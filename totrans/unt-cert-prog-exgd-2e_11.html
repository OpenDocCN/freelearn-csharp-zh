<html><head></head><body>
		<div><h1 id="_idParaDest-187"><em class="italic"><a id="_idTextAnchor190"/>Chapter 11</em>: Storing Data and Audio Mixer</h1>
			<p>In this chapter, we will be looking at common ways of storing and sending data for our game. This will also involve us making use of Unity's ready-made <strong class="bold">Audio Mixer</strong> for us to store the player's volume settings for the game.</p>
			<p>As you may recall, in the previous chapter, we had begun making our own pause screen from scratch. We will be carrying on with this in this chapter. We still need to work on the music and sound effects slider on the pause screen. We will hold all Audio Source controls for each sound to be played in the <strong class="bold">Audio Mixer</strong>. The <strong class="bold">Audio Mixer</strong> will act as a central point for all sound and can also be manipulated via scripting, which we will also be doing in this chapter. If our game had more sound effects and more music, an <strong class="bold">Audio Mixer</strong> controlling the game's sound from one place would help us avoid getting tangled up with all the different audio source components attached to game objects.</p>
			<p>We will be making use of storing the volume settings with Unity's own <code>PlayerPrefs</code>, which stores data locally on the platform playing the game. This is also known as persistent data because we can turn off the machine that holds the volume information and when the machine is turned back on, the data remains on the system. We will introduce serializing our objects into data and deserializing the data back into objects.  This is useful if we want to send batches of data onto a database.</p>
			<p>In this chapter, we will be covering the following topics:</p>
			<ul>
				<li>Using the <strong class="bold">Audio Mixer</strong></li>
				<li>Storing data</li>
			</ul>
			<p>Let's get started!</p>
			<h1 id="_idParaDest-188"><a id="_idTextAnchor191"/>Core exam skills covered in this chapter</h1>
			<p>The following are the core exam skills that will be covered in this chapter:</p>
			<p><em class="italic">Programming core interactions</em>:</p>
			<ul>
				<li>Implement and configure game object behavior and physics.</li>
			</ul>
			<p><em class="italic">Developing application systems</em>:</p>
			<ul>
				<li>Interpret scripts for application interface flow such as menu systems, UI navigation, and application settings.</li>
				<li>Analyze scripts for user progression features such as scoring, leveling, and in-game economies utilizing technologies such as Unity Analytics and <code>PlayerPrefs</code>.</li>
				<li>Identify scripts for saving and retrieving application and user data.</li>
			</ul>
			<p><em class="italic">Programming for scene and environment design</em>:</p>
			<ul>
				<li>Determine scripts for implementing audio assets.</li>
			</ul>
			<p><em class="italic">Working in professional software development teams</em>:</p>
			<ul>
				<li>Recognize techniques for structuring scripts for modularity, readability, and reusability.</li>
			</ul>
			<h1 id="_idParaDest-189"><a id="_idTextAnchor192"/>Technical requirements</h1>
			<p>The project content for this chapter can be found at <a href="https://github.com/PacktPublishing/Unity-Certified-Programmer-Exam-Guide-Second-Edition/tree/main/Chapter_11">https://github.com/PacktPublishing/Unity-Certified-Programmer-Exam-Guide-Second-Edition/tree/main/Chapter_11</a>.</p>
			<p>You can download the entirety of each chapter's project files at <a href="https://github.com/PacktPublishing/Unity-Certified-Programmer-Exam-Guide-Second-Edition">https://github.com/PacktPublishing/Unity-Certified-Programmer-Exam-Guide-Second-Edition</a>.</p>
			<p>All content for this chapter is held in the chapter's <code>unitypackage</code> file, including a <code>Complete </code>folder that contains all of the work that we'll carry out in this chapter.</p>
			<p>Check out the following video to see the <em class="italic">Code in Action</em>: <a href="https://bit.ly/3EYHpxf">https://bit.ly/3EYHpxf</a>.</p>
			<h1 id="_idParaDest-190"><a id="_idTextAnchor193"/>Using the Audio Mixer</h1>
			<p>As the<a id="_idIndexMarker1204"/> game grows, it's useful to have a mixer channel that focuses on all the allocated volume levels and sound effects. Otherwise, if not for a separate mixer channel, we would be clicking on various game objects and adjusting each of their components in the <strong class="bold">Inspector</strong> window.</p>
			<p>For our game, we are going to keep this simple and create three <strong class="bold">Audio Groups</strong> with no added effects. Let's take a look at what each <strong class="bold">Audio Group</strong> will focus on:</p>
			<ol>
				<li><strong class="bold">Master Audio Group</strong>: Controls the master for the entire game</li>
				<li><strong class="bold">Music Audio Group</strong>: Controls the music of each level</li>
				<li><strong class="bold">Effects Audio Group</strong>: Controls the sound effects of the bullets firing from our player's ship</li>
			</ol>
			<p>The following screenshot<a id="_idIndexMarker1205"/> shows <strong class="bold">Audio Mixer</strong> and the setup for the three <strong class="bold">Audio Groups</strong>:</p>
			<div><div><img src="img/Figure_11.01_B18381.jpg" alt="Figure 11.1 – Audio Mixer window with Master, Music, and Effects Audio Groups&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.1 – Audio Mixer window with Master, Music, and Effects Audio Groups</p>
			<p class="callout-heading">Further Information</p>
			<p class="callout">If you would like to know more <a id="_idIndexMarker1206"/>about the layout of <strong class="bold">Audio Mixer</strong>, check out the documentation at <a href="https://docs.unity3d.com/Manual/AudioMixerOverview.html">https://docs.unity3d.com/Manual/AudioMixerOverview.html</a>.</p>
			<p>Let's now start <a id="_idIndexMarker1207"/>by creating the <strong class="bold">Audio Mixer</strong> within the Unity Editor, by following these steps:</p>
			<ol>
				<li value="1">In the <code>Assets</code> and right-click on an open space within the folder.</li>
				<li>From the drop-down menu, select <strong class="bold">Create</strong>, followed by <strong class="bold">Audio Mixer</strong>. The following screenshot shows the selection being made:</li>
			</ol>
			<div><div><img src="img/Figure_11.02_B18381.jpg" alt="Figure 11.2 – Create an Audio Mixer&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.2 – Create an Audio Mixer</p>
			<ol>
				<li value="3">With that, a new <code>MasterMixer</code>.</li>
			</ol>
			<p>Before we hook up the mixer to the <code>LevelMusic</code> and <code>Player_Bullet</code> game objects (because these are the two game objects making the sounds), we need to go into the <strong class="bold">Audio Mixer</strong> and create <strong class="bold">Music</strong> and <strong class="bold">Effects</strong> mixers first (we only have the master <strong class="bold">Audio Group</strong> on its own at the moment).</p>
			<p>Let's have a<a id="_idIndexMarker1209"/> closer look at our <code>MasterMixer</code>, double-click the <code>MasterMixer</code> file in the <strong class="bold">Project</strong> window. We will be presented with the following screen:</p>
			<div><div><img src="img/Figure_11.03_B18381.jpg" alt="Figure 11.3 – Audio Mixer window with Master Audio Group&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.3 – Audio Mixer window with Master Audio Group</p>
			<p>The previous <a id="_idIndexMarker1210"/>screenshot shows our setup for the <strong class="bold">Audio Mixer</strong>. It consists of four categories:</p>
			<ol>
				<li value="1"><code>MasterMixer</code>.</li>
				<li><strong class="bold">Snapshots</strong>: Consider<a id="_idIndexMarker1212"/> this a save state for our mixer. We can have multiple snapshots, such as a physical Hi-Fi where we can select different saved presets (Rock, Disco, Classical, and so on). Snapshots are used in the same way as presets; it saves us time so that we don't always have to adjust the mixer settings.</li>
				<li><code>MasterMixer</code> will be our two groups – one for <strong class="bold">Music</strong> and the other for <strong class="bold">Effects</strong>. We will create these soon.</li>
				<li><strong class="bold">Views</strong>: Used<a id="_idIndexMarker1214"/> to save different <strong class="bold">Audio Mixer</strong> UI layouts.</li>
			</ol>
			<p>Don't worry<a id="_idIndexMarker1215"/> too much about the details as we are going to focus mainly on <strong class="bold">groups</strong>. There is more we can do with Audio Mixers. Check the official Unity documentation to find out more at <a href="https://docs.unity3d.com/Documentation/Manual/AudioMixer.html">https://docs.unity3d.com/Documentation/Manual/AudioMixer.html</a>.</p>
			<p>To add two<a id="_idIndexMarker1216"/> extra volume mixers next to our <strong class="bold">Master</strong>, we need to do the following:</p>
			<ol>
				<li value="1">Right-click <strong class="bold">Master</strong> under the <strong class="bold">Groups</strong> section and select <strong class="bold">Add child group</strong>. We will gain a new mixer, as shown in the following screenshot:</li>
			</ol>
			<div><div><img src="img/Figure_11.04_B18381.jpg" alt="Figure 11.4 – Creating a new Audio Group&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.4 – Creating a new Audio Group</p>
			<ol>
				<li value="2">Right-click <strong class="bold">New Group</strong> (circled in the previous screenshot) and select <strong class="bold">Rename</strong> from the drop-down menu.</li>
				<li>Rename <code>New Group</code> to <code>Music</code>.</li>
				<li>Repeat <em class="italic">steps 1-3</em> to create another <code>Effects</code>.</li>
			</ol>
			<p>The following screenshot shows <a id="_idIndexMarker1217"/>what the <strong class="bold">Audio Mixer</strong> window will look like now, with all three ASVs:</p>
			<div><div><img src="img/Figure_11.05_B18381.jpg" alt="Figure 11.5 – Audio Mixer with all three Audio Groups&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.5 – Audio Mixer with all three Audio Groups</p>
			<p>Great! Now, we can move on to hooking these <code>LevelMusic</code> game object, which is a child of the <code>GameManager</code> game object.</p>
			<p>To update our <code>LevelMusic</code> game object's <strong class="bold">Audio Source</strong> component, do the following:</p>
			<ol>
				<li value="1">Load up the <code>bootUp</code> scene from the Unity Editor.</li>
				<li>In the <code>GameManager</code> game object and select the <code>LevelMusic</code> game object.</li>
				<li>Back in the <strong class="bold">Project</strong> window, click the arrow to the left of <strong class="bold">MasterMixer</strong> to expand its content.</li>
				<li>Click <a id="_idIndexMarker1218"/>the <strong class="bold">Music</strong> child group and drag it into the <strong class="bold">Output</strong> field of LevelMusic's <strong class="bold">Audio Source</strong>, as shown in the following screenshot:</li>
			</ol>
			<div><div><img src="img/Figure_11.06_B18381.jpg" alt="Figure 11.6 – Drag the Music Audio Group to the LevelMusic Audio Source Output field &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.6 – Drag the Music Audio Group to the LevelMusic Audio Source Output field </p>
			<ol>
				<li value="5">Click <strong class="bold">Overrides |Apply All </strong>in the <strong class="bold">Inspector</strong> window to update the GameManager's prefab settings.</li>
			</ol>
			<p>Now, we need to do something similar for our <code>player_bullet</code> prefab. To update its <strong class="bold">Audio Source</strong> with the <strong class="bold">Effects</strong> mixer, do the following:</p>
			<ol>
				<li value="1">In the <code>Assets/Prefab/Player</code> folder. There, you should find our <code>player_bullet</code> game object.</li>
				<li>Select <code>player_bullet</code> (denoted as <code>player_bullet</code> for <strong class="bold">Audio Source</strong> <strong class="bold">Output</strong> (denoted as <strong class="bold">3</strong>).</li>
			</ol>
			<p>The following screenshot shows what the <code>player_bullet</code> game object's <strong class="bold">Audio Source</strong> should look like in the <strong class="bold">Inspector</strong> window:</p>
			<div><div><img src="img/Figure_11.07_B18381.jpg" alt="Figure 11.7 – Drag the player_bullet's Audio Group Effects into the Audio Source Output field&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.7 – Drag the player_bullet's Audio Group Effects into the Audio Source Output field</p>
			<p>Now, the <strong class="bold">Audio Mixer</strong> is nearly ready to be connected to our pause screen's <strong class="bold">Music</strong> and <strong class="bold">Effects</strong> sliders. We need to do one more thing before we move on to the next section, and that is to make the <strong class="bold">audio group's</strong> volume accessible so we can make it communicate with the pause screen's audio sliders. To do this, we need to set our <strong class="bold">Audio Mixer's</strong> Attenuation Volume property to open or <strong class="bold">expose</strong> it to our scripts. </p>
			<p>To expose and name <a id="_idIndexMarker1219"/>our <strong class="bold">audio groups</strong>, we need to do the following:</p>
			<ol>
				<li value="1">In the <strong class="bold">Project</strong> window, go to <strong class="bold">MasterMixer</strong> and expand its content so that we can see its groups.</li>
				<li>Select the <strong class="bold">Music</strong> group.</li>
				<li>In the <strong class="bold">Inspector</strong> window, we are presented with the <strong class="bold">Music</strong> <strong class="bold">Group's </strong>properties. We want to expose <strong class="bold">Volume</strong> so that we can alter it with our script.</li>
				<li>Right-click <strong class="bold">Volume</strong> (In the <strong class="bold">Inspector</strong> window, under <strong class="bold">Attenuation</strong>) and select <strong class="bold">Expose 'Volume (of Music)' to script</strong>, as shown in the following screenshot:</li>
			</ol>
			<div><div><img src="img/Figure_11.08_B18381.jpg" alt="Figure 11.8 – In the Inspector window, right-click Attenuation Volume and select Expose 'Volume (of Music) to script'&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.8 – In the Inspector window, right-click Attenuation Volume and select Expose 'Volume (of Music) to script'</p>
			<p>Now, we also have the<a id="_idIndexMarker1220"/> option to give the exposed volume a reference name instead of its default name of <code>MyExposedParam</code>.</p>
			<p>To change the reference of the exposed <strong class="bold">Music</strong> <strong class="bold">Volume</strong>, do the following:</p>
			<ol>
				<li value="1">Back in the <code>MasterMixer</code> file.</li>
				<li>As you may have noticed, in the top-right corner of <strong class="bold">Audio Mixer</strong>, we are notified that we have <strong class="bold">Exposed Parameters (1)</strong> (denoted by <strong class="bold">1</strong> in the following screenshot). The <strong class="bold">1</strong> is the <strong class="bold">Music</strong> <strong class="bold">Volume</strong> that we just exposed.</li>
				<li>Click <strong class="bold">Exposed Parameters (1)</strong> (denoted by <strong class="bold">1</strong>).</li>
				<li>Right-click the <strong class="bold">MyExposedParam Volume (of Music)</strong> (denoted by <strong class="bold">2</strong>).</li>
				<li>Select <strong class="bold">Rename</strong> from the drop-down menu (denoted by <strong class="bold">3</strong>).</li>
				<li>In the parameter that appears, rename it <code>musicVol</code> (denoted by <strong class="bold">4</strong>).</li>
			</ol>
			<p>The following screenshot shows the stages we just spoke about in the preceding steps:</p>
			<div><div><img src="img/Figure_11.09_B18381.jpg" alt="Figure 11.9 – Renaming MyExposedParam to musicVol&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.9 – Renaming MyExposedParam to musicVol</p>
			<p>I hope you <a id="_idIndexMarker1221"/>understood this process well, because I want you to do it again but with the <code>effectsVol</code>.</p>
			<p>Finally, we will have our exposed volume references named like so in our <strong class="bold">Audio Mixer</strong>:</p>
			<p class="figure-caption"><img src="img/Figure_11.10_B18381.png" alt="Figure 11.10 – Both of the exposed parameters are renamed&#13;&#10;"/></p>
			<p class="figure-caption">Figure 11.10 – Both of the exposed parameters are renamed</p>
			<p>Nice work! Before we move on to the next section, let's briefly recap what we have covered so far in this section:</p>
			<ul>
				<li>We introduced the <strong class="bold">Audio Mixer</strong> and its benefits.</li>
				<li>We created <strong class="bold">Audio Groups</strong> for our Mixer.</li>
				<li>We attached the <strong class="bold">Audio Mixer</strong> to our game object's Audio Source.</li>
				<li>We exposed the <strong class="bold">Audio Mixer</strong> to our scripts.</li>
			</ul>
			<p>In the next section, we are going to code our pause screen's <strong class="bold">Volume</strong> and <strong class="bold">Effects</strong> sliders.</p>
			<h2 id="_idParaDest-191"><a id="_idTextAnchor194"/>Attaching the Audio Mixer to UI sliders</h2>
			<p>In this <a id="_idIndexMarker1222"/>section, we are going to write two methods (<code>SetMusicLevelFromSlider</code> and <code>SetEffectsLevelFromSlider</code>) that <a id="_idIndexMarker1223"/>attach our pause screen's <strong class="bold">Music</strong> and <strong class="bold">Effects</strong> sliders to the <strong class="bold">Audio Mixer</strong> that we created in the previous section.</p>
			<p>Let's start by adding the <strong class="bold">Music</strong> slider to our <strong class="bold">Audio Mixer</strong> via the script, as follows:</p>
			<ol>
				<li value="1">In the <code>PauseComponent</code> script, which should be located in <code>Assets/Script</code>, and open it.</li>
			</ol>
			<p>Because we are going to access the <strong class="bold">Audio Mixer</strong>, we need an extra Unity library to let this happen.</p>
			<ol>
				<li value="2">At the top of our <code>PauseComponent</code> script, add the following line of code:<pre>using UnityEngine.Audio;</pre></li>
				<li>Now, add a field that will store a reference for our <strong class="bold">Audio Mixer</strong>:<pre> [SerializeField]
 AudioMixer masterMixer;</pre></li>
				<li>We also need to add two more variables for the <code>masterMixer</code> variable, as follows:<pre> [SerializeField]
 GameObject musicSlider;
 [SerializeField]
 GameObject effectsSlider;</pre></li>
				<li>Save the script and return to the Unity Editor.</li>
				<li>Load up the <code>level1</code> scene where we started creating our pause screen.</li>
				<li>Select the <code>PauseContainer</code> game object from the <strong class="bold">Hierarchy</strong> window.</li>
				<li>In the <code>PauseComponent</code>. Here, we can drag the two sliders from the <strong class="bold">Hierarchy</strong> window and our <strong class="bold">MasterMixer</strong> from the <strong class="bold">Project</strong> window, as shown in<a id="_idIndexMarker1225"/> the following screenshot:</li>
			</ol>
			<div><div><img src="img/Figure_11.11_B18381.jpg" alt="Figure 11.11 – Dragging each game object and file into their directed fields &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.11 – Dragging each game object and file into their directed fields </p>
			<p>Now that our three references (music slider, effects slider, and master mixer) are hooked up to their parameters, we can return to our <code>PauseComponent</code> script and code in a method for each of the pause screen's volume sliders.</p>
			<p>To add functionality so that our <strong class="bold">Music</strong> slider controls the <strong class="bold">Music</strong> mixer, do the following:</p>
			<ol>
				<li value="1">In the <code>PauseComponent</code> script, add a <code>public</code> method within the <code>PauseComponent</code> class:<pre>  public void SetMusicLevelFromSlider()
  {
    masterMixer.SetFloat("musicVol",musicSlider.GetComponent&lt;Slider&gt;
      ().value);
  }</pre></li>
			</ol>
			<p>The <code>public</code> method we have just entered, <code>SetMusicLevelFromSlider</code>, will <a id="_idIndexMarker1226"/>work as an event from the <code>masterMixer</code>. Within this variable, we call its <code>SetFloat</code> function, which takes two parameters. The first is the reference name of the mixer (we called this <code>musicVol</code> earlier in this chapter), while the second is what value it is receiving to be changed. We are sending the value from our pause screen's <strong class="bold">Music</strong> slider.</p>
			<ol>
				<li value="2">Save the script and return to the Unity Editor.</li>
			</ol>
			<p>Next, we need to attach our <code>SetMusicLevelFromSlider</code> method. To make the <strong class="bold">Music</strong> slider communicate with the method, follow these steps:</p>
			<ol>
				<li value="1">Still in our <code>level1</code> scene, in the <code>Music</code> game object.</li>
				<li>In the <strong class="bold">Inspector</strong> window, click the <strong class="bold">+</strong> button at the bottom of the <strong class="bold">Inspector</strong> window to allow an event to be attached to the <strong class="bold">Slider</strong> component (denoted by <strong class="bold">1</strong> in the following screenshot).</li>
				<li>Drag the <code>PauseContainer</code> game object from the <strong class="bold">Hierarchy</strong> window to the <strong class="bold">None (Object)</strong> parameter (denoted by <strong class="bold">2</strong>).</li>
				<li>Click the <code>SetMusicLevelFromSlider</code> (denoted by <strong class="bold">3</strong>).</li>
			</ol>
			<p>The<a id="_idIndexMarker1228"/> following screenshot references the previous instructions for the <code>Music</code> game object in the <strong class="bold">Inspector</strong> window:</p>
			<div><div><img src="img/Figure_11.12_B18381.jpg" alt="Figure 11.12 – Three steps in updating the Music game object's music slider event&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.12 – Three steps in updating the Music game object's music slider event</p>
			<p>If we go back to the <strong class="bold">bootUp</strong> scene and click <strong class="bold">Play</strong> in the Unity Editor and then, in the <strong class="bold">Game</strong> window, click the game's pause button when it appears, we will be able to turn the music up and down with the <strong class="bold">Music</strong> slider.</p>
			<p>Now, we <a id="_idIndexMarker1229"/>need to repeat this in a similar fashion for our <strong class="bold">Effects</strong> slider volume to work:</p>
			<ol>
				<li value="1">Return to the <code>PauseComponent</code> script and enter the following method:<pre>    public void SetEffectsLevelFromSlider()
  {
    masterMixer.SetFloat("effectsVol",effectsSlider.    GetComponent
       &lt;Slider&gt;().value);
  }</pre></li>
			</ol>
			<p>As we can see, the code is virtually the same as the code for <code>SetMusicLevelFromSlider</code>, apart from the variable names.</p>
			<ol>
				<li value="2">Save<a id="_idIndexMarker1230"/> the script.</li>
				<li>Return <a id="_idIndexMarker1231"/>to the Unity Editor and repeat the same procedure for dragging the <code>PauseComponent</code> game object but this time with the <code>Effects</code> game object and selecting <code>SetEffectsLevelFromSlider</code>, as shown in the following screenshot:</li>
			</ol>
			<div><div><img src="img/Figure_11.13_B18381.jpg" alt="Figure 11.13 – Updating the Effects game object audio slider&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.13 – Updating the Effects game object audio slider</p>
			<p>Finally, test to see if the <strong class="bold">Effects</strong> slider works when we run the game.</p>
			<p>This will obviously only work in <code>level1</code> as <code>level2</code> and <code>level3</code> don't have the extra game objects. In the next chapter, we will be making a new <code>level3</code>, so if you can hold on until then, it'll save going through the process of removing and adding scenes again.</p>
			<p>In this section, we covered the following functionality for the <code>PauseComponent</code> script:</p>
			<ul>
				<li>Ensuring it recognizes Audio Mixer</li>
				<li>Ensuring that the <strong class="bold">Music</strong> and <strong class="bold">Effects</strong> UI sliders alter <strong class="bold">Audio Groups</strong></li>
			</ul>
			<p>In the next section, we are going to start looking at how to store our data. We will use the pause screen one more time to show the benefit of our game remembering our volume settings.</p>
			<h1 id="_idParaDest-192"><a id="_idTextAnchor195"/>Storing data</h1>
			<p>In this section, we <a id="_idIndexMarker1232"/>are going to cover how we are going to store our data, such as the game's volume settings so that when we play our game, we don't have to keep setting the volume settings to where they were before. We want the game to remember them for us.</p>
			<p>There are multiple ways we can store data. The ones we are going to cover are the two most common choices for Unity development. They are as follows:</p>
			<ol>
				<li value="1"><code>PlayerPrefs</code> shortly to save our volume settings so that when we turn our game off and back on, it will remember our settings. <code>PlayerPrefs</code> is easily accessible from outside the game with a text file reader. When it comes to development, make sure you don't use <code>PlayerPrefs</code> to store sensitive information such as credit card details or things that would give a player an unfair advantage such as storing lives, energy, score, in-game credit, and so on. For more information<a id="_idIndexMarker1235"/> about <code>PlayerPrefs</code>, check Unity's description at <a href="https://docs.unity3d.com/Documentation/ScriptReference/PlayerPrefs.html">https://docs.unity3d.com/Documentation/ScriptReference/PlayerPrefs.html</a>.</li>
				<li><code>PlayerPrefs</code> is that it uses data types such as <code>int</code>, <code>float</code>, and <code>string</code>, just like <code>PlayerPrefs</code>, but also <code>object</code> (our classes act as blueprints so that we can make objects), <code>array</code>, <code>bool</code>, and <code>null</code>. </li>
			</ol>
			<p>It's wise to<a id="_idIndexMarker1238"/> use this form of <strong class="bold">application programming interface</strong> (<strong class="bold">API</strong>) for transferring game data (lives, levels, player progress, energy, and so on), but don't store highly personal details locally with regards to in-game credit, bank details, personal addresses, and emails, unless you are using some form of encryption.</p>
			<p class="callout-heading">Information</p>
			<p class="callout">An API basically tells us how applications communicate with each other.</p>
			<p>For more<a id="_idIndexMarker1239"/> information about JSON with Unity, check the documentation at <a href="https://docs.unity3d.com/Documentation/Manual/JSONSerialization.html">https://docs.unity3d.com/Documentation/Manual/JSONSerialization.html</a>.</p>
			<p>In the following sections, we are going to cover these two ways of storing data on the basis they are officially covered by Unity and are likely to be mentioned in your exam:</p>
			<ul>
				<li><code>PlayerPrefs</code> and volume settings</li>
				<li>JSON and storing game stats</li>
				<li>Adding JSON variables</li>
			</ul>
			<p>Let's make a start by looking at how to use <code>PlayerPrefs</code> and revisit our pause screen one last time.</p>
			<h2 id="_idParaDest-193"><a id="_idTextAnchor196"/>PlayerPrefs and volume settings</h2>
			<p>As we know, our<a id="_idIndexMarker1240"/> game has volume controls for its music and <a id="_idIndexMarker1241"/>sound effects on the pause screen. To make our game remember these volume settings, even when the game has been turned off and back on again, we need<a id="_idIndexMarker1242"/> to do the following:</p>
			<ol>
				<li value="1">In the <code>Assets/Script</code>.</li>
				<li>Double-click the <code>PauseComponent</code> script.</li>
				<li>Scroll down to the <code>SetMusicLevelFromSlider</code> method and add the following extra line of code at the bottom but within the method's scope. The following code shows what the method now looks like with the added code:<pre>  public void SetMusicLevelFromSlider()
  {
    masterMixer.SetFloat("musicVol",musicSlider.        GetComponent
       &lt;Slider&gt;().value);
    PlayerPrefs.SetFloat("musicVolume",musicSlider.        GetComponent
       &lt;Slider&gt;().value);    // &lt;&lt; NEW CODE LINE
  }</pre></li>
			</ol>
			<p>In the preceding code, we used the <code>value</code> from our music <code>&lt;Slider&gt;</code> component and applied its <code>float</code> <code>value</code> to the <code>PlayerPrefs</code> <code>float</code> with <code>musicVolume</code> as our key (the reference name to identify the <code>PlayerPrefs</code> value).</p>
			<ol>
				<li value="4">Do the <a id="_idIndexMarker1243"/>same for the <code>effects</code> method:<pre>    public void SetEffectsLevelFromSlider()
  {
    masterMixer.SetFloat("effectsVol",effectsSlider.        GetComponent
      &lt;Slider&gt;().value);
    PlayerPrefs.SetFloat("effectsVolume",effectsSlider.        GetComponent
      &lt;Slider&gt;().value);  // &lt;&lt; NEW CODE LINE
  }</pre></li>
			</ol>
			<p>That's our <code>PlayerPrefs</code> file ready to store the music and effects volume. The next thing to do is reapply the music/effects volume the next time we load the level from our <code>PlayerPrefs</code>.</p>
			<p>To grab the music volume setting from our <code>PlayerPrefs</code>, do the following:</p>
			<ol>
				<li value="5">Reopen the <code>PauseComponent</code> script.</li>
				<li>Within the <code>PauseComponent</code> class, enter the following code at the bottom of the <code>Awake</code> function:<pre>    masterMixer.SetFloat("musicVol",PlayerPrefs.GetFloat("musicVolume"));
    masterMixer.SetFloat("effectsVol",PlayerPrefs.GetFloat("effectsVolume"));</pre></li>
			</ol>
			<p>In the preceding code, we are reapplying our saved <code>PlayerPrefs</code> values for our music and effects volume (which are both floats) to our Audio Mixer's <strong class="bold">Audio Groups</strong>.</p>
			<p>The volumes<a id="_idIndexMarker1244"/> that we want the mixers to have are now set. The last thing we need to do is to set both volume sliders to their UI positions.</p>
			<ol>
				<li value="7">To update the <code>PauseComponent</code>:<pre>  float GetMusicLevelFromMixer()
  {
    float musicMixersValue;
    bool result = masterMixer.GetFloat("musicVol", 
       out musicMixersValue); 
    
    if (result)
    {
      return musicMixersValue;
    }
    else
    {
      return 0;
    }
  }</pre></li>
			</ol>
			<p>The preceding code is a method that returns a <code>float</code> value called <code>GetMusicLevelFromMixer</code>.</p>
			<p>Let's go through<a id="_idIndexMarker1245"/> the steps of this <code>GetMusicLevelFromMixer</code>:</p>
			<ol>
				<li>In this method, we create a <code>float</code> variable called <code>musicMixersValue</code>.</li>
				<li>The line after <code>musicMixersValue</code> checks to see whether the <code>masterMixer</code> instance contains an <code>musicVol</code>. We know it does because we set it earlier when we exposed each of the volume settings from the <strong class="bold">Audio Mixer</strong>, as shown in the following screenshot:</li>
			</ol>
			<p class="figure-caption"><img src="img/Figure_11.14_B18381.png" alt="Figure 11.14 – Our named exposed parameters&#13;&#10;"/></p>
			<p class="figure-caption">Figure 11.14 – Our named exposed parameters</p>
			<ol>
				<li value="3">So, if <code>masterMixer</code> does contain a <code>float</code> value with the name (key) of <code>musicVol</code>, we will store it in a <code>float</code> named <code>musicMixersValue</code>. </li>
				<li><code>masterMixer.GetFloat</code> will send a <code>true</code> or <code>false</code> value if <code>masterMixer</code> does or does not contain a <code>float</code> that is also stored in a <code>bool</code> value, respectively.</li>
				<li>If the <code>bool</code> value is <code>true</code>, the <code>float</code> value from <code>masterMixer</code> is returned from the method; otherwise, it will return <code>0</code>. </li>
			</ol>
			<p>Next, we need to call this <code>GetMusicLevelFromMixer</code> and make it so it sends its value to the music slider. Let's code this in now.</p>
			<ol>
				<li value="8">Within<a id="_idIndexMarker1246"/> the <code>PauseComponent</code> script, at the top, in the <code>Awake</code> function, add the following code below the two <code>masterMixer</code> coded lines:<pre>musicSlider.GetComponent&lt;Slider&gt;().value = GetMusicLevelFromMixer();</pre></li>
			</ol>
			<p>In the preceding piece of code, we are sending the result from our <code>GetMusicLevelFromMixer</code> to the value of our <code>musicSlider</code> when the level starts.</p>
			<p>That's our music slider set. Now, we need to repeat this process for our effects slider. The process is the same, apart from using the effect slider's variables, so without repeating the same process, I want you to do the following:</p>
			<ol>
				<li>Create a <code>GetEffectsLevelFromMixer</code> method using the same code pattern as <code>GetMusicLevelFromMixer</code> but using <code>effectsVol</code> instead of <code>musicVol</code>.</li>
				<li>Assign the results of <code>GetEffectsLevelFromMixer</code> to the <code>effectsSlider</code> variable in the <code>Awake</code> function. Use the <code>musicSlider</code> variable for reference.</li>
			</ol>
			<p>Give it a go – if you're struggling, check out the <code>Complete</code> folder in this book's GitHub repository.</p>
			<p>Save the script and return to the Unity Editor. Play the first level, change the volume, quit the game, and return to the first level to see if our volume has been saved for the music and effects sliders.</p>
			<p>Now, we will move on and learn how to store and send data in a slightly different way.</p>
			<h2 id="_idParaDest-194"><a id="_idTextAnchor197"/>JSON and storing game stats</h2>
			<p>JSON is<a id="_idIndexMarker1247"/> great for creating, storing, and updating information across our game. As we mentioned earlier in this chapter, JSON is typically used for<a id="_idIndexMarker1248"/> sending data from our game to a server online where the JSON data can be delivered to another set of data.</p>
			<p>The <a id="_idIndexMarker1249"/>best way JSON was explained to me is with an analogy of me being at a restaurant, sitting at a table (my game); the waiter comes over and takes my (JSON) order, then sends it to the kitchen (the online server). Finally, the waiter returns with my food.</p>
			<p>With regards to coding JSON, we are storing variables in a single class, then serializing the class (object) into data (system memory or file). From there, we can transfer this data to an actual file or upload it to a server on a database. This whole process can also be reversed, where we take the data and return it as an object. This is called deserializing.</p>
			<p>Now, let's move on to coding some JSON values.</p>
			<h2 id="_idParaDest-195"><a id="_idTextAnchor198"/>Adding JSON variables</h2>
			<p>The<a id="_idIndexMarker1250"/> objective of working with JSON is to create a simple way of storing and updating data with JSON. In our project, we will provide a<a id="_idIndexMarker1251"/> simple example of storing statistical data for our game. When the player completes the game, we will store data and put it in JSON format.</p>
			<p>The three variables we are going to store are as follows:</p>
			<ul>
				<li><code>livesLeft</code>: How <a id="_idIndexMarker1252"/>many lives the player has left</li>
				<li><code>completed</code>: When<a id="_idIndexMarker1253"/> the player has completed the game</li>
				<li><code>score</code>: Stores <a id="_idIndexMarker1254"/>the player's score</li>
			</ul>
			<p>Let's make a start by creating a new script that will receive our game's three statistical updates. These will then be converted into JSON format. Follow these steps:</p>
			<ol>
				<li value="1">Create a new script (if you don't know how to do that, revisit the <em class="italic">Updating our camera properties via script</em> section in <a href="B18381_02_Epub.xhtml#_idTextAnchor048"><em class="italic">Chapter 2</em></a><em class="italic">,</em> <em class="italic">Adding and Manipulating Objects</em>).</li>
				<li>Call the new script <code>GameStats</code>.</li>
				<li>Before <a id="_idIndexMarker1255"/>we open the <code>GameStats</code> script, I recommend that you keep your files stored in the <code>Assets/Script</code> folder location.</li>
				<li>Next, we can open the <code>GameStats</code> script and code in the following variables:<pre>public class GameStats
{
    public int livesLeft;
    public string completed;
    public int score;
}</pre></li>
			</ol>
			<p>Notice <a id="_idIndexMarker1256"/>how the <code>GameStats</code> script doesn't require a library or need to inherit <code>MonoBehaviour</code>. We don't require either of these extra functionalities.</p>
			<p>When the player completes the game, we will take these three readings and store them in JSON format. From there, we can convert this data into a JSON file. This process is <a id="_idIndexMarker1257"/>known as <strong class="bold">serialization</strong>.</p>
			<p class="callout-heading">Serialization/Deserialization</p>
			<p class="callout">These two terms basically refer to the direction that data is stored in.</p>
			<p class="callout"><strong class="bold">Serialization</strong>: This <a id="_idIndexMarker1258"/>refers to converting an object from our script and turning it into bytes (a file, in our case).</p>
			<p class="callout"><strong class="bold">Deserialization</strong>: As you<a id="_idIndexMarker1259"/> can probably imagine, deserialization is the opposite of serialization. This means we are taking our raw data (file) and converting it into objects.</p>
			<ol>
				<li value="5">Save the script.</li>
			</ol>
			<p>Next, we <a id="_idIndexMarker1260"/>need to write some code that will update the player's lives, time and date, and score. We are going to do this when we play through the <a id="_idIndexMarker1261"/>game and complete level 3. In this case, we need to go to our <code>ScenesManager</code> and update the code.</p>
			<p>To update our <code>ScenesManager</code> so that it takes a reading of our player's stats and converts them into JSON format, we need to do the following:</p>
			<ol>
				<li value="1">In the Unity Editor, go to where our <code>ScenesManager</code> script is. This should be in the <code>Assets/Script</code> folder.</li>
				<li>Double-click the file to open it in our IDE and scroll down to the point where we check to see if the game has ended. This is located in the <code>GameTimer</code> method.</li>
			</ol>
			<p>The following screenshot shows where in the <code>ScenesManager</code> script we need to add our new method:</p>
			<div><div><img src="img/Figure_11.15_B18381.jpg" alt="Figure 11.15 – Placement marked where to add new code in our ScenesManager script&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.15 – Placement marked where to add new code in our ScenesManager script</p>
			<p>In the preceding screenshot, there is an asterisk (<code>string</code> parameter, which will be the name of the level we have completed.</p>
			<ol>
				<li value="3">Enter<a id="_idIndexMarker1263"/> the following method name where the <strong class="bold">*</strong> is in the previous screenshot:<pre>SendInJsonFormat(SceneManager.GetActiveScene().name);</pre></li>
				<li>Next, we need to create the <code>SendInJsonFormat</code> method. Scroll down to a point in the <code>ScenesManager</code> script where we are still inside its class but not another method and enter the following:<pre>  void SendInJsonFormat(string lastLevel)
  {
    if (lastLevel == "level3")
      {
        GameStats gameStats = new GameStats();
        gameStats.livesLeft = GameManager.playerLives;
        gameStats.completed = System.DateTime.Now.ToString();
         gameStats.score = GetComponent&lt;ScoreManager&gt;().             PlayersScore;
        
        string json = JsonUtility.ToJson(gameStats,true);
        Debug.Log(json);
      }
  }</pre></li>
			</ol>
			<p>In the previous code, we go through this series of steps: </p>
			<ol>
				<li>We have our <code>SendInJsonFormat</code> method, which takes a <code>string</code> parameter.</li>
				<li>Inside <a id="_idIndexMarker1264"/>the <code>SendInJsonFormat</code> method, we set an <code>if</code> statement that checks if the <code>lastLevel</code> string contains the <code>level3</code> value.</li>
				<li>If <code>lastLevel</code> is equal to the <code>level3</code> string, we go through the following steps inside the <code>if</code> statement:</li>
				<li>We <a id="_idIndexMarker1265"/>create an instance of the <code>GameStats</code> class we made earlier in this chapter.</li>
				<li>We access its <code>livesLeft</code> <code>public</code> variable and apply the static <code>playerLives</code> variable from the <code>GameManager</code> class.</li>
				<li>The next variable shows the date and time we completed the game. We send the command from the <code>System</code> library, which gives us the date and time, and we cast this as a <code>string</code> (<code>ToString()</code>). We send this result to the <code>gameStats</code> instance into the <code>completed</code> variable.</li>
				<li>The last variable we send data is the player's score. We get this from the <code>playerScore</code> <code>static</code> variable from our <code>ScoreManager</code> class.</li>
			</ol>
			<p>Now that we have applied the three variables to our <code>gameStats</code> instance, we can use Unity's <code>JsonUtility</code> class to send our <code>gameStats</code> into the <code>ToJson</code> function.</p>
			<p>We can also <a id="_idIndexMarker1266"/>make the JSON data readable by adding <code>true</code> to the parameter so that when we send a <code>log</code> command to the console to see that this has worked correctly, we can read the results.</p>
			<ol>
				<li value="5">Save the script and jump back into the Unity Editor and complete the game from the <code>bootUp</code> scene to the <code>gameOver</code> scene.</li>
			</ol>
			<p>The following screenshot shows the console log when I played through the game and completed level 3:</p>
			<div><div><img src="img/Figure_11.16_B18381.jpg" alt="Figure 11.16 – Console window giving stats about our game&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.16 – Console window giving stats about our game</p>
			<p>As you can see, we have the data from our script but displayed in JSON format.</p>
			<p>This <a id="_idIndexMarker1267"/>information can be saved to a physical file or can be sent to a server to keep a record of our player's gameplay and/or deserialize the results later on with our project (check out the following tip if you are interested in this). The point is that we are storing and carrying data that can be sent away for us or another system to pick up, store, and alter.</p>
			<p class="callout-heading">Further Information</p>
			<p class="callout">At this point, we have successfully taken the variables from our object and converted them into JSON data format (serialization).</p>
			<p class="callout">Now, imagine if we altered our data (changed its values) and wanted to bring that data back into our game's code and into a class. The reverse method would be <code>GameStats loadJsonData = JsonUtility.FromJson&lt;GameStats&gt;(json);</code>.</p>
			<p class="callout">This would update our <code>GameStats</code> variables from the JSON file. You can imagine that this would be handy for saving and loading data in games.</p>
			<p>Next, we will take the <a id="_idIndexMarker1268"/>most current JSON data file and send it to the device (the machine we play the game on). To <a id="_idIndexMarker1269"/>make and store a JSON file containing our custom-made stats, do the following:</p>
			<ol>
				<li value="1">Return to the <code>ScenesManager</code> script.</li>
				<li>Scroll to where we created the <code>SendInJsonFormat</code> method.</li>
				<li>Within the method's <code>if</code> statement, at the bottom, inside the scope of the <code>if</code> statement, add the following two lines of code:<pre>Debug.Log(Application.persistentDataPath + "/GameStatsSaved.json");
System.IO.File.WriteAllText(Application.persistentDataPath +
   "/GameStatsSaved.json",json);</pre></li>
			</ol>
			<p>The preceding code block shows that we don't necessarily need to add <code>Debug.Log</code> and shows us where the next line of code is creating and storing our JSON file. Each platform will store data in different folders. For more information on the locations for different platforms, please refer to Unity's own documentation about <a id="_idIndexMarker1270"/>persistent data at <a href="https://docs.unity3d.com/ScriptReference/Application-persistentDataPath.html">https://docs.unity3d.com/ScriptReference/Application-persistentDataPath.html</a>.</p>
			<p>My system is a Windows PC, so <code>Debug.Log</code> will display the following location on my system:</p>
			<div><div><img src="img/Figure_11.17_B18381.jpg" alt="Figure 11.17 – Windows location of JSON file&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.17 – Windows location of JSON file</p>
			<p>The second <a id="_idIndexMarker1271"/>line of the code we just entered is using a system library and uses a function (<code>Application.persistentDataPath</code>) that will refer to our device's local storage. Then, after the function, we add the name we want to use to refer to our JSON file (<code>/GameStatsSaved.json</code>), along with the format type, which is <code>json</code>.</p>
			<ol>
				<li value="4">Save the script.</li>
				<li>Return <a id="_idIndexMarker1272"/>to the Unity Editor, play all the way to the end of the game, and go to the location that is displayed on the console screen. The following screenshot shows the location of the file that our game has made:</li>
			</ol>
			<div><div><img src="img/Figure_11.18_B18381.jpg" alt="Figure 11.18 – Windows location of our JSON file&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.18 – Windows location of our JSON file</p>
			<ol>
				<li value="6">Double-click the file to view its content. As you will see, this is where our game's stats are kept, as shown in the following screenshot:</li>
			</ol>
			<div><div><img src="img/Figure_11.19_B18381.jpg" alt="Figure 11.19 – The content of our JSON file&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.19 – The content of our JSON file</p>
			<p>With this, we <a id="_idIndexMarker1273"/>are now aware of how to store non-sensitive data such as our game's volume (<code>PlayerPrefs</code>), as well <a id="_idIndexMarker1274"/>as how to create, store, and send other types of data in JSON format.</p>
			<p>Now, let's summarize this chapter.</p>
			<p class="callout-heading">Further Information</p>
			<p class="callout">For more information<a id="_idIndexMarker1275"/> about all of these events, check the official Unity documentation at <a href="https://docs.unity3d.com/Manual/UnityAnalyticsEvents.html">https://docs.unity3d.com/Manual/UnityAnalyticsEvents.html</a>.</p>
			<h1 id="_idParaDest-196"><a id="_idTextAnchor199"/>Summary</h1>
			<p>This chapter covered a variety of topics, including understanding Unity's Audio Mixer, which is where we can control the sounds in our game, and altering levels with our script. Then, we moved on and looked at storing data with <code>PlayerPrefs</code> and custom storage in JSON format in order to recognize the differences between the two ways of storing data. For JSON, we converted our data from object-based data into bytes and stored the results in a file (serialization). </p>
			<p>In future projects, you will likely make use of the coding we covered in the last two chapters regarding storing and reapplying data such as music and sound effect volume sliders. Hopefully, you will also be able to go further with this data by using other components in your projects so that your game can send out data onto the cloud and monitor your players' progress as helpful feedback to improve development.</p>
			<p>In the next chapter, we are going to look at pathfinding and how to improve the overall performance of our game.  </p>
		</div>
	</body></html>