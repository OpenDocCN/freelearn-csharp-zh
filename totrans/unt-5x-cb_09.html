<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Playing and Manipulating Sounds</h1></div></div></div><p>In this chapter, we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Matching the audio pitch to the animation speed</li><li class="listitem" style="list-style-type: disc">Simulating acoustic environments with Reverb Zones</li><li class="listitem" style="list-style-type: disc">Preventing an Audio Clip from restarting if it is already playing</li><li class="listitem" style="list-style-type: disc">Waiting for audio to finish playing before auto-destructing an object</li><li class="listitem" style="list-style-type: disc">Adding volume control with Audio Mixers</li><li class="listitem" style="list-style-type: disc">Making a dynamic soundtrack with Snapshots</li><li class="listitem" style="list-style-type: disc">Balancing in-game audio with Ducking</li></ul></div><div><div><div><div><h1 class="title"><a id="ch09lvl1sec88"/>Introduction</h1></div></div></div><p>Sound is a very important part of the gaming experience. In fact, we can't stress enough how crucial it is to the player's immersion in a virtual environment. Just think of the engine running in your favorite racing game, the distant urban buzz in a simulator game, or the creeping noises in horror games. Think of how these sounds transport you <em>into</em> the game.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec254"/>The big picture</h2></div></div></div><p>Before getting on with the recipes, let's step back and have a quick review on how sound works on <a class="indexterm" id="id923"/>Unity 5.</p><p>Audio files can be embedded into GameObjects through the<a class="indexterm" id="id924"/> <strong>Audio Source</strong> component. Unity supports<a class="indexterm" id="id925"/> <strong>3D sounds</strong>, which means that the location and distance between the audio sources and <strong>Audio Listener</strong> matter in the way the <a class="indexterm" id="id926"/>sound is perceived in terms of loudness and the left/right balance. This is unless the audio source is specified as <strong>2D sound</strong> (which is usually the case for the background soundtrack music).</p><p>Although all sound is sent to the scene's <strong>Audio </strong><a class="indexterm" id="id927"/><strong>Listener</strong> (a component that is usually attached to<a class="indexterm" id="id928"/> the <strong>Main Camera</strong>, and that shouldn't be attached simultaneously on more than one object), Unity 5 brings a new player to the audio scene: the <strong>Audio Mixer</strong>. The Audio mixer radically changes the way in which sound elements can be experienced and worked with. It allows developers to mix and arrange audio pretty much in the same way that musicians and producers<a class="indexterm" id="id929"/> do in their <strong>Digital Audio Workstations</strong> (<strong>D.A.W</strong>), such as <strong>GarageBand</strong> or <strong>ProTools</strong>. It allows<a class="indexterm" id="id930"/> you to route audio source clips into specific channels<a class="indexterm" id="id931"/> that can have their volumes individually adjusted and processed by customized effects and filters. You can work with multiple Audio Mixers, send a mixer's output to a parent mixer, and save mix preferences as <strong>Snapshots</strong>. Also, you can <a class="indexterm" id="id932"/>access mixer parameters from scripting. The following figure represents the main Unity 5 audio mixing concepts and their relationships:</p><div><img alt="The big picture" src="img/1362_09_01.jpg"/></div><p>Taking advantage of the new Audio Mixer feature in many example projects, this chapter is filled with recipes that will hopefully help you implement a better and more efficient sound design for your projects, augmenting the player's sense of immersion, transporting him or her into the game environment, and even improving the gameplay.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec89"/>Matching the audio pitch to the animation speed</h1></div></div></div><p>Many artifacts<a class="indexterm" id="id933"/> sound higher in pitch when accelerated and <a class="indexterm" id="id934"/>lower when slowed down. Car engines, fan coolers, Vinyl—a record player… the list goes on. If you want to simulate this kind of sound effect in an animated object that can have its speed changed dynamically, follow this recipe.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec255"/>Getting ready</h2></div></div></div><p>For this recipe, you'll need an animated 3D object and an audio clip. Please use the files <code class="literal">animatedRocket.fbx</code> and <code class="literal">engineSound.wav</code>, available in the <code class="literal">1362_09_01</code> folder of the code bundle.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec256"/>How to do it...</h2></div></div></div><p>To change the pitch of an audio clip according to the speed of an animated object, please follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Import the <code class="literal">animatedRocket.fbx</code> file into your <strong>Project</strong>.</li><li class="listitem">Select the <code class="literal">animatedRocket</code> file in the <strong>Project</strong> view. Then, from the <strong>Inspector</strong> view, check its <strong>Import Settings</strong>. Select <strong>Animations</strong>, then select the clip <strong>Take 001</strong>, and make sure to check the <strong>Loop Time</strong> option. Click on the <strong>Apply</strong> button, shown as follows, to save the changes:<div><img alt="How to do it..." src="img/1362_09_02.jpg"/></div><div><div><h3 class="title"><a id="tip11"/>Tip</h3><p>The reason why we didn't need to check <strong>Loop Pose</strong> option is because our animation already loops in a seamless fashion. If it didn't, we could have checked that option to automatically create a seamless transition from the last to the first frame<a class="indexterm" id="id935"/> of the animation.</p></div></div></li><li class="listitem">Add the <a class="indexterm" id="id936"/><strong>animatedRocket</strong> GameObject to the scene by dragging it from the <strong>Project</strong> view into the <strong>Hierarchy</strong> view.</li><li class="listitem">Import the <code class="literal">engineSound.wav</code> audio clip.</li><li class="listitem">Select the<strong> animatedRocket</strong> GameObject. Then, drag <strong>engineSound</strong> from the <strong>Project</strong> view into the <strong>Inspector</strong> view, adding it as an <strong>Audio Source</strong> for that object.</li><li class="listitem">In the <strong>Audio Source</strong> component of <strong>animatedRocket</strong>, check the box for the <strong>Loop</strong> option, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362_09_03.jpg"/></div></li><li class="listitem">We need to create a <a class="indexterm" id="id937"/><strong>Controller</strong> for our object. In the <strong>Project</strong> view, click <strong>Create</strong> <a class="indexterm" id="id938"/>and select <strong>Animator Controller</strong>. Name it as <code class="literal">rocketlController</code>.</li><li class="listitem">Double-click <a class="indexterm" id="id939"/>on <strong>rocketController</strong> object to open the <strong>Animator</strong> window, as shown. Then, right-click on the gridded area and select the <strong>Create State</strong> | <strong>Empty</strong> option, from the contextual menu:<div><img alt="How to do it..." src="img/1362_09_04.jpg"/></div></li><li class="listitem">Name the new state <code class="literal">spin</code> and set <strong>Take 001</strong> as its motion in the <strong>Motion</strong> field:<div><img alt="How to do it..." src="img/1362_09_05.jpg"/></div></li><li class="listitem">From the <strong>Hierarchy</strong> view, select <strong>animatedRocket</strong>. Then, in the <strong>Animator</strong> component (in the <strong>Inspector</strong> view), set <strong>rocketController</strong> as its <strong>Controller</strong> and make sure<a class="indexterm" id="id940"/> that the <strong>Apply Root Motion</strong> option is unchecked as shown:<div><img alt="How to do it..." src="img/1362_09_06.jpg"/></div></li><li class="listitem">In the <strong>Project</strong> view, create a new <strong>C# Script</strong> and rename it to <code class="literal">ChangePitch</code>.</li><li class="listitem">Open the <a class="indexterm" id="id941"/>script in your editor and replace everything with the following code:<div><pre class="programlisting">using UnityEngine;

public class ChangePitch : MonoBehaviour{
  public float accel = 0.05f;
  public float minSpeed = 0.0f;
  public float maxSpeed = 2.0f;
  public float animationSoundRatio = 1.0f;
  private float speed = 0.0f;
  private Animator animator;
  private AudioSource audioSource;

  void Start(){
    animator = GetComponent&lt;Animator&gt;();
    audioSource = GetComponent&lt;AudioSource&gt;();
    speed = animator.speed;
    AccelRocket (0f);
  }

  void Update(){
    if (Input.GetKey (KeyCode.Alpha1))
      AccelRocket(accel);

    if (Input.GetKey (KeyCode.Alpha2))
      AccelRocket(-accel);
  }

  public void AccelRocket(float accel){
    speed += accel;
    speed = Mathf.Clamp(speed,minSpeed,maxSpeed);
    animator.speed = speed = Mathf.Clamp (speed, 0, maxSpeed);
    float soundPitch = animator.speed * animationSoundRatio;
    audioSource.pitch = soundPitch;
  }
}</pre></div></li><li class="listitem">Save your <a class="indexterm" id="id942"/>script and add it as a component to <strong>animatedRocket</strong> GameObject.</li><li class="listitem">Play the scene and change the animation speed by pressing key <em>1</em> (accelerate) and <em>2</em> (decelerate) on your alphanumeric keyboard. The audio pitch will change accordingly.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec257"/>How it works...</h2></div></div></div><p>At the <code class="literal">Start()</code> method, besides storing the <strong>Animator</strong> and <strong>AudioSource</strong> components in variables, we'll <a class="indexterm" id="id943"/>get the initial <code class="literal">speed</code> from the <strong>Animator</strong>, and we'll call the <code class="literal">AccelRocket()</code> function by passing <code class="literal">0</code> as an argument, only for that function to calculate the resulting pitch for the <strong>Audio Source</strong>. During <code class="literal">Update()</code> function, the lines of the <code class="literal">if(Input.GetKey (KeyCode.Alpha1))</code> and <code class="literal">if(Input.GetKey (KeyCode.Alpha2))</code> code detect whenever the <em>1</em> or <em>2</em> keys are being pressed on the alphanumeric keyboard to call the <code class="literal">AccelRocket()</code> function, passing a <code class="literal">accel</code> float variable as an argument. The <code class="literal">AccelRocket()</code> function, in its turn, increments <code class="literal">speed</code> with the received argument (the <code class="literal">accel</code> float variable). However, it uses the <code class="literal">Mathf.Clamp()</code>command to limit the new speed value between the minimum and maximum speed as set by the user. Then, it changes the <strong>Animator</strong> speed and <strong>Audio Source</strong> pitch according to the new <code class="literal">speed</code> absolute value. The value is clamped a second time to avoid negative numbers. Should you reverse the animation, check out a solution in the completed project included with the code files. Also, please note that setting the animation speed and therefore, the sound pitch to <code class="literal">0</code> will cause the sound to stop, making<a class="indexterm" id="id944"/> it clear that stopping the object's animation also prevents the engine sound from playing.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec258"/>There's more...</h2></div></div></div><p>Here is some information <a class="indexterm" id="id945"/>on how to fine-tune and customize this recipe.</p><div><div><div><div><h3 class="title"><a id="ch09lvl3sec65"/>Changing the Animation/Sound Ratio</h3></div></div></div><p>If you want the <a class="indexterm" id="id946"/>audio clip pitch to be more or less affected by the animation speed, change the value of the <strong>Animation/Sound Ratio</strong> parameter.</p></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec66"/>Accessing the function from other scripts</h3></div></div></div><p>The <code class="literal">AccelRocket()</code> function was<a class="indexterm" id="id947"/> made public <a class="indexterm" id="id948"/>so that it can be accessed from other scripts. As an example, we have included the <code class="literal">ExtChangePitch.cs</code> script in <code class="literal">1362_09_01</code> folder. Try attaching this script to the <strong>Main Camera</strong> object and use it to control the speed by clicking on the left and right mouse buttons.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec90"/>Simulating acoustic environments with Reverb Zones</h1></div></div></div><p>Once<a class="indexterm" id="id949"/> you have created your level's geometry and the scene is looking just the way you want it to, you might want your sound effects to correspond to that look. Sound behaves differently depending upon the environment in <a class="indexterm" id="id950"/>which it is projected, so it can be a good idea to make it reverberate accordingly. In this recipe, we will address this acoustic effect by using <strong>Reverb Zones</strong>.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec259"/>Getting ready</h2></div></div></div><p>For this recipe, we have prepared the <code class="literal">ReverbZone.unitypackage</code> file, containing a basic level named <code class="literal">reverbScene</code> and the <code class="literal">Signal</code> prefab. The package is in the <code class="literal">1362_09_02</code> folder in the code bundle.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec260"/>How to do it...</h2></div></div></div><p>Follow these steps to simulate the sonic landscape of a tunnel:</p><div><ol class="orderedlist arabic"><li class="listitem">Import the <code class="literal">ReverbZone</code> package into your Unity Project.</li><li class="listitem">In the <strong>Project</strong> view, open the <strong>reverbScene </strong>level, inside the <code class="literal">ReverbZones</code> folder. This is a basic scene, featuring a controllable character and a tunnel.</li><li class="listitem">Now, drag the <strong>Signal</strong> prefab from the <strong>Project</strong> view into <strong>Hierarchy</strong>, as shown in the<a class="indexterm" id="id951"/> following screenshot. This will add a sound-emitting object to the scene. Place it in the center of the tunnel.<div><img alt="How to do it..." src="img/1362_09_07.jpg"/></div></li><li class="listitem">Make five<a class="indexterm" id="id952"/> copies of the <strong>Signal</strong> GameObject and distribute them across the tunnel (leaving a copy just outside each entrance):<div><img alt="How to do it..." src="img/1362_09_08.jpg"/></div></li><li class="listitem">In in the<a class="indexterm" id="id953"/> <strong>Hierarchy</strong> view, navigate to <strong>Create</strong> | <strong>Audio</strong> | <strong>Audio Reverb Zone</strong> to add a <strong>Reverb Zone</strong> to the scene. Then, place it in the center of the tunnel.</li><li class="listitem">Select the <strong>Reverb Zone</strong> GameObject. In the <strong>Inspector</strong> view, change the <strong>Reverb Zone </strong>component<a class="indexterm" id="id954"/> parameters to these values: <strong>Min Distance</strong>: <code class="literal">6</code>; <strong>Max Distance</strong>: <code class="literal">18</code>; and <strong>Preset</strong>: <code class="literal">StoneCorridor</code> as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362_09_09.jpg"/></div></li><li class="listitem">Play the scene and walk through the tunnel using the <em>W A S D</em> keys ( and pressing <em>Shift</em> to run). You will hear the audio reverberate when inside the <strong>Reverb Zone</strong> area.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec261"/>How it works...</h2></div></div></div><p>Once positioned, the <a class="indexterm" id="id955"/><strong>Audio Reverb Zone</strong> applies <a class="indexterm" id="id956"/>an audio filter to all audio sources within its radius.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec262"/>There's more...</h2></div></div></div><p>Here are more options for you to try.</p><div><div><div><div><h3 class="title"><a id="ch09lvl3sec67"/>Attaching the Audio Reverb Zone component to Audio Sources</h3></div></div></div><p>Instead of creating an <a class="indexterm" id="id957"/><strong>Audio Reverb Zone</strong> GameObject, you can attach it to the sound emitting object (in our case, <strong>Signal</strong>) as a component through the <strong>Component</strong> | <strong>Audio</strong> | <strong>Audio Reverb Zone</strong> menu. In this case, the <strong>Reverb Zone</strong> will be individually set up around the object.</p></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec68"/>Making your own Reverb settings</h3></div></div></div><p>Unity comes with several <a class="indexterm" id="id958"/><strong>Reverb Presets</strong>. We have used <strong>StoneCorridor</strong>, but your scene can ask for something less intense (such as <strong>Room</strong>) or more radical (such as <strong>Psychotic</strong>). If these presets still won't be<a class="indexterm" id="id959"/> able to recreate the effect that you have in mind, change it to <strong>User</strong> and edit its parameters as you wish.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec91"/>Preventing an Audio Clip from restarting if it is already playing</h1></div></div></div><p>In a game, there<a class="indexterm" id="id960"/> may be several different events that cause a sound to start playing. If the sound is already playing, then in almost all cases, we won't wish to restart the sound. This recipe includes a test, so that an <strong>Audio Source</strong> component is only sent a <code class="literal">Play()</code> message if it is currently not playing.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec263"/>Getting ready</h2></div></div></div><p>Try this with any audio clip that is one second or longer in duration. We have included the <code class="literal">engineSound</code> audio clip inside the <code class="literal">1362_09_03</code> folder.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec264"/>How to do it...</h2></div></div></div><p>To prevent an <strong>Audio Clip</strong> from restarting, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Create an <strong>Empty</strong> GameObject and rename it to <strong>AudioObject</strong>. Then, add an <strong>Audio Source</strong> component to this object (in the <strong>Component</strong> | <strong>Audio</strong> | <strong>Audio Source</strong> menu).</li><li class="listitem">Import the<a class="indexterm" id="id961"/> <code class="literal">engineSound</code> audio clip and drag it from the <strong>Project</strong> view to populate the <strong>Audio Clip</strong> parameter of the <strong>Audio Source</strong> component of <strong>AudioObject</strong>:<div><img alt="How to do it..." src="img/1362_09_10.jpg"/></div></li><li class="listitem">Create a UI button named <strong>PlaySoundButton</strong> on the screen and attach the following script to this button:<div><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI;
public class AvoidEarlySoundRestart : MonoBehaviour {
  public AudioSource audioSource;
  public Text message;

  void Update(){
    string statusMessage = "Play sound";
    if(audioSource.isPlaying)
      statusMessage = "(sound playing)";
    message.text = statusMessage;
  }

  // button click handler
  public void PlaySoundIfNotPlaying(){
    if( !audioSource.isPlaying)
      audioSource.Play();
  }
}</pre></div></li><li class="listitem">With <strong>PlaySoundButton</strong> selected in the <strong>Hierarchy</strong> panel, drag <strong>AudioObject</strong> into the <strong>Inspector</strong> view for the public <strong>Audio Source</strong> variable, and drag the <strong>Text</strong> child of <strong>PlaySoundButton </strong>for the public <strong>ButtonText</strong>:<div><img alt="How to do it..." src="img/1362_09_11.jpg"/></div></li><li class="listitem">With <strong>PlaySoundButton</strong> selected in the <strong>Hierarchy</strong> panel, create a new on-click event handler, dragging the <strong>PlaySoundButton</strong> into the <strong>Object</strong> slot, and selecting the <strong>PlaySoundIfNotPlaying()</strong> function.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec265"/>How it works...</h2></div></div></div><p>The <strong>Audio Source</strong> <a class="indexterm" id="id962"/>components have a public readable property <strong>isPlaying</strong>, which is a Boolean true/false flag, indicating if the sound is currently playing. The text of the button is set to display <code class="literal">Play Sound</code> when the sound is not playing, and (<code class="literal">sound playing</code>) when it is. When the button is clicked, the <code class="literal">PlaySoundIfNotPlaying()</code> method is called. This method uses an <code class="literal">if</code> statement, ensuring that a <code class="literal">Play()</code> message is only sent to the Audio Source component if its <strong>isPlaying</strong> is false.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec266"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Waiting for the audio to finish before auto-destructing an object</em> recipe in this chapter.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec92"/>Waiting for audio to finish playing before auto-destructing an object</h1></div></div></div><p>An event may occur (such as an object pickup or the killing of an enemy) that we wish to notify to the player by playing an audio clip, and an associated visual object (such as an explosion particle system, or a temporary object in the location of the event). However, as soon as the clip has finished playing, we will wish for the visual object to be removed from the scene. This<a class="indexterm" id="id963"/> recipe provides a simple way to link the ending of a playing audio clip with the automatic destruction of its containing object.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec267"/>Getting ready</h2></div></div></div><p>Try this with any audio clip that is a second or more in duration. We have included the <code class="literal">engineSound</code> audio clip inside the <code class="literal">1362_09_04</code> folder.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec268"/>How to do it...</h2></div></div></div><p>To wait for<a class="indexterm" id="id964"/> audio to finish playing before destroying a GameObject, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Create an <strong>Empty</strong> GameObject and rename it to <strong>AudioObject</strong>. Then, add an <strong>Audio Source</strong> component to this object (in the <strong>Component</strong> | <strong>Audio</strong> | <strong>Audio Source</strong> menu).</li><li class="listitem">Import the <code class="literal">engineSound</code> audio clip and drag it from the <strong>Project</strong> view to populate the <strong>Audio Clip</strong> parameter of the <strong>Audio Source</strong> component of <strong>AudioObject</strong>, and deselect the component's <strong>Play On Awake</strong> checkbox:<div><img alt="How to do it..." src="img/1362_09_12.jpg"/></div></li><li class="listitem">Add the following script class to <strong>AudioObject</strong>:<div><pre class="programlisting">using UnityEngine;
using System.Collections;

public class AudioDestructBehaviour : MonoBehaviour {
  private AudioSource audioSource;

  void Start(){
    audioSource = GetComponent&lt;AudioSource&gt;();
  }

  private void Update(){
    if( !audioSource.isPlaying )
      Destroy(gameObject);
  }
}</pre></div></li><li class="listitem">In <strong>Inspector</strong> view, disable (un-check) the <code class="literal">AudioDestructBehaviour</code> scripted component of <strong>AudioObject</strong> (when needed, it will be re-enabled via C# code):<div><img alt="How to do it..." src="img/1362_09_13.jpg"/></div></li><li class="listitem">Create a<a class="indexterm" id="id965"/> new C# file named <strong>ButtonActions</strong>, containing the following code:<div><pre class="programlisting">using UnityEngine;
using System.Collections;

public class ButtonActions : MonoBehaviour{
  public AudioSource audioSource;
  public AudioDestructBehaviour audioDestructScriptedObject;

  public void PlaySound(){
    if( !audioSource.isPlaying )
      audioSource.Play();
  }

  public void DestroyAfterSoundStops(){
    audioDestructScriptedObject.enabled = true;
  }
}</pre></div></li><li class="listitem">Create a UI button named <strong>PlaySoundButton</strong> on the screen with a button <code class="literal">Play Sound</code> text, and attach the <strong>ButtonActions</strong> script to this button.</li><li class="listitem">With <strong>PlaySoundButton</strong> selected in the <strong>Hierarchy</strong>, create a new on-click event handler, dragging <strong>PlaySoundButton</strong> into the <strong>Object</strong> slot, and selecting the <strong>PlaySound()</strong> function.</li><li class="listitem">With the <strong>PlaySoundButton</strong> selected in the <strong>Hierarchy</strong> panel, drag <strong>AudioObject</strong> into the <strong>Inspector</strong> view for the public <strong>Audio Source</strong> variable <strong>AudioObject</strong>. Also, drag <strong>AudioObject</strong> into the <strong>Inspector</strong> view for the public <strong>Script</strong> variable <strong>AudioDestructScriptedObject</strong>, shown as follows:<div><img alt="How to do it..." src="img/1362_09_14.jpg"/></div></li><li class="listitem">Create a second UI button named <strong>DestoryWhenSoundFinishedButton</strong> on screen, with the button text <code class="literal">Destroy When Sound Finished</code>, and attach the <strong>ButtonActions</strong> script to this button.</li><li class="listitem">With <strong>DestoryWhenSoundFinishedButton</strong> selected in the <strong>Hierarchy</strong> panel, create a new on-click event handler, dragging <strong>PlaySoundButton</strong> into the <strong>GO</strong> slot, and then selecting the <strong>DestroyAfterSoundStops()</strong> function.</li><li class="listitem">Just as you did with the other button, now the <strong>DestoryWhenSoundFinishedButton</strong> selected in the <strong>Hierarchy</strong> panel, drag <strong>AudioObject</strong> into the <strong>Inspector</strong> view for the public <strong>Script</strong> variable <strong>MyAudioDestructObect</strong>.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec269"/>How it works...</h2></div></div></div><p>The GameObject<a class="indexterm" id="id966"/> named <strong>AudioObject</strong> contains an Audio Source component, which stores and manages the playing of the audio clip. <strong>AudioObject</strong> also contains a scripted component, which is an instance of the <strong>AudioDestructBehaviour</strong> class. This script is initially disabled. When enabled, every frame this object (via its <code class="literal">Update()</code> method) tests whether the audio source is not playing (<code class="literal">!audio.isPlaying</code>). As soon as the audio is found to be not playing, the GameObject is destroyed.</p><p>There are two UI buttons created. Button <strong>PlaySoundButton </strong>calls the <code class="literal">PlaySound()</code> method. This method will start playing the audio clip, if it is not already playing.</p><p>The second button called <strong>DestoryWhenSoundFinishedButton</strong> calls the <code class="literal">DestoryAfterSoundStops()</code> method. This method enables the scripted component <strong>AudioDestructBehaviour</strong> in GameObject <strong>AudioObject</strong>—so that that GameObject will be destroyed, once the sound has finished playing.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec270"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Preventing an Audio Clip from restarting if it is already playing</em> recipe in this chapter</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec93"/>Adding volume control with Audio Mixers</h1></div></div></div><p>Sound volume<a class="indexterm" id="id967"/> adjustment can be a very important feature, especially<a class="indexterm" id="id968"/> if your game is a standalone. After all, it can be very frustrating to access the operational system volume control. In this recipe, we will use the new <strong>Audio Mixer</strong> feature to create independent volume controls for Music and Sound FX.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec271"/>Getting ready</h2></div></div></div><p>For this recipe, we have provided a Unity package named <code class="literal">Volume.unitypackage</code>, containing an initial scene featuring soundtrack music and sound effects. The file is available inside the <code class="literal">1362_09_05</code> folder.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec272"/>How to do it...</h2></div></div></div><p>To add volume control sliders to your scene, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Import <code class="literal">Volume.unitypackage</code> into your project.</li><li class="listitem">Open the <strong>Volume</strong> scene (available in the <strong>Assets</strong> | <strong>Volume</strong> folder). Play the scene and walk towards the semitransparent green wall in the tunnel, using the <em>W A S D</em> keys (while pressing the <em>Shift</em> key to run). You will be able to listen to:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A looping soundtrack music</li><li class="listitem" style="list-style-type: disc">Bells ringing</li><li class="listitem" style="list-style-type: disc">A robotic speech whenever the character collides with the wall</li></ul></div></li><li class="listitem">From the <strong>Project</strong> view, use the <strong>Create</strong> drop-down menu to add <strong>Audio Mixer</strong> to the project. Name it <strong>MainMixer</strong>. Double-click on it to open the <strong>Audio Mixer</strong> window.</li><li class="listitem">From the <strong>Groups</strong> view, highlight <strong>Master</strong> and click the <strong>+</strong> sign to add a child to the <strong>Master</strong> group. Name it <strong>Music</strong>. Then, highlight <strong>Master</strong> again and add a new child group named <strong>FX</strong>, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362_09_15.jpg"/></div></li><li class="listitem">From the <strong>Mixers</strong> view, highlight <strong>MainMixer</strong> and click the <strong>+</strong> sign to add a new <strong>Mixer</strong> to the project. Name it <strong>MusicMixer</strong>. Then, drag it into the <strong>MainMixer</strong> and select the <strong>Music</strong> group as its <strong>Output</strong>. Repeat the operation to add a mixer <a class="indexterm" id="id969"/>named <strong>FxMixer</strong> to the project by selecting the <strong>FX</strong> group as its output:<div><img alt="How to do it..." src="img/1362_09_16.jpg"/></div></li><li class="listitem">Now, select <strong>MusicMixer</strong>. Select its<a class="indexterm" id="id970"/> <strong>Master</strong> group and add a child named <strong>Soundtrack</strong>. Then, select <strong>FxMixer</strong> and add two children to its <strong>Master</strong> group: one named <strong>Speech</strong>, and another named <strong>Bells</strong>, as shown:<div><img alt="How to do it..." src="img/1362_09_17.jpg"/></div></li><li class="listitem">From the <strong>Hierarchy</strong> <a class="indexterm" id="id971"/>view, select the <strong>DialogueTrigger</strong> object. Then, in the <strong>Inspector</strong> view, change its<a class="indexterm" id="id972"/> <strong>Output</strong> track to <strong>FxMixer</strong> | <strong>Speech</strong> in the <strong>Audio Source</strong> component:<div><img alt="How to do it..." src="img/1362_09_18.jpg"/></div></li><li class="listitem">Now, select the <strong>Soundtrack</strong> GameObject. From the <strong>Inspector</strong> view, find the <strong>Audio Source</strong> component and change its <strong>Output</strong> track to <strong>MusicMixer</strong> | <strong>Soundtrack</strong>:<div><img alt="How to do it..." src="img/1362_09_19.jpg"/></div></li><li class="listitem">Finally, from<a class="indexterm" id="id973"/> the <strong>Assets</strong> folder in the <strong>Project</strong> view, select the <strong>Signal</strong> prefab . From the <strong>Inspector</strong> view, access its <strong>Audio Source</strong> component and change its <strong>Output</strong> to <strong>FxMixer</strong> | <strong>Bells</strong>:<div><img alt="How to do it..." src="img/1362_09_20.jpg"/></div></li><li class="listitem">From the <strong>Audio Mixer</strong> window, choose <strong>MainMixer</strong> and select its <strong>Master</strong> track. Then, from the <strong>Inspector</strong> view, right-click on <strong>Volume</strong> in the <strong>Attenuation</strong> component. From<a class="indexterm" id="id974"/> the context menu, select <strong>Expose 'Volume (of Master) to script</strong> as shown in the following screenshot. Repeat the operation for the <strong>Music and FX</strong> tracks:<div><img alt="How to do it..." src="img/1362_09_21.jpg"/></div></li><li class="listitem">From the top of the <strong>Audio Mixer</strong> with the <strong>MainMixer</strong> selected, access the <strong>Exposed Parameters</strong> drop-down menu. Then, right-click on <strong>MyExposedParam</strong> and rename it to <code class="literal">OverallVolume</code>. Then, rename <strong>MyExposedParam1</strong> as <code class="literal">MusicVolume</code> and <strong>MyExposedParam2</strong> as <code class="literal">FxVolume</code>.</li><li class="listitem">From the <strong>Project</strong> view, create a new <strong>C# Script</strong> and rename it to <code class="literal">VolumeControl</code>.</li><li class="listitem">Open the script in <a class="indexterm" id="id975"/>your editor and<a class="indexterm" id="id976"/> replace everything with the following code:<div><pre class="programlisting">using UnityEngine;

using UnityEngine.Audio;
using System.Collections;

public class VolumeControl : MonoBehaviour{
  public AudioMixer myMixer;
  private GameObject panel;
  private bool isPaused = false;

  void Start(){
    panel = GameObject.Find("Panel");
    panel.SetActive(false);
  }

  void Update() {
    if (Input.GetKeyUp (KeyCode.Escape)) {
      panel.SetActive(!panel.activeInHierarchy);

      if(isPaused)
        Time.timeScale = 1.0f;
      else
        Time.timeScale = 0.0f;

      isPaused = !isPaused;
    }
  }

  public void ChangeMusicVol(float vol){
    myMixer.SetFloat ("MusicVolume", Mathf.Log10(vol) * 20f);
  }

  public void ChangeFxVol(float vol){
    myMixer.SetFloat ("FxVolume", Mathf.Log10(vol) * 20f);
  }

  public void ChangeOverallVol(float vol){
    myMixer.SetFloat ("OverallVolume", Mathf.Log10(vol) * 20f);
  }
}</pre></div></li><li class="listitem">From the <strong>Hierarchy</strong> view, use the <strong>Create</strong> dropdown menu to add a <strong>Panel</strong> to the scene (<strong>Create</strong> | <strong>UI</strong> | <strong>Panel</strong>). Note that it will automatically add a <strong>Canvas</strong> to the scene.</li><li class="listitem">From the <strong>Hierarchy</strong> view, use the <strong>Create</strong> dropdown menu to add a <strong>Slider</strong> to the scene (<strong>Create</strong> | <strong>UI</strong> | <strong>Slider</strong>). Make it a child of the <strong>Panel</strong> object.</li><li class="listitem">Rename the slider as <strong>OverallSlider</strong>. Duplicate it and rename the new copy to <strong>MusicSlider</strong>. Then, in the <strong>Inspector</strong> view, <strong>Rect Transform</strong> component, change its <strong>Pos Y</strong> <a class="indexterm" id="id977"/>parameter to <code class="literal">-40</code>.</li><li class="listitem">Duplicate <strong>MusicSlider</strong> <a class="indexterm" id="id978"/>and rename the new copy to <strong>FxSlider</strong>. Then, change its <strong>Pos Y</strong> parameter to <code class="literal">-70</code>:<div><img alt="How to do it..." src="img/1362_09_22.jpg"/></div></li><li class="listitem">Select the <strong>Canvas</strong> GameObject and add the <strong>VolumeControl</strong> script to it. Then, populate the <strong>MyMixer</strong> field of <strong>Volume Control</strong> with <strong>MainMixer</strong>:<div><img alt="How to do it..." src="img/1362_09_23.jpg"/></div></li><li class="listitem">Select the <strong>OverallSlider</strong> component. From the <strong>Inspector</strong> view at the <strong>Slider</strong> component, change <strong>Min Value</strong> to <code class="literal">0.000025</code> (or <strong>2.5e-05</strong>). Then, below the <strong>On Value Changed</strong> list, click the <strong>+</strong> sign to add an action. From <strong>Hierarchy</strong> panel, drag <a class="indexterm" id="id979"/><strong>Canvas</strong> into the <strong>Object</strong> slot and <a class="indexterm" id="id980"/>using the drop-down menu, choose<strong> VolumeControl</strong> | <strong>ChangeOverallVol</strong> option, as shown in the following screenshot, For testing purposes, change the appropriate selector from  <strong>Runtime Only</strong> to <strong>Editor and Runtime</strong>.<div><img alt="How to do it..." src="img/1362_09_24.jpg"/></div></li><li class="listitem">Repeat the previous step with <strong>MusicSlider</strong> and <strong>FxSlider</strong>, but this time, choose <strong>ChangeMusicVol</strong> and <strong>ChangeFxVol</strong> options respectively from the drop-down menu.</li><li class="listitem">Play the scene. You will be able to access the sliders when pressing <em>Escape</em> on your keyboard and adjust volume settings from there.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec273"/>How it works...</h2></div></div></div><p>The new <strong>Audio Mixer</strong> feature works in a similar fashion to Digital Audio Workstations, such as Logic and Sonar. Through <strong>Audio Mixers</strong>, you can organize and manage audio elements by routing them into specific groups that can have individual audio tracks to be tweaked around, allowing for adjustments in volume level and sound effects.</p><p>By organizing and routing <a class="indexterm" id="id981"/>our audio clips into two groups (<strong>Music</strong> and <strong>FX</strong>), we established the <strong>MainMixer</strong> as a unified controller for volume. Then, we have used the <strong>Audio Mixer</strong> to expose the volume levels for each track of the <strong>MainMixer</strong>, making them accessible to our script.</p><p>Also, we have set<a class="indexterm" id="id982"/> up a basic GUI featuring three sliders that, when in use, will pass their float values (between <code class="literal">0.000025</code> and <code class="literal">1</code>) as arguments to three specific functions in our script: <code class="literal">ChangeMusicVol</code>, <code class="literal">ChangeFxVol</code>, and <code class="literal">ChangeOverallVol</code>. These functions, on their turn, use the <code class="literal">SetFloat</code> command to effectively change the volume levels at runtime. However, before passing on the new volume levels, the script converts linear values (between <code class="literal">0.000025</code> and <code class="literal">1</code>) to the decibel levels that are used by the <strong>Audio Mixer</strong>. This conversion is calculated through the <em>log(x) * 20</em> mathematical function.</p><div><div><h3 class="title"><a id="note43"/>Note</h3><p>For a full explanation on issues regarding the conversion of linear values to decibel levels and vice-versa, check out Aaron Brown's excellent article at <a class="ulink" href="http://www.playdotsound.com/portfolio-item/decibel-db-to-float-value-calculator-making-sense-of-linear-values-in-audio-tools/">http://www.playdotsound.com/portfolio-item/decibel-db-to-float-value-calculator-making-sense-of-linear-values-in-audio-tools/</a>.</p></div></div><p>It's worth mentioning that the <code class="literal">VolumeControl</code> script also includes code to enable and disable the <strong>GUI</strong> and<a class="indexterm" id="id983"/> the<a class="indexterm" id="id984"/> <strong>EventSystem</strong>, depending upon if the player hits the Escape key to activate/deactivate the volume control sliders.</p><p>A very important note—do not change the volume of any <strong>MainMixer'</strong>s tracks; leave them at <code class="literal">0</code> dB. The reason is that our <code class="literal">VolumeControl</code> script sets their maximum volume level. For general adjustments, use the secondary Mixers <strong>MusicMixer</strong> and <strong>FxMixer</strong>.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec274"/>There's more...</h2></div></div></div><p>Here is some extra information<a class="indexterm" id="id985"/> on Audio Mixers.</p><div><div><div><div><h3 class="title"><a id="ch09lvl3sec69"/>Playing with Audio Production</h3></div></div></div><p>There are many <a class="indexterm" id="id986"/>creative uses for exposed parameters. We can, for instance, add effects<a class="indexterm" id="id987"/> such as <strong>Distortion</strong>, <strong>Flange</strong>, and <strong>Chorus</strong> to audio<a class="indexterm" id="id988"/> channels, allowing users to operate virtual sound tables/mixing<a class="indexterm" id="id989"/> boards.</p></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec275"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Making a dynamic soundtrack with Snapshots</em> recipe in this chapter</li><li class="listitem" style="list-style-type: disc">The <em>Balancing the in-game audio with Ducking</em> in this chapter</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec94"/>Making a dynamic soundtrack with Snapshots</h1></div></div></div><p>Dynamic soundtracks are the<a class="indexterm" id="id990"/> ones that change according to what is happening to the player in the game, musically reflecting that place or moment of the character's adventure. In this recipe, we will implement a soundtrack that changes twice; the first time when entering a tunnel, and the second time when coming out of its end. To achieve this, we will use the new <strong>Snapshot</strong> feature of the <strong>Audio Mixer</strong>.</p><p>Snapshots are a way of saving the state of your <strong>Audio Mixer</strong>, keeping your preferences for volume levels, audio effects, and more. We can access these states through script, creating transitions between mixes, and by bringing up the desired sonic ambience for each moment of the player's journey.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec276"/>Getting ready</h2></div></div></div><p>For this recipe, we have prepared a basic game level, contained inside the Unity package named <code class="literal">DynamicSoundtrack</code>, and two soundtrack audio clips in <code class="literal">.ogg</code> format: <code class="literal">Theme01_Percussion</code> and <code class="literal">Theme01_Synths</code>. All these files can be found in the <code class="literal">1362_09_06</code> folder.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec277"/>How to do it...</h2></div></div></div><p>To make a dynamic soundtrack, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Import the <code class="literal">DynamicSoundtrack</code> package and both <code class="literal">.ogg</code> files to your Unity Project.</li><li class="listitem">Open the level named <strong>Dynamic</strong>.</li><li class="listitem">From the <strong>Project</strong> view, use the <strong>Create</strong> drop-down menu to add <strong>Audio Mixer</strong> to the project. Name it <strong>MusicMixer</strong>. Double-click on it to open the <strong>Audio Mixer</strong> window.</li><li class="listitem">From the <strong>Groups</strong> view, highlight <strong>Master</strong> and click the <strong>+</strong> sign to add a child to the <strong>Master</strong><a class="indexterm" id="id991"/> group. Name it as <strong>Music</strong>. Then, add two child groups to <strong>Music</strong>: <strong>Percussion </strong>and <strong>Synths</strong>:<div><img alt="How to do it..." src="img/1362_09_25.jpg"/></div></li><li class="listitem">From the <strong>Hierarchy</strong> view, create a new <strong>Empty</strong> GameObject. Name it <strong>Music</strong>. Then, add two <strong>Empty Child</strong> GameObjects to it. Name them as <strong>Percussion</strong> and <strong>Synth</strong>.</li><li class="listitem">From the <strong>Project</strong> view, drag the <strong>Audio Clip</strong> named <strong>Theme01_Percussion </strong>into the <strong>Percussion</strong> GameObject in <strong>Hierarchy</strong>. Select <strong>Percussion</strong> and in the <strong>Inspector</strong> view, access the <strong>Audio Source</strong> component. Change its <strong>Output</strong> to <strong>Percussion (MusicMixer)</strong>, make sure the <strong>Play On Awake</strong> option is checked, check the <strong>Loop</strong> option, and make sure its <strong>Spatial Blend</strong> is set to <strong>2D</strong>, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362_09_26.jpg"/></div></li><li class="listitem">Now, drag the <a class="indexterm" id="id992"/><strong>Theme01_Synths</strong> audio file into the <strong>Synths</strong> GameObject. From the <strong>Inspector</strong> view, change its <strong>Output</strong> to <strong>Synths (MusicMixer)</strong>, make sure the <strong>Play On Awake</strong> option is checked, check the <strong>Loop</strong> option, and make sure its <strong>Spatial Blend</strong> is set to <strong>2D</strong>, as shown:<div><img alt="How to do it..." src="img/1362_09_27.jpg"/></div></li><li class="listitem">Open the <strong>Audio Mixer</strong> and play the scene. We will now use the mixer to set the soundtrack for the start of the scene. With the scene playing, click on the <strong>Edit in Play Mode</strong><a class="indexterm" id="id993"/> button, as shown in the screenshot, at the top of the <strong>Audio Mixer</strong>. Then, drop the volume on the <strong>Synths</strong> track down to <strong>-30 dB</strong>:<div><img alt="How to do it..." src="img/1362_09_28.jpg"/></div></li><li class="listitem">Now, select the <strong>Percussion</strong> track. Right-click on <strong>Attenuation</strong> and add the <strong>High-pass</strong> effect before it:<div><img alt="How to do it..." src="img/1362_09_29.jpg"/></div></li><li class="listitem">From the<a class="indexterm" id="id994"/> <strong>Inspector</strong> view, change the <strong>Cutoff frequency</strong> of the <strong>High-pass</strong> effect to <strong>544.00 Hz</strong>:<div><img alt="How to do it..." src="img/1362_09_30.jpg"/></div></li><li class="listitem">Every change, so far, has been assigned to the current <strong>Snapshot</strong>. From the <strong>Snaphots</strong> view, right-click on the current <strong>Snapshot</strong> and rename it to <strong>Start</strong>. Then, right-click on <strong>Start</strong> and select the <strong>Duplicate</strong> option. Rename the new snapshot as <strong>Tunnel</strong>, as shown:<div><img alt="How to do it..." src="img/1362_09_31.jpg"/></div></li><li class="listitem">Select the <strong>Tunnel</strong> snapshot. Then, from the <strong>Inspector</strong> view, change the <strong>Cutoff frequency</strong> of the <strong>Highpass</strong> effect to <strong>10.00 Hz</strong>:<div><img alt="How to do it..." src="img/1362_09_32.jpg"/></div></li><li class="listitem">Switch<a class="indexterm" id="id995"/> between the <strong>Tunnel</strong> and <strong>Start</strong> snapshots. You'll be able to hear the difference.</li><li class="listitem">Duplicate the <strong>Tunnel</strong> snapshot, rename it as <strong>OtherSide</strong>, and select it.</li><li class="listitem">Raise the volume of the <strong>Synths</strong> track up to <strong>0 dB</strong>:<div><img alt="How to do it..." src="img/1362_09_33.jpg"/></div></li><li class="listitem">Now that we have our three <strong>Snapshots</strong>, it's time to create triggers to make transitions among them. From the <strong>Hierarchy</strong> view, use the <strong>Create</strong> drop-down menu to add a <strong>Cube</strong> to the scene (<strong>Create</strong> | <strong>3D Object</strong> | <strong>Cube</strong>).</li><li class="listitem">Select the new <a class="indexterm" id="id996"/><strong>Cube</strong> and rename it <code class="literal">SnapshotTriggerTunnel</code>. Then, from the <strong>Inspector</strong> view, access the <strong>Box Collider</strong> component and check the <strong>Is Trigger</strong> option, as shown in the following screenshot. Also, uncheck its <strong>Mesh Renderer</strong> component. Finally, adjust its size and position to the scene tunnel's interior:<div><img alt="How to do it..." src="img/1362_09_34.jpg"/></div></li><li class="listitem">Make two copies of <code class="literal">SnapshotTriggerTunnel</code> and rename them to <code class="literal">SnapshotTriggerStart</code> and <code class="literal">SnapshotTriggerOtherSide</code>. Then, adjust their size and position, so that they occupy the areas before the tunnel's entrance (where the character is) and after its other end, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362_09_35.jpg"/></div></li><li class="listitem">In the <strong>Project</strong> <a class="indexterm" id="id997"/>view, create a new <strong>C# Script</strong> file and rename it to <code class="literal">SnapshotTrigger</code>.</li><li class="listitem">Open the script in your editor and replace everything with the following code:<div><pre class="programlisting">using UnityEngine;
using UnityEngine.Audio;
using System.Collections;

public class SnapshotTrigger : MonoBehaviour{
  public AudioMixerSnapshot snapshot;
  public float crossfade;

  private void OnTriggerEnter(Collider other){
    snapshot.TransitionTo (crossfade);
  }
}</pre></div></li><li class="listitem">Save your script and attach it to <code class="literal">SnapshotTriggerTunnel</code>, <code class="literal">SnapshotTriggerStart</code>, and <code class="literal">SnapshotTriggerOtherSide</code> objects.</li><li class="listitem">Select <code class="literal">SnapshotTriggerTunnel</code>. Then, from the <strong>Inspector</strong> view, access the <strong>Snapshot Trigger</strong> component, setting <strong>Snapshot</strong> as <strong>Tunnel</strong>, and <strong>Crossfade</strong> as <code class="literal">2</code>, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362_09_36.jpg"/></div></li><li class="listitem">Make changes to <code class="literal">SnapshotTriggerStart</code> and <code class="literal">SnapshotTriggerOtherSide</code> by setting their <strong>Snapshots</strong> to <strong>Start</strong> and <strong>OtherSide</strong> respectively.</li><li class="listitem">Test the scene. The <a class="indexterm" id="id998"/>background music will change as the character moves from its starting point, through the tunnel, and into the other side.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec278"/>How it works...</h2></div></div></div><p>The <strong>Snapshot</strong> feature allows you to save <strong>Audio Mixer</strong> states (including all volume levels, every filter setting, and so on) so that you can change those mixing preferences at runtime, making the audio design more suitable for specific locations or gameplay settings. For this recipe, we have created three <strong>Snapshots</strong> for different moments in the player's journey: before entering the tunnel, inside the tunnel, and outside the tunnel. We have used the <strong>Highpass</strong> filter to make the initial Snapshot less intense. We have also turned the <strong>Synths</strong> track volume up to emphasize the open environment outside the tunnel. Hopefully, changes in the audio mix will collaborate with setting the right mood for the game.</p><p>To activate our snapshots, we have placed <strong>trigger colliders</strong>, featuring our <strong>Snapshot Trigger</strong> component in which we set the desired Snapshot and the time in seconds, that it takes to make the transition (a crossfade) between the previous Snapshot and the next. In fact, the function in<a class="indexterm" id="id999"/> our script is really this straightforward—the line of <code class="literal">snapshot.TransitionTo (crossfade)</code> code simply starts a transition lasting <code class="literal">crossfade</code> seconds to the desired <code class="literal">Snapshot</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec279"/>There's more...</h2></div></div></div><p>Here is some information on how to fine-tune and customize this recipe.</p><div><div><div><div><h3 class="title"><a id="ch09lvl3sec70"/>Reducing the need for multiple audio clips</h3></div></div></div><p>You might have <a class="indexterm" id="id1000"/>noticed how different the <code class="literal">Theme01_Percussion</code> audio clip sounds when the <strong>Cutoff frequency</strong> of the <strong>High-pass</strong> filter is set as <code class="literal">10.00 Hz</code>. The reason for this is that the high-pass filter, as its name suggests, cuts off lower frequencies of the audio signal. In this case, it attenuated the bass drum down to inaudible levels while keeping the shakers audible. The opposite effect can be achieved through the <strong>Lowpass</strong> filter. A major benefit is the opportunity of virtually having two separate tracks into the same audio clip.</p></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec71"/>Dealing with audio file formats and compression rates</h3></div></div></div><p>To avoid loss of<a class="indexterm" id="id1001"/> audio quality, you should import your<a class="indexterm" id="id1002"/> sound clips using the appropriate file format, depending upon your target platform. If you are not sure which format to use, please check out Unity's documentation on the subject at <a class="ulink" href="http://docs.unity3d.com/Manual/AudioFiles.html">http://docs.unity3d.com/Manual/AudioFiles.html</a>.</p></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec72"/>Applying Snapshots to background noise</h3></div></div></div><p>Although we have applied Snapshots to our music soundtrack, background noise can also benefit immensely. If <a class="indexterm" id="id1003"/>your character travels across places that are significantly different, transitioning from open spaces to indoor environments, you should consider applying snapshots to your environment audio mix. Be careful, however, to create separate Audio Mixers for Music and Environment—unless you don't mind having musical and ambient sound tied to the same Snapshot.</p></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec73"/>Getting creative with effects</h3></div></div></div><p>In this recipe, we have<a class="indexterm" id="id1004"/> mentioned the High-pass and Low-pass filters. However, there are many effects that can make audio clips sound radically different. Experiment! Try applying effects such as Distortion, Flange, and Chorus. In fact, we encourage you to try every effect, playing with their settings. The creative use of these effects can bring out different expressions to a single audio clip.</p></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec280"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Adding volume control with Audio Mixers</em> recipe in this chapter</li><li class="listitem" style="list-style-type: disc">The <em>Balancing soundtrack volume with Ducking</em> recipe<a class="indexterm" id="id1005"/> in this chapter</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec95"/>Balancing in-game audio with Ducking</h1></div></div></div><p>As much as the background music can be important in establishing the right atmosphere, there will be times when other audio clips should be emphasized, and the music volume turned down for the <a class="indexterm" id="id1006"/>duration of that clip. This effect is known as <strong>Ducking</strong>. Maybe you will need it for dramatic effect (simulating hearing loss after an explosion took place), or maybe you want to make sure that the player listens to a specific bit <a class="indexterm" id="id1007"/>of information. In this recipe, we will learn how to emphasize a piece of dialog by ducking the audio whenever a specific sound message is played. For that effect, we will use the new <strong>Audio Mixer</strong> to send information between tracks.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec281"/>Getting ready</h2></div></div></div><p>For this recipe, we have provided the <code class="literal">soundtrack.mp3</code> audio clip and a Unity package named <code class="literal">Ducking.unitypackage</code>, containing an initial scene. All these files are available inside the <code class="literal">1362_09_07</code> folder.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec282"/>How to do it...</h2></div></div></div><p>To apply Audio<a class="indexterm" id="id1008"/> Ducking to your soundtrack, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Import <code class="literal">Ducking.unitypackage</code> and <code class="literal">soundtrack.mp3</code> into your project.</li><li class="listitem">Open the <strong>Ducking</strong> scene (available in the <strong>Assets</strong> | <strong>Ducking</strong> folder). Play the scene and walk towards the semitransparent green wall in the tunnel, using the <em>W A S D</em> keys (by pressing <em>Shift</em> to run). You will hear the <strong>robotDucking</strong> audio clip play as the character collides with the wall.</li><li class="listitem">From the <strong>Create</strong> drop-down at the top of the <strong>Hierarchy</strong> view, choose <strong>Create Empty</strong> to add a new GameObject to the scene. Name it <strong>Soundtrack</strong>.</li><li class="listitem">Drag the <strong>soundtrack</strong> audio clip you have imported into the <strong>Soundtrack</strong> GameObject. Then, select the <strong>Soundtrack</strong> object and from the <strong>Inspector</strong> view, <strong>Audio Source</strong> component, check the <strong>Loop</strong> option. Make sure the <strong>Play On Awake</strong> option is checked and <strong>Spatial Blend</strong> set to <strong>2D</strong>, as shown in the following in the following screenshot:<div><img alt="How to do it..." src="img/1362_09_37.jpg"/></div></li><li class="listitem">Test the scene again. The soundtrack music should be playing.</li><li class="listitem">From the <strong>Project</strong> view, use the <strong>Create</strong> drop-down menu to add an <strong>Audio Mixer</strong> to the project. Name it <strong>MainMixer</strong>. Double-click on it to open the <strong>Audio Mixer</strong><a class="indexterm" id="id1009"/> window.</li><li class="listitem">From the <strong>Groups</strong> view, highlight <strong>Master</strong> and click the <strong>+</strong> sign to add a child to the <strong>Master</strong> group. Name it <strong>Music</strong>. Then, highlight <strong>Master</strong> again and add a new child group named <strong>FX</strong>, as shown in the following screenshot. Finally, add a third child to the <strong>Master</strong> group, named <strong>Input</strong>:<div><img alt="How to do it..." src="img/1362_09_38.jpg"/></div></li><li class="listitem">From the <strong>Mixers</strong> view, highlight <strong>MainMixer</strong> and click the <strong>+</strong> sign to add a new <strong>Mixer</strong> to the project. Name it <strong>MusicMixer</strong>. Then, drag it into the <strong>MainMixer</strong> and select the group <strong>Music</strong> as its <strong>Output</strong>. Repeat the operation to add a mixer <a class="indexterm" id="id1010"/>named <strong>FxMixer</strong> to the project, selecting the <strong>FX</strong> group as the output:<div><img alt="How to do it..." src="img/1362_09_39.jpg"/></div></li><li class="listitem">Now, select <strong>MusicMixer</strong>. Select its <strong>Master</strong> group and add a child named <strong>Soundtrack</strong>. Then, select <strong>FxMixer</strong> and add a child named <strong>Bells</strong>, as shown:<div><img alt="How to do it..." src="img/1362_09_40.jpg"/></div></li><li class="listitem">From the <strong>Hierarchy</strong> view, select the <strong>DialogueTrigger</strong> object. Then, in the <strong>Inspector</strong> view, <strong>Audio Source</strong> component, Change its <strong>Output</strong> track to <strong>MainMixer</strong> | <strong>Input</strong>:<div><img alt="How to do it..." src="img/1362_09_41.jpg"/></div></li><li class="listitem">Now, select the <strong>Soundtrack</strong> GameObject and in the <strong>Inspector</strong> view, in the <strong>Audio Source</strong> component, change its <strong>Output</strong> track to <strong>MusicMixer</strong> | <strong>Soundtrack</strong>:<div><img alt="How to do it..." src="img/1362_09_42.jpg"/></div></li><li class="listitem">Finally, from<a class="indexterm" id="id1011"/> the <strong>Assets</strong> folder in the <strong>Project</strong> view, select the <strong>Signal</strong> prefab. From the <strong>Inspector</strong> view, access its the <strong>Audio Source</strong> component and change its <strong>Output</strong> to <strong>FxMixer</strong> | <strong>Bells</strong>:<div><img alt="How to do it..." src="img/1362_09_43.jpg"/></div></li><li class="listitem">Open the<a class="indexterm" id="id1012"/> <strong>Audio Mixer</strong> window. Choose <strong>MainMixer</strong>, select the <strong>Music</strong> track controller, right-click on <strong>Attenuation</strong>, and using the context menu, add the <strong>Duck Volume</strong> effect before <strong>Attenuation</strong>:<div><img alt="How to do it..." src="img/1362_09_44.jpg"/></div></li><li class="listitem">Now, select the <strong>Input</strong> track, right-click on <strong>Attenuation</strong>, and using the context menu, add <strong>Send</strong> after <strong>Attenuation</strong>:<div><img alt="How to do it..." src="img/1362_09_45.jpg"/></div></li><li class="listitem">With <strong>Input</strong><a class="indexterm" id="id1013"/> track still selected, go to the <strong>Inspector</strong> view and change the <strong>Receive</strong> setting in <strong>Send</strong> to <strong>Music\Duck Volume</strong> and its <strong>Send</strong> level to <code class="literal">0.00 db</code>, as shown:<div><img alt="How to do it..." src="img/1362_09_46.jpg"/></div></li><li class="listitem">Select the <strong>Music</strong> track. From the <strong>Inspector</strong> view, change the settings on the <strong>Duck Volume</strong> as follows: <strong>Threshold</strong>: -<code class="literal">40.00 db</code>; <strong>Ratio</strong>: <code class="literal">300.00 %</code>; <strong>Attack Time</strong>: <code class="literal">100.00 ms</code>; <strong>Release Time</strong>: <code class="literal">2000.00 ms</code>, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362_09_47.jpg"/></div></li><li class="listitem">Test the scene again. Entering the trigger object will cause the soundtrack volume to drop considerably, recovering the original volume in 2 seconds.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec283"/>How it works...</h2></div></div></div><p>In this recipe, we have created, in addition to Music and Sound FX, a group named <strong>Input</strong>, to which we<a class="indexterm" id="id1014"/> have routed the audio clip that triggers the <strong>Duck Volume</strong> effect attached to our music track. The <strong>Duck Volume</strong> effect changes the track's volume whenever it receives an input that is louder than indicated in its <strong>Threshold</strong> setting. In our case, we have sent the <strong>Input</strong> track as input, and adjusted the settings so the volume will be reduced as soon as 0.1 seconds after the input had been received, turning back to its original value of 2 seconds after the input has ceased. The amount of volume reduction was determined by our <strong>Ratio</strong> of <strong>300.00 %</strong>. Playing around with the setting values will give you a better idea on how each parameter affects the final result. Also, make sure to visualize the graphic as the trigger sound is played. You will be able to see how the <strong>Input</strong> sound passes the threshold, triggering the effect.</p><div><img alt="How it works..." src="img/1362_09_48.jpg"/><div><p>Duck Volume</p></div></div><p>Also, please note that we have organized our tracks so that the other sound clips (other than speech) will not <a class="indexterm" id="id1015"/>affect the volume of the music—but every music clip will be affected by audio clips sent to the input track.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec284"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Adding volume control with Audio Mixers</em> recipe in this chapter</li><li class="listitem" style="list-style-type: disc">The <em>Making a dynamic soundtrack with Snapshots</em> recipe in this chapter</li></ul></div></div></div></body></html>