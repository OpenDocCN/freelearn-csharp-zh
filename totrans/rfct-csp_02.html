<html><head></head><body>
<div id="_idContainer027">
<h1 class="chapter-number" id="_idParaDest-27"><a id="_idTextAnchor026"/><span class="koboSpan" id="kobo.1.1">2</span></h1>
<h1 id="_idParaDest-28"><a id="_idTextAnchor027"/><span class="koboSpan" id="kobo.2.1">Introduction to Refactoring</span></h1>
<p><span class="koboSpan" id="kobo.3.1">The best way to learn refactoring is to look at an example. </span><span class="koboSpan" id="kobo.3.2">In this chapter, we’ll explore a sample refactoring scenario using C# and Visual Studio and see firsthand how refactoring can transform the maintainability of code without altering </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">its functionality.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">In this chapter, we’re going to cover the following </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">main areas:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.7.1">Refactoring a baggage </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">price calculator</span></span></li>
<li><span class="koboSpan" id="kobo.9.1">Refactoring in </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">other editors</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.11.1">Along the way, we’ll cover refactorings around introducing locals, constants, and parameters, extracting methods, and removing unreachable/unused code, as well as touching upon the importance of testing in any </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">refactoring endeavor.</span></span></p>
<h1 id="_idParaDest-29"><a id="_idTextAnchor028"/><span class="koboSpan" id="kobo.13.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.14.1">If you want to follow along with this chapter, you can clone this book’s code from GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.15.1">at </span></span><a href="https://github.com/PacktPublishing/Refactoring-with-CSharp"><span class="No-Break"><span class="koboSpan" id="kobo.16.1">https://github.com/PacktPublishing/Refactoring-with-CSharp</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.17.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.18.1">The starting code for this chapter can be found in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.19.1">Chapter02/Ch2BeginningCode</span></strong><span class="koboSpan" id="kobo.20.1"> folder after cloning </span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">the repository.</span></span></p>
<h1 id="_idParaDest-30"><a id="_idTextAnchor029"/><span class="koboSpan" id="kobo.22.1">Refactoring a baggage price calculator</span></h1>
<p><span class="koboSpan" id="kobo.23.1">We’ll start by</span><a id="_idIndexMarker030"/><span class="koboSpan" id="kobo.24.1"> examining a baggage price calculator used by the staff of Cloudy Skies Airline during baggage checks to determine the amount an individual customer </span><span class="No-Break"><span class="koboSpan" id="kobo.25.1">must pay.</span></span></p>
<p><span class="koboSpan" id="kobo.26.1">The rules for baggage pricing are </span><span class="No-Break"><span class="koboSpan" id="kobo.27.1">as follows:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.28.1">All carry-on baggage costs $30 </span><span class="No-Break"><span class="koboSpan" id="kobo.29.1">per bag</span></span></li>
<li><span class="koboSpan" id="kobo.30.1">The first checked bag a passenger checks </span><span class="No-Break"><span class="koboSpan" id="kobo.31.1">costs $40</span></span></li>
<li><span class="koboSpan" id="kobo.32.1">Each subsequent checked bag </span><span class="No-Break"><span class="koboSpan" id="kobo.33.1">costs $50</span></span></li>
<li><span class="koboSpan" id="kobo.34.1">If the travel occurs during the holidays, a 10% surcharge </span><span class="No-Break"><span class="koboSpan" id="kobo.35.1">is applied</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.36.1">This code lives in a C# </span><strong class="source-inline"><span class="koboSpan" id="kobo.37.1">BaggageCalculator</span></strong><span class="koboSpan" id="kobo.38.1"> class that we’ll review in a few blocks of code, starting with the class definition, field, and </span><span class="No-Break"><span class="koboSpan" id="kobo.39.1">full property:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.40.1">BaggageCalculator.cs:</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.41.1">
public class BaggageCalculator {
  private decimal holidayFeePercent = 0.1M;
  public decimal HolidayFeePercent {
    get { return holidayFeePercent; }
    set { holidayFeePercent = value; }
  }</span></pre>
<p><span class="koboSpan" id="kobo.42.1">This is a simple class with an older style of property definition setting </span><strong class="source-inline"><span class="koboSpan" id="kobo.43.1">holidayFeePercent</span></strong><span class="koboSpan" id="kobo.44.1"> to a </span><strong class="source-inline"><span class="koboSpan" id="kobo.45.1">decimal</span></strong><span class="koboSpan" id="kobo.46.1"> value (identified by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.47.1">M</span></strong><span class="koboSpan" id="kobo.48.1"> suffix) of </span><strong class="source-inline"><span class="koboSpan" id="kobo.49.1">0.1</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.50.1">or 10%.</span></span></p>
<p><span class="koboSpan" id="kobo.51.1">The class also </span><a id="_idIndexMarker031"/><span class="koboSpan" id="kobo.52.1">has a </span><strong class="source-inline"><span class="koboSpan" id="kobo.53.1">CalculatePrice</span></strong><span class="koboSpan" id="kobo.54.1"> method that returns a </span><strong class="source-inline"><span class="koboSpan" id="kobo.55.1">decimal</span></strong><span class="koboSpan" id="kobo.56.1"> value indicating the total cost of </span><span class="No-Break"><span class="koboSpan" id="kobo.57.1">baggage fees:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.58.1">
  public decimal CalculatePrice(int bags,
    int carryOn, int passengers, DateTime travelTime) {
    decimal total = 0;
    if (carryOn &gt; 0) {
      Console.WriteLine($"Carry-on: {carryOn * 30M}");
      total += carryOn * 30M;
    }
    if (bags &gt; 0) {
      if (bags &lt;= passengers) {
        Console.WriteLine($"Checked: {bags * 40M}");
        total += bags * 40M;
      } else {
        decimal checkedFee = (passengers * 40M) +
          ((bags - passengers) * 50M);
        Console.WriteLine($"Checked: {checkedFee}");
        total += checkedFee;
      }
    }
    if (travelTime.Month &gt;= 11 || travelTime.Month &lt;= 2) {
      Console.WriteLine("Holiday Fee: " +
        (total * HolidayFeePercent));
      total += total * HolidayFeePercent;
    }
    return total;
  }</span></pre>
<p><span class="koboSpan" id="kobo.59.1">That logic has some</span><a id="_idIndexMarker032"/><span class="koboSpan" id="kobo.60.1"> complexity to it, but it matches up with the business rules </span><span class="No-Break"><span class="koboSpan" id="kobo.61.1">described earlier.</span></span></p>
<p><span class="koboSpan" id="kobo.62.1">Finally, the class ends with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.63.1">CalculatePriceFlat</span></strong><span class="koboSpan" id="kobo.64.1"> method that was introduced in an earlier version of the application and is no longer used (which we’ll </span><span class="No-Break"><span class="koboSpan" id="kobo.65.1">discuss later):</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.66.1">
  private decimal CalculatePriceFlat(int numBags) {
    decimal total = 0;
    return 100M;
    return numBags * 50M;
  }
}</span></pre>
<p><span class="koboSpan" id="kobo.67.1">While this code isn’t the worst in the world by any stretch, this is a class that is slowly growing in complexity and becoming harder to understand and maintain as new rules are added to </span><span class="No-Break"><span class="koboSpan" id="kobo.68.1">the application.</span></span></p>
<p><span class="koboSpan" id="kobo.69.1">Fortunately, this class is supported by a series of passing unit tests and is generally agreed to calculate the correct amount by </span><span class="No-Break"><span class="koboSpan" id="kobo.70.1">all users.</span></span></p>
<p><span class="koboSpan" id="kobo.71.1">Over the course of the chapter, we’ll apply a series of targeted refactorings to improve this code to </span><a id="_idIndexMarker033"/><span class="koboSpan" id="kobo.72.1">prevent it from being an issue in </span><span class="No-Break"><span class="koboSpan" id="kobo.73.1">the future.</span></span></p>
<h2 id="_idParaDest-31"><a id="_idTextAnchor030"/><span class="koboSpan" id="kobo.74.1">Converting properties to auto properties</span></h2>
<p><span class="koboSpan" id="kobo.75.1">The class </span><a id="_idIndexMarker034"/><span class="koboSpan" id="kobo.76.1">starts with the declaration of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.77.1">HolidayFeePercent</span></strong><span class="koboSpan" id="kobo.78.1"> property as </span><span class="No-Break"><span class="koboSpan" id="kobo.79.1">shown here:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.80.1">
private decimal holidayFeePercent = 0.1M;
public decimal HolidayFeePercent {
  get { return holidayFeePercent; }
  set { holidayFeePercent = value; }
}</span></pre>
<p><span class="koboSpan" id="kobo.81.1">This code is fine and has no issues whatsoever. </span><span class="koboSpan" id="kobo.81.2">However, C# is a language that continues to evolve and developers generally prefer to write and maintain fewer lines of code when given </span><span class="No-Break"><span class="koboSpan" id="kobo.82.1">the choice.</span></span></p>
<p><span class="koboSpan" id="kobo.83.1">Because of this, Microsoft gave us the ability to write </span><em class="italic"><span class="koboSpan" id="kobo.84.1">automatically implemented properties</span></em><span class="koboSpan" id="kobo.85.1"> (commonly</span><a id="_idIndexMarker035"/><span class="koboSpan" id="kobo.86.1"> called </span><strong class="bold"><span class="koboSpan" id="kobo.87.1">auto properties</span></strong><span class="koboSpan" id="kobo.88.1">) that automatically generate their own field with a getter and setter when the code </span><span class="No-Break"><span class="koboSpan" id="kobo.89.1">is compiled.</span></span></p>
<p><span class="koboSpan" id="kobo.90.1">While we could delete the property and its field and redeclare it, there’s a possibility that we could make a spelling or capitalization mistake when doing so. </span><span class="koboSpan" id="kobo.90.2">Instead, let’s take a look at how Visual Studio can do this for </span><span class="No-Break"><span class="koboSpan" id="kobo.91.1">us automatically.</span></span></p>
<p><span class="koboSpan" id="kobo.92.1">In Visual Studio, if you move your typing cursor onto a property name, either by using the arrow keys or by clicking on the name of the property, you’ll see a light bulb appear in the margin as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.93.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.94.1">.1</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.95.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer011">
<span class="koboSpan" id="kobo.96.1"><img alt="Figure 2.1 – The light bulb Quick Actions icon" src="image/B21324_02_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.97.1">Figure 2.1 – The light bulb Quick Actions icon</span></p>
<p><span class="koboSpan" id="kobo.98.1">If you click on this light bulb (or press </span><em class="italic"><span class="koboSpan" id="kobo.99.1">Ctrl</span></em><span class="koboSpan" id="kobo.100.1"> + </span><em class="italic"><span class="koboSpan" id="kobo.101.1">.</span></em><span class="koboSpan" id="kobo.102.1"> by default), the </span><strong class="bold"><span class="koboSpan" id="kobo.103.1">Quick Actions</span></strong><span class="koboSpan" id="kobo.104.1"> menu will appear and list </span><span class="No-Break"><span class="koboSpan" id="kobo.105.1">several refactorings.</span></span></p>
<p><span class="koboSpan" id="kobo.106.1">The refactoring choices are context-sensitive, so only those that Visual Studio believes are relevant to the code you have currently selected </span><span class="No-Break"><span class="koboSpan" id="kobo.107.1">will appear.</span></span></p>
<p><span class="koboSpan" id="kobo.108.1">In this case, the first option, </span><strong class="bold"><span class="koboSpan" id="kobo.109.1">Use auto property</span></strong><span class="koboSpan" id="kobo.110.1">, is the refactoring action we want. </span><span class="koboSpan" id="kobo.110.2">See </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.111.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.112.1">.2</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.113.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer012">
<span class="koboSpan" id="kobo.114.1"><img alt="Figure 2.2 – Previewing the Use auto property refactoring" src="image/B21324_02_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.115.1">Figure 2.2 – Previewing the Use auto property refactoring</span></p>
<p><span class="koboSpan" id="kobo.116.1">When this option</span><a id="_idIndexMarker036"/><span class="koboSpan" id="kobo.117.1"> is selected, the pane on the right will display a preview of the change this will make to your code. </span><span class="koboSpan" id="kobo.117.2">Here it lists the lines it will remove in red and the line it adds </span><span class="No-Break"><span class="koboSpan" id="kobo.118.1">in green.</span></span></p>
<p><span class="koboSpan" id="kobo.119.1">Clicking </span><strong class="bold"><span class="koboSpan" id="kobo.120.1">Use auto property</span></strong><span class="koboSpan" id="kobo.121.1"> or pressing </span><em class="italic"><span class="koboSpan" id="kobo.122.1">Enter</span></em><span class="koboSpan" id="kobo.123.1"> on the keyboard will accept the suggestion and replace your code with the auto </span><span class="No-Break"><span class="koboSpan" id="kobo.124.1">property version:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.125.1">
public decimal HolidayFeePercent { </span><strong class="bold"><span class="koboSpan" id="kobo.126.1">get; set;</span></strong><span class="koboSpan" id="kobo.127.1"> } = 0.1M;</span></pre>
<p><span class="koboSpan" id="kobo.128.1">Admittedly this is a simple refactoring, but there are a couple of things I want to stress about the </span><span class="No-Break"><span class="koboSpan" id="kobo.129.1">refactoring process:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.130.1">Visual Studio took care of making the change and did so in an automated way that was free of potential typos or other mistakes a human </span><span class="No-Break"><span class="koboSpan" id="kobo.131.1">might make.</span></span></li>
<li><span class="koboSpan" id="kobo.132.1">If you didn’t know that you could move a full property to an auto property, this </span><strong class="bold"><span class="koboSpan" id="kobo.133.1">Quick Action</span></strong><span class="koboSpan" id="kobo.134.1"> helped you discover that. </span><span class="koboSpan" id="kobo.134.2">These </span><strong class="bold"><span class="koboSpan" id="kobo.135.1">Quick Actions</span></strong><span class="koboSpan" id="kobo.136.1"> can actually </span><em class="italic"><span class="koboSpan" id="kobo.137.1">teach</span></em><span class="koboSpan" id="kobo.138.1"> you a lot about the C# programming language as it continues to evolve and change </span><span class="No-Break"><span class="koboSpan" id="kobo.139.1">every year.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.140.1">With the </span><a id="_idIndexMarker037"/><span class="koboSpan" id="kobo.141.1">mechanics of refactoring in Visual Studio out of the way, let’s explore some </span><span class="No-Break"><span class="koboSpan" id="kobo.142.1">additional refactorings.</span></span></p>
<h2 id="_idParaDest-32"><a id="_idTextAnchor031"/><span class="koboSpan" id="kobo.143.1">Introducing locals</span></h2>
<p><span class="koboSpan" id="kobo.144.1">One of the </span><a id="_idIndexMarker038"/><span class="koboSpan" id="kobo.145.1">problems the </span><strong class="source-inline"><span class="koboSpan" id="kobo.146.1">CalculatePrice</span></strong><span class="koboSpan" id="kobo.147.1"> method has is that </span><a id="_idIndexMarker039"/><span class="koboSpan" id="kobo.148.1">there are a few expressions, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.149.1">carryOn * 30M</span></strong><span class="koboSpan" id="kobo.150.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.151.1">bags * 40M</span></strong><span class="koboSpan" id="kobo.152.1">, that appear multiple times throughout </span><span class="No-Break"><span class="koboSpan" id="kobo.153.1">the method.</span></span></p>
<p><span class="koboSpan" id="kobo.154.1">These are small issues but can lead to maintainability problems. </span><span class="koboSpan" id="kobo.154.2">If the nature of the expressions changed, we would need to modify multiple places within </span><span class="No-Break"><span class="koboSpan" id="kobo.155.1">our code.</span></span></p>
<p><span class="koboSpan" id="kobo.156.1">In general, one of the reasons you may want to refactor code is if you find yourself modifying multiple places to make a single change on a regular basis. </span><span class="koboSpan" id="kobo.156.2">For example, if the pricing structure changed we should modify multiple lines of code to support the new pricing model. </span><span class="koboSpan" id="kobo.156.3">Each one of those lines we should modify is a place we might fail to make a change. </span><span class="koboSpan" id="kobo.156.4">Missing changes like this typically </span><span class="No-Break"><span class="koboSpan" id="kobo.157.1">introduce bugs.</span></span></p>
<p><span class="koboSpan" id="kobo.158.1">Even if we didn’t miss any code that needed to be modified, most developers would prefer to have to make a change in one place instead </span><span class="No-Break"><span class="koboSpan" id="kobo.159.1">of multiple.</span></span></p>
<p><span class="koboSpan" id="kobo.160.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.161.1">Introduce local</span></strong><span class="koboSpan" id="kobo.162.1"> refactoring can help with this by introducing a local variable containing the result of </span><span class="No-Break"><span class="koboSpan" id="kobo.163.1">the expression.</span></span></p>
<p><span class="koboSpan" id="kobo.164.1">To use this refactoring, select the expression that is repeated as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.165.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.166.1">.3</span></em><span class="koboSpan" id="kobo.167.1">, noting that Visual Studio helpfully highlights any places it </span><span class="No-Break"><span class="koboSpan" id="kobo.168.1">is repeated:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer013">
<span class="koboSpan" id="kobo.169.1"><img alt="Figure 2.3 – Selecting a repeated expression in Visual Studio" src="image/B21324_02_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.170.1">Figure 2.3 – Selecting a repeated expression in Visual Studio</span></p>
<p><span class="koboSpan" id="kobo.171.1">Next, use the </span><strong class="bold"><span class="koboSpan" id="kobo.172.1">Quick Action</span></strong><span class="koboSpan" id="kobo.173.1"> button by pressing </span><em class="italic"><span class="koboSpan" id="kobo.174.1">Ctrl</span></em><span class="koboSpan" id="kobo.175.1"> + </span><em class="italic"><span class="koboSpan" id="kobo.176.1">.</span></em><span class="koboSpan" id="kobo.177.1"> or clicking on the </span><span class="No-Break"><span class="koboSpan" id="kobo.178.1">screwdriver icon.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.179.1">A note on the Quick Actions icon</span></p>
<p class="callout"><span class="koboSpan" id="kobo.180.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.181.1">Quick Action</span></strong><span class="koboSpan" id="kobo.182.1"> button</span><a id="_idIndexMarker040"/><span class="koboSpan" id="kobo.183.1"> sometimes appears as a light bulb and sometimes appears as a screwdriver, depending on your code analysis rules and the exact issues a line is facing. </span><span class="koboSpan" id="kobo.183.2">They are effectively the same option, but the light bulb tells you a suggested refactoring is present while a screwdriver indicates a less critical refactoring option </span><span class="No-Break"><span class="koboSpan" id="kobo.184.1">to consider.</span></span></p>
<p><span class="koboSpan" id="kobo.185.1">Once the context menu is open, expand the right arrow next to </span><strong class="bold"><span class="koboSpan" id="kobo.186.1">Introduce local</span></strong><span class="koboSpan" id="kobo.187.1"> by using the </span><a id="_idIndexMarker041"/><span class="koboSpan" id="kobo.188.1">arrow keys to navigate the menu. </span><span class="koboSpan" id="kobo.188.2">This will let you view more </span><a id="_idIndexMarker042"/><span class="No-Break"><span class="koboSpan" id="kobo.189.1">detailed options.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer014">
<span class="koboSpan" id="kobo.190.1"><img alt="Figure 2.4 – Drilling into the specialized forms of the Introduce local refactoring" src="image/B21324_02_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.191.1">Figure 2.4 – Drilling into the specialized forms of the Introduce local refactoring</span></p>
<p><span class="koboSpan" id="kobo.192.1">Here it gives you the ability to introduce a local variable just for the expression you selected or to do so </span><strong class="bold"><span class="koboSpan" id="kobo.193.1">for all occurrences</span></strong><span class="koboSpan" id="kobo.194.1"> of this expression. </span><span class="koboSpan" id="kobo.194.2">I generally recommend using the </span><strong class="bold"><span class="koboSpan" id="kobo.195.1">for all occurrences</span></strong><em class="italic"> </em><span class="koboSpan" id="kobo.196.1">option, but it will depend on the context of what you’re trying </span><span class="No-Break"><span class="koboSpan" id="kobo.197.1">to improve.</span></span></p>
<p><span class="koboSpan" id="kobo.198.1">Once you select the </span><strong class="bold"><span class="koboSpan" id="kobo.199.1">Introduce local</span></strong><span class="koboSpan" id="kobo.200.1"> option, Visual Studio will prompt you for a name for your variable (see </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.201.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.202.1">.5</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.203.1">):</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer015">
<span class="koboSpan" id="kobo.204.1"><img alt="Figure 2.5 – Naming your new local variable" src="image/B21324_02_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.205.1">Figure 2.5 – Naming your new local variable</span></p>
<p><span class="koboSpan" id="kobo.206.1">Type in the name you would like and then press </span><em class="italic"><span class="koboSpan" id="kobo.207.1">Enter</span></em><span class="koboSpan" id="kobo.208.1"> to make the </span><span class="No-Break"><span class="koboSpan" id="kobo.209.1">box disappear.</span></span></p>
<p><span class="koboSpan" id="kobo.210.1">In my case, I called the variable </span><strong class="source-inline"><span class="koboSpan" id="kobo.211.1">fee</span></strong><span class="koboSpan" id="kobo.212.1"> and it replaced it in both lines as </span><span class="No-Break"><span class="koboSpan" id="kobo.213.1">shown here:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.214.1">
if (carryOn &gt; 0) {
  decimal </span><strong class="bold"><span class="koboSpan" id="kobo.215.1">fee</span></strong><span class="koboSpan" id="kobo.216.1"> = carryOn * 30M;
  Console.WriteLine($"Carry-on: {</span><strong class="bold"><span class="koboSpan" id="kobo.217.1">fee</span></strong><span class="koboSpan" id="kobo.218.1">}");
  total += </span><strong class="bold"><span class="koboSpan" id="kobo.219.1">fee</span></strong><span class="koboSpan" id="kobo.220.1">;
}</span></pre>
<p><span class="koboSpan" id="kobo.221.1">While this is certainly cleaner for the carry-on baggage fee logic, there’s still a </span><strong class="source-inline"><span class="koboSpan" id="kobo.222.1">bags * 40M</span></strong><span class="koboSpan" id="kobo.223.1"> expression repeated in the checked baggage logic and a </span><strong class="source-inline"><span class="koboSpan" id="kobo.224.1">total * HolidayFeePercent</span></strong><span class="koboSpan" id="kobo.225.1"> expression that is </span><span class="No-Break"><span class="koboSpan" id="kobo.226.1">also repeated.</span></span></p>
<p><span class="koboSpan" id="kobo.227.1">You can use the </span><strong class="bold"><span class="koboSpan" id="kobo.228.1">Introduce local</span></strong><span class="koboSpan" id="kobo.229.1"> refactoring to make complex lines more understandable by pulling some logic out of dense lines into their own </span><span class="No-Break"><span class="koboSpan" id="kobo.230.1">smaller lines.</span></span></p>
<p><span class="koboSpan" id="kobo.231.1">Applying</span><a id="_idIndexMarker043"/><span class="koboSpan" id="kobo.232.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.233.1">Introduce local</span></strong><span class="koboSpan" id="kobo.234.1"> refactoring throughout this method</span><a id="_idIndexMarker044"/><span class="koboSpan" id="kobo.235.1"> results in a longer method, but one that’s easier </span><span class="No-Break"><span class="koboSpan" id="kobo.236.1">to understand:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.237.1">
public decimal CalculatePrice(int bags,
  int carryOn, int passengers, DateTime travelTime) {
  decimal total = 0;
  if (carryOn &gt; 0) {
    decimal fee = carryOn * 30M;
    Console.WriteLine($"Carry-on: {fee}");
    total += fee;
  }
  if (bags &gt; 0) {
    if (bags &lt;= passengers) {
      </span><strong class="bold"><span class="koboSpan" id="kobo.238.1">decimal firstBagFee = bags * 40M;</span></strong><span class="koboSpan" id="kobo.239.1">
      Console.WriteLine($"Checked: {</span><strong class="bold"><span class="koboSpan" id="kobo.240.1">firstBagFee</span></strong><span class="koboSpan" id="kobo.241.1">}");
      total += </span><strong class="bold"><span class="koboSpan" id="kobo.242.1">firstBagFee</span></strong><span class="koboSpan" id="kobo.243.1">;
    } else {
      </span><strong class="bold"><span class="koboSpan" id="kobo.244.1">decimal firstBagFee = passengers * 40M;</span></strong><span class="koboSpan" id="kobo.245.1">
      </span><strong class="bold"><span class="koboSpan" id="kobo.246.1">decimal extraBagFee = (bags - passengers) * 50M;</span></strong><span class="koboSpan" id="kobo.247.1">
      decimal checkedFee = </span><strong class="bold"><span class="koboSpan" id="kobo.248.1">firstBagFee + extraBagFee</span></strong><span class="koboSpan" id="kobo.249.1">;
      Console.WriteLine($"Checked: {checkedFee}");
      total += checkedFee;
    }
  }
  if (travelTime.Month &gt;= 11 || travelTime.Month &lt;= 2) {
    </span><strong class="bold"><span class="koboSpan" id="kobo.250.1">decimal holidayFee = total * HolidayFeePercent;</span></strong><span class="koboSpan" id="kobo.251.1">
    Console.WriteLine("Holiday Fee: " + </span><strong class="bold"><span class="koboSpan" id="kobo.252.1">holidayFee</span></strong><span class="koboSpan" id="kobo.253.1">);
    total += </span><strong class="bold"><span class="koboSpan" id="kobo.254.1">holidayFee</span></strong><span class="koboSpan" id="kobo.255.1">;
  }
  return total;
}</span></pre>
<p><span class="koboSpan" id="kobo.256.1">As a programming instructor, I saw many students under the mistaken assumption that the shortest way to implement something was always </span><span class="No-Break"><span class="koboSpan" id="kobo.257.1">the best.</span></span></p>
<p><span class="koboSpan" id="kobo.258.1">Instead, the best code tends to be the code that’s easier to maintain over time, less likely to break, and easier to think about as you go about </span><span class="No-Break"><span class="koboSpan" id="kobo.259.1">development tasks.</span></span></p>
<p><span class="koboSpan" id="kobo.260.1">Less code is </span><a id="_idIndexMarker045"/><span class="koboSpan" id="kobo.261.1">often easier to think about, but when code gets too </span><a id="_idIndexMarker046"/><span class="koboSpan" id="kobo.262.1">concise or too complex it can be hard to maintain. </span><span class="koboSpan" id="kobo.262.2">Find a happy medium between brevity and readability, keeping in mind that many times, programmers skim code looking for a </span><span class="No-Break"><span class="koboSpan" id="kobo.263.1">specific section.</span></span></p>
<h2 id="_idParaDest-33"><a id="_idTextAnchor032"/><span class="koboSpan" id="kobo.264.1">Introducing constants</span></h2>
<p><span class="koboSpan" id="kobo.265.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.266.1">Introduce constant</span></strong><span class="koboSpan" id="kobo.267.1"> refactoring</span><a id="_idIndexMarker047"/><span class="koboSpan" id="kobo.268.1"> is very similar </span><a id="_idIndexMarker048"/><span class="koboSpan" id="kobo.269.1">to </span><strong class="bold"><span class="koboSpan" id="kobo.270.1">Introduce local </span></strong><span class="koboSpan" id="kobo.271.1">except it introduces a </span><strong class="source-inline"><span class="koboSpan" id="kobo.272.1">const</span></strong><span class="koboSpan" id="kobo.273.1"> value that will never change during the </span><span class="No-Break"><span class="koboSpan" id="kobo.274.1">program’s runtime.</span></span></p>
<p><span class="koboSpan" id="kobo.275.1">However, </span><strong class="bold"><span class="koboSpan" id="kobo.276.1">Introduce constant</span></strong><span class="koboSpan" id="kobo.277.1"> is often used for a different purpose than </span><strong class="bold"><span class="koboSpan" id="kobo.278.1">Introduce local</span></strong><span class="koboSpan" id="kobo.279.1">. </span><span class="koboSpan" id="kobo.279.2">While </span><strong class="bold"><span class="koboSpan" id="kobo.280.1">Introduce local</span></strong><span class="koboSpan" id="kobo.281.1"> tends to be used to reduce repetition or simplify complex lines of </span><a id="_idIndexMarker049"/><span class="koboSpan" id="kobo.282.1">code, </span><strong class="bold"><span class="koboSpan" id="kobo.283.1">Introduce constant</span></strong><span class="koboSpan" id="kobo.284.1"> is often </span><a id="_idIndexMarker050"/><span class="koboSpan" id="kobo.285.1">used to eliminate </span><strong class="bold"><span class="koboSpan" id="kobo.286.1">magic numbers</span></strong><span class="koboSpan" id="kobo.287.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.288.1">magic strings</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.289.1">from code.</span></span></p>
<p><span class="koboSpan" id="kobo.290.1">In programming, a magic number is a number that exists in your code without any explanation of what that number means or why it is there. </span><span class="koboSpan" id="kobo.290.2">This is bad because the person maintaining your code later doesn’t understand why that number </span><span class="No-Break"><span class="koboSpan" id="kobo.291.1">was chosen.</span></span></p>
<p><span class="koboSpan" id="kobo.292.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.293.1">CalculatePrice</span></strong><span class="koboSpan" id="kobo.294.1"> method has three magic numbers: </span><strong class="source-inline"><span class="koboSpan" id="kobo.295.1">30M</span></strong><span class="koboSpan" id="kobo.296.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.297.1">40M</span></strong><span class="koboSpan" id="kobo.298.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.299.1">50M</span></strong><span class="koboSpan" id="kobo.300.1">, representing the various baggage </span><span class="No-Break"><span class="koboSpan" id="kobo.301.1">fee amounts.</span></span></p>
<p><span class="koboSpan" id="kobo.302.1">Introducing a constant for these is the same as introducing a local. </span><span class="koboSpan" id="kobo.302.2">Just highlight the number and open </span><a id="_idIndexMarker051"/><span class="koboSpan" id="kobo.303.1">the </span><strong class="bold"><span class="koboSpan" id="kobo.304.1">Quick Actions</span></strong><span class="koboSpan" id="kobo.305.1"> menu, then </span><a id="_idIndexMarker052"/><span class="koboSpan" id="kobo.306.1">select </span><strong class="bold"><span class="koboSpan" id="kobo.307.1">Introduce constant</span></strong><span class="koboSpan" id="kobo.308.1"> and then </span><strong class="bold"><span class="koboSpan" id="kobo.309.1">Introduce constant for all occurrences</span></strong><span class="koboSpan" id="kobo.310.1"> in the sub-menu as </span><span class="No-Break"><span class="koboSpan" id="kobo.311.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer016">
<span class="koboSpan" id="kobo.312.1"><img alt="Figure 2.6 – Introducing a constant for all occurrences of the 40M decimal literal" src="image/B21324_02_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.313.1">Figure 2.6 – Introducing a constant for all occurrences of the 40M decimal literal</span></p>
<p><span class="koboSpan" id="kobo.314.1">Doing this to the various magic numbers in our application and choosing appropriate names results in the following new constants at the top of </span><span class="No-Break"><span class="koboSpan" id="kobo.315.1">the class:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.316.1">
private const decimal CarryOnFee = 30M;
private const decimal FirstBagFee = 40M;
private const decimal ExtraBagFee = 50M;</span></pre>
<p><span class="koboSpan" id="kobo.317.1">Introducing these constants has the added benefit of putting our price rules in a centralized place, making them more discoverable by new developers joining </span><span class="No-Break"><span class="koboSpan" id="kobo.318.1">the team.</span></span></p>
<p><span class="koboSpan" id="kobo.319.1">This also makes our code a lot easier </span><span class="No-Break"><span class="koboSpan" id="kobo.320.1">to read:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.321.1">
if (carryOn &gt; 0) {
    decimal fee = carryOn * </span><strong class="bold"><span class="koboSpan" id="kobo.322.1">CarryOnFee</span></strong><span class="koboSpan" id="kobo.323.1">;
    Console.WriteLine($"Carry-on: {fee}");
    total += fee;
}</span></pre>
<p><span class="koboSpan" id="kobo.324.1">Programmers spend disproportionally more time </span><em class="italic"><span class="koboSpan" id="kobo.325.1">reading</span></em><span class="koboSpan" id="kobo.326.1"> code rather than </span><em class="italic"><span class="koboSpan" id="kobo.327.1">writing</span></em><span class="koboSpan" id="kobo.328.1"> code. </span><span class="koboSpan" id="kobo.328.2">Optimizing</span><a id="_idIndexMarker053"/><span class="koboSpan" id="kobo.329.1"> your code for maintainability is a</span><a id="_idIndexMarker054"/><span class="koboSpan" id="kobo.330.1"> key habit that will help your application resist technical debt as time </span><span class="No-Break"><span class="koboSpan" id="kobo.331.1">goes by.</span></span></p>
<h2 id="_idParaDest-34"><a id="_idTextAnchor033"/><span class="koboSpan" id="kobo.332.1">Introducing parameters</span></h2>
<p><span class="koboSpan" id="kobo.333.1">One refactoring </span><a id="_idIndexMarker055"/><span class="koboSpan" id="kobo.334.1">technique I wish I saw more people </span><a id="_idIndexMarker056"/><span class="koboSpan" id="kobo.335.1">use is the </span><strong class="bold"><span class="koboSpan" id="kobo.336.1">Introduce </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.337.1">parameter</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.338.1"> refactoring.</span></span></p>
<p><span class="koboSpan" id="kobo.339.1">This refactoring takes an expression or variable in a method and removes it from the method entirely, instead adding its value as a new parameter to </span><span class="No-Break"><span class="koboSpan" id="kobo.340.1">the method.</span></span></p>
<p><span class="koboSpan" id="kobo.341.1">For example, right now the </span><strong class="source-inline"><span class="koboSpan" id="kobo.342.1">CalculatePrice</span></strong><span class="koboSpan" id="kobo.343.1"> method has logic inside of it for determining which travel dates should be considered for </span><span class="No-Break"><span class="koboSpan" id="kobo.344.1">holiday travel:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.345.1">
if (</span><strong class="bold"><span class="koboSpan" id="kobo.346.1">travelTime.Month &gt;= 11 || travelTime.Month &lt;= 2</span></strong><span class="koboSpan" id="kobo.347.1">) {
  decimal holidayFee = total * HolidayFeePercent;
  Console.WriteLine("Holiday Fee: " + holidayFee);
  total += holidayFee;
}</span></pre>
<p><span class="koboSpan" id="kobo.348.1">This is logic that could become more complex as more holidays are added and holidays from different countries are considered. </span><span class="koboSpan" id="kobo.348.2">As the code is written now, the additional complexity would need to go into this </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.349.1">if</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.350.1"> statement.</span></span></p>
<p><span class="koboSpan" id="kobo.351.1">Instead, introducing a parameter for </span><strong class="source-inline"><span class="koboSpan" id="kobo.352.1">isHoliday</span></strong><span class="koboSpan" id="kobo.353.1"> gives the callers of this method the responsibility of telling whether the method is holiday travel or not. </span><span class="koboSpan" id="kobo.353.2">This ultimately allows us to leave this method to focus on pricing the customer’s baggage and to be aware of holidays but it is not responsible for determining what is and what isn’t </span><span class="No-Break"><span class="koboSpan" id="kobo.354.1">a holiday.</span></span></p>
<p><span class="koboSpan" id="kobo.355.1">Introducing a parameter can be done by selecting the variable or expression you wish to move to a parameter and then triggering the </span><strong class="bold"><span class="koboSpan" id="kobo.356.1">Quick </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.357.1">Actions</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.358.1"> menu:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer017">
<span class="koboSpan" id="kobo.359.1"><img alt="Figure 2.7 – Introducing a parameter using the Quick Actions menu" src="image/B21324_02_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.360.1">Figure 2.7 – Introducing a parameter using the Quick Actions menu</span></p>
<p><span class="koboSpan" id="kobo.361.1">There are multiple options to choose from when introducing a parameter. </span><span class="koboSpan" id="kobo.361.2">Choosing </span><strong class="bold"><span class="koboSpan" id="kobo.362.1">and update call sites directly</span></strong><span class="koboSpan" id="kobo.363.1"> is usually a good option – provided you review the code </span><span class="No-Break"><span class="koboSpan" id="kobo.364.1">it generates.</span></span></p>
<p><span class="koboSpan" id="kobo.365.1">Once we introduce </span><a id="_idIndexMarker057"/><span class="koboSpan" id="kobo.366.1">the parameter and name it appropriately, the </span><a id="_idIndexMarker058"/><span class="koboSpan" id="kobo.367.1">holiday fee logic becomes much easier </span><span class="No-Break"><span class="koboSpan" id="kobo.368.1">to read:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.369.1">
if (</span><strong class="bold"><span class="koboSpan" id="kobo.370.1">isHoliday</span></strong><span class="koboSpan" id="kobo.371.1">) {
  decimal holidayFee = total * HolidayFeePercent;
  Console.WriteLine("Holiday Fee: " + holidayFee);
  total += holidayFee;
}</span></pre>
<p><span class="koboSpan" id="kobo.372.1">Introducing a parameter also changed the method signature line to add a Boolean </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.373.1">isHoliday</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.374.1"> parameter:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.375.1">
public decimal CalculatePrice(int bags, int carryOn,
  int passengers, DateTime travelTime, </span><strong class="bold"><span class="koboSpan" id="kobo.376.1">bool isHoliday</span></strong><span class="koboSpan" id="kobo.377.1">) {</span></pre>
<p><span class="koboSpan" id="kobo.378.1">As a result of this refactoring, any code that called the </span><strong class="source-inline"><span class="koboSpan" id="kobo.379.1">CalculatePrice</span></strong><span class="koboSpan" id="kobo.380.1"> method now calculates and passes a value for </span><strong class="source-inline"><span class="koboSpan" id="kobo.381.1">isHoliday</span></strong><span class="koboSpan" id="kobo.382.1"> to </span><span class="No-Break"><span class="koboSpan" id="kobo.383.1">the method.</span></span></p>
<p><span class="koboSpan" id="kobo.384.1">I find that </span><strong class="bold"><span class="koboSpan" id="kobo.385.1">Introduce parameter</span></strong><span class="koboSpan" id="kobo.386.1"> is particularly helpful for letting a method focus on just a few key pieces </span><span class="No-Break"><span class="koboSpan" id="kobo.387.1">of logic.</span></span></p>
<p><span class="koboSpan" id="kobo.388.1">It can also be very helpful in places where you have very similar methods of doing similar things but only differing by a few key details. </span><span class="koboSpan" id="kobo.388.2">It can sometimes be possible to merge many different methods into a single method that takes in a few details </span><span class="No-Break"><span class="koboSpan" id="kobo.389.1">as parameters.</span></span></p>
<p><span class="koboSpan" id="kobo.390.1">For example, the following code might perform logging for </span><span class="No-Break"><span class="koboSpan" id="kobo.391.1">different actions:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.392.1">Fee.cs</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.393.1">
public void ChargeCarryOnBaggageFee(decimal fee) {
    Console.WriteLine($"</span><strong class="bold"><span class="koboSpan" id="kobo.394.1">Carry-on Fee</span></strong><span class="koboSpan" id="kobo.395.1">: {fee}");
    Total += fee;
}
public void ChargeCheckedBaggageFee(decimal fee) {
    Console.WriteLine($"</span><strong class="bold"><span class="koboSpan" id="kobo.396.1">Checked Fee</span></strong><span class="koboSpan" id="kobo.397.1">: {fee}");
    Total += fee;
}</span></pre>
<p><span class="koboSpan" id="kobo.398.1">These two methods</span><a id="_idIndexMarker059"/><span class="koboSpan" id="kobo.399.1"> both take in a numeric fee and </span><a id="_idIndexMarker060"/><span class="koboSpan" id="kobo.400.1">write the charge name and charged fee to the console. </span><span class="koboSpan" id="kobo.400.2">In fact, the only way they differ is the </span><span class="No-Break"><span class="koboSpan" id="kobo.401.1">charge name.</span></span></p>
<p><span class="koboSpan" id="kobo.402.1">This code could be consolidated into a single method by introducing </span><span class="No-Break"><span class="koboSpan" id="kobo.403.1">a parameter:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.404.1">
public void ChargeFee(decimal fee, </span><strong class="bold"><span class="koboSpan" id="kobo.405.1">string chargeName</span></strong><span class="koboSpan" id="kobo.406.1">) {
    Console.WriteLine($"{</span><strong class="bold"><span class="koboSpan" id="kobo.407.1">chargeName</span></strong><span class="koboSpan" id="kobo.408.1">}: {fee}");
    Total += fee;
}</span></pre>
<p><span class="koboSpan" id="kobo.409.1">Never underestimate the value of making a method more generalized by having outside code provide </span><span class="No-Break"><span class="koboSpan" id="kobo.410.1">additional details.</span></span></p>
<p><span class="koboSpan" id="kobo.411.1">With the charge logic largely improved, let’s move on to the final method in the code that has several</span><a id="_idIndexMarker061"/><span class="koboSpan" id="kobo.412.1"> warnings associated </span><span class="No-Break"><span class="koboSpan" id="kobo.413.1">with it.</span></span></p>
<h2 id="_idParaDest-35"><a id="_idTextAnchor034"/><span class="koboSpan" id="kobo.414.1">Removing unreachable and unused code</span></h2>
<p><span class="koboSpan" id="kobo.415.1">If you</span><a id="_idIndexMarker062"/><span class="koboSpan" id="kobo.416.1"> opened the beginning code from</span><a id="_idIndexMarker063"/><span class="koboSpan" id="kobo.417.1"> this chapter in Visual Studio, you would likely notice that </span><strong class="source-inline"><span class="koboSpan" id="kobo.418.1">CalculatePriceFlat</span></strong><span class="koboSpan" id="kobo.419.1"> and a few variables inside it appear in gray with a number of wavy underscore suggestions as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.420.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.421.1">.8</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.422.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer018">
<span class="koboSpan" id="kobo.423.1"><img alt="Figure 2.8 – The CalculatePriceFlat method with gray text for many lines of code" src="image/B21324_02_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.424.1">Figure 2.8 – The CalculatePriceFlat method with gray text for many lines of code</span></p>
<p><span class="koboSpan" id="kobo.425.1">Visual Studio can sometimes detect when variables, parameters, and even methods are not being used. </span><span class="koboSpan" id="kobo.425.2">If it does so, Visual Studio usually renders these identifiers in more muted tones and often includes suggestions to investigate or remove </span><span class="No-Break"><span class="koboSpan" id="kobo.426.1">these items.</span></span></p>
<p><span class="koboSpan" id="kobo.427.1">In this case, nothing is ever calling the </span><strong class="source-inline"><span class="koboSpan" id="kobo.428.1">CalculatePriceFlat</span></strong><span class="koboSpan" id="kobo.429.1"> method, and nothing is referencing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.430.1">numBags</span></strong><span class="koboSpan" id="kobo.431.1"> parameter. </span><span class="koboSpan" id="kobo.431.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.432.1">total</span></strong><span class="koboSpan" id="kobo.433.1"> variable is declared and given a value but is never read from after that, and the final </span><strong class="source-inline"><span class="koboSpan" id="kobo.434.1">return</span></strong><span class="koboSpan" id="kobo.435.1"> line is unreachable given the return line </span><span class="No-Break"><span class="koboSpan" id="kobo.436.1">above it.</span></span></p>
<p><span class="koboSpan" id="kobo.437.1">Each one of these issues can be addressed with a </span><em class="italic"><span class="koboSpan" id="kobo.438.1">remove unused member</span></em><span class="koboSpan" id="kobo.439.1">, </span><em class="italic"><span class="koboSpan" id="kobo.440.1">remove unused variable</span></em><span class="koboSpan" id="kobo.441.1">, or </span><em class="italic"><span class="koboSpan" id="kobo.442.1">remove unreachable </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.443.1">code</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.444.1"> refactoring.</span></span></p>
<p><span class="koboSpan" id="kobo.445.1">All these refactorings do what you’d expect: they remove the </span><span class="No-Break"><span class="koboSpan" id="kobo.446.1">offending code.</span></span></p>
<p><span class="koboSpan" id="kobo.447.1">Since nothing is calling the method at all, the entire method can </span><span class="No-Break"><span class="koboSpan" id="kobo.448.1">be removed.</span></span></p>
<h3><span class="koboSpan" id="kobo.449.1">Removing unused parameters</span></h3>
<p><span class="koboSpan" id="kobo.450.1">There’s another </span><a id="_idIndexMarker064"/><span class="koboSpan" id="kobo.451.1">piece of code from earlier that can be removed as well: the </span><strong class="source-inline"><span class="koboSpan" id="kobo.452.1">CalculatePrice</span></strong><span class="koboSpan" id="kobo.453.1"> method has a </span><strong class="source-inline"><span class="koboSpan" id="kobo.454.1">travelTime</span></strong><span class="koboSpan" id="kobo.455.1"> parameter that is no longer being used after we introduced the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.456.1">isHoliday</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.457.1"> parameter.</span></span></p>
<p><span class="koboSpan" id="kobo.458.1">There is no </span><em class="italic"><span class="koboSpan" id="kobo.459.1">remove unused parameter</span></em><span class="koboSpan" id="kobo.460.1"> in Visual Studio at the time of writing, but you can remove it safely using some of the method-level refactorings we’ll discuss in the </span><span class="No-Break"><span class="koboSpan" id="kobo.461.1">next chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.462.1">To perform this refactoring, select the </span><strong class="source-inline"><span class="koboSpan" id="kobo.463.1">travelTime</span></strong><span class="koboSpan" id="kobo.464.1"> parameter and then select </span><strong class="bold"><span class="koboSpan" id="kobo.465.1">Change signature...</span></strong><span class="koboSpan" id="kobo.466.1"> as </span><span class="No-Break"><span class="koboSpan" id="kobo.467.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer019">
<span class="koboSpan" id="kobo.468.1"><img alt="Figure 2.9 – Changing the signature of a method" src="image/B21324_02_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.469.1">Figure 2.9 – Changing the signature of a method</span></p>
<p><span class="koboSpan" id="kobo.470.1">Clicking </span><strong class="bold"><span class="koboSpan" id="kobo.471.1">Change signature…</span></strong><span class="koboSpan" id="kobo.472.1"> will show the </span><strong class="bold"><span class="koboSpan" id="kobo.473.1">Change </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.474.1">Signature</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.475.1"> dialog.</span></span></p>
<p><span class="koboSpan" id="kobo.476.1">Select the </span><strong class="source-inline"><span class="koboSpan" id="kobo.477.1">travelTime</span></strong><span class="koboSpan" id="kobo.478.1"> parameter </span><a id="_idIndexMarker065"/><span class="koboSpan" id="kobo.479.1">and click </span><strong class="bold"><span class="koboSpan" id="kobo.480.1">Remove</span></strong><span class="koboSpan" id="kobo.481.1">. </span><span class="koboSpan" id="kobo.481.2">The parameter will appear crossed out in </span><span class="No-Break"><span class="koboSpan" id="kobo.482.1">the dialog:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer020">
<span class="koboSpan" id="kobo.483.1"><img alt="Figure 2.10 – The Change Signature dialog with travelTime removed" src="image/B21324_02_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.484.1">Figure 2.10 – The Change Signature dialog with travelTime removed</span></p>
<p><span class="koboSpan" id="kobo.485.1">Click </span><strong class="bold"><span class="koboSpan" id="kobo.486.1">OK</span></strong><span class="koboSpan" id="kobo.487.1"> and the dialog will close and the parameter will </span><span class="No-Break"><span class="koboSpan" id="kobo.488.1">be removed.</span></span></p>
<p><span class="koboSpan" id="kobo.489.1">Any code that was referencing your method will also have their signatures updated to not pass anything for the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.490.1">travelTime</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.491.1"> parameter.</span></span></p>
<h3><span class="koboSpan" id="kobo.492.1">Avoiding pitfalls when removing code</span></h3>
<p><span class="koboSpan" id="kobo.493.1">One cautionary </span><a id="_idIndexMarker066"/><span class="koboSpan" id="kobo.494.1">note on removing code: be particularly careful about removing </span><strong class="source-inline"><span class="koboSpan" id="kobo.495.1">public</span></strong><span class="koboSpan" id="kobo.496.1"> members from code. </span><span class="koboSpan" id="kobo.496.2">Sometimes Visual Studio is not aware of all the places using code. </span><span class="koboSpan" id="kobo.496.3">This is particularly true for serialization/deserialization logic, properties that exist for data binding, and members that are accessed </span><span class="No-Break"><span class="koboSpan" id="kobo.497.1">using reflection.</span></span></p>
<p><span class="koboSpan" id="kobo.498.1">Additionally, if your code is being deployed</span><a id="_idIndexMarker067"/><span class="koboSpan" id="kobo.499.1"> as a </span><strong class="bold"><span class="koboSpan" id="kobo.500.1">NuGet package</span></strong><span class="koboSpan" id="kobo.501.1"> or otherwise being shared in other projects, it is possible that code outside of your solution may depend on a method or parameter, and your change could cause their code to no </span><span class="No-Break"><span class="koboSpan" id="kobo.502.1">longer compile.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.503.1">Reminder on testing</span></p>
<p class="callout"><span class="koboSpan" id="kobo.504.1">It is </span><em class="italic"><span class="koboSpan" id="kobo.505.1">your</span></em><span class="koboSpan" id="kobo.506.1"> responsibility to test any refactorings you make and ensure they do not bring about unintended changes in </span><span class="No-Break"><span class="koboSpan" id="kobo.507.1">program behavior.</span></span></p>
<p><span class="koboSpan" id="kobo.508.1">That may sound scary, but don’t let these edge cases stop you from removing </span><span class="No-Break"><span class="koboSpan" id="kobo.509.1">dead code.</span></span></p>
<p><span class="koboSpan" id="kobo.510.1">I’ve known a number of developers hesitant to remove code in case they need it later. </span><span class="koboSpan" id="kobo.510.2">Instead, these developers will either keep the code there untouched or comment the entire block of </span><span class="No-Break"><span class="koboSpan" id="kobo.511.1">code out.</span></span></p>
<p><span class="koboSpan" id="kobo.512.1">The problem with commenting out dead code is that it increases the amount of distracting and unhelpful comments in a file. </span><span class="koboSpan" id="kobo.512.2">This reduces the amount of importance developers place on the comments that are present and also increases the amount of scrolling the developers </span><span class="No-Break"><span class="koboSpan" id="kobo.513.1">must do.</span></span></p>
<p><span class="koboSpan" id="kobo.514.1">Delete dead code. </span><span class="koboSpan" id="kobo.514.2">Your code should be in source control anyway, so if you really need to find the code later, you can look at the history to recover it – assuming, of course, you checked the code into source control to </span><span class="No-Break"><span class="koboSpan" id="kobo.515.1">begin with.</span></span></p>
<h2 id="_idParaDest-36"><a id="_idTextAnchor035"/><span class="koboSpan" id="kobo.516.1">Extracting methods</span></h2>
<p><span class="koboSpan" id="kobo.517.1">Our code is now</span><a id="_idIndexMarker068"/><span class="koboSpan" id="kobo.518.1"> looking fairly clean, but </span><a id="_idIndexMarker069"/><span class="koboSpan" id="kobo.519.1">the </span><strong class="source-inline"><span class="koboSpan" id="kobo.520.1">CalculatePrice</span></strong><span class="koboSpan" id="kobo.521.1"> method has a lot of logic in it for the checked baggage </span><span class="No-Break"><span class="koboSpan" id="kobo.522.1">price calculation.</span></span></p>
<p><span class="koboSpan" id="kobo.523.1">This logic is complex enough for us to extract a method just for this logic and call that method from our </span><span class="No-Break"><span class="koboSpan" id="kobo.524.1">existing code.</span></span></p>
<p><span class="koboSpan" id="kobo.525.1">To do this, select the lines of code that represent the method you want to extract. </span><span class="koboSpan" id="kobo.525.2">Be mindful of the various </span><strong class="source-inline"><span class="koboSpan" id="kobo.526.1">{}</span></strong><span class="koboSpan" id="kobo.527.1"> instances that you select, as your selection must make sense as a related block of code to Visual Studio. </span><span class="koboSpan" id="kobo.527.2">See the </span><span class="No-Break"><span class="koboSpan" id="kobo.528.1">following screenshot.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer021">
<span class="koboSpan" id="kobo.529.1"><img alt="Figure 2.11 – Extracting a method from a block of code" src="image/B21324_02_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.530.1">Figure 2.11 – Extracting a method from a block of code</span></p>
<p><span class="koboSpan" id="kobo.531.1">Once your block of </span><a id="_idIndexMarker070"/><span class="koboSpan" id="kobo.532.1">code is selected, open the </span><strong class="bold"><span class="koboSpan" id="kobo.533.1">Quick Actions</span></strong><span class="koboSpan" id="kobo.534.1"> menu, choose </span><strong class="bold"><span class="koboSpan" id="kobo.535.1">Extract Method</span></strong><span class="koboSpan" id="kobo.536.1">, and then name the method in the prompt before pressing </span><em class="italic"><span class="koboSpan" id="kobo.537.1">Enter</span></em><span class="koboSpan" id="kobo.538.1"> to confirm </span><span class="No-Break"><span class="koboSpan" id="kobo.539.1">your name.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer022">
<span class="koboSpan" id="kobo.540.1"><img alt="Figure 2.12 – Naming the extracted method" src="image/B21324_02_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.541.1">Figure 2.12 – Naming the extracted method</span></p>
<p><span class="koboSpan" id="kobo.542.1">This will result in a new method being added to </span><span class="No-Break"><span class="koboSpan" id="kobo.543.1">your code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.544.1">
private static decimal ApplyCheckedBagFee(int bags,
  int passengers, decimal total) {
  if (bags &lt;= passengers) {
    decimal firstBagFee = bags * FirstBagFee;
    Console.WriteLine($"Checked: {firstBagFee}");
    total += firstBagFee;
  } else {
    decimal firstBagFee = passengers * FirstBagFee;
    decimal extraBagFee = (bags - passengers)* ExtraBagFee;
    decimal checkedFee = firstBagFee + extraBagFee;
    Console.WriteLine($"Checked: {checkedFee}");
    total += checkedFee;
  }
  return total;
}</span></pre>
<p><span class="koboSpan" id="kobo.545.1">Note that Visual Studio will make the method </span><strong class="source-inline"><span class="koboSpan" id="kobo.546.1">private</span></strong><span class="koboSpan" id="kobo.547.1"> by default and will mark the method as </span><strong class="source-inline"><span class="koboSpan" id="kobo.548.1">static</span></strong><span class="koboSpan" id="kobo.549.1"> if it does not access instance members on </span><span class="No-Break"><span class="koboSpan" id="kobo.550.1">the class.</span></span></p>
<p><span class="koboSpan" id="kobo.551.1">I generally prefer </span><strong class="source-inline"><span class="koboSpan" id="kobo.552.1">private</span></strong><span class="koboSpan" id="kobo.553.1"> methods, but your preferences on </span><strong class="source-inline"><span class="koboSpan" id="kobo.554.1">static</span></strong><span class="koboSpan" id="kobo.555.1"> may vary depending on what</span><a id="_idIndexMarker071"/><span class="koboSpan" id="kobo.556.1"> method you’re working with and</span><a id="_idIndexMarker072"/><span class="koboSpan" id="kobo.557.1"> whether it makes sense for the method to ultimately </span><span class="No-Break"><span class="koboSpan" id="kobo.558.1">be </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.559.1">static</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.560.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.561.1">The extract method refactoring also removes the code from the original method and replaces it with a call to the </span><span class="No-Break"><span class="koboSpan" id="kobo.562.1">new method:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.563.1">
public decimal CalculatePrice(int bags, int carryOn,
  int passengers, DateTime travelTime, bool isHoliday) {
  decimal total = 0;
  if (carryOn &gt; 0) {
    decimal fee = carryOn * CarryOnFee;
    Console.WriteLine($"Carry-on: {fee}");
    total += fee;
  }
  if (bags &gt; 0) {
    total = </span><strong class="bold"><span class="koboSpan" id="kobo.564.1">ApplyCheckedBagFee(bags, passengers, total)</span></strong><span class="koboSpan" id="kobo.565.1">;
  }
  if (isHoliday) {
    decimal holidayFee = total * HolidayFeePercent;
    Console.WriteLine("Holiday Fee: " + holidayFee);
    total += holidayFee;
  }
  return total;
}</span></pre>
<p><span class="koboSpan" id="kobo.566.1">This results in a much more concise and readable </span><strong class="bold"><span class="koboSpan" id="kobo.567.1">CalculatePrice method</span></strong><span class="koboSpan" id="kobo.568.1"> and makes it easier to think about everything the method is doing. </span><span class="koboSpan" id="kobo.568.2">This reduced complexity greatly improves the long-term</span><a id="_idIndexMarker073"/><span class="koboSpan" id="kobo.569.1"> quality of the method by helping</span><a id="_idIndexMarker074"/><span class="koboSpan" id="kobo.570.1"> developers fully understand the method and avoids costly mistakes that can occur when maintaining complex blocks </span><span class="No-Break"><span class="koboSpan" id="kobo.571.1">of code.</span></span></p>
<h2 id="_idParaDest-37"><a id="_idTextAnchor036"/><span class="koboSpan" id="kobo.572.1">Refactoring manually</span></h2>
<p><span class="koboSpan" id="kobo.573.1">Up until this</span><a id="_idIndexMarker075"/><span class="koboSpan" id="kobo.574.1"> point, we’ve performed a number of refactoring operations supported by Visual Studio. </span><span class="koboSpan" id="kobo.574.2">These have been fairly safe given the quality of the tools we’ve used, but there are some things the built-in tools just </span><span class="No-Break"><span class="koboSpan" id="kobo.575.1">won’t do.</span></span></p>
<p><span class="koboSpan" id="kobo.576.1">Visual Studio is powerful, but it can’t think about code like a human can (despite the exciting new AI features we’ll talk about in </span><a href="B21324_11.xhtml#_idTextAnchor236"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.577.1">Chapter 11</span></em></span></a><span class="koboSpan" id="kobo.578.1">, </span><em class="italic"><span class="koboSpan" id="kobo.579.1">AI-Assisted Refactoring with GitHub </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.580.1">Copilot Chat</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.581.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.582.1">Sometimes there will be opportunities to improve the code that no built-in refactoring can perform for you. </span><span class="koboSpan" id="kobo.582.2">At those points, you’ll have to make the </span><span class="No-Break"><span class="koboSpan" id="kobo.583.1">changes manually.</span></span></p>
<p><span class="koboSpan" id="kobo.584.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.585.1">ApplyCheckedBagFee</span></strong><span class="koboSpan" id="kobo.586.1"> method we extracted earlier is a good method, but a few things could </span><span class="No-Break"><span class="koboSpan" id="kobo.587.1">be improved.</span></span></p>
<p><span class="koboSpan" id="kobo.588.1">First, the method takes in a total, increases it by a fee, and then returns that new total. </span><span class="koboSpan" id="kobo.588.2">It’d be easier for others to understand the method if the method returned the fee instead of the </span><span class="No-Break"><span class="koboSpan" id="kobo.589.1">adjusted total.</span></span></p>
<p><span class="koboSpan" id="kobo.590.1">Secondly, the method is performing the same </span><strong class="source-inline"><span class="koboSpan" id="kobo.591.1">Console.WriteLine</span></strong><span class="koboSpan" id="kobo.592.1"> operation twice. </span><span class="koboSpan" id="kobo.592.2">Additionally, all other </span><strong class="source-inline"><span class="koboSpan" id="kobo.593.1">WriteLine</span></strong><span class="koboSpan" id="kobo.594.1"> statements in the class are in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.595.1">CalculatePrice</span></strong><span class="koboSpan" id="kobo.596.1"> method, making the user interface slightly hard to </span><span class="No-Break"><span class="koboSpan" id="kobo.597.1">fully trace.</span></span></p>
<p><span class="koboSpan" id="kobo.598.1">Let’s modify the method so that it returns only the fee, doesn’t require the </span><strong class="source-inline"><span class="koboSpan" id="kobo.599.1">total</span></strong><span class="koboSpan" id="kobo.600.1"> parameter, and </span><a id="_idIndexMarker076"/><span class="koboSpan" id="kobo.601.1">doesn’t </span><span class="No-Break"><span class="koboSpan" id="kobo.602.1">log anything:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.603.1">
private static decimal ApplyCheckedBagFee(int bags,
  int passengers) {
  if (bags &lt;= passengers) {
    decimal firstBagFee = bags * FirstBagFee;
    </span><strong class="bold"><span class="koboSpan" id="kobo.604.1">return firstBagFee;</span></strong><span class="koboSpan" id="kobo.605.1">
  } else {
    decimal firstBagFee = passengers * FirstBagFee;
    decimal extraBagFee = (bags-passengers) * ExtraBagFee;
    decimal checkedFee = firstBagFee + extraBagFee;
    </span><strong class="bold"><span class="koboSpan" id="kobo.606.1">return checkedFee;</span></strong><span class="koboSpan" id="kobo.607.1">
  }
}</span></pre>
<p><span class="koboSpan" id="kobo.608.1">Next, we’ll need to update the code that calls </span><span class="No-Break"><span class="koboSpan" id="kobo.609.1">this method:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.610.1">
if (bags &gt; 0) {
  </span><strong class="bold"><span class="koboSpan" id="kobo.611.1">decimal bagFee = ApplyCheckedBagFee(bags, passengers);</span></strong><span class="koboSpan" id="kobo.612.1">
  Console.WriteLine($"Checked: {</span><strong class="bold"><span class="koboSpan" id="kobo.613.1">bagFee</span></strong><span class="koboSpan" id="kobo.614.1">}");
  total += </span><strong class="bold"><span class="koboSpan" id="kobo.615.1">bagFee</span></strong><span class="koboSpan" id="kobo.616.1">;
}</span></pre>
<p><span class="koboSpan" id="kobo.617.1">Note that the result is stored in a </span><strong class="source-inline"><span class="koboSpan" id="kobo.618.1">bagFee</span></strong><span class="koboSpan" id="kobo.619.1"> variable, </span><strong class="source-inline"><span class="koboSpan" id="kobo.620.1">total</span></strong><span class="koboSpan" id="kobo.621.1"> is no longer passed to </span><strong class="source-inline"><span class="koboSpan" id="kobo.622.1">ApplyCheckedBagFee</span></strong><span class="koboSpan" id="kobo.623.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.624.1">Console.WriteLine</span></strong><span class="koboSpan" id="kobo.625.1"> now appears here in </span><span class="No-Break"><span class="koboSpan" id="kobo.626.1">this method.</span></span></p>
<p><span class="koboSpan" id="kobo.627.1">Additionally, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.628.1">ApplyCheckedBagFee</span></strong><span class="koboSpan" id="kobo.629.1"> name might not apply anymore since the method no longer actually applies the fee, but rather calculates it. </span><span class="koboSpan" id="kobo.629.2">In this case, applying the </span><em class="italic"><span class="koboSpan" id="kobo.630.1">rename method</span></em><span class="koboSpan" id="kobo.631.1"> refactoring </span><a id="_idIndexMarker077"/><span class="koboSpan" id="kobo.632.1">would help the final code have a more </span><span class="No-Break"><span class="koboSpan" id="kobo.633.1">appropriate name.</span></span></p>
<h2 id="_idParaDest-38"><a id="_idTextAnchor037"/><span class="koboSpan" id="kobo.634.1">Testing refactored code</span></h2>
<p><span class="koboSpan" id="kobo.635.1">As I mentioned</span><a id="_idIndexMarker078"/><span class="koboSpan" id="kobo.636.1"> earlier, it is </span><em class="italic"><span class="koboSpan" id="kobo.637.1">your responsibility</span></em><span class="koboSpan" id="kobo.638.1"> to</span><a id="_idIndexMarker079"/><span class="koboSpan" id="kobo.639.1"> ensure that your refactoring efforts have not altered how the system </span><span class="No-Break"><span class="koboSpan" id="kobo.640.1">fundamentally behaves.</span></span></p>
<p><span class="koboSpan" id="kobo.641.1">In our case, this means that </span><strong class="source-inline"><span class="koboSpan" id="kobo.642.1">BaggageCalculator</span></strong><span class="koboSpan" id="kobo.643.1"> should still calculate the same prices it did before for any valid set </span><span class="No-Break"><span class="koboSpan" id="kobo.644.1">of inputs.</span></span></p>
<p><span class="koboSpan" id="kobo.645.1">One of the many tools we have at our disposal for determining whether code still meets our needs is</span><a id="_idIndexMarker080"/><span class="koboSpan" id="kobo.646.1"> running </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.647.1">unit tests</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.648.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.649.1">We’ll talk more about unit tests in </span><a href="B21324_06.xhtml#_idTextAnchor133"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.650.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.651.1">, </span><em class="italic"><span class="koboSpan" id="kobo.652.1">Unit Testing</span></em><span class="koboSpan" id="kobo.653.1">, but for now, know that unit tests are code that verifies that other code is working </span><span class="No-Break"><span class="koboSpan" id="kobo.654.1">as expected.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.655.1">BaggageCalculator</span></strong><span class="koboSpan" id="kobo.656.1"> has five tests that can be run by clicking on the </span><strong class="bold"><span class="koboSpan" id="kobo.657.1">Test</span></strong><span class="koboSpan" id="kobo.658.1"> menu and then choosing </span><strong class="bold"><span class="koboSpan" id="kobo.659.1">Run </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.660.1">All Tests</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.661.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.662.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.663.1">Test Explorer</span></strong><span class="koboSpan" id="kobo.664.1"> window should show all tests as passing with green </span><span class="No-Break"><span class="koboSpan" id="kobo.665.1">check marks:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer023">
<span class="koboSpan" id="kobo.666.1"><img alt="Figure 2.13 – Five passing tests in Test Explorer" src="image/B21324_02_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.667.1">Figure 2.13 – Five passing tests in Test Explorer</span></p>
<p><span class="koboSpan" id="kobo.668.1">If a test is now failing and didn’t fail before, this is a good thing, since it means the test found an issue you caused in the code’s behavior. </span><span class="koboSpan" id="kobo.668.2">Investigate the failing test and then resolve the issue </span><span class="No-Break"><span class="koboSpan" id="kobo.669.1">before continuing.</span></span></p>
<p><span class="koboSpan" id="kobo.670.1">We’ll explore testing in much more detail in </span><em class="italic"><span class="koboSpan" id="kobo.671.1">Part 2</span></em><span class="koboSpan" id="kobo.672.1"> of this book, but as it stands, it appears that our refactorings have </span><span class="No-Break"><span class="koboSpan" id="kobo.673.1">been successful.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.674.1">Final code</span></p>
<p class="callout"><span class="koboSpan" id="kobo.675.1">The final refactored code from this chapter is available in the </span><a href="https://github.com/PacktPublishing/Refactoring-with-CSharp"><span class="koboSpan" id="kobo.676.1">https://github.com/PacktPublishing/Refactoring-with-CSharp</span></a><span class="koboSpan" id="kobo.677.1"> repository, inside the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.678.1">Chapter02/Ch2FinalCode</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.679.1"> folder.</span></span></p>
<p><span class="koboSpan" id="kobo.680.1">The code we produced in this chapter is simple, readable, and maintainable. </span><span class="koboSpan" id="kobo.680.2">Certainly, there are things that </span><a id="_idIndexMarker081"/><span class="koboSpan" id="kobo.681.1">could still be improved, but the code is less likely to cause issues as it grows in complexity in </span><span class="No-Break"><span class="koboSpan" id="kobo.682.1">the future.</span></span></p>
<h1 id="_idParaDest-39"><a id="_idTextAnchor038"/><span class="koboSpan" id="kobo.683.1">Refactoring in other editors</span></h1>
<p><span class="koboSpan" id="kobo.684.1">Before we end</span><a id="_idIndexMarker082"/><span class="koboSpan" id="kobo.685.1"> the chapter, let’s talk about refactoring in editors other than </span><span class="No-Break"><span class="koboSpan" id="kobo.686.1">Visual Studio.</span></span></p>
<p><span class="koboSpan" id="kobo.687.1">This book primarily focuses on refactoring in Visual Studio because that’s the current primary development environment for .NET developers. </span><span class="koboSpan" id="kobo.687.2">However, there are a few other editors and extensions that are frequently used for .NET development and offer </span><span class="No-Break"><span class="koboSpan" id="kobo.688.1">refactoring support:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.689.1">Visual </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.690.1">Studio Code</span></strong></span></li>
<li><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.691.1">JetBrains Rider</span></strong></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.692.1">JetBrains ReSharper</span></strong><span class="koboSpan" id="kobo.693.1"> (Visual </span><span class="No-Break"><span class="koboSpan" id="kobo.694.1">Studio Extension)</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.695.1">These tools will not be featured in examples throughout the remainder of the book since Visual Studio is the primary editing experience. </span><span class="koboSpan" id="kobo.695.2">However, most of what I’ll show you in the remainder of the book is also possible using </span><span class="No-Break"><span class="koboSpan" id="kobo.696.1">these tools.</span></span></p>
<h2 id="_idParaDest-40"><a id="_idTextAnchor039"/><span class="koboSpan" id="kobo.697.1">Refactoring in Visual Studio Code with the C# Dev Kit</span></h2>
<p><strong class="bold"><span class="koboSpan" id="kobo.698.1">Visual Studio Code</span></strong><span class="koboSpan" id="kobo.699.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.700.1">VS Code</span></strong><span class="koboSpan" id="kobo.701.1">) is </span><a id="_idIndexMarker083"/><span class="koboSpan" id="kobo.702.1">rapidly</span><a id="_idIndexMarker084"/><span class="koboSpan" id="kobo.703.1"> becoming a highly capable editing environment for .NET projects with its </span><span class="No-Break"><span class="koboSpan" id="kobo.704.1">C# extension.</span></span></p>
<p><span class="koboSpan" id="kobo.705.1">Where VS Code really comes into its own is with the newer </span><strong class="bold"><span class="koboSpan" id="kobo.706.1">C# Dev Kit</span></strong><span class="koboSpan" id="kobo.707.1">, which gives an editing experience almost identical to Visual Studio, including the solution explorer. </span><span class="koboSpan" id="kobo.707.2">The C# Dev Kit integrates with the other C# extensions to provide code suggestions and refactoring </span><strong class="bold"><span class="koboSpan" id="kobo.708.1">Quick Actions</span></strong><span class="koboSpan" id="kobo.709.1"> with the same style of light bulb icons you see in </span><span class="No-Break"><span class="koboSpan" id="kobo.710.1">Visual Studio.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer024">
<span class="koboSpan" id="kobo.711.1"><img alt="Figure 2.14 – Refactoring with the C# Dev Kit in VS Code" src="image/B21324_02_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.712.1">Figure 2.14 – Refactoring with the C# Dev Kit in VS Code</span></p>
<p><span class="koboSpan" id="kobo.713.1">VS Code won’t give you the full set of refactoring options Visual Studio currently does, but it is cross-platform and will work on Mac </span><span class="No-Break"><span class="koboSpan" id="kobo.714.1">and Linux.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.715.1">Licensing note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.716.1">VS Code is free, but the C# Dev Kit extension requires a paid Visual Studio </span><span class="No-Break"><span class="koboSpan" id="kobo.717.1">license key.</span></span></p>
<p><span class="koboSpan" id="kobo.718.1">I expect we’ll see VS Code featured much more prominently in .NET development with the improvements from the C# Dev Kit and VS Code’s cross-platform capabilities, along with its ability to</span><a id="_idIndexMarker085"/><span class="koboSpan" id="kobo.719.1"> run </span><a id="_idIndexMarker086"/><span class="koboSpan" id="kobo.720.1">in-browser to some </span><a id="_idIndexMarker087"/><span class="koboSpan" id="kobo.721.1">extent through </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.722.1">GitHub Codespaces</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.723.1">.</span></span></p>
<h2 id="_idParaDest-41"><a id="_idTextAnchor040"/><span class="koboSpan" id="kobo.724.1">Refactoring in JetBrains Rider</span></h2>
<p><span class="koboSpan" id="kobo.725.1">JetBrains Rider is a</span><a id="_idIndexMarker088"/><span class="koboSpan" id="kobo.726.1"> separate editor developed on the same set of editing software used by the </span><a id="_idIndexMarker089"/><span class="koboSpan" id="kobo.727.1">popular </span><strong class="bold"><span class="koboSpan" id="kobo.728.1">IntelliJ</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.729.1">Java editor.</span></span></p>
<p><span class="koboSpan" id="kobo.730.1">Rider works with most .NET projects and has a fantastic set of refactoring capabilities built in. </span><span class="koboSpan" id="kobo.730.2">These capabilities will often be similar to those mentioned in this book, but the exact naming and user experience will be </span><span class="No-Break"><span class="koboSpan" id="kobo.731.1">slightly different.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer025">
<span class="koboSpan" id="kobo.732.1"><img alt="Figure 2.15 – Refactoring in JetBrains Rider" src="image/B21324_02_15.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.733.1">Figure 2.15 – Refactoring in JetBrains Rider</span></p>
<p><span class="koboSpan" id="kobo.734.1">Like VS Code, one major advantage Rider has over Visual Studio is that it is fully cross-platform and can run on macOS </span><span class="No-Break"><span class="koboSpan" id="kobo.735.1">or Linux.</span></span></p>
<h2 id="_idParaDest-42"><a id="_idTextAnchor041"/><span class="koboSpan" id="kobo.736.1">Refactoring in Visual Studio with ReSharper</span></h2>
<p><span class="koboSpan" id="kobo.737.1">If you love </span><a id="_idIndexMarker090"/><span class="koboSpan" id="kobo.738.1">working with Visual Studio but want the </span><a id="_idIndexMarker091"/><span class="koboSpan" id="kobo.739.1">same rich set of refactorings that Rider offers, JetBrains also offers a Visual Studio extension </span><span class="No-Break"><span class="koboSpan" id="kobo.740.1">called </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.741.1">ReSharper</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.742.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.743.1">ReSharper replaces many Visual Studio features with enhanced versions, including Visual Studio’s code analysis and </span><span class="No-Break"><span class="koboSpan" id="kobo.744.1">refactoring tools.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer026">
<span class="koboSpan" id="kobo.745.1"><img alt="Figure 2.16 – Refactoring with ReSharper in Visual Studio" src="image/B21324_02_16.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.746.1">Figure 2.16 – Refactoring with ReSharper in Visual Studio</span></p>
<p><span class="koboSpan" id="kobo.747.1">Nowadays, Visual Studio tends to have most of the refactoring capabilities ReSharper and Rider offer, but</span><a id="_idIndexMarker092"/><span class="koboSpan" id="kobo.748.1"> the capabilities of ReSharper and Rider </span><a id="_idIndexMarker093"/><span class="koboSpan" id="kobo.749.1">can sometimes be a bit </span><span class="No-Break"><span class="koboSpan" id="kobo.750.1">more advanced.</span></span></p>
<h1 id="_idParaDest-43"><a id="_idTextAnchor042"/><span class="koboSpan" id="kobo.751.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.752.1">Throughout this chapter, we explored refactoring by taking a class with a bit of complexity and applied targeted refactorings to make it easier to read, maintain, </span><span class="No-Break"><span class="koboSpan" id="kobo.753.1">and expand.</span></span></p>
<p><span class="koboSpan" id="kobo.754.1">We went from a modestly complex class to a relatively simple one by following a set of repeatable actions that transformed the code from one form to another without changing its overall behavior </span><span class="No-Break"><span class="koboSpan" id="kobo.755.1">or result.</span></span></p>
<p><span class="koboSpan" id="kobo.756.1">Although Visual Studio supports very capable refactoring tools, it is up to you as an experienced developer to know when you might want to apply each individual refactoring, based on the current level of complexity of your code and the code smells </span><span class="No-Break"><span class="koboSpan" id="kobo.757.1">you’re observing.</span></span></p>
<p><span class="koboSpan" id="kobo.758.1">Over the next three chapters, we’ll explore the built-in refactorings in more depth by exploring refactorings related to methods, classes, and individual lines </span><span class="No-Break"><span class="koboSpan" id="kobo.759.1">of code.</span></span></p>
<h1 id="_idParaDest-44"><a id="_idTextAnchor043"/><span class="koboSpan" id="kobo.760.1">Questions</span></h1>
<ol>
<li><span class="koboSpan" id="kobo.761.1">What are some ways of triggering Quick Actions for a block </span><span class="No-Break"><span class="koboSpan" id="kobo.762.1">of code?</span></span></li>
<li><span class="koboSpan" id="kobo.763.1">Does Visual Studio ever indicate that refactorings are possible </span><span class="No-Break"><span class="koboSpan" id="kobo.764.1">or recommended?</span></span></li>
<li><span class="koboSpan" id="kobo.765.1">How can you know what a Quick Action will do before </span><span class="No-Break"><span class="koboSpan" id="kobo.766.1">performing it?</span></span></li>
<li><span class="koboSpan" id="kobo.767.1">Are Visual Studio Quick Actions the only way to </span><span class="No-Break"><span class="koboSpan" id="kobo.768.1">refactor code?</span></span></li>
</ol>
<h1 id="_idParaDest-45"><a id="_idTextAnchor044"/><span class="koboSpan" id="kobo.769.1">Further reading</span></h1>
<p><span class="koboSpan" id="kobo.770.1">You can find more information about refactoring in Visual Studio and other environments at </span><span class="No-Break"><span class="koboSpan" id="kobo.771.1">these URLs:</span></span></p>
<ul>
<li><em class="italic"><span class="koboSpan" id="kobo.772.1">Quick Actions </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.773.1">Overview</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.774.1">: </span></span><a href="https://learn.microsoft.com/en-us/visualstudio/ide/quick-actions "><span class="No-Break"><span class="koboSpan" id="kobo.775.1">https://learn.microsoft.com/en-us/visualstudio/ide/quick-actions</span></span></a></li>
<li><em class="italic"><span class="koboSpan" id="kobo.776.1">JetBrains Rider vs Visual Studio (with and without </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.777.1">ReSharper)</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.778.1">: </span></span><a href="https://www.jetbrains.com/rider/compare/rider-vs-visual-studio/"><span class="No-Break"><span class="koboSpan" id="kobo.779.1">https://www.jetbrains.com/rider/compare/rider-vs-visual-studio/</span></span></a></li>
<li><em class="italic"><span class="koboSpan" id="kobo.780.1">Announcing C# Dev Kit for Visual Studio </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.781.1">Code</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.782.1">: </span></span><a href="https://devblogs.microsoft.com/visualstudio/announcing-csharp-dev-kit-for-visual-studio-code/"><span class="No-Break"><span class="koboSpan" id="kobo.783.1">https://devblogs.microsoft.com/visualstudio/announcing-csharp-dev-kit-for-visual-studio-code/</span></span></a></li>
</ul>
</div>
</body></html>