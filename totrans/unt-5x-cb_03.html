<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;2D Animation"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. 2D Animation</h1></div></div></div><p>In this chapter, we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Flipping a sprite horizontally</li><li class="listitem" style="list-style-type: disc">Animating body parts for character movement events</li><li class="listitem" style="list-style-type: disc">Creating a 3-frame animation clip to make a platform continually animate</li><li class="listitem" style="list-style-type: disc">Making a platform start falling once stepped-on using a Trigger to move animation from one state to another</li><li class="listitem" style="list-style-type: disc">Creating animation clips from sprite sheet sequences</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec37"/>Introduction</h1></div></div></div><p>Unity 5 builds on the introduction of powerful 2D<a class="indexterm" id="id267"/> features in the Mecanim animation system and the 2D physics system that were introduced in Unity 4.6 late 2014. In this chapter, we present a range of recipes to introduce the basics of 2D animation in Unity 5, and help you understand the relationships between the different animation elements.</p><div class="section" title="The big picture"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec95"/>The big picture</h2></div></div></div><p>In Unity 2D animations can be created in several different ways – one way is to create many images, each <a class="indexterm" id="id268"/>slightly different, which frame-by-frame give the appearance of movement. A second way to create animations is by defining keyframe positions for individual parts of an object (for example, the arms, legs, feet, head, eyes, and so on), and getting Unity to calculate all the in-between positions when the game in running.</p><div class="mediaobject"><img alt="The big picture" src="graphics/1362OT_03_21.jpg"/></div><p>Both sources of animations become <span class="strong"><strong>Animation Clips</strong></span> in the Animation panel. Each <span class="strong"><strong>Animation Clip</strong></span> then <a class="indexterm" id="id269"/>becomes a <span class="strong"><strong>State</strong></span> in the <span class="strong"><strong>Animator Controller State Machine</strong></span>. We then define under what conditions a GameObject will <span class="strong"><strong>Transition</strong></span> from one animation state (clip) to another.</p></div></div></div>
<div class="section" title="Flipping a sprite horizontally"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec38"/>Flipping a sprite horizontally</h1></div></div></div><p>Perhaps the <a class="indexterm" id="id270"/>simplest 2D animation is a simple flip, from facing left to facing right, or facing up to facing down, and so on. In this recipe we'll add a cute bug sprite to the scene, and write a short script to flip its horizontal direction when the <span class="emphasis"><em>Left</em></span> and <span class="emphasis"><em>Right</em></span> arrow keys are pressed.</p><div class="mediaobject"><img alt="Flipping a sprite horizontally" src="graphics/1362OT_03_04.jpg"/></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec96"/>Getting ready</h2></div></div></div><p>For this recipe, we have prepared the image you need in a folder named <code class="literal">Sprites</code> in folder <code class="literal">1362_03_01</code>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec97"/>How to do it...</h2></div></div></div><p>To flip an object horizontally with arrow key presses, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new Unity 2D project.</li><li class="listitem">Import the provided image <code class="literal">EnemyBug.png</code>.</li><li class="listitem">Drag an instance of the red <span class="strong"><strong>Enemy Bug</strong></span> image from the <span class="strong"><strong>Project | Sprites</strong></span> folder into the scene. Position this GameObject at (<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>) and scale to (<code class="literal">2</code>, <code class="literal">2</code>, <code class="literal">2</code>).</li><li class="listitem">Add an instance of C# script class <code class="literal">BugFlip</code> as a component to your <span class="strong"><strong>Enemy Bug</strong></span> GameObject:<div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class BugFlip : MonoBehaviour {
  private bool facingRight = true;

  void Update() {
    if (Input.GetKeyDown(KeyCode.LeftArrow) &amp;&amp; facingRight)
      Flip ();
    if (Input.GetKeyDown(KeyCode.RightArrow) &amp;&amp; !facingRight)
      Flip();
  }

  void Flip (){
    // Switch the way the player is labelled as facing.
    facingRight = !facingRight;

    // Multiply the player's x local scale by -1.
    Vector3 theScale = transform.localScale;
    theScale.x *= -1;
    transform.localScale = theScale;
  }
}</pre></div></li><li class="listitem">When you run your scene, pressing the <span class="emphasis"><em>Left</em></span> and <span class="emphasis"><em>Right</em></span> arrow keys should make the bug face left or right correspondingly.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec98"/>How it works...</h2></div></div></div><p>The C# class defines<a class="indexterm" id="id271"/> a Boolean variable <code class="literal">facingRight</code>, which stores a <code class="literal">true</code>/<code class="literal">false</code> value corresponding to whether or not the bug is facing right or not. Since our bug sprite is initially facing right, then we set the initial value of <code class="literal">facingRight</code> to true to match this.</p><p>Method <code class="literal">Update()</code>, every frame, checks to see if the <span class="emphasis"><em>Left</em></span> or <span class="emphasis"><em>Right</em></span> arrow keys have been pressed. If the <span class="emphasis"><em>Left</em></span> arrow key is pressed and the bug is facing right, then method <code class="literal">Flip()</code> is called, likewise if the <span class="emphasis"><em>Right</em></span> arrow key is pressed and the bug is facing left (that is, facing right is false), again method <code class="literal">Flip()</code> is called.</p><p>Method <code class="literal">Flip()</code> performs two actions, the first simply reverses the true/false value in variable <code class="literal">facingRight</code>. The second action changes the <span class="strong"><strong>+</strong></span>/<span class="strong"><strong>-</strong></span> sign of the X-value of the <code class="literal">localScale</code> property of the transform. Reversing the sign of the <code class="literal">localScale</code> results in the 2D flip that we<a class="indexterm" id="id272"/> desire. Look inside the <code class="literal">PlayerControl</code> script for the <span class="strong"><strong>BeanMan</strong></span> character in the next recipe – you'll see exactly the same <code class="literal">Flip()</code> method being used.</p></div></div>
<div class="section" title="Animating body parts for character movement events"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec39"/>Animating body parts for character movement events</h1></div></div></div><p>In this recipe, we'll<a class="indexterm" id="id273"/> learn to animate the hat of the Unity bean-man character in response to a jump event.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec99"/>Getting ready</h2></div></div></div><p>For this recipe, we have prepared the files you need in folder <code class="literal">1362_03_02</code>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec100"/>How to do it...</h2></div></div></div><p>To animate body parts for character movement events, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new Unity 2D project.</li><li class="listitem">Import the provided package <code class="literal">BeanManAssets</code>, by choosing menu: <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Import Package</strong></span> | <span class="strong"><strong>Custom Package …</strong></span>, and then click the <span class="strong"><strong>Import</strong></span> button to import all these assets into your <span class="strong"><strong>Project</strong></span> panel.</li><li class="listitem">Increase the size of the <span class="strong"><strong>Main Camera</strong></span> to <code class="literal">10</code>.</li><li class="listitem">Let's setup the 2D gravity setting for this project – we'll use the same setting as from Unity's 2D platform tutorial, a setting of Y= <code class="literal">-30</code>. Set 2D gravity to this value by choosing menu: <span class="strong"><strong>Edit</strong></span> | <span class="strong"><strong>Project Settings</strong></span> | <span class="strong"><strong>Physics 2D</strong></span>, and then at the top change the Y value to <code class="literal">-30</code>.</li><li class="listitem">Drag an instance of the BeanMan <span class="strong"><strong>character2D</strong></span> from the <span class="strong"><strong>Project</strong></span> | <span class="strong"><strong>Prefabs</strong></span> folder into the scene. Position this GameObject at (<code class="literal">0</code>, <code class="literal">3</code>, <code class="literal">0</code>).</li><li class="listitem">Drag an instance of the sprite <span class="strong"><strong>platformWallBlocks</strong></span> from the <span class="strong"><strong>Project</strong></span> | <span class="strong"><strong>Sprites</strong></span> folder into the scene. Position this GameObject at (<code class="literal">0</code>, <code class="literal">-4</code>, <code class="literal">0</code>).</li><li class="listitem">Add a <span class="strong"><strong>Box Collider 2D</strong></span> component to GameObject <span class="strong"><strong>platformWallBlocks</strong></span> by choosing menu: <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>Physics 2D</strong></span> | <span class="strong"><strong>Box Collider 2D</strong></span>.</li><li class="listitem">We now have a stationary platform that the player can land upon, and walk left and right on. Create a new <span class="strong"><strong>Layer</strong></span> named <span class="strong"><strong>Ground</strong></span>, and assign GameObject<span class="strong"><strong> platformWallBlocks</strong></span> to this new layer, as shown in the following screenshot. Pressing the <span class="emphasis"><em>Space</em></span> key when the character is on the platform will now make him jump.<div class="mediaobject"><img alt="How to do it..." src="graphics/1362OT_03_05.jpg"/></div></li><li class="listitem">Currently the<a class="indexterm" id="id274"/> BeanMan character is animated (arms and legs moving) when we make him jump. Let's remove the Animation clips and Animator controller and create our own from scratch. Delete folders Clips and Controllers from <span class="strong"><strong>Project</strong></span> | <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>PotatoMan2DAssets</strong></span> | <span class="strong"><strong>Character2D</strong></span> | <span class="strong"><strong>Animation</strong></span>, as shown:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362OT_03_22.jpg"/></div></li><li class="listitem">Let's create an Animation clip (and its associated Animator controller) for our hero character. In the Hierarchy panel select GameObject <span class="strong"><strong>hero</strong></span>. Ensuring GameObject <span class="strong"><strong>character2D</strong></span> is selected in the <span class="strong"><strong>Hierarchy</strong></span>, open the <span class="strong"><strong>Animation</strong></span> panel, and ensure it is in <span class="strong"><strong>Dope Sheet</strong></span> view (this is the default).</li><li class="listitem">Click the empty dropdown menu in the <span class="strong"><strong>Animation</strong></span> panel (next to the greyed out word <code class="literal">Samples</code>), and choose menu item <span class="strong"><strong>[Create New Clip]</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362OT_03_06.jpg"/></div></li><li class="listitem">Save the new clip in the<span class="strong"><strong> Character2D</strong></span> | <span class="strong"><strong>Animation</strong></span> folder, naming it as <span class="strong"><strong>character-beanman-idle</strong></span>. You've now created an Animation clip for the 'idle' character state (which is not animated).<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note28"/>Note</h3><p>Your final game may end up with tens, or even hundreds, of animation clips. Make things easy to search by prefixing the names of clips with object type, name, and then description of the animation clip.</p></div></div></li><li class="listitem">Looking at the <span class="strong"><strong>Character2D</strong></span> | <span class="strong"><strong>Animation</strong></span> folder in the Project panel you should now see<a class="indexterm" id="id275"/> both the Animation clip you have just created (<span class="strong"><strong>character-beanman-idle</strong></span>) and also a new Animator controller, which has defaulted to the name of your GameObject <span class="strong"><strong>character2D</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362OT_03_23.jpg"/></div></li><li class="listitem">Ensuring GameObject <span class="strong"><strong>character2D</strong></span> is selected in the <span class="strong"><strong>Hierarchy</strong></span>, open the <span class="strong"><strong>Animator</strong></span> panel and you'll see the State Machine for controlling the animation of our character. Since we only have one Animation clip (<span class="strong"><strong>character-beanman-idle</strong></span>) then upon entry the State Machine immediately enters this state.<div class="mediaobject"><img alt="How to do it..." src="graphics/1362OT_03_24.jpg"/></div></li><li class="listitem">Run your scene – since the character is always in the 'idle' state, we see no animation yet when we make it jump.</li><li class="listitem">Now we'll create a 'jump' Animation clip which animates the hat. Click the empty dropdown menu in the <span class="strong"><strong>Animation</strong></span> panel (next to the greyed out word 'Samples'), and <a class="indexterm" id="id276"/>create a new clip in your <span class="strong"><strong>Animation</strong></span> folder, naming it <span class="strong"><strong>character-beanman-jump</strong></span>.</li><li class="listitem">Click button <span class="strong"><strong>Add Property</strong></span>, and chose <span class="strong"><strong>Transform</strong></span> | <span class="strong"><strong>Position</strong></span> of the <span class="strong"><strong>hat</strong></span> child object, by clicking its '<span class="strong"><strong>+</strong></span>' plus-sign button. We are now recording changes to the (X, Y, Z) position of GameObject <span class="strong"><strong>hat</strong></span> in this animation clip:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362OT_03_25.jpg"/></div></li><li class="listitem">You should now see 2 'keyframes' at 0.0 and at 1.0. These are indicated by diamonds in the <span class="strong"><strong>Timeline</strong></span> area in the right-hand-section of the <span class="strong"><strong>Animation</strong></span> panel.</li><li class="listitem">Click to select the first keyframe (at time 0.0). Now in the <span class="strong"><strong>Scene</strong></span> panel move the hat up and left a little, away from the head. You should see that all three X, Y, Z values have a red background in the <span class="strong"><strong>Inspector</strong></span> – this is to inform you that the values of the <span class="strong"><strong>Transform</strong></span> component are being recorded in the animation clip:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362OT_03_26.jpg"/></div></li><li class="listitem">Since 1 second is perhaps too long for our jump animation, drag the second keyframe<a class="indexterm" id="id277"/> diamond to the left to a time of 0.5.</li><li class="listitem">We now need to define when the character should Transition from the 'idle' state to the 'jump' state. In the <span class="strong"><strong>Animator</strong></span> panel select state <span class="strong"><strong>character-beanman-idle</strong></span>, and create a transition to the state <span class="strong"><strong>character-beanman-jump</strong></span> by right-mouse-clicking and choosing menu Make Transition, then drag the transition arrow to state <span class="strong"><strong>character-beanman-jump</strong></span>, as shown:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362OT_03_27.jpg"/></div></li><li class="listitem">Now let's add a Trigger parameter named 'Jump', by clicking on the add parameter plus-sign "<span class="strong"><strong>+</strong></span>" button at the top-left of the <span class="strong"><strong>Animator</strong></span> panel, choosing<a class="indexterm" id="id278"/> <span class="strong"><strong>Trigger</strong></span>, and typing the name <span class="strong"><strong>Jump</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362OT_03_28.jpg"/></div></li><li class="listitem">We can now define the properties for when our character should <span class="strong"><strong>Transition</strong></span> from idle to jump. Click the Transition arrow to select it, and set the following 4 properties in the <span class="strong"><strong>Inspector</strong></span> panel:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Has Exit Time</strong></span>: uncheck</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Transition Duration</strong></span>: <code class="literal">0.01</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Interruption State</strong></span>: <code class="literal">Current State</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Conditions</strong></span>: Add <code class="literal">Jump</code> (click plus-sign '<code class="literal">+</code>' button at bottom)</li></ul></div><div class="mediaobject"><img alt="How to do it..." src="graphics/1362OT_03_29.jpg"/></div></li><li class="listitem">Save and run your scene. Once the character has landed on the platform and you press the <span class="emphasis"><em>SPACE</em></span> key to jump, you'll now see the character's hat jump away from his head, and slowly move back. Since we haven't added any transition to ever leave the Jump state, this Animation clip will loop, so the hat keeps on moving even when the jump is completed.</li><li class="listitem">In the Animator <a class="indexterm" id="id279"/>panel select state <span class="strong"><strong>character-beanman-jump</strong></span> and add a new Transition back to state <span class="strong"><strong>character-beanman-idle</strong></span>. Select this Transition arrow and in the Inspector panel sets its properties as follows:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Has Exit Time</strong></span>: (leave as checked)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Exit time</strong></span>: <code class="literal">0.5</code> (this needs to be the same time value as the second keyfame of our Jump animation clip)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Transition Duration</strong></span>: <code class="literal">0.01</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Interruption State</strong></span>: <code class="literal">Current State</code></li></ul></div></li><li class="listitem">Save and run your scene. Now when you jump the hat should animate once, after which the character immediately returns to its Idle state.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec101"/>How it works...</h2></div></div></div><p>You have added an Animation controller State Machine to GameObject <span class="strong"><strong>character2D</strong></span>. The two Animation clips you created (idle and jump) appear as States in the Animator panel. You created a Transition from Idle to Jump when the 'Jump' Trigger parameter is received by the State Machine. You created a second Transition, which transitions back to the Idle state after waiting 0.5 seconds (the same duration between the 2 keyframes in our Jump Animation clip).</p><p>Note that the key to everything working for the bean-man character is that when we make the character jump with the <span class="emphasis"><em>SPACE</em></span> key, then code in the <code class="literal">PlayerControl</code> C# scripted component of GameObject<span class="strong"><strong> character2D</strong></span>, as well as making the sprite move upwards on screen, also sends a <code class="literal">SetTrigger(…)</code> message to the Animator controller component, for the <span class="strong"><strong>Trigger</strong></span> named <span class="strong"><strong>Jump</strong></span>.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note29"/>Note</h3><p>The difference between a <span class="strong"><strong>Boolean</strong></span> Parameter and a <span class="strong"><strong>Trigger</strong></span> is that a <span class="strong"><strong>Trigger</strong></span> is temporality set to <code class="literal">True</code> and once the <code class="literal">SetTrigger(…)</code> event has been 'consumed' by a state transition it automatically returns to being <code class="literal">False</code>. So Triggers are useful for actions we wish to do once and then revert to a previous state. A <span class="strong"><strong>Boolean</strong></span> Parameter is a variable, which can have its value set to true/or <code class="literal">False</code> at different times during the game, and so different Transitions can be created to fire depending on the value of the variable at any time. Note that <span class="strong"><strong>Boolean</strong></span> parameters have to have their values explicitly set back to <code class="literal">False</code> with a <code class="literal">SetBool(…)</code>.</p></div></div><p>The following screenshot highlights the line of code that sends the <code class="literal">SetTrigger(…)</code> message:</p><div class="mediaobject"><img alt="How it works..." src="graphics/1362OT_03_30.jpg"/></div><p>
<span class="strong"><strong>State Machines</strong></span> for animations of a range of motions (running/walking/jumping/falling/dying and so on.) will have more states and transitions. The Unity-provided<a class="indexterm" id="id280"/> bean-man character has a more complex <span class="strong"><strong>State Machine</strong></span>, and more complex animations (of hands and feet, and eyes and hat and so on, for each <span class="strong"><strong>Animation</strong></span> clip), which you may find useful to explore.</p><p>Learn more about the <a class="indexterm" id="id281"/>Animation view on the Unity Manual web pages at <a class="ulink" href="http://docs.unity3d.com/Manual/AnimationEditorGuide.html">http://docs.unity3d.com/Manual/AnimationEditorGuide.html</a>.</p></div></div>
<div class="section" title="Creating a 3-frame animation clip to make a platform continually animate"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec40"/>Creating a 3-frame animation clip to make a platform continually animate</h1></div></div></div><p>In this recipe, we'll make<a class="indexterm" id="id282"/> a wooden-looking platform continually animate, moving upwards and downwards. This can be achieved with a single, 3-frame, animation clip (starting at top, position at bottom, top position again).</p><div class="mediaobject"><img alt="Creating a 3-frame animation clip to make a platform continually animate" src="graphics/1362OT_03_02.jpg"/></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec102"/>Getting ready</h2></div></div></div><p>This recipe builds on the previous one, so make a copy of that project, and work on the copy for this recipe.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec103"/>How to do it...</h2></div></div></div><p>To create a continually<a class="indexterm" id="id283"/> moving animated platform, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Drag an instance of the sprite <span class="strong"><strong>platformWoodBlocks</strong></span> from the <span class="strong"><strong>Project | Sprites</strong></span> folder into the scene. Position this GameObject at (<code class="literal">-4</code>, <code class="literal">-5</code>, <code class="literal">0</code>), so that these wood blocks are neatly to left, and slightly below, the wall blocks platform.</li><li class="listitem">Add a Box Collider 2D component to GameObject <span class="strong"><strong>platformWoodBlocks</strong></span> so that the player's character can stand on this platform too. Choose menu: <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>Physics 2D</strong></span> | <span class="strong"><strong>Box Collider 2D</strong></span>.</li><li class="listitem">Create a new folder named <code class="literal">Animations</code>, in which to store the animation clip and controller we'll create next.</li><li class="listitem">Ensuring GameObject <span class="strong"><strong>platformWoodBlocks</strong></span> is still selected in the <span class="strong"><strong>Hierarchy</strong></span>, open an <span class="strong"><strong>Animation</strong></span> panel, and ensure it is in <span class="strong"><strong>Dope Sheet</strong></span> view (this is the default).</li><li class="listitem">Click the empty dropdown menu in the <span class="strong"><strong>Animation</strong></span> panel (next to the greyed out word 'Samples'), and choose menu item <span class="strong"><strong>[Create New Clip]</strong></span>.</li><li class="listitem">Save the new clip in your <span class="strong"><strong>Animations</strong></span> folder, naming it '<span class="strong"><strong>platform-wood-moving-up-down</strong></span>'.</li><li class="listitem">Click button <span class="strong"><strong>Add Curve</strong></span>, and chose <span class="strong"><strong>Transform</strong></span> and the click the '<span class="strong"><strong>+</strong></span>' plus-sign by <span class="strong"><strong>Position</strong></span>. We are now recording changes to the (X, Y, Z) position of GameObject <span class="strong"><strong>platformWoodBlocks</strong></span> in this animation clip.</li><li class="listitem">You should now see 2 'keyframes' at 0.0 and at 1.0. These are indicated by diamonds in the <span class="strong"><strong>Timeline</strong></span> area in the right-hand-section of the <span class="strong"><strong>Animation</strong></span> panel.</li><li class="listitem">We need 3 keyframes, with the new one at <span class="strong"><strong>2:00</strong></span> seconds. Click at <span class="strong"><strong>2:00</strong></span> in the Timeline along the top of the <span class="strong"><strong>Animation</strong></span> panel, so that the red line for the current playhead time is at time 2:00. Then click diamond+ button to create a new keyframe at the current playhead time:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362OT_03_08.jpg"/></div></li><li class="listitem">The first and third keyframes are fine – they record the current height of the wood platform at Y= <code class="literal">-5</code>. We need to make the middle keyframe record the height <a class="indexterm" id="id284"/>of the platform at the top of its motion, and Unity in-betweening will do all the rest of the animation work for us. Select the middle keyframe (at time 1:00), by clicking on either diamond at time 1:00 (they should both turn blue, and the red playhead vertical line should move to 1:00, to indicate the middle keyframe is being edited).</li><li class="listitem">Now in the <span class="strong"><strong>Inspector</strong></span> change the Y position of the platform to 0. You should see that all three X, Y, Z values have a red background in the <span class="strong"><strong>Inspector</strong></span> – this is to inform you that the values of the <span class="strong"><strong>Transform</strong></span> component are being recorded in the animation clip.</li><li class="listitem">Save and run your scene. The wooden platform should now be animating continuously, moving smoothly up and down the positions we setup.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec104"/>How it works...</h2></div></div></div><p>You have added an animation to GameObject <span class="strong"><strong>platformWoodBlocks</strong></span>. This animation contains three keyframes. A keyframe represents the values of properties of the object at a point in time. The first keyframe stores a Y-value of -4, the second keyframe a Y-value of 0, and the final keyframe -4 again. Unity calculates all the in-between values for us, and the result is a smooth animation of the Y-position of the platform.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note30"/>Note</h3><p>Note: If we wanted to duplicate the moving platform, first we'd need to create a new, empty GameObject named movingBlockParent, and then parent platformWoodBlocks to this GameObject. Duplicating GameObject movingBlockParent would then allow us to create more moving blocks in our scene. If we simply duplicated platformWoodBlocks directly, then when the scene runs each duplicate would be animated back to the location of the original animation frames (that is, all copies would be positioned and moving in the original location).</p></div></div></div></div>
<div class="section" title="Making a platform start falling once stepped-on using a Trigger to move animation from one state to another"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec41"/>Making a platform start falling once stepped-on using a Trigger to move animation from one state to another</h1></div></div></div><p>In many cases we don't wish an animation to begin until some condition has been met, or some event occurred. In these cases a good way to organize the Animator Controller is to have two animation states (clips) and a Trigger on the Transition between the clips. We use code to detect when <a class="indexterm" id="id285"/>we wish the animation to start playing, and at that time we send the Trigger message to the Animation Controller, causing the transition to start.</p><p>In this recipe we'll <a class="indexterm" id="id286"/>create a water platform block in our 2D platform game; such blocks will begin to slowly fall down the screen as soon as they have been stepped on, and so the player must keep on moving otherwise they'll fall down the screen with the blocks too! It looks as shown in the following screenshot:</p><div class="mediaobject"><img alt="Making a platform start falling once stepped-on using a Trigger to move animation from one state to another" src="graphics/1362OT_03_01.jpg"/></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec105"/>Getting ready</h2></div></div></div><p>This recipe builds on the previous one, so make a copy of that project, and work on the copy for this recipe.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec106"/>How to do it...</h2></div></div></div><p>To construct an animation that only plays once a Trigger has been received, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the <span class="strong"><strong>Hierarchy</strong></span> create an <span class="strong"><strong>Empty</strong></span> GameObject named <span class="strong"><strong>water-block-container</strong></span>, positioned at (<code class="literal">2.5</code>, <code class="literal">-4, 0</code>). This empty GameObject will allow us to make duplicates of animated Water Blocks that will animate relative to their parent GameObject position.</li><li class="listitem">Drag an instance of the sprite <span class="strong"><strong>Water Block</strong></span> from the <span class="strong"><strong>Project</strong></span> | <span class="strong"><strong>Sprites</strong></span> folder into the scene and child it to GameObject <span class="strong"><strong>water-block-container</strong></span>. Ensure the position of your new child GameObject <span class="strong"><strong>Water Block</strong></span> is (<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>), so that it appears neatly to right of the wall blocks platform, as shown in the following screenshot:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362OT_03_09.jpg"/></div></li><li class="listitem">Add a <span class="strong"><strong>Box Collider 2D</strong></span> component to child GameObject <span class="strong"><strong>Water Block</strong></span>, and set the layer of this GameObject to <span class="strong"><strong>Ground</strong></span>, so that the player's character can stand and jump <a class="indexterm" id="id287"/>on this water block platform.</li><li class="listitem">Ensuring<a class="indexterm" id="id288"/> child GameObject <span class="strong"><strong>Water Block</strong></span> is selected in the <span class="strong"><strong>Hierarchy</strong></span>, open an <span class="strong"><strong>Animation</strong></span> panel, then create a new clip named <span class="strong"><strong>platform-water-up</strong></span>. saving it in your <code class="literal">Animations</code> folder.</li><li class="listitem">Click button <span class="strong"><strong>Add Curve</strong></span>, and chose <span class="strong"><strong>Transform</strong></span> and <span class="strong"><strong>Position</strong></span>.</li><li class="listitem">Delete the second keyframe at time <span class="strong"><strong>1:00</strong></span>. You have now completed the creation of the water block up animation clip.</li><li class="listitem">Create a second Animation clip, named <span class="strong"><strong>platform-water-down</strong></span>. Again, click button <span class="strong"><strong>Add Curve</strong></span>, and chose <span class="strong"><strong>Transform</strong></span> and <span class="strong"><strong>Position</strong></span>, and delete the second keyframe at time <span class="strong"><strong>1:00</strong></span>.</li><li class="listitem">With the first keyframe at time <span class="strong"><strong>0:00</strong></span> selected, set the Y-value of the GameObjects Transform Position to <code class="literal">-5</code>. You have now completed the creation of the water block down animation clip, so you can click the red record button to stop recording.</li><li class="listitem">You may have noticed that as well as the up/down <span class="strong"><strong>Animation Clips</strong></span> that you created, another file was created in your <code class="literal">Animations</code> folder, an <span class="strong"><strong>Animator Controller</strong></span> named <span class="strong"><strong>Water Block</strong></span>. Select this file and open the <span class="strong"><strong>Animator</strong></span> panel, to see and edit the State Machine diagram:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362OT_03_10.jpg"/></div></li><li class="listitem">Currently, although we created 2 animation clips (states), only the <span class="strong"><strong>Up</strong></span> state is ever active. This is because when the scene begins (Entry) the object will immediately go in state <span class="strong"><strong>platform-water-up</strong></span>, but since there are no transition arrows from this state to <span class="strong"><strong>platform-water-down</strong></span>, then at present the <span class="strong"><strong>Water Block</strong></span> GameObject will always be in its <span class="strong"><strong>Up</strong></span> state.</li><li class="listitem">Ensure<a class="indexterm" id="id289"/> state <span class="strong"><strong>platform-water-up</strong></span> is selected (it will have a blue border around it), and create a Transition (arrow) to state <span class="strong"><strong>platform-water-down</strong></span>, by choosing <span class="strong"><strong>Make Transition</strong></span> from the <span class="strong"><strong>mouse-right-click</strong></span> menu.</li><li class="listitem">If you run the scene now, the default <span class="strong"><strong>Transition</strong></span> settings are that after 0.9 seconds the <span class="strong"><strong>Water Blocks</strong></span> will transition into their <span class="strong"><strong>Down</strong></span> state. We don't want this – we only want them to animate downwards after the player has walked onto<a class="indexterm" id="id290"/> them. So create a <span class="strong"><strong>Trigger</strong></span> named <span class="strong"><strong>Fall</strong></span>, by choosing the <span class="strong"><strong>Parameters</strong></span> tab in the <span class="strong"><strong>Animator</strong></span> panel, clicking the plus '<span class="strong"><strong>+</strong></span>' button and selecting <span class="strong"><strong>Trigger</strong></span>, and then selecting <span class="strong"><strong>Fall</strong></span>.</li><li class="listitem">Do the following to create our Trigger:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">In the <span class="strong"><strong>Animator</strong></span> panel select the <span class="strong"><strong>Transition</strong></span></li><li class="listitem" style="list-style-type: disc">In the <span class="strong"><strong>Inspector</strong></span> panel uncheck the <span class="strong"><strong>Has Exit Time</strong></span> option</li><li class="listitem" style="list-style-type: disc">In the <span class="strong"><strong>Inspector</strong></span> panel drag the Transition end time to <span class="strong"><strong>2:00</strong></span> seconds (so the Water Block slowly Transitions to its Down state over a period of 2 seconds)</li><li class="listitem" style="list-style-type: disc">In the <span class="strong"><strong>Inspector</strong></span> panel click the plus '<span class="strong"><strong>+</strong></span>' button to add a <span class="strong"><strong>Condition</strong></span>, which should automatically suggest the only possible condition parameter, which is our <span class="strong"><strong>Trigger Fall</strong></span>.</li></ul></div><div class="mediaobject"><img alt="How to do it..." src="graphics/1362OT_03_12.jpg"/></div></li><li class="listitem">We now<a class="indexterm" id="id291"/> need to add a collider trigger just above the Water Block, and add C# script behavior to send the <span class="strong"><strong>Animator Controller Trigger</strong></span> when the player enters<a class="indexterm" id="id292"/> the collider. Ensuring child GameObject <span class="strong"><strong>Water Block</strong></span> is selected, add a (second) <span class="strong"><strong>2D Box Collider</strong></span>, with a Y-Offset of <span class="strong"><strong>1</strong></span>, and tick its <span class="strong"><strong>Is Trigger</strong></span> checkbox:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362OT_03_13.jpg"/></div></li><li class="listitem">Add an instance of C# script class <code class="literal">WaterBlock</code> as a component to your <span class="strong"><strong>Water Block</strong></span> child GameObject:<div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class WaterBlock : MonoBehaviour {
  private Animator animatorController;

  void Start(){
    animatorController = GetComponent&lt;Animator&gt;();
  }

  void OnTriggerEnter2D(Collider2D hit){
    if(hit.CompareTag("Player")){
      animatorController.SetTrigger("Fall");
    }
  }
}</pre></div></li><li class="listitem">Make 6 more copies of GameObject <span class="strong"><strong>water-block-container</strong></span>, with X positions increasing by 1 each time, that is, <code class="literal">3.5</code>, <code class="literal">4.5</code>, <code class="literal">5.5</code>, and so on.</li><li class="listitem">Run the scene, and as the player's character runs across each water block they will start falling down, so he had better keep running!</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec107"/>How it works...</h2></div></div></div><p>You created a two-state <a class="indexterm" id="id293"/><span class="strong"><strong>Animator Controller</strong></span> state machine. Each state was an <span class="strong"><strong>Animation Clip</strong></span>. You created a <span class="strong"><strong>Transition</strong></span> from the <span class="strong"><strong>Water Block</strong></span> Up state to its Down state that will take place when the Animator Controller received a Fall Trigger message. You created a <span class="strong"><strong>Box Collider 2D</strong></span> with a <span class="strong"><strong>Trigger</strong></span>, so that <a class="indexterm" id="id294"/>scripted component WaterBlock could be detected when the player (tagged <span class="strong"><strong>Player</strong></span>) enters its collider, and at that point send the <span class="strong"><strong>Fall</strong></span> Trigger message to make the <span class="strong"><strong>Water Block</strong></span> GameObject start gently Transitioning into its Down state further down the screen.</p><p>Learn more about the <a class="indexterm" id="id295"/>Animator Controllers on the Unity Manual web pages at <a class="ulink" href="http://docs.unity3d.com/Manual/class-AnimatorController.html">http://docs.unity3d.com/Manual/class-AnimatorController.html</a>.</p></div></div>
<div class="section" title="Creating animation clips from sprite sheet sequences"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec42"/>Creating animation clips from sprite sheet sequences</h1></div></div></div><p>The traditional method of animation involved hand-drawing many images, each slightly different, which<a class="indexterm" id="id296"/> displayed quickly frame-by-frame to<a class="indexterm" id="id297"/> give the appearance of movement. For computer game animation, the term Sprite Sheet is given to the image file that contains one or more sequences of sprite frames. Unity provides tools to breakup individual sprite images in large sprite sheet files, so that individual frames, or sub-sequences of frames can be used to create Animation Clips that can become States in Animator Controller State Machines. In this recipe, we'll import and break up an open source monster sprite sheet into three animation clips for Idle, Attack, and Death that looks as shown:</p><div class="mediaobject"><img alt="Creating animation clips from sprite sheet sequences" src="graphics/1362OT_03_17.jpg"/></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec108"/>Getting ready</h2></div></div></div><p>For all the<a class="indexterm" id="id298"/> recipes in this chapter, we have<a class="indexterm" id="id299"/> prepared the sprite images you need in folder <code class="literal">1362_03_05</code>. Many thanks to Rosswet Mobile for making these sprites available as Open Source at: <a class="ulink" href="http://www.rosswet.com/wp/?p=156">http://www.rosswet.com/wp/?p=156</a>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec109"/>How to do it...</h2></div></div></div><p>To create an animation from a sprite sheet of frame-by-frame animation images, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new Unity 2D project.</li><li class="listitem">Import the provided image <code class="literal">monster1</code>.</li><li class="listitem">With image <code class="literal">monster1</code> selected in the <span class="strong"><strong>Project</strong></span> panel, change its <span class="strong"><strong>Sprite</strong></span> mode to <span class="strong"><strong>Multiple</strong></span> in the <span class="strong"><strong>Inspector</strong></span>, then open the <span class="strong"><strong>Sprite Editor</strong></span> panel by clicking button <span class="strong"><strong>Sprite Editor</strong></span>.</li><li class="listitem">In the <span class="strong"><strong>Sprite Editor</strong></span> open the <span class="strong"><strong>Slice</strong></span> dropdown dialog, set the <span class="strong"><strong>Type</strong></span> to <span class="strong"><strong>Grid</strong></span>, set the grid <span class="strong"><strong>Pixel Size</strong></span> to <span class="strong"><strong>64x64</strong></span>, and then click the <span class="strong"><strong>Slice</strong></span> button. Finally, click the <span class="strong"><strong>Apply</strong></span> button in the bar at the top right of the <span class="strong"><strong>Sprite Editor</strong></span> panel):<div class="mediaobject"><img alt="How to do it..." src="graphics/1362OT_03_18.jpg"/></div></li><li class="listitem">In the <span class="strong"><strong>Project</strong></span> panel you can now click the expand triangle button center-right on the<a class="indexterm" id="id300"/> sprite, and you'll see all the different child frames for this sprite.<div class="mediaobject"><img alt="How to do it..." src="graphics/1362OT_03_19.jpg"/></div></li><li class="listitem">Create a folder named <code class="literal">Animations</code>.</li><li class="listitem">In your new folder, create an <span class="strong"><strong>Animator Controller</strong></span> named <span class="strong"><strong>monster-animator</strong></span>.</li><li class="listitem">In the <a class="indexterm" id="id301"/>scene create a new <span class="strong"><strong>Empty</strong></span> GameObject named <span class="strong"><strong>monster1</strong></span> (at position <code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>), and drag your <span class="strong"><strong>monster-animator</strong></span> into this GameObject.</li><li class="listitem">With GameObject <span class="strong"><strong>monster1</strong></span> selected in the <span class="strong"><strong>Hierarchy</strong></span>, open up the <span class="strong"><strong>Animation</strong></span> panel, and create a new <span class="strong"><strong>Animation Clip</strong></span> named <span class="strong"><strong>Idle</strong></span>.</li><li class="listitem">Select image <code class="literal">monster1</code> in the <span class="strong"><strong>Project</strong></span> panel (in its expanded view), and select and drag the first 5 frames (frames 0-4) into the <span class="strong"><strong>Animation</strong></span> panel. Change the sample rate to 12 (since this animation was created to run at 12-frames per second).<div class="mediaobject"><img alt="How to do it..." src="graphics/1362OT_03_20.jpg"/></div></li><li class="listitem">If you look at the State Chart for <span class="strong"><strong>monster-animator</strong></span>, you'll see it has a default state (clip) named monster-idle.</li><li class="listitem">When you run your scene you should now see the <span class="strong"><strong>monster1</strong></span> GameObject animating in its monster-idle state. You may wish to make the Main Camera size a bit smaller, since these are quite small sprites.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec110"/>How it works...</h2></div></div></div><p>Unity's Sprite Editor knows about sprite sheets, and once the correct grid size has been entered it<a class="indexterm" id="id302"/> treats the items in each grid square inside the sprite sheet image as an individual image, or frame, of the animation. You <a class="indexterm" id="id303"/>selected sub-sequences of sprite animation frames and added them into several <span class="strong"><strong>Animation Clips</strong></span>. You had added an <span class="strong"><strong>Animation Controller</strong></span> to your GameObject, and so each <span class="strong"><strong>Animation Clip</strong></span> appears as a state in the <span class="strong"><strong>Animation Controller State Machine</strong></span>.</p><p>You can now repeat the process, creating an <span class="strong"><strong>Animation Clip</strong></span> monster-attack with frames 8-12, and a third clip monster-death with frames 15-21. You would then create Triggers and <span class="strong"><strong>Transitions</strong></span> to make the monster GameObject transition into the appropriate <span class="strong"><strong>states</strong></span> as the game is played.</p><p>Learn more about<a class="indexterm" id="id304"/> the Unity Sprite Editor from the Unity video tutorials at <a class="ulink" href="https://unity3d.com/learn/tutorials/modules/beginner/2d/sprite-editor">https://unity3d.com/learn/tutorials/modules/beginner/2d/sprite-editor</a>.</p></div></div>
<div class="section" title="Conclusion"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec43"/>Conclusion</h1></div></div></div><p>In this chapter, we have introduced recipes demonstrating the animation system for 2D game elements. The bean-man 2D character is from the Unity 2D Platformer, which you can download yourself from the Unity asset store. That project is a good place to see lots more examples of 2D game and animation techniques (<a class="ulink" href="http://www.assetstore.unity3d.com/en/#!/content/11228">www.assetstore.unity3d.com/en/#!/content/11228</a>).</p><div class="mediaobject"><img alt="Conclusion" src="graphics/1362OT_03_03.jpg"/></div><p>Here are some links for useful resources and sources of information to explore these topics further:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Unity 2D <a class="indexterm" id="id305"/>Platformer (where the BeanMan character came from):<p>
<a class="ulink" href="https://www.assetstore.unity3d.com/en/#!/content/11228">https://www.assetstore.unity3d.com/en/#!/content/11228</a>
</p></li><li class="listitem" style="list-style-type: disc">The platform sprites are from Daniel Cook's Planet Cute game resources:<p>
<a class="ulink" href="http://www.lostgarden.com/2007/05/dancs-miraculously-flexible-game.html">http://www.lostgarden.com/2007/05/dancs-miraculously-flexible-game.html</a>
</p></li><li class="listitem" style="list-style-type: disc">Creating a <a class="indexterm" id="id306"/>basic 2D platformer game:<p>
<a class="ulink" href="https://www.unity3d.com/learn/tutorials/modules/beginner/live-training-archive/creating-a-basic-platformer-game">https://www.unity3d.com/learn/tutorials/modules/beginner/live-training-archive/creating-a-basic-platformer-game</a>
</p></li><li class="listitem" style="list-style-type: disc">Hat Catch 2D game tutorial:<p>
<a class="ulink" href="https://www.unity3d.com/learn/tutorials/modules/beginner/live-training-archive/2d-catch-game-pt1">https://www.unity3d.com/learn/tutorials/modules/beginner/live-training-archive/2d-catch-game-pt1</a>
</p></li><li class="listitem" style="list-style-type: disc">Unity games from a 2D perspective video:<p>
<a class="ulink" href="https://www.unity3d.com/learn/tutorials/modules/beginner/live-training-archive/introduction-to-unity-via-2d">https://www.unity3d.com/learn/tutorials/modules/beginner/live-training-archive/introduction-to-unity-via-2d</a>
</p></li><li class="listitem" style="list-style-type: disc">A fantastic set of modular 2D characters with a free Creative Commons license from 'Kenny'. These assets would be perfect for animating body parts in a similar way to the bean-man example in this chapter and in the Unity 2D platformer demo:<p>
<a class="ulink" href="http://kenney.nl/assets/modular-characters">http://kenney.nl/assets/modular-characters</a>
</p></li></ul></div></div></body></html>