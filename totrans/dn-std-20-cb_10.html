<html><head></head><body>
        

                            
                    <h1 class="header-title">Let’s Fine-Tune Our Library</h1>
                
            
            
                
<p class="mce-root">In this chapter, we will be looking at these recipes:</p>
<ul>
<li>Logging the library</li>
<li>Creating a .NET Core console application to use the library</li>
<li>Informing the end user – exception handling and error messages</li>
<li>Using Visual Studio 2017 diagnostics and debugging tools</li>
</ul>


            

            
        
    

        

                            
                    <h1 class="header-title">Technical requirements</h1>
                
            
            
                
<p>Readers should have a basic knowledge of C#. They should also have a basic knowledge of using Visual Studio, installing packages using NuGet, and referencing libraries within projects from other projects.</p>
<p class="mce-root">The code files for this chapter can be found on GitHub:<br/>
<a href="https://github.com/PacktPublishing/DotNET-Standard-2-Cookbook/tree/master/Chapter10/Chapter10.Logging">https://github.com/PacktPublishing/DotNET-Standard-2-Cookbook/tree/master/Chapter10/Chapter10.Logging</a></p>
<p class="mce-root">Check out the following video to see the code in action:<br/>
<a href="https://goo.gl/HNVQMh">https://goo.gl/HNVQMh</a></p>


            

            
        
    

        

                            
                    <h1 class="header-title">Introduction</h1>
                
            
            
                
<p>In this chapter, we will be looking at how to fine-tune our .NET Standard 2.0 library, how to create a log, and how to use the debugging tools available in Visual Studio 2017. We will also look at exception handling. Throughout previous chapters, we have been looking at how to build a library and its utilization. In this chapter, we are going to make that library good and solid.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">A library logs things itself</h1>
                
            
            
                
<p>In this recipe, we will be using a text log file to store details about how the library interacts with other programs. This is a good practice; to log things as you go. Then, you will be able to pinpoint errors and other important things, such as usage of the library.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>Make sure you have the latest version of Visual Studio 2017 installed on your system. Let's get started on our recipe.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>Open Visual Studio 2017.</li>
<li>Click File | New | Project<strong> </strong>to create a project. </li>
<li>In the New Project dialog box, expand the Other Project Types node in the left-hand pane and select Visual Studio Solutions. In the right-hand pane, select Blank Solution<strong>.</strong></li>
<li>In the Name: textbox, type <kbd>Chapter10.Logging</kbd>, and, in the Location: textbox, select a path from the drop-down box or click on the Browse... button to locate a path:</li>
</ol>
<div><img src="img/035fee47-ea1d-434a-973b-7147f337d760.png"/></div>
<ol start="5">
<li>Click OK.</li>
<li>Now, the Solution Explorer (<em>Ctrl</em> + <em>Alt</em> + <em>L</em>) should look like this:</li>
</ol>
<div><img class="alignnone size-full wp-image-957 image-border" src="img/e0c73bf8-203a-4665-a2fb-299609fb9714.png" style="width:19.92em;height:7.83em;"/></div>
<ol start="7">
<li>Now, right-click on the <kbd>Chapter10.Logging</kbd> label in the Solution Explorer and select Add | New Project.</li>
<li>In the New Project dialog box, expand the Visual C# node.</li>
<li>Select .NET Standard in the left-hand pane and Class Library (.NET Standard) in the right-hand pane:</li>
</ol>
<div><img class="alignnone size-full wp-image-958 image-border" src="img/bf0d9236-6a2b-4645-9551-4b9d862b980b.png" style="width:156.58em;height:108.08em;"/></div>
<ol start="10">
<li>In the Name: textbox, type <kbd>Chapter10.Logging.LogLib</kbd>, leave the other defaults as they are, and click OK:</li>
</ol>
<div><img src="img/ffa51c39-9f81-4f6f-8023-63c9812c63b5.png"/></div>
<ol start="11">
<li>Now, the Solution Explorer (<em>Ctrl</em> + <em>Alt</em> + <em>L</em>) should look like this:</li>
</ol>
<div><img class="alignnone size-full wp-image-959 image-border" src="img/c64bff24-6840-404c-97a2-1ab5aed72d0f.png" style="width:19.17em;height:11.50em;"/></div>
<ol start="12">
<li>Now, select <kbd>Class1.cs</kbd> in the Solution Explorer and press <em>F2</em> to rename the file <kbd>LoggerDemo.cs</kbd>.</li>
<li>Answer Yes in the confirmation dialog box that asks to rename the class name as well.</li>
<li>Double-click on the <kbd>LoggerDemo.cs</kbd> label in the Solution Explorer.</li>
<li>Let's scroll up in the code window and add the following <kbd>using</kbd> directive:</li>
</ol>
<pre>      using System.IO;</pre>
<ol start="16">
<li>Now, create two class-level variables to hold the filename and the <kbd>StreamWriter</kbd> class:</li>
</ol>
<pre>      private string logFileName = "lib_log.txt";<br/>      private StreamWriter logFile;</pre>
<ol start="17">
<li>Now, create the default constructor method as follows:</li>
</ol>
<pre>      public LoggerDemo()<br/>      {<br/>          WriteLog("Constructor Called.");<br/>      }</pre>
<ol start="18">
<li>Again, create this <kbd>private</kbd><strong> </strong>method to write log details to the file: </li>
</ol>
<pre>      private void WriteLog(string message)<br/>      {<br/>          if (!File.Exists(logFileName))<br/>          {<br/>              logFile = File.CreateText(logFileName);<br/>          }<br/>          else<br/>          {<br/>              logFile = File.AppendText(logFileName);<br/>          }<br/><br/>          logFile.WriteLine($"{DateTime.Now} Log Message: {message} ");<br/>          logFile.Close();<br/>      }</pre>
<ol start="19">
<li>Create these three <kbd>public</kbd> methods:</li>
</ol>
<pre>      public void CallMethod1()<br/>      {<br/>          WriteLog("Method 1 Called");<br/>      }<br/><br/>      public void CallMethod2()<br/>      {<br/>          WriteLog("Method 2 Called");<br/>      }<br/><br/>      public void CallMethod3()<br/>      {<br/>          WriteLog("Method 3 Called");<br/>      }</pre>
<ol start="20">
<li>Press <em>Ctrl</em> + <em>Shift</em> + <em>B</em> to build the solution.</li>
</ol>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>In steps 1 to 11, we created a blank solution and added a .NET Standard 2.0 library to the solution. In these steps, we assigned proper names to the solution and to the library. In steps 12 and 13, we renamed the existing <kbd>Class1.cs</kbd> created by Visual Studio. In step 15, we created a <kbd>using</kbd> directive to access the file operations.</p>
<p>In step 16, we created two <kbd>private</kbd> variables to hold the filename and the <kbd>StreamWriter</kbd> class. In step 17, we created the default constructor and we are calling the <kbd>WriteLog()</kbd> method we created in step 18. In step 19, we created three test methods to demonstrate logging. Finally, in step 20, we performed a quick build to check for syntax. </p>


            

            
        
    

        

                            
                    <h1 class="header-title">Creating a .NET Core console application to use the library</h1>
                
            
            
                
<p>In this recipe, we will be creating a .NET Core console application to use the library from the previous recipe. You can also try this recipe in macOS or Linux, since .NET Core is cross-platform.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>Make sure you have completed the previous recipe and that it builds successfully. Let's open the solution and get ready.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>Open Visual Studio 2017.</li>
<li>Now, open the solution from the previous recipe. Click File | Open | Open Project/Solution, or press <em>Ctrl</em> + <em>Shift</em> + <em>O</em>, and select the <kbd>Chapter10.Logging</kbd> solution. </li>
<li>Press <em>Ctrl</em> + <em>Shift</em> + <em>B</em> for a quick build to check that everything is fine. </li>
<li>Click on the <kbd>Chapter10.Logging</kbd> solution label. Click File | Add | New Project.</li>
<li>In the Add New Project template dialog box, expand the Visual C# node in the left-hand pane. </li>
<li>Select .NET Core and select Console App (.NET Core) in the right-hand pane:</li>
</ol>
<div><img class="alignnone size-full wp-image-960 image-border" src="img/6143722b-69f8-41ca-81b6-8003ecf900b2.png" style="width:156.58em;height:108.67em;"/></div>
<ol start="7">
<li>In the Name: textbox, type <kbd>Chapter10.Logging.LogCore</kbd> as the name of the project. The rest of the fields can be left as they are: </li>
</ol>
<div><img src="img/2e02cb5f-c6e7-409f-8156-61bb793dc548.png"/></div>
<ol start="8">
<li>Click OK.</li>
<li>Now, the Solution Explorer (press <em>Ctrl</em> + <em>Alt</em> + <em>L</em>) should look like this: </li>
</ol>
<div><img class="alignnone size-full wp-image-961 image-border" src="img/2cc47abf-74d8-4d9e-ac94-d2a7462391cb.png" style="width:17.92em;height:14.33em;"/></div>
<ol start="10">
<li>Right-click on the Dependencies label under <kbd>Chapter10.Logging.LogCore</kbd>.</li>
<li>Select Add Reference.</li>
<li>In the Reference Manager, click on the Projects label in the right-hand pane: </li>
</ol>
<div><img class="alignnone size-full wp-image-964 image-border" src="img/2b417b1b-aba3-47cc-891c-61e641442f6c.png" style="width:52.17em;height:19.83em;"/></div>
<ol start="13">
<li>Check the <kbd>Chapter10.Logging.LogLib</kbd><strong> </strong>project in the left-hand pane.</li>
<li>Click OK.</li>
<li>Now, double-click on the <kbd>Program.cs</kbd> label in the Solution Explorer.</li>
<li>Scroll up until you see the <kbd>using</kbd> directives.</li>
<li>Add the following reference next to the last line of <kbd>using</kbd> directives:</li>
</ol>
<pre>      using Chapter10.Logging.LogLib;</pre>
<ol start="18">
<li>Now, replace the existing code in the <kbd>Main()</kbd> method with this code:</li>
</ol>
<pre>      var logDemo = new LoggerDemo();<br/><br/>      Console.WriteLine("Executing method 1");<br/>      logDemo.CallMethod1();<br/><br/>      Console.WriteLine("Executing method 2");<br/>      logDemo.CallMethod2();<br/><br/>      Console.WriteLine("Executing method 3");<br/>      logDemo.CallMethod3();<br/><br/>      Console.WriteLine("Press ENTER to exit.");<br/>      Console.ReadLine();</pre>
<ol start="19">
<li>Press <em>F5</em> to debug the code.</li>
<li>You should see the following output:</li>
</ol>
<div><img class="alignnone size-full wp-image-963 image-border" src="img/5b57dfd9-1fd0-4de8-aafb-7db8a976a40a.png" style="width:16.83em;height:8.42em;"/></div>
<ol start="21">
<li>Press <em>Enter</em> to exit.</li>
<li>You will also see a <kbd>lib_log.txt</kbd> file created inside the <kbd>bin/Debug</kbd> folder (make sure you have clicked Show All Files):</li>
</ol>
<div><img class="alignnone size-full wp-image-965 image-border" src="img/678d390b-ab8c-4e1d-b32b-d80ac065ccb9.png" style="width:24.00em;height:28.25em;"/></div>
<ol start="23">
<li>The <kbd>lib_log.txt</kbd> file should have the following output:</li>
</ol>
<div><img class="alignnone size-full wp-image-966 image-border" src="img/3cf2b241-8e03-4898-be5e-32e05c5dff26.png" style="width:32.25em;height:8.42em;"/></div>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>In steps 1 to 10, we opened the solution from the previous recipe and added a .NET Core console application. In these steps, we gave it a proper name. In step 17, we added the code-level reference to the library. In step 18, we created the code inside the <kbd>Main</kbd> method. In the first line, we created an instance of the <kbd>LoggerDemo</kbd> class and stored it in a variable. In the next few lines, we executed the <kbd>public</kbd> methods of <kbd>CallMethod1()</kbd>, <kbd>CallMethod2()</kbd>, and <kbd>CallMethod3()</kbd>.</p>
<p>Finally, in steps 19 and 20, we executed the code and tested it. In steps 21 and 22, we investigated the text file created from the library.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Informing the end user – Exception handling and error messages</h1>
                
            
            
                
<p>In this recipe, we will be looking at exception handling inside a .NET class library. We will be reusing the same library created in the first recipe of this chapter.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>Make sure you have completed the two recipes from this chapter. Open the solution and perform a quick build to check that everything is fine and compiles well.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>Open Visual Studio 2017.</li>
<li>Now, open the solution from the previous recipe. Click File | Open | Open Project/Solution, or press <em>Ctrl</em> + <em>Shift</em> + <em>O</em>, and select the <kbd>Chapter10.Logging</kbd> solution. </li>
<li>Press <em>Ctrl</em> + <em>Shift</em> + <em>B</em> for a quick build to check that everything is fine. </li>
</ol>
<ol start="4">
<li>The Solution Explorer should look like this:</li>
</ol>
<div><img class="alignnone size-full wp-image-967 image-border" src="img/0e30766f-9714-4c11-8b94-6466e21015f8.png" style="width:19.08em;height:15.67em;"/></div>
<ol start="5">
<li>Now, double-click on the <kbd>LoggerDemo.cs</kbd> label to open the code window.</li>
<li>Scroll down until you reach the <kbd>WriteLog()</kbd> method.</li>
<li>Replace the current code with the following:</li>
</ol>
<pre>      try<br/>      {<br/>          if (!File.Exists(logFileName))<br/>          {<br/>              logFile = File.CreateText(logFileName);<br/>          }<br/>          else<br/>          {<br/>              logFile = File.AppendText(logFileName);<br/>          }<br/><br/>          logFile.WriteLine($"{DateTime.Now} Log Message: {message} ");<br/>      }<br/>      catch (FileNotFoundException)<br/>      {<br/>          //Cannot find the file you are looking for<br/>      }<br/>      catch (Exception ex)<br/>      {<br/>          //Catch any exception <br/>      }<br/>      finally<br/>      {<br/>          logFile.Close(); <br/>      }</pre>
<ol start="8">
<li> Now, click on the .NET Core console application project and press <em>F5</em> to test.</li>
</ol>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>In steps 1 to 5, we opened the existing solution. In step 7, we added exception handling to the <kbd>WriteLog()</kbd> method in the library. In the first line of code, we added the keyword <kbd>try</kbd><strong>. </strong>Inside it, we created the code that creates the text file. Then, we caught a <kbd>FileNotFoundException</kbd> in the first <kbd>catch</kbd> clause. This is a good practice; to catch the exact exception. If you have caught all exceptions, then you can catch the default <kbd>exception</kbd>.</p>
<p>Finally, we have used a <kbd>finally</kbd> clause to close the file stream. The <kbd>finally</kbd> clause will always execute inside a <kbd>try...catch</kbd> block. It's a good practice to include the code for a cleanup inside a <kbd>finally</kbd> clause. </p>


            

            
        
    

        

                            
                    <h1 class="header-title">Using Visual Studio 2017 diagnostics and debugging tools</h1>
                
            
            
                
<p>In this recipe, we will be looking at how to debug a .NET Standard 2.0 library using Visual Studio 2017 and its debugging tools. We will be using the same solution we created in the previous recipes.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>Make sure you have completed the previous recipes and built them without any issues. Let's get started.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>Open Visual Studio 2017.</li>
<li>Now, open the solution from the previous recipe. Click File | Open | Open Project/Solution, or press <em>Ctrl</em> + <em>Shift</em> + <em>O</em>, and select the <kbd>Chapter10.Logging</kbd> solution. </li>
</ol>
<ol start="3">
<li>Press <em>Ctrl</em> + <em>Shift</em> + <em>B</em> for a quick build to check that everything is fine. </li>
<li>The Solution Explorer should look like this:</li>
</ol>
<div><img class="alignnone size-full wp-image-968 image-border" src="img/e67d6dc6-df65-4b49-83f7-353a1b84c453.png" style="width:20.00em;height:15.92em;"/></div>
<ol start="5">
<li>Now, double-click on the <kbd>LoggerDemo.cs</kbd> label to open the code window.</li>
<li>Scroll down until you reach the <kbd>WriteLog()</kbd> method.</li>
<li>Now, as shown in the following, click on the gray bar on the left side of the code window to add a debug point:</li>
</ol>
<div><img class="alignnone size-full wp-image-969 image-border" src="img/d8ed76a6-7579-4183-8928-5d9f8bb152a9.png" style="width:43.17em;height:19.00em;"/></div>
<ol start="8">
<li>Again, click on the <kbd>Program.cs</kbd> tab.</li>
<li>Press <em>F</em><em>5</em> to debug the code.</li>
<li>As you can see, the cursor will stop at the debugging point:</li>
</ol>
<div><img class="alignnone size-full wp-image-970 image-border" src="img/464195b3-1b90-409a-9500-1762a03823ae.png" style="width:51.17em;height:20.08em;"/></div>
<ol start="11">
<li>Now, move your mouse pointer to the <kbd>message</kbd> parameter of the <kbd>WriteLog()</kbd> method:</li>
</ol>
<div><img class="alignnone size-full wp-image-971 image-border" src="img/eff31b8f-75ea-409c-afc8-4138e53b8c4e.png" style="width:54.58em;height:13.58em;"/></div>
<ol start="12">
<li>Now, you can see what is stored inside that variable.</li>
<li>Click on the small green arrow as highlighted in the following:</li>
</ol>
<div><img class="alignnone size-full wp-image-972 image-border" src="img/7dc3e5cf-c01a-44fd-afa1-aa9c14e794c0.png" style="width:54.58em;height:24.08em;"/></div>
<ol start="14">
<li>You should see that the debug point jumps to the <kbd>logFile.WriteLine</kbd> method.</li>
<li>On the right-hand side of the screen, you should see the Diagnostics Tools window:</li>
</ol>
<div><img class="alignnone size-full wp-image-973 image-border" src="img/0a7a26ec-9dcd-4ad9-9557-e267942ff5cd.png" style="width:25.50em;height:35.67em;"/></div>
<ol start="16">
<li>Also, at the bottom, you should see the Watch windows and the Call Stack window:</li>
</ol>
<div><img class="alignnone size-full wp-image-974 image-border" src="img/552bd11d-aa89-40a6-b6f7-b9a0882f6ef8.png" style="width:150.00em;height:21.92em;"/></div>
<ol start="17">
<li>Now, stop debugging by pressing <em>Shift</em> + <em>F5</em>.</li>
</ol>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>In steps 1 to 5, we opened the existing solution with the .NET Standard library and its accompanying .NET Core application. In step 10, we added a debugging point to the code. In step 11, we could see that it had stopped at the debugging point, at the .NET Standard 2.0 library itself. From then on, it performed like a normal debugging application. Visual Studio knew we were looking for code in the library.</p>
<p>In step 13, we moved the mouse pointer to the <kbd>string</kbd> parameter of the <kbd>WriteLog()</kbd> method, which is in the library code itself. Visual Studio showed us the value inside that parameter. Again, in step 13, we saw that we could jump to any area in the code we desired. This is a new feature in Visual Studio 2017. In step 15, we saw the diagnostic tools available, including the Events, Memory, and the CPU usage. These tools help us to fine-tune our library as normal C# code.</p>
<p>Finally, we looked at the Watch and Call Stack windows, which are self-explanatory.</p>


            

            
        
    </body></html>