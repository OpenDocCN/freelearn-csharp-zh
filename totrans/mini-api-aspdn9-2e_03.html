<html><head></head><body>
  <div id="_idContainer027">
   <h1 class="chapter-number" id="_idParaDest-46">
    <a id="_idTextAnchor073">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     3
    </span>
   </h1>
   <h1 id="_idParaDest-47">
    <a id="_idTextAnchor074">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     The Anatomy of a Minimal API
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.3.1">
     To understand how minimal APIs work, it makes sense to learn how they are put together in the context of an ASP.NET application.
    </span>
    <span class="koboSpan" id="kobo.3.2">
     In ASP.NET project types such as
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.4.1">
      Model-View-Controller
     </span>
    </strong>
    <span class="koboSpan" id="kobo.5.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.6.1">
      MVC
     </span>
    </strong>
    <span class="koboSpan" id="kobo.7.1">
     ) and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.8.1">
      Web API
     </span>
    </strong>
    <span class="koboSpan" id="kobo.9.1">
     , various components are tied together to create the overall application, and minimal APIs are
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.10.1">
      no different.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.11.1">
     By the end of this chapter, you will have learned how minimal APIs fit within the ASP.NET ecosystem and how the various components are combined to make
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.12.1">
      them possible.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.13.1">
     The aim here is to ensure you have a deeper understanding of the wider context surrounding minimal APIs, which will inform the way you design and implement them in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.14.1">
      future projects.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.15.1">
     In this chapter, we are going to cover the following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.16.1">
      main topics:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.17.1">
      Anatomy of a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.18.1">
       minimal API
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.19.1">
      Components of a minimal
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.20.1">
       API Application
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.21.1">
      The API
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.22.1">
       request lifecycle
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.23.1">
     Let’s get into
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.24.1">
      the chapter!
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-48">
    <a id="_idTextAnchor075">
    </a>
    <span class="koboSpan" id="kobo.25.1">
     Anatomy of a minimal API
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.26.1">
     When
    </span>
    <a id="_idIndexMarker075">
    </a>
    <span class="koboSpan" id="kobo.27.1">
     referring to the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.28.1">
      anatomy
     </span>
    </em>
    <span class="koboSpan" id="kobo.29.1">
     of a minimal API, what we are really talking about is the pieces of the puzzle that fit together to bootstrap the application.
    </span>
    <span class="koboSpan" id="kobo.29.2">
     Before ASP.NET Core, bootstrapping involved two classes:
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.30.1">
      Program.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.31.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.32.1">
      Startup.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.33.1">
     .
    </span>
    <span class="koboSpan" id="kobo.33.2">
     The former stayed at the high level of the project, setting up an HTTP pipeline before calling the startup class to add components and features to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.34.1">
      the pipeline.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.35.1">
     ASP.NET Core majorly changed this by making it possible to configure the application in a single file.
    </span>
    <span class="koboSpan" id="kobo.35.2">
     This simplified the process, paving the way for native support of minimal APIs.
    </span>
    <span class="koboSpan" id="kobo.35.3">
     So, in the most recent iterations of .NET, we now only need
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.36.1">
      Program.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.37.1">
     for bootstrapping an
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.38.1">
      ASP.NET application.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.39.1">
     The
    </span>
    <a id="_idIndexMarker076">
    </a>
    <span class="koboSpan" id="kobo.40.1">
     minimum that
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.41.1">
      Program.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.42.1">
     does to create a minimal API is to build and run an instance of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.43.1">
      WebApplication
     </span>
    </strong>
    <span class="koboSpan" id="kobo.44.1">
     .
    </span>
    <span class="koboSpan" id="kobo.44.2">
     This
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.45.1">
      WebApplication
     </span>
    </strong>
    <span class="koboSpan" id="kobo.46.1">
     instance is built using another class, called
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.47.1">
      WebApplicationBuilder
     </span>
    </strong>
    <span class="koboSpan" id="kobo.48.1">
     .
    </span>
    <span class="koboSpan" id="kobo.48.2">
     As you can see in the upcoming code,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.49.1">
      WebApplication
     </span>
    </strong>
    <span class="koboSpan" id="kobo.50.1">
     uses a
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.51.1">
      factory
     </span>
    </em>
    <span class="koboSpan" id="kobo.52.1">
     in the form of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.53.1">
      CreateBuilder
     </span>
    </strong>
    <span class="koboSpan" id="kobo.54.1">
     method to create an instance of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.55.1">
      WebApplication
     </span>
    </strong>
    <span class="koboSpan" id="kobo.56.1">
     called
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.57.1">
      app
     </span>
    </strong>
    <span class="koboSpan" id="kobo.58.1">
     .
    </span>
    <span class="koboSpan" id="kobo.58.2">
     You will have seen this code in code examples in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.59.1">
      previous chapter:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.60.1">
WebApplicationBuilder builder =
    WebApplication.CreateBuilder(args);
var app = builder.Build();</span></pre>
   <p>
    <span class="koboSpan" id="kobo.61.1">
     The result of this code is an instance of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.62.1">
      WebApplication
     </span>
    </strong>
    <span class="koboSpan" id="kobo.63.1">
     on which endpoints can be mapped, using functions such as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.64.1">
      MapGet
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.65.1">
      and
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.66.1">
       MapPost
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.67.1">
      .
     </span>
    </span>
   </p>
   <p>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.68.1">
      WebApplication
     </span>
    </strong>
    <span class="koboSpan" id="kobo.69.1">
     embodies the overall API and is created using a builder pattern implementation via a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.70.1">
      WebApplicationBuilder
     </span>
    </strong>
    <span class="koboSpan" id="kobo.71.1">
     object.
    </span>
    <span class="koboSpan" id="kobo.71.2">
     This object allows configuration to be specified while building the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.72.1">
      WebApplication
     </span>
    </strong>
    <span class="koboSpan" id="kobo.73.1">
     instance.
    </span>
    <span class="koboSpan" id="kobo.73.2">
     For example, services can be registered for dependency injection (we will learn about dependency injection in
    </span>
    <a href="B20968_07.xhtml#_idTextAnchor119">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.74.1">
        Chapter 7
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.75.1">
     ) while the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.76.1">
      WebApplication
     </span>
    </strong>
    <span class="koboSpan" id="kobo.77.1">
     is being built via the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.78.1">
       WebApplicationBuilder
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.79.1">
      object.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.80.1">
     An example of this initial setup of dependencies can be seen in the next code, where we use
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.81.1">
      AddScoped
     </span>
    </strong>
    <span class="koboSpan" id="kobo.82.1">
     to register the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.83.1">
      PayrollRunner
     </span>
    </strong>
    <span class="koboSpan" id="kobo.84.1">
     type for dependency injection before the line of code on which the app is finally built
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.85.1">
      using
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.86.1">
       builder.Build()
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.87.1">
      :
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.88.1">
WebApplicationBuilder builder =
    WebApplication.CreateBuilder(args);
builder.Services.AddScoped&lt;PayrollRunn</span><a id="_idTextAnchor076"/><span class="koboSpan" id="kobo.89.1">er&gt;();
var app = builder.Build();</span></pre>
   <p>
    <span class="koboSpan" id="kobo.90.1">
     A minimal API does not have its own dedicated project template in Visual Studio.
    </span>
    <span class="koboSpan" id="kobo.90.2">
     Think of a minimal API as an option within an ASP.NET project, rather than its own project type.
    </span>
    <span class="koboSpan" id="kobo.90.3">
     The reason for this is that minimal APIs are more often than not a part of another kind of project, although it is certainly common to have small ASP.NET projects consisting exclusively of minimal
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.91.1">
      API endpoints.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.92.1">
     By default, an ASP.NET project creates a set of minimal API endpoints.
    </span>
    <span class="koboSpan" id="kobo.92.2">
     You can see this using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.93.1">
      ASP.NET Core (Empty)
     </span>
    </strong>
    <span class="koboSpan" id="kobo.94.1">
     project template in
    </span>
    <a id="_idIndexMarker077">
    </a>
    <span class="koboSpan" id="kobo.95.1">
     Visual Studio.
    </span>
    <span class="koboSpan" id="kobo.95.2">
     Despite the name, the template’s resulting project generates an example minimal API endpoint, as we saw in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.96.1">
      Hello World!
     </span>
    </em>
    <span class="koboSpan" id="kobo.97.1">
     example in
    </span>
    <a href="B20968_01.xhtml#_idTextAnchor014">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.98.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.99.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-49">
    <a id="_idTextAnchor077">
    </a>
    <span class="koboSpan" id="kobo.100.1">
     Components of a minimal API application
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.101.1">
     There are
    </span>
    <a id="_idIndexMarker078">
    </a>
    <span class="koboSpan" id="kobo.102.1">
     several components that go together to create a minimal API project, most of which are applicable to any ASP.NET
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.103.1">
      web application.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.104.1">
     At the top level, the application is represented by an instance of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.105.1">
      WebApplication
     </span>
    </strong>
    <span class="koboSpan" id="kobo.106.1">
     .
    </span>
    <span class="koboSpan" id="kobo.106.2">
     This class holds together all the pieces that form the API system.
    </span>
    <span class="koboSpan" id="kobo.106.3">
     Think of it like the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.107.1">
      application’s body.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.108.1">
     Components that live inside
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.109.1">
      WebApplication
     </span>
    </strong>
    <span class="koboSpan" id="kobo.110.1">
     include
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.111.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.112.1">
       Application Lifecycle
      </span>
     </strong>
     <span class="koboSpan" id="kobo.113.1">
      : As the
     </span>
     <a id="_idIndexMarker079">
     </a>
     <span class="koboSpan" id="kobo.114.1">
      application runs, various events will occur, such as application startup and shutdown, and thrown exceptions.
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.115.1">
       WebApplication
      </span>
     </strong>
     <span class="koboSpan" id="kobo.116.1">
      contains several
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.117.1">
       hooks
      </span>
     </strong>
     <span class="koboSpan" id="kobo.118.1">
      that
     </span>
     <a id="_idIndexMarker080">
     </a>
     <span class="koboSpan" id="kobo.119.1">
      can be used to handle these events.
     </span>
     <span class="koboSpan" id="kobo.119.2">
      For example, you could execute specific functions or methods when the application starts up or change the way specific exception types are handled
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.120.1">
       when caught.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.121.1">
       Services
      </span>
     </strong>
     <span class="koboSpan" id="kobo.122.1">
      : Your
     </span>
     <a id="_idIndexMarker081">
     </a>
     <span class="koboSpan" id="kobo.123.1">
      APIs will no doubt have reusable aspects that could be used across multiple use cases and different areas of the application.
     </span>
     <span class="koboSpan" id="kobo.123.2">
      Creating
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.124.1">
       services
      </span>
     </em>
     <span class="koboSpan" id="kobo.125.1">
      allows you to package up these reusable aspects into components that can be passed to various parts of your API using dependency injection.
     </span>
     <span class="koboSpan" id="kobo.125.2">
      For example, several of your endpoints may rely on retrieving data from a SQL database, so it would not be good practice to write the code to access the database multiple times.
     </span>
     <span class="koboSpan" id="kobo.125.3">
      Instead, a service can be written once and then injected into any classes that need to communicate
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.126.1">
       with SQL.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.127.1">
       Routing
      </span>
     </strong>
     <span class="koboSpan" id="kobo.128.1">
      : We talked
     </span>
     <a id="_idIndexMarker082">
     </a>
     <span class="koboSpan" id="kobo.129.1">
      about routing in the previous chapter.
     </span>
     <span class="koboSpan" id="kobo.129.2">
      In the context of a minimal API’s anatomy, routing is a key component; it is responsible for ensuring that traffic is sent to the appropriate destination based on the endpoint URL and the HTTP method
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.130.1">
       being used.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.131.1">
       Middleware
      </span>
     </strong>
     <span class="koboSpan" id="kobo.132.1">
      : In ASP.NET, middleware
     </span>
     <a id="_idIndexMarker083">
     </a>
     <span class="koboSpan" id="kobo.133.1">
      is a pipeline that allows developers to interrupt the API flow with code that is executed during requests.
     </span>
     <span class="koboSpan" id="kobo.133.2">
      The middleware pipeline is a chain of components executing any required logic.
     </span>
     <span class="koboSpan" id="kobo.133.3">
      Examples of common middleware use cases include handling or modifying requests, authenticating clients, caching, and logging.
     </span>
     <span class="koboSpan" id="kobo.133.4">
      Middleware can be a reusable component that is added to the pipeline or
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.134.1">
       custom code.
      </span>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.135.1">
       Once a middleware component has finished running, the next component in the pipeline executes, until all components are finished.
      </span>
      <span class="koboSpan" id="kobo.135.2">
       This is particularly useful because it can be applied globally, running on all incoming requests.
      </span>
      <span class="koboSpan" id="kobo.135.3">
       It’s important to note that the pipeline can run both when the request comes in and when the response is sent back to the client, the difference being that the order of the middleware components in the pipeline is reversed when the response makes its way back to
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.136.1">
        the client.
       </span>
      </span>
     </p>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.137.1">
       Configuration
      </span>
     </strong>
     <span class="koboSpan" id="kobo.138.1">
      : Most
     </span>
     <a id="_idIndexMarker084">
     </a>
     <span class="koboSpan" id="kobo.139.1">
      applications, including minimal APIs, require configuration to be specified, through connection strings for databases, authentication tokens, a flag to indicate whether the API is in developer mode, and so on.
     </span>
     <span class="koboSpan" id="kobo.139.2">
      Think of these like environment variables.
     </span>
     <span class="koboSpan" id="kobo.139.3">
      These variables are stored in an accessible location for use throughout the application’s lifecycle.
     </span>
     <span class="koboSpan" id="kobo.139.4">
      For example, if you have a SQL database that several of your API endpoints need to work with data, they will need the relevant connection string to initiate the SQL connection.
     </span>
     <span class="koboSpan" id="kobo.139.5">
      This can be stored as a configuration setting for any of these endpoints to obtain when they
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.140.1">
       need it.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.141.1">
     So far, we have covered, at a basic level, the various components within an ASP.NET web application, including ones set up to host minimal API endpoints.
    </span>
    <span class="koboSpan" id="kobo.141.2">
     To better understand the anatomy of a minimal API, it helps to also understand how a request travels through an
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.142.1">
      ASP.NET API.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-50">
    <a id="_idTextAnchor078">
    </a>
    <span class="koboSpan" id="kobo.143.1">
     The API request lifecycle
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.144.1">
     APIs share
    </span>
    <a id="_idIndexMarker085">
    </a>
    <span class="koboSpan" id="kobo.145.1">
     one thing in common, irrespective of the underlying technology – the conversation between client and server.
    </span>
    <span class="koboSpan" id="kobo.145.2">
     The lifecycle of this conversation is visualized in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.146.1">
       Figure 3
      </span>
     </em>
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.147.1">
       .1
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.148.1">
      .
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer026">
     <span class="koboSpan" id="kobo.149.1">
      <img alt="Figure 3.1: The journey of an HTTP request" src="image/B20968_03_01.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.150.1">
     Figure 3.1: The journey of an HTTP request
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.151.1">
     Let’s explore this lifecycle in more detail.
    </span>
    <span class="koboSpan" id="kobo.151.2">
     Specifically, for ASP.NET, and therefore minimal APIs, the steps we outline next are taken from the point a client makes a request, to the point a
    </span>
    <a id="_idIndexMarker086">
    </a>
    <span class="koboSpan" id="kobo.152.1">
     response
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.153.1">
      is received:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.154.1">
       The request is parsed
      </span>
     </strong>
     <span class="koboSpan" id="kobo.155.1">
      – On receipt of the request, ASP.NET takes the incoming data and extracts critical information, such as the HTTP method in use (GET, POST, PUT, etc.).
     </span>
     <span class="koboSpan" id="kobo.155.2">
      The URL is extracted, along with the request’s headers
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.156.1">
       and body.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.157.1">
       The middleware pipeline is executed
      </span>
     </strong>
     <span class="koboSpan" id="kobo.158.1">
      – Middleware sitting in the chain is processed, with each middleware component operating on the request as configured.
     </span>
     <span class="koboSpan" id="kobo.158.2">
      For example, authentication middleware could check that the sender of the request is authenticated, custom middleware could alter the structure of the request, and logging middleware could reference the request in logs that it writes to various
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.159.1">
       data sources.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.160.1">
       Routing
      </span>
     </strong>
     <span class="koboSpan" id="kobo.161.1">
      – Now that the application has parsed the request and processed it through any relevant middleware, it can match the extracted URL and HTTP method against the routes configured in the API.
     </span>
     <span class="koboSpan" id="kobo.161.2">
      This allows the request’s content to be routed to the appropriate endpoint for handling.
     </span>
     <span class="koboSpan" id="kobo.161.3">
      Routing is just another example of a middleware component.
     </span>
     <span class="koboSpan" id="kobo.161.4">
      As such, its order of execution can be altered within
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.162.1">
       the pipeline.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.163.1">
       Dependency injection
      </span>
     </strong>
     <span class="koboSpan" id="kobo.164.1">
      – Once the request has been routed to the correct request, the dependency injection container will resolve any dependencies required to process the request and inject them into the components containing the endpoint, making them available
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.165.1">
       during processing.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.166.1">
       Request handling
      </span>
     </strong>
     <span class="koboSpan" id="kobo.167.1">
      – The request is effectively now
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.168.1">
       inside the endpoint
      </span>
     </em>
     <span class="koboSpan" id="kobo.169.1">
      , as in, it is being processed by the logic a developer has written inside the body of a minimal API endpoint they have written.
     </span>
     <span class="koboSpan" id="kobo.169.2">
      Parameters passed in can be used within the endpoint body to process the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.170.1">
       required logic.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.171.1">
       Response generation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.172.1">
      – Once the logic defined within the body of the endpoint has finished executing (or if an exception is thrown), a response will be generated.
     </span>
     <span class="koboSpan" id="kobo.172.2">
      The response contains any expected data for the HTTP method on the endpoint, such as JSON or a simple string.
     </span>
     <span class="koboSpan" id="kobo.172.3">
      It also has a status code appropriate to the processing result, for example,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.173.1">
       200 OK
      </span>
     </strong>
     <span class="koboSpan" id="kobo.174.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.175.1">
       400 Bad Request
      </span>
     </strong>
     <span class="koboSpan" id="kobo.176.1">
      , or
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.177.1">
       500 Internal Server Error
      </span>
     </strong>
     <span class="koboSpan" id="kobo.178.1">
      .
     </span>
     <span class="koboSpan" id="kobo.178.2">
      Once generated, the response is sent back to the client, and the HTTP conversation
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.179.1">
       is over.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.180.1">
     Now that we
    </span>
    <a id="_idIndexMarker087">
    </a>
    <span class="koboSpan" id="kobo.181.1">
     have explored the journey of a request, let’s review what we have covered in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.182.1">
      this chapter.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-51">
    <a id="_idTextAnchor079">
    </a>
    <span class="koboSpan" id="kobo.183.1">
     Summary
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.184.1">
     The chapter has detailed the different components that ASP.NET employs to construct an application capable of hosting minimal API endpoints.
    </span>
    <span class="koboSpan" id="kobo.184.2">
     It explained how the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.185.1">
      WebApplication
     </span>
    </strong>
    <span class="koboSpan" id="kobo.186.1">
     instance is configured using the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.187.1">
      WebApplicationBuilder
     </span>
    </strong>
    <span class="koboSpan" id="kobo.188.1">
     .
    </span>
    <span class="koboSpan" id="kobo.188.2">
     The chapter also described the integration of elements like routing, services, dependency injection, and middleware into the application.
    </span>
    <span class="koboSpan" id="kobo.188.3">
     Additionally, it emphasized the importance of the application lifecycle and how lifecycle events can be managed through hooks.
    </span>
    <span class="koboSpan" id="kobo.188.4">
     The journey of an HTTP request from the client to minimal API endpoints and back was also discussed.
    </span>
    <span class="koboSpan" id="kobo.188.5">
     Finally, the chapter outlined the steps involved in matching incoming requests with the appropriate logic, and the process of handling the request in preparation for a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.189.1">
      client response.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.190.1">
     In the next chapter, we will move away from the conceptual and back to the practical with a more advanced guide on handling HTTP requests
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.191.1">
      and routing.
     </span>
    </span>
   </p>
  </div>
 

  <div class="Content" id="_idContainer028">
   <h1 id="_idParaDest-52" lang="en-US" xml:lang="en-US">
    <a id="_idTextAnchor080">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     Part 2 - Data and Execution Flow
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.2.1">
     This part delves into the crucial aspects of how data flows through minimal APIs.
    </span>
    <span class="koboSpan" id="kobo.2.2">
     You’ll learn how to handle various HTTP methods, set up routing, customize middleware pipelines, and integrate with different data sources.
    </span>
    <span class="koboSpan" id="kobo.2.3">
     These chapters cover everything from dependency injection to working with databases using
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.3.1">
      Object-Relational Mapping
     </span>
    </strong>
    <span class="koboSpan" id="kobo.4.1">
     (
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.5.1">
       ORM
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.6.1">
      ) tools.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.7.1">
     This part has the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.8.1">
      following chapters:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <a href="B20968_04.xhtml#_idTextAnchor081">
      <em class="italic">
       <span class="koboSpan" id="kobo.9.1">
        Chapter 4
       </span>
      </em>
     </a>
     <span class="koboSpan" id="kobo.10.1">
      ,
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.11.1">
       Handling HTTP Methods and Routing
      </span>
     </em>
    </li>
    <li>
     <a href="B20968_05.xhtml#_idTextAnchor094">
      <em class="italic">
       <span class="koboSpan" id="kobo.12.1">
        Chapter 5
       </span>
      </em>
     </a>
     <span class="koboSpan" id="kobo.13.1">
      ,
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.14.1">
       The Middleware Pipeline
      </span>
     </em>
    </li>
    <li>
     <a href="B20968_06.xhtml#_idTextAnchor105">
      <em class="italic">
       <span class="koboSpan" id="kobo.15.1">
        Chapter 6
       </span>
      </em>
     </a>
     <span class="koboSpan" id="kobo.16.1">
      ,
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.17.1">
       Parameter Binding
      </span>
     </em>
    </li>
    <li>
     <a href="B20968_07.xhtml#_idTextAnchor119">
      <em class="italic">
       <span class="koboSpan" id="kobo.18.1">
        Chapter 7
       </span>
      </em>
     </a>
     <span class="koboSpan" id="kobo.19.1">
      ,
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.20.1">
       Dependency Injection in Minimal APIs
      </span>
     </em>
    </li>
    <li>
     <a href="B20968_08.xhtml#_idTextAnchor132">
      <em class="italic">
       <span class="koboSpan" id="kobo.21.1">
        Chapter 8
       </span>
      </em>
     </a>
     <span class="koboSpan" id="kobo.22.1">
      ,
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.23.1">
       Integrating Minimal APIs with Data Sources
      </span>
     </em>
    </li>
    <li>
     <a href="B20968_09.xhtml#_idTextAnchor143">
      <em class="italic">
       <span class="koboSpan" id="kobo.24.1">
        Chapter 9
       </span>
      </em>
     </a>
     <span class="koboSpan" id="kobo.25.1">
      ,
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.26.1">
       Object Relational Mapping with Entity Framework Core and Dapper
      </span>
     </em>
    </li>
   </ul>
  </div>
  <div>
   <div id="_idContainer029">
   </div>
  </div>
  <div>
   <div id="_idContainer030">
   </div>
  </div>
  <div>
   <div id="_idContainer031">
   </div>
  </div>
  <div>
   <div id="_idContainer032">
   </div>
  </div>
  <div>
   <div id="_idContainer033">
   </div>
  </div>
  <div>
   <div class="Basic-Graphics-Frame" id="_idContainer034">
   </div>
  </div>
  <div>
   <div class="Basic-Graphics-Frame" id="_idContainer035">
   </div>
  </div>
  <div>
   <div id="_idContainer036">
   </div>
  </div>
  <div>
   <div id="_idContainer037">
   </div>
  </div>
  <div>
   <div class="Basic-Graphics-Frame" id="_idContainer038">
   </div>
  </div>
 </body></html>