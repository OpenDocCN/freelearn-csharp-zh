<html><head></head><body>
<div class="Basic-Text-Frame" id="_idContainer275">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">16</span></h1>
<h1 class="chapterTitle" id="_idParaDest-326"><span class="koboSpan" id="kobo.2.1">Working with Serverless – Azure Functions</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">In </span><em class="chapterRef"><span class="koboSpan" id="kobo.4.1">Chapter 10</span></em><span class="koboSpan" id="kobo.5.1">, </span><em class="italic"><span class="koboSpan" id="kobo.6.1">Deciding on the Best Cloud-Based Solution</span></em><span class="koboSpan" id="kobo.7.1">, we explored the fundamentals and strategic advantages of different cloud architectures and serverless can be considered one of the newest ways to provide flexible cloud-based solutions. </span><span class="koboSpan" id="kobo.7.2">We delved into how serverless systems offer scalability, cost-efficiency, and agility – key factors that drive today’s software architecture decisions.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.8.1">Building on that foundation, this chapter delves deeper into a pivotal component of serverless architecture: Azure Functions.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.9.1">Azure Functions stands out as the component that Microsoft delivers as a prime example of serverless architecture in action. </span><span class="koboSpan" id="kobo.9.2">It offers a versatile, event-driven approach that integrates seamlessly with the .NET ecosystem, making it the for architects and developers aiming to build efficient, scalable, and responsive applications.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.10.1">We will navigate through the intricacies of Azure Functions, emphasizing their application in complex enterprise environments. </span><span class="koboSpan" id="kobo.10.2">This chapter will arm you with practical insights into leveraging Azure Functions for robust application architecture, discussing best practices, design patterns, and advanced features specific to the .NET stack.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.11.1">This chapter provides a comprehensive understanding of Azure Functions, focusing on enhancing your technical mastery of this platform. </span><span class="koboSpan" id="kobo.11.2">We delve into the specifics of Azure Functions, covering its setup, programming using C#, and various hosting plans like the Consumption, Premium, and App Service plans. </span><span class="koboSpan" id="kobo.11.3">By the end of this chapter, you will have a thorough understanding of Azure Functions, equipped with the knowledge to deploy, maintain, and optimize its functions effectively in your projects.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.12.1">In this chapter, we will cover the following topics:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.13.1">Understanding the Azure Functions app</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.14.1">Programming Azure Functions using C#</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.15.1">Maintaining Azure Functions</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.16.1">By the end of this chapter, you will understand how to use Azure Functions in C# to speed up your development cycle.</span></p>
<h1 class="heading-1" id="_idParaDest-327"><span class="koboSpan" id="kobo.17.1">Technical requirements</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.18.1">This chapter requires that you have the following:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.19.1">The free Visual Studio 2022 Community Edition or, even better, with all the Azure tools installed.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.20.1">A free Azure account. </span><span class="koboSpan" id="kobo.20.2">The </span><em class="italic"><span class="koboSpan" id="kobo.21.1">Creating an Azure account</span></em><span class="koboSpan" id="kobo.22.1"> section of </span><em class="italic"><span class="koboSpan" id="kobo.23.1">Chapter 1</span></em><span class="koboSpan" id="kobo.24.1">, </span><em class="italic"><span class="koboSpan" id="kobo.25.1">Understanding the Importance of Software Architecture</span></em><span class="koboSpan" id="kobo.26.1">, explains how to create one.</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-328"><span class="koboSpan" id="kobo.27.1">Understanding the Azure Functions app</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.28.1">The Azure Functions app</span><a id="_idIndexMarker1128"/><span class="koboSpan" id="kobo.29.1"> is an Azure </span><strong class="keyWord"><span class="koboSpan" id="kobo.30.1">PaaS</span></strong><span class="koboSpan" id="kobo.31.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.32.1">platform as a service</span></strong><span class="koboSpan" id="kobo.33.1">) where you can build pieces of code (functions), connect them to your application, and use triggers to start them. </span><span class="koboSpan" id="kobo.33.2">The concept is quite simple – you build a function in the language you prefer and decide on the trigger that will start it. </span><span class="koboSpan" id="kobo.33.3">You can write as many functions as you want in your system. </span><span class="koboSpan" id="kobo.33.4">There are cases where the system is written entirely with functions.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.34.1">The steps to create the necessary environment are as simple as the ones we need to follow to create the function itself. </span><span class="koboSpan" id="kobo.34.2">The following screenshot shows the parameters that you must decide on when you create the environment. </span><span class="koboSpan" id="kobo.34.3">After you select </span><strong class="keyWord"><span class="koboSpan" id="kobo.35.1">Create a resource</span></strong><span class="koboSpan" id="kobo.36.1"> in Azure and filter by </span><strong class="keyWord"><span class="koboSpan" id="kobo.37.1">Function App</span></strong><span class="koboSpan" id="kobo.38.1">, upon clicking the </span><strong class="keyWord"><span class="koboSpan" id="kobo.39.1">Create</span></strong><span class="koboSpan" id="kobo.40.1"> button, you will see</span><a id="_idIndexMarker1129"/><span class="koboSpan" id="kobo.41.1"> the following screen:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.42.1"><img alt="" role="presentation" src="../Images/B19820_16_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.43.1">Figure 16.1: Creating an Azure function app</span></p>
<p class="normal"><span class="koboSpan" id="kobo.44.1">There are a couple of key points that you should consider while creating your Azure Functions environment. </span><span class="koboSpan" id="kobo.44.2">The possibilities given for running functions increase from time to time, as do the programming language options and publishing styles. </span><span class="koboSpan" id="kobo.44.3">One of the most important configurations we have is the hosting plan, which is where you will run your functions. </span><span class="koboSpan" id="kobo.44.4">There are three options</span><a id="_idIndexMarker1130"/><span class="koboSpan" id="kobo.45.1"> for the hosting plan: a Consumption (Serverless), Premium, and App Service plan. </span><span class="koboSpan" id="kobo.45.2">Let’s talk about them.</span></p>
<h2 class="heading-2" id="_idParaDest-329"><span class="koboSpan" id="kobo.46.1">Consumption plan</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.47.1">If you choose a Consumption plan, your functions</span><a id="_idIndexMarker1131"/><span class="koboSpan" id="kobo.48.1"> will only consume resources when they are executed. </span><span class="koboSpan" id="kobo.48.2">This means that you will only be charged while your functions are running. </span><span class="koboSpan" id="kobo.48.3">Scalability and memory resources will be automatically managed by Azure. </span><span class="koboSpan" id="kobo.48.4">This is truly what we call serverless.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.49.1">Something we need to take note of while writing functions in this plan is the timeout. </span><span class="koboSpan" id="kobo.49.2">By default, after 5 minutes, the function will time out. </span><span class="koboSpan" id="kobo.49.3">You can change the timeout value using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.50.1">functionTimeout</span></code><span class="koboSpan" id="kobo.51.1"> parameter in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.52.1">host.json</span></code><span class="koboSpan" id="kobo.53.1"> file. </span><span class="koboSpan" id="kobo.53.2">The maximum value is 10 minutes.</span></p>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.54.1">When you choose the Consumption plan, how you will be charged will depend on what you are executing, the execution</span><a id="_idIndexMarker1132"/><span class="koboSpan" id="kobo.55.1"> time, and memory usage. </span><span class="koboSpan" id="kobo.55.2">More information on this can be found at </span><a href="https://azure.microsoft.com/en-us/pricing/details/functions/"><span class="url"><span class="koboSpan" id="kobo.56.1">https://azure.microsoft.com/en-us/pricing/details/functions/</span></span></a><span class="koboSpan" id="kobo.57.1">.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.58.1">Note that this can be a good option when you do not have app services in your environment, and you are running functions with low periodicity. </span><span class="koboSpan" id="kobo.58.2">On the other hand, if you need continuous processing, you may want</span><a id="_idIndexMarker1133"/><span class="koboSpan" id="kobo.59.1"> to consider using a Premium plan or an App Service plan. </span><span class="koboSpan" id="kobo.59.2">Let’s have a look at them below.</span></p>
<h2 class="heading-2" id="_idParaDest-330"><span class="koboSpan" id="kobo.60.1">Premium plan</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.61.1">Depending on what you use</span><a id="_idIndexMarker1134"/><span class="koboSpan" id="kobo.62.1"> your functions for, especially if they need to run continuously or almost continuously, or if some function executions take longer than 10 minutes, you may want to consider a Premium plan. </span><span class="koboSpan" id="kobo.62.2">Besides, you may need to connect your function to a VNET/VPN environment, and in this case, you will be forced to run in this plan.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.63.1">You may also need more CPU or memory options than what is provided with the Consumption plan. </span><span class="koboSpan" id="kobo.63.2">The Premium plan gives you one-core, two-core, and four-core instance options.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.64.1">It is worth mentioning that even with unlimited time to run your function if you decide to use an HTTP trigger function, 230 seconds is the maximum allowed for responding to a request. </span><span class="koboSpan" id="kobo.64.2">The reason this is a limit is related to the default idle timeout value of Azure Load Balancer.</span></p>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.65.1">You may have to redesign your solution</span><a id="_idIndexMarker1135"/><span class="koboSpan" id="kobo.66.1"> in such situations to adhere to the best practices set by Microsoft (</span><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-best-practices"><span class="url"><span class="koboSpan" id="kobo.67.1">https://docs.microsoft.com/en-us/azure/azure-functions/functions-best-practices</span></span></a><span class="koboSpan" id="kobo.68.1">).</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.69.1">Although the Premium plan is a great alternative, if you want to optimize the usage of your App Services</span><a id="_idIndexMarker1136"/><span class="koboSpan" id="kobo.70.1"> instances, the best option is the App Service plan. </span><span class="koboSpan" id="kobo.70.2">Let’s have a look at it.</span></p>
<h2 class="heading-2" id="_idParaDest-331"><span class="koboSpan" id="kobo.71.1">The App Service plan</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.72.1">The App Service plan is one of the options</span><a id="_idIndexMarker1137"/><span class="koboSpan" id="kobo.73.1"> you can choose when you want to create an Azure Functions app. </span><span class="koboSpan" id="kobo.73.2">Here are a couple of reasons (suggested by Microsoft) why you should use the App Service plan instead of the Consumption plan to maintain your functions:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.74.1">You can use underutilized existing App Service instances.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.75.1">You can run your function app on a custom image if you want to.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.76.1">In the App Service plan scenario, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.77.1">functionTimeout</span></code><span class="koboSpan" id="kobo.78.1"> value varies according to the Azure Functions runtime version. </span><span class="koboSpan" id="kobo.78.2">However, the value needs to be at least 30 minutes.</span></p>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.79.1">You can find a tabled comparison</span><a id="_idIndexMarker1138"/><span class="koboSpan" id="kobo.80.1"> between the timeouts in each Consumption plan at </span><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-scale#timeout"><span class="url"><span class="koboSpan" id="kobo.81.1">https://docs.microsoft.com/en-us/azure/azure-functions/functions-scale#timeout</span></span></a><span class="koboSpan" id="kobo.82.1">.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.83.1">Now that we have a foundational understanding of the Azure Functions app and its role in serverless architecture, let’s explore how to bring these concepts into action. </span><span class="koboSpan" id="kobo.83.2">In the following section, we’ll dive into programming Azure Functions using C#, turning theoretical knowledge into practical application.</span></p>
<h1 class="heading-1" id="_idParaDest-332"><span class="koboSpan" id="kobo.84.1">Programming Azure Functions using C#</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.85.1">In this section, you will learn how to create</span><a id="_idIndexMarker1139"/><span class="koboSpan" id="kobo.86.1"> Azure Functions. </span><span class="koboSpan" id="kobo.86.2">It is worth mentioning</span><a id="_idIndexMarker1140"/><span class="koboSpan" id="kobo.87.1"> that there are several ways to create them using C#. </span><span class="koboSpan" id="kobo.87.2">The first one is by creating the functions and developing them in the Azure portal itself. </span><span class="koboSpan" id="kobo.87.3">To do this, let us assume that you have created an Azure Functions app with similar configurations to the ones in the screenshot at the beginning of the chapter.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.88.1">By selecting the resource created and navigating to the </span><strong class="screenText"><span class="koboSpan" id="kobo.89.1">Functions</span></strong><span class="koboSpan" id="kobo.90.1"> menu, you will be able to add new functions to this environment, as you can see in the following screenshot:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.91.1"><img alt="" role="presentation" src="../Images/B19820_16_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.92.1">Figure 16.2: Adding a function</span></p>
<p class="normal"><span class="koboSpan" id="kobo.93.1">Here, you will need to decide the kind of trigger that you want to use to start the execution. </span><span class="koboSpan" id="kobo.93.2">The most frequently used ones are the </span><strong class="screenText"><span class="koboSpan" id="kobo.94.1">HTTP trigger</span></strong><span class="koboSpan" id="kobo.95.1"> and the </span><strong class="screenText"><span class="koboSpan" id="kobo.96.1">Timer trigger</span></strong><span class="koboSpan" id="kobo.97.1">. </span><span class="koboSpan" id="kobo.97.2">The first enables the creation of an HTTP API that will trigger the function. </span><span class="koboSpan" id="kobo.97.3">The second means functions will be triggered by a timer you set.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.98.1">When you decide on the trigger </span><a id="_idIndexMarker1141"/><span class="koboSpan" id="kobo.99.1">you want to use, you must name</span><a id="_idIndexMarker1142"/><span class="koboSpan" id="kobo.100.1"> the function. </span><span class="koboSpan" id="kobo.100.2">Depending on the trigger you decide on, you will have to set up some parameters. </span><span class="koboSpan" id="kobo.100.3">For instance, an </span><strong class="screenText"><span class="koboSpan" id="kobo.101.1">HTTP trigger</span></strong><span class="koboSpan" id="kobo.102.1"> requires that you set up an authorization level. </span><span class="koboSpan" id="kobo.102.2">Three options are available: </span><strong class="screenText"><span class="koboSpan" id="kobo.103.1">Function</span></strong><span class="koboSpan" id="kobo.104.1">, </span><strong class="screenText"><span class="koboSpan" id="kobo.105.1">Anonymous</span></strong><span class="koboSpan" id="kobo.106.1">, and </span><strong class="screenText"><span class="koboSpan" id="kobo.107.1">Admin</span></strong><span class="koboSpan" id="kobo.108.1">. </span><span class="koboSpan" id="kobo.108.2">The </span><strong class="screenText"><span class="koboSpan" id="kobo.109.1">Function</span></strong><span class="koboSpan" id="kobo.110.1"> option requires a specific key to access each HTTP trigger, while </span><strong class="screenText"><span class="koboSpan" id="kobo.111.1">Anonymous</span></strong><span class="koboSpan" id="kobo.112.1"> does not require anything. </span><span class="koboSpan" id="kobo.112.2">For the </span><strong class="screenText"><span class="koboSpan" id="kobo.113.1">Admin</span></strong><span class="koboSpan" id="kobo.114.1"> option, the key used is the master one, which is created together with the function app.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.115.1"><img alt="Interface gráfica do usuário, Texto, Aplicativo  Descrição gerada automaticamente" src="../Images/B19820_16_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.116.1">Figure 16.3: Configuring an HTTP function</span></p>
<p class="normal"><span class="koboSpan" id="kobo.117.1">It is important to note that this book</span><a id="_idIndexMarker1143"/><span class="koboSpan" id="kobo.118.1"> does not cover all the options</span><a id="_idIndexMarker1144"/><span class="koboSpan" id="kobo.119.1"> that are available when it comes to building functions. </span><span class="koboSpan" id="kobo.119.2">As a software architect, you should understand that Azure provides a good service for serverless architectures in terms of functions. </span><span class="koboSpan" id="kobo.119.3">This can be useful in several situations. </span><span class="koboSpan" id="kobo.119.4">This was discussed in more detail in </span><em class="italic"><span class="koboSpan" id="kobo.120.1">Chapter 10</span></em><span class="koboSpan" id="kobo.121.1">, </span><em class="italic"><span class="koboSpan" id="kobo.122.1">Deciding on the Best Cloud-Based Solution</span></em><span class="koboSpan" id="kobo.123.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.124.1">The result of this is as follows. </span><span class="koboSpan" id="kobo.124.2">Notice that Azure provides an editor that allows us to run the code, check logs, and test the function that we have created. </span><span class="koboSpan" id="kobo.124.3">This is a good interface for testing and coding basic functions:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.125.1"><img alt="" role="presentation" src="../Images/B19820_16_04.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.126.1">Figure 16.4: HTTP function environment</span></p>
<p class="normal"><span class="koboSpan" id="kobo.127.1">However, if you want</span><a id="_idIndexMarker1145"/><span class="koboSpan" id="kobo.128.1"> to create more sophisticated </span><a id="_idIndexMarker1146"/><span class="koboSpan" id="kobo.129.1">functions, you may need a more sophisticated environment so that you can code and debug them more efficaciously. </span><span class="koboSpan" id="kobo.129.2">This is where the Visual Studio Azure Functions project can help you. </span><span class="koboSpan" id="kobo.129.3">Besides, using Visual Studio to execute the development of the function moves you in the direction of using source control and CI/CD for your functions.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.130.1">In Visual Studio, you can create a project dedicated to Azure Functions by going to </span><strong class="screenText"><span class="koboSpan" id="kobo.131.1">Create a new project</span></strong><span class="koboSpan" id="kobo.132.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.133.1"><img alt="Texto  Descrição gerada automaticamente" src="../Images/B19820_16_05.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.134.1">Figure 16.5: Creating an Azure Functions project in Visual Studio 2022</span></p>
<p class="normal"><span class="koboSpan" id="kobo.135.1">Once you have created</span><a id="_idIndexMarker1147"/><span class="koboSpan" id="kobo.136.1"> your project, Visual Studio will ask</span><a id="_idIndexMarker1148"/><span class="koboSpan" id="kobo.137.1"> you for the type of triggers you are using and for the Azure version that your function will run on. </span><span class="koboSpan" id="kobo.137.2">It is worth mentioning that, for some scenarios, a storage account is required while creating the function app, such as managing triggers and logging executions.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.138.1"><img alt="" role="presentation" src="../Images/B19820_16_06.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.139.1">Figure 16.6: Creating a new Azure Functions application</span></p>
<p class="normal"><span class="koboSpan" id="kobo.140.1">It is worth mentioning that Azure Functions supports different platforms and programming languages. </span><span class="koboSpan" id="kobo.140.2">At the time of writing, there are two available runtime versions of Azure Functions with support provided. </span><span class="koboSpan" id="kobo.140.3">The first version (v1) is compatible with .NET Framework 4.8. </span><span class="koboSpan" id="kobo.140.4">The v2 and v3 versions are not supported anymore, so for .NET 8, you shall use version 4 (v4).</span></p>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.141.1">You can always check</span><a id="_idIndexMarker1149"/><span class="koboSpan" id="kobo.142.1"> for up-to-date information about it at </span><a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-versions"><span class="url"><span class="koboSpan" id="kobo.143.1">https://learn.microsoft.com/en-us/azure/azure-functions/functions-versions</span></span></a><span class="koboSpan" id="kobo.144.1">.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.145.1">As a software architect, you must keep</span><a id="_idIndexMarker1150"/><span class="koboSpan" id="kobo.146.1"> code reusability in mind. </span><span class="koboSpan" id="kobo.146.2">In this case, you should</span><a id="_idIndexMarker1151"/><span class="koboSpan" id="kobo.147.1"> pay attention to which version of Azure Functions you decide to build your functions in. </span><span class="koboSpan" id="kobo.147.2">However, it is always recommended that you use the latest version of the runtime as soon as it acquires general availability status.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.148.1">By default, the code that is generated is similar to that generated when you create Azure Functions in the Azure portal:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.149.1">using</span></span><span class="koboSpan" id="kobo.150.1"> System.Net;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.151.1">using</span></span><span class="koboSpan" id="kobo.152.1"> Google.Protobuf.WellKnownTypes;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.153.1">using</span></span><span class="koboSpan" id="kobo.154.1"> Microsoft.AspNetCore.WebUtilities;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.155.1">using</span></span><span class="koboSpan" id="kobo.156.1"> Microsoft.Azure.Functions.Worker;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.157.1">using</span></span><span class="koboSpan" id="kobo.158.1"> Microsoft.Azure.Functions.Worker.Http;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.159.1">using</span></span><span class="koboSpan" id="kobo.160.1"> Microsoft.Extensions.Logging;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.161.1">namespace</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.162.1">FunctionAppSampleIsolated</span></span><span class="koboSpan" id="kobo.163.1">
{
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.164.1">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.165.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.166.1">AzureFunctionHttpSampleNet8</span></span><span class="koboSpan" id="kobo.167.1">
    {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.168.1">private</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.169.1">readonly</span></span><span class="koboSpan" id="kobo.170.1"> ILogger _logger;
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.171.1">public</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.172.1">AzureFunctionHttpSampleNet8</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.173.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.174.1">ILoggerFactory loggerFactory</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.175.1">)</span></span><span class="koboSpan" id="kobo.176.1">
        {
            _logger = loggerFactory.CreateLogger&lt;AzureFunctionHttpSampleNet8&gt;();
        }
        [</span><span class="hljs-meta"><span class="koboSpan" id="kobo.177.1">Function(</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.178.1">"AzureFunctionHttpSampleNet8"</span></span><span class="hljs-meta"><span class="koboSpan" id="kobo.179.1">)</span></span><span class="koboSpan" id="kobo.180.1">]
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.181.1">public</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.182.1"> HttpResponseData </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.183.1">Run</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.184.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.185.1">[HttpTrigger(AuthorizationLevel.Function, </span></span><span class="hljs-string"><span class="koboSpan" id="kobo.186.1">"get"</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.187.1">, </span></span><span class="hljs-string"><span class="koboSpan" id="kobo.188.1">"post"</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.189.1">)] HttpRequestData req)</span></span><span class="koboSpan" id="kobo.190.1">
        {
            _logger.LogInformation(</span><span class="hljs-string"><span class="koboSpan" id="kobo.191.1">"C# HTTP trigger function processed a request."</span></span><span class="koboSpan" id="kobo.192.1">);
            </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.193.1">string</span></span><span class="koboSpan" id="kobo.194.1"> responseMessage = </span><span class="hljs-string"><span class="koboSpan" id="kobo.195.1">"This HTTP triggered function executed successfully. </span><span class="koboSpan" id="kobo.195.2">Pass a name in the query string or in the request body for a personalized response."</span></span><span class="koboSpan" id="kobo.196.1">;
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.197.1">var</span></span><span class="koboSpan" id="kobo.198.1"> queryDictionary = QueryHelpers.ParseQuery(req.Url.Query);
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.199.1">if</span></span><span class="koboSpan" id="kobo.200.1"> (queryDictionary.ContainsKey(</span><span class="hljs-string"><span class="koboSpan" id="kobo.201.1">"name"</span></span><span class="koboSpan" id="kobo.202.1">))
                responseMessage = </span><span class="hljs-string"><span class="koboSpan" id="kobo.203.1">$"Hello, </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.204.1">{queryDictionary[</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.205.1">"name"</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.206.1">]}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.207.1">. </span><span class="koboSpan" id="kobo.207.2">This HTTP triggered function executed successfully."</span></span><span class="koboSpan" id="kobo.208.1">;
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.209.1">var</span></span><span class="koboSpan" id="kobo.210.1"> response = req.CreateResponse(HttpStatusCode.OK);
            response.Headers.Add(</span><span class="hljs-string"><span class="koboSpan" id="kobo.211.1">"Content-Type"</span></span><span class="koboSpan" id="kobo.212.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.213.1">"text/plain; charset=utf-8"</span></span><span class="koboSpan" id="kobo.214.1">);
            response.WriteString(responseMessage);
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.215.1">return</span></span><span class="koboSpan" id="kobo.216.1"> response;
        }
    }
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.217.1">Since you have understood</span><a id="_idIndexMarker1152"/><span class="koboSpan" id="kobo.218.1"> the basis for creating Azure Functions</span><a id="_idIndexMarker1153"/><span class="koboSpan" id="kobo.219.1"> using C#, it is also important to understand the number of triggers that are available as templates for Azure Functions. </span><span class="koboSpan" id="kobo.219.2">Let’s have a look at that.</span></p>
<h2 class="heading-2" id="_idParaDest-333"><span class="koboSpan" id="kobo.220.1">Listing Azure Functions templates</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.221.1">There are several templates in the Azure portal</span><a id="_idIndexMarker1154"/><span class="koboSpan" id="kobo.222.1"> that you can use to create Azure Functions. </span><span class="koboSpan" id="kobo.222.2">The number of templates that you can choose from is updated continuously. </span><span class="koboSpan" id="kobo.222.3">The following are just a few of them:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.223.1">Blob Trigger</span></strong><span class="koboSpan" id="kobo.224.1">: You may want to process something for a file as soon as the file is uploaded to your blob storage. </span><span class="koboSpan" id="kobo.224.2">This can be a good use case for Azure Functions.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.225.1">Cosmos DB Trigger</span></strong><span class="koboSpan" id="kobo.226.1">: You may want to synchronize data that arrives in a Cosmos DB database with a processing method. </span><span class="koboSpan" id="kobo.226.2">Cosmos DB was discussed in detail in </span><em class="italic"><span class="koboSpan" id="kobo.227.1">Chapter 12</span></em><span class="koboSpan" id="kobo.228.1">, </span><em class="italic"><span class="koboSpan" id="kobo.229.1">Choosing Your Data Storage in the Cloud</span></em><span class="koboSpan" id="kobo.230.1">.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.231.1">Event Grid Trigger</span></strong><span class="koboSpan" id="kobo.232.1">: This is a good way to manage Azure events. </span><span class="koboSpan" id="kobo.232.2">Functions can be triggered so that they manage each event.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.233.1">Event Hub Trigger</span></strong><span class="koboSpan" id="kobo.234.1">: With this trigger, you can build functions that are linked to any system that sends data to Azure Event Hubs.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.235.1">HTTP Trigger</span></strong><span class="koboSpan" id="kobo.236.1">: This trigger is useful for building serverless APIs and web app events.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.237.1">IoT Hub Trigger</span></strong><span class="koboSpan" id="kobo.238.1">: When your application is connected to devices using IoT Hub, you can use this trigger whenever a new event is received by one of the devices.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.239.1">Queue Trigger</span></strong><span class="koboSpan" id="kobo.240.1">: You can handle queue processing using a function-as-a-service solution.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.241.1">Service Bus Queue Trigger</span></strong><span class="koboSpan" id="kobo.242.1">: This is another messaging service that can be a trigger for functions. </span><span class="koboSpan" id="kobo.242.2">Azure Service Bus was covered in more detail in </span><em class="italic"><span class="koboSpan" id="kobo.243.1">Chapter 11</span></em><span class="koboSpan" id="kobo.244.1">, </span><em class="italic"><span class="koboSpan" id="kobo.245.1">Applying a Microservice Architecture to Your Enterprise Application</span></em><span class="koboSpan" id="kobo.246.1">.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.247.1">Timer Trigger</span></strong><span class="koboSpan" id="kobo.248.1">: This is commonly used with functions and is where you specify time triggers so that you can continuously process data from your system.</span></li>
</ul>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.249.1">You can find the complete list of triggers</span><a id="_idIndexMarker1155"/><span class="koboSpan" id="kobo.250.1"> and bindings available for Azure Functions at </span><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings"><span class="url"><span class="koboSpan" id="kobo.251.1">https://docs.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings</span></span></a><span class="koboSpan" id="kobo.252.1">.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.253.1">With a solid understanding of how</span><a id="_idIndexMarker1156"/><span class="koboSpan" id="kobo.254.1"> to program Azure Functions in C#, let’s now ensure their longevity and performance. </span><span class="koboSpan" id="kobo.254.2">In the upcoming section, we will uncover the best practices and tools necessary for the effective management and monitoring of your serverless architecture.</span></p>
<h1 class="heading-1" id="_idParaDest-334"><span class="koboSpan" id="kobo.255.1">Maintaining Azure Functions</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.256.1">Once you have created and programmed</span><a id="_idIndexMarker1157"/><span class="koboSpan" id="kobo.257.1"> your function, you need to monitor and maintain it. </span><span class="koboSpan" id="kobo.257.2">To do this, you can use a variety of tools, all of which you can find in the Azure portal. </span><span class="koboSpan" id="kobo.257.3">These tools will help you solve problems due to the amount of information you will be able to collect with them.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.258.1">The first option when it comes to monitoring your function is using the </span><strong class="keyWord"><span class="koboSpan" id="kobo.259.1">Monitor</span></strong><span class="koboSpan" id="kobo.260.1"> menu inside the Azure Functions interface in the Azure portal. </span><span class="koboSpan" id="kobo.260.2">There, you will be able to check all your function executions, including successful results and failures:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.261.1"><img alt="" role="presentation" src="../Images/B19820_16_07.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.262.1">Figure 16.7: Monitoring a function</span></p>
<p class="normal"><span class="koboSpan" id="kobo.263.1">It will take about 5 minutes for any results to be available. </span><span class="koboSpan" id="kobo.263.2">The date shown in the grid is in UTC time.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.264.1">By clicking on </span><strong class="screenText"><span class="koboSpan" id="kobo.265.1">Run query in Application Insights</span></strong><span class="koboSpan" id="kobo.266.1">, the same interface</span><a id="_idIndexMarker1158"/><span class="koboSpan" id="kobo.267.1"> allows you to connect to this tool. </span><span class="koboSpan" id="kobo.267.2">This will take you to a world of almost infinite options that you can use to analyze</span><a id="_idIndexMarker1159"/><span class="koboSpan" id="kobo.268.1"> your function data. </span><span class="koboSpan" id="kobo.268.2">Application Insights is an excellent option for </span><strong class="keyWord"><span class="koboSpan" id="kobo.269.1">Application Performance Management</span></strong><span class="koboSpan" id="kobo.270.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.271.1">APM</span></strong><span class="koboSpan" id="kobo.272.1">):</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.273.1"><img alt="" role="presentation" src="../Images/B19820_16_08.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.274.1">Figure 16.8: Monitoring using Application Insights</span></p>
<p class="normal"><span class="koboSpan" id="kobo.275.1">Beyond the query interface, you can also check all the performance issues of your function using the Application Insights interface in the Azure portal. </span><span class="koboSpan" id="kobo.275.2">There, you can analyze and filter all the requests that have been received by your solution and check their performance and dependencies. </span><span class="koboSpan" id="kobo.275.3">You can also trigger alerts when something abnormal happens to one of your endpoints.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.276.1">You can find this resource in the Azure</span><a id="_idIndexMarker1160"/><span class="koboSpan" id="kobo.277.1"> portal by selecting your function resource and searching for </span><strong class="keyWord"><span class="koboSpan" id="kobo.278.1">Application Insights</span></strong><span class="koboSpan" id="kobo.279.1">.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.280.1"><img alt="" role="presentation" src="../Images/B19820_16_09.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.281.1">Figure 16.9: Monitoring using Application Insights live metrics</span></p>
<p class="normal"><span class="koboSpan" id="kobo.282.1">As a software architect, you will find a good daily helper for your projects in this tool. </span><span class="koboSpan" id="kobo.282.2">Please remember that Application Insights works on several other Azure services, such as Web Apps and Virtual Machines. </span><span class="koboSpan" id="kobo.282.3">This means</span><a id="_idIndexMarker1161"/><span class="koboSpan" id="kobo.283.1"> that you can monitor the health of your system and maintain it using the wonderful features provided by Azure.</span></p>
<h1 class="heading-1" id="_idParaDest-335"><span class="koboSpan" id="kobo.284.1">Azure Durable Functions</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.285.1">If you decide to delve deeper</span><a id="_idIndexMarker1162"/><span class="koboSpan" id="kobo.286.1"> into the usage of serverless, you may consider Azure Durable Functions as a good option for designing orchestration scenarios. </span><span class="koboSpan" id="kobo.286.2">Azure Durable Functions let us write stateful workflows, managing the state behind the scenes. </span><span class="koboSpan" id="kobo.286.3">To do so, you</span><a id="_idIndexMarker1163"/><span class="koboSpan" id="kobo.287.1"> will have to write an </span><strong class="keyWord"><span class="koboSpan" id="kobo.288.1">orchestrator function</span></strong><span class="koboSpan" id="kobo.289.1">, which is basically a procedure that defines the workflow that you want to run. </span><span class="koboSpan" id="kobo.289.2">You may</span><a id="_idIndexMarker1164"/><span class="koboSpan" id="kobo.290.1"> also need some </span><strong class="keyWord"><span class="koboSpan" id="kobo.291.1">entity functions</span></strong><span class="koboSpan" id="kobo.292.1"> to enable the reading of small pieces of state.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.293.1">The following are some application patterns where this solution can be used; however, it is important to remember that it is not suitable for all applications:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.294.1">Function chaining</span></strong><span class="koboSpan" id="kobo.295.1">: When you need to execute a sequence of functions in a particular order.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.296.1">Async HTTP APIs</span></strong><span class="koboSpan" id="kobo.297.1">: A good way to solve long-running operations with external clients, where you will have the opportunity to get a status API because of the orchestrator function. </span><span class="koboSpan" id="kobo.297.2">There is a sample code of this pattern as soon as you create an orchestrator function in Visual Studio.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.298.1">Fan-out/fan-in</span></strong><span class="koboSpan" id="kobo.299.1">: The ability to run multiple functions in parallel and wait for them to finish to conclude work in an aggregate function.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.300.1">Monitors</span></strong><span class="koboSpan" id="kobo.301.1">: A way to monitor a process without using a timer trigger, enabling configured intervals to monitor many instances of a process.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.302.1">Human interaction</span></strong><span class="koboSpan" id="kobo.303.1">: A way to automate a process even when you need human interaction, but you need to monitor the response after a period.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.304.1">Aggregator</span></strong><span class="koboSpan" id="kobo.305.1">: A way to address event data over a period into a single entity.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.306.1">When it comes to pricing, we should keep in mind that Azure Durable Functions are billed the same way common Azure Functions are. </span><span class="koboSpan" id="kobo.306.2">The only concern you must consider is that orchestrator functions might replay several times throughout the lifetime of an orchestration, and you will be billed for each replay.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.307.1">Once we have covered the possibilities presented by Azure Durable Functions, it is also important to evaluate the roadmap of Azure Functions. </span><span class="koboSpan" id="kobo.307.2">The reason why we keep writing about this arises from the changes Azure Functions has suffered since its creation. </span><span class="koboSpan" id="kobo.307.3">Considering that a serverless application based on Azure Functions can be the kernel of your solution, this is a very important topic that needs to be discussed. </span><span class="koboSpan" id="kobo.307.4">Let’s check it out now.</span></p>
<h1 class="heading-1" id="_idParaDest-336"><span class="koboSpan" id="kobo.308.1">Azure Functions roadmap</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.309.1">The structure of Azure Functions</span><a id="_idIndexMarker1165"/><span class="koboSpan" id="kobo.310.1"> has changed since it was rolled out in 2016. </span><span class="koboSpan" id="kobo.310.2">The number of people using the tool and the changes related to .NET caused some compatibility problems that saw Microsoft come up with a new way of delivering the deployment of functions. </span><span class="koboSpan" id="kobo.310.3">This new way is called the isolated process model, and it has been available since .NET 5. </span><span class="koboSpan" id="kobo.310.4">It is also important to mention that the currently supported available runtime versions for Azure Functions are v1 and v4. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.311.1">According to the current roadmap, using the isolated process model is the only way to run Azure Functions in .NET 8 and future versions. </span><span class="koboSpan" id="kobo.311.2">There is a plan to have the in-process model for .NET 8, but no date has been confirmed yet.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.312.1"><img alt="thumbnail image 1 captioned A diagram showing the change in release patterns after parity. .NET 8 has an in-process model option on a delay after the isolated worker model. All subsequent updates use the isolated worker model." src="../Images/B19820_16_10.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.313.1">Figure 16.10: Azure Functions roadmap</span></p>
<p class="normal"><span class="koboSpan" id="kobo.314.1">As a software architect, you must keep</span><a id="_idIndexMarker1166"/><span class="koboSpan" id="kobo.315.1"> an eye on the roadmaps provided so that you can decide on the best implementation for your solution.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.316.1">When implementing an Azure function using the isolated process model, you will have access to the startup of the function in a </span><code class="inlineCode"><span class="koboSpan" id="kobo.317.1">Program.cs</span></code><span class="koboSpan" id="kobo.318.1"> file. </span><span class="koboSpan" id="kobo.318.2">This means that you will have to configure and create the instance of your function:</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.319.1">var</span></span><span class="koboSpan" id="kobo.320.1"> host = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.321.1">new</span></span><span class="koboSpan" id="kobo.322.1"> HostBuilder()
    .ConfigureFunctionsWorkerDefaults()
    .ConfigureServices(services =&gt;
    {
        services.AddApplicationInsightsTelemetryWorkerService();
        services.ConfigureFunctionsApplicationInsights();
    })
    .Build();
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.323.1">It is worth mentioning</span><a id="_idIndexMarker1167"/><span class="koboSpan" id="kobo.324.1"> that to do so, you will need </span><code class="inlineCode"><span class="koboSpan" id="kobo.325.1">Microsoft.Azure.Functions.Worker.Extensions</span></code><span class="koboSpan" id="kobo.326.1"> packages. </span><span class="koboSpan" id="kobo.326.2">You can</span><a id="_idIndexMarker1168"/><span class="koboSpan" id="kobo.327.1"> find a very good guide to doing this at </span><a href="https://docs.microsoft.com/en-us/azure/azure-functions/dotnet-isolated-process-guide"><span class="url"><span class="koboSpan" id="kobo.328.1">https://docs.microsoft.com/en-us/azure/azure-functions/dotnet-isolated-process-guide</span></span></a><span class="koboSpan" id="kobo.329.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-337"><span class="koboSpan" id="kobo.330.1">The decision to use serverless and Azure Functions</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.331.1">Even with the benefits presented during</span><a id="_idIndexMarker1169"/><span class="koboSpan" id="kobo.332.1"> this chapter, there is always</span><a id="_idIndexMarker1170"/><span class="koboSpan" id="kobo.333.1"> a question about why one would use a serverless function over having it as part of a bigger web application. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.334.1">If you think exclusively about HTTP Trigger functions, this question is more difficult to answer because you can create a Web API application that generally solves the problems in this scenario.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.335.1">However, there are some use cases where an Azure Function is truly the best option. </span><span class="koboSpan" id="kobo.335.2">Let’s list them to help you with this decision in your scenario:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.336.1">When you need to execute a periodic task</span></strong><span class="koboSpan" id="kobo.337.1">: Azure Functions with </span><em class="italic"><span class="koboSpan" id="kobo.338.1">Timer Trigger</span></em><span class="koboSpan" id="kobo.339.1"> is, for sure, a great option. </span><span class="koboSpan" id="kobo.339.2">Using Cron expressions, you will be able to set different periods</span><a id="_idIndexMarker1171"/><span class="koboSpan" id="kobo.340.1"> to have your function running. </span><span class="koboSpan" id="kobo.340.2">You can check out more details at </span><a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-bindings-timer"><span class="url"><span class="koboSpan" id="kobo.341.1">https://learn.microsoft.com/en-us/azure/azure-functions/functions-bindings-timer</span></span></a><span class="koboSpan" id="kobo.342.1">.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.343.1">When you want to execute a task after some data changes</span></strong><span class="BS---InfoBox-Normal--PACKT--Char"><span class="koboSpan" id="kobo.344.1">: By</span></span><span class="koboSpan" id="kobo.345.1"> using triggers like </span><em class="italic"><span class="koboSpan" id="kobo.346.1">Blob Trigger</span></em><span class="koboSpan" id="kobo.347.1">, </span><em class="italic"><span class="koboSpan" id="kobo.348.1">Queue Trigger</span></em><span class="koboSpan" id="kobo.349.1">, or </span><em class="italic"><span class="koboSpan" id="kobo.350.1">CosmosDB Trigger</span></em><span class="koboSpan" id="kobo.351.1">, you can monitor data changes and subsequently execute a specific task in response to these changes, which</span><a id="_idIndexMarker1172"/><span class="koboSpan" id="kobo.352.1"> may be useful in some scenarios. </span><span class="koboSpan" id="kobo.352.2">There is a great example of how to use it at </span><a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-create-cosmos-db-triggered-function"><span class="url"><span class="koboSpan" id="kobo.353.1">https://learn.microsoft.com/en-us/azure/azure-functions/functions-create-cosmos-db-triggered-function</span></span></a><span class="koboSpan" id="kobo.354.1">.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.355.1">When you want to execute a task after some event happens on devices or another system</span></strong><span class="koboSpan" id="kobo.356.1">: Again, without needing to pool data, you can use </span><em class="italic"><span class="koboSpan" id="kobo.357.1">Event Grid Trigger</span></em><span class="koboSpan" id="kobo.358.1">, </span><em class="italic"><span class="koboSpan" id="kobo.359.1">Event Hub Trigger</span></em><span class="koboSpan" id="kobo.360.1">, </span><em class="italic"><span class="koboSpan" id="kobo.361.1">IoT Hub Trigger</span></em><span class="koboSpan" id="kobo.362.1">, or </span><em class="italic"><span class="koboSpan" id="kobo.363.1">Service Bus Queue Trigger</span></em><span class="koboSpan" id="kobo.364.1"> to track an event and start a task with the information provided by it. </span><span class="koboSpan" id="kobo.364.2">You can check</span><a id="_idIndexMarker1173"/><span class="koboSpan" id="kobo.365.1"> out more information about it at </span><a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-bindings-event-hubs-trigger"><span class="url"><span class="koboSpan" id="kobo.366.1">https://learn.microsoft.com/en-us/azure/azure-functions/functions-bindings-event-hubs-trigger</span></span></a><span class="koboSpan" id="kobo.367.1">.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.368.1">To make this decision easier, in </span><em class="italic"><span class="koboSpan" id="kobo.369.1">Chapter 21</span></em><span class="koboSpan" id="kobo.370.1">, </span><em class="italic"><span class="koboSpan" id="kobo.371.1">Case Study</span></em><span class="koboSpan" id="kobo.372.1">, you will find the complete tutorial to implement the architecture presented below.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.373.1">To give users a great experience, all the emails that are sent by the application will be queued asynchronously, thereby preventing significant delays in the system’s responses.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.374.1"><img alt="Diagram  Description automatically generated" src="../Images/B19820_16_11.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.375.1">Figure 16.11: Architectural design for sending emails</span></p>
<p class="normal"><span class="koboSpan" id="kobo.376.1">The great thing about this design is that although you have a solution with different components, you cannot recognize some computational characteristics, like the amount of memory used, the number of CPUs designed for this process, or even the storage needed to guarantee the solution quality. </span><span class="koboSpan" id="kobo.376.2">This is what we call serverless in its essential meaning – a solution where</span><a id="_idIndexMarker1174"/><span class="koboSpan" id="kobo.377.1"> the focus is not on where</span><a id="_idIndexMarker1175"/><span class="koboSpan" id="kobo.378.1"> the code runs.</span></p>
<h1 class="heading-1" id="_idParaDest-338"><span class="koboSpan" id="kobo.379.1">Summary</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.380.1">In this chapter, we looked at some of the advantages of developing functionality with serverless Azure Functions. </span><span class="koboSpan" id="kobo.380.2">You can use it as a guideline to check the different types of triggers that are available in Azure Functions and to plan how to monitor them. </span><span class="koboSpan" id="kobo.380.3">We also saw how to program and maintain Azure Functions.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.381.1">In the next chapter, we will discuss the current news related to ASP.NET Core MVC.</span></p>
<h1 class="heading-1" id="_idParaDest-339"><span class="koboSpan" id="kobo.382.1">Questions</span></h1>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.383.1">What are Azure Functions?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.384.1">What are the programming options for Azure Functions?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.385.1">What are the plans that can be used with Azure Functions?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.386.1">How can you deploy Azure Functions with Visual Studio?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.387.1">What triggers can you use to develop Azure Functions?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.388.1">What is the difference between Azure Functions v1, v2, v3, and v4?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.389.1">How does Application Insights help us to maintain and monitor Azure Functions?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.390.1">What are Azure Durable Functions?</span></li>
</ol>
<h1 class="heading-1" id="_idParaDest-340"><span class="koboSpan" id="kobo.391.1">Further reading</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.392.1">If you want to learn more about creating Azure functions, check out the following links:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.393.1">Azure Functions scale and hosting: </span><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-scale"><span class="url"><span class="koboSpan" id="kobo.394.1">https://docs.microsoft.com/en-us/azure/azure-functions/functions-scale</span></span></a></li>
<li class="bulletList"><em class="italic"><span class="koboSpan" id="kobo.395.1">Microsoft Azure For .NET Developers [Video], by Trevoir Williams: </span></em><a href="https://www.packtpub.com/product/microsoft-azure-for-net-developers-video/9781835465059"><span class="url"><span class="koboSpan" id="kobo.396.1">https://www.packtpub.com/product/microsoft-azure-for-net-developers-video/9781835465059</span></span></a></li>
<li class="bulletList"><em class="italic"><span class="koboSpan" id="kobo.397.1">Azure Serverless Computing Cookbook - Third Edition, by Praveen Kumar Sreeram: </span></em><a href="https://www.packtpub.com/product/azure-serverless-computing-cookbook-third-edition/9781800206601"><span class="url"><span class="koboSpan" id="kobo.398.1">https://www.packtpub.com/product/azure-serverless-computing-cookbook-third-edition/9781800206601</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.399.1">Azure Functions runtime overview: </span><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-versions"><span class="url"><span class="koboSpan" id="kobo.400.1">https://docs.microsoft.com/en-us/azure/azure-functions/functions-versions</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.401.1">An overview of Azure Event Grid: </span><a href="https://docs.microsoft.com/en-us/azure/event-grid/"><span class="url"><span class="koboSpan" id="kobo.402.1">https://docs.microsoft.com/en-us/azure/event-grid/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.403.1">Timer trigger for Azure Functions: </span><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-timer "><span class="url"><span class="koboSpan" id="kobo.404.1">https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-timer</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.405.1">The </span><em class="italic"><span class="koboSpan" id="kobo.406.1">Application Insights</span></em><span class="koboSpan" id="kobo.407.1"> section of the book </span><em class="italic"><span class="koboSpan" id="kobo.408.1">Azure for Architects</span></em><span class="koboSpan" id="kobo.409.1">, by Ritesh Modi: </span><a href="https://subscription.packtpub.com/book/virtualization_and_cloud/9781788397391/12/ch12lvl1sec95/application-insights "><span class="url"><span class="koboSpan" id="kobo.410.1">https://subscription.packtpub.com/book/virtualization_and_cloud/9781788397391/12/ch12lvl1sec95/application-insights</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.411.1">The </span><em class="italic"><span class="koboSpan" id="kobo.412.1">Monitoring Azure Functions using the Application Insights</span></em><span class="koboSpan" id="kobo.413.1"> section of the book </span><em class="italic"><span class="koboSpan" id="kobo.414.1">Azure Serverless Computing Cookbook</span></em><span class="koboSpan" id="kobo.415.1">, by Praveen Kumar Sreeram: </span><a href="https://subscription.packtpub.com/book/virtualization_and_cloud/9781788390828/6/06lvl1sec34/monitoring-azure-functions-using-application-insights"><span class="url"><span class="koboSpan" id="kobo.416.1">https://subscription.packtpub.com/book/virtualization_and_cloud/9781788390828/6/06lvl1sec34/monitoring-azure-functions-using-application-insights</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.417.1">Get started with Azure Queue storage using .NET: </span><a href="https://docs.microsoft.com/en-us/azure/storage/queues/storage-dotnet-how-to-use-queues"><span class="url"><span class="koboSpan" id="kobo.418.1">https://docs.microsoft.com/en-us/azure/storage/queues/storage-dotnet-how-to-use-queues</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.419.1">Azure Functions triggers and bindings concepts: </span><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings"><span class="url"><span class="koboSpan" id="kobo.420.1">https://docs.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.421.1">Azure Queue Storage bindings for Azure Functions: </span><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-storage-queue"><span class="url"><span class="koboSpan" id="kobo.422.1">https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-storage-queue</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.423.1">Azure emulator for local Azure Storage Development: </span><a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-use-azurite"><span class="url"><span class="koboSpan" id="kobo.424.1">https://docs.microsoft.com/en-us/azure/storage/common/storage-use-azurite</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.425.1">Azure Durable Functions: </span><a href="https://docs.microsoft.com/en-us/azure/azure-functions/durable/   "><span class="url"><span class="koboSpan" id="kobo.426.1">https://docs.microsoft.com/en-us/azure/azure-functions/durable/</span></span></a></li>
</ul>
<p class="normal"><a href="https://docs.microsoft.com/en-us/azure/azure-functions/durable/   "/></p>
<p class="normal"><a href="https://docs.microsoft.com/en-us/azure/azure-functions/durable/   "/></p>
<h1 class="heading-1"><span class="koboSpan" id="kobo.427.1">Learn more on Discord</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.428.1">To join the Discord community for this book – where you can share feedback, ask questions to the authors, and learn about new releases – follow the QR code below:</span></p>
<p class="normal"><a href="https://packt.link/SoftwareArchitectureCSharp12Dotnet8"><span class="url"><span class="koboSpan" id="kobo.429.1">https://packt.link/SoftwareArchitectureCSharp12Dotnet8</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.430.1"><img alt="" role="presentation" src="../Images/QR_Code175081751210902046.png"/></span></p>
</div>
</body></html>