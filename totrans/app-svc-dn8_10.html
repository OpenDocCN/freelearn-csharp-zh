<html><head></head><body>
  <div><h1 class="chapterNumber">10</h1>
    <h1 class="chapterTitle" id="_idParaDest-379">Building Serverless Nanoservices Using Azure Functions</h1>
    <p class="normal">In this chapter, you will be introduced to Azure Functions, which can be configured to only require server-side resources while they execute. They execute when they are triggered by an activity like a message sent to a queue or a file uploaded to Azure Storage, or at a regularly scheduled interval.</p>
    <p class="normal">This chapter will cover the following topics:</p>
    <ul>
      <li class="bulletList">Understanding Azure Functions</li>
      <li class="bulletList">Building an Azure Functions project</li>
      <li class="bulletList">Responding to timer and resource triggers</li>
      <li class="bulletList">Publishing an Azure Functions project to the cloud</li>
      <li class="bulletList">Cleaning up Azure Functions resources</li>
    </ul>
    <h1 class="heading-1" id="_idParaDest-380">Understanding Azure Functions</h1>
    <p class="normal"><strong class="keyWord">Azure Functions</strong> is an event-driven <a id="_idIndexMarker1027"/>serverless compute platform. You can build and debug locally and later deploy to Microsoft Azure cloud. Azure Functions can be implemented in many languages, not just C# and .NET. It has extensions for Visual Studio 2022 and Visual Studio Code and a command-line tool.</p>
    <p class="normal">But first, you might be wondering, “How is it possible to have a service without a server?”</p>
    <p class="normal"><em class="italic">Serverless</em> does not literally mean there is no server. What serverless means is a service without a <em class="italic">permanently running server</em>, and usually that means not running for most of the time or running with low resources and scaling up dynamically when needed. This can save a lot of costs.</p>
    <p class="normal">For example, organizations often have business functions that only need to run once per hour, once per month, or on an ad hoc basis. Perhaps the organization prints checks (cheques in England) to pay its employees at the end of the month. Those checks might need the salary amounts converted to words to print on the check. A function to convert numbers to words could be implemented as a serverless service. </p>
    <p class="normal">For another example, with a content management system, editors might upload new images, and those images might need to be processed in various ways, like generating thumbnails and other optimizations. This work can be added to a queue, or an Azure function can be triggered<a id="_idIndexMarker1028"/> when the file is uploaded to Blob Storage.</p>
    <p class="normal">Azure Functions can be much more than just a single function. They support complex, stateful, workflows and event-driven<a id="_idIndexMarker1029"/> solutions using <strong class="keyWord">Durable Functions</strong>.</p>
    <div><p class="normal">I do not cover Durable Functions in this book, so if you are interested, you can learn more about implementing them using C# and .NET at the following link: <a href="https://learn.microsoft.com/en-us/azure/azure-functions/durable/durable-functions-overview?tabs=csharp">https://learn.microsoft.com/en-us/azure/azure-functions/durable/durable-functions-overview?tabs=csharp</a>.</p>
    </div>
    <p class="normal">Azure Functions has a programming model based on triggers and bindings that enable your serverless service to respond to events and connect to other services like data stores.</p>
    <h2 class="heading-2" id="_idParaDest-381">Azure Functions triggers and bindings</h2>
    <p class="normal"><strong class="keyWord">Triggers</strong> and <strong class="keyWord">bindings</strong> are key <a id="_idIndexMarker1030"/>concepts for Azure Functions.</p>
    <p class="normal">Triggers are what <a id="_idIndexMarker1031"/>cause a function to execute. Each function must have one, and only one, trigger. The most common triggers are shown in the following list:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">HTTP</strong>: This trigger responds to an<a id="_idIndexMarker1032"/> incoming HTTP request, typically a <code class="inlineCode">GET</code> or <code class="inlineCode">POST</code>.</li>
      <li class="bulletList"><strong class="keyWord">Azure SQL</strong>: This trigger responds <a id="_idIndexMarker1033"/>when a change is detected on a SQL table.</li>
      <li class="bulletList"><strong class="keyWord">Cosmos DB</strong>: This trigger<a id="_idIndexMarker1034"/> uses the Cosmos DB Change Feed to listen for inserts and updates.</li>
      <li class="bulletList"><strong class="keyWord">Timer</strong>: This trigger<a id="_idIndexMarker1035"/> responds to a scheduled time occurring. It does not retry if a function fails. The function is not called again until the next time on the schedule.</li>
      <li class="bulletList"><strong class="keyWord">SignalR</strong>: This trigger<a id="_idIndexMarker1036"/> responds to messages sent from Azure SignalR Service.</li>
      <li class="bulletList"><strong class="keyWord">Queue</strong> and <strong class="keyWord">RabbitMQ</strong>: These triggers<a id="_idIndexMarker1037"/> respond to a message arriving in a queue <a id="_idIndexMarker1038"/>ready for processing.</li>
      <li class="bulletList"><strong class="keyWord">Blob Storage</strong>: This<a id="_idIndexMarker1039"/> trigger responds<a id="_idIndexMarker1040"/> to a new or<a id="_idIndexMarker1041"/> updated <strong class="keyWord">binary large object </strong>(<strong class="keyWord">Blob</strong>).</li>
      <li class="bulletList"><strong class="keyWord">Event Grid</strong> and <strong class="keyWord">Event Hub</strong>: These triggers<a id="_idIndexMarker1042"/> respond when a predefined event occurs.</li>
    </ul>
    <p class="normal">Bindings allow functions to have inputs and outputs. Each function can have zero, one, or more bindings. Some common bindings are shown in the following list:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Azure SQL</strong>: Read or write to <a id="_idIndexMarker1043"/>a table in a SQL Server database.</li>
      <li class="bulletList"><strong class="keyWord">Blob Storage</strong>: Read or <a id="_idIndexMarker1044"/>write to any file stored as a BLOB.</li>
      <li class="bulletList"><strong class="keyWord">Cosmos DB</strong>: Read or <a id="_idIndexMarker1045"/>write documents to a cloud-scale data store.</li>
      <li class="bulletList"><strong class="keyWord">SignalR</strong>: Receive or <a id="_idIndexMarker1046"/>make remote method calls.</li>
      <li class="bulletList"><strong class="keyWord">HTTP</strong>: Make an HTTP<a id="_idIndexMarker1047"/> request and receive the response.</li>
      <li class="bulletList"><strong class="keyWord">Queue</strong> and <strong class="keyWord">RabbitMQ</strong>: Write a message to a queue or read a message from a queue.</li>
      <li class="bulletList"><strong class="keyWord">SendGrid</strong>: Send an <a id="_idIndexMarker1048"/>email message.</li>
      <li class="bulletList"><strong class="keyWord">Twilio</strong>: Send an<a id="_idIndexMarker1049"/> SMS message.</li>
      <li class="bulletList"><strong class="keyWord">IoT hub</strong>: Write to an<a id="_idIndexMarker1050"/> internet-connected device.</li>
    </ul>
    <div><p class="normal">You can see the full list of supported triggers and bindings at the following link: <a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings?tabs=csharp#supported-bindings">https://learn.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings?tabs=csharp#supported-bindings</a>.</p>
    </div>
    <p class="normal">Triggers and bindings are configured differently for different languages. For C# and Java, you decorate methods and parameters with attributes. For the other languages, you configure a file named <code class="inlineCode">function.json</code>.</p>
    <h2 class="heading-2" id="_idParaDest-382">NCRONTAB expressions</h2>
    <p class="normal">The <strong class="keyWord">Timer</strong> trigger<a id="_idIndexMarker1051"/> uses <strong class="keyWord">NCRONTAB expressions</strong> to define the frequency of<a id="_idIndexMarker1052"/> the timer. The default time zone is <strong class="keyWord">Coordinated Universal Time</strong> (<strong class="keyWord">UTC</strong>). This can be overridden but you really should use UTC for the reasons you learned <a id="_idIndexMarker1053"/>about in <em class="chapterRef">Chapter 7</em>, <em class="italic">Handling Dates, Times, and Internationalization</em>.</p>
    <p class="normal">If you are hosting in an App Service plan, then you can alternatively use a <code class="inlineCode">TimeSpan</code>, but I recommend learning NCRONTAB expressions for flexibility.</p>
    <p class="normal">An NCRONTAB expression consists of five or six parts (if seconds are included):</p>
    <pre class="programlisting gen"><code class="hljs"><code class="inlineCode">* * * * * *</code>
<code class="inlineCode">- - - - - -</code>
<code class="inlineCode">| | | | | |</code>
<code class="inlineCode">| | | | | +--- day of week (0 - 6) (Sunday=0)</code>
<code class="inlineCode">| | | | +----- month (1 - 12)</code>
<code class="inlineCode">| | | +------- day of month (1 - 31)</code>
<code class="inlineCode">| | +--------- hour (0 - 23)</code>
<code class="inlineCode">| +----------- min (0 - 59)</code>
<code class="inlineCode">+------------- sec (0 - 59)</code>
</code></pre>
    <p class="normal">A star <code class="inlineCode">*</code> in the value field above means all legal values, as in parentheses for that column. You can specify ranges using a hyphen, and a step value using <code class="inlineCode">/</code>. Here are some examples of how values can be specified in this format:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">0</code> means at that value. For example, for hours, at midnight.</li>
      <li class="bulletList"><code class="inlineCode">0,6,12,18</code> means at those listed values. For example, for hours, at midnight, 6 a.m., 12 noon, and 6 p.m.</li>
      <li class="bulletList"><code class="inlineCode">3-7</code> means at that inclusive range of values. For example, for hours, at 3 a.m., 4 a.m., 5 a.m., 6 a.m., and 7 a.m.</li>
      <li class="bulletList"><code class="inlineCode">4/3</code> means a start value of <code class="inlineCode">4</code> and a step value of <code class="inlineCode">3</code>. For example, for hours, at 4 a.m., 7 a.m., 10 a.m., 1 p.m., 4 p.m., 7 p.m., and 10 p.m.</li>
    </ul>
    <p class="normal"><em class="italic">Table 10.1</em> shows some more examples:</p>
    <table class="table-container" id="table001-8">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Expression</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">0 5 * * * *</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Once every hour of the day at minute 5 of each hour.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">0 0,10,30,40 * * * *</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Four times an hour – at minutes 0, 10, 30, and 40 during every hour.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">* * */2 * * *</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Every 2 hours.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">0,15 * * * * *</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">At 0 and 15 seconds every minute.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">0/15 * * * * *</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">At 0, 15, 30, and 45 seconds every minute, aka every 15 seconds.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">0-15 * * * * *</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">At 0, 1, 2, 3, and so on up to 15 seconds past each minute, but not 16 to 59 seconds past each minute.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">0 30 9-16 * * *</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Eight times a day – at hours 9:30 A.M, 10:30 A.M, and so on up to 4:30 P.M.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">0 */5 * * * *</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">12 times an hour – at second 0 of every 5<sup class="superscript">th</sup> minute of every hour.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">0 0 */4 * * *</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">6 times a day – at minute 0 of every 4<sup class="superscript">th</sup> hour of every day.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">0 30 9 * * *</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">9:30 AM every day.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">0 30 9 * * 1-5</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">9:30 AM every workday.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">0 30 9 * * Mon-Fri</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">9:30 AM every workday.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">0 30 9 * Jan Mon</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">9:30 AM every Monday in January.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 10.1: Examples of NCRONTAB expressions</p>
    <p class="normal">Now let’s build a simple console app <a id="_idIndexMarker1054"/>to test your understanding <a id="_idIndexMarker1055"/>of NCRONTAB expressions:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Use your preferred code editor to add a new console app named <code class="inlineCode">NCrontab.Console</code> to a <code class="inlineCode">Chapter10</code> solution.</li>
      <li class="numberedList">In the <code class="inlineCode">NCrontab.Console</code> project, treat warnings as errors, globally and statically import the <code class="inlineCode">System.Console</code> class, and add a package reference for <code class="inlineCode">NCrontab.Signed</code>, as shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;PackageReference Include="NCrontab.Signed" Version="3.3.3" /&gt;
&lt;/ItemGroup&gt;
</code></pre>
      
    <div><p class="normal">The NCRONTAB library is only for parsing expressions. It is not itself a scheduler. You can learn more about it in the GitHub repository at the following link: <a href="https://github.com/atifaziz/NCrontab">https://github.com/atifaziz/NCrontab</a>.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">Build the <code class="inlineCode">NCrontab.Console</code> project to restore packages.</li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete the existing statements. Add statements to define a date range for the <a id="_idIndexMarker1056"/>year 2023, output a summary of NCRONTAB syntax, and construct an NCRONTAB schedule, and then use it to output the next 40 occurrences that <a id="_idIndexMarker1057"/>would occur in 2023, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using NCrontab; // To use CrontabSchedule and so on.
DateTime start = new(year: 2023, month: 1, day: 1);
DateTime end = start.AddYears(1);
WriteLine($"Start at:   {start:ddd, dd MMM yyyy HH:mm:ss}");
WriteLine($"End at:     {end:ddd, dd MMM yyyy HH:mm:ss}");
WriteLine();
string sec = "0,30";
string min = "*";
string hour = "*";
string dayOfMonth = "*";
string month = "*";
string dayOfWeek = "*";
string expression = string.Format(
  "{0,-3} {1,-3} {2,-3} {3,-3} {4,-3} {5,-3}",
  sec, min, hour, dayOfMonth, month, dayOfWeek);
WriteLine($"Expression: {expression}");
WriteLine(@"            \ / \ / \ / \ / \ / \ /");
WriteLine($"             -   -   -   -   -   -");
WriteLine($"             |   |   |   |   |   |");
WriteLine($"             |   |   |   |   |   +--- day of week (0 - 6) (Sunday=0)");
WriteLine($"             |   |   |   |   +------- month (1 - 12)");
WriteLine($"             |   |   |   +----------- day of month (1 - 31)");
WriteLine($"             |   |   +--------------- hour (0 - 23)");
WriteLine($"             |   +------------------- min (0 - 59)");
WriteLine($"             +----------------------- sec (0 - 59)");
WriteLine();
CrontabSchedule schedule = CrontabSchedule.Parse(expression, 
  new CrontabSchedule.ParseOptions { IncludingSeconds = true });
IEnumerable&lt;DateTime&gt; occurrences = schedule.GetNextOccurrences(start, end);
// Output the first 40 occurrences.
foreach (DateTime occurrence in occurrences.Take(40))
{
  WriteLine($"{occurrence:ddd, dd MMM yyyy HH:mm:ss}");
}
</code></pre>
      
    <p class="normal">Note the following:</p>
    <ul>
      <li class="bulletList">The default <a id="_idIndexMarker1058"/>potential time span for occurrences is the whole year of 2023.</li>
      <li class="bulletList">The default <a id="_idIndexMarker1059"/>expression is <code class="inlineCode">0,30 * * * * *</code>, meaning at 0 and 30 seconds of every minute of every hour of every day of every weekday of every month.</li>
      <li class="bulletList">The formatting for the syntax help assumes each component will be three characters wide because <code class="inlineCode">-3</code> is used for output formatting. You could write a cleverer algorithm to dynamically adjust the arrows to point to variable width components, but I was lazy. I will leave that as an exercise for you.</li>
      <li class="bulletList">Our expression includes seconds, so when parsing, we must set that as an additional option.</li>
      <li class="bulletList">After defining the schedule, the schedule calls its <code class="inlineCode">GetNextOccurrences</code> method to return a sequence of all the calculated occurrences.</li>
      <li class="bulletList">The loop only outputs the first 40 occurrences. That should be enough to understand how most expressions work.</li>
    </ul></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Start the console app without debugging, and note the occurrences are every 30 seconds, as shown in the following partial output:
        <pre class="programlisting con"><code class="hljs-con">Start at:   Sun, 01 Jan 2023 00:00:00
End at:     Mon, 01 Jan 2024 00:00:00
Expression: 0,30 *   *   *   *   *
            \ / \ / \ / \ / \ / \ /
             -   -   -   -   -   -
             |   |   |   |   |   |
             |   |   |   |   |   +--- day of week (0 - 6) (Sunday=0)
             |   |   |   |   +------- month (1 - 12)
             |   |   |   +----------- day of month (1 - 31)
             |   |   +--------------- hour (0 - 23)
             |   +------------------- min (0 - 59)
             +----------------------- sec (0 - 59)
Sun, 01 Jan 2023 00:00:30
Sun, 01 Jan 2023 00:01:00
Sun, 01 Jan 2023 00:01:30
...
Sun, 01 Jan 2023 00:19:30
Sun, 01 Jan 2023 00:20:00
</code></pre>
      
    <div><p class="normal">Note that although the start time is <code class="inlineCode">Sun, 01 Jan 2023 00:00:00</code>, that value is excluded from the occurrences because it is not a “next” occurrence.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Close the console app.</li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, modify the <a id="_idIndexMarker1060"/>components of the expression to test some of the examples in the table, or make up your own<a id="_idIndexMarker1061"/> examples. Try the expression <code class="inlineCode">0 0 */4 * * *</code>, and note it should have the following partial output:
        <pre class="programlisting con"><code class="hljs-con">Start at:   Sun, 01 Jan 2023 00:00:00
End at:     Mon, 01 Jan 2024 00:00:00
Expression: 0   0   */4 *   *   *
            \ / \ / \ / \ / \ / \ /
             -   -   -   -   -   -
             |   |   |   |   |   |
             |   |   |   |   |   +--- day of week (0 - 6) (Sunday=0)
             |   |   |   |   +------- month (1 - 12)
             |   |   |   +----------- day of month (1 - 31)
             |   |   +--------------- hour (0 - 23)
             |   +------------------- min (0 - 59)
             +----------------------- sec (0 - 59)
Sun, 01 Jan 2023 04:00:00
Sun, 01 Jan 2023 08:00:00
Sun, 01 Jan 2023 12:00:00
Sun, 01 Jan 2023 16:00:00
Sun, 01 Jan 2023 20:00:00
Mon, 02 Jan 2023 00:00:00
Mon, 02 Jan 2023 04:00:00
Mon, 02 Jan 2023 08:00:00
Mon, 02 Jan 2023 12:00:00
Mon, 02 Jan 2023 16:00:00
Mon, 02 Jan 2023 20:00:00
Tue, 03 Jan 2023 00:00:00
...
Sat, 07 Jan 2023 12:00:00
Sat, 07 Jan 2023 16:00:00
</code></pre>
      </li>
    </ol>
    <div><p class="normal">Note that although the start time is <code class="inlineCode">Sun, 01 Jan 2023 00:00:00</code>, that value is excluded from the occurrences because it is not a “next” occurrence. So, Sunday only has five occurrences. Monday onward has the expected six occurrences per day.</p>
    </div>
    <h2 class="heading-2" id="_idParaDest-383">Azure Functions versions and languages</h2>
    <p class="normal">Azure Functions version <a id="_idIndexMarker1062"/>4 of the runtime host is the only version still generally available. All older versions have reached end-of-life.</p>
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: Microsoft recommends using v4 for functions in all languages. v1, v2, and v3 are in maintenance mode and should be avoided.</p>
    </div>
    <p class="normal">Languages and platforms supported by Azure Functions v4 include:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">C#, F#</strong>: .NET 8, .NET 7, .NET 6, and .NET Framework 4.8. Note that .NET 6 and .NET 7 (and in future, .NET 9) are only supported in the isolated worker model because they<a id="_idIndexMarker1063"/> are <strong class="keyWord">Standard-Term Support</strong> (<strong class="keyWord">STS</strong>) releases, or, in the case of .NET 6, they are older LTS releases. .NET 8 is supported in both isolated<a id="_idIndexMarker1064"/> and in-process worker models because it is a <strong class="keyWord">Long-Term Support</strong> (<strong class="keyWord">LTS</strong>) release.</li>
      <li class="bulletList"><strong class="keyWord">JavaScript</strong>: Node 14, 16, and 18. TypeScript is supported via transpiling (transforming/compiling) to JavaScript.</li>
      <li class="bulletList"><strong class="keyWord">Java</strong> 8, 11, and 17.</li>
      <li class="bulletList"><strong class="keyWord">PowerShell</strong> 7.2.</li>
      <li class="bulletList"><strong class="keyWord">Python</strong> 3.7, 3.8, 3.9, and 3.10.</li>
    </ul>
    <div><p class="normal"><strong class="keyWord">More Information</strong>: You can review the whole table of languages at the following link: <a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-versions?tabs=v4&amp;pivots=programming-language-csharp#languages">https://learn.microsoft.com/en-us/azure/azure-functions/functions-versions?tabs=v4&amp;pivots=programming-language-csharp#languages</a>.</p>
    </div>
    <p class="normal">In this book, we will only look at implementing Azure Functions using C# and .NET 8 so that we can use the in-process and isolated worker models and get LTS.</p>
    <div><p class="normal">For advanced uses, you <a id="_idIndexMarker1065"/>can even register a custom handler that would enable you to use any language you like for the implementation of an Azure function. You can read more about Azure Functions custom handlers at the following link: <a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-custom-handlers">https://learn.microsoft.com/en-us/azure/azure-functions/functions-custom-handlers</a>.</p>
    </div>
    <h2 class="heading-2" id="_idParaDest-384">Azure Functions worker models</h2>
    <p class="normal">Azure Functions have two worker models, in-process and isolated, as described in the following list:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">In-process</strong>: Your function<a id="_idIndexMarker1066"/> is implemented in a <a id="_idIndexMarker1067"/>class library that must run in the same process as the host, which means your functions must run on the most recent LTS release of .NET. The latest LTS release is .NET 8. The next LTS release will be .NET 10 in November 2025, but .NET 8 will be the last<a id="_idIndexMarker1068"/> release that supports in-process hosting. After .NET 8, only the isolated worker model will be supported for all versions.</li>
      <li class="bulletList"><strong class="keyWord">Isolated</strong>: Your function is implemented in a console app that runs in its own process. Your function<a id="_idIndexMarker1069"/> can therefore execute on any supported .NET version, have full control over its <code class="inlineCode">Main</code> entry point, and have additional features like invocation middleware. From .NET 9 onward, this will be the only worker model. You can read more about this decision at the following link: <a href="https://techcommunity.microsoft.com/t5/apps-on-azure-blog/net-on-azure-functions-august-2023-roadmap-update/ba-p/3910098">https://techcommunity.microsoft.com/t5/apps-on-azure-blog/net-on-azure-functions-august-2023-roadmap-update/ba-p/3910098</a>.</li>
    </ul>
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: New projects should use the isolated worker model.</p>
    </div>
    <h2 class="heading-2" id="_idParaDest-385">Azure Functions hosting plans</h2>
    <p class="normal">After testing locally, you must <a id="_idIndexMarker1070"/>deploy your Azure Functions project to an Azure hosting plan. There are three Azure Functions plans to choose from, as described in the following list:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Consumption</strong>: In this plan, host instances are dynamically added and removed based on activity. This plan is the closest to <em class="italic">serverless</em>. It scales automatically during periods of high load. The cost is only for compute resources when your functions are running. You can configure a timeout for function execution<a id="_idIndexMarker1071"/> times to ensure your functions do not run forever.</li>
      <li class="bulletList"><strong class="keyWord">Premium</strong>: This plan supports elastic scaling up and down, perpetually warm instances to avoid <a id="_idIndexMarker1072"/>cold starts, unlimited execution duration, multicore instance sizes up to four cores, potentially more predictable costs, and high-density app allocation for multiple Azure Functions projects. The cost is based on the number of core seconds and memory allocated across instances. At least one instance must be allocated at all times, so there will always be a minimum monthly cost per active plan, even if it never executes that month.</li>
      <li class="bulletList"><strong class="keyWord">Dedicated</strong>: Executes in the cloud equivalent of a server farm. Hosting is provided by an Azure App Service plan that controls the allocated server resources. Azure App Service plans include Basic, Standard, Premium, and Isolated. This plan<a id="_idIndexMarker1073"/> can be an especially good choice if you already have an App Service plan used for other projects like ASP.NET Core MVC websites, gRPC, OData, and GraphQL services, and so on. The cost is only for the App Service plan. You can host as many Azure Functions and other web apps in it as you like.<div><p class="normal"><strong class="keyWord">Warning!</strong> Premium and Dedicated plans both run on Azure App Service plans. You must carefully select the correct App Service plan that works with your Azure Functions hosting plan. For example, for Premium, you should choose an Elastic Premium plan like <code class="inlineCode">EP1</code>. If you choose an App Service plan like <code class="inlineCode">P1V1</code>, then you are choosing a<a id="_idIndexMarker1074"/> dedicated plan that will not elastically scale!</p>
        </div>
      </li>
    </ul>
    <div><p class="normal">You can read more about your choices at the following link: <a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-scale">https://learn.microsoft.com/en-us/azure/azure-functions/functions-scale</a>.</p>
    </div>
    <h2 class="heading-2" id="_idParaDest-386">Azure Storage requirements</h2>
    <p class="normal">Azure Functions requires an<a id="_idIndexMarker1075"/> Azure Storage account for storing information for some bindings and triggers. These Azure Storage services can also be used by your code for its implementation:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Azure Files</strong>: Stores and runs your function app code in a Consumption or Premium plan.</li>
      <li class="bulletList"><strong class="keyWord">Azure Blob Storage</strong>: Stores state for bindings and function keys.</li>
      <li class="bulletList"><strong class="keyWord">Azure Queue Storage</strong>: Used for failure and retry handling by some triggers.</li>
      <li class="bulletList"><strong class="keyWord">Azure Table Storage</strong>: Task hubs in Durable Functions use Blob, Queue, and Table Storage.</li>
    </ul>
    <h2 class="heading-2" id="_idParaDest-387">Testing locally with Azurite</h2>
    <p class="normal">Azurite is an<a id="_idIndexMarker1076"/> open-source<a id="_idIndexMarker1077"/> local environment for testing Azure Functions with its related Blob, Queue, and Table Storage. Azurite is cross-platform on Windows, Linux, and macOS. Azurite supersedes the older Azure Storage Emulator.</p>
    <p class="normal">To install Azurite:</p>
    <ul>
      <li class="bulletList">For Visual Studio 2022, Azurite is included.</li>
      <li class="bulletList">For Visual Studio Code, search for and install the Azurite extension.</li>
      <li class="bulletList">For JetBrains Rider, install the Azure Toolkit for Rider plugin, which includes Azurite.</li>
      <li class="bulletList">For installation at the command prompt, you must have Node.js version 8 or later installed <a id="_idIndexMarker1078"/>and then you can enter the following command:
        <pre class="programlisting con"><code class="hljs-con">npm install -g azurite
</code></pre>
      </li>
    </ul>
    <p class="normal">Once you have locally tested <a id="_idIndexMarker1079"/>an Azure function, you can switch to an Azure Storage account in the cloud.</p>
    <div><p class="normal">You can learn more<a id="_idIndexMarker1080"/> about Azurite at the following link: <a href="https://learn.microsoft.com/en-us/azure/storage/common/storage-use-azurite">https://learn.microsoft.com/en-us/azure/storage/common/storage-use-azurite</a>.</p>
    </div>
    <h2 class="heading-2" id="_idParaDest-388">Azure Functions authorization levels</h2>
    <p class="normal">Azure Functions has three <a id="_idIndexMarker1081"/>authorization levels that control whether an API key is required:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Anonymous</strong>: No API <a id="_idIndexMarker1082"/>key is required.</li>
      <li class="bulletList"><strong class="keyWord">Function</strong>: A <a id="_idIndexMarker1083"/>function-level key is required.</li>
      <li class="bulletList"><strong class="keyWord">Admin</strong>: The master <a id="_idIndexMarker1084"/>key is required.</li>
    </ul>
    <p class="normal">API keys are available through the Azure portal.</p>
    <h2 class="heading-2" id="_idParaDest-389">Azure Functions support for dependency injection</h2>
    <p class="normal">Dependency injection in <a id="_idIndexMarker1085"/>Azure Functions is built on the standard .NET dependency injection features, but there are implementation differences depending on your chosen worker model.</p>
    <p class="normal">To register dependency services, create a class that inherits from the <code class="inlineCode">FunctionsStartup</code> class and override its <code class="inlineCode">Configure</code> method. Add the <code class="inlineCode">[FunctionsStartup]</code> assembly attribute to specify the class name registered for startup. Add services to the <code class="inlineCode">IFunctionsHostBuilder</code> instance passed to the method. You will do this in a task later in this chapter.</p>
    <p class="normal">Normally, the class that implements an Azure Functions function is <code class="inlineCode">static</code> with a <code class="inlineCode">static</code> method. A <code class="inlineCode">static</code> class is not instantiated with a constructor. Dependency injection uses constructor injection so that means you must use instance classes for injected services and for your function class implementation. You will see how to do this in the coding task.</p>
    <h2 class="heading-2" id="_idParaDest-390">Installing Azure Functions Core Tools</h2>
    <p class="normal"><strong class="keyWord">Azure Functions Core Tools</strong> provides the core runtime and templates for creating functions, which enable local development on Windows, macOS, and Linux using any code editor.</p>
    <div><p class="normal">Azure Functions Core Tools is included in the <strong class="screenText">Azure development</strong> workload of Visual Studio 2022, so you might already have it installed.</p>
    </div>
    <p class="normal">You can install the latest<a id="_idIndexMarker1086"/> version of <strong class="keyWord">Azure Functions Core Tools</strong> from the following link:</p>
    <p class="normal"><a href="https://www.npmjs.com/package/azure-functions-core-tools">https://www.npmjs.com/package/azure-functions-core-tools</a></p>
    <p class="normal">The page found at the <a id="_idIndexMarker1087"/>preceding link has instructions for installing using <strong class="keyWord">Microsoft Software Installer</strong> (<strong class="keyWord">MSI</strong>) and <code class="inlineCode">winget</code> on Windows, Homebrew on Mac, <code class="inlineCode">npm</code> on any operating system, and common Linux distributions.</p>
    <p class="normal">If you are using JetBrains Rider, then install Azure Functions Core Tools via Rider.</p>
    <h1 class="heading-1" id="_idParaDest-391">Building an Azure Functions project</h1>
    <p class="normal">Now, we can create an<a id="_idIndexMarker1088"/> Azure Functions project. Although they can be created in the cloud using the Azure portal, developers will have a better experience creating and running them locally first. You can then deploy to the cloud once you have tested your function on your own computer. </p>
    <p class="normal">Each code editor has a slightly different experience to get started with an Azure Functions project, so let’s have a look at each in turn, starting with Visual Studio 2022.</p>
    <h2 class="heading-2" id="_idParaDest-392">Using Visual Studio 2022</h2>
    <p class="normal">If you prefer to use<a id="_idIndexMarker1089"/> Visual Studio 2022, here are the steps<a id="_idIndexMarker1090"/> to create an Azure Functions project:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">In Visual Studio 2022, create a new project, as defined in the following list:<ul>
          <li class="bulletList">Project template: <strong class="screenText">Azure Functions</strong></li>
          <li class="bulletList">Solution file and folder: <code class="inlineCode">Chapter10</code></li>
          <li class="bulletList">Project file and folder: <code class="inlineCode">Northwind.AzureFunctions.Service</code></li>
          <li class="bulletList"><strong class="screenText">Functions worker</strong>: <strong class="screenText">.NET 8.0 Isolated (Long Term Support)</strong></li>
          <li class="bulletList"><strong class="screenText">Function</strong>: <strong class="screenText">Http trigger</strong></li>
          <li class="bulletList"><strong class="screenText">Use Azurite for runtime storage account (AzureWebJobsStorage)</strong>: Selected</li>
          <li class="bulletList"><strong class="screenText">Enable</strong> <strong class="screenText">Docker</strong>: Cleared</li>
          <li class="bulletList"><strong class="screenText">Authorization level</strong>: <strong class="screenText">Anonymous</strong></li>
        </ul>
      </li>
      <li class="numberedList">Click <strong class="screenText">Create</strong>.</li>
      <li class="numberedList">Configure the<a id="_idIndexMarker1091"/> startup project for the solution to be the current selection.</li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-393">Using Visual Studio Code</h2>
    <p class="normal">If you prefer to use Visual <a id="_idIndexMarker1092"/>Studio Code, here are the steps <a id="_idIndexMarker1093"/>to create an Azure Functions project:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">In Visual Studio Code, navigate to <strong class="screenText">Extensions</strong> and search for Azure Functions (<code class="inlineCode">ms-azuretools.vscode-azurefunctions</code>). It has dependencies on two other extensions: Azure Account (<code class="inlineCode">ms-vscode.azure-account</code>) and Azure Resources (<code class="inlineCode">ms-azuretools.vscode-azureresourcegroups</code>), so those will be installed too. Click the <strong class="screenText">Install</strong> button to install the extension.</li>
      <li class="numberedList">Create a folder named <code class="inlineCode">Northwind.AzureFunctions.Service</code>. (If you previously created the same project using Visual Studio 2022, then create a new folder named <code class="inlineCode">Chapter10-vscode</code> and create this new project folder in there instead.)</li>
      <li class="numberedList">In Visual Studio Code, open the <code class="inlineCode">Northwind.AzureFunctions.Service</code> folder.</li>
      <li class="numberedList">Navigate to <strong class="screenText">View</strong> | <strong class="screenText">Command Palette</strong>, type <code class="inlineCode">azure f</code>, and then in the list of <strong class="screenText">Azure Functions</strong> commands, click <strong class="screenText">Azure Functions: Create New Project…</strong>.</li>
      <li class="numberedList">Select the <code class="inlineCode">Northwind.AzureFunctions.Service</code> folder to contain your function project.</li>
      <li class="numberedList">At the prompts, select the following:<ul>
          <li class="bulletList">Select a language: <strong class="screenText">C#</strong></li>
          <li class="bulletList">Select a .NET runtime: <strong class="screenText">.NET 8 Isolated LTS</strong>.</li>
          <li class="bulletList">Select a template for your project’s first function: <strong class="screenText">HTTP trigger</strong>. </li>
          <li class="bulletList">Provide a function name: <code class="inlineCode">NumbersToWordsFunction</code></li>
          <li class="bulletList">Provide a namespace: <code class="inlineCode">Northwind.AzureFunctions.Service</code></li>
          <li class="bulletList">Select the authorization level: <strong class="screenText">Anonymous</strong></li>
        </ul>
      </li>
      <li class="numberedList">Navigate to <strong class="screenText">Terminal</strong> | <strong class="screenText">New Terminal</strong>.</li>
      <li class="numberedList">At the command <a id="_idIndexMarker1094"/>prompt, build <a id="_idIndexMarker1095"/>the project, as shown in the following command:
        <pre class="programlisting con"><code class="hljs-con">dotnet build
</code></pre>
      </li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-394">Using the func CLI</h2>
    <p class="normal">If you prefer to use the <a id="_idIndexMarker1096"/>command line and some other code editor, here are the steps to create and start an Azure<a id="_idIndexMarker1097"/> Functions project:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Create a <code class="inlineCode">Chapter10-cli</code> folder with a subfolder named <code class="inlineCode">Northwind.AzureFunctions.Service</code>.</li>
      <li class="numberedList">In command prompt or terminal, in the <code class="inlineCode">Northwind.AzureFunctions.Service</code> folder, create a new Azure Functions project using C#, as shown in the following command:
        <pre class="programlisting con"><code class="hljs-con">func init --csharp
</code></pre>
      </li>
      <li class="numberedList">In command prompt or terminal, in the <code class="inlineCode">Northwind.AzureFunctions.Service</code> folder, create a new Azure Functions function using <code class="inlineCode">HTTP trigger</code> that can be called anonymously, as shown in the following command:
        <pre class="programlisting con"><code class="hljs-con">func new --name NumbersToWordsFunction --template "HTTP trigger" --authlevel "anonymous"
</code></pre>
      </li>
      <li class="numberedList">Optionally, you can start the function locally, as shown in the following command:
        <pre class="programlisting con"><code class="hljs-con">func start
</code></pre>
      </li>
    </ol>
    <div><p class="normal">If you cannot<a id="_idIndexMarker1098"/> find <code class="inlineCode">func</code> at the command prompt or terminal, then try installing the Azure Functions Core Tools using Chocolatey, as described at the following link: <a href="https://community.chocolatey.org/packages/azure-functions-core-tools">https://community.chocolatey.org/packages/azure-functions-core-tools</a>.</p>
    </div>
    <h2 class="heading-2" id="_idParaDest-395">Reviewing the Azure Functions project</h2>
    <p class="normal">Before we write a function, let’s review what makes an Azure Functions project:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Open the<a id="_idIndexMarker1099"/> project file, and note the Azure Functions version and the package references needed to implement an Azure function that responds to HTTP requests, as shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;Project Sdk="Microsoft.NET.Sdk"&gt;
  &lt;PropertyGroup&gt;
    &lt;TargetFramework&gt;net8.0&lt;/TargetFramework&gt;
    &lt;AzureFunctionsVersion&gt;v4&lt;/AzureFunctionsVersion&gt;
    &lt;OutputType&gt;Exe&lt;/OutputType&gt;
    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
    &lt;Nullable&gt;enable&lt;/Nullable&gt;
  &lt;/PropertyGroup&gt;
  &lt;ItemGroup&gt;
    &lt;PackageReference Version="1.19.0" 
      Include="Microsoft.Azure.Functions.Worker" /&gt;
    &lt;PackageReference Version="3.0.13" 
      Include="Microsoft.Azure.Functions.Worker.Extensions.Http" /&gt;
    &lt;PackageReference Version="1.14.0"
      Include="Microsoft.Azure.Functions.Worker.Sdk" /&gt;
  &lt;/ItemGroup&gt;
  &lt;ItemGroup&gt;
    &lt;None Update="host.json"&gt;
      &lt;CopyToOutputDirectory&gt;PreserveNewest&lt;/CopyToOutputDirectory&gt;
    &lt;/None&gt;
    &lt;None Update="local.settings.json"&gt;
      &lt;CopyToOutputDirectory&gt;PreserveNewest&lt;/CopyToOutputDirectory&gt;
      &lt;CopyToPublishDirectory&gt;Never&lt;/CopyToPublishDirectory&gt;
    &lt;/None&gt;
  &lt;/ItemGroup&gt;
  &lt;ItemGroup&gt;
    &lt;Using Include="System.Threading.ExecutionContext" 
           Alias="ExecutionContext" /&gt;
  &lt;/ItemGroup&gt;
&lt;/Project&gt;
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">host.json</code>, note that logging to Application Insights is enabled but excludes <code class="inlineCode">Request</code> types, as shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">{
  "version": "2.0",
  "logging": {
    "applicationInsights": {
      "samplingSettings": {
        "isEnabled": true,
        "excludedTypes": "Request"
      },
      "enableLiveMetricsFilters": true
    }
  }
}
</code></pre>
      
    <div><p class="normal">Application Insights is Azure’s monitoring and logging service. We will not be using it in this chapter.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">In <code class="inlineCode">local.settings.json</code>, confirm<a id="_idIndexMarker1100"/> that during local development, your project will use local development storage and an isolated worker model, as shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">{
  "IsEncrypted": false,
  "Values": {
    "AzureWebJobsStorage": "UseDevelopmentStorage=true",
    "FUNCTIONS_WORKER_RUNTIME": "dotnet-isolated"
  }
}
</code></pre>
      </li>
      <li class="numberedList">If the <code class="inlineCode">AzureWebJobsStorage</code> setting is blank or missing, which might happen if you are using Visual Studio Code, then add it, set it to <code class="inlineCode">UseDevelopmentStorage=true</code>, and then save changes.
    <div><p class="normal"><code class="inlineCode">FUNCTIONS_WORKER_RUNTIME</code> is the language being used by your project. <code class="inlineCode">dotnet</code> means a .NET class library; <code class="inlineCode">dotnet-isolated</code> means a .NET console app. Other values include <code class="inlineCode">java</code>, <code class="inlineCode">node</code>, <code class="inlineCode">powershell</code>, and <code class="inlineCode">python</code>.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">In the <code class="inlineCode">Properties</code> folder, in <code class="inlineCode">launchSettings.json</code>, note the randomly assigned port number for the web service, as shown in the following configuration:
        <pre class="programlisting code"><code class="hljs-code">{
  "profiles": {
    "Northwind.AzureFunctions.Service": {
      "commandName": "Project",
      "commandLineArgs": "--port 7274",
      "launchBrowser": false
    }
  }
}
</code></pre>
      </li>
      <li class="numberedList">Change the port <a id="_idIndexMarker1101"/>number to <code class="inlineCode">5101</code> and save the changes to the file.</li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-396">Implementing a simple function</h2>
    <p class="normal">Let’s implement the<a id="_idIndexMarker1102"/> function to convert numbers into words by using the <code class="inlineCode">Humanizer</code> package:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">In the project file, add a package reference for Humanizer, as shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;PackageReference Include="Humanizer" Version="2.14.1" /&gt;
</code></pre>
      </li>
      <li class="numberedList">Build the project to restore packages.
    <p class="normal">If you are using Visual Studio 2022, in the <code class="inlineCode">Northwind.AzureFunctions.Service</code> project, right-click <code class="inlineCode">Function1.cs</code> and rename it to <code class="inlineCode">NumbersToWordsFunction.cs</code>.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">In <code class="inlineCode">NumbersToWordsFunction.cs</code>, modify the contents to implement an Azure function to convert an amount as a number into words, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using Humanizer; // To use ToWords extension method.
using Microsoft.Azure.Functions.Worker; // To use [HttpTrigger].
using Microsoft.Azure.Functions.Worker.Http; // To use HttpResponseData.
using Microsoft.Extensions.Logging; // To use ILogger.
namespace Northwind.AzureFunctions.Service;
public class NumbersToWordsFunction
{
  private readonly ILogger _logger;
  public NumbersToWordsFunction(ILoggerFactory loggerFactory)
  {
    _logger = loggerFactory.CreateLogger&lt;NumbersToWordsFunction&gt;();
  }
  [Function(nameof(NumbersToWordsFunction))]
  public HttpResponseData Run(
    [HttpTrigger(AuthorizationLevel.Anonymous, 
      "get", "post", Route = null)] HttpRequestData req)
  {
    _logger.LogInformation("C# HTTP trigger function processed a request.");
    string? amount = req.Query["amount"];
    HttpResponseData response;
    if (long.TryParse(amount, out long number))
    {
      response = req.CreateResponse(System.Net.HttpStatusCode.OK);
      response.WriteString(number.ToWords());
    }
    else
    {
      response = req.CreateResponse(System.Net.HttpStatusCode.BadRequest);
      response.WriteString($"Failed to parse: {amount}");
    }
    return response;
  }
}
</code></pre>
      </li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-397">Testing a simple function</h2>
    <p class="normal">Now we can test the <a id="_idIndexMarker1103"/>function in our local development environment:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Start the <code class="inlineCode">Northwind.AzureFunctions.Service</code> project: <ul>
          <li class="bulletList">If you are using Visual Studio Code, you will need to navigate to the <strong class="screenText">Run and Debug</strong> pane, make sure that <strong class="screenText">Attach to .NET Functions</strong> is selected, and then click the <strong class="screenText">Run</strong> button.</li>
          <li class="bulletList">On Windows, if you see a <strong class="screenText">Windows Security Alert</strong> from <strong class="screenText">Windows Defender Firewall</strong>, then click <strong class="screenText">Allow access</strong>.</li>
        </ul>
      </li>
      <li class="numberedList">Note that <strong class="screenText">Azure Functions Core Tools</strong> hosts your function, as shown in the following output and in <em class="italic">Figure 10.1</em>:
        <pre class="programlisting con"><code class="hljs-con">Azure Functions Core Tools
Core Tools Version:       4.0.5390 Commit hash: N/A  (64-bit)
Function Runtime Version: 4.25.3.21264
[2023-10-01T11:42:05.319Z] Found C:\apps-services-net8\Chapter10\Northwind.AzureFunctions.Service\Northwind.AzureFunctions.Service.csproj. Using for user secrets file configuration.
Functions:
        NumbersToWordsFunction: [GET,POST] http://localhost:5101/api/NumbersToWordsFunction
For detailed output, run func with --verbose flag.
[2023-06-05T11:42:14.265Z] Host lock lease acquired by instance ID '00000000000000000000000011150C3D'.
</code></pre>
      
    <figure class="mediaobject"><img alt="" src="img/B19587_10_01.png"/></figure>
    <p class="packt_figref">Figure 10.1: Azure Functions Core Tools hosting a function</p>
    <div><p class="normal">It might take a few minutes for the <code class="inlineCode">Host</code> <code class="inlineCode">lock</code> <code class="inlineCode">lease</code> message to appear so do not worry if it doesn’t show immediately.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">Select the<a id="_idIndexMarker1104"/> URL for your function and copy it to the clipboard.</li>
      <li class="numberedList">Start Chrome.</li>
      <li class="numberedList">Paste the URL into the address box, append the query string <code class="inlineCode">?amount=123456</code>, and note the successful response in the browser of <strong class="screenText">one hundred and twenty-three thousand four hundred and fifty-six</strong>, as shown in <em class="italic">Figure 10.2</em>:</li>
    </ol>
    <figure class="mediaobject"><img alt="" src="img/B19587_10_02.png"/></figure>
    <p class="packt_figref">Figure 10.2: A successful call to the Azure function running locally</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">In the command prompt or terminal, note the function was called successfully, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">[2023-101-01T11:32:51.574Z] Executing 'NumbersToWordsFunction' (Reason='This function was programmatically called via the host APIs.', Id=234d3122-ff3d-4896-94b3-db3c8b5013d8)
[2023-10-01T11:32:51.603Z] C# HTTP trigger function processed a request.
[2023-10-01T11:32:51.629Z] Executed 'NumbersToWordsFunction' (Succeeded, Id=234d3122-ff3d-4896-94b3-db3c8b5013d8, Duration=96ms)
</code></pre>
      </li>
      <li class="numberedList">Try calling the <a id="_idIndexMarker1105"/>function without an amount in the query string, or a non-integer value for the amount like <code class="inlineCode">apples</code>, and note the function returns a <code class="inlineCode">400</code> status code indicating a bad request with a custom message, <code class="inlineCode">Failed to parse: apples</code>.</li>
      <li class="numberedList">Close Chrome and shut down the web server (or in Visual Studio Code, stop debugging).</li>
    </ol>
    <h1 class="heading-1" id="_idParaDest-398">Responding to timer and resource triggers</h1>
    <p class="normal">Now that you have seen an Azure Functions function that responds to an HTTP request, let’s build some that respond to other types of triggers.</p>
    <p class="normal">Support for HTTP and timer triggers is built in. Support for other bindings is implemented as extension packages.</p>
    <h2 class="heading-2" id="_idParaDest-399">Implementing a Timer triggered function</h2>
    <p class="normal">First, we will make<a id="_idIndexMarker1106"/> a function that runs every hour and requests a page from <a href="https://www.amazon.com/">amazon.com</a> for the eighth edition of my book, <em class="italic">C# 12 and .NET 8 – Modern Cross-Platform Development Fundamentals</em>, so that I can keep track of its Best Sellers Rank in the United States.</p>
    <p class="normal">The function will need to make HTTP <code class="inlineCode">GET</code> requests so we should inject the HTTP client factory. To do that, we will need to add some extra package references and create a special startup class:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">In the <code class="inlineCode">Northwind.AzureFunctions.Service</code> project, add package references for working with Azure Functions extensions and timers, as shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;PackageReference Include="Microsoft.Azure.Functions.Extensions" 
                  Version="1.1.0" /&gt;
&lt;PackageReference Version="4.2.0" 
  Include="Microsoft.Azure.Functions.Worker.Extensions.Timer" /&gt;
</code></pre>
      </li>
      <li class="numberedList">Build the <code class="inlineCode">Northwind.AzureFunctions.Service</code> project to restore packages.</li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, import<a id="_idIndexMarker1107"/> namespaces for working with dependency injection and HTTP media headers, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using Microsoft.Extensions.DependencyInjection; // To use AddHttpClient().
using System.Net.Http.Headers; // To use MediaTypeWithQualityHeaderValue.
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, add statements to configure a HTTP client factory for making requests to Amazon as if it was the Chrome browser as a dependency service, as shown highlighted in the following code:
        <pre class="programlisting code"><code class="hljs-code">var host = new HostBuilder()
  .ConfigureFunctionsWorkerDefaults()
<strong class="hljs-slc">  .ConfigureServices(services =&gt;</strong>
<strong class="hljs-slc">  { </strong>
<strong class="hljs-slc">    services.AddHttpClient(name: </strong><strong class="hljs-string-slc">"Amazon"</strong><strong class="hljs-slc">, </strong>
<strong class="hljs-slc">      configureClient: options =&gt;</strong>
<strong class="hljs-slc">    {</strong>
<strong class="hljs-slc">      options.BaseAddress = </strong><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> Uri(</strong><strong class="hljs-string-slc">"https://www.amazon.com"</strong><strong class="hljs-slc">);</strong>
<strong class="hljs-slc">      </strong><strong class="hljs-comment-slc">// Pretend to be Chrome with US English.</strong>
<strong class="hljs-slc">      options.DefaultRequestHeaders.Accept.Add(</strong>
<strong class="hljs-slc">        </strong><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> MediaTypeWithQualityHeaderValue(</strong><strong class="hljs-string-slc">"</strong><strong class="hljs-string-slc">text/html"</strong><strong class="hljs-slc">));</strong>
<strong class="hljs-slc">      options.DefaultRequestHeaders.Accept.Add(</strong>
<strong class="hljs-slc">        </strong><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> MediaTypeWithQualityHeaderValue(</strong><strong class="hljs-string-slc">"application/xhtml+xml"</strong><strong class="hljs-slc">));</strong>
<strong class="hljs-slc">      options.DefaultRequestHeaders.Accept.Add(</strong>
<strong class="hljs-slc">        </strong><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> MediaTypeWithQualityHeaderValue(</strong><strong class="hljs-string-slc">"application/xml"</strong><strong class="hljs-slc">, </strong><strong class="hljs-number-slc">0.9</strong><strong class="hljs-slc">));</strong>
<strong class="hljs-slc">      options.DefaultRequestHeaders.Accept.Add(</strong>
<strong class="hljs-slc">        </strong><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> MediaTypeWithQualityHeaderValue(</strong><strong class="hljs-string-slc">"image/avif"</strong><strong class="hljs-slc">));</strong>
<strong class="hljs-slc">      options.DefaultRequestHeaders.Accept.Add(</strong>
<strong class="hljs-slc">        </strong><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> MediaTypeWithQualityHeaderValue(</strong><strong class="hljs-string-slc">"image/webp"</strong><strong class="hljs-slc">));</strong>
<strong class="hljs-slc">      options.DefaultRequestHeaders.Accept.Add(</strong>
<strong class="hljs-slc">        </strong><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> MediaTypeWithQualityHeaderValue(</strong><strong class="hljs-string-slc">"image/apng"</strong><strong class="hljs-slc">));</strong>
<strong class="hljs-slc">      options.DefaultRequestHeaders.Accept.Add(</strong>
<strong class="hljs-slc">        </strong><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> MediaTypeWithQualityHeaderValue(</strong><strong class="hljs-string-slc">"*/*"</strong><strong class="hljs-slc">, </strong><strong class="hljs-number-slc">0.8</strong><strong class="hljs-slc">));</strong>
<strong class="hljs-slc">      </strong>
<strong class="hljs-slc">      options.DefaultRequestHeaders.AcceptLanguage.Add(</strong>
<strong class="hljs-slc">        </strong><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> StringWithQualityHeaderValue(</strong><strong class="hljs-string-slc">"en-US"</strong><strong class="hljs-slc">));</strong>
<strong class="hljs-slc">      options.DefaultRequestHeaders.AcceptLanguage.Add(</strong>
<strong class="hljs-slc">        </strong><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> StringWithQualityHeaderValue(</strong><strong class="hljs-string-slc">"en"</strong><strong class="hljs-slc">,</strong><strong class="hljs-number-slc">0.8</strong><strong class="hljs-slc">));</strong>
<strong class="hljs-slc">      options.DefaultRequestHeaders.UserAgent.Add(</strong>
<strong class="hljs-slc">        </strong><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc">(productName: </strong><strong class="hljs-string-slc">"Chrome"</strong><strong class="hljs-slc">, productVersion: </strong><strong class="hljs-string-slc">"114.0.5735.91"</strong><strong class="hljs-slc">));</strong>
<strong class="hljs-slc">    });</strong>
<strong class="hljs-slc">  })</strong>
  .Build();
host.Run();
</code></pre>
      
    <div><p class="normal">The Chrome version on June 5, 2023, was <code class="inlineCode">114.0.5735.91</code>. The major version number usually increments monthly, so in November 2023, it will likely be <code class="inlineCode">119</code>, and in November 2024, it will likely be <code class="inlineCode">131</code>.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Add a class file named <code class="inlineCode">ScrapeAmazonFunction.cs</code>.</li>
      <li class="numberedList">Modify its contents<a id="_idIndexMarker1108"/> to implement a function that requests the page for the seventh edition of my book on the Amazon website and process the response, which is compressed using GZIP, to extract the book’s Best Seller Rank, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using Microsoft.Azure.Functions.Worker; // To use [Function].
using Microsoft.Extensions.Logging; // To use ILogger.
using System.IO.Compression; // To use GZipStream, CompressionMode.
namespace Northwind.AzureFunctions.Service;
public class ScrapeAmazonFunction
{
  private const string relativePath = 
    "12-NET-Cross-Platform-Development-Fundamentals/dp/1837635870/";
  private readonly IHttpClientFactory _clientFactory;
  private readonly ILogger _logger;
  public ScrapeAmazonFunction(IHttpClientFactory clientFactory,
    ILoggerFactory loggerFactory)
  {
    _clientFactory = clientFactory;
    _logger = loggerFactory.CreateLogger&lt;ScrapeAmazonFunction&gt;();
  }
  [Function(nameof(ScrapeAmazonFunction))]
  public async Task Run( // Every hour.
    [TimerTrigger("0 0 * * * *")] TimerInfo timer)
  {
    _logger.LogInformation($"C# Timer trigger function executed at {
      DateTime.UtcNow}.");
    _logger.LogInformation(
      $"C# Timer trigger function next three occurrences at: {
        timer.ScheduleStatus?.Next}.");
    HttpClient client = _clientFactory.CreateClient("Amazon");
    HttpResponseMessage response = await client.GetAsync(relativePath);
    _logger.LogInformation(
      $"Request: GET {client.BaseAddress}{relativePath}");
    if (response.IsSuccessStatusCode)
    {
      _logger.LogInformation("Successful HTTP request.");
      // Read the content from a GZIP stream into a string.
      Stream stream = await response.Content.ReadAsStreamAsync();
      GZipStream gzipStream = new(stream, CompressionMode.Decompress);
      StreamReader reader = new(gzipStream);
      string page = reader.ReadToEnd();
      // Extract the Best Sellers Rank.
      int posBsr = page.IndexOf("Best Sellers Rank");
      string bsrSection = page.Substring(posBsr, 45);
      // bsrSection will be something like:
      //   "Best Sellers Rank: &lt;/span&gt; #22,258 in Books ("
      // Get the position of the # and the following space.
      int posHash = bsrSection.IndexOf("#") + 1;
      int posSpaceAfterHash = bsrSection.IndexOf(" ", posHash);
      // Get the BSR number as text.
      string bsr = bsrSection.Substring(
        posHash, posSpaceAfterHash - posHash);
      bsr = bsr.Replace(",", null); // remove commas
      // Parse the text into a number.
      if (int.TryParse(bsr, out int bestSellersRank))
      {
        _logger.LogInformation(
          $"Best Sellers Rank #{bestSellersRank:N0}.");
      }
      else
      {
        _logger.LogError(
          $"Failed to extract BSR number from: {bsrSection}.");
      }
    }
    else
    {
      _logger.LogError("Bad HTTP request.");
    }
  }
}
</code></pre>
      </li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-400">Testing the Timer triggered function</h2>
    <p class="normal">Information about a<a id="_idIndexMarker1109"/> function can be retrieved by making an HTTP <code class="inlineCode">GET</code> request in the following format:</p>
    <p class="normal"><code class="inlineCode">http://locahost:5101/admin/functions/&lt;functionname&gt;</code></p>
    <p class="normal">Now we can test the Timer function in our local development environment:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Start the <code class="inlineCode">Northwind.AzureFunctions.Service</code> project: <ul>
          <li class="bulletList">If you are using Visual Studio Code, you will need to make sure you have the Azurite extension installed and the Azurite services running. Navigate to the <strong class="screenText">Run and Debug</strong> pane, make sure that <strong class="screenText">Attach to .NET Functions</strong> is selected, and then click the <strong class="screenText">Run</strong> button.</li>
        </ul>
      </li>
      <li class="numberedList">Note there are now two functions, as shown in the following partial output:
        <pre class="programlisting con"><code class="hljs-con">Functions:
        NumbersToWordsFunction: [GET,POST] http://localhost:5101api/NumbersToWordsFunction
        ScrapeAmazonFunction: timerTrigger
For detailed output, run func with --verbose flag.
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">HttpRequests</code> folder, add a new file named <code class="inlineCode">azurefunctions-scrapeamazon.http</code>.</li>
      <li class="numberedList">Modify its contents to define a global variable and two requests to the Azure Functions locally hosted service, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">### Configure a variable for the Azure Functions service base address.
@base_address = http://localhost:5101/
### Get information about the NumbersToWordsFunction function.
{{base_address}}admin/functions/NumbersToWordsFunction
### Get information about the ScrapeAmazonFunction function.
{{base_address}}admin/functions/ScrapeAmazonFunction
</code></pre>
      </li>
      <li class="numberedList">Send the first request and note that a JSON document is returned with information <a id="_idIndexMarker1110"/>about the <code class="inlineCode">NumbersToWordsFunction</code> function, as shown in the following response:
        <pre class="programlisting code"><code class="hljs-code">HTTP/1.1 200 OK
Content-Length: 918
Connection: close
Content-Type: application/json; charset=utf-8
Date: Mon, 05 Jun 2023 13:32:11 GMT
Server: Kestrel
{
  "name": "NumbersToWordsFunction",
  "script_root_path_href": null,
  "script_href": "http://localhost:5101/admin/vfs/bin/Northwind.AzureFunctions.Service.dll",
  "config_href": null,
  "test_data_href": null,
  "href": "http://localhost:5101/admin/functions/NumbersToWordsFunction",
  "invoke_url_template": "http://localhost:5101/api/numberstowordsfunction",
  "language": "dotnet-isolated",
  "config": {
    "name": "NumbersToWordsFunction",
    "entryPoint": "Northwind.AzureFunctions.Service.NumbersToWordsFunction.Run",
    "scriptFile": "Northwind.AzureFunctions.Service.dll",
    "language": "dotnet-isolated",
    "functionDirectory": null,
    "bindings": [
      {
        "name": "req",
        "direction": "In",
        "type": "httpTrigger",
        "authLevel": "Anonymous",
        "methods": [
          "get",
          "post"
        ],
        "properties": {}
      },
      {
        "name": "$return",
        "type": "http",
        "direction": "Out"
      }
    ]
  },
  "files": null,
  "test_data": null,
  "isDisabled": false,
  "isDirect": true,
  "isProxy": false
}
</code></pre>
      </li>
      <li class="numberedList">Send the second request and note that a JSON document is returned with information about the <code class="inlineCode">ScrapeAmazonFunction</code> function. The most interesting information<a id="_idIndexMarker1111"/> for this function is the binding type and schedule, as shown in the following partial response:
        <pre class="programlisting code"><code class="hljs-code">"bindings": [
  {
    "name": "timer",
    "direction": "In",
    "type": "timerTrigger",
    "schedule": "0 0 * * * *",
    "properties": {}
  }
],
</code></pre>
      </li>
      <li class="numberedList">Add a third request that will trigger the timer function manually without having to wait for the hour mark by sending a <code class="inlineCode">POST</code> request with an empty JSON document in the body to its <code class="inlineCode">admin</code> endpoint, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">### Make a manual request to the Timer function.
POST {{base_address}}admin/functions/ScrapeAmazonFunction
Content-Type: application/json
{}
</code></pre>
      </li>
      <li class="numberedList">Send the third request and note that it was successfully accepted, as shown in the following response:
        <pre class="programlisting con"><code class="hljs-con">HTTP/1.1 202 Accepted
</code></pre>
      </li>
      <li class="numberedList">Remove the <code class="inlineCode">{}</code> in the body of the request, send it again, and note the client error response from which we can deduce that an empty JSON document is required, as shown in the following response:
        <pre class="programlisting con"><code class="hljs-con">HTTP/1.1 400 Bad Request
</code></pre>
      </li>
      <li class="numberedList">Add the empty JSON <a id="_idIndexMarker1112"/>document back.</li>
      <li class="numberedList">At the command prompt or terminal for the Azure Functions service, note that the function was triggered by our call. It outputs the time it was triggered (13:49 p.m.) and the time of its next occurrence in its normal timer schedule (2 p.m.) if I were to leave the service running, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">[2023-10-01T13:49:53.939Z] Executing 'Functions.ScrapeAmazonFunction' (Reason='This function was programmatically called via the host APIs.', Id=1df349a1-79c5-4b52-a7f1-d0f8f0d5cd9c)
[2023-10-01T13:49:54.095Z] C# Timer trigger function executed at 01/10/2023 13:49:54.
[2023-10-01T13:49:54.095Z] C# Timer trigger function next occurrence at: 01/10/2023 14:00:00.
[2023-10-01T13:49:54.105Z] Start processing HTTP request GET https://www.amazon.com/12-NET-Cross-Platform-Development-Fundamentals/dp/1837635870/
[2023-10-01T13:49:54.106Z] Sending HTTP request GET https://www.amazon.com/12-NET-Cross-Platform-Development-Fundamentals/dp/1837635870/
[2023-10-01T13:49:54.520Z] Received HTTP response after 407.4353ms - OK
[2023-10-01T13:49:54.521Z] End processing HTTP request after 420.1273ms - OK
[2023-10-01T13:49:56.212Z] Successful HTTP request.
[2023-10-01T13:49:56.212Z] Request: GET https://www.amazon.com/12-NET-Cross-Platform-Development-Fundamentals/dp/1837635870/
[2023-10-01T13:49:56.251Z] Best Sellers Rank #384,269.
[2023-10-01T13:49:56.275Z] Executed 'Functions.ScrapeAmazonFunction' (Succeeded, Id=1df349a1-79c5-4b52-a7f1-d0f8f0d5cd9c, Duration=2362ms)
</code></pre>
      </li>
      <li class="numberedList">Optionally, wait until the hour mark and note that the next occurrence triggers, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">[2023-10-01T14:00:00.023Z] Executing 'Functions.ScrapeAmazonFunction' (Reason='Timer fired at 2023-10-01T15:00:00.0220351+01:00', Id=aa9f7495-6066-4b0a-ba81-42582d677321)
[2023-10-01T14:00:00.027Z] C# Timer trigger function executed at 01/10/2023 14:00:00.
[2023-10-01T14:00:00.028Z] Start processing HTTP request GET https://www.amazon.com/12-NET-Cross-Platform-Development-Fundamentals/dp/1837635870/
[2023-10-01T14:00:00.027Z] C# Timer trigger function next occurrence at: 01/10/2023 15:00:00.
[2023-10-01T14:00:00.028Z] Sending HTTP request GET https://www.amazon.com/12-NET-Cross-Platform-Development-Fundamentals/dp/1837635870/
[2023-10-01T14:00:00.337Z] Received HTTP response after 305.1877ms - OK
[2023-10-01T14:00:00.339Z] End processing HTTP request after 305.5222ms - OK
[2023-10-01T14:00:01.899Z] Successful HTTP request.
[2023-10-01T14:00:01.899Z] Request: GET https://www.amazon.com/12-NET-Cross-Platform-Development-Fundamentals/dp/1837635870/
[2023-10-01T14:00:01.931Z] Best Sellers Rank #387,339.
[2023-10-01T14:00:01.931Z] Executed 'Functions.ScrapeAmazonFunction' (Succeeded, Id=aa9f7495-6066-4b0a-ba81-42582d677321, Duration=1909ms)
</code></pre>
      </li>
      <li class="numberedList">If I were to stop the service running, wait for more than an hour, and then start the service, it <a id="_idIndexMarker1113"/>would immediately run the function because it is past due, as shown highlighted in the following output:
        <pre class="programlisting con"><code class="hljs-con">[2023-10-01T16:19:31.369Z] Trigger Details: UnscheduledInvocationReason: IsPastDue, OriginalSchedule: 2023-10-01T15:00:00.0000000+01:00
</code></pre>
      </li>
      <li class="numberedList">Shut down the Azure Functions service.</li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-401">Implementing a function that works with queues and BLOBs</h2>
    <p class="normal">The HTTP-triggered function responded directly to the <code class="inlineCode">GET</code> request with plain text. We will now define a similar <a id="_idIndexMarker1114"/>function to bind to Queue Storage and add a message to a queue to indicate that an image needs to be generated and uploaded to Blob Storage. This can then be printed as a check.</p>
    <p class="normal">When running the service locally, we want to generate the image of the check BLOB in the local filesystem to make it easier to ensure it is working correctly. We will set a custom environment variable in local settings to detect that condition.</p>
    <p class="normal">We need a font that looks like handwriting. Google has a useful website where you can search for, preview, and download fonts. The one we will use is Caveat, as shown at the following link:</p>
    <p class="normal"><a href="https://fonts.google.com/specimen/Caveat?category=Handwriting&amp;preview.text=one%20hundred%20and%20twenty%20three%20thousand,%20four%20hundred%20and%20fifty%20six&amp;preview.text_type=custom#standard-styles">https://fonts.google.com/specimen/Caveat?category=Handwriting&amp;preview.text=one%20hundred%20and%20twenty%20three%20thousand,%20four%20hundred%20and%20fifty%20six&amp;preview.text_type=custom#standard-styles</a></p>
    <p class="normal">Let’s go:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Download the font at the link above, extract the ZIP file, and copy the files into a folder named <code class="inlineCode">fonts</code>, as shown in Visual Studio 2022 in <em class="italic">Figure 10.3</em>:</li>
    </ol>
    <figure class="mediaobject"><img alt="" src="img/B19587_10_03.png"/></figure>
    <p class="packt_figref">Figure 10.3: The fonts folder with the Caveat font files in Visual Studio 2022</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Select the <code class="inlineCode">Caveat-Regular.ttf</code> font file.</li>
      <li class="numberedList">In <strong class="screenText">Properties</strong>, set <strong class="screenText">Copy to Output Directory</strong> to <strong class="screenText">Copy always</strong>, as shown in <em class="italic">Figure 10.3</em>. This adds an<a id="_idIndexMarker1115"/> entry to the project file, as shown highlighted in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;ItemGroup&gt;
<strong class="hljs-slc">  &lt;None Update=</strong><strong class="hljs-string-slc">"fonts\Caveat\static\Caveat-Regular.ttf"</strong><strong class="hljs-slc">&gt;</strong>
<strong class="hljs-slc">    &lt;CopyToOutputDirectory&gt;Always&lt;/CopyToOutputDirectory&gt;</strong>
<strong class="hljs-slc">  &lt;/None&gt;</strong>
  &lt;None Update="host.json"&gt;
    &lt;CopyToOutputDirectory&gt;PreserveNewest&lt;/CopyToOutputDirectory&gt;
  &lt;/None&gt;
  &lt;None Update="local.settings.json"&gt;
    &lt;CopyToOutputDirectory&gt;PreserveNewest&lt;/CopyToOutputDirectory&gt;
    &lt;CopyToPublishDirectory&gt;Never&lt;/CopyToPublishDirectory&gt;
  &lt;/None&gt;
&lt;/ItemGroup&gt;
</code></pre>
      
    <p class="normal">If you are using Visual Studio Code, manually add the preceding entry to the project file.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">In the <code class="inlineCode">Northwind.AzureFunctions.Service</code> project, add package references for working with the Azure Queue and Blob Storage extensions and drawing with <code class="inlineCode">ImageSharp</code>, as shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;PackageReference Version="5.2.0" Include=
  "Microsoft.Azure.Functions.Worker.Extensions.Storage.Queues" /&gt;
&lt;PackageReference Version="6.2.0" Include=
  "Microsoft.Azure.Functions.Worker.Extensions.Storage.Blobs" /&gt;
&lt;PackageReference Include="SixLabors.ImageSharp" Version="3.0.2" /&gt;
&lt;PackageReference Include="SixLabors.ImageSharp.Drawing" 
                  Version="2.0.0" /&gt;
</code></pre>
      </li>
      <li class="numberedList">Build the project to restore packages.</li>
      <li class="numberedList">In the <code class="inlineCode">Northwind.AzureFunctions.Service</code> project, add a new class named <code class="inlineCode">NumbersToChecksFunction.cs</code>.</li>
      <li class="numberedList">In <code class="inlineCode">NumbersToChecksFunction.cs</code>, add statements to register the function with an output binding for Queue Storage so that it can write to a named queue, and when the<a id="_idIndexMarker1116"/> amount is successfully parsed to return the words to the queue, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using Humanizer; // To use ToWords extension method.
using Microsoft.Azure.Functions.Worker; // To use [Function] and so on.
using Microsoft.Azure.Functions.Worker.Http; // To use HttpRequestData.
using Microsoft.Extensions.Logging; // To use ILogger.
namespace Northwind.AzureFunctions.Service;
public class NumbersToChecksFunction
{
  private readonly ILogger _logger;
  public NumbersToChecksFunction(ILoggerFactory loggerFactory)
  {
    _logger = loggerFactory.CreateLogger&lt;NumbersToChecksFunction&gt;();
  }
  [Function(nameof(NumbersToChecksFunction))]
  [QueueOutput("checksQueue")] // Return value is written to this queue.
  public string Run(
    [HttpTrigger(AuthorizationLevel.Anonymous,
      "get", "post", Route = null)] HttpRequestData request)
  {
    _logger.LogInformation("C# HTTP trigger function processed a request.");
    string? amount = request.Query["amount"];
    if (long.TryParse(amount, out long number))
    {
      return number.ToWords();
    }
    else
    {
      return $"Failed to parse: {amount}";
    }
  }
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">local.settings.json</code>, add an environment variable named <code class="inlineCode">IS_LOCAL</code> with a value of <code class="inlineCode">true</code>, as shown <a id="_idIndexMarker1117"/>highlighted in the following configuration:
        <pre class="programlisting code"><code class="hljs-code">{
  "IsEncrypted": false,
  "Values": {
    "AzureWebJobsStorage": "UseDevelopmentStorage=true",
    "FUNCTIONS_WORKER_RUNTIME": "dotnet-isolated"<strong class="hljs-punctuation-slc">,</strong>
<strong class="hljs-slc">    </strong><strong class="hljs-attr-slc">"IS_LOCAL"</strong><strong class="hljs-punctuation-slc">:</strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">true</strong>
  }
}
</code></pre>
      </li>
      <li class="numberedList">Add a class file named <code class="inlineCode">CheckGeneratorFunction.cs</code>.</li>
      <li class="numberedList">Modify its contents, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using Microsoft.Azure.Functions.Worker; // To use [Function] and so on.
using Microsoft.Extensions.Logging; // To use ILogger.
using SixLabors.Fonts; // To use Font.
using SixLabors.ImageSharp.Drawing; // To use IPath.
using SixLabors.ImageSharp.Drawing.Processing; // To use Brush, Pen.
namespace Northwind.AzureFunctions.Service;
public class CheckGeneratorFunction
{
  private readonly ILogger _logger;
  public CheckGeneratorFunction(ILoggerFactory loggerFactory)
  {
    _logger = loggerFactory.CreateLogger&lt;NumbersToWordsFunction&gt;();
  }
  [Function(nameof(CheckGeneratorFunction))]
  [BlobOutput("checks-blob-container/check.png")]
  public byte[] Run(
    [QueueTrigger("checksQueue")] string message)
  {
    _logger.LogInformation("C# Queue trigger function executed.");
    _logger.LogInformation($"Body: {message}.");
    // Create a new blank image with a white background.
    using (Image&lt;Rgba32&gt; image = new(width: 1200, height: 600,
      backgroundColor: new Rgba32(r: 255, g: 255, b: 255, a: 100)))
    {
      // Load the font file and create a large font.
      FontCollection collection = new();
      FontFamily family = collection.Add(
        @"fonts\Caveat\static\Caveat-Regular.ttf");
      Font font = family.CreateFont(72);
      string amount = message.Body.ToString();
      DrawingOptions options = new()
      {
        GraphicsOptions = new()
        {
          ColorBlendingMode = PixelColorBlendingMode.Multiply
        }
      };
      // Define some pens and brushes.
      Pen blackPen = Pens.Solid(Color.Black, 2);
      Pen blackThickPen = Pens.Solid(Color.Black, 8);
      Pen greenPen = Pens.Solid(Color.Green, 3);
      Brush redBrush = Brushes.Solid(Color.Red);
      Brush blueBrush = Brushes.Solid(Color.Blue);
      // Define some paths and draw them.
      IPath border = new RectangularPolygon(
        x: 50, y: 50, width: 1100, height: 500);
      image.Mutate(x =&gt; x.Draw(options, blackPen, border));
      IPath star = new Star(x: 150.0f, y: 150.0f, 
        prongs: 5, innerRadii: 20.0f, outerRadii: 30.0f);
      image.Mutate(x =&gt; x.Fill(options, redBrush, star)
                         .Draw(options, greenPen, star));
      IPath line1 = new Polygon(new LinearLineSegment(
        new PointF(x: 100, y: 275), new PointF(x: 1050, y: 275)));
      
      image.Mutate(x =&gt; x.Draw(options, blackPen, line1));
      IPath line2 = new Polygon(new LinearLineSegment(
        new PointF(x: 100, y: 365), new PointF(x: 1050, y: 365)));
      image.Mutate(x =&gt; x.Draw(options, blackPen, line2));
      RichTextOptions textOptions = new(font)
      {
        Origin = new PointF(100, 200),
        WrappingLength = 1000,
        HorizontalAlignment = HorizontalAlignment.Left
      };
      image.Mutate(x =&gt; x.DrawText(
        textOptions, amount, blueBrush, blackPen));
      string blobName = $"{DateTime.UtcNow:yyyy-MM-dd-hh-mm-ss}.png";
      _logger.LogInformation($"Blob filename: {blobName}.");
      try
      {
        if (Environment.GetEnvironmentVariable("IS_LOCAL") == "true")
        {
          // Create blob in the local filesystem.
          string folder = $@"{System.Environment.CurrentDirectory}\blobs";
          if (!Directory.Exists(folder))
          {
            Directory.CreateDirectory(folder);
          }
          log.LogInformation($"Blobs folder: {folder}");
          string blobPath = $@"{folder}\{blobName}";
          image.SaveAsPng(blobPath);
        }
        // Create BLOB in Blob Storage via a memory stream.
        MemoryStream stream = new();
        image.SaveAsPng(stream);
        stream.Seek(0, SeekOrigin.Begin);
        return stream.ToArray();
      }
      catch (System.Exception ex)
      {
        log.LogError(ex.Message);
      }
      return Array.Empty&lt;byte&gt;();
    }
  }
}
</code></pre>
      </li>
    </ol>
    <p class="normal">Note the following:</p>
    <ul>
      <li class="bulletList">The <code class="inlineCode">[QueueTrigger("checksQueue")] string message</code> parameter means the function is<a id="_idIndexMarker1118"/> triggered by a message being added to the <code class="inlineCode">checksQueue</code> and the queued item is automatically passed to the parameter named <code class="inlineCode">message</code>.</li>
      <li class="bulletList">We use ImageSharp to create a 1200x600 image of a check.</li>
      <li class="bulletList">We use the current UTC date and time to name the BLOB to avoid duplicates. In a real implementation, you would need something more robust like GUIDs.</li>
      <li class="bulletList">If the <code class="inlineCode">IS_LOCAL</code> environment variable is set to <code class="inlineCode">true</code>, then we save the image as a PNG to the local filesystem in a <code class="inlineCode">blobs</code> subfolder.</li>
      <li class="bulletList">We save the image as a PNG to a memory stream that is then returned as a byte array <a id="_idIndexMarker1119"/>and uploaded to the BLOB container defined by the <code class="inlineCode">[BlobOutput("checks-blob-container/check.png")]</code> attribute.</li>
    </ul>
    <h2 class="heading-2" id="_idParaDest-402">Testing the function that works with queues and BLOBs</h2>
    <p class="normal">Now we can test the<a id="_idIndexMarker1120"/> function that works with queues and BLOBs in our local development environment:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Start the <code class="inlineCode">Northwind.AzureFunctions.Service</code> project:
    <p class="normal">If you are using Visual Studio Code, you will need to navigate to the <strong class="screenText">Run and Debug</strong> pane, make sure that <strong class="screenText">Attach to .NET Functions</strong> is selected, and then click the <strong class="screenText">Run</strong> button.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">Note there are now four functions, as shown in the following partial output:
        <pre class="programlisting con"><code class="hljs-con">Functions:
        NumbersToChecksFunction: [GET,POST] http://localhost:5101/api/NumbersToChecksFunction
        NumbersToWordsFunction: [GET,POST] http://localhost:5101/api/NumbersToWordsFunction
        CheckGeneratorFunction: queueTrigger
        ScrapeAmazonFunction: timerTrigger
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">HttpRequests</code> folder, add a new file named <code class="inlineCode">azurefunctions-numberstochecks.http</code>.</li>
      <li class="numberedList">Modify its <a id="_idIndexMarker1121"/>contents, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">### Configure a variable for the Azure Functions base address.
@base_address = http://localhost:5101/
### Trigger the NumbersToChecksFunction function.
GET {{base_address}}api/NumbersToChecksFunction?amount=123456
</code></pre>
      </li>
      <li class="numberedList">Send the request and note that a JSON document is returned with information about the <code class="inlineCode">NumbersToWordsFunction</code> function, as shown in the following response:
        <pre class="programlisting con"><code class="hljs-con">Response time: 2524 ms
Status code: OK (200)
Transfer-Encoding: chunked
Date: Mon, 05 Jun 2023 13:53:11 GMT
Server: Kestrel
Content-Type: text/plain; charset=utf-8
Content-Length: 64
------------------------------------------------
Content:
one hundred and twenty-three thousand four hundred and fifty-six
</code></pre>
      </li>
      <li class="numberedList">At the command prompt or terminal, note the function call was successful and a message<a id="_idIndexMarker1122"/> was sent to the queue that then triggered the <code class="inlineCode">CheckGeneratorFunction</code>, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">[2023-06-05T13:53:12.175Z] Executing 'NumbersToWordsFunction' (Reason='This function was programmatically called via the host APIs.', Id=b6a49d34-edbf-4c2a-97f2-195f8d06cd13)
[2023-06-05T13:53:12.195Z] C# HTTP trigger function processed a request.
[2023-06-05T13:53:12.262Z] Executed 'NumbersToWordsFunction' (Succeeded, Id=b6a49d34-edbf-4c2a-97f2-195f8d06cd13, Duration=104ms)
[2023-06-05T13:53:14.302Z] Executing 'CheckGeneratorFunction' (Reason='New queue message detected on 'checksqueue'.', Id=2697ddc0-46dd-4c06-b960-fb5a443ec929)
[2023-06-05T13:53:14.305Z] Trigger Details: MessageId: 229e4961-bfaf-46da-bb17-040ffc2bbf91, DequeueCount: 1, InsertedOn: 2023-06-05T13:53:12.000+00:00
[2023-06-05T13:53:14.313Z] C# Queue trigger function executed.
[2023-06-05T13:53:14.314Z] MessageId: 229e4961-bfaf-46da-bb17-040ffc2bbf91.
[2023-06-05T13:53:14.316Z] InsertedOn: 05/06/2023 13:53:12 +00:00.
[2023-06-05T13:53:14.317Z] ExpiresOn: 12/06/2023 13:53:12 +00:00.
[2023-06-05T13:53:14.318Z] Body: one hundred and twenty-three thousand four hundred and fifty-six.
[2023-06-05T13:53:14.845Z] Blob name: 2023-06-05-01-53-14.png.
[2023-06-05T13:53:14.848Z] Blobs folder: C:\apps-services-net8\Chapter10\Northwind.AzureFunctions.Service\bin\Debug\net8.0\blobs
[2023-06-05T13:53:15.057Z] Blob sequence number: 0.
[2023-06-05T13:53:15.060Z] Executed 'CheckGeneratorFunction' (Succeeded, Id=2697ddc0-46dd-4c06-b960-fb5a443ec929, Duration=776ms)
[2023-06-05T13:53:20.979Z] Host lock lease acquired by instance ID '00000000000000000000000011150C3D'.
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">Northwind.AzureFunctions.Service\bin\Debug\net8.0\blobs</code> folder, note the<a id="_idIndexMarker1123"/> image created locally in the <code class="inlineCode">blobs</code> folder, as shown in <em class="italic">Figure 10.4</em>:</li>
    </ol>
    <figure class="mediaobject"><img alt="" src="img/B19587_10_04.png"/></figure>
    <p class="packt_figref">Figure 10.4: The check image generated in the project blobs folder</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="8">Note the check image, as shown in <em class="italic">Figure 10.5</em>:</li>
    </ol>
    <figure class="mediaobject"><img alt="" src="img/B19587_10_05.png"/></figure>
    <p class="packt_figref">Figure 10.5: The check image opened in Windows Paint</p>
    <h1 class="heading-1" id="_idParaDest-403">Publishing an Azure Functions project to the cloud</h1>
    <p class="normal">Now, let’s create<a id="_idIndexMarker1124"/> a function app and related resources in an Azure subscription, then deploy your functions to the cloud and run it there.</p>
    <p class="normal">If you do not already have an Azure account, then you can sign up for a free one at the following link: <a href="https://azure.microsoft.com/en-us/free/">https://azure.microsoft.com/en-us/free/</a>.</p>
    <h2 class="heading-2" id="_idParaDest-404">Using Visual Studio 2022 to publish</h2>
    <p class="normal">Visual Studio 2022 has <a id="_idIndexMarker1125"/>a GUI to publish to <a id="_idIndexMarker1126"/>Azure:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">In <strong class="screenText">Solution Explorer</strong>, right-click the <code class="inlineCode">Northwind.AzureFunctions.Service</code> project and select <strong class="screenText">Publish</strong>.</li>
      <li class="numberedList">Select <strong class="screenText">Azure</strong> and then click <strong class="screenText">Next</strong>.</li>
      <li class="numberedList">Select <strong class="screenText">Azure Function App (Linux)</strong> and click <strong class="screenText">Next</strong>.</li>
      <li class="numberedList">Sign in and enter your Azure credentials.</li>
      <li class="numberedList">Select your subscription; for example, I chose my subscription named <strong class="screenText">Pay-As-You-Go</strong>.</li>
      <li class="numberedList">In the <strong class="screenText">Function Instance</strong> section, click the <strong class="screenText">+ Create New</strong> button.</li>
      <li class="numberedList">Complete the dialog box, as shown in <em class="italic">Figure 10.6</em>:<ul>
          <li class="bulletList"><strong class="screenText">Name</strong>: This must be globally unique. It suggested a name based on the project name and the current date and time.</li>
          <li class="bulletList"><strong class="screenText">Subscription name</strong>: Select your subscription.</li>
          <li class="bulletList"><strong class="screenText">Resource group</strong>: Select or create a new resource group to make it easier to delete everything later. I chose <code class="inlineCode">apps-services-book</code>.</li>
          <li class="bulletList"><strong class="screenText">Plan Type</strong>: <strong class="screenText">Consumption</strong> (pay for only what you use).</li>
          <li class="bulletList"><strong class="screenText">Location</strong>: A data center<a id="_idIndexMarker1127"/> nearest to you. I chose <strong class="screenText">UK South</strong>.</li>
          <li class="bulletList"><strong class="screenText">Azure Storage</strong>: Create a<a id="_idIndexMarker1128"/> new account named <code class="inlineCode">northwindazurefunctions</code> (or something else that is globally unique) in a data center nearest to you and choose <strong class="screenText">Standard – Locally Redundant Storage</strong> for the account type.</li>
          <li class="bulletList"><strong class="screenText">Application Insights</strong>: <strong class="screenText">None</strong>.</li>
        </ul>
      </li>
    </ol>
    <figure class="mediaobject"><img alt="" src="img/B19587_10_06.png"/></figure>
    <p class="packt_figref">Figure 10.6: Creating a new Azure function app</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="8">Click <strong class="screenText">Create</strong>. This<a id="_idIndexMarker1129"/> process can take<a id="_idIndexMarker1130"/> a minute or more.</li>
      <li class="numberedList">In the <strong class="screenText">Publish</strong> dialog, click <strong class="screenText">Finish</strong> and then click <strong class="screenText">Close</strong>.</li>
      <li class="numberedList">In the <strong class="screenText">Publish</strong> window, click the <strong class="screenText">Publish</strong> button, as shown in <em class="italic">Figure 10.7</em>:</li>
    </ol>
    <figure class="mediaobject"><img alt="" src="img/B19587_10_07.png"/></figure>
    <p class="packt_figref">Figure 10.7: An Azure Function App ready to publish using Visual Studio 2022</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="11">Review the <a id="_idIndexMarker1131"/>output window, as <a id="_idIndexMarker1132"/>shown in the following publishing output:
        <pre class="programlisting con"><code class="hljs-con">Build started...
1&gt;------ Build started: Project: Northwind.AzureFunctions.Service, Configuration: Release Any CPU ------
1&gt;Northwind.AzureFunctions.Service -&gt; C:\apps-services-net8\Chapter10\Northwind.AzureFunctions.Service\bin\Release\net8.0\Northwind.AzureFunctions.Service.dll
2&gt;------ Publish started: Project: Northwind.AzureFunctions.Service, Configuration: Release Any CPU ------
2&gt;Northwind.AzureFunctions.Service -&gt; C:\apps-services-net8\Chapter10\Northwind.AzureFunctions.Service\bin\Release\net8.0\Northwind.AzureFunctions.Service.dll
2&gt;Northwind.AzureFunctions.Service -&gt; C:\apps-services-net8\Chapter10\Northwind.AzureFunctions.Service\obj\Release\net8.0\PubTmp\Out\
2&gt;Publishing C:\apps-services-net8\Chapter10\Northwind.AzureFunctions.Service\obj\Release\net8.0\PubTmp\Northwind.AzureFunctions.Service - 20230605152148071.zip to https://northwindazurefunctionsservice20230605151137.scm.azurewebsites.net/api/zipdeploy...
2&gt;Zip Deployment succeeded.
========== Build: 1 succeeded, 0 failed, 0 up-to-date, 0 skipped ==========
========== Build started at 3:21 PM and took 03:34.100 minutes ==========
========== Publish: 1 succeeded, 0 failed, 0 skipped ==========
========== Publish started at 3:21 PM and took 03:34.100 minutes ==========
Waiting for Function app to be ready...
Function app is ready
</code></pre>
      </li>
      <li class="numberedList">In the <strong class="screenText">Publish</strong> window, click <strong class="screenText">Open site</strong> and note your Azure Functions v4 host site is ready.</li>
      <li class="numberedList">Test the function<a id="_idIndexMarker1133"/> in your browser by appending the following relative URL to the address box, as <a id="_idIndexMarker1134"/>shown in <em class="italic">Figure 10.8</em>: 
    <p class="normal"><code class="inlineCode">/api/NumbersToWordsFunction?amount=987654321</code></p>
    <figure class="mediaobject"><img alt="" src="img/B19587_10_08.png"/></figure>
    <p class="packt_figref">Figure 10.8: Calling the function hosted in the Azure cloud</p>
    <h2 class="heading-2" id="_idParaDest-405">Using Visual Studio Code to publish</h2>
    <p class="normal">You can learn how to publish using Visual Studio <a id="_idIndexMarker1135"/>Code at the following link:</p></li>
    </ol>
    <p class="normal"><a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-develop-vs-code?tabs=csharp#sign-in-to-azure">https://learn.microsoft.com/en-us/azure/azure-functions/functions-develop-vs-code?tabs=csharp#sign-in-to-azure</a></p>
    <p class="normal">Now that you’ve successfully<a id="_idIndexMarker1136"/> published your Azure Functions project to the cloud, it’s important to understand how to manage your resources efficiently. Let’s explore how to clean up our Azure Functions<a id="_idIndexMarker1137"/> resources to avoid unnecessary costs and ensure tidy resource<a id="_idIndexMarker1138"/> management.</p>
    <h1 class="heading-1" id="_idParaDest-406">Cleaning up Azure Functions resources</h1>
    <p class="normal">You can use the following<a id="_idIndexMarker1139"/> steps to delete the function app and its related resources to avoid incurring further costs:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">In your browser, navigate to <a href="https://portal.azure.com/">https://portal.azure.com/</a>.</li>
      <li class="numberedList">In the Azure portal, in your function app’s <strong class="screenText">Overview</strong> blade, select <strong class="screenText">Resource Group</strong>.</li>
      <li class="numberedList">Confirm that it contains only resources that you want to delete; for example, there should be a <strong class="screenText">Storage account</strong>, a <strong class="screenText">Function App</strong>, and an <strong class="screenText">App Service plan</strong>.</li>
      <li class="numberedList">If you are sure you want to delete all the resources in the group, then click <strong class="screenText">Delete resource group</strong> and accept any other confirmations. Alternatively, you can delete each resource individually.</li>
    </ol>
    <h1 class="heading-1" id="_idParaDest-407">Practicing and exploring</h1>
    <p class="normal">Test your knowledge and understanding by answering some questions, getting some hands-on practice, and exploring this chapter’s topics with deeper research.</p>
    <h2 class="heading-2" id="_idParaDest-408">Exercise 10.1 – Test your knowledge</h2>
    <p class="normal">Answer the following questions:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">What is the difference between the in-process and isolated worker models for Azure Functions?</li>
      <li class="numberedList">What attribute do you use to cause a function to trigger when a message arrives in a queue?</li>
      <li class="numberedList">What attribute do you use to make a queue available to send messages to?</li>
      <li class="numberedList">What schedule does the following NCRONTAB expression define?</li>
    </ol>
    <p class="normal"><code class="inlineCode">0 0 */6 * 6 6</code></p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">How can you configure a dependency service for use in a function?</li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-409">Exercise 10.2 – Explore topics</h2>
    <p class="normal">Use the links on the following page for more details on the topics covered in this chapter:</p>
    <p class="normal"><a href="https://github.com/markjprice/apps-services-net8/blob/main/docs/book-links.md#chapter-10---building-serverless-nanoservices-using-azure-functions">https://github.com/markjprice/apps-services-net8/blob/main/docs/book-links.md#chapter-10---building-serverless-nanoservices-using-azure-functions</a></p>
    <h1 class="heading-1" id="_idParaDest-410">Summary</h1>
    <p class="normal">In this chapter, you learned:</p>
    <ul>
      <li class="bulletList">Some of the concepts around Azure Functions</li>
      <li class="bulletList">How to build serverless services using Azure Functions</li>
      <li class="bulletList">How to respond to HTTP, Timer, and Queue triggers</li>
      <li class="bulletList">How to bind to Queue and Blob Storage</li>
      <li class="bulletList">How to deploy an Azure Functions project to the cloud</li>
    </ul>
    <p class="normal">In the next chapter, you will learn about SignalR, a technology for performing real-time communication between client and server.</p>
  </div>
</body></html>