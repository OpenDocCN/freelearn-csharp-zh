- en: Chapter 13. Creating a Web Application in Azure
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'This chapter will introduce you to Azure. If you have never worked with Azure
    before, the interface might seem a bit daunting. Azure, however, is actually not
    all that complicated and is a tremendous benefit to any developer. In this chapter,
    we will have a look at doing the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Creating a database in Azure for testing
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating a web application and hosting on Azure
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using virtual machines on Azure
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure allows developers to be more productive. It is a series of cloud services
    that developers can use to build apps, protect data, and provide high availability
    to your applications irrespective of what you are building. Mobile apps, enterprise
    apps, web, **internet of things** (**IoT**)… all are welcome on Azure.
  prefs: []
  type: TYPE_NORMAL
- en: You can create apps with .NET, JavaScript, PHP, Node.js, Python, and even run
    Linux containers. Azure also allows you to only pay for what you actually use,
    allowing you to easily scale as your needs grow.
  prefs: []
  type: TYPE_NORMAL
- en: Creating a database in Azure for testing
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Creating a database in Azure is really a straightforward process. A lot of work
    has gone into making the process really streamlined with an all-too-familiar wizard-type
    interface.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To start working with Azure, you will need to have an Azure account. You can
    create a free trial account. For more information on Azure pricing, have a look
    at the following URL: [https://azure.microsoft.com/en-us/pricing/](https://azure.microsoft.com/en-us/pricing/).'
  prefs: []
  type: TYPE_NORMAL
- en: How to do it…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: After you have logged in to your Azure account, you will be taken to your **Dashboard**.
    From here you can see any items you may have pinned. To the left, you will see
    the menu. We just want to create a SQL database, so click on the **SQL databases**
    menu item:![How to do it…](img/B05391_13_01.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If this is the first time you are using Azure, you will not have any databases
    available in the **Default Directory**. Click on **Add** to create a new database:![How
    to do it…](img/B05391_13_02.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You will now be presented with a form that you can use to specify the database
    details. As you can see, you will probably not have a server selected. This is
    because you probably don't have one yet. Click on **Server Configure required
    setting**:![How to do it…](img/B05391_13_03.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You will be given the option to create a new server. This is where you will
    also create the **Server admin login**:![How to do it…](img/B05391_13_04.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: When you have created your server, you will be taken back to the database setup
    screen. The server you created is now selected for you:![How to do it…](img/B05391_13_05.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: When you click the **Create** button, Azure will start deploying your database
    to the server you created:![How to do it…](img/B05391_13_06.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: This process can take a couple of minutes, so be patient while it completes.
    When the database deployment is completed, you will see a notification in the
    notifications tab at the top of the Azure portal:![How to do it…](img/B05391_13_07.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You might need to refresh your SQL databases screen to see the newly deployed
    database. In order to complete the next steps, click on the created database in
    the databases list:![How to do it…](img/B05391_13_08.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The properties and settings for the created database are then displayed. Here
    you can see the **Resource group** you selected, along with the **Server name**
    and other properties. Of particular interest is the **Connection strings** property:![How
    to do it…](img/B05391_13_09.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Clicking on the **Connection strings** will display the connection strings for
    the different providers for the database you created. Make a note of the **ADO.NET(SQL
    authentication)** string:![How to do it…](img/B05391_13_10.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Going back to the previous screen, click on the **Server name** property. It
    is here that you will find the **Firewall** settings. You need to add a rule to
    the firewall to allow your computer to connect to this database:![How to do it…](img/B05391_13_11.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Clicking on the **Show firewall settings**, you will see that you can add a
    client IP. By default, the machine's IP address you are accessing the **Firewall
    settings** from is displayed in the **Client IP address** field. Click on the
    **Add client IP** to add your current machine's IP address to allow it through
    the firewall. You can change the **RULE NAME** to something more user friendly:![How
    to do it…](img/B05391_13_12.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: You can also define a different IP address here to give a colleague access to
    this database from their machine.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: After you have added your firewall rules, open up SQL Server Management Studio
    on your local development machine. In the **Object Explorer**, click on the **Connect
    Object Explorer** button:![How to do it…](img/B05391_13_13.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Have a look at the connection string you made a note of earlier. After the server
    portion in the connection string, I copied the server name as `tcp:srvcookbook.database.windows.net`.
    Paste that in the **Server** **name** field in the **Connect to Server** screen.
    Lastly, enter the **Login** and **Password** you defined when creating the server
    on Azure. Click on the **Connect** button:![How to do it…](img/B05391_13_14.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: SQL Server Management Studio will now connect to the `CookbookDb` database on
    Azure:![How to do it…](img/B05391_13_15.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Azure is the perfect place to store your database. It is secure and accessible
    to only those developers you choose. You need to be aware that if your IP address
    changes, you might need to reconfigure the firewall rule on your Azure database.
    This does, however, bode well for security, because you can be assured that your
    data is secure. For more information on databases in Azure, have a look at the
    following documentation: [https://azure.microsoft.com/en-us/documentation/services/sql-database/](https://azure.microsoft.com/en-us/documentation/services/sql-database/).'
  prefs: []
  type: TYPE_NORMAL
- en: Creating a web application and hosting on Azure
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: One of the things a web developer does more often than not is to deploy a web
    application for (**user acceptance testing**) **UAT** or developer testing purposes.
    Azure makes this process very convenient for you by providing a seamless publishing
    experience from within Visual Studio. To publish a web application or website
    to Azure, you first need to create a web application on Azure to publish your
    website to.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To start working with Azure, you will need to have an Azure account. You can
    create a free trial account. For more information on Azure pricing, have a look
    at the following URL: [https://azure.microsoft.com/en-us/pricing/](https://azure.microsoft.com/en-us/pricing/).'
  prefs: []
  type: TYPE_NORMAL
- en: How to do it…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: After you have logged in to your Azure account, you will be taken to your **Dashboard**.
    From here you can see any items you may have pinned. To the left, you will see
    the menu. We want to create a website, so click on the **App Services** menu item:![How
    to do it…](img/B05391_13_16.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If this is your first time using Azure, you probably will not have any app services
    to display. Click on **Add** to create a new one:![How to do it…](img/B05391_13_17.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Give the app service a name and select or create a **Resource Group**:![How
    to do it…](img/B05391_13_18.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: When you click the **Create** button, Azure starts the deployment. This process
    can take several minutes to complete, so go grab a cup of coffee while you wait:![How
    to do it…](img/B05391_13_19.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: When the deployment is finished, you will receive a notification in the notifications
    menu:![How to do it…](img/B05391_13_20.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Refreshing the **App Services** section, you will see the **cookbookdemo** web
    app that we have just created. You might need to click on the **Refresh** button
    before the **cookbookdemo** web app becomes visible:![How to do it…](img/B05391_13_21.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Clicking on the **cookbookdemo** web app will display the properties. Take special
    notice of the **URL** in the upper-right corner:![How to do it…](img/B05391_13_22.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If you click on this URL, you will be taken to the default placeholder site
    for your web application. It is time to publish our website to Azure:![How to
    do it…](img/B05391_13_23.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Start Visual Studio and create or open a website you want to publish. I have
    created a simple website that I want to publish:![How to do it…](img/B05391_13_24.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Right-click on your website project and click on **Publish** **Web App** from
    the context menu:![How to do it…](img/B05391_13_25.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The **Publish Web**screen is displayed. Here you can see various publish targets
    available to you. We simply want to publish our application to Azure. Select **Microsoft
    Azure Web Apps** as a publish target:![How to do it…](img/B05391_13_26.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Clicking on **Next** will either ask you to connect to Azure or, if you have
    previously connected, select your **Subscription** from the drop-down selection.
    Any existing web apps are displayed in the **Existing Web Apps** list. The **cookbookdemo**
    web app we created earlier is displayed:![How to do it…](img/B05391_13_27.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Selecting the **cookbookdemo** web app, you now have to define your web app
    connection and **Publish method**. For now, we will just select **Web Deploy**
    as our method for publishing our web application to Azure:![How to do it…](img/B05391_13_28.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You can also click on the **Validate Connection** button to make sure everything
    is in order before continuing:![How to do it…](img/B05391_13_29.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Clicking **Next** takes you to the **Settings** screen. Here you can select
    a **Configuration** to deploy, as well as define a database connection:![How to
    do it…](img/B05391_13_30.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: As you will notice, the database connection I am using is the connection to
    the database we created in the first recipe of this chapter, *Creating a database
    in Azure for testing*.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: When you click **Next**, you will see that you can preview the files that are
    to be published to the web application on Azure. The initial publish will obviously
    contain the most files, as nothing exists on the web application yet:![How to
    do it…](img/B05391_13_31.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: When you are ready, clicking on the **Publish** button will start the process
    of publishing your website to Azure. This can also take a few minutes to complete.
    When the publish has completed, Visual Studio will automatically open the published
    website:![How to do it…](img/B05391_13_32.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Back in Azure, you will see the **Monitoring** window spring to life. You can
    also add other sections here that will provide more information about the state
    of your web application:![How to do it…](img/B05391_13_33.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Azure puts a lot of power into the hands of the developer when deploying to
    Azure. You can add additional sections that assist in the management of your web
    application. These are displayed to you as tiles. Some of the sections available
    are:'
  prefs: []
  type: TYPE_NORMAL
- en: Process Explorer
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: WebJobs
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Traffic routing
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Requests and errors
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Http 4xx
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Http 5xx
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Filesystem storage
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Web tests
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Users and roles
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Performance tests
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Even your estimated Azure spend
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure is truly a very versatile cloud solution for developers, no matter what
    your individual needs.
  prefs: []
  type: TYPE_NORMAL
- en: Using virtual machines on Azure
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A **virtual machine** (**VM**) is indispensable to developers. I have a few
    myself that I use for my personal use and to try out new software. The technology
    behind it is quite incredible as it virtualizes a specific environment for you
    to accurately test your applications against. At my previous employer, we would
    create VMs of certain client environments in order to test application deployment
    and basically to see whether the application works correctly.
  prefs: []
  type: TYPE_NORMAL
- en: With Azure, developers have so many choices when deciding on a specific VM platform.
    You can spin up virtually (pun intended) any type of VM you need. If you want
    to test out the new Visual Studio, you can. A new version of Windows? You can
    bet there will be a VM on Azure for that. Want to play around with Linux and WordPress
    a bit? No problem. Azure does it all and it is incredibly easy to set up.
  prefs: []
  type: TYPE_NORMAL
- en: Consider the alternative. If VMs weren't there and you wanted to test an application
    on an OS such as Windows 10, you would probably have to set aside a specific machine
    just for testing different OS versions. That's one machine not available to you
    anymore for other work. Then you need to spend an hour or two setting up that
    PC with the correct OS. You then need to set the PC up to be available over the
    local network at your office. What about if you wanted to access that test machine
    from a remote location (at home for example)? You would need to configure it to
    be accessible remotely while still maintaining security. So then you set up a
    VPN to access the machine remotely on the off chance that the developers need
    to work after hours. This has to be done for a single instance of an application
    in development. If you have servers to spare, sure, this might not be a problem.
    If, however, you are a small-to-medium-sized company with limited resources, chances
    are you'll be reinstalling that machine soon with a different client's setup for
    testing.
  prefs: []
  type: TYPE_NORMAL
- en: This is where Azure is brilliant at making a difference. The setup process takes
    a few minutes, a moment compared to the setup required for a PC at your office.
    Remote access, security, event monitoring, alerts, and a whole bunch of other
    features are immediately available to all the developers in your team.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To start working with Azure, you will need to have an Azure account. You can
    create a free trial account. For more information on Azure pricing, have a look
    at the following URL: [https://azure.microsoft.com/en-us/pricing/](https://azure.microsoft.com/en-us/pricing/).'
  prefs: []
  type: TYPE_NORMAL
- en: How to do it…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: After you have logged in to your Azure account, you will be taken to your **Dashboard**.
    From here you can see any items you may have pinned. To the left you will see
    the menu. Click on the **Virtual machines** menu item:![How to do it…](img/B05391_13_34.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You will then be taken to the default directory for the virtual machines on
    your Azure subscription. We need to create a new virtual machine by clicking on
    the **Add** button:![How to do it…](img/B05391_13_35.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Azure then displays all the types of virtual machine available to you. There
    are quite a lot of types of machine to choose from. From Service Fabric, to Linux,
    to Ubuntu, the choice is vast:![How to do it…](img/B05391_13_36.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: For our purposes, we will just create a Windows virtual machine:![How to do
    it…](img/B05391_13_37.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Clicking on the **Windows** group, you can see that we have a choice of Windows
    10 Enterprise or Windows 8.1 Enterprise 64-bit VMs. We will simply select the
    Windows 10 VM to get started:![How to do it…](img/B05391_13_38.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You will now be asked to enter various settings to configure your Windows 10
    VMs. Give your VM a name and define a login user and password. The **Resource
    group** will allow you to select an existing one or create a new one:![How to
    do it…](img/B05391_13_39.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the next configuration screen, you will be presented with recommended VM
    sizes, each with their different pricing option displayed in your local currency.
    Choose the option that is most suitable for you, your requirements, and/or budget.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The next screen allows you to configure optional features. The features available
    to you are the following:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Storage account is where the disks for the VM are created.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Virtual network acts much like a traditional network. Any VMs in the same virtual
    network will be able to access each other, and this is configured by default.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Subnet allows you to isolate VM from other VMs or the Internet.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Public IP address allows you to communicate with a machine outside the virtual
    network defined previously.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Network security group is a collection of rules defined on your firewall that
    controls who can access your Windows 10 virtual machine.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Extensions are quite nice. These are additional add-ons, such as antivirus packages.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Monitoring is on by default and allows you to gather information about your
    VM and define alerts based on the information monitored. This keeps you in control
    and informed at all times.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: The diagnostics storage account is where the monitoring metrics are stored.
    You can then analyze these with any of your own tools if needed.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The availability setting allows you to cluster two or more VMs together to
    provide a failover if one of the VMs needs to be taken offline for maintenance.
    This need to be configured at this step because the availability setting can''t
    be changed after the VM is created:'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '![How to do it…](img/B05391_13_41.jpg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: Once you have configured the VM, you will be presented with a summary of the
    configuration options you selected during setup:![How to do it…](img/B05391_13_42.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: When you are satisfied that the VM is set up correctly, Azure will then start
    the deployment process:![How to do it…](img/B05391_13_43.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The progress of the deployment process is also visible on the **Dashboard**
    and takes a few minutes to complete:![How to do it…](img/B05391_13_44.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: After a few minutes, the VM is available and ready. You will be taken to the
    virtual machine page for your **cookbookvm**:![How to do it…](img/B05391_13_45.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: To connect to your VM, click on the **Connect** button:![How to do it…](img/B05391_13_46.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: An `.rdp` file is then downloaded. You can click on the file directly to start
    the **Remote Desktop Connection** session:![How to do it…](img/B05391_13_47.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You will probably be asked whether you trust the publisher of the remote connection.
    Obviously you do, so just click on the **Connect** button:![How to do it…](img/B05391_13_48.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You will now be able to enter your login credentials, as defined earlier during
    the VM setup:![How to do it…](img/B05391_13_49.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You will now be connected to the Windows 10 virtual machine via Remote Desktop
    Connection:![How to do it…](img/B05391_13_50.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Back in Azure, if you selected the **Monitoring** option during the VM setup,
    you will see that you have a default **Monitoring** tile for **CPU percentage**.
    Azure allows you to add more monitoring events and create alerts for each event:![How
    to do it…](img/B05391_13_51.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Virtual machines are accessible via remote connections. You can use the good
    old Remote Desktop Connection, or something more exotic such as mRemoteNG if you
    have several remote machines that you need to access. The reason that Azure is
    so well suited for development testing is because the resource does not have to
    live on your own network at all. That means the overhead involved in maintaining
    backups of development VMs is largely avoided.
  prefs: []
  type: TYPE_NORMAL
- en: I remember the network administrator at my previous employer regularly asking
    what VMs we still used. Some of these VMs were used perhaps once or twice a year,
    so they couldn't be deleted. Having several developers access these VMs also meant
    that there was a lot of junk on these VMs, which made backing those up a painful
    process (usually run over weekends).
  prefs: []
  type: TYPE_NORMAL
- en: Azure solves many issues and problems for IT professionals. In this chapter,
    we have looked at only three solutions available to you as a developer. Do not
    be fooled, Azure is much more powerful than just being able to provide a robust
    testing platform for developers. Going into detail about Azure would probably
    require a separate book on its own.
  prefs: []
  type: TYPE_NORMAL
