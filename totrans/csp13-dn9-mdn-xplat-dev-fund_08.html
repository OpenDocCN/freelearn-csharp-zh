<html><head></head><body><div id="book-content"><div id="sbo-rt-content"><div id="_idContainer475" class="Basic-Text-Frame">
    <h1 class="chapterNumber">8</h1>
    <h1 id="_idParaDest-500" class="chapterTitle">Working with Common .NET Types</h1>
    <p class="normal">This chapter is about some common types that are included with .NET. These include types for manipulating numbers, text, and collections; improving working with spans, indexes, and ranges; and, in an optional online-only section, working with network resources.</p>
    <p class="normal">This chapter covers the following topics:</p>
    <ul>
      <li class="bulletList">Working with numbers</li>
      <li class="bulletList">Working with text</li>
      <li class="bulletList">Pattern matching with regular expressions</li>
      <li class="bulletList">Storing multiple objects in collections</li>
      <li class="bulletList">Working with spans, indexes, and ranges</li>
    </ul>
    <h1 id="_idParaDest-501" class="heading-1">Working with numbers</h1>
    <p class="normal">One of the most<a id="_idIndexMarker1167"/> common types of data is numbers. The most common types in .NET for working with numbers are shown in <em class="italic">Table 8.1</em>:</p>
    <table id="table001-7" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Namespace</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Example types</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">SByte</code>, <code class="inlineCode">Int16</code>, <code class="inlineCode">Int32</code>, <code class="inlineCode">Int64</code>, <code class="inlineCode">Int128</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Integers; that is, zero, and positive and negative whole numbers.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Byte</code>, <code class="inlineCode">UInt16</code>, <code class="inlineCode">UInt32</code>, <code class="inlineCode">UInt64</code>, <code class="inlineCode">UInt128</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Cardinals; that is, zero and positive whole numbers.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Half</code>, <code class="inlineCode">Single</code>, <code class="inlineCode">Double</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Reals; that is, floating-point numbers.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Decimal</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Accurate reals; that is, for use in science, engineering, or financial scenarios.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System.Numerics</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">BigInteger</code>, <code class="inlineCode">Complex</code>, <code class="inlineCode">Quaternion</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Arbitrarily large integers, complex numbers, and quaternion numbers.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 8.1: Common .NET number types</p>
    <p class="normal">.NET has had the 32-bit <code class="inlineCode">float</code> and 64-bit <code class="inlineCode">double</code> types since .NET Framework 1.0 was released in 2002. The IEEE 754 specification also defines a 16-bit floating-point standard. Machine<a id="_idIndexMarker1168"/> learning and other algorithms would benefit from this smaller, lower-precision number type; so, Microsoft introduced the <code class="inlineCode">System.Half</code> type with .NET 5 and later. Currently, the C# language does not define a <code class="inlineCode">half</code> alias, so you must use the .NET type <code class="inlineCode">System.Half</code>. This might change in the future.</p>
    <p class="normal"><code class="inlineCode">System.Int128</code> and <code class="inlineCode">System.UInt128</code> were introduced with .NET 7, and they too do not yet have a C# alias keyword.</p>
    <h2 id="_idParaDest-502" class="heading-2">Working with big integers</h2>
    <p class="normal">The largest<a id="_idIndexMarker1169"/> whole number that can<a id="_idIndexMarker1170"/> be stored in .NET types that have a C# alias is about eighteen and a half quintillion, stored in an unsigned 64-bit integer using <code class="inlineCode">ulong</code>. But what if you need to store numbers larger than that?</p>
    <p class="normal">Let’s explore numerics:</p>
    <ol>
      <li class="numberedList" value="1">Use your preferred code editor to create a new project, as defined in the following list:<ul>
          <li class="bulletList level-2">Project template: <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code></li>
          <li class="bulletList level-2">Project file and folder: <code class="inlineCode">WorkingWithNumbers</code></li>
          <li class="bulletList level-2">Solution file and folder: <code class="inlineCode">Chapter08</code></li>
        </ul>
      </li>
      <li class="numberedList">In the project file, add an element to statically and globally import the <code class="inlineCode">System.Console</code> class.</li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete the existing statements and then add a statement to import <code class="inlineCode">System.Numerics</code>, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">using</span> System.Numerics; <span class="hljs-comment">// To use BigInteger.</span>
</code></pre>
      </li>
      <li class="numberedList">Add statements<a id="_idIndexMarker1171"/> to output the maximum value of the <code class="inlineCode">ulong</code> type, and a number with 30 digits using <code class="inlineCode">BigInteger</code>, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> width = <span class="hljs-number">40</span>;
WriteLine(<span class="hljs-string">"ulong.MaxValue vs a 30-digit BigInteger"</span>);
WriteLine(<span class="hljs-keyword">new</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">'-'</span>, width));
<span class="hljs-built_in">ulong</span> big = <span class="hljs-built_in">ulong</span>.MaxValue;
WriteLine(<span class="hljs-string">$"</span><span class="hljs-subst">{big,width:N0}</span><span class="hljs-string">"</span>);
BigInteger bigger =
  BigInteger.Parse(<span class="hljs-string">"</span><span class="hljs-string">123456789012345678901234567890"</span>);
WriteLine(<span class="hljs-string">$"</span><span class="hljs-subst">{bigger,width:N0}</span><span class="hljs-string">"</span>);
</code></pre>
      </li>
    </ol>
    <div class="note-one">
      <p class="normal">The <code class="inlineCode">width</code> constant with the value <code class="inlineCode">40</code> in the format code means “right-align 40 characters,” so both numbers are lined up to the right-hand edge. The <code class="inlineCode">N0</code> means “use a thousand separators and zero decimal places.”</p>
    </div>
    <ol>
      <li class="numberedList" value="5">Run the code and view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">ulong.MaxValue vs a 30-digit BigInteger
----------------------------------------
              18,446,744,073,709,551,615
 123,456,789,012,345,678,901,234,567,890
</code></pre>
      </li>
    </ol>
    <p class="normal"><code class="inlineCode">BigInteger</code> can represent integer values of nearly unlimited length. However, in reality, this is constrained by factors like available memory and computation time. Some APIs can also fail if the value produced is excessively large. Therefore, in .NET 9 and later, a maximum length for <code class="inlineCode">BigInteger</code> has been enforced, limiting it to <code class="inlineCode">(2^31) - 1</code> bits (approximately 2.14 billion bits). This translates to about 256 MB and approximately 646.5 million digits. This limit ensures APIs <a id="_idIndexMarker1172"/>remain reliable and consistent <a id="_idIndexMarker1173"/>while still supporting numbers far larger than most practical needs.</p>
    <h2 id="_idParaDest-503" class="heading-2">Multiplying big integers</h2>
    <p class="normal">When you<a id="_idIndexMarker1174"/> multiply two 32-bit integers, the <a id="_idIndexMarker1175"/>result can exceed the range of a 32-bit integer. For instance, the maximum value of a 32-bit integer (<code class="inlineCode">int</code>) is 2,147,483,647. If you multiply this by another large integer, the result can exceed this limit, causing an overflow and potentially resulting in incorrect calculations if only 32 bits are used to store the result.</p>
    <p class="normal">Since the earliest versions of .NET, the <code class="inlineCode">System.Math</code> class has a <code class="inlineCode">BigMul</code> method that performs a multiplication of two 32-bit integers and returns the full 64-bit result as a <code class="inlineCode">long</code>. This method is necessary because multiplying two 32-bit integers using the * operator can result in a 64-bit integer, which might overflow the typical 32-bit integer type.</p>
    <p class="normal">Since .NET 5, <code class="inlineCode">BigMul</code> has gained overloads to multiply two signed or unsigned <code class="inlineCode">long</code> values. In .NET 9 and later, the number types themselves, like <code class="inlineCode">int</code> and <code class="inlineCode">long</code> and <code class="inlineCode">uint</code> and <code class="inlineCode">ulong</code>, now gain <code class="inlineCode">BigMul</code> methods to multiply their values and return the results in the next largest type. For example, <code class="inlineCode">long.BigMul</code> returns a <code class="inlineCode">System.Int128</code>.</p>
    <p class="normal">Now, let’s look at how to multiply big integers:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, add statements to multiply some big integers using old and new methods, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">WriteLine(<span class="hljs-string">"Multiplying big integers"</span>);
<span class="hljs-built_in">int</span> number1 = <span class="hljs-number">2</span>_000_000_000;
<span class="hljs-built_in">int</span> number2 = <span class="hljs-number">2</span>;
WriteLine(<span class="hljs-string">$"number1: </span><span class="hljs-subst">{number1:N0}</span><span class="hljs-string">"</span>);
WriteLine(<span class="hljs-string">$"number2: </span><span class="hljs-subst">{number2:N0}</span><span class="hljs-string">"</span>);
WriteLine(<span class="hljs-string">$"number1 * number2: </span><span class="hljs-subst">{number1 * number2:N0}</span><span class="hljs-string">"</span>);
WriteLine(<span class="hljs-string">$"Math.BigMul(number1, number2): </span><span class="hljs-subst">{</span>
<span class="hljs-subst">  Math.BigMul(number1, number2):N0}</span><span class="hljs-string">"</span>);
WriteLine(<span class="hljs-string">$"int.BigMul(number1, number2): </span><span class="hljs-subst">{</span>
<span class="hljs-subst">  </span><span class="hljs-built_in">int</span><span class="hljs-subst">.BigMul(number1, number2):N0}</span><span class="hljs-string">"</span>);
</code></pre>
      </li>
      <li class="numberedList">Run the <a id="_idIndexMarker1176"/>code and view the<a id="_idIndexMarker1177"/> result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Multiplying big integers
number1: 2,000,000,000
number2: 2
number1 * number2: -294,967,296
Math.BigMul(number1, number2): 4,000,000,000
int.BigMul(number1, number2): 4,000,000,000
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-504" class="heading-2">Working with complex numbers</h2>
    <p class="normal">A complex <a id="_idIndexMarker1178"/>number can be expressed <a id="_idIndexMarker1179"/>as <em class="italic">a + bi</em>, where <em class="italic">a</em> and <em class="italic">b</em> are real numbers and <em class="italic">i</em> is an imaginary unit, where <em class="italic">i</em><sup class="superscript">2</sup><em class="italic"> = −1</em>. If the real part <em class="italic">a</em> is zero, it is a purely imaginary number. If the imaginary part <em class="italic">b</em> is zero, it is a real number.</p>
    <p class="normal">Complex numbers have practical applications in many <strong class="keyWord">science, technology, engineering, and mathematics </strong>(<strong class="keyWord">STEM</strong>) fields<a id="_idIndexMarker1180"/> of study. They are added by separately adding the real and imaginary parts of the summands; consider this:</p>
    <pre class="programlisting code"><code class="hljs-code">(a + bi) + (c + di) = (a + c) + (b + d)i
</code></pre>
    <p class="normal">Let’s<a id="_idIndexMarker1181"/> explore <a id="_idIndexMarker1182"/>complex numbers:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, add statements to add two complex numbers, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">Complex c1 = <span class="hljs-keyword">new</span>(real: <span class="hljs-number">4</span>, imaginary: <span class="hljs-number">2</span>);
Complex c2 = <span class="hljs-keyword">new</span>(real: <span class="hljs-number">3</span>, imaginary: <span class="hljs-number">7</span>);
Complex c3 = c1 + c2;
<span class="hljs-comment">// Output using the default ToString implementation.</span>
WriteLine(<span class="hljs-string">$"</span><span class="hljs-subst">{c1}</span><span class="hljs-string"> added to </span><span class="hljs-subst">{c2}</span><span class="hljs-string"> is </span><span class="hljs-subst">{c3}</span><span class="hljs-string">"</span>);
<span class="hljs-comment">// Output using a custom format.</span>
WriteLine(<span class="hljs-string">"{0} + {1}i added to {2} + {3}i is {4} + {5}i"</span>,
  c1.Real, c1.Imaginary,
  c2.Real, c2.Imaginary,
  c3.Real, c3.Imaginary);
</code></pre>
      </li>
      <li class="numberedList">Run the code and view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">&lt;4; 2&gt; added to &lt;3; 7&gt; is &lt;7; 9&gt;
4 + 2i added to 3 + 7i is 7 + 9i
</code></pre>
      </li>
    </ol>
    <div class="note">
      <p class="normal">.NET 6 and earlier used a different default format for complex numbers: <code class="inlineCode">(4, 2) added to (3, 7) is (7, 9)</code>. In .NET 7 and later, the default format was changed to use angle brackets and semi-colons because some cultures use round brackets to indicate negative numbers and use commas for decimal numbers. At the time of writing, the official documentation has not been updated to use <a id="_idIndexMarker1183"/>the new format, as shown<a id="_idIndexMarker1184"/> at the following link: <a href="https://learn.microsoft.com/en-us/dotnet/api/system.numerics.complex.tostring"><span class="url">https://learn.microsoft.com/en-us/dotnet/api/system.numerics.complex.tostring</span></a>.</p>
    </div>
    <h2 id="_idParaDest-505" class="heading-2">Working with tensors</h2>
    <p class="normal">Tensors are a<a id="_idIndexMarker1185"/> fundamental data structure in <strong class="keyWord">artificial</strong><strong class="keyWord"><a id="_idIndexMarker1186"/></strong><strong class="keyWord"> intelligence</strong> (<strong class="keyWord">AI</strong>). You can think of them as specialized multidimensional arrays.</p>
    <p class="normal">Tensors are used to represent and encode various forms of data, including text sequences (tokens), images, videos, and audio. Tensors perform computations on high-dimensional data with optimal efficiency and store weight information and intermediate calculations within neural networks.</p>
    <p class="normal">.NET 9 introduced a new <code class="inlineCode">Tensor&lt;T&gt;</code> type that enables efficient interoperation with AI libraries, such as ML.NET, TorchSharp, and ONNX Runtime, and minimizes data copying where possible. It simplifies data manipulation through intuitive indexing and slicing operations, ensuring ease of use and efficiency.</p>
    <h2 id="_idParaDest-506" class="heading-2">Generating random numbers for games and similar apps</h2>
    <p class="normal">In scenarios that<a id="_idIndexMarker1187"/> don’t <a id="_idIndexMarker1188"/>need truly random numbers like games, you can create an instance of the <code class="inlineCode">Random</code> class, as shown in the following code example:</p>
    <pre class="programlisting code"><code class="hljs-code">Random r = <span class="hljs-keyword">new</span>();
</code></pre>
    <p class="normal"><code class="inlineCode">Random</code> has a constructor with a parameter for specifying a seed value used to initialize its pseudo-random number generator, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">Random r = <span class="hljs-keyword">new</span>(Seed: <span class="hljs-number">46378</span>);
</code></pre>
    <p class="normal">As you learned in <em class="chapterRef">Chapter 2</em>, <em class="italic">Speaking C#</em>, parameter names should use <em class="italic">camel case</em>. The developer who defined the constructor for the <code class="inlineCode">Random</code> class broke this convention. The parameter name should be <code class="inlineCode">seed</code>, not <code class="inlineCode">Seed</code>.</p>
    <div class="packt_tip">
      <p class="normal"><strong class="keyWord">Good practice</strong>: Shared seed values act as a secret key; so, if you use the same random number generation algorithm with the same seed value in two applications, then they can generate the same “random” sequences of numbers. Sometimes this is necessary, for example, when synchronizing a GPS receiver with a satellite, or when a game needs to randomly generate the same level. But usually, you <a id="_idIndexMarker1189"/>want to<a id="_idIndexMarker1190"/> keep your seed secret.</p>
    </div>
    <h3 id="_idParaDest-507" class="heading-3">Generating random numbers with the Random class</h3>
    <p class="normal">To avoid <a id="_idIndexMarker1191"/>allocating more memory than necessary, .NET 6 introduced a shared static instance of <code class="inlineCode">Random</code> that you can access instead of creating your own.</p>
    <p class="normal">The <code class="inlineCode">Random</code> class has commonly used methods for generating random numbers, as described in the following list:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">Next</code>: This method returns a random <code class="inlineCode">int</code> (whole number) and it takes two parameters, <code class="inlineCode">minValue</code> and <code class="inlineCode">maxValue</code>, but <code class="inlineCode">maxValue</code> is not the maximum value that the method returns! It is an <em class="italic">exclusive upper bound</em>, meaning <code class="inlineCode">maxValue</code> is one more than the maximum value returned. Use the <code class="inlineCode">NextInt64</code> method to return a <code class="inlineCode">long</code> integer.</li>
      <li class="bulletList"><code class="inlineCode">NextDouble</code>: This method returns a number that is greater than or equal to <code class="inlineCode">0.0</code> and less than and never equal to <code class="inlineCode">1.0</code>. Use the <code class="inlineCode">NextSingle</code> method to return a <code class="inlineCode">float</code>.</li>
      <li class="bulletList"><code class="inlineCode">NextBytes</code>: This method populates an array of any size with random <code class="inlineCode">byte</code> (<code class="inlineCode">0</code> to <code class="inlineCode">255</code>) values. It is common to format <code class="inlineCode">byte</code> values as hexadecimal, for example, <code class="inlineCode">00</code> to <code class="inlineCode">FF</code>.</li>
    </ul>
    <p class="normal">Let’s see some examples of generating pseudo-random numbers:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, add statements to access the shared <code class="inlineCode">Random</code> instance, and then call its methods to generate random numbers, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">Random r = Random.Shared;
<span class="hljs-comment">// minValue is an inclusive lower bound i.e. 1 is a possible value.</span>
<span class="hljs-comment">// maxValue is an exclusive upper bound i.e. 7 is not a possible value.</span>
<span class="hljs-built_in">int</span> dieRoll = r.Next(minValue: <span class="hljs-number">1</span>, maxValue: <span class="hljs-number">7</span>); <span class="hljs-comment">// Returns 1 to 6.</span>
WriteLine(<span class="hljs-string">$"Random die roll: </span><span class="hljs-subst">{dieRoll}</span><span class="hljs-string">"</span>);
<span class="hljs-built_in">double</span> randomReal = r.NextDouble(); <span class="hljs-comment">// Returns 0.0 to less than 1.0.</span>
WriteLine(<span class="hljs-string">$"Random double: </span><span class="hljs-subst">{randomReal}</span><span class="hljs-string">"</span>);
<span class="hljs-built_in">byte</span>[] arrayOfBytes = <span class="hljs-keyword">new</span> <span class="hljs-built_in">byte</span>[<span class="hljs-number">256</span>];
r.NextBytes(arrayOfBytes); <span class="hljs-comment">// Fills array with 256 random bytes.</span>
Write(<span class="hljs-string">"Random bytes: "</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; arrayOfBytes.Length; i++)
{
  Write(<span class="hljs-string">$"</span><span class="hljs-subst">{arrayOfBytes[i]:X2}</span><span class="hljs-string"> "</span>);
}
WriteLine();
</code></pre>
      </li>
      <li class="numberedList">Run the code <a id="_idIndexMarker1192"/>and view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Random die roll: 1
Random double: 0.06735275453092382
Random bytes: D9 38 CD F3 5B 40 2D F4 5B D0 48 DF F7 B6 67 C1 95 A1 2C 58 42 CF 70 6C C3 BE 82 D7 EC 61 0D D2 2D C4 49 7B C7 0F EA CC B3 41 F3 04 5D 29 25 B7 F7 99 8A 0F 56 20 A6 B3 57 C4 48 DA 94 2B 07 F1 15 64 EA 8D FF 79 E6 E4 9A C8 65 C5 D8 55 3D 3C C0 2B 0B 4C 3A 0E E6 A5 91 B7 59 6C 9A 94 97 43 B7 90 EE D8 9A C6 CA A1 8F DD 0A 23 3C 01 48 E0 45 E1 D6 BD 7C 41 C8 22 8A 81 82 DC 1F 2E AD 3F 93 68 0F B5 40 7B 2B 31 FC A6 BF BA 05 C0 76 EE 58 B3 41 63 88 E5 5C 8B B5 08 5C C3 52 FF 73 69 B0 97 78 B5 3B 87 2C 12 F3 C3 AE 96 43 7D 67 2F F8 C9 31 70 BD AD B3 9B 44 53 39 5F 19 73 C8 43 0E A5 5B 6B 5A 9D 2F DF DC A3 EE C5 CF AF A4 8C 0F F2 9C 78 19 48 CE 49 A8 28 06 A3 4E 7D F7 75 AA 49 E7 4E 20 AF B1 77 0A 90 CF C1 E0 62 BC 4F 79 76 64 98 BF 63 76 B4 F9 1D A4 C4 74 03 63 02
</code></pre>
      </li>
    </ol>
    <div class="note">
      <p class="normal">In scenarios that do need truly random numbers, like cryptography, there are specialized types for that, like <code class="inlineCode">RandomNumberGenerator</code>. I cover this and other cryptographic <a id="_idIndexMarker1193"/>types in the companion book, <em class="italic">Tools and Skills for .NET 8</em>, in a chapter titled <em class="italic">Protecting Data and Apps Using Cryptography</em>, published in July 2024.</p>
    </div>
    <h3 id="_idParaDest-508" class="heading-3">New random methods in .NET 8 and later</h3>
    <p class="normal">.NET 8 introduced<a id="_idIndexMarker1194"/> two new <code class="inlineCode">Random</code> methods, as <a id="_idIndexMarker1195"/>described in the following list:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">GetItems&lt;T&gt;</code>: This method is passed an array or read-only span of any type <code class="inlineCode">T</code> of choices and the number of items you want to generate, and then it returns that number of items randomly selected from the choices.</li>
      <li class="bulletList"><code class="inlineCode">Shuffle&lt;T&gt;</code>: This method is passed an array or span of any type <code class="inlineCode">T</code> and the order of items is randomized.</li>
    </ul>
    <p class="normal">Let’s see an example of each:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, add statements to access the shared <code class="inlineCode">Random</code> instance, and then call its methods to generate random numbers, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-built_in">string</span>[] beatles = r.GetItems(
  choices: <span class="hljs-keyword">new</span>[] { <span class="hljs-string">"John"</span>, <span class="hljs-string">"Paul"</span>, <span class="hljs-string">"George"</span>, <span class="hljs-string">"Ringo"</span> },
  length: <span class="hljs-number">10</span>);
Write(<span class="hljs-string">"Random ten beatles:"</span>);
<span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">string</span> beatle <span class="hljs-keyword">in</span> beatles)
{
  Write(<span class="hljs-string">$" </span><span class="hljs-subst">{beatle}</span><span class="hljs-string">"</span>);
}
WriteLine();
r.Shuffle(beatles);
Write(<span class="hljs-string">"Shuffled beatles:"</span>);
<span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">string</span> beatle <span class="hljs-keyword">in</span> beatles)
{
  Write(<span class="hljs-string">$" </span><span class="hljs-subst">{beatle}</span><span class="hljs-string">"</span>);
}
WriteLine();
</code></pre>
      </li>
      <li class="numberedList">Run the<a id="_idIndexMarker1196"/> code and<a id="_idIndexMarker1197"/> view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Random ten beatles: Paul Paul John John John John Paul John George Ringo
Shuffled beatles: George John Paul Paul John John John Ringo Paul John
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-509" class="heading-2">Generating GUIDs</h2>
    <p class="normal">A <strong class="keyWord">globally unique identifier (GUID)</strong> is a 128-bit text string that represents a unique value<a id="_idIndexMarker1198"/> for identification. As <a id="_idIndexMarker1199"/>a developer, you will need to generate GUIDs when a unique reference is needed to identify information. Traditionally, database and computer systems may have used an incrementing integer value, but a GUID is more likely to avoid conflicts in multi-tasking systems.</p>
    <p class="normal">The <code class="inlineCode">System.Guid</code> type is a value type (<code class="inlineCode">struct</code>) that represents a GUID value. It has <code class="inlineCode">Parse</code> and <code class="inlineCode">TryParse</code> methods to take an existing GUID value represented as a <code class="inlineCode">string</code> and convert it into the <code class="inlineCode">Guid</code> type. It has a <code class="inlineCode">NewGuid</code> method to generate a new value.</p>
    <p class="normal">The <code class="inlineCode">NewGuid</code> method implements version 4 of the <strong class="keyWord">universally unique identifiers (UUIDs)</strong> specification. You<a id="_idIndexMarker1200"/> can learn about the UUID specification at the following link: <a href="https://datatracker.ietf.org/doc/rfc9562/"><span class="url">https://datatracker.ietf.org/doc/rfc9562/</span></a>.</p>
    <p class="normal">.NET 9 introduced support for version 7 of the UUID specification, which allows you to control the first 48-bit timestamp millisecond ticks since Unix Epoch so that you can create sortable GUIDs. This is much better for unique IDs for databases.</p>
    <p class="normal">Let’s break down an example value: <code class="inlineCode">0191a398-12ec-7d5e-a8d3-8a629eae8be1</code>:</p>
    <ul>
      <li class="bulletList">The first 48 bits are a timestamp in hexadecimal: <code class="inlineCode">0191a39812ec</code>.<ul>
          <li class="bulletList level-2"><code class="inlineCode">0191a398</code>: The first 32 bits represent the high part of the timestamp.</li>
          <li class="bulletList level-2"><code class="inlineCode">12ec</code>: The next 16 bits continue the timestamp.</li>
        </ul>
      </li>
      <li class="bulletList">The<a id="_idIndexMarker1201"/> next 12 bits <a id="_idIndexMarker1202"/>are a version and variant in hexadecimal: <code class="inlineCode">7d5e</code>.<ul>
          <li class="bulletList level-2">The <code class="inlineCode">7</code> indicates that this is a version 7 UUID.</li>
          <li class="bulletList level-2">The remaining three digits (<code class="inlineCode">d5e</code>) combine parts of the timestamp and the variant, which is used to identify the layout of the UUID.</li>
        </ul>
      </li>
      <li class="bulletList">The final 68 bits are a random section in hexadecimal: <code class="inlineCode">a8d3-8a629eae8be1</code>.<ul>
          <li class="bulletList level-2">This ensures the uniqueness of the GUID.</li>
        </ul>
      </li>
    </ul>
    <p class="normal">Let’s see how we can generate GUID values and output them:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, add statements to output the value of an empty <code class="inlineCode">Guid</code>, generate a new random <code class="inlineCode">Guid</code> and then output its value, and finally output each individual byte of the random <code class="inlineCode">Guid</code> value, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">WriteLine(<span class="hljs-string">$"Empty GUID: </span><span class="hljs-subst">{Guid.Empty}</span><span class="hljs-string">."</span>);
Guid g = Guid.NewGuid();
WriteLine(<span class="hljs-string">$"Random GUID: </span><span class="hljs-subst">{g}</span><span class="hljs-string">."</span>);
<span class="hljs-built_in">byte</span>[] guidAsBytes = g.ToByteArray();
Write(<span class="hljs-string">"GUID as byte array: "</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; guidAsBytes.Length; i++)
{
  Write(<span class="hljs-string">$"</span><span class="hljs-subst">{guidAsBytes[i]:X2}</span><span class="hljs-string"> "</span>);
}
WriteLine();
WriteLine("Generating three v7 GUIDs:");
for (int i = 0; i &lt; 3; i++)
{
  Guid g7 = Guid.CreateVersion7(DateTimeOffset.UtcNow);
  WriteLine($"  {g7}.");
}
</code></pre>
      </li>
      <li class="numberedList">Run the code, view<a id="_idIndexMarker1203"/> the result, and <a id="_idIndexMarker1204"/>note that the first parts of the three GUID values (<code class="inlineCode">0191a398-12ec</code> and so on) are sortable because they are based on the same <code class="inlineCode">DateTimeOffset</code> value, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Empty GUID: 00000000-0000-0000-0000-000000000000.
Random GUID: c7a11eea-45a5-4619-964a-a9cce1e4220c.
GUID as byte array: EA 1E A1 C7 A5 45 19 46 96 4A A9 CC E1 E4 22 0C
Generating three v7 GUIDs:
  0191a398-12ec-7d5e-a8d3-8a629eae8be1.
  0191a398-12ed-7913-8096-c6f70b5edd8f.
  0191a398-12ed-7475-8284-0588b573080e.
</code></pre>
        <div class="note">
          <p class="normal">The EF Core team has a proposal to enable the use of version 7 GUIDs in your data models. You can learn more about that idea at the following link: <a href="https://github.com/dotnet/efcore/issues/34158"><span class="url">https://github.com/dotnet/efcore/issues/34158</span></a>.</p>
        </div>
      </li>
    </ol>
    <h1 id="_idParaDest-510" class="heading-1">Working with text</h1>
    <p class="normal">One of the other <a id="_idIndexMarker1205"/>most common types of data for variables is text. The most common types in .NET for working with text are shown in <em class="italic">Table 8.2</em>:</p>
    <table id="table002-7" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Namespace</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Type</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Char</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Storage for a single text character</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">String</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Storage for multiple text characters</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System.Text</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">StringBuilder</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Efficiently manipulates strings</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System.Text.RegularExpressions</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Regex</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Efficiently pattern-matches strings</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 8.2: Common .NET types for working with text</p>
    <h2 id="_idParaDest-511" class="heading-2">Getting the length of a string</h2>
    <p class="normal">Let’s explore<a id="_idIndexMarker1206"/> some common tasks when working with<a id="_idIndexMarker1207"/> text; for example, sometimes you need to find out the length of a piece of text stored in a <code class="inlineCode">string</code> variable:</p>
    <ol>
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Console App </strong>/ <code class="inlineCode">console</code> project named <code class="inlineCode">WorkingWithText</code> to the <code class="inlineCode">Chapter08</code> solution.</li>
      <li class="numberedList">In the <code class="inlineCode">WorkingWithText</code> project, in <code class="inlineCode">Program.cs</code>, delete the existing statements and then add statements to define a variable to store the name of the city, London, and then write its name and length to the console, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-built_in">string</span> city = <span class="hljs-string">"London"</span>;
WriteLine(<span class="hljs-string">$"</span><span class="hljs-subst">{city}</span><span class="hljs-string"> is </span><span class="hljs-subst">{city.Length}</span><span class="hljs-string"> characters long."</span>);
</code></pre>
      </li>
      <li class="numberedList">Run the code and view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">London is 6 characters long.
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-512" class="heading-2">Getting the characters of a string</h2>
    <p class="normal">The <code class="inlineCode">string</code> class uses<a id="_idIndexMarker1208"/> an array of <code class="inlineCode">char</code> internally to store <a id="_idIndexMarker1209"/>the text. It also has an indexer, which means that we can use the array syntax to read its characters. Array indexes start at 0, so the third character will be at index 2.</p>
    <p class="normal">Let’s see this in action:</p>
    <ol>
      <li class="numberedList" value="1">Add a statement to write the characters at the first and fourth positions in the <code class="inlineCode">string</code> variable, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">WriteLine(<span class="hljs-string">$"First char is </span><span class="hljs-subst">{city[</span><span class="hljs-number">0</span><span class="hljs-subst">]}</span><span class="hljs-string"> and fourth is </span><span class="hljs-subst">{city[</span><span class="hljs-number">3</span><span class="hljs-subst">]}</span><span class="hljs-string">."</span>);
</code></pre>
      </li>
      <li class="numberedList">Run the code and view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">First char is L and fourth is d.
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-513" class="heading-2">Splitting a string</h2>
    <p class="normal">Sometimes, you <a id="_idIndexMarker1210"/>need to split some text wherever there is a<a id="_idIndexMarker1211"/> character, such as a comma:</p>
    <ol>
      <li class="numberedList" value="1">Add statements to define a single <code class="inlineCode">string</code> variable containing comma-separated city names, then use the <code class="inlineCode">Split</code> method and specify that you want to treat commas as the separator, and then enumerate the returned array of <code class="inlineCode">string</code> values, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-built_in">string</span> cities = <span class="hljs-string">"Paris,Tehran,Chennai,Sydney,New York,Medellín"</span>;
<span class="hljs-built_in">string</span>[] citiesArray = cities.Split(<span class="hljs-string">','</span>);
WriteLine(<span class="hljs-string">$"There are </span><span class="hljs-subst">{citiesArray.Length}</span><span class="hljs-string"> items in the array:"</span>);
<span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">string</span> item <span class="hljs-keyword">in</span> citiesArray)
{
  WriteLine(<span class="hljs-string">$"  </span><span class="hljs-subst">{item}</span><span class="hljs-string">"</span>);
}
</code></pre>
      </li>
      <li class="numberedList">Run the code and view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">There are 6 items in the array:
  Paris
  Tehran
  Chennai
  Sydney
  New York
  Medellín
</code></pre>
      </li>
    </ol>
    <p class="normal">Later in this <a id="_idIndexMarker1212"/>chapter, you will learn how to handle more complex<a id="_idIndexMarker1213"/> string-splitting scenarios using a regular expression.</p>
    <h2 id="_idParaDest-514" class="heading-2">Getting part of a string</h2>
    <p class="normal">Sometimes, you<a id="_idIndexMarker1214"/> need to get part of some text. The <code class="inlineCode">IndexOf</code> method<a id="_idIndexMarker1215"/> has nine overloads that return the index position of a specified <code class="inlineCode">char</code> or <code class="inlineCode">string</code> within a <code class="inlineCode">string</code>. The <code class="inlineCode">Substring</code> method has two overloads, as shown in the following list:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">Substring(startIndex, length)</code>: This returns part of a string starting at <code class="inlineCode">startIndex</code> and containing the next <code class="inlineCode">length</code> characters.</li>
      <li class="bulletList"><code class="inlineCode">Substring(startIndex)</code>: This returns part of a string starting at <code class="inlineCode">startIndex</code> and containing all characters up to the end of the string.</li>
    </ul>
    <p class="normal">Let’s explore a simple example:</p>
    <ol>
      <li class="numberedList" value="1">Add statements to store a person’s full name in a <code class="inlineCode">string</code> variable with a space character between the first and last names, find the position of the space, and then extract the first name and last name as two parts so that they can be recombined in a different order, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-built_in">string</span> fullName = <span class="hljs-string">"Alan Shore"</span>;
<span class="hljs-built_in">int</span> indexOfTheSpace = fullName.IndexOf(<span class="hljs-string">' '</span>);
<span class="hljs-built_in">string</span> firstName = fullName.Substring(
  startIndex: <span class="hljs-number">0</span>, length: indexOfTheSpace);
<span class="hljs-built_in">string</span> lastName = fullName.Substring(
  startIndex: indexOfTheSpace + <span class="hljs-number">1</span>);
WriteLine(<span class="hljs-string">$"Original: </span><span class="hljs-subst">{fullName}</span><span class="hljs-string">"</span>);
WriteLine(<span class="hljs-string">$"Swapped: </span><span class="hljs-subst">{lastName}</span><span class="hljs-string">, </span><span class="hljs-subst">{firstName}</span><span class="hljs-string">"</span>);
</code></pre>
      </li>
      <li class="numberedList">Run the code and view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Original: Alan Shore
Swapped: Shore, Alan
</code></pre>
      </li>
    </ol>
    <p class="normal">If the format of the initial full name was different, for example, <code class="inlineCode">"LastName, FirstName"</code>, then<a id="_idIndexMarker1216"/> the code would need to be different. As an <a id="_idIndexMarker1217"/>optional exercise, try writing some statements that would change the input <code class="inlineCode">"Shore, Alan"</code> into <code class="inlineCode">"Alan Shore"</code>.</p>
    <h2 id="_idParaDest-515" class="heading-2">Checking a string for content</h2>
    <p class="normal">Sometimes, you <a id="_idIndexMarker1218"/>need to check whether a piece of text <a id="_idIndexMarker1219"/>starts or ends with some characters or contains some characters. You can achieve this with methods named <code class="inlineCode">StartsWith</code>, <code class="inlineCode">EndsWith</code>, and <code class="inlineCode">Contains</code>:</p>
    <ol>
      <li class="numberedList" value="1">Add statements to store a <code class="inlineCode">string</code> value and then check if it starts with or contains a couple of different <code class="inlineCode">char</code> values, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-built_in">string</span> company = <span class="hljs-string">"Microsoft"</span>;
WriteLine(<span class="hljs-string">$"Text: </span><span class="hljs-subst">{company}</span><span class="hljs-string">"</span>);
WriteLine(<span class="hljs-string">"Starts with M: {0}, contains an N: {1}"</span>,
  arg0: company.StartsWith(<span class="hljs-string">'M'</span>),
  arg1: company.Contains(<span class="hljs-string">'N'</span>));
</code></pre>
        <div class="packt_tip-one">
          <p class="normal"><strong class="keyWord">Good practice</strong>: <code class="inlineCode">StartsWith</code>, <code class="inlineCode">EndsWith</code>, and <code class="inlineCode">Contains</code> can be passed a <code class="inlineCode">string</code> or <code class="inlineCode">char</code> value. The single quotes indicate a <code class="inlineCode">char</code> value in the preceding code. Searching for a <code class="inlineCode">char</code> like <code class="inlineCode">'M'</code> is more efficient than searching for a <code class="inlineCode">string</code> value like <code class="inlineCode">"M"</code>.</p>
        </div>
      </li>
    </ol>
    <ol>
      <li class="numberedList" value="2">Run the code<a id="_idIndexMarker1220"/> and view the result, as <a id="_idIndexMarker1221"/>shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Text: Microsoft
Starts with M: True, contains an N: False
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-516" class="heading-2">Comparing string values</h2>
    <p class="normal">Two common<a id="_idIndexMarker1222"/> tasks with string values are sorting (aka collating) and<a id="_idIndexMarker1223"/> comparing. For example, when a user enters their username or password, you need to compare what they entered with what is stored.</p>
    <p class="normal">The <code class="inlineCode">string</code> class implements the <code class="inlineCode">IComparable</code> interface, meaning that you can easily compare two string values using the <code class="inlineCode">CompareTo</code> instance method and it will return <code class="inlineCode">-1</code>, <code class="inlineCode">0</code>, or <code class="inlineCode">1</code> depending on if the value is “less than,” “equal to,” or “greater than” the other. You saw an example of this when you implemented the <code class="inlineCode">IComparable</code> interface for the <code class="inlineCode">Person</code> class in <em class="chapterRef">Chapter 6</em>, <em class="italic">Implementing Interfaces and Inheriting Classes</em>.</p>
    <p class="normal">However, the lower or upper casing of characters can affect ordering, and the ordering rules for text are culture-dependent. For example, double-L is treated as a single character in traditional Spanish, as shown in <em class="italic">Table 8.3</em>:</p>
    <table id="table003-5" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Culture</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Example string values</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Spanish</p>
          </td>
          <td class="table-cell">
            <p class="normal">In 1994, the Royal Spanish Academy issued a new alphabetization rule to treat LL and CH as Latin alphabetic characters instead of separate individual characters.</p>
          </td>
          <td class="table-cell">
            <p class="normal">Modern: <code class="inlineCode">llegar</code> comes before <code class="inlineCode">lugar</code>. Traditional: <code class="inlineCode">llegar</code> comes after <code class="inlineCode">lugar</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Swedish</p>
          </td>
          <td class="table-cell">
            <p class="normal">In 2006, the Swedish Academy issued a new rule. Before 2006, V and W were the same character. Since 2006, they have been treated as separate characters.</p>
          </td>
          <td class="table-cell">
            <p class="normal">Swedish words mostly only use V. Loanwords (words taken from other languages) that contain W can now keep those Ws instead of replacing the Ws with Vs.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">German</p>
          </td>
          <td class="table-cell">
            <p class="normal">Phonebook ordering is different than dictionary ordering, for example, umlauts are sorted as combinations of letters.</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Müller</code> and <code class="inlineCode">Mueller</code> in phonebook ordering are the same name.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">German</p>
          </td>
          <td class="table-cell">
            <p class="normal">The character <code class="inlineCode">ß</code> is sorted as <code class="inlineCode">SS</code>. This is a common issue with addresses since the word for <code class="inlineCode">street</code> is <code class="inlineCode">Straße</code>.</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Straße</code> and <code class="inlineCode">Strasse</code> have the same meaning.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 8.3: Examples of ordering rules in European languages</p>
    <p class="normal">For consistency and <a id="_idIndexMarker1224"/>performance, you sometimes want to<a id="_idIndexMarker1225"/> make comparisons in a culture-invariant way. It is therefore better to use the <code class="inlineCode">static</code> method <code class="inlineCode">Compare</code>.</p>
    <p class="normal">Let’s see some examples:</p>
    <ol>
      <li class="numberedList" value="1">At the top of <code class="inlineCode">Program.cs</code>, import the namespace for working with cultures and enable special characters like the Euro currency symbol, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">using</span> System.Globalization; <span class="hljs-comment">// To use CultureInfo.</span>
OutputEncoding = System.Text.Encoding.UTF8; <span class="hljs-comment">// Enable Euro symbol.</span>
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, define some text variables and compare them in different cultures, as<a id="_idIndexMarker1226"/> shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">CultureInfo.CurrentCulture = CultureInfo.GetCultureInfo(<span class="hljs-string">"</span><span class="hljs-string">en-US"</span>);
<span class="hljs-built_in">string</span> text1 = <span class="hljs-string">"Mark"</span>;
<span class="hljs-built_in">string</span> text2 = <span class="hljs-string">"MARK"</span>;
WriteLine(<span class="hljs-string">$"text1: </span><span class="hljs-subst">{text1}</span><span class="hljs-string">, text2: </span><span class="hljs-subst">{text2}</span><span class="hljs-string">"</span>);
WriteLine(<span class="hljs-string">"Compare: {0}."</span>, <span class="hljs-built_in">string</span>.Compare(text1, text2));
WriteLine(<span class="hljs-string">"Compare (ignoreCase): {0}."</span>,
  <span class="hljs-built_in">string</span>.Compare(text1, text2, ignoreCase: <span class="hljs-literal">true</span>));
WriteLine(<span class="hljs-string">"Compare (InvariantCultureIgnoreCase): {0}."</span>,
  <span class="hljs-built_in">string</span>.Compare(text1, text2,
  StringComparison.InvariantCultureIgnoreCase));
<span class="hljs-comment">// German string comparisons</span>
CultureInfo.CurrentCulture = CultureInfo.GetCultureInfo(<span class="hljs-string">"</span><span class="hljs-string">de-DE"</span>);
text1 = <span class="hljs-string">"Strasse"</span>;
text2 = <span class="hljs-string">"Straße"</span>;
WriteLine(<span class="hljs-string">$"text1: </span><span class="hljs-subst">{text1}</span><span class="hljs-string">, text2: </span><span class="hljs-subst">{text2}</span><span class="hljs-string">"</span>);
WriteLine(<span class="hljs-string">"Compare: {0}."</span>, <span class="hljs-built_in">string</span>.Compare(text1, text2,
  CultureInfo.CurrentCulture, CompareOptions.IgnoreNonSpace));
WriteLine(<span class="hljs-string">"Compare (IgnoreCase, IgnoreNonSpace): {0}."</span>,
  <span class="hljs-built_in">string</span>.Compare(text1, text2, CultureInfo.CurrentCulture,
  CompareOptions.IgnoreNonSpace | CompareOptions.IgnoreCase));
WriteLine(<span class="hljs-string">"Compare (InvariantCultureIgnoreCase): {0}."</span>,
  <span class="hljs-built_in">string</span>.Compare(text1, text2,
  StringComparison.InvariantCultureIgnoreCase));
</code></pre>
      </li>
      <li class="numberedList">Run the code, view <a id="_idIndexMarker1227"/>the result, and note that a lowercase “a” is “less than” (<code class="inlineCode">-1</code>) an uppercase “A,” so the comparison returns -1. But we can either set an option to ignore case, or even better, do a culture- and case-invariant comparison to treat the two string values as equal (<code class="inlineCode">0</code>), as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">text1: Mark, text2: MARK
Compare: -1.
Compare (ignoreCase): 0.
Compare (InvariantCultureIgnoreCase): 0.
text1: Strasse, text2: Straße
Compare: 0.
Compare (IgnoreCase, IgnoreNonSpace): 0.
Compare (InvariantCultureIgnoreCase): -1.
</code></pre>
      </li>
    </ol>
    <div class="note">
      <p class="normal"><strong class="keyWord">More Information</strong>: You <a id="_idIndexMarker1228"/>can <a id="_idIndexMarker1229"/>learn more about <code class="inlineCode">string</code> comparisons at the following link: <a href="https://learn.microsoft.com/en-us/globalization/locale/sorting-and-string-comparison"><span class="url">https://learn.microsoft.com/en-us/globalization/locale/sorting-and-string-comparison</span></a>.</p>
    </div>
    <h2 id="_idParaDest-517" class="heading-2">Joining, formatting, and other string members</h2>
    <p class="normal">There <a id="_idIndexMarker1230"/>are <a id="_idIndexMarker1231"/>many<a id="_idIndexMarker1232"/> other <code class="inlineCode">string</code> members, as<a id="_idIndexMarker1233"/> shown in <em class="italic">Table 8.4</em>:</p>
    <table id="table004-5" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Member</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Trim</code>, <code class="inlineCode">TrimStart</code>, <code class="inlineCode">TrimEnd</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">These methods trim whitespace characters such as space, tab, and carriage return from the start and/or end.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">ToUpper</code>, <code class="inlineCode">ToLower</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">These convert all the characters into uppercase or lowercase.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Insert</code>, <code class="inlineCode">Remove</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">These methods insert or remove some text.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Replace</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This replaces some text with other text.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">string.Empty</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This can be used instead of allocating memory each time you use a literal string value using an empty pair of double quotes (<code class="inlineCode">""</code>).</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">string.Concat</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This concatenates two string variables. The <code class="inlineCode">+</code> operator does the equivalent when used between string operands.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">string.Join</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This concatenates one or more string variables with a character in between each one.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">string.IsNullOrEmpty</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This checks whether a string variable is null or empty.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">string.IsNullOrWhiteSpace</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This checks whether a string variable is null or whitespace; that is, a mix of any number of horizontal and vertical spacing characters, for example, tab, space, carriage return, line feed, and so on.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">string.Format</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">An alternative method to string interpolation for outputting formatted string values, which uses positioned instead of named parameters.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 8.4: Joining, formatting, and other string members</p>
    <div class="note">
      <p class="normal">Some of the preceding methods are <code class="inlineCode">static</code> methods. This means that the method can<a id="_idIndexMarker1234"/> only<a id="_idIndexMarker1235"/> be<a id="_idIndexMarker1236"/> called<a id="_idIndexMarker1237"/> from the type, not from a variable instance. In the preceding table, I indicated the static methods by prefixing them with <code class="inlineCode">string.</code>, as in <code class="inlineCode">string.Format</code>.</p>
    </div>
    <p class="normal">Let’s explore some of these methods:</p>
    <ol>
      <li class="numberedList" value="1">Add statements to take an array of <code class="inlineCode">string</code> values and combine them back together into a single <code class="inlineCode">string</code> variable with separators using the <code class="inlineCode">Join</code> method, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-built_in">string</span> recombined = <span class="hljs-built_in">string</span>.Join(<span class="hljs-string">" =&gt; "</span>, citiesArray);
WriteLine(recombined);
</code></pre>
      </li>
      <li class="numberedList">Run the code and view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Paris =&gt; Tehran =&gt; Chennai =&gt; Sydney =&gt; New York =&gt; Medellín
</code></pre>
      </li>
      <li class="numberedList">Add statements to use positioned parameters and interpolated <code class="inlineCode">string</code> formatting syntax to output the same three variables twice, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-built_in">string</span> fruit = <span class="hljs-string">"</span><span class="hljs-string">Apples"</span>;
<span class="hljs-built_in">decimal</span> price =  <span class="hljs-number">0.39</span>M;
DateTime <span class="hljs-keyword">when</span> = DateTime.Today;
WriteLine(<span class="hljs-string">$"Interpolated:  </span><span class="hljs-subst">{fruit}</span><span class="hljs-string"> cost </span><span class="hljs-subst">{price:C}</span><span class="hljs-string"> on </span><span class="hljs-subst">{</span><span class="hljs-keyword">when</span><span class="hljs-subst">:dddd}</span><span class="hljs-string">."</span>);
WriteLine(<span class="hljs-built_in">string</span>.Format(<span class="hljs-string">"</span><span class="hljs-string">string.Format: {0} cost {1:C} on {2:dddd}."</span>,
  arg0: fruit, arg1: price, arg2: <span class="hljs-keyword">when</span>));
</code></pre>
        <div class="note-one">
          <p class="normal">Some code editors, like Rider, will warn you about boxing operations. These are slow but not a problem in this scenario. To avoid boxing, call <code class="inlineCode">ToString</code> on <code class="inlineCode">price</code> and <code class="inlineCode">when</code>.</p>
        </div>
      </li>
    </ol>
    <ol>
      <li class="numberedList" value="4">Run the<a id="_idIndexMarker1238"/> code <a id="_idIndexMarker1239"/>and<a id="_idIndexMarker1240"/> view <a id="_idIndexMarker1241"/>the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Interpolated:  Apples cost $0.39 on Friday.
string.Format: Apples cost $0.39 on Friday.
</code></pre>
      </li>
    </ol>
    <p class="normal">Note that we could have simplified the second statement because <code class="inlineCode">Console.WriteLine</code> supports <a id="_idIndexMarker1242"/>the same format code as <code class="inlineCode">string.Format</code>, as shown<a id="_idIndexMarker1243"/> in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">WriteLine(<span class="hljs-string">"</span><span class="hljs-string">WriteLine: {0} cost {1:C} on {2:dddd}."</span>,
  arg0: fruit, arg1: price, arg2: <span class="hljs-keyword">when</span>);
</code></pre>
    <h2 id="_idParaDest-518" class="heading-2">Building strings efficiently</h2>
    <p class="normal">You can <a id="_idIndexMarker1244"/>concatenate<a id="_idIndexMarker1245"/> two strings to make a new <code class="inlineCode">string</code> using the <code class="inlineCode">String.Concat</code> method or simply by using the <code class="inlineCode">+</code> operator. But both choices are bad practices when combining more than a few values because .NET must create a completely new <code class="inlineCode">string</code> in memory.</p>
    <p class="normal">This might not be noticeable if you are only adding two <code class="inlineCode">string</code> values, but if you concatenate inside a loop with many iterations, it can have a significant negative impact on performance and memory use. You can concatenate <code class="inlineCode">string</code> variables more efficiently using the <code class="inlineCode">StringBuilder</code> type.</p>
    <p class="normal">I have written an online-only section for the companion book, <em class="italic">Apps and Services with .NET 8</em>, about performance benchmarking using <code class="inlineCode">string</code> concatenations as the main example. You can optionally complete the section and its practical coding tasks at the following link: <a href="https://github.com/markjprice/apps-services-net8/blob/main/docs/ch01-benchmarking.md"><span class="url">https://github.com/markjprice/apps-services-net8/blob/main/docs/ch01-benchmarking.md</span></a>.</p>
    <div class="note">
      <p class="normal"><strong class="keyWord">More information</strong>: You can see examples of using <code class="inlineCode">StringBuilder</code> at the following link: <a href="https://learn.microsoft.com/en-us/dotnet/api/system.text.stringbuilder#examples"><span class="url">https://learn.microsoft.com/en-us/dotnet/api/system.text.stringbuilder#examples</span></a>.</p>
    </div>
    <h2 id="_idParaDest-519" class="heading-2">Working with characters</h2>
    <p class="normal">Sometimes, you<a id="_idIndexMarker1246"/> need to work with individual <a id="_idIndexMarker1247"/>characters. The <code class="inlineCode">System.Char</code> type (aka <code class="inlineCode">char</code>) has some useful methods, as shown in <em class="italic">Table 8.5</em>:</p>
    <table id="table005-4" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Method</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">char.IsDigit(char)</code>, <code class="inlineCode">char.IsDigit(string, int)</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Returns <code class="inlineCode">true</code> if the character is a decimal digit.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">char.IsLetter(char)</code>, <code class="inlineCode">char.IsLetter(string, int)</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Returns <code class="inlineCode">true</code> if the character is a letter.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">char.IsLower(char)</code>, <code class="inlineCode">char.IsLower(string, int)</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Returns <code class="inlineCode">true</code> if the character is a lowercase letter.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">char.IsUpper(char)</code>, <code class="inlineCode">char.IsUpper(string, int)</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Returns <code class="inlineCode">true</code> if the character is an uppercase letter.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">char.IsSeparator(char)</code>, <code class="inlineCode">char.IsSeparator(string, int)</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Returns <code class="inlineCode">true</code> if the character is a separator.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">char.IsSymbol(char)</code>, <code class="inlineCode">char.IsSymbol(string, int)</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Returns <code class="inlineCode">true</code> if the character is a symbol.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">char.IsWhiteSpace(char)</code>, <code class="inlineCode">char.IsWhiteSpace(string, int)</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Returns <code class="inlineCode">true</code> if the character is whitespace like a space or tab.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 8.5: Methods for working with characters</p>
    <h2 id="_idParaDest-520" class="heading-2">Searching in strings</h2>
    <p class="normal">.NET 8 introduced<a id="_idIndexMarker1248"/> the <code class="inlineCode">SearchValues</code> type, which implements an <a id="_idIndexMarker1249"/>optimized method for searching for sets of characters or bytes within spans. For example, <code class="inlineCode">SearchValues</code> helps to find the first instance of a vowel in a text value, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">string vowels <span class="hljs-punctuation">=</span> <span class="hljs-string">"AEIOUaeiou"</span><span class="hljs-punctuation">;</span>
<span class="hljs-comment">// .NET 8 and later.</span>
SearchValues&lt;char&gt; vowelsSearchValues <span class="hljs-punctuation">=</span> SearchValues.Create<span class="hljs-punctuation">(</span>vowels<span class="hljs-punctuation">);</span>   
ReadOnlySpan&lt;char&gt; text <span class="hljs-punctuation">=</span> <span class="hljs-string">"Fred"</span><span class="hljs-punctuation">;</span>
WriteLine<span class="hljs-punctuation">(</span>$<span class="hljs-string">"vowels: {vowels}"</span><span class="hljs-punctuation">);</span>
WriteLine<span class="hljs-punctuation">(</span>$<span class="hljs-string">"text: {text}"</span><span class="hljs-punctuation">);</span>
WriteLine<span class="hljs-punctuation">(</span>$<span class="hljs-string">"text.IndexOfAny(vowelsSearchValues): {</span>
  text.IndexOfAny<span class="hljs-punctuation">(</span>vowelsSearchValues<span class="hljs-punctuation">)</span>}<span class="hljs-string">");</span>
</code></pre>
    <p class="normal">The first vowel in the text <code class="inlineCode">Fred</code> is at index position 2, as shown in the following output:</p>
    <pre class="programlisting con"><code class="hljs-con">vowels: AEIOUaeiou
text: Fred
text.IndexOfAny(vowelsSearchValues): 2
</code></pre>
    <p class="normal">In .NET 9 or later, <code class="inlineCode">SearchValues</code> now supports searching for substrings as well as searching for <a id="_idIndexMarker1250"/>characters within a larger string, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">string[] names <span class="hljs-punctuation">=</span> [ <span class="hljs-string">"Cassian"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Luthen"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Mon Mothma"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-string">"Dedra"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Syril"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Kino"</span> ]<span class="hljs-punctuation">;</span>
<span class="hljs-comment">// .NET 9 and later.</span>
SearchValues&lt;string&gt; namesSearchValues <span class="hljs-punctuation">=</span> SearchValues.Create<span class="hljs-punctuation">(</span>
  names<span class="hljs-punctuation">,</span> StringComparison.OrdinalIgnoreCase<span class="hljs-punctuation">);</span>
ReadOnlySpan&lt;char&gt; sentence <span class="hljs-punctuation">=</span> <span class="hljs-string">"In Andor, Diego Luna returns as the titular character, Cassian Andor, to whom audiences were first introduced in Rogue One."</span><span class="hljs-punctuation">;</span>
WriteLine<span class="hljs-punctuation">(</span>$<span class="hljs-string">"names: {string.Join(' ', names)}"</span><span class="hljs-punctuation">);</span>
WriteLine<span class="hljs-punctuation">(</span>$<span class="hljs-string">"sentence: {sentence}"</span><span class="hljs-punctuation">);</span>
WriteLine<span class="hljs-punctuation">(</span>$<span class="hljs-string">"sentence.IndexOfAny(vowelsSearchValues): {</span>
  sentence.IndexOfAny<span class="hljs-punctuation">(</span>namesSearchValues<span class="hljs-punctuation">)</span>}<span class="hljs-string">");</span>
</code></pre>
    <p class="normal">The first name from the list of Andor characters starts at index position 55, as shown in the<a id="_idIndexMarker1251"/> following <a id="_idIndexMarker1252"/>output:</p>
    <pre class="programlisting con"><code class="hljs-con">names: Cassian Luthen Mon Mothma Dedra Syril Kino
sentence: In Andor, Diego Luna returns as the titular character, Cassian Andor, to whom audiences were first introduced in Rogue One.
sentence.IndexOfAny(vowelsSearchValues): 55
</code></pre>
    <h1 id="_idParaDest-521" class="heading-1">Pattern matching with regular expressions</h1>
    <p class="normal">Regular expressions<a id="_idIndexMarker1253"/> are useful for validating input from the user. They are very powerful and can get very complicated. Almost all programming languages have support for regular expressions and use a common set of special characters to define them.</p>
    <p class="normal">Let’s try out some example regular expressions:</p>
    <ol>
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code> project named <code class="inlineCode">WorkingWithRegularExpressions</code> to the <code class="inlineCode">Chapter08</code> solution.</li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete the existing statements and then import the following namespace:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">using</span> System.Text.RegularExpressions; <span class="hljs-comment">// To use Regex.</span>
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-522" class="heading-2">Checking for digits entered as text</h2>
    <p class="normal">We will start by <a id="_idIndexMarker1254"/>implementing the common example of validating number input:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, add statements to prompt the user to enter their age and then check that it is valid using a regular expression that looks for a digit character, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">Write(<span class="hljs-string">"Enter your age: "</span>);
<span class="hljs-built_in">string</span> input = ReadLine()!; <span class="hljs-comment">// Null-forgiving operator.</span>
Regex ageChecker = <span class="hljs-keyword">new</span>(<span class="hljs-string">@"\d"</span>);
WriteLine(ageChecker.IsMatch(input) ? <span class="hljs-string">"Thank you!"</span> :
  <span class="hljs-string">$"This is not a valid age: </span><span class="hljs-subst">{input}</span><span class="hljs-string">"</span>);
</code></pre>
      </li>
    </ol>
    <p class="normal-one">Note the following about the code:</p>
    <ul>
      <li class="bulletList level-2">The <code class="inlineCode">@</code> character switches off the ability to use escape characters in the <code class="inlineCode">string</code>. Escape characters are prefixed with a backslash. For example, <code class="inlineCode">\t</code> means a tab and <code class="inlineCode">\n</code> means a new line. When writing regular expressions, we need to disable this feature. To paraphrase the television show <em class="italic">The West Wing</em>, “Let backslash be backslash.”</li>
      <li class="bulletList level-2">Once escape characters are disabled with <code class="inlineCode">@</code>, then they can be interpreted by a regular expression. For example, <code class="inlineCode">\d</code> means digit. You will learn about more regular expression symbols that are prefixed with a backslash later in this topic.</li>
    </ul>
    <ol>
      <li class="numberedList" value="2">Run the code, enter a whole number, such as <code class="inlineCode">34</code>, for the age, and view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Enter your age: 34
Thank you!
</code></pre>
      </li>
      <li class="numberedList">Run the<a id="_idIndexMarker1255"/> code again, enter <code class="inlineCode">carrots</code>, and view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Enter your age: carrots
This is not a valid age: carrots
</code></pre>
      </li>
      <li class="numberedList">Run the code again, enter <code class="inlineCode">bob30smith</code>, and view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Enter your age: bob30smith
Thank you!
</code></pre>
      </li>
    </ol>
    <p class="normal-one">The regular expression we used is <code class="inlineCode">\d</code>, which means <em class="italic">one digit</em>. However, it does not specify what can be entered before and after that one digit. This regular expression could be described in English as “Enter any characters you want as long as you enter at least one digit character.”</p>
    <p class="normal-one">In regular expressions, you indicate the start of some input with the caret <code class="inlineCode">^</code> symbol and the end of some input with the dollar <code class="inlineCode">$</code> symbol. Let’s use these symbols to indicate that we expect nothing else between the start and end of the input except for a digit.</p>
    <ol>
      <li class="numberedList" value="5">Add a <code class="inlineCode">^</code> and a <code class="inlineCode">$</code> to change the regular expression to <code class="inlineCode">^\d$</code>, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">Regex ageChecker = <span class="hljs-keyword">new</span>(<span class="hljs-string">@"</span><span class="code-highlight"><strong class="hljs-string-slc">^</strong></span><span class="hljs-string">\d</span><span class="code-highlight"><strong class="hljs-string-slc">$</strong></span><span class="hljs-string">"</span>);
</code></pre>
      </li>
      <li class="numberedList">Run the code again and note that it rejects any input except a single digit.</li>
      <li class="numberedList">Add a <code class="inlineCode">+</code> after the <code class="inlineCode">\d</code> expression to modify the meaning to one or more digits, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">Regex ageChecker = <span class="hljs-keyword">new</span>(<span class="hljs-string">@"^\d</span><span class="code-highlight"><strong class="hljs-string-slc">+</strong></span><span class="hljs-string">$"</span>);
</code></pre>
      </li>
      <li class="numberedList">Run the <a id="_idIndexMarker1256"/>code again and note the regular expression only allows zero or positive whole numbers of any length.</li>
    </ol>
    <h2 id="_idParaDest-523" class="heading-2">Regular expression performance improvements</h2>
    <p class="normal">The .NET types <a id="_idIndexMarker1257"/>for working with regular expressions are used throughout the .NET platform and many of the apps built with it. As such, they have a significant impact on performance. However, until .NET 5, they had not received much optimization attention from Microsoft.</p>
    <p class="normal">With .NET 5 and later, the types in the <code class="inlineCode">System.Text.RegularExpressions</code> namespace have rewritten implementations to squeeze out maximum performance. Common regular expression benchmarks using methods like <code class="inlineCode">IsMatch</code> are now five times faster. The best thing is you do not have to change your code to get the benefits!</p>
    <p class="normal">With .NET 7 and later, the <code class="inlineCode">IsMatch</code> method of the <code class="inlineCode">Regex</code> class now has an overload for a <code class="inlineCode">ReadOnlySpan&lt;char&gt;</code> as its input, which gives even better performance.</p>
    <h2 id="_idParaDest-524" class="heading-2">Understanding the syntax of a regular expression</h2>
    <p class="normal">Some common<a id="_idIndexMarker1258"/> symbols that you can use in regular expressions are shown in <em class="italic">Table 8.6</em>:</p>
    <table id="table006-4" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Symbol</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Meaning</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Symbol</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Meaning</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">^</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Start of input</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">$</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">End of input</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">\d</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">A single digit</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">\D</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">A single <em class="italic">non</em>-digit</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">\s</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Whitespace</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">\S</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><em class="italic">Non</em>-whitespace</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">\w</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Word characters</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">\W</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><em class="italic">Non</em>-word characters</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">[A-Za-z0-9]</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Range(s) of characters</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">\^</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">^ (caret) character</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">[aeiou]</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Set of characters</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">[^aeiou]</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><em class="italic">Not</em> in a set of characters</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">.</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Any single character</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">\.</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">. (dot) character</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 8.6: Common regular expression symbols</p>
    <p class="normal">In addition, some common regular expression quantifiers that affect the previous symbols in a regular expression are shown in <em class="italic">Table 8.7</em>:</p>
    <table id="table007-1" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Symbol</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Meaning</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Symbol</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Meaning</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">+</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">One or more</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">?</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">One or none</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">{3}</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Exactly three</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">{3,5}</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Three to five</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">{3,}</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">At least three</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">{,3}</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Up to three</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 8.7: Common regular expression quantifiers</p>
    <h2 id="_idParaDest-525" class="heading-2">Examples of regular expressions</h2>
    <p class="normal">Some examples <a id="_idIndexMarker1259"/>of regular expressions with a description of their meaning are shown in <em class="italic">Table 8.8</em>:</p>
    <table id="table008-1" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Expression</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Meaning</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">\d</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">A single digit somewhere in the input</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">a</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">The character “a” somewhere in the input</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Bob</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">The word “Bob” somewhere in the input</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">^Bob</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">The word “Bob” at the start of the input</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Bob$</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">The word “Bob” at the end of the input</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">^\d{2}$</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Exactly two digits</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">^[0-9]{2}$</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Exactly two digits</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">^[A-Z]{4,}$</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">At least four uppercase English letters in the ASCII character set only</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">^[A-Za-z]{4,}$</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">At least four upper or lowercase English letters in the ASCII character set only</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">^[A-Z]{2}\d{3}$</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Two uppercase English letters in the ASCII character set and three digits only</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">^[A-Za-z\u00c0-\u017e]+$</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">At least one uppercase or lowercase English letter in the ASCII character set or European letters in the Unicode character set, as shown in the following list:</p>
            <p class="normal"><code class="inlineCode">ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÚÛÜÝ</code></p>
            <p class="normal"><code class="inlineCode">Þßàáâãäåæçèéêëìíîïðñòóôõö÷øùúûüýþÿıŒœŠšŸŽž</code></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">^d.g$</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">The letter <code class="inlineCode">d</code>, then any character, and then the letter <code class="inlineCode">g</code>, so it would match both <code class="inlineCode">dig</code> and <code class="inlineCode">dog</code> or any single character between the <code class="inlineCode">d</code> and <code class="inlineCode">g</code></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">^d\.g$</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">The letter <code class="inlineCode">d</code>, then a dot <code class="inlineCode">.</code>, and then the letter <code class="inlineCode">g</code>, so it would match <code class="inlineCode">d.g</code> only</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 8.8: Examples of regular expressions with descriptions of their meaning</p>
    <div class="packt_tip">
      <p class="normal"><strong class="keyWord">Good practice</strong>: Use regular expressions to validate input from the user. The same regular expressions <a id="_idIndexMarker1260"/>can be reused in other languages, such as JavaScript and Python.</p>
    </div>
    <div class="note">
      <p class="normal">A handy website for building and testing regular expressions can be found at the following link: <a href="https://regex101.com/"><span class="url">https://regex101.com/</span></a>.</p>
    </div>
    <h2 id="_idParaDest-526" class="heading-2">Splitting a complex comma-separated string</h2>
    <p class="normal">Earlier in this <a id="_idIndexMarker1261"/>chapter, you<a id="_idIndexMarker1262"/> learned how to split a simple comma-separated string variable. But what about the following example of film titles?</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-string">"Monsters, Inc."</span>,<span class="hljs-string">"I, Tonya"</span>,<span class="hljs-string">"</span><span class="hljs-string">Lock, Stock and Two Smoking Barrels"</span>
</code></pre>
    <p class="normal">The <code class="inlineCode">string</code> value uses double quotes around each film title. We can use these to identify whether we need to split on a comma (or not). The <code class="inlineCode">Split</code> method is not powerful enough, so we can use a regular expression instead.</p>
    <div class="packt_tip">
      <p class="normal"><strong class="keyWord">Good practice</strong>: You can read a fuller explanation in the Stack Overflow article that inspired this task at the following link: <a href="https://stackoverflow.com/questions/18144431/regex-to-split-a-csv"><span class="url">https://stackoverflow.com/questions/18144431/regex-to-split-a-csv</span></a>.</p>
    </div>
    <p class="normal">To include double quotes inside a <code class="inlineCode">string</code> value, we prefix them with a backslash, or we could use the raw string literal feature in C# 11 or later:</p>
    <ol>
      <li class="numberedList" value="1">Add statements to store a complex comma-separated <code class="inlineCode">string</code> variable, and then split it in a dumb way using the <code class="inlineCode">Split</code> method, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// C# 1 to 10: Use escaped double-quote characters \"</span>
<span class="hljs-comment">// string films = "\"Monsters, Inc.\",\"I, Tonya\",\"Lock, Stock and Two Smoking Barrels\"";</span>
<span class="hljs-comment">// C# 11 or later: Use """ to start and end a raw string literal</span>
<span class="hljs-built_in">string</span> films = <span class="hljs-string">"""</span>
<span class="hljs-string">"</span>Monsters, Inc.<span class="hljs-string">","</span>I, Tonya<span class="hljs-string">","</span>Lock, Stock <span class="hljs-keyword">and</span> Two Smoking Barrels<span class="hljs-string">"</span>
<span class="hljs-string">"""</span>;
WriteLine(<span class="hljs-string">$"Films to split: </span><span class="hljs-subst">{films}</span><span class="hljs-string">"</span>);
<span class="hljs-built_in">string</span>[] filmsDumb = films.Split(<span class="hljs-string">','</span>);
WriteLine(<span class="hljs-string">"Splitting with string.Split method:"</span>);
<span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">string</span> film <span class="hljs-keyword">in</span> filmsDumb)
{
  WriteLine(<span class="hljs-string">$"  </span><span class="hljs-subst">{film}</span><span class="hljs-string">"</span>);
}
</code></pre>
      </li>
      <li class="numberedList">Add <a id="_idIndexMarker1263"/>statements <a id="_idIndexMarker1264"/>to define a regular expression to split and write the film titles in a smart way, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">Regex csv = <span class="hljs-keyword">new</span>(
  <span class="hljs-string">"(?:^|,)(?=[^\"]|(\")?)\"?((?(1)[^\"]*|[^,\"]*))\"?(?=,|$)"</span>);
MatchCollection filmsSmart = csv.Matches(films);
WriteLine(<span class="hljs-string">"Splitting with regular expression:"</span>);
<span class="hljs-keyword">foreach</span> (Match film <span class="hljs-keyword">in</span> filmsSmart)
{
  WriteLine(<span class="hljs-string">$"  </span><span class="hljs-subst">{film.Groups[</span><span class="hljs-number">2</span><span class="hljs-subst">].Value}</span><span class="hljs-string">"</span>);
}
</code></pre>
      </li>
    </ol>
    <div class="note-one">
      <p class="normal">In a later section, you will see how you can get a source generator to auto-generate XML comments for a regular expression to explain how it works. This is really useful for regular expressions that you might have copied from a website.</p>
    </div>
    <ol>
      <li class="numberedList" value="3">Run the <a id="_idIndexMarker1265"/>code and<a id="_idIndexMarker1266"/> view the result, as shown in the following output:
        <pre class="programlisting code-one"><code class="hljs-code">Splitting <span class="hljs-keyword">with</span> <span class="hljs-built_in">string</span>.Split method:
  <span class="hljs-string">"Monsters</span>
<span class="hljs-string">   Inc."</span>
  <span class="hljs-string">"I</span>
<span class="hljs-string">   Tonya"</span>
  <span class="hljs-string">"Lock</span>
<span class="hljs-string">   Stock and Two Smoking Barrels"</span>
Splitting <span class="hljs-keyword">with</span> regular expression:
  Monsters, Inc.
  I, Tonya
  Lock, Stock <span class="hljs-keyword">and</span> Two Smoking Barrels
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-527" class="heading-2">Activating regular expression syntax coloring</h2>
    <p class="normal">If you use Visual Studio as<a id="_idIndexMarker1267"/> your code editor, then you probably noticed that when passing a <code class="inlineCode">string</code> value to the <code class="inlineCode">Regex</code> constructor, you see color syntax highlighting, as shown in <em class="italic">Figure 8.1</em>:</p>
    <figure class="mediaobject"><img src="../Images/B22322_08_01.png" alt="" width="878" height="198"/></figure>
    <p class="packt_figref">Figure 8.1: Regular expression color syntax highlighting when using the Regex constructor</p>
    <div class="note">
      <p class="normal">This would be a good time to remind print book readers, who will only see the preceding figure in grayscale, that they can see all figures in full color as a PDF at the following link: <a href="https://packt.link/gbp/9781837635870"><span class="url">https://packt.link/gbp/9781837635870</span></a>.</p>
    </div>
    <p class="normal">Why does this <code class="inlineCode">string</code> get syntax coloring for regular expressions when most <code class="inlineCode">string</code> values do not? Let’s find out:</p>
    <ol>
      <li class="numberedList" value="1">Right-click on the <code class="inlineCode">new</code> constructor, select <strong class="screenText">Go To Implementation</strong>, and note the <code class="inlineCode">string</code> parameter named <code class="inlineCode">pattern</code> is decorated with an attribute named <code class="inlineCode">StringSyntax</code> that has the <code class="inlineCode">string</code> constant <code class="inlineCode">Regex</code> value passed to it, as shown highlighted<a id="_idIndexMarker1268"/> in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-title">Regex</span><span class="hljs-function">(</span><span class="code-highlight"><strong class="hljs-params-slc">[StringSyntax(StringSyntaxAttribute.Regex</strong><strong class="hljs-function-slc">)] </strong><strong class="hljs-built_in-slc">string</strong><strong class="hljs-function-slc"> pattern</strong></span><span class="hljs-function">) :</span>
<span class="hljs-function">  </span><span class="hljs-title">this</span><span class="hljs-function">(</span><span class="hljs-params">pattern, culture: </span><span class="hljs-literal">null</span><span class="hljs-function">)</span>
{
}
</code></pre>
      </li>
      <li class="numberedList">Right-click on the <code class="inlineCode">StringSyntax</code> attribute, select <strong class="screenText">Go To Implementation</strong>, and note there are 12 recognized <code class="inlineCode">string</code> syntax formats that you can choose from as well as <code class="inlineCode">Regex</code>, as shown in the following partial code:
        <pre class="programlisting code-one"><code class="hljs-code">[<span class="hljs-meta">AttributeUsage(AttributeTargets.Property | AttributeTargets.Field | AttributeTargets.Parameter, AllowMultiple = false, Inherited = false)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StringSyntaxAttribute</span> : <span class="hljs-title">Attribute</span>
{
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> CompositeFormat = <span class="hljs-string">"CompositeFormat"</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> DateOnlyFormat = <span class="hljs-string">"DateOnlyFormat"</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> DateTimeFormat = <span class="hljs-string">"DateTimeFormat"</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> EnumFormat = <span class="hljs-string">"EnumFormat"</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> GuidFormat = <span class="hljs-string">"GuidFormat"</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> Json = <span class="hljs-string">"Json"</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> NumericFormat = <span class="hljs-string">"NumericFormat"</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> Regex = <span class="hljs-string">"Regex"</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> TimeOnlyFormat = <span class="hljs-string">"TimeOnlyFormat"</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> TimeSpanFormat = <span class="hljs-string">"TimeSpanFormat"</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> Uri = <span class="hljs-string">"Uri"</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> Xml = <span class="hljs-string">"Xml"</span>;
  …
}
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">WorkingWithRegularExpressions</code> project, add a new class file named <code class="inlineCode">Program.Strings.cs</code>, delete any existing statements, and then define some <code class="inlineCode">string</code> constants <a id="_idIndexMarker1269"/>in a partial <code class="inlineCode">Program</code> class, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> DigitsOnlyText = <span class="hljs-string">@"^\d+$"</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> CommaSeparatorText =
    <span class="hljs-string">"(?:^|,)(?=[^\"]|(\")?)\"?((?(1)[^\"]*|[^,\"]*))\"?(?=,|$)"</span>;
}
</code></pre>
      </li>
    </ol>
    <div class="note-one">
      <p class="normal">Note that the two <code class="inlineCode">string</code> constants do not have any color syntax highlighting yet.</p>
    </div>
    <ol>
      <li class="numberedList" value="4">In <code class="inlineCode">Program.cs</code>, replace the literal <code class="inlineCode">string</code> with the <code class="inlineCode">string</code> constant for the digits-only regular expression, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">Regex ageChecker = <span class="hljs-keyword">new</span>(<span class="code-highlight"><strong class="hljs-slc">DigitsOnlyText</strong></span>);
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, replace the literal <code class="inlineCode">string</code> with the <code class="inlineCode">string</code> constant for the comma-separator regular expression, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">Regex csv = <span class="hljs-keyword">new</span>(<span class="code-highlight"><strong class="hljs-slc">CommaSeparatorText</strong></span>);
</code></pre>
      </li>
      <li class="numberedList">Run the <code class="inlineCode">WorkingWithRegularExpressions</code> project and confirm that the regular expression behavior is as before.</li>
      <li class="numberedList">In <code class="inlineCode">Program.Strings.cs</code>, import the namespace for the <code class="inlineCode">[StringSyntax]</code> attribute and then decorate both <code class="inlineCode">string</code> constants with it, as shown highlighted in<a id="_idIndexMarker1270"/> the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc">using</strong><strong class="hljs-slc"> System.Diagnostics.CodeAnalysis; </strong><strong class="hljs-comment-slc">// To use [StringSyntax].</strong></span>
<span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
<span class="code-highlight"><strong class="hljs-slc">  [</strong><strong class="hljs-meta-slc">StringSyntax(StringSyntaxAttribute.Regex)</strong><strong class="hljs-slc">]</strong></span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> DigitsOnlyText = <span class="hljs-string">@"^\d+$"</span>;
<span class="code-highlight"><strong class="hljs-slc">  [</strong><strong class="hljs-meta-slc">StringSyntax(StringSyntaxAttribute.Regex)</strong><strong class="hljs-slc">]</strong></span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> CommaSeparatorText =
    <span class="hljs-string">"(?:^|,)(?=[^\"]|(\")?)\"?((?(1)[^\"]*|[^,\"]*))\"?(?=,|$)"</span>;
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.Strings.cs</code>, add another <code class="inlineCode">string</code> constant for formatting a date, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">[<span class="hljs-meta">StringSyntax(StringSyntaxAttribute.DateTimeFormat)</span>]
<span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> FullDateTime = <span class="hljs-string">""</span>;
</code></pre>
      </li>
      <li class="numberedList">Click inside the empty string, type the letter <code class="inlineCode">d</code>, and note the IntelliSense explanation, as shown in <em class="italic">Figure 8.2</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_08_02.png" alt="" width="812" height="291"/></figure>
    <p class="packt_figref">Figure 8.2: IntelliSense activated due to the StringSyntax attribute</p>
    <ol>
      <li class="numberedList" value="10">Finish entering the date format and as you type, note the IntelliSense value: <code class="inlineCode">dddd, d MMMM yyyy</code>.</li>
      <li class="numberedList">Inside, at the end of the <code class="inlineCode">DigitsOnlyText</code> string literal, enter <code class="inlineCode">\</code>, and note the IntelliSense to<a id="_idIndexMarker1271"/> help you write a valid regular expression, as shown in <em class="italic">Figure 8.3</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_08_03.png" alt="" width="812" height="291"/></figure>
    <p class="packt_figref">Figure 8.3: IntelliSense for writing a regular expression</p>
    <ol>
      <li class="numberedList" value="12">Delete the <code class="inlineCode">\</code> that <a id="_idIndexMarker1272"/>you entered to trigger IntelliSense.</li>
    </ol>
    <div class="note">
      <p class="normal">The <code class="inlineCode">[StringSyntax]</code> attribute is a feature introduced in .NET 7. It depends on your code editor whether it is recognized. The .NET BCL has more than 350 parameters, properties, and fields that are now decorated with this attribute.</p>
    </div>
    <h2 id="_idParaDest-528" class="heading-2">Improving regular expression performance with source generators</h2>
    <p class="normal">When you pass a <a id="_idIndexMarker1273"/>string literal or <a id="_idIndexMarker1274"/>string constant to the constructor of <code class="inlineCode">Regex</code>, the class parses the string and transforms it into an internal tree structure that represents the expression in an optimized way that can be executed efficiently by a regular expression interpreter.</p>
    <p class="normal">You can also compile regular expressions by specifying <code class="inlineCode">RegexOptions</code>, as in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">Regex ageChecker = <span class="hljs-keyword">new</span>(DigitsOnlyText, RegexOptions.Compiled);
</code></pre>
    <p class="normal">Unfortunately, compiling has the negative effect of slowing down the initial creation of the regular expression. After creating the tree structure that would then be executed by the interpreter, the compiler then must convert the tree into IL code, and then that IL code needs to be JIT compiled into native code. If you’re only running the regular expression a few times, it is not worth compiling it, which is why it is not the default behavior. If you’re running the regular expression more than a few times, for example, because it will be used to validate the URL for every incoming HTTP request to a website, then it is worth compiling. But even then, you should only use compilation if you must use .NET 6 or earlier.</p>
    <p class="normal">.NET 7 introduced a source generator for regular expressions that recognizes if you decorate a partial method that returns <code class="inlineCode">Regex</code> with the <code class="inlineCode">[GeneratedRegex]</code> attribute. It generates an implementation of that method that implements the logic for the regular expression. .NET 9 allows you to use partial properties, which have a more natural syntax.</p>
    <p class="normal">Let’s see this in action:</p>
    <ol>
      <li class="numberedList" value="1">In the <code class="inlineCode">WorkingWithRegularExpressions</code> project, add a new class file named <code class="inlineCode">Program.Regexs.cs</code> and modify its content to define some <code class="inlineCode">partial</code> properties, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">using</span> System.Text.RegularExpressions; <span class="hljs-comment">// To use [GeneratedRegex].</span>
<span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
  [<span class="hljs-meta">GeneratedRegex(DigitsOnlyText, RegexOptions.IgnoreCase)</span>]
  <span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">partial</span><span class="hljs-function"> Regex </span><span class="hljs-title">DigitsOnly</span> { get; }
  [<span class="hljs-meta">GeneratedRegex(CommaSeparatorText, RegexOptions.IgnoreCase)</span>]
  <span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">partial</span><span class="hljs-function"> Regex </span><span class="hljs-title">CommaSeparator</span><span class="hljs-function"> { get; }</span>
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, replace the <code class="inlineCode">new</code> constructor with a call to the <code class="inlineCode">partial</code> method that <a id="_idIndexMarker1275"/>returns <a id="_idIndexMarker1276"/>the digits-only regular expression, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">Regex ageChecker = <span class="code-highlight"><strong class="hljs-slc">DigitsOnly</strong></span>;
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, replace the new constructor with a call to the <code class="inlineCode">partial</code> method that returns the comma-separator regular expression, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">Regex csv = <span class="code-highlight"><strong class="hljs-slc">CommaSeparator</strong></span>;
</code></pre>
      </li>
      <li class="numberedList">Hover your mouse pointer over the <code class="inlineCode">partial</code> methods and note the tooltip describes the behavior of the regular expression, as shown in <em class="italic">Figure 8.4</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_08_04.png" alt="" width="812" height="361"/></figure>
    <p class="packt_figref">Figure 8.4: Tooltip for a partial method shows a description of the regular expression</p>
    <ol>
      <li class="numberedList" value="5">Right-click the <code class="inlineCode">DigitsOnly</code> <code class="inlineCode">partial</code> method, select <strong class="screenText">Go To Definition</strong>, and note that you can review the implementation of the auto-generated partial<a id="_idIndexMarker1277"/> methods, as <a id="_idIndexMarker1278"/>shown in <em class="italic">Figure 8.5</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_08_05.png" alt="" width="812" height="254"/></figure>
    <p class="packt_figref">Figure 8.5: The auto-generated source code for the regular expression</p>
    <ol>
      <li class="numberedList" value="6">Run the <a id="_idIndexMarker1279"/>project <a id="_idIndexMarker1280"/>and confirm that the functionality is the same as before.</li>
    </ol>
    <div class="note">
      <p class="normal">You can learn more about the improvements to regular expressions with .NET 7 at the following link: <a href="https://devblogs.microsoft.com/dotnet/regular-expression-improvements-in-dotnet-7"><span class="url">https://devblogs.microsoft.com/dotnet/regular-expression-improvements-in-dotnet-7</span></a>.</p>
    </div>
    <h1 id="_idParaDest-529" class="heading-1">Storing multiple objects in collections</h1>
    <p class="normal">Another of the <a id="_idIndexMarker1281"/>most common types of data is collections. If you need to store multiple values in a variable, then you can use a collection.</p>
    <p class="normal">A collection is a data structure in memory that can manage multiple items in different ways, although all collections have some shared functionality.</p>
    <p class="normal">The most common types in .NET for working with collections are shown in <em class="italic">Table 8.9</em>:</p>
    <table id="table009-1" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Namespace</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Example types</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System .Collections</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">IEnumerable</code>,</p>
            <p class="normal"><code class="inlineCode">IEnumerable&lt;T&gt;</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Interfaces and base classes used by collections.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System .Collections .Generic</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">List&lt;T&gt;</code>,</p>
            <p class="normal"><code class="inlineCode">Dictionary&lt;T&gt;</code>,</p>
            <p class="normal"><code class="inlineCode">Queue&lt;T&gt;</code>,</p>
            <p class="normal"><code class="inlineCode">Stack&lt;T&gt;</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Introduced in C# 2.0 with .NET Framework 2.0. These collections allow you to specify the type you want to store using a generic type parameter (which is safer, faster, and more efficient).</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System .Collections .Concurrent</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">BlockingCollection</code>,</p>
            <p class="normal"><code class="inlineCode">ConcurrentDictionary</code>,</p>
            <p class="normal"><code class="inlineCode">ConcurrentQueue</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">These collections are safe to use in multithreaded scenarios.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System .Collections .Immutable</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">ImmutableArray</code>,</p>
            <p class="normal"><code class="inlineCode">ImmutableDictionary</code>,</p>
            <p class="normal"><code class="inlineCode">ImmutableList</code>,</p>
            <p class="normal"><code class="inlineCode">ImmutableQueue</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Designed for scenarios where the contents of the original collection will never change, although they can create modified collections as a new <a id="_idIndexMarker1282"/>instance.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 8.9: Common .NET collection types</p>
    <h2 id="_idParaDest-530" class="heading-2">Common features of all collections</h2>
    <p class="normal">All collections<a id="_idIndexMarker1283"/> implement the <code class="inlineCode">ICollection</code> interface; this means that they must have a <code class="inlineCode">Count</code> property to tell you how many objects are in them, and three other members, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">namespace</span> <span class="hljs-title">System.Collections</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">ICollection</span> : <span class="hljs-title">IEnumerable</span>
{
  <span class="hljs-built_in">int</span> Count { <span class="hljs-keyword">get</span>; }
  <span class="hljs-built_in">bool</span> IsSynchronized { <span class="hljs-keyword">get</span>; }
  <span class="hljs-built_in">object</span> SyncRoot { <span class="hljs-keyword">get</span>; }
  <span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">CopyTo</span><span class="hljs-function">(</span><span class="hljs-params">Array array, </span><span class="hljs-built_in">int</span><span class="hljs-params"> index</span><span class="hljs-function">)</span>;
}
</code></pre>
    <p class="normal">For example, if we had a collection named <code class="inlineCode">passengers</code>, we could do this:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-built_in">int</span> howMany = passengers.Count;
</code></pre>
    <p class="normal">As you have probably surmised, <code class="inlineCode">CopyTo</code> copies the collection to an array. <code class="inlineCode">IsSynchronized</code> and <code class="inlineCode">SyncRoot</code> are used in multithreading scenarios, so I do not cover them in this book.</p>
    <p class="normal">All collections implement the <code class="inlineCode">IEnumerable</code> interface, which means that they can be iterated using the <code class="inlineCode">foreach</code> statement. They must have a <code class="inlineCode">GetEnumerator</code> method that returns an object that implements <code class="inlineCode">IEnumerator</code>; this means that the returned <code class="inlineCode">object</code> must have <code class="inlineCode">MoveNext</code> and <code class="inlineCode">Reset</code> methods for navigating through the collection and a <code class="inlineCode">Current</code> property containing the current item in the collection, as<a id="_idIndexMarker1284"/> shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">namespace</span> <span class="hljs-title">System.Collections</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IEnumerable</span>
{
  <span class="hljs-function">IEnumerator </span><span class="hljs-title">GetEnumerator</span><span class="hljs-function">()</span>;
}
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IEnumerator</span>
{
  <span class="hljs-built_in">object</span> Current { <span class="hljs-keyword">get</span>; }
  <span class="hljs-built_in">bool</span><span class="hljs-function"> </span><span class="hljs-title">MoveNext</span><span class="hljs-function">()</span>;
  <span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Reset</span><span class="hljs-function">()</span>;
}
</code></pre>
    <p class="normal">For example, to perform an action on each object in the <code class="inlineCode">passengers</code> collection, we could write the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">foreach</span> (Passenger p <span class="hljs-keyword">in</span> passengers)
{
  <span class="hljs-comment">// Perform an action on each passenger.</span>
}
</code></pre>
    <p class="normal">As well as the <code class="inlineCode">object</code>-based collection interface, there is also a generic collection interface, where the generic type defines the type stored in the collection. It has additional members like <code class="inlineCode">IsReadOnly</code>, <code class="inlineCode">Add</code>, <code class="inlineCode">Clear</code>, <code class="inlineCode">Contains</code>, and <code class="inlineCode">Remove</code>, as shown in the following <a id="_idIndexMarker1285"/>code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">namespace</span> <span class="hljs-title">System.Collections.Generic</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">ICollection</span>&lt;<span class="hljs-title">T</span>&gt; : <span class="hljs-title">IEnumerable</span>&lt;<span class="hljs-title">T</span>&gt;, <span class="hljs-title">IEnumerable</span>
{
  <span class="hljs-built_in">int</span> Count { <span class="hljs-keyword">get</span>; }
  <span class="hljs-built_in">bool</span> IsReadOnly { <span class="hljs-keyword">get</span>; }
  <span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Add</span><span class="hljs-function">(</span><span class="hljs-params">T item</span><span class="hljs-function">)</span>;
  <span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Clear</span><span class="hljs-function">()</span>;
  <span class="hljs-built_in">bool</span><span class="hljs-function"> </span><span class="hljs-title">Contains</span><span class="hljs-function">(</span><span class="hljs-params">T item</span><span class="hljs-function">)</span>;
  <span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">CopyTo</span><span class="hljs-function">(</span><span class="hljs-params">T[] array, </span><span class="hljs-built_in">int</span><span class="hljs-params"> index</span><span class="hljs-function">)</span>;
  <span class="hljs-built_in">bool</span><span class="hljs-function"> </span><span class="hljs-title">Remove</span><span class="hljs-function">(</span><span class="hljs-params">T item</span><span class="hljs-function">)</span>;
}
</code></pre>
    <h2 id="_idParaDest-531" class="heading-2">Working with lists</h2>
    <p class="normal">Lists, that is, a<a id="_idIndexMarker1286"/> type that implements <code class="inlineCode">IList&lt;T&gt;</code>, are <strong class="keyWord">ordered collections</strong>, with<a id="_idIndexMarker1287"/> an <code class="inlineCode">int</code> index to show the<a id="_idIndexMarker1288"/> position of an item within the list, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">namespace</span> <span class="hljs-title">System.Collections.Generic</span>;
[<span class="hljs-meta">DefaultMember(</span><span class="hljs-string">"Item"</span><span class="hljs-meta">)</span>] <span class="hljs-comment">// aka "this" indexer.</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IList</span>&lt;<span class="hljs-title">T</span>&gt; : <span class="hljs-title">ICollection</span>&lt;<span class="hljs-title">T</span>&gt;, <span class="hljs-title">IEnumerable</span>&lt;<span class="hljs-title">T</span>&gt;, <span class="hljs-title">IEnumerable</span>
{
  T <span class="hljs-keyword">this</span>[<span class="hljs-built_in">int</span> index] { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
  <span class="hljs-built_in">int</span><span class="hljs-function"> </span><span class="hljs-title">IndexOf</span><span class="hljs-function">(</span><span class="hljs-params">T item</span><span class="hljs-function">)</span>;
  <span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Insert</span><span class="hljs-function">(</span><span class="hljs-built_in">int</span><span class="hljs-params"> index, T item</span><span class="hljs-function">)</span>;
  <span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">RemoveAt</span><span class="hljs-function">(</span><span class="hljs-built_in">int</span><span class="hljs-params"> index</span><span class="hljs-function">)</span>;
}
</code></pre>
    <div class="note">
      <p class="normal">The <code class="inlineCode">[DefaultMember]</code> attribute allows you to specify which member is accessed by default when no member name is specified. To make <code class="inlineCode">IndexOf</code> the default member, you would use <code class="inlineCode">[DefaultMember("IndexOf")]</code>. To specify the indexer, you use <code class="inlineCode">[DefaultMember("Item")]</code>.</p>
    </div>
    <p class="normal"><code class="inlineCode">IList&lt;T&gt;</code> derives from <code class="inlineCode">ICollection&lt;T&gt;</code>, so it has a <code class="inlineCode">Count</code> property, and an <code class="inlineCode">Add</code> method to put an item at the end of the collection, as well as an <code class="inlineCode">Insert</code> method to put an item in the list at a specified position, and <code class="inlineCode">RemoveAt</code> to remove an item at a specified position.</p>
    <p class="normal">Lists are a good choice when you want to manually control the order of items in a collection. Each item in a list has a unique index (or position) that is automatically assigned. Items can be any type defined by <code class="inlineCode">T</code> and items can be duplicated. Indexes <a id="_idIndexMarker1289"/>are <code class="inlineCode">int</code> types and start from <code class="inlineCode">0</code>, so the<a id="_idIndexMarker1290"/> first item in a list is at index <code class="inlineCode">0</code>, as shown in <em class="italic">Table 8.10</em>:</p>
    <table id="table010-1" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Index</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Item</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">0</p>
          </td>
          <td class="table-cell">
            <p class="normal">London</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">1</p>
          </td>
          <td class="table-cell">
            <p class="normal">Paris</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">2</p>
          </td>
          <td class="table-cell">
            <p class="normal">London</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">3</p>
          </td>
          <td class="table-cell">
            <p class="normal">Sydney</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 8.10: Cities in a list with indexes</p>
    <p class="normal">If a new item (for example, Santiago) is inserted between London and Sydney, then the index of Sydney is automatically incremented. Therefore, you must be aware that an item’s index can change after inserting or removing items, as shown in <em class="italic">Table 8.11</em>:</p>
    <table id="table011-1" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Index</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Item</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">0</p>
          </td>
          <td class="table-cell">
            <p class="normal">London</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">1</p>
          </td>
          <td class="table-cell">
            <p class="normal">Paris</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">2</p>
          </td>
          <td class="table-cell">
            <p class="normal">London</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">3</p>
          </td>
          <td class="table-cell">
            <p class="normal">Santiago</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">4</p>
          </td>
          <td class="table-cell">
            <p class="normal">Sydney</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 8.11: Cities list after an item is inserted</p>
    <div class="packt_tip">
      <p class="normal"><strong class="keyWord">Good practice</strong>: Some developers can get into the poor habit of using <code class="inlineCode">List&lt;T&gt;</code> and other collections when an array would be better. Use arrays instead of collections if the data will not change size after instantiation. You should also use lists initially while you are adding and removing items, but then convert them into an array once you are done with manipulating the items.</p>
    </div>
    <p class="normal">Let’s <a id="_idIndexMarker1291"/>explore<a id="_idIndexMarker1292"/> lists:</p>
    <ol>
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code> project named <code class="inlineCode">WorkingWithCollections</code> to the <code class="inlineCode">Chapter08</code> solution.</li>
      <li class="numberedList">Add a new class file named <code class="inlineCode">Program.Helpers.cs</code>.</li>
      <li class="numberedList">In <code class="inlineCode">Program.Helpers.cs</code>, define a partial <code class="inlineCode">Program</code> class with a generic method to output a collection of <code class="inlineCode">T</code> values with a title, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
  <span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">OutputCollection</span><span class="hljs-function">&lt;</span><span class="hljs-title">T</span><span class="hljs-function">&gt;(</span>
<span class="hljs-params">    </span><span class="hljs-built_in">string</span><span class="hljs-params"> title, IEnumerable&lt;T&gt; collection</span><span class="hljs-function">)</span>
  {
    WriteLine(<span class="hljs-string">$"</span><span class="hljs-subst">{title}</span><span class="hljs-string">:"</span>);
    <span class="hljs-keyword">foreach</span> (T item <span class="hljs-keyword">in</span> collection)
    {
      WriteLine(<span class="hljs-string">$"  </span><span class="hljs-subst">{item}</span><span class="hljs-string">"</span>);
    }
  }
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete the existing statements and then add some statements to illustrate some of the common ways of defining and working with<a id="_idIndexMarker1293"/> lists, as<a id="_idIndexMarker1294"/> shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// Simple syntax for creating a list and adding three items.</span>
List&lt;<span class="hljs-built_in">string</span>&gt; cities = <span class="hljs-keyword">new</span>();
cities.Add(<span class="hljs-string">"London"</span>);
cities.Add(<span class="hljs-string">"Paris"</span>);
cities.Add(<span class="hljs-string">"Milan"</span>);
<span class="hljs-comment">/* Alternative syntax that is converted by the compiler into</span>
<span class="hljs-comment">   the three Add method calls above.</span>
<span class="hljs-comment">List&lt;string&gt; cities = new()</span>
<span class="hljs-comment">  { "London", "Paris", "Milan" }; */</span>
<span class="hljs-comment">/* Alternative syntax that passes an array</span>
<span class="hljs-comment">   of string values to AddRange method.</span>
<span class="hljs-comment">List&lt;string&gt; cities = new();</span>
<span class="hljs-comment">cities.AddRange(new[] { "London", "Paris", "Milan" }); */</span>
OutputCollection(<span class="hljs-string">"Initial list"</span>, cities);
WriteLine(<span class="hljs-string">$"The first city is </span><span class="hljs-subst">{cities[</span><span class="hljs-number">0</span><span class="hljs-subst">]}</span><span class="hljs-string">."</span>);
WriteLine(<span class="hljs-string">$"The last city is </span><span class="hljs-subst">{cities[cities.Count - </span><span class="hljs-number">1</span><span class="hljs-subst">]}</span><span class="hljs-string">."</span>);
WriteLine($"Are all cities longer than four characters? {
  cities.TrueForAll(city =&gt; city.Length &gt; 4)}.");
WriteLine($"Do all cities contain the character 'e'? {
  cities.TrueForAll(city =&gt; city.Contains('e'))}.");
cities.Insert(<span class="hljs-number">0</span>, <span class="hljs-string">"Sydney"</span>);
OutputCollection(<span class="hljs-string">"After inserting Sydney at index 0"</span>, cities);
cities.RemoveAt(<span class="hljs-number">1</span>);
cities.Remove(<span class="hljs-string">"Milan"</span>);
OutputCollection(<span class="hljs-string">"After removing two cities"</span>, cities);
</code></pre>
      </li>
      <li class="numberedList">Run the code and view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Initial list:
  London
  Paris
  Milan
The first city is London.
The last city is Milan.
Are all cities longer than four characters? True.
Do all cities contain the character 'e'? False.
After inserting Sydney at index 0:
  Sydney
  London
  Paris
  Milan
After removing two cities:
  Sydney
  Paris
</code></pre>
      </li>
    </ol>
    <div class="packt_tip">
      <p class="normal"><strong class="keyWord">Good practice</strong>: LINQ has extension methods named <code class="inlineCode">All()</code> and <code class="inlineCode">Count()</code> that work like the <code class="inlineCode">List&lt;T&gt;</code> class <code class="inlineCode">TrueForAll()</code> method and <code class="inlineCode">Count</code> property respectively. You <a id="_idIndexMarker1295"/>will generally achieve better <a id="_idIndexMarker1296"/>performance by using methods provided by a class rather than the more general LINQ methods.</p>
    </div>
    <h2 id="_idParaDest-532" class="heading-2">Working with dictionaries</h2>
    <p class="normal">Dictionaries are a<a id="_idIndexMarker1297"/> good<a id="_idIndexMarker1298"/> choice when each <strong class="keyWord">value</strong> (or object) has a unique sub-value (or a made-up value) that can be used as a <strong class="keyWord">key</strong> to quickly find a value in the collection later. The key must be unique. For example, if you are storing a list of people, you could choose to use a government-issued identity number as the key. Dictionaries are<a id="_idIndexMarker1299"/> called <strong class="keyWord">hashmaps</strong> in other languages like Python and Java.</p>
    <p class="normal">Think of the key as being like an index entry in a real-world dictionary. It allows you to quickly find the definition of a word because the words (in other words, keys) are kept sorted; if we know we’re looking for the definition of <em class="italic">manatee</em>, we will jump to the middle of the dictionary to start looking, because the letter <em class="italic">m</em> is in the middle of the alphabet.</p>
    <p class="normal">Dictionaries in programming are similarly smart when looking something up. They must implement <a id="_idIndexMarker1300"/>the<a id="_idIndexMarker1301"/> interface <code class="inlineCode">IDictionary&lt;TKey, TValue&gt;</code>, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">namespace</span> <span class="hljs-title">System.Collections.Generic</span>;
[<span class="hljs-meta">DefaultMember(</span><span class="hljs-string">"Item"</span><span class="hljs-meta">)</span>] <span class="hljs-comment">// aka "this" indexer.</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IDictionary</span>&lt;<span class="hljs-title">TKey</span>, <span class="hljs-title">TValue</span>&gt;
  : <span class="hljs-title">ICollection</span>&lt;<span class="hljs-title">KeyValuePair</span>&lt;<span class="hljs-title">TKey</span>, <span class="hljs-title">TValue</span>&gt;&gt;,
    <span class="hljs-title">IEnumerable</span>&lt;<span class="hljs-title">KeyValuePair</span>&lt;<span class="hljs-title">TKey</span>, <span class="hljs-title">TValue</span>&gt;&gt;, <span class="hljs-title">IEnumerable</span>
{
  TValue <span class="hljs-keyword">this</span>[TKey key] { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
  ICollection&lt;TKey&gt; Keys { <span class="hljs-keyword">get</span>; }
  ICollection&lt;TValue&gt; Values { <span class="hljs-keyword">get</span>; }
  <span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Add</span><span class="hljs-function">(</span><span class="hljs-params">TKey key, TValue </span><span class="hljs-keyword">value</span><span class="hljs-function">)</span>;
  <span class="hljs-built_in">bool</span><span class="hljs-function"> </span><span class="hljs-title">ContainsKey</span><span class="hljs-function">(</span><span class="hljs-params">TKey key</span><span class="hljs-function">)</span>;
  <span class="hljs-built_in">bool</span><span class="hljs-function"> </span><span class="hljs-title">Remove</span><span class="hljs-function">(</span><span class="hljs-params">TKey key</span><span class="hljs-function">)</span>;
  <span class="hljs-built_in">bool</span><span class="hljs-function"> </span><span class="hljs-title">TryGetValue</span><span class="hljs-function">(</span><span class="hljs-params">TKey key, [MaybeNullWhen(</span><span class="hljs-literal">false</span><span class="hljs-function">)] </span><span class="hljs-keyword">out</span><span class="hljs-function"> TValue </span><span class="hljs-keyword">value</span><span class="hljs-function">)</span>;
}
</code></pre>
    <p class="normal">Items in a dictionary are instances of the <code class="inlineCode">struct</code>, aka the value type, <code class="inlineCode">KeyValuePair&lt;TKey, TValue&gt;</code>, where <code class="inlineCode">TKey</code> is the type of the key and <code class="inlineCode">TValue</code> is the type of the value, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">namespace</span> <span class="hljs-title">System.Collections.Generic</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">struct</span> KeyValuePair&lt;TKey, TValue&gt;
{
  <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-title">KeyValuePair</span><span class="hljs-function">(</span><span class="hljs-params">TKey key, TValue </span><span class="hljs-keyword">value</span><span class="hljs-function">)</span>;
  <span class="hljs-keyword">public</span> TKey Key { <span class="hljs-keyword">get</span>; }
  <span class="hljs-keyword">public</span> TValue Value { <span class="hljs-keyword">get</span>; }
  [<span class="hljs-meta">EditorBrowsable(EditorBrowsableState.Never)</span>]
  <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Deconstruct</span><span class="hljs-function">(</span><span class="hljs-keyword">out</span><span class="hljs-params"> TKey key, </span><span class="hljs-keyword">out</span><span class="hljs-params"> TValue </span><span class="hljs-keyword">value</span><span class="hljs-function">)</span>;
  <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">override</span><span class="hljs-function"> </span><span class="hljs-built_in">string</span><span class="hljs-function"> </span><span class="hljs-title">ToString</span><span class="hljs-function">()</span>;
}
</code></pre>
    <p class="normal">An example <code class="inlineCode">Dictionary&lt;string, Person&gt;</code> uses a <code class="inlineCode">string</code> as the key and a <code class="inlineCode">Person</code> instance as the value. <code class="inlineCode">Dictionary&lt;string, string&gt;</code> uses <code class="inlineCode">string</code> values for both, as shown in <em class="italic">Table 8.12</em>:</p>
    <table id="table012" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Key</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Value</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">BSA</p>
          </td>
          <td class="table-cell">
            <p class="normal">Bob Smith</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">MW</p>
          </td>
          <td class="table-cell">
            <p class="normal">Max Williams</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">BSB</p>
          </td>
          <td class="table-cell">
            <p class="normal">Bob Smith</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">AM</p>
          </td>
          <td class="table-cell">
            <p class="normal">Amir Mohammed</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 8.12: Dictionary with keys and values</p>
    <p class="normal">Let’s <a id="_idIndexMarker1302"/>explore<a id="_idIndexMarker1303"/> dictionaries:</p>
    <ol>
      <li class="numberedList" value="1">At the top of <code class="inlineCode">Program.cs</code>, define an alias for the <code class="inlineCode">Dictionary&lt;TKey, TValue&gt;</code> class, where <code class="inlineCode">TKey</code> and <code class="inlineCode">TValue</code> are both <code class="inlineCode">string</code>, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// Define an alias for a dictionary with string key and string value.</span>
<span class="hljs-keyword">using</span> StringDictionary = System.Collections.Generic.Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;;
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, add some statements to illustrate some of the common ways of working with dictionaries, for example, looking up word definitions, as shown <a id="_idIndexMarker1304"/>in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// Declare a dictionary without the alias.</span>
<span class="hljs-comment">// Dictionary&lt;string, string&gt; keywords = new();</span>
<span class="hljs-comment">// Use the alias to declare the dictionary.</span>
StringDictionary keywords = <span class="hljs-keyword">new</span>();
<span class="hljs-comment">// Add using named parameters.</span>
keywords.Add(key: <span class="hljs-string">"int"</span>, <span class="hljs-keyword">value</span>: <span class="hljs-string">"32-bit integer data type"</span>);
<span class="hljs-comment">// Add using positional parameters.</span>
keywords.Add(<span class="hljs-string">"long"</span>, <span class="hljs-string">"64-bit integer data type"</span>);
keywords.Add(<span class="hljs-string">"float"</span>, <span class="hljs-string">"Single precision floating point number"</span>);
<span class="hljs-comment">/* Alternative syntax; compiler converts this to calls to Add method.</span>
<span class="hljs-comment">Dictionary&lt;string, string&gt; keywords = new()</span>
<span class="hljs-comment">{</span>
<span class="hljs-comment">  { "int", "32-bit integer data type" },</span>
<span class="hljs-comment">  { "long", "64-bit integer data type" },</span>
<span class="hljs-comment">  { "float", "Single precision floating point number" },</span>
<span class="hljs-comment">}; */</span>
<span class="hljs-comment">/* Alternative syntax; compiler converts this to calls to Add method.</span>
<span class="hljs-comment">Dictionary&lt;string, string&gt; keywords = new()</span>
<span class="hljs-comment">{</span>
<span class="hljs-comment">  ["int"] = "32-bit integer data type",</span>
<span class="hljs-comment">  ["long"] = "64-bit integer data type",</span>
<span class="hljs-comment">  ["float"] = "Single precision floating point number",</span>
<span class="hljs-comment">}; */</span>
OutputCollection(<span class="hljs-string">"Dictionary keys"</span>, keywords.Keys);
OutputCollection(<span class="hljs-string">"Dictionary values"</span>, keywords.Values);
WriteLine(<span class="hljs-string">"Keywords and their definitions:"</span>);
<span class="hljs-keyword">foreach</span> (KeyValuePair&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; item <span class="hljs-keyword">in</span> keywords)
{
  WriteLine(<span class="hljs-string">$"  </span><span class="hljs-subst">{item.Key}</span><span class="hljs-string">: </span><span class="hljs-subst">{item.Value}</span><span class="hljs-string">"</span>);
}
<span class="hljs-comment">// Look up a value using a key.</span>
<span class="hljs-built_in">string</span> key = <span class="hljs-string">"long"</span>;
WriteLine(<span class="hljs-string">$"The definition of </span><span class="hljs-subst">{key}</span><span class="hljs-string"> is </span><span class="hljs-subst">{keywords[key]}</span><span class="hljs-string">."</span>);
</code></pre>
      </li>
    </ol>
    <div class="note-one">
      <p class="normal">The trailing commas after the third item is added to the dictionary are optional and the compiler will not complain about them. This is convenient so that you can change the order of the three items without having to delete and add commas in the right places.</p>
    </div>
    <ol>
      <li class="numberedList" value="3">Run the code and view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Dictionary keys:
  int
  long
  float
Dictionary values:
  32-bit integer data type
  64-bit integer data type
  Single precision floating point number
Keywords and their definitions:
  int: 32-bit integer data type
  long: 64-bit integer data type
  float: Single precision floating point number
The definition of long is 64-bit integer data type
</code></pre>
      </li>
    </ol>
    <div class="note">
      <p class="normal">In <em class="chapterRef">Chapter 11</em>, <em class="italic">Querying and Manipulating Data Using LINQ</em>, you will learn how to create dictionaries and lookups from existing data sources, like tables in a database, using LINQ methods, like <code class="inlineCode">ToDictionary</code> and <code class="inlineCode">ToLookup</code>. This is much more<a id="_idIndexMarker1305"/> common <a id="_idIndexMarker1306"/>than manually adding items to a dictionary, as shown in this section.</p>
    </div>
    <h2 id="_idParaDest-533" class="heading-2">Sets, stacks, and queues</h2>
    <p class="normal"><strong class="keyWord">Sets</strong> are a good<a id="_idIndexMarker1307"/> choice <a id="_idIndexMarker1308"/>when you want to <a id="_idIndexMarker1309"/>perform set<a id="_idIndexMarker1310"/> operations between two collections. For example, you may have two collections of city names, and you want to know which names appear in both sets (known as the <em class="italic">intersect</em> between the sets). Items in a set must be unique.</p>
    <p class="normal">Common set methods are shown in <em class="italic">Table 8.13</em>:</p>
    <table id="table013" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Method</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Add</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">If the item does not already exist in the set, then it is added. This returns <code class="inlineCode">true</code> if the item was added, and <code class="inlineCode">false</code> if it was already in the set.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">ExceptWith</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This removes the items in the set passed as the parameter from the set.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">IntersectWith</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This removes the items not in the set passed as the parameter and in the set.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">IsProperSubsetOf</code>, <code class="inlineCode">IsProperSupersetOf</code>, <code class="inlineCode">IsSubsetOf</code>, <code class="inlineCode">IsSupersetOf</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">A subset is a set whose items are all in the other set. A proper subset is a set whose items are all in the other set but there is at least one item in the other set that is not in the set. A superset is a set that contains all the items in the other set. A proper superset is a set that contains all the items in the other set and at least one more not in the other set.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Overlaps</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">The set and the other set share at least one common item.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">SetEquals</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">The set and the other set contain exactly the same items.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">SymmetricExceptWith</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This removes the items not in the set passed as the parameter from the set and adds any that are missing.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">UnionWith</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This adds any items in the set passed as the parameter to the set that are not already in the set.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 8.13: Set methods</p>
    <p class="normal">Let’s <a id="_idIndexMarker1311"/>explore<a id="_idIndexMarker1312"/> example <a id="_idIndexMarker1313"/>code for<a id="_idIndexMarker1314"/> sets:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, add some statements to add items to a set, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">HashSet&lt;<span class="hljs-built_in">string</span>&gt; names = <span class="hljs-keyword">new</span>();
<span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">string</span> name <span class="hljs-keyword">in</span>
  <span class="hljs-keyword">new</span>[] { <span class="hljs-string">"Adam"</span>, <span class="hljs-string">"</span><span class="hljs-string">Barry"</span>, <span class="hljs-string">"Charlie"</span>, <span class="hljs-string">"Barry"</span> })
{
  <span class="hljs-built_in">bool</span> added = names.Add(name);
  WriteLine(<span class="hljs-string">$"</span><span class="hljs-subst">{name}</span><span class="hljs-string"> was added: </span><span class="hljs-subst">{added}</span><span class="hljs-string">."</span>);
}
WriteLine(<span class="hljs-string">$"names set: </span><span class="hljs-subst">{</span><span class="hljs-built_in">string</span><span class="hljs-subst">.Join(</span><span class="hljs-string">','</span><span class="hljs-subst">, names)}</span><span class="hljs-string">."</span>);
</code></pre>
      </li>
      <li class="numberedList">Run the code and view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Adam was added: True.
Barry was added: True.
Charlie was added: True.
Barry was added: False.
names set: Adam,Barry,Charlie.
</code></pre>
      </li>
    </ol>
    <p class="normal">You will see more set operations in <em class="chapterRef">Chapter 11</em>, <em class="italic">Querying and Manipulating Data Using LINQ</em>.</p>
    <p class="normal"><strong class="keyWord">Stacks</strong> are a<a id="_idIndexMarker1315"/> good <a id="_idIndexMarker1316"/>choice when you want<a id="_idIndexMarker1317"/> to <a id="_idIndexMarker1318"/>implement <strong class="keyWord">last-in, first-out</strong> (<strong class="keyWord">LIFO</strong>) behavior. With <a id="_idIndexMarker1319"/>a stack, you can only directly access or remove the one item at the top of the stack, although you can enumerate to read through the whole stack of items. You cannot, for example, directly access the second item in a stack.</p>
    <p class="normal">For example, word processors use a stack to remember the sequence of actions you have recently performed, and then, when you press <em class="keystroke">Ctrl</em> + <em class="keystroke">Z</em>, it will undo the last action in the stack, and then the next-to-last action, and so on.</p>
    <p class="normal"><strong class="keyWord">Queues</strong> are a good <a id="_idIndexMarker1320"/>choice when you want to implement <strong class="keyWord">first-in, first-out</strong> (<strong class="keyWord">FIFO</strong>) behavior. With <a id="_idIndexMarker1321"/>a queue, you can only directly access or remove the item at the front of the queue, although you can enumerate to read through the whole queue of items. You cannot, for example, directly access the second item in a queue.</p>
    <p class="normal">For example, background processes use a queue to process work items in the order that they arrive, just like people standing in line at the post office.</p>
    <p class="normal">.NET 6 introduced the <code class="inlineCode">PriorityQueue</code>, where each item in the queue has a priority value assigned, as well as its position in the queue.</p>
    <p class="normal">Let’s explore example code for queues:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, add some statements to illustrate some of the common ways of working <a id="_idIndexMarker1322"/>with<a id="_idIndexMarker1323"/> queues, for<a id="_idIndexMarker1324"/> example, handling customers in a queue for coffee, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">Queue&lt;<span class="hljs-built_in">string</span>&gt; coffee = <span class="hljs-keyword">new</span>();
coffee.Enqueue(<span class="hljs-string">"Damir"</span>); <span class="hljs-comment">// Front of the queue.</span>
coffee.Enqueue(<span class="hljs-string">"Andrea"</span>);
coffee.Enqueue(<span class="hljs-string">"Ronald"</span>);
coffee.Enqueue(<span class="hljs-string">"Amin"</span>);
coffee.Enqueue(<span class="hljs-string">"Irina"</span>); <span class="hljs-comment">// Back of the queue.</span>
OutputCollection(<span class="hljs-string">"Initial queue from front to back"</span>, coffee);
<span class="hljs-comment">// Server handles next person in queue.</span>
<span class="hljs-built_in">string</span> served = coffee.Dequeue();
WriteLine(<span class="hljs-string">$"Served: </span><span class="hljs-subst">{served}</span><span class="hljs-string">."</span>);
<span class="hljs-comment">// Server handles next person in queue.</span>
served = coffee.Dequeue();
WriteLine(<span class="hljs-string">$"Served: </span><span class="hljs-subst">{served}</span><span class="hljs-string">."</span>);
OutputCollection(<span class="hljs-string">"Current queue from front to back"</span>, coffee);
WriteLine(<span class="hljs-string">$"</span><span class="hljs-subst">{coffee.Peek()}</span><span class="hljs-string"> is next in line."</span>);
OutputCollection(<span class="hljs-string">"Current queue from front to back"</span>, coffee);
</code></pre>
      </li>
      <li class="numberedList">Run the code and <a id="_idIndexMarker1325"/>view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Initial queue from front to back:
  Damir
  Andrea
  Ronald
  Amin
  Irina
Served: Damir.
Served: Andrea.
Current queue from front to back:
  Ronald
  Amin
  Irina
Ronald is next in line.
Current queue from front to back:
  Ronald
  Amin
  Irina
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.Helpers.cs</code>, in the partial <code class="inlineCode">Program</code> class, add a static method named <code class="inlineCode">OutputPQ</code>, as<a id="_idIndexMarker1326"/> shown<a id="_idIndexMarker1327"/> in the <a id="_idIndexMarker1328"/>following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">OutputPQ</span><span class="hljs-function">&lt;</span><span class="hljs-title">TElement</span><span class="hljs-function">, </span><span class="hljs-title">TPriority</span><span class="hljs-function">&gt;(</span><span class="hljs-built_in">string</span><span class="hljs-params"> title,</span>
<span class="hljs-params">  IEnumerable&lt;(TElement Element, TPriority Priority</span><span class="hljs-function">)&gt; collection)</span>
{
  WriteLine(<span class="hljs-string">$"</span><span class="hljs-subst">{title}</span><span class="hljs-string">:"</span>);
  <span class="hljs-keyword">foreach</span> ((TElement, TPriority) item <span class="hljs-keyword">in</span> collection)
  {
    WriteLine(<span class="hljs-string">$"  </span><span class="hljs-subst">{item.Item1}</span><span class="hljs-string">: </span><span class="hljs-subst">{item.Item2}</span><span class="hljs-string">"</span>);
  }
}
</code></pre>
      </li>
    </ol>
    <div class="note-one">
      <p class="normal">Note that the <code class="inlineCode">OutputPQ</code> method is generic. You can specify the two types used in the tuples that are passed in as <code class="inlineCode">collection</code>.</p>
    </div>
    <ol>
      <li class="numberedList" value="4">In <code class="inlineCode">Program.cs</code>, add some statements to illustrate some of the common ways of working<a id="_idIndexMarker1329"/> with priority<a id="_idIndexMarker1330"/> queues, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">PriorityQueue&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">int</span>&gt; vaccine = <span class="hljs-keyword">new</span>();
<span class="hljs-comment">// Add some people.</span>
<span class="hljs-comment">// 1 = High priority people in their 70s or poor health.</span>
<span class="hljs-comment">// 2 = Medium priority e.g. middle-aged.</span>
<span class="hljs-comment">// 3 = Low priority e.g. teens and twenties.</span>
vaccine.Enqueue(<span class="hljs-string">"Pamela"</span>, <span class="hljs-number">1</span>);
vaccine.Enqueue(<span class="hljs-string">"</span><span class="hljs-string">Rebecca"</span>, <span class="hljs-number">3</span>);
vaccine.Enqueue(<span class="hljs-string">"Juliet"</span>, <span class="hljs-number">2</span>);
vaccine.Enqueue(<span class="hljs-string">"Ian"</span>, <span class="hljs-number">1</span>);
OutputPQ(<span class="hljs-string">"Current queue for vaccination"</span>, vaccine.UnorderedItems);
WriteLine(<span class="hljs-string">$"</span><span class="hljs-subst">{vaccine.Dequeue()}</span><span class="hljs-string"> has been vaccinated."</span>);
WriteLine(<span class="hljs-string">$"</span><span class="hljs-subst">{vaccine.Dequeue()}</span><span class="hljs-string"> has been vaccinated."</span>);
OutputPQ(<span class="hljs-string">"Current queue for vaccination"</span>, vaccine.UnorderedItems);
WriteLine(<span class="hljs-string">$"</span><span class="hljs-subst">{vaccine.Dequeue()}</span><span class="hljs-string"> has been vaccinated."</span>);
WriteLine(<span class="hljs-string">"Adding Mark to queue with priority 2."</span>);
vaccine.Enqueue(<span class="hljs-string">"Mark"</span>, <span class="hljs-number">2</span>);
WriteLine(<span class="hljs-string">$"</span><span class="hljs-subst">{vaccine.Peek()}</span><span class="hljs-string"> will be next to be vaccinated."</span>);
OutputPQ(<span class="hljs-string">"Current queue for vaccination"</span>, vaccine.UnorderedItems);
</code></pre>
      </li>
      <li class="numberedList">Run the code <a id="_idIndexMarker1331"/>and<a id="_idIndexMarker1332"/> view the result, as <a id="_idIndexMarker1333"/>shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Current queue for vaccination:
  Pamela: 1
  Rebecca: 3
  Juliet: 2
  Ian: 1
Pamela has been vaccinated.
Ian has been vaccinated.
Current queue for vaccination:
  Juliet: 2
  Rebecca: 3
Juliet has been vaccinated.
Adding Mark to queue with priority 2
Mark will be next to be vaccinated.
Current queue for vaccination:
  Mark: 2
  Rebecca: 3
</code></pre>
      </li>
    </ol>
    <p class="normal">.NET 9 introduced a <code class="inlineCode">Remove</code> method to <code class="inlineCode">PriorityQueue</code>. The method performs a linear-time scan through each element in the heap, removing the first occurrence that matches the specified element parameter. If there are duplicate entries, the <a id="_idIndexMarker1334"/>method <a id="_idIndexMarker1335"/>removes one of them<a id="_idIndexMarker1336"/> in a non-deterministic manner, without considering <a id="_idIndexMarker1337"/>any priority.</p>
    <h2 id="_idParaDest-534" class="heading-2">Collection add and remove methods</h2>
    <p class="normal">Each collection<a id="_idIndexMarker1338"/> has a different set of methods to “add” and “remove” items, as shown in <em class="italic">Table 8.14</em>:</p>
    <table id="table014" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Collection</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">“Add” methods</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">“Remove” methods</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">List</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Add</code>, <code class="inlineCode">Insert</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Remove</code>, <code class="inlineCode">RemoveAt</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Lists are ordered so items have an integer index position. <code class="inlineCode">Add</code> will add a new item at the end of the list. <code class="inlineCode">Insert</code> will add a new item at the index position specified.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Dictionary</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Add</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Remove</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Dictionaries are not ordered so items do not have integer index positions. You can check if a key has been used by calling the <code class="inlineCode">ContainsKey</code> method.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Stack</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Push</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Pop</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Stacks always add a new item at the top of the stack using the <code class="inlineCode">Push</code> method. The first item is at the bottom. Items are always removed from the top of the stack using the <code class="inlineCode">Pop</code> method. Call the <code class="inlineCode">Peek</code> method to see this value without removing it. Stacks are LIFO.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Queue</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Enqueue</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Dequeue</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Queues always add a new item at the end of the queue using the <code class="inlineCode">Enqueue</code> method. The first item is at the front of the queue. Items are always removed from the front of the queue using the <code class="inlineCode">Dequeue</code> method. Call the <code class="inlineCode">Peek</code> method to see this<a id="_idIndexMarker1339"/> value without removing it. Queues are FIFO.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 8.14: Collection “add” and “remove” methods</p>
    <h2 id="_idParaDest-535" class="heading-2">Sorting collections</h2>
    <p class="normal">A <code class="inlineCode">List&lt;T&gt;</code> class can be <a id="_idIndexMarker1340"/>sorted by manually calling its <code class="inlineCode">Sort</code> method (but remember that the indexes of each item will change). Manually sorting a list of <code class="inlineCode">string</code> values or other built-in types will work without extra effort on your part, but if you create a collection of your own type, then that type must implement an interface named <code class="inlineCode">IComparable</code>. You learned how to do this in <em class="chapterRef">Chapter 6</em>, <em class="italic">Implementing Interfaces and Inheriting Classes</em>.</p>
    <p class="normal">A <code class="inlineCode">Stack&lt;T&gt;</code> or <code class="inlineCode">Queue&lt;T&gt;</code> collection cannot be sorted because you wouldn’t usually want that functionality; for example, you would probably never sort a queue of guests checking into a hotel. But sometimes, you might want to sort a dictionary or a set.</p>
    <p class="normal">Sometimes, it would be useful to have an automatically sorted collection, that is, one that maintains the items in a sorted order as you add and remove them.</p>
    <p class="normal">There are multiple auto-sorting collections to choose from. The differences between these sorted collections are often subtle but can have an impact on the memory requirements and performance of your application, so it is worth putting effort into picking the most appropriate option for your requirements.</p>
    <p class="normal">Since the early days of .NET, the <code class="inlineCode">OrderedDictionary</code> type has supported this, but it was non-generic, with keys and values typed as <code class="inlineCode">System.Object</code>. .NET 9 introduces the long-awaited <code class="inlineCode">OrderedDictionary&lt;TKey, TValue&gt;</code> collection, offering an efficient and generic solution for these scenarios.</p>
    <p class="normal">Some other <a id="_idIndexMarker1341"/>common auto-sorting collections are shown in <em class="italic">Table 8.15</em>:</p>
    <table id="table015" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Collection</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">SortedDictionary&lt;TKey, TValue&gt;</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This represents a collection of key-value pairs that are sorted by key. Internally, it maintains a binary tree for items.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">SortedList&lt;TKey, TValue&gt;</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This represents a collection of key-value pairs that are sorted by key. The name is misleading because this is not a list. Compared to <code class="inlineCode">SortedDictionary&lt;TKey, TValue&gt;</code>, retrieval performance is similar, it uses less memory, and insert and remove operations are slower for unsorted data. If it is populated from sorted data, then it is faster. Internally, it maintains a sorted array with a binary search to find elements.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">SortedSet&lt;T&gt;</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This represents a collection of unique objects that are maintained in a sorted order.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 8.15: Common auto-sorting collections</p>
    <h2 id="_idParaDest-536" class="heading-2">Specialized collections</h2>
    <p class="normal">There are a <a id="_idIndexMarker1342"/>few other collections for special situations.</p>
    <p class="normal">The <code class="inlineCode">System.Collections.BitArray</code> collection manages a compact array of bit values, which are represented as Booleans, where <code class="inlineCode">true</code> indicates that the bit is on (value is 1) and <code class="inlineCode">false</code> indicates that the bit is off (value is 0).</p>
    <p class="normal">The <code class="inlineCode">System.Collections.Generics.LinkedList&lt;T&gt;</code> collection represents a doubly linked list where every item has a reference to its previous and next items. They provide better performance compared to <code class="inlineCode">List&lt;T&gt;</code> for scenarios where you will frequently insert and remove items from the middle of the list. In a <code class="inlineCode">LinkedList&lt;T&gt;</code>, the items do not have to be rearranged in memory.</p>
    <h2 id="_idParaDest-537" class="heading-2">Read-only, immutable, and frozen collections</h2>
    <p class="normal">When we <a id="_idIndexMarker1343"/>looked <a id="_idIndexMarker1344"/>at the generic <a id="_idIndexMarker1345"/>collection interface, we saw that it has a property named <code class="inlineCode">IsReadOnly</code>. This is useful when we want to pass a collection to a method but not allow it to make changes.</p>
    <p class="normal">For example, we might define a method as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">ReadCollection</span><span class="hljs-function">&lt;</span><span class="hljs-title">T</span><span class="hljs-function">&gt;(</span><span class="hljs-params">ICollection&lt;T&gt; collection</span><span class="hljs-function">)</span>
{
  <span class="hljs-comment">// We can check if the collection is read-only.</span>
  <span class="hljs-keyword">if</span> (collection.IsReadOnly)
  {
    <span class="hljs-comment">// Read the collection.</span>
  }
  <span class="hljs-keyword">else</span>
  {
    WriteLine(<span class="hljs-string">"You have given me a collection that I could change!"</span>);
  }
}
</code></pre>
    <p class="normal">Generic collections, like <code class="inlineCode">List&lt;T&gt;</code> and <code class="inlineCode">Dictionary&lt;TKey, TValue&gt;</code>, have an <code class="inlineCode">AsReadOnly</code> method to create a <code class="inlineCode">ReadOnlyCollection&lt;T&gt;</code> that references the original collection. Although the <code class="inlineCode">ReadOnlyCollection&lt;T&gt;</code> has to have an <code class="inlineCode">Add</code> and a <code class="inlineCode">Remove</code> method because it implements <code class="inlineCode">ICollection&lt;T&gt;</code>, it throws a <code class="inlineCode">NotImplementedException</code> to prevent changes.</p>
    <p class="normal">If the original collection has items added or removed, the <code class="inlineCode">ReadOnlyCollection&lt;T&gt;</code> will see those changes. You can think of a <code class="inlineCode">ReadOnlyCollection&lt;T&gt;</code> as a protected view of a collection.</p>
    <p class="normal">Let’s see how we can make sure a collection is read-only:</p>
    <ol>
      <li class="numberedList" value="1">In the <code class="inlineCode">WorkingWithCollections</code> project, in <code class="inlineCode">Program.Helpers.cs</code>, add a method <a id="_idIndexMarker1346"/>that<a id="_idIndexMarker1347"/> should only <a id="_idIndexMarker1348"/>be given a read-only dictionary with <code class="inlineCode">string</code> for the type of key and value, but the naughty method tries to call <code class="inlineCode">Add</code>, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">UseDictionary</span><span class="hljs-function">(</span>
<span class="hljs-params">  IDictionary&lt;</span><span class="hljs-built_in">string</span><span class="hljs-params">, </span><span class="hljs-built_in">string</span><span class="hljs-params">&gt; dictionary</span><span class="hljs-function">)</span>
{
  WriteLine(<span class="hljs-string">$"Count before is </span><span class="hljs-subst">{dictionary.Count}</span><span class="hljs-string">."</span>);
  <span class="hljs-keyword">try</span>
  {
    WriteLine(<span class="hljs-string">"Adding new item with GUID values."</span>);
    <span class="hljs-comment">// Add method with return type of void.</span>
    dictionary.Add(
      key: Guid.NewGuid().ToString(),
      <span class="hljs-keyword">value</span>: Guid.NewGuid().ToString());
  }
  <span class="hljs-keyword">catch</span> (NotSupportedException)
  {
    WriteLine(<span class="hljs-string">"This dictionary does not support the Add method."</span>);
  }
  WriteLine(<span class="hljs-string">$"Count after is </span><span class="hljs-subst">{dictionary.Count}</span><span class="hljs-string">."</span>);
}
</code></pre>
        <div class="note-one">
          <p class="normal">Note the type of parameter is <code class="inlineCode">IDictionary&lt;TKey, TValue&gt;</code>. Using an interface provides more flexibility because we can pass either a <code class="inlineCode">Dictionary&lt;TKey, TValue&gt;</code>, a <code class="inlineCode">ReadOnlyDictionary&lt;TKey, TValue&gt;</code>, or anything else that implements that interface.</p>
        </div>
      </li>
    </ol>
    <ol>
      <li class="numberedList" value="2">In <code class="inlineCode">Program.cs</code>, add statements to pass the <code class="inlineCode">keywords</code> dictionary to this naughty method, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">UseDictionary(keywords);
</code></pre>
      </li>
      <li class="numberedList">Run the code, view the result, and note that the naughty method was able to add a new key-value pair, so the count has incremented, as shown in<a id="_idIndexMarker1349"/> the <a id="_idIndexMarker1350"/>following<a id="_idIndexMarker1351"/> output:
        <pre class="programlisting con-one"><code class="hljs-con">Count before is 3.
Adding new item with GUID values.
Count after is 4.
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, comment out the <code class="inlineCode">UseDictionary</code> statement, and then add a statement to pass the dictionary converted into a read-only collection, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">//UseDictionary(keywords);</span>
UseDictionary(keywords.AsReadOnly());
</code></pre>
      </li>
      <li class="numberedList">Run the code, view the result, and note that this time, the method was not able to add an item, so the count is the same, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Count before is 3.
Adding new item with GUID values.
This dictionary does not support the Add method.
Count after is 3.
</code></pre>
      </li>
      <li class="numberedList">At the top of <code class="inlineCode">Program.cs</code>, import the <code class="inlineCode">System.Collections.Immutable</code> namespace, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">using</span> System.Collections.Immutable; <span class="hljs-comment">// To use ImmutableDictionary&lt;T, T&gt;.</span>
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, comment out the <code class="inlineCode">AsReadOnly</code> statement and then add a statement to pass the keywords converted into an immutable dictionary, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">//UseDictionary(keywords.AsReadOnly());</span>
UseDictionary(keywords.ToImmutableDictionary());
</code></pre>
      </li>
      <li class="numberedList">Run the code, view the result, and note that this time, the method was also not able to add a default value, so the count is the same – it is the same behavior as using a read-only collection, so what’s the point of immutable collections?</li>
    </ol>
    <p class="normal">If you import the <code class="inlineCode">System.Collections.Immutable</code> namespace, then any collection that implements <code class="inlineCode">IEnumerable&lt;T&gt;</code> is given six extension methods to convert it into an immutable collection, like a list, dictionary, set, and so on.</p>
    <p class="normal">Although <a id="_idIndexMarker1352"/>the<a id="_idIndexMarker1353"/> immutable <a id="_idIndexMarker1354"/>collection will have a method named <code class="inlineCode">Add</code>, it does not add an item to the original immutable collection! Instead, it returns a new immutable collection with the new item in it. The original immutable collection still only has the original items in it.</p>
    <p class="normal">Let’s see an example:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, add statements to convert the keywords dictionary into an immutable dictionary, and then add a new keyword definition to it by randomly generating GUID values, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">ImmutableDictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; immutableKeywords =
  keywords.ToImmutableDictionary();
<span class="hljs-comment">// Call the Add method with a return value.</span>
ImmutableDictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; newDictionary =
  immutableKeywords.Add(
    key: Guid.NewGuid().ToString(),
    <span class="hljs-keyword">value</span>: Guid.NewGuid().ToString());
OutputCollection(<span class="hljs-string">"Immutable keywords dictionary"</span>, immutableKeywords);
OutputCollection(<span class="hljs-string">"New keywords dictionary"</span>, newDictionary);
</code></pre>
      </li>
      <li class="numberedList">Run the code, view the result, and note that the immutable keywords dictionary does not get modified when you call the <code class="inlineCode">Add</code> method on it; instead, it returns a new dictionary with all the existing keywords plus the newly added <a id="_idIndexMarker1355"/>keyword, as<a id="_idIndexMarker1356"/> shown<a id="_idIndexMarker1357"/> in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Immutable keywords dictionary:
  [float, Single precision floating point number]
  [long, 64-bit integer data type]
  [int, 32-bit integer data type]
New keywords dictionary:
  [d0e099ff-995f-4463-ae7f-7b59ed3c8d1d, 3f8e4c38-c7a3-4b20-acb3-01b2e3c86e8c]
  [float, Single precision floating point number]
  [long, 64-bit integer data type]
  [int, 32-bit integer data type]
</code></pre>
      </li>
    </ol>
    <div class="note">
      <p class="normal">Newly added items will not always appear at the top of the dictionary, as shown in the output above. Internally, the order is defined by the hash of the key. This is why dictionaries are sometimes called hash tables.</p>
    </div>
    <div class="packt_tip">
      <p class="normal"><strong class="keyWord">Good practice</strong>: To improve performance, many applications store a shared copy of commonly accessed objects in a central cache. To safely allow multiple threads to work with those objects knowing they won’t change, you should make them immutable or use a concurrent collection type, which you can read about at the following link: <a href="https://learn.microsoft.com/en-us/dotnet/api/system.collections.concurrent"><span class="url">https://learn.microsoft.com/en-us/dotnet/api/system.collections.concurrent</span></a>.</p>
    </div>
    <p class="normal">The generic collections have some potential performance issues related to how they are designed.</p>
    <p class="normal">First, being generic, the types of items or types used for keys and values for a dictionary have a big effect on performance, depending on what they are. Since they could be any type, the .NET team cannot optimize the algorithm. <code class="inlineCode">string</code> and <code class="inlineCode">int</code> types are the most used in real life. If the .NET team could rely on those always being the types used, then they could greatly improve performance.</p>
    <p class="normal">Second, collections are dynamic, meaning that new items can be added, and existing items can be removed at any time. Even more optimizations could be made if the .NET team knew that no more changes would be made to the collection.</p>
    <p class="normal">.NET 8 introduced a new concept: frozen collections. Hmmm, we already have immutable collections, so what is different about frozen collections? Are they delicious like ice cream? The idea is that 95% of the time, a collection is populated and<a id="_idIndexMarker1358"/> then <a id="_idIndexMarker1359"/>never <a id="_idIndexMarker1360"/>changed. So, if we could optimize them at the time of creation, then those optimizations could be made, adding some time and effort upfront, but then after that, performance for reading the collection could be greatly improved.</p>
    <p class="normal">In .NET 8, there are only two frozen collections: <code class="inlineCode">FrozenDictionary&lt;TKey, TValue&gt;</code> and <code class="inlineCode">FrozenSet&lt;T&gt;</code>. More may come in future versions of .NET, but these are the two most common scenarios that would benefit from the frozen concept.</p>
    <p class="normal">Let’s go:</p>
    <ol>
      <li class="numberedList" value="1">At the top of <code class="inlineCode">Program.cs</code>, import the <code class="inlineCode">System.Collections.Frozen</code> namespace, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">using</span> System.Collections.Frozen; <span class="hljs-comment">// To use FrozenDictionary&lt;T, T&gt;.</span>
</code></pre>
      </li>
      <li class="numberedList">At the bottom of <code class="inlineCode">Program.cs</code>, add statements to convert the keywords dictionary into a frozen dictionary, output its items, and then look up the definition of <code class="inlineCode">long</code>, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// Creating a frozen collection has an overhead to perform the</span>
<span class="hljs-comment">// sometimes complex optimizations.</span>
FrozenDictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; frozenKeywords =
  keywords.ToFrozenDictionary();
OutputCollection(<span class="hljs-string">"Frozen keywords dictionary"</span>, frozenKeywords);
<span class="hljs-comment">// Lookups are faster in a frozen dictionary.</span>
WriteLine(<span class="hljs-string">$"Define long: </span><span class="hljs-subst">{frozenKeywords[</span><span class="hljs-string">"long"</span><span class="hljs-subst">]}</span><span class="hljs-string">"</span>);
</code></pre>
      </li>
      <li class="numberedList">Run the code and view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Frozen keywords dictionary:
  [int, 32-bit integer data type]
  [long, 64-bit integer data type]
  [float, Single precision floating point number]
Define long: 64-bit integer data type
</code></pre>
      </li>
    </ol>
    <p class="normal-one">What the <code class="inlineCode">Add</code> method <a id="_idIndexMarker1361"/>does depends on the type, as<a id="_idIndexMarker1362"/> summarized<a id="_idIndexMarker1363"/> in the following list:</p>
    <ul>
      <li class="bulletList level-2"><code class="inlineCode">List&lt;T&gt;</code>: This adds a new item to the end of the existing list.</li>
      <li class="bulletList level-2"><code class="inlineCode">Dictionary&lt;TKey, TValue&gt;</code>: This adds a new item to the existing dictionary in a position determined by its internal structure.</li>
      <li class="bulletList level-2"><code class="inlineCode">ReadOnlyCollection&lt;T&gt;</code>: This throws a not-supported exception.</li>
      <li class="bulletList level-2"><code class="inlineCode">ImmutableList&lt;T&gt;</code>: This returns a new list with the new item in it. This does not affect the original list.</li>
      <li class="bulletList level-2"><code class="inlineCode">ImmutableDictionary&lt;TKey, TValue&gt;</code>: This returns a new dictionary with the new item in it. This does not affect the original dictionary.</li>
      <li class="bulletList level-2"><code class="inlineCode">FrozenDictionary&lt;TKey, TValue&gt;</code>: This does not exist.</li>
    </ul>
    <div class="note">
      <p class="normal"><strong class="keyWord">More information</strong>: The documentation for frozen collections is found at the following link: <a href="https://learn.microsoft.com/en-us/dotnet/api/system.collections.frozen"><span class="url">https://learn.microsoft.com/en-us/dotnet/api/system.collections.frozen</span></a>.</p>
    </div>
    <p class="normal">You’ve seen that <a id="_idIndexMarker1364"/>you<a id="_idIndexMarker1365"/> can create read-only lists<a id="_idIndexMarker1366"/> and dictionaries, but what about sets? In .NET 9, there is now a <code class="inlineCode">ReadOnlySet&lt;T&gt;</code> to address this.</p>
    <h2 id="_idParaDest-538" class="heading-2">Initializing collections using collection expressions</h2>
    <p class="normal">Introduced<a id="_idIndexMarker1367"/> with C# 12 is a new consistent syntax for initializing arrays, collections, and span variables.</p>
    <p class="normal">With C# 11 and earlier, you would have to declare and initialize an array, collection, or span of <code class="inlineCode">int</code> values using the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-built_in">int</span>[] numbersArray11 = { <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span> };
List&lt;<span class="hljs-built_in">int</span>&gt; numbersList11 = <span class="hljs-keyword">new</span>() { <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span> };
Span&lt;<span class="hljs-built_in">int</span>&gt; numbersSpan11 = <span class="hljs-keyword">stackalloc</span> <span class="hljs-built_in">int</span>[] { <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span> };
</code></pre>
    <p class="normal">Starting with C# 12, you can now consistently use square brackets, and the compiler will do the right thing, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-built_in">int</span>[] numbersArray12 = [ <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span> ];
List&lt;<span class="hljs-built_in">int</span>&gt; numbersList12 = [ <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span> ];
Span&lt;<span class="hljs-built_in">int</span>&gt; numbersSpan12 = [ <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span> ];
</code></pre>
    <div class="note">
      <p class="normal"><strong class="keyWord">More information</strong>: You can learn more about collection expressions at the following link: <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/proposals/csharp-12.0/collection-expressions"><span class="url">https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/proposals/csharp-12.0/collection-expressions</span></a>.</p>
    </div>
    <p class="normal">Collection expressions do not work with all collections. For example, they do not work with dictionaries or multidimensional arrays. The documentation lists the types that a<a id="_idIndexMarker1368"/> collection expression can be converted to: <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/proposals/csharp-12.0/collection-expressions#conversions"><span class="url">https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/proposals/csharp-12.0/collection-expressions#conversions</span></a>.</p>
    <h2 id="_idParaDest-539" class="heading-2">Using the spread element</h2>
    <p class="normal">The <strong class="keyWord">spread element</strong> <code class="inlineCode">..</code> can <a id="_idIndexMarker1369"/>be prefixed before any<a id="_idIndexMarker1370"/> expression that can be enumerated to evaluate it in a collection expression. For example, any type that can be enumerated using <code class="inlineCode">foreach</code>, like an array or collection, can be evaluated using the spread element.</p>
    <p class="normal">The use of the spread element <code class="inlineCode">..</code> in a collection expression replaces its argument with the elements from that collection. You can combine spread elements with individual elements in a collection expression.</p>
    <div class="note">
      <p class="normal">Microsoft official documentation uses both the <strong class="keyWord">spread element</strong> and <strong class="keyWord">spread operator</strong> to <a id="_idIndexMarker1371"/>refer to the same language feature. I prefer the element because it is used in collection expressions to represent an element within the defined collection.</p>
    </div>
    <p class="normal">Let’s see an example of using the spread element, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">int[] row0 <span class="hljs-punctuation">=</span> [<span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span> <span class="hljs-number">3</span>]<span class="hljs-punctuation">;</span>
int[] row1 <span class="hljs-punctuation">=</span> [<span class="hljs-number">4</span><span class="hljs-punctuation">,</span> <span class="hljs-number">5</span>]<span class="hljs-punctuation">;</span>
int[] row2 <span class="hljs-punctuation">=</span> [<span class="hljs-number">6</span><span class="hljs-punctuation">,</span> <span class="hljs-number">7</span><span class="hljs-punctuation">,</span> <span class="hljs-number">8</span><span class="hljs-punctuation">,</span> <span class="hljs-number">9</span>]<span class="hljs-punctuation">;</span>
<span class="hljs-comment">// Use the spread element to combine the three arrays and an integer into a single array.</span>
int[] combinedRows <span class="hljs-punctuation">=</span> [..row0<span class="hljs-punctuation">,</span> ..row1<span class="hljs-punctuation">,</span> ..row2<span class="hljs-punctuation">,</span> <span class="hljs-number">10</span>]<span class="hljs-punctuation">;</span>
foreach <span class="hljs-punctuation">(</span>int number in combinedRows<span class="hljs-punctuation">)</span>
{
  Console.Write<span class="hljs-punctuation">(</span>$<span class="hljs-string">"</span><span class="hljs-string">{number}, "</span><span class="hljs-punctuation">);</span>
}
</code></pre>
    <p class="normal">The output would be:</p>
    <pre class="programlisting con"><code class="hljs-con">1, 2, 3, 4, 5, 6, 7, 8, 9, 10,
</code></pre>
    <div class="note">
      <p class="normal"><strong class="keyWord">More information</strong>: You can learn more about the spread element at the following link: <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/operators/collection-expressions#spread-element"><span class="url">https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/operators/collection-expressions#spread-element</span></a>.</p>
    </div>
    <div class="packt_tip">
      <p class="normal"><strong class="keyWord">Warning!</strong> Be careful not to confuse the spread element <code class="inlineCode">..</code> that must be applied before an <a id="_idIndexMarker1372"/>enumerable expression, with the range operator <code class="inlineCode">..</code> that is used to define a <code class="inlineCode">Range</code>. You<a id="_idIndexMarker1373"/> will learn about ranges in the next major section in this chapter, <em class="italic">Working with spans, indexes, and ranges</em>. There is a discussion about the design decision around the spread element at the following link: <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/proposals/csharp-12.0/collection-expressions#drawbacks"><span class="url">https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/proposals/csharp-12.0/collection-expressions#drawbacks</span></a>.</p>
    </div>
    <h2 id="_idParaDest-540" class="heading-2">Good practice with collections</h2>
    <p class="normal">Let’s end this section about collections by reviewing some good practices that you should follow when working with collections.</p>
    <h3 id="_idParaDest-541" class="heading-3">Presizing collections</h3>
    <p class="normal">Since .NET 1.1, types<a id="_idIndexMarker1374"/> like <code class="inlineCode">StringBuilder</code> have had a method named <code class="inlineCode">EnsureCapacity</code> that can presize its internal storage array to the expected final size of the <code class="inlineCode">string</code>. This improves performance because it does not have to repeatedly increment the size of the array as more characters are appended.</p>
    <p class="normal">Since .NET Core 2.1, types like <code class="inlineCode">Dictionary&lt;T&gt;</code> and <code class="inlineCode">HashSet&lt;T&gt;</code> have also had <code class="inlineCode">EnsureCapacity</code>.</p>
    <p class="normal">In .NET 6 and later, collections like <code class="inlineCode">List&lt;T&gt;</code>, <code class="inlineCode">Queue&lt;T&gt;</code>, and <code class="inlineCode">Stack&lt;T&gt;</code> now have an <code class="inlineCode">EnsureCapacity</code> method<a id="_idIndexMarker1375"/> too, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">List&lt;<span class="hljs-built_in">string</span>&gt; names = <span class="hljs-keyword">new</span>();
names.EnsureCapacity(<span class="hljs-number">10</span>_000);
<span class="hljs-comment">// Load ten thousand names into the list.</span>
</code></pre>
    <h3 id="_idParaDest-542" class="heading-3">Passing collections to methods</h3>
    <p class="normal">Let’s say you <a id="_idIndexMarker1376"/>need to create a method to process a collection. For maximum flexibility, you could declare the input parameter to be <code class="inlineCode">IEnumerable&lt;T&gt;</code> and make the method generic, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">ProcessCollection</span><span class="hljs-function">&lt;</span><span class="hljs-title">T</span><span class="hljs-function">&gt;(</span><span class="hljs-params">IEnumerable&lt;T&gt; collection</span><span class="hljs-function">)</span>
{
  <span class="hljs-comment">// Process the items in the collection,</span>
  <span class="hljs-comment">// perhaps using a foreach statement.</span>
}
</code></pre>
    <p class="normal">I could pass an array, a list, a queue, or a stack, containing any type, like <code class="inlineCode">int</code>, <code class="inlineCode">string</code>, <code class="inlineCode">Person</code>, or anything else that implements <code class="inlineCode">IEnumerable&lt;T&gt;</code>, into this method and it will process the items. However, the flexibility to pass any collection to this method comes at a performance cost.</p>
    <p class="normal">One of the performance problems with <code class="inlineCode">IEnumerable&lt;T&gt;</code> is also one of its benefits: deferred execution, also known as lazy loading. Types that implement this interface do not have to implement deferred execution, but many do.</p>
    <p class="normal">But the worst performance problem with <code class="inlineCode">IEnumerable&lt;T&gt;</code> is that the iteration must allocate an object on the heap. To avoid this memory allocation, you should define your method using a concrete type, as shown highlighted in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">ProcessCollection</span><span class="hljs-function">&lt;</span><span class="hljs-title">T</span><span class="hljs-function">&gt;(</span><span class="code-highlight"><strong class="hljs-params-slc">List&lt;T&gt;</strong></span><span class="hljs-params"> collection</span><span class="hljs-function">)</span>
{
  <span class="hljs-comment">// Process the items in the collection,</span>
  <span class="hljs-comment">// perhaps using a foreach statement.</span>
}
</code></pre>
    <p class="normal">This will use the <code class="inlineCode">List&lt;T&gt;.Enumerator GetEnumerator()</code> method, which returns a <code class="inlineCode">struct</code>, instead of the <code class="inlineCode">IEnumerator&lt;T&gt; GetEnumerator()</code> method, which returns a reference type. Your code will be two to three times faster and require less memory. As with all recommendations related to performance, you should confirm the <a id="_idIndexMarker1377"/>benefit by running performance tests on your actual code in a product environment.</p>
    <h3 id="_idParaDest-543" class="heading-3">Returning collections from members</h3>
    <p class="normal">Collections are <a id="_idIndexMarker1378"/>reference types, which means they can be <code class="inlineCode">null</code>. You might define methods or properties that return <code class="inlineCode">null</code>, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">public class Vehicle
{
  public List&lt;Person&gt;? GetPassengers<span class="hljs-punctuation">()</span>
  {
    ICollection&lt;Person&gt; passengers <span class="hljs-punctuation">=</span> GetFromDatabase<span class="hljs-punctuation">();</span>
    if <span class="hljs-punctuation">(</span>passengers.Count &gt; <span class="hljs-number">0</span><span class="hljs-punctuation">)</span>
    {
      return passengers<span class="hljs-punctuation">;</span>
    }
    else
    {
      return <span class="hljs-literal">null</span><span class="hljs-punctuation">;</span>
    }
  }
  public List&lt;Person&gt;? Passengers
  {
    get
    {
      ICollection&lt;Person&gt; passengers <span class="hljs-punctuation">=</span> GetFromDatabase<span class="hljs-punctuation">();</span>
      if <span class="hljs-punctuation">(</span>passengers.Count &gt; <span class="hljs-number">0</span><span class="hljs-punctuation">)</span>
      {
        return passengers<span class="hljs-punctuation">;</span>
      }
      else
      {
        return <span class="hljs-literal">null</span><span class="hljs-punctuation">;</span>
      }
    }
  }
}
</code></pre>
    <p class="normal">This can cause issues if a developer calls your methods and properties that return a collection without checking for <code class="inlineCode">null</code>, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">var people <span class="hljs-punctuation">=</span> car.GetPassengers<span class="hljs-punctuation">();</span>
<span class="hljs-comment">// Accessing people could throw a NullReferenceException!</span>
WriteLine<span class="hljs-punctuation">(</span>$<span class="hljs-string">"There are {people.Count} people."</span><span class="hljs-punctuation">);</span>
foreach <span class="hljs-punctuation">(</span>Person p in car.Passengers<span class="hljs-punctuation">)</span>
{
  <span class="hljs-comment">// Process each person.</span>
}
</code></pre>
    <p class="normal">In your implementations of methods and properties that return collections, return an empty <a id="_idIndexMarker1379"/>collection or array instead of <code class="inlineCode">null</code>, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// Return an empty sequence instead.</span>
return Enumerable.Empty&lt;Person&gt;<span class="hljs-punctuation">();</span>
<span class="hljs-comment">// Or an empty array.</span>
return Array<span class="hljs-punctuation">,</span>Empty&lt;Person&gt;<span class="hljs-punctuation">();</span>
<span class="hljs-comment">// Or an empty collection expression.</span>
return []<span class="hljs-punctuation">;</span>
</code></pre>
    <h1 id="_idParaDest-544" class="heading-1">Working with spans, indexes, and ranges</h1>
    <p class="normal">One of Microsoft’s goals with .NET Core 2.1 was to improve performance and resource usage. A key .NET feature that enables this is the <code class="inlineCode">Span&lt;T&gt;</code> type.</p>
    <h2 id="_idParaDest-545" class="heading-2">Using memory efficiently using spans</h2>
    <p class="normal">When manipulating <a id="_idIndexMarker1380"/>arrays, you will often create new copies or subsets of existing ones so that you can process just the subset. This is not efficient because duplicate objects must be created in memory.</p>
    <p class="normal">If you need to work with a subset of an array, use a <strong class="keyWord">span</strong> because it is like a window into the original array. This is more efficient in terms of memory usage and improves performance. Spans only work with arrays, not collections, because the memory must be contiguous.</p>
    <p class="normal">Before we look at spans in more detail, we need to understand some related objects: indexes and ranges.</p>
    <h2 id="_idParaDest-546" class="heading-2">Identifying positions with the Index type</h2>
    <p class="normal">C# 8 introduced<a id="_idIndexMarker1381"/> two features for identifying an item’s index position within an array and a range of items using two indexes.</p>
    <p class="normal">You learned in the previous section that objects in a list can be accessed by passing an integer into their indexer, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-built_in">int</span> index = <span class="hljs-number">3</span>;
Person p = people[index]; <span class="hljs-comment">// Fourth person in array.</span>
<span class="hljs-built_in">char</span> letter = name[index]; <span class="hljs-comment">// Fourth letter in name.</span>
</code></pre>
    <p class="normal">The <code class="inlineCode">Index</code> value type is a more formal way of identifying a position, and supports counting from the end, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// Two ways to define the same index, 3 in from the start.</span>
Index i1 = <span class="hljs-keyword">new</span>(<span class="hljs-keyword">value</span>: <span class="hljs-number">3</span>); <span class="hljs-comment">// Counts from the start</span>
Index i2 = <span class="hljs-number">3</span>; <span class="hljs-comment">// Using implicit int conversion operator.</span>
<span class="hljs-comment">// Two ways to define the same index, 5 in from the end.</span>
Index i3 = <span class="hljs-keyword">new</span>(<span class="hljs-keyword">value</span>: <span class="hljs-number">5</span>, fromEnd: <span class="hljs-literal">true</span>);
Index i4 = ^<span class="hljs-number">5</span>; <span class="hljs-comment">// Using the caret ^ operator.</span>
</code></pre>
    <h2 id="_idParaDest-547" class="heading-2">Identifying ranges with the Range type</h2>
    <p class="normal">The <code class="inlineCode">Range</code> value <a id="_idIndexMarker1382"/>type uses <code class="inlineCode">Index</code> values to indicate the start and end of its range, using its constructor, C# syntax, or its static methods, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">Range r1 = <span class="hljs-keyword">new</span>(start: <span class="hljs-keyword">new</span> Index(<span class="hljs-number">3</span>), end: <span class="hljs-keyword">new</span> Index(<span class="hljs-number">7</span>));
Range r2 = <span class="hljs-keyword">new</span>(start: <span class="hljs-number">3</span>, end: <span class="hljs-number">7</span>); <span class="hljs-comment">// Using implicit int conversion.</span>
Range r3 = <span class="hljs-number">3..7</span>; <span class="hljs-comment">// Using C# 8.0 or later syntax.</span>
Range r4 = Range.StartAt(<span class="hljs-number">3</span>); <span class="hljs-comment">// From index 3 to last index.</span>
Range r5 = <span class="hljs-number">3.</span>.; <span class="hljs-comment">// From index 3 to last index.</span>
Range r6 = Range.EndAt(<span class="hljs-number">3</span>); <span class="hljs-comment">// From index 0 to index 3.</span>
Range r7 = .<span class="hljs-number">.3</span>; <span class="hljs-comment">// From index 0 to index 3.</span>
</code></pre>
    <p class="normal">Extension methods have been added to <code class="inlineCode">string</code> values (which internally use an array of <code class="inlineCode">char</code>), <code class="inlineCode">int</code> arrays, and spans to make ranges easier to work with. These extension methods accept a range as a parameter and return a <code class="inlineCode">Span&lt;T&gt;</code>. This makes them very memory-efficient.</p>
    <div class="packt_tip">
      <p class="normal"><strong class="keyWord">Warning!</strong> The range operator <code class="inlineCode">..</code> (introduced with C# 8) and the spread element <code class="inlineCode">..</code> (introduced with C# 12) look identical. Be careful to differentiate them when reading code. The range operator should always appear next to an integer, either<a id="_idIndexMarker1383"/> before, after, or both. The spread element should always appear before a named variable that is enumerable.</p>
    </div>
    <h2 id="_idParaDest-548" class="heading-2">Using indexes, ranges, and spans</h2>
    <p class="normal">Let’s explore <a id="_idIndexMarker1384"/>using<a id="_idIndexMarker1385"/> indexes <a id="_idIndexMarker1386"/>and ranges to return spans:</p>
    <ol>
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code> project named <code class="inlineCode">WorkingWithRanges</code> to the <code class="inlineCode">Chapter08</code> solution.</li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete the existing statements and then add statements to compare using the <code class="inlineCode">string</code> type’s <code class="inlineCode">Substring</code> method with ranges to extract parts of someone’s name, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-built_in">string</span> name = <span class="hljs-string">"</span><span class="hljs-string">Samantha Jones"</span>;
<span class="hljs-comment">// Getting the lengths of the first and last names.</span>
<span class="hljs-built_in">int</span> lengthOfFirst = name.IndexOf(<span class="hljs-string">' '</span>);
<span class="hljs-built_in">int</span> lengthOfLast = name.Length - lengthOfFirst - <span class="hljs-number">1</span>;
<span class="hljs-comment">// Using Substring.</span>
<span class="hljs-built_in">string</span> firstName = name.Substring(
  startIndex: <span class="hljs-number">0</span>,
  length: lengthOfFirst);
<span class="hljs-built_in">string</span> lastName = name.Substring(
  startIndex: name.Length - lengthOfLast,
  length: lengthOfLast);
WriteLine(<span class="hljs-string">$"First: </span><span class="hljs-subst">{firstName}</span><span class="hljs-string">, Last: </span><span class="hljs-subst">{lastName}</span><span class="hljs-string">"</span>);
<span class="hljs-comment">// Using spans.</span>
ReadOnlySpan&lt;<span class="hljs-built_in">char</span>&gt; nameAsSpan = name.AsSpan();
ReadOnlySpan&lt;<span class="hljs-built_in">char</span>&gt; firstNameSpan = nameAsSpan[<span class="hljs-number">0.</span>.lengthOfFirst];
ReadOnlySpan&lt;<span class="hljs-built_in">char</span>&gt; lastNameSpan = nameAsSpan[^lengthOfLast..];
WriteLine(<span class="hljs-string">$"First: </span><span class="hljs-subst">{firstNameSpan}</span><span class="hljs-string">, Last: </span><span class="hljs-subst">{lastNameSpan}</span><span class="hljs-string">"</span>);
</code></pre>
      </li>
      <li class="numberedList">Run <a id="_idIndexMarker1387"/>the <a id="_idIndexMarker1388"/>code and view the result, as shown<a id="_idIndexMarker1389"/> in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">First: Samantha, Last: Jones
First: Samantha, Last: Jones
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-549" class="heading-2">Using spans for efficient text handling</h2>
    <p class="normal">One of the common<a id="_idIndexMarker1390"/> problems with working with text is that copies of <code class="inlineCode">string</code> values are often allocated in memory during processing. It would be more efficient to reuse the original values when possible.</p>
    <p class="normal">Spans enable this by creating data structures that point to the original parts of a string.</p>
    <p class="normal">For example, consider a <code class="inlineCode">string</code> value containing integers separated by addition symbols that need to be summed up:</p>
    <p class="normal">With .NET 9 and later, we can now create a span over the <code class="inlineCode">string</code> value, and then use ranges to efficiently divide the integer values and pass them to the <code class="inlineCode">int.Parse</code> method, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">ReadOnlySpan&lt;char&gt; text <span class="hljs-punctuation">=</span> <span class="hljs-string">"12+23+456"</span>.AsSpan<span class="hljs-punctuation">();</span>
int sum <span class="hljs-punctuation">=</span> <span class="hljs-number">0</span><span class="hljs-punctuation">;</span>
foreach <span class="hljs-punctuation">(</span>Range r in text.Split<span class="hljs-punctuation">(</span>'+'<span class="hljs-punctuation">))</span>
{
  sum <span class="hljs-punctuation">+=</span> int.Parse<span class="hljs-punctuation">(</span>text[r]<span class="hljs-punctuation">);</span>
}
WriteLine<span class="hljs-punctuation">(</span>$<span class="hljs-string">"Sum using Split: {sum}"</span><span class="hljs-punctuation">);</span>
</code></pre>
    <p class="normal">If you set a breakpoint in the loop, then note the range object named <code class="inlineCode">r</code> is first <code class="inlineCode">[0..2]</code>, as shown in <em class="italic">Figure 8.6</em>, then <code class="inlineCode">{3..5}</code>, and finally <code class="inlineCode">{6..9}</code>:</p>
    <figure class="mediaobject"><img src="../Images/B22322_08_06.png" alt="" width="878" height="270"/></figure>
    <p class="packt_figref">Figure 8.6: A span and range used to split a string efficiently</p>
    <p class="normal">The range values<a id="_idIndexMarker1391"/> efficiently define windows into the original string without allocating new memory resources.</p>
    <h1 id="_idParaDest-550" class="heading-1">Practicing and exploring</h1>
    <p class="normal">Test your knowledge and understanding by answering some questions, getting some hands-on practice, and exploring, with deeper research into the topics in this chapter.</p>
    <h2 id="_idParaDest-551" class="heading-2">Exercise 8.1 – online material</h2>
    <p class="normal">Online material could be created by Microsoft or third parties, or extra content for this book.</p>
    <h3 id="_idParaDest-552" class="heading-3">Working with network resources</h3>
    <p class="normal">If you are interested in some low-level types for working with network resources, then you can read an online-only section found at the following link:</p>
    <p class="normal"><a href="https://github.com/markjprice/cs13net9/blob/main/docs/ch08-network-resources.md"><span class="url">https://github.com/markjprice/cs13net9/blob/main/docs/ch08-network-resources.md</span></a></p>
    <p class="normal">There is a useful online book about networking with .NET by Chris Woodruff called <em class="italic">Beyond Boundaries – Networking Programming with C# 12 and .NET 8</em>, which you can find at the following link: <a href="https://csharp-networking.com"><span class="url">https://csharp-networking.com</span></a>.</p>
    <h3 id="_idParaDest-553" class="heading-3">Collection expressions</h3>
    <p class="normal">You can learn more about how to refactor existing code to make the most of collection expressions at the following link:</p>
    <p class="normal"><a href="https://devblogs.microsoft.com/dotnet/refactor-your-code-with-collection-expressions/"><span class="url">https://devblogs.microsoft.com/dotnet/refactor-your-code-with-collection-expressions/</span></a></p>
    <h2 id="_idParaDest-554" class="heading-2">Exercise 8.2 – practice exercises</h2>
    <p class="normal">Practice exercises go deeper into the topics for this chapter.</p>
    <h3 id="_idParaDest-555" class="heading-3">Regular expressions</h3>
    <p class="normal">In the <code class="inlineCode">Chapter08</code> solution, create a console app named <code class="inlineCode">Exercise_RegularExpressions</code> that prompts the user to enter a regular expression and then prompts the user to enter some input, and compare the two for a match until the user presses <em class="italic">Esc</em>, as shown in the following output:</p>
    <pre class="programlisting con"><code class="hljs-con">The default regular expression checks for at least one digit.
Enter a regular expression (or press ENTER to use the default): ^[a-z]+$
Enter some input: apples
apples matches ^[a-z]+$? True
Press ESC to end or any key to try again.
Enter a regular expression (or press ENTER to use the default): ^[a-z]+$
Enter some input: abc123xyz
abc123xyz matches ^[a-z]+$? False
Press ESC to end or any key to try again.
</code></pre>
    <h3 id="_idParaDest-556" class="heading-3">Extension methods</h3>
    <p class="normal">In the <code class="inlineCode">Chapter08</code> solution, create a class library named <code class="inlineCode">Exercise_NumbersAsWordsLib</code> and projects to test it. It should define extension methods that extend number types such as <code class="inlineCode">BigInteger</code> and <code class="inlineCode">int</code> with a method named <code class="inlineCode">ToWords</code> that returns a <code class="inlineCode">string</code> describing the number.</p>
    <p class="normal">For example, <code class="inlineCode">18,000,000</code> would be eighteen million, and <code class="inlineCode">18,456,002,032,011,000,007</code> would be eighteen quintillion, four hundred and fifty-six quadrillion, two trillion, thirty-two billion, eleven million, and seven.</p>
    <p class="normal">You can read more about names for large numbers at the following link: <a href="https://en.wikipedia.org/wiki/Names_of_large_numbers"><span class="url">https://en.wikipedia.org/wiki/Names_of_large_numbers</span></a>.</p>
    <p class="normal">Create projects to test your class library using xUnit and as an interactive console app.</p>
    <h2 id="_idParaDest-557" class="heading-2">Exercise 8.3 – test your knowledge</h2>
    <p class="normal">Use the web to answer the following questions:</p>
    <ol>
      <li class="numberedList" value="1">What is the maximum number of characters that can be stored in a <code class="inlineCode">string</code> variable?</li>
      <li class="numberedList">When and why should you use a <code class="inlineCode">SecureString</code> type?</li>
      <li class="numberedList">When is it appropriate to use a <code class="inlineCode">StringBuilder</code> class?</li>
      <li class="numberedList">When should you use a <code class="inlineCode">LinkedList&lt;T&gt;</code> class?</li>
      <li class="numberedList">When should you use a <code class="inlineCode">SortedDictionary&lt;T&gt;</code> class rather than a <code class="inlineCode">SortedList&lt;T&gt;</code> class?</li>
      <li class="numberedList">In a regular expression, what does <code class="inlineCode">$</code> mean?</li>
      <li class="numberedList">In a regular expression, how can you represent digits?</li>
      <li class="numberedList">Why should you <em class="italic">not</em> use the official standard for email addresses to create a regular expression to validate a user’s email address?</li>
      <li class="numberedList">What characters are output when the following code runs?
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-built_in">string</span> city = <span class="hljs-string">"Aberdeen"</span>;
ReadOnlySpan&lt;<span class="hljs-built_in">char</span>&gt; citySpan = city.AsSpan()[^<span class="hljs-number">5.</span>.^<span class="hljs-number">0</span>];
WriteLine(citySpan.ToString());
</code></pre>
      </li>
      <li class="numberedList">How could you check that a web service is available before calling it?</li>
    </ol>
    <h2 id="_idParaDest-558" class="heading-2">Exercise 8.4 – explore topics</h2>
    <p class="normal">Use the following link to learn more details about the topics covered in this chapter:</p>
    <p class="normal"><a href="https://github.com/markjprice/cs13net9/blob/main/docs/book-links.md#chapter-8---working-with-common-net-types"><span class="url">https://github.com/markjprice/cs13net9/blob/main/docs/book-links.md#chapter-8---working-with-common-net-types</span></a></p>
    <h1 id="_idParaDest-559" class="heading-1">Summary</h1>
    <p class="normal">In this chapter, you explored:</p>
    <ul>
      <li class="bulletList">Choices for types to store and manipulate numbers.</li>
      <li class="bulletList">Handling text, including using regular expressions for validating input.</li>
      <li class="bulletList">Collections to use for storing multiple items.</li>
      <li class="bulletList">Working with indexes, ranges, and spans.</li>
    </ul>
    <p class="normal">In the next chapter, we will manage files and streams, encode and decode text, and perform serialization.</p>
    <h1 class="heading-1">Learn more on Discord</h1>
    <p class="normal">To join the Discord community for this book – where you can share feedback, ask questions to the author, and learn about new releases – follow the QR code below:</p>
    <p class="normal"><a href="https://packt.link/csharp13dotnet9"><span class="url">https://packt.link/csharp13dotnet9</span></a></p>
    <p class="normal"><img src="../Images/QR_Code281224304227278796.png" alt="" width="177" height="177"/></p>
    <h1 class="heading-1">Leave a Review!</h1>
    <p class="normal">Thank you for purchasing this book from Packt Publishing—we hope you enjoy it! Your feedback is invaluable and helps us improve and grow. Once you’ve completed reading it, please take a moment to leave an Amazon review; it will only take a minute, but it makes a big difference for readers like you.</p>
    <p class="normal">Scan the QR or visit the link to receive a free ebook of your choice.</p>
    <p class="normal"><a href="https://packt.link/NzOWQ"><span class="url">https://packt.link/NzOWQ</span></a></p>
    <p class="normal"><img src="../Images/review1.png" alt="A qr code with black squares  Description automatically generated" width="150" height="150"/></p>
  </div>
</div></div></body></html>