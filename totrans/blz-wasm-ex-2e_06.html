<html><head></head><body>
  <div><h1 class="chapterNumber">6</h1>
    <h1 id="_idParaDest-176" class="chapterTitle">Building a Weather App as a Progressive Web App (PWA)</h1>
    <p class="normal">As web developers, we develop amazing web apps of all kinds, but until recently there has been a divide between what a web app can do versus what a native app can do. A new class of apps called <strong class="keyWord">Progressive Web Apps</strong> (<strong class="keyWord">PWAs</strong>) is helping to bridge that divide by enabling us to add <a id="_idIndexMarker409"/>native-like capabilities, reliability, and installability to our web apps. A PWA is a web application that takes advantage of native app features while retaining all the features of a web app.</p>
    <p class="normal">In this chapter, we will learn what defines a PWA, as well as how to create a PWA by adding a <strong class="keyWord">manifest file</strong> and a <strong class="keyWord">service worker</strong> to an existing web application.</p>
    <p class="normal">The project that we create in this chapter will be a local 5-day weather forecast application that can be installed and run as a native application on Windows, macOS, iPhones, Android phones, and so on and can be distributed through the various app stores. We will use JavaScript’s <strong class="keyWord">Geolocation API</strong> to obtain the location of the device and the <strong class="keyWord">OpenWeather One Call API</strong> to fetch the weather forecast for that location. We will convert the application into a PWA by adding a manifest file and a service worker. The service worker will use the <strong class="keyWord">CacheStorage API</strong> to cache information so that the PWA can work offline.</p>
    <blockquote class="packt_quote">
      <p class="quote"> Native app, am I?</p>
      <p class="quote">Web application, am I?</p>
      <p class="quote">PWA!</p>
    </blockquote>
    <p class="normal">In this chapter, we will cover the following topics:</p>
    <ul>
      <li class="bulletList">Understanding PWAs</li>
      <li class="bulletList">Working with manifest files</li>
      <li class="bulletList">Working with service workers</li>
      <li class="bulletList">Using the <code class="inlineCode">CacheStorage</code> API</li>
      <li class="bulletList">Using the <code class="inlineCode">Geolocation</code> API</li>
      <li class="bulletList">Using the <code class="inlineCode">OpenWeather One Call</code> API</li>
      <li class="bulletList">Creating a PWA</li>
    </ul>
    <h1 id="_idParaDest-177" class="heading-1">Technical requirements</h1>
    <p class="normal">To complete this project, you need to have Visual Studio 2022 installed on your PC. For instructions on how to install the free Community Edition of Visual Studio 2022, refer to <em class="chapterRef">Chapter 1</em>, <em class="italic">Introduction to Blazor WebAssembly</em>.</p>
    <p class="normal">We will be using an external weather API to access the weather forecast data for our project. The API that we will be using is the <code class="inlineCode">OpenWeather One Call</code> API. This is a free API that is provided by <code class="inlineCode">OpenWeather</code> (<a href="https://openweathermap.org">https://openweathermap.org</a>). To get started with this API, you need to create an account and obtain an API key. If you do not want to create an account, you can use the <code class="inlineCode">weather.json</code> file that we have provided in the GitHub repository for this chapter.</p>
    <p class="normal">The source code for this chapter is available in the following GitHub repository: <a href="https://github.com/PacktPublishing/Blazor-WebAssembly-by-Example-Second-Edition/tree/main/Chapter06">https://github.com/PacktPublishing/Blazor-WebAssembly-by-Example-Second-Edition/tree/main/Chapter06</a>.</p>
    <p class="normal">The Code in Action video is available here: <a href="https://packt.link/Ch6">https://packt.link/Ch6</a>.</p>
    <h1 id="_idParaDest-178" class="heading-1">Understanding PWAs</h1>
    <p class="normal">A PWA is a web application <a id="_idIndexMarker410"/>that uses modern web capabilities to deliver a native app-like experience to users. PWAs look and feel like native applications because they run in their own app window instead of the browser’s window, and they can be launched from the <strong class="screenText">Start</strong> menu or taskbar. PWAs offer an offline experience and load instantly due to their use of caching. They can receive push notifications and are automatically updated in the background. Finally, although they do not require a listing in an app store for distribution, they can be distributed through the various app stores.</p>
    <p class="normal">Many large companies, such as Pinterest, Starbucks, Trivago, and Twitter, have embraced PWAs. Companies are drawn to PWAs because they can develop them once and use them everywhere.</p>
    <p class="normal">A PWA feels like a <a id="_idIndexMarker411"/>native application due to a combination of technologies. To convert a web app into a PWA, it must use HTTPS and include both a manifest file and a service worker.</p>
    <h2 id="_idParaDest-179" class="heading-2">HTTPS</h2>
    <p class="normal">To be converted into <a id="_idIndexMarker412"/>a PWA, the web app must use HTTPS and <a id="_idIndexMarker413"/>must be served over a secure network. This should not be a problem since most browsers will no longer serve pages over HTTP. Therefore, even if you are not planning to convert a Blazor WebAssembly app into a PWA, you should always be using HTTPS.</p>
    <div><p class="normal"><strong class="keyWord">TIP</strong></p>
      <p class="normal">A <strong class="keyWord">Secure Sockets Layer</strong> (<strong class="keyWord">SSL</strong>) certificate is required to enable HTTPS. A great source <a id="_idIndexMarker414"/>for free SSL certificates is <strong class="keyWord">Let’s Encrypt</strong> (<a href="https://letsencrypt.org">https://letsencrypt.org</a>). It is <a id="_idIndexMarker415"/>a free, automated, and open <strong class="keyWord">Certificate Authority</strong> (<strong class="keyWord">CA</strong>).</p>
    </div>
    <h2 id="_idParaDest-180" class="heading-2">Manifest files</h2>
    <p class="normal">A manifest file is a <a id="_idIndexMarker416"/>simple <strong class="keyWord">JavaScript Object Notation</strong> (<strong class="keyWord">JSON</strong>) document <a id="_idIndexMarker417"/>that contains an application’s name, defaults, and <a id="_idIndexMarker418"/>startup parameters for when a web application is launched. It describes how an application looks and feels.</p>
    <p class="normal">This is an example of a simple manifest file:</p>
    <pre class="programlisting code"><code class="hljs-code">{
  "name": "My Sample PWA",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#03173d",
  "icons": [
    {
      "src": "icon-512.png",
      "type": "image/png",
      "sizes": "512x512"
    }
  ]
}
</code></pre>
    <p class="normal">A manifest file must <a id="_idIndexMarker419"/>include the name of the application <a id="_idIndexMarker420"/>and at least one icon. We will look more closely at manifest files in the next section.</p>
    <h2 id="_idParaDest-181" class="heading-2">Service workers</h2>
    <p class="normal">A service worker is a JavaScript <a id="_idIndexMarker421"/>file that defines the offline experience <a id="_idIndexMarker422"/>for the PWA. It intercepts and controls how a web browser handles its network requests and asset caching.</p>
    <p class="normal">This is the content of the <code class="inlineCode">service-worker.js</code> file that is included in the <code class="inlineCode">Blazor WebAssembly PWA</code> project template provided by Microsoft:</p>
    <pre class="programlisting code"><code class="hljs-code">self.addEventListener('fetch', () =&gt; { });
</code></pre>
    <p class="normal">It is only one line of code and—as you can see—it does not actually do anything. However, it counts as a service worker and is all that is technically needed to convert an application into a PWA. We will take a closer look at more robust service workers later in this chapter.</p>
    <p class="normal">A PWA is a web app that can be installed on a device like a native application. If a web app uses HTTPS and includes both a manifest file and a service worker, it can be converted into a PWA. Let’s take a closer look at manifest files.</p>
    <h1 id="_idParaDest-182" class="heading-1">Working with manifest files</h1>
    <pre>manifest.json</code> to the <code class="inlineCode">index.html</code> file:</pre>
    <pre class="programlisting code"><code class="hljs-code">&lt;link href="manifest.json" rel="manifest" /&gt;
</code></pre>
    <p class="normal">Here is a more robust manifest file that includes more fields than the previous example:</p>
    <p class="normal"><strong class="keyWord">manifest.json</strong></p>
    <pre class="programlisting code"><code class="hljs-code">{
  "dir": "ltr",
  "lang": "en",
  "name": " 5-Day Weather Forecast",
  "short_name": "Weather",
  "scope": "/",
  "display": "standalone",
  "start_url": "./",
  "background_color": "transparent",
  "theme_color": "transparent",
  "description": "This is a 5-day weather forecast.",
  "orientation": "any",
  "related_applications": [],
  "prefer_related_applications": false,
  "icons": [
    {
      "src": "icon-512.png",
      "type": "image/png",
      "sizes": "512x512"
    }
  ],
  "url": "https://bweweather.azurewebsites.net",
  "screenshots": [],
"categories": ["weather"]
}
</code></pre>
    <p class="normal">As mentioned earlier, a <a id="_idIndexMarker424"/>manifest file must include the name of the application and at least one icon. Beyond that, everything else is optional, although we highly recommend that you include at least the <code class="inlineCode">description</code>, <code class="inlineCode">short_name</code>, and <code class="inlineCode">start_url</code> in your manifest files.</p>
    <p class="normal">These are the keys used in the preceding <code class="inlineCode">manifest.json</code> file:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">dir</code>: The base direction of <code class="inlineCode">name</code>, <code class="inlineCode">short_name</code>, and <code class="inlineCode">description</code>. It is either <code class="inlineCode">ltr</code>, <code class="inlineCode">rtl</code>, or <code class="inlineCode">auto</code>.</li>
      <li class="bulletList"><code class="inlineCode">lang</code>: The primary language of <code class="inlineCode">name</code>, <code class="inlineCode">short_name</code>, and <code class="inlineCode">description</code>.</li>
      <li class="bulletList"><code class="inlineCode">name</code>: The name of the app. The maximum length is 45 characters.</li>
      <li class="bulletList"><code class="inlineCode">short_name</code>: The short name of the app. The maximum length is 12 characters.</li>
      <li class="bulletList"><code class="inlineCode">scope</code>: The navigation scope of the app.</li>
      <li class="bulletList"><code class="inlineCode">display</code>: The way the app is displayed. The valid options are <code class="inlineCode">fullscreen</code>, <code class="inlineCode">standalone</code>, <code class="inlineCode">minimal-UI</code>, or <code class="inlineCode">browser</code>.</li>
      <li class="bulletList"><code class="inlineCode">start_url</code>: The <strong class="keyWord">Uniform Resource Locator</strong> (<strong class="keyWord">URL</strong>) of the app.</li>
      <li class="bulletList"><code class="inlineCode">background_color</code>: The color <a id="_idIndexMarker425"/>used for the app’s background during installation on the splash screen.</li>
      <li class="bulletList"><code class="inlineCode">theme_color</code>: The default theme color.</li>
      <li class="bulletList"><code class="inlineCode">description</code>: A short description of the app.</li>
      <li class="bulletList"><code class="inlineCode">orientation</code>: The default screen orientation. Some of the options are <code class="inlineCode">any</code>, <code class="inlineCode">natural</code>, <code class="inlineCode">landscape</code>, and <code class="inlineCode">portrait</code>.</li>
      <li class="bulletList"><code class="inlineCode">related_applications</code>: Any related apps that the developer wishes to highlight. These are usually native apps.</li>
      <li class="bulletList"><code class="inlineCode">prefer_related_applications</code>: A value notifying the user agent that the related application is preferred over a web app.</li>
      <li class="bulletList"><code class="inlineCode">icons</code>: One or more images used by the app. This is usually the largest section of the file because many devices prefer images of different sizes.</li>
      <li class="bulletList"><code class="inlineCode">url</code>: The address of the app.</li>
      <li class="bulletList"><code class="inlineCode">screenshots</code>: An array of images of the app in action.</li>
      <li class="bulletList"><code class="inlineCode">categories</code>: An array of strings representing the categories that the app belongs to.</li>
    </ul>
    <p class="normal">The preceding list does not <a id="_idIndexMarker426"/>include all the keys that can be included in a <code class="inlineCode">manifest.json</code> file. Also, more keys are still being added every year.</p>
    <p class="normal">A manifest file controls how the PWA appears to the user and is required to convert a web app into a PWA. A service worker is also required to convert a web app into a PWA. Let’s take a closer look at service workers.</p>
    <h1 id="_idParaDest-183" class="heading-1">Working with service workers</h1>
    <p class="normal">Service workers <a id="_idIndexMarker427"/>provide the magic behind PWAs. They are used for caching, background syncing, and push notifications. A service worker is a JavaScript file that intercepts and modifies navigation and resource requests. It gives us full control over which resources are cached and how our PWA behaves in different situations.</p>
    <p class="normal">A service worker is <a id="_idIndexMarker428"/>simply a script that your browser runs in the background. It is separate from the app and has no <strong class="keyWord">Document Object Model</strong> (<strong class="keyWord">DOM</strong>) access. It runs on a different thread than the thread used by the main JavaScript that <a id="_idIndexMarker429"/>powers your app, so it is not blocking. It is designed to be fully asynchronous.</p>
    <h2 id="_idParaDest-184" class="heading-2">Service worker life cycle</h2>
    <p class="normal">When working with service workers, it is very important to understand their life cycle because offline support can add a significant amount of complexity to the web app. There are three steps in the life cycle of a service worker—<strong class="screenText">install, activate, and </strong><strong class="screenText">fetch</strong>, as illustrated in the following diagram:</p>
    <figure class="mediaobject"><img src="img/B18471_06_01.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.1: Service worker life cycle</p>
    <h3 id="_idParaDest-185" class="heading-3">Install</h3>
    <p class="normal">During the install step, the <a id="_idIndexMarker430"/>service worker usually caches some of the static assets of the website, such as a <code class="inlineCode">You are offline</code> splash screen. If the files are cached successfully, the service worker is installed. However, if any of the files fail to download and cache, the service worker is not installed and does not move to the activate step.</p>
    <p class="normal">If the service worker is not successfully installed, it will try to be installed the next time the web app is run. Therefore, the developer can be assured that if the service worker has been successfully installed, the cache contains all the static assets that were designated to be cached. After the install step is successfully completed, the activate step is initiated.</p>
    <h3 id="_idParaDest-186" class="heading-3">Activate</h3>
    <p class="normal">During the activate step, the <a id="_idIndexMarker431"/>service worker handles the management of the old caches. Since a previous installation may have created a cache, this is the app’s opportunity to delete it. After the activate step is successfully completed, the service worker is ready to begin processing the fetch events.</p>
    <h3 id="_idParaDest-187" class="heading-3">Fetch</h3>
    <p class="normal">During the fetch step, the service <a id="_idIndexMarker432"/>worker controls all the pages that fall under its scope. It handles all the fetch events that occur when a network request is made from the PWA. The service worker will continue to fetch until it is terminated.</p>
    <h2 id="_idParaDest-188" class="heading-2">Updating a service worker</h2>
    <p class="normal">To update the service worker that is running for our website, we need to update the service worker’s JavaScript <a id="_idIndexMarker433"/>file. Each time a user navigates to our site, the browser downloads the current service worker and compares it with the installed service worker. If they are different, it will attempt to replace the old service worker.</p>
    <p class="normal">However, this does not happen immediately. The new service worker must wait until the old service worker is no longer in control before it can be activated. The old service worker will remain in control until all the open pages are closed. When the new service worker takes control, its activate event will fire.</p>
    <p class="normal">Cache management is handled during the activate callback. The reason we manage the cache during the activate callback is that if we were to wipe out any old caches in the install step, the old service worker (which has control of all the current pages) would suddenly stop being able to serve files from that cache.</p>
    <p class="normal">The following screenshot shows a service worker that is <strong class="screenText">waiting to activate</strong>:</p>
    <figure class="mediaobject"><img src="img/B18471_06_02.png" alt="Graphical user interface, application  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.2: Service worker waiting to activate</p>
    <div><p class="normal"><strong class="keyWord">TIP</strong></p>
      <p class="normal">The service worker will not be <a id="_idIndexMarker434"/>activated until the user has navigated away from the app in all tabs. Reloading the tab will not suffice, even if the app is only running in that one tab. However, you can activate a service worker that is <strong class="screenText">waiting to activate</strong> by clicking the <strong class="screenText">skipWaiting</strong> link. The <strong class="screenText">skipWaiting</strong> link is highlighted in <em class="italic">Figure 6.2</em>.</p>
    </div>
    <h2 id="_idParaDest-189" class="heading-2">Types of service workers</h2>
    <p class="normal">There are many different <a id="_idIndexMarker435"/>types of service workers, from the ridiculously simple to the more complex. The following diagram shows some of the different types of service workers, ordered from simple to complex:</p>
    <figure class="mediaobject"><img src="img/B18471_06_03.png" alt="A screenshot of a computer  Description automatically generated with low confidence"/></figure>
    <p class="packt_figref">Figure 6.3: Types of service workers from simple to complex</p>
    <h3 id="_idParaDest-190" class="heading-3">Offline page</h3>
    <p class="normal">This is the simplest type <a id="_idIndexMarker436"/>of functioning service worker to create. All we need to create this type of service worker is an HTML page that indicates an application is offline. Whenever an application is unable to connect to a network, we simply display that HTML page.</p>
    <h3 id="_idParaDest-191" class="heading-3">Offline copy of pages</h3>
    <p class="normal">With this type of service worker, we store a copy of each page in the cache as our visitors view them. When <a id="_idIndexMarker437"/>the application is offline, it serves the pages from the cache. This approach may only work for applications with a limited number of pages because if a page that a user wants to view has not yet been viewed by that user, it will not yet be in the cache and the app will fail.</p>
    <h3 id="_idParaDest-192" class="heading-3">Offline copy with offline page</h3>
    <p class="normal">This type of service <a id="_idIndexMarker438"/>worker is an improved version of the offline copy of pages service worker. It combines the two previous types of service workers. With this type of service worker, we store a copy of each page in the cache as our visitors view them. When an application is offline, it serves the pages from the cache. If a page that a user wants to view is not in the cache, we display the HTML page that indicates the application is offline.</p>
    <h3 id="_idParaDest-193" class="heading-3">Cache-first network</h3>
    <p class="normal">This type of service worker <a id="_idIndexMarker439"/>always uses the cache first. If the requested page is in the cache, it serves that page before it requests the page from the server and updates the cache with the requested page. Using this service worker, we always <a id="_idIndexMarker440"/>serve the version of the page that is in the cache before requesting the page from the server, thus users are served the same data whether they are online or offline.</p>
    <div><p class="normal"><strong class="keyWord">IMPORTANT NOTE</strong></p>
      <p class="normal">The cache-first network service worker is the type of service worker that is preferred <a id="_idIndexMarker441"/>by Microsoft.</p>
    </div>
    <h3 id="_idParaDest-194" class="heading-3">Advanced caching</h3>
    <p class="normal">This type of service worker <a id="_idIndexMarker442"/>is a combination of each of the preceding types. With this type of service worker, we designate different files and routes to be cached using different rules. For example, some data, such as stock prices, should never be cached, while other data that does not change very often should be cached.</p>
    <h3 id="_idParaDest-195" class="heading-3">Background sync</h3>
    <p class="normal">This is the most <a id="_idIndexMarker443"/>complex type of service worker. It allows a user to continue to use an application to add and edit data when they are offline. Then, when they are back online, the application will sync their data with the network.</p>
    <p class="normal">This is not a complete list of all the different types of service workers that are available. However, it should give you an idea of the power and flexibility of service workers and the importance of caching. All the service workers on our list rely on the <code class="inlineCode">CacheStorage</code> API for caching.</p>
    <h1 id="_idParaDest-196" class="heading-1">Using the CacheStorage API</h1>
    <p class="normal">The <code class="inlineCode">CacheStorage</code> API is used to cache <code class="inlineCode">request/response</code> object pairs, where the <code class="inlineCode">request</code> objects are <a id="_idIndexMarker444"/>the keys and the <code class="inlineCode">response</code> objects are the values. It was designed to be used by service workers to provide offline functionality. A <code class="inlineCode">caches</code> object is an instance of <code class="inlineCode">CacheStorage</code>. It is a global object that is located in the <code class="inlineCode">window</code> object.</p>
    <p class="normal">We can use the following code to test if <code class="inlineCode">CacheStorage</code> is available on the browser:</p>
    <pre class="programlisting code"><code class="hljs-code">const hasCaches = 'caches' in self;
</code></pre>
    <p class="normal">A <code class="inlineCode">caches</code> object is used to maintain a list of caches for a particular web app. Caches cannot be shared <a id="_idIndexMarker445"/>with other web apps and they are isolated from the browser’s HTTP cache. They are entirely managed through the JavaScript that we write.</p>
    <p class="normal">These are some of the methods of <code class="inlineCode">CacheStorage</code>:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">delete(cacheName</code>): This method deletes the indicated cache and returns <code class="inlineCode">true</code>. If the indicated cache is <a id="_idIndexMarker446"/>not found, it returns <code class="inlineCode">false</code>.</li>
      <li class="bulletList"><code class="inlineCode">has(cacheName)</code>: This method returns <code class="inlineCode">true</code> if the indicated cache exists and <code class="inlineCode">false</code> otherwise.</li>
      <li class="bulletList"><code class="inlineCode">keys</code>: This method returns a string array of the names of all the caches.</li>
      <li class="bulletList"><code class="inlineCode">open(cacheName)</code>: This method opens the indicated cache. If it does not exist, it is created and then opened.</li>
    </ul>
    <p class="normal">When we open an instance of <code class="inlineCode">CacheStorage</code>, a <code class="inlineCode">Cache</code> object is returned. These are some of the methods of a <code class="inlineCode">Cache</code> object:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">add(request)</code>: This method takes a request and adds the resulting response to the cache.</li>
      <li class="bulletList"><code class="inlineCode">addAll(requests)</code>: This method takes an array of requests and adds all the resulting responses to the cache.</li>
      <li class="bulletList"><code class="inlineCode">delete(request)</code>: This method returns <code class="inlineCode">true</code> if it can find and delete the indicated request, and <code class="inlineCode">false</code> otherwise.</li>
      <li class="bulletList"><code class="inlineCode">keys()</code>: This method returns an array of keys.</li>
      <li class="bulletList"><code class="inlineCode">match(request</code>): This method returns the response associated with the matching request.</li>
      <li class="bulletList"><code class="inlineCode">put(request, response)</code>: This method adds the <code class="inlineCode">request</code> and <code class="inlineCode">response</code> pair to the cache.</li>
    </ul>
    <div><p class="normal"><strong class="keyWord">TIP</strong></p>
      <p class="normal">A <code class="inlineCode">Cache</code> object does not get <a id="_idIndexMarker447"/>updated unless we explicitly request it to be updated. Also, these objects do not expire. We need to delete them as they become obsolete.</p>
    </div>
    <p class="normal">Service workers <a id="_idIndexMarker448"/>use the <code class="inlineCode">CacheStorage</code> API to allow the PWA to continue to function when it is offline. Next, we will explain how to use the <strong class="keyWord">Geolocation API</strong>.</p>
    <h1 id="_idParaDest-197" class="heading-1">Using the Geolocation API</h1>
    <p class="normal">The <code class="inlineCode">Geolocation</code> API for <a id="_idIndexMarker449"/>JavaScript provides a mechanism for us to obtain the location of a user. Using the <code class="inlineCode">Geolocation</code> API, we can obtain the coordinates of a device that the browser is running on.</p>
    <p class="normal">The <code class="inlineCode">Geolocation</code> API is accessed through a <code class="inlineCode">navigator.geolocation</code> object. When we make a call to the <code class="inlineCode">navigator.geolocation</code> object, the user’s browser asks the user for permission to access their location. If they accept, the browser uses the device’s positioning <a id="_idIndexMarker450"/>hardware, such as the <strong class="keyWord">Global Positioning System</strong> (<strong class="keyWord">GPS</strong>) on a smartphone, to determine its location.</p>
    <p class="normal">Before we attempt to use the <code class="inlineCode">navigator.geolocation</code> object, we should verify that it is supported by the browser. The following code tests for the presence of geolocation support on the browser:</p>
    <pre class="programlisting code"><code class="hljs-code">if (navigator.geolocation) {
    var position = await getPositionAsync();  
} else {
    throw Error("Geolocation is not supported.");
};
</code></pre>
    <p class="normal">For the project in this chapter, we will be using the <code class="inlineCode">getCurrentPosition</code> method to retrieve the device’s location. This method uses two callback functions. The <code class="inlineCode">success</code> callback function returns a <code class="inlineCode">GeolocationPosition</code> object, while the <code class="inlineCode">error</code> callback function returns a <code class="inlineCode">GeolocationPositionError</code> object. If the user denies us access to their position, it will be reported in the <code class="inlineCode">GeolocationPositionError</code> object.</p>
    <p class="normal">These are the properties of the <code class="inlineCode">GeolocationPosition</code> object:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">coords.latitude</code>: This property <a id="_idIndexMarker451"/>returns a double that represents the latitude of the device.</li>
      <li class="bulletList"><code class="inlineCode">coords.longitude</code>: This property returns a double that represents the longitude of the device.</li>
      <li class="bulletList"><code class="inlineCode">coords.accuracy</code>: This property returns a double that represents the accuracy of the latitude and the longitude, expressed in meters.</li>
      <li class="bulletList"><code class="inlineCode">coords.altitude</code>: This property returns a double that represents the altitude of the device.</li>
      <li class="bulletList"><code class="inlineCode">coords.altitudeAccuracy</code>: This property returns a double that represents the accuracy of the altitude, expressed in meters.</li>
      <li class="bulletList"><code class="inlineCode">coords.heading</code>: This property <a id="_idIndexMarker452"/>returns a double that represents the direction in which the device is heading, expressed in degrees. If the device is stationary, the value is NaN.</li>
      <li class="bulletList"><code class="inlineCode">coords.speed</code>: This property returns a double that represents the speed of the device, expressed in meters per second.</li>
      <li class="bulletList"><code class="inlineCode">timestamp</code>: This property returns the date and time of the response.</li>
    </ul>
    <p class="normal">The <code class="inlineCode">GeolocationPosition</code> object always returns the <code class="inlineCode">coords.latitude</code>, <code class="inlineCode">coords.longitude</code>, <code class="inlineCode">coords.accuracy</code>, and <code class="inlineCode">timestamp</code> properties. The other properties are only returned if they are available.</p>
    <p class="normal">By using JavaScript’s <code class="inlineCode">Geolocation</code> API, we can determine the latitude and longitude of a device. We need <a id="_idIndexMarker453"/>this information to use the <code class="inlineCode">OpenWeather</code> <code class="inlineCode">One</code> <code class="inlineCode">Call</code> API to request a local weather forecast for our project.</p>
    <h1 id="_idParaDest-198" class="heading-1">Using the OpenWeather One Call API</h1>
    <p class="normal">The data source for <a id="_idIndexMarker454"/>the project in this chapter is a free API provided by <code class="inlineCode">OpenWeather</code>. It is called the <code class="inlineCode">OpenWeather One Call</code> API (<a href="https://openweathermap.org/api/one-call-api">https://openweathermap.org/api/one-call-api</a>). This API can return current, forecast, and historical <a id="_idIndexMarker455"/>weather data. We will be using it to access the local forecast for the next 5 days. This is the format of an API call using the <code class="inlineCode">OpenWeather One Call</code> API:</p>
    <pre class="programlisting code"><code class="hljs-code">https://api.openweathermap.org/data/2.5/onecall?lat={lat}&amp;lon={lon}&amp;appid={API key}
</code></pre>
    <p class="normal">These are the parameters for the <code class="inlineCode">OpenWeather One Call</code> API:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">lat</code>: Latitude. This parameter is required.</li>
      <li class="bulletList"><code class="inlineCode">lon</code>: Longitude. This <a id="_idIndexMarker456"/>parameter is required.</li>
      <li class="bulletList"><code class="inlineCode">appid</code>: API key. This parameter is required. After you create an account, you can manage your API keys from the <code class="inlineCode">API keys</code> tab.</li>
      <li class="bulletList"><code class="inlineCode">units</code>: Units of measurement. This is set to <code class="inlineCode">Standard</code>, <code class="inlineCode">Metric</code>, or <code class="inlineCode">Imperial</code>.</li>
      <li class="bulletList"><code class="inlineCode">exclude</code>: Excluded data. This is used to simplify data that is returned. Since we will only be using <a id="_idIndexMarker457"/>the daily forecast, we will exclude current, per minute, and hourly data, and alerts for our project. This is a comma-delimited list.</li>
      <li class="bulletList"><code class="inlineCode">lang</code>: Language of the output.</li>
    </ul>
    <p class="normal">This is a fragment <a id="_idIndexMarker458"/>of the response from the <code class="inlineCode">OpenWeather One Call</code> API:</p>
    <p class="normal"><strong class="keyWord">weather.json fragment</strong></p>
    <pre class="programlisting code"><code class="hljs-code">{
  <strong class="hljs-string-slc">"</strong><strong class="hljs-string-slc">dt"</strong><strong class="hljs-slc">: </strong><strong class="hljs-number-slc">1616436000</strong><strong class="hljs-slc">,</strong>
  "sunrise": 1616416088,
  "sunset": 1616460020,
  "temp": {
    "day": 58.5,
    <strong class="hljs-string-slc">"min"</strong><strong class="hljs-slc">: </strong><strong class="hljs-number-slc">54.75</strong><strong class="hljs-slc">,</strong>
    <strong class="hljs-string-slc">"max"</strong><strong class="hljs-slc">: </strong><strong class="hljs-number-slc">62.6</strong><strong class="hljs-slc">,</strong>
    "night": 61.29,
    "eve": 61.25,
    "morn": 54.75
  },
  "feels_like": {
    "day": 49.69,
    "night": 51.91,
    "eve": 50.67,
    "morn": 47.03
  },
  "pressure": 1011,
  "humidity": 85,
  "dew_point": 54.01,
  "wind_speed": 17.83,
  "wind_deg": 168,
  "weather": [
    {
      "id": 502,
      "main": "Rain",
      <strong class="hljs-string-slc">"description"</strong><strong class="hljs-slc">: </strong><strong class="hljs-string-slc">"heavy intensity rain"</strong><strong class="hljs-slc">,</strong>
      <strong class="hljs-string-slc">"icon"</strong><strong class="hljs-slc">: </strong><strong class="hljs-string-slc">"10d"</strong>
    }
  ],
  "clouds": 98,
  "pop": 1,
  "rain": 27.91,
  "uvi": 2.34
},
</code></pre>
    <p class="normal">In the preceding JSON fragment, we have highlighted the fields that we are using in this chapter’s project.</p>
    <div><p class="normal"><strong class="keyWord">IMPORTANT NOTE</strong></p>
      <p class="normal">This project uses version 2.5 of the <code class="inlineCode">OpenWeather One Call</code> API. They have recently released version 3.0 of the API. There is a small fee to use the new version of the API if you make over 1,000 API calls in a day.</p>
    </div>
    <p class="normal">The <code class="inlineCode">OpenWeather One Call</code> API is a simple API that we will be using to obtain the daily forecast for a given <a id="_idIndexMarker459"/>location. Now, let’s get a quick overview of the project that we are going to build in this chapter.</p>
    <h1 id="_idParaDest-199" class="heading-1">Creating a PWA</h1>
    <p class="normal">In this chapter, we <a id="_idIndexMarker460"/>will build a Blazor WebAssembly app to display a local 5-day weather forecast and then convert it into a PWA.</p>
    <p class="normal">The web app we will build uses JavaScript’s <code class="inlineCode">Geolocation</code> API to determine the current latitude and longitude of the device. It uses the <code class="inlineCode">OpenWeather One Call</code> API to obtain the local weather forecast and uses a variety of Razor components to display the weather forecast to the user. After we have completed the web app, we will convert it into a PWA by adding a logo, a manifest file, and a service worker. Finally, we will install, run, and uninstall the PWA.</p>
    <p class="normal">This is a screenshot of the completed application:</p>
    <figure class="mediaobject"><img src="img/B18471_06_04.png" alt="Graphical user interface, application  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.4: 5-Day Weather Forecast application</p>
    <p class="normal">The build time <a id="_idIndexMarker461"/>for this project is approximately 90 minutes.</p>
    <h2 id="_idParaDest-200" class="heading-2">Project overview</h2>
    <p class="normal">A <code class="inlineCode">WeatherForecast</code> project will be created by using Microsoft’s <strong class="keyWord">Blazor WebAssembly App Empty</strong> project template to create an empty Blazor WebAssembly project. First, we will use JavaScript <a id="_idIndexMarker462"/>interop with the <code class="inlineCode">Geolocation</code> API to obtain the coordinates of the device. We will then use the <code class="inlineCode">OpenWeather One Call</code> API to obtain a weather forecast for those coordinates. Next, we will create a couple of Razor components to display the forecast.</p>
    <p class="normal">To convert the web app into a PWA, we will add a logo, a manifest file, and an offline page service worker. After testing the service worker, we will install, run, and uninstall the PWA.</p>
    <h2 id="_idParaDest-201" class="heading-2">Getting started with the project</h2>
    <p class="normal">We need to <a id="_idIndexMarker463"/>create a new Blazor WebAssembly app. We do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Open Visual Studio 2022.</li>
      <li class="numberedList">Click the <strong class="screenText">Create a new project</strong> button.</li>
      <li class="numberedList">Press <em class="keystroke">Alt</em>+<em class="keystroke">S</em> to enter the <strong class="screenText">Search for templates</strong> textbox.</li>
      <li class="numberedList">Enter <code class="inlineCode">Blazor</code> and press the <em class="keystroke">Enter</em> key.
    <p class="normal">The following screenshot shows the <strong class="screenText">Blazor WebAssembly App Empty</strong> project template.</p>
    <figure class="mediaobject"><img src="img/B18471_06_05.png" alt="Graphical user interface, text, application, chat or text message  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.5: Blazor WebAssembly App Empty project template</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Select <a id="_idIndexMarker464"/>the <strong class="screenText">Blazor WebAssembly App Empty</strong> project template and click the <strong class="screenText">Next</strong> button.</li>
      <li class="numberedList">Enter <code class="inlineCode">WeatherForecast</code> in the <strong class="screenText">Project name</strong> textbox and click the <strong class="screenText">Next</strong> button.
    <p class="normal">This is a screenshot of the dialog used to configure our new project:</p>
    <figure class="mediaobject"><img src="img/B18471_06_06.png" alt="Graphical user interface, text, application, email  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.6: Configure your new project dialog</p>
    <div><p class="normal"><strong class="keyWord">TIP</strong></p>
      <p class="normal">In the preceding example, we placed the <code class="inlineCode">WeatherForecast</code> project into the <code class="inlineCode">E:/Blazor</code> folder. However, the location of this project is not important.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="7">Select <strong class="screenText">.NET 7.0</strong> as the version of the <strong class="screenText">Framework</strong> to use.</li>
      <li class="numberedList">Check the <strong class="screenText">Configure for HTTPS</strong> checkbox.</li>
      <li class="numberedList">Uncheck <a id="_idIndexMarker465"/>the <strong class="screenText">ASP.NET Core Hosted</strong> checkbox.</li>
      <li class="numberedList">Uncheck the <strong class="screenText">Progressive Web Application</strong> checkbox.
    <p class="normal">This is a screenshot of the dialog used to collect additional information about our new project:</p>
    <figure class="mediaobject"> <img src="img/B18471_06_07.png" alt="Graphical user interface, text, application, email  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.7: Additional information dialog</p>
    <div><p class="normal"><strong class="keyWord">IMPORTANT NOTE</strong></p>
      <p class="normal">The reason that we are not checking the <strong class="screenText">Progressive Web Application</strong> checkbox is that we will be transforming the application into a PWA as part of this project.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="11">Click the <strong class="screenText">Create</strong> button.</li>
    </ol>
    <p class="normal">We have created an <a id="_idIndexMarker466"/>empty <code class="inlineCode">WeatherForecast</code> Blazor WebAssembly project. Let’s get started by adding the JavaScript function for determining the location of the device.</p>
    <h2 id="_idParaDest-202" class="heading-2">Add JavaScript to determine our location</h2>
    <p class="normal">We need to <a id="_idIndexMarker467"/>add the JavaScript <a id="_idIndexMarker468"/>function to determine our current latitude and longitude. We do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Right-click the <code class="inlineCode">wwwroot</code> folder and select the <strong class="screenText">Add</strong>, <strong class="screenText">New Folder</strong> option from the menu.</li>
      <li class="numberedList">Name the new folder <code class="inlineCode">scripts</code>.</li>
      <li class="numberedList">Right-click the <code class="inlineCode">scripts</code> folder and select the <strong class="screenText">Add</strong>, <strong class="screenText">New Item</strong> option from the menu.</li>
      <li class="numberedList">Enter <code class="inlineCode">javascript</code> in the <strong class="screenText">Search</strong> box.</li>
      <li class="numberedList">Select <strong class="screenText">JavaScript File</strong>.</li>
      <li class="numberedList">Name the file <code class="inlineCode">bweInterop.js</code>.
    <div><p class="normal"><strong class="keyWord">TIP</strong></p>
      <p class="normal">In this book, we will be using the <code class="inlineCode">bweInterop</code> namespace for our JavaScript code to both structure our code and minimize the risk of naming conflicts.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="7">Click the <strong class="screenText">Add</strong> button.</li>
      <li class="numberedList">Enter the following JavaScript:
        <pre class="programlisting code"><code class="hljs-code">var bweInterop = {};
bweInterop.getPosition = async function () {
    function getPositionAsync() {
        return new Promise((success, error) =&gt; {
            navigator.geolocation.getCurrentPosition
                (success, error);
        });
    }
    if (navigator.geolocation) {
        var position = await getPositionAsync();
        var coords = {
            latitude: position.coords.latitude,
            longitude: position.coords.longitude
        };
        return coords;
    } else {
        throw Error("Geolocation is not supported.");
    };
}
</code></pre>
      
    <p class="normal">The preceding JavaScript code uses the <code class="inlineCode">Geolocation</code> API to return the latitude and longitude of the device. If it is not allowed or it is not supported, an error is thrown.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="9">Open the <code class="inlineCode">wwwroot/index.html</code> file.</li>
      <li class="numberedList">Add the following markup at the bottom of the <code class="inlineCode">body</code> element:
        <pre class="programlisting code"><code class="hljs-code">&lt;script src="img/bweInterop.js"&gt;&lt;/script&gt;
</code></pre>
      </li>
    </ol>
    <p class="normal">We have <a id="_idIndexMarker469"/>created a JavaScript function <a id="_idIndexMarker470"/>that uses the <code class="inlineCode">Geolocation</code> API to return our current latitude and longitude. Next, we need to invoke it from our web app.</p>
    <h2 id="_idParaDest-203" class="heading-2">Invoke the JavaScript function</h2>
    <p class="normal">We need to <a id="_idIndexMarker471"/>add a class to store our location and then we <a id="_idIndexMarker472"/>can invoke our <code class="inlineCode">bweInterop.getPosition</code> function. We do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Right-click the <code class="inlineCode">WeatherForecast</code> project and select the <strong class="screenText">Add</strong>, <strong class="screenText">New Folder</strong> option from the menu.</li>
      <li class="numberedList">Name the new folder <code class="inlineCode">Models</code>.</li>
      <li class="numberedList">Right-click the <code class="inlineCode">Models</code> folder and select the <strong class="screenText">Add</strong>, <strong class="screenText">Class</strong> option from the menu.</li>
      <li class="numberedList">Name the new class <code class="inlineCode">Position</code>.</li>
      <li class="numberedList">Add the following properties to the <code class="inlineCode">Position</code> class:
        <pre class="programlisting code"><code class="hljs-code">public double Latitude { get; set; }
public double Longitude { get; set; }
</code></pre>
      
    <p class="normal">This is the class that we will use to store our coordinates.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Open the <code class="inlineCode">Pages/Index.razor</code> file.</li>
      <li class="numberedList">Delete the <code class="inlineCode">H1</code> element.</li>
      <li class="numberedList">Add the following directives:
        <pre class="programlisting code"><code class="hljs-code">@using WeatherForecast.Models
@inject IJSRuntime js
</code></pre>
      </li>
      <li class="numberedList">Add the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;PageTitle&gt;Weather Forecast&lt;/PageTitle&gt;
@if (pos == null)
{
    &lt;p&gt;&lt;em&gt;@message&lt;/em&gt;&lt;/p&gt;
}
else
{
    &lt;h2&gt;
        Latitude: @pos.Latitude, 
        Longitude: @pos.Longitude
    &lt;/h2&gt;
}
@code {
    string message = "Loading...";
    Position? pos;
}
</code></pre>
      
    <p class="normal">The <a id="_idIndexMarker473"/>preceding markup displays the value <a id="_idIndexMarker474"/>of the <code class="inlineCode">message</code> field if the <code class="inlineCode">pos</code> property is <code class="inlineCode">null</code>. Otherwise, it displays the latitude and longitude from the <code class="inlineCode">pos</code> property.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="10">Add the following <code class="inlineCode">OnInitializedAsync</code> method to the code block:
        <pre class="programlisting code"><code class="hljs-code">protected override async Task OnInitializedAsync()
{
    try
    {
        await GetPositionAsync();
    }
    catch (Exception)
    {
        message = "Geolocation is not supported.";
    };
}
</code></pre>
      
    <p class="normal">The preceding code attempts to get our coordinates when the page initializes.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="11">Add the following <code class="inlineCode">GetPositionAsync</code> method to the code block:
        <pre class="programlisting code"><code class="hljs-code">private async Task GetPositionAsync()
{
    pos = await js.InvokeAsync&lt;Position&gt;(
        "bweInterop.getPosition");
}
</code></pre>
      
    <p class="normal">The preceding code uses JavaScript interop to invoke the JavaScript function that we wrote that uses the <code class="inlineCode">Geolocation</code> API to return our coordinates. For more information on JavaScript interop, refer to <em class="chapterRef">Chapter 5</em>, <em class="italic">Building a Local Storage Service Using JavaScript Interoperability (JS Interop)</em>.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="12">Press <em class="keystroke">Ctrl</em>+<em class="keystroke">F5</em> to start the application without debugging.
    <p class="normal">The <a id="_idIndexMarker475"/>following screenshot is an example of the <a id="_idIndexMarker476"/>dialog that will ask you for permission to access your location:</p>
    <figure class="mediaobject"><img src="img/B18471_06_08.png" alt="Table  Description automatically generated with low confidence"/></figure>
    <p class="packt_figref">Figure 6.8: Geolocation permission dialog</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="13">Click the <strong class="screenText">Allow</strong> button to allow the app to have access to your location.
    <p class="normal">The following screenshot is of the <strong class="screenText">Home</strong> page of our Weather Forecast app:</p>
    <figure class="mediaobject"><img src="img/B18471_06_09.png" alt="Graphical user interface, text, application  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.9: Home page displaying our coordinates</p>
    <p class="normal">You can disable the app’s ability to access your location by using the <strong class="screenText">Location access allowed</strong> dialog that is shown in the following screenshot:</p>
    <figure class="mediaobject"><img src="img/B18471_06_10.png" alt="Graphical user interface, application  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.10: Location access allowed dialog</p>
    <p class="normal">The <strong class="screenText">Location access allowed</strong> dialog is accessed via the highlighted button on the <a id="_idIndexMarker477"/>browser’s toolbar. You may want to toggle <a id="_idIndexMarker478"/>the permissions to see how that impacts the app.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="14">Close the browser.</li>
    </ol>
    <p class="normal">We have used the <code class="inlineCode">Geolocation</code> API to display our latitude and longitude on the <strong class="screenText">Home</strong> page. Next, we need to provide those coordinates to the <code class="inlineCode">OpenWeather One Call</code> API.</p>
    <h2 id="_idParaDest-204" class="heading-2">Add an OpenWeather class</h2>
    <p class="normal">We need <a id="_idIndexMarker479"/>to add an <code class="inlineCode">OpenWeather</code> class to <a id="_idIndexMarker480"/>capture the results from the <code class="inlineCode">OpenWeather One Call</code> API. We do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Return to Visual Studio.</li>
      <li class="numberedList">Right-click the <code class="inlineCode">Models</code> folder and select the <strong class="screenText">Add</strong>, <strong class="screenText">Class</strong> option from the menu.</li>
      <li class="numberedList">Name the new class <code class="inlineCode">OpenWeather</code>.</li>
      <li class="numberedList">Click the <strong class="screenText">Add</strong> button.</li>
      <li class="numberedList">Add the following classes:
        <pre class="programlisting code"><code class="hljs-code">public class OpenWeather
{
    public Daily[] Daily { get; set; }
}
public class Daily
{
    public long Dt { get; set; }
    public Temp Temp { get; set; }
    public Weather[] Weather { get; set; }
}
public class Temp
{
    public double Min { get; set; }
    public double Max { get; set; }
}
public class Weather
{
    public string Description { get; set; }
    public string Icon { get; set; }
}
</code></pre>
      </li>
    </ol>
    <p class="normal">The preceding classes <a id="_idIndexMarker481"/>will be used to <a id="_idIndexMarker482"/>store the responses from the <code class="inlineCode">OpenWeather One Call</code> API. </p>
    <p class="normal">Now we need to add a component to display the responses. We will use <code class="inlineCode">Bootstrap</code> to style our new component.</p>
    <h2 id="_idParaDest-205" class="heading-2">Install Bootstrap</h2>
    <p class="normal">We need <a id="_idIndexMarker483"/>to install <code class="inlineCode">Bootstrap</code> in our web app. We do this as <a id="_idIndexMarker484"/>follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Right-click the <code class="inlineCode">wwwroot/css</code> folder and select the <strong class="screenText">Add</strong>, <strong class="screenText">Client-Side Library</strong> option from the menu.</li>
      <li class="numberedList">Enter <code class="inlineCode">bootstrap</code> into the <strong class="screenText">Library</strong> search textbox and press the <em class="keystroke">Enter</em> key.</li>
      <li class="numberedList">Select <strong class="screenText">Choose specific files</strong>.</li>
      <li class="numberedList">Select only the <code class="inlineCode">css</code> files, as shown in the following screenshot:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B18471_06_11.png" alt="Graphical user interface, text, application, email  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.11: Add Client-Side Library dialog</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Click the <strong class="screenText">Install</strong> button.
    <div><p class="normal"><strong class="keyWord">IMPORTANT NOTE </strong></p>
      <p class="normal">After you install <code class="inlineCode">Bootstrap</code>, a new folder will be added to the <code class="inlineCode">wwwroot/css</code> folder. This new folder contains all the CSS files needed for <code class="inlineCode">Bootstrap</code>. We will only be using the <code class="inlineCode">bootstrap.min.css</code> file in this project.</p>
    </div>
    <p class="normal">Now <a id="_idIndexMarker485"/>that <code class="inlineCode">Bootstrap</code> is installed, let’s verify that it is <a id="_idIndexMarker486"/>working.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Open the <code class="inlineCode">wwwroot/index.html</code> file.</li>
      <li class="numberedList">Add the following markup to the <code class="inlineCode">head</code> element before the link to the <code class="inlineCode">css/app.css</code> stylesheet.
        <pre class="programlisting code"><code class="hljs-code">&lt;link href="css/bootstrap/css/bootstrap.min.css" 
        rel="stylesheet" /&gt;
</code></pre>
      </li>
      <li class="numberedList">Open the <code class="inlineCode">Pages/Index.razor</code> page.</li>
      <li class="numberedList">Add the following markup below the <code class="inlineCode">PageTitle</code> component.
        <pre class="programlisting code"><code class="hljs-code">&lt;div class="alert alert-info"&gt;
    Bootstrap is installed!
&lt;/div&gt;
</code></pre>
      </li>
      <li class="numberedList">Press <em class="keystroke">Ctrl</em>+<em class="keystroke">F5</em> to start the application without debugging.</li>
      <li class="numberedList">Verify <a id="_idIndexMarker487"/>that the top of the page is now blue.</li>
      <li class="numberedList">Close <a id="_idIndexMarker488"/>the browser.</li>
    </ol>
    <p class="normal">Now that <code class="inlineCode">Bootstrap</code> is properly installed, we can add the new component.</p>
    <h2 id="_idParaDest-206" class="heading-2">Add a DailyForecast component</h2>
    <p class="normal">We need the <a id="_idIndexMarker489"/>new component <a id="_idIndexMarker490"/>to display each day’s forecast. We do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Right-click the <code class="inlineCode">WeatherForecast</code> project and select the <strong class="screenText">Add</strong>, <strong class="screenText">New Folder</strong> option from the menu.</li>
      <li class="numberedList">Name the new folder <code class="inlineCode">Shared</code>.</li>
      <li class="numberedList">Right-click the <code class="inlineCode">Shared</code> folder and select the <strong class="screenText">Add</strong>, <strong class="screenText">Razor Component</strong> option from the menu.</li>
      <li class="numberedList">Name the new component <code class="inlineCode">DailyForecast</code>.</li>
      <li class="numberedList">Click the <strong class="screenText">Add</strong> button.</li>
      <li class="numberedList">Replace the existing markup with the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;div class="card text-center"&gt;
    &lt;div class="card-header"&gt;
        @Date
    &lt;/div&gt;
    &lt;div class="card-body"&gt;
        &lt;img src="img/@IconUrl" /&gt;
        &lt;h4 class="card-title"&gt;@Description&lt;/h4&gt;
        &lt;b&gt;@((int)HighTemp) F&amp;deg;&lt;/b&gt; /
        @((int)LowTemp) F&amp;deg;
    &lt;/div&gt;
&lt;/div&gt;
@code {
}
</code></pre>
      
    <p class="normal">This component uses the <code class="inlineCode">Card</code> component from <code class="inlineCode">Bootstrap</code> to display the daily forecast.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="7">Add the following code to the code block:
        <pre class="programlisting code"><code class="hljs-code">[Parameter] public long Seconds { get; set; }
[Parameter] public double HighTemp { get; set; }
[Parameter] public double LowTemp { get; set; }
[Parameter] public string? Description { get; set; }
[Parameter] public string? Icon { get; set; }
private string? Date;
private string? IconUrl;
protected override void OnInitialized()
{
    Date = DateTimeOffset
        .FromUnixTimeSeconds(Seconds)
        .LocalDateTime
        .ToLongDateString();
    
    IconUrl = String.Format(
        "https://openweathermap.org/img/wn/{0}@2x.png",
        Icon);
}
</code></pre>
      </li>
    </ol>
    <p class="normal">The preceding <a id="_idIndexMarker491"/>code defines the <a id="_idIndexMarker492"/>parameters that are used to display the daily weather forecast. The <code class="inlineCode">OnInitialized</code> method is used to format the <code class="inlineCode">Date</code> and <code class="inlineCode">IconUrl</code> fields.</p>
    <p class="normal">We have added a Razor component to display each day’s weather forecast using the <code class="inlineCode">Card</code> component from <code class="inlineCode">Bootstrap</code>.</p>
    <h2 id="_idParaDest-207" class="heading-2">Fetch the forecast</h2>
    <p class="normal">We need to fetch the <a id="_idIndexMarker493"/>weather forecast. We can fetch the forecast by <a id="_idIndexMarker494"/>either calling the <code class="inlineCode">OpenWeather One Call</code> API or using the <code class="inlineCode">weather.json</code> file that is in GitHub. We do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Open the <code class="inlineCode">Pages/Index.razor</code> file.</li>
      <li class="numberedList">Add the following <code class="inlineCode">using</code> statements:
        <pre class="programlisting code"><code class="hljs-code">@using System.Text 
@using WeatherForecast.Shared
</code></pre>
      </li>
      <li class="numberedList">Add the following directive:
        <pre class="programlisting code"><code class="hljs-code">@inject HttpClient Http
</code></pre>
      </li>
      <li class="numberedList">Add the following field to the top of the code block:
        <pre class="programlisting code"><code class="hljs-code">OpenWeather? forecast;
</code></pre>
      </li>
      <li class="numberedList">Add the <code class="inlineCode">GetForecastAsync</code> method to the code block:
        <pre class="programlisting code"><code class="hljs-code">private async Task GetForecastAsync()
{
}
</code></pre>
      </li>
      <li class="numberedList">Add the following code to the <code class="inlineCode">GetForecastAsync</code> method:
        <pre class="programlisting code"><code class="hljs-code">if (pos != null)
{
    string APIKey = "{Your API Key}";
    StringBuilder url = new StringBuilder();
    url.Append("https://api.openweathermap.org");
    url.Append("/data/2.5/onecall?");
    url.Append("lat=");
    url.Append(pos.Latitude);
    url.Append("&amp;lon=");
    url.Append(pos.Longitude);
    url.Append("&amp;exclude=");
    url.Append("current,minutely,hourly,alerts");
    url.Append("&amp;units=imperial");
    url.Append("&amp;appid=");
    url.Append(APIKey);
    forecast = await Http.GetFromJsonAsync&lt;OpenWeather&gt;
        (url.ToString());
}
</code></pre>
        <div><p class="normal"><strong class="keyWord">IMPORTANT NOTE</strong></p>
          <p class="normal">You need to replace <code class="inlineCode">{Your_API_Key}</code> with the API key that you obtained from <code class="inlineCode">OpenWeather</code>. Also, it may take a couple of hours for your API key to become active.</p>
        </div>
      
    <p class="normal">The <a id="_idIndexMarker495"/>preceding method uses the <code class="inlineCode">OpenWeather One Call</code> API with the coordinates obtained by the <code class="inlineCode">GetPositionAsync</code> method to populate the <code class="inlineCode">forecast</code> object.</p>
    <p class="normal">If you <a id="_idIndexMarker496"/>cannot use the <code class="inlineCode">OpenWeather One Call</code> API, use the following version of the <code class="inlineCode">GetForecastAsync</code> method:</p>
    <pre class="programlisting code"><code class="hljs-code">forecast = await Http.GetFromJsonAsync&lt;OpenWeather&gt;
    ("sample-data/weather.json");
</code></pre>
    <p class="normal">The preceding version of the <code class="inlineCode">GetForecastAsync</code> method uses a static file to populate the <code class="inlineCode">forecast</code> object. It assumes that the <code class="inlineCode">weather.json</code> file has been downloaded from the GitHub repository for this chapter and that it has been placed into the <code class="inlineCode">wwwroot/sample-data</code> folder.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="7">Update the <code class="inlineCode">OnInitializedAsync</code> method to call the <code class="inlineCode">GetForecastAsync</code> method and update the error message, like this:
        <pre class="programlisting code"><code class="hljs-code">try
{
    await GetPositionAsync();
    await GetForecastAsync();
}
catch (Exception)
{
    message = "Error encountered.";
};
</code></pre>
      </li>
    </ol>
    <p class="normal">Now that we have populated the forecast object, we can display the forecast.</p>
    <h2 id="_idParaDest-208" class="heading-2">Display the forecast</h2>
    <p class="normal">We need to <a id="_idIndexMarker497"/>add a collection <a id="_idIndexMarker498"/>of daily forecasts to the <strong class="screenText">Home</strong> page. We do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Remove the <code class="inlineCode">div</code> element.</li>
      <li class="numberedList">Replace the <code class="inlineCode">@if</code> statement with the following markup:
        <pre class="programlisting code"><code class="hljs-code">@if (forecast == null)
{
    &lt;p&gt;&lt;em&gt;@message&lt;/em&gt;&lt;/p&gt;
}
else
{
    &lt;div class="card-group"&gt;
        @foreach (var item in forecast.Daily.Take(5))
        {
            &lt;DailyForecast
               Seconds="@item.Dt"
               LowTemp="@item.Temp.Min"
               HighTemp="@item.Temp.Max"
               Description="@item.Weather[0].Description"
               Icon="@item.Weather[0].Icon" /&gt;
        }
    &lt;/div&gt;
}
</code></pre>
      
    <p class="normal">The preceding markup loops through the <code class="inlineCode">forecast</code> object five times. It uses the <code class="inlineCode">DailyForecast</code> component to display the daily forecast.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">Press <em class="keystroke">Ctrl</em>+<em class="keystroke">F5</em> to start the application without debugging.</li>
      <li class="numberedList">Close the browser.</li>
    </ol>
    <p class="normal">We have <a id="_idIndexMarker499"/>completed our Weather Forecast<strong class="screenText"> </strong>application. Now, we need to convert it into a PWA. To do that, we need to add a <a id="_idIndexMarker500"/>logo, a manifest file, and a service worker.</p>
    <h2 id="_idParaDest-209" class="heading-2">Add the logo</h2>
    <p class="normal">We need to <a id="_idIndexMarker501"/>add an image to be used as a logo for the <a id="_idIndexMarker502"/>app. We do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Right-click the <code class="inlineCode">wwwroot</code> folder and select the <strong class="screenText">Add</strong>, <strong class="screenText">New Folder</strong> option from the menu.</li>
      <li class="numberedList">Name the new folder <code class="inlineCode">images</code>.</li>
      <li class="numberedList">Copy the <code class="inlineCode">Sun-512.png</code> image from the GitHub repository for this chapter to the <code class="inlineCode">images</code> folder.</li>
    </ol>
    <p class="normal">At least one <a id="_idIndexMarker503"/>image must be included in the manifest <a id="_idIndexMarker504"/>file for the PWA to be installed. Now, we can add a manifest file.</p>
    <h2 id="_idParaDest-210" class="heading-2">Add a manifest file</h2>
    <p class="normal">To convert the <a id="_idIndexMarker505"/>web app into a PWA, we need to add a manifest file. We <a id="_idIndexMarker506"/>do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Right-click the <code class="inlineCode">wwwroot</code> folder and select the <strong class="screenText">Add</strong>, <strong class="screenText">New Item</strong> option from the menu.</li>
      <li class="numberedList">Enter <code class="inlineCode">json</code> in the <strong class="screenText">Search</strong> box.</li>
      <li class="numberedList">Select <strong class="screenText">JSON File</strong>.</li>
      <li class="numberedList">Name the file <code class="inlineCode">manifest.json</code>.</li>
      <li class="numberedList">Click the <strong class="screenText">Add</strong> button.</li>
      <li class="numberedList">Enter the following JSON code:
        <pre class="programlisting code"><code class="hljs-code">{
  "lang": "en",
  "name": "5-Day Weather Forecast",
  "short_name": "Weather",
  "display": "standalone",
  "start_url": "./",
  "background_color": "#ffa500",
  "theme_color": "transparent",
  "description": "This is a 5-day weather forecast app",
  "orientation": "any",
  "icons": [
    {
      "src": "images/Sun-512.png",
      "type": "image/png",
      "sizes": "512x512"
    }
  ]
}
</code></pre>
      </li>
      <li class="numberedList">Open the <code class="inlineCode">wwwroot/index.html</code> file.</li>
      <li class="numberedList">Add the following markup to the bottom of the <code class="inlineCode">head</code> element:
        <pre class="programlisting code"><code class="hljs-code">&lt;link href="manifest.json" rel="manifest" /&gt;
</code></pre>
      </li>
      <li class="numberedList">Add the following markup below the preceding markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;link rel="apple-touch-icon" 
      sizes="512x512" 
      href="images/Sun-512.png" /&gt;
</code></pre>
        <div><p class="normal"><strong class="keyWord">TIP</strong></p>
          <p class="normal">With iOS Safari, you must include the preceding link tag to instruct it to use the indicated icon or it will generate an icon by taking a screenshot of the page’s content.</p>
        </div>
      </li>
    </ol>
    <p class="normal">We have <a id="_idIndexMarker507"/>added a manifest file to our web app to control how it looks <a id="_idIndexMarker508"/>and behaves when it is installed. Next, we need to add a service worker.</p>
    <h2 id="_idParaDest-211" class="heading-2">Add a simple service worker</h2>
    <p class="normal">To finish <a id="_idIndexMarker509"/>converting the web app into a PWA, we <a id="_idIndexMarker510"/>need to add a service worker. We do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Right-click the <code class="inlineCode">wwwroot</code> folder and select the <strong class="screenText">Add</strong>, <strong class="screenText">New Item</strong> option from the menu.</li>
      <li class="numberedList">Enter <code class="inlineCode">html</code> in the <strong class="screenText">Search</strong> box.</li>
      <li class="numberedList">Select <strong class="screenText">HTML Page</strong>.</li>
      <li class="numberedList">Name the file <code class="inlineCode">offline.html</code>.</li>
      <li class="numberedList">Click the <strong class="screenText">Add</strong> button.</li>
      <li class="numberedList">Add the following markup to the <code class="inlineCode">body</code> element:
        <pre class="programlisting code"><code class="hljs-code">&lt;h1&gt;You are offline.&lt;/h1&gt;
</code></pre>
      </li>
      <li class="numberedList">Right-click the <code class="inlineCode">wwwroot</code> folder and select the <strong class="screenText">Add</strong>, <strong class="screenText">New Item</strong> option from the menu.</li>
      <li class="numberedList">Enter <code class="inlineCode">javascript</code> in the <strong class="screenText">Search</strong> box.</li>
      <li class="numberedList">Select <code class="inlineCode">JavaScript File</code>.</li>
      <li class="numberedList">Name the file <code class="inlineCode">service-worker.js</code>.</li>
      <li class="numberedList">Click the <strong class="screenText">Add</strong> button.</li>
      <li class="numberedList">Add the following constants:
        <pre class="programlisting code"><code class="hljs-code">const OFFLINE_VERSION = 1;
const CACHE_PREFIX = 'offline';
const CACHE_NAME = '${CACHE_PREFIX}${OFFLINE_VERSION}';
const OFFLINE_URL = 'offline.html';
</code></pre>
      
    <p class="normal">The <a id="_idIndexMarker511"/>preceding code sets the <a id="_idIndexMarker512"/>name of the current cache and the name of the file we will be using to indicate that we are offline.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="13">Add the following event listeners:
        <pre class="programlisting code"><code class="hljs-code">self.addEventListener('install',
    event =&gt; event.waitUntil(onInstall(event)));
self.addEventListener('activate',
    event =&gt; event.waitUntil(onActivate(event)));
self.addEventListener('fetch',
    event =&gt; event.respondWith(onFetch(event)));
</code></pre>
     
    <p class="normal">The preceding code designates the functions to be used for each of the following steps: install, activate, and fetch.</p> </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="14">Add the following <code class="inlineCode">onInstall</code> function:
        <pre class="programlisting code"><code class="hljs-code">async function onInstall(event) {
    console.info('Service worker: Install');
    const cache = await caches.open(CACHE_NAME);
    await cache.add(new Request(OFFLINE_URL));
}
</code></pre>
      
    <p class="normal">The preceding function opens the indicated cache. If the cache does not yet exist, it creates the cache and then opens it. After the cache is open, it adds the indicated request/response pair to the cache.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="15">Add the following <code class="inlineCode">onActivate</code> function:
        <pre class="programlisting code"><code class="hljs-code">async function onActivate(event) {
    console.info('Service worker: Activate');
    const cacheKeys = await caches.keys();
    await Promise.all(cacheKeys
        .filter(key =&gt; key.startsWith(CACHE_PREFIX)
            &amp;&amp; key !== CACHE_NAME)
        .map(key =&gt; caches.delete(key)));
}
</code></pre>
      
    <p class="normal">The preceding code fetches the names of all the caches. All the caches that do not match the name of the indicated cache are deleted.</p>
    <div><p class="normal"><strong class="keyWord">TIP</strong></p>
      <p class="normal">It is your responsibility to purge obsolete caches. Each browser has a limit as to the amount of storage that a web app can use. If you violate that limit, all of your caches may be deleted by the browser.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="16">Add the following <code class="inlineCode">onFetch</code> function:
        <pre class="programlisting code"><code class="hljs-code">async function onFetch(event) {
    if (event.request.method === 'GET') {
        try {
            return await fetch(event.request);
        } catch (error) {
            const cache = await
               caches.open(CACHE_NAME);
            return await cache.match(OFFLINE_URL);
        };
    };
}
</code></pre>
      
    <p class="normal">In the <a id="_idIndexMarker513"/>preceding code, if the <a id="_idIndexMarker514"/>fetch fails, the cache is opened, and the previously cached offline page is served.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="17">Open the <code class="inlineCode">wwwroot/index.html</code> file.</li>
      <li class="numberedList">Add the following markup to the bottom of the <code class="inlineCode">body</code> element:
        <pre class="programlisting code"><code class="hljs-code">&lt;script&gt;
   navigator.serviceWorker.register('service-worker.js');
&lt;/script&gt;
</code></pre>
     
    <p class="normal">The preceding code registers the service worker.</p> </li>
    </ol>
    <p class="normal">We have <a id="_idIndexMarker515"/>added an offline page service worker <a id="_idIndexMarker516"/>that will display the <code class="inlineCode">offline.html</code> page when the PWA is offline.</p>
    <h2 id="_idParaDest-212" class="heading-2">Test the service worker</h2>
    <p class="normal">We need to <a id="_idIndexMarker517"/>test that the service worker is allowing us to work <a id="_idIndexMarker518"/>offline. We do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Press <em class="keystroke">Ctrl</em>+<em class="keystroke">F5</em> to start the application without debugging.</li>
      <li class="numberedList">Click <em class="keystroke">F12</em> to open the <code class="inlineCode">Developer Tools</code> interface.</li>
      <li class="numberedList">Select the <strong class="screenText">Application</strong> tab.</li>
      <li class="numberedList">Select the <strong class="screenText">Manifest</strong> option from the menu on the left to view the <strong class="screenText">App Manifest </strong>details.</li>
    </ol>
    <figure class="mediaobject"><img src="img/B18471_06_12.png" alt="Graphical user interface, text, application, chat or text message  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.12: App Manifest details</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Select the <strong class="screenText">Service Workers</strong> option from the menu on the left to view the service <a id="_idIndexMarker519"/>worker that is installed for the current <a id="_idIndexMarker520"/>client, as illustrated in the following screenshot:
    <figure class="mediaobject"><img src="img/B18471_06_13.png" alt="Graphical user interface, application  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.13: Service Workers dialog</p>
    <p class="normal">In the <a id="_idIndexMarker521"/>preceding screenshot, we have highlighted <a id="_idIndexMarker522"/>both the <strong class="screenText">Offline</strong> checkbox and the <strong class="screenText">See all registrations</strong> link.</p>
    <div><p class="normal"><strong class="keyWord">TIP</strong></p>
      <p class="normal">Click on the <strong class="screenText">See all registrations</strong> link to see all the service workers that are installed on your device. You will probably be surprised to see how many service workers are installed on your computer.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Select the <strong class="screenText">Cache Storage</strong> option from the menu on the left to view the caches.</li>
      <li class="numberedList">Click on the <strong class="screenText">offline1</strong> cache to view its contents, as illustrated in the following screenshot:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B18471_06_14.png" alt="Graphical user interface, application  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.14: Cache Storage</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="8">Select <a id="_idIndexMarker523"/>the <strong class="screenText">Service Workers</strong> option from the menu <a id="_idIndexMarker524"/>on the left.</li>
      <li class="numberedList">Check the <strong class="screenText">Offline</strong> checkbox on the <strong class="screenText">Service Workers</strong> dialog.
    <div><p class="normal"><strong class="keyWord">TIP</strong></p>
      <p class="normal">The <strong class="screenText">Offline</strong> checkbox is highlighted in Figure 16.13.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="10">Refresh the browser, and you should see the following screen:
    <figure class="mediaobject"><img src="img/B18471_06_15.png" alt="Graphical user interface, text, application, chat or text message  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.15: Offline page</p>
    <p class="normal">The page that is displayed is from the browser’s cache.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="11">Uncheck the <strong class="screenText">Offline</strong> checkbox on the <strong class="screenText">Service Workers</strong> dialog.</li>
      <li class="numberedList">Refresh the browser.</li>
    </ol>
    <p class="normal">Since the web <a id="_idIndexMarker525"/>app is now back online, the <strong class="screenText">Offline</strong> page is no <a id="_idIndexMarker526"/>longer displayed.</p>
    <p class="normal">We have tested that the service worker enables our web app to work offline. Now, we can install the PWA.</p>
    <h2 id="_idParaDest-213" class="heading-2">Install the PWA</h2>
    <p class="normal">We need <a id="_idIndexMarker527"/>to test the PWA by installing it. We <a id="_idIndexMarker528"/>do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Select the <strong class="screenText">App available. Install 5-Day Weather Forecast</strong> menu option from the browser’s menu:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B18471_06_16.png" alt="Graphical user interface  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.16: Install 5-Day Weather Forecast option</p>
    <div><p class="normal"><strong class="keyWord">TIP</strong></p>
      <p class="normal">On Chromium-based browsers, the <strong class="screenText">Install</strong> button is on the URL bar. However, for other types of browsers, you will need to install the PWA from either the <strong class="screenText">Menu</strong> button or the <strong class="screenText">Share</strong> button.</p>
    </div>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">Click <a id="_idIndexMarker529"/>the <strong class="screenText">Install</strong> button in the <strong class="screenText">Install PWA</strong> dialog:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B18471_06_17.png" alt="Text  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.17: Install PWA dialog</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">Click <a id="_idIndexMarker530"/>the <strong class="screenText">Allow</strong> button in the <strong class="screenText">App installed</strong> dialog.
    <figure class="mediaobject"><img src="img/B18471_06_18.png" alt="Graphical user interface, text, application  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.18: App installed dialog</p>
    <p class="normal">Once installed, the PWA appears without an address bar. It appears on our taskbar, and we <a id="_idIndexMarker531"/>can run it from <a id="_idIndexMarker532"/>our <strong class="screenText">Start</strong> menu. The following screenshot shows the PWA after it has been installed:</p>
    <figure class="mediaobject"><img src="img/B18471_06_19.png" alt="Graphical user interface, application  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.19: Installed PWA</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Close the app.</li>
      <li class="numberedList">Click the <em class="keystroke">Windows</em> key and search for the <strong class="screenText">5-Day Weather Forecast</strong> app.</li>
      <li class="numberedList">Open the <strong class="screenText">5-Day Weather Forecast</strong> app.</li>
    </ol>
    <p class="normal">When the <a id="_idIndexMarker533"/>application opens, its icon appears on <a id="_idIndexMarker534"/>the taskbar. We can pin it to the taskbar if we want.</p>
    <p class="normal">We have successfully installed and run the PWA. It is just as easy to uninstall a PWA as it is to install one.</p>
    <h2 id="_idParaDest-214" class="heading-2">Uninstall the PWA</h2>
    <p class="normal">We need <a id="_idIndexMarker535"/>to uninstall the PWA. We do this <a id="_idIndexMarker536"/>as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Close the <strong class="screenText">5-Day Weather Forecast</strong> app.</li>
      <li class="numberedList">Click the <em class="keystroke">Windows</em> key and search for the <strong class="screenText">5-Day Weather Forecast</strong> app. </li>
      <li class="numberedList">Right-click the <strong class="screenText">5-Day Weather Forecast</strong> app and select the <strong class="screenText">Uninstall</strong> option from the menu.</li>
    </ol>
    <figure class="mediaobject"><img src="img/B18471_06_20.png" alt="Graphical user interface, text, application, chat or text message  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.20: Uninstall the 5-Day Weather Forecast app</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Click <a id="_idIndexMarker537"/>the <strong class="screenText">Uninstall</strong> button.
    <figure class="mediaobject"><img src="img/B18471_06_21.png" alt="Graphical user interface, text, application, chat or text message  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.21: Uninstall the 5-Day Weather Forecast app</p>
    <p class="normal">We have <a id="_idIndexMarker538"/>uninstalled the PWA.</p></li>
    </ol>
    <div><p class="normal"><strong class="keyWord">IMPORTANT NOTE</strong></p>
      <p class="normal">It may take a few seconds for the app to be removed from the taskbar.</p>
    </div>
    <h1 id="_idParaDest-215" class="heading-1">Summary</h1>
    <p class="normal">You should now be able to convert a Blazor WebAssembly app into a PWA by adding a manifest file and a service worker.</p>
    <p class="normal">In this chapter, we introduced PWAs. We explained how to convert a web app into a PWA by adding a manifest file and a service worker. We explained how to work with manifest files and service workers. We went into some detail explaining the different types of service workers and explained how to use the <code class="inlineCode">CacheStorage</code> API to cache request/response pairs. Finally, we demonstrated how to use both the <code class="inlineCode">Geolocation</code> API and the <code class="inlineCode">OpenWeather One Call</code> API.</p>
    <p class="normal">After that, we used the <code class="inlineCode">Blazor WebAssembly App Empty</code> project template to create a new project. We added a JavaScript function that uses the <code class="inlineCode">Geolocation</code> API to obtain our coordinates. We added some models to capture the coordinates and used JavaScript interop to invoke the JavaScript function. We used the <code class="inlineCode">OpenWeather One Call API</code> to obtain the local 5-day weather forecast. We installed <code class="inlineCode">Bootstrap</code> and created a Razor component to display each day’s forecast.</p>
    <p class="normal">In the last part of the chapter, we converted the Blazor WebAssembly app into a PWA by adding an image, a manifest file, and an offline page service worker. Finally, we installed, ran, and uninstalled the PWA. We can apply our new skills to convert our existing web apps into PWAs that combine the benefits of a web app with the look and feel of a native app.</p>
    <p class="normal">In the next chapter, we will use <strong class="keyWord">dependency injection</strong> (<strong class="keyWord">DI)</strong> to build a shopping cart application.</p>
    <h1 id="_idParaDest-216" class="heading-1">Questions</h1>
    <p class="normal">The following questions are provided for your consideration:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Are service workers asynchronous or synchronous?</li>
      <li class="numberedList">Can <code class="inlineCode">localStorage</code> be used inside a service worker for data storage?</li>
      <li class="numberedList">Can service workers manipulate the DOM?</li>
      <li class="numberedList">Are PWAs secure?</li>
      <li class="numberedList">Are PWAs platform-specific?</li>
      <li class="numberedList">What are the differences between a PWA and a native app?</li>
    </ol>
    <h1 id="_idParaDest-217" class="heading-1">Further reading</h1>
    <p class="normal">The following resources provide more information concerning the topics in this chapter:</p>
    <ul>
      <li class="bulletList">For more information on the <code class="inlineCode">Geolocation</code> API specification, refer to <a href="https://w3c.github.io/geolocation-api">https://w3c.github.io/geolocation-api</a>.</li>
      <li class="bulletList">For more information on using the <code class="inlineCode">Geolocation</code> API, refer to <a href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API">https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API</a>.</li>
      <li class="bulletList">For more information on the <code class="inlineCode">Weather</code> API, refer to <a href="https://openweathermap.org/api">https://openweathermap.org/api</a>.</li>
      <li class="bulletList">For more information on the <code class="inlineCode">Web Application Manifest</code> specification, refer to <a href="https://www.w3.org/TR/appmanifest">https://www.w3.org/TR/appmanifest</a>.</li>
      <li class="bulletList">For more information on the <code class="inlineCode">Service Worker</code> specification, refer to <a href="https://w3c.github.io/ServiceWorker">https://w3c.github.io/ServiceWorker</a>.</li>
      <li class="bulletList">For more information on using the <code class="inlineCode">CacheStorage</code> API, refer to <a href="https://developer.mozilla.org/en-US/docs/Web/API/CacheStorage">https://developer.mozilla.org/en-US/docs/Web/API/CacheStorage</a>.</li>
      <li class="bulletList">For more examples of service workers, refer to the Workbox website at <a href="https://developers.google.com/web/tools/workbox">https://developers.google.com/web/tools/workbox</a>.</li>
      <li class="bulletList">For more information on Microsoft’s <code class="inlineCode">PWABuilder</code>, refer to <a href="https://www.pwabuilder.com">https://www.pwabuilder.com</a>.</li>
      <li class="bulletList">For a PWA image generator, refer to <a href="https://www.pwabuilder.com/imageGenerator">https://www.pwabuilder.com/imageGenerator</a>.</li>
      <li class="bulletList">For more information on <code class="inlineCode">Bootstrap</code>, refer to <a href="https://getbootstrap.com/">https://getbootstrap.com/</a>.</li>
    </ul>
  </div>
</body></html>