<html><head></head><body>
<div id="_idContainer209">
<h1 class="chapter-number" id="_idParaDest-355"><a id="_idTextAnchor354"/><span class="koboSpan" id="kobo.1.1">17</span></h1>
<h1 id="_idParaDest-356"><a id="_idTextAnchor355"/><span class="koboSpan" id="kobo.2.1">Agile Refactoring</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In this final chapter, we’ll talk about refactoring as part of an </span><em class="italic"><span class="koboSpan" id="kobo.4.1">agile</span></em><span class="koboSpan" id="kobo.5.1"> team, succeeding with larger refactoring efforts, recovering when things go wrong, and incorporating deployment strategies to help make sure they don’t go </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">wrong again.</span></span></p>
<p><span class="koboSpan" id="kobo.7.1">It’s possible to win many small refactoring battles with small pieces of offending code but lose the overall “war” when you can’t address large-scale design issues. </span><span class="koboSpan" id="kobo.7.2">This chapter explores how to continue to fight and win the smaller refactoring battles with your code from sprint to sprint. </span><span class="koboSpan" id="kobo.7.3">We will also cover the larger strategic battle of making sure your application has the right design – and correct it to something better when </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">it doesn’t.</span></span></p>
<p><span class="koboSpan" id="kobo.9.1">This chapter covers the </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.11.1">Refactoring in an </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">agile environment</span></span></li>
<li><span class="koboSpan" id="kobo.13.1">Succeeding with agile </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">refactoring strategies</span></span></li>
<li><span class="koboSpan" id="kobo.15.1">Accomplishing </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">large-scale refactorings</span></span></li>
<li><span class="koboSpan" id="kobo.17.1">Recovering when refactoring </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">goes wrong</span></span></li>
<li><span class="koboSpan" id="kobo.19.1">Deploying </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">large-scale refactorings</span></span></li>
</ul>
<h1 id="_idParaDest-357"><a id="_idTextAnchor356"/><span class="koboSpan" id="kobo.21.1">Refactoring in an agile environment</span></h1>
<p><span class="koboSpan" id="kobo.22.1">Almost all development </span><a id="_idIndexMarker953"/><span class="koboSpan" id="kobo.23.1">teams I work with use some form of </span><strong class="bold"><span class="koboSpan" id="kobo.24.1">agile software development</span></strong><span class="koboSpan" id="kobo.25.1"> to manage work over time in the form of short sprints, including any </span><a id="_idIndexMarker954"/><span class="No-Break"><span class="koboSpan" id="kobo.26.1">refactoring work.</span></span></p>
<p><span class="koboSpan" id="kobo.27.1">In this section, we’ll cover the basics of agile workflows and how refactoring can fit into this type of environment. </span><span class="koboSpan" id="kobo.27.2">This is important because if refactoring work can’t fit into an agile workflow, refactoring simply </span><span class="No-Break"><span class="koboSpan" id="kobo.28.1">won’t happen.</span></span></p>
<h2 id="_idParaDest-358"><a id="_idTextAnchor357"/><span class="koboSpan" id="kobo.29.1">Key elements of agile teams</span></h2>
<p><span class="koboSpan" id="kobo.30.1">Agile </span><a id="_idIndexMarker955"/><span class="koboSpan" id="kobo.31.1">software development was officially codified in the </span><em class="italic"><span class="koboSpan" id="kobo.32.1">Manifesto for Agile Software Development </span></em><span class="koboSpan" id="kobo.33.1">(commonly</span><a id="_idIndexMarker956"/><span class="koboSpan" id="kobo.34.1"> called the </span><em class="italic"><span class="koboSpan" id="kobo.35.1">Agile Manifesto</span></em><span class="koboSpan" id="kobo.36.1">) and flows from the following </span><span class="No-Break"><span class="koboSpan" id="kobo.37.1">core preferences:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.38.1">Individuals and interactions</span></strong><span class="koboSpan" id="kobo.39.1"> over processes </span><span class="No-Break"><span class="koboSpan" id="kobo.40.1">and tools</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.41.1">Working software</span></strong><span class="koboSpan" id="kobo.42.1"> over </span><span class="No-Break"><span class="koboSpan" id="kobo.43.1">comprehensive documentation</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.44.1">Customer collaboration</span></strong><span class="koboSpan" id="kobo.45.1"> over </span><span class="No-Break"><span class="koboSpan" id="kobo.46.1">contract negotiation</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.47.1">Responding to change</span></strong><span class="koboSpan" id="kobo.48.1"> over following </span><span class="No-Break"><span class="koboSpan" id="kobo.49.1">a plan</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.50.1">Following these guiding principles, the exact “flavor” of agile differs from team to team, but most teams adopt the following </span><span class="No-Break"><span class="koboSpan" id="kobo.51.1">key components:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.52.1">Sprints</span></strong><span class="koboSpan" id="kobo.53.1">: Work</span><a id="_idIndexMarker957"/><span class="koboSpan" id="kobo.54.1"> is conducted during fixed-duration periods called sprints. </span><span class="koboSpan" id="kobo.54.2">These range anywhere from 1 to 4 weeks, but 2 weeks is </span><span class="No-Break"><span class="koboSpan" id="kobo.55.1">the norm.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.56.1">User stories</span></strong><span class="koboSpan" id="kobo.57.1">: Work</span><a id="_idIndexMarker958"/><span class="koboSpan" id="kobo.58.1"> is tracked in the form of work items or user stories. </span><span class="koboSpan" id="kobo.58.2">Many teams require that any code change be associated with at least one </span><span class="No-Break"><span class="koboSpan" id="kobo.59.1">work item.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.60.1">Backlogs</span></strong><span class="koboSpan" id="kobo.61.1">: The </span><a id="_idIndexMarker959"/><span class="koboSpan" id="kobo.62.1">work for each sprint is taken from a prioritized backlog of user stories the team has previously reviewed </span><span class="No-Break"><span class="koboSpan" id="kobo.63.1">and refined.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.64.1">The exact details, roles, and names of things may vary from organization to organization, but these truths </span><span class="No-Break"><span class="koboSpan" id="kobo.65.1">generally apply.</span></span></p>
<p><span class="koboSpan" id="kobo.66.1">This process creates an iterative and cyclical process where the team works on the work items the business considers the most important in one sprint while prioritizing and refining items for the following sprint, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.67.1">Figure 17</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.68.1">.1</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.69.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer199">
<span class="koboSpan" id="kobo.70.1"><img alt="Figure 17.1 – The cycle of agile software development" src="image/B21324_17_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.71.1">Figure 17.1 – The cycle of agile software development</span></p>
<p><span class="koboSpan" id="kobo.72.1">Agile is </span><a id="_idIndexMarker960"/><span class="koboSpan" id="kobo.73.1">currently the best methodology we’ve found for software engineering in a business setting, but it does pose some unique obstacles to refactoring. </span><span class="koboSpan" id="kobo.73.2">See the </span><em class="italic"><span class="koboSpan" id="kobo.74.1">Further reading</span></em><span class="koboSpan" id="kobo.75.1"> section at the end of this chapter for additional resources </span><span class="No-Break"><span class="koboSpan" id="kobo.76.1">on agile.</span></span></p>
<h2 id="_idParaDest-359"><a id="_idTextAnchor358"/><span class="koboSpan" id="kobo.77.1">Understanding obstacles to refactoring</span></h2>
<p><span class="koboSpan" id="kobo.78.1">Agile is good for getting teams</span><a id="_idIndexMarker961"/><span class="koboSpan" id="kobo.79.1"> working on items that are important to the business and working through a prioritized backlog. </span><span class="koboSpan" id="kobo.79.2">Unfortunately, agile may not be the best development modality for proactive </span><span class="No-Break"><span class="koboSpan" id="kobo.80.1">refactoring work.</span></span></p>
<p><span class="koboSpan" id="kobo.81.1">Most organizations require all code changes to be associated with at least one user story and developers are expected to be working on user stories when they have </span><span class="No-Break"><span class="koboSpan" id="kobo.82.1">spare capacity.</span></span></p>
<p><span class="koboSpan" id="kobo.83.1">This leaves engineers in a conundrum where they know the areas of code that need to be refactored and have the technical skills and knowledge to refactor them, yet it is not acceptable within the boundaries of their teams for them to proactively improve code outside the bounds of an assigned </span><span class="No-Break"><span class="koboSpan" id="kobo.84.1">user story.</span></span></p>
<p><span class="koboSpan" id="kobo.85.1">This causes technical debt to pile up and eventually decays the team’s velocity by slowing down work items. </span><span class="koboSpan" id="kobo.85.2">This also results in a greater number of bugs being introduced because the team has not been allowed to proactively manage the risk inherent in their </span><span class="No-Break"><span class="koboSpan" id="kobo.86.1">legacy code.</span></span></p>
<p><span class="koboSpan" id="kobo.87.1">This isn’t to say that agile is bad. </span><span class="koboSpan" id="kobo.87.2">Agile is the best process we’ve found so far to manage work in software engineering teams; however, it has some limitations that must be solved to help organizations achieve both short-term and </span><span class="No-Break"><span class="koboSpan" id="kobo.88.1">long-term success.</span></span></p>
<h1 id="_idParaDest-360"><a id="_idTextAnchor359"/><span class="koboSpan" id="kobo.89.1">Succeeding with agile refactoring strategies</span></h1>
<p><span class="koboSpan" id="kobo.90.1">Ongoing refactoring is important in an agile environment, so let’s talk about some ways of making sure code gets </span><span class="No-Break"><span class="koboSpan" id="kobo.91.1">refactored regularly.</span></span></p>
<h2 id="_idParaDest-361"><a id="_idTextAnchor360"/><span class="koboSpan" id="kobo.92.1">Dedicated work items for refactoring efforts</span></h2>
<p><span class="koboSpan" id="kobo.93.1">Remember that every line of code</span><a id="_idIndexMarker962"/><span class="koboSpan" id="kobo.94.1"> you and your team write should deliver business value, including your </span><span class="No-Break"><span class="koboSpan" id="kobo.95.1">refactoring efforts.</span></span></p>
<p><span class="koboSpan" id="kobo.96.1">Refactoring focuses on delivering value to the business by addressing known areas of technical risk and improving the speed the team can achieve in the future on related work in the </span><span class="No-Break"><span class="koboSpan" id="kobo.97.1">targeted area.</span></span></p>
<p><span class="koboSpan" id="kobo.98.1">Given these facts, it makes sense that refactoring efforts should be represented inside a sprint as user stories. </span><span class="koboSpan" id="kobo.98.2">Just as one developer might get a user story about integrating with a new external system for a partner, another developer might get a user story to refactor and establish additional tests around the data </span><span class="No-Break"><span class="koboSpan" id="kobo.99.1">access layer.</span></span></p>
<p><span class="koboSpan" id="kobo.100.1">In </span><a href="B21324_15.xhtml#_idTextAnchor316"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.101.1">Chapter 15</span></em></span></a><span class="koboSpan" id="kobo.102.1">, we discussed tracking technical debt in a risk register. </span><span class="koboSpan" id="kobo.102.2">I didn’t make it explicit in that chapter, but you can use the same system that tracks your user stories to track your known technical risks as a specialized type of user story, such as the one shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.103.1">Figure 17</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.104.1">.2</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.105.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer200">
<span class="koboSpan" id="kobo.106.1"><img alt="Figure 17.2 – A technical debt item in Azure DevOps" src="image/B21324_17_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.107.1">Figure 17.2 – A technical debt item in Azure DevOps</span></p>
<p><span class="koboSpan" id="kobo.108.1">These technical debt user stories should look just like normal user stories and have the same degree of polish and refinement. </span><span class="koboSpan" id="kobo.108.2">However, these user stories should have a different type or a property with a different value so that you can identify technical debt items in your backlog </span><span class="No-Break"><span class="koboSpan" id="kobo.109.1">and sprints.</span></span></p>
<p><span class="koboSpan" id="kobo.110.1">Additionally, it should be the responsibility of the developers on the team to write up these technical debt items and not the product owner, though the team will still need to walk the product owner through what the item is, the rough amount of effort needed to remediate it, and the risk the change is looking </span><span class="No-Break"><span class="koboSpan" id="kobo.111.1">to resolve.</span></span></p>
<p><span class="koboSpan" id="kobo.112.1">Healthy agile teams should take a mixture of short-term and long-term items, with technical debt items typically falling in the </span><span class="No-Break"><span class="koboSpan" id="kobo.113.1">long-term bucket.</span></span></p>
<p><span class="koboSpan" id="kobo.114.1">There may </span><a id="_idIndexMarker963"/><span class="koboSpan" id="kobo.115.1">be times when you cannot do anything but short-term work and there may be times when you work with a product owner that doesn’t understand the risk present in your technical debt. </span><span class="koboSpan" id="kobo.115.2">The suggestions from </span><a href="B21324_15.xhtml#_idTextAnchor316"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.116.1">Chapter 15</span></em></span></a><span class="koboSpan" id="kobo.117.1"> may help with this, but sometimes, there won’t be an </span><span class="No-Break"><span class="koboSpan" id="kobo.118.1">easy answer.</span></span></p>
<p><span class="koboSpan" id="kobo.119.1">In these times, you may need to shift to a strategy of refactoring any code </span><span class="No-Break"><span class="koboSpan" id="kobo.120.1">that changes.</span></span></p>
<h2 id="_idParaDest-362"><a id="_idTextAnchor361"/><span class="koboSpan" id="kobo.121.1">Refactoring code as it changes</span></h2>
<p><span class="koboSpan" id="kobo.122.1">Most of the technical debt I’ve </span><a id="_idIndexMarker964"/><span class="koboSpan" id="kobo.123.1">addressed over my career has come from the conscious decision to refactor any code </span><span class="No-Break"><span class="koboSpan" id="kobo.124.1">I touch.</span></span></p>
<p><span class="koboSpan" id="kobo.125.1">This approach of refactoring code that changes has several </span><span class="No-Break"><span class="koboSpan" id="kobo.126.1">key benefits:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.127.1">It ensures the areas that are changed most frequently </span><span class="No-Break"><span class="koboSpan" id="kobo.128.1">get refactored.</span></span></li>
<li><span class="koboSpan" id="kobo.129.1">Since I’m working in that area anyway, I know I will be testing the code in question. </span><span class="koboSpan" id="kobo.129.2">This means that these testing efforts will help catch any issues that might be addressed as part </span><span class="No-Break"><span class="koboSpan" id="kobo.130.1">of refactoring.</span></span></li>
<li><span class="koboSpan" id="kobo.131.1">It does not require the overhead of separate user stories for small, trivial </span><span class="No-Break"><span class="koboSpan" id="kobo.132.1">refactoring efforts.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.133.1">In my experience, making it part of your policy to clean up and test the code around the areas you touch results in a much cleaner codebase </span><span class="No-Break"><span class="koboSpan" id="kobo.134.1">over time.</span></span></p>
<p><span class="koboSpan" id="kobo.135.1">This approach has its</span><a id="_idIndexMarker965"/><span class="koboSpan" id="kobo.136.1"> limitations: when you are making a minor change in one area of code and the code needs serious refactoring efforts, it is typically irresponsible to expand the scope of your work item beyond a </span><span class="No-Break"><span class="koboSpan" id="kobo.137.1">certain point.</span></span></p>
<p><span class="koboSpan" id="kobo.138.1">Additionally, some refactoring efforts cannot be achieved within the context of a single sprint and need more strategic thought and planning </span><span class="No-Break"><span class="koboSpan" id="kobo.139.1">behind them.</span></span></p>
<h2 id="_idParaDest-363"><a id="_idTextAnchor362"/><span class="koboSpan" id="kobo.140.1">Refactoring sprints</span></h2>
<p><span class="koboSpan" id="kobo.141.1">One concept I’ve encountered once o</span><a id="_idIndexMarker966"/><span class="koboSpan" id="kobo.142.1">r twice has been the idea of a </span><strong class="bold"><span class="koboSpan" id="kobo.143.1">refactoring sprint</span></strong><span class="koboSpan" id="kobo.144.1">. </span><span class="koboSpan" id="kobo.144.2">A refactoring sprint follows the mentality of crop rotation </span><span class="No-Break"><span class="koboSpan" id="kobo.145.1">in farming.</span></span></p>
<p><span class="koboSpan" id="kobo.146.1">I’m no farmer, but my understanding of crop rotation is that you can use a field for several seasons, but over time, that field starts to lose the nutrient values from the soil and becomes less productive as years </span><span class="No-Break"><span class="koboSpan" id="kobo.147.1">go on.</span></span></p>
<p><span class="koboSpan" id="kobo.148.1">To combat this, farmers learned to leave these fields fallow and not grow anything in them for a time, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.149.1">Figure 17</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.150.1">.3</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.151.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer201">
<span class="koboSpan" id="kobo.152.1"><img alt="Figure 17.3 – Rotating crops over several years" src="image/B21324_17_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.153.1">Figure 17.3 – Rotating crops over several years</span></p>
<p><span class="koboSpan" id="kobo.154.1">Applied to agile development, you might spend several sprints working on normal work items, but after a handful of sprints, you introduce a refactoring sprint where the team’s effort goes into refactoring the areas of code that concern the team </span><span class="No-Break"><span class="koboSpan" id="kobo.155.1">the most.</span></span></p>
<p><span class="koboSpan" id="kobo.156.1">In refactoring sprints, the development team can take on larger-scale efforts than they might otherwise try as part of a </span><span class="No-Break"><span class="koboSpan" id="kobo.157.1">standard sprint.</span></span></p>
<p><span class="koboSpan" id="kobo.158.1">This also has the side effect of re-energizing your developers and getting them ready for another sequence of sprints around a key long-term </span><span class="No-Break"><span class="koboSpan" id="kobo.159.1">business objective.</span></span></p>
<p><span class="koboSpan" id="kobo.160.1">In practicality, I’m not sure how well these sprints work regularly, but I’ve seen teams benefit from them tremendously in special scenarios. </span><span class="koboSpan" id="kobo.160.2">These refactoring sprints can be used to tackle larger problems or as a way of recharging the team after a major initiative is completed. </span><span class="koboSpan" id="kobo.160.3">I’ve also</span><a id="_idIndexMarker967"/><span class="koboSpan" id="kobo.161.1"> seen these sprints used as a way of keeping the team engaged during </span><span class="No-Break"><span class="koboSpan" id="kobo.162.1">holiday seasons.</span></span></p>
<h2 id="_idParaDest-364"><a id="_idTextAnchor363"/><span class="koboSpan" id="kobo.163.1">Refactoring sabbaticals</span></h2>
<p><span class="koboSpan" id="kobo.164.1">Most teams I’ve worked with </span><a id="_idIndexMarker968"/><span class="koboSpan" id="kobo.165.1">simply can’t afford to have all their developers work primarily on refactoring efforts, even for a </span><span class="No-Break"><span class="koboSpan" id="kobo.166.1">single sprint.</span></span></p>
<p><span class="koboSpan" id="kobo.167.1">Teams like this may want to take the idea of a refactoring sprint and scale it down so that it applies to just a single </span><span class="No-Break"><span class="koboSpan" id="kobo.168.1">team member.</span></span></p>
<p><span class="koboSpan" id="kobo.169.1">I call this concept a </span><strong class="bold"><span class="koboSpan" id="kobo.170.1">refactoring sabbatical</span></strong><span class="koboSpan" id="kobo.171.1">, where the developer effectively splits off of the team for a short time to work on a refactoring project, only to rejoin the larger team in the </span><span class="No-Break"><span class="koboSpan" id="kobo.172.1">next sprint.</span></span></p>
<p><span class="koboSpan" id="kobo.173.1">In a future sprint, another developer gets to spend a sprint working on refactoring efforts while others work on traditional work items, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.174.1">Figure 17</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.175.1">.4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.176.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer202">
<span class="koboSpan" id="kobo.177.1"><img alt="Figure 17.4 – A rotating developer sabbatical over several sprints" src="image/B21324_17_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.178.1">Figure 17.4 – A rotating developer sabbatical over several sprints</span></p>
<p><span class="koboSpan" id="kobo.179.1">Under this model, the refactoring efforts the developer wants to take on should be pre-approved, reviewed, and tested by other developers on </span><span class="No-Break"><span class="koboSpan" id="kobo.180.1">the team.</span></span></p>
<p><span class="koboSpan" id="kobo.181.1">The developer on “sabbatical” should still be available for questions and work on emergency items. </span><span class="koboSpan" id="kobo.181.2">The only major change is that their work for a sprint is self-directed toward known </span><span class="No-Break"><span class="koboSpan" id="kobo.182.1">refactoring goals.</span></span></p>
<p><span class="koboSpan" id="kobo.183.1">This has some of the same morale-boosting effects as a refactoring sprint but on a smaller scale. </span><span class="koboSpan" id="kobo.183.2">This also helps prevent teams from over-relying on any one person on the team, because people rotate into and out of </span><span class="No-Break"><span class="koboSpan" id="kobo.184.1">sabbaticals frequently.</span></span></p>
<p><span class="koboSpan" id="kobo.185.1">While this model may see success in small and medium-sized refactorings, it is less effective in large-scale refactorings. </span><span class="koboSpan" id="kobo.185.2">We’ll discuss ways of succeeding with larger </span><span class="No-Break"><span class="koboSpan" id="kobo.186.1">refactorings next.</span></span></p>
<h1 id="_idParaDest-365"><a id="_idTextAnchor364"/><span class="koboSpan" id="kobo.187.1">Accomplishing large-scale refactorings</span></h1>
<p><span class="koboSpan" id="kobo.188.1">In my experience, successfully </span><a id="_idIndexMarker969"/><span class="koboSpan" id="kobo.189.1">performing large-scale refactorings is one of the hardest challenges in all of </span><span class="No-Break"><span class="koboSpan" id="kobo.190.1">software engineering.</span></span></p>
<p><span class="koboSpan" id="kobo.191.1">I define large-scale refactoring as something on the scale of replacing an application or a major architectural layer of an application. </span><span class="koboSpan" id="kobo.191.2">Moving an application from one database technology to another, replacing a REST API with a gRPC API, upgrading from Web Forms to Blazor, or replacing your entire service layer are all examples </span><span class="No-Break"><span class="koboSpan" id="kobo.192.1">of this.</span></span></p>
<h2 id="_idParaDest-366"><a id="_idTextAnchor365"/><span class="koboSpan" id="kobo.193.1">Why large refactorings are difficult</span></h2>
<p><span class="koboSpan" id="kobo.194.1">These projects are challenging</span><a id="_idIndexMarker970"/><span class="koboSpan" id="kobo.195.1"> because they typically take longer than a single sprint to accomplish and must meet feature parity with software that has been developed over </span><span class="No-Break"><span class="koboSpan" id="kobo.196.1">the years.</span></span></p>
<p><span class="koboSpan" id="kobo.197.1">Additionally, software engineering projects are notoriously hard to accurately estimate, which is one of the reasons developers prefer agile software development over more traditional project management </span><a id="_idIndexMarker971"/><span class="koboSpan" id="kobo.198.1">methodologies such as </span><strong class="bold"><span class="koboSpan" id="kobo.199.1">waterfall</span></strong><span class="koboSpan" id="kobo.200.1">. </span><span class="koboSpan" id="kobo.200.2">Delays in software development projects can be difficult to predict and manifest in the form of unexpected technical obstacles, such as previously unknown limitations of other components or platforms or subtle bugs </span><span class="No-Break"><span class="koboSpan" id="kobo.201.1">slowing development.</span></span></p>
<p><span class="koboSpan" id="kobo.202.1">Because of these factors, large refactoring efforts are significantly harder to achieve than medium </span><span class="No-Break"><span class="koboSpan" id="kobo.203.1">refactoring efforts.</span></span></p>
<p><span class="koboSpan" id="kobo.204.1">Once completed, the results of these efforts can be daunting to move into production environments as well because they represent such a large change. </span><span class="koboSpan" id="kobo.204.2">Later in this chapter, we’ll talk about a few ways of reducing this risk, but the decision to replace or upgrade major parts of your application is not one without </span><span class="No-Break"><span class="koboSpan" id="kobo.205.1">quality risks.</span></span></p>
<p><span class="koboSpan" id="kobo.206.1">This problem gets even more pronounced when teams choose to completely rewrite or replace software projects instead of </span><span class="No-Break"><span class="koboSpan" id="kobo.207.1">refactoring them.</span></span></p>
<h2 id="_idParaDest-367"><a id="_idTextAnchor366"/><span class="koboSpan" id="kobo.208.1">The rewrite trap</span></h2>
<p><span class="koboSpan" id="kobo.209.1">Rewrites</span><a id="_idIndexMarker972"/><span class="koboSpan" id="kobo.210.1"> take all the problems of large refactoring efforts and multiply them by a factor of at </span><span class="No-Break"><span class="koboSpan" id="kobo.211.1">least 10.</span></span></p>
<p><span class="koboSpan" id="kobo.212.1">In this scenario, you are replacing an application that has been used for some time and typically has a significant number of active users and </span><span class="No-Break"><span class="koboSpan" id="kobo.213.1">established features.</span></span></p>
<p><span class="koboSpan" id="kobo.214.1">It can be a struggle to re-implement years’ worth of features while keeping up with production bugs and other short-term work that must happen to keep the business </span><span class="No-Break"><span class="koboSpan" id="kobo.215.1">running smoothly.</span></span></p>
<p><span class="koboSpan" id="kobo.216.1">When a team is actively working on a rewrite, they usually see little value in targeted refactorings of the current system they’re working on replacing. </span><span class="koboSpan" id="kobo.216.2">This means that if a rewrite is canceled or put on hold, the team gets no value out of their investment and still has a legacy system that needs to </span><span class="No-Break"><span class="koboSpan" id="kobo.217.1">be supported.</span></span></p>
<p><span class="koboSpan" id="kobo.218.1">Since software projects are hard to estimate and manage, rewrites frequently take much longer than you expect them to. </span><span class="koboSpan" id="kobo.218.2">During this time, your engineers are working primarily on the rewrite, which takes capacity away from </span><span class="No-Break"><span class="koboSpan" id="kobo.219.1">other initiatives.</span></span></p>
<p><span class="koboSpan" id="kobo.220.1">Remember that a rewrite usually provides no intrinsic value to the business or the users until it is active in a production environment and people are working with it live. </span><span class="koboSpan" id="kobo.220.2">This is why so few rewrite </span><span class="No-Break"><span class="koboSpan" id="kobo.221.1">projects succeed.</span></span></p>
<p><span class="koboSpan" id="kobo.222.1">You can remediate this by offering early previews of a partial rewrite, but this is not always possible and may not be the best user experience if important features are not present yet in </span><span class="No-Break"><span class="koboSpan" id="kobo.223.1">the rewrite.</span></span></p>
<h2 id="_idParaDest-368"><a id="_idTextAnchor367"/><span class="koboSpan" id="kobo.224.1">Lessons from the ship of Theseus</span></h2>
<p><span class="koboSpan" id="kobo.225.1">There’s a thought experiment about the Greek hero Theseus that is relevant to </span><span class="No-Break"><span class="koboSpan" id="kobo.226.1">refactoring software.</span></span></p>
<p><span class="koboSpan" id="kobo.227.1">In this thought </span><a id="_idIndexMarker973"/><span class="koboSpan" id="kobo.228.1">experiment, </span><strong class="bold"><span class="koboSpan" id="kobo.229.1">the ship of Theseus</span></strong><span class="koboSpan" id="kobo.230.1">, our hero, Theseus, sets sail on a long journey by sea. </span><span class="koboSpan" id="kobo.230.2">Throughout his long voyages, the crew gradually replaced pieces of the ship with spare materials and materials they made or found on their voyages. </span><span class="koboSpan" id="kobo.230.3">This continued for some time until there wasn’t a single piece of the original ship left in his ship as he </span><span class="No-Break"><span class="koboSpan" id="kobo.231.1">returned home.</span></span></p>
<p><span class="koboSpan" id="kobo.232.1">This thought experiment asks whether the ship that came home is the same, and if it isn’t, when did it stop being </span><span class="No-Break"><span class="koboSpan" id="kobo.233.1">that ship?</span></span></p>
<p><span class="koboSpan" id="kobo.234.1">While these are interesting philosophical questions, the concept is relevant to </span><span class="No-Break"><span class="koboSpan" id="kobo.235.1">software engineering.</span></span></p>
<p><span class="koboSpan" id="kobo.236.1">Using refactoring, we can replace the “planks” of our virtual “ship” as technical debt takes hold in various areas. </span><span class="koboSpan" id="kobo.236.2">As we gradually refactor the components that need it the most, we continually evolve our software to stay relevant </span><span class="No-Break"><span class="koboSpan" id="kobo.237.1">over time.</span></span></p>
<p><span class="koboSpan" id="kobo.238.1">This is why I view refactoring </span><a id="_idIndexMarker974"/><span class="koboSpan" id="kobo.239.1">code as you write code as a critically important practice in software engineering. </span><span class="koboSpan" id="kobo.239.2">Technical debt is an inescapable reality of software and you must keep it in mind with every change you make by doing what you can to prevent it from taking hold and paying down existing debt areas </span><span class="No-Break"><span class="koboSpan" id="kobo.240.1">through refactoring.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.241.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.242.1">Gradual refactoring only goes so far. </span><span class="koboSpan" id="kobo.242.2">Progressive refactoring may help keep your virtual “boat” afloat, but it won’t turn a rowboat into a cruise liner </span><span class="No-Break"><span class="koboSpan" id="kobo.243.1">or submarine.</span></span></p>
<p><span class="koboSpan" id="kobo.244.1">Put more clearly, refactoring won’t help you move from an antiquated technology to a more modern one. </span><span class="koboSpan" id="kobo.244.2">Let’s look at a tool that might help </span><span class="No-Break"><span class="koboSpan" id="kobo.245.1">with that.</span></span></p>
<h2 id="_idParaDest-369"><a id="_idTextAnchor368"/><span class="koboSpan" id="kobo.246.1">Upgrading projects with.NET Upgrade Assistant</span></h2>
<p><span class="koboSpan" id="kobo.247.1">As new versions of .NET come out and new technologies emerge within the .NET ecosystem, keeping up can be </span><span class="No-Break"><span class="koboSpan" id="kobo.248.1">a challenge.</span></span></p>
<p><span class="koboSpan" id="kobo.249.1">To address this, Microsoft </span><a id="_idIndexMarker975"/><span class="koboSpan" id="kobo.250.1">introduced </span><strong class="bold"><span class="koboSpan" id="kobo.251.1">.NET Upgrade Assistant</span></strong><span class="koboSpan" id="kobo.252.1">, which helps you safely upgrade and modernize your applications. </span><span class="koboSpan" id="kobo.252.2">At the time of writing, this tool has been useful with projects written with the </span><span class="No-Break"><span class="koboSpan" id="kobo.253.1">following technologies:</span></span></p>
<ul>
<li><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.254.1">ASP.NET</span></strong></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.255.1">Universal Windows </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.256.1">Platform</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.257.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.258.1">UWP</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.259.1">)</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.260.1">Windows Communication </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.261.1">Foundation</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.262.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.263.1">WCF</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.264.1">)</span></span></li>
<li><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.265.1">Windows Forms</span></strong></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.266.1">Windows Presentation </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.267.1">Foundation</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.268.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.269.1">WPF</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.270.1">)</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.271.1">.NET Upgrade Assistant</span><a id="_idIndexMarker976"/><span class="koboSpan" id="kobo.272.1"> can be installed either as a global tool or as a Visual Studio extension, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.273.1">Figure 17</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.274.1">.5</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.275.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer203">
<span class="koboSpan" id="kobo.276.1"><img alt="Figure 17.5 – Installing.NET Upgrade Assistant in Visual Studio" src="image/B21324_17_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.277.1">Figure 17.5 – Installing.NET Upgrade Assistant in Visual Studio</span></p>
<p><span class="koboSpan" id="kobo.278.1">Once the extension has been installed, you will be able to right-click on a project in </span><strong class="bold"><span class="koboSpan" id="kobo.279.1">Solution Explorer</span></strong><span class="koboSpan" id="kobo.280.1"> and </span><span class="No-Break"><span class="koboSpan" id="kobo.281.1">choose </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.282.1">Upgrade</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.283.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.284.1">From there, you’ll be able to configure a set of options on your project that will vary based on the technologies you use. </span><span class="koboSpan" id="kobo.284.2">You’ll also be able to configure the scope of the upgrade attempt and include and exclude files of </span><span class="No-Break"><span class="koboSpan" id="kobo.285.1">your choosing.</span></span></p>
<p><span class="koboSpan" id="kobo.286.1">Once the upgrade runs, you’ll see a list of projects and files that were updated and see details in the log, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.287.1">Figure 17</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.288.1">.6</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.289.1">:</span></span></p>
<p class="IMG---Figure"> </p>
<div>
<div class="IMG---Figure" id="_idContainer204">
<span class="koboSpan" id="kobo.290.1"><img alt="Figure 17.6 – .NET Upgrade Assistant in action" src="image/B21324_17_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.291.1">Figure 17.6 – .NET Upgrade Assistant in action</span></p>
<p><span class="koboSpan" id="kobo.292.1">You should </span><a id="_idIndexMarker977"/><span class="koboSpan" id="kobo.293.1">make sure your project is properly backed up and in source control before attempting an upgrade and you may need to resolve certain issues yourself, but this tool can be very useful for starting an upgrade in an </span><span class="No-Break"><span class="koboSpan" id="kobo.294.1">automated manner.</span></span></p>
<p><span class="koboSpan" id="kobo.295.1">For applications that can’t be easily upgraded with .NET Upgrade Assistant, you may need some more creative strategies, which we’ll talk </span><span class="No-Break"><span class="koboSpan" id="kobo.296.1">about next.</span></span></p>
<h2 id="_idParaDest-370"><a id="_idTextAnchor369"/><span class="koboSpan" id="kobo.297.1">Refactoring and the strangler fig pattern</span></h2>
<p><span class="koboSpan" id="kobo.298.1">In 2004, Martin Folwer</span><a id="_idIndexMarker978"/><span class="koboSpan" id="kobo.299.1"> introduced the </span><strong class="bold"><span class="koboSpan" id="kobo.300.1">strangler fig pattern</span></strong><span class="koboSpan" id="kobo.301.1"> to the software community in a post he </span><span class="No-Break"><span class="koboSpan" id="kobo.302.1">titled </span></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.303.1">StranglerFigApplication</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.304.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.305.1">In this post, Martin Fowler describes how certain fig trees, such as the Banyan Tree pictured in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.306.1">Figure 17</span></em></span><em class="italic"><span class="koboSpan" id="kobo.307.1">.7</span></em><span class="koboSpan" id="kobo.308.1">, wrap themselves around other trees and gradually replace the structure of the </span><span class="No-Break"><span class="koboSpan" id="kobo.309.1">other tree:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer205">
<span class="koboSpan" id="kobo.310.1"><img alt="Figure 17.7 – Photo of a banyan tree by Ankit Bhattacharjee" src="image/B21324_17_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.311.1">Figure 17.7 – Photo of a banyan tree by Ankit Bhattacharjee</span></p>
<p><span class="koboSpan" id="kobo.312.1">Over time, this</span><a id="_idIndexMarker979"/><span class="koboSpan" id="kobo.313.1"> strangler fig assumes more and more of the structure of the tree and it effectively becomes a whole </span><span class="No-Break"><span class="koboSpan" id="kobo.314.1">new tree.</span></span></p>
<p><span class="koboSpan" id="kobo.315.1">In this metaphor, the tree would be the legacy application you’re trying to replace while the various vines from the strangler fig represent </span><span class="No-Break"><span class="koboSpan" id="kobo.316.1">your rewrite.</span></span></p>
<p><span class="koboSpan" id="kobo.317.1">Under this model, you’re not trying to rewrite the entire application and replace it with a freshly </span><span class="No-Break"><span class="koboSpan" id="kobo.318.1">rewritten application.</span></span></p>
<p><span class="koboSpan" id="kobo.319.1">Instead, you take a single </span><strong class="bold"><span class="koboSpan" id="kobo.320.1">vertical slice</span></strong><span class="koboSpan" id="kobo.321.1"> of</span><a id="_idIndexMarker980"/><span class="koboSpan" id="kobo.322.1"> the application encompassing a core set of features and behaviors and you make a new implementation of them in a new technology. </span><span class="koboSpan" id="kobo.322.2">This might be a web page or a set of API endpoints, depending on what </span><span class="No-Break"><span class="koboSpan" id="kobo.323.1">you’re writing.</span></span></p>
<p><span class="koboSpan" id="kobo.324.1">Once you’ve rewritten this capability in your new technology, you redirect traffic for that one area from the old application to the new application. </span><span class="koboSpan" id="kobo.324.2">This allows you to ship parts of your new application to users incrementally, validate things in production, and then take on another vertical slice of </span><span class="No-Break"><span class="koboSpan" id="kobo.325.1">the application.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.326.1">Technical details</span></p>
<p class="callout"><span class="koboSpan" id="kobo.327.1">There are a few technologies that can help achieve this goal of replacing vertical slices of an application. </span><span class="koboSpan" id="kobo.327.2">Azure API Management can help direct web traffic to an appropriate endpoint in API Management. </span><span class="koboSpan" id="kobo.327.3">I’ve also seen </span><a id="_idIndexMarker981"/><span class="koboSpan" id="kobo.328.1">people succeed with </span><strong class="bold"><span class="koboSpan" id="kobo.329.1">Yet Another Reverse Proxy</span></strong><span class="koboSpan" id="kobo.330.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.331.1">YARP</span></strong><span class="koboSpan" id="kobo.332.1">) for these efforts. </span><span class="koboSpan" id="kobo.332.2">Links to both can be found in the </span><em class="italic"><span class="koboSpan" id="kobo.333.1">Further </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.334.1">reading</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.335.1"> section.</span></span></p>
<p><span class="koboSpan" id="kobo.336.1">As you expand your rewrite and validate it works, you can remove portions of the original application so that you no longer need to </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">maintain them.</span></span></p>
<p><span class="koboSpan" id="kobo.338.1">For areas that your new application doesn’t support yet, you can have it link back to existing areas on the </span><span class="No-Break"><span class="koboSpan" id="kobo.339.1">old application.</span></span></p>
<p><span class="koboSpan" id="kobo.340.1">The strangler fig approach has some</span><a id="_idIndexMarker982"/><span class="koboSpan" id="kobo.341.1"> key advantages compared to a </span><span class="No-Break"><span class="koboSpan" id="kobo.342.1">full rewrite:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.343.1">It allows you to iteratively deliver your rewrite </span><span class="No-Break"><span class="koboSpan" id="kobo.344.1">in stages</span></span></li>
<li><span class="koboSpan" id="kobo.345.1">It works better in an </span><span class="No-Break"><span class="koboSpan" id="kobo.346.1">agile environment</span></span></li>
<li><span class="koboSpan" id="kobo.347.1">It helps validate risk areas early instead of waiting for the </span><span class="No-Break"><span class="koboSpan" id="kobo.348.1">full rewrite</span></span></li>
<li><span class="koboSpan" id="kobo.349.1">It allows you to remove replaced code from the original if </span><span class="No-Break"><span class="koboSpan" id="kobo.350.1">you’d like</span></span></li>
<li><span class="koboSpan" id="kobo.351.1">It can be rolled out in parallel with the original as </span><span class="No-Break"><span class="koboSpan" id="kobo.352.1">a preview</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.353.1">Perhaps the biggest benefit of this pattern is that its success chance is significantly higher than attempting a </span><span class="No-Break"><span class="koboSpan" id="kobo.354.1">total rewrite.</span></span></p>
<p><span class="koboSpan" id="kobo.355.1">Let’s talk about what to do when refactoring isn’t </span><span class="No-Break"><span class="koboSpan" id="kobo.356.1">as successful.</span></span></p>
<h1 id="_idParaDest-371"><a id="_idTextAnchor370"/><span class="koboSpan" id="kobo.357.1">Recovering when refactoring goes wrong</span></h1>
<p><span class="koboSpan" id="kobo.358.1">Sometimes, despite your best efforts, refactoring efforts will fail. </span><span class="koboSpan" id="kobo.358.2">It may be due to gaps in your tests or mistaken assumptions about new technologies, but a certain percentage of your refactoring attempts </span><span class="No-Break"><span class="koboSpan" id="kobo.359.1">will fail.</span></span></p>
<h2 id="_idParaDest-372"><a id="_idTextAnchor371"/><span class="koboSpan" id="kobo.360.1">The impact of failed refactorings</span></h2>
<p><span class="koboSpan" id="kobo.361.1">Failed refactorings can be</span><a id="_idIndexMarker983"/><span class="koboSpan" id="kobo.362.1"> both frustrating and a serious challenge to future refactoring work. </span><span class="koboSpan" id="kobo.362.2">After all, a significant barrier to refactoring is the belief that legacy code is so brittle that touching it will break it. </span><span class="koboSpan" id="kobo.362.3">When you change code and it breaks, you make it harder to change code in </span><span class="No-Break"><span class="koboSpan" id="kobo.363.1">the future.</span></span></p>
<p><span class="koboSpan" id="kobo.364.1">When refactoring fails, you sometimes get to make a quick patch to address the issue you introduced. </span><span class="koboSpan" id="kobo.364.2">In this case, the code is refactored and service gets restored, but you’ve lost some of the </span><span class="No-Break"><span class="koboSpan" id="kobo.365.1">team’s trust.</span></span></p>
<p><span class="koboSpan" id="kobo.366.1">Other times, failures in refactoring result in code getting rolled back to the previous version before you refactored it. </span><span class="koboSpan" id="kobo.366.2">Sometimes, you’ll get to make changes, add additional tests, and retry this refactoring, while other times, the team will decide that the refactoring is too dangerous to try again and you’ll lose your shot at improving the code for </span><span class="No-Break"><span class="koboSpan" id="kobo.367.1">some time.</span></span></p>
<p><span class="koboSpan" id="kobo.368.1">Ultimately, this conversation boils down to how much the business trusts you to not </span><span class="No-Break"><span class="koboSpan" id="kobo.369.1">make mistakes.</span></span></p>
<p><span class="koboSpan" id="kobo.370.1">Mistakes in</span><a id="_idIndexMarker984"/><span class="koboSpan" id="kobo.371.1"> software development will happen because people are imperfect and make mistakes, assume things without realizing them, and don’t </span><span class="No-Break"><span class="koboSpan" id="kobo.372.1">know everything.</span></span></p>
<h2 id="_idParaDest-373"><a id="_idTextAnchor372"/><span class="koboSpan" id="kobo.373.1">Establishing safety in agile environments</span></h2>
<p><span class="koboSpan" id="kobo.374.1">What you want to do as a </span><a id="_idIndexMarker985"/><span class="koboSpan" id="kobo.375.1">technologist is create an environment where mistakes are infrequent and can easily and safely be caught before they reach </span><span class="No-Break"><span class="koboSpan" id="kobo.376.1">production environments.</span></span></p>
<p><span class="koboSpan" id="kobo.377.1">There are certain things you can do to reduce the odds of breaking software </span><span class="No-Break"><span class="koboSpan" id="kobo.378.1">when refactoring:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.379.1">Testing</span></strong><span class="koboSpan" id="kobo.380.1">: Unit tests, manual tests, and having your peers test your code in a different environment </span><a id="_idIndexMarker986"/><span class="koboSpan" id="kobo.381.1">can help you catch many mistakes and </span><span class="No-Break"><span class="koboSpan" id="kobo.382.1">some assumptions.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.383.1">Code review</span></strong><span class="koboSpan" id="kobo.384.1">: Teams that review changes before they ship to integration and production environments can catch bad assumptions, mistakes, and poor coding practices. </span><span class="koboSpan" id="kobo.384.2">Code review</span><a id="_idIndexMarker987"/><span class="koboSpan" id="kobo.385.1"> is also an opportunity for teams to share knowledge and techniques, as well as share knowledge of the codebase across the </span><span class="No-Break"><span class="koboSpan" id="kobo.386.1">dev team.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.387.1">Code analysis</span></strong><span class="koboSpan" id="kobo.388.1">: Using the </span><a id="_idIndexMarker988"/><span class="koboSpan" id="kobo.389.1">documented best practices in .NET and adhering to your team’s standards, as we talked about in </span><em class="italic"><span class="koboSpan" id="kobo.390.1">Part 3</span></em><span class="koboSpan" id="kobo.391.1"> of this book, can prevent issues the team has encountered before </span><span class="No-Break"><span class="koboSpan" id="kobo.392.1">from recurring.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.393.1">Automated tests</span></strong><span class="koboSpan" id="kobo.394.1">: Testing is so important I put it on here twice, but this time, I’m stressing that any </span><a id="_idIndexMarker989"/><span class="koboSpan" id="kobo.395.1">change getting merged into a release branch needs to have automated tests run against it and pass before it can move on. </span><span class="koboSpan" id="kobo.395.2">This ensures that tests are reliably and </span><span class="No-Break"><span class="koboSpan" id="kobo.396.1">repeatably run.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.397.1">Active monitoring</span></strong><span class="koboSpan" id="kobo.398.1">: Regular </span><a id="_idIndexMarker990"/><span class="koboSpan" id="kobo.399.1">monitoring of error and warning logs can help you detect problems early in production and </span><span class="No-Break"><span class="koboSpan" id="kobo.400.1">staging environments.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.401.1">Be honest and</span><a id="_idIndexMarker991"/><span class="koboSpan" id="kobo.402.1"> transparent when an issue occurs and follow this sequence </span><span class="No-Break"><span class="koboSpan" id="kobo.403.1">of steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.404.1">Confirm that the </span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">issue exists.</span></span></li>
<li><span class="koboSpan" id="kobo.406.1">Understand the issue enough to </span><span class="No-Break"><span class="koboSpan" id="kobo.407.1">resolve it.</span></span></li>
<li><span class="koboSpan" id="kobo.408.1">Resolve the issue and </span><span class="No-Break"><span class="koboSpan" id="kobo.409.1">restore service.</span></span></li>
<li><span class="koboSpan" id="kobo.410.1">Determine how you could have prevented the issue </span><span class="No-Break"><span class="koboSpan" id="kobo.411.1">from occurring.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.412.1">When you look at a bug getting past your defensive practices as a way of improving your processes and identifying gaps, it becomes a learning opportunity for </span><span class="No-Break"><span class="koboSpan" id="kobo.413.1">your team.</span></span></p>
<p><span class="koboSpan" id="kobo.414.1">Unfortunately, these learning opportunities do come with a penalty of lost trust from others due to </span><span class="No-Break"><span class="koboSpan" id="kobo.415.1">the issue.</span></span></p>
<p><span class="koboSpan" id="kobo.416.1">I’ve found that openly and honestly communicating the following things helps encourage understanding and somewhat heal </span><span class="No-Break"><span class="koboSpan" id="kobo.417.1">lost trust:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.418.1">The steps your team took to verify the item wouldn’t cause issues </span><span class="No-Break"><span class="koboSpan" id="kobo.419.1">before release</span></span></li>
<li><span class="koboSpan" id="kobo.420.1">The nature of the bug and how it got past </span><span class="No-Break"><span class="koboSpan" id="kobo.421.1">your team</span></span></li>
<li><span class="koboSpan" id="kobo.422.1">What you did to resolve it and </span><span class="No-Break"><span class="koboSpan" id="kobo.423.1">restore service</span></span></li>
<li><span class="koboSpan" id="kobo.424.1">What you’re </span><a id="_idIndexMarker992"/><span class="koboSpan" id="kobo.425.1">doing to ensure that things like it won’t be issues in </span><span class="No-Break"><span class="koboSpan" id="kobo.426.1">the future</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.427.1">This approach treats everyone with respect, shares understanding, provides opportunities for questions and suggestions, and assures them that the quality of the application is important to you and </span><span class="No-Break"><span class="koboSpan" id="kobo.428.1">your team.</span></span></p>
<p><span class="koboSpan" id="kobo.429.1">Before we close this chapter and this book as a whole, let’s talk about some helpful practices you may want to consider when </span><span class="No-Break"><span class="koboSpan" id="kobo.430.1">deploying software.</span></span></p>
<h1 id="_idParaDest-374"><a id="_idTextAnchor373"/><span class="koboSpan" id="kobo.431.1">Deploying large-scale refactorings</span></h1>
<p><span class="koboSpan" id="kobo.432.1">Let’s talk about some ways of </span><a id="_idIndexMarker993"/><span class="koboSpan" id="kobo.433.1">deploying code that can help you catch any issues that slip through before they become </span><span class="No-Break"><span class="koboSpan" id="kobo.434.1">major problems.</span></span></p>
<h2 id="_idParaDest-375"><a id="_idTextAnchor374"/><span class="koboSpan" id="kobo.435.1">Using feature flags</span></h2>
<p><strong class="bold"><span class="koboSpan" id="kobo.436.1">Feature flags</span></strong><span class="koboSpan" id="kobo.437.1"> are </span><a id="_idIndexMarker994"/><span class="koboSpan" id="kobo.438.1">configuration</span><a id="_idIndexMarker995"/><span class="koboSpan" id="kobo.439.1"> settings that control whether features </span><span class="No-Break"><span class="koboSpan" id="kobo.440.1">are active.</span></span></p>
<p><span class="koboSpan" id="kobo.441.1">When you push out new code that includes a new capability, that code doesn’t have to be immediately available. </span><span class="koboSpan" id="kobo.441.2">You can deploy as usual with the new feature area disabled in </span><span class="No-Break"><span class="koboSpan" id="kobo.442.1">the configuration.</span></span></p>
<p><span class="koboSpan" id="kobo.443.1">Once you’re confident the rest of the software is working as intended, you can enable the new feature. </span><span class="koboSpan" id="kobo.443.2">If the feature winds up having issues, you can quickly disable it by flipping the feature flag back to its </span><span class="No-Break"><span class="koboSpan" id="kobo.444.1">inactive state.</span></span></p>
<p><span class="koboSpan" id="kobo.445.1">While feature flags are helpful when you’re releasing actual features, you can also use them with major refactoring efforts. </span><span class="koboSpan" id="kobo.445.2">For example, a feature flag might govern whether the system uses </span><strong class="source-inline"><span class="koboSpan" id="kobo.446.1">LegacyBookingSystem</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.447.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.448.1">RevisedBookingSystem</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.449.1">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.450.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.451.1">Feature flag libraries pair nicely with A/B testing libraries such as Scientist .NET, which we covered in </span><a href="B21324_09.xhtml#_idTextAnchor189"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.452.1">Chapter 9</span></em></span></a><span class="No-Break"><span class="koboSpan" id="kobo.453.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.454.1">Popular feature</span><a id="_idIndexMarker996"/><span class="koboSpan" id="kobo.455.1"> flag tools </span><a id="_idIndexMarker997"/><span class="koboSpan" id="kobo.456.1">include </span><strong class="bold"><span class="koboSpan" id="kobo.457.1">Azure App Configuration</span></strong><span class="koboSpan" id="kobo.458.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.459.1">Launchdarkly</span></strong><span class="koboSpan" id="kobo.460.1">, but Microsoft also offers an open-source feature management library </span><a id="_idIndexMarker998"/><span class="koboSpan" id="kobo.461.1">called </span><strong class="bold"><span class="koboSpan" id="kobo.462.1">.NET </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.463.1">Feature Management</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.464.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.465.1">.NET Feature Management is surprisingly capable and integrates directly into your .NET applications, though it lacks some of the web monitoring capabilities a commercial software product </span><span class="No-Break"><span class="koboSpan" id="kobo.466.1">might have.</span></span></p>
<p><span class="koboSpan" id="kobo.467.1">Feature flags add complexity</span><a id="_idIndexMarker999"/><span class="koboSpan" id="kobo.468.1"> to your application but give you options for when your features go live. </span><span class="koboSpan" id="kobo.468.2">This lets you enable a feature, evaluate it</span><a id="_idIndexMarker1000"/><span class="koboSpan" id="kobo.469.1"> for correctness in a production environment, and then either disable it, patch any issues observed, or leave </span><span class="No-Break"><span class="koboSpan" id="kobo.470.1">it on.</span></span></p>
<h2 id="_idParaDest-376"><a id="_idTextAnchor375"/><span class="koboSpan" id="kobo.471.1">Phased rollouts and blue/green deployments</span></h2>
<p><strong class="bold"><span class="koboSpan" id="kobo.472.1">Phased rollouts</span></strong><span class="koboSpan" id="kobo.473.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.474.1">blue/green deployments</span></strong><span class="koboSpan" id="kobo.475.1"> take</span><a id="_idIndexMarker1001"/><span class="koboSpan" id="kobo.476.1"> the idea of feature </span><a id="_idIndexMarker1002"/><span class="koboSpan" id="kobo.477.1">flags to a different level. </span><span class="koboSpan" id="kobo.477.2">In this model, you have distinct sets of</span><a id="_idIndexMarker1003"/><span class="koboSpan" id="kobo.478.1"> servers, typically referred to as </span><a id="_idIndexMarker1004"/><span class="koboSpan" id="kobo.479.1">blue and </span><span class="No-Break"><span class="koboSpan" id="kobo.480.1">green environments.</span></span></p>
<p><span class="koboSpan" id="kobo.481.1">In a blue/green deployment, you might start with 100% of your users using one environment. </span><span class="koboSpan" id="kobo.481.2">During this time, you patch the other server with your new update and verify that it appears to be running correctly, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.482.1">Figure 17</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.483.1">.8</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.484.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer206">
<span class="koboSpan" id="kobo.485.1"><img alt="Figure 17.8 – Users using the blue environment while the green one is being updated" src="image/B21324_17_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.486.1">Figure 17.8 – Users using the blue environment while the green one is being updated</span></p>
<p><span class="koboSpan" id="kobo.487.1">Once you’re sure the new server is operational and running without issue, you can start diverting a percentage of your users onto the </span><span class="No-Break"><span class="koboSpan" id="kobo.488.1">new server.</span></span></p>
<p><span class="koboSpan" id="kobo.489.1">This subset of users represents real production traffic and can be used to monitor the behavior of your new release with a minimal set of users, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.490.1">Figure 17</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.491.1">.9</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.492.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer207">
<span class="koboSpan" id="kobo.493.1"><img alt="Figure 17.9 – The blue environment running most users while a subset of users are on green" src="image/B21324_17_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.494.1">Figure 17.9 – The blue environment running most users while a subset of users are on green</span></p>
<p><span class="koboSpan" id="kobo.495.1">If the new environment</span><a id="_idIndexMarker1005"/><span class="koboSpan" id="kobo.496.1"> starts to have issues, you can quickly move users off of that server and onto the old one, then take the </span><a id="_idIndexMarker1006"/><span class="koboSpan" id="kobo.497.1">new environment offline for maintenance until you’ve addressed the issues and are ready to </span><span class="No-Break"><span class="koboSpan" id="kobo.498.1">try again.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.499.1">Caution</span></p>
<p class="callout"><span class="koboSpan" id="kobo.500.1">When migrating to a new revision and then rolling back to the old one, you must take special care to ensure any database migrations still work appropriately. </span><span class="koboSpan" id="kobo.500.2">Tools such as Entity Framework’s up-and-down scripts can help </span><span class="No-Break"><span class="koboSpan" id="kobo.501.1">with this.</span></span></p>
<p><span class="koboSpan" id="kobo.502.1">If the new environment performs without issues, you can gradually “drain” users from the old environment onto the new environment. </span><span class="koboSpan" id="kobo.502.2">Eventually, your old environment will be empty and can be taken offline until the next deployment, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.503.1">Figure 17</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.504.1">.10</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.505.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer208">
<span class="koboSpan" id="kobo.506.1"><img alt="Figure 17.10 – The green environment handles all traffic and the blue one goes offline" src="image/B21324_17_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.507.1">Figure 17.10 – The green environment handles all traffic and the blue one goes offline</span></p>
<p><span class="koboSpan" id="kobo.508.1">The next time a </span><a id="_idIndexMarker1007"/><span class="koboSpan" id="kobo.509.1">deployment occurs, the roles will reverse and users will move from the green environment to the blue </span><a id="_idIndexMarker1008"/><span class="koboSpan" id="kobo.510.1">environment once the blue environment is updated to the </span><span class="No-Break"><span class="koboSpan" id="kobo.511.1">next version.</span></span></p>
<p><span class="koboSpan" id="kobo.512.1">This sounds complex, and to some extent it is, but a lot of this complexity can be automated and managed by your cloud provider. </span><span class="koboSpan" id="kobo.512.2">For example, Azure provides blue/green deployments in many of its services, as detailed in the </span><em class="italic"><span class="koboSpan" id="kobo.513.1">Further </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.514.1">reading</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.515.1"> section.</span></span></p>
<p><span class="koboSpan" id="kobo.516.1">Once you’ve migrated over to a blue/green deployment model, the complexity becomes largely irrelevant, and instead, blue/green deployment becomes another tool in your </span><span class="No-Break"><span class="koboSpan" id="kobo.517.1">quality toolbox.</span></span></p>
<h2 id="_idParaDest-377"><a id="_idTextAnchor376"/><span class="koboSpan" id="kobo.518.1">The value of continuous integration and continuous delivery</span></h2>
<p><span class="koboSpan" id="kobo.519.1">All of this </span><a id="_idIndexMarker1009"/><span class="koboSpan" id="kobo.520.1">added complexity in the form of deployment and feature management sounds intimidating at first, but this level of maturity helps teams perform at very high levels and reduces the impact of any failures on the </span><span class="No-Break"><span class="koboSpan" id="kobo.521.1">end users.</span></span></p>
<p><span class="koboSpan" id="kobo.522.1">This</span><a id="_idIndexMarker1010"/><span class="koboSpan" id="kobo.523.1"> complexity can be a problem, but thankfully, </span><strong class="bold"><span class="koboSpan" id="kobo.524.1">continuous integration and continuous delivery</span></strong><span class="koboSpan" id="kobo.525.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.526.1">CI/CD</span></strong><span class="koboSpan" id="kobo.527.1">) can help </span><span class="No-Break"><span class="koboSpan" id="kobo.528.1">manage it.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.529.1">CI</span></strong><span class="koboSpan" id="kobo.530.1"> is about verifying the correctness of your software any time it changes. </span><span class="koboSpan" id="kobo.530.2">This means running code analysis, unit tests, and any other checks you need to do any time a change is about to be merged into an </span><span class="No-Break"><span class="koboSpan" id="kobo.531.1">integration branch.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.532.1">CD</span></strong><span class="koboSpan" id="kobo.533.1"> focuses on </span><a id="_idIndexMarker1011"/><span class="koboSpan" id="kobo.534.1">automating the deployment of software applications in a repeatable and reliable manner. </span><span class="koboSpan" id="kobo.534.2">Instead of deployments being done from one specialized developer’s machine, deployments are done using an automated script that is typically run in a cloud environment. </span><span class="koboSpan" id="kobo.534.3">Continuous delivery allows you to ship your software in a repeatable and </span><a id="_idIndexMarker1012"/><span class="koboSpan" id="kobo.535.1">reliable manner to whatever environment </span><span class="No-Break"><span class="koboSpan" id="kobo.536.1">you want.</span></span></p>
<p><span class="koboSpan" id="kobo.537.1">Some interpretations of CI/CD also</span><a id="_idIndexMarker1013"/><span class="koboSpan" id="kobo.538.1"> include </span><strong class="bold"><span class="koboSpan" id="kobo.539.1">Infrastructure as Code</span></strong><span class="koboSpan" id="kobo.540.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.541.1">IaC</span></strong><span class="koboSpan" id="kobo.542.1">) through </span><a id="_idIndexMarker1014"/><span class="koboSpan" id="kobo.543.1">tools </span><a id="_idIndexMarker1015"/><span class="koboSpan" id="kobo.544.1">such as </span><strong class="bold"><span class="koboSpan" id="kobo.545.1">Terraform</span></strong><span class="koboSpan" id="kobo.546.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.547.1">Bicep</span></strong><span class="koboSpan" id="kobo.548.1">. </span><span class="koboSpan" id="kobo.548.2">IaC is used to configure cloud environments that have the same resources, security privileges, and configuration settings based on an IaC script. </span><span class="koboSpan" id="kobo.548.3">This means that deployments can be used to create missing cloud resources and secure resources, and generally make it easier for your team to create new </span><span class="No-Break"><span class="koboSpan" id="kobo.549.1">environments consistently.</span></span></p>
<p><span class="koboSpan" id="kobo.550.1">When you put these tools and processes together, you get a well-defined and automated pipeline that checks new code for correctness, runs tests to ensure that the change doesn’t break anything, and can deploy changes to whatever environment you’d like – all without the possibility of human error in </span><span class="No-Break"><span class="koboSpan" id="kobo.551.1">the process.</span></span></p>
<p><span class="koboSpan" id="kobo.552.1">Once you have a broad enough library of unit and integration tests, CI/CD allows you to deploy at whatever pace you’re comfortable with and is how some teams can deploy hundreds of times a day if they </span><span class="No-Break"><span class="koboSpan" id="kobo.553.1">want to.</span></span></p>
<p><span class="koboSpan" id="kobo.554.1">This degree of process maturity gives teams the freedom to innovate at a rapid pace. </span><span class="koboSpan" id="kobo.554.2">These added safety nets of quality checks and automation further support refactoring efforts by taking the fear out of making the changes needed to keep your software clean </span><span class="No-Break"><span class="koboSpan" id="kobo.555.1">and healthy.</span></span></p>
<h1 id="_idParaDest-378"><a id="_idTextAnchor377"/><span class="koboSpan" id="kobo.556.1">Case study – Cloudy Skies Airlines</span></h1>
<p><span class="koboSpan" id="kobo.557.1">As we close this book, let’s take </span><a id="_idIndexMarker1016"/><span class="koboSpan" id="kobo.558.1">a final look at our case study company: Cloudy </span><span class="No-Break"><span class="koboSpan" id="kobo.559.1">Skies Airlines.</span></span></p>
<p><span class="koboSpan" id="kobo.560.1">Cloudy Skies started with unmaintainable systems they were afraid to touch for fear of introducing critical bugs. </span><span class="koboSpan" id="kobo.560.2">They carried out a systematic review of the technical debt in their codebase and the quality issues the team had encountered in the </span><span class="No-Break"><span class="koboSpan" id="kobo.561.1">past year.</span></span></p>
<p><span class="koboSpan" id="kobo.562.1">As a result, the team was able to prioritize a list of key areas of technical debt and identify critical areas lacking unit tests. </span><span class="koboSpan" id="kobo.562.2">Cloudy Skies carried out several refactoring sprints to address the most critical areas first, putting a heavy emphasis on expanding their </span><span class="No-Break"><span class="koboSpan" id="kobo.563.1">unit tests.</span></span></p>
<p><span class="koboSpan" id="kobo.564.1">Once the quality hotspots were largely addressed, Cloudy Skies went back to a standard agile development cadence but allocated about 30% of their work each sprint toward paying down </span><span class="No-Break"><span class="koboSpan" id="kobo.565.1">technical debt.</span></span></p>
<p><span class="koboSpan" id="kobo.566.1">Many of the systems Cloudy Skies used were out of date, but Cloudy Skies was able to use .NET Upgrade Assistant to quickly modernize most </span><span class="No-Break"><span class="koboSpan" id="kobo.567.1">of them.</span></span></p>
<p><span class="koboSpan" id="kobo.568.1">For applications that could not be easily upgraded, development teams began following the strangler fig pattern to build a new application to cover vertical slices of the old application and tools such as YARP to route traffic to the new application </span><span class="No-Break"><span class="koboSpan" id="kobo.569.1">where possible.</span></span></p>
<p><span class="koboSpan" id="kobo.570.1">All of this was supported by</span><a id="_idIndexMarker1017"/><span class="koboSpan" id="kobo.571.1"> a culture of trust and transparency and modern application management processes through feature flags </span><span class="No-Break"><span class="koboSpan" id="kobo.572.1">and CI/CD.</span></span></p>
<p><span class="koboSpan" id="kobo.573.1">While it will be some time before the developers are fully proud of their code, Cloudy Skies is heading in the right direction. </span><span class="koboSpan" id="kobo.573.2">The team has regained the respect of the larger organization and the added stability and agility is helping the business steer toward </span><span class="No-Break"><span class="koboSpan" id="kobo.574.1">sunny horizons.</span></span></p>
<h1 id="_idParaDest-379"><a id="_idTextAnchor378"/><span class="koboSpan" id="kobo.575.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.576.1">In this chapter, we explored the unique challenges of refactoring in an agile environment and strategies for including refactoring work inside </span><span class="No-Break"><span class="koboSpan" id="kobo.577.1">agile sprints.</span></span></p>
<p><span class="koboSpan" id="kobo.578.1">We also looked at ways of accomplishing large-scale refactorings and how to respond when things don’t go </span><span class="No-Break"><span class="koboSpan" id="kobo.579.1">as planned.</span></span></p>
<p><span class="koboSpan" id="kobo.580.1">This chapter also touched on some deployment and automation processes that can reduce the impact of issues on end users and minimize the risk of human error through feature flags, blue/green deployments, and </span><span class="No-Break"><span class="koboSpan" id="kobo.581.1">CI/CD practices.</span></span></p>
<h1 id="_idParaDest-380"><a id="_idTextAnchor379"/><span class="koboSpan" id="kobo.582.1">Toward more sustainable software</span></h1>
<p><span class="koboSpan" id="kobo.583.1">This book took you on a journey from the nature of technical debt to the procedures of refactoring. </span><span class="koboSpan" id="kobo.583.2">We talked about how to safely test and structure your software and how to evaluate code for best practices, prioritize, and communicate </span><span class="No-Break"><span class="koboSpan" id="kobo.584.1">technical debt.</span></span></p>
<p><span class="koboSpan" id="kobo.585.1">We also talked about how the C# language and features of Visual Studio support you in this journey toward more sustainable </span><span class="No-Break"><span class="koboSpan" id="kobo.586.1">software development.</span></span></p>
<p><span class="koboSpan" id="kobo.587.1">Every year our world changes a little as Microsoft unveils new C# preview features at the beginning of the year and releases them near </span><span class="No-Break"><span class="koboSpan" id="kobo.588.1">the end.</span></span></p>
<p><span class="koboSpan" id="kobo.589.1">These capabilities give us a wide range of capabilities to tackle the development problems of today and tomorrow, but the reality is that software development continues </span><span class="No-Break"><span class="koboSpan" id="kobo.590.1">to change.</span></span></p>
<p><span class="koboSpan" id="kobo.591.1">Software and software development grows more complex each year. </span><span class="koboSpan" id="kobo.591.2">Meanwhile, many teams are stuck maintaining </span><span class="No-Break"><span class="koboSpan" id="kobo.592.1">yesterday’s code.</span></span></p>
<p><span class="koboSpan" id="kobo.593.1">It doesn’t have to be this way. </span><span class="koboSpan" id="kobo.593.2">You can modernize your software, and you can do it in an agile and responsible way while serving the needs of your business and </span><span class="No-Break"><span class="koboSpan" id="kobo.594.1">its customers.</span></span></p>
<p><span class="koboSpan" id="kobo.595.1">I’ve been writing software in some shape or form for over 35 years now. </span><span class="koboSpan" id="kobo.595.2">New developers assume that more experience results in fewer mistakes. </span><span class="koboSpan" id="kobo.595.3">While this has some truth to it, I’ve personally found that the more experience I get, the less I trust my ability to not </span><span class="No-Break"><span class="koboSpan" id="kobo.596.1">make mistakes.</span></span></p>
<p><span class="koboSpan" id="kobo.597.1">Make room for yourself – and others – to make mistakes. </span><span class="koboSpan" id="kobo.597.2">Mistakes will happen and bugs will reach production, but when they do, you need to learn </span><span class="No-Break"><span class="koboSpan" id="kobo.598.1">from them.</span></span></p>
<p><span class="koboSpan" id="kobo.599.1">It is my sincere hope that you have learned something new from every chapter. </span><span class="koboSpan" id="kobo.599.2">Moreover, I want you to emerge from this book with hope – hope that your code can be a source of joy to you, or at least be less afraid </span><span class="No-Break"><span class="koboSpan" id="kobo.600.1">to change.</span></span></p>
<p><span class="koboSpan" id="kobo.601.1">Through the practices outlined in this book, I believe that you and your team can reach a better place through successfully refactoring </span><span class="No-Break"><span class="koboSpan" id="kobo.602.1">with C#.</span></span></p>
<h1 id="_idParaDest-381"><a id="_idTextAnchor380"/><span class="koboSpan" id="kobo.603.1">Questions</span></h1>
<ol>
<li><span class="koboSpan" id="kobo.604.1">How can technical debt be paid down inside of an </span><span class="No-Break"><span class="koboSpan" id="kobo.605.1">agile setting?</span></span></li>
<li><span class="koboSpan" id="kobo.606.1">Why are large rewrites hard? </span><span class="koboSpan" id="kobo.606.2">What processes can help </span><span class="No-Break"><span class="koboSpan" id="kobo.607.1">with this?</span></span></li>
<li><span class="koboSpan" id="kobo.608.1">What variances do you see right now in how you deploy and </span><span class="No-Break"><span class="koboSpan" id="kobo.609.1">test software?</span></span></li>
</ol>
<h1 id="_idParaDest-382"><a id="_idTextAnchor381"/><span class="koboSpan" id="kobo.610.1">Further reading</span></h1>
<p><span class="koboSpan" id="kobo.611.1">You can find more information about the materials from this chapter at </span><span class="No-Break"><span class="koboSpan" id="kobo.612.1">these URLs:</span></span></p>
<ul>
<li><em class="italic"><span class="koboSpan" id="kobo.613.1">Manifesto for Agile Software Development</span></em><span class="koboSpan" id="kobo.614.1">: </span><em class="italic"><span class="koboSpan" id="kobo.615.1">StranglerFigApplication </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.616.1">Post</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.617.1">: </span></span><a href="https://martinfowler.com/bliki/StranglerFigApplication.html"><span class="No-Break"><span class="koboSpan" id="kobo.618.1">https://martinfowler.com/bliki/StranglerFigApplication.html</span></span></a></li>
<li><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.619.1">YARP</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.620.1">: </span></span><a href="https://github.com/microsoft/reverse-proxy"><span class="No-Break"><span class="koboSpan" id="kobo.621.1">https://github.com/microsoft/reverse-proxy</span></span></a></li>
<li><em class="italic"><span class="koboSpan" id="kobo.622.1">Azure API </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.623.1">Management</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.624.1">: </span></span><a href="https://learn.microsoft.com/en-us/azure/api-management/api-management-key-concepts"><span class="No-Break"><span class="koboSpan" id="kobo.625.1">https://learn.microsoft.com/en-us/azure/api-management/api-management-key-concepts</span></span></a></li>
<li><em class="italic"><span class="koboSpan" id="kobo.626.1">Overview of the.NET Upgrade </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.627.1">Assistant</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.628.1">: </span></span><a href="https://learn.microsoft.com/en-us/dotnet/core/porting/upgrade-assistant-overview"><span class="No-Break"><span class="koboSpan" id="kobo.629.1">https://learn.microsoft.com/en-us/dotnet/core/porting/upgrade-assistant-overview</span></span></a></li>
<li><em class="italic"><span class="koboSpan" id="kobo.630.1">.NET Feature </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.631.1">Management</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.632.1">: </span></span><a href="https://github.com/microsoft/FeatureManagement-Dotnet"><span class="No-Break"><span class="koboSpan" id="kobo.633.1">https://github.com/microsoft/FeatureManagement-Dotnet</span></span></a></li>
<li><em class="italic"><span class="koboSpan" id="kobo.634.1">Blue-Green Deployment in Azure Container </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.635.1">Apps</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.636.1">:</span></span><span class="No-Break"><em class="italic"> </em></span><a href="https://learn.microsoft.com/en-us/azure/container-apps/blue-green-deployment"><span class="No-Break"><span class="koboSpan" id="kobo.637.1">https://learn.microsoft.com/en-us/azure/container-apps/blue-green-deployment</span></span></a></li>
<li><em class="italic"><span class="koboSpan" id="kobo.638.1">Vertical </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.639.1">Slices: </span></em></span><a href="https://deviq.com/practices/vertical-slices"><span class="No-Break"><span class="koboSpan" id="kobo.640.1">https://deviq.com/practices/vertical-slices</span></span></a></li>
</ul>
</div>
</body></html>