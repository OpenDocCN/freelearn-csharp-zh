<html><head></head><body><div class="chapter" title="Chapter&#xA0;6.&#xA0;Trade"><div class="titlepage"><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Trade</h1></div></div></div><p>In the previous chapter, we discussed how Microsoft Dynamics NAV can help us to streamline our production process using both the standard application as well as customized solutions. We talked about five vertical industries and how to fit the application for them.</p><p>In this chapter, we will discuss how to use Microsoft Dynamics NAV for these companies using sales and purchase documents and how to integrate this with the built-in Warehouse Management and Reservation processes.</p><p>The primary focus of this chapter is on how the application is designed, and where to go to change or enhance the design. Basic knowledge of how to create and process sales and purchase documents in Microsoft Dynamics NAV is a prerequisite.</p><p>We will use examples from the same vertical industries—automotive, fashion, medicines, food, and furniture—which we discussed in the previous chapters. After reading this chapter, you will have a good understanding of how to implement Microsoft Dynamics NAV in trading companies.</p><div class="section" title="The process"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec44"/>The process</h1></div></div></div><p>A trading company <a class="indexterm" id="id725"/>purchases and sells items without changing them. The main activities are purchase, storage, packaging, sales, and shipping, as shown in the following screenshot:</p><div class="mediaobject"><img alt="The process" src="graphics/0365EN_06_01.jpg"/></div><p>Managing the inventory is very important in these companies. Having inventory is crucial for delivering on time and not having to say "no" to customers.</p><div class="section" title="Wholesale versus retail"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec101"/>Wholesale versus retail</h2></div></div></div><p>Traditionally, trading<a class="indexterm" id="id726"/> companies are divided into wholesale and retail companies. Wholesale<a class="indexterm" id="id727"/> companies sell to business and retail companies sell to<a class="indexterm" id="id728"/> consumers. Microsoft Dynamics NAV supports both and from the perspective of design (table and posting structure), there is not much difference.</p><p>The biggest difference between wholesale and retail for the application is the transaction volume. While the total turnover of a wholesale company can be much higher compared to a retailer, the retailer often has more, smaller transactions. It can be a challenge from an application design perspective to retain a solution that performs well.</p><p>Another issue with high volume transaction systems is traceability of the data. Whenever something goes wrong, it is very important to see where this has started and how much data was impacted by the mistake. In low transaction systems, it is easier to find this manually.</p></div></div></div>
<div class="section" title="Sales and purchasing"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec45"/>Sales and purchasing</h1></div></div></div><p>Traditionally, salespersons<a class="indexterm" id="id729"/> used to work with paper order forms. They would write down the customer name and address and the items or services required.</p><div class="mediaobject"><img alt="Sales and purchasing" src="graphics/0365EN_06_02.jpg"/><div class="caption"><p>Paper order form</p></div></div><p>In Microsoft Dynamics NAV, the paper document is replaced by a sales and purchase document using a header for the general order information and lines to register the items and services.</p><p>The posting process breaks<a class="indexterm" id="id730"/> down the information in the document into the journals and posts them, so the end user does not have to worry about this. The application reuses the same posting routines as we discussed in earlier chapters.</p><p>Let's look at how the documents and journals tie together by drawing the table and transaction scheme for this:</p><div class="mediaobject"><img alt="Sales and purchasing" src="graphics/0365EN_06_03.jpg"/></div><p>The first step is creating the <a class="indexterm" id="id731"/>document. When we create this <span class="strong"><strong>Sales Document</strong></span>
<a class="indexterm" id="id732"/> (<span class="strong"><strong>Sales Header</strong></span>
<a class="indexterm" id="id733"/> and <a class="indexterm" id="id734"/>
<span class="strong"><strong>Sales Line</strong></span>), nothing is posted. We are only entering the information into the system that can be changed at any time.</p><p>When we start the <a class="indexterm" id="id735"/>
<span class="strong"><strong>Codeunit Sales-Post (80)</strong></span>, the system will create all the journals for us and post them. When we sell an item, the system will create an <a class="indexterm" id="id736"/>
<span class="strong"><strong>Item Journal Line</strong></span>, and when we sell a resource, the system creates a <a class="indexterm" id="id737"/>
<span class="strong"><strong>Resource Journal Line</strong></span>, and so on.</p><p>The <span class="strong"><strong>Invoice Posting buffer</strong></span>
<a class="indexterm" id="id738"/> is used to create the entries in the <a class="indexterm" id="id739"/>
<span class="strong"><strong>General Journal Line</strong></span>. We already discussed this feature in <a class="link" href="ch03.html" title="Chapter 3. Financial Management">Chapter 3</a>, <span class="emphasis"><em>Financial Management</em></span>.</p><p>Microsoft Dynamics NAV allows us to create four different kinds of posted sales documents: invoices, shipments, credit memos, and return receipts. We will discuss all these types later in this chapter.</p><div class="section" title="Transaction mirroring"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec102"/>Transaction mirroring</h2></div></div></div><p>The unique concept of <a class="indexterm" id="id740"/>sales and <a class="indexterm" id="id741"/>purchase in Microsoft Dynamics NAV is the mirroring of the transaction structure. Once we understand how the sales transactions fit together, it will be easy to understand the structure of a purchase.</p><p>Let's demonstrate this by comparing the first fields in <span class="strong"><strong>Table 37 Sales Line</strong></span> and <span class="strong"><strong>Table 39 Purchase Line</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img alt="Transaction mirroring" src="graphics/0365EN_06_04.jpg"/></div><p>The fields in both tables are equally numbered and serve the same process even though they use different terminology, for example, field 18, <span class="strong"><strong>Qty. to Ship</strong></span> (sale) and <span class="strong"><strong>Qty. To Receive</strong></span> (purchase).</p><p>Some fields are different because they don't make sense to be in both processes, for example, <span class="strong"><strong>Unit Price (LCY)</strong></span> (field 31) in purchase and <span class="strong"><strong>Customer Price Group</strong></span> (field 42) in sales.</p><p>The purchase<a class="indexterm" id="id742"/> process also uses the same posting <a class="indexterm" id="id743"/>methodology. The purchase header (38) and purchase line (39) tables are posted using the codeunit Purch.-Post (90) in the purchase receipt, invoice, credit memo, and return shipment documents.</p><p>Let's have a closer look at the sales process.</p></div><div class="section" title="Sales"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec103"/>Sales</h2></div></div></div><p>The sales<a class="indexterm" id="id744"/> process supports six document types<a class="indexterm" id="id745"/> that are normalized into two tables, sales header (36) and sales line (37).</p><p>Each process can have its own Number Series and has a special card and list page, but they all share the same business logic. Let's discuss the document types:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Quote</strong></span>: When a customer <a class="indexterm" id="id746"/>would<a class="indexterm" id="id747"/> like to know the terms and conditions of making a purchase, we can make a quote. This will show all the calculations such as pricing and VAT.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Blanket Order</strong></span>: This is a<a class="indexterm" id="id748"/> pre-order<a class="indexterm" id="id749"/> status. When used, we have an agreement with the customer without knowing the exact shipment date.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Order</strong></span>: This is used <a class="indexterm" id="id750"/>for the <a class="indexterm" id="id751"/>actual order document.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Invoice</strong></span>: This can<a class="indexterm" id="id752"/> be used in two <a class="indexterm" id="id753"/>ways; directly, without a sales order if the company only invoices directly on G/L Accounts, or we can use the invoices to invoice one or more shipments.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Credit Memo</strong></span>: We can <a class="indexterm" id="id754"/>use a <a class="indexterm" id="id755"/>credit memo when we credit on a G/L Account.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Return Order</strong></span>: If a customer <a class="indexterm" id="id756"/>returns<a class="indexterm" id="id757"/> an item, we can use a return order to reverse the inventory process.</li></ul></div><div class="section" title="Orders"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec101"/>Orders</h3></div></div></div><p>The main process is the <a class="indexterm" id="id758"/>order. The other document types are designed to support this. Sales orders can be created directly or via a quote or blanket order. There are two differences between a quote and a blanket order:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Quotes can only be fully transferred into a sales order, not in parts. For example, a blanket order of 100 items can be split into 10 deliveries of 10 items with different shipping dates.</li><li class="listitem" style="list-style-type: disc">A customer with a<a class="indexterm" id="id759"/> quote has the possibility to say yes or no. When the answer is no, there will be no transaction. Therefore, quotes are not used in the supply and demand calculation, as we discussed in the previous chapter. A blanket order is a real order. The customer should eventually purchase the complete quantity that was agreed. Therefore, the blanket orders are used in the supply and demand calculation.</li></ul></div></div><div class="section" title="Quote to order and blanket order to order"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec102"/>Quote to order and blanket order to order</h3></div></div></div><p>Although the quotes and blanket to orders are stored in the same table, the records are physically deleted from the table and inserted using another document type. This is done in codeunits sales-quote to order (86) and blanket sales order to order (87).</p><p>When comparing these codeunits in compare tools, such as Beyond Compare or Araxis, we can see that there is a lot of similarity. They both create a new sales order.</p><div class="section" title="Quote to order"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl4sec09"/>Quote to order</h4></div></div></div><p>When moving a<a class="indexterm" id="id760"/> quote to an order, the complete quote is copied and then deleted. A quote can be created from an opportunity in CRM as we discussed in <a class="link" href="ch04.html" title="Chapter 4. Relationship Management">Chapter 4</a>, <span class="emphasis"><em>Relationship Management</em></span>. Therefore, the opportunity is updated when this happens.</p></div><div class="section" title="Blanket order to order"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl4sec10"/>Blanket order to order</h4></div></div></div><p>A blanket order <a class="indexterm" id="id761"/>can be moved in parts. Therefore, business logic is implemented to calculate the remaining quantity. There is no link between blanket orders and CRM and it is also not possible to create a blanket order from a quote.</p></div></div></div><div class="section" title="Creating a new sales order"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec104"/>Creating a new sales order</h2></div></div></div><p>In order to understand<a class="indexterm" id="id762"/> the examples in this chapter, we will discuss the most important fields of the sales order. A sales <a class="indexterm" id="id763"/>document contains one header and multiple lines.</p><p>While the sales header table contains more static registration of information, the sales line has more real business logic, such as price calculation, inventory availability, and VAT. We will discuss how this business logic is normalized.</p><div class="mediaobject"><img alt="Creating a new sales order" src="graphics/0365EN_06_05.jpg"/></div><div class="section" title="Sales header"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec103"/>Sales header</h3></div></div></div><p>All document types are uniquely<a class="indexterm" id="id764"/> numbered. The primary key fields of the sales header table are <span class="strong"><strong>Document Type</strong></span> and <span class="strong"><strong>No.</strong></span>.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip32"/>Tip</h3><p>It is very useful to use Number Series code that makes sense to the end users, for example, SO13-0012 for sales order 12 in the year 2013 and SQ14-0312 for sales quote 312 for 2014.</p></div></div><p>The sales document<a class="indexterm" id="id765"/> contains the following two different customer no. fields:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Sell-to Customer No.</strong></span>: This is the primary customer no. field, which defines the customer who requested the order to be created. This customer number is used to calculate the discounts.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Bill-to Customer No.</strong></span>: By default, the <span class="strong"><strong>Sell-to Customer No.</strong></span> will also receive the invoice. By changing this field to another customer, this will make the invoice print out containing other customer details.</li></ul></div><p>A sales document contains some dates that are used for different purposes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Posting Date</strong></span>: This date is used for posting to the various ledgers</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Document Date</strong></span>: This date is used for the accounts receivable</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Shipment Date</strong></span>: This date is for the calculation or the inventory availability</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Due Date</strong></span>: This date is the last date at which the bill-to customer is expected to pay the invoice</li></ul></div></div><div class="section" title="Sales lines"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec104"/>Sales lines</h3></div></div></div><p>Each sales document can contain an almost<a class="indexterm" id="id766"/> unlimited number of sales lines. By default, the sales lines are numbered 10000, 20000, 30000, and so on.</p><p>The numbering is done using the <code class="literal">AutoSplitKey</code> property on the sales line page and the increment cannot be changed. When a user inserts new records between two existing lines, the program will calculate the new number to be exactly between the old values, for example, 10000, 15000, 17500, 18750, 19375, 19687, 19843, 19921, 19960, 19980, 19990, 19995, 19997, 19998, 19999, and 20000. If there is no more room, the system will generate a runtime error message, as shown in the following screenshot:</p><div class="mediaobject"><img alt="Sales lines" src="graphics/0365EN_06_06.jpg"/></div><div class="section" title="Master data options"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl4sec11"/>Master data options</h4></div></div></div><p>A sales line can contain a reference to<a class="indexterm" id="id767"/> six types of master data defined by the <span class="strong"><strong>Type</strong></span> field. These types are: <span class="strong"><strong>Text</strong></span> (blank option), <span class="strong"><strong>G/L Account</strong></span>, <span class="strong"><strong>Item</strong></span>, <span class="strong"><strong>Resource</strong></span>, <span class="strong"><strong>Fixed Asset</strong></span>, and <span class="strong"><strong>Charge</strong></span> (item).</p><p>The type that we specify here determines which journal will be used later when we post this sales document. However, each line can contain financial information, which will be processed to the general ledger via the posting buffer table.</p><p>In the next chapter, we will discuss how to add a new type to this process.</p></div></div><div class="section" title="Sales line fields"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec105"/>Sales line fields</h3></div></div></div><p>To create a new sales line<a class="indexterm" id="id768"/> and start the important business logic in Microsoft Dynamics NAV, we need to know about the following fields:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Type</strong></span>: This defines the master data type the sales line uses and eventually the journal that will be used during posting<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note34"/>Note</h3><p>When the <span class="strong"><strong>Type</strong></span> field changes after the sales line was created, the record is cleared and the fields get their default values.</p></div></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>No.</strong></span>: This is the actual reference to the unique number of the master data type that is used<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note35"/>Note</h3><p>When the <span class="strong"><strong>No.</strong></span> field is changed, the previous quantity is used to recreate the sales line with the new master data.</p></div></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Quantity</strong></span>: This is <a class="indexterm" id="id769"/>used to calculate the sales amounts for the invoicing and in the case of an item, and also the physical quantity of the changes in inventory</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Outstanding Quantity</strong></span>, <span class="strong"><strong>Qty. to Invoice</strong></span>, and <span class="strong"><strong>Qty. to Ship</strong></span>: These fields are designed to use for partial shipping and invoicing of an order</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Unit Price</strong></span> and <span class="strong"><strong>Unit Cost (LCY)</strong></span>: The fields are used to calculate the sales amount and profit</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Line Discount %</strong></span> and <span class="strong"><strong>Line Discount Amount</strong></span>: These fields are used to determine the discounts</li></ul></div></div><div class="section" title="Validation flow"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec106"/>Validation flow</h3></div></div></div><p>The sales line table has a <a class="indexterm" id="id770"/>specific <a class="indexterm" id="id771"/>validation flow of functions that is important to understand before making changes to the table. This flow is based on the normal way an end user creates a sales line.</p><p>To create a sales line, only four fields are populated and the line is ready to use. After setting the type and choosing a no., the end user types in the <span class="strong"><strong>Quantity</strong></span> field and if necessary, the <span class="strong"><strong>Unit Price</strong></span> field.</p><p>Let's analyze the C/AL code in the <code class="literal">OnValidate</code> trigger of the three fields that can calculate the sales line.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note36"/>Note</h3><p>When changing these C/AL routines, make sure to use the <span class="emphasis"><em>Test near</em></span>, <span class="emphasis"><em>Test far</em></span>, <span class="emphasis"><em>Do it</em></span>, and <span class="emphasis"><em>Clean up</em></span> methods that we discussed in <a class="link" href="ch01.html" title="Chapter 1. Introduction to Microsoft Dynamics NAV">Chapter 1</a>, <span class="emphasis"><em>Introduction to Microsoft Dynamics NAV</em></span>.</p></div></div><div class="section" title="No. | field 6"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl4sec12"/>No. | field 6</h4></div></div></div><p>The C/AL code<a class="indexterm" id="id772"/> in the <code class="literal">OnValidate</code> trigger starts by doing the initial testing, if the change is allowed. After this, the record is cleared and the old values for the <span class="strong"><strong>No.</strong></span> field and <span class="strong"><strong>Quantity</strong></span> fields are applied, as follows:</p><div class="informalexample"><pre class="programlisting">TempSalesLine := Rec;
INIT;
Type := TempSalesLine.Type;
"No." := TempSalesLine."No.";
IF "No." = '' THEN
  EXIT;
IF Type &lt;&gt; Type::" " THEN
  Quantity := TempSalesLine.Quantity;</pre></div><p>Then, the sales line inherits the values from the sales header, if required, and the date fields are calculated, as follows:</p><div class="informalexample"><pre class="programlisting">"Sell-to Customer No." := SalesHeader."Sell-to Customer No.";
"Currency Code" := SalesHeader."Currency Code";
...

"Promised Delivery Date" := SalesHeader."Promised Delivery Date";
...

UpdateDates;</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip33"/>Tip</h3><p>The sales header information is not present in the sales line when an end user picks a value for the <span class="strong"><strong>No.</strong></span> field. We cannot use the customer information for table relations.</p></div></div><p>When this is done, we see a <code class="literal">CASE</code> statement where the master data is acquired. This would be the place where we would move newly added fields from master data to the sales line table.</p><div class="informalexample"><pre class="programlisting">CASE Type OF
  Type::" ":
      ...
  Type::"G/L Account":
      ...
  Type::Item:
      ...
 Type::Resource:
      ...
  Type::"Fixed Asset":
      ...
  Type::"Charge (Item)":
      ...
END;</pre></div><p>When this is done, the quantities are calculated and the unit price is calculated.</p><div class="informalexample"><pre class="programlisting">IF Type &lt;&gt; Type::" " THEN BEGIN
  IF Type &lt;&gt; Type::"Fixed Asset" THEN
    VALIDATE("VAT Prod. Posting Group");
  VALIDATE("Unit of Measure Code");
  IF Quantity &lt;&gt; 0 THEN BEGIN
    InitOutstanding;
    IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN
      InitQtyToReceive
    ELSE
      InitQtyToShip;
    UpdateWithWarehouseShip;
  END;
<span class="strong"><strong>  UpdateUnitPrice(FIELDNO("No."));</strong></span>
END;</pre></div><p>The latter is very important for our<a class="indexterm" id="id773"/> analysis. After this function, other code is executed but this is not important for this example.</p></div><div class="section" title="Quantity | field 15"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl4sec13"/>Quantity | field 15</h4></div></div></div><p>Just like the <span class="strong"><strong>No.</strong></span> field, the <a class="indexterm" id="id774"/>
<span class="strong"><strong>Quantity</strong></span> field also first checks whether the change is allowed. When this is done, the following section of C/AL code is important:</p><div class="informalexample"><pre class="programlisting">IF Type = Type::Item THEN BEGIN
<span class="strong"><strong>  UpdateUnitPrice(FIELDNO(Quantity));</strong></span>
  ...
  CheckApplFromItemLedgEntry(ItemLedgEntry);
END ELSE
  VALIDATE("Line Discount %");</pre></div><p>In the preceding C/AL code, we should notice again the <code class="literal">UpdateUnitPrice</code> function and also the validation of the <code class="literal">Line Discount %</code> field.</p></div><div class="section" title="Unit price | field 22"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl4sec14"/>Unit price | field 22</h4></div></div></div><p>This field has little <a class="indexterm" id="id775"/>C/AL code. When changing the unit price manually, the C/AL code will trigger the <code class="literal">Line Discount %</code> field:</p><div class="informalexample"><pre class="programlisting">TestStatusOpen;
<span class="strong"><strong>VALIDATE("Line Discount %");</strong></span>
</pre></div><p>Before going to this field, let's first have a look at the <code class="literal">UpdateUnitPrice</code> function we noticed earlier in the <span class="strong"><strong>Quantity</strong></span> and <span class="strong"><strong>No.</strong></span> field.</p></div><div class="section" title="UpdateUnitPrice"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl4sec15"/>UpdateUnitPrice</h4></div></div></div><p>The <code class="literal">UpdateUnitPrice</code> function<a class="indexterm" id="id776"/> executes the following C/AL code:</p><div class="informalexample"><pre class="programlisting">IF (CalledByFieldNo &lt;&gt; CurrFieldNo) AND (CurrFieldNo &lt;&gt; 0) THEN
  EXIT;

GetSalesHeader;
TESTFIELD("Qty. per Unit of Measure");

CASE Type OF
  Type::Item,Type::Resource:
    BEGIN
      PriceCalcMgt.FindSalesLineLineDisc(SalesHeader,Rec);
      PriceCalcMgt.FindSalesLinePrice(SalesHeader,Rec,
        CalledByFieldNo);
    END;
END;
<span class="strong"><strong>VALIDATE("Unit Price");</strong></span>
</pre></div><p>After doing the checks, the sales price calculation routines we discussed in <a class="link" href="ch02.html" title="Chapter 2. A Sample Application">Chapter 2</a>, <span class="emphasis"><em>A Sample Application</em></span>, are executed. This is codeunit Sales Price Calc. Mgt. 7000.</p><p>When this is done, it validates the field Unit Price that we already analyzed. This leads us to one single point; the <code class="literal">OnValidate</code> trigger of Line Discount %.</p></div><div class="section" title="Line Discount % | field 27"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl4sec16"/>Line Discount % | field 27</h4></div></div></div><p>The C/AL code in this <code class="literal">OnValidate</code> trigger first<a class="indexterm" id="id777"/> calculates the line discount amount based on the unit price and then starts the <code class="literal">UpdateAmounts</code> function, as follows:</p><div class="informalexample"><pre class="programlisting">TestJobPlanningLine;
TestStatusOpen;
"Line Discount Amount" :=
  ROUND(
    ROUND(Quantity * "Unit Price",Currency."Amount Rounding Precision") *
    "Line Discount %" / 100,Currency."Amount Rounding Precision");
"Inv. Discount Amount" := 0;
"Inv. Disc. Amount to Invoice" := 0;
<span class="strong"><strong>UpdateAmounts;</strong></span>
</pre></div></div><div class="section" title="UpdateAmounts"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl4sec17"/>UpdateAmounts</h4></div></div></div><p>The <code class="literal">UpdateAmounts</code> function <a class="indexterm" id="id778"/>completes the creation of the sales line and this is where our quest ends.</p><p>The two most important other functions that are executed in this function are the <code class="literal">UpdateVATAmounts</code> for VAT calculation and the credit limit check for the customer in <code class="literal">CustCheckCreditLimit.SalesLineCheck(Rec)</code>.</p></div></div><div class="section" title="VAT calculation"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec107"/>VAT calculation</h3></div></div></div><p>The VAT calculation in <a class="indexterm" id="id779"/>Microsoft Dynamics NAV is not normalized in one application area but redeveloped everywhere. This makes VAT calculation one of the most complex application areas to make changes to.</p><div class="section" title="Code cloning"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl4sec18"/>Code cloning</h4></div></div></div><p>The VAT calculation is not only <a class="indexterm" id="id780"/>done in the sales line, purchase line, and general journal line table, but also in more specific function tables such as the service line. This is done by making a full copy of the C/AL code.</p><p>This phenomenon is known as code cloning in computer science. Although code cloning simplifies application design, it is considered bad practice and should be avoided at all times. In this case, it would have been better if VAT would have been calculated in a generic engine.</p><p>It is therefore highly recommended not to change VAT calculation in Microsoft Dynamics NAV.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip34"/>Tip</h3><p>If VAT calculation is required in a customized solution, it can be done using the general journal line as a temporary table. By populating the necessary fields and starting the calculation, we can use the results without copying the VAT calculation to our own solution.</p></div></div></div></div></div><div class="section" title="Invoicing"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec105"/>Invoicing</h2></div></div></div><p>In Microsoft Dynamics <a class="indexterm" id="id781"/>NAV, a sales <a class="indexterm" id="id782"/>order can be shipped and invoiced directly from the document.</p><p>However, not all companies have a combined shipping and invoicing process. Some companies ship the goods first and send the invoice later, most of the time using combined invoicing.</p><div class="section" title="Prepayments"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec108"/>Prepayments</h3></div></div></div><p>Besides<a class="indexterm" id="id783"/> separating the invoice moment from the shipping moment, Microsoft Dynamics NAV also allows a prepayment process. This prepayment process is designed to work on top of the normal invoicing process. This means it does not replace the invoice but instead creates an extra invoice.</p><div class="mediaobject"><img alt="Prepayments" src="graphics/0365EN_06_07.jpg"/></div><p>This invoice is not created in codeunit sales-post (80) but in codeunit sales-post prepayments (461).</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note37"/>Note</h3><p>Using prepayments in Microsoft Dynamics NAV will always generate a minimum of two invoices per sales order.</p></div></div><p>When the <a class="indexterm" id="id784"/>order is eventually invoiced, the prepayment invoice is deducted from the invoice amount.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip35"/>Tip</h3><p>The design of this solution by Microsoft teaches us and demonstrates that to generate a posted sales invoice, it is not specifically necessary to start codeunit sales-post 80.</p></div></div></div><div class="section" title="Combined invoicing"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec109"/>Combined invoicing</h3></div></div></div><p>Combined invoicing of <a class="indexterm" id="id785"/>shipments<a class="indexterm" id="id786"/> can be done manually or using a batch report.</p><div class="section" title="Manual"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl4sec19"/>Manual</h4></div></div></div><p>To manually combine shipments <a class="indexterm" id="id787"/>on a sales invoice, we can use the<a class="indexterm" id="id788"/> <span class="strong"><strong>Sales-Get Shipment Codeunit (64)</strong></span>.</p><p>This codeunit can be started from the actions on a sales invoice subpage (47) and displays the sales shipment lines that are not yet completely invoiced.</p><div class="mediaobject"><img alt="Manual" src="graphics/0365EN_06_08.jpg"/></div><p>The C/AL code, however, is not completely <a class="indexterm" id="id789"/>within the codeunit; the process starts in the codeunit and runs the page. The page then again starts a function in the codeunit.</p><div class="mediaobject"><img alt="Manual" src="graphics/0365EN_06_09.jpg"/></div></div><div class="section" title="Batch"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl4sec20"/>Batch</h4></div></div></div><p>The Combine Shipments report (295) can be <a class="indexterm" id="id790"/>used to create one invoice for multiple shipments in batch. It works in a similar way as the Combine Invoice report we created in <a class="link" href="ch02.html" title="Chapter 2. A Sample Application">Chapter 2</a>, <span class="emphasis"><em>A Sample Application</em></span>.</p><p>The C/AL code that creates the sales line for the invoice is normalized and used in both codeunit sales-get shipment (64) and combine shipments report (295). The function is located in the sales shipment <a class="indexterm" id="id791"/>line table (111) and is called <code class="literal">InsertInvLineFromShptLine</code>.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note38"/>Note</h3><p>To enable combined shipments, the Boolean field Combine Shipments (87) should be set to <span class="strong"><strong>Yes</strong></span> in the customer table. This value is inherited into the sales header for the sales order document.</p></div></div></div></div><div class="section" title="Credit memo and return orders"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec110"/>Credit memo and return orders</h3></div></div></div><p>The credit memo<a class="indexterm" id="id792"/> and return order<a class="indexterm" id="id793"/> document types are used to reverse the order process.</p></div></div><div class="section" title="Purchasing"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec106"/>Purchasing</h2></div></div></div><p>Before we can ship the<a class="indexterm" id="id794"/> items we sold, we<a class="indexterm" id="id795"/> first need to purchase or produce them. We discussed the production process in the previous chapter, so let's focus on the purchasing process.</p><p>Technically, the sales and purchase process are mirrored transactions and the application design is similar. The purchase header table has the same document types: quote, order, invoice, credit memo, blanket order, and return order, and the same posting process.</p><p>So instead of going into the similarities, we will discuss the differences.</p><div class="section" title="Resources"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec111"/>Resources</h3></div></div></div><p>In Microsoft Dynamics NAV, it is not possible to<a class="indexterm" id="id796"/> purchase resources. When we take a closer look at the <span class="strong"><strong>Type</strong></span> field (5), we can see that the option is left blank:</p><div class="mediaobject"><img alt="Resources" src="graphics/0365EN_06_10.jpg"/></div></div><div class="section" title="Drop shipments"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec112"/>Drop shipments</h3></div></div></div><p>When selling<a class="indexterm" id="id797"/> items that <a class="indexterm" id="id798"/>are not in the inventory, it is possible to purchase the items from a vendor and have them directly shipped to the customer. This process is called drop shipments.</p><p>This process can be handled manually and using the requisition worksheet.</p><div class="section" title="Manual"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl4sec21"/>Manual</h4></div></div></div><p>To create a drop shipment<a class="indexterm" id="id799"/> manually, the purchase order should first be created using the <span class="strong"><strong>Sell-to Customer No.</strong></span> from the corresponding sales order as the shipping address:</p><div class="mediaobject"><img alt="Manual" src="graphics/0365EN_06_11.jpg"/></div><p>When this is done, we can start the codeunit Purch.-Get Drop Shpt. (76) from <span class="strong"><strong>ACTIONS</strong></span> on the purchase order. This function will show a list of all sales orders for this <span class="strong"><strong>Sell-to Customer No.</strong></span> regardless of whether drop shipment is possible.</p><p>If we select a sales order without sales lines that are marked for drop shipment, we get the following error message:</p><div class="mediaobject"><img alt="Manual" src="graphics/0365EN_06_12.jpg"/></div><p>After retrieving the sales <a class="indexterm" id="id800"/>information, the sales line and purchase line table are connected to each other by populating the <span class="strong"><strong>Purchase Order No.</strong></span>, <span class="strong"><strong>Purch. Order Line No.</strong></span>, <span class="strong"><strong>Sales Order No.</strong></span>, and <span class="strong"><strong>Sales Order Line No.</strong></span> fields.</p><div class="mediaobject"><img alt="Manual" src="graphics/0365EN_06_13.jpg"/></div><p>These fields are numbered 71 and 72 in the sales line and purchase line table.</p></div><div class="section" title="Requisition worksheet"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl4sec22"/>Requisition worksheet</h4></div></div></div><p>We introduced the requisition worksheet<a class="indexterm" id="id801"/> in the previous chapter when we discussed the planning process. The requisition worksheet can also be used for the <span class="strong"><strong>Drop Shipment</strong></span> functionality:</p><div class="mediaobject"><img alt="Requisition worksheet" src="graphics/0365EN_06_14.jpg"/></div><p>This will start the <a class="indexterm" id="id802"/>Get Sales Orders report (698), which will filter on all sales lines marked for drop shipment and creates a line in the requisition worksheet table.</p><p>This line can be processed by carrying out the action messages. This function will also connect the sales order to the purchase order using fields 71 and 72.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note39"/>Note</h3><p>The C/AL code for manual drop shipment and using the requisition worksheet is not normalized (code cloning). This means that changes done in one method should also be done in the other method and maintained twice.</p></div></div></div></div></div><div class="section" title="Document releasing and approval process"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec107"/>Document releasing and approval process</h2></div></div></div><p>Within the sales and purchase document process, there is a workflow available for releasing and approving a document. This is<a class="indexterm" id="id803"/> taken care of by a single <a class="indexterm" id="id804"/>status field and two processes.</p><div class="section" title="Status"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec113"/>Status</h3></div></div></div><p>The <span class="strong"><strong>Status</strong></span> field (120) in the sales header and purchase header table indicates the status of the process. There are four options: <span class="strong"><strong>Open</strong></span>, <span class="strong"><strong>Released</strong></span>, <span class="strong"><strong>Pending Approval</strong></span>, and <span class="strong"><strong>Pending Prepayment</strong></span>.</p><p>Two of these status fields, <span class="strong"><strong>Open</strong></span> and <span class="strong"><strong>Released</strong></span>, are mandatory to use. <span class="strong"><strong>Pending Approval</strong></span> and <span class="strong"><strong>Pending Prepayment</strong></span> are optional.</p><p>We have already discussed prepayments earlier in this chapter.</p></div><div class="section" title="Releasing a document"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec114"/>Releasing a document</h3></div></div></div><p>Before a document <a class="indexterm" id="id805"/>can be posted, it is mandatory to release it. This is done by the codeunits Release Sales Document (414) and Release Purchase Document (415). These codeunits are, as you may have guessed, almost identical.</p><p>The codeunit performs a number of tests before setting the status to <span class="strong"><strong>Released</strong></span>. Let's discuss some of these checks:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A typical example of Test Near, the customer number should not be blank:<div class="informalexample"><pre class="programlisting">TESTFIELD("Sell-to Customer No.");</pre></div></li><li class="listitem" style="list-style-type: disc">There should be at least one sales line with a <code class="literal">Quantity</code>:<div class="informalexample"><pre class="programlisting">SalesLine.SETRANGE("Document Type","Document Type");
SalesLine.SETRANGE("Document No.","No.");
SalesLine.SETFILTER(Type,'&gt;0');
SalesLine.SETFILTER(Quantity,'&lt;&gt;0');
IF NOT SalesLine.FIND('-') THEN
  ERROR(Text001,"Document Type","No.");</pre></div></li><li class="listitem" style="list-style-type: disc">When the testing is done, some final calculations are implemented. These calculations are document calculations that span over the individual sales lines:<div class="informalexample"><pre class="programlisting">SalesSetup.GET;
IF SalesSetup."Calc. Inv. Discount" THEN BEGIN
  CODEUNIT.RUN(CODEUNIT::"Sales-Calc. Discount",SalesLine);
  GET("Document Type","No.");
END;</pre></div></li><li class="listitem" style="list-style-type: disc">The following codeunit calculates the invoice discount:<div class="informalexample"><pre class="programlisting">SalesLine.SetSalesHeader(Rec);
SalesLine.CalcVATAmountLines(0,Rec,SalesLine,TempVATAmountLine0);
SalesLine.CalcVATAmountLines(1,Rec,SalesLine,TempVATAmountLine1);
SalesLine.UpdateVATOnLines(0,Rec,SalesLine,TempVATAmountLine0);
SalesLine.UpdateVATOnLines(1,Rec,SalesLine,TempVATAmountLine1);</pre></div></li><li class="listitem" style="list-style-type: disc">At the end of the releasing process, the VAT calculation is completed.</li><li class="listitem" style="list-style-type: disc">Releasing a document also calculates the <span class="strong"><strong>Amount</strong></span> and <span class="strong"><strong>Amount Including VAT</strong></span> fields on the sales line.</li></ul></div></div><div class="section" title="Manual versus automatic releasing"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec115"/>Manual versus automatic releasing</h3></div></div></div><p>By default, Microsoft <a class="indexterm" id="id806"/>Dynamics NAV releases the document automatically. The posting codeunits sales-post (80) and purchase-post (90) contain the following C/AL code:</p><div class="informalexample"><pre class="programlisting">IF (Status = Status::Open) OR (Status = Status::"Pending Prepayment") THEN BEGIN
  TempInvoice := Invoice;
  TempShpt := Ship;
  TempReturn := Receive;
  GetOpenLinkedATOs(TempAsmHeader);
  CODEUNIT.RUN(CODEUNIT::"Release Sales Document",SalesHeader);
  TESTFIELD(Status,Status::Released);
  Status := Status::Open;
  Invoice := TempInvoice;
  Ship := TempShpt;
  Receive := TempReturn;
  ReopenAsmOrders(TempAsmHeader);  
  MODIFY;
  COMMIT;
  Status := Status::Released;
END;</pre></div><p>This code temporarily releases the document by starting the release codeunit but then sets the status back to <span class="strong"><strong>Open</strong></span>, modifies the records, and commits the transaction. Then, the status is set to <span class="strong"><strong>Released</strong></span>.</p><p>Whenever there is an error afterwards, the status will still be <span class="strong"><strong>Open</strong></span> since that was the status before the <code class="literal">COMMIT</code>.</p></div><div class="section" title="Document approval"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec116"/>Document approval</h3></div></div></div><p>On top of the release <a class="indexterm" id="id807"/>process is a document approval workflow. This feature is designed to work on top of the functionality we already discussed and is optional.</p></div></div><div class="section" title="Deleting sales and purchase documents"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec108"/>Deleting sales and purchase documents</h2></div></div></div><p>During the <a class="indexterm" id="id808"/>life cycle of <a class="indexterm" id="id809"/>our application, many documents will be created. There might come a day when this exceeds the point where some maintenance is required.</p><div class="section" title="Data deletion"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec117"/>Data deletion</h3></div></div></div><p>In the <span class="strong"><strong>IT Administration</strong></span> section of the <span class="strong"><strong>Departments Role Center</strong></span>, we can find a <span class="strong"><strong>Data Deletion</strong></span> section, which is designed <a class="indexterm" id="id810"/>for IT administrators to clean up data, as shown in the following screenshot:</p><div class="mediaobject"><img alt="Data deletion" src="graphics/0365EN_06_15.jpg"/></div><p>When a sales order is invoiced using <span class="strong"><strong>Get Shipment Lines</strong></span> or <span class="strong"><strong>Combined Invoicing</strong></span>, the sales order is not automatically deleted, nor are completely handled blanket orders.</p><p>Leaving old orders in the database may lead to large tables. Since these document tables are heavily inserted and modified throughout the working day by many people, this may lead to unnecessary overhead in the database.</p></div><div class="section" title="Deletion of shipments and invoices"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec118"/>Deletion of shipments and invoices</h3></div></div></div><p>Microsoft Dynamics NAV<a class="indexterm" id="id811"/> allows users to delete posted shipments and<a class="indexterm" id="id812"/> invoices when they are printed.</p><div class="mediaobject"><img alt="Deletion of shipments and invoices" src="graphics/0365EN_06_16.jpg"/></div><p>Although it should be <a class="indexterm" id="id813"/>considered carefully, it <a class="indexterm" id="id814"/>might be necessary for some companies to periodically clean up this data. Most companies never look at the shipments once the items are delivered to their customers.</p><p>Cleaning up these tables will have a positive impact on the performance and maintainability of your system if it reaches the size of roughly 50-100 GB.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip36"/>Tip</h3><p>When designing business analysis reports, never use data from the sales shipment header or line table since they might get deleted. Always use the ledger entry tables instead.</p></div></div></div></div></div>
<div class="section" title="Inventory management"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec46"/>Inventory management</h1></div></div></div><p>In Microsoft Dynamics NAV, inventory<a class="indexterm" id="id815"/> is kept for items in locations using <span class="strong"><strong>Item Ledger Entries</strong></span> and <span class="strong"><strong>Value Entries</strong></span>. On top of this, we can use <span class="strong"><strong>Stock Keeping Units</strong></span> to have different inventory settings per item, location, and variant.</p><p>Let's start by looking at the design patterns of the inventory in Microsoft Dynamics NAV:</p><div class="mediaobject"><img alt="Inventory management" src="graphics/0365EN_06_19.jpg"/></div><p>Keeping inventory can be extended with the use of warehouse management. This is designed to run on top of the <a class="indexterm" id="id816"/>
<span class="strong"><strong>Basic Item Inventory</strong></span> functionality.</p><div class="section" title="Items"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec109"/>Items</h2></div></div></div><p>The item table hosts the master <a class="indexterm" id="id817"/>data for inventory management like a G/L Account does for financial management.</p><div class="mediaobject"><img alt="Items" src="graphics/0365EN_06_20.jpg"/></div><p>In this table, we can do the set<a class="indexterm" id="id818"/> up for each individual item such as pricing, inventory and production strategies, and tracking options.</p></div><div class="section" title="Locations"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec110"/>Locations</h2></div></div></div><p>The location table defines <a class="indexterm" id="id819"/>which level of inventory management is done. A location can either be a physical warehouse somewhere or a part of a warehouse, if one warehouse uses different warehouse strategies.</p><p>If we look at the <span class="strong"><strong>Location Card</strong></span>, we see what we can set up:</p><div class="mediaobject"><img alt="Locations" src="graphics/0365EN_06_21.jpg"/></div><p>Let's see these <a class="indexterm" id="id820"/>settings in detail:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>General</strong></span>: Here, we can specify the physical location of the warehouse. We can also specify <span class="strong"><strong>Use As In-Transit</strong></span>. When this is specified, we can only use transfer orders to move inventory to this location.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Warehouse</strong></span>: On this tab, we specify which level of warehouse management functionality we want to use. If everything is left blank, no warehouse entries are created when this location is used.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Bins</strong></span>: This tab contains the default bins for most inventory activities, such as <span class="strong"><strong>Receipt</strong></span> and <span class="strong"><strong>Shipment</strong></span>. These values can be changed when creating the warehouse documents.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Bin Policies</strong></span>: This<a class="indexterm" id="id821"/> tab contains some more advanced options for warehouse management.</li></ul></div></div><div class="section" title="Variants"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec111"/>Variants</h2></div></div></div><p>Item variants is a<a class="indexterm" id="id822"/> powerful feature in Microsoft Dynamics NAV. It enables us to split an item into different categories without having to create a new item.</p><p>The variant code is maintained in the item ledger entries and used when applying them. Let's see an example of how this can be used.</p><p>Our company sells t-shirts. We have three sizes; small, medium, and large, and four colors; white, black, red, and blue. This enables us to create the following twelve unique variant codes:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th colspan="4" style="text-align: center" valign="bottom">
<p>Size and color</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>S-WHITE</p>
</td><td style="text-align: left" valign="top">
<p>S-BLACK</p>
</td><td style="text-align: left" valign="top">
<p>S-RED</p>
</td><td style="text-align: left" valign="top">
<p>S-BLUE</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>M-WHITE</p>
</td><td style="text-align: left" valign="top">
<p>M-BLACK</p>
</td><td style="text-align: left" valign="top">
<p>M-RED</p>
</td><td style="text-align: left" valign="top">
<p>M-BLUE</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>L-WHITE</p>
</td><td style="text-align: left" valign="top">
<p>L-BLACK</p>
</td><td style="text-align: left" valign="top">
<p>L-RED</p>
</td><td style="text-align: left" valign="top">
<p>L-BLUE</p>
</td></tr></tbody></table></div><p>When we purchase or produce these t-shirts, we need to specify the variant code, which is inherited into the item ledger entry.</p><p>If we sell or transfer one of these items, we can specify the same variant code. Microsoft Dynamics NAV will then use this variant code when searching for inventory.</p><div class="mediaobject"><img alt="Variants" src="graphics/0365EN_06_22.jpg"/></div></div><div class="section" title="Stock keeping units"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec112"/>Stock keeping units</h2></div></div></div><p>Sometimes, the same <a class="indexterm" id="id823"/>item can have more than one unit cost, replenishment system, or production method. To support this, we<a class="indexterm" id="id824"/> can use stock keeping units.</p><p>A stock keeping unit refers to an existing item, location, and variant. These three fields are the unique primary key. Let's see an example of how this can be used. Our t-shirts need to have different unit costs. In order to do this, we need to create a SKU for each variant we just created:</p><div class="mediaobject"><img alt="Stock keeping units" src="graphics/0365EN_06_23.jpg"/></div><p>When we now create two purchase order lines for the same item with a different variant code, we can see that the <span class="strong"><strong>Last Direct Cost</strong></span> is different for each variant.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note40"/>Note</h3><p>
<span class="strong"><strong>Stockkeeping Units</strong></span> is a very powerful feature of Microsoft Dynamics. It enables you to change the settings for an item after it is created, using variant codes for each setting. Make sure the code of the variant is self-explanatory.</p></div></div><div class="section" title="Creating a SKU function"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec119"/>Creating a SKU function</h3></div></div></div><p>When an item has many <a class="indexterm" id="id825"/>variants and locations, creating the SKU for <a class="indexterm" id="id826"/>each combination can be quite a challenge. To help in this process, we can use the <span class="strong"><strong>Create Stockkeeping Unit</strong></span> report (5706).</p><p>The newly created SKU will inherit all the necessary fields from the item. After this, we can go in and make necessary changes to the individual SKU records:</p><div class="mediaobject"><img alt="Creating a SKU function" src="graphics/0365EN_06_24.jpg"/></div></div></div><div class="section" title="Sales pricing"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec113"/>Sales pricing</h2></div></div></div><p>The basic unit price of an item can be set <a class="indexterm" id="id827"/>in the <span class="strong"><strong>Item</strong></span> table. This is a static field, which is used when a new sales document is created. To use more flexible unit prices, we can use the <span class="strong"><strong>Sales Prices</strong></span> and <span class="strong"><strong>Sales Discounts</strong></span> functionality:</p><div class="mediaobject"><img alt="Sales pricing" src="graphics/0365EN_06_25.jpg"/></div><p>More information about <a class="indexterm" id="id828"/>pricing can be found in <a class="link" href="ch01.html" title="Chapter 1. Introduction to Microsoft Dynamics NAV">Chapter 1</a>, <span class="emphasis"><em>Introduction to Microsoft Dynamics NAV</em></span>, and <a class="link" href="ch02.html" title="Chapter 2. A Sample Application">Chapter 2</a>, <span class="emphasis"><em>A Sample Application</em></span>.</p></div><div class="section" title="Item ledger entry application"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec114"/>Item ledger entry application</h2></div></div></div><p>When the inventory is<a class="indexterm" id="id829"/> created and used, the system<a class="indexterm" id="id830"/> will apply and close positive and negative item ledger entries with each other. This enables us to trace inventory.</p><p>The application is saved in <span class="strong"><strong>Item Application Entry</strong></span> table (339). Let's have a look at the C/AL code that handles the item application.</p><div class="section" title="Item application C/AL routine"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec120"/>Item application C/AL routine</h3></div></div></div><p>Item application is done in <a class="indexterm" id="id831"/>codeunit Item Jnl.-Post Line (22) in the <code class="literal">ApplyItemLedgEntry</code> function. The function starts with checking whether reservations are used. Using reservations changes the way inventory application is used. We'll discuss reservations later in this chapter.</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ApplyItemLedgEntry</strong></span>
...

CLEAR(OldItemLedgEntry);
...
REPEAT
  ItemJnlLine.CALCFIELDS("Reserved Qty. (Base)");
  IF ItemJnlLine."Assemble to Order" THEN BEGIN
    ItemJnlLine.TESTFIELD("Reserved Qty. (Base)");
    ItemJnlLine.TESTFIELD("Applies-to Entry");
  END ELSE
    IF ItemJnlLine."Reserved Qty. (Base)" &lt;&gt; 0 THEN BEGIN
      IF ItemLedgEntry."Applies-to Entry" &lt;&gt; 0 THEN
        ItemLedgEntry.FIELDERROR(
          "Applies-to Entry",Text99000000);
    END;
    ...
  END ELSE
    StartApplication := TRUE;</pre></div><p>If there are no reservations made, the system will start the application code. This allows two possibilities: manual application and automatic application.</p><p>Manual application is done when the user populates the <span class="strong"><strong>Applies-to Entry</strong></span> field in the item journal line. This is also used when users change the application.</p><div class="informalexample"><pre class="programlisting">IF StartApplication THEN BEGIN
  ItemLedgEntry.CALCFIELDS("Reserved Quantity");
  IF ItemLedgEntry."Applies-to Entry" &lt;&gt; 0 THEN BEGIN
    IF FirstApplication THEN BEGIN
      FirstApplication := FALSE;
      OldItemLedgEntry.GET(ItemLedgEntry."Applies-to Entry");
      OldItemLedgEntry.TESTFIELD("Item No.",ItemLedgEntry."Item No.");
      OldItemLedgEntry.TESTFIELD("Variant Code",ItemLedgEntry."Variant Code");

      OldItemLedgEntry.TESTFIELD(Positive,NOT ItemLedgEntry.Positive);
      OldItemLedgEntry.TESTFIELD("Location Code",ItemLedgEntry."Location Code");</pre></div><p>In this case, the system <a class="indexterm" id="id832"/>checks whether the <span class="strong"><strong>Item Ledger Entry</strong></span> we have specified matches the requirements. When the application is done automatically, the system will search for the best item ledger entry based on the same requirements.</p><div class="informalexample"><pre class="programlisting">END ELSE BEGIN
  IF FirstApplication THEN BEGIN
    FirstApplication := FALSE;
    ItemLedgEntry2.SETCURRENTKEY("Item No.",Open,"Variant Code",
      Positive,"Location Code","Posting Date");
    ItemLedgEntry2.SETRANGE("Item No.",ItemLedgEntry."Item No.");
    ItemLedgEntry2.SETRANGE(Open,TRUE);
    ItemLedgEntry2.SETRANGE("Variant Code",ItemLedgEntry.
      "Variant Code");
    ItemLedgEntry2.SETRANGE(Positive,NOT ItemLedgEntry.Positive);
    ItemLedgEntry2.SETRANGE("Location Code",
      ItemLedgEntry."Location Code");

    IF ItemLedgEntry."Job Purchase" = TRUE THEN BEGIN
      ItemLedgEntry2.SETRANGE("Job No.",ItemLedgEntry."Job No.");
      ItemLedgEntry2.SETRANGE("Job Task No.",
        ItemLedgEntry."Job Task No.");
      ...
    END;
    IF ItemTrackingCode."SN Specific Tracking" THEN
      ItemLedgEntry2.SETRANGE("Serial No.",
        ItemLedgEntry."Serial No.");
    IF ItemTrackingCode."Lot Specific Tracking" THEN
      ItemLedgEntry2.SETRANGE("Lot No.",ItemLedgEntry."Lot No.");

    IF Location.GET(ItemLedgEntry."Location Code") THEN
      IF Location."Use As In-Transit" THEN
        ItemLedgEntry2.SETRANGE("Transfer Order No.",
          ItemLedgEntry."Transfer Order No.");

    IF Item."Costing Method" = Item."Costing Method"::LIFO THEN
      EntryFindMethod := '+'
    ELSE
      EntryFindMethod := '-';
    IF NOT ItemLedgEntry2.FIND(EntryFindMethod) THEN
      EXIT;</pre></div><p>The actual application entry<a class="indexterm" id="id833"/> is created in the <code class="literal">InsertApplEntry</code> function.</p></div><div class="section" title="Requirements to apply an item ledger"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec121"/>Requirements to apply an item ledger</h3></div></div></div><p>In order to apply an <a class="indexterm" id="id834"/>item ledger entry to another item ledger entry, certain requirements should be taken into account. We can read these requirements from the C/AL code:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="strong"><strong>Item No.</strong></span> should be the same for both the entries.</li><li class="listitem" style="list-style-type: disc">The old item ledger entry should be <span class="strong"><strong>Open</strong></span>. When an item ledger entry is fully applied, the Boolean field <span class="strong"><strong>Open</strong></span> is set to <span class="strong"><strong>False</strong></span>.</li><li class="listitem" style="list-style-type: disc">The variant code and location code should be the same.</li><li class="listitem" style="list-style-type: disc">The Boolean field <span class="strong"><strong>Positive</strong></span> should have a reverse sign. This results in the limitation of not being able to apply one negative entry to another negative entry.</li></ul></div><p>Other requirements are conditional based on system setup. For example, if the item uses a <span class="strong"><strong>Lot No.</strong></span> or <span class="strong"><strong>Serial No.</strong></span>, this should also match.</p><p>When the system has defined the filter, it tries to find the first record. The search method depends on the costing method. If the cost method is LIFO, the system will try to find the last record in the filter. For all other costing methods, it will find the first.</p><p>We can also see that when using<a class="indexterm" id="id835"/> Lot numbers, the application and the costing is done within the Lot number.</p></div></div><div class="section" title="Value entries"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec115"/>Value entries</h2></div></div></div><p>In Microsoft Dynamics NAV, the <a class="indexterm" id="id836"/>physical information for Inventory is<a class="indexterm" id="id837"/> stored separately from the financial information. This information is stored in a one-to-many relation, meaning one Item Ledger Entry can have multiple Value Entries.</p><p>This enables us to specify the value information in detail in a time dimension and cost type dimension.</p><div class="section" title="Direct cost"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec122"/>Direct cost</h3></div></div></div><p>Each item ledger entry starts with at least one value entry of the type <a class="indexterm" id="id838"/>direct cost. This defines the initial value of the inventory. During the inventory lifetime, the item ledger entry can get the following four other types of value entries:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Revaluation</strong></span>: This entry type is used when the item revaluation batch is started and the value of the item is different compared to the direct cost.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Rounding</strong></span>: Sometimes, the inventory adjustment leads into rounding issues. The rounding is stored as a special entry type for traceability.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Indirect Cost</strong></span>: When <span class="strong"><strong>Indirect Cost %</strong></span> is used on the item card the system will create additional value entries for the indirect cost amount.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Variance</strong></span>: When the item uses standard cost, the difference between the invoiced amount and the standard cost is saved as an entry type variance.</li></ul></div></div><div class="section" title="Value entries and general ledger entries"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec123"/>Value entries and general ledger entries</h3></div></div></div><p>The value entries and general ledger<a class="indexterm" id="id839"/> entries are linked through the G/L - Item Ledger Relation table (5823). Each general ledger entry is linked to one or more value entries. This enables traceability and helps auditors to analyze the system.</p></div></div><div class="section" title="Transfer orders"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec116"/>Transfer orders</h2></div></div></div><p>To move inventory from one <a class="indexterm" id="id840"/>location to another location, it is<a class="indexterm" id="id841"/> possible to do a negative and a positive adjustment in the <span class="strong"><strong>Item Journal Line</strong></span>, but we can also use a <span class="strong"><strong>Transfer Order</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img alt="Transfer orders" src="graphics/0365EN_06_26.jpg"/></div><p>The <span class="strong"><strong>Transfer Order</strong></span> creates the item ledger entries for each location and maintains the link for the value entries.</p><p>This means that if we move 100 items from location blue to green without having received the purchase invoice yet, the system will create value entries for the moved inventory when the invoice is posted. Let's try this for a new item.</p><div class="section" title="Example"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec124"/>Example</h3></div></div></div><p>The item we will use is <span class="strong"><strong>Jeans</strong></span>. The first step is<a class="indexterm" id="id842"/> to create the item as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We only define the <span class="strong"><strong>No.</strong></span>, <span class="strong"><strong>Description</strong></span>, <span class="strong"><strong>Base UOM</strong></span>, and the <span class="strong"><strong>Posting Groups</strong></span>.</li><li class="listitem">Now, we create a new purchase order with quantity 10 in location <span class="strong"><strong>BLUE</strong></span>.</li><li class="listitem">We receive the purchase order.</li><li class="listitem">Using a new transfer order, we move the inventory from <span class="strong"><strong>BLUE</strong></span> to <span class="strong"><strong>RED</strong></span>.<p>This will result in five <span class="strong"><strong>Item Ledger Entries</strong></span> with five <span class="strong"><strong>Value Entries</strong></span> but the total cost is zero since we<a class="indexterm" id="id843"/> have not yet received the purchase invoice.</p><div class="mediaobject"><img alt="Example" src="graphics/0365EN_06_27.jpg"/></div></li><li class="listitem">Now, we create a new purchase invoice and get the receipt lines. We use a <span class="strong"><strong>Unit Cost</strong></span> of <span class="strong"><strong>10</strong></span>.<div class="mediaobject"><img alt="Example" src="graphics/0365EN_06_28.jpg"/></div><p>This results in a value entry for the original item ledger entry.</p></li><li class="listitem">To create the value entries for the transfers, we need to run the Adjust Cost - Item Entries report (795). This results in all item ledger entries having the same value entries:<div class="mediaobject"><img alt="Example" src="graphics/0365EN_06_29.jpg"/></div></li></ol></div></div></div><div class="section" title="Requisition worksheets"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec117"/>Requisition worksheets</h2></div></div></div><p>For trading companies, it is very<a class="indexterm" id="id844"/> important to have just enough <a class="indexterm" id="id845"/>inventories; not too many, not too few. In order to do this, we can use the requisition journals together with the reordering policy on the item.</p><div class="section" title="Reordering policy"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec125"/>Reordering policy</h3></div></div></div><p>The reordering policy<a class="indexterm" id="id846"/> tells the system how to calculate the moment and the quantity for item<a class="indexterm" id="id847"/> ordering. Microsoft Dynamics NAV uses the following four different reordering policies:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Fixed Reorder Qty.</strong></span>: Each time <a class="indexterm" id="id848"/>we run the requisition journal, the system will purchase the same, fixed quantity of items. This quantity is specified in the <span class="strong"><strong>Reorder Quantity</strong></span> field.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Maximum Qty.</strong></span>: The system will <a class="indexterm" id="id849"/>purchase as many items to meet the value of the <span class="strong"><strong>Maximum Inventory</strong></span> field.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Order</strong></span>: For each<a class="indexterm" id="id850"/> sales order, a purchase order will be created. This automatically enables the reservation process for this item.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Lot-for-Lot</strong></span>: This option will <a class="indexterm" id="id851"/>calculate the required inventory necessary to deliver the outstanding sales orders.</li></ul></div><p>The quantity is calculated in the codeunit Inventory Profile Offsetting (99000854) in the <code class="literal">CalcReorderQty</code> function.</p></div><div class="section" title="Extending the reordering policy"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec126"/>Extending the reordering policy</h3></div></div></div><p>The ordering policy <a class="indexterm" id="id852"/>algorithms in Microsoft Dynamics NAV are very static and some trading companies need more flexibility.</p><p>One example is seasonal and depends on the weather. Toy stores need extra inventory during Christmas and garden tool stores have their peak in spring. During these peaks, the delivery times and availability is also different compared to the other times of the year.</p></div><div class="section" title="Virtual inventory"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec127"/>Virtual inventory</h3></div></div></div><p>An upcoming trend in trading companies is<a class="indexterm" id="id853"/> virtual inventory. This is the inventory that we do not<a class="indexterm" id="id854"/> control but is available to sell to our customers. The computer industry uses this frequently. Everyone can start a website for computer equipment and use the inventory of large wholesale companies.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note41"/>Note</h3><p>In order for this to work, the information should always be real time and reliable. In Microsoft Dynamics NAV, we could solve this using web services.</p></div></div></div></div></div>
<div class="section" title="Warehouse management"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec47"/>Warehouse management</h1></div></div></div><p>With inventory management, we <a class="indexterm" id="id855"/>can use the locations to see where the inventory is. For some trading companies, this is good enough but some would like to be more specific in where the items are in the warehouse.</p><p>For this, we can use the <span class="strong"><strong>Warehouse Management Systems</strong></span> (<span class="strong"><strong>WMS</strong></span>)<a class="indexterm" id="id856"/> functionality in Microsoft Dynamics NAV. WMS enables us to specify zones and bins within each location.</p><p>Another feature in warehouse management is the possibility of combining sales shipments and purchase receipts in warehouse documents. Using these documents, warehouse employees can pick or put away for more than one order at the same time resulting in a more efficient way of doing logistics.</p><div class="section" title="Warehouse strategy levels"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec118"/>Warehouse strategy levels</h2></div></div></div><p>Warehouse management can be used and <a class="indexterm" id="id857"/>implemented<a class="indexterm" id="id858"/> from very simple to highly advanced. To demonstrate the application design of WMS in Microsoft Dynamics NAV, we will discuss the following five possible levels of implementation. For each level, we will show the table and posting models.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Bin Code</strong></span>: Using this field in the <a class="indexterm" id="id859"/>sales and purchase document enables the system to start creating warehouse entries.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Warehouse Receipt and Shipment</strong></span>: This <a class="indexterm" id="id860"/>allows us to combine sales shipments and purchase receipts in one warehouse document. We cannot use the <span class="strong"><strong>Pick and Put-Away</strong></span> activities.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Warehouse Put-Away and Pick</strong></span>: For each <a class="indexterm" id="id861"/>purchase receipt or sales shipment, we can create a <span class="strong"><strong>Put-Away or Pick</strong></span> journal.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Warehouse Receipt and Shipment + Use Put-away Worksheet</strong></span>: This allows us to implement a real <a class="indexterm" id="id862"/>two-step warehouse process and receive the items on a staging location and creating put-away documents to move the items to their storage location in the warehouse.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Directed Put-Away and Pick</strong></span>: This is<a class="indexterm" id="id863"/> the full option of WMS functionality in Microsoft Dynamics NAV. We use <span class="strong"><strong>Receipts</strong></span>, <span class="strong"><strong>Shipments</strong></span>, <span class="strong"><strong>Put-aways</strong></span>, and <span class="strong"><strong>Picks</strong></span>. Microsoft Dynamics<a class="indexterm" id="id864"/> NAV will suggest the <span class="strong"><strong>Bin Codes</strong></span>. We can also use <span class="strong"><strong>Zones</strong></span>, <span class="strong"><strong>Cross Docking</strong></span>, and so on.</li></ul></div></div><div class="section" title="Location setup"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec119"/>Location setup</h2></div></div></div><p>The setup<a class="indexterm" id="id865"/> options in the Location table (14) enable or disable the WMS options in Microsoft Dynamics NAV. This is done on the <span class="strong"><strong>Warehouse</strong></span> tab, as shown in the following screenshot. Each level requires a special combination of settings.</p><div class="mediaobject"><img alt="Location setup" src="graphics/0365EN_06_30.jpg"/></div><p>Let's have a look at the different levels:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Level 1</strong></span>: Enable Bin Mandatory</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Level 2</strong></span>: Enable Require Receive, Require Shipment, and Bin Mandatory</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Level 3</strong></span>: Enable Require Put-away, Require Pick, and Bin Mandatory</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Level 4</strong></span>: Enable Require Receive, Shipment, Require Put-away, Require Pick, Bin Mandatory, and Use Put-away Worksheet</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Level 5</strong></span>: Enable Require Receive, Require Shipment, Require Put-away, Require Pick, Bin Mandatory, and Directed Put-away and Pick</li></ul></div><div class="section" title="Warehouse employees"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec128"/>Warehouse employees</h3></div></div></div><p>Before we can start, the <a class="indexterm" id="id866"/>current user should be set up as a warehouse employee.</p><div class="mediaobject"><img alt="Warehouse employees" src="graphics/0365EN_06_31.jpg"/></div><p>This can be done by creating a new record in the Warehouse Employee table (7301).</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note42"/>Note</h3><p>Each user can be a warehouse employee in each location and can only do warehouse actions in the locations that they are assigned to.</p></div></div></div></div><div class="section" title="Bin code | level 1"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec120"/>Bin code | level 1</h2></div></div></div><p>The starting level of implementing <a class="indexterm" id="id867"/>WMS is using the Bin table. This is done by enabling the <span class="strong"><strong>Bin Mandatory</strong></span> field on the location. The <span class="strong"><strong>Bin Code</strong></span> field is available in all the necessary tables, such as Purchase Line, Sales Line, and Item Journal Line.</p><p>When the <span class="strong"><strong>Bin Code</strong></span> is used, codeunit Item Jnl.-Post Line (22) will create a Warehouse Journal Line and start the Whse. Jnl.-Register Line Codeunit (7301). This will result in the creation of Warehouse Entries (7312) and a Bin Content (7302).</p><div class="section" title="Example"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec129"/>Example</h3></div></div></div><p>We will create a new location,<a class="indexterm" id="id868"/> <span class="strong"><strong>ORANGE</strong></span>, with a bin of <span class="strong"><strong>BIN1</strong></span>. The location uses the <span class="strong"><strong>Bin Mandatory</strong></span> option, as shown in the following screenshot:</p><div class="mediaobject"><img alt="Example" src="graphics/0365EN_06_32.jpg"/><div class="caption"><p>Bin Mandatory</p></div></div><p>In a new purchase order, we can now select this new Bin Code and post a receipt. The system now creates a new record in the <span class="strong"><strong>Bin Content</strong></span> table, which enables us to see the created <span class="strong"><strong>Warehouse Entries</strong></span>.</p><div class="mediaobject"><img alt="Example" src="graphics/0365EN_06_33.jpg"/></div></div><div class="section" title="Bin content"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec130"/>Bin content</h3></div></div></div><p>Whenever a Bin is used for <a class="indexterm" id="id869"/>the first time, Microsoft Dynamics NAV will create a <span class="strong"><strong>Bin Content</strong></span> record. A <span class="strong"><strong>Bin Content</strong></span> record is neither master data nor a ledger entry or document. It is a special kind of table in the philosophy of Microsoft Dynamics NAV.</p><p>The C/AL code for the <span class="strong"><strong>Bin Content</strong></span> handling can be found in codeunit Whse. Jnl.-Register Line (7301). To see which Bins are used for an item at any moment, we can open the <span class="strong"><strong>Bin Content</strong></span> from the <span class="strong"><strong>Item Card</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img alt="Bin content" src="graphics/0365EN_06_34.jpg"/></div><p>The warehouse <a class="indexterm" id="id870"/>entries can be displayed by clicking on the <span class="strong"><strong>Quantity (Base)</strong></span> field.</p></div></div><div class="section" title="Receipt and shipment | level 2"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec121"/>Receipt and shipment | level 2</h2></div></div></div><p>When we enable<a class="indexterm" id="id871"/> <span class="strong"><strong>Require Receive</strong></span> and <span class="strong"><strong>Require Shipment</strong></span> in the location, we can start using the warehouse receipt and shipment documents. These documents allow us to receive or ship multiple purchase or sales orders in one document.</p><p>Let's have a look at how this is done in the application:</p><div class="mediaobject"><img alt="Receipt and shipment | level 2" src="graphics/0365EN_06_35.jpg"/></div><div class="section" title="Warehouse request"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec131"/>Warehouse request</h3></div></div></div><p>All warehouse documents start with a record <a class="indexterm" id="id872"/>Warehouse Request table (5765). These records are created when a sales or purchase document is released.</p><p>The warehouse receipt or shipment can be created in the following three ways:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Using the <span class="strong"><strong>Create Whse. Receipt</strong></span> or <span class="strong"><strong>Create Whse. Shipment</strong></span> option from the purchase and sales order</li><li class="listitem" style="list-style-type: disc">Using the Get Source Documents report (5723)</li><li class="listitem" style="list-style-type: disc">Using the <span class="strong"><strong>Get Source Documents</strong></span> option on the <span class="strong"><strong>Warehouse Receipt</strong></span> or <span class="strong"><strong>Shipment Card</strong></span></li></ul></div><p>The first two options will create a new warehouse document for each sales or purchase document. The latter allows us to combine orders in one warehouse document.</p><div class="mediaobject"><img alt="Warehouse request" src="graphics/0365EN_06_36.jpg"/></div></div><div class="section" title="Limitations"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec132"/>Limitations</h3></div></div></div><p>Using only the warehouse <a class="indexterm" id="id873"/>receipt and shipment document is basically just adding one layer on top of the sales and purchase document. The posting routines <span class="strong"><strong>Whse. Post Shipment (5763)</strong></span> and <span class="strong"><strong>Whse. Post Receipt (5760)</strong></span>, do not actually post something to the warehouse; they just write back the Bin code to the Sales Line and Purchase Line table. Technically, this uses the same C/AL code as level 1.</p><p>We can see how this is done by looking at the <code class="literal">InitSourceDocumentLines</code> function of, for example, Codeunit Whse. Post Receipt (5760):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>InitSourceDocumentLines</strong></span>
WhseRcptLine2.COPY(WhseRcptLine);
WITH WhseRcptLine2 DO BEGIN
  CASE "Source Type" OF
    DATABASE::"Purchase Line":
      BEGIN
        PurchLine.SETRANGE("Document Type","Source Subtype");
        PurchLine.SETRANGE("Document No.","Source No.");
        IF PurchLine.FIND('-') THEN
          REPEAT
              ...
              IF PurchLine."Bin Code" &lt;&gt; "Bin Code" THEN BEGIN
                PurchLine."Bin Code" := "Bin Code";
                ModifyLine := TRUE;
              END;
              ...
            IF ModifyLine THEN
              PurchLine.MODIFY;</pre></div><p>When the source tables are updated, the system creates a normal purchase receipt or sales shipment using codeunits sales-post (80) and Purch. Post (90).</p></div></div><div class="section" title="Put-away and Pick | level 3"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec122"/>Put-away and Pick | level 3</h2></div></div></div><p>Instead of creating a warehouse <a class="indexterm" id="id874"/>receipt or shipment, we can also directly create a Put-away or Pick from the sales or purchase order.</p><p>To enable this, we need to activate the <span class="strong"><strong>Require Put-away</strong></span> and <span class="strong"><strong>Require Pick</strong></span> options on the <span class="strong"><strong>Location Card</strong></span>.</p><div class="mediaobject"><img alt="Put-away and Pick | level 3" src="graphics/0365EN_06_37.jpg"/></div><div class="section" title="Warehouse request"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec133"/>Warehouse request</h3></div></div></div><p>The warehouse request<a class="indexterm" id="id875"/> record is exactly the same as in level 2, but instead of creating a warehouse receipt or shipment, the system directly creates a warehouse activity header and line.</p></div><div class="section" title="Warehouse activities"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec134"/>Warehouse activities</h3></div></div></div><p>The <a class="indexterm" id="id876"/>warehouse activity header and line table are the internal Microsoft Dynamics NAV warehouse documents. There are five types of warehouse activity documents<a class="indexterm" id="id877"/>, they are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Put-away</strong></span>: This<a class="indexterm" id="id878"/> document is used to move items from the receipt bin to a put-away bin. The document is generated from a warehouse receipt.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Pick</strong></span>: This <a class="indexterm" id="id879"/>document is used to move items from a storage bin to a shipment bin. The document is generated from a warehouse shipment.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Movement</strong></span>: This is an <a class="indexterm" id="id880"/>internal document that is used to move items internally in the warehouse.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Invt. Put-away</strong></span>: This <a class="indexterm" id="id881"/>document is used to receive items and put them directly into the warehouse on their permanent bin. The document is created from a warehouse request.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Invt. Pick</strong></span>: This<a class="indexterm" id="id882"/> document is used to ship items directly from the warehouse in one step. The document is created from a warehouse request.</li></ul></div><p>When only<a class="indexterm" id="id883"/> using the <span class="strong"><strong>Require Put-away</strong></span> and <span class="strong"><strong>Require Pick</strong></span> option on a location, document types <span class="strong"><strong>Invt. Put-Away</strong></span> and <span class="strong"><strong>Invt. Pick</strong></span> are used. This will also make sure that the purchase order and sales order will be processed by starting codeunit sales-post (80) and Purch. Post (90).</p></div><div class="section" title="Level 2 and level 3 comparison"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec135"/>Level 2 and level 3 comparison</h3></div></div></div><p>Both level 2 and level 3 setup options<a class="indexterm" id="id884"/> are one-step warehouse implementations. When receiving an item, we must provide the storage bin where the item will be stored until it is sold. There is no additional step.</p><p>Using the warehouse receipt and shipment documents allows us to combine sales and purchase documents on one warehouse document. This cannot be done using direct Put-away and Pick. Using direct Put-away and Pick, we can split one sales line or purchase line into multiple bins. This cannot be done using warehouse receipt and shipment documents.</p><p>The reason for this is the way the warehouse entries are created. Level 2 uses the <span class="strong"><strong>Bin</strong></span> field in the <span class="strong"><strong>Item Journal Line</strong></span> to create the warehouse entries.</p><p>Using level 3, the warehouse entries are created using codeunit Whse.-Activity-Post (7324). The Bin code is not written back into the sales line or purchase line. This means we also cannot use the <span class="strong"><strong>Bin</strong></span> code field in the purchase receipt and sales shipment documents.</p></div></div><div class="section" title="Level 4 – receipt with Put-away worksheet"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec123"/>Level 4 – receipt with Put-away worksheet</h2></div></div></div><p>Most warehouses use a two-step <a class="indexterm" id="id885"/>receipt and shipment process. The first step is receiving the items on a receipt location, which is often close to the unloading docks. Then, the items are stored in their warehouse location until they are required for the production or sales process. This is step 2.</p><p>To enable this two-step process, we can combine level 2 and 3 by using the options <span class="strong"><strong>Require Receive</strong></span>, <span class="strong"><strong>Shipment</strong></span>, <span class="strong"><strong>Put-away and Pick</strong></span> + <span class="strong"><strong>Bin Mandatory</strong></span> + <span class="strong"><strong>Use Put-away worksheet</strong></span> in the <span class="strong"><strong>Location Card</strong></span>.</p><p>This allows us to first perform the warehouse receipt and shipment as discussed in level 2. When we process this document, it will not only post the sales order and purchase order but it will also generate a record in the Whse. Put-away Request table (7324).</p><div class="mediaobject"><img alt="Level 4 – receipt with Put-away worksheet" src="graphics/0365EN_06_38.jpg"/></div><div class="section" title="Whse.- activity register versus whse.-activity-post"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec136"/>Whse.- activity register versus whse.-activity-post</h3></div></div></div><p>When the whse. put-away <a class="indexterm" id="id886"/>request is processed using the warehouse worksheet, it will result in a warehouse activity header and line. In this context, the system will use the Put-away and pick document type that we discussed in the previous section about level 3.</p><p>Technically, the documents for level 3 and level 4 are equal, but there are the following two differences:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">In a two-step warehouse setup, the items are already in a warehouse entry. This means we have to move them. This results in two new warehouse entries but also two lines in the warehouse document.</li><li class="listitem" style="list-style-type: disc">The two-step warehouse documents are not posted but registered. This means that the system will only create warehouse entries and no longer updates the sales and purchase documents.</li></ul></div></div></div><div class="section" title="Level 5 – directed put-away and pick"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec124"/>Level 5 – directed put-away and pick</h2></div></div></div><p>Combining warehouse receipts and <a class="indexterm" id="id887"/>shipments with put-aways and picks completes the table and posting diagram of WMS in Microsoft Dynamics NAV. But there are additional options to enrich the functionality.</p><p>One of these options is directed put-away and pick. When this option is activated, the system can and will help us in finding the correct bins for each warehouse activity.</p><div class="section" title="Zones and default bins"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec137"/>Zones and default bins</h3></div></div></div><p>Let's start with defining zones and default bins. A <a class="indexterm" id="id888"/>zone is a group of bins. Usually, they are located near each other physically but more importantly, they share some properties.</p><p>For each zone, we need to specify if it is <a class="indexterm" id="id889"/>allowed to receive, ship, put-away, and pick. This is done in the <span class="strong"><strong>Bin Type</strong></span> list.</p><p>When defining the bins, it is recommended to use a logical name such as R-01-001 for <span class="strong"><strong>Receipt</strong></span> row one shelf one:</p><div class="mediaobject"><img alt="Zones and default bins" src="graphics/0365EN_06_39.jpg"/></div><p>The default bins are set up in the <span class="strong"><strong>Location Card</strong></span> on the <span class="strong"><strong>Bin</strong></span> tab. These bins can always be changed on each document.</p></div><div class="section" title="Bin calculation"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec138"/>Bin calculation</h3></div></div></div><p>The bin calculation is done for the <a class="indexterm" id="id890"/>put-away documents using templates. This template defines the rules for finding the correct bin to store the items:</p><div class="mediaobject"><img alt="Bin calculation" src="graphics/0365EN_06_40.jpg"/></div><p>The find options are stored in the put-away template line table (7308); they are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Find Fixed Bin</strong></span>: The system will try to find a bin, which is fixed. A fixed bin is usually reserved for a specific item.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Find Floating Bin</strong></span>: This will try to find the first available bin.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Find Same Item</strong></span>: This will filter on an available bin that already contains this item.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Find Unit of Measure Match</strong></span>: This option can be used if parts of the warehouse are designed to handle a specific kind of carrier such as Euro or US pallet.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Find Bin w. Less than Min. Qty</strong></span>: Use this option to find bins that are not fully used. If this option is not used with the <span class="strong"><strong>Find Same Item</strong></span>, it might result in two items in the same bin.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Find Empty Bin</strong></span>: This <a class="indexterm" id="id891"/>option will make sure we find an empty bin.</li></ul></div><p>The C/AL code that handles the bin calculation is located in codeunit create put-away (7313). Let's have a look:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Code()</strong></span>
IF Location."Directed Put-away and Pick" THEN BEGIN
  BinType.CreateBinTypeFilter(BinTypeFilter,2);
  REPEAT
    QtyToPutAwayBase := RemQtyToPutAwayBase;
    IF NOT (PutAwayTemplLine."Find Empty Bin" OR 
      PutAwayTemplLine."Find Floating Bin") OR
      PutAwayTemplLine."Find Fixed Bin" OR
      PutAwayTemplLine."Find Same Item" OR
      PutAwayTemplLine."Find Unit of Measure Match" OR
      PutAwayTemplLine."Find Bin w. Less than Min. Qty"
    THEN BEGIN
        //Calc Availability per Bin Content
        IF FindBinContent("Location Code","Item No.",
          "Variant Code",WarehouseClassCode) 
        THEN
          REPEAT
            ...
          UNTIL (BinContent.NEXT(-1) = 0) OR EverythingHandled
      END ELSE BEGIN

        //Calc Availability per Bin
        IF FindBin("Location Code",WarehouseClassCode) THEN
          REPEAT
            IF Bin.Code &lt;&gt; "Bin Code" THEN BEGIN
              ...
            END;
          UNTIL (Bin.NEXT(-1) = 0) OR EverythingHandled
      END
    UNTIL (PutAwayTemplLine.NEXT = 0) OR EverythingHandled;</pre></div><p>For each record in the put-away template line table, the system will try to find a bin. This means that if the rules of the first template line fail, it will use the second template line and so forth.</p><p>The two<a class="indexterm" id="id892"/> options <code class="literal">Find Empty Bin</code> and <code class="literal">Find Floating Bin</code> eliminate using the others. If these are <code class="literal">true</code>, the system will call the <code class="literal">FindBin</code> function. For the other options, it will use the <code class="literal">FindBinContent</code> function.</p></div></div><div class="section" title="Implementing and customizing warehouse management"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec125"/>Implementing and customizing warehouse management</h2></div></div></div><p>Since there are many ways to set up <a class="indexterm" id="id893"/>WMS in Microsoft Dynamics NAV, it is <a class="indexterm" id="id894"/>very important to make the correct decisions at the start of the implementation. Moving the system from one strategy to another is quite a challenge.</p><p>It is therefore very important to discuss all possibilities and compare them to the way your company works.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note43"/>Note</h3><p>A common mistake when implementing WMS software is trying to solve procedural issues with a computer system. The simple rule is: "If it does not work without a computer system, it will most certainly not work with a computer system".</p></div></div><p>Customizing and changing WMS should be done very carefully since the data flow is very complex, especially for Microsoft Dynamics NAV standards.</p></div></div>
<div class="section" title="Reservations"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec48"/>Reservations</h1></div></div></div><p>In Microsoft Dynamics NAV, it is possible to do <a class="indexterm" id="id895"/>reservations on inventory. This can help us manage our inventory more effectively. Let's discuss the reservation process with a customer scenario.</p><p>One of our customer orders 100 black t-shirts size M on January 22, 2015. Currently, we have 120 in our inventory so we can ship them without any problems. The customer wants to have them delivered on November 18. We enter a sales order with the shipping date and release the order.</p><p>The next day, another customer calls for 40 black t-shirts size M. Our inventory is still 120. This customer wants to have them delivered on May 31. We enter the sales order without a warning. Lastly, we will create a new sales order for 90 of the same t-shirts with a delivery date on July 25. Now, we get the following error message:</p><div class="mediaobject"><img alt="Reservations" src="graphics/0365EN_06_41.jpg"/></div><p>And if we now go back to the second sales order and re-enter the quantity, we get a similar message.</p><div class="section" title="Check-avail. period calc."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec126"/>Check-avail. period calc.</h2></div></div></div><p>The reason this happens lies in the way<a class="indexterm" id="id896"/> Microsoft Dynamics NAV calculates the gross requirement:</p><div class="mediaobject"><img alt="Check-avail. period calc." src="graphics/0365EN_06_42.jpg"/></div><p>This is a two-step method <a class="indexterm" id="id897"/>where first, the requirement is calculated until the shipment date of the sales line and secondly, a <code class="literal">Lookahead</code> function is called using a date formula that is defined in the company information table.</p><p>The C/AL code that is used to calculate the <code class="literal">Lookahead</code> can be found in the <code class="literal">QtyAvailabletoPromise</code> function in codeunit Available to Promise (5790).</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>QtyAvailabletoPromise</strong></span>
Item.CALCFIELDS(Inventory,"Reserved Qty. on Inventory");
ScheduledReceipt := CalcScheduledReceipt(Item);
GrossRequirement := CalcGrossRequirement(Item);

IF FORMAT(LookaheadDateFormula) &lt;&gt; '' THEN BEGIN
  GrossRequirement :=
    GrossRequirement +
    CalculateLookahead(
      Item,PeriodType,
      AvailabilityDate + 1,</pre></div><p>If this <code class="literal">Lookahead</code> functionality is not detailed enough, we can start using the reservation process.</p></div><div class="section" title="Always versus optional reservation"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec127"/>Always versus optional reservation</h2></div></div></div><p>The <span class="strong"><strong>Reservation</strong></span> option can be<a class="indexterm" id="id898"/> activated on the item level and customer level and can be set to <span class="strong"><strong>Never</strong></span>, <span class="strong"><strong>Optional</strong></span>, and <span class="strong"><strong>Always</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img alt="Always versus optional reservation" src="graphics/0365EN_06_43.jpg"/></div><p>Let's see what these options signify:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Never</strong></span>: Reservations on this item or customer are impossible. If the item is <span class="strong"><strong>Reserve</strong></span> as <span class="strong"><strong>Always</strong></span> and the <span class="strong"><strong>Customer</strong></span> as <span class="strong"><strong>Never</strong></span>, the item wins.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Optional</strong></span>: It is possible to reserve items for this customer; however, salespersons and warehouse employees can decide to overrule the reservation.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Always</strong></span>: Shipping is not possible without a proper reservation. If the demand is larger than the supply, the salespersons and warehouse employees must make manual decisions of who gets what.</li></ul></div></div><div class="section" title="Reservation entries"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec128"/>Reservation entries</h2></div></div></div><p>Microsoft Dynamics NAV uses the<a class="indexterm" id="id899"/> Reservation Entry (337) table to store the reservation entries. Reservation entries can be connected to all outstanding documents and journals and posted entries. This is done using the following source fields:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Source Type</strong></span>: This is an integer field representing the table the record is linked to, for example, 37 means sales line and 5406, prod. order line.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Source Subtype</strong></span>: This is an option field, which is linked to the <span class="strong"><strong>Document Type</strong></span> field when the record is linked to a sales line, purchase line record, or the status of a production order.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Source ID</strong></span>: This is the link to the document no. of the record this line is linked to.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Source Batch Name</strong></span>: If the record is linked to a journal, this field represents the journal batch name. If this field is used, the source ID is empty and vice versa.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Source Prod. Order Line</strong></span>: When the record is used for a production order line or component, this field represents the production order line number.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Source Ref. No.</strong></span>:  This is an integer field, which is used to link the record to a line no. in a document, journal, or the production component. If the line is linked to a ledger entry, this field represents the entry no. field.</li></ul></div><p>There are four types of <a class="indexterm" id="id900"/>Reservation Entries in Microsoft Dynamics NAV represented by the <span class="strong"><strong>Reservation Status</strong></span> field:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Reservation</strong></span>: These are real <a class="indexterm" id="id901"/>reservation entries, which means that a part of the current or future inventory is reserved for a production order or sales order. If the item uses the <span class="strong"><strong>Always</strong></span> reservation option, it is not possible to work around this. If the reservation is optional, it is possible that someone else might still use these items in another process.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Tracking</strong></span>: This <a class="indexterm" id="id902"/>option is used by the <span class="strong"><strong>Order Tracking Policy</strong></span> option in Microsoft Dynamics NAV. This is an "underwater" process that can link supply and demand automatically. The status <span class="strong"><strong>Tracking</strong></span> means that there is a supply as well as a demand.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Surplus</strong></span>: This <a class="indexterm" id="id903"/>option is used for both item tracking as discussed in <a class="link" href="ch05.html" title="Chapter 5. Production">Chapter 5</a>, <span class="emphasis"><em>Production</em></span>, and the Order Tracking policy. The records can be identified by using the value of the item tracking field. This is set to <span class="strong"><strong>None</strong></span> for Order Tracking policy records and <span class="strong"><strong>Serial No.</strong></span>, <span class="strong"><strong>Lot No.</strong></span>, and <span class="strong"><strong>Lot</strong></span> and <span class="strong"><strong>Serial No.</strong></span> for item tracking.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Prospect</strong></span>: When item <a class="indexterm" id="id904"/>tracking is used, a prospect reservation record indicates an internal journal action, for example, assigning a serial number to an item journal line.</li></ul></div></div><div class="section" title="Creating a reservation"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec129"/>Creating a reservation</h2></div></div></div><p>Let's go into the application and create a<a class="indexterm" id="id905"/> reservation to see what entries we get in the database.</p><p>We will do this using a new item. The item should have a Description, Base Unit of Measure, and a Gen. Prod., VAT Prod., and an Inventory Posting Group. The default value for <span class="strong"><strong>Reserve</strong></span> is <span class="strong"><strong>Optional</strong></span>, which we will use for this example. The default costing method is FIFO, which we will also use.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">To <a class="indexterm" id="id906"/>demonstrate the real value of reservations, we should create two purchase orders with different dates and unit costs. With FIFO, the system would normally apply the sales order to the first item ledger entry. We will reserve on the second item ledger entry to demonstrate the impact on item costing and application.</li><li class="listitem">When this is done, we can create a new sales order with one sales line containing the item and half the inventory and select <span class="strong"><strong>Reserve</strong></span> from the <span class="strong"><strong>Functions</strong></span> tab.</li><li class="listitem">In this screen, we can take a look at the available inventory by clicking on <span class="strong"><strong>Available to Reserve</strong></span>:<div class="mediaobject"><img alt="Creating a reservation" src="graphics/0365EN_06_44.jpg"/></div></li><li class="listitem">Here, we select the second receipt and navigate to <span class="strong"><strong>Actions</strong></span> | <span class="strong"><strong>Functions</strong></span> | <span class="strong"><strong>Reserve</strong></span>. Then, we close the screen.</li><li class="listitem">In <span class="strong"><strong>Sales Order Lines</strong></span>, we can now see the <span class="strong"><strong>Reserved Quantity</strong></span> as <span class="strong"><strong>50</strong></span>:<div class="mediaobject"><img alt="Creating a reservation" src="graphics/0365EN_06_45.jpg"/></div></li></ol></div><p>Let's have a look at the <span class="strong"><strong>Reservation Entries</strong></span> created in the database by running the table from the <span class="strong"><strong>Object Designer</strong></span>:</p><div class="mediaobject"><img alt="Creating a reservation" src="graphics/0365EN_06_46.jpg"/></div><p>A reservation<a class="indexterm" id="id907"/> entry of the type <span class="strong"><strong>Reservation</strong></span> always uses to lines with the same entry no. The <span class="strong"><strong>Source Type</strong></span> for the first entry links to the Sales Line table (37) and the second uses the Item Ledger Entry Table (32).</p><p>We ship and invoice the sales order and look at the <span class="strong"><strong>Item Ledger Entries</strong></span> for our item:</p><div class="mediaobject"><img alt="Creating a reservation" src="graphics/0365EN_06_47.jpg"/></div><p>We see that Microsoft Dynamics NAV has used the second item ledger entry, but the cost is <span class="strong"><strong>500</strong></span>, not the <span class="strong"><strong>600</strong></span> from the second entry.</p><p>To correct this, we run the report Adjust Cost - Item Entries (795) and have another look at the <span class="strong"><strong>Item Ledger Entries</strong></span> and the <span class="strong"><strong>Value Entries</strong></span> to see that it is corrected.</p><div class="mediaobject"><img alt="Creating a reservation" src="graphics/0365EN_06_48.jpg"/></div></div><div class="section" title="Order tracking policy"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec130"/>Order tracking policy</h2></div></div></div><p>We have seen that reservation entries are<a class="indexterm" id="id908"/> not only used for the reservation process of inventory and item tracking but also for balancing supply and demand. This is an internal option within Microsoft Dynamics NAV that allows us to link inventory internally.</p><p>The entries are used in the supply and demand calculation to create the requisition worksheets.</p><div class="section" title="Example"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec139"/>Example</h3></div></div></div><p>Let's create a copy of our <a class="indexterm" id="id909"/>reservation test item to see the differences between reservations and item tracking. This new item should have the Order Tracking Policy Tracking and Action Msg.</p><p>We will create two purchase orders with both a quantity of <span class="strong"><strong>50</strong></span> without receiving them and create a sales order for the same item with a quantity of <span class="strong"><strong>80</strong></span>.</p><div class="mediaobject"><img alt="Example" src="graphics/0365EN_06_49.jpg"/></div><p>If we now select <span class="strong"><strong>Order Tracking</strong></span> from the <span class="strong"><strong>Sales Line Functions</strong></span>, we see that the system matches supply and demand.</p><p>Let's have a look at the <a class="indexterm" id="id910"/>
<span class="strong"><strong>Reservation Entries</strong></span>:</p><div class="mediaobject"><img alt="Example" src="graphics/0365EN_06_50.jpg"/></div><p>We can see that Microsoft Dynamics NAV is now using the <span class="strong"><strong>Surplus</strong></span> and <span class="strong"><strong>Tracking</strong></span> types. The 20 items we have left are not linked to a demand.</p><p>Let's start the <span class="strong"><strong>Requisition Worksheet</strong></span> for this item and see what Microsoft Dynamics NAV can do with this information.</p></div><div class="section" title="Replenishment"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec140"/>Replenishment</h3></div></div></div><p>Let's change the<a class="indexterm" id="id911"/> reordering policy of the item to <span class="strong"><strong>Lot-for-Lot</strong></span> and run the <span class="strong"><strong>Requisition Worksheet</strong></span> for this item:</p><div class="mediaobject"><img alt="Replenishment" src="graphics/0365EN_06_51.jpg"/></div><p>This will result in the suggestion to combine both purchase orders into one document with a different quantity.</p><div class="mediaobject"><img alt="Replenishment" src="graphics/0365EN_06_52.jpg"/></div></div></div><div class="section" title="Auto increment"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec131"/>Auto increment</h2></div></div></div><p>In Microsoft Dynamics NAV 2013, the Reservation <a class="indexterm" id="id912"/>Entry table was redesigned to use the Auto increment feature to determine unique numbering. This improves application performance and reduces locking.</p></div></div>
<div class="section" title="Trade in vertical industries"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec49"/>Trade in vertical industries</h1></div></div></div><p>Microsoft Dynamics NAV is used in <a class="indexterm" id="id913"/>many different vertical industries that often require specific features. Rather than trying to implement all these features in the standard product, Microsoft Dynamics NAV supports the framework and allows developers to design and create the vertical features.</p><p>For these features, the 80/20 rule applies. Microsoft delivers 80 percent of the framework which costs 20 percent of our time to implement. The missing 20 percent of the functionality is developed costing 80 percent of the budgeted time.</p><p>In this section, we will discuss how Microsoft Dynamics NAV is used for trade in five different vertical industries. For each industry, we will discuss two specific vertical features and how they could be solved.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note44"/>Note</h3><p>Most industries have solid add-on solutions available designed by certified Microsoft Dynamics NAV partners that have been implemented at multiple sites. It is highly recommended to look at those add-on solutions instead of reinventing the wheel and rewriting an add-on that already exists.</p></div></div><div class="section" title="Fashion"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec132"/>Fashion</h2></div></div></div><p>The fashion<a class="indexterm" id="id914"/> industry has trade periods within the seasons. During <a class="indexterm" id="id915"/>spring, shops need to order the collection for the next winter and during autumn they buy summer clothes.</p><div class="section" title="Sales orders"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec141"/>Sales orders</h3></div></div></div><p>The sales orders<a class="indexterm" id="id916"/> for each collection are created as normal sales orders but with a shipment date in the future, sometimes six months or more ahead. When using variants, there should be a separate sales line for each variant, meaning, size, and color.</p><p>This can be quite a hassle to enter for sales people, so we could speed this up using a template sales line for the main item and hide the individual sizes.</p><p>Using a matrix where the <span class="emphasis"><em>x</em></span> axis represents the size and <span class="emphasis"><em>y</em></span> axis the color, sales people can quickly enter the quantities. When the matrix is closed, we can update the hidden sales lines. These hidden sales lines are used to calculate the production orders as discussed in <a class="link" href="ch05.html" title="Chapter 5. Production">Chapter 5</a>, <span class="emphasis"><em>Production</em></span>.</p></div><div class="section" title="Reservations"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec142"/>Reservations</h3></div></div></div><p>When the production orders <a class="indexterm" id="id917"/>return from the factory, the warehouse and sales people need to decide which customer gets the items first. This can be done using the shipment date but that might not be completely fair if one customer orders in time, meaning six months ahead, and another customer orders too late with an earlier or the same shipment date.</p><p>This is where we can start using reservations. The reservations already support variants but the auto reserve functionality of Microsoft Dynamics NAV might not just do what we like.</p><p>Changing this functionality <a class="indexterm" id="id918"/>is a complex task. The C/AL code for AutoReserve can be found in codeunit Reservation Management (99000845) but should only be changed by experienced developers.</p><p>Fortunately, reservations are layered on top of the normal inventory, production, purchase, and sales process. If we change the algorithm, we can remove the current reservations and retest the code to see if the newly created reservation entries are good. This testing process should be done very carefully, on a dataset that is small enough to analyze using Microsoft Excel.</p></div></div><div class="section" title="Automotive"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec133"/>Automotive</h2></div></div></div><p>Microsoft Dynamics NAV is used by <a class="indexterm" id="id919"/>many car dealer companies and garages <a class="indexterm" id="id920"/>because there are some strong add-on products available for this vertical industry.</p><p>On top of the normal trade process supported by Microsoft Dynamics NAV, these companies have additional business requirements. Let's discuss two of them.</p><div class="section" title="Vehicle information"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec143"/>Vehicle information</h3></div></div></div><p>Each vehicle that is sold needs to be <a class="indexterm" id="id921"/>configured and ordered. The configuration should be stored in the database for future maintenance and warranty.</p><p>We can compare this to serial numbers or the lot number information table in the standard product. We could create a new master data table called <span class="strong"><strong>Vehicle</strong></span> and create a record in this table for each car we configure or sell. The number we create for the <span class="strong"><strong>Vehicle</strong></span> can be used as a serial number in the <span class="strong"><strong>Item Ledger Entry</strong></span>.</p><p>For maintenance, we could have a vehicle journal that creates vehicle ledger entries each time the car comes back for servicing. This helps us keep track of the history and should include information such as mileage. The technical design of this solution can be compared to the squash application we created in <a class="link" href="ch02.html" title="Chapter 2. A Sample Application">Chapter 2</a>, <span class="emphasis"><em>A Sample Application</em></span>.</p></div><div class="section" title="Parts management"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec144"/>Parts management</h3></div></div></div><p>In the automotive industry, using the<a class="indexterm" id="id922"/> right part is crucial. Different parts can be used on different types of cars and are often even brand independent.</p><p>Many vendors offer their assortment in digital formats allowing us to create interfaces with them. Parts should be defined as items, using standard features such as substitutions. As many parts can be expensive and have a low turnover speed, keeping them in the inventory can be very expensive, thus a minimum inventory should be maintained.</p><p>Parts can be connected to vehicle types. For example, a car interior mirror could be used for five types of cars. When a service engineer wants to replace such a mirror, he/she can use a filtered item list of all available parts.</p></div></div><div class="section" title="Pharmaceuticals/medicines"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec134"/>Pharmaceuticals/medicines</h2></div></div></div><p>In a pharmacy or at another medicine<a class="indexterm" id="id923"/> supplier, it is normal that not just every customer is allowed to purchase any item. They cannot <a class="indexterm" id="id924"/>sell medicines against cardiac arrhythmia to a healthy person.</p><p>Even when someone is allowed to use a certain medication, it is often limited to certain doses. People are often insured for the cost of these medicines but most insurance companies require a contribution.</p><div class="section" title="Medication card"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec145"/>Medication card</h3></div></div></div><p>Microsoft Dynamics NAV does not support<a class="indexterm" id="id925"/> item regulation. To support this, we should create new functionality that links items to customers but also allows us to enter the doses and frequency.</p><p>From this template, we could periodically create sales orders and shipments. Whenever we ship the medicines, we need to update the template.</p></div><div class="section" title="Contribution invoicing"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec146"/>Contribution invoicing</h3></div></div></div><p>When customers need to pay a <a class="indexterm" id="id926"/>part of the medication as an own contribution, we require the system to create two sales invoices for one sales order.</p><p>This is possible using the standard pre-payment functionality in Microsoft Dynamics NAV. We could send a pre-payment invoice to the customer and handle the other invoices to the insurance companies using combined invoicing. The pre-payments will be automatically deducted from the invoice amount but the value entries on the items will remain intact.</p><p>However, the standard system does not allow us to create a pre-payment invoice to another Bill-to Customer No. This would have to be designed and developed.</p></div></div><div class="section" title="Food"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec135"/>Food</h2></div></div></div><p>Where fashion companies <a class="indexterm" id="id927"/>have two or three<a class="indexterm" id="id928"/> large ordering moments per year where customers carefully consider what to order, most food companies have a daily ordering process of high volume items.</p><p>This ordering process is often done by phone or fax where the retailer calls and tells the call center employees what to ship the next day.</p><div class="section" title="Assortment"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec147"/>Assortment</h3></div></div></div><p>Most food companies use an assortment<a class="indexterm" id="id929"/> of products. This assortment can change from season to season or contain special action items but is usually stable since that is what most consumers want; meatballs on Monday, pork chops on Tuesday, and so on.</p><p>To save valuable time creating a new sales order with the same items each day, we could have the system do this at night.</p><p>This could be done using Standard Customer Sales Codes. This standard function in Microsoft Dynamics NAV allows us to create template sales orders with multiple items or other master data supported by the sales process. It also supports fixed quantities that can be adjusted when the sales orders are created.</p><p>The sales order can be created from the Customer Sales Codes using the <span class="strong"><strong>Get. Std. Cust Sales Codes</strong></span> function, as shown in the following screenshot:</p><div class="mediaobject"><img alt="Assortment" src="graphics/0365EN_06_53.jpg"/><div class="caption"><p>Sales order creation</p></div></div><p>This function could be scheduled in the <span class="strong"><strong>Job Scheduler</strong></span> to create new sales order each night for the next day. We will discuss the job scheduler in <a class="link" href="ch09.html" title="Chapter 9. Interfacing">Chapter 9</a>, <span class="emphasis"><em>Interfacing</em></span>.</p></div><div class="section" title="Fast order entry"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec148"/>Fast order entry</h3></div></div></div><p>When the retailer contacts the call <a class="indexterm" id="id930"/>center to complete the sales order, the order entry person should be able to quickly find the correct sales line. If the assortment contains 150 items, this can be quite challenging.</p><p>This can be solved by implementing a fast order entry functionality that enables users to key in an item number and quantity on the sales header. The values will be updated in the correct sales line and blanked for the next entry.</p><p>With this functionality, the end user can always work from the same place without searching for the correct sales line.</p></div></div><div class="section" title="Furniture"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec136"/>Furniture</h2></div></div></div><p>The furniture<a class="indexterm" id="id931"/> trading companies have similar issues with variants like fashion <a class="indexterm" id="id932"/>companies, with some key differences.</p><p>Items like office chairs and desks have far more options compared to clothes and when sold, most consumers buy few with the same specifications rather than a collection of different sizes.</p><div class="section" title="Variant configuration"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec149"/>Variant configuration</h3></div></div></div><p>The price of furniture is dependent of the<a class="indexterm" id="id933"/> configuration, which fabric we want for the seat, the type of armrest, or even the type of wheel. This configuration also determines the item number.</p><p>An office chair or desk can have as much as 1200 possible combinations. We do not want to register all these combinations as items or even as variants.</p><p>Most furniture suppliers offer online systems or small external software packages to determine the combination. Once the combination is identified, we can create a new variant code or see if the variant already exists and create the sales order.</p></div><div class="section" title="One-off items"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec150"/>One-off items</h3></div></div></div><p>Furniture retailers often have many collections<a class="indexterm" id="id934"/> they can sell with thousands of items. Most of the items in these collections will never be sold, or get sold as one-off items that are only sold once to one customer.</p><p>In this case, it does not make sense to create an item with an item cost and inventory value, but we still want to have some traceability of the item. This calls for two solutions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">We could create a collection item, which we can reuse each time we sell an item that is similar to another item but not exactly the same, for example, a lamp with a different foot color. On the sales line, we create the possibility for sales people to enter the vendor/collection and an item category. The system should then search for the template item.</li><li class="listitem" style="list-style-type: disc">Another solution is to<a class="indexterm" id="id935"/> create a new item runtime from the sales order. The sales person will also select the vendor/collection and item category and the system should show a list with items already in the database. If the item is not created, the system should create the item using a template for the posting groups. The sales person can immediately use it and we then have traceability of the items we sold.</li></ul></div></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec50"/>Summary</h1></div></div></div><p>With this chapter, we end our quest exploring the production and trade functionality around the items in Microsoft Dynamics NAV. We discussed the application design of sales and purchase documents in Microsoft Dynamics NAV and how they are mirrored. We talked about the different document types and how they work together from quote or blanket order to order, and invoice or return order, and credit memo.</p><p>The sales and purchase line validation methodology helps us to calculate the pricing, inventory and VAT using a special structure of functions that is linked to the way end users create these lines.</p><p>Sales and purchase orders have a mandatory release process that can be extended with document approval and prepayments. The items have a two-layer inventory process using item ledger entries on locations and warehouse entries on bins and zones. We can use transfer orders to move items from one location to another and warehouse documents to move items from bin to bin and zone to zone. A warehouse is set up in the location and can have different levels. The setup level should match the physical process in the warehouse.</p><p>Item application and costing is tied together with the reservation process in Microsoft Dynamics NAV. The Reservation Entry table adds a new level to the inventory process linking documents, journals, and entries together to level supply and demand. When used, the reservation process can overrule the costing method.</p><p>At the end of the chapter, we talked about different ways to implement this in vertical solutions and what gaps would have to be solved and how. This demonstrates the flexibility and the power of the standard transaction structure in Microsoft Dynamics NAV.</p><p>In the next chapter, we will take this to a new level where we will design and build a real-world vertical solution for Microsoft Dynamics NAV that will enable us to create combine sales shipment in routes for trucks. We will also create a new solution on top of Microsoft Dynamics NAV using the application as a development environment to build something new with respect to the methodology of the application.</p></div></body></html>