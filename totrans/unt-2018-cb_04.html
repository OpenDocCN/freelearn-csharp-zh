<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Playing and Manipulating Sounds</h1>
                </header>
            
            <article>
                
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li>Playing different one-off sound effects with a single AudioSource</li>
<li>Playing and controlling different sounds each with their own AudioSource</li>
<li>Creating just-in-time AudioSource components at runtime through C# scripting</li>
<li>Delaying before playing a sound</li>
<li>Preventing an Audio Clip from restarting if it is already playing</li>
<li>Waiting for audio to finish playing before auto-destructing an object</li>
<li>Creating a metronome through the precise scheduling of sounds with dspTime</li>
<li>Matching the audio pitch to the animation speed</li>
<li>Simulating acoustic environments with Reverb Zones</li>
<li>Adding volume control with Audio Mixers</li>
<li>Making a dynamic soundtrack with Snapshots</li>
<li>Balancing in-game audio with Ducking</li>
<li>Audio visualization from sample spectral data</li>
<li>Synchronizing simultaneous and sequential music to create a simple 140 bpm music-loop manager</li>
</ul>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p>Sound is a very important part of the gaming experience. In fact, it can't be stressed enough how crucial it is to the player's immersion in a virtual environment. Just think of the engine running in your favorite racing game, the distant urban buzz in a simulator game, or the creeping noises in horror games. Think of how these sounds transport you <span class="ItalicsPACKT">into</span> the game.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The big picture</h1>
                </header>
            
            <article>
                
<p>Before getting on with the recipes, let's first review how the different sound features work in Unity. A project with audio needs one or more audio files, which are called <strong><span class="KeyWordPACKT">AudioClips</span></strong> in Unity, and these sit in your <strong><span class="KeyWordPACKT">Project</span></strong> folders. At the time of writing, Unity 2017 supports four audio file formats: <kbd><span class="CodeInTextPACKT">.wav</span></kbd>, <kbd><span class="CodeInTextPACKT">.ogg</span></kbd>, <span class="CodeInTextPACKT"><kbd>.mp3</kbd>,</span> and <kbd><span class="CodeInTextPACKT">.aif</span></kbd>. Files in these types are re-encoded when Unity builds for a target platform. It also supports tracker modules in four formats: .<span class="KeyWordPACKT">xm</span>, <strong>.<span class="KeyWordPACKT">mod</span></strong>, <strong>.</strong><span class="KeyWordPACKT"><strong>it</strong>,</span> and <strong>.<span class="KeyWordPACKT">s3m</span></strong>.</p>
<p>A scene or prefab GameObject can have an <strong><span class="KeyWordPACKT">AudioSource</span></strong> component <span>–</span> which can be linked to an <strong><span class="KeyWordPACKT">AudioClip</span></strong> sound file at <span class="KeyWordPACKT">Design-Time</span>, or through scripting at <span class="KeyWordPACKT">Run-Time</span>. At any time in a scene, there is one active <strong><span class="KeyWordPACKT">AudioListener</span></strong> component inside a GameObject. When you create a new scene, there is one added automatically for you in the <em>Main Camera</em>. One can think of an <strong><span class="KeyWordPACKT">AudioListener</span></strong> as a simulated digital '"ear," since the sounds Unity plays are based on the relationship between playing <strong><span class="KeyWordPACKT">AudioSources</span></strong> and the active <strong><span class="KeyWordPACKT">AudioListener</span></strong>.</p>
<p>Simple sounds, such as pickup effects and background soundtrack music, can be defined as as <strong><span class="KeyWordPACKT">2D sound</span></strong>. However, Unity supports <strong><span class="KeyWordPACKT">3D sounds</span></strong>, which means that the location and distance between playing <strong><span class="KeyWordPACKT">AudioSources</span></strong> and the active <strong><span class="KeyWordPACKT">AudioListener</span></strong> determine the way the sound is perceived in terms of loudness and the left/right balance.</p>
<p>You can also engineer synchronized sound playing and scheduling through <kbd><span class="CodeInTextPACKT">AudioSettings.dspTime</span></kbd> <span>–</span> a value based on the samples in the audio system, so it is much more precise than the <kbd><span class="CodeInTextPACKT">Time.time</span></kbd> value. Also, <kbd><span class="CodeInTextPACKT">dspTime</span></kbd> will pause/suspend with the scene, so no logic is required for rescheduling when using <span class="CodeInTextPACKT"><kbd>dspTime</kbd>.</span> Several recipes in this chapter illustrate this approach.</p>
<p>In recent years, Unity has added a powerful new feature to game audio: the <strong><span class="KeyWordPACKT">AudioMixer</span></strong>. The <strong><span class="KeyWordPACKT">AudioMixer</span></strong> radically changes the way in which sound elements can be experienced by players and worked with by game developers. It allows us to mix and arrange audio pretty much in the same way that musicians and producers do in their <strong><span class="KeyWordPACKT">Digital Audio Workstations</span></strong> (<strong><span class="KeyWordPACKT">D.A.W.</span></strong>), such as <strong><span class="KeyWordPACKT">GarageBand</span></strong> or <strong><span class="KeyWordPACKT">ProTools</span></strong>. It allows you to route <span class="KeyWordPACKT"><strong>AudioSource</strong></span> clips into specific channels that can have their volumes individually adjusted and processed by customized effects and filters. You can work with multiple <strong><span class="KeyWordPACKT">AudioMixers</span></strong>, send a mixer's output to a parent mixer, and save mix preferences as <strong><span class="KeyWordPACKT">Snapshots</span></strong>. Also, you can access mixer parameters from scripting. The following figure represents the main Unity audio mixing concepts and their relationships:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/aeb76899-3541-4772-bfae-f4fe02750351.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign"><span>The figure above represents the main Unity audio mixing concepts and their relationships:</span></div>
<p>Taking advantage of the new <span class="ScreenTextPACKT"><span class="packt_screen">AudioMixer</span></span> feature in many example projects, this chapter is filled with recipes that will hopefully help you implement a better and more efficient sound design for your projects, augmenting the player's sense of immersion, transporting them into the game environment, and even improving the gameplay.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Future audio features</h1>
                </header>
            
            <article>
                
<p>The recipes demonstrate both scripted and Unity audio system approaches to managing audio and introducing dynamic effects at runtime. Games can become much more engaging when the audio environment of effects and music can subtly change based on the context of what is happening in the game <span>–</span> whether you chose effects such as reverb zones, ducking to de-emphasize some sounds for a while, or allow the user to control the audio volumes.</p>
<p>Finally, what is possible with special audio is now getting even more interesting, with the introduction of Ambisonic Audio when playing 3D VR games <span>–</span> allowing rich audio experiences based on whether sounds are above or below the listener, as well as their distance from an audio source. Some reference sources for ambisonic audio include:</p>
<ul>
<li>Wikipedia offers some history of ambisonics:<span> </span><a href="https://en.wikipedia.org/wiki/Ambisonics">https://en.wikipedia.org/wiki/Ambisonics</a>.</li>
<li>Learn about Unity and ambisonic audio in the Unity docs:<a href="https://docs.unity3d.com/Manual/AmbisonicAudio.html"> https://docs.unity3d.com/Manual/AmbisonicAudio.html</a>.</li>
<li>Google's reference pages about special audio and ambisonics:<span> </span><a href="https://developers.google.com/vr/concepts/spatial-audio">https://developers.google.com/vr/concepts/spatial-audio</a>.</li>
<li>Occulus reference pages about special audio and ambisonics:<span> </span><a href="https://developer.oculus.com/downloads/package/oculus-ambisonics-starter-pack/">https://developer.oculus.com/downloads/package/oculus-ambisonics-starter-pack/</a>.</li>
<li>Robert Hernadez has published a great article at Medium.com disambiguating how to record and edit ambisonic audio:<span> </span><a href="https://medium.com/@webjournalist/spatial-audio-how-to-hear-in-vr-10914a41f4ca">https://medium.com/@webjournalist/spatial-audio-how-to-hear-in-vr-10914a41f4ca</a>.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Playing different one-off sound effects with a single AudioSource component</h1>
                </header>
            
            <article>
                
<p>The basics of playing a sound are very straightforward in Unity (adding an <strong><span class="KeyWordPACKT">AudioSource</span></strong> component to a GameObject and linking it to an <strong><span class="KeyWordPACKT">AudioClip</span></strong> sound file). For simple sound effects such as short, one-off plays of pickup confirmation noises, it's useful to have a single <strong><span class="KeyWordPACKT">AudioSource</span></strong> component and reuse it to play different sound effects <span>–</span> which is what we'll do in this recipe.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Try this with any short audio clip that is less than one second in duration. We have included some classic Pacman game sound clips inside the <kbd><span class="CodeInTextPACKT">04_01</span></kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To play multiple sounds using the same <strong><span class="KeyWordPACKT">AudioSource</span></strong> component, do the following:</p>
<ol>
<li>Create a new Unity 2D project and import the sound clip files.</li>
<li>Create a C# script class, <span class="CodeInTextPACKT"><kbd>PlaySound</kbd>s</span><span class="CodeInTextPACKT">,</span> in a new folder, <kbd><span class="CodeInTextPACKT">_Scripts</span></kbd><span>, containing the following code, and add an instance as a scripted component to the <strong><span class="ScreenTextPACKT">Main Camera</span></strong>:</span></li>
</ol>
<pre style="padding-left: 60px">using UnityEngine; 
 
[RequireComponent(typeof(AudioSource))] 
public class PlaySounds : MonoBehaviour  
{ 
    public AudioClip clipEatCherry; 
    public AudioClip clipExtraLife; 
 
    private AudioSource audioAudioSource; 
 
    void Awake() { 
        audioAudioSource = GetComponent&lt;AudioSource&gt;(); 
    } 
 
    void Update() { 
        if (Input.GetKey(KeyCode.UpArrow))
            audioAudioSource.PlayOneShot(clipEatCherry); 
 
        if (Input.GetKey(KeyCode.DownArrow)) 
            audioAudioSource.PlayOneShot(clipExtraLife); 
    } 
}</pre>
<ol start="3">
<li>Ensure that the <strong>M<span class="KeyWordPACKT">ainCamera</span></strong> GameObject is selected in the <strong><span class="KeyWordPACKT">Hierarchy</span></strong>. Then, in the <strong><span class="KeyWordPACKT">Inspector</span></strong> panel, drag the <span class="ScreenTextPACKT"><span class="packt_screen">Pacman Eating Cherry</span></span> sound clip from the <strong><span class="KeyWordPACKT">Project</span></strong> panel into the public <span class="ScreenTextPACKT"><span class="packt_screen">Pacman Eating Cherry</span> <strong>AudioClip</strong> variable</span> in the <kbd><span class="CodeInTextPACKT">PlaySounds</span> <span class="CodeInTextPACKT">(Script)</span></kbd> scripted component. Repeat this procedure for the <span class="ScreenTextPACKT"><span class="packt_screen">Pacman Extra Life</span></span> sound clip. These steps are illustrated in the screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/288ddefa-548e-4662-b08d-2adeb64b8360.png" style="width:39.17em;height:17.83em;"/></div>
<ol start="4">
<li>Run the scene, and press the <em><span class="KeyPACKT">UP</span></em> and <em><span class="KeyPACKT">DOWN</span></em> arrow keys to play the different sound effects.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>You have created a C# script class, <kbd><span class="CodeInTextPACKT">PlaySounds</span></kbd>. The script class includes a <kbd><span class="CodeInTextPACKT">RequireComponent</span></kbd> attribute declaring that any GameObject containing a scripted object component of this class must have a sibling AudioSource component (and one will be automatically added if such a component does not exist when the scripted component is added).</p>
<p>The <kbd><span class="CodeInTextPACKT">PlaySounds</span></kbd> script class has two public <strong><span class="KeyWordPACKT">AudioClip</span></strong> properties: <kbd><span class="CodeInTextPACKT">Pacman Eating Cherry</span></kbd> and <kbd><span class="CodeInTextPACKT">Pacman Extra Life</span></kbd>. At <span class="KeyWordPACKT"><strong>Design-Time</strong>,</span> we associated <strong><span class="KeyWordPACKT">AudioClip</span></strong> sound files from the <strong><span class="KeyWordPACKT">Project</span></strong> panel with these public properties.</p>
<p>At r<span class="KeyWordPACKT">untime,</span> the <kbd><span class="CodeInTextPACKT">Update()</span></kbd> method is executed in every frame. This method checks for the <em><span class="KeyPACKT">UP</span></em> and <em><span class="KeyPACKT">DOWN</span></em> array keys being pressed, and if so, plays the Eat Cherry or Extra Life sounds correspondingly <span>–</span> sending the <strong><span class="KeyWordPACKT">AudioSource</span></strong> component a <kbd><span class="CodeInTextPACKT">PlayOneShot()</span></kbd> message with the appropriate <strong><span class="KeyWordPACKT">AudioClip</span></strong> sound file link.</p>
<div class="packt_infobox"><span class="KeyWordPACKT">NOTE: Cannot pause/interrogate sounds played with <strong>PlayOneShot</strong><br/>
<br/></span> While great for short, one-off sound effects, a limitation of the <kbd><span class="CodeInTextPACKT">PlayOneShot()</span></kbd> method is that you cannot then interrogate the status of the playing sound (has it finished, at what point is it playing, and so on). Nor can you pause/restart a sound played with <kbd><span class="CodeInTextPACKT">PlayOneShot()</span></kbd>. For such detailed control of sounds, each sound needs its own <span class="KeyWordPACKT">AudioSource</span> component.<br/>
<br/>
Learn more about the <kbd><span class="CodeInTextPACKT">PlayOneShot()</span></kbd> method in the Unity documentation: <a href="https://docs.unity3d.com/ScriptReference/AudioSource.PlayOneShot.html"><span class="URLPACKT">https://docs.unity3d.com/ScriptReference/AudioSource.PlayOneShot.html</span></a>.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>There are some details that you don't want to miss.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Play a sound at a static point in 3D world space</h1>
                </header>
            
            <article>
                
<p>Similar to <kbd><span class="CodeInTextPACKT">PlayOneShot()</span></kbd> is the <kbd><span class="CodeInTextPACKT">PlayClipAtPoint()</span></kbd> <strong><span class="KeyWordPACKT">AudioSource</span></strong> method. This allows you to play a sound clip for an <strong><span class="KeyWordPACKT">AudioSource</span></strong> created at a specific point in 3D World Space. Note that this is a static class method <span>–</span> so that you don't need an <strong><span class="KeyWordPACKT">AudioSource</span></strong> component to use this method <span>–</span> an <strong><span class="KeyWordPACKT">AudioSource</span></strong> component is created (at the location you give), and will exist as long as the <strong><span class="KeyWordPACKT">AudioClip</span></strong> sound is playing. The <strong><span class="KeyWordPACKT">AudioSource</span></strong> component will automatically be removed by Unity once the sound has finished playing. All you need is a <kbd><span class="CodeInTextPACKT">Vector3</span></kbd> (x,y,z) position object, and a reference to the <strong><span class="KeyWordPACKT">AudioClip</span></strong> file to be played:</p>
<pre>Vector3 location = new Vector3(10, 10, 10); 
AudioSource.PlayClipAtPoint(soundClipToPlay, location); </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Playing and controlling different sounds each with their own AudioSource component</h1>
                </header>
            
            <article>
                
<p>While the approach in the previous recipe (using <kbd><span class="CodeInTextPACKT">PlayOneShot(...)</span></kbd> with a single <strong><span class="KeyWordPACKT">AudioSource</span></strong>) is fine for one-off sound effects, when further control may be required over a playing sound, each sound will needs to be played in its own <strong><span class="KeyWordPACKT">AudioSource</span></strong> component. In this recipe, we'll create two separate <strong><span class="KeyWordPACKT">AudioSource</span></strong> components and pause/resume each with different arrow keys.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Try this with two audio clips that are several seconds long. We have included two free music clips inside folder <kbd><span class="CodeInTextPACKT">04_02</span></kbd>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To play different sounds each with their own AudioSouce component, do the following:</p>
<ol>
<li>Create a new Unity 2D project and import the sound clip files.</li>
<li>Create a GameObject in the scene containing an <strong><span class="KeyWordPACKT">AudioSource</span></strong> component linked to <span class="KeyWordPACKT">the</span> <span class="ScreenTextPACKT"><span class="packt_screen">186772__dafawe__medieval</span> <strong>AudioClip</strong></span>. This can be done in a single step by dragging the music clip from the <strong><span class="KeyWordPACKT">Project</span></strong> panel into either the <strong><span class="KeyWordPACKT">Hierarchy</span></strong> or <strong><span class="KeyWordPACKT">Scene</span></strong> panels. Rename this new GameObject to <span class="ScreenTextPACKT"><span class="packt_screen">music1_medieval</span></span>.</li>
<li>Repeat the previous step to create another GameObject named <span class="ScreenTextPACKT"><span class="packt_screen">music2_arcade</span></span>, containing an <strong><span class="KeyWordPACKT">AudioSource</span></strong> linked to <span class="ScreenTextPACKT"><span class="packt_screen">251461__joshuaempyre__arcade-music-loop</span></span>.</li>
<li>For both <span class="KeyWordPACKT">AudioSources</span> created, uncheck the <span class="ScreenTextPACKT">Play Awake</span> property <span>–</span> so these sounds do not begin playing as soon as the scene is loaded.</li>
<li>Create an empty GameObject named <span class="ScreenTextPACKT"><span class="packt_screen">Manager</span></span>.</li>
</ol>
<ol start="6">
<li>Create a C# script class, <span class="CodeInTextPACKT">MusicManager,</span> in a new folder, <kbd><span class="CodeInTextPACKT">_Scripts</span></kbd><span>, containing the following code, and add an instance as a scripted component to the Manager GameObject:</span></li>
</ol>
<pre style="padding-left: 60px">using UnityEngine; 
 
public class MusicManager : MonoBehaviour  { 
    public AudioSource audioSourceMedieval; 
    public AudioSource audioSourceArcade; 
 
    void Update() { 
        if (Input.GetKey(KeyCode.RightArrow)){ 
            if (audioSourceMedieval.time &gt; 0) 
                audioSourceMedieval.UnPause(); 
            else 
                audioSourceMedieval.Play(); 
        } 
 
        if (Input.GetKey(KeyCode.LeftArrow)) 
            audioSourceMedieval.Pause(); 
             
        if (Input.GetKey(KeyCode.UpArrow)){ 
            if (audioSourceArcade.time &gt; 0) 
                audioSourceArcade.UnPause(); 
            else 
                audioSourceArcade.Play(); 
        } 
 
        if (Input.GetKey(KeyCode.DownArrow)) 
            audioSourceArcade.Pause(); 
    } 
} </pre>
<ol start="7">
<li>Ensure that the <strong><span class="KeyWordPACKT">Manager</span></strong> GameObject is selected in the <strong><span class="KeyWordPACKT">Hierarchy</span></strong>. In the <strong><span class="KeyWordPACKT">Inspector</span></strong> panel, drag the <span class="ScreenTextPACKT"><span class="packt_screen">music1_medieval</span></span> <strong><span class="KeyWordPACKT">GameObject</span></strong> from the <span class="KeyWordPACKT">Scene</span> panel into the public <strong><span class="ScreenTextPACKT">Audio Source Medieval</span></strong> <span class="packt_screen">AudioSourc</span>e variable in the <kbd><span class="CodeInTextPACKT">MusicManager</span> <span class="CodeInTextPACKT">(Script)</span></kbd> scripted component. Repeat this procedure, dragging <span class="KeyWordPACKT">GameObject</span> <span class="ScreenTextPACKT"><span class="packt_screen">music2_arcade</span></span> into the public <span class="ScreenTextPACKT"><span class="packt_screen">Audio Source Arcade</span> variable</span>.</li>
<li>Run the scene, and press the <em><span class="KeyPACKT">UP</span></em> and <em><span class="KeyPACKT">DOWN</span></em> arrow keys to start/resume and pause the medieval sound clip. Press the <em><span class="KeyPACKT">RIGHT</span></em> and <em><span class="KeyPACKT">LEFT</span></em> arrow keys to start/resume and pause the arcade sound clip.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>You created a C# script class, <kbd><span class="CodeInTextPACKT">MusicManager</span></kbd>, and added an instance of this class as a component to the Manager GameObject. You also created two <span class="KeyWordPACKT"><strong>GameObjects</strong>,</span> named <span class="ScreenTextPACKT"><span class="packt_screen">music1_medieval</span></span> and <span class="ScreenTextPACKT"><span class="packt_screen">music2_arcade</span>,</span> in the scene, each containing an <strong><span class="KeyWordPACKT">AudioSource</span></strong> component linked to a different music clip.</p>
<p>The script class has two public <strong><span class="KeyWordPACKT">AudioSource</span></strong> properties: <kbd><span class="CodeInTextPACKT">Music Medieval</span></kbd> and <kbd><span class="CodeInTextPACKT">Music Arcade</span></kbd>. At <span class="KeyWordPACKT"><strong>Design-Time</strong>,</span> we associated the <strong><span class="KeyWordPACKT">AudioSource</span></strong> components of <strong><span class="KeyWordPACKT">GameObjects</span></strong> <span class="packt_screen"><span class="ScreenTextPACKT">music1_medieval</span> and <span class="ScreenTextPACKT">music2_arcade</span></span> with these public properties.</p>
<p>At <span class="KeyWordPACKT">Run-Time,</span> the <kbd><span class="CodeInTextPACKT">Update()</span></kbd> method is executed in every frame. This method checks for the <em><span class="KeyPACKT">UP</span>/<span class="KeyPACKT">DOWN/RIGHT</span>/<span class="KeyPACKT">LEFT</span></em> array keys being pressed. If the <em><span class="KeyPACKT">UP</span></em> arrow key is detected, the medieval music audio source is sent a <kbd><span class="CodeInTextPACKT">Play()</span></kbd> or <kbd><span class="CodeInTextPACKT">UnPause()</span></kbd> message. The <kbd><span class="CodeInTextPACKT">Play()</span></kbd> message is sent if the clip is not already playing (its <span class="CodeInTextPACKT">time</span> property is zero). If the <span class="KeyPACKT">DOWN</span> arrow key is pressed, the medieval music audio source is sent a <kbd><span class="CodeInTextPACKT">Pause()</span></kbd> message.</p>
<p>The arcade music clip is controlled in a corresponding way through detection of the <span class="KeyPACKT">RIGHT</span>/<span class="KeyPACKT">LEFT</span> array keys.</p>
<p>Each <strong><span class="KeyWordPACKT">AudioClip</span></strong> sound file being associated with its own <strong><span class="KeyWordPACKT">AudioSource</span></strong> component allows simultaneous playing, and managing of each sound independently.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating just-in-time AudioSource components at runtime through C# scripting</h1>
                </header>
            
            <article>
                
<p>In the previous recipe, for each sound clip we wanted to manage, in the scene we had to manually create <strong><span class="KeyWordPACKT">GameObjects</span></strong> with <strong><span class="KeyWordPACKT">AudioSource</span></strong> components at <span class="KeyWordPACKT">Design-Time</span>. However, using C# scripting, we can create our own <strong><span class="KeyWordPACKT">GameObjects</span></strong> that contain <strong><span class="KeyWordPACKT">AudioSources</span></strong> at <strong><span class="KeyWordPACKT">Run-Time</span></strong>, just when they are needed. This method is similar to the built-in <strong><span class="KeyWordPACKT">AudioSource</span> <span class="CodeInTextPACKT">PlayClipAtPoint()</span></strong> method, but the created <strong><span class="KeyWordPACKT">AudioSource</span></strong> component is completely under our programmatic control <span>–</span> although we then have to be responsible for destroying this component when it is no longer needed.</p>
<div class="packt_infobox">This code was inspired by some of the code posted in 2011 in the online <strong><span class="KeyWordPACKT">Unity Answers</span></strong> forum by user Bunny83. Unity has a great online community helping each other and posting interesting ways of adding features to games. Learn more about that post at <a href="http://answers.unity3d.com/questions/123772/playoneshot-returns-false-for-isplaying.html"><span class="URLPACKT">http://answers.unity3d.com/questions/123772/playoneshot-returns-false-for-isplaying.html</span></a>.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>This recipe adapts the previous one. So, make a copy of the project for the previous recipe, and work on this copy.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To create just-in-time <span class="KeyWordPACKT">AudioSource</span> components at run time through C# scripting do the following:</p>
<ol>
<li>Delete the <span class="ScreenTextPACKT"><span class="packt_screen">music1_medieval</span></span> and <span class="ScreenTextPACKT"><span class="packt_screen">music-loop</span> GameObjects</span> from the scene <span>–</span> we'll be creating these at <strong><span class="KeyWordPACKT">Run-Time</span></strong> in this recipe!</li>
<li>Refactor the <kbd>MusicManager</kbd> C# script class to read as follows (note that the <kbd><span class="CodeInTextPACKT">Update()</span></kbd> method is unchanged):</li>
</ol>
<pre style="padding-left: 60px">using UnityEngine; 
 
public class MusicManager : MonoBehaviour { 
    public AudioClip clipMedieval; 
    public AudioClip clipArcade; 
 
    private AudioSource audioSourceMedieval; 
    private AudioSource audioSourceArcade; 
 
    void Awake() { 
        audioSourceMedieval = CreateAudioSource(clipMedieval, true); 
        audioSourceArcade = CreateAudioSource(clipArcade, false); 
    } 
 
    private AudioSource CreateAudioSource(AudioClip audioClip, bool startPlayingImmediately) { 
        GameObject audioSourceGO = new GameObject(); 
           audioSourceGO.transform.parent = transform; 
        audioSourceGO.transform.position = transform.position; 
        AudioSource newAudioSource = audioSourceGO.AddComponent&lt;AudioSource&gt;() as AudioSource; 
        newAudioSource.clip = audioClip; 
        if(startPlayingImmediately) 
            newAudioSource.Play(); 
 
        return newAudioSource; 
    } 
 
    void Update(){ 
        if (Input.GetKey(KeyCode.RightArrow)){ 
            if (audioSourceMedieval.time &gt; 0) 
                audioSourceMedieval.UnPause(); 
            else 
                audioSourceMedieval.Play(); 
        } 
 
        if (Input.GetKey(KeyCode.LeftArrow)) 
            audioSourceMedieval.Pause(); 
         
        if (Input.GetKey(KeyCode.UpArrow)){ 
            if (audioSourceArcade.time &gt; 0) 
                audioSourceArcade.UnPause(); 
            else 
                audioSourceArcade.Play();             
        } 
 
        if (Input.GetKey(KeyCode.DownArrow)) 
            audioSourceArcade.Pause(); 
   } 
} </pre>
<ol start="3">
<li>Ensure that the <kbd><span class="CodeInTextPACKT">MainCamera</span></kbd> <strong>GameObject</strong> is selected in the <strong><span class="KeyWordPACKT">Hierarchy</span></strong>. In the <span class="KeyWordPACKT">Inspector</span> panel, drag the <strong><span class="KeyWordPACKT">AudioClip</span></strong> <span class="ScreenTextPACKT"><span class="packt_screen">186772__dafawe__medieval</span></span> sound clip from the <span class="KeyWordPACKT">Project</span> panel into the public <span class="ScreenTextPACKT"><span class="packt_screen">Clip Medieval</span></span> <strong>AudioClip</strong> variable in the <kbd><span class="CodeInTextPACKT">MusicManager</span> <span class="CodeInTextPACKT">(Script)</span></kbd> scripted component. Repeat this procedure with <strong>AudioClip</strong> <span class="ScreenTextPACKT"><span class="packt_screen">251461__joshuaempyre__arcade-music-loop</span></span> for the <span class="ScreenTextPACKT"><span class="packt_screen">Clip Arcade</span> variable</span>.</li>
<li>Run the scene, and press the <em><span class="KeyPACKT">UP</span></em> and <em><span class="KeyPACKT">DOWN</span></em> arrow keys to start/resume and pause the medieval sound clip. Press the <em><span class="KeyPACKT">RIGHT</span></em> and <em><span class="KeyPACKT">LEFT</span></em> arrow keys to start/resume and pause the arcade sound clip.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The key feature of this recipe is the new <span class="CodeInTextPACKT"><kbd>CreateAudioSource(...)</kbd> method</span>. This method takes input as a reference to a sound clip file and a Boolean true/false value as to whether the sound should start playing immediately. The method does the following:</p>
<ul>
<li>Creates a new <strong><span class="KeyWordPACKT">GameObject</span></strong> (with the same parent, and at the same location as the <strong><span class="KeyWordPACKT">GameObject</span></strong> doing the creating)</li>
<li>Adds a new <strong><span class="KeyWordPACKT">AudioSource</span></strong> component to the new <strong><span class="KeyWordPACKT">GameObject</span></strong></li>
<li>Sets the audio clip of the new <span class="KeyWordPACKT">AudioSource</span> component to the provided <span class="KeyWordPACKT">AudioClip</span> parameter</li>
<li>If the Boolean parameter was true, the <strong><span class="KeyWordPACKT">AudioSource</span></strong> component is immediately sent a <kbd><span class="CodeInTextPACKT">Play()</span></kbd> message to start it playing the sound clip</li>
<li>A reference to the AudioSource component is returned</li>
</ul>
<p>The rest of the <span class="CodeInTextPACKT"><kbd>MusicManager</kbd> script class</span> is very similar to that in the previous recipe. There are two public <kbd><span class="KeyWordPACKT">AudioClip</span></kbd> variables, <kbd><span class="CodeInTextPACKT">clipMedieval</span></kbd> and <kbd><span class="CodeInTextPACKT">clipArcade</span></kbd>, which are set through drag-and-drop at <strong><span class="KeyWordPACKT">Design-Time</span></strong> to link to the sound clip files in <strong>Sounds <span class="KeyWordPACKT">Project</span></strong> folder.</p>
<p><span class="KeyWordPACKT">The</span> <kbd><span class="CodeInTextPACKT">audioSourceMedieval</span></kbd> and <kbd><span class="CodeInTextPACKT">audioSourceArcade</span> AudioSource</kbd> variables are now private. These values are set up in the <span class="CodeInTextPACKT"><kbd>Awake(</kbd>) method</span>, by calling and storing values returned by the <kbd><span class="CodeInTextPACKT">CreateAudioSource(...)</span></kbd> method with <span class="KeyWordPACKT">the</span> <strong><span class="CodeInTextPACKT">clipMedieval</span></strong> and <span class="CodeInTextPACKT"><kbd>clipArcade</kbd> AudioClip variables</span>.</p>
<p>To illustrate how the Boolean parameter works, the medieval music <strong><span class="KeyWordPACKT">AudioSource</span></strong> is created to play immediately, while the arcade music won't start playing until the <em><span class="KeyPACKT">UP</span></em> arrow key is pressed. Playing/Resuming/Pausing the two audio clips is just the same as in the previous recipe <span>–</span> via the arrow-key detection logic in the (unchanged) <span class="CodeInTextPACKT"><kbd>Update()</kbd> method</span>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>There are some details that you don't want to miss.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding the CreateAudioSource(...) method as an extension to the MonoBehavior class</h1>
                </header>
            
            <article>
                
<p>Since the <kbd><span class="CodeInTextPACKT">CreateAudioSource(...)</span></kbd> method is a general-purpose method that could be used by many different game script classes, it doesn't naturally sit within the <span class="CodeInTextPACKT"><kbd>MusicManager</kbd> class</span>. The best place for general-purpose generative methods such as this is to add them as static (class) methods to the component class they work with <span>–</span> in this case it would be great if we could add this method to <kbd><span class="CodeInTextPACKT">MonoBehavior</span></kbd> class itself <span>–</span> so any scripted component could create <strong><span class="KeyWordPACKT">AudioSource</span></strong> <span class="KeyWordPACKT">GameObjects</span> on the fly.</p>
<p>All we have to do is create a class (usually named <kbd><span class="CodeInTextPACKT">ExtensionMethods</span></kbd>) with a static method, as follows:</p>
<pre>using UnityEngine; 
 
public static class ExtensionMethods { 
    public static AudioSource CreateAudioSource(this MonoBehaviour parent, AudioClip audioClip, bool startPlayingImmediately) 
    { 
         GameObject audioSourceGO = new GameObject("music-player"); 
         audioSourceGO.transform.parent = parent.transform; 
         audioSourceGO.transform.position = parent.transform.position; 
         AudioSource newAudioSource = audioSourceGO.AddComponent&lt;AudioSource&gt;() as AudioSource; 
         newAudioSource.clip = audioClip; 
 
         if (startPlayingImmediately) 
               newAudioSource.Play(); 
 
         return newAudioSource; 
    } 
} </pre>
<p>As we can see, we add an extra first parameter to the extension method, stating which class we are adding this method to. Since we have added this to the <kbd><span class="CodeInTextPACKT">MonoBehavior</span></kbd> class, we can now use this method in our scripted classes as if it were built-in. So our <kbd><span class="CodeInTextPACKT">Awake()</span></kbd> method in our <kbd><span class="CodeInTextPACKT">MusicManager</span></kbd> class looks as follows:</p>
<pre>void Awake() { 
   audioSourceMedieval = this.CreateAudioSource(clipMedieval, true); 
   audioSourceArcade = this.CreateAudioSource(clipArcade, false); 
} </pre>
<p>That's it <span>–</span> we can now remove the method from our <kbd><span class="CodeInTextPACKT">MusicManager</span></kbd> class and use this method in any of our <kbd><span class="CodeInTextPACKT">MonoBehavior</span></kbd> scripted classes.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Delaying before playing a sound</h1>
                </header>
            
            <article>
                
<p>Sometimes we don't want to play a sound immediately, but after a short delay. For example, we might want to wait a second or two before playing a sound to indicate the slightly delayed onset of a poison drunk or having walked into a spell that weakens the player. For such cases, <strong><span class="KeyWordPACKT">AudioSource</span></strong> offers the <kbd><span class="CodeInTextPACKT">PlayDelayed(...)</span></kbd> method. This recipe illustrates a simple approach for such cases where we do not wish to immediately start playing a sound.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Try this with two audio clips that are several seconds long. We have included two free music clips inside the <kbd><span class="CodeInTextPACKT">04_04</span></kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To schedule a sound to play after a given delay, do the following:</p>
<ol>
<li>Create a new Unity 2D project and import the sound clip files.</li>
<li>Create a <strong><span class="KeyWordPACKT">GameObject</span></strong> in the scene containing an <strong><span class="KeyWordPACKT">AudioSource</span></strong> component linked to <span class="KeyWordPACKT">the</span> <span class="KeyWordPACKT"><strong>Pacman Opening Song</strong> <strong>AudioClip</strong></span>. This can be done in a single step by dragging the music clip from the <span class="KeyWordPACKT">Project</span> panel into either the <strong><span class="KeyWordPACKT">Hierarchy</span></strong> or <strong><span class="KeyWordPACKT">Scene</span></strong> panels.</li>
<li>Repeat the previous step to create another <strong><span class="KeyWordPACKT">GameObject</span></strong>, containing an <strong><span class="KeyWordPACKT">AudioSource</span></strong> linked to the <span class="ScreenTextPACKT"><span class="packt_screen">Pacman Dies</span> clip</span>.</li>
<li>For both <strong><span class="KeyWordPACKT">AudioSources</span></strong> created, uncheck the <span class="ScreenTextPACKT">Play Awake</span> property <span>–</span> so these sounds do not begin playing as soon as the scene is loaded.</li>
<li>Create a <strong><span class="KeyWordPACKT">UI Button</span></strong> named <strong><span class="ScreenTextPACKT">Button-music</span></strong> on the screen, changing its text to <span class="ScreenTextPACKT"><span class="packt_screen">Play Music Immediately</span></span>.</li>
<li>Create a <strong><span class="KeyWordPACKT">UI Button</span></strong> named <strong><span class="ScreenTextPACKT">Button-dies</span></strong> on the screen, changing its text to <span class="ScreenTextPACKT"><span class="packt_screen">Play Dies Sound After 1 second</span></span>.</li>
</ol>
<ol start="7">
<li>Create an empty <strong><span class="KeyWordPACKT">GameObject</span></strong> named <span class="ScreenTextPACKT"><span class="packt_screen">SoundManager</span></span>.</li>
<li>Create a C# script class, <span class="CodeInTextPACKT">DelayedSoundManager,</span> in a new folder, <kbd><span class="CodeInTextPACKT">_Scripts</span></kbd>, containing the following code, and add an instance as a scripted component to the <span class="packt_screen">SoundManager</span> <strong><span class="KeyWordPACKT">GameObject</span></strong>:</li>
</ol>
<pre style="padding-left: 60px">using UnityEngine; 
 
public class DelayedSoundManager : MonoBehaviour { 
    public AudioSource audioSourcePacmandMusic; 
    public AudioSource audioSourceDies; 
 
    public void ACTION_PlayMusicNow() { 
        audioSourcePacmandMusic.Play(); 
    } 
 
    public void ACTION_PlayDiesSoundAfterDelay() { 
        float delay = 1.0F; 
        audioSourceDies.PlayDelayed(delay); 
    } 
} </pre>
<ol start="9">
<li>With <span class="KeyWordPACKT">the</span> <span class="packt_screen"><span class="ScreenTextPACKT">Butto</span><span class="ScreenTextPACKT">n-music</span></span> <strong>GameObject</strong> selected in the <span class="KeyWordPACKT">Hierarchy</span> panel, create a new on-click event-handler, dragging <span class="KeyWordPACKT">the</span> <span class="ScreenTextPACKT"><span class="packt_screen">SoundsManager</span></span> <strong>GameObject</strong> into the <span class="ScreenTextPACKT"><span class="packt_screen">Object</span></span> slot, and selecting the <span class="CodeInTextPACKT"><span class="packt_screen">ACTION_PlayMusicNow()</span></span> method.</li>
<li>With <span class="KeyWordPACKT">the</span> <span class="ScreenTextPACKT"><span class="packt_screen">Button-dies</span></span> GameObject selected in the <span class="KeyWordPACKT">Hierarchy</span> panel, create a new on-click event-handler, dragging <span class="KeyWordPACKT">the</span> <span class="ScreenTextPACKT"><span class="packt_screen">SoundsManager</span></span> GameObject into the <span class="ScreenTextPACKT"><span class="packt_screen">Object</span></span> slot, and selecting the <span class="CodeInTextPACKT"><span class="packt_screen">ACTION_PlayDiesSoundAfterDelay()</span></span> method.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>You add two <strong>GameObjects</strong> to the scene, containing <kbd><span class="KeyWordPACKT">AudioSources</span></kbd> linked to music and dying sound clips. You created a C# script class, <span class="CodeInTextPACKT"><kbd>DelayedSoundManager</kbd>,</span> and added an instance to an empty <strong><span class="KeyWordPACKT">GameObject</span></strong>. You associated the two AudioSources in your <strong>GameObjects</strong> with the two public variables in your scripted component.</p>
<p>You created two buttons:</p>
<ul>
<li><span class="ScreenTextPACKT"><span class="packt_screen">Button-music</span>,</span> with a click action to invoke the <kbd><span class="CodeInTextPACKT">DelayedSoundManager</span>.<span class="CodeInTextPACKT">ACTION_PlayMusicNow()</span></kbd> method</li>
<li><span class="ScreenTextPACKT"><span class="packt_screen">Button-dies</span>,</span> with a click action to invoke the <kbd><span class="CodeInTextPACKT">DelayedSoundManager</span>.<span class="CodeInTextPACKT">PlayDiesSoundAfterDelay()</span></kbd> method.</li>
</ul>
<p class="mce-root"/>
<p>The <kbd><span class="CodeInTextPACKT">DelayedSoundManager</span>.<span class="CodeInTextPACKT">ACTION_PlayMusicNow()</span></kbd> method immediately sends a Play() message to the audio source linked to <span class="KeyWordPACKT">the</span> <strong><span class="KeyWordPACKT">Pacman Opening Song AudioClip</span></strong>. However, the <kbd><span class="CodeInTextPACKT">DelayedSoundManager</span>.<span class="CodeInTextPACKT">PlayDiesSoundAfterDelay()</span></kbd> method sends a PlayDelayed(...) message to the audio source linked to <span class="KeyWordPACKT">the</span> <span class="KeyWordPACKT"><strong>Pacman Dies AudioClip</strong></span>, passing a value of 1.0, making Unity wait 1 second before playing the sound clip.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Preventing an Audio Clip from restarting if it is already playing</h1>
                </header>
            
            <article>
                
<p>In a game, there may be several different events that cause a particular sound effect to start playing. If the sound is already playing, then in almost all cases, we won't wish to restart the sound. This recipe includes a test, so that an <span class="ScreenTextPACKT">Audio Source</span> component is only sent a <kbd><span class="CodeInTextPACKT">Play()</span></kbd> message if it is currently not playing.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Try this with any audio clip that is one second or longer in duration. We have included the <span class="CodeInTextPACKT">engineSound</span> audio clip inside the <kbd><span class="CodeInTextPACKT">04_05</span></kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To prevent an <strong><span class="ScreenTextPACKT">AudioClip</span></strong> from restarting, follow these steps:</p>
<ol>
<li>Create a new Unity 2D project and import the sound clip file.</li>
<li>Create a GameObject in the scene containing an <strong><span class="KeyWordPACKT">AudioSource</span></strong> component linked to the <span class="KeyWordPACKT"><kbd>AudioClip <span>engineSound</span></kbd></span>. This can be done in a single step by dragging the music clip from the <span class="KeyWordPACKT">Project</span> panel into either the <span class="KeyWordPACKT">Hierarchy</span> or <span class="KeyWordPACKT">Scene</span> panels.</li>
<li>Uncheck the <span class="ScreenTextPACKT">Play Awake</span> property for the <strong><span class="KeyWordPACKT">AudioSource</span></strong> component of the engineSound <span class="KeyWordPACKT">GameObject</span> <span>–</span> so this sound does not begin playing as soon as the scene is loaded.</li>
<li>Create a UI button named <strong><span class="ScreenTextPACKT">Button-play-sound</span></strong>, changing its text to <span class="ScreenTextPACKT"><span class="packt_screen">Play Sound</span></span>. Position the button in the center of the screen by setting its <span class="KeyWordPACKT">Rect <strong>Transform</strong></span> property position to <span class="ScreenTextPACKT">middle-center</span>.</li>
</ol>
<ol start="5">
<li>Create a C# script class, <kbd><span class="CodeInTextPACKT">WaitToFinishBeforePlaying</span></kbd><span class="CodeInTextPACKT">,</span> in a new folder, <kbd><span class="CodeInTextPACKT">_Scripts</span></kbd><span>, containing the following code, and add an instance as a scripted component to the <span class="packt_screen">Main Camera</span> GameObject:</span></li>
</ol>
<pre style="padding-left: 60px">using UnityEngine; 
using UnityEngine.UI; 
 
public class WaitToFinishBeforePlaying : MonoBehaviour  { 
   public AudioSource audioSource; 
   public Text buttonText; 
 
   void Update() { 
         string statusMessage = "Play sound"; 
         if(audioSource.isPlaying ) 
               statusMessage = "(sound playing)"; 
 
         buttonText.text = statusMessage; 
   } 
 
   public void ACTION_PlaySoundIfNotPlaying() { 
         if( !audioSource.isPlaying ) 
               audioSource.Play(); 
   } 
} </pre>
<ol start="6">
<li>With <span class="packt_screen"><span class="ScreenTextPACKT">Main Camer</span><span class="ScreenTextPACKT">a</span></span> selected in the <strong><span class="KeyWordPACKT">Hierarchy</span></strong> panel, drag <span class="ScreenTextPACKT"><span class="packt_screen">engineSound</span></span> <span>into the</span> <span class="KeyWordPACKT">Inspector</span> panel for the public <span class="ScreenTextPACKT">Audio Source</span> variable, and drag the <span class="ScreenTextPACKT"><span class="packt_screen">Text</span></span> child of <span class="ScreenTextPACKT"><span class="packt_screen">Button-play-sound</span></span> for the public <span class="ScreenTextPACKT"><span class="packt_screen">ButtonText</span>.</span></li>
<li>With <span class="ScreenTextPACKT"><span class="packt_screen">Button-play-sound</span></span> selected in the Hierarchy panel, create a new on-click event-handler, dragging the <span class="ScreenTextPACKT"><span class="packt_screen">Main Camera</span></span> into the <span class="ScreenTextPACKT"><span class="packt_screen">Object</span></span> slot, and selecting the <kbd><span class="CodeInTextPACKT">ACTION_PlaySoundIfNotPlaying()</span></kbd> function.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p><strong><span class="ScreenTextPACKT">Audio Source</span></strong> components have a public readable property, <strong><span class="ScreenTextPACKT">isPlaying</span></strong>, which is a Boolean true/false flag, indicating whether the sound is currently playing. In this recipe, the text of the button is set to display <span class="CodeInTextPACKT">Play</span> <span class="CodeInTextPACKT">Sound</span> when the sound is not playing, and (<kbd><span class="CodeInTextPACKT">sound</span> <span class="CodeInTextPACKT">playing</span></kbd>) when it is. When the button is clicked, the <kbd>ACTION_<span class="CodeInTextPACKT">PlaySoundIfNotPlaying()</span></kbd> method is called. This method uses an <kbd><span class="CodeInTextPACKT">if</span></kbd> statement, ensuring that a <kbd><span class="CodeInTextPACKT">Play()</span></kbd> message is only sent to the Audio Source component if its <strong><span class="ScreenTextPACKT">isPlaying</span></strong> is false, and updates the button's text as appropriate.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<p>The <em><span class="ItalicsPACKT">Waiting for the audio to finish playing before auto-destructing an object</span></em> recipe in this chapter.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Waiting for the audio to finish playing before auto-destructing an object</h1>
                </header>
            
            <article>
                
<p>An event may occur (such as an object pickup or the killing of an enemy) that we wish to notify to the player of by playing an audio clip, and an associated visual object (such as an explosion particle system, or a temporary object in the location of the event). However, as soon as the clip has finished playing, we will want the visual object to be removed from the scene. This recipe provides a simple way to link the ending of a playing audio clip with the automatic destruction of its containing object.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Try this with any audio clip that is a second or more in duration. We have included the <kbd><span class="CodeInTextPACKT">engineSound</span></kbd> audio clip inside the <kbd><span class="CodeInTextPACKT">04_06</span></kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To wait for audio to finish playing before destroying its parent GameObject, follow these steps:</p>
<ol>
<li>Create a new Unity 2D project and import the sound clip file.</li>
<li>Create a GameObject in the scene containing an <strong><span class="KeyWordPACKT">AudioSource</span></strong> component linked to <span class="KeyWordPACKT">the <strong><span>AudioClip</span></strong></span> <strong><span class="KeyWordPACKT">engineSound</span></strong>. This can be done in a single step by dragging the music clip from the <span class="KeyWordPACKT">Project</span> panel into either the <strong><span class="KeyWordPACKT">Hierarchy</span></strong> or <strong><span class="KeyWordPACKT">Scene</span></strong> panels. Rename this the <span class="packt_screen">AudioObject</span> GameObject.</li>
<li>Uncheck the <span class="packt_screen"><span class="ScreenTextPACKT">Play Awake</span></span> property for the <span class="KeyWordPACKT">AudioSource</span> component of <span class="KeyWordPACKT">the <strong><span>GameObject</span></strong></span> <span class="ScreenTextPACKT"><span class="packt_screen">engineSound</span></span> <span>–</span> so this sound does not begin playing as soon as the scene is loaded.</li>
</ol>
<ol start="4">
<li>Create a C# script class, <span class="CodeInTextPACKT"><kbd>AudioDestructBehaviour</kbd>,</span> in a new folder, <kbd><span class="CodeInTextPACKT">_Scripts</span></kbd><span>, containing the following code, and add an instance as a scripted component to the <span class="packt_screen">AudioObject</span> GameObject:</span></li>
</ol>
<pre style="padding-left: 60px">using UnityEngine; 
using UnityEngine; 
 
public class AudioDestructBehaviour : MonoBehaviour { 
   private AudioSource audioSource; 
 
   void Awake() { 
         audioSource = GetComponent&lt;AudioSource&gt;(); 
   } 
 
   private void Update() { 
         if( !audioSource.isPlaying ) 
               Destroy(gameObject); 
   } 
} </pre>
<ol start="5">
<li>In the <strong><span class="KeyWordPACKT">Inspector</span></strong> panel, disable (uncheck) the <kbd><span class="CodeInTextPACKT">AudioDestructBehaviour</span></kbd> scripted component of <span class="ScreenTextPACKT"><span class="packt_screen">AudioObject</span></span> (when needed, it will be re-enabled via C# code):</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/ea58c4f8-5e25-4d9e-9dbc-1584ab99cb18.png"/></div>
<ol start="6">
<li>Create a C# script class, <span class="CodeInTextPACKT"><kbd>ButtonActions</kbd>,</span> in the <span class="CodeInTextPACKT"><kbd>_Scripts</kbd> folder</span><span>, containing the following code, and add an instance as a scripted component to the <span class="packt_screen">Main Camera</span> GameObject:</span></li>
</ol>
<pre style="padding-left: 60px">using UnityEngine; 
 
public class ButtonActions : MonoBehaviour { 
   public AudioSource audioSource; 
 
   public AudioDestructBehaviour audioDestructScriptedObject; 
 
   public void ACTION_PlaySound() { 
         if( !audioSource.isPlaying ) 
               audioSource.Play(); 
   } 
 
   public void ACTION_DestroyAfterSoundStops(){ 
         audioDestructScriptedObject.enabled = true; 
   } 
} </pre>
<ol start="7">
<li>With <span class="packt_screen"><span class="ScreenTextPACKT">Main Camer</span><span class="ScreenTextPACKT">a</span></span> selected in the <strong><span class="KeyWordPACKT">Hierarchy</span></strong> panel, drag <span class="ScreenTextPACKT"><span class="packt_screen">AudioObject</span></span> <span>into<br/></span> <span>the</span> <strong><span class="KeyWordPACKT">Inspector</span></strong> panel for the public <span class="ScreenTextPACKT"><span class="packt_screen">Audio Source</span></span> variable.</li>
<li>With <span class="ScreenTextPACKT"><span class="packt_screen">Main Camera</span></span> selected in the <strong><span class="KeyWordPACKT">Hierarchy</span></strong> panel, drag <span class="ScreenTextPACKT"><span class="packt_screen">AudioObject</span></span> <span>into<br/>
the</span> <strong><span class="KeyWordPACKT">Inspector</span></strong> panel for the public <span class="ScreenTextPACKT"><span class="packt_screen">Audio Destruct Scripted</span> <span class="packt_screen">Object</span></span> variable.</li>
<li>Create a UI button named <strong><span class="ScreenTextPACKT">Button-play-sound</span></strong>, changing its text to <span class="ScreenTextPACKT"><span class="packt_screen">Play</span> Sound</span>. Position the button in the center of the screen by setting its <strong><span class="KeyWordPACKT">Rect Transform</span></strong> property to <span class="ScreenTextPACKT"><span class="packt_screen">middle-center</span></span>.</li>
<li>With <span class="ScreenTextPACKT"><span class="packt_screen">Button-play-sound</span></span> selected in the <strong>Hierarchy</strong> panel, create a new on-click event-handler, dragging the <span class="ScreenTextPACKT"><span class="packt_screen">Main Camera</span></span> into the <span class="ScreenTextPACKT"><span class="packt_screen">Object</span></span> slot, and selecting the <kbd><span class="CodeInTextPACKT">ACTION_PlaySound()</span></kbd> function.</li>
<li>Create a second UI button named <span class="ScreenTextPACKT"><span class="packt_screen">Button-destroy-when-finished-playing</span></span>, changing its text to <span class="ScreenTextPACKT"><span class="packt_screen">Destroy When Sound Finishe</span><span class="packt_screen">d</span></span>. Position the button in the center of the screen (just below the other button) by setting its <strong><span class="KeyWordPACKT">Rect Transform</span></strong> property to <span class="ScreenTextPACKT"><span class="packt_screen">middle-center</span></span> and then drag the button down a little.</li>
<li>With <span class="packt_screen"><span class="ScreenTextPACKT">Button-</span><span class="ScreenTextPACKT">destroy-when-finished-playing</span></span> selected in the <strong>Hierarchy</strong> panel, create a new on-click event-handler, dragging the <span class="ScreenTextPACKT"><span class="packt_screen">Main Camera</span></span> into the <span class="ScreenTextPACKT"><span class="packt_screen">Object</span></span> slot, and selecting the <kbd><span class="CodeInTextPACKT">ACTION_</span> <span class="CodeInTextPACKT">DestroyAfterSoundStops()</span></kbd> function.</li>
<li>Run the scene. Clicking the <span class="ScreenTextPACKT"><span class="packt_screen">Play Sound</span></span> button will play the engine sound each time. However, once the <span class="ScreenTextPACKT"><span class="packt_screen">Destroy When Sound Finished</span></span> button has been clicked, as soon as the engineSound finished playing, you'll see the <span class="packt_screen">AudioObject</span> GameObject disappear from the <strong><span class="KeyWordPACKT">Hierarchy</span></strong> panel, since the GameObject has destroyed itself.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>You created a ButtonActions script class and added an instance as a component to the <span class="ScreenTextPACKT"><span class="packt_screen">Main Camera</span></span> <strong><span class="KeyWordPACKT">GameObject</span></strong>. This has two public variables, one to an <strong>AudioSource</strong> and one to an instance of the <span class="CodeInTextPACKT">AudioDestructBehaviour scripted component</span>.</p>
<p class="mce-root"/>
<p>The GameObject named <strong><span class="ScreenTextPACKT">AudioObject</span></strong> contains an <strong><span class="KeyWordPACKT">AudioSource</span></strong> component, which stores and manages the playing of the audio clip. <span class="ScreenTextPACKT"><strong>AudioObject</strong></span> also contains a scripted component, which is an instance of the <kbd><span class="ScreenTextPACKT">AudioDestructBehaviour</span></kbd> class. This script is initially disabled. When enabled, every frame in this object (via its <kbd><span class="CodeInTextPACKT">Update()</span></kbd> method) tests whether the audio source is playing (<kbd><span class="CodeInTextPACKT">!audio.isPlaying</span></kbd>). As soon as the audio is found to be not playing, the GameObject is destroyed.</p>
<p>There are two UI buttons created. The <strong><span class="ScreenTextPACKT">Button-play-sound</span></strong> button calls the <kbd>ACTION_<span class="CodeInTextPACKT">PlaySound()</span></kbd> method of the scripted component in <strong><span class="KeyWordPACKT">Main Camera</span></strong>. This method will start playing the audio clip, if it is not already playing.</p>
<p>The second button, <span class="ScreenTextPACKT"><strong>Button-destroy-when-finished-playing</strong>,</span> calls the <kbd>ACTION_</kbd><span class="CodeInTextPACKT"><kbd>DestoryAfterSoundStops()</kbd> </span>method of the scripted component in <span class="KeyWordPACKT">Main Camera</span>. This method enables the <span class="ScreenTextPACKT"><strong>AudioDestructBehaviour</strong></span> scripted component in the <strong>AudioObject</strong> GameObject <span>–</span> so that the <strong>AudioObject GameObject</strong> will be destroyed, once its <strong><span class="KeyWordPACKT">AudioSource</span></strong> sound has finished playing.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<p>The <em><span class="ItalicsPACKT">Preventing an Audio Clip from restarting if it is already playing</span></em> recipe in this chapter.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a metronome through the precise scheduling of sounds with dspTime</h1>
                </header>
            
            <article>
                
<p>In cases where we need precise scheduling of when sounds play, we should use the <kbd>AudioSource.<span class="CodeInTextPACKT">PlayScheduled(...)</span></kbd> method. This method uses the <kbd><span class="CodeInTextPACKT">AudioSettings.dspTime</span></kbd> value, which is highly accurate based on the playing of music data through the Unity audio system. Another advantage of the <kbd><span class="CodeInTextPACKT">dspTime</span></kbd> value is that is it independent of the graphical rendering frame rate:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/14fad81a-0b48-4ccc-bb69-4fa176b67d3d.png" style="width:23.33em;height:14.33em;"/></div>
<p>Note that the <kbd><span class="CodeInTextPACKT">dspTime</span></kbd> value is automatically frozen when a game is paused or suspended <span>–</span> so music scheduled using this approach will pause and resume flawlessly along with the scene gameplay. In this recipe, we'll create a metronome by precisely scheduling when two different sounds will play. Note that this recipe is based on some examples from the Unity documentation for the <kbd><span class="CodeInTextPACKT">AudioSource.PlayScheduled(...)</span></kbd> method: <a href="https://docs.unity3d.com/ScriptReference/AudioSource.PlayScheduled.html"><span class="URLPACKT">https://docs.unity3d.com/ScriptReference/AudioSource.PlayScheduled.html</span></a>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, we have provided two metronome sound clips inside the <kbd>04_07</kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To schedule a sound to play after a given delay, do the following:</p>
<ol>
<li>Create a new Unity 2D project and import the provided sound clip files.</li>
<li>Create a GameObject in the scene containing an <strong><span class="KeyWordPACKT">AudioSource</span></strong> component linked to <span class="KeyWordPACKT">the</span> <strong>metronome_tick AudioClip</strong>. This can be done in a single step by dragging the music clip from the <span class="KeyWordPACKT">Project</span> panel into either the <strong><span class="KeyWordPACKT">Hierarchy</span></strong> or <strong><span class="KeyWordPACKT">Scene</span></strong> panels.</li>
<li>Repeat the previous step to create another GameObject, containing an <strong><span class="KeyWordPACKT">AudioSource</span></strong> linked to the <span class="ScreenTextPACKT"><span class="packt_screen">metronome_tick_accent</span> clip</span>.</li>
</ol>
<ol start="4">
<li>For both <strong><span class="KeyWordPACKT">AudioSources</span></strong> created, uncheck the <span class="ScreenTextPACKT"><span class="packt_screen">Play Awake</span></span> property <span>–</span> so these sounds do not begin playing as soon as the scene is loaded.</li>
<li>Create an empty GameObject named <span class="ScreenTextPACKT"><span class="packt_screen">MetronomeManager</span></span>.</li>
<li>Create a C# script class, <span class="CodeInTextPACKT">Metronome,</span> in a new folder, <kbd><span class="CodeInTextPACKT">_Scripts</span></kbd><span>, containing the following code, and add an instance as a scripted component to the <span class="ScreenTextPACKT"><span class="packt_screen">MetronomeManager</span> GameObject</span>:</span></li>
</ol>
<pre style="padding-left: 60px">using UnityEngine; 
 
public class Metronome : MonoBehaviour { 
    public AudioSource audioSourceTickBasic; 
    public AudioSource audioSourceTickAccent; 
 
    public double bpm = 140.0F; 
    public int beatsPerMeasure = 4; 
 
    private double nextTickTime = 0.0F; 
    private int beatCount; 
    private double beatDuration; 
 
    void Start() { 
        beatDuration = 60.0F / bpm; 
        beatCount = beatsPerMeasure; // so about to do a beat 
        double startTick = AudioSettings.dspTime; 
        nextTickTime = startTick; 
    } 
 
    void Update() { 
        if (IsNearlyTimeForNextTick()) 
            BeatAction(); 
    } 
 
    private bool IsNearlyTimeForNextTick() { 
        float lookAhead = 0.1F; 
        if ((AudioSettings.dspTime + lookAhead) &gt;= nextTickTime) 
            return true; 
        else 
            return false; 
    } 
 
    private void BeatAction() { 
        beatCount++; 
        string accentMessage = ""; 
 
        if (beatCount &gt; beatsPerMeasure) 
            accentMessage = AccentBeatAction(); 
        else 
            audioSourceTickBasic.PlayScheduled(nextTickTime); 
 
        nextTickTime += beatDuration; 
        print("Tick: " + beatCount + "/" + signatureHi + accentMessage); 
    } 
 
    private string AccentBeatAction() { 
        audioSourceTickAccent.PlayScheduled(nextTickTime); 
        beatCount = 1; 
        return " -- ACCENT ---"; 
    } 
} </pre>
<ol start="7">
<li>Select <span class="KeyWordPACKT">the</span> <span class="ScreenTextPACKT">M</span><span class="ScreenTextPACKT">etronomeManager</span> GameObject in the <span class="KeyWordPACKT">Hierarchy</span>. Drag <span class="KeyWordPACKT"><span class="packt_screen">metronome_tick</span></span> from the <span class="KeyWordPACKT">Hierarchy</span> into the <strong><span class="KeyWordPACKT">Inspector</span></strong> <span class="ScreenTextPACKT"><span class="packt_screen">Audio Source Tick Basic</span></span> public variable, for the <span class="ScreenTextPACKT">Metronome (Script)</span> component.</li>
<li>Drag <span class="KeyWordPACKT"><span class="packt_screen">metronome_tick_accent</span></span> from the <span class="KeyWordPACKT">Hierarchy</span> into the <span class="KeyWordPACKT">Inspector</span> <span class="ScreenTextPACKT"><span class="packt_screen">Audio Source Tick Accent</span></span> public variable, for the <span class="ScreenTextPACKT"><span class="packt_screen">Metronome (Script)</span></span> component:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/cd68dae0-aece-415a-b050-2e78d38f168e.png" style="width:41.42em;height:19.33em;"/></div>
<ol start="9">
<li>Play the scene. You will see (in the Console) and hear the regular metronome sounds, with the first beat of each count playing the accented (and louder) sound.</li>
</ol>
<ol start="10">
<li>Try changing the <span class="ScreenTextPACKT"><span class="packt_screen">Bpm</span></span> (beats per minute) setting, to speed up or slow down the metronome. Or change the number of <span class="ScreenTextPACKT"><span class="packt_screen">Beats Per Measure</span></span>, to count up to 3, 4, or 6 beats between each accented beat.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>You add to the scene two <span class="KeyWordPACKT">GameIObjects</span>, containing <span class="KeyWordPACKT">AudioSources</span> linked to music clips for a basic and an accented metronome "tick." You created a Metronome C# script class and added an instance to an empty <span class="KeyWordPACKT">GameObject</span>. You associated the two <span class="KeyWordPACKT">AudioSources</span> in your GameObjects with the two public variables in your scripted component.</p>
<p>The <kbd><span class="CodeInTextPACKT">Start()</span></kbd> method calculates the duration of each beat (based on bpm), initializes the beat count (so the first beat is an accented beat), and then sets <kbd><span class="CodeInTextPACKT">nextTickTime</span></kbd>, the time for the next tick to the current <span class="CodeInTextPACKT">dspTime</span>.</p>
<p>The <kbd><span class="CodeInTextPACKT">IsNearlyTimeForNextTick()</span></kbd> method returns a Boolean true/false value indicating if it is nearly time to schedule the next tick. The value returned is based on whether the current <kbd><span class="CodeInTextPACKT">dspTime</span></kbd> is within 1/10<sup>th</sup> of a second of the value of <kbd><span class="CodeInTextPACKT">nextTickTime</span></kbd>. If so, then true is returned.</p>
<p>The <kbd><span class="CodeInTextPACKT">Update()</span></kbd> method is a single if statement. If it's nearly time for the next beat, the <span class="CodeInTextPACKT"><kbd>BeatAction()</kbd></span> method is invoked.</p>
<p>The <kbd><span class="CodeInTextPACKT">BeatAction()</span></kbd> method does the following:</p>
<ul>
<li>Adds 1 to the number of beats</li>
<li>Initializes the <span class="CodeInTextPACKT">accentMessage string</span> to be empty (the default)</li>
<li>IF:<br/>
the next beat should be 1 (the accent), <span class="CodeInTextPACKT">AccentBeatAction()</span> and the string returned are stored in <span class="CodeInTextPACKT">accentMessage</span></li>
<li>ELSE (if not accent next beat):<br/>
the basic beat sound is scheduled</li>
<li>The next beat time is calculated (current beat time + duration of each beat)</li>
<li>It displays the beat count message in Console (including the string for any accent message)</li>
</ul>
<p>The <span class="CodeInTextPACKT">AccentBeatAction()</span> method does three things: it schedules the accented beat sound, it resets the beat count to 1, and it returns a string to be shown with the beat message (with text to indicate an accent beat is next: <span class="CodeInTextPACKT">-- ACCENT ---).</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>There are some details that you don't want to miss.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating just-in-time AudioSource GameObjects for the basic and accented beats</h1>
                </header>
            
            <article>
                
<p>We can reduce the <span class="KeyWordPACKT">Design-Time</span> work for the metronome by making use of the Extension method presented in the <span class="ItalicsPACKT"><em>Creating just-in-time AudioSource components at runtime through C# scripting</em> recipe</span>.</p>
<p>First, copy the <kbd><span class="CodeInTextPACKT">ExtensionMethods.cs</span></kbd> <span> </span><span>C# script class </span><span>into your metronome project. Next, delete the two </span><span class="KeyWordPACKT">GameObjects</span> <span>in the scene containing</span> <strong><span class="KeyWordPACKT">AudioSource</span></strong> <span>components, and instead declare two public variables for each <kbd>AudioClip ()</kbd>. Finally, we just need to write an</span> <kbd><span class="CodeInTextPACKT">Awake()</span></kbd> <span>method that will create the required</span> <span class="KeyWordPACKT">GameObjects</span> <span>in the scene containing</span> <strong><span class="KeyWordPACKT">AudioSource</span></strong> <span>basic on the <strong>AudioClip</strong> variables (and making the basic beat quieter than the accented one):</span></p>
<pre>void Awake() { 
   audioSourceTickBasic = this.CreateAudioSource(clipTickBasic, false); 
   audioSourceTickBasic.volume = 0.5F; 
 
   audioSourceTickAccent = this.CreateAudioSource(clipTickAccent, false); 
   audioSourceTickAccent.volume = 1.00F; 
} </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating beat sounds through data rather than AudioClips</h1>
                </header>
            
            <article>
                
<p>The Unity documentation about <kbd><span class="CodeInTextPACKT">dspTime</span></kbd> provides an interesting approach to creating the basic and accented beats for a metronome <span>–</span> though editing the audio data samples themselves. Check out their scripted metronome at <a href="https://docs.unity3d.com/ScriptReference/AudioSettings-dspTime.html"><span class="URLPACKT">https://docs.unity3d.com/ScriptReference/AudioSettings-dspTime.html</span></a>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Matching the audio pitch to the animation speed</h1>
                </header>
            
            <article>
                
<p>Many artifacts sound higher in pitch when accelerated and lower when slowed down. Car engines, fan coolers, a record player... the list goes on. If you want to simulate this kind of sound effect in an animated object that can have its speed changed dynamically, follow this recipe.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, you'll need an animated 3D object and an audio clip. Please use the <kbd><span class="CodeInTextPACKT">animatedRocket.fbx</span></kbd> and <span class="CodeInTextPACKT"><kbd>engineSound.wav</kbd> files</span>, available in the <kbd><span class="CodeInTextPACKT">04_08</span></kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To change the pitch of an audio clip according to the speed of an animated object, please follow these steps:</p>
<ol>
<li>Create a new Unity 3D project.</li>
<li>Create a new <span class="packt_screen">Models</span> <span class="ScreenTextPACKT">folder</span> in the <span class="packt_screen">Project</span> panel, and into this import the provided <span class="packt_screen">animatedRocket.fbx</span> file.</li>
<li>Create a new <span class="ScreenTextPACKT">Sounds</span> folder in the <span class="packt_screen">Project</span> panel, and into this Import the provided audio clip, <span class="packt_screen">engineSound.wav</span>.</li>
<li>Select the <span class="ScreenTextPACKT"><span class="packt_screen">animatedRocket</span></span> file in the <span class="KeyWordPACKT">Project</span> panel. In the <span class="KeyWordPACKT">Inspector</span> for <span class="packt_screen">animatedRocket</span> <span class="ScreenTextPACKT">Import Settings,</span> click the <span class="ScreenTextPACKT"><span class="packt_screen">Animations</span></span> button. In <span class="ScreenTextPACKT"><span class="packt_screen">Animations</span></span> select (the only) <span class="ScreenTextPACKT">Take 001 clip</span>, and make sure to check the <span class="ScreenTextPACKT">Loop Time</span> option. Click on the <span class="ScreenTextPACKT">Apply</span> button to save the changes. See the screenshot for these settings:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/287379b6-8649-4823-9ee6-d6dbd243f51d.png" style="width:28.58em;height:36.58em;"/></div>
<div class="packt_tip">The reason we didn't need to check <strong><span class="ScreenTextPACKT">Loop Pose</span></strong> option is because our animation already loops in a seamless fashion. If it didn't, we could have checked that option to automatically create a seamless transition from the last to the first frame of the animation.</div>
<ol start="5">
<li>Add an instance of <kbd><span class="ScreenTextPACKT">a</span><span class="ScreenTextPACKT">nimatedRocket</span></kbd> as a <span class="KeyWordPACKT">GameObject</span> <span class="ScreenTextPACKT">in</span> the scene by dragging it from the <strong><span class="KeyWordPACKT">Project</span></strong> panel into the <span class="KeyWordPACKT">Scene</span> or <strong><span class="KeyWordPACKT">Hierarchy</span></strong> panel.</li>
<li>Add an <span class="KeyWordPACKT">AudioSource</span> component to <span class="KeyWordPACKT">the</span> <span class="ScreenTextPACKT">engineSound GameObject</span>.</li>
</ol>
<ol start="7">
<li>With <span class="ScreenTextPACKT"><span class="packt_screen">engineSound</span></span> selected in the <strong><span class="KeyWordPACKT">Hierarchy</span></strong>, drag <span class="KeyWordPACKT">the</span> <span class="packt_screen"><span class="ScreenTextPACKT">engineSound</span> AudioClip</span> file from the <strong><span class="KeyWordPACKT">Project</span></strong> panel into the <strong><span class="KeyWordPACKT">Inspector</span></strong> for the <strong><span class="KeyWordPACKT">Audio Clip</span></strong> parameter of the <span class="KeyWordPACKT">Audio Source</span> component. Ensure the <span class="ScreenTextPACKT"><span class="packt_screen">Loop</span></span> option is <span class="KeyWordPACKT">checked</span>, and the <span class="ScreenTextPACKT"><span class="packt_screen">Play On Awake</span></span> option is <span class="KeyWordPACKT">unchecked:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/76e48ab6-4c24-4282-a9ed-7f01865ee829.png" style="width:28.75em;height:23.08em;"/></div>
<ol start="8">
<li>Create an <span class="packt_screen"><span class="KeyWordPACKT">Anima</span><span class="KeyWordPACKT">tor</span> <span class="KeyWordPACKT">Controller</span></span> for our model. Select the <span class="ScreenTextPACKT"><span class="packt_screen">Models</span> folder</span> in the <span class="KeyWordPACKT">Project</span> panel, and use the Create menu to create a new <span class="KeyWordPACKT"><strong>Animator</strong> Controller</span> file named <span class="ScreenTextPACKT"><span class="packt_screen">Rocket Controller</span></span>.</li>
<li>Double-click the <span class="packt_screen"><span class="ScreenTextPACKT">Rocket Controller</span> </span>file in the Project panel to open the <strong>Animator</strong> panel. Create a new state by choosing menu option: <span class="ScreenTextPACKT">Create <span class="packt_screen">State</span> | <span class="packt_screen">Empty</span></span> (as shown in the screenshot):</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/0851aa59-05c6-44b6-a4dd-671a7322b5c6.png" style="width:32.17em;height:12.33em;"/></div>
<ol start="10">
<li>Rename this new state <span class="ScreenTextPACKT">spin</span> (in its <strong><span class="KeyWordPACKT">Inspector</span></strong> properties), and set <span class="ScreenTextPACKT">Take 001</span> as its motion in the Motion field:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/f3bc6c09-492f-46a9-9f72-e6a5830cfb12.png" style="width:37.08em;height:13.42em;"/></div>
<ol start="11">
<li>Select <span class="packt_screen"><span class="ScreenTextPACKT">animatedRo</span><span class="ScreenTextPACKT">cket</span></span> in the <strong><span class="KeyWordPACKT">Hierarchy</span></strong> panel. Drag <span class="ScreenTextPACKT">Rocket Controller</span> from the <kbd><span class="ScreenTextPACKT">Models</span></kbd> folder in the <span class="KeyWordPACKT">Project</span> panel into the <span class="ScreenTextPACKT">Controller</span> parameter for the <span class="KeyWordPACKT">Animator</span> component in the <strong><span class="KeyWordPACKT">Inspector</span></strong>. Ensure that the <span class="ScreenTextPACKT"><span class="packt_screen">Apply Root Motion</span></span> option is unchecked in the <span class="KeyWordPACKT"><strong>Inspector</strong>:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/4d01c174-4d66-42a1-b905-887aba4211fa.png" style="width:37.25em;height:18.17em;"/></div>
<ol start="12">
<li>Create a C# script class, <span class="CodeInTextPACKT"><kbd>ChangePitch</kbd>,</span> in the <span class="CodeInTextPACKT"><kbd>_Scripts</kbd> folder</span>, containing the following code, and add an instance as a scripted component to <span class="KeyWordPACKT">the</span> <span class="ScreenTextPACKT"><kbd>animatedRocket</kbd> GameObject</span>:</li>
</ol>
<pre style="padding-left: 60px">using UnityEngine; 
 
public class ChangePitch : MonoBehaviour{ 
   public float acceleration = 0.05f; 
   public float minSpeed = 0.0f; 
   public float maxSpeed = 2.0f; 
   public float animationSoundRatio = 1.0f; 
 
   private float speed = 0.0f; 
   private Animator animator; 
   private AudioSource audioSource; 
 
    private void Awake() { 
        animator = GetComponent&lt;Animator&gt;(); 
        audioSource = GetComponent&lt;AudioSource&gt;(); 
    } 
 
    void Start() { 
         speed = animator.speed; 
        AccelerateRocket (0); 
   }      
 
   void Update() { 
         if (Input.GetKey (KeyCode.Alpha1)) 
            AccelerateRocket(acceleration); 
          
         if (Input.GetKey (KeyCode.Alpha2)) 
            AccelerateRocket(-acceleration); 
   } 
 
   public void AccelerateRocket(float acceleration) { 
         speed += acceleration; 
         speed = Mathf.Clamp(speed,minSpeed,maxSpeed); 
         animator.speed = speed; 
         float soundPitch = animator.speed * animationSoundRatio; 
         audioSource.pitch = Mathf.Abs(soundPitch); 
   } 
} </pre>
<ol start="13">
<li><span>Play the scene and ch</span><span>ange the animation speed by pressing number key 1 (accelerate) and 2 (decelerate) on your keyboard. The audio pitch will change accordingly.</span></li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>You created a C# script class, <span class="CodeInTextPACKT"><strong>ChangePitch</strong>,</span> and added an instance to <span>the <span class="ScreenTextPACKT"><strong>animatedRocket</strong> GameObject</span>. It declares several variables, the most important of which is</span> <kbd><span class="CodeInTextPACKT">acceleration</span></kbd>.</p>
<p>It's <kbd><span class="CodeInTextPACKT">Awake()</span></kbd> method caches references to the <span class="ScreenTextPACKT">Animator</span> <span>and <span class="ScreenTextPACKT"><strong>AudioSource</strong> sibling components</span>.</span> The <kbd><span class="CodeInTextPACKT">Start()</span></kbd> method sets the initial <span class="CodeInTextPACKT">speed</span> <span>from the <strong><span class="ScreenTextPACKT">Animator</span></strong>, and calls the</span> <kbd><span class="CodeInTextPACKT">AccelerateRocket(...)</span></kbd> method, passing <span class="CodeInTextPACKT">0</span> <span>to calculate the resulting pitch for the <span class="ScreenTextPACKT">Audio Source</span>.</span></p>
<p>In each frame, the <span class="CodeInTextPACKT">Update()</span> method tests for keyboard keys <span class="KeyPACKT">1</span> and <span class="KeyPACKT">2</span>. When detected, they call the <kbd><span class="CodeInTextPACKT">AccelerateRocket(...)</span></kbd> method, passing a positive or negative value of acceleration as appropriate.</p>
<p>The <span class="CodeInTextPACKT"><kbd>AccelerateRocket(...)</kbd> method </span>increments variable <span class="CodeInTextPACKT">speed</span> with the received argument. The <span class="CodeInTextPACKT"><kbd>Mathf.Clamp()</kbd> </span><span>command limits the new speed value between the minimum and maximum speed. Then, it changes the <strong><span class="ScreenTextPACKT">Animator</span></strong> speed and <strong><span class="ScreenTextPACKT">Audio Source</span></strong> pitch according to the new</span> <span class="CodeInTextPACKT">speed</span> absolute (positive) value. The value is then clamped a second time to avoid negative numbers. If you wish to reverse the animation, check out the<span> code files in the </span>solution provided for this recipe.</p>
<p>Please note that setting the animation speed, and therefore the sound pitch, to <span class="CodeInTextPACKT">0</span> will cause the sound to stop, making it clear that stopping the object's animation also prevents the engine sound from playing.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Here is some information on how to fine-tune and customize this recipe.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Changing the Animation/Sound Ratio</h1>
                </header>
            
            <article>
                
<p>If you want the audio clip pitch to be more or less affected by the animation speed, change the value of the public <span class="ScreenTextPACKT">Animation/Sound Ratio</span> parameter in the <span class="KeyWordPACKT">Inspector</span>.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Accessing the function from other scripts</h1>
                </header>
            
            <article>
                
<p>The <kbd><span class="CodeInTextPACKT">AccelerateRocket(...)</span></kbd> function was made public so that it can be accessed from other scripts. As an example, we have included the <kbd><span class="CodeInTextPACKT">ExternalChangePitch.cs</span></kbd> script in <span class="CodeInTextPACKT">the <kbd>_Scripts</kbd></span> folder. To illustrate how the <strong>ChangePitch</strong> scripted component can be controlled form another script, do the following:</p>
<ol>
<li>Attach this script to the <strong><span class="ScreenTextPACKT">Main Camera</span></strong> <span class="KeyWordPACKT">GameObject</span>. Drag <span class="KeyWordPACKT">the</span> <strong><span class="ScreenTextPACKT">animatedRocket</span></strong> GameObject from the <span class="KeyWordPACKT">Hierarchy</span> into the public <span class="ScreenTextPACKT"><strong>Change Pitch Scripted Component</strong> variable</span>.</li>
<li>Run the scene.</li>
<li>Use the <em><span class="KeyPACKT">UP</span></em> and <em><span class="KeyPACKT">DOWN</span></em> arrow keys to control the animation speed (and sound pitch).</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Allowing reverse animation (negative speeds!)</h1>
                </header>
            
            <article>
                
<p>In the <span class="KeyWordPACKT">Animator</span> panel, create a new Float parameter, <strong>Speed</strong>, initialized to 1.0. With state spin selected in the <strong><span class="KeyWordPACKT">Animator</span></strong> panel, check the <strong><span class="ScreenTextPACKT">Speed Parameter Multiplier</span></strong> option and choose the <strong>Speed</strong> parameter. In the Inspector, set <strong><span class="ScreenTextPACKT">Min Speed</span></strong> to <span class="ScreenTextPACKT">-2</span>, to allow negative speeds for animations.</p>
<p>In the <strong>ChangePitch</strong> C# script, replace the <strong><span class="CodeInTextPACKT">AccelerateRocket</span></strong> method with the following:</p>
<pre>public void AccelerateRocket(float acceleration) { 
   speed += acceleration;  
   speed = Mathf.Clamp(speed, minSpeed, maxSpeed); 
 
   animator.SetFloat("Speed", speed); 
   float soundPitch = speed * animationSoundRatio; 
   audioSource.pitch = Mathf.Abs(soundPitch); 
} </pre>
<p>Now when you use <span>key 1 (accelerate) and 2 (decelerate), you can actually decelerate to zero and then continue to reverse the animation.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Simulating acoustic environments with Reverb Zones</h1>
                </header>
            
            <article>
                
<p>Once you have created your level's geometry and the scene is looking just the way you want it to, you might want your sound effects to correspond to that look. Sound behaves differently depending upon the environment in which it is projected, so it can be a good idea to make it reverberate accordingly. In this recipe, we will address this acoustic effect by using <span class="KeyWordPACKT">Reverb Zones</span>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, we have prepared the <kbd><span class="CodeInTextPACKT">ReverbZone.unitypackage</span></kbd> file, containing a basic level named <strong><span class="CodeInTextPACKT">reverbScene</span></strong> and a prefab, <span class="CodeInTextPACKT">Signal</span>. The package can be found in the <span class="CodeInTextPACKT"><kbd>04_09</kbd> folder</span>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>Follow these steps to simulate the sonic landscape of a tunnel:</p>
<ol>
<li>Create a new Unity 3D project.</li>
<li>Import the provided <strong>Unity</strong> package, <span class="CodeInTextPACKT"><strong>ReverbZone</strong>,</span> into your project.</li>
<li>From the <span class="KeyWordPACKT">Project</span> panel, open <strong>reverbScene</strong> <span>–</span> it's in the <kbd><span class="ScreenTextPACKT">_Scenes</span></kbd> folder in the <span class="ScreenTextPACKT"><kbd>ReverbZones</kbd> folder</span>. This scene gives you a tunnel, and a controllable character (<em><span class="KeyPACKT">W A S D</span></em> keys and <em><span class="KeyPACKT">Shift</span></em> to run).</li>
</ol>
<ol start="4">
<li>From the <span class="KeyWordPACKT">Project</span> panel, drag the <span class="ScreenTextPACKT">Signal</span> prefab into the <span class="KeyWordPACKT">Hierarchy</span> <span>–</span> it's in the <span class="ScreenTextPACKT"><kbd>_Prefabs</kbd> folder</span> in the <span class="ScreenTextPACKT"><kbd>ReverbZones</kbd> folder</span>. This will add a sound-emitting object to the scene. Place it in the center of the tunnel:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/c5f6e601-504a-4af4-a12e-8db352f55463.png" style="width:34.50em;height:29.75em;"/></div>
<ol start="5">
<li>Make five copies of <span class="KeyWordPACKT">the</span> <strong><span class="ScreenTextPACKT">Signal</span></strong> GameObject and distribute them throughout the tunnel (leaving a copy just outside each entrance):</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/496916f1-7221-4a49-b39c-60114dedfdd3.png"/></div>
<ol start="6">
<li>In the Hierarchy panel, use the <strong><span class="ScreenTextPACKT">Create</span> menu</strong> <span class="ScreenTextPACKT">| <strong>Audio</strong> | <strong>Audio Reverb Zone</strong></span> to add a <strong>Reverb Zone</strong> to the scene. Then place this new GameObjct in the center of the tunnel.</li>
</ol>
<div class="packt_tip">Use menu GameObject | Move To View if there is already a GameObject where you want to position another one. Since our Signal GameObject is in the middle of the tunnel, we can double-click that GameObject, then single-click Reverb Zone and move to view <span>–</span> to move the Reverb Zone object to the same location.</div>
<ol start="7">
<li>Select <span class="KeyWordPACKT">the</span> <span class="ScreenTextPACKT"><strong>Reverb Zone</strong> GameObject</span>. In the Inspector panel, change the <strong><span class="ScreenTextPACKT">Reverb Zone</span></strong> component parameters to these values: <strong><span class="ScreenTextPACKT">Min Distance</span></strong> = <span class="ScreenTextPACKT"><kbd>6</kbd>,</span> <strong><span class="ScreenTextPACKT">Max Distance</span></strong> = <span class="ScreenTextPACKT"><kbd>18</kbd>,</span> and <strong><span class="ScreenTextPACKT">Preset</span></strong> = <kbd><span class="ScreenTextPACKT">StoneCorridor</span></kbd>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/5bd41d25-65a8-4e4f-9c0b-266f32bf832b.png"/></div>
<ol start="8">
<li>Play the scene. As you walk through the tunnel, you will hear the audio reverberate when inside the <span class="ScreenTextPACKT">Reverb Zone</span> area.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Once positioned, the <span class="ScreenTextPACKT">Audio Reverb Zone</span> applies an audio filter to all audio sources within its radius.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Here are more options for you to try.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Attaching the Audio Reverb Zone component to Audio Sources</h1>
                </header>
            
            <article>
                
<p>Instead of creating an <span class="ScreenTextPACKT">Audio Reverb Zone</span> GameObject, you can attach it to the sound-emitting object (in our case, <span class="ScreenTextPACKT">Signal</span>) as a component through the <strong><span class="ScreenTextPACKT">Component</span></strong> | <strong><span class="ScreenTextPACKT">Audio</span></strong> | <span class="ScreenTextPACKT"><strong>Audio</strong> <strong>Reverb Zone</strong></span> menu. In such cases, the <span class="ScreenTextPACKT">Reverb Zone</span> will be individually set up around its parent <span class="KeyWordPACKT">GameObject</span>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Making your own Reverb settings</h1>
                </header>
            
            <article>
                
<p>Unity comes with several <strong><span class="KeyWordPACKT">Reverb Presets</span></strong>. We have used <strong><span class="ScreenTextPACKT">StoneCorridor</span></strong>, but your scene can ask for something less intense (such as <span class="ScreenTextPACKT">Room</span>) or more radical (such as <span class="ScreenTextPACKT">Psychotic</span>). If these presets still won't be able to recreate the effect that you have in mind, change it to <span class="ScreenTextPACKT">User</span> and edit its parameters as you wish.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding volume control with Audio Mixers</h1>
                </header>
            
            <article>
                
<p>Sound-volume adjustment can be a very important feature, especially if your game is a standalone. After all, it can be very frustrating for players to have to access the <strong>Operating System</strong> volume control. In this recipe, we will use the <span class="ScreenTextPACKT">Audio Mixer</span> feature to create independent volume controls for Music and Sound FX.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, we have provided a Unity package named <kbd><span class="CodeInTextPACKT">VolumeControl.unitypackage</span></kbd>, containing an initial scene featuring soundtrack music and sound effects. The file is available inside the <kbd><span class="CodeInTextPACKT">04_10</span></kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To add volume control sliders to your scene, follow these steps:</p>
<ol>
<li>Create a new Unity 3D project.</li>
<li>Import the provided <strong>Unity</strong> package, <span class="CodeInTextPACKT"><strong>Volume</strong>,</span> into your project.</li>
<li>Open the <strong><span class="ScreenTextPACKT">Volume</span></strong> scene from <span class="KeyWordPACKT"><strong>Project</strong></span> panel folder, <strong><span class="ScreenTextPACKT">VolumeControl</span></strong> | <kbd>_Scenes</kbd>.</li>
<li>Play the scene and walk toward the semitransparent green wall in the tunnel, using the <em><span class="KeyPACKT">W A S D</span></em> keys (press <em><span class="KeyPACKT">Shift</span></em> to run). You will be able to listen to:
<ul>
<li>A looping music soundtrack</li>
<li>Bells ringing</li>
<li>A robotic speech whenever the character collides with the wall</li>
</ul>
</li>
<li>In the <strong>Project</strong> panel, use the <span class="ScreenTextPACKT">Create</span> menu to add an <strong><span class="ScreenTextPACKT">Audio Mixer</span></strong> file. Rename this new file <span class="ScreenTextPACKT">MainMixer</span>.</li>
<li>Double-click <span class="ScreenTextPACKT">MainMixer</span> to open the <strong><span class="ScreenTextPACKT">Audio Mixer</span></strong> panel.</li>
</ol>
<ol start="7">
<li>In the the <strong><span class="ScreenTextPACKT">Audio Mixer</span></strong> panel <strong><span class="ScreenTextPACKT">Groups</span></strong> section, highlight <strong><span class="ScreenTextPACKT">Master</span></strong> and click the + (plus) sign to add a child to the <strong><span class="ScreenTextPACKT">Master</span></strong> group. Name this child <strong><span class="ScreenTextPACKT">Music</span></strong>. Repeat these actions to add a second child of <strong><span class="ScreenTextPACKT">Master</span></strong> named <span class="ScreenTextPACKT">FX:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/4e196b5d-9e9f-481b-81dc-4c86d2caf4e2.png" style="width:13.50em;height:19.33em;"/></div>
<ol start="8">
<li>In the the <span class="ScreenTextPACKT">A</span><span class="ScreenTextPACKT">udio Mixer</span> panel <span class="ScreenTextPACKT">Mixers</span> section, highlight <span class="ScreenTextPACKT">MainMixer</span> and click the + (plus) sign to add a new item to the <span class="ScreenTextPACKT">Mixers</span> group. Rename this <span class="ScreenTextPACKT">MusicMixer</span> (you may need to rename this via the Project panel, since you've created a new Audio Mixer file through this process).</li>
<li>Drag <span class="ScreenTextPACKT">MusicMixer</span> onto <span class="ScreenTextPACKT">MainMixer</span> (child it), and select <span class="ScreenTextPACKT">Music</span> as its output in the pop-up dialog window.</li>
<li>In the the <strong><span class="ScreenTextPACKT">Audio Mixer</span></strong> panel <span class="ScreenTextPACKT">Mixers</span> section, highlight <strong><span class="ScreenTextPACKT">MainMixer</span></strong> and click the + (plus) sign to add a new item to the <strong><span class="ScreenTextPACKT">Mixers</span></strong> group. Name this <strong><span class="ScreenTextPACKT">FxMixer</span></strong>.</li>
<li>Child (drag) <strong><span class="ScreenTextPACKT">FxMixer</span></strong> onto <strong><span class="ScreenTextPACKT">MainMixer</span></strong>, and select <span class="ScreenTextPACKT">Fx</span> as its output in the pop-up dialog window.</li>
<li>Select <span class="ScreenTextPACKT">MusicMixer</span>. Select its <span class="ScreenTextPACKT">Master</span> group and add a child named <span class="ScreenTextPACKT">Soundtrack</span>.</li>
<li>Select <strong><span class="ScreenTextPACKT">FxMixer</span></strong> and add two children to its <strong>Master</strong> group: one named <span class="ScreenTextPACKT">Speech</span>, and another named <span class="ScreenTextPACKT">Bells:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/dbb0f356-94dd-44f5-95cf-cfd45f3d0948.png" style="width:13.25em;height:21.25em;"/></div>
<ol start="14">
<li>Select <span class="KeyWordPACKT">the</span> <strong><span class="ScreenTextPACKT">DialogueTrigger</span></strong> GameObject in the <strong><span class="KeyWordPACKT">Hierarchy</span></strong>. In the <span class="KeyWordPACKT"><strong>Inspector</strong>,</span> change its <strong><span class="ScreenTextPACKT">Audio Source</span></strong> component <span class="ScreenTextPACKT">Output</span> track to <span class="ScreenTextPACKT"><strong>FxMixer</strong> | <strong>Speech</strong></span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/7707cd89-f690-4463-bfe7-ef346b642c88.png" style="width:35.17em;height:16.83em;"/></div>
<ol start="15">
<li>Select the <span class="ScreenTextPACKT"><strong>Soundtrack</strong> GameObject</span> in the <strong><span class="KeyWordPACKT">Hierarchy</span></strong>. In the <span class="KeyWordPACKT"><strong>Inspector</strong>,</span> change its <span class="ScreenTextPACKT">Audio Source</span> component <strong><span class="ScreenTextPACKT">Output</span></strong> track to <span class="ScreenTextPACKT"><strong>MusicMixer</strong> | <strong>Soundtrack</strong>.</span></li>
<li>Select <strong><span class="ScreenTextPACKT">Signal</span></strong> from the <span class="ScreenTextPACKT"><kbd>Prefabs</kbd> folder</span> in the <strong><span class="KeyWordPACKT">Project</span></strong> panel. In the <span class="KeyWordPACKT"><strong>Inspector</strong>,</span> change its <span class="ScreenTextPACKT">Audio Source</span> component <span class="ScreenTextPACKT">Output</span> track to <span class="ScreenTextPACKT">FxMixer | Bells.</span></li>
</ol>
<p class="mce-root"/>
<ol start="17">
<li>Select <strong><span class="ScreenTextPACKT">MainMixer</span></strong> in the <strong><span class="ScreenTextPACKT">Audio Mixer</span></strong> panel, and select its <strong><span class="ScreenTextPACKT">Master</span></strong> track. In the <strong>Inspector</strong> panel, right-click on <span class="ScreenTextPACKT">Volume</span> in the <strong><span class="ScreenTextPACKT">Attenuation</span></strong> component. From the pop-up-context menu, select <strong>Expose</strong> <span class="ScreenTextPACKT"><strong>Volume</strong> (of Master) to script</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/8dde7821-a2ce-4bb1-b8af-89bccd79ce27.png" style="width:33.33em;height:10.67em;"/></div>
<ol start="18">
<li>Repeat the operation to expose the <strong>Volume</strong> to scripts for both the <strong><span class="ScreenTextPACKT">Music</span></strong> and <span class="ScreenTextPACKT">FX</span> <span class="ScreenTextPACKT">Groups</span>.</li>
<li>At the top-right of the <strong><span class="ScreenTextPACKT">Audio Mixer</span></strong> panel, you should see <span class="ScreenTextPACKT"><strong>Exposed Parameters</strong> (three)</span>. Click the drop-down icon, and rename them as follows: <span class="ScreenTextPACKT"><span class="packt_screen">MyExposedParam</span></span> to <span class="ScreenTextPACKT">OverallVolume</span>; <span class="ScreenTextPACKT"><span class="packt_screen">MyExposedParam1</span></span> to <span class="ScreenTextPACKT"><span class="packt_screen">MusicVolume</span></span>, and <span class="ScreenTextPACKT"><span class="packt_screen">MyExposedParam2</span></span> to <span class="ScreenTextPACKT">FxVolume</span>. Note the sequence of the three parameters may not match the order you added them, so double-check that the greyed-out track names on the right correspond correctly:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/5337a07a-2550-47f3-854a-05d204563484.png"/></div>
<ol start="20">
<li>In the <strong><span class="KeyWordPACKT">Hierarchy</span></strong> panel, use the <strong><span class="ScreenTextPACKT">Create</span></strong> drop-down menu to add a <strong><span class="KeyWordPACKT">UI Panel</span></strong> to the scene (menu: <strong><span class="ScreenTextPACKT">Create</span></strong> | <strong><span class="ScreenTextPACKT">UI</span></strong> | <strong><span class="ScreenTextPACKT">Panel</span></strong>). Unity will automatically add a <span class="ScreenTextPACKT">Canvas</span> parent for this panel.</li>
<li>In the <strong><span class="KeyWordPACKT">Hierarchy</span></strong> panel, create a UI <span class="ScreenTextPACKT">Slider</span> to the scene (menu: <strong><span class="ScreenTextPACKT">Create</span></strong> | <strong><span class="ScreenTextPACKT">UI</span></strong> | <strong><span class="ScreenTextPACKT">Slider</span></strong>). Make it a child of the <strong><span class="ScreenTextPACKT">Panel</span></strong> object. Rename this slider as <strong><span class="ScreenTextPACKT">Slider-overall</span></strong>. <span>Set the slider's <span class="ScreenTextPACKT">Min Value</span> to</span> <kbd><span class="CodeInTextPACKT">0.000025</span></kbd> <span>(or <kbd><span class="ScreenTextPACKT">2.5e-05</span></kbd>).</span></li>
<li>Duplicate it and rename the new copy to <span class="ScreenTextPACKT">Slider-music</span>. In the <span class="ScreenTextPACKT"><strong>Inspecto</strong>r</span> panel, <strong><span class="ScreenTextPACKT">Rect Transform</span></strong> component, change its <span class="packt_screen"><span class="ScreenTextPACKT">Pos Y</span></span> parameter to <kbd><span class="CodeInTextPACKT">-40</span></kbd>.</li>
<li>Duplicate <span class="ScreenTextPACKT">Slider-music</span> and rename the new copy to <strong><span class="ScreenTextPACKT">Slider-fx</span></strong>. Change its <strong><span class="ScreenTextPACKT">Pos Y</span></strong> parameter to <kbd><span class="CodeInTextPACKT">-70</span></kbd>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/350f4d6a-fd4c-4b39-8456-96e54abbf58f.png" style="width:34.08em;height:11.33em;"/></div>
<ol start="24">
<li>Create a C# script class, <span class="CodeInTextPACKT"><strong>VolumeControl</strong>,</span> in the <span class="CodeInTextPACKT"><kbd>_Scripts</kbd> folder</span><span>, containing the following code, and add an instance as a scripted component to the <span class="ScreenTextPACKT"><strong>Main Camera</strong> GameObject</span>:</span></li>
</ol>
<pre style="padding-left: 60px">using UnityEngine; 
using UnityEngine.Audio; 
 
public class VolumeControl : MonoBehaviour { 
    public GameObject panel; 
   public AudioMixer myMixer; 
   private bool isPaused = false; 
 
   void Start(){ 
        panel.SetActive(false); 
 
        ON_CHANGE_OverallVol(0.01F); 
        ON_CHANGE_MusicVol(0.01F); 
        ON_CHANGE_FxVol(0.01F); 
   } 
 
   void Update() { 
         if (Input.GetKeyUp (KeyCode.Escape)) { 
               panel.SetActive(!panel.activeInHierarchy); 
 
               if(isPaused) 
                     Time.timeScale = 1.0f; 
               else 
                     Time.timeScale = 0.0f; 
 
               isPaused = !isPaused; 
         }            
   }      
 
    public void ON_CHANGE_OverallVol(float vol) { 
        myMixer.SetFloat("OverallVolume", Mathf.Log10(vol) * 20f); 
    } 
 
   public void ON_CHANGE_MusicVol(float vol) { 
         myMixer.SetFloat ("MusicVolume", Mathf.Log10(vol) * 20f); 
   } 
 
   public void ON_CHANGE_FxVol(float vol) { 
         myMixer.SetFloat ("FxVolume", Mathf.Log10(vol) * 20f); 
   } 
} </pre>
<ol start="25">
<li>With <strong><span class="ScreenTextPACKT">Main Camera</span></strong> selected in the <strong><span class="KeyWordPACKT">Hierarchy</span></strong> panel, drag the <span class="ScreenTextPACKT"><strong>Panel</strong> GameObject</span> into the <span class="KeyWordPACKT">Inspector</span> for the public <span class="ScreenTextPACKT">Panel</span> variable.</li>
<li>With <strong><span class="ScreenTextPACKT">Main Camera</span></strong> selected in the <strong><span class="KeyWordPACKT">Hierarchy</span></strong> panel, drag <strong><span class="ScreenTextPACKT">MainMixer</span></strong> from the Project panel into the <strong><span class="KeyWordPACKT">Inspector</span></strong> for the public <span class="ScreenTextPACKT">My Mixer</span> variable.</li>
<li>Select the <strong><span class="CodeInTextPACKT">OverallSlider</span></strong> <span>component. Below the <strong><span class="ScreenTextPACKT">On Value Changed</span></strong> list, click the <span class="ScreenTextPACKT">+</span> sign to add an action. From the <strong><span class="ScreenTextPACKT">Hierarchy</span></strong> panel, drag</span> <span class="KeyWordPACKT">Main Camera</span> <span>into the <span class="ScreenTextPACKT">Object</span> slot and</span> <span>using the drop-down menu, choose</span> <span class="packt_screen">VolumeControl</span> <span>| <span class="ScreenTextPACKT"><span class="packt_screen">ON_CHANGE_OverallVol</span></span> option.  For testing purposes, change the appropriate selector from <span class="ScreenTextPACKT">Runtime Only</span> to <span class="ScreenTextPACKT">Editor and Runtime</span>.</span></li>
<li>Repeat the previous step with <span class="ScreenTextPACKT">MusicSlider</span> and <span class="ScreenTextPACKT">FxSlider</span>, but this time, choose the <span class="ScreenTextPACKT"><span class="packt_screen">ON_CHANGE_MusicVol</span></span> and <span class="ScreenTextPACKT"><span class="packt_screen">ON_CHANGE_FxVol</span></span> options, respectively, from the drop-down menu.</li>
<li>Play the scene. You will be able to access the sliders when pressing <em><span class="KeyPACKT">ESCAPE</span></em> on your keyboard and adjust volume settings from there.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The <strong><span class="KeyWordPACKT">Audio Mixer</span></strong> feature works in a similar fashion to <strong>Digital Audio Workstations</strong>, such as <strong>Logic</strong> and <strong>Sonar</strong>. Through <span class="ScreenTextPACKT">Audio Mixers</span> you can organize and manage audio elements by routing them into specific groups that can have individual audio tracks you can tweak, allowing adjustments in volume level and sound effects.</p>
<p>By organizing and routing our audio clips into two groups (<span class="ScreenTextPACKT">Music</span> and <span class="ScreenTextPACKT">FX</span>), we established <span class="ScreenTextPACKT">MainMixer</span> as a unified controller for volume. Then, we used the <span class="ScreenTextPACKT">Audio Mixer</span> to expose the volume levels for each track of <strong><span class="ScreenTextPACKT">MainMixer</span></strong>, making them accessible to our script.</p>
<p class="mce-root"/>
<p>Also, we have set up a basic <span class="KeyWordPACKT">UI</span> featuring three sliders that, when in use, will pass their float values (between <span class="CodeInTextPACKT">0.000025</span> and <span class="CodeInTextPACKT">1</span>) as arguments to three specific functions in our script: <span class="packt_screen"><span class="CodeInTextPACKT">ON_CHANGE_MusicVol</span>, <span class="CodeInTextPACKT">ON_CHANGE_FxVol</span>, and <span class="CodeInTextPACKT">ON_CHANGE_OverallVol</span></span>. These functions, on their turn, use the <span class="CodeInTextPACKT">SetFloat</span> command to effectively change the volume levels at runtime. However, before passing on the new volume levels, the script converts linear values (between <span class="CodeInTextPACKT">0.000025</span> and <span class="CodeInTextPACKT">1</span>) to the decibel levels that are used by the <span class="ScreenTextPACKT">Audio Mixer</span>. This conversion is calculated through the <span class="ItalicsPACKT">log(x) * 20</span> mathematical function.</p>
<div class="packt_infobox">For a full explanation on issues regarding the conversion of linear values to decibel levels and vice-versa, check out Aaron Brown's excellent article at <span class="URLPACKT"><span><a href="http://www.playdotsound.com/portfolio-item/decibel-db-to-float-value-calculator-making-sense-of-linear-values-in-audio-tools/">http://www.playdotsound.com/portfolio-item/decibel-db-to-float-value-calculator-making-sense-of-linear-values-in-audio-tools/</a>.</span></span></div>
<p>If one of the sliders seems not to work, double-check that the name of the first parameter to <kbd><span class="CodeInTextPACKT">SetFloat(...)</span></kbd> matches the exposed parameter in the <strong>AudioMixer</strong> <span>–</span> any spelling difference will mean the on-change function will not change values in the <strong>Audio Mixer</strong>. For example, if the named exposed parameter was wrongly named "<strong><span class="CodeInTextPACKT">OveralVolume</span></strong>" (missing an "l"), this statement in response to a slider change would not work due to the spelling mismatch:</p>
<pre>myMixer.SetFloat ("OverallVolume ", Mathf.Log10(vol) * 20f); </pre>
<p>The <kbd><span class="CodeInTextPACKT">VolumeControl</span></kbd> script includes code to enable and disable the <span class="KeyWordPACKT">UI</span> and the <strong><span class="KeyWordPACKT">EventSystem</span></strong>, depending upon whether the player hits the <em><span class="KeyPACKT">ESCAPE</span></em> key to activate/deactivate the volume-control sliders.</p>
<div class="packt_infobox">Since our <span class="CodeInTextPACKT">VolumeControl</span> script sets the maximum volume level for the music and Fx tracks, you should not manually change any of the track volumes of the <span class="ScreenTextPACKT">MainMixer</span> at <span class="KeyWordPACKT">Design-Time</span>. For general adjustments, use the secondary <span class="ScreenTextPACKT">MusicMixer</span> and <span class="ScreenTextPACKT">FxMixer mixers</span>.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Here is some extra information on Audio Mixers.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Playing with Audio Production</h1>
                </header>
            
            <article>
                
<p>There are many creative uses for exposed parameters. We can, for instance, add effects such as <strong><span class="KeyWordPACKT">Distortion</span></strong>, <strong><span class="KeyWordPACKT">Flange</span></strong>, and <strong><span class="KeyWordPACKT">Chorus</span></strong> to audio channels, allowing users to operate virtual sound tables/mixing boards.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<p>The <em><span class="ItalicsPACKT">Making a dynamic soundtrack with Snapshots</span></em> recipe in this chapter.<br/>
The <em><span class="ItalicsPACKT">Balancing the in-game audio with Ducking</span></em> in this chapter.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Making a dynamic soundtrack with Snapshots</h1>
                </header>
            
            <article>
                
<p>Dynamic soundtracks are the ones that change according to what is happening to the player in the game, musically reflecting that place or moment of the character's adventure. In this recipe, we will implement a soundtrack that changes twice; the first time when entering a tunnel, and the second time when coming out of it. To achieve this, we will use the <strong><span class="ScreenTextPACKT">Snapshot</span></strong> feature of the <strong><span class="ScreenTextPACKT">Audio Mixer</span></strong>.</p>
<p>Snapshots are a way of saving the state of your <strong><span class="ScreenTextPACKT">Audio Mixer</span></strong>, keeping your preferences for volume levels, audio effects, and more. We can access these states through C# scripting, creating transitions between mixes, and by bringing up the desired sonic ambience for each moment of the player's journey.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, we have prepared a basic game level, contained inside the Unity package named <kbd><span class="CodeInTextPACKT">DynamicSoundtrack</span></kbd>, and two soundtrack audio clips in the <kbd><span class="CodeInTextPACKT">.ogg</span></kbd> format: <kbd><span class="CodeInTextPACKT">Theme01_Percussion</span></kbd> and <kbd><span class="CodeInTextPACKT">Theme01_Synths</span></kbd>. All these files can be found in the <kbd><span class="CodeInTextPACKT">04_11</span></kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To make a dynamic soundtrack, follow these steps:</p>
<ol>
<li>Create a new Unity 3D project.</li>
<li>Import the provided Unity package, <span class="CodeInTextPACKT"><span class="packt_screen">DynamicSoundtrack</span>,</span> and the two <kbd><span class="CodeInTextPACKT">.ogg</span></kbd> files into your project.</li>
<li>Open the <span class="ScreenTextPACKT"><span class="packt_screen">Dynamic</span></span> scene from <strong><span class="KeyWordPACKT">Project</span></strong> panel folder, <span class="ScreenTextPACKT"><span class="packt_screen">DynamicSoundtrack</span> | <span class="packt_screen">_Scenes</span>.</span></li>
<li>In the Project panel, use the <span class="ScreenTextPACKT"><span class="packt_screen">Create</span></span> menu to add an <span class="ScreenTextPACKT"><span class="packt_screen">Audio Mixer</span></span> file. Rename this new file <span class="ScreenTextPACKT">Mixer-music</span>. Double-click it to open the <span class="ScreenTextPACKT"><span class="packt_screen">Audio Mixer</span></span> panel.</li>
<li>In the the <span class="packt_screen"><span class="ScreenTextPACKT">Audio Mixer</span></span> panel <span class="ScreenTextPACKT"><span class="packt_screen">Groups</span></span> section, highlight <span class="ScreenTextPACKT"><span class="packt_screen">Master</span></span> and click the + (plus) sign to add a child to the <span class="ScreenTextPACKT"><span class="packt_screen">Master</span></span> group. Name this child <span class="ScreenTextPACKT"><span class="packt_screen">Percussion</span></span>. Repeat these actions to add a second child of <span class="ScreenTextPACKT"><span class="packt_screen">Master</span>,</span> named <span class="ScreenTextPACKT">Synths:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/ce937ba3-ebb4-43d9-b076-7c6734a3f936.png" style="width:35.25em;height:18.58em;"/></div>
<ol start="6">
<li>From the <strong><span class="ScreenTextPACKT">Hierarchy</span></strong> view, create a new <strong><span class="ScreenTextPACKT">Empty</span></strong> GameObject. Name it <span class="ScreenTextPACKT">Music</span>.</li>
<li>Create a GameObject in the scene containing an <strong><span class="KeyWordPACKT">AudioSource</span></strong> component linked to <span class="KeyWordPACKT">the</span> <span class="ScreenTextPACKT"><span class="packt_screen">Theme01_Percussion</span> <strong>AudioClip</strong></span>. This can be done in a single step by dragging the music clip from the <span class="KeyWordPACKT">Project</span> panel into either the <strong><span class="KeyWordPACKT">Hierarchy</span></strong> or <span class="KeyWordPACKT">Scene</span> panels. Child this new <span class="KeyWordPACKT">GameObject</span> to the <strong><span class="ScreenTextPACKT">Music</span></strong> <span class="KeyWordPACKT">GameObject</span> in the <strong><span class="KeyWordPACKT">Hierarchy</span></strong>.</li>
</ol>
<ol start="8">
<li>Ensure <span class="KeyWordPACKT">the</span> <span class="ScreenTextPACKT"><span class="packt_screen">Theme01_Percussion</span> GameObject</span> is selected in the <strong><span class="KeyWordPACKT">Hierarchy</span></strong>. In the Inspector for the <strong><span class="KeyWordPACKT">AudioSource</span></strong> <span>component, change its <span class="ScreenTextPACKT">Output</span> to <span class="ScreenTextPACKT">Percussion (<strong>MusicMixer</strong>)</span>, make sure the <strong><span class="ScreenTextPACKT">Play On Awake</span></strong> option is checked, check the <strong><span class="ScreenTextPACKT">Loop</span></strong> option, and make sure its <strong><span class="ScreenTextPACKT">Spatial Blend</span></strong> is set to <span class="ScreenTextPACKT">2D</span>:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/bc2c2792-bde9-4a45-a330-ca278dc289f1.png" style="width:35.17em;height:18.08em;"/></div>
<ol start="9">
<li>Repeat the previous two steps for <span class="KeyWordPACKT">the</span> <span class="ScreenTextPACKT"><span class="packt_screen">Theme01_Synths</span></span> <strong>AudioClip</strong> <span>–</span> setting the <strong><span class="ScreenTextPACKT">Output</span></strong> <span>to <span class="ScreenTextPACKT">Synths (<strong>MusicMixer</strong>)</span>.</span></li>
<li>Open the <strong><span class="ScreenTextPACKT">Audio Mixer</span></strong> and play the scene. We will now use the mixer to set the soundtrack for the start of the scene. With the scene playing, click on the <span class="ScreenTextPACKT"><strong>Edit</strong> in Play Mode</span> button, as shown in the screenshot, at the top of the <strong><span class="ScreenTextPACKT">Audio Mixer</span></strong>. Drop the volume on the <strong><span class="ScreenTextPACKT">Synths</span></strong> track down to <strong><span class="ScreenTextPACKT">-30 dB</span></strong>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/fa270b68-b74b-450d-80ab-68824bd8e401.png"/></div>
<ol start="11">
<li>Select the <span class="ScreenTextPACKT">Percussion</span> track. Click the <span class="ScreenTextPACKT"><span class="packt_screen">Add..</span></span> button for <strong><span class="ScreenTextPACKT">Attenuation</span></strong>, and add a <strong><span class="ScreenTextPACKT">High-pass</span></strong> effect. From the <strong><span class="ScreenTextPACKT">Inspector</span></strong> view, change the <span class="ScreenTextPACKT"><strong>Cutoff</strong> frequency</span> of the <strong><span class="ScreenTextPACKT">High-pass</span></strong> effect to <strong><span class="ScreenTextPACKT">544.00 Hz</span></strong>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/c15d7736-a7f2-466f-ab6c-3146f255afd3.png" style="width:36.08em;height:21.75em;"/></div>
<ol start="12">
<li><span>Every c</span><span>hange, so far, has been assigned to the current <span class="ScreenTextPACKT">Snapshot</span>. From the <span class="ScreenTextPACKT">Snaphots</span> view, right-click on the current <span class="ScreenTextPACKT">Snapshot</span> and rename it to <span class="ScreenTextPACKT">Start</span>. C</span>lick the + (plus) sign to make a copy of the current <span>snapshot, rename this copy <span class="ScreenTextPACKT">Tunnel</span>:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/7adeff53-424e-4a1d-8e8f-e1d64ea92857.png" style="width:12.67em;height:12.58em;"/></div>
<ol start="13">
<li>Select the <strong><span class="ScreenTextPACKT">Tunnel</span></strong> snapshot and select the <strong><span class="ScreenTextPACKT">High-pass</span></strong> effect of the <span class="ScreenTextPACKT"><span class="packt_screen">Percussion</span></span> group. In the <span class="packt_screen">Inspector</span><span class="ScreenTextPACKT">,</span> set property <strong><span class="ScreenTextPACKT">Cutoff frequency</span></strong> of <span class="ScreenTextPACKT"><strong>10.00</strong> Hz:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/0b25d80c-50cc-4fe4-bc07-db9ae098fe53.png" style="width:35.58em;height:18.83em;"/></div>
<ol start="14">
<li>Switch between the <strong><span class="ScreenTextPACKT">Tunnel</span></strong> and <span class="ScreenTextPACKT">Start</span> snapshots. You'll be able to hear the difference.</li>
<li>Duplicate the <strong><span class="ScreenTextPACKT">Tunnel</span></strong> snapshot, rename it <strong><span class="ScreenTextPACKT">OtherSide</span></strong>, and select it.</li>
<li>Raise the volume of the <strong><span class="ScreenTextPACKT">Synths</span></strong> track up to <span class="ScreenTextPACKT">0 dB.</span></li>
<li>Now that we have our three <strong><span class="ScreenTextPACKT">Snapshots</span></strong>, it's time to create triggers to make transitions among them.</li>
<li>Stop running the scene (so changes to the <strong>Hierarchy</strong> will be stored in the scene).</li>
<li>In the <span class="KeyWordPACKT"><strong>Hierarchy</strong>,</span> create a <strong><span class="ScreenTextPACKT">Cube</span></strong> GameObject (menu: <strong><span class="ScreenTextPACKT">Create</span></strong> | <strong><span class="ScreenTextPACKT">3D Object</span></strong> | <strong><span class="ScreenTextPACKT">Cube</span></strong>). Name it <span class="ScreenTextPACKT"><span class="packt_screen">Cube-tunnel-trigger</span></span>.</li>
<li>In the <span class="ScreenTextPACKT">Inspector,</span> access the <span class="ScreenTextPACKT">Cube-tunnel-trigger GameObject</span>'s <span class="ScreenTextPACKT">Box Collider</span> component and check the <strong><span class="ScreenTextPACKT">Is Trigger</span></strong> option. Uncheck its <strong><span class="ScreenTextPACKT">Mesh Renderer</span></strong> component. Adjust its size and position to the scene tunnel's interior. You may find Scene Wireframe view useful for the cube collider positioning:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/a23204bd-a7d1-470e-ad44-2a000deabb13.png" style="width:45.33em;height:18.42em;"/></div>
<ol start="21">
<li>Make two copies of cube <span class="ScreenTextPACKT"><span class="packt_screen">Cube-tunnel-trigger</span></span> and rename them to cube <span class="ScreenTextPACKT"><span class="packt_screen">Cube-start-trigger</span></span> and cube <span class="ScreenTextPACKT"><span class="packt_screen">Cube-otherside-trigger</span></span>. Adjust their size and position, so that they occupy the areas before the tunnel's entrance (where the character is) and after its exit:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/98f42182-da98-42a3-b7e3-181c33041b26.png"/></div>
<ol start="22">
<li>Create a C# script class, <kbd>SnapshotTrigger</kbd><span class="CodeInTextPACKT">,</span> in the <span class="CodeInTextPACKT"><span class="packt_screen">_Scripts folder</span></span>, containing the following code:</li>
</ol>
<pre style="padding-left: 60px">using UnityEngine; 
using UnityEngine.Audio; 
 
public class SnapshotTrigger : MonoBehaviour { 
   public AudioMixerSnapshot snapshot; 
   public float crossfade; 
 
   private void OnTriggerEnter(Collider other) { 
         snapshot.TransitionTo (crossfade); 
   } 
} </pre>
<ol start="23">
<li>Add an instance of <kbd><span class="CodeInTextPACKT">SnapshotTrigger</span></kbd> to all three trigger cubes (<span class="ScreenTextPACKT"><span class="packt_screen">Cube-tunnel-trigger</span></span>, <span class="ScreenTextPACKT"><span class="packt_screen">Cube-start-trigger</span>,</span> and <span class="ScreenTextPACKT"><span class="packt_screen">Cube-otherside-trigger</span></span>).</li>
<li>Select <span class="ScreenTextPACKT"><span class="packt_screen">Cube-tunnel-trigger</span></span>. From the <strong><span class="ScreenTextPACKT">Inspector</span></strong> for the <span class="packt_screen"><span class="ScreenTextPACKT">Snapshot Trigger (Script)</span></span> component, set <span class="ScreenTextPACKT">Snapshot</span> to <strong><span class="ScreenTextPACKT">Tunnel</span></strong>, and <strong><span class="ScreenTextPACKT">Crossfade</span></strong> as <span class="CodeInTextPACKT">2:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/9ab0df2e-e1ac-44f5-bf68-3f45524941ef.png" style="width:34.83em;height:23.67em;"/></div>
<ol start="25">
<li>Make changes to <strong><span class="ScreenTextPACKT">Cube-start-trigger</span></strong> and <span class="ScreenTextPACKT"><strong>Cube-otherside-trigger</strong></span> by setting their <strong><span class="ScreenTextPACKT">Snapshots</span></strong> to <strong><span class="ScreenTextPACKT">Start</span></strong> and <span class="ScreenTextPACKT"><strong>OtherSide</strong>,</span> respectively <span>–</span> also with <strong><span class="ScreenTextPACKT">Crossfade</span></strong> as <span class="CodeInTextPACKT"><kbd>2</kbd>.</span></li>
<li>Test the scene. The background music will change as the character moves from the starting point, through the tunnel, and out the other side.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The <span class="ScreenTextPACKT">Snapshot</span> feature allows you to save <strong><span class="ScreenTextPACKT">Audio Mixer</span></strong> states (including all volume levels and every filter setting) so that you can change those mixing preferences at <strong><span class="KeyWordPACKT">Run-Time</span></strong>, making the audio design more suitable for specific locations or gameplay settings. For this recipe, we have created three <strong><span class="ScreenTextPACKT">Snapshots</span></strong> for different moments in the player's journey:</p>
<ul>
<li><span>B</span>efore entering the tunnel</li>
<li><span>I</span>nside the tunnel</li>
<li>Outside the tunnel</li>
</ul>
<p>We have used the <strong><span class="ScreenTextPACKT">Highpass</span></strong> filter to make the initial <strong>Snapshot</strong> less intense. We have also turned the <span class="ScreenTextPACKT">Synths</span> track volume up to emphasize the open environment outside the tunnel. Our aim is for the changes in the audio mix to help set the right mood for the game.</p>
<p><span>To activate our snapshots, we have placed <span class="ScreenTextPACKT"><strong>trigger</strong> colliders</span>, featuring our <strong><span class="ScreenTextPACKT">Snapshot Trigger</span></strong> scripted component in which we set the desired Snapshot and the time in seconds, that it takes to make the transition (a crossfade) between the previous Snapshot and the next. In fact, the function in</span> our script is really this straightforward <span>–</span> the line of <kbd><span class="CodeInTextPACKT">snapshot.TransitionTo</span> <span class="CodeInTextPACKT">(crossfade)</span></kbd> code simply starts a transition lasting <kbd><span class="CodeInTextPACKT">crossfade</span></kbd> seconds to the desired <span class="CodeInTextPACKT">Snapshot</span>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Here is some information on how to fine-tune and customize this recipe.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Reducing the need for multiple audio clips</h1>
                </header>
            
            <article>
                
<p>You might have noticed how different the <kbd><span class="CodeInTextPACKT">Theme01_Percussion</span></kbd> audio clip sounds when the <span class="ScreenTextPACKT"><strong>Cutoff frequency</strong></span> of the <strong><span class="ScreenTextPACKT">High-pass</span></strong> filter is set as <kbd><span class="CodeInTextPACKT">10.00</span> <span class="CodeInTextPACKT">Hz</span></kbd>. This is because the high-pass filter, as its name suggests, cuts off lower frequencies of the audio signal. In this case, it attenuated the bass drum down to inaudible levels while keeping the shakers audible. The opposite effect can be achieved through the <strong><span class="ScreenTextPACKT">Lowpass</span></strong> filter. A major benefit is<br/>
the opportunity to have two separate tracks in the same audio clip.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Dealing with audio file formats and compression rates</h1>
                </header>
            
            <article>
                
<p>To avoid a loss of audio quality, you should import your sound clips using the appropriate file format, depending upon your target platform. If you are not sure which format to use, check out Unity's documentation on the subject at <span class="URLPACKT"><span><a href="http://docs.unity3d.com/Manual/AudioFiles.html">http://docs.unity3d.com/Manual/AudioFiles.html</a>.</span></span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Applying Snapshots to background noise</h1>
                </header>
            
            <article>
                
<p>Although we have applied Snapshots to our music soundtrack, background noise can also benefit immensely. If your character travels across places that are significantly different, transitioning from open spaces to indoor environments, you should consider applying snapshots to your environment audio mix. Be careful, however, to create separate <strong><span class="KeyWordPACKT">Audio Mixers</span></strong> for Music and Environment <span>–</span> unless you don't mind having musical and ambient<br/>
sound tied to the same <span class="KeyWordPACKT">Snapshot</span>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting creative with effects</h1>
                </header>
            
            <article>
                
<p>In this recipe, we have mentioned the <span class="packt_screen"><span class="ScreenTextPACKT">High-pass</span> and <span class="ScreenTextPACKT">Low-pass</span></span> filters. However, there are many effects that can make audio clips sound radically different. Experiment! Try applying effects such as <span class="ScreenTextPACKT"><span class="packt_screen">Distortion</span></span>, <span class="ScreenTextPACKT"><span class="packt_screen">Flange</span></span>, and <span class="ScreenTextPACKT"><span class="packt_screen">Chorus</span></span>. In fact, we encourage you to try every effect, playing with their settings. The creative use of these effects can bring out different expressions to a single audio clip.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<p>The <em><span class="ItalicsPACKT">Adding volume control with Audio Mixers</span></em> recipe in this chapter.</p>
<p>The <em><span class="ItalicsPACKT">Balancin</span><span class="ItalicsPACKT">g soundtrack volume with Ducking</span></em> recipe in this chapter.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Balancing in-game audio with Ducking</h1>
                </header>
            
            <article>
                
<p>As much as the background music can be important in establishing the right atmosphere, there will be times when other audio clips should be emphasized, and the music volume turned down for the duration of that clip. This effect is known as <strong><span class="KeyWordPACKT">Ducking</span></strong>. Maybe you will need it for dramatic effect (simulating hearing loss after an explosion took place), or maybe you want to make sure that the player listens to a specific bit of information presented as an audio speed sound clip. In this recipe, we will learn how to emphasize a piece of dialog by ducking the audio whenever a specific sound message is played. For that effect, we will use the <strong><span class="KeyWordPACKT">Audio Mixer</span></strong> to send information between tracks.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, we have provided the <kbd><span class="CodeInTextPACKT">soundtrack.mp3</span></kbd> audio clip and a Unity package named <span class="CodeInTextPACKT">Ducking.unitypackage</span>, containing an initial scene. All these files are available inside the <kbd><span class="CodeInTextPACKT">04_12</span></kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To apply Audio Ducking to your soundtrack, follow these steps:</p>
<ol>
<li>Create a new <strong>Unity 3D</strong> project.</li>
<li>Import the provided <strong>Unity</strong> package,<strong> </strong><span class="CodeInTextPACKT"><strong>Ducking</strong>,</span> and the <kbd><span class="CodeInTextPACKT">soundtrack.mp3</span></kbd> file into your project.</li>
<li>Open the <span class="ScreenTextPACKT">Ducking</span> scene from <strong><span class="KeyWordPACKT">Project</span></strong> panel folder, <strong><span class="ScreenTextPACKT">Ducking</span></strong> | <kbd><span class="ScreenTextPACKT">_Scenes</span></kbd>.</li>
<li>Enter <span class="KeyWordPACKT">Run-Time</span> by playing the scene and walk toward the semitransparent green wall in the tunnel, using the <em><span class="KeyPACKT">W, A, S,</span></em> <span class="KeyPACKT">and</span> <em><span class="KeyPACKT">D</span></em> keys (by pressing <em><span class="KeyPACKT">Shift</span></em> to run). You will hear the <span class="ScreenTextPACKT">robotDucking</span> speech audio clip play as the character collides with the green wall ("This your captain speaking ..."). Then stop the scene playing to return to <span class="KeyWordPACKT">Design-Time</span>.</li>
<li>Create a <strong>GameObject</strong> in the scene containing an <strong><span class="KeyWordPACKT">AudioSource</span></strong> component linked to <span class="KeyWordPACKT">the</span> <span class="ScreenTextPACKT">soundtrack <strong>AudioClip</strong></span>. This can be done in a single step by dragging the music clip from the <span class="KeyWordPACKT"><strong>Project</strong></span> panel into either the <strong><span class="KeyWordPACKT">Hierarchy</span></strong> or <strong><span class="KeyWordPACKT">Scene</span></strong> panels.</li>
</ol>
<ol start="6">
<li>Ensure the GameObject <span class="ScreenTextPACKT">soundtrack</span> is selected in the <strong><span class="KeyWordPACKT">Hierarchy</span></strong>. In the <strong><span class="KeyWordPACKT">Inspector</span></strong> for the <strong><span class="KeyWordPACKT">Audio Source</span></strong> <span>component, make sure the <span class="ScreenTextPACKT">Play On Awake</span> option is checked, check the <span class="ScreenTextPACKT">Loop</span> option, and make sure its <strong><span class="ScreenTextPACKT">Spatial Blend</span></strong> is set to <span class="ScreenTextPACKT">2D</span> (if necessary, see screenshot in the previous recipe for same action on the percussion GameObject</span>).</li>
<li>Play the scene again. The soundtrack music should be playing. Then stop the scene playing to return to <strong><span class="KeyWordPACKT">Design-Time</span></strong>.</li>
<li>In the <strong><span class="KeyWordPACKT">Project</span></strong> panel, use the <strong><span class="ScreenTextPACKT">Create</span></strong> menu to add an <strong><span class="ScreenTextPACKT">Audio Mixer</span></strong> file. Rename this new file <strong><span class="ScreenTextPACKT">MainMixer</span></strong>.</li>
<li>Double-click <strong><span class="ScreenTextPACKT">MainMixer</span></strong> to open the <strong><span class="ScreenTextPACKT">Audio Mixer</span></strong> panel.</li>
<li>In the the <strong><span class="ScreenTextPACKT">Audio Mixer</span></strong> panel <span class="ScreenTextPACKT">Groups</span> section, highlight <strong><span class="ScreenTextPACKT">Master</span></strong> and click the + (plus) sign to add a child to the <strong><span class="ScreenTextPACKT">Master</span></strong> group. Name this child <span class="ScreenTextPACKT">Music</span>. Repeat these actions to add a second child of <span class="ScreenTextPACKT">Master,</span> named <span class="ScreenTextPACKT">FX.</span> <span>Add a third child to the <strong><span class="ScreenTextPACKT">Master</span></strong> group, named <span class="ScreenTextPACKT">Input</span></span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/51d8ac5b-84a1-4b63-b141-44ca6296f723.png" style="width:13.25em;height:19.67em;"/></div>
<ol start="11">
<li>In the Audio <span class="ScreenTextPACKT">Mixe</span><span class="ScreenTextPACKT">rs</span> view, add a new <strong><span class="KeyWordPACKT">Mixer</span></strong> by clicking the <span class="packt_screen"><span class="ScreenTextPACKT">+</span></span> (plus) sign to add a new <strong><span class="ScreenTextPACKT">Mixer</span></strong> to the project. Name it <strong><span class="ScreenTextPACKT">MusicMixer</span></strong>. Drag it into the <strong><span class="ScreenTextPACKT">MainMixer</span></strong> (to become its child) and select the <span class="ScreenTextPACKT"><span class="packt_screen">Music</span></span> group as its <span class="ScreenTextPACKT">Output:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/68ad76d8-b80d-4153-b6f2-d8c360d9e46e.png" style="width:16.50em;height:14.25em;"/></div>
<ol start="12">
<li>Repeat the previous step to add another child of <span class="ScreenTextPACKT"><strong>MainMixer</strong>,</span> named <span class="ScreenTextPACKT"><strong>FxMixer</strong>,</span> to the project, selecting the <span class="ScreenTextPACKT">FX</span> group as the output.</li>
<li>Select <strong><span class="ScreenTextPACKT">MusicMixer</span></strong>. Select its <strong><span class="ScreenTextPACKT">Master</span></strong> group and add a child named <span class="ScreenTextPACKT"><kbd>Soundtrack</kbd>:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/2cd38a48-a015-46ba-a2d4-2acdf2c61858.png" style="width:37.17em;height:24.42em;"/></div>
<ol start="14">
<li>Select <strong><span class="ScreenTextPACKT">FxMi</span><span class="ScreenTextPACKT">xer</span></strong> and add a child named <strong><span class="ScreenTextPACKT">Bells</span></strong>.</li>
</ol>
<ol start="15">
<li>From the <strong><span class="ScreenTextPACKT">Hierarchy</span></strong> view, select the <strong><span class="ScreenTextPACKT">DialogueTrigger</span> GameObject</strong>. In the <span class="ScreenTextPACKT"><strong>Inspector</strong>, </span>change the <span class="ScreenTextPACKT">Output</span> track to <strong><span class="ScreenTextPACKT">MainMixer</span></strong> | <span class="ScreenTextPACKT"><strong>Input</strong>, for the <strong>Audio Source</strong><span> component:</span></span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/865c010c-bab9-49db-9a42-17ca978e8453.png" style="width:28.42em;height:30.33em;"/></div>
<ol start="16">
<li>Select the <strong><span class="ScreenTextPACKT">Soundtrac</span><span class="ScreenTextPACKT">k</span></strong> GameObject. In the <strong><span class="ScreenTextPACKT">Inspector</span></strong> for the <strong><span class="ScreenTextPACKT">Audio</span></strong> <span class="ScreenTextPACKT"><strong>Sourc</strong>e</span> component, change its <span class="ScreenTextPACKT">Output</span> track to <strong><span class="ScreenTextPACKT">MusicMixer</span></strong> | <strong><span class="ScreenTextPACKT">Soundtrack</span></strong>.</li>
</ol>
<ol start="17">
<li>From the <span class="ScreenTextPACKT"><strong>Ducking</strong> | <strong>Prefabs</strong></span> folder in the <span class="ScreenTextPACKT">Project</span> panel, select the <span class="ScreenTextPACKT">Signal</span> prefab. In the <span class="ScreenTextPACKT">Inspector,</span> set its <strong><span class="ScreenTextPACKT">Audio Source</span></strong> component <strong><span class="ScreenTextPACKT">Output</span></strong> to <strong><span class="ScreenTextPACKT">FxMixer</span></strong> | <strong><span class="ScreenTextPACKT">Bells</span></strong>.</li>
<li>Open the <strong><span class="ScreenTextPACKT">Audio Mixer</span></strong> window. Choose <strong><span class="ScreenTextPACKT">MainMixer</span></strong>, select the <span class="ScreenTextPACKT">Music</span> track controller, right-click on <strong><span class="ScreenTextPACKT">Attenuation</span></strong>, and using the context menu, add the <strong><span class="ScreenTextPACKT">Duck Volume</span></strong> effect:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/25a69c10-a7ae-4764-8e71-4ce0aeae78da.png" style="width:30.67em;height:21.50em;"/></div>
<ol start="19">
<li>Select the <span class="packt_screen"><span class="ScreenTextPACKT">In</span><span class="ScreenTextPACKT">put</span></span> track, right-click on <strong><span class="ScreenTextPACKT">Attenuation</span></strong>, and using the context menu, add <strong><span class="ScreenTextPACKT">Send</span></strong>.</li>
<li>With the <span class="ScreenTextPACKT"><span class="packt_screen">Input</span></span> track still selected, go to the <strong><span class="ScreenTextPACKT">Inspector</span></strong> view and change the <span class="ScreenTextPACKT">Receive</span> setting in <strong><span class="ScreenTextPACKT">Send</span></strong> to <span class="ScreenTextPACKT"><strong>Music\Duck</strong> Volume</span> and its <strong><span class="ScreenTextPACKT">Send</span></strong> level to <span class="CodeInTextPACKT">0.00</span> <span class="CodeInTextPACKT">db.</span></li>
</ol>
<ol start="21">
<li>Select the <strong><span class="ScreenTextPACKT">Music</span></strong> track. From the <span class="ScreenTextPACKT">Inspector</span> view, change the settings on the <strong><span class="ScreenTextPACKT">Duck Volume</span></strong> as follows: <strong><span class="ScreenTextPACKT">Threshold</span></strong>: <kbd>-</kbd><span class="CodeInTextPACKT"><kbd>40.00 db</kbd>,</span> <strong><span class="ScreenTextPACKT">Ratio</span></strong>: <span class="CodeInTextPACKT"><kbd>300.00%</kbd>,</span> <span class="ScreenTextPACKT"><strong>Attack</strong> <strong>Time</strong></span>: <span class="CodeInTextPACKT"><kbd>100.00 ms</kbd>,</span> <strong><span class="ScreenTextPACKT">Release Time</span></strong>: <kbd><span class="CodeInTextPACKT">200.00 ms</span></kbd>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/3a0ca160-25e9-43c5-a513-b028d1bf447c.png" style="width:31.00em;height:23.08em;"/></div>
<ol start="22">
<li>Test the scene again. Entering the trigger object will cause the soundtrack volume to drop considerably, recovering the original volume in two seconds.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>In this recipe, we have created, in addition to <span class="ScreenTextPACKT">Music</span> and <span class="ScreenTextPACKT">Sound FX</span><span>, a group named <span class="ScreenTextPACKT">Input</span>, to which we</span> <span>have routed the audio clip that triggers the <span class="ScreenTextPACKT">Duck Volume</span> effect attached to our music track. The <span class="ScreenTextPACKT">Duck Volume</span> effect changes the track's volume whenever it receives an input that is louder than indicated in its <span class="ScreenTextPACKT">Threshold</span> setting. In our case, we have sent the <span class="ScreenTextPACKT">Input</span> track as input, and adjusted the settings so the volume will be reduced as soon as 0.1 seconds after the input had been received, turning back to its original value of 2 seconds after the input has ceased. The amount of volume reduction was determined by our <span class="ScreenTextPACKT">Ratio</span> of <span class="ScreenTextPACKT">300.00%</span>. Playing around with the setting values will give you a better idea of how each parameter affects the final result. Also, make sure to visualize the graphic as the trigger sound is played. You will be able to see how the <span class="ScreenTextPACKT">Input</span> sound passes the threshold, triggering the effect.</span></p>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<div class="packt_infobox">The tracks are organized so that the other sound clips (other than speech) will not affect the volume of the music <span>–</span> but every music clip will be affected by audio clips sent to the input track.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<p>The <em><span class="ItalicsPACKT">Adding volume control with Audio Mixers</span></em> recipe in this chapter.</p>
<p>The <em><span class="ItalicsPACKT">Making a dynamic soundtrack with Snapshots</span></em> recipe in this chapter.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Audio visualization from sample spectral data</h1>
                </header>
            
            <article>
                
<p>The Unity audio systems allows us to access the music data <span>–</span> via the <kbd><span class="CodeInTextPACKT">AudioSource.GetSpectrumData(...)</span></kbd> method. This gives us the opportunity to use that data to present <span class="KeyWordPACKT">Run-Time</span> visualization of the overall sound being heard (from the <strong><span class="KeyWordPACKT">AudioListener</span></strong>), or the individual sound being played by individual <strong><span class="KeyWordPACKT">AudioSources</span></strong>.</p>
<p>The screenshot shows lines drawn using a sample script provided by Unity (<a href="https://docs.unity3d.com/ScriptReference/AudioSource.GetSpectrumData.html"><span class="URLPACKT">https://docs.unity3d.com/ScriptReference/AudioSource.GetSpectrumData.html</span></a>):</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/09aa10c3-5f54-420d-a202-25edf5fcf4a6.png" style="width:23.92em;height:11.42em;"/></div>
<p>However, in that sample code, their use of <span class="CodeInTextPACKT"><kbd>Debug.DrawLine()</kbd></span> only appears in the <span class="KeyWordPACKT">Scene</span> panel when running the game in the Unity Editor (not for final builds), and so cannot be seen by the game player. In this recipe, we'll take that same spectral data, and use it to create a <strong><span class="KeyWordPACKT">Run-Time</span></strong> audio spectral visualization in the Game panel. We'll do this by creating a row of 512 small cubes, and then changing their heights each frame based on 512 audio data samples for the playing <strong><span class="KeyWordPACKT">AudioSource</span></strong> component.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, we have provided several 140 bmp sampled free music clips inside the <kbd>04_13</kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To schedule a sound to play after a given delay, do the following:</p>
<ol>
<li>Create a new 3D project and import the provided sound clip files.</li>
<li>In the <span class="ScreenTextPACKT"><span class="packt_screen">Inspector</span>,</span> set the <span class="ScreenTextPACKT">Background</span> of the <span class="ScreenTextPACKT"><span class="packt_screen">Main Camera</span></span> to black.</li>
<li>Set the <span class="packt_screen">Main Camera Transform Position</span> to (224, 50, -200).</li>
<li>Set the <span class="packt_screen">Main Camera</span> <span class="packt_screen">Camera</span> component to have these settings: <span class="packt_screen"><span class="ScreenTextPACKT">Projection = Perspective, Field of View 60,</span> and <span class="ScreenTextPACKT">Clipping Planes 0.3 - 300</span></span>.</li>
<li>Add <strong><span class="KeyWordPACKT">DirectionalLight</span></strong> to the scene.</li>
<li>Add a new empty <span class="KeyWordPACKT">GameObject</span> named <span class="ScreenTextPACKT">visualizer</span> to the scene. Add an <strong><span class="KeyWordPACKT">AudioSource</span></strong> component to this <span class="KeyWordPACKT">GameObject</span>, and set its <strong><span class="KeyWordPACKT">AudioClip</span></strong> to one of the 140 bmp loops provided.</li>
<li>Create a C# script class, <span class="CodeInTextPACKT"><strong>SpectrumCubes</strong>,</span> in a new folder, <span class="CodeInTextPACKT">_Scripts</span><span>, containing the following code, and add an instance as a scripted component to the visualizer GameObject:</span></li>
</ol>
<pre style="padding-left: 60px">using UnityEngine; 
 
public class SpectrumCubes : MonoBehaviour  
{ 
    const int NUM_SAMPLES = 512; 
    public Color displayColor; 
    public float multiplier = 5000; 
    public float startY; 
    public float maxHeight = 50; 
    private AudioSource audioSource; 
    private float[] spectrum = new float[NUM_SAMPLES]; 
    private GameObject[] cubes = new GameObject[NUM_SAMPLES]; 
 
    void Awake() { 
        audioSource = GetComponent&lt;AudioSource&gt;(); 
        CreateCubes(); 
    } 
 
    void Update() { 
        audioSource.GetSpectrumData(spectrum, 0, FFTWindow.BlackmanHarris); 
        UpdateCubeHeights(); 
    } 
 
    private void UpdateCubeHeights() { 
        for (int i = 0; i &lt; NUM_SAMPLES; i++) 
        { 
            Vector3 oldScale = cubes[i].transform.localScale; 
            Vector3 scaler = new Vector3(oldScale.x, HeightFromSample(spectrum[i]), oldScale.z); 
            cubes[i].transform.localScale = scaler; 
            Vector3 oldPosition = cubes[i].transform.position; 
            float newY = startY + cubes[i].transform.localScale.y / 2; 
            Vector3 newPosition = new Vector3(oldPosition.x, newY, oldPosition.z); 
            cubes[i].transform.position = newPosition; 
        } 
    } 
 
    private float HeightFromSample(float sample) { 
        float height = 2 + (sample * multiplier); 
        return Mathf.Clamp(height, 0, maxHeight); 
    } 
 
    private void CreateCubes() { 
        for (int i = 0; i &lt; NUM_SAMPLES; i++) { 
            GameObject cube = GameObject.CreatePrimitive(PrimitiveType.Cube); 
            cube.transform.parent = transform; 
            cube.name = "SampleCube" + i; 
 
            Renderer cubeRenderer = cube.GetComponent&lt;Renderer&gt;(); 
            cubeRenderer.material = new Material(Shader.Find("Specular")); 
            cubeRenderer.sharedMaterial.color = displayColor; 
 
            float x = 0.9f * i; 
            float y = startY; 
            float z = 0; 
            cube.transform.position = new Vector3(x, y, z); 
 
            cubes[i] = cube; 
        } 
    } 
 
} </pre>
<ol start="8">
<li>With the <span class="ScreenTextPACKT">visualizer</span> GameObject selected in the <span class="KeyWordPACKT"><strong>Hierarchy</strong>,</span> click to choose a visualization color from the <strong><span class="KeyWordPACKT">Inspector</span> <span class="ScreenTextPACKT">Display Color</span></strong> public variable for the <span class="ScreenTextPACKT"><strong>SpectrumCubes</strong> (Script)</span> component.</li>
<li>Run the scene <span>–</span> you should see the cubes jump up and down, presenting a Run-Time visualization of the sound data spectrum for the playing sound.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>You created a C# script class, <kbd><span class="CodeInTextPACKT">SpectrumCubes</span></kbd>. You created a <span class="KeyWordPACKT">GameObject</span> with an <strong>AudioSource</strong> component, and an instance of your scripted class. All the work is done by the methods in the <kbd>SpectrumCues</kbd> C# script class, so each of these is explained in the following sections.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The void Awake() method</h1>
                </header>
            
            <article>
                
<p>This method caches references to the sibling <strong>AudioSource</strong> component, and then invokes the <span class="CodeInTextPACKT"><kbd>CreateCubes()</kbd> method</span>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The void CreateCubes() method</h1>
                </header>
            
            <article>
                
<p>This method loops for the number of samples (default is 512), to create a 3D Cube GameObject, in a row along the X-axis. Each Cube is created with the name "<span class="CodeInTextPACKT">Cube&lt;i&gt;</span>" (where "i" is from 0 to 511) and then parented to the visualizer <span>GameObject (since the scripted method is running in this GameObject). Each cube then has the color of its renderer set to the value of the public</span> <span class="CodeInTextPACKT">displayColor</span> parameter. The cube is then positioned on the X-axis according to the loop number, at the value of the public <span class="CodeInTextPACKT">startY</span> parameter (so multiple visualizations can be at different parts of the screen), and Z = 0. Finally, a reference to the new cube GameObject is stored in the <span class="CodeInTextPACKT">cubes[] array.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The void Update() method</h1>
                </header>
            
            <article>
                
<p>Each frame in this method updates the values inside the <span class="CodeInTextPACKT">spectrum[]</span> array through a call to <kbd><span class="CodeInTextPACKT">GetSpectrumData(...)</span></kbd>. In our example, the <kbd><span class="CodeInTextPACKT">FFTWindow.BlackmanHarris</span></kbd> frequency window technique is used. Then the <kbd><span class="CodeInTextPACKT">UpdateCubeHeights()</span></kbd> method is invoked.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The void UpdateCubeHeights() method</h1>
                </header>
            
            <article>
                
<p>This method loops for each cube to set its height to a scaled value of its corresponding audio data value in the <span class="CodeInTextPACKT"><kbd>spectrum[]</kbd> array</span>. The cube has its Y-value scaled by the value returned by the <span class="CodeInTextPACKT"><kbd>HeightFromSample(spectrum[i])</kbd> method</span>. The cube is then moved up (its transform position is set) from the value of <kbd><span class="CodeInTextPACKT">startY</span></kbd> by half its height <span>–</span> so that all the scaling appears upwards (rather than up and down) <span>–</span> this is to have a flat line along the base of our spectrum of cubes.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The float HeightFromSample(float) method</h1>
                </header>
            
            <article>
                
<p><span><span>M</span></span>ethod  <kbd>HeightFromSample(float)</kbd> does a simple calculation (<span class="CodeInTextPACKT">sample</span> value times public parameter <span class="CodeInTextPACKT">multiplier</span>), plus minimum value of two added to it. The value returned from the function is this result, limited to the maxHeight public parameter (via the <kbd><span class="CodeInTextPACKT">Mathf.Clamp(...)</span></kbd> method).</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>There are some details that you don't want to miss.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding visualizations to a second AudioSource</h1>
                </header>
            
            <article>
                
<p>The script has been written to be easy to have multiple visualizations in a scene. So to create a second visualizer for a second <strong><span class="KeyWordPACKT">AudioClip</span></strong> in the scene, do the following:</p>
<ol>
<li>Duplicate the <span class="packt_screen">visualizer</span> <span class="KeyWordPACKT">GameObject</span>.</li>
<li>Drag a different <span class="KeyWordPACKT">AudioClip</span> from the <strong><span class="KeyWordPACKT">Project</span></strong> panel into the <strong><span class="KeyWordPACKT">Audio Source</span></strong> component of your new <span class="KeyWordPACKT">GameObject</span>.</li>
</ol>
<ol start="3">
<li>Set the Start <strong>Y</strong> public parameter in the <strong>Inspector</strong> to 60 (so the new row of cubes will be above the original row).</li>
<li>In the <span class="KeyWordPACKT"><strong>Inspector</strong>,</span> choose a different <span class="ScreenTextPACKT"><span class="packt_screen">Display Color</span></span> public variable for the <strong><span class="ScreenTextPACKT">SpectrumCubes (Script)</span></strong> component:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/987f9d56-391c-4727-aa15-b530eaaa2ad9.png" style="width:28.08em;height:19.00em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Try out different FFT (Fast Fourier Transform) window types</h1>
                </header>
            
            <article>
                
<p>There are several different approaches to frequency analysis of audio data, our recipe currently uses the <kbd><span class="CodeInTextPACKT">FFTWindow.BlackmanHarris</span></kbd> version. Learn (and try out!) some of the others from the Unity <kbd>FFTWindow</kbd> documentation page: <a href="https://docs.unity3d.com/ScriptReference/FFTWindow.html"><span class="URLPACKT">https://docs.unity3d.com/ScriptReference/FFTWindow.html</span></a>.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Synchronizing simultaneous and sequential music to create a simple 140 bpm music-loop manager</h1>
                </header>
            
            <article>
                
<p>The <em><span class="ItalicsPACKT">Creating a metronome through the precise scheduling of sounds with</span></em> <kbd>dspTime</kbd> recipe demonstrated how to create a metronome by scheduling when sounds play using the <span class="CodeInTextPACKT"><kbd>AudioSource.PlayScheduled(...)</kbd> method </span>and the <kbd><span class="CodeInTextPACKT">AudioSettings.dspTime</span></kbd> value. Another situation when we need to precisely schedule audio start times is to ensure a smooth transition from one music track to another, or to ensure simultaneous music tracks play in time together.</p>
<p>In this recipe, we'll create a simple 4-track 140 bpm music manager that starts playing a new sound after a fixed time <span>–</span> the result of which is that the tracks fit together perfectly, and those that overlap do so in synchronicity:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/47e24a71-b907-4ddf-9aab-99df2b36f208.png" style="width:22.83em;height:2.00em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, we have provided several 140 bmp sampled free music clips inside the <kbd>04_14</kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To create a music-loop manager, do the following:</p>
<ol>
<li>Create a new Unity 3D project and import the provided sound clip files.</li>
<li>Create four GameObjects in the scene containing an <strong><span class="KeyWordPACKT">AudioSource</span></strong> component linked to different <strong><span class="KeyWordPACKT">AudioClip</span></strong> loops from the 140 bpm files provided. This can be done in a single step by dragging the music clip from the <strong><span class="KeyWordPACKT">Project</span></strong> panel into either the <strong><span class="KeyWordPACKT">Hierarchy</span></strong> or <span class="KeyWordPACKT">Scene</span> panels.</li>
</ol>
<ol start="3">
<li>In the <span class="KeyWordPACKT">Inspector,</span> uncheck the <strong><span class="ScreenTextPACKT">Play On Awake</span></strong> parameter for all four <strong>AudioSource</strong> components (so they don't start playing until we tell them to).</li>
<li>Add a new empty <strong><span class="KeyWordPACKT">GameObject</span></strong> named <strong><span class="ScreenTextPACKT">musicScheduler</span></strong> to the scene.</li>
<li>Create a C# script class, <span class="CodeInTextPACKT"><strong>LoopScheduler</strong>,</span> in a new folder, <kbd><span class="CodeInTextPACKT">_Scripts</span></kbd><span>, containing the following code, and add an instance as a scripted component to the <span class="ScreenTextPACKT"><strong>musicScheduler</strong> GameObject</span>:</span></li>
</ol>
<pre style="padding-left: 60px">using UnityEngine; 
 
public class LoopScheduler : MonoBehaviour { 
    public float bpm = 140.0F; 
    public int numBeatsPerSegment = 16; 
    public AudioSource[] audioSources = new AudioSource[4]; 
    private double nextEventTime; 
    private int nextLoopIndex = 0; 
    private int numLoops; 
    private float numSecondsPerMinute = 60F; 
    private float timeBetweenPlays; 
 
    void Start() { 
        numLoops = audioSources.Length; 
timeBetweenPlays = numSecondsPerMinute / bpm * numBeatsPerSegment; 
        nextEventTime = AudioSettings.dspTime; 
    } 
 
    void Update() { 
        double lookAhead = AudioSettings.dspTime + 1.0F; 
        if (lookAhead &gt; nextEventTime) 
            StartNextLoop(); 
 
        PrintLoopPlayingStatus(); 
    } 
 
    private void StartNextLoop() { 
        audioSources[nextLoopIndex].PlayScheduled(nextEventTime); 
        nextEventTime += timeBetweenPlays; 
 
        nextLoopIndex++; 
        if (nextLoopIndex &gt;= numLoops) 
            nextLoopIndex = 0; 
    } 
 
    private void PrintLoopPlayingStatus(){ 
        string statusMessage = "Sounds playing: "; 
        int i = 0; 
 
        while (i &lt; numLoops) { 
            statusMessage += audioSources[i].isPlaying + " "; 
            i++; 
        } 
 
        print(statusMessage); 
    } 
} </pre>
<ol start="6">
<li>With <span class="KeyWordPACKT">the</span> <strong><span class="ScreenTextPACKT">mus</span><span class="ScreenTextPACKT">icScheduler</span></strong> GameObject selected in the <span class="KeyWordPACKT"><strong>Hierarchy</strong>,</span> drag each of the music loop GameObjects into the four available slots for the <strong><span class="KeyWordPACKT">AudioSources</span></strong> public array variable in the <strong><span class="ScreenTextPACKT">Loop Scheduler</span> <span class="ScreenTextPACKT">(Script)</span></strong> component:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/7718015b-b831-4215-8b4f-8173a251bdea.png" style="width:33.92em;height:21.08em;"/></div>
<ol start="7">
<li>Run the scene <span>–</span> each clips should start in turn after the same time delay. If you chose one or two longer clips, they will continue playing while the next clip begins <span>–</span> all overlapping perfectly since they are all 140 bpm sound clips.</li>
</ol>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>You added four <span class="KeyWordPACKT"><strong>GameObjects</strong> to the scene</span>, containing <strong><span class="KeyWordPACKT">AudioSources</span></strong> linked to 140 bpm music clips. You created a C# script class, <span class="CodeInTextPACKT"><kbd>LoopScheduler</kbd>,</span> and added an instance to an empty <strong><span class="KeyWordPACKT">GameObject</span></strong>. You associated the four <strong><span class="KeyWordPACKT">AudioSources</span></strong> in your <strong><span class="KeyWordPACKT">GameObjects</span></strong> with the four slots in the public <strong><span class="KeyWordPACKT">AudioSource</span></strong> array variable in your scripted component.</p>
<p>The numbers of music clips you use can easily be changed by changing the size of the public array variable.</p>
<p>The <kbd><span class="CodeInTextPACKT">Start()</span></kbd> method counts the length of the array to set the <span class="CodeInTextPACKT"><kbd>numLoops</kbd> variable</span>. It then calculates the number of seconds to delay before starting each clip (this is fixed according to the beats-per-minute and beats-per-measure). Finally, it sets the current time to be the time to start the first loop.</p>
<p>The <kbd><span class="CodeInTextPACKT">Update()</span></kbd> method decides whether it's time to schedule the next loop, by testing whether the current time plus a 1-second look-ahead, is past the time to start the next loop. If so, the <kbd><span class="CodeInTextPACKT">StartNextLoop()</span></kbd> method is invoked. Regardless of whether we have started the next loop, the <kbd><span class="CodeInTextPACKT">PrintLoopPlayingStatus()</span></kbd> method to display to the user which loops are playing or not is printed to the Console.</p>
<p>The <kbd><span class="CodeInTextPACKT">PrintLoopPlayingStatus()</span></kbd> method loops for each <strong>AudioSource</strong> reference in the array, creating a string of <span class="ScreenTextPACKT">trues</span> and <span class="ScreenTextPACKT">falses</span> to be then printed out.</p>
<p>The <kbd><span class="CodeInTextPACKT">StartNextLoop()</span></kbd> method sends a <kbd><span class="CodeInTextPACKT">PlayScheduled(...)</span></kbd> message to the next <kbd><span class="KeyWordPACKT">AudioSource</span></kbd> to be played, passing the <kbd><span class="CodeInTextPACKT">nextEventTime</span></kbd> value. It then adds the time between plays for the next event time. The next value of the loop index is then calculated (add one, if past the end of the array, then reset to 0 again).</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>There are some details that you don't want to miss.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding visualizations to the four playing loops</h1>
                </header>
            
            <article>
                
<p>It's great fun to watch the visualization of the loop sounds as they play together. To add visualizations to the four AudioSources, all you have to do is:</p>
<ol>
<li>Import the <strong>SpectrumCubes.cs</strong> C# script file from the previous recipe into this project.</li>
<li>Set the <span class="ScreenTextPACKT"><span class="packt_screen">Main Camera Transform Position</span></span> to <span class="ScreenTextPACKT">(<span class="packt_screen">224, 50, -200</span>)</span>.</li>
<li>Set the <strong>Main Camera Camera component</strong> to have these settings: <span class="ScreenTextPACKT">Projection = Perspective, Field of View 60,</span> and <span class="ScreenTextPACKT">Clipping Planes 0.3 - 300</span>.</li>
<li>Add a <strong><span class="ScreenTextPACKT">Directional Light</span> <span class="KeyWordPACKT">GameObject</span></strong> to the scene.</li>
<li>For each of the four <span class="KeyWordPACKT"><strong>GameObjects</strong></span> containing your <strong><span class="KeyWordPACKT">AudioSources</span></strong>, add an instance of the <span class="ScreenTextPACKT"><strong>SpectrumCubes</strong> script class</span>.</li>
<li>In the <strong><span class="ScreenTextPACKT">Inspector</span></strong> for the <strong><span class="ScreenTextPACKT">Spectrum Cubes (Script)</span></strong> component, change the <span class="ScreenTextPACKT"><span class="packt_screen">displayColors</span></span> for each <strong><span class="KeyWordPACKT">AudioSource</span> <span class="KeyWordPACKT">GameObject</span></strong>.</li>
<li>Set the startY values of <span class="packt_screen"><span class="ScreenTextPACKT">Spectrum Cubes (Script)</span></span> components for the four <strong><span class="ScreenTextPACKT">GameObjects</span></strong> to be -50, 0, 50, 100. For most screen sizes, this should allow you too see all four visualization spectrums:</li>
</ol>


            </article>

            
        </section>
    </body></html>