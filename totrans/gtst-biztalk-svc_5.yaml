- en: Chapter 5. Business-to-business Integration
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第5章 商业对商业集成
- en: A transaction between two companies in a buyer-seller relationship is business-to-business
    (B2B) as opposed to a B2C relationship between a company and its consumer. In
    the context of integration, B2B is about two organizations agreeing on a set of
    well-defined transactions for the exchange of business information. The B2B process
    starts off with a business negotiation or an agreement, which further translates
    into the technical details at the message flow level.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在买卖关系的两个公司之间的交易是商业对商业（B2B），而不是公司与消费者之间的B2C关系。在集成的背景下，B2B是关于两个组织就一系列定义良好的交易达成一致，以交换商业信息。B2B过程从商业谈判或协议开始，这进一步转化为消息流层面的技术细节。
- en: 'In this chapter, we will focus on the following topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将重点关注以下主题：
- en: Understanding B2B integration in the context of Azure
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在Azure的背景下理解B2B集成
- en: Understanding the capabilities of the service with partner, agreement, batching,
    and tracking
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解与合作伙伴、协议、批处理和跟踪相关的服务能力
- en: Walkthrough of a real-world B2B scenario using BizTalk Services on Azure
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Azure上的BizTalk服务进行真实世界B2B场景的演练
- en: Basic concepts of B2B
  id: totrans-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: B2B基本概念
- en: 'Consider a retailer, Contoso, who wishes to procure stock from a supplier,
    Northwind. From a technology standpoint, the message flow between Contoso and
    Northwind can be explained using the following flow:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑一个零售商Contoso，他希望从供应商Northwind那里采购库存。从技术角度来看，Contoso和Northwind之间的消息流可以用以下流程来解释：
- en: Contoso and Northwind agree to enter into a business relationship (usually over
    phone/e-mail/meetings). The legal teams draft the memorandum of understanding
    (MoU) between the partners.
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Contoso和Northwind同意建立商业关系（通常通过电话/电子邮件/会议）。双方的法律团队起草合作伙伴之间的谅解备忘录（MoU）。
- en: The partners exchange information on how one would receive/send payments, including
    cheque and bank details.
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 合作伙伴交换有关如何接收/发送付款的信息，包括支票和银行详情。
- en: Both partners enter a setup phase where each of their IT departments configures
    the B2B system to enable the exchange of electronic data interchange (EDI).
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 双方合作伙伴进入一个设置阶段，其中每个IT部门都配置B2B系统以启用电子数据交换（EDI）的交换。
- en: Both partners exchange sample test messages to validate the configuration, and
    after sufficient testing, they agree to move ahead with production.
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 双方交换样本测试消息以验证配置，并在充分测试后，他们同意进入生产阶段。
- en: 'In production, the following steps are carried out:'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在生产中，执行以下步骤：
- en: Contoso raises a purchase order from their Dynamics AX ERP system and sends
    it to Northwind
  id: totrans-13
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Contoso从他们的Dynamics AX ERP系统中发起采购订单并将其发送给Northwind
- en: Northwind receives the order and acknowledges that they have received the order
  id: totrans-14
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Northwind收到订单并确认已收到订单
- en: Northwind processes the order and looks up the inventory in their SAP ERP to
    determine whether they can service the request
  id: totrans-15
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Northwind处理订单并在他们的SAP ERP系统中查找库存，以确定他们是否可以满足请求
- en: If the order can be serviced, Northwind send the goods to a third-party logistics
    company (3PL) who handles the shipment of goods
  id: totrans-16
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果订单可以服务，Northwind将货物发送给第三方物流公司（3PL），该公司负责货物的运输
- en: Northwind replies with the shipment details to Contoso
  id: totrans-17
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Northwind向Contoso回复运输详情
- en: Contoso can optionally acknowledge the receipt of the shipment notice
  id: totrans-18
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Contoso可以选择确认收货通知
- en: Northwind sends an invoice to Contoso for the cost of goods sold
  id: totrans-19
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Northwind向Contoso发送发票，以收取销售商品的成本
- en: Contoso sends payment to Northwind based on the financial terms agreed upon.
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根据双方商定的财务条款，Contoso向Northwind支付款项。
- en: 'The preceding flow can be visually represented as follows:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 上述流程可以如下直观表示：
- en: '![Basic concepts of B2B](img/7401EN_05_01.jpg)'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
  zh: '![B2B基本概念](img/7401EN_05_01.jpg)'
- en: Each of the arrows in the preceding diagram represents a set of messages exchanged
    between Contoso and Northwind. Each message type is identified by a document name
    or transaction set (for example, PO/X12 850) and has a defined format based on
    the protocol used. The protocol, in addition to the structure of the message,
    governs the set of messages exchanged back and forth. In the preceding example,
    we can write the first transaction as "Contoso raises an EDI X12 purchase order
    (850) to Northwind". Here, X12 is the EDI format and 850 is the purchase order
    message type.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 前一图中的每个箭头代表Contoso和Northwind之间交换的一组消息。每种消息类型由一个文档名称或事务集（例如，PO/X12 850）标识，并基于所使用的协议具有定义的格式。除了消息的结构外，协议还规定了来回交换的消息集。在前面的例子中，我们可以将第一个交易写为“Contoso向Northwind提出EDI
    X12采购订单（850）”。在这里，X12是EDI格式，850是采购订单消息类型。
- en: Common interaction models
  id: totrans-24
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 常见交互模型
- en: There are two common ways to integrate trading partners for B2B. They are listed
    as follows.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: B2B集成交易伙伴有两种常见方式。如下列出。
- en: Direct enterprise integration
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 直接企业集成
- en: In this model, both trading partner organizations have in-house IT and can directly
    transact EDI messages. There are systems in place to send and receive EDI transactions
    over point-to-point protocols without any mediator or middleman.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 在此模型中，两个交易伙伴组织都有内部IT，可以直接进行EDI消息交易。有系统用于通过点对点协议发送和接收EDI交易，无需任何中介或中间人。
- en: Service provider integration
  id: totrans-28
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 服务提供商集成
- en: In this model, one of the trading partners is a small-to-medium business player
    who cannot afford in-house IT. In order to facilitate EDI interactions, there
    is a middleman, or the EDI service provider, who acts as a liaison between the
    two partners. The service provider talks about EDI to a trading partner on one
    end and transacts non-EDI (such as XLS/XML) with the other trading partner. The
    service provider charges a fee based on transaction size/volume or the complexity
    of the protocols used.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 在此模型中，一个交易伙伴是一个无法承担内部IT服务的小到中型企业玩家。为了促进EDI交互，存在一个中间人，或称EDI服务提供商，作为两个合作伙伴之间的联络人。服务提供商向一端的交易伙伴介绍EDI，并与另一端的交易伙伴进行非EDI（如XLS/XML）交易。服务提供商根据交易规模/数量或协议的复杂性收取费用。
- en: '**Value Added Networks** (**VANs**) are specialized networks offering end-to-end
    B2B services in a service provider integration. VANs manage the hosting of servers
    and software to process EDI traffic and usually charge based on message volume.
    They could specialize solutions for a particular vertical or offer generic message
    processing services.'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '**增值网络**（**VANs**）是提供端到端B2B服务的专业网络，在服务提供商集成中发挥作用。VANs管理服务器的托管和软件以处理EDI流量，通常根据消息量收费。它们可以为特定垂直领域提供专业解决方案或提供通用消息处理服务。'
- en: Industry standards and protocols
  id: totrans-31
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 行业标准和协议
- en: Various organizations define protocols for different industry verticals. Each
    protocol governs the set of messages exchanged, the acknowledgements transferred,
    and the error behavior between trading partners.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 不同的组织为不同的行业垂直领域定义协议。每个协议都规定了交易伙伴之间交换的消息集、传输的确认和错误行为。
- en: 'The following are some of the most common protocols and their standards organization
    supported in BizTalk today:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一些BizTalk今天支持的最常见的协议及其支持的标准组织：
- en: '| Standards body | Website | Protocol | Industries |'
  id: totrans-34
  prefs: []
  type: TYPE_TB
  zh: '| 标准机构 | 网站 | 协议 | 行业 |'
- en: '| --- | --- | --- | --- |'
  id: totrans-35
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- |'
- en: '| ANSI ASC X12 | [http://www.x12.org/](http://www.x12.org/) | X12 | In the
    US: manufacturing, retail, government, and transportation |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '| ANSI ASC X12 | [http://www.x12.org/](http://www.x12.org/) | X12 | 在美国：制造业，零售业，政府和交通
    |'
- en: '|  |  | HIPAA | Healthcare, insurance |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
  zh: '|  |  | HIPAA | 医疗保健，保险 |'
- en: '| UN/CEFACT | [http://www.unece.org/cefact/edifact](http://www.unece.org/cefact/edifact)[http://www.gefeg.com/jswg/](http://www.gefeg.com/jswg/)
    | UN/ EDIFACT | In Europe: manufacturing, retail, government, and transportation
    |'
  id: totrans-38
  prefs: []
  type: TYPE_TB
  zh: '| UN/CEFACT | [http://www.unece.org/cefact/edifact](http://www.unece.org/cefact/edifact)[http://www.gefeg.com/jswg/](http://www.gefeg.com/jswg/)
    | UN/ EDIFACT | 在欧洲：制造业，零售业，政府和交通 |'
- en: '| SWIFT | [http://www.swift.com](http://www.swift.com) | SWIFT | Financial
    transactions for treasury, trade, and banking |'
  id: totrans-39
  prefs: []
  type: TYPE_TB
  zh: '| SWIFT | [http://www.swift.com](http://www.swift.com) | SWIFT | 财务，贸易和银行交易
    |'
- en: '| RosettaNet | [http://www.rosettanet.org/](http://www.rosettanet.org/) | RosettaNet
    | Supply chain |'
  id: totrans-40
  prefs: []
  type: TYPE_TB
  zh: '| RosettaNet | [http://www.rosettanet.org/](http://www.rosettanet.org/) | RosettaNet
    | 供应链 |'
- en: '| OAGi | [http://www.oagi.org](http://www.oagi.org) | CIDX | Horizontal framework
    for several verticals |'
  id: totrans-41
  prefs: []
  type: TYPE_TB
- en: '| PIDX | [http://www.pidx.org/](http://www.pidx.org/) | PIDX | Oil and Natural
    Gas |'
  id: totrans-42
  prefs: []
  type: TYPE_TB
- en: '| HL7 | [http://www.hl7.org/](http://www.hl7.org/) | HL7 | Healthcare |'
  id: totrans-43
  prefs: []
  type: TYPE_TB
- en: X12 is heavily used in the US, while EDIFACT is more popular in Europe and Asian
    countries. Both these protocols are supported in BizTalk Services today. The remaining
    protocols are available in BizTalk Server.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: Concepts in BizTalk Services B2B
  id: totrans-45
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: B2B in BizTalk Services is all about processing EDI and non-EDI messages between
    trading partners. It is meant to make B2B integration simple, powerful, and flexible
    using Azure. B2B, by its nature of protocols, formats, and transport, tends to
    be complex in configuration; with Azure, service configuration of an agreement
    between partners is simple. It's easy to extend the service and connect with other
    technologies such as SharePoint and mobile services to build a rich and powerful
    solution.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: 'The top-level concepts in B2B/EDI include the following:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
- en: EDI message structure
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Partners and agreements
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Property promotion in EDI
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Batching
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Tracking and archiving
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Extensibility and object model API
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: EDI message structure
  id: totrans-54
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'EDI messages (either X12 or EDIFACT) have a nested structure, compartmentalizing
    transactions for ease of understanding by the receiver. Every structure has a
    header and trailer to identify the start and end of the nested structure. The
    following outlines the nesting structure:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
- en: '**Interchange**: This is the outermost envelope with a header and trailer.
    It identifies the sender and receiver of the message as well as the date/time
    when the message was sent. In the case of X12, the ISA and IEA are the header
    and trailer respectively; in EDIFACT, the UNB and UNZ form the header and trailer.'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Group**: A group segment in an interchange is a set of transactions clubbed
    together by their function. A group starts with a header (GS in X12 and UNG in
    EDIFACT) and ends with a trailer (GE in X12 and UNE in EDIFACT). Unlike X12, groups
    are optional in EDIFACT; but when groups are present, they must contain all transactions
    of the same type (for example, all purchase orders).'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Transaction set**: A transaction set in a group is the message of a given
    type (for example, a purchase order message) with segments detailing transactions
    such as item quantity or price. A transaction set starts with a header (ST in
    X12 and UNH in EDIFACT) and ends with a trailer (SE in X12 and UNT in EDIFACT).'
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The following table illustrates the X12 and EDIFACT headers and trailers:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
- en: '| X12 header and trailer | EDIFACT header and trailer |'
  id: totrans-60
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  id: totrans-61
  prefs: []
  type: TYPE_TB
- en: '| ISA Interchange Control Header | UNA Optional Advice |'
  id: totrans-62
  prefs: []
  type: TYPE_TB
- en: '| GS Functional Group Header | UNB Interchange Control Header |'
  id: totrans-63
  prefs: []
  type: TYPE_TB
- en: '| ST Transaction Set Header | UNG Functional Group Header |'
  id: totrans-64
  prefs: []
  type: TYPE_TB
- en: '| SE Transaction Set Trailer | UNH Message Header |'
  id: totrans-65
  prefs: []
  type: TYPE_TB
- en: '| GE Functional Group Trailer | UNT Message Trailer |'
  id: totrans-66
  prefs: []
  type: TYPE_TB
- en: '| IEA Interchange Control Trailer | UNE Functional Group Trailer |'
  id: totrans-67
  prefs: []
  type: TYPE_TB
  zh: '| IEA 交换控制尾 | UNE 功能组尾 |'
- en: '|   | UNZ Interchange Control Trailer |'
  id: totrans-68
  prefs: []
  type: TYPE_TB
  zh: '|   | UNZ 交换控制尾 |'
- en: Partners and agreements
  id: totrans-69
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '**合作伙伴和协议**'
- en: 'The following are the key concepts used with agreements:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在协议中使用的关键概念如下：
- en: '**Partner**: A partner is an organization with which a trading relationship
    is established. Each partner has one or more business units referred to as **business
    profiles**. Every business profile has an identifier (for example, a DUNS ID or
    phone number) that is unique and added to each message exchanged between the partners.'
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**合作伙伴**：合作伙伴是与之建立贸易关系的组织。每个合作伙伴有一个或多个称为**业务配置文件**的业务单元。每个业务配置文件都有一个标识符（例如，DUNS
    ID或电话号码），它是唯一的，并添加到合作伙伴之间交换的每条消息中。'
- en: '**Agreement**: An agreement represents the technical settings of message exchange
    between partners. An agreement is established between two business profiles of
    partners. The agreement is composed of send settings (send of Contoso, receive
    of Northwind) and receive settings (receive of Contoso and send of Northwind)
    in the trading partner relationship. An agreement refers to a protocol such as
    AS2, X12, EDIFACT, and so on, based on messaging requirements. An agreement also
    identifies the schemas and requirements around tracking and batching. Deployment
    of the agreement results in two bridge deployments and, therefore, endpoints in
    Azure that can receive EDI messages and send XML and vice versa. The agreement
    definition in the BizTalk Portal has the following:'
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**协议**：协议表示合作伙伴之间消息交换的技术设置。协议是在合作伙伴的两个业务配置文件之间建立的。协议由发送设置（Contoso的发送，Northwind的接收）和接收设置（Contoso的接收和Northwind的发送）组成，这些设置在贸易伙伴关系中。协议基于消息要求引用一个协议，如AS2、X12、EDIFACT等。协议还确定了跟踪和批处理周围的模式和需求。协议的部署导致两个网桥部署，因此，Azure中的端点可以接收EDI消息并发送XML，反之亦然。BizTalk门户中的协议定义具有以下内容：'
- en: '**Transport**: This is the send side or the receive side transport of the bridges.'
  id: totrans-73
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**传输**：这是网桥的发送端或接收端传输。'
- en: '**Protocol**: This is the EDI protocol under use in the bridge.'
  id: totrans-74
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**协议**：这是网桥中使用的EDI协议。'
- en: '**Transform**: These are the maps used while a message is processed in the
    bridge.'
  id: totrans-75
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**转换**：这些是在消息在网桥中处理时使用的映射。'
- en: '**Route**: This is the target destination where the bridge will route the message
    to the recipient of the message.'
  id: totrans-76
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**路由**：这是网桥将消息路由到消息接收者的目标目的地。'
- en: '**Inbound URI**: This is the address of the send side bridge which receives
    messages to be sent to the destination partner.'
  id: totrans-77
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**入站URI**：这是接收要发送到目标合作伙伴的消息的发送端网桥的地址。'
- en: '**Suspend endpoint**: This is the endpoint which would process the message
    if there are errors in the processing of the EDI message. This endpoint can be
    used to build repair-resubmit scenarios.'
  id: totrans-78
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**挂起端点**：这是在处理EDI消息时出现错误时将处理消息的端点。此端点可用于构建修复-重新提交场景。'
- en: '**Partnership**: At least one agreement between partners constitutes a partnership
    between the partners. The concept of partnership is exposed only through the trading
    partner management API.'
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**伙伴关系**：至少有一个协议在合作伙伴之间构成伙伴关系。伙伴关系的概念仅通过贸易伙伴管理API公开。'
- en: '**Agreement template**: An agreement template is a unit of re-use where commonly
    repeated settings can be captured as a template and applied while defining an
    agreement for rapid configuration. An agreement template is associated with a
    profile. Each template definition identifies the hosted partner in the definition
    to determine the direction of settings to be applied while creating an agreement.'
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**协议模板**：协议模板是一个可重用单元，其中可以捕获常用设置作为模板，并在定义协议时应用，以实现快速配置。协议模板与配置文件相关联。每个模板定义都确定了在定义中指定的托管合作伙伴，以确定在创建协议时应用设置的方向。'
- en: '**AS2 agreement**: AS2 agreement refers to the AS2 transport settings agreed
    between two partners adhering to the RFC 4130 standard. In a nutshell, AS2 allows
    messages and acknowledgements to be transmitted in compressed, signed, or encrypted
    form over HTTP or HTTPS. Signing and encryption is supported using certificates.
    AS2 is not specific to the payload and can be used for both B2B flat files and
    EAI XML messages.'
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**AS2协议**：AS2协议是指两个遵守RFC 4130标准的合作伙伴之间同意的AS2传输设置。简而言之，AS2允许以压缩、签名或加密的形式通过HTTP或HTTPS传输消息和确认。使用证书支持签名和加密。AS2不特定于有效负载，可用于B2B平面文件和EAI
    XML消息。'
- en: Note
  id: totrans-82
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**注意**'
- en: 'If the endpoints of one partner, say Partner A, require HTTPS for AS2 traffic,
    then Partner A''s deployment certificate needs to be added to the "Trusted People"
    certificate store of Partner B. Alternately, if the AS2 messaging from Partner
    A is to an HTTPS endpoint of Partner B, then Partner B''s public certificate needs
    to be added to the certificate store of Partner A''s deployment. Both these certificates
    need to be uploaded to the BizTalk Services deployment certificate store using
    `PSCmdlet` loaded from BizTalk Services Tools. Here is the sample code to add
    the certificate using PowerShell:'
  id: totrans-83
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-84
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: If self-signed certificates are generated by using `makecert.exe`, ensure that
    you pass the `–pe` and `–key` exchange parameters to the command to make the certificate
    exportable and usable for encryption purposes.
  id: totrans-85
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '**X12 and EDIFACT agreement**: Both X12 and EDIFACT are supported on BizTalk
    Services. The choice of the agreement is available through a combobox selection
    during agreement creation. For each application protocol, the agreement settings
    consist of a series of schema selection, acknowledgement configuration, control
    number configuration, batching, character sets and separators configuration, and
    configuration of message validation.'
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Property promotion
  id: totrans-87
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Certain properties in the EDI envelopes we discussed earlier are autopromoted
    and are available for use in routing and tracking scenarios. They can also be
    used to determine the agreement endpoints programmatically.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
- en: 'Listed in the following tables are the promoted properties in EDI and AS2:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
- en: '| Property | Location | Description |'
  id: totrans-90
  prefs: []
  type: TYPE_TB
- en: '| --- | --- | --- |'
  id: totrans-91
  prefs: []
  type: TYPE_TB
- en: '| Message Type | X12 Receive | Numeric value identifies type of message, for
    example, 850 PO, 810 Invoice |'
  id: totrans-92
  prefs: []
  type: TYPE_TB
- en: '| AgreementName | X12 Receive | Name of the agreement |'
  id: totrans-93
  prefs: []
  type: TYPE_TB
- en: '| ISA 5-8ISA 9, 10, 12, 15 | X12 Receive | X12 ISA envelopes |'
  id: totrans-94
  prefs: []
  type: TYPE_TB
- en: '| GS01-08 | X12 Receive | X12 GS envelopes |'
  id: totrans-95
  prefs: []
  type: TYPE_TB
- en: '| ST01 | X12 Receive | X12 transaction set message type |'
  id: totrans-96
  prefs: []
  type: TYPE_TB
- en: '| ST03 | X12 Receive | X12 transaction set version |'
  id: totrans-97
  prefs: []
  type: TYPE_TB
- en: '| AS2-To, AS2-Version, Mime-Version, AS2-From | AS2 Send/Receive | AS2 header
    properties |'
  id: totrans-98
  prefs: []
  type: TYPE_TB
- en: '| Content-ID, Content-Type, Content-Transfer-Encoding |   |   |'
  id: totrans-99
  prefs: []
  type: TYPE_TB
- en: '| Disposition-Notification-To, Disposition-Notification-Options |   |   |'
  id: totrans-100
  prefs: []
  type: TYPE_TB
- en: '| Content-Description, Content-Disposition, Receipt-Delivery-Option |   |  
    |'
  id: totrans-101
  prefs: []
  type: TYPE_TB
- en: '| SystemRequestID | X12 Send, X12 Receive, AS2 Receive | ID to track the message
    flow in the bridge |'
  id: totrans-102
  prefs: []
  type: TYPE_TB
- en: '| MessageReceivedTime | X12 Send, X12 Receive, AS2 Receive | Date and time
    of incoming message |'
  id: totrans-103
  prefs: []
  type: TYPE_TB
- en: '| SourceType | X12 Send, X12 Receive, AS2 Receive | FTP, HTTP, or AS2 per configuration
    |'
  id: totrans-104
  prefs: []
  type: TYPE_TB
- en: '| SourceName | X12 Send, X12 Receive, AS2 Receive | The name configured for
    source; this is an autogenerated name in EDI agreements |'
  id: totrans-105
  prefs: []
  type: TYPE_TB
- en: '| AgreementID | X12 Send, X12 Receive, AS2 Receive | Agreement ID as displayed
    in the agreements list view in the BizTalk portal |'
  id: totrans-106
  prefs: []
  type: TYPE_TB
- en: '| UNA_Segment | EDIFACT Receive | UNA Segment with characters as separators
    and indicators |'
  id: totrans-107
  prefs: []
  type: TYPE_TB
- en: '| UNB_Segment | EDIFACT Receive | Interchange header segment |'
  id: totrans-108
  prefs: []
  type: TYPE_TB
- en: '| UNB2_1 | EDIFACT Receive | Sender Identification |'
  id: totrans-109
  prefs: []
  type: TYPE_TB
- en: '| UNB2_2 | EDIFACT Receive | Sender Code qualifier |'
  id: totrans-110
  prefs: []
  type: TYPE_TB
- en: '| UNB2_3 | EDIFACT Receive | Sender Reverse Routing address |'
  id: totrans-111
  prefs: []
  type: TYPE_TB
- en: '| UNB3_1 | EDIFACT Receive | Receiver Identification |'
  id: totrans-112
  prefs: []
  type: TYPE_TB
- en: '| UNB3_2 | EDIFACT Receive | Receiver Code qualifier |'
  id: totrans-113
  prefs: []
  type: TYPE_TB
- en: '| UNB11 | EDIFACT Receive | Test indicator |'
  id: totrans-114
  prefs: []
  type: TYPE_TB
- en: '| UNG_Segment | EDIFACT Receive | Functional group header segment |'
  id: totrans-115
  prefs: []
  type: TYPE_TB
- en: '| UNG1 | EDIFACT Receive | Functional group identifier |'
  id: totrans-116
  prefs: []
  type: TYPE_TB
- en: '| UNG2_1 | EDIFACT Receive | Group Application Sender Identifier |'
  id: totrans-117
  prefs: []
  type: TYPE_TB
- en: '| UNG3_1 | EDIFACT Receive | Group Application Receiver Identifier |'
  id: totrans-118
  prefs: []
  type: TYPE_TB
- en: '| UNH2_1 | EDIFACT Receive | Message type identifier |'
  id: totrans-119
  prefs: []
  type: TYPE_TB
- en: '| UNH2_2 | EDIFACT Receive | Message type version number |'
  id: totrans-120
  prefs: []
  type: TYPE_TB
- en: '| UNH2_3 | EDIFACT Receive | Message type release number |'
  id: totrans-121
  prefs: []
  type: TYPE_TB
- en: Note
  id: totrans-122
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: AS2 Send is sending the message to the partner; hence, the properties are not
    usable directly. In the case of X12 Send, we can route the message to a blob store
    or Service Bus queue and base our action on the properties promoted.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
- en: Batching
  id: totrans-124
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Batching is a concept where messages are accumulated based on selection criteria
    and released once the desired event known as the release criteria is met. Customers
    use batching of messages to aggregate messages for reasons of cost, compatibility,
    and convenience. In the early days of VAN, messages were charged on size and customers
    were optimized by sending batches of messages. An example of this is airlines
    charging the same for all containers, whether they contain 2000 kg or 5000 kg.
    It makes sense for freight forwarders to batch requests from multiple shipments
    into a single container to save costs. Few mainframe systems of trading partners
    cannot accept messages more than 250 KB. It is important to break messages such
    as these to sizes less than or equal to 250 KB before sending them to the target
    system.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
- en: As part of BizTalk Services B2B, customers can configure and manage a batch
    in an agreement's send side configuration (debatching is already part of the system
    as the interchange format is implicitly known). An agreement can contain zero
    or more batch definitions. Every batch has a state—it can be enabled, disabled,
    or in error. Batches are enabled when the corresponding agreement is deployed
    or the start command is used explicitly. When batches are stopped, messages in
    the batch are flushed out. Each batch definition contains the selection and the
    release criteria.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
- en: Selection criteria
  id: totrans-127
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The selection criteria are used to select a message for batching. In BizTalk
    Services, customers can promote properties and use them in expressions to select
    the message to be added to one or more batches. If the property of an incoming
    batch matches more than one definition, then the message is copied to these many
    batches.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
- en: Release criteria
  id: totrans-129
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The release criteria determine when the batch should be released. One of the
    following can be used as release criteria:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
- en: '| Release criteria | Description |'
  id: totrans-131
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  id: totrans-132
  prefs: []
  type: TYPE_TB
- en: '| Size | The maximum size of the message (excluding interchange and groups)
    in bytes with UTF-8 encoding |'
  id: totrans-133
  prefs: []
  type: TYPE_TB
  zh: '| 大小 | 消息的最大大小（不包括交换和组），以UTF-8编码的字节为单位 |'
- en: '| Count | The number of transaction sets in a batched message |'
  id: totrans-134
  prefs: []
  type: TYPE_TB
  zh: '| 计数 | 批处理消息中事务集的数量 |'
- en: '| Schedule | The configuration of the occurrence and recurrence values to release
    messages periodically |'
  id: totrans-135
  prefs: []
  type: TYPE_TB
  zh: '| 计划 | 配置释放消息的周期性发生和重复值 |'
- en: '| Timeout | Inter-message idle timeout when a batch needs to be released |'
  id: totrans-136
  prefs: []
  type: TYPE_TB
  zh: '| 超时 | 批次需要释放时的消息间空闲超时 |'
- en: '| Interchange size and schedule | Either size or based on schedule |'
  id: totrans-137
  prefs: []
  type: TYPE_TB
  zh: '| 交换大小和计划 | 交换大小或基于计划 |'
- en: '| Interchange size and timeout | Either size or configured timeout |'
  id: totrans-138
  prefs: []
  type: TYPE_TB
  zh: '| 交换大小和超时 | 交换大小或配置的超时 |'
- en: '| Message count and schedule | Either count or based on schedule |'
  id: totrans-139
  prefs: []
  type: TYPE_TB
  zh: '| 消息计数和计划 | 计数或基于计划 |'
- en: '| Message count and timeout | Either count or configured timeout |'
  id: totrans-140
  prefs: []
  type: TYPE_TB
  zh: '| 消息计数和超时 | 计数或配置的超时 |'
- en: '| Interchange size and message count | Either size or count |'
  id: totrans-141
  prefs: []
  type: TYPE_TB
  zh: '| 交换大小和消息计数 | 交换大小或计数 |'
- en: Messages from a batch are released when either the release criteria are met
    or the batch has been stopped from the BizTalk portal. If the release criteria
    are met but no messages are in the batch, a null message is not sent to the send
    endpoint. If the send endpoint is not available when the batch releases a message,
    the message is passed to the suspend endpoint. In the worst case, if the suspend
    endpoint is also down in spite of retries, the set of unbatched transaction sets
    are held in the system and released to the suspend endpoint the next time it becomes
    available. Also, note that for an agreement to be deleted, the batches defined
    in the agreement must not have any messages.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 当满足释放标准或从BizTalk门户停止批次时，将释放批次的消息。如果满足释放标准但批次中没有消息，则不会向发送端点发送空消息。如果批次释放消息时发送端点不可用，则消息将传递到挂起端点。在最坏的情况下，如果挂起端点在重试后仍然不可用，则未批处理的事务集将保留在系统中，并在下次可用时释放到挂起端点。此外，请注意，要删除协议，协议中定义的批次不得有任何消息。
- en: Tracking and archiving
  id: totrans-143
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 跟踪和归档
- en: Tracking helps in storing interesting properties in a message and archiving
    messages in stores. Both tracking and archiving are settings enabled as part of
    an agreement configuration. In the case of B2B, the system and user-promoted properties
    are tracked and written to the Azure SQL Tracking database. In addition to messages,
    the system tracks properties with which a message can be correlated with its acknowledgement.
    This would let users know if an X12 has received a technical or a functional acknowledgement
    and if an AS2 message has received its MDN NACK or ACK message. Tracking identifies
    the list of batches that are active with the list of messages currently held in
    the batch. It also identifies the history of batches that were dispatched on the
    send side.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 跟踪有助于在消息中存储有趣的属性并在存储中归档消息。跟踪和归档都是作为协议配置的一部分启用的设置。在B2B的情况下，系统和用户推广的属性被跟踪并写入Azure
    SQL跟踪数据库。除了消息外，系统还跟踪与消息可以关联的确认属性。这将使用户知道X12是否收到了技术或功能确认，以及AS2消息是否收到了其MDN NACK或ACK消息。跟踪识别了当前在批次中持有的消息列表以及活动的批次列表。它还识别了在发送端发送的批次的历史记录。
- en: 'Archiving is supported in the following cases for X12 and AS2 as illustrated
    in the following diagram:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 如以下图所示，X12和AS2支持以下情况下的归档：
- en: Just before sending a message
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在发送消息之前
- en: Immediately after receiving a message![Tracking and archiving](img/7401EN_05_02.jpg)
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在接收到消息后立即![跟踪和归档](img/7401EN_05_02.jpg)
- en: Archiving is configured in the **General Settings** section in the agreement.
    The messages can be accessed from the BizTalk portal's tracking view option by
    clicking on the relevant message entry and choosing **Details**. From the message
    info pop-up view, you can select the entity to download and click on the **Download**
    option.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 归档在协议中的**常规设置**部分进行配置。可以通过点击相关的消息条目并选择**详细信息**从BizTalk门户的跟踪视图选项访问消息。从消息信息弹出视图，您可以选择要下载的实体并点击**下载**选项。
- en: Non-repudiation
  id: totrans-149
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 不可抵赖性
- en: '**Non-repudiation of Receipt** (**NRR**) is supported in AS2 using both tracking
    and archiving. NRR is required in dispute settlement scenarios where, for example,
    a supplier may not process a PO or claim not to have received the order or the
    payment. NRR ensures that the AS2 message is stored and the incoming Message Integrity
    Check (MIC) value or hashcode is validated against the MIC of the stored AS2 message.
    This validates that the other partner has indeed received and processed the message.
    If the NRR option is turned on and if the tracking or archiving fails, then the
    message processing also fails (unlike in cases without NRR, where message processing
    can continue even if there are tracking errors). To enable NRR, check the **Enable
    NRR** option in the **General Settings** page of the AS2 agreement, as shown in
    the following screenshot:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
- en: '![Non-repudiation](img/7401EN_05_03.jpg)'
  id: totrans-151
  prefs: []
  type: TYPE_IMG
- en: Extensibility
  id: totrans-152
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Extensibility in B2B is possible by using the public API for **Trading Partner
    Management Object Model** (**TPM OM**). We will cover TPM OM as part of the overall
    extensibility in BizTalk Services using API.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
- en: Scenario walk-through
  id: totrans-154
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Let us revisit the scenario we began with in this chapter; we will add a service
    provider to illustrate the concepts. A service provider, as we know, is an expert
    in EDI and will act as a middleman to help suppliers connect to large retailers.
    In this example, Contoso, a large retailer, wishes to procure stock from supplier
    Northwind. Since Northwind is not aware of EDI, they approach a service provider,
    Fabrikam, to help them connect with the retailer Contoso.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
- en: Ecosystem players
  id: totrans-156
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: There are three players in our example. Contoso is a large retailer, Northwind
    is the supplier connecting to Contoso, and finally, Fabrikam is the EDI service
    provider providing EDI services to Northwind.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
- en: Provisioning BizTalk Services
  id: totrans-158
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Fabrikam creates a new BizTalk Services deployment. See [Chapter 1](ch01.html
    "Chapter 1. Hello BizTalk Services"), *Hello BizTalk Services*, on creating BizTalk
    Services deployment and registering the BizTalk Services portal.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
- en: Fabrikam adds Northwind's admin e-mail ID as a registered user in the BizTalk
    Services portal Settings page. This allows Northwind users to log in to the same
    view as that of Fabrikam.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
- en: Configuring partners – Fabrikam, Northwind, and Contoso
  id: totrans-161
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We need to configure the trading partners and the agreement in BizTalk Services.
    The following steps need to be carried out by Fabrikam to add partners:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
- en: Once signed in, click on the **PARTNERS** page and then the **Add** button.
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter the **Partner name** as `Northwind`.
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter **First name**, **Last Name**, **Email ID**, and **Phone** details, if
    required.
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Save**.
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Repeat the above steps for `Contoso` and `Fabrikam` as partner names.
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on each partner, navigate to the default profile, and upload the certificate
    for AS2 signing and encryption.
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The creation of a new partner is shown in the following screenshot:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
- en: '![Configuring partners – Fabrikam, Northwind, and Contoso](img/7401EN_05_04.jpg)'
  id: totrans-170
  prefs: []
  type: TYPE_IMG
- en: Configuring the AS2 agreement between Fabrikam and Contoso
  id: totrans-171
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Once the partners are created, we need to add agreements. The following steps
    need to be carried out to add the AS2 agreement between Fabrikam and Contoso:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
- en: Click on **AGREEMENTS** in the left navigation bar.
  id: totrans-173
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the **AS2** tab.
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Add**.
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **New Agreement** (AS2) page, fill the agreement name as `Fabrikam-Contoso
    agreement` and add a description.
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Hosted Partner** as `Fabrikam` and **Guest Partner** as `Contoso` .
    Here, **Hosted Partner** is the partner who owns the bridge in BizTalk Services.
    In this case, `Fabrikam` owns the BizTalk Services deployment, and hence is the
    host partner.
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter **AS2 Identity** of Fabrikam as `fabrikam` and for Contoso as `contoso`.
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enable tracking and archiving; the latter is available for Premium SKUs.
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Continue**.
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The page is now renamed to `Fabrikam-Contoso agreement` and you are on the **Receive
    Settings** page.
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Following are the steps to configure **Receive Settings**:'
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Under **Inbound URL**, set **URL Suffix** to `endpoint1` and note down the complete
    URL. This is where `Fabrikam` would receive messages from `Contoso`.
  id: totrans-183
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Under **Protocol**, open **Message** and choose **Messages should be signed**
    or **Messages should be encrypted** if applicable. Note that both these options
    require you to add a certificate in the profiles pages of Contoso and Fabrikam
    for this purpose. Also, set **Acknowledgement** and select **Send MDN** if required.
  id: totrans-184
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Click on **Send Settings**:'
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The **Inbound URL** is where `Fabrikam` would send messages to reach `Contoso`.
    The `<Agreement ID>` in the URL would be filled in after the agreement is deployed.
    The inbound refers to the endpoint where messages need to be delivered from the
    `Fabrikam` system in order to be sent to `Contoso` over AS2.
  id: totrans-186
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Under **Protocol**, similar to **Send Settings**, configure signing and encryption
    options if required. Also, set **Acknowledgement** and select **Request MDN**
    (you can leave the other two checkboxes unchecked).
  id: totrans-187
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Under **Transport**, enter the URL of the `Contoso` endpoint. You can create
    a BizTalk Server or BizTalk Services setup which can mock the other end of the
    partner, or simply leave the URL to the default [http://www.microsoft.com](http://www.microsoft.com).
    Note that the prefix `http` is required.
  id: totrans-188
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Click on **Deploy**. You should see the following message in the portal:![Configuring
    the AS2 agreement between Fabrikam and Contoso](img/7401EN_05_05.jpg)
  id: totrans-189
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Configuring the X12 agreement between Northwind and Contoso
  id: totrans-190
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Similar to the AS2 agreement, we now need to configure the X12 agreement between
    Northwind and Contoso. The following steps need to be carried out:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
- en: Click on **AGREEMENTS** in the left navigation bar.
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **EDI** this time; the (0) indicates there are no X12 or EDIFACT agreements.
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Add**.
  id: totrans-194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **New Agreement** option, choose the protocol as **X12** and fill the
    agreement name as `Northwind-Contoso agreement`, and also add a description. You
    can also create an EDIFACT agreement. The next set of steps configure the specific
    X12 settings.
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**新协议**选项中，选择协议为**X12**，并将协议名称填写为`Northwind-Contoso agreement`，同时添加描述。您还可以创建EDIFACT协议。接下来的步骤将配置特定的X12设置。
- en: Select **Hosted Partner** as `Northwind` and **Guest Partner** as `Contoso`.
    Here, **Hosted Partner** is the partner who directly/indirectly owns the bridge
    in BizTalk Services.
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**托管合作伙伴**为`Northwind`和**来宾合作伙伴**为`Contoso`。在这里，**托管合作伙伴**是直接/间接拥有BizTalk服务中桥的合作伙伴。
- en: Select **Qualifier** as **ZZ - Mutually Defined (X12)** and enter the value
    for Northwind as `northwind` and for Contoso as `contoso`.
  id: totrans-197
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**限定符**为**ZZ - 互相定义（X12）**，并为Northwind输入值为`northwind`，为Contoso输入值为`contoso`。
- en: Enable tracking and archiving on both sides; the latter is available for Premium
    SKUs.
  id: totrans-198
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在双方启用跟踪和存档；后者适用于高级SKU。
- en: Click on **Continue**.
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**继续**。
- en: The page is now renamed to `Fabrikam-Contoso agreement` and you are on **Receive
    Settings**.
  id: totrans-200
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 页面现在已重命名为`Fabrikam-Contoso agreement`，您现在处于**接收设置**。
- en: 'The following are the steps to configure **Receive Settings**:'
  id: totrans-201
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以下是为配置**接收设置**的步骤：
- en: Under **Transport**, choose **Transport type** as **AS2** and **AS2 Agreement**
    as `Fabrikam-Contoso agreement`. This means all messages from the X12 agreement
    will be received from the AS2 channel configured earlier. In future, `Fabrikam`
    can create multiple such X12 agreements and reuse the same AS2 agreement to connect
    with the retailer `Contoso`. This is possible as only the X12 configuration changes
    across suppliers while the `Fabrikam` connectivity to `Contoso` is mostly constant.
  id: totrans-202
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在**传输**下，选择**传输类型**为**AS2**和**AS2协议**为`Fabrikam-Contoso agreement`。这意味着所有来自X12协议的消息都将通过之前配置的AS2通道接收。将来，`Fabrikam`可以创建多个此类X12协议，并重用相同的AS2协议来连接零售商`Contoso`。这是可能的，因为只有供应商之间的X12配置发生变化，而`Fabrikam`对`Contoso`的连接基本上是恒定的。
- en: 'Under **Protocol**, select **TA1 expected** and **997 expected**. Assuming
    you have downloaded the B2B schemas from the BizTalk Services download page, click
    on **Upload** and add `X12_00401_810.xsd` and `X12_00401_850.xsd` one after the
    other. They will be listed post upload, as shown in the following screenshot:'
  id: totrans-203
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在**协议**下，选择**预期TA1**和**预期997**。假设您已从BizTalk服务下载页面下载了B2B架构，请点击**上传**并依次添加`X12_00401_810.xsd`和`X12_00401_850.xsd`。它们将在上传后列出，如下面的截图所示：
- en: '![Configuring the X12 agreement between Northwind and Contoso](img/7401EN_05_06.jpg)'
  id: totrans-204
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![配置Northwind和Contoso之间的X12协议](img/7401EN_05_06.jpg)'
- en: Leave the **Transform** settings as they are for now.
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 目前保留**转换**设置不变。
- en: 'Under **Route**, click on **Add** to add the success route rule:'
  id: totrans-206
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**路由**下，点击**添加**以添加成功路由规则：
- en: Enter the rule name as `default`.
  id: totrans-207
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 输入规则名称为`default`。
- en: Click on **Advanced Settings** and enter `1=1` in the expression window. This
    means we will route all successful messages to this endpoint.
  id: totrans-208
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 点击**高级设置**并在表达式窗口中输入`1=1`。这意味着我们将将所有成功消息路由到该端点。
- en: Select **Transport type** as **Azure Service Bus**.
  id: totrans-209
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择**传输类型**为**Azure Service Bus**。
- en: Select **Route destination type** as **BasicHttpRelay**. Add the **BasicHttpRelay
    URL**, **issuer name**, and **issuer key**. This is the URL where the BasicHttpRelay
    service will be listening for successful messages routed from this agreement.
  id: totrans-210
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择**路由目标类型**为**BasicHttpRelay**。添加**BasicHttpRelay URL**、**发行者名称**和**发行者密钥**。这是BasicHttpRelay服务将监听从该协议路由的成功消息的URL。
- en: Click on **Save**.
  id: totrans-211
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 点击**保存**。
- en: 'Add the **Message Suspension Settings**. The suspend settings refer to the
    target URL if messages fail to successfully reach Northwind. We can configure
    Azure Service Bus with Queue, Topic, or Relay. Queues and Topics need to be pre
    created with Shared Access Signature or Issuer Name and Secret:'
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加**消息挂起设置**。挂起设置指的是如果消息未能成功到达Northwind，将引用的目标URL。我们可以使用队列、主题或中继配置Azure Service
    Bus。队列和主题需要使用共享访问签名或发行者名称和密钥预先创建：
- en: Select **Transport type** as **Azure Service Bus**.
  id: totrans-213
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择**传输类型**为**Azure Service Bus**。
- en: Select **Route destination type** as **BasicHttpRelay**. Add the **BasicHttpRelay
    URL**, **issuer name**, and **issuer key**. This is the URL where the BasicHttpRelay
    service will be listening for failed messages from this agreement.
  id: totrans-214
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择**路由目标类型**为**BasicHttpRelay**。添加**BasicHttpRelay URL**、**发行者名称**和**发行者密钥**。这是BasicHttpRelay服务将监听来自此协议的失败消息的URL。
- en: Click on **Save**.
  id: totrans-215
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 点击**保存**。
- en: 'Click on **Send Settings**:'
  id: totrans-216
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**发送设置**：
- en: Under **Inbound URL**, note the **Endpoint** value—the `<Agreement-ID>` in the
    URL will be updated after the agreement is deployed. We will return to this view
    later.
  id: totrans-217
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Leave the **Transform** settings on the send side as the are for now.
  id: totrans-218
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Under **Batching**, you can configure to send a batch of messages instead of
    a single message.
  id: totrans-219
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Click on **Add Batch**, enter `batch of 3 messages` as the name, and add a description.
    Click on **Next**.
  id: totrans-220
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: In **Batch criteria**, choose **Use advanced definitions** and enter `1=1` in
    the textbox. This implies all messages will be batches. Click on **Next**.
  id: totrans-221
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: In **Batch release criteria**, choose **MessageCountBased** and enter `3` as
    the value of **Count**.
  id: totrans-222
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Click on **Next,** and finally, **Save**.
  id: totrans-223
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: You don't have to click on **Start Batch**; the batch will be started automatically
    once the agreement is deployed.
  id: totrans-224
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Under **Protocol**, select **TA1 expected** and **997 expected**. Also, click
    on the **+** symbol under the **Schemas** section and choose the existing **X12_00401_810.xsd**
    option from the **Schema** dropdown. This should already be listed if the same
    was uploaded in the previous **Receive Settings** section.
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Under **Transport**, fill both the **Transport Settings** and **Message Suspension
    Settings**. Under **Transport**, choose **Transport type** as **AS2** and **AS2
    Agreement** as `Fabrikam-Contoso agreement`. This means all messages from the
    X12 agreement will be sent to the AS2 channel configured earlier.
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Add the **Message Suspension Settings**. The suspend settings refer to the
    target URL if messages fail to reach Contoso. We can configure Azure Service Bus
    with Queue, Topic, or Relay. Queues and Topics need to be precreated with Shared
    Access Signature or Issuer Name and Secret. In this case, we configure a service
    running with BasicHttpRelay binding:'
  id: totrans-227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Transport type** as **Azure Service Bus**.
  id: totrans-228
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Select **Route destination type** as **BasicHttpRelay**.
  id: totrans-229
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Add the **BasicHttpRelay URL**, **issuer name**, and **issuer key**. This is
    the URL where the BasicHttpRelay service will be listening for messages which
    could not be sent to `Contoso`.
  id: totrans-230
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Click on **Deploy**:'
  id: totrans-231
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: A success message, `The agreement between Northwind and Contoso was successfully
    deployed` should be shown. If not, check for errors and click on **Deploy** again.
  id: totrans-232
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Navigate to the agreement's **Send Settings** page and note down the **Inbound
    URL** value. This will be used to send messages to the agreement.
  id: totrans-233
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Sending messages
  id: totrans-234
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Web Sender** is a tool available in MSDN Code Gallery for BizTalk Services''
    samples. It can be used to send messages to AS2 receive endpoints. Since in this
    example the AS2 is tied to X12 endpoints, all messages sent to AS2 receive should
    be routed to the success endpoint of X12 receive (the Azure Service Bus relay
    endpoint in this case). **Message Receiver** is a tool in MSDN Code Gallery to
    receive messages on relay endpoints; it needs to listen on the configured address
    in the X12 agreement route address.'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
- en: Use **Web Sender** from MSDN Code Gallery to test the AS2 message with sample
    850\. You can generate an instance of the Purchase Order EDI 850 using Visual
    Studio **Generate Instance** command from the BizTalk Services project.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 使用MSDN代码库中的**Web Sender**测试示例850的AS2消息。您可以使用BizTalk服务项目中的Visual Studio **生成实例**命令生成采购订单EDI
    850的实例。
- en: Note
  id: totrans-237
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'You can download the Message Receiver C# sample at the following link:'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过以下链接下载消息接收器C#示例：
- en: '[http://code.msdn.microsoft.com/Windows-Azure-BizTalk-EAI-e01a5b64](http://code.msdn.microsoft.com/Windows-Azure-BizTalk-EAI-e01a5b64)'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://code.msdn.microsoft.com/Windows-Azure-BizTalk-EAI-e01a5b64](http://code.msdn.microsoft.com/Windows-Azure-BizTalk-EAI-e01a5b64)'
- en: 'You can download the Web Sender C# sample at the following link:'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过以下链接下载Web Sender C#示例：
- en: '[http://code.msdn.microsoft.com/Windows-Azure-BizTalk-a0d12dca](http://code.msdn.microsoft.com/Windows-Azure-BizTalk-a0d12dca)'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://code.msdn.microsoft.com/Windows-Azure-BizTalk-a0d12dca](http://code.msdn.microsoft.com/Windows-Azure-BizTalk-a0d12dca)'
- en: Viewing tracking data
  id: totrans-242
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 查看跟踪数据
- en: Click on the **TRACKING** view in the navigation bar to see the status of message
    flow on the agreement.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 点击导航栏中的**跟踪**视图以查看协议上消息流的状态。
- en: Summary
  id: totrans-244
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we started with the basic concepts around B2B and its relevance
    in the context of Azure. We introduced key concepts of B2B on Azure, notably partners,
    agreements, templates, batching, tracking, and archiving. We also walked through
    a simple agreement configuration for AS2 and X12 in BizTalk Services. Trading
    partners can also be managed using API—this is covered in detail in the extensibility
    chapter later.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们首先介绍了围绕B2B的基本概念及其在Azure环境中的相关性。我们介绍了Azure上B2B的关键概念，特别是合作伙伴、协议、模板、批处理、跟踪和归档。我们还介绍了BizTalk服务中AS2和X12的简单协议配置。交易伙伴也可以使用API进行管理——这将在后面的可扩展性章节中详细说明。
