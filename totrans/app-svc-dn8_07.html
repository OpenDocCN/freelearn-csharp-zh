<html><head></head><body>
  <div><h1 class="chapterNumber">7</h1>
    <h1 class="chapterTitle" id="_idParaDest-269">Handling Dates, Times, and Internationalization</h1>
    <p class="normal">This chapter is about some of the common types that are included with .NET. These include types to manipulate dates and times and implement internationalization, which includes globalization and localization.</p>
    <p class="normal">When writing code to handle times, it is especially important to consider time zones. Bugs are often introduced because two times are compared in different time zones without taking that into account. It is important to understand the concept of <strong class="keyWord">Coordinated Universal Time</strong> (<strong class="keyWord">UTC</strong>) and to<a id="_idIndexMarker561"/> convert time values into UTC before performing time manipulation. </p>
    <p class="normal">You should also be aware <a id="_idIndexMarker562"/>of any <strong class="keyWord">Daylight Saving Time</strong> (<strong class="keyWord">DST</strong>) adjustments that might be needed.</p>
    <p class="normal">This chapter covers the following topics:</p>
    <ul>
      <li class="bulletList">Working with dates and times</li>
      <li class="bulletList">Working with time zones</li>
      <li class="bulletList">Working with cultures</li>
      <li class="bulletList">Working with Noda Time</li>
    </ul>
    <h1 class="heading-1" id="_idParaDest-270">Working with dates and times</h1>
    <p class="normal">After numbers and text, the next <a id="_idIndexMarker563"/>most popular types of data to work with are dates and times. The two main types are as follows:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">DateTime</code>: Represents a combined date and time value for a fixed point in time.</li>
      <li class="bulletList"><code class="inlineCode">TimeSpan</code>: Represents a duration of time.</li>
    </ul>
    <p class="normal">These two types are often used together. For example, if you subtract one <code class="inlineCode">DateTime</code> value from another, the result is a <code class="inlineCode">TimeSpan</code>. If you add a <code class="inlineCode">TimeSpan</code> to a <code class="inlineCode">DateTime</code>, then the result is a <code class="inlineCode">DateTime</code> value.</p>
    <h2 class="heading-2" id="_idParaDest-271">Specifying date and time values</h2>
    <p class="normal">A common way to create a <a id="_idIndexMarker564"/>date and time value is to specify individual values for the date and time components, like day and hour, as described in <em class="italic">Table 7.1</em>:</p>
    <table class="table-container" id="table001-5">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Date/time parameter</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Value range</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">year</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">1 to 9,999</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">month</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">1 to 12</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">day</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">1 to the number of days in that month</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">hour</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">0 to 23</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">minute</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">0 to 59</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">second</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">0 to 59</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">millisecond</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">0 to 999</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">microsecond</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">0 to 999</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 7.1: Parameters for formatting date and time values</p>
    <p class="normal">For example, to instantiate a <code class="inlineCode">DateTime</code> that represents when .NET 9 might be released for <strong class="keyWord">General Availability</strong>, as shown in the following<a id="_idIndexMarker565"/> code:</p>
    <pre class="programlisting code"><code class="hljs-code">DateTime dotnet9GA = new(year: 2024, month: 11, day: 12,
  hour: 11, minute: 0, second: 0);
</code></pre>
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: The preceding code example might make you think, “What time zone does the value represent?” This is the big problem with <code class="inlineCode">DateTime</code> and why it is good practice to avoid it in favor of <code class="inlineCode">DateTimeOffset</code>, which stores the time zone too. We will look at this issue in more detail later in this chapter.</p>
    </div>
    <p class="normal">An alternative is to<a id="_idIndexMarker566"/> provide the value as a <code class="inlineCode">string</code> to be parsed, but this can be misinterpreted depending on the default culture of the thread. For example, in the UK, dates are specified as day/month/year, whereas in the US, dates are specified as month/day/year.</p>
    <p class="normal">Let’s see what you might want to do with dates and times:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Use your preferred code editor to create a new project, as defined in the following list:<ul>
          <li class="bulletList">Project template: <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code></li>
          <li class="bulletList">Project file and folder: <code class="inlineCode">WorkingWithTime</code></li>
          <li class="bulletList">Solution file and folder: <code class="inlineCode">Chapter07</code></li>
          <li class="bulletList"><strong class="screenText">Do not use top-level statements</strong>: Cleared.</li>
          <li class="bulletList"><strong class="screenText">Enable native AOT publish</strong>: Cleared.</li>
        </ul>
      </li>
      <li class="numberedList">In the project file, treat warnings as errors, and add an element to statically and globally import the <code class="inlineCode">System.Console</code> class.</li>
      <li class="numberedList">Add a new class file named <code class="inlineCode">Program.Helpers.cs</code> and replace its contents, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using System.Globalization; // To use CultureInfo.
partial class Program
{
  private static void ConfigureConsole(string culture = "en-US",
    bool overrideComputerCulture = true)
  {
    // To enable special characters like Euro currency symbol.
    OutputEncoding = System.Text.Encoding.UTF8;
    Thread t = Thread.CurrentThread;
    if (overrideComputerCulture)
    {
      t.CurrentCulture = CultureInfo.GetCultureInfo(culture);
      t.CurrentUICulture = t.CurrentCulture;
    }
    CultureInfo ci = t.CurrentCulture;
    WriteLine($"Current culture: {ci.DisplayName}");
    WriteLine($"Short date pattern: {
      ci.DateTimeFormat.ShortDatePattern}");
    WriteLine($"Long date pattern: {
      ci.DateTimeFormat.LongDatePattern}");
    WriteLine();
  }
  private static void SectionTitle(string title)
  {
    ConsoleColor previousColor = ForegroundColor;
    ForegroundColor = ConsoleColor.DarkYellow;
    WriteLine($"*** {title}");
    ForegroundColor = previousColor;
  }
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete<a id="_idIndexMarker567"/> the existing statements, and then add statements to initialize some special date/time values, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">ConfigureConsole(); // Defaults to en-US culture.
SectionTitle("Specifying date and time values");
WriteLine($"DateTime.MinValue:  {DateTime.MinValue}");
WriteLine($"DateTime.MaxValue:  {DateTime.MaxValue}");
WriteLine($"DateTime.UnixEpoch: {DateTime.UnixEpoch}");
WriteLine($"DateTime.Now:       {DateTime.Now}");
WriteLine($"DateTime.Today:     {DateTime.Today}");
WriteLine($"DateTime.Today:     {DateTime.Today:d}");
WriteLine($"DateTime.Today:     {DateTime.Today:D}");
</code></pre>
      </li>
      <li class="numberedList">Run the code, and note the results, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">Current culture: English (United States)
Short date pattern: M/d/yyyy
Long date pattern: dddd, MMMM d, yyyy
*** Specifying date and time values
DateTime.MinValue:  1/1/0001 12:00:00 AM
DateTime.MaxValue:  12/31/9999 11:59:59 PM
DateTime.UnixEpoch: 1/1/1970 12:00:00 AM
DateTime.Now:       5/30/2023 9:18:05 AM
DateTime.Today:     5/30/2023 12:00:00 AM
DateTime.Today:     5/30/2023
DateTime.Today:     Tuesday, May 30, 2023
</code></pre>
      
    <div><p class="normal">The date and time formats output are determined by the culture settings of your console app. We called the <code class="inlineCode">ConfigureConsole</code> method to make sure we all see the same default output in US English. </p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">In <code class="inlineCode">Program.cs</code>, at the top of the statement that calls <code class="inlineCode">ConfigureConsole</code>, set the parameter to not override your local computer’s culture, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">ConfigureConsole(overrideComputerCulture: false);
</code></pre>
      </li>
      <li class="numberedList">Run the code, and <a id="_idIndexMarker568"/>note the output is localized to your computer’s culture.</li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, set the parameter to specify alternative languages, like French in Canada (<code class="inlineCode">fr-CA</code>) or English in Great Britain (<code class="inlineCode">en-GB</code>), as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">ConfigureConsole("fr-CA");
</code></pre>
      
    <div><p class="normal"><strong class="keyWord">More Information</strong>: There is a table of common culture codes at the following link: <a href="https://en.wikipedia.org/wiki/Language_localisation#Language_tags_and_codes">https://en.wikipedia.org/wiki/Language_localisation#Language_tags_and_codes</a></p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="9">Run the code, and note that the output is localized to the specified culture.</li>
      <li class="numberedList">Reset the console configuration back to the default so that it uses US English culture, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">ConfigureConsole(); // Defaults to en-US culture.
</code></pre>
      </li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-272">Formatting date and time values</h2>
    <p class="normal">You have just seen that dates <a id="_idIndexMarker569"/>and times have default formats based on the current culture. </p>
    <p class="normal">You can take complete control of date and time formatting using custom format code, as shown in <em class="italic">Table 7.2</em>:</p>
    <table class="table-container" id="table002-5">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Format code</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">/</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Date part separator. Varies by culture; for example, <code class="inlineCode">en-US</code> uses <code class="inlineCode">/</code>, but <code class="inlineCode">fr-FR</code> uses <code class="inlineCode">-</code> (dash).</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">\</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Escape character. Useful if you want to use a special format code as a literal character; for example, <code class="inlineCode">h \h m \m</code> would format a time of 9:30 am as <code class="inlineCode">9 h 30 m</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">:</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Time part separator. Varies by culture; for example, <code class="inlineCode">en-US</code> uses <code class="inlineCode">:</code>, but <code class="inlineCode">fr-FR</code> uses <code class="inlineCode">.</code> (dot).</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">d</code>, <code class="inlineCode">dd</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">The day of the month, from <code class="inlineCode">1</code> to <code class="inlineCode">31</code>, or with a leading zero from <code class="inlineCode">01</code> through <code class="inlineCode">31</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">ddd, dddd</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">The abbreviated or full name of the day of the week, for example, <code class="inlineCode">Mon</code> or <code class="inlineCode">Monday</code>, localized for the current culture.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">f</code>, <code class="inlineCode">ff</code>, <code class="inlineCode">fff</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">The tenths of a second, hundredths of a second, or milliseconds.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">g</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">The period or era, for example, <code class="inlineCode">A.D.</code></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">h</code>, <code class="inlineCode">hh</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">The hour, using a 12-hour clock from <code class="inlineCode">1</code> to <code class="inlineCode">12</code>, or from <code class="inlineCode">01</code> to <code class="inlineCode">12</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">H</code>, <code class="inlineCode">HH</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">The hour, using a 24-hour clock from <code class="inlineCode">0</code> to <code class="inlineCode">23</code>, or from <code class="inlineCode">01</code> to <code class="inlineCode">23</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">K</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Time zone information. <code class="inlineCode">null</code> for an unspecified time zone, <code class="inlineCode">Z</code> for UTC, and a value like <code class="inlineCode">-8:00</code> for local time adjusted from UTC.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">m</code>, <code class="inlineCode">mm</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">The minute, from <code class="inlineCode">0</code> through <code class="inlineCode">59</code>, or with a leading zero from <code class="inlineCode">00</code> through <code class="inlineCode">59</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">M</code>, <code class="inlineCode">MM</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">The month, from <code class="inlineCode">1</code> through <code class="inlineCode">12</code>, or with a leading zero from <code class="inlineCode">01</code> through <code class="inlineCode">12</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">MMM</code>, <code class="inlineCode">MMMM</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">The abbreviated or full name of the month, for example, <code class="inlineCode">Jan</code> or <code class="inlineCode">January</code>, localized for the current culture.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">s</code>, <code class="inlineCode">ss</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">The second, from <code class="inlineCode">0</code> through <code class="inlineCode">59</code>, or with a leading zero from <code class="inlineCode">00</code> through <code class="inlineCode">59</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">t</code>, <code class="inlineCode">tt</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">The first or both characters of the AM/PM designator.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">y</code>, <code class="inlineCode">yy</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">The year of the current century, from <code class="inlineCode">0</code> through <code class="inlineCode">99</code>, or with a leading zero from <code class="inlineCode">00</code> through <code class="inlineCode">99</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">yyy</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">The year with a minimum of three digits, and as many as needed. For example, 1 A.D. is <code class="inlineCode">001</code>. The first sacking of Rome was in <code class="inlineCode">410</code>. The year this book was published is <code class="inlineCode">2023</code>. </p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">yyyy</code>, <code class="inlineCode">yyyyy</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">The year as a four- or five-digit number.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">z</code>, <code class="inlineCode">zz</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Hours offset from UTC, with no leading zeros, or with leading zeros.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">zzz</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Hours and minutes offset from UTC, with a leading zero, for example, <code class="inlineCode">+04:30</code>.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 7.2: Custom format code for date and time values</p>
    <div><p class="normal"><strong class="keyWord">More Information</strong>: A full list of custom format code can be found at the following link: <a href="https://learn.microsoft.com/en-us/dotnet/standard/base-types/custom-date-and-time-format-strings">https://learn.microsoft.com/en-us/dotnet/standard/base-types/custom-date-and-time-format-strings</a></p>
    </div>
    <p class="normal">You can apply standard <a id="_idIndexMarker570"/>date and time formatting using simpler format code, like the <code class="inlineCode">d</code> and <code class="inlineCode">D</code> we used in the code example, as shown in <em class="italic">Table 7.3</em>:</p>
    <table class="table-container" id="table003-5">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Format code</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">d</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Short date pattern. Varies by culture; for example, <code class="inlineCode">en-US</code> uses <code class="inlineCode">M/d/yyyy</code> and <code class="inlineCode">fr-FR</code> uses <code class="inlineCode">dd/MM/yyyy</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">D</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Long date pattern. Varies by culture; for example, <code class="inlineCode">en-US</code> uses <code class="inlineCode">mmmm, MMMM d, yyyy</code> and <code class="inlineCode">fr-FR</code> uses <code class="inlineCode">mmmm, dd MMMM yyyy</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">f</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Full date/time pattern (short time – hours and minutes). Varies by culture.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">F</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Full date/time pattern (long time – hours, minutes, seconds, and AM/PM). Varies by culture.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">o, O</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">A standardized pattern, suitable to serialize date/time values for roundtrips, for example, <code class="inlineCode">2023-05-30T13:45:30.0000000-08:00</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">r</code>, <code class="inlineCode">R</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">RFC1123 pattern.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">t</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Short time pattern. Varies by culture; for example, <code class="inlineCode">en-US</code> uses <code class="inlineCode">h:mm tt</code> and <code class="inlineCode">fr-FR</code> uses <code class="inlineCode">HH:mm</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">T</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Long time pattern. Varies by culture; for example, <code class="inlineCode">en-US</code> uses <code class="inlineCode">h:mm:ss tt</code> and <code class="inlineCode">fr-FR</code> uses <code class="inlineCode">HH:mm:ss</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">u</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Universal sortable date/time pattern, for example, <code class="inlineCode">2009-06-15 13:45:30Z</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">U</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Universal full date/time pattern. Varies by culture; for example, <code class="inlineCode">en-US</code> might be <code class="inlineCode">Monday, June 15, 2009 8:45:30 PM</code>.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 7.3: Standard format code for date and time values</p>
    <div><p class="normal"><strong class="keyWord">More Information</strong>: A full list of format code can be found at the following link: <a href="https://learn.microsoft.com/en-us/dotnet/standard/base-types/standard-date-and-time-format-strings">https://learn.microsoft.com/en-us/dotnet/standard/base-types/standard-date-and-time-format-strings</a>.</p>
    </div>
    <p class="normal">Let’s run some <a id="_idIndexMarker571"/>examples:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, add statements to define Christmas Day in 2024 and display it in various ways, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">DateTime xmas = new(year: 2024, month: 12, day: 25);
WriteLine($"Christmas (default format): {xmas}");
WriteLine($"Christmas (custom short format): {xmas:ddd d/M/yy}");
WriteLine($"Christmas (custom long format): {
  xmas:dddd, dd MMMM yyyy}");
WriteLine($"Christmas (standard long format): {xmas:D}");
WriteLine($"Christmas (sortable): {xmas:u}");
WriteLine($"Christmas is in month {xmas.Month} of the year.");
WriteLine($"Christmas is day {xmas.DayOfYear} of {xmas.Year}.");
WriteLine($"Christmas {xmas.Year} is on a {xmas.DayOfWeek}.");
</code></pre>
      </li>
      <li class="numberedList">Run the code, and note the results, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">Christmas (default format): 12/25/2024 12:00:00 AM
Christmas (custom short format): Wed, 25/12/24
Christmas (custom long format): Wednesday, 25 December 2024
Christmas (standard long format): Wednesday, December 25, 2024
Christmas (sortable): 2024-12-25 00:00:00Z
Christmas is in month 12 of the year.
Christmas is day 360 of 2024.
Christmas 2024 is on a Wednesday.
</code></pre>
      </li>
      <li class="numberedList">Disable overriding your computer culture or pass a specific culture code, like French in France, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">ConfigureConsole("fr-FR"); // Defaults to en-US culture.
</code></pre>
      </li>
      <li class="numberedList">Run the<a id="_idIndexMarker572"/> code, and note that the results should be localized to that culture.</li>
      <li class="numberedList">Reset the console configuration back to the default of US English.</li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-273">Date and time calculations</h2>
    <p class="normal">Now, let’s try performing simple<a id="_idIndexMarker573"/> calculations on date and time values:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, add statements to perform addition and subtraction with Christmas 2024, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">SectionTitle("Date and time calculations");
DateTime beforeXmas = xmas.Subtract(TimeSpan.FromDays(12));
DateTime afterXmas = xmas.AddDays(12);
WriteLine($"12 days before Christmas: {beforeXmas:d}");
WriteLine($"12 days after Christmas: {afterXmas:d}");
TimeSpan untilXmas = xmas - DateTime.Now;
WriteLine($"Now: {DateTime.Now}");
WriteLine($"There are {untilXmas.Days} days and {untilXmas.Hours
  } hours until Christmas {xmas.Year.");
WriteLine("There are {untilXmas.TotalHours:N0} hours " +
  $"until Christmas {xmas.Year}.");
</code></pre>
      </li>
      <li class="numberedList">Run the code, and note the results, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">*** Date and time calculations
12 days before Christmas: 12/13/2024
12 days after Christmas: 1/6/2025
Now: 5/30/2023 1:57:01 PM
There are 574 days and 10 hours until Christmas 2024.
There are 13,786 hours until Christmas 2024.
</code></pre>
      </li>
      <li class="numberedList">Add statements to define the time on Christmas Day that your children (or dog or cat or iguana?) might <a id="_idIndexMarker574"/>wake up to open presents, and display it in various ways, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">DateTime kidsWakeUp = new(
  year: 2024, month: 12, day: 25, 
  hour: 6, minute: 30, second: 0);
WriteLine($"Kids wake up: {kidsWakeUp}");
WriteLine($"The kids woke me up at {
  kidsWakeUp.ToShortTimeString()}");
</code></pre>
      </li>
      <li class="numberedList">Run the code, and note the results, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">Kids wake up: 25/12/2024 06:30:00 AM
The kids woke me up at 06:30 AM
</code></pre>
      </li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-274">Microseconds and nanoseconds</h2>
    <p class="normal">In earlier versions of .NET, the smallest unit of time measurement was a tick. A tick is 100 nanoseconds, so developers used to<a id="_idIndexMarker575"/> have to do the calculation for nanoseconds <a id="_idIndexMarker576"/>themselves. .NET 7 introduced millisecond and microsecond parameters to constructors, and microsecond and nanosecond properties to the <code class="inlineCode">DateTime</code>, <code class="inlineCode">DateTimeOffset</code>, <code class="inlineCode">TimeSpan</code>, and <code class="inlineCode">TimeOnly</code> types.</p>
    <p class="normal">Let’s see some examples:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, add statements to<a id="_idIndexMarker577"/> construct a date and time value with <a id="_idIndexMarker578"/>more precision than was<a id="_idIndexMarker579"/> possible and to display its value, as shown in<a id="_idIndexMarker580"/> the following code:
        <pre class="programlisting code"><code class="hljs-code">SectionTitle("Milli-, micro-, and nanoseconds");
DateTime preciseTime = new(
  year: 2022, month: 11, day: 8,
  hour: 12, minute: 0, second: 0,
  millisecond: 6, microsecond: 999);
WriteLine($"Millisecond: {preciseTime.Millisecond}, Microsecond: {
  preciseTime.Microsecond}, Nanosecond: {preciseTime.Nanosecond}");
preciseTime = DateTime.UtcNow;
// Nanosecond value will be 0 to 900 in 100 nanosecond increments.
WriteLine($"Millisecond: {preciseTime.Millisecond}, Microsecond: {
  preciseTime.Microsecond}, Nanosecond: {preciseTime.Nanosecond}");
</code></pre>
      </li>
      <li class="numberedList">Run the code, and note the results, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">*** Milli-, micro-, and nanoseconds
Millisecond: 6, Microsecond: 999, Nanosecond: 0
Millisecond: 243, Microsecond: 958, Nanosecond: 400
</code></pre>
      </li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-275">Globalization with dates and times</h2>
    <p class="normal">The current culture controls <a id="_idIndexMarker581"/>how dates and times are<a id="_idIndexMarker582"/> formatted and parsed:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">At the top of <code class="inlineCode">Program.cs</code>, import the namespace to work with globalization, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using System.Globalization; // To use CultureInfo.
</code></pre>
      </li>
      <li class="numberedList">Add statements to show the current culture that is used to display date and time values, and then parse the United States’ Independence Day and display it in <a id="_idIndexMarker583"/>various ways, as shown in the<a id="_idIndexMarker584"/> following code:
        <pre class="programlisting code"><code class="hljs-code">SectionTitle("Globalization with dates and times");
// Same as Thread.CurrentThread.CurrentCulture.
WriteLine($"Current culture: {CultureInfo.CurrentCulture.Name}");
string textDate = "4 July 2024";
DateTime independenceDay = DateTime.Parse(textDate);
WriteLine($"Text: {textDate}, DateTime: {independenceDay:d MMMM}");
textDate = "7/4/2024";
independenceDay = DateTime.Parse(textDate);
WriteLine($"Text: {textDate}, DateTime: {independenceDay:d MMMM}");
// Explicitly override the current culture by setting a provider.
independenceDay = DateTime.Parse(textDate,
  provider: CultureInfo.GetCultureInfo("en-US"));
WriteLine($"Text: {textDate}, DateTime: {independenceDay:d MMMM}");
</code></pre>
      
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: Although you can create a <code class="inlineCode">CultureInfo</code> instance using its constructor, unless you need to make changes to it, you should get a read-only shared instance by calling the <code class="inlineCode">GetCultureInfo</code> method.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">At the top of <code class="inlineCode">Program.cs</code>, set the culture to British English, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">ConfigureConsole("en-GB");
</code></pre>
      </li>
      <li class="numberedList">Run the code, and note the results, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">*** Globalization with dates and times
Current culture is: en-GB
Text: 4 July 2024, DateTime: 4 July
Text: 7/4/2024, DateTime: 7 April
Text: 7/4/2024, DateTime: 4 July
</code></pre>
      
    <div><p class="normal">When the current culture is <em class="italic">English (Great Britain)</em>, if a date is given as 4 July 2024, then it is correctly parsed regardless of whether the current culture is British or American. But if the date is given as <code class="inlineCode">7/4/2024</code>, then it is parsed as 7 April. You can override the current culture by specifying the correct culture as a provider when parsing, as shown in the third example above.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Add statements to<a id="_idIndexMarker585"/> loop from the year 2023 to 2028, displaying if the year is a leap year and<a id="_idIndexMarker586"/> how many days there are in February, and then showing if Christmas and Independence Day are during DST, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">for (int year = 2023; year &lt;= 2028; year++)
{
  Write($"{year} is a leap year: {DateTime.IsLeapYear(year)}. ");
  WriteLine($"There are {DateTime.DaysInMonth(year: year, month: 2)
    } days in February {year}.");
}
WriteLine($"Is Christmas daylight saving time? {
  xmas.IsDaylightSavingTime()}");
WriteLine($"Is July 4th daylight saving time? {
  independenceDay.IsDaylightSavingTime()}");
</code></pre>
      </li>
      <li class="numberedList">Run the code, and note the results, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">2023 is a leap year: False. There are 28 days in February 2023.
2024 is a leap year: True. There are 29 days in February 2024.
2025 is a leap year: False. There are 28 days in February 2025.
2026 is a leap year: False. There are 28 days in February 2026.
2027 is a leap year: False. There are 28 days in February 2027.
2028 is a leap year: True. There are 29 days in February 2028.
Is Christmas daylight saving time? False
Is July 4th daylight saving time? True
</code></pre>
      </li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-276">Complexities of Daylight Saving Time (DST)</h2>
    <p class="normal">DST is not used in all countries; it is <a id="_idIndexMarker587"/>also determined by hemisphere, and politics plays a role. For example, the United <a id="_idIndexMarker588"/>States is currently debating whether it should make DST permanent. They might decide to leave the decision up to individual states. It could all get extra confusing for Americans over the next few years.</p>
    <p class="normal">Each country has its own rules for what day and what hour DST happens. These rules are encoded by .NET so that it can adjust automatically when needed.</p>
    <p class="normal">In the US in springtime, the clocks “spring” forward one hour at 2 AM. In the fall, they “fall” back one hour at 2 AM. Wikipedia explains this at the following link: <a href="https://en.wikipedia.org/wiki/Daylight_saving_time_in_the_United_States">https://en.wikipedia.org/wiki/Daylight_saving_time_in_the_United_States</a></p>
    <p class="normal">In the UK in springtime, the clocks spring forward one hour at 1 AM. In the autumn, they fall back one hour at 2 AM. The UK government explains this at the following link: <a href="https://www.gov.uk/when-do-the-clocks-change">https://www.gov.uk/when-do-the-clocks-change</a></p>
    <p class="normal">Imagine that you need to set an alarm to wake you up at 1:30 AM to catch a flight from Heathrow airport in the UK. Your flight happens to depart on the day that DST takes effect.</p>
    <p class="normal">In the UK spring, the clocks are at 12:59 AM, and then the next minute they spring forward to 2:00AM. 1:30 AM never happens, your alarm does not go off, and you miss your flight! 1:30 AM is an invalid time in .NET, and if you try to store that value in a variable, it will throw an exception.</p>
    <p class="normal">In the UK autumn, the clocks are at 1:59, and then the next minute, they fall back to 1:00 and repeat that hour. In this case, 1:30 AM happens twice.</p>
    <h2 class="heading-2" id="_idParaDest-277">Localizing the DayOfWeek enum</h2>
    <p class="normal"><code class="inlineCode">DayOfWeek</code> is an <code class="inlineCode">enum</code>, so it<a id="_idIndexMarker589"/> cannot be localized <a id="_idIndexMarker590"/>as you might expect or hope. Its <code class="inlineCode">string</code> values are hardcoded in English, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">namespace System
{
  public enum DayOfWeek
  {
    Sunday = 0,
    Monday = 1,
    Tuesday = 2,
    Wednesday = 3,
    Thursday = 4,
    Friday = 5,
    Saturday = 6
  }
}
</code></pre>
    <p class="normal">There are two solutions to this problem. First, you could apply the <code class="inlineCode">dddd</code> date format code to a whole date value. For example, </p>
    <pre class="programlisting gen"><code class="hljs">WriteLine($"The day of the week is {DateTime.Now:dddd}.");
</code></pre>
    <p class="normal">Second, you can use a helper method of the <code class="inlineCode">DateTimeFormatInfo</code> class to convert a <code class="inlineCode">DayOfWeek</code> value into a localized <code class="inlineCode">string</code> for output as text. </p>
    <p class="normal">Let’s see an example of the problem and solution:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, add statements to explicitly set the current culture to Danish, and then output the current day of the week in that culture, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">SectionTitle("Localizing the DayOfWeek enum");
CultureInfo previousCulture = Thread.CurrentThread.CurrentCulture;
// Explicitly set culture to Danish (Denmark).
Thread.CurrentThread.CurrentCulture = 
  CultureInfo.GetCultureInfo("da-DK");
// DayOfWeek is not localized to Danish.
WriteLine("Culture: {Thread.CurrentThread.CurrentCulture
  .NativeName}, DayOfWeek: {DateTime.Now.DayOfWeek}";
// Use dddd format code to get day of the week localized.
WriteLine($"Culture: {Thread.CurrentThread.CurrentCulture
  .NativeName}, DayOfWeek: {DateTime.Now:dddd}");
// Use GetDayName method to get day of the week localized.
WriteLine("Culture: {Thread.CurrentThread.CurrentCulture
  .NativeName}, DayOfWeek: {DateTimeFormatInfo.CurrentInfo
  .GetDayName(DateTime.Now.DayOfWeek)}");
Thread.CurrentThread.CurrentCulture = previousCulture;
</code></pre>
      </li>
      <li class="numberedList">Run the code, and <a id="_idIndexMarker591"/>note the results, as shown in the<a id="_idIndexMarker592"/> following output:
        <pre class="programlisting con"><code class="hljs-con">*** Localizing the DayOfWeek enum
Culture: dansk (Danmark), DayOfWeek: Thursday
Culture: dansk (Danmark), DayOfWeek: torsdag
Culture: dansk (Danmark), DayOfWeek: torsdag
</code></pre>
      </li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-278">Working with only a date or a time</h2>
    <p class="normal">.NET 6 introduced some new types to <a id="_idIndexMarker593"/>work with only a date value or only a time value, named <code class="inlineCode">DateOnly</code> and <code class="inlineCode">TimeOnly</code>.</p>
    <p class="normal">These are better than<a id="_idIndexMarker594"/> using a <code class="inlineCode">DateTime</code> value with a zero time to store a date-only value because it is type-safe and avoids misuse. <code class="inlineCode">DateOnly</code> also maps better to database column types, for example, a <code class="inlineCode">date</code> column in SQL Server. <code class="inlineCode">TimeOnly</code> is good for setting alarms and scheduling regular meetings or the opening hours for an organization, and it maps to a <code class="inlineCode">time</code> column in SQL Server.</p>
    <p class="normal">Let’s use them to plan a release party for .NET 9, probably on Tuesday, November 12, 2024, one week after the US presidential election:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, add statements to define the .NET 9 release party and a time for it to start, and then combine the two values to make a calendar entry so that we don’t miss it, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">SectionTitle("Working with only a date or a time");
DateOnly party = new(year: 2024, month: 11, day: 12);
WriteLine($"The .NET 9 release party is on {party.ToLongDateString()}.");
TimeOnly starts = new(hour: 11, minute: 30);
WriteLine($"The party starts at {starts}.");
DateTime calendarEntry = party.ToDateTime(starts);
WriteLine($"Add to your calendar: {calendarEntry}.");
</code></pre>
      </li>
      <li class="numberedList">Run the code and note the results, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">*** Working with only a date or a time
The .NET 9 release party is on Tuesday, November 12, 2024.
The party starts at 11:30 AM.
Add to your calendar: 11/12/2024 11:30:00 AM.
</code></pre>
      </li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-279">Getting date/time formatting information</h2>
    <p class="normal">Each culture has its own<a id="_idIndexMarker595"/> date/time formatting rules. These<a id="_idIndexMarker596"/> are defined in the <code class="inlineCode">DateTimeFormat</code> property of a <code class="inlineCode">CultureInfo</code> instance.</p>
    <p class="normal">Let’s output some commonly used information:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, add statements to get the date/time formatting information for the current culture and output some of its most useful properties, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">SectionTitle("Working with date/time formats");
DateTimeFormatInfo dtfi = DateTimeFormatInfo.CurrentInfo;
// Or use Thread.CurrentThread.CurrentCulture.DateTimeFormat.
WriteLine($"Date separator: {dtfi.DateSeparator}");
WriteLine($"Time separator: {dtfi.TimeSeparator}");
WriteLine($"Long date pattern: {dtfi.LongDatePattern}");
WriteLine($"Short date pattern: {dtfi.ShortDatePattern}");
WriteLine($"Long time pattern: {dtfi.LongTimePattern}");
WriteLine($"Short time pattern: {dtfi.ShortTimePattern}");
Write("Day names:");
for (int i = 0; i &lt; dtfi.DayNames.Length - 1; i++)
{
  Write($"  {dtfi.GetDayName((DayOfWeek)i)}");
}
WriteLine();
Write("Month names:");
for (int i = 1; i &lt; dtfi.MonthNames.Length; i++)
{
  Write($"  {dtfi.GetMonthName(i)}");
}
WriteLine();
</code></pre>
      </li>
      <li class="numberedList">Run the code, and <a id="_idIndexMarker597"/>note the results, as <a id="_idIndexMarker598"/>shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">*** Working with date/time formats
Date separator: /
Time separator: :
Long date pattern: dddd, MMMM d, yyyy
Short date pattern: M/d/yyyy
Long time pattern: h:mm:ss tt
Short time pattern: h:mm tt
Day names:  Sunday  Monday  Tuesday  Wednesday  Thursday  Friday
Month names:  January  February  March  April  May  June  July  August  September  October  November  December
</code></pre>
      </li>
      <li class="numberedList">Change the culture to something else, run the code, and note the results.</li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-280">Unit testing with a time provider</h2>
    <p class="normal">Writing unit tests for <a id="_idIndexMarker599"/>components that need the current time is tricky because the time is constantly changing!</p>
    <p class="normal">Imagine you want visitors to<a id="_idIndexMarker600"/> your e-commerce website<a id="_idIndexMarker601"/> to get a 20% discount if they make an order at the weekend. During workdays, they pay full price. How can we test this functionality?</p>
    <p class="normal">To control the time used in unit tests, .NET 8 introduces the <code class="inlineCode">TimeProvider</code> class. </p>
    <p class="normal">Let’s start defining a function to perform this calculation:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">In the <code class="inlineCode">Chapter07</code> solution, add a new <strong class="screenText">Class Library</strong>/<code class="inlineCode">classlib</code> project named <code class="inlineCode">TimeFunctionsLib</code>.</li>
      <li class="numberedList">In the <code class="inlineCode">TimeFunctionsLib</code> project, rename <code class="inlineCode">Class1.cs</code> to <code class="inlineCode">DiscountService.cs</code>.</li>
      <li class="numberedList">In <code class="inlineCode">DiscountService.cs</code>, define a function to perform the calculation, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">namespace Northwind.Services;
public class DiscountService
{
  public decimal GetDiscount()
  {
    // This has a dependency on the current time provided by the system.
    var now = DateTime.UtcNow;
    return now.DayOfWeek switch
    {
      DayOfWeek.Saturday or DayOfWeek.Sunday =&gt; 0.2M,
      _ =&gt; 0M
    };
  }
}
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">Chapter07</code> solution, add <a id="_idIndexMarker602"/>a new <strong class="screenText">xUnit Test Project</strong>/<code class="inlineCode">xunit</code> project <a id="_idIndexMarker603"/>named <code class="inlineCode">TestingWithTimeProvider</code>.</li>
      <li class="numberedList">In the <code class="inlineCode">TestingWithTimeProvider</code> project, add a reference to the <code class="inlineCode">TimeFunctionsLib</code> project, as<a id="_idIndexMarker604"/> shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;ProjectReference Include=
    "..\TimeFunctionsLib\TimeFunctionsLib.csproj" /&gt;
&lt;/ItemGroup&gt;
</code></pre>
      </li>
      <li class="numberedList">Build the <code class="inlineCode">TestingWithTimeProvider</code> project.</li>
      <li class="numberedList">In the <code class="inlineCode">TestingWithTimeProvider</code> project, rename <code class="inlineCode">Test1.cs</code> to <code class="inlineCode">TimeTests.cs</code>.</li>
      <li class="numberedList">In <code class="inlineCode">TimeTests.cs</code>, modify the statements to import the namespace for the discount service, and then define two tests, one for workdays and one for weekends, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using Northwind.Services; // To use DiscountService.
namespace TestingWithTimeProvider;
public class TimeTests
{
  [Fact]
  public void TestDiscountDuringWorkdays()
  {
    // Arrange
    DiscountService service = new();
    // Act
    decimal discount = service.GetDiscount();
    // Assert
    Assert.Equal(0M, discount);
  }
  [Fact]
  public void TestDiscountDuringWeekends()
  {
    DiscountService service = new();
    decimal discount = service.GetDiscount();
    Assert.Equal(0.2M, discount);
  }
}
</code></pre>
      </li>
      <li class="numberedList">Run the two tests, and <a id="_idIndexMarker605"/>note that only one can ever succeed at any one time. If you run the<a id="_idIndexMarker606"/> tests during workdays, the weekend test will fail. If you run the tests during the weekend, the <a id="_idIndexMarker607"/>workday test will fail!</li>
    </ol>
    <p class="normal">Now that you’ve seen the problem, how can we solve it?</p>
    <p class="normal">The way Microsoft solves it is by each team that creates .NET libraries defining its own internal <code class="inlineCode">ISystemClock</code> interface with, at a minimum, a property named <code class="inlineCode">UtcNow</code>, and sometimes other<a id="_idIndexMarker608"/> members, along with implementations that typically use the built-in system clock but are all slightly different. A typical example is shown in the <a id="_idIndexMarker609"/>following code:</p>
    <pre class="programlisting code"><code class="hljs-code">using System;
namespace Microsoft.Extensions.Internal
{
  public interface ISystemClock
  {
    DateTimeOffset UtcNow { get; }
  }
  public class SystemClock
  {
    public DateTimeOffset UtcNow 
    {
      return DateTimeOffset.UtcNow;
    }
  }
}
</code></pre>
    <p class="normal">Finally, with .NET 8, the core .NET team <a id="_idIndexMarker610"/>has introduced a proper equivalent of the preceding code with an implementation that uses the system clock. Unfortunately, they do not define an interface. Instead, they define an abstract class named <code class="inlineCode">TimeProvider</code>.</p>
    <p class="normal">Let’s use it:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">In the <code class="inlineCode">TimeFunctionsLib</code> project, in <code class="inlineCode">DiscountService.cs</code>, comment out the use of the <code class="inlineCode">UtcNow</code> property, and add a statement to add a constructor-injected service, as highlighted in the following code:
        <pre class="programlisting code"><code class="hljs-code">namespace Northwind.Services;
public class DiscountService
{
<strong class="hljs-slc">  </strong><strong class="hljs-keyword-slc">private</strong><strong class="hljs-slc"> TimeProvider _timeProvider;</strong>
<strong class="hljs-slc">  </strong><strong class="hljs-keyword-slc">public</strong><strong class="hljs-function-slc"> </strong><strong class="hljs-title-slc">DiscountService</strong><strong class="hljs-function-slc">(</strong><strong class="hljs-params-slc">TimeProvider timeProvider</strong><strong class="hljs-function-slc">)</strong>
<strong class="hljs-slc">  {</strong>
<strong class="hljs-slc">    _timeProvider = timeProvider;</strong>
<strong class="hljs-slc">  }</strong>
  public decimal GetDiscount()
  {
    // This has a dependency on the current time provided by the system.
    <strong class="hljs-comment-slc">//</strong> var now = DateTime.UtcNow;
<strong class="hljs-slc">    </strong><strong class="hljs-keyword-slc">var</strong><strong class="hljs-slc"> now = _timeProvider.GetUtcNow();</strong>
    // This has a dependency on the current time provided by the system.
    return now.DayOfWeek switch
    {
      DayOfWeek.Saturday or DayOfWeek.Sunday =&gt; 0.2M,
      _ =&gt; 0M
    };
  }
}
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">TestingWithTimeProvider</code> project, in <code class="inlineCode">TimeTests.cs</code>, add statements to both tests to<a id="_idIndexMarker611"/> show how we could use the <a id="_idIndexMarker612"/>new <code class="inlineCode">TimeProvider</code> and its <code class="inlineCode">System</code> property (which would still have a dependency<a id="_idIndexMarker613"/> on the system clock!), as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">// This would use the .NET 8 or later dependency service,
// but its implementation is still the system clock.
DiscountService service = new(TimeProvider.System);
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">TestingWithTimeProvider</code> project, add a reference to <code class="inlineCode">Moq</code>, a package to mock dependencies, as shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;!-- The newest version before the controversy. --&gt;
&lt;PackageReference Include="Moq" Version="4.18.4" /&gt;
</code></pre>
      
    <div><p class="normal">Moq 4.18.4 was the last version released before a controversy erupted when the developer added obfuscated code that executed during builds. You can read more about this at the following link: <a href="https://github.com/devlooped/moq/issues/1370">https://github.com/devlooped/moq/issues/1370</a>. I plan to keep an eye on the situation over the next few months and then decide whether I should switch to an alternative.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">In <code class="inlineCode">TimeTests.cs</code>, import the namespace to use the <code class="inlineCode">Mock.Of&lt;T&gt;</code> extension method, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using Moq; // To use Mock.Of&lt;T&gt; method.
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">TestDiscountDuringWorkdays</code> method, comment out the statement that used the <code class="inlineCode">System</code> provider, and <a id="_idIndexMarker614"/>replace it with statements to mock a time provider that always<a id="_idIndexMarker615"/> returns a fixed date and time during workdays, as highlighted in the<a id="_idIndexMarker616"/> following code:
        <pre class="programlisting code"><code class="hljs-code">TimeProvider timeProvider = Mock.Of&lt;TimeProvider&gt;();
// Mock the time provider so it always returns the date of
// 2023-11-07 09:30:00 UTC which is a Tuesday.
Mock.Get(timeProvider).Setup(s =&gt; s.GetUtcNow()).Returns(
  new DateTimeOffset(year: 2023, month: 11, day: 7, 
  hour: 9, minute: 30, second: 0, offset: TimeSpan.Zero));
DiscountService service = new(timeProvider);
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">TestDiscountDuringWeekends</code> method, comment out the statement that used the <code class="inlineCode">System</code> provider and replace it with statements to mock a time provider that always returns a fixed date and time at the weekend, as highlighted in the following code:
        <pre class="programlisting code"><code class="hljs-code">TimeProvider timeProvider = Mock.Of&lt;TimeProvider&gt;();
// Mock the time provider so it always returns the date of
// 2023-11-04 09:30:00 UTC which is a Saturday.
Mock.Get(timeProvider).Setup(s =&gt; s.GetUtcNow()).Returns(
  new DateTimeOffset(year: 2023, month: 11, day: 4, 
  hour: 9, minute: 30, second: 0, offset: TimeSpan.Zero));
DiscountService service = new(timeProvider);
</code></pre>
      </li>
      <li class="numberedList">Run the unit tests, and note that they both succeed.</li>
    </ol>
    <h1 class="heading-1" id="_idParaDest-281">Working with time zones</h1>
    <p class="normal">In the code example<a id="_idIndexMarker617"/> about the .NET release party, using a <code class="inlineCode">TimeOnly</code> was not actually a good idea because the <code class="inlineCode">TimeOnly</code> value did not include information about the time zone. It is only useful if you are in the correct time zone. <code class="inlineCode">TimeOnly</code> is, therefore, a poor choice for an event. For events, we need to understand and handle time zones.</p>
    <h2 class="heading-2" id="_idParaDest-282">Understanding DateTime and TimeZoneInfo</h2>
    <p class="normal">The <code class="inlineCode">DateTime</code> class<a id="_idIndexMarker618"/> has many <a id="_idIndexMarker619"/>useful members related to time zones, as <a id="_idIndexMarker620"/>shown in <em class="italic">Table 7.4</em>:</p>
    <table class="table-container" id="table004-5">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Member</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Now</code> property</p>
          </td>
          <td class="table-cell">
            <p class="normal">A <code class="inlineCode">DateTime</code> value that represents the current date and time in the local time zone.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">UtcNow</code> property</p>
          </td>
          <td class="table-cell">
            <p class="normal">A <code class="inlineCode">DateTime</code> value that represents the current date and time in the UTC time zone.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Kind</code> property</p>
          </td>
          <td class="table-cell">
            <p class="normal">A <code class="inlineCode">DateTimeKind</code> value that indicates whether the <code class="inlineCode">DateTime</code> value is <code class="inlineCode">Unspecified</code>, <code class="inlineCode">Utc</code>, or <code class="inlineCode">Local</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">IsDaylightSavingTime</code> method</p>
          </td>
          <td class="table-cell">
            <p class="normal">A <code class="inlineCode">bool</code> that indicates if the <code class="inlineCode">DateTime</code> value is during DST.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">ToLocalTime</code> method</p>
          </td>
          <td class="table-cell">
            <p class="normal">Converts a UTC <code class="inlineCode">DateTime</code> value to the equivalent local time.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">ToUniversalTime</code> method</p>
          </td>
          <td class="table-cell">
            <p class="normal">Converts a local <code class="inlineCode">DateTime</code> value to the equivalent UTC time.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 7.4: DateTime members related to time zones</p>
    <p class="normal">The <code class="inlineCode">TimeZoneInfo</code> class has many <a id="_idIndexMarker621"/>useful members, as shown in <em class="italic">Table 7.5</em>:</p>
    <table class="table-container" id="table005-4">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Member</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Id</code> property</p>
          </td>
          <td class="table-cell">
            <p class="normal">A <code class="inlineCode">string</code> that uniquely identifies the time zone.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Local</code> property</p>
          </td>
          <td class="table-cell">
            <p class="normal">A <code class="inlineCode">TimeZoneInfo</code> value that represents the current local time zone. Varies depending on where the code executes.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Utc</code> property</p>
          </td>
          <td class="table-cell">
            <p class="normal">A <code class="inlineCode">TimeZoneInfo</code> value that represents the UTC time zone.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">StandardName</code> property</p>
          </td>
          <td class="table-cell">
            <p class="normal">A <code class="inlineCode">string</code> for the name of the time zone when Daylight Saving is not active.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">DaylightName</code> property</p>
          </td>
          <td class="table-cell">
            <p class="normal">A <code class="inlineCode">string</code> for the name of the time zone when Daylight Saving is active.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">DisplayName</code> property</p>
          </td>
          <td class="table-cell">
            <p class="normal">A <code class="inlineCode">string</code> for the general name of the time zone.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">BaseUtcOffset</code> property</p>
          </td>
          <td class="table-cell">
            <p class="normal">A <code class="inlineCode">TimeSpan</code> that represents the difference between this time zone and the UTC time zone, ignoring any potential Daylight Saving adjustments.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">SupportsDaylightSavingTime</code> property</p>
          </td>
          <td class="table-cell">
            <p class="normal">A <code class="inlineCode">bool</code> that indicates whether this time zone has Daylight Saving adjustments.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">ConvertTime</code> method</p>
          </td>
          <td class="table-cell">
            <p class="normal">Converts a <code class="inlineCode">DateTime</code> value to another <code class="inlineCode">DateTime</code> value in a different time zone. You can specify the source and destination time zones.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">ConvertTimeFromUtc</code> method</p>
          </td>
          <td class="table-cell">
            <p class="normal">Converts a <code class="inlineCode">DateTime</code> value in the UTC time zone to a <code class="inlineCode">DateTime</code> value in a specified time zone.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">ConvertTimeToUtc</code> method</p>
          </td>
          <td class="table-cell">
            <p class="normal">Converts a <code class="inlineCode">DateTime</code> value in a specified time zone to a <code class="inlineCode">DateTime</code> value in the UTC time zone.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">IsDaylightSavingTime</code> method</p>
          </td>
          <td class="table-cell">
            <p class="normal">Returns a <code class="inlineCode">bool</code>, indicating whether the <code class="inlineCode">DateTime</code> value is in Daylight Saving.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">GetSystemTimeZones</code> method</p>
          </td>
          <td class="table-cell">
            <p class="normal">Returns<a id="_idIndexMarker622"/> a collection of time zones registered with the operating system.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 7.5: TimeZoneInfo useful members</p>
    <div><p class="normal">Some <a id="_idIndexMarker623"/>database providers for EF Core only allow you to store <code class="inlineCode">DateTime</code> values<a id="_idIndexMarker624"/> that use the <code class="inlineCode">Kind</code> property to determine whether it is UTC, so you might need to convert to and from <code class="inlineCode">DateTimeOffset</code> if you need to work with these values.</p>
    </div>
    <h2 class="heading-2" id="_idParaDest-283">Exploring DateTime and TimeZoneInfo</h2>
    <p class="normal">Use the <code class="inlineCode">TimeZoneInfo</code> class to <a id="_idIndexMarker625"/>work with time zones:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code> project named <code class="inlineCode">WorkingWithTimeZones</code> to the <code class="inlineCode">Chapter07</code> solution:<ol class="numberedList" style="list-style-type: decimal;">
          <li class="numberedList" value="1">In Visual Studio 2022, set <strong class="screenText">Startup Project</strong> to <strong class="screenText">Current selection</strong>.</li>
          <li class="numberedList">Treat warnings as errors, and statically and globally import the <code class="inlineCode">System.Console</code> class.</li>
        </ol>
      </li>
      <li class="numberedList">Add a new class file named <code class="inlineCode">Program.Helpers.cs</code>.</li>
      <li class="numberedList">Modify its contents to define some helper methods to output a section title in a visually different way, output a list of all time zones in the current system, and output <a id="_idIndexMarker626"/>details about a <code class="inlineCode">DateTime</code> or <code class="inlineCode">TimeZoneInfo</code> object, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using System.Collections.ObjectModel; // To use ReadOnlyCollection&lt;T&gt;
partial class Program
{
  private static void SectionTitle(string title)
  {
    ConsoleColor previousColor = ForegroundColor;
    ForegroundColor = ConsoleColor.DarkYellow;
    WriteLine($"*** {title}");
    ForegroundColor = previousColor;
  }
  private static void OutputTimeZones()
  {
    // get the time zones registered with the OS
    ReadOnlyCollection&lt;TimeZoneInfo&gt; zones = 
      TimeZoneInfo.GetSystemTimeZones();
    WriteLine($"*** {zones.Count} time zones:");
    // order the time zones by Id instead of DisplayName
    foreach (TimeZoneInfo zone in zones.OrderBy(z =&gt; z.Id))
    {
      WriteLine($"{zone.Id}");
    }
  }
  private static void OutputDateTime(DateTime dateTime, string title)
  {
    SectionTitle(title);
    WriteLine($"Value: {dateTime}");
    WriteLine($"Kind: {dateTime.Kind}");
    WriteLine($"IsDaylightSavingTime: {dateTime.IsDaylightSavingTime()}");
    WriteLine($"ToLocalTime(): {dateTime.ToLocalTime()}");
    WriteLine($"ToUniversalTime(): {dateTime.ToUniversalTime()}");
  }
  private static void OutputTimeZone(TimeZoneInfo zone, string title)
  {
    SectionTitle(title);
    WriteLine($"Id: {zone.Id}");
    WriteLine($"IsDaylightSavingTime(DateTime.Now): {
      zone.IsDaylightSavingTime(DateTime.Now)}");
    WriteLine($"StandardName: {zone.StandardName}");
    WriteLine($"DaylightName: {zone.DaylightName}");
    WriteLine($"BaseUtcOffset: {zone.BaseUtcOffset}");
  }
  private static string GetCurrentZoneName(TimeZoneInfo zone, DateTime when)
  {
    // time zone names change if Daylight Saving time is active
    // e.g. GMT Standard Time becomes GMT Summer Time
    return zone.IsDaylightSavingTime(when) ?
      zone.DaylightName : zone.StandardName;
  }
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete<a id="_idIndexMarker627"/> the existing statements. Add statements to output the current date and time in the local and UTC time zones, and then output details about the local and UTC time zones, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">OutputTimeZones();
OutputDateTime(DateTime.Now, "DateTime.Now");
OutputDateTime(DateTime.UtcNow, "DateTime.UtcNow");
OutputTimeZone(TimeZoneInfo.Local, "TimeZoneInfo.Local");
OutputTimeZone(TimeZoneInfo.Utc, "TimeZoneInfo.Utc");
</code></pre>
      </li>
      <li class="numberedList">Run the console app and note the results, including the time zones registered on your operating system (there are 141 on my Windows 11 laptop), and that it is currently 4:17 PM on 31 May 2022 in England, meaning I am in the GMT Standard Time zone. However, because DST is active, it is currently known<a id="_idIndexMarker628"/> as GMT Summer Time, which is one hour ahead of UTC, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">*** 141 time zones:
Afghanistan Standard Time
Alaskan Standard Time
...
West Pacific Standard Time
Yakutsk Standard Time
Yukon Standard Time
*** DateTime.Now
Value: 31/05/2022 16:17:03
Kind: Local
IsDaylightSavingTime: True
ToLocalTime(): 31/05/2022 16:17:03
ToUniversalTime(): 31/05/2022 15:17:03
*** DateTime.UtcNow
Value: 31/05/2022 15:17:03
Kind: Utc
IsDaylightSavingTime: False
ToLocalTime(): 31/05/2022 16:17:03
ToUniversalTime(): 31/05/2022 15:17:03
*** TimeZoneInfo.Local
Id: GMT Standard Time
IsDaylightSavingTime(DateTime.Now): True
StandardName: GMT Standard Time
DaylightName: GMT Summer Time
BaseUtcOffset: 00:00:00
*** TimeZoneInfo.Utc
Id: UTC
IsDaylightSavingTime(DateTime.Now): False
StandardName: Coordinated Universal Time
DaylightName: Coordinated Universal Time
BaseUtcOffset: 00:00:00
</code></pre>
      
    <div><p class="normal">The <code class="inlineCode">BaseUtcOffset</code> of the <strong class="keyWord">GMT Standard Time</strong> zone is zero because normally Daylight Saving is not active. That is why it is prefixed with <code class="inlineCode">Base</code>.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">In <code class="inlineCode">Program.cs</code>, add statements to prompt the user to enter a time zone (using Eastern Standard Time as a default), get that time zone, output details about it, and then compare a time entered by the user with the equivalent time<a id="_idIndexMarker629"/> in the other time zone, and catch potential exceptions, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">Write("Enter a time zone or press Enter for US East Coast: ");
string zoneId = ReadLine()!;
if (string.IsNullOrEmpty(zoneId))
{
  zoneId = "Eastern Standard Time";
}
try
{
  TimeZoneInfo otherZone = TimeZoneInfo.FindSystemTimeZoneById(zoneId);
  OutputTimeZone(otherZone,
    $"TimeZoneInfo.FindSystemTimeZoneById(\"{zoneId}\")");
  SectionTitle($"What's the time in {zoneId}?");
  Write("Enter a local time or press Enter for now: ");
  string? timeText = ReadLine();
  DateTime localTime;
  if (string.IsNullOrEmpty(timeText) || 
    !DateTime.TryParse(timeText, out localTime))
  {
    localTime = DateTime.Now;
  }
  DateTime otherZoneTime = TimeZoneInfo.ConvertTime(
    dateTime: localTime, sourceTimeZone: TimeZoneInfo.Local,
    destinationTimeZone: otherZone);
  WriteLine($"{localTime} {GetCurrentZoneName(TimeZoneInfo.Local,
    localTime)} is {otherZoneTime} {GetCurrentZoneName(otherZone,
    otherZoneTime)}.");
}
catch (TimeZoneNotFoundException)
{
  WriteLine($"The {zoneId} zone cannot be found on the local system.");
}
catch (InvalidTimeZoneException)
{
  WriteLine($"The {zoneId} zone contains invalid or missing data.");
}
catch (System.Security.SecurityException)
{
  WriteLine("The application does not have permission to read time zone information.");
}
catch (OutOfMemoryException)
{
  WriteLine($"Not enough memory is available to load information on the {zoneId} zone.");
}
</code></pre>
      </li>
      <li class="numberedList">Run the console app, press <em class="keystroke">Enter</em> for US East Coast, then enter <code class="inlineCode">12:30pm</code> for the local time, and <a id="_idIndexMarker630"/>note the results, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">Enter a time zone or press Enter for US East Coast:
*** TimeZoneInfo.FindSystemTimeZoneById("Eastern Standard Time")
Id: Eastern Standard Time
IsDaylightSavingTime(DateTime.Now): True
StandardName: Eastern Standard Time
DaylightName: Eastern Summer Time
BaseUtcOffset: -05:00:00
*** What's the time in Eastern Standard Time?
Enter a local time or press Enter for now: 12:30pm
31/05/2023 12:30:00 GMT Summer Time is 31/05/2023 07:30:00 Eastern Summer Time.
</code></pre>
      
    <div><p class="normal">My local time zone is GMT Standard Time, so there is currently a five-hour time difference between me and the US East Coast. Your local time zone will be different.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="8">Run the console app, copy one of the time zones to the clipboard, paste it at the prompt, and then press <em class="keystroke">Enter</em> for the local time. Note the results, as shown in the<a id="_idIndexMarker631"/> following output:
        <pre class="programlisting con"><code class="hljs-con">Enter a time zone or press Enter for US East Coast: AUS Eastern Standard Time
*** TimeZoneInfo.FindSystemTimeZoneById("AUS Eastern Standard Time")
Id: AUS Eastern Standard Time
IsDaylightSavingTime(DateTime.Now): False
StandardName: AUS Eastern Standard Time
DaylightName: AUS Eastern Summer Time
BaseUtcOffset: 10:00:00
*** What's the time in AUS Eastern Standard Time?
Enter a local time or press Enter for now:
31/05/2023 17:00:04 GMT Summer Time is 01/06/2023 02:00:04 AUS Eastern Standard Time.
</code></pre>
      </li>
    </ol>
    <div><p class="normal">Sydney, Australia, is currently nine hours ahead, so at about 5 PM for me, it is about 2 AM on the following day for them.</p>
    </div>
    <p class="normal">That’s a lot to learn about dates, times, and time zones. But we aren’t done yet. Now, we need to look at the wider topic of cultures, which are a combination of language and region and do not just affect date and time formatting.</p>
    <h1 class="heading-1" id="_idParaDest-284">Working with cultures</h1>
    <p class="normal">Internationalization is <a id="_idIndexMarker632"/>the process of enabling your code to correctly run all over the <a id="_idIndexMarker633"/>world. It has two parts, <strong class="keyWord">globalization</strong> and <strong class="keyWord">localization</strong>, and both of them are about <a id="_idIndexMarker634"/>working with cultures.</p>
    <p class="normal">Globalization is about writing your code to accommodate multiple languages and region combinations. The combination of a language and a region is known as a culture. It is important for your code to know both the language and region because, for example, the date and currency formats are different in Quebec and Paris, despite them both using the French language.</p>
    <p class="normal">There are <strong class="keyWord">International Organization for Standardization</strong> (<strong class="keyWord">ISO</strong>) codes for all culture combinations. For example, in the <a id="_idIndexMarker635"/>code <code class="inlineCode">da-DK</code>, <code class="inlineCode">da</code> indicates the Danish language and <code class="inlineCode">DK</code> indicates the Denmark region, and in the code <code class="inlineCode">fr-CA</code>, <code class="inlineCode">fr</code> indicates the French language and <code class="inlineCode">CA</code> indicates the Canada region.</p>
    <div><p class="normal">ISO is not just an acronym. ISO is a reference to the Greek word <em class="italic">isos</em> (which means <em class="italic">equal</em>). You can see a list of ISO culture codes at the following link: <a href="https://lonewolfonline.net/list-net-culture-country-codes/">https://lonewolfonline.net/list-net-culture-country-codes/</a>.</p>
    </div>
    <p class="normal">Localization is about customizing the user interface to support a language, for example, changing the label of <a id="_idIndexMarker636"/>a button to <strong class="screenText">Close</strong> (<code class="inlineCode">en</code>) or <strong class="screenText">Fermer</strong> (<code class="inlineCode">fr</code>). Since localization is more about the language, it doesn’t always need to know about the region, although, ironically enough, the words <em class="italic">standardization</em> (<code class="inlineCode">en-US</code>) and <em class="italic">standardisation</em> (<code class="inlineCode">en-GB</code>) suggest otherwise.</p>
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: I am not a professional translator of software user interfaces, so take all examples in this chapter as general guidance. My research into French user interface labeling common practice led me to the following links, but it would be best to hire a professional if you are not a native language speaker: <a href="https://french.stackexchange.com/questions/12969/translation-of-it-terms-like-close-next-search-etc">https://french.stackexchange.com/questions/12969/translation-of-it-terms-like-close-next-search-etc</a> and <a href="https://www.linguee.com/english-french/translation/close+button.html">https://www.linguee.com/english-french/translation/close+button.html</a>.</p>
    </div>
    <h2 class="heading-2" id="_idParaDest-285">Detecting and changing the current culture</h2>
    <p class="normal">Internationalization is a huge topic on which thousand-page books have been written. In this section, you will get a brief<a id="_idIndexMarker637"/> introduction to the basics, using<a id="_idIndexMarker638"/> the <code class="inlineCode">CultureInfo</code> and <code class="inlineCode">RegionInfo</code> types in the <code class="inlineCode">System.Globalization</code> namespace.</p>
    <p class="normal">Let’s write some code:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code> project named <code class="inlineCode">WorkingWithCultures</code> to the <code class="inlineCode">Chapter07</code> solution.<ul>
          <li class="bulletList">In the project file, treat warnings as errors, and then statically and globally import the <code class="inlineCode">System.Console</code> class, and globally import the <code class="inlineCode">System.Globalization</code> namespace so that we can use the <code class="inlineCode">CultureInfo</code> class, as shown in the following markup:</li>
        </ul>
        <pre class="programlisting code"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;Using Include="System.Console" Static="true" /&gt;
  &lt;Using Include="System.Globalization" /&gt;
&lt;/ItemGroup&gt;
</code></pre>
      </li>
      <li class="numberedList">Add a new class file named <code class="inlineCode">Program.Helpers.cs</code>, and modify its contents to add a method to<a id="_idIndexMarker639"/> the partial <code class="inlineCode">Program</code> class that will output information about the cultures<a id="_idIndexMarker640"/> used for globalization and localization, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">partial class Program
{
  private static void OutputCultures(string title)
  {
    ConsoleColor previousColor = ForegroundColor;
    ForegroundColor = ConsoleColor.DarkYellow;
    WriteLine($"*** {title}");
    // Get the cultures from the current thread.
    CultureInfo globalization = CultureInfo.CurrentCulture;
    CultureInfo localization = CultureInfo.CurrentUICulture;
    WriteLine($"The current globalization culture is {
      globalization.Name}: {globalization.DisplayName}");
    WriteLine($"The current localization culture is {
      localization.Name}: {localization.DisplayName}");
    WriteLine($"Days of the week: {string.Join(", ",
      globalization.DateTimeFormat.DayNames)}");
    WriteLine($"Months of the year: {string.Join(", ",
      globalization.DateTimeFormat.MonthNames
      // Some have 13 months; most 12, and the last is empty.
      .TakeWhile(month =&gt; !string.IsNullOrEmpty(month)))}");
    WriteLine($"1st day of this year: {new DateTime(
      year: DateTime.Today.Year, month: 1, day: 1)
      .ToString("D", globalization)}");
    WriteLine($"Number group separator: {globalization
      .NumberFormat.NumberGroupSeparator}");
    WriteLine($"Number decimal separator: {globalization
      .NumberFormat.NumberDecimalSeparator}");
    RegionInfo region = new(globalization.LCID);
    WriteLine($"Currency symbol: {region.CurrencySymbol}");
    WriteLine($"Currency name: {region.CurrencyNativeName} ({
      region.CurrencyEnglishName})");
    WriteLine($"IsMetric: {region.IsMetric}");
    WriteLine();
    ForegroundColor = previousColor;
  }
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete the existing statements, and add statements to set the output encoding of the console to support Unicode. Then, output information about the globalization and localization cultures. Finally, prompt the user to <a id="_idIndexMarker641"/>enter a new culture code and show how that affects the formatting of <a id="_idIndexMarker642"/>common values, such as dates and currency, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">// To enable special characters like €.
OutputEncoding = System.Text.Encoding.UTF8;
OutputCultures("Current culture");
WriteLine("Example ISO culture codes:");
string[] cultureCodes = { 
  "da-DK", "en-GB", "en-US", "fa-IR", 
  "fr-CA", "fr-FR", "he-IL", "pl-PL", "sl-SI" };
foreach (string code in cultureCodes)
{
  CultureInfo culture = CultureInfo.GetCultureInfo(code);
  WriteLine($"  {culture.Name}: {culture.EnglishName} / {
    culture.NativeName}");
}
 
WriteLine();
Write("Enter an ISO culture code: ");
string? cultureCode = ReadLine();
if (string.IsNullOrWhiteSpace(cultureCode))
{
  cultureCode = "en-US";
}  
CultureInfo ci;
try
{
  ci = CultureInfo.GetCultureInfo(cultureCode);
}
catch (CultureNotFoundException)
{
  WriteLine($"Culture code not found: {cultureCode}");
  WriteLine("Exiting the app.");
  return;
}
// change the current cultures on the thread
CultureInfo.CurrentCulture = ci;
CultureInfo.CurrentUICulture = ci;
OutputCultures("After changing the current culture");
Write("Enter your name: ");
string? name = ReadLine();
if (string.IsNullOrWhiteSpace(name))
{
  name = "Bob";
}
Write("Enter your date of birth: ");
string? dobText = ReadLine();
if (string.IsNullOrWhiteSpace(dobText))
{
  // If they do not enter a DOB then use
  // sensible defaults for their culture.
  dobText = ci.Name switch
    {
      "en-US" or "fr-CA" =&gt; "1/27/1990",
      "da-DK" or "fr-FR" or "pl-PL" =&gt; "27/1/1990",
      "fa-IR" =&gt; "1990/1/27",
      _ =&gt; "1/27/1990"
    };
}
Write("Enter your salary: ");
string? salaryText = ReadLine();
if (string.IsNullOrWhiteSpace(salaryText))
{
  salaryText = "34500";
}
DateTime dob = DateTime.Parse(dobText);
int minutes = (int)DateTime.Today.Subtract(dob).TotalMinutes;
decimal salary = decimal.Parse(salaryText);
WriteLine($"{name} was born on a {dob:dddd}. {name} is {
  minutes:N0} minutes old. {name} earns {salary:C}.");
</code></pre>
      
    <p class="normal">When you run an<a id="_idIndexMarker643"/> application, it automatically sets its thread to use the culture of the operating system. I am running my code in London, UK, so the thread is set to English (Great Britain).</p>
    <p class="normal">The code prompts<a id="_idIndexMarker644"/> the user to enter an alternative ISO code. This allows your applications to replace the default culture at runtime.</p>
    <p class="normal">The application then uses standard format codes to output the day of the week using format code <code class="inlineCode">dddd</code>, the number of minutes with thousand separators using format code <code class="inlineCode">N0</code>, and the salary with the currency symbol. These adapt automatically, based on the thread’s culture.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Run the code and enter <code class="inlineCode">en-US</code> for the ISO code (or press <em class="keystroke">Enter</em>), and then enter some sample data, including<a id="_idIndexMarker645"/> a date in a format valid for US English, as shown in the <a id="_idIndexMarker646"/>following output:
        <pre class="programlisting con"><code class="hljs-con">*** Current culture
The current globalization culture is en-GB: English (United Kingdom)
The current localization culture is en-GB: English (United Kingdom)
Days of the week: Sunday, Monday, Tuesday, Wednesday, Thursday, Friday, Saturday
Months of the year: January, February, March, April, May, June, July, August, September, October, November, December
1st day of this year: 01 January 2023
Number group separator: ,
Number decimal separator: .
Currency symbol: £
Currency name: British Pound (British Pound)
IsMetric: True
Example ISO culture codes:
  da-DK: Danish (Denmark) / dansk (Danmark)
  en-GB: English (United Kingdom) / English (United Kingdom)
  en-US: English (United States) / English (United States)
  fa-IR: Persian (Iran) / فارسی (ایران)
  fr-CA: French (Canada) / français (Canada)
  fr-FR: French (France) / français (France)
  he-IL: Hebrew (Israel) / עברית (ישראל)
  pl-PL: Polish (Poland) / polski (Polska)
  sl-SI: Slovenian (Slovenia) / slovenščina (Slovenija)
Enter an ISO culture code: en-US
*** After changing the current culture
The current globalization culture is en-US: English (United States)
The current localization culture is en-US: English (United States)
Days of the week: Sunday, Monday, Tuesday, Wednesday, Thursday, Friday, Saturday
Months of the year: January, February, March, April, May, June, July, August, September, October, November, December
1st day of this year: Sunday, January 1, 2023
Number group separator: ,
Number decimal separator: .
Currency symbol: $
Currency name: US Dollar (US Dollar)
IsMetric: False
Enter your name: Alice
Enter your date of birth: 3/30/1967
Enter your salary: 34500
Alice was born on a Thursday. Alice is 29,541,600 minutes old. Alice earns $34,500.00
</code></pre>
      </li>
      <li class="numberedList">Run the <a id="_idIndexMarker647"/>code again, and try Danish in Denmark (<code class="inlineCode">da-DK</code>), as shown<a id="_idIndexMarker648"/> in the following output:
        <pre class="programlisting con"><code class="hljs-con">Enter an ISO culture code: da-DK
*** After changing the current culture
The current globalization culture is da-DK: dansk (Danmark)
The current localization culture is da-DK: dansk (Danmark)
Days of the week: søndag, mandag, tirsdag, onsdag, torsdag, fredag, lørdag
Months of the year: januar, februar, marts, april, maj, juni, juli, august, september, oktober, november, december
1st day of this year: søndag den 1. januar 2023
Number group separator: .
Number decimal separator: ,
Currency symbol: kr.
Currency name: dansk krone (Danish Krone)
IsMetric: True
Enter your name: Mikkel
Enter your date of birth: 16/3/1980
Enter your salary: 65000
Mikkel was born on a søndag. Mikkel is 22.723.200 minutes old. Mikkel earns 65.000,00 kr..
</code></pre>
      
    <p class="normal">In this example, only the date and salary are globalized into Danish. The rest of the text is hardcoded as English. Later, we will translate that English text into other languages. For now, let’s see some other differences between cultures.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Run the code again, and try Polish in Poland (<code class="inlineCode">pl-PL</code>). Note that the grammar rules in Polish <a id="_idIndexMarker649"/>make the day number possessive for the month name, so the month <code class="inlineCode">styczeń</code> becomes <code class="inlineCode">stycznia</code>, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">The current globalization culture is pl-PL: polski (Polska)
...
Months of the year: styczeń, luty, marzec, kwiecień, maj, czerwiec, lipiec, sierpień, wrzesień, październik, listopad, grudzień
1st day of this year: niedziela, 1 stycznia 2023
...
Enter your name: Bob
Enter your date of birth: 1972/4/16
Enter your salary: 50000
Bob was born on a niedziela. Bob is 26 886 240 minutes old. Bob earns 50 000,00 zł.
</code></pre>
      </li>
      <li class="numberedList">Run the code again, and try Persian in Iran (<code class="inlineCode">fa-IR</code>). Note that dates in Iran must be specified as year/month/day, and that this year (2023) is the year 1401 in the Persian <a id="_idIndexMarker650"/>calendar, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">The current globalization culture is fa-IR: فارسی (ایران)
The current localization culture is fa-IR: فارسی (ایران)
Days of the week: یکشنبه, دوشنبه, سهشنبه, چهارشنبه, پنجشنبه, جمعه, شنبه
Months of the year: فروردین, اردیبهشت, خرداد, تیر, مرداد, شهریور, مهر, آبان, آذر, دی, بهمن, اسفند
1st day of this year: 1401 دی 11, شنبه
Number group separator: ٬
Number decimal separator: ٫
Currency symbol: ریال
Currency name: ریال ایران (Iranian Rial)
IsMetric: True
Enter your name: Cyrus
Enter your date of birth: 1372/4/16
Enter your salary: 50000
Cyrus was born on a چهارشنبه. Cyrus is 15٬723٬360 minutes old. Cyrus earns ریال50٬000.
</code></pre>
      </li>
    </ol>
    <div><p class="normal">Although I tried to confirm with a Persian reader whether this example is correct, due to factors like right-to-left languages being tricky to work with in console apps and copying and pasting from a console window into a word processor, I apologize in advance to my Persian readers if this example is all messed up!</p>
    </div>
    <h2 class="heading-2" id="_idParaDest-286">Temporarily using the invariant culture</h2>
    <p class="normal">Sometimes, you might need to<a id="_idIndexMarker651"/> temporarily use a different culture without switching the current thread to that culture. For example, when automatically generating documents, queries, and commands that include data values, you might need to ignore your current culture and use a more standardized culture. For this purpose, you can use the invariant culture, which is based on US English.</p>
    <p class="normal">For example, you might need to generate a JSON document with a decimal number value and format the number with two decimal places, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">decimal price = 54321.99M;
string document = $$"""
  {
    "price": "{{price:N2}}"
  }
  """;
</code></pre>
    <p class="normal">If you were to execute this on a Slovenian computer, you would get the following output:</p>
    <pre class="programlisting con"><code class="hljs-con">{
  "price": " 54.321,99"
}
</code></pre>
    <p class="normal">If you then tried to insert this JSON document into a cloud database, it would fail because it would not understand the number format that uses commas for decimals and dots for groups.</p>
    <p class="normal">So you can override the current culture and specify the invariant culture only when outputting the number as a <code class="inlineCode">string</code> value, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">decimal price = 54321.99M;
string document = $$"""
  {
    "price": "{{price.ToString("N2", CultureInfo.InvariantCulture)}}"
  }
  """;
</code></pre>
    <p class="normal">If you were to execute this on a Slovenian (or any other culture) computer, you would now get the following output, which would be successfully recognized by a cloud database and not throw<a id="_idIndexMarker652"/> exceptions:</p>
    <pre class="programlisting con"><code class="hljs-con">{
  "price": " 54,321.99"
}
</code></pre>
    <p class="normal">Now, let’s see how to translate text from one language to another so that the label prompts are in the correct language for the current culture.</p>
    <h2 class="heading-2" id="_idParaDest-287">Localizing your user interface</h2>
    <p class="normal">A localized application is divided <a id="_idIndexMarker653"/>into two parts: </p>
    <ul>
      <li class="bulletList">An assembly containing code that is the same for all locales and contains resources for when no other resource file is found.</li>
      <li class="bulletList">One or more<a id="_idIndexMarker654"/> assemblies that contain the user interface<a id="_idIndexMarker655"/> resources, which are different for different locales. These are known as <strong class="keyWord">satellite assemblies</strong>. </li>
    </ul>
    <p class="normal">This model allows the initial application to be deployed with default invariant resources, and over time, additional satellite assemblies can be deployed as the resources are translated. In the coding task, you will create a console app with embedded invariant culture, and satellite assemblies for Danish, French, French-Canadian, Polish, and Iranian (Persian). To add more cultures in the future, just follow the same steps.</p>
    <p class="normal">User interface resources include any text for messages, logs, dialog boxes, buttons, labels, or even filenames of images, videos, and so on. Resource files are XML files with the <code class="inlineCode">.resx</code> extension. The filename includes a culture code, for example, <code class="inlineCode">PacktResources.en-GB.resx</code> or <code class="inlineCode">PacktResources.da-DK.resx</code>.</p>
    <p class="normal">If a resource file or individual entry is missing, the automatic culture fallback search path for resources goes from specific culture (language and region) to neutral culture (language only) to invariant culture (supposedly independent but, basically, US English). If the current thread culture is <code class="inlineCode">en-AU</code> (Australian English), then it will search for the resource file in the following order:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Australian English: <code class="inlineCode">PacktResources.en-AU.resx</code></li>
      <li class="numberedList">Neutral<a id="_idIndexMarker656"/> English: <code class="inlineCode">PacktResources.en.resx</code></li>
      <li class="numberedList">Invariant: <code class="inlineCode">PacktResources.resx</code></li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-288">Defining and loading resources</h2>
    <p class="normal">To load resources from these satellite assemblies, we use some standard .NET types named <code class="inlineCode">IStringLocalizer&lt;T&gt;</code> and <code class="inlineCode">IStringLocalizerFactory</code>. Implementations of these are loaded from the .NET generic host as<a id="_idIndexMarker657"/> dependency services:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">In the <code class="inlineCode">WorkingWithCultures</code> project, add <a id="_idIndexMarker658"/>package references to Microsoft extensions to work with generic hosting and localization, as shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;PackageReference Include="Microsoft.Extensions.Hosting" 
                    Version="8.0.0" /&gt;
  &lt;PackageReference Include="Microsoft.Extensions.Localization" 
                    Version="8.0.0" /&gt;
&lt;/ItemGroup&gt;
</code></pre>
      </li>
      <li class="numberedList">Build the <code class="inlineCode">WorkingWithCultures</code> project to restore packages.</li>
      <li class="numberedList">In the project folder, create a new folder named <code class="inlineCode">Resources</code>.</li>
      <li class="numberedList">In the <code class="inlineCode">Resources</code> folder, add a new XML file named <code class="inlineCode">PacktResources.resx</code>, and modify the contents to contain default invariant language resources (usually equivalent to US English), as shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;root&gt;
  &lt;data name="EnterYourDob" xml:space="preserve"&gt;
    &lt;value&gt;Enter your date of birth: &lt;/value&gt;
  &lt;/data&gt;
  &lt;data name="EnterYourName" xml:space="preserve"&gt;
    &lt;value&gt;Enter your name: &lt;/value&gt;
  &lt;/data&gt;
  &lt;data name="EnterYourSalary" xml:space="preserve"&gt;
    &lt;value&gt;Enter your salary: &lt;/value&gt;
  &lt;/data&gt;
  &lt;data name="PersonDetails" xml:space="preserve"&gt;
    &lt;value&gt;{0} was born on a {1:dddd}. {0} is {2:N0} minutes old. {0} earns {3:C}.&lt;/value&gt;
  &lt;/data&gt;
&lt;/root&gt;
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">WorkingWithCultures</code> project folder, add a new class file named <code class="inlineCode">PacktResources.cs</code> that<a id="_idIndexMarker659"/> will load text resources for the user interface, as shown in the <a id="_idIndexMarker660"/>following code:
        <pre class="programlisting code"><code class="hljs-code">using Microsoft.Extensions.Localization; // To use IStringLocalizer and so on.
public class PacktResources
{
  private readonly IStringLocalizer&lt;PacktResources&gt; localizer = null!;
  public PacktResources(IStringLocalizer&lt;PacktResources&gt; localizer)
  {
    this.localizer = localizer;
  }
  public string? GetEnterYourNamePrompt()
  {
    string resourceStringName = "EnterYourName";
    // 1. Get the LocalizedString object.
    LocalizedString localizedString = localizer[resourceStringName];
    // 2. Check if the resource string was found.
    if (localizedString.ResourceNotFound)
    {
      ConsoleColor previousColor = ForegroundColor;
      ForegroundColor = ConsoleColor.Red;
      WriteLine($"Error: resource string \"{resourceStringName}\" not found."
        + Environment.NewLine
        + $"Search path: {localizedString.SearchedLocation}");
      ForegroundColor = previousColor;
      return $"{localizedString}: ";
    }
    // 3. Return the found resource string.
    return localizedString;
  }
  public string? GetEnterYourDobPrompt()
  {
    // LocalizedString has an implicit cast to string
    // that falls back to the key if the resource 
    // string is not found.
    return localizer["EnterYourDob"];
  }
  public string? GetEnterYourSalaryPrompt()
  {
    return localizer["EnterYourSalary"];
  }
  public string? GetPersonDetails(
    string name, DateTime dob, int minutes, decimal salary)
  {
    return localizer["PersonDetails", name, dob, minutes, salary];
  }
}
</code></pre>
      
    <div><p class="normal">For the <code class="inlineCode">GetEnterYourNamePrompt</code> method, I broke the implementation down into steps to get useful information, like checking if the resource string is found and showing the search path if not. The other method implementations use a simplified fallback to the key name for the resource string if the resource is not found.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">In <code class="inlineCode">Program.cs</code>, at the top, import the <a id="_idIndexMarker661"/>namespaces to work with hosting <a id="_idIndexMarker662"/>and dependency injection, and then configure a host that enables localization and the <code class="inlineCode">PacktResources</code> service, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using Microsoft.Extensions.Hosting; // To use IHost, Host.
// To use AddLocalization, AddTransient&lt;T&gt;.
using Microsoft.Extensions.DependencyInjection;
using IHost host = Host.CreateDefaultBuilder(args)
  .ConfigureServices(services =&gt;
  {
    services.AddLocalization(options =&gt;
    {
      options.ResourcesPath = "Resources";
    });
    services.AddTransient&lt;PacktResources&gt;();
  })
  .Build();
</code></pre>
      
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: By default, <code class="inlineCode">ResourcesPath</code> is an empty string, meaning it looks for <code class="inlineCode">.resx</code> files in the current directory. We are going to make the project tidier by putting resources into a subfolder.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="7">After changing<a id="_idIndexMarker663"/> the current culture, add a statement to get the <code class="inlineCode">PacktResources</code> service, and use it to output localized prompts for the user to<a id="_idIndexMarker664"/> enter their name, date of birth, and salary. Then, output their details, as highlighted in the following code:
        <pre class="programlisting code"><code class="hljs-code">OutputCultures("After changing the current culture");
<strong class="hljs-slc">PacktResources resources =</strong>
<strong class="hljs-slc">    host.Services.GetRequiredService&lt;PacktResources&gt;();</strong>
Write(<strong class="hljs-slc">resources.GetEnterYourNamePrompt()</strong>);
string? name = ReadLine();
if (string.IsNullOrWhiteSpace(name))
{
  name = "Bob";
}
Write(<strong class="hljs-slc">resources.GetEnterYourDobPrompt()</strong>);
string? dobText = ReadLine();
if (string.IsNullOrWhiteSpace(dobText))
{
  // If they do not enter a DOB then use
  // sensible defaults for their culture.
  dobText = ci.Name switch
    {
      "en-US" or "fr-CA" =&gt; "1/27/1990",
      "da-DK" or "fr-FR" or "pl-PL" =&gt; "27/1/1990",
      "fa-IR" =&gt; "1990/1/27",
      _ =&gt; "1/27/1990"
    };
}
Write(<strong class="hljs-slc">resources.GetEnterYourSalaryPrompt()</strong>);
string? salaryText = ReadLine();
if (string.IsNullOrWhiteSpace(salaryText))
{
  salaryText = "34500";
}
DateTime dob = DateTime.Parse(dobText);
int minutes = (int)DateTime.Today.Subtract(dob).TotalMinutes;
decimal salary = decimal.Parse(salaryText);
WriteLine(<strong class="hljs-slc">resources.GetPersonDetails(name, dob, minutes, salary)</strong>);
</code></pre>
      </li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-289">Testing globalization and localization</h2>
    <p class="normal">Now, we can run the console app <a id="_idIndexMarker665"/>and see the resources being <a id="_idIndexMarker666"/>loaded:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Run the console app <a id="_idIndexMarker667"/>and enter <code class="inlineCode">da-DK</code> for the ISO code. Note that the <a id="_idIndexMarker668"/>prompts are in US English because we currently <a id="_idIndexMarker669"/>only have invariant culture resources.
    <div><p class="normal">To save time and to make sure you have the correct structure, you can copy, paste, and rename the <code class="inlineCode">.resx</code> files instead of creating empty new ones. Or you could copy these files from the GitHub repository for the book.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">In the <code class="inlineCode">Resources</code> folder, add a new XML file named <code class="inlineCode">PacktResources.da.resx</code>, and modify the contents to contain non-region-specific Danish language <a id="_idIndexMarker670"/>resources, as shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;root&gt;
  &lt;data name="EnterYourDob" xml:space="preserve"&gt;
    &lt;value&gt;Indtast din fødselsdato: &lt;/value&gt;
  &lt;/data&gt;
  &lt;data name="EnterYourName" xml:space="preserve"&gt;
    &lt;value&gt;Indtast dit navn: &lt;/value&gt;
  &lt;/data&gt;
  &lt;data name="EnterYourSalary" xml:space="preserve"&gt;
    &lt;value&gt;Indtast din løn: &lt;/value&gt;
  &lt;/data&gt;
  &lt;data name="PersonDetails" xml:space="preserve"&gt;
    &lt;value&gt;{0} blev født på en {1:dddd}. {0} er {2:N0} minutter gammel. {0} tjener {3:C}.&lt;/value&gt;
  &lt;/data&gt;
&lt;/root&gt;
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">Resources</code> folder, add <a id="_idIndexMarker671"/>a new XML file named <code class="inlineCode">PacktResources.fr.resx</code>, and modify the contents to contain non-region-specific<a id="_idIndexMarker672"/> French language resources, as shown in the following<a id="_idIndexMarker673"/> markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;root&gt;
  &lt;data name="EnterYourDob" xml:space="preserve"&gt;
    &lt;value&gt;Entrez votre date de naissance: &lt;/value&gt;
  &lt;/data&gt;
  &lt;data name="EnterYourName" xml:space="preserve"&gt;
    &lt;value&gt;Entrez votre nom: &lt;/value&gt;
  &lt;/data&gt;
  &lt;data name="EnterYourSalary" xml:space="preserve"&gt;
    &lt;value&gt;Entrez votre salaire: &lt;/value&gt;
  &lt;/data&gt;
  &lt;data name="PersonDetails" xml:space="preserve"&gt;
    &lt;value&gt;{0} est né un {1:dddd}. {0} a {2:N0} minutes. {0} gagne {3:C}.&lt;/value&gt;
  &lt;/data&gt;
&lt;/root&gt;
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">Resources</code> folder, add a new XML file named <code class="inlineCode">PacktResources.fr-CA.resx</code>, and modify the contents to contain the French language in Canada region resources, as<a id="_idIndexMarker674"/> shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;root&gt;
  &lt;data name="EnterYourDob" xml:space="preserve"&gt;
    &lt;value&gt;Entrez votre date de naissance / Enter your date of birth: &lt;/value&gt;
  &lt;/data&gt;
  &lt;data name="EnterYourName" xml:space="preserve"&gt;
    &lt;value&gt;Entrez votre nom / Enter your name: &lt;/value&gt;
  &lt;/data&gt;
  &lt;data name="EnterYourSalary" xml:space="preserve"&gt;
    &lt;value&gt;Entrez votre salaire / Enter your salary: &lt;/value&gt;
  &lt;/data&gt;
  &lt;data name="PersonDetails" xml:space="preserve"&gt;
    &lt;value&gt;{0} est né un {1:dddd}. {0} a {2:N0} minutes. {0} gagne {3:C}.&lt;/value&gt;
  &lt;/data&gt;
&lt;/root&gt;
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">Resources</code> folder, add a<a id="_idIndexMarker675"/> new XML file named <code class="inlineCode">PacktResources.pl-PL.resx</code>, and modify the contents to contain the Polish language in<a id="_idIndexMarker676"/> Poland region resources, as <a id="_idIndexMarker677"/>shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;root&gt;
  &lt;data name="EnterYourDob" xml:space="preserve"&gt;
    &lt;value&gt;Wpisz swoją datę urodzenia: &lt;/value&gt;
  &lt;/data&gt;
  &lt;data name="EnterYourName" xml:space="preserve"&gt;
    &lt;value&gt;Wpisz swoje imię i nazwisko: &lt;/value&gt;
  &lt;/data&gt;
  &lt;data name="EnterYourSalary" xml:space="preserve"&gt;
    &lt;value&gt;Wpisz swoje wynagrodzenie: &lt;/value&gt;
  &lt;/data&gt;
  &lt;data name="PersonDetails" xml:space="preserve"&gt;
    &lt;value&gt;{0} urodził się na {1:dddd}. {0} ma {2:N0} minut. {0} zarabia {3:C}.&lt;/value&gt;
  &lt;/data&gt;
&lt;/root&gt;
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">Resources</code> folder, add a new XML file named <code class="inlineCode">PacktResources.fa-IR.resx</code>, and modify<a id="_idIndexMarker678"/> the contents to contain the Farsi language in Iranian region resources, as shown<a id="_idIndexMarker679"/> in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;root&gt;
  &lt;data name="EnterYourDob" xml:space="preserve"&gt;
    &lt;value&gt;تاریخ تولد خود را وارد کنید / Enter your date of birth: &lt;/value&gt;
  &lt;/data&gt;
  &lt;data name="EnterYourName" xml:space="preserve"&gt;
    &lt;value&gt;اسمت را وارد کن / Enter your name: &lt;/value&gt;
  &lt;/data&gt;
  &lt;data name="EnterYourSalary" xml:space="preserve"&gt;
    &lt;value&gt;حقوق خود را وارد کنید / Enter your salary: &lt;/value&gt;
  &lt;/data&gt;
  &lt;data name="PersonDetails" xml:space="preserve"&gt;
    &lt;value&gt;{0} در {1:dddd}به دنیا آمد. {0} {2:N0} دقیقه است. {0} {3:C}.&lt;/value&gt;
  &lt;/data&gt;
&lt;/root&gt;
</code></pre>
      </li>
      <li class="numberedList">Run the code, and <a id="_idIndexMarker680"/>enter <code class="inlineCode">da-DK</code> for the ISO code. Note that the prompts are<a id="_idIndexMarker681"/> in Danish, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">The current localization culture is da-DK: dansk (Danmark)
...
Indtast dit navn: Bob
Indtast din fødselsdato: 3/4/1987
Indtast din løn: 45449
Bob blev født på en fredag. Bob er 19.016.640 minutter gammel. Bob tjener 45.449,00 kr.
</code></pre>
      </li>
      <li class="numberedList">Run the code, and enter <code class="inlineCode">fr-FR</code> for the ISO code. Note that the prompts are in French only, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">The current localization culture is fr-FR: français (France)
...
Entrez votre nom: Monique
Entrez votre date de naissance: 2/12/1990
Entrez votre salaire: 45000
Monique est né un dimanche. Monique a 17 088 480 minutes. Monique gagne 45 000,00 €.
</code></pre>
      </li>
      <li class="numberedList">Run the code, and enter <code class="inlineCode">fr-CA</code> for the ISO <a id="_idIndexMarker682"/>code. Note that the prompts are in French and English<a id="_idIndexMarker683"/> because Canada might have a requirement to support both as official languages, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">The current localization culture is fr-CA: français (Canada)
...
Entrez votre nom / Enter your name: Sophie
Entrez votre date de naissance / Enter your date of birth: 4/5/2001
Entrez votre salaire / Enter your salary: 65000
Sophie est né un jeudi. Sophie a 11 649 600 minutes. Sophie gagne 65 000,00 $ CA.
</code></pre>
      </li>
      <li class="numberedList">Run the code, and enter <code class="inlineCode">fa-IR</code> for the ISO code. Note that the prompts are in Persian/Farsi and English, and there is the additional complication of a right-to-left language, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">The current localization culture is fa-IR: فارسی (ایران)
...
اسمت را وارد کن / Enter your name: Hoshyar
تاریخ تولد خود را وارد کنید / Enter your date of birth: 1370/3/6
حقوق خود را وارد کنید / Enter your salary: 90000
Hoshyar در چهارشنبهبه دنیا آمد. Hoshyar 11٬190٬240 دقیقه است. Hoshyar ریال90٬000.
</code></pre>
      
    <div><p class="normal">If you need to work with Persian dates, then there are NuGet packages with open-source GitHub repositories that you can try, although I cannot vouch for their correctness, like <a href="https://github.com/VahidN/DNTPersianUtils.Core">https://github.com/VahidN/DNTPersianUtils.Core</a> and <a href="https://github.com/imanabidi/PersianDate.NET">https://github.com/imanabidi/PersianDate.NET</a>.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="11">In the <code class="inlineCode">Resources</code> folder, in <code class="inlineCode">PacktResources.da.resx</code>, modify the contents to deliberately change<a id="_idIndexMarker684"/> the key for the prompt to enter<a id="_idIndexMarker685"/> your name, by<a id="_idIndexMarker686"/> appending <code class="inlineCode">Wrong</code>, as highlighted<a id="_idIndexMarker687"/> in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;root&gt;
  &lt;data name="EnterYourDob" xml:space="preserve"&gt;
    &lt;value&gt;Indtast din fødselsdato: &lt;/value&gt;
  &lt;/data&gt;
  &lt;data name="EnterYourName<strong class="hljs-string-slc">Wrong</strong>" xml:space="preserve"&gt;
    &lt;value&gt;Indtast dit navn: &lt;/value&gt;
  &lt;/data&gt;
  &lt;data name="EnterYourSalary" xml:space="preserve"&gt;
    &lt;value&gt;Indtast din løn: &lt;/value&gt;
  &lt;/data&gt;
  &lt;data name="PersonDetails" xml:space="preserve"&gt;
    &lt;value&gt;{0} blev født på en {1:dddd}. {0} er {2:N0} minutter gammel. {0} tjener {3:C}.&lt;/value&gt;
  &lt;/data&gt;
&lt;/root&gt;
</code></pre>
      </li>
      <li class="numberedList">Run the code, and enter <code class="inlineCode">da-DK</code> for the ISO code. Note that the prompts are in Danish, except<a id="_idIndexMarker688"/> for the <code class="inlineCode">Enter your name</code> prompt in English, due to it falling back to the default resource file, as shown in the following <a id="_idIndexMarker689"/>output:
        <pre class="programlisting con"><code class="hljs-con">The current localization culture is da-DK: dansk (Danmark)
...
<strong class="hljs-con-slc">Enter your name</strong>: Bob
Indtast din fødselsdato: 3/4/1987
Indtast din løn: 45449
Bob blev født på en fredag. Bob er 18.413.280 minutter gammel. Bob tjener 45.449,00 kr.
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">Resources</code> folder, in <code class="inlineCode">PacktResources.resx</code>, modify the contents to deliberately change the key for the prompt to enter your name, by appending <code class="inlineCode">Wrong</code>.</li>
      <li class="numberedList">Run the code, and enter <code class="inlineCode">da-DK</code> for the ISO code. Note that the prompts are in Danish, except for the <code class="inlineCode">Enter your name</code> prompt, which shows an error and uses the key name <a id="_idIndexMarker690"/>as a last - resort fallback, as shown in the following <a id="_idIndexMarker691"/>output:
        <pre class="programlisting con"><code class="hljs-con">The current localization culture is da-DK: dansk (Danmark)
...
<strong class="hljs-con-slc">Error: resource string "EnterYourName" not found.</strong>
<strong class="hljs-con-slc">Search path: WorkingWithCultures.Resources.PacktResources</strong>
<strong class="hljs-con-slc">EnterYourName: </strong>Bob
Indtast din fødselsdato: 3/4/1987
Indtast din løn: 45449
Bob blev født på en fredag. Bob er 18.413.280 minutter gammel. Bob tjener 45.449,00 kr.
</code></pre>
      </li>
      <li class="numberedList">Remove <a id="_idIndexMarker692"/>the <code class="inlineCode">Wrong</code> suffix in both resource files.</li>
      <li class="numberedList">In <strong class="screenText">Solution Explorer</strong>, toggle <strong class="screenText">Show All Files</strong>, and expand the <code class="inlineCode">bin/Debug/net8.0/da</code> folder, as <a id="_idIndexMarker693"/>shown in <em class="italic">Figure 7.1</em>:</li>
    </ol>
    <figure class="mediaobject"><img alt="" src="img/B19587_07_01.png"/></figure>
    <p class="packt_figref">Figure 7.1: The satellite assembly folders for culture resources</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="17">Note the satellite assembly named <code class="inlineCode">WorkingWithCultures.resources.dll</code> for the neutral Danish resources.</li>
    </ol>
    <p class="normal">Any other culture resource assemblies are <a id="_idIndexMarker694"/>named the same but stored in folders that match the appropriate culture code. You can use tools like <strong class="keyWord">ResX Resource Manager</strong> (found at the following link: <a href="https://dotnetfoundation.org/projects/resx-resource-manager">https://dotnetfoundation.org/projects/resx-resource-manager</a>) to create many more <code class="inlineCode">.resx</code> files, compile them into satellite assemblies, and then deploy <a id="_idIndexMarker695"/>them to users without needing to recompile the original console app.</p>
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: Consider whether your application needs to be internationalized, and plan for that before you start coding! Think about all the data that will need to be globalized (date formats, number formats, and sorting text behavior). Write down all the pieces of text in the user interface that will need to be localized. </p>
    </div>
    <p class="normal">Microsoft has an online<a id="_idIndexMarker696"/> tool (found at the following<a id="_idIndexMarker697"/> link: <a href="https://www.microsoft.com/en-us/Language/">https://www.microsoft.com/en-us/Language/</a>) that can help you translate text in your user interfaces, as shown in <em class="italic">Figure 7.2</em>: </p>
    <figure class="mediaobject"><img alt="" src="img/B19587_07_02.png"/></figure>
    <p class="packt_figref">Figure 7.2: Microsoft user interface online text translation tool</p>
    <p class="normal">We have now seen lots of date <a id="_idIndexMarker698"/>and time features provided by the .NET BCL. Does it provide<a id="_idIndexMarker699"/> everything we need to handle internationalization? Unfortunately, no. That’s why you will likely want to use Noda Time.</p>
    <h1 class="heading-1" id="_idParaDest-290">Working with Noda Time</h1>
    <p class="normal"><strong class="keyWord">Noda Time</strong> is for developers <a id="_idIndexMarker700"/>who feel that the built-in libraries for handling dates and times are not good enough. Noda Time is like Joda Time, a replacement date/time handling library for Java.</p>
    <div><p class="normal">Noda Time 3.0 or later supports .NET Standard 2.0 and .NET 6 or later. This means that you can use it with legacy platforms like .NET Framework and Xamarin, as well as modern .NET.</p>
    </div>
    <p class="normal">To understand one of the core deficiencies with the built-in .NET date/time types, imagine that instead of defining separate types for numbers, like <code class="inlineCode">int</code> (<code class="inlineCode">System.Int32</code>), <code class="inlineCode">double</code> (<code class="inlineCode">System.Double</code>), and <code class="inlineCode">decimal</code> (<code class="inlineCode">System.Decimal</code>), the .NET team defined only a <code class="inlineCode">System.Number</code> type with a property named <code class="inlineCode">Kind</code> to indicate what kind of number it is, how it is stored in memory, how to handle it, and so on. </p>
    <p class="normal">That is what the team did with <code class="inlineCode">System.DateTime</code>. That type has a <code class="inlineCode">Kind</code> property that indicates if it is a local time, UTC time, or unspecified. It varies in behavior depending on how you treat it. This makes date/time values as implemented in .NET fundamentally tricky to work with and <a id="_idIndexMarker701"/>understand.</p>
    <div><p class="normal"><strong class="keyWord">More Information</strong>: Jon Skeet, the creator of Noda Time, has a lot more to say about the limitations of date/time support in .NET and <code class="inlineCode">DateTime</code>, specifically in a 2011 blog post found at the following link: <a href="https://blog.nodatime.org/2011/08/what-wrong-with-datetime-anyway.html">https://blog.nodatime.org/2011/08/what-wrong-with-datetime-anyway.html</a></p>
    </div>
    <h2 class="heading-2" id="_idParaDest-291">Important concepts and defaults in Noda Time</h2>
    <p class="normal">The built-in <code class="inlineCode">DateTime</code> type stores both global and local values, or values that are unspecified. Unless treated with great care, this opens the door to subtle bugs and misunderstandings.</p>
    <p class="normal">The first big difference with Noda Time is that<a id="_idIndexMarker702"/> it forces you to make a choice at the type level. Noda Time, therefore, has more types and, at first, can seem more confusing. Types in Noda Time are global or local. Every person anywhere in the world would share the same global values at the same instant, whereas each person would have a different local value, depending on factors like their time zone.</p>
    <p class="normal">The built-in date/time types in .NET are only accurate to the tick, which is about 100 nanoseconds. Noda Time is accurate to 1 nanosecond, 100 times more accurate.</p>
    <p class="normal">The “zero” baseline in Noda<a id="_idIndexMarker703"/> Time is midnight at the start of 1 January 1970 in the UTC time zone. The Noda Time <code class="inlineCode">Instant</code> is the number of nanoseconds before (if a negative value) or since (if a positive value) that time and represents a point in time on the global timeline.</p>
    <p class="normal">The default calendaring system in Noda Time is the ISO-8601 calendar because it is the standard, and you can read more about it at the following link: <a href="https://en.wikipedia.org/wiki/ISO_8601">https://en.wikipedia.org/wiki/ISO_8601</a>. Automatic conversions to other calendaring systems like Julian, Coptic, and Buddhist are supported.</p>
    <p class="normal">Noda Time has some common types<a id="_idIndexMarker704"/> that are like some .NET date/time types, as summarized in <em class="italic">Table 7.6</em>:</p>
    <table class="table-container" id="table006-3">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Noda Time type</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Instant</code> struct</p>
          </td>
          <td class="table-cell">
            <p class="normal">Represents an instant on the global timeline, with nanosecond resolution.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Interval</code> struct</p>
          </td>
          <td class="table-cell">
            <p class="normal">Two <code class="inlineCode">Instant</code> values, an inclusive start and an exclusive end.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">LocalDateTime</code> struct</p>
          </td>
          <td class="table-cell">
            <p class="normal">A date/time value in a particular calendaring system, but it does not represent a fixed point on the global timeline. For example, midnight on New Year’s Eve 2023 happens for different people in different time zones. If you do not know the user’s time zone, you will likely have to use this type.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">LocalDate</code> and <code class="inlineCode">LocalTime</code> structs</p>
          </td>
          <td class="table-cell">
            <p class="normal">Like <code class="inlineCode">LocalDateTime</code> struct but only the date or time part. When prompting the user to enter date and time values, you often start with them separately and then combine them into a single <code class="inlineCode">LocalDateTime</code> struct.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">DateTimeZone</code> class</p>
          </td>
          <td class="table-cell">
            <p class="normal">Represents a time zone. It is easy to convert from the .NET <code class="inlineCode">TimeZoneInfo</code> using <code class="inlineCode">BclDateTimeZone</code>. Use <code class="inlineCode">DateTimeZoneProviders.Tzdb</code> to get a time zone, based on the standard names listed at the following link: <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">https://en.wikipedia.org/wiki/List_of_tz_database_time_zones</a></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">ZonedDateTime</code> struct</p>
          </td>
          <td class="table-cell">
            <p class="normal">A date/time value in a particular calendaring system and in a specific time zone, so it does represent a fixed point on the global timeline. </p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Offset</code> struct</p>
          </td>
          <td class="table-cell">
            <p class="normal">Represents an offset. It is positive if the local time is ahead of UTC, and negative if the local time is behind UTC. </p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">OffsetDateTime</code> struct</p>
          </td>
          <td class="table-cell">
            <p class="normal">You might know the offset from UTC, but that does not always cleanly map to a single time zone. This type should be used in this scenario instead of <code class="inlineCode">ZonedDateTime</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Duration</code> struct</p>
          </td>
          <td class="table-cell">
            <p class="normal">A fixed number of nanoseconds. Has properties to convert to common time units like <code class="inlineCode">Days</code>, <code class="inlineCode">Hours</code>, <code class="inlineCode">Minutes</code>, and <code class="inlineCode">Seconds</code>, rounded down or up to zero because they return an <code class="inlineCode">int</code>, and non-rounded properties like <code class="inlineCode">TotalDays</code>, <code class="inlineCode">TotalMinutes</code>, and so on, because they return a <code class="inlineCode">double</code>. Used for calculations on <code class="inlineCode">Instant</code> and <code class="inlineCode">ZonedDateTime</code> values. Use this instead of the .NET <code class="inlineCode">TimeSpan</code> type.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Period</code> class</p>
          </td>
          <td class="table-cell">
            <p class="normal">A variable duration because the “two months” represented by January and February 2024 are different lengths to the “two months” of June and July 2024, or even the “two months” represented by January and February in a non-leap year (2024 is a leap year, so February 2024 has 29 days).</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 7.6: Common Noda Time types</p>
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: Use <code class="inlineCode">Instant</code> to<a id="_idIndexMarker705"/> record the point in time when something happened. It is good for timestamps. It can then be represented to the user in their local time zone. Common<a id="_idIndexMarker706"/> types used to record a user-entered date/time value are the following: <code class="inlineCode">ZonedDateTime</code>, <code class="inlineCode">OffsetDateTime</code>, <code class="inlineCode">LocalDateTime</code>, <code class="inlineCode">LocalDate</code>, and <code class="inlineCode">LocalTime</code>.</p>
    </div>
    <h2 class="heading-2" id="_idParaDest-292">Converting between Noda Time date/time types</h2>
    <p class="normal">To summarize common <a id="_idIndexMarker707"/>ways to convert between Noda Time types, review the following non-exhaustive diagram:</p>
    <figure class="mediaobject"><img alt="" src="img/B19587_07_03.png"/></figure>
    <p class="packt_figref">Figure 7.3: Common ways to convert between Noda Time date/time types</p>
    <h2 class="heading-2" id="_idParaDest-293">Exploring Node Time in a console app</h2>
    <p class="normal">Let’s write some code:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Use your preferred <a id="_idIndexMarker708"/>code editor to add a new <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code> project named <code class="inlineCode">WorkingWithNodaTime</code> to the <code class="inlineCode">Chapter07</code> solution.<ul>
          <li class="bulletList">In the project file, treat warnings as errors, then statically and globally import the <code class="inlineCode">System.Console</code> class, and add a package reference for <code class="inlineCode">NodaTime</code>, as shown in the following markup:
            <pre class="programlisting code"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;PackageReference Include="NodaTime" Version="3.1.9" /&gt;
&lt;/ItemGroup&gt;
</code></pre>
          </li>
        </ul>
      </li>
      <li class="numberedList">Add a new class file named <code class="inlineCode">Program.Helpers.cs</code>, and replace its contents, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">partial class Program
{
  private static void SectionTitle(string title)
  {
    ConsoleColor previousColor = ForegroundColor;
    ForegroundColor = ConsoleColor.DarkYellow;
    WriteLine($"*** {title}");
    ForegroundColor = previousColor;
  }
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete the existing statements, add statements to get the current instant in time, and <a id="_idIndexMarker709"/>convert it to various Noda Time types, including UTC, a couple of time zones, and local time, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using NodaTime; // To use SystemClock, Instant and so on.
SectionTitle("Converting Noda Time types");
// Get the current instant in time.
Instant now = SystemClock.Instance.GetCurrentInstant();
WriteLine($"Now (Instant): {now}");
WriteLine();
ZonedDateTime nowInUtc = now.InUtc();
WriteLine($"Now (DateTimeZone): {nowInUtc.Zone}");
WriteLine($"Now (ZonedDateTime): {nowInUtc}");
WriteLine($"Now (DST): {nowInUtc.IsDaylightSavingTime()}");
WriteLine();
// Use the Tzdb provider to get the time zone for US Pacific.
// To use .NET compatible time zones, use the Bcl provider.
DateTimeZone zonePT = DateTimeZoneProviders.Tzdb["US/Pacific"];
ZonedDateTime nowInPT = now.InZone(zonePT);
WriteLine($"Now (DateTimeZone): {nowInPT.Zone}");
WriteLine($"Now (ZonedDateTime): {nowInPT}");
WriteLine($"Now (DST): {nowInPT.IsDaylightSavingTime()}");
WriteLine();
DateTimeZone zoneUK = DateTimeZoneProviders.Tzdb["Europe/London"];
ZonedDateTime nowInUK = now.InZone(zoneUK);
WriteLine($"Now (DateTimeZone): {nowInUK.Zone}");
WriteLine($"Now (ZonedDateTime): {nowInUK}");
WriteLine($"Now (DST): {nowInUK.IsDaylightSavingTime()}");
WriteLine();
LocalDateTime nowInLocal = nowInUtc.LocalDateTime;
WriteLine($"Now (LocalDateTime): {nowInLocal}");
WriteLine($"Now (LocalDate): {nowInLocal.Date}");
WriteLine($"Now (LocalTime): {nowInLocal.TimeOfDay}");
WriteLine();
</code></pre>
      </li>
      <li class="numberedList">Run the console app, and note the results, including that “local” time does not take into account any DST offset; for example, in my case, living in the UK, I must use the<a id="_idIndexMarker710"/> London time zone to get British Summer Time (10:21am), not “local” time (9:21am), as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">*** Converting Noda Time types
Now (Instant): 2023-06-01T09:21:05Z
Now (DateTimeZone): UTC
Now (ZonedDateTime): 2023-06-01T09:21:05 UTC (+00)
Now (DST): False
Now (DateTimeZone): US/Pacific
Now (ZonedDateTime): 2023-06-01T02:21:05 US/Pacific (-07)
Now (DST): True
Now (DateTimeZone): Europe/London
Now (ZonedDateTime): 2023-06-01T10:21:05 Europe/London (+01)
Now (DST): True
Now (LocalDateTime): 01/06/2023 09:21:05
Now (LocalDate): 01 June 2023
Now (LocalTime): 09:21:05
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, add <a id="_idIndexMarker711"/>statements to explore what can be done with periods of time, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">SectionTitle("Working with periods");
// The modern .NET era began with the release of .NET Core 1.0
// on June 27, 2016 at 10am Pacific Time, or 5pm UTC.
LocalDateTime start = new(year: 2016, month: 6, day: 27, 
  hour: 17, minute: 0, second: 0);
LocalDateTime end = LocalDateTime.FromDateTime(DateTime.UtcNow);
WriteLine("Modern .NET era");
WriteLine($"Start: {start}");
WriteLine($"End: {end}");
WriteLine();
Period period = Period.Between(start, end);
WriteLine($"Period: {period}");
WriteLine($"Years: {period.Years}");
WriteLine($"Months: {period.Months}");
WriteLine($"Weeks: {period.Weeks}");
WriteLine($"Days: {period.Days}");
WriteLine($"Hours: {period.Hours}");
WriteLine();
Period p1 = Period.FromWeeks(2);
Period p2 = Period.FromDays(14);
WriteLine($"p1 (period of two weeks): {p1}");
WriteLine($"p2 (period of 14 days): {p2}");
WriteLine($"p1 == p2: {p1 == p2}");
WriteLine($"p1.Normalize() == p2: {p1.Normalize() == p2}");
</code></pre>
      </li>
      <li class="numberedList">Run the console app and note the results, including that at the time of running the console<a id="_idIndexMarker712"/> app on 1 June 2023, the modern .NET era has lasted 6 years, 11 months, and 4 days, the serialization format for the <code class="inlineCode">Period</code> type, and how two periods can be compared and should be normalized before the comparison, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">*** Working with periods
Modern .NET era
Start: 27/06/2016 17:00:00
End: 01/06/2023 09:21:05
Period: P6Y11M4DT16H21M5S889s9240t
Years: 6
Months: 11
Weeks: 0
Days: 4
Hours: 16
p1 (period of two weeks): P2W
p2 (period of 14 days): P14D
p1 == p2: False
p1.Normalize() == p2: True
</code></pre>
      </li>
    </ol>
    <div><p class="normal"><strong class="keyWord">More Information</strong>: Normalizing a <code class="inlineCode">Period</code> with the <code class="inlineCode">Normalize</code> method means multiplying any<a id="_idIndexMarker713"/> weeks by 7 and adding them to the number of days, then setting <code class="inlineCode">Weeks</code> to zero, and other calculations. Learn more at the following link: <a href="https://nodatime.org/3.1.x/api/NodaTime.Period.html#NodaTime_Period_Normalize">https://nodatime.org/3.1.x/api/NodaTime.Period.html#NodaTime_Period_Normalize</a></p>
    </div>
    <h2 class="heading-2" id="_idParaDest-294">Unit testing and JSON serialization with Noda Time</h2>
    <p class="normal">Noda<a id="_idIndexMarker714"/> Time has two <a id="_idIndexMarker715"/>optional packages to write unit tests (<code class="inlineCode">NodaTime.Testing</code>) and work<a id="_idIndexMarker716"/> with<a id="_idIndexMarker717"/> JSON.NET (<code class="inlineCode">NodaTime.Serialization.JsonNet</code>).</p>
    <div><p class="normal">The documentation for Noda Time is found at the following link: <a href="https://nodatime.org/">https://nodatime.org/</a></p>
    </div>
    <h1 class="heading-1" id="_idParaDest-295">Practicing and exploring</h1>
    <p class="normal">Test your knowledge and understanding by answering some questions, getting some hands-on practice, and exploring the topics in this chapter with deeper research.</p>
    <h2 class="heading-2" id="_idParaDest-296">Exercise 7.1 – Test your knowledge</h2>
    <p class="normal">Use the web to answer the following questions:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">What is the difference between localization, globalization, and internationalization?</li>
      <li class="numberedList">What is the smallest measurement of time available in .NET?</li>
      <li class="numberedList">How long is a “tick” in .NET?</li>
      <li class="numberedList">In what scenario might you use a <code class="inlineCode">DateOnly</code> value instead of a <code class="inlineCode">DateTime</code> value?</li>
      <li class="numberedList">For a time zone, what does its <code class="inlineCode">BaseUtcOffset</code> property tell you?</li>
      <li class="numberedList">How can you get information about the local time zone in which your code executes?</li>
      <li class="numberedList">For a <code class="inlineCode">DateTime</code> value, what does its <code class="inlineCode">Kind</code> property tell you?</li>
      <li class="numberedList">How can you control the current culture for your executing code?</li>
      <li class="numberedList">What is the ISO culture code for Welsh?</li>
      <li class="numberedList">How do localization resource file fallbacks work?</li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-297">Exercise 7.2 – Explore topics</h2>
    <p class="normal">Use the links on the following page to learn more details about the topics covered in this chapter:</p>
    <p class="normal"><a href="https://github.com/markjprice/apps-services-net8/blob/main/docs/book-links.md#chapter-7---handling-dates-times-and-internationalization">https://github.com/markjprice/apps-services-net8/blob/main/docs/book-links.md#chapter-7---handling-dates-times-and-internationalization</a></p>
    <h2 class="heading-2" id="_idParaDest-298">Exercise 7.3 – Learn from expert Jon Skeet</h2>
    <p class="normal">Jon Skeet is a world-renowned expert on internationalization. Watch him present <em class="italic">Working with Time is Easy</em> at the following link: <a href="https://www.youtube.com/watch?v=saeKBuPewcU">https://www.youtube.com/watch?v=saeKBuPewcU</a></p>
    <h1 class="heading-1" id="_idParaDest-299">Summary</h1>
    <p class="normal">In this chapter, you:</p>
    <ul>
      <li class="bulletList">Explored dates and times, including the .NET 8 <code class="inlineCode">TimeProvider</code> to improve unit tests.</li>
      <li class="bulletList">Learned how to handle time zones.</li>
      <li class="bulletList">Learned how to internationalize your code using globalization and localization.</li>
      <li class="bulletList">Explored some of the features of Noda Time.</li>
    </ul>
    <p class="normal">In the next chapter, you will learn how to build web services using the ASP.NET Core Minimal API, and how to secure and protect them.</p>
  </div>
</body></html>