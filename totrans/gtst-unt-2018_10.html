<html><head></head><body>
        

                            
                    <h1 class="header-title">Scripting Our Points System</h1>
                
            
            
                
<p class="mce-root">In the last chapter, we designed, developed, and incorporated a <strong>Heads-Up Display</strong> (<strong>HUD</strong>) in our game. We used a canvas game object to create text and graphics that provide visual indicators of points, health, and additional information to help the player maintain situational awareness during game play. In addition, we wrote scripts to update key components of the HUD. We also implemented a mini-map using a second camera in our game scene.</p>
<p>In this chapter, we will design, script, and implement our game's point system. This will include providing frame-by-frame updates to key on-screen components of the game's HUD.</p>
<p>Specifically, we will write scripts for the following in this chapter:</p>
<ul>
<li>Collecting cherries from trees</li>
<li>Adding the cherry-throwing capability</li>
<li>Adding points based on cherry collection and combat hits</li>
</ul>


            

            
        
    

        

                            
                    <h1 class="header-title">Collecting cherries from trees</h1>
                
            
            
                
<p>In this section, we will make the necessary adjustments to our game objects and script functionality that enable the collection of cherries from cherry trees. More specifically, we will create the following gameplay:</p>
<ul>
<li>Detect collisions of Cucumber Man and cherry trees</li>
<li>Simulate collection of cherries</li>
<li>Update inventory and HUD with cherry count</li>
</ul>
<p>Before we get started, you should open your Unity game project. Alternatively, you can download the Starting-Chapter-10 Unity project available from the publisher's companion site.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Detecting collisions of Cucumber Man and cherry trees</h1>
                
            
            
                
<p>In this section, we will enable and test collisions between the Cucumber Man and cherry trees. Our first step is to ensure the cherry trees in our sandbox area all have the <kbd>CherryTree</kbd> tag. We previously created the tag name, so we only need to apply it to the trees in our sandbox. Here are the steps:</p>
<ol>
<li>In the Hierarchy panel, select a Cherry Tree that is inside your sandbox area</li>
<li>In the Inspector panel, click the drop-down box to the left of the Tag label</li>
<li>Select the CherryTree tag</li>
<li>Repeat steps 1 through 3 for each Cherry Tree GameObject in your sandbox area</li>
<li>Optionally, repeat steps 1 through 3 for all the Cherry Tree GameObjects in the Hierarchy view, not just the ones in your sandbox area</li>
</ol>
<p>Next, we will create a <kbd>CucumberManManager</kbd> script to handle the collisions with the cherry trees. Here are the steps to create that script:</p>
<ol>
<li>In the Hierarchy panel, select the CumcuberMan player character</li>
<li>In the Inspector panel, scroll to the bottom and click the Add Component button</li>
<li>Select New Script</li>
<li>Name the script <kbd>CucumberManManager</kbd></li>
<li>Click the Create and Add button</li>
<li>In the Project panel, click Favorites | All Scripts</li>
<li>Drag the <kbd>CucumberManManager</kbd> script to the <kbd>Assets</kbd> | <kbd>Custom Scripts</kbd> folder</li>
<li>Double-click the <kbd>CucumberManManager</kbd> script to open it in an editor</li>
<li>Edit the script so that it matches the code provided here:</li>
</ol>
<pre>     using System.Collections;<br/>     using System.Collections.Generic;<br/>     using UnityEngine;<br/> <br/>     public class CucumberManManager : MonoBehaviour {<br/> <br/>         void OnTriggerEnter(Collider theObject) {<br/>             if (theObject.gameObject.CompareTag ("CherryTree")) {<br/> <br/>                 // Do something<br/> <br/>                 }<br/>         }<br/>     } </pre>
<p>The preceding script is a C# script with an <kbd>OnTriggerEnter()</kbd> method. As you can see, we check the tag of what the Cucumber Man collided with to see if that game object has a tag of <kbd>CherryTree</kbd>.</p>
<p>Next, we need to do something when that collision is detected. We will handle that in the next section.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Simulating the collection of cherries</h1>
                
            
            
                
<p>In this section, we will continue working on the <kbd>CucumberManManager</kbd> script to simulate the collection of cherries.</p>
<p>If you do not already have the script open, open it now in an editor. We will review the updated code in five sequential sections.</p>
<p>Our first section, shown here, imports the three necessary namespaces.</p>
<pre>using System.Collections;<br/>    using System.Collections.Generic;<br/>    using UnityEngine;<br/> <br/>    public class CucumberManManager : MonoBehaviour {<br/> <br/>       public static int currentCherryCount;<br/>       public int tempCurrentCherryCount;<br/>       public bool collectingCherries; </pre>
<p>The fourth line of code is the class declaration statement. The last three lines of code in this section are the class variables. Here is a brief description of each:</p>
<ul>
<li><kbd>currentCherryCount</kbd>: Keep the current number of cherries in the Cucumber Man's inventory</li>
<li><kbd>tempCurrentCherryCount</kbd>: Used to limit cherry collection to one per second</li>
<li><kbd>collectingCherries</kbd>: Used to determine whether the inventory counter should be active</li>
</ul>
<p>Our second section, shown as follows, features the <kbd>Awake()</kbd> method. This method is used to initialize our variables at the start of the game:</p>
<pre>     void Awake () {<br/> <br/>         currentCherryCount = 0;<br/>         tempCurrentCherryCount = 0;<br/>         collectingCherries = false;<br/> <br/>     } </pre>
<p>Our third section, shown here, features the <kbd>Update()</kbd> method. This method is executed once per frame. We have an if/else statement nested in an outer if statement. This outer statement checks to see whether the <kbd>collectingCherries</kbd> Boolean value is true. If it is, the inner if/else statement block is evaluated.</p>
<p>The inner if/else block checks to see whether the <kbd>tempCurrentCherryCount</kbd> variable's value is greater than or equal to <kbd>60</kbd>. If it is, then the <kbd>currentCherryCount</kbd> value is incremented by one; otherwise, the <kbd>tempCurrentCherryCount</kbd> value is incremented by one. The <kbd>Update()</kbd> method is called once per frame and frame rates can vary. So, we are essentially adding one cherry to the Cucumber Man's inventory every 60 frames:</p>
<pre>     void Update () {<br/> <br/>         if (collectingCherries) {<br/>             if (tempCurrentCherryCount &gt;= 60) {<br/>                 currentCherryCount = currentCherryCount + 1;<br/>                 tempCurrentCherryCount = 0;<br/> <br/>             } else {<br/>                 tempCurrentCherryCount = tempCurrentCherryCount + 1;<br/>             }<br/>         }<br/> <br/>     } </pre>
<p>Our fourth section, shown in the following code block, contains the <kbd>OnTriggerEnter()</kbd> method we started in the last section. We edited this method to include an if statement that checks to see whether the Cucumber Man has entered a collision with a cherry tree. If so, the <kbd>collectingCherries</kbd> Boolean variable is set to <kbd>true</kbd> and one cherry is added to the inventory:</p>
<pre>     void OnTriggerEnter(Collider theObject) {<br/>         if (theObject.gameObject.CompareTag ("CherryTree")) {<br/> <br/>             collectingCherries = true; <br/>             currentCherryCount = currentCherryCount + 1;<br/>             }<br/>     } </pre>
<p>Our fifth section, shown as follows, has the <kbd>OnTriggerExit()</kbd> method. This event is fired when the Cucumber Man stops colliding with the cherry trees. When this occurs, we set the <kbd>collectingCherries</kbd> Boolean value to <kbd>false</kbd>:</p>
<pre> <br/>     void OnTriggerExit(Collider theObject) {<br/>         if (theObject.gameObject.CompareTag ("CherryTree")) {<br/>             collectingCherries = false;<br/>         }<br/>     }<br/> <br/> } // end of CucumberManManager.cs</pre>


            

            
        
    

        

                            
                    <h1 class="header-title">Updating the inventory and HUD with cherry count</h1>
                
            
            
                
<p>We now have a system in place for adding cherries to the Cucumber Man's inventory based on his collision with cherry trees. Next, we need to update the appropriate UI text component with the current inventory amount. We will take care of this important task in this section.</p>
<p>Here are the steps to create that script:</p>
<ol>
<li>In the Hierarchy panel, select the <kbd>HUD_Canvas</kbd> | <kbd>Cherries_Count</kbd> UI text component</li>
<li>In the Inspector panel, scroll to the bottom and click the Add Component button</li>
<li>Select New Script</li>
<li>Name the script <kbd>CherryManager</kbd></li>
<li>Click the Create and Add button</li>
<li>In the Project panel, click Favorites | All Scripts</li>
<li>Drag the <kbd>CherryManager</kbd> script to the <kbd>Assets</kbd> | <kbd>Custom Scripts</kbd> folder</li>
<li>Double-click the <kbd>CherryManager</kbd> script to open it in an editor</li>
<li>Edit the script so that it matches the code provided here</li>
</ol>
<p>An explanation of this code is provided immediately following the code block:</p>
<pre> using System.Collections;<br/> using System.Collections.Generic;<br/> using UnityEngine;<br/> using UnityEngine.UI;<br/> <br/> public class CherryManager : MonoBehaviour {<br/> <br/>     Text Cherries_Count;<br/> <br/>     void Awake () {<br/> <br/>         Cherries_Count = GetComponent&lt;Text&gt; ();<br/> <br/>     }<br/> <br/> <br/>     void Update () {<br/>         <br/>         Cherries_Count.text = CucumberManManager.currentCherryCount.ToString ();<br/> <br/>     }<br/> } </pre>
<p>The first four lines of code import the appropriate namespaces.</p>
<p>The next line of code is the class declaration: <kbd>public class CherryManager : MonoBehaviour {</kbd>.</p>
<p>Next is the single class variable, a <kbd>text</kbd> object named <kbd>Cherries_Count</kbd>.</p>
<p>The first method in the class is the <kbd>Awake()</kbd> method. We use this method to create a reference to the <kbd>Cherries_Count</kbd> UI text component.</p>
<p>The last section of our <kbd>CherryManager</kbd> class is the <kbd>Update()</kbd> method. That method has a single statement used to convert the <kbd>currentCherryCount</kbd> from an <kbd>int</kbd> to a string and update the HUD.</p>
<p>You can play-test the game to validate the functionality. Simply navigate the Cucumber Man to a cherry tree and watch the inventory of cherries increase. It is important for us to have a method of collecting cherries because the player can press the <em>E</em> key on the keyboard to throw a cherry. We will program that functionality in the next section.</p>
<p>Now is a great time to save your scene and project. </p>


            

            
        
    

        

                            
                    <h1 class="header-title">Adding the cherry-throwing capability</h1>
                
            
            
                
<p>In <a href="6a3fb463-b0c2-4145-9096-bc52d55cf905.xhtml" target="_blank">Chapter 7</a>, <em>Implementing our Player Character</em>, we demonstrated the Cucumber Man's throw animation using the <em>E</em> keyboard key. In this section, we will make the necessary changes to instantiate a cherry in the Cucumber Man's right hand when the <em>E</em> keyboard key is pressed and then allow it to be launched. We will check to ensure the Cucumber Man has at least one cherry in his inventory so we know whether a cherry should be instantiated or not. Okay, let's get started.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Creating a spot for the cherry</h1>
                
            
            
                
<p>The following steps demonstrate how to create a spot for the cherry on the Cucumber Man's right hand.</p>
<ol>
<li>In the Hierarchy panel, expand the <kbd>CucumberMan</kbd> object until you see <kbd>Character1_RightHand</kbd>.</li>
<li>Right-click <kbd>Character1_RightHand</kbd> and select Create Empty.</li>
<li>Rename the new GameObject to <kbd>cherrySpot</kbd>. This will be the spot where we render the cherry.</li>
</ol>
<p style="padding-left: 60px">Your <kbd>CucumberMan</kbd> object's hierarchy should look as follows:</p>
<div><img height="193" width="203" src="img/86af7308-f77d-4295-b9a5-b8bdd514e8b3.png"/></div>
<ol start="4">
<li>Using the transform tools, move the <kbd>cherrySpot</kbd> GameObject so that it is inside the Cucumber Man's right hand. Your placement should be similar to what is displayed here:</li>
</ol>
<div><img src="img/138608f2-0cc2-439e-b244-d9f329a84c23.png"/></div>
<p>We will need to add a <kbd>Rigidbody</kbd> to the <kbd>Cherry</kbd> prefab so we can instantiate and throw it during runtime.</p>
<ol>
<li>In the Project panel, select Assets | Cherry | <kbd>Cherry.Prefab</kbd></li>
<li>In the Inspector panel, click the Add Component button</li>
<li>Select Physics | Rigidbody</li>
<li>Uncheck the Use Gravity option</li>
<li>Expand the Constraints section of the Rigidbody component</li>
<li>Check all Freeze Position and Freeze Rotation boxes</li>
</ol>
<p>Next, we will add the <kbd>Cherry</kbd> prefab to our scene.</p>
<ol>
<li>Drag the Cherry prefab from the Project panel to the Hierarchy panel, making it subordinate to the cherrySpot game object.</li>
<li>In Scene view, zoom in and adjust the location of the cherrySpot so the cherry looks as if the Cucumber Man is holding it. A suggested placement is shown here:</li>
</ol>
<div><img height="258" width="150" src="img/f2146f28-d1c8-4e6c-b615-06a5b2d39e9c.png"/></div>


            

            
        
    

        

                            
                    <h1 class="header-title">Writing a CherryControl script</h1>
                
            
            
                
<p>Next, we will add a script to the cherry prefab to support the creation and release of the cherry with respect to the Cucumber Man's hand.</p>
<ol>
<li>In the Project panel, select Assets | Cherry | <kbd>Cherry.Prefab</kbd></li>
<li>In the Inspector panel, click the Add Component button</li>
<li>Select New Script and name the script CherryControl</li>
<li>Click the Create and Add button</li>
<li>In the Project panel, drag the new script into the <kbd>Assets</kbd> | <kbd>Custom Scripts</kbd> folder</li>
<li>Edit the script so that it matches what is provided in the following code block</li>
</ol>
<p>The first part of the script consists of the namespace import statements and the class declaration:</p>
<pre> using System.Collections;<br/> using System.Collections.Generic;<br/> using UnityEngine;<br/> <br/> public class CherryControl : MonoBehaviour {<br/></pre>
<p>The next section contains the class variables. We have one <kbd>Rigidbody</kbd>, two floats, and a <kbd>GameObject</kbd>:</p>
<pre>     public Rigidbody cherry;<br/>     public float throwDistance = 2000000000f;<br/>     public float time2Die = 4.0f;<br/> <br/>     GameObject cucumberHand;</pre>
<p>The <kbd>Update()</kbd> method, shown here, checks to see whether the <em>E</em> keyboard key is pressed and whether the Cucumber Man has at least one cherry:</p>
<pre>     void Update () {<br/> <br/>         int count = CucumberManManager.currentCherryCount;<br/> <br/>         if (Input.GetKeyDown (KeyCode.E)) {<br/>             <br/>             if (count &gt;= 1) {<br/> <br/>                 ThrowACherry ();<br/>             }<br/>         }<br/>     }<br/></pre>
<p>The last section of the code is the <kbd>ThrowACherry()</kbd> method. As you can see, we clone the cherry at the Cucumber Man's hand, turn gravity on, release the constraints, and push it forward using the <kbd>AddForce()</kbd> method. Next, we use the <kbd>Destroy()</kbd> method to destroy the cloned cherry in four seconds. The last statement decrements the Cucumber Man's cherry inventory:</p>
<pre>     public void ThrowACherry () {<br/> <br/>         Rigidbody cherryClone = (Rigidbody)Instantiate <br/>               (cherry, transform.position, transform.rotation);<br/>         cherryClone.useGravity = true;<br/>         cherryClone.constraints = RigidbodyConstraints.None;<br/>         cherryClone.AddForce(transform.forward * throwDistance);<br/>         Destroy (cherryClone.gameObject, time2Die);<br/> <br/>         CucumberManManager.currentCherryCount = CucumberManManager.currentCherryCount - 1;<br/>     }<br/> } </pre>


            

            
        
    

        

                            
                    <h1 class="header-title">Adding points based on cherry collection and combat hits</h1>
                
            
            
                
<p>In this section, we will edit the appropriate scripts so that the Cucumber Man can earn points, related to cherries, based on the following criteria:</p>
<table style="width: 470px;height: 94px">
<tbody>
<tr>
<td><strong>In-game event</strong></td>
<td><strong>Points</strong></td>
</tr>
<tr>
<td>Cucumber Man picks cherry</td>
<td>+ 5</td>
</tr>
<tr>
<td>Cucumber Man hits beetle with cherry</td>
<td>+ 10</td>
</tr>
</tbody>
</table>


            

            
        
    

        

                            
                    <h1 class="header-title">Creating a points manager script</h1>
                
            
            
                
<p>In this section, we will create and edit a script to manage our points and to display them on our game's HUD. Here are the steps:</p>
<ol>
<li>In the Hierarchy panel, select the HUD_Canvas | Score_Value</li>
<li>In the Inspector panel, click the Add Component button</li>
<li>Select New Script and name the script <kbd>PointsManager</kbd></li>
<li>In the Project panel, click Favorites | All Scripts</li>
<li>Drag the PointsManager script to the Assets | <kbd>Custom Scripts</kbd> folder</li>
<li>Double-click the PointsManager script to open it in an editor</li>
<li>Edit the script so that it matches the following code</li>
</ol>
<p>The first section of the code contains the namespace import statements and the <kbd>PointsManager</kbd> class declaration:</p>
<pre> using System.Collections;<br/> using System.Collections.Generic;<br/> using UnityEngine;<br/>
 using UnityEngine.UI;<br/> <br/> public class PointsManager : MonoBehaviour {<br/></pre>
<p>The next section of the script declares two class variables; one for the current score and the other is a reference to the <kbd>Text</kbd> UI component that displays the score during game play:</p>
<pre>     public static int currentScore;<br/>     Text score;<br/></pre>
<p>The first method in our class is the <kbd>Awake()</kbd> method. We use this method to initialize our variables:</p>
<pre>     void Awake () {<br/>         score = GetComponent&lt;Text&gt; ();<br/>         currentScore = 0;<br/>         <br/>     }<br/></pre>
<p>The last section of our class is the <kbd>Update()</kbd> method. Here, we have a single statement that converts the current score to a string and then updates the HUD:</p>
<pre>     void Update () {<br/> <br/>         score.text = currentScore.ToString ();<br/>         <br/>     }<br/> } </pre>


            

            
        
    

        

                            
                    <h1 class="header-title">Adding points for each cherry picked</h1>
                
            
            
                
<p>In this section, we will edit the appropriate script to add five points for each cherry picked. Here are the steps:</p>
<ol>
<li>In the Project panel, select the Custom Scripts | CucumberManManager</li>
<li>Edit the script</li>
<li>Add the following class variable: public <kbd>PointsManager _ptsManager;</kbd></li>
<li>Add the following lines of code inside the nested if statement in the <kbd>Update()</kbd> method:</li>
</ol>
<pre>_ptsManager = GameObject.Find ("Score_Value").GetComponent&lt;PointsManager&gt; ();<br/>PointsManager.currentScore = PointsManager.currentScore + 5;  </pre>
<p>The two lines of preceding code create a reference to the <kbd>PointsManager</kbd> script and, on the second line, increments the <kbd>currentScore</kbd> by 5.</p>
<p>The updated <kbd>CucumberManManager</kbd> script should be as follows:</p>
<pre> using System.Collections;<br/> using System.Collections.Generic;<br/> using UnityEngine;<br/> <br/> public class CucumberManManager : MonoBehaviour {<br/> <br/>     public static int currentCherryCount;<br/>     public int tempCurrentCherryCount;<br/>     public bool collectingCherries;<br/>     public PointsManager _ptsManager;<br/> <br/>     void Awake () {<br/>         currentCherryCount = 0;<br/>         tempCurrentCherryCount = 0;<br/>         collectingCherries = false;<br/>     }<br/> <br/>     void Update () {<br/>         if (collectingCherries) {<br/>             if (tempCurrentCherryCount &gt;= 60) {<br/>                 currentCherryCount = currentCherryCount + 1;<br/>                 tempCurrentCherryCount = 0;<br/> <br/>                 _ptsManager = GameObject.Find    <br/>  ("Score_Value").GetComponent&lt;PointsManager&gt; ();<br/>                 PointsManager.currentScore =   <br/>    PointsManager.currentScore + 5; <br/> <br/>             } else {<br/>                 tempCurrentCherryCount = tempCurrentCherryCount + 1;<br/>             }<br/>         }<br/>     }<br/> <br/>     void OnTriggerEnter(Collider theObject) {<br/>         if (theObject.gameObject.CompareTag ("CherryTree")) {<br/> <br/>             collectingCherries = true; <br/>             currentCherryCount = currentCherryCount + 1;<br/>             }<br/>     }<br/> <br/>     void OnTriggerExit(Collider theObject) {<br/>         if (theObject.gameObject.CompareTag ("CherryTree")) {<br/>             collectingCherries = false;<br/>         }<br/>     }<br/> } </pre>


            

            
        
    

        

                            
                    <h1 class="header-title">Adding points for hitting a beetle with a cherry</h1>
                
            
            
                
<p>Our last points-related task is to update the BeetleNPC script so that appropriate points are added when a cherry hits a cucumber beetle. Here are the steps:</p>
<ol>
<li>In the Project panel, select the Custom Scripts | BeetleNPC</li>
<li>Edit the script</li>
<li>Add the following class variable:  <kbd>public PointsManager _ptsManager;</kbd></li>
<li>Add the following lines of code inside the nested else if statement in the <kbd>OnTriggerEnter()</kbd> method:</li>
</ol>
<pre>_ptsManager = GameObject.Find ("Score_Value").GetComponent&lt;PointsManager&gt; ();<br/>PointsManager.currentScore = PointsManager.currentScore + 10;  <br/></pre>
<p>The two preceding lines of code create a reference to the <kbd>PointsManager</kbd> script and, on the second line, increment the <kbd>currentScore</kbd> by <kbd>10</kbd>.</p>
<p>The updated <kbd>BeetleNPC</kbd> script's <kbd>OnTriggerEnter()</kbd> method should be as follows:</p>
<pre>     void OnTriggerEnter(Collider theObject) {<br/>         if (theObject.gameObject.CompareTag ("Cucumber")) {<br/> <br/>             cucumberToDestroy = theObject.gameObject;<br/>             BeetlePatrol.isEating = true;<br/>             animator.Play ("Eating on Ground");<br/>             StartCoroutine ("DestroyCucumber");<br/>         } else if (theObject.gameObject.CompareTag ("Cherry")) {<br/>             _ptsManager = GameObject.Find    <br/>   ("Score_Value").GetComponent&lt;PointsManager&gt; ();<br/>          PointsManager.currentScore = PointsManager.currentScore + 10;  <br/>             BeetlePatrol.isAttacking = true;<br/>             cherryHit = true;<br/>             animator.Play ("Stand");<br/>         }<br/>     } </pre>


            

            
        
    

        

                            
                    <h1 class="header-title">Summary</h1>
                
            
            
                
<p>In this chapter, we designed, scripted, and implemented our game's point system. This included providing frame-by-frame updates to key on-screen components of the game's HUD. Our scripts enabled the collection of cherries from cherry trees, adding the cherry-throwing capability for our Cucumber Man. We also added points based on the collection of cherries and combat hits.</p>
<p>In <a href="7098e2ac-1871-4cb2-98ba-36f3acdb0515.xhtml" target="_blank">Chapter 11</a>, <em>Scripting Victory and Defeat</em>, we will design and script our game's victory and defeat conditions. This will include managing the Cucumber Man's health, lives remaining, and respawning the player character.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            

            
        
    </body></html>