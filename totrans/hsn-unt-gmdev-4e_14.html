<html><head></head><body>
  <div id="_idContainer617" class="Basic-Text-Frame">
    <h1 class="chapterNumber">11</h1>
    <h1 id="_idParaDest-155" class="chapterTitle">Captivating Visual Effects: Harnessing Particle Systems and Visual Effect Graph</h1>
    <p class="normal">In this chapter, we will continue learning about visual effects for our game. We will be discussing particle systems, which are a way to simulate fire, waterfalls, smoke, and all kinds of fluids. We will see two Unity particle systems to create these kinds of effects, <strong class="screenText">Shuriken</strong> and <strong class="screenText">Visual Effect (VFX) Graph</strong>, the latter being more powerful than the first but requiring more hardware. These technologies are used widely in different games to simulate all kinds of effects, like explosions and gun muzzles in war games such as Battlefield or magic effects, as in Hogwarts Legacy.</p>
    <p class="normal">In this chapter, we will cover the following particle system topics:</p>
    <ul>
      <li class="bulletList">Introduction to particle systems</li>
      <li class="bulletList">Creating fluid simulations</li>
      <li class="bulletList">Creating complex simulations with Visual Effect Graph</li>
    </ul>
    <h1 id="_idParaDest-156" class="heading-1">Introduction to particle systems</h1>
    <p class="normal">All graphics and effects<a id="_idIndexMarker677"/> we have created so far use static meshes—3D models that can’t be skewed, bent, or deformed in any way other than by using shaders. Fluids such as fire and smoke can’t always be represented using this kind of mesh, but we can simulate these effects with a combination of static meshes, and this is where particle systems are useful.</p>
    <p class="normal"><strong class="screenText">Particle systems</strong> are objects that emit and animate lots of <strong class="screenText">particles </strong>or <strong class="screenText">billboards</strong>, which are simple quad meshes that face the camera. Each particle is a static mesh, but rendering, animating, and combining lots of them can generate the illusion of a fluid.</p>
    <p class="normal">In Figure 11.1, you can see a smoke effect using particle systems on the left, and on the right, the <strong class="screenText">Wireframe</strong> view of the same particles. There, you can see the quads that create the illusion of smoke, which is done by applying a smoke texture to each of the particles and animating them, so they spawn at the bottom and move up in random directions:</p>
    <figure class="mediaobject"><img src="../Images/B21361_11_01_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.1: On the left side, a smoke particle system; on the right side, the wireframe of the same system</p>
    <p class="normal">In this section, we will cover<a id="_idIndexMarker678"/> the following topics related to particles:</p>
    <ul>
      <li class="bulletList">Creating a basic particle system</li>
      <li class="bulletList">Using advanced modules</li>
    </ul>
    <p class="normal">Let’s start by discussing how to create our very first particle system.</p>
    <h2 id="_idParaDest-157" class="heading-2">Creating a basic particle system</h2>
    <p class="normal">To illustrate the creation of a particle<a id="_idIndexMarker679"/> system, let’s create an explosion effect. The idea is to spawn lots of particles at once and spread them in all directions. Let’s start with creating the particle system and configuring the basic settings it provides to change its default behavior. To do so, follow these steps:</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="1">Select the <strong class="screenText">GameObject | Effects | Particle System</strong> option:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_02.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.2: The Particle System option</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="2">You can see the effect in the following screenshot. The default behavior is a column of particles going up, like the smoke effect shown previously. Let’s change that.</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_03_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.3: Default particle system appearance</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="3">Click the created object<a id="_idIndexMarker680"/> in the scene and look at the Inspector.</li>
      <li class="numberedList">Open the <strong class="screenText">Shape</strong> section by clicking on the title. Here you will be able to specify the particle emitter shape from where the particles are going to be spawned.</li>
      <li class="numberedList">Change the <strong class="screenText">Shape</strong> property to <strong class="screenText">Sphere</strong>. Now the particles should move in all possible directions instead of following the default one:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_04_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.4: Shape properties</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="6">In the <strong class="screenText">Particle System</strong> module (usually known as <strong class="screenText">Main</strong>), set <strong class="screenText">Start Speed</strong> to <strong class="screenText">10</strong>. This will make the particles move faster.</li>
      <li class="numberedList">In the same module, set <strong class="screenText">Start Lifetime</strong> to <strong class="screenText">0.5</strong>. This specifies how long a particle will live. In this case, we have given a lifetime of half a second. In combination with the speed (10 meters per second), this makes the particles disappear after moving 5 meters:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_05_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.5: Main Particle System module</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="8">Open the <strong class="screenText">Emission</strong> module and set <strong class="screenText">Rate over Time</strong> to <strong class="screenText">0</strong>. This property specifies how many particles will be emitted<a id="_idIndexMarker681"/> per second, but for an explosion, we actually need a burst of particles, so we won’t emit particles constantly over time in this case.</li>
      <li class="numberedList">In the <strong class="screenText">Bursts</strong> list, click the <strong class="screenText">+</strong> button at the bottom, and in the created item in the list, set the <strong class="screenText">Count</strong> column to <strong class="screenText">100</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_06_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.6: The Emission module</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="10">In the Main module (the one titled <strong class="screenText">Particle System</strong>) set <strong class="screenText">Duration</strong> to <code class="inlineCode">1</code> and uncheck <strong class="screenText">Looping</strong>. In our case, the explosion won’t repeat constantly; we just need one explosion:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_07_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.7: The Looping checkbox</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="11">Now that we already have the particle in the scene, we notice that it isn’t looping. In order to achieve this effect, you need to manually hit the <strong class="screenText">Play</strong> button that is shown in the <strong class="screenText">Particle Effect</strong> window in the bottom-right part of the <strong class="screenText">Scene</strong> view to see the system. If you don’t see that window, remember to first select the GameObject with the particle system in the <strong class="screenText">Hierarchy</strong> window.</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_08_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.8: Particle system playback controls</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="12">Set <strong class="screenText">Stop Action</strong> to <strong class="screenText">Destroy</strong>. This will destroy<a id="_idIndexMarker682"/> the object when the <strong class="screenText">Duration</strong> time has passed. This will just work when you are running the game, so you can safely use this configuration while editing your scene:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_09_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.9: Stop Action set to Destroy</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="13">Set <strong class="screenText">Start Size</strong> of the <strong class="screenText">Main</strong> module to <strong class="screenText">3</strong>. This will make the particles bigger so they seem denser:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_10_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.10: Particle system Start Size</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="14">Click on the down-pointing arrow to the right of the <strong class="screenText">Start Rotation</strong> property of the Main module and select <strong class="screenText">Random Between Two Constants</strong>.</li>
      <li class="numberedList">Set <strong class="screenText">Start Rotation</strong> to <code class="inlineCode">0</code> and <code class="inlineCode">360</code> in the two input values that appeared after <em class="keystroke">step 14</em>. This allows us to give the particles a random rotation when they spawn to make them look slightly different from each other:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_11_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.11: Random Start Rotation</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="16">Now the particles behave as expected, but they don’t look as expected. Let’s change that. Create a new material by clicking on the <strong class="screenText">+</strong> icon in the <strong class="screenText">Project</strong> view and selecting <strong class="screenText">Material</strong>. Let’s call it <code class="inlineCode">Explosion</code>.</li>
      <li class="numberedList">Set its shader to <strong class="screenText">Universal Render Pipeline/Particles/Unlit</strong>. This is a special shader that is used to apply a texture to the particle system:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_12_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.12: Particle system Material shader</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="18">Download a <code class="inlineCode">smoke</code> particle<a id="_idIndexMarker683"/> texture from the internet or the <strong class="screenText">Asset Store</strong>. In this case, it is important to download one with a black background; ignore the others:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_13_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.13: Smoke particle texture</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="19">Set this texture as the <strong class="screenText">Base Map</strong> of the material.</li>
      <li class="numberedList">Set <strong class="screenText">Surface Type</strong> to <strong class="screenText">Transparent</strong> and <strong class="screenText">Blending Mode</strong> to <strong class="screenText">Additive</strong>. Doing this will make the particles blend with each other, instead of being drawn on each other, to simulate a big mass of smoke instead of individual smoke puffs. We use the <strong class="screenText">Additive</strong> mode because our texture has a black background and we want to create a lighting effect (the explosion will brighten the scene):</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_14_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.14: Surface options for particles</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="21">Drag your material<a id="_idIndexMarker684"/> to the <strong class="screenText">Material</strong> property of the <strong class="screenText">Renderer</strong> module:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_15_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.15: Particle Material settings</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="22">Now your system should look like the following figure:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_16_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.16: Result of the previous settings</p>
    <p class="normal">With those steps, we have changed how the particles or billboards will spawn (using the <strong class="screenText">Emission</strong> module), in which direction they will move (using the <strong class="screenText">Shape</strong> module), how fast they will move, how long they will last, how big they will be (using the <strong class="screenText">Main</strong> module), and what they will look like (using the <strong class="screenText">Renderer</strong> module). Creating particle systems is a simple case of properly configuring their different settings. Of course, doing it properly is an art on its own; it requires creativity and knowledge of how to use all the settings<a id="_idIndexMarker685"/> and configurations they provide. So, to increase our skillset, let’s discuss some advanced modules.</p>
    <h2 id="_idParaDest-158" class="heading-2">Using advanced modules</h2>
    <p class="normal">Our system looks nice, but we can improve<a id="_idIndexMarker686"/> it a lot, so let’s enable some new modules to increase its quality:</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="1">Check the checkbox to the left of <strong class="screenText">Color over Lifetime</strong> to enable it:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_17_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.17: Enabling the Color over Lifetime module</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="2">Open the module by clicking on the title and then click the white bar to the right of the <strong class="screenText">Color</strong> property. This will open the Gradient Editor.</li>
      <li class="numberedList">Click slightly to the right of the top-left white marker in the bar to create a new marker. Also, click slightly to the left of the top-right white marker to create the fourth marker. These markers will allow us to specify the transparency of the particles during their lifetime:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_18.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.18: Color over Lifetime gradient editor</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="4">If you accidentally created unwanted markers, just drag them outside the window to remove them. Make sure that <strong class="screenText">Mode</strong> is set to <strong class="screenText">Blend (Classic)</strong>.</li>
      <li class="numberedList">Click on the top-left marker (not the one we created, the one that was already there) and set the <strong class="screenText">Alpha</strong> slider at the bottom to <code class="inlineCode">0</code>. Do the same with the top-right marker, as shown in the following screenshot. Now you should see the particles fading away instead of popping out of existence when the explosion is finishing:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_19.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.19: Fade-in and fade-out gradient</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="6">Enable the <strong class="screenText">Limit Velocity over Lifetime</strong> module by clicking<a id="_idIndexMarker687"/> on its checkbox.</li>
      <li class="numberedList">Set the <strong class="screenText">Dampen</strong> setting to <code class="inlineCode">0.1</code>. This will make the particles slowly stop instead of continuing to move:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_20_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.20: Dampen the velocity to make the particles stop</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="8">Enable <strong class="screenText">Rotation over Lifetime</strong> and set <strong class="screenText">Angular Velocity</strong> between <code class="inlineCode">-90</code> and <code class="inlineCode">90</code>. Remember that you should set the value to <strong class="screenText">Random Between Two Constants</strong> by clicking on the down-pointing arrow to the right of the property. Now the particles should rotate during their lives to simulate more motion:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_21_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.21: Random rotation velocity</p>
    <p class="normal">Some of these effects will be very subtle given the short lifetime we set in the <strong class="screenText">Main </strong>module<strong class="screenText"> </strong>when we just created the particle. Feel free to increase the <strong class="screenText">Lifetime</strong> value to see those effects in more detail, but consider that this could lead to an excessive number of particles if you spawn them frequently, reducing performance. Just be wary about how they impact your performance when tweaking those values.</p>
    <p class="normal">As you can see, there are lots of extra modules that can be enabled and disabled to add layers of behavior on top of the existing ones, so again, use them creatively to create all kinds of effects. Remember that you can create Prefabs of these systems to replicate them all over your scene. I also recommend searching for and downloading particle effects from the Asset Store to see how other people have used the same system<a id="_idIndexMarker688"/> to create amazing effects. Seeing a variety of different systems is the best way to learn how to create them, and that is what we are going to do in the next section: create more systems!</p>
    <h1 id="_idParaDest-159" class="heading-1">Creating fluid simulations</h1>
    <p class="normal">As we said, the best way to learn<a id="_idIndexMarker689"/> how to create particle systems is to keep looking for already-created particle systems and explore how people have used the various system settings to create completely different simulations.</p>
    <p class="normal">In this section, we will learn how to create the following effects using particle systems:</p>
    <ul>
      <li class="bulletList">A waterfall effect</li>
      <li class="bulletList">A bonfire effect</li>
    </ul>
    <p class="normal">Let’s start with the simplest one, the waterfall effect.</p>
    <h2 id="_idParaDest-160" class="heading-2">Creating a waterfall effect</h2>
    <p class="normal">In order to<a id="_idIndexMarker690"/> do this, follow<a id="_idIndexMarker691"/> these steps:</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="1">Create a new particle system (<strong class="screenText">GameObject | Effects | Particle System</strong>).</li>
      <li class="numberedList">Set <strong class="screenText">Shape</strong> to <strong class="screenText">Edge</strong> and <strong class="screenText">Radius</strong> to <code class="inlineCode">5</code> in the <strong class="screenText">Shape</strong> module. This will make the particles spawn along a line of emission:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_22_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.22: Edge shape</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="3">Set the <strong class="screenText">Rate over Lifetime</strong> value of the <strong class="screenText">Emission</strong> module to <code class="inlineCode">50</code>.</li>
      <li class="numberedList">Set the <strong class="screenText">Start Size</strong> of the <strong class="screenText">Main</strong> module to <code class="inlineCode">3</code> and <strong class="screenText">Start Lifetime</strong> to <code class="inlineCode">3</code>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_23_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.23: Main module settings</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="5">Set <strong class="screenText">Gravity Modifier</strong> of the <strong class="screenText">Main</strong> module to <code class="inlineCode">0.5</code>. This will make the particles fall down:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_24_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.24: Gravity Modifier in the Main module</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="6">Use the same <strong class="screenText">Explosion</strong><strong class="screenText"><a id="_idIndexMarker692"/></strong> material we created<a id="_idIndexMarker693"/> previously for this system:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_25_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.25: Explosion particle material</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="7">Enable <strong class="screenText">Color over Lifetime</strong> and open the Gradient Editor. Make sure that <strong class="screenText">Mode</strong> is set to <strong class="screenText">Blend (Classic)</strong>, given that it’s the simplest and most performant one.</li>
      <li class="numberedList">Click the bottom-right marker and, this time, you should see a color picker instead of an alpha slider. The top markers allow you to change the transparency over time, while the bottom ones change the color of the particles over time. Set a light blue color in this marker (you can also use any other color):</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_26.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.26: White to light blue gradient</p>
    <p class="normal">As a challenge, I suggest you add a little particle system where this one ends to create some water splashes, simulating the water colliding with a lake at the bottom. Now we can add this particle system to one of the hills of our scene to decorate it, as in the following screenshot. I have adjusted the system a little bit to look<a id="_idIndexMarker694"/> better in this scenario. I challenge you to tweak it by yourself to make<a id="_idIndexMarker695"/> it look like this:</p>
    <figure class="mediaobject"><img src="../Images/B21361_11_27_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.27: The waterfall particle system being applied to our current scene</p>
    <p class="normal">Now, let’s create another effect: a bonfire.</p>
    <h2 id="_idParaDest-161" class="heading-2">Creating a bonfire effect</h2>
    <p class="normal">In order to create<a id="_idIndexMarker696"/> a bonfire, do the<a id="_idIndexMarker697"/> following:</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="1">Create a particle system as we did in the <em class="italic">Creating a basic particle system</em> section in <strong class="screenText">GameObject | Effects | Particle System</strong>.</li>
      <li class="numberedList">Look for a <strong class="screenText">Fire Particle Texture Sheet</strong> texture on the internet or in the Asset Store. This kind of texture should look like a grid of different flame textures. The idea is to apply a flame animation to our particles, swapping all those mini textures:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_28_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.28: Particles texture sprite sheet</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="3">Create a particle material<a id="_idIndexMarker698"/> that uses the <strong class="screenText">Universal Render Pipeline/Particles/Unlit</strong> <a id="_idIndexMarker699"/>shader.</li>
      <li class="numberedList">Set the flames sprite sheet texture as the Base Map.</li>
      <li class="numberedList">Set the color to the right of <strong class="screenText">Base Map</strong> to white.</li>
      <li class="numberedList">Set this material as the particle material. Remember to set <strong class="screenText">Surface Type</strong> to <strong class="screenText">Transparent</strong> and <strong class="screenText">Blending Mode</strong> to <strong class="screenText">Additive</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_29.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.29: A material with a particle sprite sheet</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="7">Enable the <strong class="screenText">Texture Sheet Animation</strong> module and set the <strong class="screenText">Tiles</strong> property according to your <strong class="screenText">Fire</strong> sheet. In my case, I have a grid of 4x4 sprites, so I put <code class="inlineCode">4</code> in <strong class="screenText">X</strong> and <code class="inlineCode">4</code> in <strong class="screenText">Y</strong>. After this, you should see the particles swapping textures:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_30_PE.png" alt="A picture containing text, screenshot, font, line  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 11.30: Enabling Texture Sheet Animation</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="8">Set <strong class="screenText">Start Speed</strong> to <code class="inlineCode">0</code> and <strong class="screenText">Start Size</strong> to <code class="inlineCode">1.5</code> in the <strong class="screenText">Main</strong> module.</li>
      <li class="numberedList">Set <strong class="screenText">Radius</strong> to <code class="inlineCode">0.5</code> in the <strong class="screenText">Shape </strong>module.</li>
      <li class="numberedList">Create a second particle system and make it a child of <strong class="screenText">Fire System</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_31_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.31: Parenting particle systems</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="11">Apply the <strong class="screenText">Explosion</strong> material<a id="_idIndexMarker700"/> from the explosion<a id="_idIndexMarker701"/> example.</li>
      <li class="numberedList">Set <strong class="screenText">Angle</strong> to <code class="inlineCode">0</code> and <strong class="screenText">Radius</strong> to <code class="inlineCode">0.5</code> in the <strong class="screenText">Shape</strong> module.</li>
    </ol>
    <p class="normal">The system should look like this:</p>
    <figure class="mediaobject"><img src="../Images/B21361_11_32_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.32: Result of combining fire and smoke particle systems</p>
    <p class="normal">As you can see, you can combine several particle systems to create a single effect. Take care when doing this because it’s easy to emit too many particles and affect the game’s performance. Particles are not cheap and may cause a reduction in the game’s <strong class="screenText">Frames Per Second </strong>(<strong class="screenText">FPS</strong>) if you are not cautious with them.</p>
    <div class="packt_tip">
      <p class="normal">One of the reasons why<a id="_idIndexMarker702"/> particles are expensive is called <strong class="keyWord">overdraw</strong>, or the scenario where you have multiple overlapping objects. Remember, particles are just a lot of quads rendered on top of each other to simulate a single fluid. This means some screen pixels get drawn several times to achieve the effect, which can be very heavy on the GPU. You can analyze this and other GPU problems<a id="_idIndexMarker703"/> using tools like RenderDoc. Learn more about it here: <a href="https://docs.unity3d.com/Manual/RenderDocIntegration.html"><span class="url">https://docs.unity3d.com/Manual/RenderDocIntegration.html</span></a></p>
    </div>
    <p class="normal">So far, we have explored one of the Unity<a id="_idIndexMarker704"/> systems that you can use to create these kinds of effects, and while<a id="_idIndexMarker705"/> this system is enough for most situations, Unity recently released a new one that can generate more complex effects, called <strong class="screenText">Visual Effect Graph</strong>. Let’s see how to use it and see how both systems differ.</p>
    <h1 id="_idParaDest-162" class="heading-1">Creating complex simulations with Visual Effect Graph</h1>
    <p class="normal">The particle system we have used<a id="_idIndexMarker706"/> so far handles all calculations<a id="_idIndexMarker707"/> in the CPU. This has both pros and cons. A pro is that it can run on all possible devices that Unity supports, regardless of their capabilities (all of them have CPUs), but a con is that we can exceed CPU capabilities easily if we are not cautious with the number of particles we emit. </p>
    <p class="normal">Modern games require more complex particle systems to generate believable effects, and this kind of CPU-based particle system solution has started to reach its limit. This is where Visual Effect Graph comes in:</p>
    <figure class="mediaobject"><img src="../Images/B21361_11_33_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.33: On the left is a massive particle system, and on the right, an example of a Visual Effect Graph</p>
    <p class="normal"><strong class="screenText">Visual Effect Graph</strong> is a GPU-based particle system solution, meaning that the system is executed in the video card instead of the CPU. That’s because video cards are far more efficient at executing lots and lots of little simulations, like the ones each particle of a system needs, so we can reach far higher orders of magnitude in the number of particles with the GPU than we can with the CPU. The con here is that we need a fairly modern GPU that has <strong class="screenText">compute shader</strong> capabilities to support this system, so we will exclude certain target platforms using this system (forget about most mobile phones), so use it if your target platform supports it (mid- to high-end PCs, consoles, and some high-end phones).</p>
    <p class="normal">In this section, we will discuss the following topics regarding Visual Effect Graph:</p>
    <ul>
      <li class="bulletList">Installing Visual Effect Graph</li>
      <li class="bulletList">Creating and analyzing a Visual Effect Graph</li>
      <li class="bulletList">Creating a rain effect</li>
    </ul>
    <p class="normal">Let’s start by seeing how we can add support for Visual Effect Graph in our project.</p>
    <h2 id="_idParaDest-163" class="heading-2">Installing Visual Effect Graph</h2>
    <p class="normal">So far, we have used lots of Unity<a id="_idIndexMarker708"/> features that were already installed in our project, but Unity can be extended with a myriad of plugins, both official and third-party. Visual Effect Graph is one of those features that needs to be independently installed if you are using <strong class="screenText">Universal Render Pipeline</strong> <strong class="screenText">(URP)</strong>. We can do that using <strong class="screenText">Package Manager</strong>, a Unity window dedicated to managing official Unity plugins.</p>
    <p class="normal">Something to think about when you are installing those packages is that each package or plugin has its own version, independent of the Unity version. That means that you can have Unity 2022.1 installed, but Visual Effect Graph 13.1.8 or whatever version you want, and you can actually update the package to a newer version without upgrading Unity. </p>
    <p class="normal">This is important because some versions of these packages require a minimum version of Unity—for example, Visual Effect Graph 13.1.8 requires Unity 2022.1 as a minimum. Moreover, some packages depend on other packages and specific versions of those packages, so we need to ensure we have the correct versions of every package to ensure compatibility. To be clear, the dependencies of a package are installed automatically, but sometimes we can have them installed separately, so in that scenario, we need to check the required version. It sounds complicated, but it is simpler than it sounds.</p>
    <p class="normal">At the time of writing this book, in order to get Visual Effect Graph working properly, we need version 15.0.6, and we also need the same version of <strong class="screenText">Universal RP</strong>. Yes, Universal RP is another feature you can install using the Package Manager, but as we created the project using the <strong class="screenText">Universal RP</strong> template, it was already installed for us with the proper version. With that in mind, let’s install the Visual Effect Graph as follows:</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="1">In the top menu of Unity, go to <strong class="screenText">Window | Package Manager</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_34.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.34: Package Manager location</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="2">Remember to be sure the <strong class="screenText">Packages</strong> dropdown<a id="_idIndexMarker709"/> is in <strong class="screenText">Unity Registry</strong> mode, to see the Unity official packages list:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_35.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.35: Package Manager Unity Registry mode</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="3">In the left column, locate <strong class="screenText">Universal RP</strong> and check whether it says 15.0.6 or higher to the right. If it does, jump to <em class="italic">step 6</em>. Remember, though, that a higher version may look different or have different steps for use than the ones displayed in this chapter.</li>
      <li class="numberedList">If you don’t have version 15.0.6 or higher, click on the <strong class="screenText">Version History</strong> tab to the right of the panel to display a list of all possible versions to install. Locate <strong class="screenText">15.0.6</strong> and click it. In my case, it says <strong class="screenText">installed</strong> as I have that version already installed in the project, and there’s no other one available for Unity 2022:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_36.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.36: Package version selector</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="5">Click on the <strong class="screenText">Update to 15.0.6</strong> button in the bottom-right part of the window and wait for the package to update.</li>
      <li class="numberedList">Look for the <strong class="screenText">Visual Effect Graph </strong>package on the left side of the window. As you did with Universal RP, make sure you select version <strong class="screenText">15.0.6</strong> or the closest higher available version:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_37.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.37: Visual Effect Graph package</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="7">Click the <strong class="screenText">Install</strong> button at the bottom right of the window and wait for the package to install. Sometimes it is recommended to restart Unity after installing packages, so save your changes and restart<a id="_idIndexMarker710"/> Unity.</li>
    </ol>
    <p class="normal">Now that we have installed Visual Effect Graph, let’s create our first particle system using it.</p>
    <h2 id="_idParaDest-164" class="heading-2">Creating and analyzing Visual Effect Graph</h2>
    <p class="normal">The method to create<a id="_idIndexMarker711"/> a particle system<a id="_idIndexMarker712"/> using Visual Effect Graph is similar to a regular particle system. We will chain and configure modules as parts of the behavior of the particles, each module adding some specific behavior. First, we need to create <strong class="screenText">Visual Effect Graph</strong>, an asset that will contain all the modules and configurations, and then make a GameObject that will execute the graph asset to spawn particles. Let’s do that with the following steps:</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="1">In the <strong class="screenText">Project</strong> window, click on the <strong class="screenText">+</strong> button and look for <strong class="screenText">Visual Effects | Visual Effect Graph</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_38.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.38: Visual Effect Graph</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="2">From the new pop up, select the option <strong class="screenText">Simple Loop</strong> from the available templates. You can rename the file as Rain:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_39.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.39: Simple Loop template</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="3">Create an empty GameObject using the <strong class="screenText">GameObject</strong> | <strong class="screenText">Create Empty</strong> option:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_40.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.40: Empty GameObject creation</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="4">Select the created object and look at the Inspector.</li>
      <li class="numberedList">Using the <strong class="screenText">Add Component</strong> search bar, look for the <strong class="screenText">Visual Effect</strong> component and click on it to add it to the object:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_41_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.41: Adding a component to the Visual Effect Graph</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="6">Drag the <strong class="screenText">Visual Effect</strong> asset we created to the <strong class="screenText">Asset Template</strong> property of the Visual Effect component in our GameObject:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_42_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.42: Visual Effect using the previously created Visual Effect asset</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="7">You should see the gizmo of a Magic Lamp representing our object, which is the default state of the new <strong class="screenText">Visual Effect</strong> asset, meaning it’s being created correctly:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_43_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.43 Default Visual Effect asset results</p>
    <p class="normal">After creating the basic visual effect, and now that we have a base effect, let’s create something that requires a lot of particles, such as dense rain. Before doing so, we will explore some core concepts of Visual Effect Graph. If you double-click the <strong class="screenText">Visual Effect</strong> asset, you will see the following editor:</p>
    <figure class="mediaobject"><img src="../Images/B21361_11_44_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.44: Visual Effect Graph Editor window</p>
    <p class="normal">This window is composed<a id="_idIndexMarker713"/> of several interconnected<a id="_idIndexMarker714"/> nodes, generating a flow of actions to be executed. As with Shader Graph, you can navigate this window by keeping the <em class="keystroke">Alt</em> key (<em class="keystroke">Option</em> on Mac) pressed and dragging with the mouse the empty areas of the graph. At first, it seems similar to Shader Graph, but it works a little bit differently, so let’s study each section of the default graph.</p>
    <p class="normal">The first area to explore is the dotted one that contains three nodes. This is what Unity calls a <strong class="screenText">system</strong>. A System is a set of nodes that defines how a particle will behave, and you can have as many as you want, which is the equivalent of having several particle system objects. Each System is composed of <strong class="screenText">contexts</strong>, the nodes inside the dotted area, and in this case, we have <strong class="screenText">Initialize Particle</strong>, <strong class="screenText">Update Particle</strong>, and <strong class="screenText">Output Particle Quad</strong>. Each Context represents a different stage of the particle system logic flow, so let’s define what each Context in our graph does:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Initialize Particle</strong>: This defines the initial data<a id="_idIndexMarker715"/> of each emitted particle, such as position, color, speed, and size. It is similar to the <strong class="keyWord">Start</strong> properties in the <strong class="keyWord">Main</strong> module of the particle system we saw at the beginning of this chapter. The logic in this node will only execute when a new particle is emitted.</li>
      <li class="bulletList"><strong class="keyWord">Update Particle</strong>: Here, we can apply <a id="_idIndexMarker716"/>modifications to the data of the living particles. We can change particle data such as the current velocity or particle size of all the frames. This is similar to the <strong class="keyWord">Overtime</strong> nodes of the particle systems seen at the beginning of the chapter.</li>
      <li class="bulletList"><strong class="keyWord">Output Particle Quad</strong>: This Context will be executed when the particle<a id="_idIndexMarker717"/> needs to be rendered. It will read the particle data to see where to render, how to render, which texture and color to use, and the different visual settings. This is similar to the <strong class="keyWord">Renderer</strong> module of the previous particle system.</li>
    </ul>
    <p class="normal">Inside each Context, apart from some base <a id="_idIndexMarker718"/>configurations, we can add <strong class="screenText">blocks</strong>. Each block<a id="_idIndexMarker719"/> is an action that will be executed in the Context. We have actions that can be executed in any Context and then some specific Context actions. As an example, we can use an <strong class="screenText">Add Position </strong>block in the <strong class="screenText">Initialize Particle</strong> Context to move the initial particle position, but if we use the same block in the <strong class="screenText">Update Particle</strong> Context, it will move the particle constantly. So basically, Contexts are different situations that happen in the life of the particle, and blocks are actions that are executed in those situations:</p>
    <figure class="mediaobject"><img src="../Images/B21361_11_45_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.45: A Set Velocity Random block inside the Initialize Particle Context. This sets the initial velocity of a particle</p>
    <p class="normal">Also, we can have <strong class="screenText">standalone contexts</strong>, Contexts outside Systems, such as <strong class="screenText">Spawn</strong>. This Context is responsible for telling the System that a new particle needs to be created. We can add blocks to specify when the context will tell the system to create the particle, such as at a fixed rate over time, bursts, and so on. The idea is that <strong class="screenText">Spawn</strong> will create particles according to its blocks, while a System is responsible for initializing, updating, and rendering each of them, again, according to the blocks we set up inside each one of those Contexts.</p>
    <p class="normal">So, we can see that there are lots of similarities with regular particle<a id="_idIndexMarker720"/> systems, but the way to create a system here is quite<a id="_idIndexMarker721"/> different. Let’s reinforce this by creating a rain effect, which will require lots of particles—a nice use case for Visual Effect Graph.</p>
    <h2 id="_idParaDest-165" class="heading-2">Creating a rain effect</h2>
    <p class="normal">In order to create<a id="_idIndexMarker722"/> this effect, do<a id="_idIndexMarker723"/> the following:</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="1">Set the <strong class="screenText">Capacity</strong> property of the <strong class="screenText">Initialize Particle</strong> Context to <code class="inlineCode">10000</code>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_46_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.46 Initialize Particle Context</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="2">Set the <strong class="screenText">Constant SPawn Rate</strong> at the beginning of the graph to <code class="inlineCode">10000</code>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_47_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.47: Constant Spawn Rate block</p>
    <p class="normal">Before adding new nodes on the graph, we will delete the ones we won’t need to create our rain effect.</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="3">Right click over the node <strong class="screenText">Set Position (Shape: Arc Sphere)</strong> inside the <strong class="screenText">Initialize Particle Block</strong> and select <strong class="screenText">Delete</strong> to remove this node:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_48.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.48: Deleting the Set Position block</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="4">Repeat the process with the node Set Velocity from Direction &amp; Speed (New Direction) to remove it as well</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_49.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.49: Deleting the Set Velocity block</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="5">Right-click the Initialize Particle title, and select Create Block</li>
      <li class="numberedList">Search for the Set Velocity Random (Per-component) block and click on it to add it:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_50.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.50: Adding the Set Velocity Random block</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="7">Set the A and B properties to (0, -50, 0) and (0, -75, 0), respectively, in the Set Velocity Random block in the Initialize Particle Context. This will set a random velocity pointing downward for our particles:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_51.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.51: Set Velocity Random block</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="8">Right click over the node Gravity inside the Update Particles Block and select Delete to remove this node:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_52.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.52: Deleting the Gravity block</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="9">Repeat the process with the Linear Drag Block:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_53.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.53: Deleting the Linear Drag block</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="10">After this two deletions, the Update Particle Block will be empty:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_54.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.54: Empty Update Particles block</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="11">Right-click the <strong class="screenText">Initialize Particle</strong> title, and select <strong class="screenText">Create Block</strong>.</li>
      <li class="numberedList">Search for the <strong class="screenText">Set Position Random (Per-component)</strong> block and click on it:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_55.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.55: Adding blocks</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="13">Set the <strong class="screenText">A</strong> and <strong class="screenText">B</strong> properties<a id="_idIndexMarker724"/> of the <strong class="screenText">Set Position Random</strong> block to (<code class="inlineCode">-50</code>, <code class="inlineCode">0</code>, <code class="inlineCode">-50</code>) and (<code class="inlineCode">50</code>, <code class="inlineCode">0</code>, <code class="inlineCode">50</code>), respectively. This will define<a id="_idIndexMarker725"/> an initial area in which to randomly spawn the particle.</li>
      <li class="numberedList">Click the arrow at the left of the <strong class="screenText">Bounds</strong> property of the <strong class="screenText">Initialize Particle</strong> block to display its properties, and set <strong class="screenText">Center</strong> and <strong class="screenText">Size</strong> to (<code class="inlineCode">0</code>, <code class="inlineCode">-12.5</code>, <code class="inlineCode">0</code>) and (<code class="inlineCode">100</code>, <code class="inlineCode">25</code>, <code class="inlineCode">100</code>), respectively. This will define the area where the particles should be visible. Particles can actually move outside this area, but it is important to render the particles only in the areas we are interested in them being visible.</li>
    </ol>
    <p class="normal">Search for <code class="inlineCode">Frustum culling</code> on the internet for more information about bounds.</p>
    <figure class="mediaobject"><img src="../Images/B21361_11_56_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.56: Configuring blocks</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="15">Select the GameObject that is executing <a id="_idIndexMarker726"/>the system, and in the bottom-right window<a id="_idIndexMarker727"/> in the <strong class="screenText">Scene</strong> view, check the <strong class="screenText">Show Bounds</strong> checkbox to see the previously defined bounds:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_57_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.57: Visual Effect playback controls</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="16">If you don’t see the window at the bottom right, click the <strong class="screenText">VE</strong> (Visual Effect) button at the top left of the screen to display it. This button will be shown only if you have selected the <strong class="screenText">Rain</strong> visual effect GameObject in the <strong class="screenText">Hierarchy</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_58_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.58: Another way to display the Visual Effect playback controls</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="17">If you can’t see the changes<a id="_idIndexMarker728"/> being applied, click the <strong class="screenText">Compile</strong> button at the top<a id="_idIndexMarker729"/> left of the window, the one that looks like a paper bin beneath a downward-pointing arrow. Also, you can save your changes using <em class="keystroke">Ctrl</em> + <em class="keystroke">S</em> (<em class="keystroke">Command</em> + <em class="keystroke">S</em> on a Mac):</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_59_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.59: VFX asset saving controls</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="18">Set the object position to cover the whole base area. In my case, <strong class="screenText">Position</strong> is <code class="inlineCode">100</code>, <code class="inlineCode">37</code>, and <code class="inlineCode">100</code>. Remember that you need to change <strong class="screenText">Position</strong> of the <strong class="screenText">Transform</strong> component for this:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_60.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.60: Setting a Transform position</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="19">Set the <strong class="screenText">A</strong> and <strong class="screenText">B</strong> properties of the <strong class="screenText">Set Lifetime Random</strong> block in <strong class="screenText">Initialize Particle</strong> to <code class="inlineCode">0.5</code>. This will make the particles have a shorter life, ensuring that they are always inside the bounds:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_61_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.61: Set Lifetime Random block</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="20">Change the <strong class="screenText">Main Texture</strong> property<a id="_idIndexMarker730"/> of the <strong class="screenText">Output Particle Quad</strong> Context to another<a id="_idIndexMarker731"/> texture. In this case, the previously downloaded smoke texture can work here, even though it’s not water, because we will modify its appearance in a moment. Also, you can try to download a water droplet texture if you want to:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_62.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.62: VFX Graph Main Texture</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="21">Set <strong class="screenText">Blend Mode</strong> of the <strong class="screenText">Output Particle Quad</strong> Context to <strong class="screenText">Additive</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_63.png" alt="A picture containing text, screenshot, font, black  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 11.63: Additive mode of VFX graph</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="22">We need to stretch our particles a little bit to look like actual raindrops instead of falling balls. Before accomplishing that, first, we need to change the orientation of our particles so they don’t point at the camera all the time. In order to do this, right-click on the <strong class="screenText">Orient </strong>block in the <strong class="screenText">Output Particle Quad</strong> Context and select <strong class="screenText">Delete</strong> (or press <em class="keystroke">Delete</em> on a PC or <em class="keystroke">Command</em> + <em class="keystroke">Backspace</em> on a Mac):</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_64.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.64: Deleting a block</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="23">We want to stretch our particles <a id="_idIndexMarker732"/>according to their velocity direction. Another preparation<a id="_idIndexMarker733"/> step before actually doing that is to select the title of the <strong class="screenText">Output Particle Quad</strong> context and hit the spacebar to look for a block to add. In this case, we need to search and add the <strong class="screenText">Orient Along Velocity</strong> block.</li>
      <li class="numberedList">Add a <strong class="screenText">Set Scale</strong> block to the <strong class="screenText">Initialize Particle</strong> Context and set the <strong class="screenText">Scale</strong> property to <code class="inlineCode">0.25</code>, <code class="inlineCode">1.5</code>, and <code class="inlineCode">0.25</code>. This will stretch the particles to look like falling drops:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_65.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.65: Set Scale block</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="25">Click the <strong class="screenText">Compile</strong> button in the top-left window again to see the changes. Your system should look like this:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_66.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.66: Rain results</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="26">You can adjust the rest of the node values to change size and color of the particles over lifetime using both nodes inside Output Particle Quad Block.</li>
    </ol>
    <p class="normal">We have just modified lots of different properties of Visual Effect Graph, but if you want to have two instances of the same Visual Effect Graph, but with slight differences, I recommend you look at the <strong class="screenText">Blackboard</strong> feature, which will allow you to expose properties in the <strong class="screenText">Inspector</strong>. For example, you can make less dense rain in another scene, make the spawn rate lower, or change the particle color to make acid rain, all using the same graph, but let’s keep things simple for now.</p>
    <p class="normal">The <strong class="screenText">Blackboard</strong> feature is also present in <strong class="screenText">Shader Graph</strong>.</p>
    <p class="normal">From here, you can experiment<a id="_idIndexMarker734"/> by adding and removing blocks from the Contexts<a id="_idIndexMarker735"/> as you wish, and again, I recommend you look for an already-created Visual Effect Graph to find ideas for other systems. Actually, you can get ideas for Visual Effect Graph by looking at effects made in regular particle systems and using the analogous blocks. </p>
    <p class="normal">Also, I recommend<a id="_idIndexMarker736"/> you search for the Visual Effect Graph documentation online or at: <a href="mailto:https://docs.unity3d.com/Packages/com.unity.visualeffectgraph@15.0/manual/index.html"><span class="url">https://docs.unity3d.com/Packages/com.unity.visualeffectgraph@15.0/manual/index.html</span></a> to learn more about this system. You can also access the documentation of any Unity package by clicking the <strong class="screenText">Documentation</strong> button in the <strong class="screenText">Package Manager</strong> while the package is selected.</p>
    <figure class="mediaobject"><img src="../Images/B21361_11_67.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.67: Package Manager documentation link</p>
    <p class="normal">Now that we have learned<a id="_idIndexMarker737"/> how to create different<a id="_idIndexMarker738"/> visual effects, let’s see how to use them via scripting to achieve effects that react to what’s happening in the game.</p>
    <h2 id="_idParaDest-166" class="heading-2">Scripting Visual Effects</h2>
    <p class="normal">Visual feedback is the concept<a id="_idIndexMarker739"/> of using different VFX, such as particles and VFX Graph, to reinforce what is happening. For example, say right now we are shooting our weapon; we know that this is happening because we can see the bullets. However, it doesn’t feel like a real shooting effect because a proper shooting effect should have a muzzle effect on the tip of our gun. Another example would be the enemy dying—it just disappears with no animation! That doesn’t feel as satisfying as it could be. We can instead add a little explosion (considering they are robots).</p>
    <p class="normal">Let’s start making our enemies spawn an explosion when they are destroyed by doing the following:</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="1">Create an explosion effect or download one from the Asset Store. It shouldn’t loop, and it needs to be destroyed automatically when the explosion is over (ensure <strong class="screenText">Looping</strong> is unchecked and <strong class="screenText">Stop Action</strong> is set to <strong class="screenText">Destroy</strong> in the <strong class="screenText">Main</strong> module). Feel free to use the same one we did previously in this chapter.</li>
      <li class="numberedList">Some explosions in the Asset Store might use non-URP-compatible shaders. The <strong class="screenText">Asset Store</strong> page of the package specifies if the package supports URP. You can also fix them by using <strong class="screenText">Window | Rendering | Render Pipeline Converter</strong>, as we saw in <em class="chapterRef">Chapter 4</em>, <em class="italic">Seamless Integration: Importing and Integrating Assets</em>.</li>
      <li class="numberedList">Manually upgrade the materials that didn’t upgrade automatically.</li>
      <li class="numberedList">Add a script to the <code class="inlineCode">Enemy</code> Prefab called <code class="inlineCode">ExplosionOnDeath</code>. This will be responsible for spawning the particles Prefab when the enemy dies.</li>
      <li class="numberedList">Add a field of the <strong class="screenText">GameObject</strong> type called <code class="inlineCode">particlePrefab</code> and drag the <code class="inlineCode">explosion</code> Prefab to it.
    <p class="normal">You may be expecting to add the explosion spawning to the <strong class="screenText">Life</strong> component. In that case, you are assuming that anything to do with life will spawn a particle when dying, but consider scenarios where characters die with a falling animation instead, or maybe an object that just despawns with no effect whatsoever. If a certain behavior is not used in most scenarios, it is better to code it in a separate optional script to allow us to mix and match different components and get the exact behavior we want.</p></li>
    </ol>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="6">Make the script access the <code class="inlineCode">Life</code> component we created in <em class="chapterRef">Chapter 8</em>, <em class="italic">Victory or Defeat: Win and Lose Conditions</em>, of this book and subscribe to its <code class="inlineCode">OnDeath</code> event.</li>
      <li class="numberedList">In the <code class="inlineCode">listener</code> function, let’s instantiate<a id="_idIndexMarker740"/> the particle system in the same location:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_68_PE.png" alt="Graphical user interface, text, application, chat or text message  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 11.68: The explosion spawner script</p>
    <p class="normal">The visual scripting version would look like this:</p>
    <figure class="mediaobject"><img src="../Images/B21361_11_69_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.69: The explosion spawner visual script</p>
    <p class="normal">As you can see, we are just using the same concepts<a id="_idIndexMarker741"/> we learned about in previous chapters but combining them in new ways. This is what programming is all about.</p>
    <p class="normal">Let’s continue with the muzzle effect, which makes our gun feel more realistic and provides feedback about the player’s avatar shooting. It could also be a particle system, but we will take another approach this time:</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="1">If you don’t have one already, download a weapon model from the Asset Store. The character in the package we used in the book already comes with one, so we will use that one.</li>
      <li class="numberedList">If it’s not already on your character, instantiate the weapon so that it is the parent of the hand of the player. Remember that our character is rigged and has a hand bone, so you should put the weapon there.
    <p class="normal">The weapon that comes<a id="_idIndexMarker742"/> with the character we downloaded in this book is a special scenario where the weapon has a <strong class="keyWord">SkinnedMeshRenderer</strong> component. This component<a id="_idIndexMarker743"/> uses the <strong class="keyWord">Skinning Animation</strong> system that we will learn to use in <em class="chapterRef">Chapter 17</em>, <em class="italic">Animated Realities: Creating Animations with Animator, Cinemachine, and Timeline</em>. In this case, the movement of the weapon will be affected by the animations we will use in that chapter, so for now, let’s keep the weapon where it is located now, even if it looks odd.</p></li>
    </ol>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="3">Create or get a muzzle particle system. In this case, my muzzle particle system was created as a short particle system that has a burst of particles and then automatically stops. Try to get one with that behavior because there are others out there that will loop instead, and the script to handle that scenario would be different.</li>
      <li class="numberedList">Create an instance of the particle<a id="_idIndexMarker744"/> system Prefab in the Editor and parent it inside the weapon, locating it in front of the weapon, aligned with the cannon of the gun. Make sure the <strong class="screenText">Play On Awake</strong> property of the <strong class="screenText">Main</strong> module of the particle system is unchecked; we don’t want the muzzle to fire until we press the <strong class="screenText">Fire</strong> key:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_70_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.70: The muzzle parented to the weapon</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="5">Create a field of the <code class="inlineCode">ParticleSystem</code> type called <code class="inlineCode">muzzleEffect</code> in <code class="inlineCode">PlayerShooting</code>.</li>
      <li class="numberedList">Drag the muzzle effect GameObject that is parented in the gun to it in the Inspector. Now, we have a reference to the <strong class="screenText">ParticleSystem</strong> component of the muzzle to manage it.</li>
      <li class="numberedList">Inside the <code class="inlineCode">if</code> statement that checks whether we are shooting, execute <code class="inlineCode">muzzleEffect.Play();</code> to play the particle system. It will automatically stop and is short enough to finish between key presses:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_71_PE.png" alt="Graphical user interface, text, application  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 11.71: The muzzle parented to the weapon</p>
    <p class="normal">The visual scripting version’s additional nodes<a id="_idIndexMarker745"/> and variables would be the following:</p>
    <figure class="mediaobject"><img src="../Images/B21361_11_72_PE.png" alt="Graphical user interface, application  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 11.72: The muzzle playing visual script</p>
    <p class="normal">Finally, we also need to play the muzzle<a id="_idIndexMarker746"/> effect on the AI while shooting by doing the following:</p>
    <ol style="list-style-type: decimal;" class="numberedList">
      <li class="numberedList" value="1">As we did with <code class="inlineCode">PlayerShooting</code>, create a field of the <code class="inlineCode">ParticleSystem</code> type called <code class="inlineCode">muzzleEffect</code> in <code class="inlineCode">EnemyFSM</code>.</li>
      <li class="numberedList">Inside the <code class="inlineCode">Shoot</code> method, add the line <code class="inlineCode">muzzleEffect.Play();</code> at the end of the method to play the particle system:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B21361_11_73_PE.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 11.73: The muzzle playing C# script</p>
    <p class="normal">The visual scripting version’s additional nodes for <strong class="screenText">Attack State</strong> and <strong class="screenText">Attack</strong> <code class="inlineCode">Base</code> will be as follows:</p>
    <figure class="mediaobject"><img src="../Images/B21361_11_74_PE.png" alt="Graphical user interface, text, application, chat or text message  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 11.74: The muzzle playing script for Attack State</p>
    <p class="normal">Remember to add those nodes<a id="_idIndexMarker747"/> to both attack states and to add the <strong class="screenText">muzzleEffect</strong> variable to the AI Variables component.</p>
    <h1 id="_idParaDest-167" class="heading-1">Summary</h1>
    <p class="normal">In this chapter, we discussed two different ways to create particle systems: using regular particle systems and VFX Graph. We used them to simulate different fluid phenomena, such as fire, a waterfall, smoke, and rain. The idea is to combine particle systems with meshes to generate all the possible props needed for your scene. Also, as you can imagine, creating these kinds of effects professionally requires you to go deeper. </p>
    <p class="normal">If you want to dedicate yourself to this (another part of the job of a technical artist), you will need to learn how to create your own particle textures to get the exact look and feel you want, code scripts that control certain aspects of the systems, and several other aspects of particle creation. However, that is outside the scope of the book.</p>
    <p class="normal">Now that we have some rain in our scene, we can see that the sky and the lighting in the scene don’t really reflect a rainy day, so let’s fix that in the next chapter!</p>
    <h1 id="_idParaDest-168" class="heading-1">Learn more on Discord</h1>
    <p class="normal">Read this book alongside other users, Unity game development experts, and the author himself. Ask questions, provide solutions to other readers, chat with the author via Ask Me Anything sessions, and much more. Scan the QR code or visit the link to join the community:</p>
    <p class="normal"><a href="https://packt.link/unitydev"><span class="url">https://packt.link/unitydev</span></a></p>
    <p class="normal"><img src="../Images/QR_Code1498477041053909218.png" alt="" role="presentation"/></p>
  </div>
</body></html>