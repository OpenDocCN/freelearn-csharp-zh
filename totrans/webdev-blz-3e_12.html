<html><head></head><body>
<div><h1 class="chapterNumber">12</h1>
<h1 class="chapterTitle" id="_idParaDest-214">Debugging the Code</h1>
<p class="normal">In this chapter, we will take a look at debugging. The <a id="_idIndexMarker490"/>debugging experience of Blazor is a good one; hopefully, you haven’t gotten stuck earlier on in the book and had to jump to this chapter.</p>
<p class="normal">Debugging code is<a id="_idIndexMarker491"/> an excellent way to solve bugs, understand the workflow, or look at specific values. Blazor has three different ways to debug code, and we will look at each one.</p>
<p class="normal">In this chapter, we will cover the following:</p>
<ul>
<li class="bulletList">Making things break</li>
<li class="bulletList">Debugging Blazor Server</li>
<li class="bulletList">Debugging Blazor WebAssembly</li>
<li class="bulletList">Debugging Blazor WebAssembly in the browser</li>
<li class="bulletList">Hot Reload</li>
</ul>
<h1 class="heading-1" id="_idParaDest-215">Technical requirements</h1>
<p class="normal">Make sure you have followed the previous chapters or use the <code class="inlineCode">Chapter11</code> folder as a starting point.</p>
<p class="normal">You can find the source code for this chapter’s end result at <a href="https://github.com/PacktPublishing/Web-Development-with-Blazor-Third-Edition/tree/main/Chapter12">https://github.com/PacktPublishing/Web-Development-with-Blazor-Third-Edition/tree/main/Chapter12</a>.</p>
<p class="normal">If you are jumping into this chapter using the code from GitHub, make sure you have added <code class="inlineCode">Auth0</code> account information in the settings files. You can find the instructions in <em class="chapterRef">Chapter 8</em>, <em class="italic">Authentication and Authorization</em>.</p>
<p class="normal">To debug something, we should first make something break!</p>
<h1 class="heading-1" id="_idParaDest-216">Making things break</h1>
<p class="normal">Edsger W. Dijkstra once said,</p>
<p class="normal"><em class="italic">“If debugging is the process of removing software bugs, then programming must be the process of putting them in.”</em></p>
<p class="normal">This is definitely <a id="_idIndexMarker492"/>true in this section because we will add a page that will <a id="_idIndexMarker493"/>throw an exception:</p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1">In the <code class="inlineCode">SharedComponents</code> project, in the <code class="inlineCode">Pages</code> folder, create a new Razor component called <code class="inlineCode">ThrowException.razor</code>.</li>
<li class="numberedList">Replace the contents of the file with the following code block:
        <pre class="programlisting code"><code class="hljs-code">@page "/ThrowException"
@rendermode @(new InteractiveServerRenderMode(prerender: false))
&lt;button @onclick="@(()=&gt; {throw new Exception("Something is broken"); })"&gt;Throw an exception&lt;/button&gt;
</code></pre>
</li>
</ol>
<p class="normal">This page shows a button, and when you press it, it throws an exception.</p>
<p class="normal">Great! We have our application’s Ivan Drago (he wants to break us, but we might just beat him with some fancy debugging).</p>
<p class="normal">The next step is to take a look at Blazor Server debugging.</p>
<h1 class="heading-1" id="_idParaDest-217">Debugging Blazor Server</h1>
<p class="normal">If you have <a id="_idIndexMarker494"/>debugged any .NET application in the past, you will feel<a id="_idIndexMarker495"/> right at home. Don’t worry; we will go through it if you haven’t. Debugging Blazor Server is just as we might expect and is the best debugging experience of the three different types we will cover.</p>
<p class="normal">I usually keep my Razor pages in a shared library, and while building my project, I use Blazor Server for two reasons. First, running the project is a bit faster, and second, the debugging<a id="_idIndexMarker496"/> experience is better.</p>
<p class="normal">Let’s give it a try!</p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1">Press <em class="keystroke">F5</em> to start the project (this time with debugging).</li>
<li class="numberedList">Using the web browser, navigate to <code class="inlineCode">https://localhost:portnumber/throwexception</code> (the port number may vary).</li>
<li class="numberedList">Press <em class="keystroke">F12</em> to show the web browser developer tools.</li>
<li class="numberedList">In the developer tools, click <strong class="screenText">Console</strong>.</li>
<li class="numberedList">Click the <strong class="screenText">Throw exception</strong> button on our page.
    <p class="normal">At this<a id="_idIndexMarker497"/> point, Visual Studio should request focus, and it should show the exception as shown in <em class="italic">Figure 12.1</em>:</p>
<figure class="mediaobject"><img alt="Figure 12.1 – Exception in Visual Studio " src="img/B21849_12_01.png"/></figure>
<p class="packt_figref">Figure 12.1: Exception in Visual Studio</p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="6">Press <em class="keystroke">F5</em> to continue and switch back to the web browser. We should now be able to see the exception message in the developer tools, as shown in <em class="italic">Figure 12.2</em>:
    <figure class="mediaobject"><img alt="Figure 12.2 – Exception in the web browser" src="img/B21849_12_02.png"/></figure>
<p class="packt_figref">Figure 12.2: Exception in the web browser</p>
<p class="normal">As we can see in <em class="italic">Figure 12.1</em> and <em class="italic">Figure 12.2</em>, we get the exception both in Visual Studio while debugging and also in the developer tools.</p>
<p class="normal">This makes it quite easy to find the problem if there is an exception in an app in production (perish the thought) – that feature has saved us many times.</p>
<p class="normal">Now let’s try a breakpoint:</p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="7">In <a id="_idIndexMarker498"/>Visual Studio, open <code class="inlineCode">Pages/Home.razor</code>.</li>
<li class="numberedList">Anywhere in the <code class="inlineCode">LoadPosts</code> method, set a breakpoint by clicking the leftmost border (making a red dot appear). We can also add a breakpoint by pressing <em class="keystroke">F9</em>.</li>
<li class="numberedList">Go back to the web browser and navigate to <code class="inlineCode">https://localhost:portnumber/</code> (the port number may vary).</li>
</ol>
<p class="normal">Visual Studio <a id="_idIndexMarker499"/>should now hit the breakpoint, and by hovering over variables, we should be able to see the current values.</p>
<p class="normal">Both breakpoints and exception debugging work as we might expect. Next, we will take a look at debugging Blazor WebAssembly.</p>
<h1 class="heading-1" id="_idParaDest-218">Debugging Blazor WebAssembly</h1>
<p class="normal">Blazor WebAssembly <a id="_idIndexMarker500"/>can, of course, be debugged<a id="_idIndexMarker501"/> as well. There are a couple of things to keep in mind. Debugging <code class="inlineCode">InteractiveWebAssembly</code>, like we are using in our blog, is going to work just the same as with Blazor Server. Breakpoints and exceptions will work just the same. However, there is an option to run Blazor WebAssembly as a standalone app. And that works a bit differently.</p>
<p class="normal">To be able to play around with that, we need to add another project.</p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1">Right-click on the <strong class="screenText">MyBlog solution</strong>, select <strong class="screenText">Add</strong>, <strong class="screenText">New Project</strong>…, and select <strong class="screenText">Blazor WebAssembly Standalone App</strong>.</li>
<li class="numberedList">Change the project name to <code class="inlineCode">BlazorWebAssemblyApp</code>.</li>
<li class="numberedList">Leave the default values as is and click <strong class="screenText">Create</strong>.</li>
<li class="numberedList">Right-click on our <strong class="screenText">BlazorWebAssemblyApp</strong> project and select <strong class="screenText">Set as Startup Project</strong>.</li>
<li class="numberedList">In the <strong class="screenText">Pages</strong> folder, open <code class="inlineCode">Counter.razor</code> and add a breakpoint on the <code class="inlineCode">currentCount++</code> row.</li>
<li class="numberedList">Run the project by pressing <em class="keystroke">F5</em>, and lo and behold, the breakpoint is hit.</li>
</ol>
<p class="normal">This has <a id="_idIndexMarker502"/>not always been the case, and I was actually pleasantly surprised it worked that well. In previous versions of .NET, you had to click on another page and then back to have breakpoints hit.</p>
<p class="normal">Debugging<a id="_idIndexMarker503"/> Blazor WebAssembly is made possible by the following line of code in the <code class="inlineCode">launchSettings.json</code> file:</p>
<pre class="programlisting code"><code class="hljs-code">"inspectUri": "{wsProtocol}://{url.hostname}:{url.port}/_framework/debug/ws-proxy?browser={browserInspectUri}"
</code></pre>
<p class="normal">But it is supplied for us when we create the project, so we don’t need to add that manually.</p>
<p class="normal">Now let’s see what happens with our exception:</p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1">Copy our <code class="inlineCode">ThrowException.razor</code> file and put it in the <code class="inlineCode">BlazorWebAssemblyApp/Pages</code> folder.</li>
<li class="numberedList">In the copied file, remove the <code class="inlineCode">@rendermode</code> line. Since the WebAssembly project is all WebAssembly, we don’t need to specify render mode.</li>
<li class="numberedList">In the web browser, navigate to <code class="inlineCode">https://localhost:portnumber/throwexception</code>.</li>
<li class="numberedList">Click the <strong class="screenText">Throw exception</strong> button.</li>
<li class="numberedList">The unhandled exception won’t get hit in Visual Studio. We get the exception in the developer tools in the web browser, as shown in <em class="italic">Figure 12.3</em>:</li>
</ol>
<figure class="mediaobject"><img alt="Figure 12.3 – WebAssembly error" src="img/B21849_12_03.png"/></figure>
<p class="packt_figref">Figure 12.3: WebAssembly error</p>
<p class="normal">The <a id="_idIndexMarker504"/>debugging<a id="_idIndexMarker505"/> experience in Blazor WebAssembly is not as polished as with Blazor Server, but it is polished enough to get the job done.</p>
<p class="normal">We have one method left to explore – debugging in the web browser.</p>
<h1 class="heading-1" id="_idParaDest-219">Debugging Blazor WebAssembly in the web browser</h1>
<p class="normal">The <a id="_idIndexMarker506"/>first debugging<a id="_idIndexMarker507"/> experience for Blazor WebAssembly was the ability to debug right in the web browser:</p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1">In Visual Studio, start the project by pressing <em class="keystroke">Ctrl</em> + <em class="keystroke">F5</em> (run without debugging).</li>
<li class="numberedList">In the web browser, press <em class="keystroke">Shift</em> + <em class="keystroke">Alt</em> + <em class="keystroke">D</em>.
    <p class="normal">We will get an error message with instructions on how to start the web browser in debug mode.</p>
<p class="normal">I am running Edge, so the way to start Edge would be something like this:</p>
<pre class="programlisting con"><code class="hljs-con">msedge --remote-debugging-port=9222 --user-data-dir="C:\Users\Jimmy\AppData\Local\Temp\blazor-edge-debug" --no-first-run https://localhost:5001/
</code></pre>
<p class="normal">The <code class="inlineCode">port</code> and <code class="inlineCode">user-data-dir</code> values will differ from the example above. Copy <a id="_idIndexMarker508"/>the command from your web browser.</p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3">Press <em class="keystroke">Win</em> + <em class="keystroke">R</em> and paste the command.</li>
<li class="numberedList">A new instance of Chrome or Edge will open. In this new instance, press <em class="keystroke">Shift</em> + <em class="keystroke">Alt</em> + <em class="keystroke">D</em>.</li>
<li class="numberedList">We should <a id="_idIndexMarker509"/>now see a <strong class="screenText">Sources</strong> tab containing C# code from our project. From here, we can put breakpoints that will be hit and hover over variables. Make sure to have only this tab open in the web browser (not multiple tabs open).</li>
</ol>
<p class="normal">The debug UI can be seen in <em class="italic">Figure 12.4</em>:</p>
<figure class="mediaobject"><img alt="Figure 12.4 – Screenshot of the in-browser debug" src="img/B21849_12_04.png"/></figure>
<p class="packt_figref">Figure 12.4: Screenshot of the in-browser debug UI</p>
<p class="normal">Debugging C# code<a id="_idIndexMarker510"/> in the browser is <a id="_idIndexMarker511"/>pretty amazing, but since we have been directly debugging in Visual Studio, I don’t see much use for this kind of debugging.</p>
<p class="normal">Next, we will look at something that might not fall under debugging but is useful while developing Blazor apps.</p>
<h1 class="heading-1" id="_idParaDest-220">Hot Reload</h1>
<p class="normal">In <a id="_idIndexMarker512"/>Visual Studio<a id="_idIndexMarker513"/> and the <strong class="keyWord">dotnet CLI</strong>, we can enable <strong class="keyWord">Hot Reload</strong>. This means that as soon as we make changes in our application, our Blazor app will automatically get reloaded, and we will (in most cases) not lose the state.</p>
<p class="normal">To set this up, do the following:</p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1">In Visual Studio, there is a small fire icon. We can use this button to trigger <strong class="screenText">Hot Reload</strong> manually.
    <p class="normal">It is only clickable when the application is running (with or without debugging).</p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="2">Select the <strong class="screenText">Hot Reload on File Save</strong> option.</li>
<li class="numberedList">Start the project by pressing <em class="keystroke">Ctrl</em> + <em class="keystroke">F5</em>.</li>
<li class="numberedList">In the web browser, bring up the counter page by adding <code class="inlineCode">/counter</code> to the URL.</li>
<li class="numberedList">Make a change to the <code class="inlineCode">/Pages/Counter.razor</code> file and click <strong class="screenText">Save</strong>.</li>
</ol>
<p class="normal">Our web <a id="_idIndexMarker514"/>browser should now reload, and the change will be shown. At the time of writing, my Hot Reload did not find any changes when running in Visual Studio, but it did work with <code class="inlineCode">dotnet watch</code>.</p>
<p class="normal">Hot Reload does save time and is pretty amazing. Not having to recompile the project and start up a web browser and seeing the changes in the browser just seconds after you save the file is simply amazing. However, there are some cases where our site behaves oddly, and then we need to rebuild. Therefore, you need to remember that if there is an unexplainable issue, you might need to build the project again.</p>
<p class="normal">This also works from the command line by running the following command:</p>
<pre class="programlisting con"><code class="hljs-con">dotnet watch
</code></pre>
<p class="normal">Hot reload gets better and better with each release. I usually run preview versions of Visual Studio to get the best experience, but that can also sometimes have its drawbacks.</p>
<h1 class="heading-1" id="_idParaDest-221">Summary</h1>
<p class="normal">This chapter looked at different ways to debug our Blazor application. There will always be moments when we need to step through the code to find a bug or see what is happening. When these moments are upon us, Visual Studio delivers world-class functionality to help us achieve our goals.</p>
<p class="normal">The nice thing is that debugging Blazor applications, whether it’s Blazor Server or Blazor WebAssembly, will work as expected from a Microsoft product. We get C# errors that are (in most cases) easy to understand and solve.</p>
<p class="normal">In the next chapter, we will look at testing our Blazor components.</p>
</div>
</body></html>