<html><head></head><body>
  <div id="_idContainer045">
   <h1 class="chapter-number" id="_idParaDest-273">
    <a id="_idTextAnchor273">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     8
    </span>
   </h1>
   <h1 id="_idParaDest-274">
    <a id="_idTextAnchor274">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Keeping the Application Secure
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.3.1">
     In this chapter, we focus on essential security practices for Blazor applications, as protecting user data and maintaining trust is crucial for any
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.4.1">
      commercial success.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.5.1">
     We will start by scaffolding identity – setting up the necessary infrastructure for user authentication and management by leveraging the template provided by the .NET team.
    </span>
    <span class="koboSpan" id="kobo.5.2">
     We will look at strategies to prevent unauthorized access and protect your component from unwanted actors.
    </span>
    <span class="koboSpan" id="kobo.5.3">
     Additionally, we will cover a more granular approach and secure markup areas to customize the component behavior and ensure that sensitive information is only accessible to authorized users.
    </span>
    <span class="koboSpan" id="kobo.5.4">
     We will explore how to define and enforce
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.6.1">
      roles
     </span>
    </strong>
    <span class="koboSpan" id="kobo.7.1">
     and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.8.1">
      policies
     </span>
    </strong>
    <span class="koboSpan" id="kobo.9.1">
     to centralize and encapsulate access levels that align with your security requirements.
    </span>
    <span class="koboSpan" id="kobo.9.2">
     Next, we will learn how to determine users’
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.10.1">
      authentication state
     </span>
    </strong>
    <span class="koboSpan" id="kobo.11.1">
     and their current
    </span>
    <a id="_idIndexMarker389">
    </a>
    <span class="koboSpan" id="kobo.12.1">
     access context, allowing us to secure and enhance backend logic.
    </span>
    <span class="koboSpan" id="kobo.12.2">
     We will also discuss how to update user identity safely
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.13.1">
      and securely.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.14.1">
     By the end of this chapter, you will understand various security mechanisms in Blazor and have the best security practices in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.15.1">
      your skillset.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.16.1">
     Here’s a list of the recipes we
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.17.1">
      will cover:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.18.1">
       Scaffolding identity
      </span>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.19.1">
       Securing pages
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.20.1">
      Securing
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.21.1">
       markup areas
      </span>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.22.1">
       Creating roles
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.23.1">
      Modifying a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.24.1">
       user’s identity
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.25.1">
      Supporting roles’ and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.26.1">
       policies’ authorization
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.27.1">
      Resolving authentication state in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.28.1">
       procedural logic
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-275">
    <a id="_idTextAnchor275">
    </a>
    <span class="koboSpan" id="kobo.29.1">
     Technical requirements
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.30.1">
     In this chapter, recipes build on one another, resulting in a guide through the most often required identity features.
    </span>
    <span class="koboSpan" id="kobo.30.2">
     For clarity, at the beginning of each recipe, you will find instructions on how to set up a working directory and where to get the sample objects from.
    </span>
    <span class="koboSpan" id="kobo.30.3">
     On top of that, this chapter requires that you have a working
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.31.1">
      Structured Query Language
     </span>
    </strong>
    <span class="koboSpan" id="kobo.32.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.33.1">
      SQL
     </span>
    </strong>
    <span class="koboSpan" id="kobo.34.1">
     ) database, a connection string to the database instance, and a SQL IDE as you will need to run a few custom migrations.
    </span>
    <span class="koboSpan" id="kobo.34.2">
     Most of the tables will be scaffolded for you, so don’t stress if you don’t have much experience with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.35.1">
      SQL itself.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.36.1">
     All the code samples are available on GitHub
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.37.1">
      at:
     </span>
    </span>
    <a href="https://github.com/PacktPublishing/Blazor-Web-Development-Cookbook/tree/main/Chapter08/BlazorCookbook.Auth">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.38.1">
       https://github.com/PacktPublishing/Blazor-Web-Development-Cookbook/tree/main/Chapter08/BlazorCookbook.Auth
      </span>
     </span>
    </a>
   </p>
   <h1 id="_idParaDest-276">
    <a id="_idTextAnchor276">
    </a>
    <span class="koboSpan" id="kobo.39.1">
     Scaffolding identity
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.40.1">
     The .NET team provides a template that enables adding authentication to your Blazor application rapidly.
    </span>
    <span class="koboSpan" id="kobo.40.2">
     This template is not only quick to set up but also highly customizable.
    </span>
    <span class="koboSpan" id="kobo.40.3">
     You can streamline the implementation of user authentication, registration, and profile management, ensuring that your application is secure from the get-go.
    </span>
    <span class="koboSpan" id="kobo.40.4">
     You get essential features such as login and logout functionality, password recovery, and user data management – all crucial for any
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.41.1">
      authentication system.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.42.1">
     Let’s scaffold a new Blazor project with authentication enabled and explore the features it offers out of the box.
    </span>
    <span class="koboSpan" id="kobo.42.2">
     By the
    </span>
    <a id="_idIndexMarker390">
    </a>
    <span class="koboSpan" id="kobo.43.1">
     end of this recipe, you will have a solid foundation and understanding of the identity system.
    </span>
    <span class="koboSpan" id="kobo.43.2">
     Whether you’re building a simple app or a complex enterprise solution, this approach will save you time and effort while ensuring your application meets modern
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.44.1">
      security standards.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-277">
    <a id="_idTextAnchor277">
    </a>
    <span class="koboSpan" id="kobo.45.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.46.1">
     We will showcase initializing the project with identity, leveraging the GUI provided as part of Visual Studio, so the only pre-requirement in this recipe is that you start your IDE.
    </span>
    <span class="koboSpan" id="kobo.46.2">
     Let’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.47.1">
      dive in.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.48.1">
     If you’re using the .NET CLI in your environment, you can refer to the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.49.1">
      There’s more…
     </span>
    </em>
    <span class="koboSpan" id="kobo.50.1">
     section at the end of the recipe, where I’ll provide
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.51.1">
      equivalent commands.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-278">
    <a id="_idTextAnchor278">
    </a>
    <span class="koboSpan" id="kobo.52.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.53.1">
     Follow these steps to
    </span>
    <a id="_idIndexMarker391">
    </a>
    <span class="koboSpan" id="kobo.54.1">
     scaffold a new Blazor project
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.55.1">
      with identity:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.56.1">
      Select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.57.1">
       Create a new project
      </span>
     </strong>
     <span class="koboSpan" id="kobo.58.1">
      from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.59.1">
       welcome window:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer032">
     <span class="koboSpan" id="kobo.60.1">
      <img alt="Figure 8.1: Starting the creation of a new project from the welcome window" src="image/Figure_8.1_B22020.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.61.1">
     Figure 8.1: Starting the creation of a new project from the welcome window
    </span>
   </p>
   <ol>
    <li value="2">
     <span class="koboSpan" id="kobo.62.1">
      Use the search bar at the top of the panel to find the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.63.1">
       Blazor Web App
      </span>
     </strong>
     <span class="koboSpan" id="kobo.64.1">
      position and confirm by clicking the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.65.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.66.1">
       button:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer033">
     <span class="koboSpan" id="kobo.67.1">
      <img alt="Figure 8.2: Selecting Blazor Web App from available project templates" src="image/Figure_8.2_B22020.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.68.1">
     Figure 8.2: Selecting Blazor Web App from available project templates
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.69.1">
      Define a project
     </span>
     <a id="_idIndexMarker392">
     </a>
     <span class="koboSpan" id="kobo.70.1">
      location and name and confirm by clicking the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.71.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.72.1">
       button:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer034">
     <span class="koboSpan" id="kobo.73.1">
      <img alt="Figure 8.3: Setting a project location and name" src="image/Figure_8.3_B22020.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.74.1">
     Figure 8.3: Setting a project location and name
    </span>
   </p>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.75.1">
      Choose
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.76.1">
       .NET 9.0 (Standard Term Support)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.77.1">
      as the target framework, and in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.78.1">
       Authentication type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.79.1">
      section, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.80.1">
       Individual Accounts
      </span>
     </strong>
     <span class="koboSpan" id="kobo.81.1">
      .
     </span>
     <span class="koboSpan" id="kobo.81.2">
      Make sure to check the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.82.1">
       Configure for HTTPS
      </span>
     </strong>
     <span class="koboSpan" id="kobo.83.1">
      and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.84.1">
       Include sample pages
      </span>
     </strong>
     <span class="koboSpan" id="kobo.85.1">
      checkboxes, and select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.86.1">
       Auto (Server and WebAssembly)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.87.1">
      and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.88.1">
       Per page/component
      </span>
     </strong>
     <span class="koboSpan" id="kobo.89.1">
      from the
     </span>
     <a id="_idIndexMarker393">
     </a>
     <span class="koboSpan" id="kobo.90.1">
      interactivity configuration dropdowns.
     </span>
     <span class="koboSpan" id="kobo.90.2">
      Confirm by clicking the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.91.1">
        Create
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.92.1">
       button:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer035">
     <span class="koboSpan" id="kobo.93.1">
      <img alt="Figure 8.4: Configuring the project’s framework, interactivity, and authentication" src="image/Figure_8.4_B22020.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.94.1">
     Figure 8.4: Configuring the project’s framework, interactivity, and authentication
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.95.1">
     You will arrive at
    </span>
    <a id="_idIndexMarker394">
    </a>
    <span class="koboSpan" id="kobo.96.1">
     a similar project setup, which may vary depending on the name of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.97.1">
      your project:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer036">
     <span class="koboSpan" id="kobo.98.1">
      <img alt="Figure 8.5: Initial solution structure" src="image/Figure_8.5_B22020.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.99.1">
     Figure 8.5: Initial solution structure
    </span>
   </p>
   <h2 id="_idParaDest-279">
    <a id="_idTextAnchor279">
    </a>
    <span class="koboSpan" id="kobo.100.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.101.1">
     The entire process is almost the same as we explored in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.102.1">
      Initializing a project
     </span>
    </em>
    <span class="koboSpan" id="kobo.103.1">
     recipe in
    </span>
    <a href="B22020_01.xhtml#_idTextAnchor020">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.104.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.105.1">
     .
    </span>
    <span class="koboSpan" id="kobo.105.2">
     Navigate there for the first three steps.
    </span>
    <span class="koboSpan" id="kobo.105.3">
     Here, we focus on
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.106.1">
       step 4
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.107.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.108.1">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.109.1">
      step 4
     </span>
    </em>
    <span class="koboSpan" id="kobo.110.1">
     , we land on the project configuration panel.
    </span>
    <span class="koboSpan" id="kobo.110.2">
     First, we select
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.111.1">
      .NET 9 (Standard Term Support)
     </span>
    </strong>
    <span class="koboSpan" id="kobo.112.1">
     as our target framework.
    </span>
    <span class="koboSpan" id="kobo.112.2">
     Then, we have an
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.113.1">
      Authentication type
     </span>
    </strong>
    <span class="koboSpan" id="kobo.114.1">
     section.
    </span>
    <span class="koboSpan" id="kobo.114.2">
     Here, we opt for the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.115.1">
      Individual Accounts
     </span>
    </strong>
    <span class="koboSpan" id="kobo.116.1">
     option, instructing Visual Studio to scaffold the code supporting identity in our application.
    </span>
    <span class="koboSpan" id="kobo.116.2">
     We also enable HTTPS and generate sample pages by checking the respective checkboxes.
    </span>
    <span class="koboSpan" id="kobo.116.3">
     Lastly, to complete the configuration setup, we define the interactivity of our application – we will
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.117.1">
      use a
     </span>
    </span>
    <span class="koboSpan" id="kobo.118.1">
     per-page/component interactivity location and a mix of Server and WebAssembly rendering.
    </span>
    <span class="koboSpan" id="kobo.118.2">
     Next, we see the result of the scaffolding – a solution with two projects for the server and
    </span>
    <a id="_idIndexMarker395">
    </a>
    <span class="koboSpan" id="kobo.119.1">
     client side, respectively.
    </span>
    <span class="koboSpan" id="kobo.119.2">
     It looks nothing different from the standard Blazor template scaffold, so let’s dive into each project to understand how it
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.120.1">
      supports identity.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.121.1">
     Here’s what the scaffolded projects’ structures
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.122.1">
      look like:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer037">
     <span class="koboSpan" id="kobo.123.1">
      <img alt="Figure 8.6: Scaffolded server- and client-side projects, with enabled authentication" src="image/Figure_8.6_B22020.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.124.1">
     Figure 8.6: Scaffolded server- and client-side projects, with enabled authentication
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.125.1">
     Let’s first unpack the client-side project (on the right side in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.126.1">
       Figure 8
      </span>
     </em>
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.127.1">
      .6
     </span>
    </em>
    <span class="koboSpan" id="kobo.128.1">
     ), as it’s significantly smaller.
    </span>
    <span class="koboSpan" id="kobo.128.2">
     On the components’ side, we’re getting just one relevant to manage identity –
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.129.1">
      RedirectToLogin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.130.1">
     .
    </span>
    <span class="koboSpan" id="kobo.130.2">
     As the name implies,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.131.1">
      RedirectToLogin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.132.1">
     safely redirects a user to the login page, persisting the initial URL so that Blazor can return there.
    </span>
    <span class="koboSpan" id="kobo.132.2">
     We’re also getting a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.133.1">
      UserInfo
     </span>
    </strong>
    <span class="koboSpan" id="kobo.134.1">
     class – a model containing the user identity details we want to share between server- and client-side communication, and one we can easily extend.
    </span>
    <span class="koboSpan" id="kobo.134.2">
     The backbone of sharing the authentication state across render mode boundaries is the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.135.1">
      PersistentAuthenticationStateProvider
     </span>
    </strong>
    <span class="koboSpan" id="kobo.136.1">
     service, which we will explore in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.137.1">
      Supporting roles’ and policies’ authorization
     </span>
    </em>
    <span class="koboSpan" id="kobo.138.1">
     recipe.
    </span>
    <span class="koboSpan" id="kobo.138.2">
     Lastly, we’re getting a minimal setup in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.139.1">
      Program.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.140.1">
     file.
    </span>
    <span class="koboSpan" id="kobo.140.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.141.1">
      PersistentAuthenticationStateProvider
     </span>
    </strong>
    <span class="koboSpan" id="kobo.142.1">
     service is registered as a singleton in the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.143.1">
      dependency injection container
     </span>
    </strong>
    <span class="koboSpan" id="kobo.144.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.145.1">
      DI
     </span>
    </strong>
    <span class="koboSpan" id="kobo.146.1">
     ), and with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.147.1">
      AddAuthorizationCore()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.148.1">
     extension method, all services required to enable authorization in our app are registered for us.
    </span>
    <span class="koboSpan" id="kobo.148.2">
     We also get an invocation of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.149.1">
      AddCascadingAuthenticationState()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.150.1">
     extension method to add an authentication state as a root-level cascading value and make it interceptable in the entire
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.151.1">
      WebAssembly application.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.152.1">
     The server-side project (on the left side in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.153.1">
       Figure 8
      </span>
     </em>
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.154.1">
      .6
     </span>
    </em>
    <span class="koboSpan" id="kobo.155.1">
     ) contains the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.156.1">
      Data
     </span>
    </strong>
    <span class="koboSpan" id="kobo.157.1">
     directory, with an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.158.1">
      ApplicationDbContext
     </span>
    </strong>
    <span class="koboSpan" id="kobo.159.1">
     class, an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.160.1">
      ApplicationUser
     </span>
    </strong>
    <span class="koboSpan" id="kobo.161.1">
     class, and a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.162.1">
      Migrations
     </span>
    </strong>
    <span class="koboSpan" id="kobo.163.1">
     subdirectory, indicating that the server-side project is responsible for persisting and managing users
    </span>
    <a id="_idIndexMarker396">
    </a>
    <span class="koboSpan" id="kobo.164.1">
     and their identities.
    </span>
    <span class="koboSpan" id="kobo.164.2">
     That means you must provide a valid connection string to the database where you want to store identity data.
    </span>
    <span class="koboSpan" id="kobo.164.3">
     You’ll find a placeholder
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.165.1">
      DefaultConnection
     </span>
    </strong>
    <span class="koboSpan" id="kobo.166.1">
     node generated in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.167.1">
      appSettings.json
     </span>
    </strong>
    <span class="koboSpan" id="kobo.168.1">
     file, which you must replace with the connection details of your database resource.
    </span>
    <span class="koboSpan" id="kobo.168.2">
     Next to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.169.1">
      Data
     </span>
    </strong>
    <span class="koboSpan" id="kobo.170.1">
     directory, we get a chunk of generated components, including an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.171.1">
      Account
     </span>
    </strong>
    <span class="koboSpan" id="kobo.172.1">
     area, with pages and UI, handling all actions required to manage identity in our application.
    </span>
    <span class="koboSpan" id="kobo.172.2">
     There are components for logging in, logging out, managing accounts, and even enabling
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.173.1">
      two-factor authentication
     </span>
    </strong>
    <span class="koboSpan" id="kobo.174.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.175.1">
      2FA
     </span>
    </strong>
    <span class="koboSpan" id="kobo.176.1">
     ), and they’re all Razor-native components.
    </span>
    <span class="koboSpan" id="kobo.176.2">
     You’ll notice that regardless of the interactivity declared when configuring, all the identity components are rendered in
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.177.1">
      server-side rendering
     </span>
    </strong>
    <span class="koboSpan" id="kobo.178.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.179.1">
      SSR
     </span>
    </strong>
    <span class="koboSpan" id="kobo.180.1">
     ) mode by default.
    </span>
    <span class="koboSpan" id="kobo.180.2">
     As is currently an industry standard for applications with a server-side to leverage cookies for identity management, we’re also getting a custom
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.181.1">
      IdentityRedirectManager
     </span>
    </strong>
    <span class="koboSpan" id="kobo.182.1">
     wrapper, which leverages the default Blazor
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.183.1">
      NavigationManager
     </span>
    </strong>
    <span class="koboSpan" id="kobo.184.1">
     class, extending it with identity status cookies and a few redirection resolvers.
    </span>
    <span class="koboSpan" id="kobo.184.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.185.1">
      IdentityRedirectManager
     </span>
    </strong>
    <span class="koboSpan" id="kobo.186.1">
     class is also designed to throw an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.187.1">
      InvalidOperationException
     </span>
    </strong>
    <span class="koboSpan" id="kobo.188.1">
     exception when used outside of the static SSR.
    </span>
    <span class="koboSpan" id="kobo.188.2">
     In SSR, contrary to other rendering modes, we can access an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.189.1">
      HttpContext
     </span>
    </strong>
    <span class="koboSpan" id="kobo.190.1">
     instance of each request.
    </span>
    <span class="koboSpan" id="kobo.190.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.191.1">
      IdentityUserAccessor
     </span>
    </strong>
    <span class="koboSpan" id="kobo.192.1">
     class is another wrapper class, allowing us to resolve the current user identity from the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.193.1">
      HttpContext
     </span>
    </strong>
    <span class="koboSpan" id="kobo.194.1">
     instance.
    </span>
    <span class="koboSpan" id="kobo.194.2">
     In the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.195.1">
      IdentityComponentsEndpointRouteBuilderExtensions
     </span>
    </strong>
    <span class="koboSpan" id="kobo.196.1">
     class, we get a mapping for three additional identity endpoints for logging in with an external
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.197.1">
      identity provider
     </span>
    </strong>
    <span class="koboSpan" id="kobo.198.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.199.1">
      IdP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.200.1">
     ), downloading personal user data, and logging out.
    </span>
    <span class="koboSpan" id="kobo.200.2">
     These are missing in the default identity API implementation, as they’re native for applications with a UI.
    </span>
    <span class="koboSpan" id="kobo.200.3">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.201.1">
      IdentityNoOpEmailSender
     </span>
    </strong>
    <span class="koboSpan" id="kobo.202.1">
     class is a placeholder service for sending identity-related emails: confirming user email or resetting passwords.
    </span>
    <span class="koboSpan" id="kobo.202.2">
     You have to implement your own
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.203.1">
      IEmailSender
     </span>
    </strong>
    <span class="koboSpan" id="kobo.204.1">
     client before going live.
    </span>
    <span class="koboSpan" id="kobo.204.2">
     We also get a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.205.1">
      PersistingRevalidatingAuthenticationStateProvider
     </span>
    </strong>
    <span class="koboSpan" id="kobo.206.1">
     class that Blazor uses to share the authentication state across render boundaries between server and client code – we will explore that in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.207.1">
      Supporting roles’ and policies’ authorization
     </span>
    </em>
    <span class="koboSpan" id="kobo.208.1">
     recipe too.
    </span>
    <span class="koboSpan" id="kobo.208.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.209.1">
      Program.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.210.1">
     file gets a bit more complex.
    </span>
    <span class="koboSpan" id="kobo.210.2">
     We will find here the default setup of interactive
    </span>
    <a id="_idIndexMarker397">
    </a>
    <span class="koboSpan" id="kobo.211.1">
     server and WebAssembly components and a default middleware pipeline.
    </span>
    <span class="koboSpan" id="kobo.211.2">
     However, on top of that, we’re setting up the server-side identity features.
    </span>
    <span class="koboSpan" id="kobo.211.3">
     We register the custom identity services (discussed earlier in this section) and invoke the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.212.1">
      AddCascadingAuthenticationState()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.213.1">
     extension method to enable the cascading of the authentication state at a root level.
    </span>
    <span class="koboSpan" id="kobo.213.2">
     We configure the authentication leveraging the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.214.1">
      AddAuthentication()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.215.1">
     extension method.
    </span>
    <span class="koboSpan" id="kobo.215.2">
     Here’s also where we inform Blazor to use cookies for identity persistence with the help of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.216.1">
      AddIdentityCookies()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.217.1">
     extension method.
    </span>
    <span class="koboSpan" id="kobo.217.2">
     In
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.218.1">
      Program.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.219.1">
     , we also configure the database access for our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.220.1">
      ApplicationDbContext
     </span>
    </strong>
    <span class="koboSpan" id="kobo.221.1">
     class.
    </span>
    <span class="koboSpan" id="kobo.221.2">
     Lastly, and most importantly, we leverage the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.222.1">
      AddIdentityCore()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.223.1">
     method and the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.224.1">
      IdentityBuilder
     </span>
    </strong>
    <span class="koboSpan" id="kobo.225.1">
     API to configure the required
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.226.1">
      identity services.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.227.1">
     Now that you understand the structure of each of the projects, let’s visualize how the authentication
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.228.1">
      workflow works:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer038">
     <span class="koboSpan" id="kobo.229.1">
      <img alt="Figure 8.7: Authentication workflow between server and client sides of the Blazor web app" src="image/Figure_8.7_B22020.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.230.1">
     Figure 8.7: Authentication workflow between server and client sides of the Blazor web app
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.231.1">
     When a user tries to access the application, their identity is checked.
    </span>
    <span class="koboSpan" id="kobo.231.2">
     The authentication state provider service validates the available authentication cookie or lack thereof.
    </span>
    <span class="koboSpan" id="kobo.231.3">
     If validation is successful, the user gets redirected to the page they intended to visit; otherwise, the user lands on the login page.
    </span>
    <span class="koboSpan" id="kobo.231.4">
     After submitting the login form and receiving a successful
    </span>
    <a id="_idIndexMarker398">
    </a>
    <span class="koboSpan" id="kobo.232.1">
     authentication response from the IdP, Blazor persists the user’s identity in the authentication cookie.
    </span>
    <span class="koboSpan" id="kobo.232.2">
     That cookie gets attached to every request between the server and client side, allowing
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.233.1">
      PersistingRevalidatingAuthenticationStateProvider
     </span>
    </strong>
    <span class="koboSpan" id="kobo.234.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.235.1">
      PersistentAuthenticationStateProvider
     </span>
    </strong>
    <span class="koboSpan" id="kobo.236.1">
     to effectively monitor and recognize the current user and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.237.1">
      their permissions.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.238.1">
     When you run the application for the first time and try to create an account, your application will fail.
    </span>
    <span class="koboSpan" id="kobo.238.2">
     But in a developer-friendly way, you will see an exception page, informing you that you didn’t run the initial migration yet, so your backing database can’t support
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.239.1">
      identity features:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer039">
     <span class="koboSpan" id="kobo.240.1">
      <img alt="Figure 8.8: Exception page when you try to create an account without the initial migration" src="image/Figure_8.8_B22020.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.241.1">
     Figure 8.8: Exception page when you try to create an account without the initial migration
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.242.1">
     You will also get a simple
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.243.1">
      Apply Migrations
     </span>
    </strong>
    <span class="koboSpan" id="kobo.244.1">
     button allowing you to apply the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.245.1">
      migrations immediately!
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.246.1">
     All that code and functionality are ready to use, and you haven’t written a single line of your own code yet.
    </span>
    <span class="koboSpan" id="kobo.246.2">
     Leveraging
    </span>
    <a id="_idIndexMarker399">
    </a>
    <span class="koboSpan" id="kobo.247.1">
     solution templates and scaffolding increases the velocity of the delivery of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.248.1">
      your application.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-280">
    <a id="_idTextAnchor280">
    </a>
    <span class="koboSpan" id="kobo.249.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.250.1">
     In case you’re not using a GUI or Visual Studio, you can leverage the cross-platform .NET CLI and scaffold the same template with a single command line.
    </span>
    <span class="koboSpan" id="kobo.250.2">
     Navigate to your working directory and run the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.251.1">
      following command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.252.1">
dotnet new blazor -o BlazorCookbook.Auth -int Auto --framework net9.0 -au Individual</span></pre>
   <p>
    <span class="koboSpan" id="kobo.253.1">
     You will get the same format of a project that we did through the Visual Studio walk-through, with one difference.
    </span>
    <span class="koboSpan" id="kobo.253.2">
     The project scaffolded with the .NET CLI utilizes the SQLite database rather than SQL Server.
    </span>
    <span class="koboSpan" id="kobo.253.3">
     You can quickly adjust that by navigating to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.254.1">
      Program.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.255.1">
     file of the server-side project and updating the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.256.1">
      ApplicationDbContext
     </span>
    </strong>
    <span class="koboSpan" id="kobo.257.1">
     registration options to use
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.258.1">
      SQL Server:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.259.1">
builder.Services.AddDbContext&lt;ApplicationDbContext&gt;(
    options =&gt; options.UseSqlServer(connectionString));</span></pre>
   <h1 id="_idParaDest-281">
    <a id="_idTextAnchor281">
    </a>
    <span class="koboSpan" id="kobo.260.1">
     Securing pages
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.261.1">
     Protecting unauthorized routing is crucial as malicious actors can attempt to scrape your application, bypassing the navigation paths enforced by your UI.
    </span>
    <span class="koboSpan" id="kobo.261.2">
     Ensuring that only authorized users can access specific routes helps safeguard sensitive data and functionality.
    </span>
    <span class="koboSpan" id="kobo.261.3">
     Blazor
    </span>
    <a id="_idIndexMarker400">
    </a>
    <span class="koboSpan" id="kobo.262.1">
     comes with a built-in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.263.1">
      Authorize
     </span>
    </strong>
    <span class="koboSpan" id="kobo.264.1">
     attribute to check access permissions when a user navigates to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.265.1">
      a page.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.266.1">
     Let’s add a routable component that only an authenticated user can navigate to by applying the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.267.1">
      Authorize
     </span>
    </strong>
    <span class="koboSpan" id="kobo.268.1">
     attribute in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.269.1">
      right place.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-282">
    <a id="_idTextAnchor282">
    </a>
    <span class="koboSpan" id="kobo.270.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.271.1">
     Before we add a secure component to the server-side project, create a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.272.1">
      Components
     </span>
    </strong>
    <span class="koboSpan" id="kobo.273.1">
     /
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.274.1">
      Recipes
     </span>
    </strong>
    <span class="koboSpan" id="kobo.275.1">
     /
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.276.1">
      Recipe02
     </span>
    </strong>
    <span class="koboSpan" id="kobo.277.1">
     directory – this will be your
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.278.1">
      working directory.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-283">
    <a id="_idTextAnchor283">
    </a>
    <span class="koboSpan" id="kobo.279.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.280.1">
     Follow these instructions to protect
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.281.1">
      a component:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.282.1">
      Create a routable
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.283.1">
       Settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.284.1">
      component with a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.285.1">
       /
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.286.1">
        ch08r02
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.287.1">
       path:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.288.1">
@page "/ch08r02"</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.289.1">
      Reference the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.290.1">
       Microsoft.AspNetCore.Authorization
      </span>
     </strong>
     <span class="koboSpan" id="kobo.291.1">
      assembly and attach an
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.292.1">
       Authorize
      </span>
     </strong>
     <span class="koboSpan" id="kobo.293.1">
      attribute to the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.294.1">
        Settings
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.295.1">
       component:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.296.1">
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize]</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.297.1">
      Add placeholder markup to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.298.1">
       Settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.299.1">
      component, informing the user that they are authorized to see
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.300.1">
       this content:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.301.1">
&lt;h3&gt;Settings&lt;/h3&gt;
&lt;p&gt;You're authorized to see settings.&lt;/p&gt;</span></pre>
    </li>
   </ol>
   <h2 id="_idParaDest-284">
    <a id="_idTextAnchor284">
    </a>
    <span class="koboSpan" id="kobo.302.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.303.1">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.304.1">
      step 1
     </span>
    </em>
    <span class="koboSpan" id="kobo.305.1">
     , we execute a routine step and create a new routable
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.306.1">
      Settings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.307.1">
     component, leveraging
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.308.1">
      @page
     </span>
    </strong>
    <span class="koboSpan" id="kobo.309.1">
     .
    </span>
    <span class="koboSpan" id="kobo.309.2">
     Next, in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.310.1">
      step 2
     </span>
    </em>
    <span class="koboSpan" id="kobo.311.1">
     , we reference the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.312.1">
      Microsoft.AspNetCore.Authorization
     </span>
    </strong>
    <span class="koboSpan" id="kobo.313.1">
     assembly with the help of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.314.1">
      @using
     </span>
    </strong>
    <span class="koboSpan" id="kobo.315.1">
     directive right below the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.316.1">
      @page
     </span>
    </strong>
    <span class="koboSpan" id="kobo.317.1">
     declaration.
    </span>
    <span class="koboSpan" id="kobo.317.2">
     Then, we use
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.318.1">
      @attribute
     </span>
    </strong>
    <span class="koboSpan" id="kobo.319.1">
     to attach the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.320.1">
      Authorize
     </span>
    </strong>
    <span class="koboSpan" id="kobo.321.1">
     attribute.
    </span>
    <span class="koboSpan" id="kobo.321.2">
     Now, only authenticated users can access the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.322.1">
      Settings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.323.1">
     page.
    </span>
    <span class="koboSpan" id="kobo.323.2">
     However, it’s important to note that Blazor performs a verification of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.324.1">
      Authorize
     </span>
    </strong>
    <span class="koboSpan" id="kobo.325.1">
     attribute only as part of the routing process and does not apply it to child components’ rendering flow.
    </span>
    <span class="koboSpan" id="kobo.325.2">
     Lastly, in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.326.1">
      step 3
     </span>
    </em>
    <span class="koboSpan" id="kobo.327.1">
     , we add some placeholder content to inform users that they
    </span>
    <a id="_idIndexMarker401">
    </a>
    <span class="koboSpan" id="kobo.328.1">
     are authorized to view this page.
    </span>
    <span class="koboSpan" id="kobo.328.2">
     In the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.329.1">
      Settings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.330.1">
     markup, we render the page header and a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.331.1">
      You’re authorized to see
     </span>
    </strong>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.332.1">
       settings.
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.333.1">
      message.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-285">
    <a id="_idTextAnchor285">
    </a>
    <span class="koboSpan" id="kobo.334.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.335.1">
     If you’re building a markup-less component or simply working in a code-behind fashion, you can still leverage the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.336.1">
      Authorize
     </span>
    </strong>
    <span class="koboSpan" id="kobo.337.1">
     attribute.
    </span>
    <span class="koboSpan" id="kobo.337.2">
     Here’s how we would implement a markup-less
    </span>
    <a id="_idIndexMarker402">
    </a>
    <span class="koboSpan" id="kobo.338.1">
     version of the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.339.1">
       Settings
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.340.1">
      component:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.341.1">
[Route("/ch08r02")]
[Authorize]
public class Settings : ComponentBase
{
    // ...
</span><span class="koboSpan" id="kobo.341.2">}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.342.1">
     As we’re no longer in a Razor file, we’re using the syntax of C# attributes.
    </span>
    <span class="koboSpan" id="kobo.342.2">
     By decorating the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.343.1">
      Settings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.344.1">
     class with a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.345.1">
      [Route]
     </span>
    </strong>
    <span class="koboSpan" id="kobo.346.1">
     attribute, we enable navigation to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.347.1">
      /ch08r02
     </span>
    </strong>
    <span class="koboSpan" id="kobo.348.1">
     path.
    </span>
    <span class="koboSpan" id="kobo.348.2">
     Additionally, by adding the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.349.1">
      [Authorize]
     </span>
    </strong>
    <span class="koboSpan" id="kobo.350.1">
     attribute, we ensure that Blazor only allows routing to this component for authenticated users.
    </span>
    <span class="koboSpan" id="kobo.350.2">
     We effectively achieve the same logical behavior as in the initial implementation.
    </span>
    <span class="koboSpan" id="kobo.350.3">
     As a side note, when you’re working in Razor files, the Razor compiler translates all the dedicated
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.351.1">
      @directive
     </span>
    </strong>
    <span class="koboSpan" id="kobo.352.1">
     declarations to attributes – similar to what we did with the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.353.1">
      markup-less component.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-286">
    <a id="_idTextAnchor286">
    </a>
    <span class="koboSpan" id="kobo.354.1">
     Securing markup areas
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.355.1">
     Sometimes, restricting access to an entire page can be too limiting.
    </span>
    <span class="koboSpan" id="kobo.355.2">
     You might want to expose your landing page to everyone while fine-tuning the elements users see in the navigation menu.
    </span>
    <span class="koboSpan" id="kobo.355.3">
     For example, authenticated
    </span>
    <a id="_idIndexMarker403">
    </a>
    <span class="koboSpan" id="kobo.356.1">
     users might have access to a back office feature that standard users cannot see despite viewing the same page.
    </span>
    <span class="koboSpan" id="kobo.356.2">
     Blazor supports protecting specific markup areas with an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.357.1">
      AuthorizeView
     </span>
    </strong>
    <span class="koboSpan" id="kobo.358.1">
     component.
    </span>
    <span class="koboSpan" id="kobo.358.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.359.1">
      AuthorizeView
     </span>
    </strong>
    <span class="koboSpan" id="kobo.360.1">
     component allows you to control the visibility of content based on the user’s authentication state.
    </span>
    <span class="koboSpan" id="kobo.360.2">
     It supports various states and works seamlessly with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.361.1">
      RenderFragment
     </span>
    </strong>
    <span class="koboSpan" id="kobo.362.1">
     objects, making it highly flexible
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.363.1">
      and versatile.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.364.1">
     Let’s leverage the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.365.1">
      AuthorizeView
     </span>
    </strong>
    <span class="koboSpan" id="kobo.366.1">
     component and add a status message visible only to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.367.1">
      authenticated users.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-287">
    <a id="_idTextAnchor287">
    </a>
    <span class="koboSpan" id="kobo.368.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.369.1">
     Before we add a protected status message to a component, do
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.370.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.371.1">
      In the server-side project, create a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.372.1">
       Components
      </span>
     </strong>
     <span class="koboSpan" id="kobo.373.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.374.1">
       Recipes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.375.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.376.1">
       Recipe03
      </span>
     </strong>
     <span class="koboSpan" id="kobo.377.1">
      directory – this will be your
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.378.1">
       working directory
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.379.1">
      Copy the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.380.1">
       Settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.381.1">
      component from the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.382.1">
       Securing pages
      </span>
     </em>
     <span class="koboSpan" id="kobo.383.1">
      recipe or from the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.384.1">
       Components
      </span>
     </strong>
     <span class="koboSpan" id="kobo.385.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.386.1">
       Recipes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.387.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.388.1">
       Recipe02
      </span>
     </strong>
     <span class="koboSpan" id="kobo.389.1">
      directory in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.390.1">
       GitHub repository
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-288">
    <a id="_idTextAnchor288">
    </a>
    <span class="koboSpan" id="kobo.391.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.392.1">
     Follow these steps to add a protected markup area in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.393.1">
      a component:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.394.1">
      Navigate to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.395.1">
       Settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.396.1">
      component and remove the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.397.1">
       Authorize
      </span>
     </strong>
     <span class="koboSpan" id="kobo.398.1">
      attribute and the existing
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.399.1">
       @
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.400.1">
        using
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.401.1">
       directive.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.402.1">
      Locate the authorization status message in the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.403.1">
       Settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.404.1">
      markup and wrap it in
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.405.1">
       AuthorizeView
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.406.1">
       component tags:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.407.1">
&lt;h3&gt;Settings&lt;/h3&gt;
&lt;AuthorizeView&gt;
    &lt;p&gt;You're authorized to see settings.&lt;/p&gt;
&lt;/AuthorizeView&gt;</span></pre>
    </li>
   </ol>
   <h2 id="_idParaDest-289">
    <a id="_idTextAnchor289">
    </a>
    <span class="koboSpan" id="kobo.408.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.409.1">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.410.1">
      step 1
     </span>
    </em>
    <span class="koboSpan" id="kobo.411.1">
     , we remove the existing
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.412.1">
      Authorize
     </span>
    </strong>
    <span class="koboSpan" id="kobo.413.1">
     attribute and the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.414.1">
      @using
     </span>
    </strong>
    <span class="koboSpan" id="kobo.415.1">
     directive, required to reference the attribute, from the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.416.1">
      Settings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.417.1">
     component, allowing all users to access
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.418.1">
      the page.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.419.1">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.420.1">
      step 2
     </span>
    </em>
    <span class="koboSpan" id="kobo.421.1">
     , we locate the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.422.1">
      You’re authorized to see settings.
     </span>
    </strong>
    <span class="koboSpan" id="kobo.423.1">
     authorization status message in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.424.1">
      Settings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.425.1">
     markup.
    </span>
    <span class="koboSpan" id="kobo.425.2">
     We then wrap this message inside
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.426.1">
      AuthorizeView
     </span>
    </strong>
    <span class="koboSpan" id="kobo.427.1">
     component tags.
    </span>
    <span class="koboSpan" id="kobo.427.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.428.1">
      AuthorizeView
     </span>
    </strong>
    <span class="koboSpan" id="kobo.429.1">
     component manages content visibility based on
    </span>
    <a id="_idIndexMarker404">
    </a>
    <span class="koboSpan" id="kobo.430.1">
     the user authentication state and accepts
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.431.1">
      ChildContent
     </span>
    </strong>
    <span class="koboSpan" id="kobo.432.1">
     , meaning Blazor will render the status message only for authenticated users.
    </span>
    <span class="koboSpan" id="kobo.432.2">
     This approach ensures that only users with the proper credentials see certain content, enhancing the security and user experience of your application.
    </span>
    <span class="koboSpan" id="kobo.432.3">
     You can find more details on the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.433.1">
      ChildContent
     </span>
    </strong>
    <span class="koboSpan" id="kobo.434.1">
     pattern in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.435.1">
      Creating components with customizable content
     </span>
    </em>
    <span class="koboSpan" id="kobo.436.1">
     recipe of
    </span>
    <a href="B22020_01.xhtml#_idTextAnchor020">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.437.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.438.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.439.1">
     Blazor will effectively obscure everything inside the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.440.1">
      AuthorizeView
     </span>
    </strong>
    <span class="koboSpan" id="kobo.441.1">
     component from unauthorized users.
    </span>
    <span class="koboSpan" id="kobo.441.2">
     That means markup, as well as any event handlers or method calls.
    </span>
    <span class="koboSpan" id="kobo.441.3">
     Consequently, you can secure your UI and entire features and functionalities, preventing unauthorized users from even knowing
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.442.1">
      they exist.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-290">
    <a id="_idTextAnchor290">
    </a>
    <span class="koboSpan" id="kobo.443.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.444.1">
     Apart from
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.445.1">
      ChildContent
     </span>
    </strong>
    <span class="koboSpan" id="kobo.446.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.447.1">
      AuthorizeView
     </span>
    </strong>
    <span class="koboSpan" id="kobo.448.1">
     supports providing the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.449.1">
      Authorized
     </span>
    </strong>
    <span class="koboSpan" id="kobo.450.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.451.1">
      Authorizing
     </span>
    </strong>
    <span class="koboSpan" id="kobo.452.1">
     , and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.453.1">
      NotAuthorized
     </span>
    </strong>
    <span class="koboSpan" id="kobo.454.1">
     fragments explicitly.
    </span>
    <span class="koboSpan" id="kobo.454.2">
     With that, you can define distinct content for authenticated and unauthenticated users within the same component.
    </span>
    <span class="koboSpan" id="kobo.454.3">
     You would leverage the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.455.1">
      Authorizing
     </span>
    </strong>
    <span class="koboSpan" id="kobo.456.1">
     fragment to display a temporary message indicating that resolving of user’s identity is in progress, as you might need to execute some asynchronous and long-running logic.
    </span>
    <span class="koboSpan" id="kobo.456.2">
     In our case, we could opt for the following markup in the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.457.1">
       Settings
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.458.1">
      component:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.459.1">
&lt;h3&gt;Settings&lt;/h3&gt;
&lt;AuthorizeView&gt;
    &lt;Authorized&gt;
        &lt;p&gt;You're authorized to see settings.&lt;/p&gt;
    &lt;/Authorized&gt;
    &lt;Authorizing&gt;
        &lt;p&gt;Give us a few moments...&lt;/p&gt;
    &lt;/Authorizing&gt;
    &lt;NotAuthorized&gt;
        &lt;p&gt;You can't be here, sorry.&lt;/p&gt;
    &lt;/NotAuthorized&gt;
&lt;/AuthorizeView&gt;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.460.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.461.1">
      AuthorizeView
     </span>
    </strong>
    <span class="koboSpan" id="kobo.462.1">
     component will evaluate the user’s authentication state normally, but this time give the user a feeling of each stage of the process.
    </span>
    <span class="koboSpan" id="kobo.462.2">
     When authenticating the user, Blazor will render the content in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.463.1">
      Authorizing
     </span>
    </strong>
    <span class="koboSpan" id="kobo.464.1">
     tags – a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.465.1">
      Give us a few moments…
     </span>
    </strong>
    <span class="koboSpan" id="kobo.466.1">
     message.
    </span>
    <span class="koboSpan" id="kobo.466.2">
     When
    </span>
    <a id="_idIndexMarker405">
    </a>
    <span class="koboSpan" id="kobo.467.1">
     authentication is complete, for the authenticated user, Blazor will render the markup in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.468.1">
      Authorized
     </span>
    </strong>
    <span class="koboSpan" id="kobo.469.1">
     section and display the expected
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.470.1">
      You’re authorized to see settings.
     </span>
    </strong>
    <span class="koboSpan" id="kobo.471.1">
     message.
    </span>
    <span class="koboSpan" id="kobo.471.2">
     However, contrary to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.472.1">
      Authorized
     </span>
    </strong>
    <span class="koboSpan" id="kobo.473.1">
     attribute, an anonymous user will also see some content – one within
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.474.1">
      NotAuthorized
     </span>
    </strong>
    <span class="koboSpan" id="kobo.475.1">
     tags, saying
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.476.1">
      You can’t be here, sorry.
     </span>
    </strong>
    <span class="koboSpan" id="kobo.477.1">
     , offering meaningful feedback to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.478.1">
      unauthenticated users.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-291">
    <a id="_idTextAnchor291">
    </a>
    <span class="koboSpan" id="kobo.479.1">
     Creating roles
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.480.1">
     Roles in web applications are predefined categories assigned to users that determine their access permissions and functionalities within the application.
    </span>
    <span class="koboSpan" id="kobo.480.2">
     By categorizing users into roles, you can manage
    </span>
    <a id="_idIndexMarker406">
    </a>
    <span class="koboSpan" id="kobo.481.1">
     and control what each user can view and do, enhancing security and user experience.
    </span>
    <span class="koboSpan" id="kobo.481.2">
     Roles provide a clear and structured way to enforce access control.
    </span>
    <span class="koboSpan" id="kobo.481.3">
     Instead of managing permissions for each user, you can assign roles and define access rules based on these roles.
    </span>
    <span class="koboSpan" id="kobo.481.4">
     This approach simplifies the administration of user permissions and ensures consistent security policies across
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.482.1">
      the application.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.483.1">
     Let’s add a small form where authenticated users can create new roles in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.484.1">
      the application.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-292">
    <a id="_idTextAnchor292">
    </a>
    <span class="koboSpan" id="kobo.485.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.486.1">
     Before we implement the role creation form, do
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.487.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.488.1">
      In the server-side
     </span>
     <a id="_idIndexMarker407">
     </a>
     <span class="koboSpan" id="kobo.489.1">
      project, create a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.490.1">
       Components
      </span>
     </strong>
     <span class="koboSpan" id="kobo.491.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.492.1">
       Recipes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.493.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.494.1">
       Recipe04
      </span>
     </strong>
     <span class="koboSpan" id="kobo.495.1">
      directory – this will be your
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.496.1">
       working directory
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.497.1">
      Copy the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.498.1">
       Settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.499.1">
      component from the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.500.1">
       Securing markup areas
      </span>
     </em>
     <span class="koboSpan" id="kobo.501.1">
      recipe or from the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.502.1">
       Components
      </span>
     </strong>
     <span class="koboSpan" id="kobo.503.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.504.1">
       Recipes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.505.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.506.1">
       Recipe03
      </span>
     </strong>
     <span class="koboSpan" id="kobo.507.1">
      directory in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.508.1">
       GitHub repository
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.509.1">
      If you haven’t scaffolded your project, copy the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.510.1">
       StatusMessage
      </span>
     </strong>
     <span class="koboSpan" id="kobo.511.1">
      component from the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.512.1">
       Components
      </span>
     </strong>
     <span class="koboSpan" id="kobo.513.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.514.1">
       Account
      </span>
     </strong>
     <span class="koboSpan" id="kobo.515.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.516.1">
       Shared
      </span>
     </strong>
     <span class="koboSpan" id="kobo.517.1">
      directory of the GitHub repository to the same path in your
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.518.1">
       server-side project
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-293">
    <a id="_idTextAnchor293">
    </a>
    <span class="koboSpan" id="kobo.519.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.520.1">
     Follow these instructions to set up roles’ support
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.521.1">
      and management:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.522.1">
      Navigate to the server-side project’s
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.523.1">
       Program.cs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.524.1">
      file.
     </span>
     <span class="koboSpan" id="kobo.524.2">
      Find the section where we register identity services, starting with the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.525.1">
        AddIdentityCore()
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.526.1">
       method.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.527.1">
      After the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.528.1">
       AddIdentityCore()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.529.1">
      method, invoke the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.530.1">
       AddRoles()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.531.1">
      method and leverage the default
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.532.1">
       IdentityRole
      </span>
     </strong>
     <span class="koboSpan" id="kobo.533.1">
      model to declare the application role model.
     </span>
     <span class="koboSpan" id="kobo.533.2">
      Below the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.534.1">
       AddEntityFrameworkStores()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.535.1">
      method, register a role manager with the help of an
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.536.1">
       AddRoleManager()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.537.1">
      builder method with the default
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.538.1">
       RoleManager
      </span>
     </strong>
     <span class="koboSpan" id="kobo.539.1">
      service for the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.540.1">
        IdentityRole
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.541.1">
       model:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.542.1">
builder.Services.AddIdentityCore&lt;ApplicationUser&gt;()
    .AddRoles&lt;IdentityRole&gt;()
    .AddEntityFrameworkStores&lt;ApplicationDbContext&gt;()
    .AddRoleManager&lt;RoleManager&lt;IdentityRole&gt;&gt;()
    .AddSignInManager()
    .AddDefaultTokenProviders();</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.543.1">
      Open the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.544.1">
       Settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.545.1">
      component, and below the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.546.1">
       @page
      </span>
     </strong>
     <span class="koboSpan" id="kobo.547.1">
      directive, add a set of
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.548.1">
       @using
      </span>
     </strong>
     <span class="koboSpan" id="kobo.549.1">
      directives referencing the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.550.1">
       necessary assemblies:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.551.1">
@using BlazorCookbook.Auth.Components.Account
@using BlazorCookbook.Auth.Components.Account.Shared
@using Microsoft.AspNetCore.Identity</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.552.1">
      Below the section
     </span>
     <a id="_idIndexMarker408">
     </a>
     <span class="koboSpan" id="kobo.553.1">
      with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.554.1">
       @using
      </span>
     </strong>
     <span class="koboSpan" id="kobo.555.1">
      , inject
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.556.1">
       RoleManager
      </span>
     </strong>
     <span class="koboSpan" id="kobo.557.1">
      and
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.558.1">
        Navigation
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.559.1">
       services:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.560.1">
@inject RoleManager&lt;IdentityRole&gt; RoleManager
@inject IdentityRedirectManager Navigation</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.561.1">
      In the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.562.1">
       Settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.563.1">
      component, initialize the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.564.1">
       @code
      </span>
     </strong>
     <span class="koboSpan" id="kobo.565.1">
      block and construct an
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.566.1">
       InputModel
      </span>
     </strong>
     <span class="koboSpan" id="kobo.567.1">
      class with a single
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.568.1">
        RoleName
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.569.1">
       property:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.570.1">
@code {
    private sealed class InputModel
    {
        public string RoleName { get; set; }
    }
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.571.1">
      Below the service injections, intercept a cascading value
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.572.1">
       of
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.573.1">
        HttpContext
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.574.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.575.1">
[CascadingParameter]
private HttpContext HttpContext { get; set; }</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.576.1">
      Below
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.577.1">
       HttpContext
      </span>
     </strong>
     <span class="koboSpan" id="kobo.578.1">
      , declare an
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.579.1">
       Input
      </span>
     </strong>
     <span class="koboSpan" id="kobo.580.1">
      parameter supplied from a form and override the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.581.1">
       OnInitialized()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.582.1">
      lifecycle method to complete the form
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.583.1">
       initialization pattern:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.584.1">
[SupplyParameterFromForm]
private InputModel Input { get; set; } = new();
protected override void OnInitialized()
    =&gt; Input ??= new();</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.585.1">
      Complete the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.586.1">
       @code
      </span>
     </strong>
     <span class="koboSpan" id="kobo.587.1">
      block with the implementation of a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.588.1">
       SaveAsync()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.589.1">
      method, where you initialize a new
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.590.1">
       IdentityRole
      </span>
     </strong>
     <span class="koboSpan" id="kobo.591.1">
      object and leverage the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.592.1">
       RoleManager
      </span>
     </strong>
     <span class="koboSpan" id="kobo.593.1">
      service to
     </span>
     <a id="_idIndexMarker409">
     </a>
     <span class="koboSpan" id="kobo.594.1">
      save the new role.
     </span>
     <span class="koboSpan" id="kobo.594.2">
      Use the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.595.1">
       Navigation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.596.1">
      service to perform a self-redirect and display the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.597.1">
       operation status:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.598.1">
private async Task SaveAsync()
{
    var role = new IdentityRole(Input.RoleName);
    await RoleManager.CreateAsync(role);
    Navigation.RedirectToCurrentPageWithStatus(
        $"'{role.Name}' role has been created",
        HttpContext);
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.599.1">
      In the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.600.1">
       Settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.601.1">
      component markup, locate the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.602.1">
       AuthorizeView
      </span>
     </strong>
     <span class="koboSpan" id="kobo.603.1">
      tags and declare a custom name for the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.604.1">
       Context
      </span>
     </strong>
     <span class="koboSpan" id="kobo.605.1">
      parameter.
     </span>
     <span class="koboSpan" id="kobo.605.2">
      Also, replace the authentication status message with a
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.606.1">
        StatusMessage
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.607.1">
       component:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.608.1">
&lt;AuthorizeView Context="auth"&gt;
    &lt;StatusMessage /&gt;
&lt;/AuthorizeView&gt;</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.609.1">
      Below
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.610.1">
       StatusMessage
      </span>
     </strong>
     <span class="koboSpan" id="kobo.611.1">
      , initialize an
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.612.1">
       EditForm
      </span>
     </strong>
     <span class="koboSpan" id="kobo.613.1">
      component, attaching the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.614.1">
       Input
      </span>
     </strong>
     <span class="koboSpan" id="kobo.615.1">
      model and the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.616.1">
       SaveAsync()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.617.1">
      method to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.618.1">
       Model
      </span>
     </strong>
     <span class="koboSpan" id="kobo.619.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.620.1">
       OnValidSubmit
      </span>
     </strong>
     <span class="koboSpan" id="kobo.621.1">
      parameters.
     </span>
     <span class="koboSpan" id="kobo.621.2">
      Remember to declare a unique
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.622.1">
       EditForm
      </span>
     </strong>
     <span class="koboSpan" id="kobo.623.1">
      name
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.624.1">
       as well:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.625.1">
&lt;EditForm FormName="creator"
          OnValidSubmit="@SaveAsync"
          Model="@Input"&gt;
&lt;/EditForm&gt;</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.626.1">
      Within the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.627.1">
       EditForm
      </span>
     </strong>
     <span class="koboSpan" id="kobo.628.1">
      component, add a paragraph with an editable input box binding to the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.629.1">
        Input.RoleName
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.630.1">
       property:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.631.1">
&lt;p&gt;Role name
  &lt;InputText @bind-Value="@Input.RoleName" /&gt;
&lt;/p&gt;</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.632.1">
      Complete the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.633.1">
       EditForm
      </span>
     </strong>
     <span class="koboSpan" id="kobo.634.1">
      component
     </span>
     <a id="_idIndexMarker410">
     </a>
     <span class="koboSpan" id="kobo.635.1">
      by adding a form submit button below the role
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.636.1">
       name input:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.637.1">
&lt;p&gt;&lt;button type="submit"&gt;Save&lt;/button&gt;&lt;/p&gt;</span></pre>
    </li>
   </ol>
   <h2 id="_idParaDest-294">
    <a id="_idTextAnchor294">
    </a>
    <span class="koboSpan" id="kobo.638.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.639.1">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.640.1">
      step 1
     </span>
    </em>
    <span class="koboSpan" id="kobo.641.1">
     , we navigate to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.642.1">
      Program.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.643.1">
     file of the server-side project and locate the section where we register identity services.
    </span>
    <span class="koboSpan" id="kobo.643.2">
     It’s a section starting with an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.644.1">
      AddIdentityCore()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.645.1">
     method and producing an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.646.1">
      IdentityBuilder
     </span>
    </strong>
    <span class="koboSpan" id="kobo.647.1">
     object.
    </span>
    <span class="koboSpan" id="kobo.647.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.648.1">
      step 2
     </span>
    </em>
    <span class="koboSpan" id="kobo.649.1">
     , we invoke the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.650.1">
      AddRoles()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.651.1">
     method to add role management capabilities to the identity system.
    </span>
    <span class="koboSpan" id="kobo.651.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.652.1">
      AddRoles()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.653.1">
     method is a generic method requiring an identity role model class.
    </span>
    <span class="koboSpan" id="kobo.653.2">
     We leverage the default
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.654.1">
      IdentityRole
     </span>
    </strong>
    <span class="koboSpan" id="kobo.655.1">
     model, provided with an identity package.
    </span>
    <span class="koboSpan" id="kobo.655.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.656.1">
      IdentityRole
     </span>
    </strong>
    <span class="koboSpan" id="kobo.657.1">
     model is enough for our needs.
    </span>
    <span class="koboSpan" id="kobo.657.2">
     Next, below the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.658.1">
      AddEntityFrameworkStores()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.659.1">
     method, we register the role manager using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.660.1">
      AddRoleManager()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.661.1">
     builder method with the default
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.662.1">
      RoleManager
     </span>
    </strong>
    <span class="koboSpan" id="kobo.663.1">
     service for the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.664.1">
      IdentityRole
     </span>
    </strong>
    <span class="koboSpan" id="kobo.665.1">
     model.
    </span>
    <span class="koboSpan" id="kobo.665.2">
     We’ve effectively enabled roles’ support and roles’ management in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.666.1">
      the app.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.667.1">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.668.1">
      step 3
     </span>
    </em>
    <span class="koboSpan" id="kobo.669.1">
     , we move to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.670.1">
      Settings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.671.1">
     component.
    </span>
    <span class="koboSpan" id="kobo.671.2">
     First, we add a set of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.672.1">
      @using
     </span>
    </strong>
    <span class="koboSpan" id="kobo.673.1">
     directives below
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.674.1">
      @page
     </span>
    </strong>
    <span class="koboSpan" id="kobo.675.1">
     to reference the necessary assemblies, allowing access to the scaffolded
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.676.1">
      Account
     </span>
    </strong>
    <span class="koboSpan" id="kobo.677.1">
     area and built-in identity services.
    </span>
    <span class="koboSpan" id="kobo.677.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.678.1">
      step 4
     </span>
    </em>
    <span class="koboSpan" id="kobo.679.1">
     , we inject the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.680.1">
      RoleManager
     </span>
    </strong>
    <span class="koboSpan" id="kobo.681.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.682.1">
      Navigation
     </span>
    </strong>
    <span class="koboSpan" id="kobo.683.1">
     services, handling role management and navigation, respectively.
    </span>
    <span class="koboSpan" id="kobo.683.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.684.1">
      step 5
     </span>
    </em>
    <span class="koboSpan" id="kobo.685.1">
     , we initialize the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.686.1">
      @code
     </span>
    </strong>
    <span class="koboSpan" id="kobo.687.1">
     block in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.688.1">
      Settings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.689.1">
     component.
    </span>
    <span class="koboSpan" id="kobo.689.2">
     Within the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.690.1">
      @code
     </span>
    </strong>
    <span class="koboSpan" id="kobo.691.1">
     block, we construct an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.692.1">
      InputModel
     </span>
    </strong>
    <span class="koboSpan" id="kobo.693.1">
     class with a single
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.694.1">
      RoleName
     </span>
    </strong>
    <span class="koboSpan" id="kobo.695.1">
     property.
    </span>
    <span class="koboSpan" id="kobo.695.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.696.1">
      InputModel
     </span>
    </strong>
    <span class="koboSpan" id="kobo.697.1">
     class will hold the details of the new role when a user fills out the form.
    </span>
    <span class="koboSpan" id="kobo.697.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.698.1">
      step 6
     </span>
    </em>
    <span class="koboSpan" id="kobo.699.1">
     , we intercept a cascading value of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.700.1">
      HttpContext
     </span>
    </strong>
    <span class="koboSpan" id="kobo.701.1">
     to access the current HTTP context  –  necessary for communicating role creation status later.
    </span>
    <span class="koboSpan" id="kobo.701.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.702.1">
      HttpContext
     </span>
    </strong>
    <span class="koboSpan" id="kobo.703.1">
     object didn’t appear magically – when Blazor renders in SSR mode, it exposes the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.704.1">
      HttpContext
     </span>
    </strong>
    <span class="koboSpan" id="kobo.705.1">
     instance cascadingly by default.
    </span>
    <span class="koboSpan" id="kobo.705.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.706.1">
      step 7
     </span>
    </em>
    <span class="koboSpan" id="kobo.707.1">
     , below
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.708.1">
      HttpContext
     </span>
    </strong>
    <span class="koboSpan" id="kobo.709.1">
     , we declare an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.710.1">
      Input
     </span>
    </strong>
    <span class="koboSpan" id="kobo.711.1">
     parameter supplied from a form and override the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.712.1">
      OnInitialized()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.713.1">
     lifecycle method to complete the form initialization pattern.
    </span>
    <span class="koboSpan" id="kobo.713.2">
     You can learn more about building forms in
    </span>
    <a href="B22020_06.xhtml#_idTextAnchor203">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.714.1">
        Chapter 6
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.715.1">
     .
    </span>
    <span class="koboSpan" id="kobo.715.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.716.1">
      step 8
     </span>
    </em>
    <span class="koboSpan" id="kobo.717.1">
     , we complete the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.718.1">
      @code
     </span>
    </strong>
    <span class="koboSpan" id="kobo.719.1">
     block by implementing a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.720.1">
      SaveAsync()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.721.1">
     method.
    </span>
    <span class="koboSpan" id="kobo.721.2">
     In
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.722.1">
      SaveAsync()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.723.1">
     , we initialize a new
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.724.1">
      IdentityRole
     </span>
    </strong>
    <span class="koboSpan" id="kobo.725.1">
     object and leverage
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.726.1">
      RoleManager
     </span>
    </strong>
    <span class="koboSpan" id="kobo.727.1">
     to save the new role to a database.
    </span>
    <span class="koboSpan" id="kobo.727.2">
     We
    </span>
    <a id="_idIndexMarker411">
    </a>
    <span class="koboSpan" id="kobo.728.1">
     use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.729.1">
      Navigation
     </span>
    </strong>
    <span class="koboSpan" id="kobo.730.1">
     service and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.731.1">
      HttpContext
     </span>
    </strong>
    <span class="koboSpan" id="kobo.732.1">
     to perform a self-redirect and send an operation status back to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.733.1">
      the user.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.734.1">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.735.1">
      step 9
     </span>
    </em>
    <span class="koboSpan" id="kobo.736.1">
     , we switch to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.737.1">
      Settings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.738.1">
     markup.
    </span>
    <span class="koboSpan" id="kobo.738.2">
     First, we locate the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.739.1">
      AuthorizeView
     </span>
    </strong>
    <span class="koboSpan" id="kobo.740.1">
     tags.
    </span>
    <span class="koboSpan" id="kobo.740.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.741.1">
      AuthorizeView
     </span>
    </strong>
    <span class="koboSpan" id="kobo.742.1">
     component is a generic component, so it exposes a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.743.1">
      Context
     </span>
    </strong>
    <span class="koboSpan" id="kobo.744.1">
     property.
    </span>
    <span class="koboSpan" id="kobo.744.2">
     Likewise,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.745.1">
      EditForm
     </span>
    </strong>
    <span class="koboSpan" id="kobo.746.1">
     , which we will use for our form, is also a generic component having a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.747.1">
      Context
     </span>
    </strong>
    <span class="koboSpan" id="kobo.748.1">
     property.
    </span>
    <span class="koboSpan" id="kobo.748.2">
     We will have a conflict, and the app will not compile!
    </span>
    <span class="koboSpan" id="kobo.748.3">
     To resolve that issue, we give a custom name to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.749.1">
      Context
     </span>
    </strong>
    <span class="koboSpan" id="kobo.750.1">
     property of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.751.1">
      AuthorizeView
     </span>
    </strong>
    <span class="koboSpan" id="kobo.752.1">
     .
    </span>
    <span class="koboSpan" id="kobo.752.2">
     We also replace the existing authentication status message with a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.753.1">
      StatusMessage
     </span>
    </strong>
    <span class="koboSpan" id="kobo.754.1">
     component.
    </span>
    <span class="koboSpan" id="kobo.754.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.755.1">
      StatusMessage
     </span>
    </strong>
    <span class="koboSpan" id="kobo.756.1">
     component intercepts
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.757.1">
      HttpContext
     </span>
    </strong>
    <span class="koboSpan" id="kobo.758.1">
     and resolves the status message from a designated cookie.
    </span>
    <span class="koboSpan" id="kobo.758.2">
     That’s why we needed
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.759.1">
      HttpContext
     </span>
    </strong>
    <span class="koboSpan" id="kobo.760.1">
     in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.761.1">
      @code
     </span>
    </strong>
    <span class="koboSpan" id="kobo.762.1">
     block – to attach that status cookie correctly.
    </span>
    <span class="koboSpan" id="kobo.762.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.763.1">
      step 10
     </span>
    </em>
    <span class="koboSpan" id="kobo.764.1">
     , we initialize an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.765.1">
      EditForm
     </span>
    </strong>
    <span class="koboSpan" id="kobo.766.1">
     component below
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.767.1">
      StatusMessage
     </span>
    </strong>
    <span class="koboSpan" id="kobo.768.1">
     , attaching the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.769.1">
      Input
     </span>
    </strong>
    <span class="koboSpan" id="kobo.770.1">
     model and the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.771.1">
      SaveAsync()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.772.1">
     method to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.773.1">
      Model
     </span>
    </strong>
    <span class="koboSpan" id="kobo.774.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.775.1">
      OnValidSubmit
     </span>
    </strong>
    <span class="koboSpan" id="kobo.776.1">
     parameters, respectively.
    </span>
    <span class="koboSpan" id="kobo.776.2">
     We also declare a unique
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.777.1">
      FormName
     </span>
    </strong>
    <span class="koboSpan" id="kobo.778.1">
     class for
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.779.1">
      EditForm
     </span>
    </strong>
    <span class="koboSpan" id="kobo.780.1">
     .
    </span>
    <span class="koboSpan" id="kobo.780.2">
     Within
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.781.1">
      EditForm
     </span>
    </strong>
    <span class="koboSpan" id="kobo.782.1">
     , in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.783.1">
      step 11
     </span>
    </em>
    <span class="koboSpan" id="kobo.784.1">
     , we add a paragraph with an editable input box binding to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.785.1">
      Input.RoleName
     </span>
    </strong>
    <span class="koboSpan" id="kobo.786.1">
     property, allowing the user to enter the new role name.
    </span>
    <span class="koboSpan" id="kobo.786.2">
     Finally, in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.787.1">
      step 12
     </span>
    </em>
    <span class="koboSpan" id="kobo.788.1">
     , we complete the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.789.1">
      EditForm
     </span>
    </strong>
    <span class="koboSpan" id="kobo.790.1">
     component by adding a form submit button below the role
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.791.1">
      name input.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-295">
    <a id="_idTextAnchor295">
    </a>
    <span class="koboSpan" id="kobo.792.1">
     Modifying a user’s identity
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.793.1">
     Modifying a user’s identity
    </span>
    <a id="_idIndexMarker412">
    </a>
    <span class="koboSpan" id="kobo.794.1">
     can be crucial for tailoring your application’s functionality and improving user experience.
    </span>
    <span class="koboSpan" id="kobo.794.2">
     Having additional identity properties, you can enable more personalized interactions and better manage user-specific information.
    </span>
    <span class="koboSpan" id="kobo.794.3">
     In many applications, a username is equivalent to a user’s email, and that’s not enough details for displaying personalized greetings, sending customized notifications, or generating reports.
    </span>
    <span class="koboSpan" id="kobo.794.4">
     But worry not.
    </span>
    <span class="koboSpan" id="kobo.794.5">
     In Blazor, identity is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.795.1">
      highly flexible.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.796.1">
     Let’s allow a user to
    </span>
    <a id="_idIndexMarker413">
    </a>
    <span class="koboSpan" id="kobo.797.1">
     fill in their first and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.798.1">
      last name.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-296">
    <a id="_idTextAnchor296">
    </a>
    <span class="koboSpan" id="kobo.799.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.800.1">
     Before extending the user’s identity, do
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.801.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.802.1">
      In the server-side project, create a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.803.1">
       Components
      </span>
     </strong>
     <span class="koboSpan" id="kobo.804.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.805.1">
       Recipes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.806.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.807.1">
       Recipe05
      </span>
     </strong>
     <span class="koboSpan" id="kobo.808.1">
      directory – this will be your
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.809.1">
       working directory
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.810.1">
      Copy the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.811.1">
       Settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.812.1">
      component from the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.813.1">
       Creating roles
      </span>
     </em>
     <span class="koboSpan" id="kobo.814.1">
      recipe or from the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.815.1">
       Components
      </span>
     </strong>
     <span class="koboSpan" id="kobo.816.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.817.1">
       Recipes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.818.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.819.1">
       Recipe03
      </span>
     </strong>
     <span class="koboSpan" id="kobo.820.1">
      directory in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.821.1">
       GitHub repository
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.822.1">
      Find the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.823.1">
       seed-work.sql
      </span>
     </strong>
     <span class="koboSpan" id="kobo.824.1">
      script in the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.825.1">
       Samples
      </span>
     </strong>
     <span class="koboSpan" id="kobo.826.1">
      directory of the server-side project in the GitHub repository and run it on
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.827.1">
       your database
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.828.1">
      If you haven’t scaffolded your project, copy the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.829.1">
       StatusMessage
      </span>
     </strong>
     <span class="koboSpan" id="kobo.830.1">
      component from the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.831.1">
       Components
      </span>
     </strong>
     <span class="koboSpan" id="kobo.832.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.833.1">
       Account
      </span>
     </strong>
     <span class="koboSpan" id="kobo.834.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.835.1">
       Shared
      </span>
     </strong>
     <span class="koboSpan" id="kobo.836.1">
      directory of the GitHub repository to the same path in your
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.837.1">
       server-side project
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-297">
    <a id="_idTextAnchor297">
    </a>
    <span class="koboSpan" id="kobo.838.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.839.1">
     Follow these steps to extend the default user
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.840.1">
      identity model:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.841.1">
      Navigate to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.842.1">
       ApplicationUser
      </span>
     </strong>
     <span class="koboSpan" id="kobo.843.1">
      class in the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.844.1">
       Data
      </span>
     </strong>
     <span class="koboSpan" id="kobo.845.1">
      directory of the server-side project and extend it with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.846.1">
       FirstName
      </span>
     </strong>
     <span class="koboSpan" id="kobo.847.1">
      and
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.848.1">
        LastName
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.849.1">
       properties:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.850.1">
public class ApplicationUser : IdentityUser
{
    public string FirstName { get; set; }
    public string LastName { get; set; }
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.851.1">
      Using the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.852.1">
       Package Manager Console
      </span>
     </strong>
     <span class="koboSpan" id="kobo.853.1">
      , call an Entity Framework command to generate a new
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.854.1">
       AddedUserFullName
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.855.1">
       database migration:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.856.1">add-migration AddedUserFullName</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.857.1">
       Alternatively, if you’re using the .NET CLI, generate the same migration using the
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.858.1">
        following command:
       </span>
      </span>
     </p>
     <pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.859.1">dotnet ef migrations add AddedUserFullName</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.860.1">
       You will get a few
      </span>
      <a id="_idIndexMarker414">
      </a>
      <span class="koboSpan" id="kobo.861.1">
       new files in the
      </span>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.862.1">
         Data
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.863.1">
        /
       </span>
      </span>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.864.1">
         Migrations
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.865.1">
        directory:
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer040">
     <span class="koboSpan" id="kobo.866.1">
      <img alt="Figure 8.9: Migration files adding FirstName and LastName properties to ApplicationUser in database" src="image/Figure_8.9_B22020.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.867.1">
     Figure 8.9: Migration files adding FirstName and LastName properties to ApplicationUser in database
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.868.1">
      Apply the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.869.1">
       AddedUserFullName
      </span>
     </strong>
     <span class="koboSpan" id="kobo.870.1">
      migration to the database by calling another command in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.871.1">
       Package
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.872.1">
        Manager Console
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.873.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.874.1">update-database</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.875.1">
       Alternatively, if you’re using the .NET CLI, update the database using the
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.876.1">
        following command:
       </span>
      </span>
     </p>
     <pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.877.1">dotnet ef database update</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.878.1">
      Open the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.879.1">
       Settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.880.1">
      component and add one more
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.881.1">
       @using
      </span>
     </strong>
     <span class="koboSpan" id="kobo.882.1">
      directive, next to the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.883.1">
       existing ones:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.884.1">
@using BlazorCookbook.Auth.Data</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.885.1">
      Below, in the section with injections, replace the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.886.1">
       RoleManager
      </span>
     </strong>
     <span class="koboSpan" id="kobo.887.1">
      service with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.888.1">
       IdentityUserAccessor
      </span>
     </strong>
     <span class="koboSpan" id="kobo.889.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.890.1">
       UserManager
      </span>
     </strong>
     <span class="koboSpan" id="kobo.891.1">
      , and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.892.1">
       SignInManager
      </span>
     </strong>
     <span class="koboSpan" id="kobo.893.1">
      services.
     </span>
     <span class="koboSpan" id="kobo.893.2">
      Keep the already available
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.894.1">
        Navigation
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.895.1">
       service:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.896.1">
@inject IdentityUserAccessor UserAccessor
@inject UserManager&lt;ApplicationUser&gt; UserManager
@inject SignInManager&lt;ApplicationUser&gt; SignInManager
@inject IdentityRedirectManager Navigation</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.897.1">
      In the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.898.1">
       @code
      </span>
     </strong>
     <span class="koboSpan" id="kobo.899.1">
      block, update
     </span>
     <a id="_idIndexMarker415">
     </a>
     <span class="koboSpan" id="kobo.900.1">
      the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.901.1">
       InputModel
      </span>
     </strong>
     <span class="koboSpan" id="kobo.902.1">
      class by replacing the existing properties with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.903.1">
       FirstName
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.904.1">
       and
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.905.1">
        LastName
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.906.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.907.1">
private sealed class InputModel
{
    public string FirstName { get; set; }
    public string LastName { get; set; }
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.908.1">
      Above the existing
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.909.1">
       SaveAsync()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.910.1">
      method, declare a private
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.911.1">
        ApplicationUser
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.912.1">
       field:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.913.1">
private ApplicationUser _user;</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.914.1">
      Below the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.915.1">
       _user
      </span>
     </strong>
     <span class="koboSpan" id="kobo.916.1">
      declaration, override the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.917.1">
       OnInitializedAsync()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.918.1">
      lifecycle method.
     </span>
     <span class="koboSpan" id="kobo.918.2">
      Leverage the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.919.1">
       UserAccessor
      </span>
     </strong>
     <span class="koboSpan" id="kobo.920.1">
      instance to get the user details from the database and hydrate the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.921.1">
        Input
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.922.1">
       model:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.923.1">
protected override async Task OnInitializedAsync()
{
    _user = await UserAccessor
        .GetRequiredUserAsync(HttpContext);
    Input.FirstName ??= _user.FirstName;
    Input.LastName ??= _user.LastName;
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.924.1">
      To complete the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.925.1">
       @code
      </span>
     </strong>
     <span class="koboSpan" id="kobo.926.1">
      block, update the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.927.1">
       SaveAsync()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.928.1">
      method so that it updates
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.929.1">
       _user
      </span>
     </strong>
     <span class="koboSpan" id="kobo.930.1">
      details from the filled
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.931.1">
       Input
      </span>
     </strong>
     <span class="koboSpan" id="kobo.932.1">
      model, persist changes with the help of
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.933.1">
       UserManager
      </span>
     </strong>
     <span class="koboSpan" id="kobo.934.1">
      , and refresh the user context using
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.935.1">
       SignInManager
      </span>
     </strong>
     <span class="koboSpan" id="kobo.936.1">
      .
     </span>
     <span class="koboSpan" id="kobo.936.2">
      Lastly, update the status
     </span>
     <a id="_idIndexMarker416">
     </a>
     <span class="koboSpan" id="kobo.937.1">
      message returned to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.938.1">
       the user:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.939.1">
private async Task SaveAsync()
{
    _user.FirstName = Input.FirstName;
    _user.LastName = Input.LastName;
    await UserManager.UpdateAsync(_user);
    await SignInManager.RefreshSignInAsync(_user);
    Navigation.RedirectToCurrentPageWithStatus(
        "Your profile has been updated",
        HttpContext);
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.940.1">
      Jump to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.941.1">
       Settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.942.1">
      markup area and locate the content area of the existing
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.943.1">
        EditForm
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.944.1">
       component.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.945.1">
      Update the existing input label to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.946.1">
       First Name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.947.1">
      and fix the binding to the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.948.1">
        Input.FirstName
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.949.1">
       property:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.950.1">
&lt;p&gt;First Name
  &lt;InputText @bind-Value="@Input.FirstName" /&gt;
&lt;/p&gt;</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.951.1">
      Below the first name, add a paragraph displaying another editable input binding to the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.952.1">
        Input.LastName
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.953.1">
       property:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.954.1">
&lt;p&gt;Last Name
  &lt;InputText @bind-Value="@Input.LastName" /&gt;
&lt;/p&gt;</span></pre>
    </li>
   </ol>
   <h2 id="_idParaDest-298">
    <a id="_idTextAnchor298">
    </a>
    <span class="koboSpan" id="kobo.955.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.956.1">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.957.1">
      step 1
     </span>
    </em>
    <span class="koboSpan" id="kobo.958.1">
     , we navigate to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.959.1">
      ApplicationUser
     </span>
    </strong>
    <span class="koboSpan" id="kobo.960.1">
     class in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.961.1">
      Data
     </span>
    </strong>
    <span class="koboSpan" id="kobo.962.1">
     directory of the server-side project.
    </span>
    <span class="koboSpan" id="kobo.962.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.963.1">
      ApplicationUser
     </span>
    </strong>
    <span class="koboSpan" id="kobo.964.1">
     class represents the user of our application and currently inherits from the default
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.965.1">
      IdentityUser
     </span>
    </strong>
    <span class="koboSpan" id="kobo.966.1">
     class to be compatible with the identity schema.
    </span>
    <span class="koboSpan" id="kobo.966.2">
     Now, we extend our user identity details with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.967.1">
      FirstName
     </span>
    </strong>
    <span class="koboSpan" id="kobo.968.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.969.1">
      LastName
     </span>
    </strong>
    <span class="koboSpan" id="kobo.970.1">
     properties.
    </span>
    <span class="koboSpan" id="kobo.970.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.971.1">
      step 2
     </span>
    </em>
    <span class="koboSpan" id="kobo.972.1">
     , we extend the identity database using a database migration.
    </span>
    <span class="koboSpan" id="kobo.972.2">
     Database migrations are a way to manage and apply incremental changes to the database schema over time.
    </span>
    <span class="koboSpan" id="kobo.972.3">
     They allow developers to define changes to the database
    </span>
    <a id="_idIndexMarker417">
    </a>
    <span class="koboSpan" id="kobo.973.1">
     structure, such as adding or modifying tables and columns, in code, ensuring that the database is in sync with the application.
    </span>
    <span class="koboSpan" id="kobo.973.2">
     We open the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.974.1">
      Package Manager Console
     </span>
    </strong>
    <span class="koboSpan" id="kobo.975.1">
     , available in Visual Studio, and generate a new
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.976.1">
      AddedUserFullName
     </span>
    </strong>
    <span class="koboSpan" id="kobo.977.1">
     database migration.
    </span>
    <span class="koboSpan" id="kobo.977.2">
     The Entity Framework tool will generate two new files in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.978.1">
      Data
     </span>
    </strong>
    <span class="koboSpan" id="kobo.979.1">
     /
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.980.1">
      Migrations
     </span>
    </strong>
    <span class="koboSpan" id="kobo.981.1">
     directory.
    </span>
    <span class="koboSpan" id="kobo.981.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.982.1">
      step 3
     </span>
    </em>
    <span class="koboSpan" id="kobo.983.1">
     , we apply the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.984.1">
      AddedUserFullName
     </span>
    </strong>
    <span class="koboSpan" id="kobo.985.1">
     migration to the database using the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.986.1">
      Package Manager Console
     </span>
    </strong>
    <span class="koboSpan" id="kobo.987.1">
     again.
    </span>
    <span class="koboSpan" id="kobo.987.2">
     We will not explore generated migrations or migration commands as they’re not in the scope of this book, but you can find additional resources in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.988.1">
      See also
     </span>
    </em>
    <span class="koboSpan" id="kobo.989.1">
     section at the end of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.990.1">
      the recipe.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.991.1">
     Next, in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.992.1">
      step 4
     </span>
    </em>
    <span class="koboSpan" id="kobo.993.1">
     , we open the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.994.1">
      Settings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.995.1">
     component and extend the set of already existing
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.996.1">
      @using
     </span>
    </strong>
    <span class="koboSpan" id="kobo.997.1">
     directives with a reference to a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.998.1">
      BlazorCookbook.Auth.Data
     </span>
    </strong>
    <span class="koboSpan" id="kobo.999.1">
     assembly, where we have the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1000.1">
      ApplicationUser
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1001.1">
     class.
    </span>
    <span class="koboSpan" id="kobo.1001.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1002.1">
      step 5
     </span>
    </em>
    <span class="koboSpan" id="kobo.1003.1">
     , we remove the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1004.1">
      RoleManager
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1005.1">
     service injection, as we won’t work with roles.
    </span>
    <span class="koboSpan" id="kobo.1005.2">
     Instead, we’re adding a few other identity services.
    </span>
    <span class="koboSpan" id="kobo.1005.3">
     We need
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1006.1">
      IdentityUserAccessor
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1007.1">
     to resolve the user context from the application
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1008.1">
      HttpContext
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1009.1">
     instance.
    </span>
    <span class="koboSpan" id="kobo.1009.2">
     With the help of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1010.1">
      UserManager
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1011.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1012.1">
      SignInManager
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1013.1">
     , we can safely manipulate and refresh user details.
    </span>
    <span class="koboSpan" id="kobo.1013.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1014.1">
      step 6
     </span>
    </em>
    <span class="koboSpan" id="kobo.1015.1">
     , we update the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1016.1">
      InputModel
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1017.1">
     class to support our new requirements and replace all existing properties with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1018.1">
      FirstName
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1019.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1020.1">
      LastName
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1021.1">
     properties, matching the details we want to see on the new form later.
    </span>
    <span class="koboSpan" id="kobo.1021.2">
     At this point, you will see some IDE errors, as the existing form is no longer compatible with the updated
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1022.1">
      InputModel
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1023.1">
     class.
    </span>
    <span class="koboSpan" id="kobo.1023.2">
     We will fix that shortly.
    </span>
    <span class="koboSpan" id="kobo.1023.3">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1024.1">
      step 7
     </span>
    </em>
    <span class="koboSpan" id="kobo.1025.1">
     , we declare a backing field – a private
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1026.1">
      ApplicationUser
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1027.1">
     variable to store a reference to the database object representing the currently logged-in user.
    </span>
    <span class="koboSpan" id="kobo.1027.2">
     We will use it to persist the first and last name the user provides.
    </span>
    <span class="koboSpan" id="kobo.1027.3">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1028.1">
      step 8
     </span>
    </em>
    <span class="koboSpan" id="kobo.1029.1">
     , we override the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1030.1">
      OnInitializedAsync()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1031.1">
     lifecycle method.
    </span>
    <span class="koboSpan" id="kobo.1031.2">
     We leverage the injected
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1032.1">
      UserAccessor
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1033.1">
     service to resolve the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1034.1">
      ApplicationUser
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1035.1">
     object from
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1036.1">
      HttpContext
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1037.1">
     into the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1038.1">
      _user
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1039.1">
     instance and hydrate the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1040.1">
      Input
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1041.1">
     model with the found details.
    </span>
    <span class="koboSpan" id="kobo.1041.2">
     That way, we ensure the form is pre-populated with the current user’s details before the UI renders.
    </span>
    <span class="koboSpan" id="kobo.1041.3">
     To complete the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1042.1">
      @code
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1043.1">
     block, in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1044.1">
      step 9
     </span>
    </em>
    <span class="koboSpan" id="kobo.1045.1">
     , we update the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1046.1">
      SaveAsync()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1047.1">
     method so that it supports the updated
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1048.1">
      Input
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1049.1">
     model and saves user identity details.
    </span>
    <span class="koboSpan" id="kobo.1049.2">
     We update the persisted
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1050.1">
      _user
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1051.1">
     object with data coming from the form, filled by the user, and save those changes to the database with the help of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1052.1">
      UserManager
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1053.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1053.2">
     After
    </span>
    <a id="_idIndexMarker418">
    </a>
    <span class="koboSpan" id="kobo.1054.1">
     updating, we refresh the user context using
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1055.1">
      SignInManager
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1056.1">
     and perform a self-redirect to display a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1057.1">
      Your profile has been updated
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1058.1">
     message on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1059.1">
      the UI.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1060.1">
     Next, in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1061.1">
      step 10
     </span>
    </em>
    <span class="koboSpan" id="kobo.1062.1">
     , we jump to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1063.1">
      Settings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1064.1">
     markup area and locate the existing
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1065.1">
      EditForm
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1066.1">
     component.
    </span>
    <span class="koboSpan" id="kobo.1066.2">
     We will adjust the form to support filling in the user’s first and last names.
    </span>
    <span class="koboSpan" id="kobo.1066.3">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1067.1">
      step 11
     </span>
    </em>
    <span class="koboSpan" id="kobo.1068.1">
     , we fix the no longer compatible input box by binding it to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1069.1">
      Input.FirstName
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1070.1">
     property.
    </span>
    <span class="koboSpan" id="kobo.1070.2">
     We also update the label to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1071.1">
      First name
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1072.1">
     , to make it clear which field the user is updating.
    </span>
    <span class="koboSpan" id="kobo.1072.2">
     Similarly, in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1073.1">
      step 12
     </span>
    </em>
    <span class="koboSpan" id="kobo.1074.1">
     , we add a paragraph with another editable input box with a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1075.1">
      Last name
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1076.1">
     label and binding to the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1077.1">
       Input.LastName
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1078.1">
      property.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1079.1">
     With the form in place, you can run the app and update the first and last name of the account you’ll be using.
    </span>
    <span class="koboSpan" id="kobo.1079.2">
     When you fill the inputs and save the changes, you’ll receive a friendly
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1080.1">
      confirmation message:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer041">
     <span class="koboSpan" id="kobo.1081.1">
      <img alt="Figure 8.10: Status message confirming that changes were successfully applied" src="image/Figure_8.10_B22020.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1082.1">
     Figure 8.10: Status message confirming that changes were successfully applied
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1083.1">
     You can also check changes in the database by displaying the records in the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1084.1">
       AspNetUsers
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1085.1">
      table:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer042">
     <span class="koboSpan" id="kobo.1086.1">
      <img alt="Figure 8.11: Reviewing first and last name updates in the database" src="image/Figure_8.11_B22020.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1087.1">
     Figure 8.11: Reviewing first and last name updates in the database
    </span>
   </p>
   <h2 id="_idParaDest-299">
    <a id="_idTextAnchor299">
    </a>
    <span class="koboSpan" id="kobo.1088.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1089.1">
     In this recipe, we’ve
    </span>
    <a id="_idIndexMarker419">
    </a>
    <span class="koboSpan" id="kobo.1090.1">
     touched on the concept of database migrations.
    </span>
    <span class="koboSpan" id="kobo.1090.2">
     It’s a topic deserving a book of its own, but if you’d like to learn more, go to the learning resources prepared by the Microsoft
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1091.1">
      team:
     </span>
    </span>
    <a href="https://learn.microsoft.com/en-us/ef/core/managing-schemas/migrations">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1092.1">
       https://learn.microsoft.com/en-us/ef/core/managing-schemas/migrations
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1093.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-300">
    <a id="_idTextAnchor300">
    </a>
    <span class="koboSpan" id="kobo.1094.1">
     Supporting roles’ and policies’ authorization
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1095.1">
     Securing your application might not be just about having an authenticated user; it often requires more granular control.
    </span>
    <span class="koboSpan" id="kobo.1095.2">
     You may need to grant access to specific features or pages based on the user’s role.
    </span>
    <span class="koboSpan" id="kobo.1095.3">
     Blazor’s native authorization APIs – the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1096.1">
      Authorize
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1097.1">
     attribute and the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1098.1">
      AuthorizeView
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1099.1">
     component – support both roles and policies that you will find familiar from MVC applications or
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1100.1">
      REST APIs.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1101.1">
     Let’s implement roles and policies, fine-tuning a settings page to display different content for administrators and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1102.1">
      standard users.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-301">
    <a id="_idTextAnchor301">
    </a>
    <span class="koboSpan" id="kobo.1103.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1104.1">
     Before we put policies and
    </span>
    <a id="_idIndexMarker420">
    </a>
    <span class="koboSpan" id="kobo.1105.1">
     roles in place, do
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1106.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1107.1">
      In the server-side project, create a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1108.1">
       Components
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1109.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1110.1">
       Recipes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1111.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1112.1">
       Recipe06
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1113.1">
      directory – this will be your
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1114.1">
       working directory.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1115.1">
      Copy the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1116.1">
       Settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1117.1">
      component from the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1118.1">
       Modifying a user’s identity
      </span>
     </em>
     <span class="koboSpan" id="kobo.1119.1">
      recipe or from the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1120.1">
       Components
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1121.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1122.1">
       Recipes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1123.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1124.1">
       Recipe05
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1125.1">
      directory in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1126.1">
       GitHub repository.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1127.1">
      If you haven’t run migrations yet, find the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1128.1">
       seed-work.sql
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1129.1">
      script in the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1130.1">
       Samples
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1131.1">
      directory of the server-side project and run it on
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1132.1">
       your database.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1133.1">
      If you’re not following along, make sure you have roles’ support enabled in your server-side project; you must leverage the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1134.1">
       AddRoles()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1135.1">
      builder API method, which we discussed in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1136.1">
       Creating
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1137.1">
        roles
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1138.1">
       recipe.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-302">
    <a id="_idTextAnchor302">
    </a>
    <span class="koboSpan" id="kobo.1139.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1140.1">
     To add roles’ and policies’ support, both
    </span>
    <a id="_idIndexMarker421">
    </a>
    <span class="koboSpan" id="kobo.1141.1">
     on the server and client side, follow
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1142.1">
      these steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1143.1">
      Navigate to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1144.1">
       Program.cs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1145.1">
      file in the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1146.1">
       BlazorCookbook.Auth.Client
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1147.1">
      project – the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1148.1">
       client-side application.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1149.1">
      In the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1150.1">
       Program.cs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1151.1">
      file, find the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1152.1">
       AddAuthorizationCore()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1153.1">
      method call and overload it with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1154.1">
       options
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1155.1">
      to configure the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1156.1">
       InternalEmployee
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1157.1">
      policy that checks if a user’s email belongs to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1158.1">
       @
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1159.1">
        packt.com
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1160.1">
       domain:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1161.1">
builder.Services.AddAuthorizationCore(options =&gt;
{
    options.AddPolicy("InternalEmployee", policy =&gt;
        policy.RequireAssertion(context =&gt;
            context.User?.Identity?.Name?
</span><span class="koboSpan" id="kobo.1161.2">                .EndsWith("@packt.com") ?? </span><span class="koboSpan" id="kobo.1161.3">false));
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1162.1">
      Still on the client side, open the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1163.1">
       UserInfo
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1164.1">
      class and extend it with a
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1165.1">
        Role
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1166.1">
       property:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1167.1">
public class UserInfo
{
    //... </span><span class="koboSpan" id="kobo.1167.2">existing properties ...
</span><span class="koboSpan" id="kobo.1167.3">    public required string Role { get; set; }
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1168.1">
      Next, navigate to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1169.1">
       PersistentAuthenticationStateProvider
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1170.1">
      class, and in the
     </span>
     <a id="_idIndexMarker422">
     </a>
     <span class="koboSpan" id="kobo.1171.1">
      constructor, extend the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1172.1">
       claims
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1173.1">
      array to include the newly added
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1174.1">
        Role
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1175.1">
       value:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1176.1">
Claim[] claims = [
    // ... </span><span class="koboSpan" id="kobo.1176.2">existing properties ...
</span><span class="koboSpan" id="kobo.1176.3">    new Claim(ClaimTypes.Email, userInfo.Email),
    new Claim(ClaimTypes.Role, userInfo.Role),
];</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1177.1">
      Switch to the server-side application and open the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1178.1">
       Program.cs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1179.1">
      file of the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1180.1">
        BlazorCookbook.Auth
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1181.1">
       project.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1182.1">
      Locate where the app is built, and just before that, use the authorization builder to add the same
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1183.1">
       InternalEmployee
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1184.1">
      policy as on the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1185.1">
       client side:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1186.1">
builder.Services
    .AddAuthorizationBuilder()
    .AddPolicy("InternalEmployee",
        policy =&gt; policy.RequireAssertion(context =&gt;
            context.User?.Identity?.Name?
</span><span class="koboSpan" id="kobo.1186.2">                .EndsWith("@packt.com") ?? </span><span class="koboSpan" id="kobo.1186.3">false));
var app = builder.Build();</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1187.1">
      Navigate to an
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1188.1">
       OnPersistingAsync
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1189.1">
      method of a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1190.1">
       PersistingRevalidatingAuthenticationStateProvider
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1191.1">
      class and extend the logic executed for the authenticated user to append the role to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1192.1">
       UserInfo
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1193.1">
      class that Blazor will send over to the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1194.1">
       client side:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1195.1">
var userId = principal.FindFirst(
    options.ClaimsIdentity.UserIdClaimType)?.Value;
var email = principal.FindFirst(
    options.ClaimsIdentity.EmailClaimType)?.Value;
var role = principal.FindFirst(
    options.ClaimsIdentity.RoleClaimType)?.Value;
state.PersistAsJson(nameof(UserInfo), new UserInfo
{
    UserId = userId,
    Email = email,
    Role = role
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1196.1">
      Open the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1197.1">
       Settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1198.1">
      component, and below the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1199.1">
       @page
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1200.1">
      directive, add the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1201.1">
       Authorize
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1202.1">
      attribute
     </span>
     <a id="_idIndexMarker423">
     </a>
     <span class="koboSpan" id="kobo.1203.1">
      overloaded with the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1204.1">
        InternalEmployee
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1205.1">
       policy:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1206.1">
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize(Policy = "InternalEmployee")]</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1207.1">
      In the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1208.1">
       Settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1209.1">
      markup, find the existing
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1210.1">
       AuthorizeView
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1211.1">
      opening tag and set the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1212.1">
       Roles
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1213.1">
      parameter to allow
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1214.1">
       Support
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1215.1">
      and
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1216.1">
        Admin
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1217.1">
       roles:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1218.1">
&lt;AuthorizeView Context="user" Roles="Support,Admin"&gt;
    @* here's still the existing EditForm *@
&lt;/AuthorizeView&gt;</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1219.1">
      Below the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1220.1">
       EditForm
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1221.1">
      protected area, construct another
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1222.1">
       AuthorizeView
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1223.1">
      section, protecting a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1224.1">
       Shut down the app
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1225.1">
      button and rendering the content only for users in the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1226.1">
        Admin
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1227.1">
       role:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1228.1">
&lt;AuthorizeView Roles="Admin"&gt;
    &lt;p&gt;&lt;button&gt;Shut down the app&lt;/button&gt;&lt;/p&gt;
&lt;/AuthorizeView&gt;</span></pre>
    </li>
   </ol>
   <h2 id="_idParaDest-303">
    <a id="_idTextAnchor303">
    </a>
    <span class="koboSpan" id="kobo.1229.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1230.1">
     We’re starting with the client-side application, so in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1231.1">
      step 1
     </span>
    </em>
    <span class="koboSpan" id="kobo.1232.1">
     , we navigate to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1233.1">
      Program.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1234.1">
     file in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1235.1">
      BlazorCookbook.Auth.Client
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1236.1">
     project.
    </span>
    <span class="koboSpan" id="kobo.1236.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1237.1">
      step 2
     </span>
    </em>
    <span class="koboSpan" id="kobo.1238.1">
     , we extend the authorization registration by finding the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1239.1">
      AddAuthorizationCore()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1240.1">
     method call and overloading it with options to configure the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1241.1">
      InternalEmployee
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1242.1">
     policy.
    </span>
    <span class="koboSpan" id="kobo.1242.2">
     We leverage the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1243.1">
      AuthorizationPolicyBuilder
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1244.1">
     class, which we call
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1245.1">
      policy
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1246.1">
     , to check if a currently logged-in user’s email belongs to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1247.1">
      @packt.com
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1248.1">
     domain.
    </span>
    <span class="koboSpan" id="kobo.1248.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1249.1">
      AuthorizationPolicyBuilder
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1250.1">
     class supports custom assertions (which we used) as well as checking claims, usernames, or .NET native
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1251.1">
      IAuthorizationRequirement
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1252.1">
     objects.
    </span>
    <span class="koboSpan" id="kobo.1252.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1253.1">
      step 3
     </span>
    </em>
    <span class="koboSpan" id="kobo.1254.1">
     , we open the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1255.1">
      UserInfo
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1256.1">
     class and extend it with a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1257.1">
      Role
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1258.1">
     property.
    </span>
    <span class="koboSpan" id="kobo.1258.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1259.1">
      UserInfo
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1260.1">
     class is a model that Blazor uses to share user identity details across render mode boundaries.
    </span>
    <span class="koboSpan" id="kobo.1260.2">
     As we need the WebAssembly side to resolve
    </span>
    <a id="_idIndexMarker424">
    </a>
    <span class="koboSpan" id="kobo.1261.1">
     user roles correctly, we must pass them there explicitly.
    </span>
    <span class="koboSpan" id="kobo.1261.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1262.1">
      step 4
     </span>
    </em>
    <span class="koboSpan" id="kobo.1263.1">
     , we complete the client-side configuration by extending the constructor of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1264.1">
      PersistentAuthenticationStateProvider
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1265.1">
     class.
    </span>
    <span class="koboSpan" id="kobo.1265.2">
     Blazor uses
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1266.1">
      PersistentAuthenticationStateProvider
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1267.1">
     to determine the user’s authentication state that arrives from the server side.
    </span>
    <span class="koboSpan" id="kobo.1267.2">
     In the constructor, we deserialize the state into a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1268.1">
      UserInfo
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1269.1">
     object and extend the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1270.1">
      claims
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1271.1">
     array to include the value of the newly added
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1272.1">
      Role
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1273.1">
     property.
    </span>
    <span class="koboSpan" id="kobo.1273.2">
     Now, whenever our application runs locally in the browser, the user’s role will still be available to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1274.1">
      verify against.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1275.1">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1276.1">
      step 5
     </span>
    </em>
    <span class="koboSpan" id="kobo.1277.1">
     , we switch to the server-side application and open the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1278.1">
      Program.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1279.1">
     file of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1280.1">
      BlazorCookbook.Auth
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1281.1">
     project.
    </span>
    <span class="koboSpan" id="kobo.1281.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1282.1">
      step 6
     </span>
    </em>
    <span class="koboSpan" id="kobo.1283.1">
     , we locate where we invoke the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1284.1">
      builder.Build()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1285.1">
     method to build the app.
    </span>
    <span class="koboSpan" id="kobo.1285.2">
     Right before that, we add the same
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1286.1">
      InternalEmployee
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1287.1">
     policy as on the client side with the help of the authorization builder.
    </span>
    <span class="koboSpan" id="kobo.1287.2">
     As the policy assertion is indeed the same, the server API for configuring authorization is slightly different.
    </span>
    <span class="koboSpan" id="kobo.1287.3">
     We invoke the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1288.1">
      AddAuthorizationBuilder()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1289.1">
     method to access the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1290.1">
      AuthorizationBuilder
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1291.1">
     instance as it exposes the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1292.1">
      AddPolicy()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1293.1">
     builder method.
    </span>
    <span class="koboSpan" id="kobo.1293.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1294.1">
      step 7
     </span>
    </em>
    <span class="koboSpan" id="kobo.1295.1">
     , we complete the server-side implementation by navigating to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1296.1">
      OnPersistingAsync
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1297.1">
     method of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1298.1">
      PersistingRevalidatingAuthenticationStateProvider
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1299.1">
     class.
    </span>
    <span class="koboSpan" id="kobo.1299.2">
     That’s the service Blazor uses when passing the user’s identity to the browser.
    </span>
    <span class="koboSpan" id="kobo.1299.3">
     We locate the logic for the authenticated user.
    </span>
    <span class="koboSpan" id="kobo.1299.4">
     It already contains the sharing of the user’s ID and email.
    </span>
    <span class="koboSpan" id="kobo.1299.5">
     We follow the same implementation pattern by grabbing the value of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1300.1">
      RoleClaimType
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1301.1">
     from the current
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1302.1">
      principal
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1303.1">
     value and passing it on to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1304.1">
      UserRole
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1305.1">
     object that Blazor will persist as JSON inside the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1306.1">
      outgoing response.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1307.1">
     Now, we put all that authorization implementation to the test.
    </span>
    <span class="koboSpan" id="kobo.1307.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1308.1">
      step 8
     </span>
    </em>
    <span class="koboSpan" id="kobo.1309.1">
     , we open the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1310.1">
      Settings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1311.1">
     component
    </span>
    <a id="_idIndexMarker425">
    </a>
    <span class="koboSpan" id="kobo.1312.1">
     and add the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1313.1">
      Authorize
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1314.1">
     attribute.
    </span>
    <span class="koboSpan" id="kobo.1314.2">
     It requires a reference to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1315.1">
      Microsoft.AspNetCore.Authorization
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1316.1">
     assembly, so we grant that with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1317.1">
      @using
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1318.1">
     directive.
    </span>
    <span class="koboSpan" id="kobo.1318.2">
     Then, we leverage the overloading of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1319.1">
      Authorize
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1320.1">
     attribute.
    </span>
    <span class="koboSpan" id="kobo.1320.2">
     We can set the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1321.1">
      Policy
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1322.1">
     property so that the user must meet it to access the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1323.1">
      Settings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1324.1">
     page.
    </span>
    <span class="koboSpan" id="kobo.1324.2">
     That’s where we finally use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1325.1">
      InternalEmployee
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1326.1">
     policy.
    </span>
    <span class="koboSpan" id="kobo.1326.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1327.1">
      step 9
     </span>
    </em>
    <span class="koboSpan" id="kobo.1328.1">
     , we continue to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1329.1">
      Settings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1330.1">
     markup.
    </span>
    <span class="koboSpan" id="kobo.1330.2">
     We find the existing
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1331.1">
      AuthorizeView
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1332.1">
     opening tag, wrapping the form where users can fill in their first and last names.
    </span>
    <span class="koboSpan" id="kobo.1332.2">
     We set the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1333.1">
      Roles
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1334.1">
     parameter to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1335.1">
      Support
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1336.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1337.1">
      Admin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1338.1">
     values, ensuring that the form renders only when the current user is in any of the expected roles.
    </span>
    <span class="koboSpan" id="kobo.1338.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1339.1">
      Roles
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1340.1">
     parameter accepts a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1341.1">
      string
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1342.1">
     object, so you can provide one or multiple comma-separated roles.
    </span>
    <span class="koboSpan" id="kobo.1342.2">
     You can also have as many protected markup areas as you need within the same component.
    </span>
    <span class="koboSpan" id="kobo.1342.3">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1343.1">
      step 10
     </span>
    </em>
    <span class="koboSpan" id="kobo.1344.1">
     , we construct another
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1345.1">
      AuthorizeView
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1346.1">
     area below the one already existing.
    </span>
    <span class="koboSpan" id="kobo.1346.2">
     Inside, we construct an idle
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1347.1">
      Shut down the app
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1348.1">
     button, but we ensure it renders only for users in the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1349.1">
       Admin
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1350.1">
      role.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1351.1">
     We arrive at a fully functional, secure view that adjusts dynamically to whoever is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1352.1">
      viewing it.
     </span>
    </span>
   </p>
   <p>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.1353.1">
       Figure 8
      </span>
     </em>
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1354.1">
      .12
     </span>
    </em>
    <span class="koboSpan" id="kobo.1355.1">
     shows the store settings to the user with the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1356.1">
       Admin
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1357.1">
      role:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer043">
     <span class="koboSpan" id="kobo.1358.1">
      <img alt="Figure 8.12: Store settings that an admin@packt.com user sees" src="image/Figure_8.12_B22020.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1359.1">
     Figure 8.12: Store settings that an admin@packt.com user sees
    </span>
   </p>
   <p>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.1360.1">
       Figure 8
      </span>
     </em>
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1361.1">
      .13
     </span>
    </em>
    <span class="koboSpan" id="kobo.1362.1">
     shows the store settings to the user with the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1363.1">
       Support
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1364.1">
      role:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer044">
     <span class="koboSpan" id="kobo.1365.1">
      <img alt="Figure 8.13: Store settings that a support@packt.com user sees" src="image/Figure_8.13_B22020.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1366.1">
     Figure 8.13: Store settings that a support@packt.com user sees
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1367.1">
     As you can see, when I log in as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1368.1">
      admin@packt.com
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1369.1">
     , which has the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1370.1">
      Admin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1371.1">
     role, I can see both the edit form and the most restricted
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1372.1">
      Shut down the app
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1373.1">
     button.
    </span>
    <span class="koboSpan" id="kobo.1373.2">
     But the moment I change to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1374.1">
      support@packt.com
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1375.1">
     , the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1376.1">
      Shut down the app
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1377.1">
     button is gone!
    </span>
    <span class="koboSpan" id="kobo.1377.2">
     I encourage you to
    </span>
    <a id="_idIndexMarker426">
    </a>
    <span class="koboSpan" id="kobo.1378.1">
     check how the UI changes when you log in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1379.1">
      as
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1380.1">
       user@packt.com
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1381.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-304">
    <a id="_idTextAnchor304">
    </a>
    <span class="koboSpan" id="kobo.1382.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1383.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1384.1">
      Authorize
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1385.1">
     attribute supports the same authorization APIs that
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1386.1">
      AuthorizeView
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1387.1">
     does.
    </span>
    <span class="koboSpan" id="kobo.1387.2">
     Both can use
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1388.1">
      Roles
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1389.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1390.1">
      Policy
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1391.1">
     to verify the user’s identity against specific criteria.
    </span>
    <span class="koboSpan" id="kobo.1391.2">
     You can even use both
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1392.1">
      Roles
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1393.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1394.1">
      Policy
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1395.1">
     at the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1396.1">
      same time!
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1397.1">
@attribute [Authorize(Roles = "User,Support,Admin")]
&lt;h3&gt;Settings&lt;/h3&gt;
&lt;AuthorizeView Context="user" Policy="InternalEmployee"&gt;
    @* here's still the existing EditForm *@
&lt;/AuthorizeView&gt;
&lt;AuthorizeView Policy="InternalEmployee" Roles="Admin"&gt;
    &lt;p&gt;&lt;button&gt;Shutdown the app&lt;/button&gt;&lt;/p&gt;
&lt;/AuthorizeView&gt;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1398.1">
     With the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1399.1">
      Authorize
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1400.1">
     attribute, we now verify whether the logged-in user has any of the three allowed roles:
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1401.1">
      User
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1402.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1403.1">
      Support
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1404.1">
     , or
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1405.1">
      Admin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1406.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1406.2">
     Additionally, we’ve updated the rendering of the user details edit form.
    </span>
    <span class="koboSpan" id="kobo.1406.3">
     Now,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1407.1">
      AuthorizeView
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1408.1">
     displays the form to anyone meeting the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1409.1">
      InternalEmployee
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1410.1">
     policy and having any of the available roles.
    </span>
    <span class="koboSpan" id="kobo.1410.2">
     We’ve also updated the restrictions on the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1411.1">
      Shut down the app
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1412.1">
     button – the user has to have the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1413.1">
      Admin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1414.1">
     role and belong to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1415.1">
      @packt.com
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1416.1">
     domain, enforced by the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1417.1">
       InternalEmployee
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1418.1">
      policy.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1419.1">
     The parameters of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1420.1">
      Authorize
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1421.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1422.1">
      AuthorizeView
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1423.1">
     work similarly but are applied at different levels.
    </span>
    <span class="koboSpan" id="kobo.1423.2">
     The question remains when to use the attribute and when the component suits best.
    </span>
    <span class="koboSpan" id="kobo.1423.3">
     Use
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1424.1">
      Authorize
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1425.1">
     when protecting navigation to a given resource or page, ensuring that only authorized users can access it.
    </span>
    <span class="koboSpan" id="kobo.1425.2">
     On the other hand, use
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1426.1">
      AuthorizeView
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1427.1">
     when you need to restrict access to certain areas of the markup without affecting the overall routing.
    </span>
    <span class="koboSpan" id="kobo.1427.2">
     This approach provides a comprehensive way to secure your Blazor
    </span>
    <a id="_idIndexMarker427">
    </a>
    <span class="koboSpan" id="kobo.1428.1">
     application, ensuring that only authorized users can access specific features
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1429.1">
      and content.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-305">
    <a id="_idTextAnchor305">
    </a>
    <span class="koboSpan" id="kobo.1430.1">
     Resolving authentication state in procedural logic
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1431.1">
     Incorporating authentication and authorization into the procedural logic of your application is often necessary.
    </span>
    <span class="koboSpan" id="kobo.1431.2">
     Simply manipulating markup visibility may not suffice in these scenarios; you need to
    </span>
    <a id="_idIndexMarker428">
    </a>
    <span class="koboSpan" id="kobo.1432.1">
     resolve the current
    </span>
    <a id="_idIndexMarker429">
    </a>
    <span class="koboSpan" id="kobo.1433.1">
     authentication state to make informed decisions within your code.
    </span>
    <span class="koboSpan" id="kobo.1433.2">
     That’s where a cascading
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1434.1">
      AuthenticationState
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1435.1">
     class comes in.
    </span>
    <span class="koboSpan" id="kobo.1435.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1436.1">
      AuthenticationState
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1437.1">
     class is a built-in Blazor feature that provides information about the user’s authentication status
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1438.1">
      and claims.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1439.1">
     Let’s add a button that redirects internal employees to different areas of a ticketing system based on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1440.1">
      their roles.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-306">
    <a id="_idTextAnchor306">
    </a>
    <span class="koboSpan" id="kobo.1441.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1442.1">
     Before we leverage authentication state in procedural logic, do
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1443.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1444.1">
      In the server-side project, create a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1445.1">
       Components
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1446.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1447.1">
       Recipes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1448.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1449.1">
       Recipe07
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1450.1">
      directory – this will be your
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1451.1">
       working directory
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1452.1">
      Copy the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1453.1">
       FakePages
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1454.1">
      directory from the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1455.1">
       Components
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1456.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1457.1">
       Recipes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1458.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1459.1">
       Recipe07
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1460.1">
      directory in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1461.1">
       GitHub repository
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1462.1">
      If you haven’t run migrations yet, find the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1463.1">
       seed-work.sql
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1464.1">
      script in the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1465.1">
       Samples
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1466.1">
      directory of the server-side project and run it on
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1467.1">
       your database
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1468.1">
      As we will need to enable interactivity, we can’t use any of the existing
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1469.1">
       Settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1470.1">
      components
     </span>
     <a id="_idIndexMarker430">
     </a>
     <span class="koboSpan" id="kobo.1471.1">
      anymore, so we will create a totally
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1472.1">
       new one
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.1473.1">
     How to do it…
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1474.1">
     Follow these instructions
    </span>
    <a id="_idIndexMarker431">
    </a>
    <span class="koboSpan" id="kobo.1475.1">
     to leverage authentication state in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1476.1">
      procedural logic:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1477.1">
      Create a new routable
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1478.1">
       Settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1479.1">
      component with server-side interactivity and an injected
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1480.1">
        Navigation
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1481.1">
       service:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1482.1">
@page "/ch08r07"
@rendermode InteractiveServer
@inject NavigationManager Navigation</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1483.1">
      Add a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1484.1">
       @code
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1485.1">
      block to intercept the cascading
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1486.1">
       authentication state:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1487.1">
@code {
    [CascadingParameter]
    private Task&lt;AuthenticationState&gt; AuthState
    {
        get; set;
    }
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1488.1">
      Below the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1489.1">
       AuthState
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1490.1">
      parameter, initialize a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1491.1">
       GoToTicketsAsync()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1492.1">
      method and resolve the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1493.1">
        user
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1494.1">
       context:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1495.1">
private async Task GoToTicketsAsync()
{
    var user = (await AuthState).User;
    //we will continue building logic here
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1496.1">
      Below the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1497.1">
       user
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1498.1">
      context, check
     </span>
     <a id="_idIndexMarker432">
     </a>
     <span class="koboSpan" id="kobo.1499.1">
      if the user’s
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1500.1">
       Identity
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1501.1">
      property has a value and redirect to
     </span>
     <a id="_idIndexMarker433">
     </a>
     <span class="koboSpan" id="kobo.1502.1">
      the login page if
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1503.1">
       it’s missing:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1504.1">
if (user.Identity is null)
{
    Navigation.NavigateTo("/Account/Login");
    return;
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1505.1">
      Below the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1506.1">
       Identity
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1507.1">
      verification, check if the user is correctly authenticated and redirect to the login page
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1508.1">
       if not:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1509.1">
if (!user.Identity.IsAuthenticated)
{
    Navigation.NavigateTo("/Account/Login");
    return;
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1510.1">
      After authentication verification, check if the value of the user’s
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1511.1">
       Name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1512.1">
      property belongs to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1513.1">
       @packt.com
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1514.1">
      domain and, if not, redirect them to the landing page of the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1515.1">
       ticketing system:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1516.1">
if (!user.Identity.Name.EndsWith("@packt.com"))
{
    Navigation.NavigateTo("/tickets");
    return;
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1517.1">
      After the user’s domain
     </span>
     <a id="_idIndexMarker434">
     </a>
     <span class="koboSpan" id="kobo.1518.1">
      check, check if the user is in the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1519.1">
       Support
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1520.1">
      or
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1521.1">
       Admin
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1522.1">
      role and redirect
     </span>
     <a id="_idIndexMarker435">
     </a>
     <span class="koboSpan" id="kobo.1523.1">
      them to the admin panel of the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1524.1">
       ticketing system:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1525.1">
if (user.IsInRole("Support") ||
    user.IsInRole("Admin"))
{
    Navigation.NavigateTo("/tickets/admin");
    return;
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1526.1">
      Lastly, if the user’s identity doesn’t fit any of the handled cases, redirect them to the access
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1527.1">
       denied page:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1528.1">
Navigation.NavigateTo("/tickets/denied");</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1529.1">
      Jump to the markup of the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1530.1">
       Settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1531.1">
      component and add a button to navigate to the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1532.1">
       ticketing system:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1533.1">
&lt;p&gt;
    &lt;button @onclick=@GoToTicketsAsync&gt;
        Support tickets
    &lt;/button&gt;
&lt;/p&gt;</span></pre>
    </li>
   </ol>
   <h2 id="_idParaDest-307">
    <a id="_idTextAnchor307">
    </a>
    <span class="koboSpan" id="kobo.1534.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1535.1">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1536.1">
      step 1
     </span>
    </em>
    <span class="koboSpan" id="kobo.1537.1">
     , we create a new routable
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1538.1">
      Settings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1539.1">
     component, rendering in an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1540.1">
      InteractiveServer
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1541.1">
     mode as we want our users to navigate to the ticketing system with a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1542.1">
      button click.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1543.1">
     If you follow along the entire chapter
    </span>
    <a id="_idIndexMarker436">
    </a>
    <span class="koboSpan" id="kobo.1544.1">
     or have scaffolded your project, you will already have a cascading
    </span>
    <a id="_idIndexMarker437">
    </a>
    <span class="koboSpan" id="kobo.1545.1">
     authentication state registered.
    </span>
    <span class="koboSpan" id="kobo.1545.2">
     But to give you a comprehensive overview, in both server- and client-side projects, in their
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1546.1">
      Program.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1547.1">
     files, you will find (or add, if it’s missing) the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1548.1">
      builder.Services.AddCascadingAuthenticationState()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1549.1">
     command that explicitly enables cascading authentication state in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1550.1">
      your application.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1551.1">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1552.1">
      step 2
     </span>
    </em>
    <span class="koboSpan" id="kobo.1553.1">
     , we initialize the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1554.1">
      @code
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1555.1">
     block in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1556.1">
      Settings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1557.1">
     component.
    </span>
    <span class="koboSpan" id="kobo.1557.2">
     Firstly, we intercept the authentication state.
    </span>
    <span class="koboSpan" id="kobo.1557.3">
     Blazor shares
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1558.1">
      AuthenticationState
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1559.1">
     as a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1560.1">
      Task
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1561.1">
     parameter – in line with modern web development, where all operations are inherently asynchronous and as the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1562.1">
      AuthenticationStateProvider
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1563.1">
     implementation might contain asynchronous logic constructing the authentication state.
    </span>
    <span class="koboSpan" id="kobo.1563.2">
     We also inject a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1564.1">
      NavigationManager
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1565.1">
     service to help us redirect the user to the intended destination.
    </span>
    <span class="koboSpan" id="kobo.1565.2">
     For the next couple of steps, still inside the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1566.1">
      @code
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1567.1">
     block, we implement a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1568.1">
      GoToTicketsAsync()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1569.1">
     method to resolve the redirection destination based on the user’s identity context.
    </span>
    <span class="koboSpan" id="kobo.1569.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1570.1">
      step 3
     </span>
    </em>
    <span class="koboSpan" id="kobo.1571.1">
     , we resolve the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1572.1">
      user
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1573.1">
     object by awaiting
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1574.1">
      AuthState
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1575.1">
     and grabbing the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1576.1">
      User
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1577.1">
     property from the result.
    </span>
    <span class="koboSpan" id="kobo.1577.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1578.1">
      step 4
     </span>
    </em>
    <span class="koboSpan" id="kobo.1579.1">
     , we check if the current user has an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1580.1">
      Identity
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1581.1">
     value set, which can be
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1582.1">
      null
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1583.1">
     if the user hasn’t logged in yet.
    </span>
    <span class="koboSpan" id="kobo.1583.2">
     If the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1584.1">
      Identity
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1585.1">
     value is missing, we immediately redirect the user to the login page.
    </span>
    <span class="koboSpan" id="kobo.1585.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1586.1">
      step 5
     </span>
    </em>
    <span class="koboSpan" id="kobo.1587.1">
     , we perform an additional check on the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1588.1">
      Identity
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1589.1">
     value using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1590.1">
      IsAuthenticated
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1591.1">
     property to verify if the user is logged in and correctly authenticated.
    </span>
    <span class="koboSpan" id="kobo.1591.2">
     If that check fails, we redirect the user to the login page to revalidate their authentication state.
    </span>
    <span class="koboSpan" id="kobo.1591.3">
     Now that we are sure the current user has a valid identity, in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1592.1">
      step 6
     </span>
    </em>
    <span class="koboSpan" id="kobo.1593.1">
     , we check if the user is actually an internal employee.
    </span>
    <span class="koboSpan" id="kobo.1593.2">
     We leverage the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1594.1">
      Name
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1595.1">
     property of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1596.1">
      user
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1597.1">
     object, representing the user’s login in the application.
    </span>
    <span class="koboSpan" id="kobo.1597.2">
     As, in our case, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1598.1">
      Name
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1599.1">
     property is equivalent to the user’s email, we verify if the user account of the current user we check belongs to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1600.1">
      @packt.com
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1601.1">
     domain.
    </span>
    <span class="koboSpan" id="kobo.1601.2">
     If that check fails, we redirect the user to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1602.1">
      /tickets
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1603.1">
     page, where they can create new support tickets as standard application users.
    </span>
    <span class="koboSpan" id="kobo.1603.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1604.1">
      step 7
     </span>
    </em>
    <span class="koboSpan" id="kobo.1605.1">
     , knowing that an internal employee is using the application, we check if they have an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1606.1">
      Admin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1607.1">
     or
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1608.1">
      Support
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1609.1">
     role.
    </span>
    <span class="koboSpan" id="kobo.1609.2">
     If they do, we redirect them to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1610.1">
      /tickets/admin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1611.1">
     page, where they can access the admin panel of the ticketing system.
    </span>
    <span class="koboSpan" id="kobo.1611.2">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1612.1">
      step 8
     </span>
    </em>
    <span class="koboSpan" id="kobo.1613.1">
     , we close the implementation of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1614.1">
      GoToTicketsAsync()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1615.1">
     method.
    </span>
    <span class="koboSpan" id="kobo.1615.2">
     When all the previous authentication and authorization checks fail, we assume the user’s account is incomplete and redirect them to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1616.1">
      /tickets/denied
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1617.1">
     page, indicating they can’t access the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1618.1">
      ticketing system.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1619.1">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1620.1">
      step 9
     </span>
    </em>
    <span class="koboSpan" id="kobo.1621.1">
     , we extend the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1622.1">
      Settings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1623.1">
     component
    </span>
    <a id="_idIndexMarker438">
    </a>
    <span class="koboSpan" id="kobo.1624.1">
     markup.
    </span>
    <span class="koboSpan" id="kobo.1624.2">
     Below the existing
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1625.1">
      h3
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1626.1">
     header, we add a paragraph
    </span>
    <a id="_idIndexMarker439">
    </a>
    <span class="koboSpan" id="kobo.1627.1">
     with a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1628.1">
      button
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1629.1">
     property that invokes the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1630.1">
      GoToTicketsAsync()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1631.1">
     method upon click, allowing the user to navigate to the ticketing system.
    </span>
    <span class="koboSpan" id="kobo.1631.2">
     Effective redirection depends on the result of the procedural logic we added and the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1632.1">
      user’s identity.
     </span>
    </span>
   </p>
  </div>
 </body></html>