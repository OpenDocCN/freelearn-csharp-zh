<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Building a Scrollable Viewport"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Building a Scrollable Viewport</h1></div></div></div><p>In this chapter, we will create a new scene and build a functional scrollable viewport in which we can drop objects that will stick to it. We will add interesting features such as scroll bars and keyboard scrolling with arrows.</p><p>This scrollable viewport<a id="id230" class="indexterm"/> will be the base of our game from the previous chapter. So, from here, the user will become the player. The idea is that the player can scroll and<a id="id231" class="indexterm"/> drag barriers on a viewport, which will take a few seconds to build. Enemies will come down from the top of the screen. If an enemy touches a barrier, he or she will be destroyed along with the barrier—but we will deal with enemies in <a class="link" href="ch07.html" title="Chapter 7. Creating a Game with NGUI">Chapter 7</a>, <span class="emphasis"><em>Creating a Game with NGUI.</em></span>
</p><p>The more barriers there are on the scene, the longer the building process will be for the future barriers— this is the same idea with the barriers' cooldown.</p><div class="section" title="Preparing the Game scene"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec37"/>Preparing the Game scene</h1></div></div></div><p>We will <a id="id232" class="indexterm"/>need to have our <span class="strong"><strong>GameManager</strong></span> and <span class="strong"><strong>Notification</strong></span> GameObjects as prefabs for this chapter.</p><p>From our <span class="strong"><strong>Menu</strong></span> scene, create these two prefabs by dragging them separately in the folder of your choice in the <span class="strong"><strong>Project</strong></span> view.</p><p>Now, let's create a new scene with <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>N</em></span> and perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Press <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>S</em></span> to save it, and enter <code class="literal">Game</code> as the scene's name.</li><li class="listitem">In our new scene, delete the <span class="strong"><strong>Main Camera</strong></span> GameObject. We won't need it for this scene.</li><li class="listitem">Drag our <span class="strong"><strong>GameManager</strong></span> prefab from the <span class="strong"><strong>Project</strong></span> view into the <span class="strong"><strong>Hierarchy</strong></span> view.</li><li class="listitem">Open the <span class="strong"><strong>UI Tool</strong></span> wizard by navigating to <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Create a New UI</strong></span>.</li><li class="listitem">Add a new <span class="strong"><strong>Layer</strong></span> named <code class="literal">Game</code>.</li><li class="listitem">Select this <span class="strong"><strong>Game</strong></span> layer for the <span class="strong"><strong>Layer</strong></span> parameter in our <span class="strong"><strong>UI Tool</strong></span> wizard.</li><li class="listitem">Click on the <span class="strong"><strong>Create Your UI</strong></span> button.</li><li class="listitem">Select our new <span class="strong"><strong>Camera</strong></span> GameObject, and set its <span class="strong"><strong>Background Color</strong></span> to <span class="strong"><strong>R</strong></span>: <code class="literal">0</code>, <span class="strong"><strong>G</strong></span>: <code class="literal">0</code>, <span class="strong"><strong>B</strong></span>: <code class="literal">0</code>, and <span class="strong"><strong>A</strong></span>: <code class="literal">255</code>.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note18"/>Note</h3><p>Make sure your <span class="strong"><strong>Color</strong></span> selector popup is in the <span class="strong"><strong>RGBA</strong></span> values and not <span class="strong"><strong>HSVA</strong></span>. This can be done by using the button next to the <span class="strong"><strong>Sliders</strong></span> option when you click on a <span class="strong"><strong>Color</strong></span> parameter.</p></div></div></li><li class="listitem">Select our <span class="strong"><strong>UI Root (2D)</strong></span> GameObject and then perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Set its <span class="strong"><strong>Scaling Style</strong></span> parameter to <span class="strong"><strong>FixedSize</strong></span>.</li><li class="listitem">Set its <span class="strong"><strong>Manual Height</strong></span> to <code class="literal">1080</code>.</li></ol></div></li></ol></div><p>Ok,<a id="id233" class="indexterm"/> our scene and UI are ready. Your <span class="strong"><strong>UI Root (2D)</strong></span> script should be as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/8667OT_05_01.jpg" alt="Preparing the Game scene"/></div><p>Let's start creating our scrollable viewport.</p></div></div>
<div class="section" title="The scrollable viewport"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec38"/>The scrollable viewport</h1></div></div></div><p>We will<a id="id234" class="indexterm"/> start by creating a clipped, draggable background, and then add linked scroll bars as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/8667OT_05_02.jpg" alt="The scrollable viewport"/></div><div class="section" title="Draggable background"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec50"/>Draggable background</h2></div></div></div><p>We <a id="id235" class="indexterm"/>want the player to be able to scroll on both axes. That means we need a background both larger and taller than the screen size. For this game, we will need quite a large environment to force him or her to scroll regularly. Let's create one that is twice the screen's size.</p><p>Perform the following steps to create the environment:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select our <span class="strong"><strong>Panel</strong></span> GameObject and perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Rename it as <code class="literal">Viewport</code>.</li><li class="listitem">Set its <span class="strong"><strong>Clipping</strong></span> parameter to <span class="strong"><strong>Alpha Clip</strong></span>.</li><li class="listitem">Set its <span class="strong"><strong>Clipping</strong></span> <span class="strong"><strong>Size</strong></span> to <code class="literal">1920</code> x <code class="literal">1080</code>.</li></ol></div></li><li class="listitem">Add a <span class="strong"><strong>Draggable Panel</strong></span> component to it by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Interaction</strong></span> and perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Set its <span class="strong"><strong>Drag Effect</strong></span> parameter to <span class="strong"><strong>Momentum</strong></span>. We don't want the player to scroll out of bounds with the spring effect.</li><li class="listitem">Set its <span class="strong"><strong>Momentum Amount</strong></span> value to <code class="literal">10</code>. Over 10, the background will continue scrolling too much on release.</li><li class="listitem">Set its <span class="strong"><strong>Scale</strong></span> parameter to {<code class="literal">1</code>, <code class="literal">1</code>, <code class="literal">0</code>} to enable X and Y scrolling.</li></ol></div></li><li class="listitem">Attach a <span class="strong"><strong>Drag Panel Contents</strong></span> component to it by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Interaction</strong></span>.</li><li class="listitem">Attach a collider to it by navigating to <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Attach a Collider</strong></span>, and set its <span class="strong"><strong>Size</strong></span> to {<code class="literal">3840</code>, <code class="literal">2160</code>, <code class="literal">1</code>}.</li></ol></div><p>Now that <a id="id236" class="indexterm"/>our <span class="strong"><strong>Draggable Panel</strong></span> is set up, let's add a tiling background as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/8667OT_05_03.jpg" alt="Draggable background"/></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <span class="strong"><strong>Widget Tool</strong></span> wizard by navigating to <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Create a Widget</strong></span>. Then perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">If the <span class="strong"><strong>Atlas</strong></span> field is set to <span class="strong"><strong>None</strong></span>, drag the <span class="strong"><strong>SciFi Atlas</strong></span> prefab in it by navigating to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Examples</strong></span> | <span class="strong"><strong>Atlases</strong></span>.</li><li class="listitem">Select the <span class="strong"><strong>Sprite</strong></span> template.</li><li class="listitem">Select the <span class="strong"><strong>Honeycomb</strong></span> sprite.</li><li class="listitem">With our <span class="strong"><strong>Viewport</strong></span> selected; click on the <span class="strong"><strong>Add To</strong></span> button.</li></ol></div></li><li class="listitem">Select the new <span class="strong"><strong>Sprite (Honeycomb)</strong></span> GameObject and then perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Rename it as <code class="literal">Background</code>.</li><li class="listitem">Set its <span class="strong"><strong>Sprite Type</strong></span> to <span class="strong"><strong>Tiled</strong></span>.</li><li class="listitem">Set its <span class="strong"><strong>Color Tint</strong></span> value to {<code class="literal">0</code>, <code class="literal">40</code>, <code class="literal">40</code>, <code class="literal">255</code>}.</li><li class="listitem">Set its <span class="strong"><strong>Depth</strong></span> value to <code class="literal">0</code>.</li><li class="listitem">Set its <span class="strong"><strong>Dimensions</strong></span> to <code class="literal">3840</code> x <code class="literal">2160</code>.</li></ol></div></li></ol></div><p>Click on the play button. That's it, we now have a scrollable viewport. You can drag the background by dragging your mouse while clicking.</p></div><div class="section" title="Linking scroll bars"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec51"/>Linking scroll bars</h2></div></div></div><p>Let's <a id="id237" class="indexterm"/>add scroll bars to know where we are on the viewport. They must be on a separate panel rendered over our viewport, so that they won't move with the draggable background. Perform the following steps to add the scroll bars:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select our <span class="strong"><strong>Anchor</strong></span> GameObject.</li><li class="listitem">Create a new child with <span class="emphasis"><em>Alt</em></span> + <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>N</em></span> and rename it as <code class="literal">UI</code>.</li><li class="listitem">Add a <span class="strong"><strong>Panel</strong></span> component to it by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>UI</strong></span>, and set its <span class="strong"><strong>Depth</strong></span> to <code class="literal">1</code> so that it can be displayed over the viewport.</li><li class="listitem">Open the <span class="strong"><strong>Widget tool</strong></span> wizard by navigating to <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Create a Widget</strong></span>. Then perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select <span class="strong"><strong>Scrollbar</strong></span> for the <span class="strong"><strong>Template</strong></span> field.</li><li class="listitem">Select <span class="strong"><strong>Dark</strong></span> sprite as <span class="strong"><strong>Background</strong></span>.</li><li class="listitem">Select <span class="strong"><strong>Highlight</strong></span> sprite as <span class="strong"><strong>Foreground</strong></span>.</li><li class="listitem">Select <span class="strong"><strong>Horizontal</strong></span> for <span class="strong"><strong>Direction</strong></span>.</li><li class="listitem">With our <span class="strong"><strong>UI</strong></span> GameObject selected, click on the <span class="strong"><strong>Add To</strong></span> button.</li></ol></div></li><li class="listitem">On our <span class="strong"><strong>Widget Tool</strong></span> wizard window, select <span class="strong"><strong>Vertical</strong></span> for <span class="strong"><strong>Direction</strong></span>. With our <span class="strong"><strong>UI</strong></span> GameObject selected, click on the <span class="strong"><strong>Add To</strong></span> button.<p>We have created both our horizontal and vertical scroll bars at the center of the scene as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/8667OT_05_04.jpg" alt="Linking scroll bars"/></div><p>Now, we need to place them correctly and adjust their size to fit the entire screen.</p></li><li class="listitem">Select<a id="id238" class="indexterm"/> the vertical <span class="strong"><strong>Scroll Bar</strong></span> GameObject and rename it as <code class="literal">VerticalScrollbar</code>.</li><li class="listitem">Attach an <span class="strong"><strong>Anchor</strong></span> component to it by navigating to <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Attach</strong></span> and perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Drag our <span class="strong"><strong>Viewport</strong></span> GameObject in the <span class="strong"><strong>Container</strong></span> field.</li><li class="listitem">Set its <span class="strong"><strong>Side</strong></span> parameter to <span class="strong"><strong>TopRight</strong></span>.</li><li class="listitem">Set its <span class="strong"><strong>Pixel Offset</strong></span> to {<code class="literal">-11</code>, <code class="literal">0</code>}.</li></ol></div></li><li class="listitem">Select our <span class="strong"><strong>Background</strong></span> GameObject from <span class="strong"><strong>VerticalScrollbar</strong></span>. Then perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Set its <span class="strong"><strong>Color Tint</strong></span> to {<code class="literal">130</code>, <code class="literal">255</code>, <code class="literal">245</code>, <code class="literal">110</code>}.</li><li class="listitem">Set the <span class="strong"><strong>Center</strong></span> coordinates of <span class="strong"><strong>Box Collider</strong></span> to {<code class="literal">0</code>, <code class="literal">-540</code>, <code class="literal">0</code>}.</li><li class="listitem">Set the <span class="strong"><strong>Size</strong></span> of <span class="strong"><strong>Box Collider</strong></span> to {<code class="literal">22</code>, <code class="literal">1080</code>, <code class="literal">0</code>}.</li></ol></div></li><li class="listitem">Attach a <span class="strong"><strong>Stretch</strong></span> component to it by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>UI</strong></span>.<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Set its <span class="strong"><strong>Style</strong></span> parameter to <span class="strong"><strong>Vertical</strong></span>.</li><li class="listitem">Set its <span class="strong"><strong>Relative Size</strong></span> values to {<code class="literal">1</code>, <code class="literal">0.983</code>} in order to leave space for our horizontal scroll bar at the bottom of the screen.</li></ol></div></li><li class="listitem">Select the <span class="strong"><strong>Foreground</strong></span> GameObject from <span class="strong"><strong>VerticalScrollbar</strong></span>, and set its <span class="strong"><strong>Color Tint</strong></span> to {<code class="literal">0</code>, <code class="literal">255</code>, <code class="literal">128</code>, <code class="literal">255</code>}.<p>Our vertical scroll bar is configured. Let's do the same for the horizontal scroll bar.</p></li><li class="listitem">Select the horizontal <span class="strong"><strong>Scroll Bar</strong></span> GameObject, and rename it as <code class="literal">HorizontalScrollbar</code>.</li><li class="listitem">Attach an <span class="strong"><strong>Anchor</strong></span> component to it by navigating to <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Attach</strong></span>. Then perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Drag our <span class="strong"><strong>Viewport</strong></span> GameObject into the <span class="strong"><strong>Container</strong></span> field.</li><li class="listitem">Set its <span class="strong"><strong>Side</strong></span> parameter to <span class="strong"><strong>BottomLeft</strong></span>.</li><li class="listitem">Set its <span class="strong"><strong>Pixel Offset</strong></span> to {<code class="literal">0</code>, <code class="literal">11</code>}.</li></ol></div></li><li class="listitem">Select our <span class="strong"><strong>Background</strong></span> GameObject from <span class="strong"><strong>HorizontalScrollbar</strong></span> and perform these steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Set its <span class="strong"><strong>Color Tint</strong></span> to {<code class="literal">130</code>, <code class="literal">255</code>, <code class="literal">245</code>, <code class="literal">110</code>}.</li><li class="listitem">Set the <span class="strong"><strong>Center</strong></span> coordinates of <span class="strong"><strong>Box Collider</strong></span> to {<code class="literal">960</code>, <code class="literal">0</code>, <code class="literal">0</code>}.</li><li class="listitem">Set the <span class="strong"><strong>Size</strong></span> of <span class="strong"><strong>Box Collider</strong></span> to {<code class="literal">1920</code>, <code class="literal">22</code>, <code class="literal">0</code>}.</li></ol></div></li><li class="listitem">Attach a <span class="strong"><strong>Stretch</strong></span> component to it by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>UI</strong></span>, and set its <span class="strong"><strong>Style</strong></span> parameter to <span class="strong"><strong>Horizontal</strong></span>.</li><li class="listitem">Select the <span class="strong"><strong>Foreground</strong></span> GameObject from <span class="strong"><strong>HorizontalScrollbar</strong></span>, and set its <span class="strong"><strong>Color Tint</strong></span> to {<code class="literal">0</code>, <code class="literal">255</code>, <code class="literal">128</code>, <code class="literal">255</code>}.</li></ol></div><p>Good. Both<a id="id239" class="indexterm"/> our horizontal and vertical scroll bars are set up. Now, we need to assign them to our scrollable viewport by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select our <span class="strong"><strong>Viewport</strong></span> GameObject.</li><li class="listitem">Drag our <span class="strong"><strong>HorizontalScrollbar</strong></span> GameObject from <span class="strong"><strong>UI</strong></span> to the <span class="strong"><strong>Horizontal Scroll Bar</strong></span> field in <span class="strong"><strong>UIDraggable Panel</strong></span>.</li><li class="listitem">Drag our <span class="strong"><strong>VerticalScrollbar</strong></span> GameObject from <span class="strong"><strong>UI</strong></span> to the <span class="strong"><strong>Vertical Scroll Bar</strong></span> field in <span class="strong"><strong>UIDraggable Panel</strong></span>.</li><li class="listitem">Change the <span class="strong"><strong>Show Scroll Bars</strong></span> parameter to <span class="strong"><strong>Always</strong></span>.</li></ol></div><p>Click on the play button. That's it. Our scroll bars can be used to scroll, and they indicate where we are on the viewport as we scroll. Your hierarchy should be as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/8667OT_05_05.jpg" alt="Linking scroll bars"/></div><p>Now, let's add keyboard scrolling.</p></div><div class="section" title="Keyboard scrolling"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec52"/>Keyboard scrolling</h2></div></div></div><p>For this<a id="id240" class="indexterm"/> game, scrolling with the keyboard is important. In order to do so, we will create a custom script that will force our scroll bars to move depending on the pressed key. Select our <span class="strong"><strong>Viewport</strong></span> GameObject, and attach a new <code class="literal">KeyboardScroll.cs</code> script to it. Open this new script, and declare the required variables and the <code class="literal">Awake()</code> method:</p><div class="informalexample"><pre class="programlisting">//We need the Scrollbars for keyboard scroll
UIScrollBar hScrollbar;
UIScrollBar vScrollbar;
public float keyboardSensitivity = 1;

void Awake()
{
  //Assign both scrollbars on Awake
  hScrollbar = GetComponent&lt;UIDraggablePanel&gt;().horizontalScrollBar;
  vScrollbar = GetComponent&lt;UIDraggablePanel&gt;().verticalScrollBar;
}</pre></div><p>Okay, we <a id="id241" class="indexterm"/>have both of our scroll bars on <code class="literal">Awake()</code>, and a float value for sensitivity.</p><p>Now, let's check the horizontal and vertical input axes at each frame, and change our scroll bars' values consequently:</p><div class="informalexample"><pre class="programlisting">void Update()
{
  //Get keyboard input axes values
  Vector2 keyDelta = Vector2.zero;
  keyDelta.Set(Input.GetAxis("Horizontal"), Input.GetAxis("Vertical"));
  //If no keyboard arrow is pressed, leave
  if(keyDelta == Vector2.zero) return;
  //Make it framerate independent and multiply by sensitivity
  keyDelta *= Time.deltaTime * keyboardSensitivity;
  //Scroll by adjusting scrollbars' values
  hScrollbar.value += keyDelta.x;
  vScrollbar.value -= keyDelta.y;
}</pre></div><p>Save the script and click on the play button. You can now scroll using the keyboard arrows. You may also adjust the <span class="strong"><strong>Sensitivity</strong></span> parameter in the <span class="strong"><strong>Inspector</strong></span> window as you see fit.</p><p>Now, it's time to create draggable barriers that we can drop inside our <span class="strong"><strong>Viewport</strong></span> GameObject.</p></div></div>
<div class="section" title="Creating draggable barriers"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec39"/>Creating draggable barriers</h1></div></div></div><p>It is time to create our <a id="id242" class="indexterm"/>draggable barriers. The player will be able to drag-and-drop the <span class="strong"><strong>BarrierObject</strong></span> prefab in the <span class="strong"><strong>Viewport</strong></span> GameObject. This <span class="strong"><strong>BarrierObject</strong></span> prefab will look as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/8667OT_05_06.jpg" alt="Creating draggable barriers"/></div><div class="section" title="The BarrierObject prefab"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec53"/>The BarrierObject prefab</h2></div></div></div><p>First, we need<a id="id243" class="indexterm"/> to create our <span class="strong"><strong>BarrierObject</strong></span> prefab's holder that will contain the draggable object:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select our <span class="strong"><strong>UI</strong></span> GameObject.</li><li class="listitem">Create a new child with <span class="emphasis"><em>Alt</em></span> + <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>N</em></span> and rename it as <code class="literal">Barrier</code>.</li><li class="listitem">Open the <span class="strong"><strong>Widget Tool</strong></span> wizard by navigating to <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Open</strong></span> and perform the given steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select <span class="strong"><strong>Sprite</strong></span> for the <span class="strong"><strong>Template</strong></span> parameter.</li><li class="listitem">Select <span class="strong"><strong>Dark</strong></span> sprite for the <span class="strong"><strong>Sprite</strong></span> field.</li><li class="listitem">With our <span class="strong"><strong>Barrier</strong></span> GameObject selected, click on the <span class="strong"><strong>Add To</strong></span> button.</li></ol></div></li><li class="listitem">Select our new barrier's <span class="strong"><strong>Sprite (Dark)</strong></span> GameObject and perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Rename it as <code class="literal">Background</code>.</li><li class="listitem">Set its <span class="strong"><strong>Sprite Type</strong></span> to <span class="strong"><strong>Sliced</strong></span>.</li><li class="listitem">Set its <span class="strong"><strong>Color Tint</strong></span> to {<code class="literal">0</code>, <code class="literal">250</code>, <code class="literal">250</code>, <code class="literal">170</code>}.</li><li class="listitem">Set its <span class="strong"><strong>Depth</strong></span> value to <code class="literal">0</code>.</li><li class="listitem">Set its <span class="strong"><strong>Dimensions</strong></span> to <code class="literal">200</code> x <code class="literal">200</code>.</li></ol></div></li><li class="listitem">Select our <span class="strong"><strong>Barrier</strong></span> GameObject.</li><li class="listitem">Attach a collider to it by navigating to <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Attach a Collider</strong></span> and perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Set its <span class="strong"><strong>Center</strong></span> coordinates in <span class="strong"><strong>Box Collider</strong></span> to {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>}.</li><li class="listitem">Set the <span class="strong"><strong>Size</strong></span> parameter of <span class="strong"><strong>Box Collider</strong></span> to {<code class="literal">200</code>, <code class="literal">200</code>, <code class="literal">1</code>}.</li></ol></div></li><li class="listitem">Attach <span class="strong"><strong>Anchor</strong></span> to it by navigating to <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Attach</strong></span>.<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Drag our <span class="strong"><strong>Viewport</strong></span> GameObject in its <span class="strong"><strong>Container</strong></span> field.</li><li class="listitem">Set its <span class="strong"><strong>Side</strong></span> parameter to <span class="strong"><strong>TopLeft</strong></span>.</li><li class="listitem">Set its <span class="strong"><strong>Pixel Offset</strong></span> to {<code class="literal">100</code>, <code class="literal">-100</code>}.</li></ol></div></li></ol></div><p>Ok, we have our <span class="strong"><strong>BarrierObject</strong></span> holder's background at the top left-hand corner as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/8667OT_05_07.jpg" alt="The BarrierObject prefab"/></div><p>Let's create<a id="id244" class="indexterm"/> the actual <span class="strong"><strong>BarrierObject</strong></span> prefab, which will be a custom button:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select our <span class="strong"><strong>Barrier</strong></span> GameObject.</li><li class="listitem">Open the <span class="strong"><strong>Widget tool</strong></span> wizard by navigating to <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Create a Widget</strong></span> and perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Drag the <span class="strong"><strong>SciFi Font – Normal</strong></span> prefab into the <span class="strong"><strong>Widget Tool</strong></span> wizard's <span class="strong"><strong>Font</strong></span> field by navigating to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Examples</strong></span> | <span class="strong"><strong>Atlases</strong></span> | <span class="strong"><strong>SciFi</strong></span>.</li><li class="listitem">Select <span class="strong"><strong>Button</strong></span> for the <span class="strong"><strong>Template</strong></span> field.</li><li class="listitem">Select the <span class="strong"><strong>Highlight</strong></span> sprite for the <span class="strong"><strong>Background</strong></span> field.</li><li class="listitem">With our <span class="strong"><strong>Barrier</strong></span> GameObject selected, click on the <span class="strong"><strong>Add To</strong></span> button.</li></ol></div></li><li class="listitem">Select our new <span class="strong"><strong>Button</strong></span> GameObject from <span class="strong"><strong>Barrier</strong></span>.<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Rename it as <code class="literal">BarrierObject</code>.</li><li class="listitem">Set its <span class="strong"><strong>Center</strong></span> coordinates <span class="strong"><strong>Box Collider</strong></span> to {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>}.</li><li class="listitem">Set <span class="strong"><strong>Size</strong></span> of <span class="strong"><strong>Box Collider</strong></span> to {<code class="literal">160</code>, <code class="literal">160</code>, <code class="literal">0</code>}.</li></ol></div></li><li class="listitem">Drag the <span class="strong"><strong>Background</strong></span> GameObject from <span class="strong"><strong>BarrierObject</strong></span> into the <span class="strong"><strong>Target</strong></span> field in <span class="strong"><strong>UIButton</strong></span>. Then perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Set its <span class="strong"><strong>Normal Color</strong></span> to {<code class="literal">125</code>, <code class="literal">255</code>, <code class="literal">155</code>, <code class="literal">130</code>}.</li><li class="listitem">Set its <span class="strong"><strong>Hover Color</strong></span> to {<code class="literal">100</code>, <code class="literal">255</code>, <code class="literal">60</code>, <code class="literal">255</code>}.</li><li class="listitem">Set its <span class="strong"><strong>Pressed Color</strong></span> to {<code class="literal">20</code>, <code class="literal">255</code>, <code class="literal">0</code>, <code class="literal">160</code>}.</li><li class="listitem">Set its <span class="strong"><strong>Disabled Color</strong></span> to {<code class="literal">115</code>, <code class="literal">115</code>, <code class="literal">155</code>, <code class="literal">255</code>}.</li></ol></div></li><li class="listitem">Select the <span class="strong"><strong>Background</strong></span> GameObject from <span class="strong"><strong>BarrierObject</strong></span> and perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Set its <span class="strong"><strong>Depth</strong></span> value to <code class="literal">1</code>.</li><li class="listitem">Set its <span class="strong"><strong>Dimensions</strong></span> to <code class="literal">160</code> x <code class="literal">160</code>.</li></ol></div></li><li class="listitem">Select the <span class="strong"><strong>Label</strong></span> GameObject from <span class="strong"><strong>BarrierObject</strong></span> and then perform the given steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Set its text to <code class="literal">[99FF99]Barrier</code>.</li><li class="listitem">Set its <span class="strong"><strong>Depth</strong></span> to <code class="literal">2</code>.</li></ol></div></li></ol></div><p>Ok. We<a id="id245" class="indexterm"/> now have our <span class="strong"><strong>BarrierObject</strong></span> in the <span class="strong"><strong>Barrier</strong></span> holder. Let's make it draggable by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select our <span class="strong"><strong>BarrierObject</strong></span> GameObject.</li><li class="listitem">Attach a <span class="strong"><strong>Drag Object</strong></span> component to it by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Interaction</strong></span>.<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Drag our <span class="strong"><strong>BarrierObject</strong></span> GameObject in its <span class="strong"><strong>Target</strong></span> field.</li><li class="listitem">Set its <span class="strong"><strong>Scale</strong></span> parameter to {<code class="literal">1</code>, <code class="literal">1</code>, <code class="literal">0</code>} to avoid Z scrolling.</li><li class="listitem">Set its <span class="strong"><strong>Drag Effect</strong></span> parameter to <span class="strong"><strong>None</strong></span>. We want it to be precise.</li></ol></div></li><li class="listitem">Create and attach a new <code class="literal">BarrierObjectController.cs</code> C# script to it.</li></ol></div><p>Click on the play button. The <span class="strong"><strong>BarrierObject</strong></span> prefab is now draggable. Now, it is time to handle the drop on the <span class="strong"><strong>Viewport</strong></span> GameObject.</p><p>Before we continue, drag our <span class="strong"><strong>BarrierObject</strong></span> in a folder of your choice in the <span class="strong"><strong>Project</strong></span> view to make it a prefab.</p></div><div class="section" title="Dropping a barrier on Viewport"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec54"/>Dropping a barrier on Viewport</h2></div></div></div><p>In order to drop<a id="id246" class="indexterm"/> a barrier inside the <span class="strong"><strong>Viewport</strong></span> GameObject, we need to catch the <span class="strong"><strong>Viewport</strong></span> GameObject's <code class="literal">OnDrop()</code> event and check what was dropped:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select our <span class="strong"><strong>Viewport</strong></span> GameObject.</li><li class="listitem">Create and attach a new <code class="literal">ViewportHolder.cs</code> C# script to it.</li><li class="listitem">Open this new <code class="literal">ViewportHolder.cs</code> script.</li></ol></div><p>In this script, we can add a new <code class="literal">OnDrop()</code> method that will be called when an object is dropped on it:</p><div class="informalexample"><pre class="programlisting">void OnDrop(GameObject droppedObj)
{
  //Get the dropped object's BarrierObjectController
  BarrierObjectController barrierObj = droppedObj.GetComponent&lt;BarrierObjectController&gt;();

  //If it actually has one, destroy the droppedObj
  if(barrierObj != null){
    Destroy(droppedObj);
  }
}</pre></div><p>Save the<a id="id247" class="indexterm"/> script and click on the play button. Surprisingly, when you drop the <span class="strong"><strong>BarrierObject</strong></span> on the <span class="strong"><strong>Viewport</strong></span> GameObject, nothing happens!</p><p>That's because, like in <a class="link" href="ch03.html" title="Chapter 3. Enhancing your UI">Chapter 3</a>, <span class="emphasis"><em>Enhancing your UI</em></span>, the Collider of <span class="strong"><strong>BarrierObject</strong></span> is enabled when the <code class="literal">OnPress(false)</code> event occurs. This obstructs the collision detection of <span class="strong"><strong>UICamera</strong></span>.</p><p>We just have to disable the collider while dragging, and re-enable it when dropping it. Let's also make it reposition itself if it isn't dropped on the <span class="strong"><strong>Viewport</strong></span> GameObject. Open our <code class="literal">BarrierObjectController.cs</code> script, and add following <code class="literal">OnPress()</code> method to do so:</p><div class="informalexample"><pre class="programlisting">void OnPress(bool pressed)
{
  //Invert the Collider's state
  collider.enabled = !pressed;

  //If it has just been dropped
  if(!pressed)
  {
    //Get the target's collider
    Collider col = UICamera.lastHit.collider;
    //If the target has no collider or is not the viewport
    if(col == null || col.GetComponent&lt;ViewportHolder&gt;() == null)
    //Reset its localPosition to {0,0,0}
    transform.localPosition = Vector3.zero;
  }
}</pre></div><p>Save the script and click on the play button. This time, the collider is disabled when the <span class="strong"><strong>BarrierObject</strong></span> prefab is dropped. So, it is indeed dropped on the collider of <span class="strong"><strong>Viewport</strong></span> and destroyed instantly.</p><p>If it is dropped somewhere else (out of screen or on the barrier's container), it is automatically replaced at the center of the barrier's container. Let's make this <span class="strong"><strong>BarrierObject</strong></span> a prefab by dragging it in the folder of your choice inside the <span class="strong"><strong>Project</strong></span> view.</p><p>We can now create an <span class="strong"><strong>ActiveBarrier</strong></span> prefab that will be instantiated on the <span class="strong"><strong>Viewport</strong></span> GameObject.</p></div></div>
<div class="section" title="Creating an ActiveBarrier prefab"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec40"/>Creating an ActiveBarrier prefab</h1></div></div></div><p>When <a id="id248" class="indexterm"/>a <span class="strong"><strong>BarrierObject</strong></span> is dropped on the <span class="strong"><strong>Viewport</strong></span> GameObject, we want to instantiate an <span class="strong"><strong>ActiveBarrier</strong></span> prefab that will take a few seconds to build, using a slider as status indicator as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/8667OT_05_08.jpg" alt="Creating an ActiveBarrier prefab"/></div><div class="section" title="The ActiveBarrier prefab"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec55"/>The ActiveBarrier prefab</h2></div></div></div><p>Let's <a id="id249" class="indexterm"/>create the <span class="strong"><strong>ActiveBarrier</strong></span> prefab by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select our <span class="strong"><strong>Viewport</strong></span> GameObject.</li><li class="listitem">Create a new child with <span class="emphasis"><em>Alt</em></span> + <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>N</em></span>.</li><li class="listitem">Select this new child and rename it as <code class="literal">ActiveBarrier</code>.</li><li class="listitem">Open the <span class="strong"><strong>Widget Tool</strong></span> wizard by navigating to <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Create a Widget</strong></span> and perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select <span class="strong"><strong>Progress Bar</strong></span> for the <span class="strong"><strong>Template</strong></span> field.</li><li class="listitem">Set <span class="strong"><strong>Dark</strong></span> sprite as <span class="strong"><strong>Empty</strong></span>.</li><li class="listitem">Set the <span class="strong"><strong>Highlight</strong></span> sprite as <span class="strong"><strong>Full</strong></span>.</li><li class="listitem">With our <span class="strong"><strong>ActiveBarrier</strong></span> GameObject selected, click on the <span class="strong"><strong>Add To</strong></span> button.</li></ol></div><p>A <span class="strong"><strong>Progress Bar</strong></span> has just been created as child of the <span class="strong"><strong>ActiveBarrier</strong></span> GameObject as shown in the following screenshot:</p></li></ol></div><div class="mediaobject"><img src="graphics/8667OT_05_09.jpg" alt="The ActiveBarrier prefab"/></div><p>It doesn't look like anything. Let's configure it to look like an <span class="strong"><strong>ActiveBarrier</strong></span> prefab by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select <a id="id250" class="indexterm"/>our new <span class="strong"><strong>Background</strong></span> GameObject from <span class="strong"><strong>Progress Bar</strong></span> and perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Uncheck its <span class="strong"><strong>Fill Center</strong></span> boolean to only keep edges.</li><li class="listitem">Set its <span class="strong"><strong>Color Tint</strong></span> to {<code class="literal">100</code>, <code class="literal">200</code>, <code class="literal">100</code>, <code class="literal">255</code>}.</li><li class="listitem">Set its <span class="strong"><strong>Depth</strong></span> to <code class="literal">1</code> so that it can be rendered over the <span class="strong"><strong>Viewport</strong></span> background.</li><li class="listitem">Set its <span class="strong"><strong>Dimensions</strong></span> to <code class="literal">160</code> x <code class="literal">160</code>.</li></ol></div></li><li class="listitem">Select our <span class="strong"><strong>Foreground</strong></span> GameObject from <span class="strong"><strong>Progress Bar</strong></span> and perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Set its <span class="strong"><strong>Color Tint</strong></span> to {<code class="literal">75</code>, <code class="literal">190</code>, <code class="literal">95</code>, <code class="literal">255</code>}.</li><li class="listitem">Set its <span class="strong"><strong>Depth</strong></span> value to <code class="literal">2</code>.</li><li class="listitem">Set its <span class="strong"><strong>Dimensions</strong></span> to <code class="literal">160</code> x <code class="literal">160</code>.</li></ol></div></li><li class="listitem"> Select our <span class="strong"><strong>Progress Bar</strong></span> from <span class="strong"><strong>ActiveBarrier</strong></span> and perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Rename it as <code class="literal">Slider</code>.</li><li class="listitem">Set its <span class="strong"><strong>Transform Position</strong></span> to {<code class="literal">-80</code>, <code class="literal">0</code>, <code class="literal">0</code>} to center it.</li><li class="listitem">Set the <span class="strong"><strong>UISlider</strong></span> value to <code class="literal">0</code> to make sure it's empty at start.</li></ol></div></li><li class="listitem">Select our <span class="strong"><strong>ActiveBarrier</strong></span> GameObject.</li><li class="listitem">Attach a collider to it by navigating to <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Attach</strong></span>, and set its <span class="strong"><strong>Size</strong></span> to {<code class="literal">160</code>, <code class="literal">160</code>, <code class="literal">1</code>}.</li></ol></div><p>The slider of <span class="strong"><strong>ActiveBarrier</strong></span> GameObject is ready. If you click on the play button and change the <span class="strong"><strong>Slider</strong></span> value in the <span class="strong"><strong>Inspector</strong></span> view during runtime, you will see the <span class="strong"><strong>ActiveBarrier</strong></span> prefab building itself.</p><p>Let's add a label that will show the status of <span class="strong"><strong>ActiveBarrier</strong></span>: either <span class="strong"><strong>Building</strong></span> or <span class="strong"><strong>Built</strong></span>.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Duplicate our <span class="strong"><strong>Label</strong></span> GameObject in <span class="strong"><strong>BarrierObject</strong></span> and perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Drag it inside our <span class="strong"><strong>ActiveBarrier</strong></span> GameObject.</li><li class="listitem">Reset its <span class="strong"><strong>Transform Position</strong></span> to {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>}.</li><li class="listitem">Set its <span class="strong"><strong>Depth</strong></span> to <code class="literal">3</code>.</li><li class="listitem">Add a Localize component to it by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>UI</strong></span>.</li><li class="listitem">Set the key of <span class="strong"><strong>UILocalize</strong></span> to <code class="literal">BuildingBarrier</code>.</li></ol></div></li><li class="listitem">Drag our <span class="strong"><strong>ActiveBarrier</strong></span> in the folder of your choice inside the <span class="strong"><strong>Project</strong></span> view to make it a prefab.</li><li class="listitem">Delete the <span class="strong"><strong>ActiveBarrier</strong></span> instance from the scene.</li></ol></div><p>Ok, our<a id="id251" class="indexterm"/> <span class="strong"><strong>ActiveBarrier</strong></span> prefab is ready. Now, add the following localization strings to <code class="literal">English.txt</code>:</p><div class="informalexample"><pre class="programlisting">//Game
Barrier = [99FF99]Barrier
BuildingBarrier = [FF6666]Building\nBarrier...
Wait = Wait</pre></div><p>Also, add the following localization strings to <code class="literal">French.txt</code>:</p><div class="informalexample"><pre class="programlisting">//Game
Barrier = [99FF99]Barrière
BuildingBarrier = [FF6666]Construction\nBarrière...
Wait = Attendez</pre></div><p>Now, everything is set for our <span class="strong"><strong>ActiveBarrier</strong></span> prefab.</p></div><div class="section" title="Instantiating the ActiveBarrier prefab"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec56"/>Instantiating the ActiveBarrier prefab</h2></div></div></div><p>Now <a id="id252" class="indexterm"/>that we have our prefab, we need to instantiate it when a <span class="strong"><strong>BarrierObject</strong></span> prefab is dropped inside the <span class="strong"><strong>Viewport</strong></span> GameObject.</p><p>Open our <code class="literal">ViewportHolder.cs</code> script and declare our necessary variables:</p><div class="informalexample"><pre class="programlisting">//We need our two barriers Prefabs
public Object barrierObjectPrefab;
public Object activeBarrierPrefab;

//We need the BarrierObject container
public GameObject barrierContainer;</pre></div><p>Save the script. Let's go back to the scene and assign these variables in the <span class="strong"><strong>Inspector</strong></span> view:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select the <span class="strong"><strong>Viewport</strong></span> GameObject.</li><li class="listitem">Drag the <span class="strong"><strong>BarrierObject</strong></span> prefab from the <span class="strong"><strong>Project</strong></span> view in the <span class="strong"><strong>BarrierObject</strong></span> prefab field of <span class="strong"><strong>Viewport Holder</strong></span>.</li><li class="listitem">Drag the <span class="strong"><strong>ActiveBarrier</strong></span> prefab from the <span class="strong"><strong>Project</strong></span> view in the <span class="strong"><strong>ActiveBarrier</strong></span> prefab field <span class="strong"><strong>Viewport Holder</strong></span>.</li><li class="listitem">Drag the <span class="strong"><strong>Barrier</strong></span> GameObject in <span class="strong"><strong>UI</strong></span> from the <span class="strong"><strong>Hierarchy</strong></span> view to the <span class="strong"><strong>Barrier Container</strong></span> field in <span class="strong"><strong>Viewport Holder</strong></span>.</li></ol></div><p>The necessary variables are assigned. Go back to our <code class="literal">ViewportHolder.cs</code> script, and add the following two lines to call the appropriate methods, after <code class="literal">Destroy(droppedObj)</code>:</p><div class="informalexample"><pre class="programlisting">RecreateBarrierObject();
CreateActiveBarrier(droppedObj.transform);</pre></div><p>Now, we <a id="id253" class="indexterm"/>can add these two methods that will recreate our <span class="strong"><strong>BarrierObject</strong></span> prefab. Also, we can add an <span class="strong"><strong>ActiveBarrier</strong></span> prefab to the <span class="strong"><strong>Viewport</strong></span> GameObject:</p><div class="informalexample"><pre class="programlisting">void RecreateBarrierObject()
{
  //Add a BarrierObject to the container
  Transform newBarrierTrans = NGUITools.AddChild(barrierContainer, barrierObjectPrefab as GameObject).transform;
  //Reset its localPosition to {0,0,0}
  newBarrierTrans.localPosition = Vector3.zero;
}

void CreateActiveBarrier(Transform barrierObjectTrans)
{
  //Add an ActiveBarrier to the Viewport
  Transform newActiveBarrierTrans = NGUITools.AddChild(gameObject, activeBarrierPrefab as GameObject).transform;
  //Set position to the droppedObject's position
  newActiveBarrierTrans.position = barrierObjectTrans.position;
}</pre></div><p>Click on the play button. When you drag the <span class="strong"><strong>BarrierObject</strong></span> prefab onto the <span class="strong"><strong>Viewport</strong></span> GameObject, it creates our <span class="strong"><strong>ActiveBarrier</strong></span> prefab; and it recreates a <span class="strong"><strong>BarrierObject</strong></span> prefab to be able to drag another one.</p></div><div class="section" title="Barrier's building process"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec57"/>Barrier's building process</h2></div></div></div><p>Right <a id="id254" class="indexterm"/>now, our dropped <span class="strong"><strong>ActiveBarrier</strong></span> instances stay empty and never build. Let's make them fill themselves at a speed depending on the number of barriers in the scene:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select our <span class="strong"><strong>ActiveBarrier</strong></span> prefab in the <span class="strong"><strong>Project</strong></span> view.</li><li class="listitem">Create and add an <code class="literal">ActiveBarrierController.cs</code> script to it.</li></ol></div><p>Open this new <code class="literal">ActiveBarrierController.cs</code> script, and add these necessary variables and the <code class="literal">Awake()</code> method to initialize them:</p><div class="informalexample"><pre class="programlisting">//We will need the Slider and the Label's UILocalize
private UISlider slider;
private UILocalize loc;

void Awake()
{
  //Get necessary components at Awake()
  slider = GetComponentInChildren&lt;UISlider&gt;();
  loc = GetComponentInChildren&lt;UILocalize&gt;();
}</pre></div><p>Now that we have our necessary variables initialized, let's add a coroutine that will increase the <span class="strong"><strong>UISlider</strong></span> value over time, at a rate depending on a given <code class="literal">buildTime</code>:</p><div class="informalexample"><pre class="programlisting">public IEnumerator Build(float buildTime)
{
    while(slider.value &lt; 1) {
    slider.value += (Time.deltaTime / buildTime);
    yield return null;
  }
  //When slider value is &gt; 1
  BuildFinished();
}</pre></div><p>Ok. Let's add <a id="id255" class="indexterm"/>the <code class="literal">BuildFinished()</code> method that will set the <span class="strong"><strong>Slider</strong></span> value to <code class="literal">1</code> (in case this value is higher), and change the <span class="strong"><strong>UILocalize</strong></span> key:</p><div class="informalexample"><pre class="programlisting">private void BuildFinished()
{
  //Make sure it's at 1
  slider.value = 1;
  //Set the key to "normal" barrier and update Localization
  loc.key = "Barrier";
  loc.Localize();
}</pre></div><p>Good. We just need to edit the <code class="literal">ViewportHolder.cs</code> script to add a <code class="literal">barrierCount</code> variable, and start the new <code class="literal">Build()</code> coroutine from <span class="strong"><strong>ActiveBarrier</strong></span>.</p><p>Open the <code class="literal">ViewportHolder.cs</code> script and declare a new <code class="literal">int</code> after our <code class="literal">barrierContainer</code>:</p><div class="informalexample"><pre class="programlisting">public int barrierCount = 0;</pre></div><p>Now, let's add these two simple lines of code to update the <code class="literal">barrierCount</code> variable and start the <code class="literal">Build()</code> coroutine on our new <span class="strong"><strong>ActiveBarrier</strong></span> prefab:</p><div class="informalexample"><pre class="programlisting">//Update barrierCount
barrierCount++;
//Start the Build Coroutine with the correct buildTime
StartCoroutine(newActiveBarrierTrans.GetComponent&lt;ActiveBarrierController&gt;().Build(barrierCount *2));</pre></div><p>Click on the play button. Now, our <span class="strong"><strong>ActiveBarrier</strong></span> prefab builds itself depending on the number of <span class="strong"><strong>ActiveBarriers</strong></span> on the scene!</p></div><div class="section" title="Forwarding events to viewport"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec58"/>Forwarding events to viewport</h2></div></div></div><p>You may<a id="id256" class="indexterm"/> have noticed that you cannot scroll if you click on an <span class="strong"><strong>ActiveBarrier</strong></span> prefab. That's because it catches the events instead of our viewport.</p><p>Let's simply forward its events to the viewport:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select our <span class="strong"><strong>ActiveBarrier</strong></span> prefab in the <span class="strong"><strong>Project</strong></span> view.</li><li class="listitem">Attach a <span class="strong"><strong>Forward Events</strong></span> component to it by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Interaction</strong></span> and perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Check its <span class="strong"><strong>On Press</strong></span> Boolean.</li><li class="listitem">Check its <span class="strong"><strong>On Drag</strong></span> Boolean.</li></ol></div></li><li class="listitem">Open the <code class="literal">ActiveBarrierController.cs</code> script that is attached to it.</li></ol></div><p>We need to assign the target variable of the <span class="strong"><strong>UIForward Event</strong></span> component when the <span class="strong"><strong>ActiveBarrier</strong></span> prefab is created. To do so, add a new <code class="literal">Start()</code> method with the following:</p><div class="informalexample"><pre class="programlisting">void Start()
{
  //Set the UIForwardEvents' target to the viewport
  GetComponent&lt;UIForwardEvents&gt;().target = transform.parent.gameObject;
}</pre></div><p>We can now scroll no matter what. We are missing something: a cooldown on the BarrierObjects that also depends on the number of ActiveBarriers.</p></div></div>
<div class="section" title="BarrierObject cooldown"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec41"/>BarrierObject cooldown</h1></div></div></div><p>We will <a id="id257" class="indexterm"/>implement the cooldown system that will deactivate the <span class="strong"><strong>BarrierObject</strong></span> button as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/8667OT_05_10.jpg" alt="BarrierObject cooldown"/></div><p>Then, we will make the barrier's apparition smoother by tweening its scale.</p><div class="section" title="Cooldown implementation"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec59"/>Cooldown implementation</h2></div></div></div><p>In order to implement<a id="id258" class="indexterm"/> the required cooldown, we need to open the <code class="literal">BarrierObjectController.cs</code> script and add the following  two necessary variables with an initialization on <code class="literal">Awake()</code>:</p><div class="informalexample"><pre class="programlisting">//We will need the Button and the Label
private UIButton button;
private UILabel label;

void Awake()
{
  //Get necessary components at Awake
  button = GetComponentInChildren&lt;UIButton&gt;();
  label = GetComponentInChildren&lt;UILabel&gt;();
}</pre></div><p>Now that we have the button and label, we can add a <code class="literal">Cooldown()</code> coroutine that will deactivate the button and update the label to show the remaining time to the player:</p><div class="informalexample"><pre class="programlisting">public IEnumerator Cooldown(int cooldown)
{
  //Deactivate the Barrier button and update Color to Disable
  button.isEnabled = false;
  button.UpdateColor(false, true);

  while(cooldown &gt; 0)
  {
    //Update Label with localized text each second
    label.text = Localization.instance.Get("Wait") + " " + cooldown.ToString() + "s";
    cooldown -= 1;
    //Wait for a second, then return to start of While
    yield return new WaitForSeconds(1);
  }
  //If cooldown &lt;= 0
  CooldownFinished();
}</pre></div><p>The previous coroutine updates the label and decreases the cooldown. We can now add the <code class="literal">CooldownFinished()</code> method that will reactivate the button and reset the label:</p><div class="informalexample"><pre class="programlisting">void CooldownFinished()
{
  //Reset the Label's Text to "normal" Barrier
  label.text = Localization.instance.Get("Barrier");
  //Reactivate the Barrier button and update Color to Normal
  button.isEnabled = true;
  button.UpdateColor(true, true);
}</pre></div><p>Great, <a id="id259" class="indexterm"/>everything is ready for our cooldown. We just need to start the <code class="literal">Cooldown()</code> coroutine when a new <span class="strong"><strong>BarrierObject</strong></span> prefab is created.</p><p>In order to do this, let's go back to our <code class="literal">ViewportHolder.cs</code> script and add the following line at the very end of the <code class="literal">RecreateBarrierObject()</code> method:</p><div class="informalexample"><pre class="programlisting">//Start the new BarrierObject's Cooldown Coroutine
StartCoroutine(newBarrierTrans.GetComponent&lt;BarrierObjectController&gt;().Cooldown((barrierCount +1) *3));</pre></div><p>Perfect. Here, we needed to pass <code class="literal">barrierCount +1</code> as argument because at this stage it is not yet updated (it is incremented in the <code class="literal">CreateActiveBarrier()</code> method).</p><p>Click on the play button. When you drop a <span class="strong"><strong>BarrierObject</strong></span> prefab on the <span class="strong"><strong>Viewport</strong></span> GameObject, you will only be able to drop another one when the cooldown is finished. The more barriers you have, the longer the cooldown.</p></div><div class="section" title="BarrierObject smooth apparition"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec60"/>BarrierObject smooth apparition</h2></div></div></div><p>Let's add a TweenScale<a id="id260" class="indexterm"/> to make the barrier's availability more obvious to the player. Go back to our <code class="literal">BarrierObjectController.cs</code> script and add the following two lines at the very end of the <code class="literal">CooldownFinished()</code> method:</p><div class="informalexample"><pre class="programlisting">//Set its scale to {0,0,0}
transform.localScale = Vector3.zero;
//Tween it back to make it appear smoothly
TweenScale.Begin(gameObject, 0.3f, new Vector3(1,1,1));</pre></div><p>That's better. Now, the animated apparition of <span class="strong"><strong>BarrierObject</strong></span> attracts the player's eye. But, hey, we created a notification in the previous chapter. Let's reuse it to make it even more obvious!</p></div></div>
<div class="section" title="The barrier availability tool tip"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec42"/>The barrier availability tool tip</h1></div></div></div><p>Let's set up <a id="id261" class="indexterm"/>notifications in the game using our previous work:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Drag our <span class="strong"><strong>Notification</strong></span> prefab inside our <span class="strong"><strong>UI</strong></span> GameObject.</li><li class="listitem">Select the new <span class="strong"><strong>Notification</strong></span> GameObject in the <span class="strong"><strong>Hierarchy</strong></span> view, and then perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Change its <span class="strong"><strong>Layer</strong></span> to <span class="strong"><strong>Game</strong></span> (in the top right-hand corner of the <span class="strong"><strong>Inspector</strong></span> view).</li><li class="listitem">A pop up will appear. Click on <span class="strong"><strong>Yes</strong></span>, and change children.</li><li class="listitem">Open the <code class="literal">NotificationManager.cs</code> script that is attached to it.</li></ol></div></li></ol></div><p>First, we need to add a new notification type. This is done by adding a third line to our type <code class="literal">enum</code>:</p><div class="informalexample"><pre class="programlisting">BarrierAvailable</pre></div><p>Now, add the following localization string to <code class="literal">English.txt</code>:</p><div class="informalexample"><pre class="programlisting">BarrierAvailableNotification = New [99FF99]Barrier[FFFFFF] Available!</pre></div><p>Also, add the <a id="id262" class="indexterm"/>following localization string to <code class="literal">French.txt</code>:</p><div class="informalexample"><pre class="programlisting">BarrierAvailableNotification = Nouvelle [99FF99]Barrière[FFFFFF] Disponible !</pre></div><p>Everything is set. Now, go back to our <code class="literal">BarrierObjectController.cs</code> script, and add the following line of code at the very end of the <code class="literal">CooldownFinished()</code> method:</p><div class="informalexample"><pre class="programlisting">//Show Notification to inform the player
NotificationManager.instance.Show(NotificationManager.Type.BarrierAvailable, 1.5f);</pre></div><p>Click on the play button. A localized notification will appear as soon as a new barrier is available. This way, we are sure that the player will not miss it.</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec43"/>Summary</h1></div></div></div><p>In this chapter, we learned how to create a scrollable viewport using a scrollable background. Also, we linked the mouse drag, scroll bars, and keyboard arrows to it.</p><p>We used the <span class="strong"><strong>UIDrag Object</strong></span> component to create our drag-and-drop system, allowing us to drag objects inside the scrollable viewport.</p><p>Coroutines helped us to create the barriers' building process and cooldown system. The <span class="strong"><strong>UIForward Events</strong></span> component was used to forward events to the viewport. Finally, we reused our <span class="strong"><strong>Notification</strong></span> prefab inside our new <span class="strong"><strong>Game</strong></span> scene.</p><p>We now have the basic elements for <a class="link" href="ch07.html" title="Chapter 7. Creating a Game with NGUI">Chapter 7</a>, <span class="emphasis"><em>Creating a Game with NGUI</em></span>. Now, it is time to discover how to add sprites and fonts to NGUI with <a class="link" href="ch06.html" title="Chapter 6. Atlas and Font Customization">Chapter 6</a>, <span class="emphasis"><em>Atlas and Font Customization</em></span>. We will then use our own assets to create a game!</p></div></body></html>