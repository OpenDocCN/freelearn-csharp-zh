<html><head></head><body><div class="chapter" title="Chapter&#xA0;9.&#xA0;Playing and Manipulating Sounds"><div class="titlepage"><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Playing and Manipulating Sounds</h1></div></div></div><p>In this chapter, we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Matching the audio pitch to the animation speed</li><li class="listitem" style="list-style-type: disc">Simulating acoustic environments with Reverb Zones</li><li class="listitem" style="list-style-type: disc">Preventing an Audio Clip from restarting if it is already playing</li><li class="listitem" style="list-style-type: disc">Waiting for audio to finish playing before auto-destructing an object</li><li class="listitem" style="list-style-type: disc">Adding volume control with Audio Mixers</li><li class="listitem" style="list-style-type: disc">Making a dynamic soundtrack with Snapshots</li><li class="listitem" style="list-style-type: disc">Balancing in-game audio with Ducking</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec88"/>Introduction</h1></div></div></div><p>Sound is a very important part of the gaming experience. In fact, we can't stress enough how crucial it is to the player's immersion in a virtual environment. Just think of the engine running in your favorite racing game, the distant urban buzz in a simulator game, or the creeping noises in horror games. Think of how these sounds transport you <span class="emphasis"><em>into</em></span> the game.</p><div class="section" title="The big picture"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec254"/>The big picture</h2></div></div></div><p>Before getting on with the recipes, let's step back and have a quick review on how sound works on <a class="indexterm" id="id923"/>Unity 5.</p><p>Audio files can be embedded into GameObjects through the<a class="indexterm" id="id924"/> <span class="strong"><strong>Audio Source</strong></span> component. Unity supports<a class="indexterm" id="id925"/> <span class="strong"><strong>3D sounds</strong></span>, which means that the location and distance between the audio sources and <span class="strong"><strong>Audio Listener</strong></span> matter in the way the <a class="indexterm" id="id926"/>sound is perceived in terms of loudness and the left/right balance. This is unless the audio source is specified as <span class="strong"><strong>2D sound</strong></span> (which is usually the case for the background soundtrack music).</p><p>Although all sound is sent to the scene's <span class="strong"><strong>Audio </strong></span><a class="indexterm" id="id927"/><span class="strong"><strong>Listener</strong></span> (a component that is usually attached to<a class="indexterm" id="id928"/> the <span class="strong"><strong>Main Camera</strong></span>, and that shouldn't be attached simultaneously on more than one object), Unity 5 brings a new player to the audio scene: the <span class="strong"><strong>Audio Mixer</strong></span>. The Audio mixer radically changes the way in which sound elements can be experienced and worked with. It allows developers to mix and arrange audio pretty much in the same way that musicians and producers<a class="indexterm" id="id929"/> do in their <span class="strong"><strong>Digital Audio Workstations</strong></span> (<span class="strong"><strong>D.A.W</strong></span>), such as <span class="strong"><strong>GarageBand</strong></span> or <span class="strong"><strong>ProTools</strong></span>. It allows<a class="indexterm" id="id930"/> you to route audio source clips into specific channels<a class="indexterm" id="id931"/> that can have their volumes individually adjusted and processed by customized effects and filters. You can work with multiple Audio Mixers, send a mixer's output to a parent mixer, and save mix preferences as <span class="strong"><strong>Snapshots</strong></span>. Also, you can <a class="indexterm" id="id932"/>access mixer parameters from scripting. The following figure represents the main Unity 5 audio mixing concepts and their relationships:</p><div class="mediaobject"><img alt="The big picture" src="graphics/1362_09_01.jpg"/></div><p>Taking advantage of the new Audio Mixer feature in many example projects, this chapter is filled with recipes that will hopefully help you implement a better and more efficient sound design for your projects, augmenting the player's sense of immersion, transporting him or her into the game environment, and even improving the gameplay.</p></div></div></div>
<div class="section" title="Matching the audio pitch to the animation speed"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec89"/>Matching the audio pitch to the animation speed</h1></div></div></div><p>Many artifacts<a class="indexterm" id="id933"/> sound higher in pitch when accelerated and <a class="indexterm" id="id934"/>lower when slowed down. Car engines, fan coolers, Vinyl—a record player… the list goes on. If you want to simulate this kind of sound effect in an animated object that can have its speed changed dynamically, follow this recipe.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec255"/>Getting ready</h2></div></div></div><p>For this recipe, you'll need an animated 3D object and an audio clip. Please use the files <code class="literal">animatedRocket.fbx</code> and <code class="literal">engineSound.wav</code>, available in the <code class="literal">1362_09_01</code> folder of the code bundle.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec256"/>How to do it...</h2></div></div></div><p>To change the pitch of an audio clip according to the speed of an animated object, please follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Import the <code class="literal">animatedRocket.fbx</code> file into your <span class="strong"><strong>Project</strong></span>.</li><li class="listitem">Select the <code class="literal">animatedRocket</code> file in the <span class="strong"><strong>Project</strong></span> view. Then, from the <span class="strong"><strong>Inspector</strong></span> view, check its <span class="strong"><strong>Import Settings</strong></span>. Select <span class="strong"><strong>Animations</strong></span>, then select the clip <span class="strong"><strong>Take 001</strong></span>, and make sure to check the <span class="strong"><strong>Loop Time</strong></span> option. Click on the <span class="strong"><strong>Apply</strong></span> button, shown as follows, to save the changes:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_02.jpg"/></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip11"/>Tip</h3><p>The reason why we didn't need to check <span class="strong"><strong>Loop Pose</strong></span> option is because our animation already loops in a seamless fashion. If it didn't, we could have checked that option to automatically create a seamless transition from the last to the first frame<a class="indexterm" id="id935"/> of the animation.</p></div></div></li><li class="listitem">Add the <a class="indexterm" id="id936"/><span class="strong"><strong>animatedRocket</strong></span> GameObject to the scene by dragging it from the <span class="strong"><strong>Project</strong></span> view into the <span class="strong"><strong>Hierarchy</strong></span> view.</li><li class="listitem">Import the <code class="literal">engineSound.wav</code> audio clip.</li><li class="listitem">Select the<span class="strong"><strong> animatedRocket</strong></span> GameObject. Then, drag <span class="strong"><strong>engineSound</strong></span> from the <span class="strong"><strong>Project</strong></span> view into the <span class="strong"><strong>Inspector</strong></span> view, adding it as an <span class="strong"><strong>Audio Source</strong></span> for that object.</li><li class="listitem">In the <span class="strong"><strong>Audio Source</strong></span> component of <span class="strong"><strong>animatedRocket</strong></span>, check the box for the <span class="strong"><strong>Loop</strong></span> option, as shown in the following screenshot:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_03.jpg"/></div></li><li class="listitem">We need to create a <a class="indexterm" id="id937"/><span class="strong"><strong>Controller</strong></span> for our object. In the <span class="strong"><strong>Project</strong></span> view, click <span class="strong"><strong>Create</strong></span> <a class="indexterm" id="id938"/>and select <span class="strong"><strong>Animator Controller</strong></span>. Name it as <code class="literal">rocketlController</code>.</li><li class="listitem">Double-click <a class="indexterm" id="id939"/>on <span class="strong"><strong>rocketController</strong></span> object to open the <span class="strong"><strong>Animator</strong></span> window, as shown. Then, right-click on the gridded area and select the <span class="strong"><strong>Create State</strong></span> | <span class="strong"><strong>Empty</strong></span> option, from the contextual menu:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_04.jpg"/></div></li><li class="listitem">Name the new state <code class="literal">spin</code> and set <span class="strong"><strong>Take 001</strong></span> as its motion in the <span class="strong"><strong>Motion</strong></span> field:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_05.jpg"/></div></li><li class="listitem">From the <span class="strong"><strong>Hierarchy</strong></span> view, select <span class="strong"><strong>animatedRocket</strong></span>. Then, in the <span class="strong"><strong>Animator</strong></span> component (in the <span class="strong"><strong>Inspector</strong></span> view), set <span class="strong"><strong>rocketController</strong></span> as its <span class="strong"><strong>Controller</strong></span> and make sure<a class="indexterm" id="id940"/> that the <span class="strong"><strong>Apply Root Motion</strong></span> option is unchecked as shown:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_06.jpg"/></div></li><li class="listitem">In the <span class="strong"><strong>Project</strong></span> view, create a new <span class="strong"><strong>C# Script</strong></span> and rename it to <code class="literal">ChangePitch</code>.</li><li class="listitem">Open the <a class="indexterm" id="id941"/>script in your editor and replace everything with the following code:<div class="informalexample"><pre class="programlisting">using UnityEngine;

public class ChangePitch : MonoBehaviour{
  public float accel = 0.05f;
  public float minSpeed = 0.0f;
  public float maxSpeed = 2.0f;
  public float animationSoundRatio = 1.0f;
  private float speed = 0.0f;
  private Animator animator;
  private AudioSource audioSource;

  void Start(){
    animator = GetComponent&lt;Animator&gt;();
    audioSource = GetComponent&lt;AudioSource&gt;();
    speed = animator.speed;
    AccelRocket (0f);
  }

  void Update(){
    if (Input.GetKey (KeyCode.Alpha1))
      AccelRocket(accel);

    if (Input.GetKey (KeyCode.Alpha2))
      AccelRocket(-accel);
  }

  public void AccelRocket(float accel){
    speed += accel;
    speed = Mathf.Clamp(speed,minSpeed,maxSpeed);
    animator.speed = speed = Mathf.Clamp (speed, 0, maxSpeed);
    float soundPitch = animator.speed * animationSoundRatio;
    audioSource.pitch = soundPitch;
  }
}</pre></div></li><li class="listitem">Save your <a class="indexterm" id="id942"/>script and add it as a component to <span class="strong"><strong>animatedRocket</strong></span> GameObject.</li><li class="listitem">Play the scene and change the animation speed by pressing key <span class="emphasis"><em>1</em></span> (accelerate) and <span class="emphasis"><em>2</em></span> (decelerate) on your alphanumeric keyboard. The audio pitch will change accordingly.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec257"/>How it works...</h2></div></div></div><p>At the <code class="literal">Start()</code> method, besides storing the <span class="strong"><strong>Animator</strong></span> and <span class="strong"><strong>AudioSource</strong></span> components in variables, we'll <a class="indexterm" id="id943"/>get the initial <code class="literal">speed</code> from the <span class="strong"><strong>Animator</strong></span>, and we'll call the <code class="literal">AccelRocket()</code> function by passing <code class="literal">0</code> as an argument, only for that function to calculate the resulting pitch for the <span class="strong"><strong>Audio Source</strong></span>. During <code class="literal">Update()</code> function, the lines of the <code class="literal">if(Input.GetKey (KeyCode.Alpha1))</code> and <code class="literal">if(Input.GetKey (KeyCode.Alpha2))</code> code detect whenever the <span class="emphasis"><em>1</em></span> or <span class="emphasis"><em>2</em></span> keys are being pressed on the alphanumeric keyboard to call the <code class="literal">AccelRocket()</code> function, passing a <code class="literal">accel</code> float variable as an argument. The <code class="literal">AccelRocket()</code> function, in its turn, increments <code class="literal">speed</code> with the received argument (the <code class="literal">accel</code> float variable). However, it uses the <code class="literal">Mathf.Clamp()</code>command to limit the new speed value between the minimum and maximum speed as set by the user. Then, it changes the <span class="strong"><strong>Animator</strong></span> speed and <span class="strong"><strong>Audio Source</strong></span> pitch according to the new <code class="literal">speed</code> absolute value. The value is clamped a second time to avoid negative numbers. Should you reverse the animation, check out a solution in the completed project included with the code files. Also, please note that setting the animation speed and therefore, the sound pitch to <code class="literal">0</code> will cause the sound to stop, making<a class="indexterm" id="id944"/> it clear that stopping the object's animation also prevents the engine sound from playing.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec258"/>There's more...</h2></div></div></div><p>Here is some information <a class="indexterm" id="id945"/>on how to fine-tune and customize this recipe.</p><div class="section" title="Changing the Animation/Sound Ratio"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec65"/>Changing the Animation/Sound Ratio</h3></div></div></div><p>If you want the <a class="indexterm" id="id946"/>audio clip pitch to be more or less affected by the animation speed, change the value of the <span class="strong"><strong>Animation/Sound Ratio</strong></span> parameter.</p></div><div class="section" title="Accessing the function from other scripts"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec66"/>Accessing the function from other scripts</h3></div></div></div><p>The <code class="literal">AccelRocket()</code> function was<a class="indexterm" id="id947"/> made public <a class="indexterm" id="id948"/>so that it can be accessed from other scripts. As an example, we have included the <code class="literal">ExtChangePitch.cs</code> script in <code class="literal">1362_09_01</code> folder. Try attaching this script to the <span class="strong"><strong>Main Camera</strong></span> object and use it to control the speed by clicking on the left and right mouse buttons.</p></div></div></div>
<div class="section" title="Simulating acoustic environments with Reverb Zones"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec90"/>Simulating acoustic environments with Reverb Zones</h1></div></div></div><p>Once<a class="indexterm" id="id949"/> you have created your level's geometry and the scene is looking just the way you want it to, you might want your sound effects to correspond to that look. Sound behaves differently depending upon the environment in <a class="indexterm" id="id950"/>which it is projected, so it can be a good idea to make it reverberate accordingly. In this recipe, we will address this acoustic effect by using <span class="strong"><strong>Reverb Zones</strong></span>.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec259"/>Getting ready</h2></div></div></div><p>For this recipe, we have prepared the <code class="literal">ReverbZone.unitypackage</code> file, containing a basic level named <code class="literal">reverbScene</code> and the <code class="literal">Signal</code> prefab. The package is in the <code class="literal">1362_09_02</code> folder in the code bundle.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec260"/>How to do it...</h2></div></div></div><p>Follow these steps to simulate the sonic landscape of a tunnel:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Import the <code class="literal">ReverbZone</code> package into your Unity Project.</li><li class="listitem">In the <span class="strong"><strong>Project</strong></span> view, open the <span class="strong"><strong>reverbScene </strong></span>level, inside the <code class="literal">ReverbZones</code> folder. This is a basic scene, featuring a controllable character and a tunnel.</li><li class="listitem">Now, drag the <span class="strong"><strong>Signal</strong></span> prefab from the <span class="strong"><strong>Project</strong></span> view into <span class="strong"><strong>Hierarchy</strong></span>, as shown in the<a class="indexterm" id="id951"/> following screenshot. This will add a sound-emitting object to the scene. Place it in the center of the tunnel.<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_07.jpg"/></div></li><li class="listitem">Make five<a class="indexterm" id="id952"/> copies of the <span class="strong"><strong>Signal</strong></span> GameObject and distribute them across the tunnel (leaving a copy just outside each entrance):<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_08.jpg"/></div></li><li class="listitem">In in the<a class="indexterm" id="id953"/> <span class="strong"><strong>Hierarchy</strong></span> view, navigate to <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Audio</strong></span> | <span class="strong"><strong>Audio Reverb Zone</strong></span> to add a <span class="strong"><strong>Reverb Zone</strong></span> to the scene. Then, place it in the center of the tunnel.</li><li class="listitem">Select the <span class="strong"><strong>Reverb Zone</strong></span> GameObject. In the <span class="strong"><strong>Inspector</strong></span> view, change the <span class="strong"><strong>Reverb Zone </strong></span>component<a class="indexterm" id="id954"/> parameters to these values: <span class="strong"><strong>Min Distance</strong></span>: <code class="literal">6</code>; <span class="strong"><strong>Max Distance</strong></span>: <code class="literal">18</code>; and <span class="strong"><strong>Preset</strong></span>: <code class="literal">StoneCorridor</code> as shown in the following screenshot:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_09.jpg"/></div></li><li class="listitem">Play the scene and walk through the tunnel using the <span class="emphasis"><em>W A S D</em></span> keys ( and pressing <span class="emphasis"><em>Shift</em></span> to run). You will hear the audio reverberate when inside the <span class="strong"><strong>Reverb Zone</strong></span> area.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec261"/>How it works...</h2></div></div></div><p>Once positioned, the <a class="indexterm" id="id955"/><span class="strong"><strong>Audio Reverb Zone</strong></span> applies <a class="indexterm" id="id956"/>an audio filter to all audio sources within its radius.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec262"/>There's more...</h2></div></div></div><p>Here are more options for you to try.</p><div class="section" title="Attaching the Audio Reverb Zone component to Audio Sources"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec67"/>Attaching the Audio Reverb Zone component to Audio Sources</h3></div></div></div><p>Instead of creating an <a class="indexterm" id="id957"/><span class="strong"><strong>Audio Reverb Zone</strong></span> GameObject, you can attach it to the sound emitting object (in our case, <span class="strong"><strong>Signal</strong></span>) as a component through the <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Audio</strong></span> | <span class="strong"><strong>Audio Reverb Zone</strong></span> menu. In this case, the <span class="strong"><strong>Reverb Zone</strong></span> will be individually set up around the object.</p></div><div class="section" title="Making your own Reverb settings"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec68"/>Making your own Reverb settings</h3></div></div></div><p>Unity comes with several <a class="indexterm" id="id958"/><span class="strong"><strong>Reverb Presets</strong></span>. We have used <span class="strong"><strong>StoneCorridor</strong></span>, but your scene can ask for something less intense (such as <span class="strong"><strong>Room</strong></span>) or more radical (such as <span class="strong"><strong>Psychotic</strong></span>). If these presets still won't be<a class="indexterm" id="id959"/> able to recreate the effect that you have in mind, change it to <span class="strong"><strong>User</strong></span> and edit its parameters as you wish.</p></div></div></div>
<div class="section" title="Preventing an Audio Clip from restarting if it is already playing"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec91"/>Preventing an Audio Clip from restarting if it is already playing</h1></div></div></div><p>In a game, there<a class="indexterm" id="id960"/> may be several different events that cause a sound to start playing. If the sound is already playing, then in almost all cases, we won't wish to restart the sound. This recipe includes a test, so that an <span class="strong"><strong>Audio Source</strong></span> component is only sent a <code class="literal">Play()</code> message if it is currently not playing.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec263"/>Getting ready</h2></div></div></div><p>Try this with any audio clip that is one second or longer in duration. We have included the <code class="literal">engineSound</code> audio clip inside the <code class="literal">1362_09_03</code> folder.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec264"/>How to do it...</h2></div></div></div><p>To prevent an <span class="strong"><strong>Audio Clip</strong></span> from restarting, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create an <span class="strong"><strong>Empty</strong></span> GameObject and rename it to <span class="strong"><strong>AudioObject</strong></span>. Then, add an <span class="strong"><strong>Audio Source</strong></span> component to this object (in the <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Audio</strong></span> | <span class="strong"><strong>Audio Source</strong></span> menu).</li><li class="listitem">Import the<a class="indexterm" id="id961"/> <code class="literal">engineSound</code> audio clip and drag it from the <span class="strong"><strong>Project</strong></span> view to populate the <span class="strong"><strong>Audio Clip</strong></span> parameter of the <span class="strong"><strong>Audio Source</strong></span> component of <span class="strong"><strong>AudioObject</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_10.jpg"/></div></li><li class="listitem">Create a UI button named <span class="strong"><strong>PlaySoundButton</strong></span> on the screen and attach the following script to this button:<div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI;
public class AvoidEarlySoundRestart : MonoBehaviour {
  public AudioSource audioSource;
  public Text message;

  void Update(){
    string statusMessage = "Play sound";
    if(audioSource.isPlaying)
      statusMessage = "(sound playing)";
    message.text = statusMessage;
  }

  // button click handler
  public void PlaySoundIfNotPlaying(){
    if( !audioSource.isPlaying)
      audioSource.Play();
  }
}</pre></div></li><li class="listitem">With <span class="strong"><strong>PlaySoundButton</strong></span> selected in the <span class="strong"><strong>Hierarchy</strong></span> panel, drag <span class="strong"><strong>AudioObject</strong></span> into the <span class="strong"><strong>Inspector</strong></span> view for the public <span class="strong"><strong>Audio Source</strong></span> variable, and drag the <span class="strong"><strong>Text</strong></span> child of <span class="strong"><strong>PlaySoundButton </strong></span>for the public <span class="strong"><strong>ButtonText</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_11.jpg"/></div></li><li class="listitem">With <span class="strong"><strong>PlaySoundButton</strong></span> selected in the <span class="strong"><strong>Hierarchy</strong></span> panel, create a new on-click event handler, dragging the <span class="strong"><strong>PlaySoundButton</strong></span> into the <span class="strong"><strong>Object</strong></span> slot, and selecting the <span class="strong"><strong>PlaySoundIfNotPlaying()</strong></span> function.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec265"/>How it works...</h2></div></div></div><p>The <span class="strong"><strong>Audio Source</strong></span> <a class="indexterm" id="id962"/>components have a public readable property <span class="strong"><strong>isPlaying</strong></span>, which is a Boolean true/false flag, indicating if the sound is currently playing. The text of the button is set to display <code class="literal">Play Sound</code> when the sound is not playing, and (<code class="literal">sound playing</code>) when it is. When the button is clicked, the <code class="literal">PlaySoundIfNotPlaying()</code> method is called. This method uses an <code class="literal">if</code> statement, ensuring that a <code class="literal">Play()</code> message is only sent to the Audio Source component if its <span class="strong"><strong>isPlaying</strong></span> is false.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec266"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Waiting for the audio to finish before auto-destructing an object</em></span> recipe in this chapter.</li></ul></div></div></div>
<div class="section" title="Waiting for audio to finish playing before auto-destructing an object"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec92"/>Waiting for audio to finish playing before auto-destructing an object</h1></div></div></div><p>An event may occur (such as an object pickup or the killing of an enemy) that we wish to notify to the player by playing an audio clip, and an associated visual object (such as an explosion particle system, or a temporary object in the location of the event). However, as soon as the clip has finished playing, we will wish for the visual object to be removed from the scene. This<a class="indexterm" id="id963"/> recipe provides a simple way to link the ending of a playing audio clip with the automatic destruction of its containing object.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec267"/>Getting ready</h2></div></div></div><p>Try this with any audio clip that is a second or more in duration. We have included the <code class="literal">engineSound</code> audio clip inside the <code class="literal">1362_09_04</code> folder.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec268"/>How to do it...</h2></div></div></div><p>To wait for<a class="indexterm" id="id964"/> audio to finish playing before destroying a GameObject, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create an <span class="strong"><strong>Empty</strong></span> GameObject and rename it to <span class="strong"><strong>AudioObject</strong></span>. Then, add an <span class="strong"><strong>Audio Source</strong></span> component to this object (in the <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Audio</strong></span> | <span class="strong"><strong>Audio Source</strong></span> menu).</li><li class="listitem">Import the <code class="literal">engineSound</code> audio clip and drag it from the <span class="strong"><strong>Project</strong></span> view to populate the <span class="strong"><strong>Audio Clip</strong></span> parameter of the <span class="strong"><strong>Audio Source</strong></span> component of <span class="strong"><strong>AudioObject</strong></span>, and deselect the component's <span class="strong"><strong>Play On Awake</strong></span> checkbox:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_12.jpg"/></div></li><li class="listitem">Add the following script class to <span class="strong"><strong>AudioObject</strong></span>:<div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class AudioDestructBehaviour : MonoBehaviour {
  private AudioSource audioSource;

  void Start(){
    audioSource = GetComponent&lt;AudioSource&gt;();
  }

  private void Update(){
    if( !audioSource.isPlaying )
      Destroy(gameObject);
  }
}</pre></div></li><li class="listitem">In <span class="strong"><strong>Inspector</strong></span> view, disable (un-check) the <code class="literal">AudioDestructBehaviour</code> scripted component of <span class="strong"><strong>AudioObject</strong></span> (when needed, it will be re-enabled via C# code):<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_13.jpg"/></div></li><li class="listitem">Create a<a class="indexterm" id="id965"/> new C# file named <span class="strong"><strong>ButtonActions</strong></span>, containing the following code:<div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class ButtonActions : MonoBehaviour{
  public AudioSource audioSource;
  public AudioDestructBehaviour audioDestructScriptedObject;

  public void PlaySound(){
    if( !audioSource.isPlaying )
      audioSource.Play();
  }

  public void DestroyAfterSoundStops(){
    audioDestructScriptedObject.enabled = true;
  }
}</pre></div></li><li class="listitem">Create a UI button named <span class="strong"><strong>PlaySoundButton</strong></span> on the screen with a button <code class="literal">Play Sound</code> text, and attach the <span class="strong"><strong>ButtonActions</strong></span> script to this button.</li><li class="listitem">With <span class="strong"><strong>PlaySoundButton</strong></span> selected in the <span class="strong"><strong>Hierarchy</strong></span>, create a new on-click event handler, dragging <span class="strong"><strong>PlaySoundButton</strong></span> into the <span class="strong"><strong>Object</strong></span> slot, and selecting the <span class="strong"><strong>PlaySound()</strong></span> function.</li><li class="listitem">With the <span class="strong"><strong>PlaySoundButton</strong></span> selected in the <span class="strong"><strong>Hierarchy</strong></span> panel, drag <span class="strong"><strong>AudioObject</strong></span> into the <span class="strong"><strong>Inspector</strong></span> view for the public <span class="strong"><strong>Audio Source</strong></span> variable <span class="strong"><strong>AudioObject</strong></span>. Also, drag <span class="strong"><strong>AudioObject</strong></span> into the <span class="strong"><strong>Inspector</strong></span> view for the public <span class="strong"><strong>Script</strong></span> variable <span class="strong"><strong>AudioDestructScriptedObject</strong></span>, shown as follows:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_14.jpg"/></div></li><li class="listitem">Create a second UI button named <span class="strong"><strong>DestoryWhenSoundFinishedButton</strong></span> on screen, with the button text <code class="literal">Destroy When Sound Finished</code>, and attach the <span class="strong"><strong>ButtonActions</strong></span> script to this button.</li><li class="listitem">With <span class="strong"><strong>DestoryWhenSoundFinishedButton</strong></span> selected in the <span class="strong"><strong>Hierarchy</strong></span> panel, create a new on-click event handler, dragging <span class="strong"><strong>PlaySoundButton</strong></span> into the <span class="strong"><strong>GO</strong></span> slot, and then selecting the <span class="strong"><strong>DestroyAfterSoundStops()</strong></span> function.</li><li class="listitem">Just as you did with the other button, now the <span class="strong"><strong>DestoryWhenSoundFinishedButton</strong></span> selected in the <span class="strong"><strong>Hierarchy</strong></span> panel, drag <span class="strong"><strong>AudioObject</strong></span> into the <span class="strong"><strong>Inspector</strong></span> view for the public <span class="strong"><strong>Script</strong></span> variable <span class="strong"><strong>MyAudioDestructObect</strong></span>.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec269"/>How it works...</h2></div></div></div><p>The GameObject<a class="indexterm" id="id966"/> named <span class="strong"><strong>AudioObject</strong></span> contains an Audio Source component, which stores and manages the playing of the audio clip. <span class="strong"><strong>AudioObject</strong></span> also contains a scripted component, which is an instance of the <span class="strong"><strong>AudioDestructBehaviour</strong></span> class. This script is initially disabled. When enabled, every frame this object (via its <code class="literal">Update()</code> method) tests whether the audio source is not playing (<code class="literal">!audio.isPlaying</code>). As soon as the audio is found to be not playing, the GameObject is destroyed.</p><p>There are two UI buttons created. Button <span class="strong"><strong>PlaySoundButton </strong></span>calls the <code class="literal">PlaySound()</code> method. This method will start playing the audio clip, if it is not already playing.</p><p>The second button called <span class="strong"><strong>DestoryWhenSoundFinishedButton</strong></span> calls the <code class="literal">DestoryAfterSoundStops()</code> method. This method enables the scripted component <span class="strong"><strong>AudioDestructBehaviour</strong></span> in GameObject <span class="strong"><strong>AudioObject</strong></span>—so that that GameObject will be destroyed, once the sound has finished playing.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec270"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Preventing an Audio Clip from restarting if it is already playing</em></span> recipe in this chapter</li></ul></div></div></div>
<div class="section" title="Adding volume control with Audio Mixers"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec93"/>Adding volume control with Audio Mixers</h1></div></div></div><p>Sound volume<a class="indexterm" id="id967"/> adjustment can be a very important feature, especially<a class="indexterm" id="id968"/> if your game is a standalone. After all, it can be very frustrating to access the operational system volume control. In this recipe, we will use the new <span class="strong"><strong>Audio Mixer</strong></span> feature to create independent volume controls for Music and Sound FX.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec271"/>Getting ready</h2></div></div></div><p>For this recipe, we have provided a Unity package named <code class="literal">Volume.unitypackage</code>, containing an initial scene featuring soundtrack music and sound effects. The file is available inside the <code class="literal">1362_09_05</code> folder.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec272"/>How to do it...</h2></div></div></div><p>To add volume control sliders to your scene, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Import <code class="literal">Volume.unitypackage</code> into your project.</li><li class="listitem">Open the <span class="strong"><strong>Volume</strong></span> scene (available in the <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Volume</strong></span> folder). Play the scene and walk towards the semitransparent green wall in the tunnel, using the <span class="emphasis"><em>W A S D</em></span> keys (while pressing the <span class="emphasis"><em>Shift</em></span> key to run). You will be able to listen to:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A looping soundtrack music</li><li class="listitem" style="list-style-type: disc">Bells ringing</li><li class="listitem" style="list-style-type: disc">A robotic speech whenever the character collides with the wall</li></ul></div></li><li class="listitem">From the <span class="strong"><strong>Project</strong></span> view, use the <span class="strong"><strong>Create</strong></span> drop-down menu to add <span class="strong"><strong>Audio Mixer</strong></span> to the project. Name it <span class="strong"><strong>MainMixer</strong></span>. Double-click on it to open the <span class="strong"><strong>Audio Mixer</strong></span> window.</li><li class="listitem">From the <span class="strong"><strong>Groups</strong></span> view, highlight <span class="strong"><strong>Master</strong></span> and click the <span class="strong"><strong>+</strong></span> sign to add a child to the <span class="strong"><strong>Master</strong></span> group. Name it <span class="strong"><strong>Music</strong></span>. Then, highlight <span class="strong"><strong>Master</strong></span> again and add a new child group named <span class="strong"><strong>FX</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_15.jpg"/></div></li><li class="listitem">From the <span class="strong"><strong>Mixers</strong></span> view, highlight <span class="strong"><strong>MainMixer</strong></span> and click the <span class="strong"><strong>+</strong></span> sign to add a new <span class="strong"><strong>Mixer</strong></span> to the project. Name it <span class="strong"><strong>MusicMixer</strong></span>. Then, drag it into the <span class="strong"><strong>MainMixer</strong></span> and select the <span class="strong"><strong>Music</strong></span> group as its <span class="strong"><strong>Output</strong></span>. Repeat the operation to add a mixer <a class="indexterm" id="id969"/>named <span class="strong"><strong>FxMixer</strong></span> to the project by selecting the <span class="strong"><strong>FX</strong></span> group as its output:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_16.jpg"/></div></li><li class="listitem">Now, select <span class="strong"><strong>MusicMixer</strong></span>. Select its<a class="indexterm" id="id970"/> <span class="strong"><strong>Master</strong></span> group and add a child named <span class="strong"><strong>Soundtrack</strong></span>. Then, select <span class="strong"><strong>FxMixer</strong></span> and add two children to its <span class="strong"><strong>Master</strong></span> group: one named <span class="strong"><strong>Speech</strong></span>, and another named <span class="strong"><strong>Bells</strong></span>, as shown:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_17.jpg"/></div></li><li class="listitem">From the <span class="strong"><strong>Hierarchy</strong></span> <a class="indexterm" id="id971"/>view, select the <span class="strong"><strong>DialogueTrigger</strong></span> object. Then, in the <span class="strong"><strong>Inspector</strong></span> view, change its<a class="indexterm" id="id972"/> <span class="strong"><strong>Output</strong></span> track to <span class="strong"><strong>FxMixer</strong></span> | <span class="strong"><strong>Speech</strong></span> in the <span class="strong"><strong>Audio Source</strong></span> component:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_18.jpg"/></div></li><li class="listitem">Now, select the <span class="strong"><strong>Soundtrack</strong></span> GameObject. From the <span class="strong"><strong>Inspector</strong></span> view, find the <span class="strong"><strong>Audio Source</strong></span> component and change its <span class="strong"><strong>Output</strong></span> track to <span class="strong"><strong>MusicMixer</strong></span> | <span class="strong"><strong>Soundtrack</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_19.jpg"/></div></li><li class="listitem">Finally, from<a class="indexterm" id="id973"/> the <span class="strong"><strong>Assets</strong></span> folder in the <span class="strong"><strong>Project</strong></span> view, select the <span class="strong"><strong>Signal</strong></span> prefab . From the <span class="strong"><strong>Inspector</strong></span> view, access its <span class="strong"><strong>Audio Source</strong></span> component and change its <span class="strong"><strong>Output</strong></span> to <span class="strong"><strong>FxMixer</strong></span> | <span class="strong"><strong>Bells</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_20.jpg"/></div></li><li class="listitem">From the <span class="strong"><strong>Audio Mixer</strong></span> window, choose <span class="strong"><strong>MainMixer</strong></span> and select its <span class="strong"><strong>Master</strong></span> track. Then, from the <span class="strong"><strong>Inspector</strong></span> view, right-click on <span class="strong"><strong>Volume</strong></span> in the <span class="strong"><strong>Attenuation</strong></span> component. From<a class="indexterm" id="id974"/> the context menu, select <span class="strong"><strong>Expose 'Volume (of Master) to script</strong></span> as shown in the following screenshot. Repeat the operation for the <span class="strong"><strong>Music and FX</strong></span> tracks:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_21.jpg"/></div></li><li class="listitem">From the top of the <span class="strong"><strong>Audio Mixer</strong></span> with the <span class="strong"><strong>MainMixer</strong></span> selected, access the <span class="strong"><strong>Exposed Parameters</strong></span> drop-down menu. Then, right-click on <span class="strong"><strong>MyExposedParam</strong></span> and rename it to <code class="literal">OverallVolume</code>. Then, rename <span class="strong"><strong>MyExposedParam1</strong></span> as <code class="literal">MusicVolume</code> and <span class="strong"><strong>MyExposedParam2</strong></span> as <code class="literal">FxVolume</code>.</li><li class="listitem">From the <span class="strong"><strong>Project</strong></span> view, create a new <span class="strong"><strong>C# Script</strong></span> and rename it to <code class="literal">VolumeControl</code>.</li><li class="listitem">Open the script in <a class="indexterm" id="id975"/>your editor and<a class="indexterm" id="id976"/> replace everything with the following code:<div class="informalexample"><pre class="programlisting">using UnityEngine;

using UnityEngine.Audio;
using System.Collections;

public class VolumeControl : MonoBehaviour{
  public AudioMixer myMixer;
  private GameObject panel;
  private bool isPaused = false;

  void Start(){
    panel = GameObject.Find("Panel");
    panel.SetActive(false);
  }

  void Update() {
    if (Input.GetKeyUp (KeyCode.Escape)) {
      panel.SetActive(!panel.activeInHierarchy);

      if(isPaused)
        Time.timeScale = 1.0f;
      else
        Time.timeScale = 0.0f;

      isPaused = !isPaused;
    }
  }

  public void ChangeMusicVol(float vol){
    myMixer.SetFloat ("MusicVolume", Mathf.Log10(vol) * 20f);
  }

  public void ChangeFxVol(float vol){
    myMixer.SetFloat ("FxVolume", Mathf.Log10(vol) * 20f);
  }

  public void ChangeOverallVol(float vol){
    myMixer.SetFloat ("OverallVolume", Mathf.Log10(vol) * 20f);
  }
}</pre></div></li><li class="listitem">From the <span class="strong"><strong>Hierarchy</strong></span> view, use the <span class="strong"><strong>Create</strong></span> dropdown menu to add a <span class="strong"><strong>Panel</strong></span> to the scene (<span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Panel</strong></span>). Note that it will automatically add a <span class="strong"><strong>Canvas</strong></span> to the scene.</li><li class="listitem">From the <span class="strong"><strong>Hierarchy</strong></span> view, use the <span class="strong"><strong>Create</strong></span> dropdown menu to add a <span class="strong"><strong>Slider</strong></span> to the scene (<span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Slider</strong></span>). Make it a child of the <span class="strong"><strong>Panel</strong></span> object.</li><li class="listitem">Rename the slider as <span class="strong"><strong>OverallSlider</strong></span>. Duplicate it and rename the new copy to <span class="strong"><strong>MusicSlider</strong></span>. Then, in the <span class="strong"><strong>Inspector</strong></span> view, <span class="strong"><strong>Rect Transform</strong></span> component, change its <span class="strong"><strong>Pos Y</strong></span> <a class="indexterm" id="id977"/>parameter to <code class="literal">-40</code>.</li><li class="listitem">Duplicate <span class="strong"><strong>MusicSlider</strong></span> <a class="indexterm" id="id978"/>and rename the new copy to <span class="strong"><strong>FxSlider</strong></span>. Then, change its <span class="strong"><strong>Pos Y</strong></span> parameter to <code class="literal">-70</code>:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_22.jpg"/></div></li><li class="listitem">Select the <span class="strong"><strong>Canvas</strong></span> GameObject and add the <span class="strong"><strong>VolumeControl</strong></span> script to it. Then, populate the <span class="strong"><strong>MyMixer</strong></span> field of <span class="strong"><strong>Volume Control</strong></span> with <span class="strong"><strong>MainMixer</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_23.jpg"/></div></li><li class="listitem">Select the <span class="strong"><strong>OverallSlider</strong></span> component. From the <span class="strong"><strong>Inspector</strong></span> view at the <span class="strong"><strong>Slider</strong></span> component, change <span class="strong"><strong>Min Value</strong></span> to <code class="literal">0.000025</code> (or <span class="strong"><strong>2.5e-05</strong></span>). Then, below the <span class="strong"><strong>On Value Changed</strong></span> list, click the <span class="strong"><strong>+</strong></span> sign to add an action. From <span class="strong"><strong>Hierarchy</strong></span> panel, drag <a class="indexterm" id="id979"/><span class="strong"><strong>Canvas</strong></span> into the <span class="strong"><strong>Object</strong></span> slot and <a class="indexterm" id="id980"/>using the drop-down menu, choose<span class="strong"><strong> VolumeControl</strong></span> | <span class="strong"><strong>ChangeOverallVol</strong></span> option, as shown in the following screenshot, For testing purposes, change the appropriate selector from  <span class="strong"><strong>Runtime Only</strong></span> to <span class="strong"><strong>Editor and Runtime</strong></span>.<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_24.jpg"/></div></li><li class="listitem">Repeat the previous step with <span class="strong"><strong>MusicSlider</strong></span> and <span class="strong"><strong>FxSlider</strong></span>, but this time, choose <span class="strong"><strong>ChangeMusicVol</strong></span> and <span class="strong"><strong>ChangeFxVol</strong></span> options respectively from the drop-down menu.</li><li class="listitem">Play the scene. You will be able to access the sliders when pressing <span class="emphasis"><em>Escape</em></span> on your keyboard and adjust volume settings from there.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec273"/>How it works...</h2></div></div></div><p>The new <span class="strong"><strong>Audio Mixer</strong></span> feature works in a similar fashion to Digital Audio Workstations, such as Logic and Sonar. Through <span class="strong"><strong>Audio Mixers</strong></span>, you can organize and manage audio elements by routing them into specific groups that can have individual audio tracks to be tweaked around, allowing for adjustments in volume level and sound effects.</p><p>By organizing and routing <a class="indexterm" id="id981"/>our audio clips into two groups (<span class="strong"><strong>Music</strong></span> and <span class="strong"><strong>FX</strong></span>), we established the <span class="strong"><strong>MainMixer</strong></span> as a unified controller for volume. Then, we have used the <span class="strong"><strong>Audio Mixer</strong></span> to expose the volume levels for each track of the <span class="strong"><strong>MainMixer</strong></span>, making them accessible to our script.</p><p>Also, we have set<a class="indexterm" id="id982"/> up a basic GUI featuring three sliders that, when in use, will pass their float values (between <code class="literal">0.000025</code> and <code class="literal">1</code>) as arguments to three specific functions in our script: <code class="literal">ChangeMusicVol</code>, <code class="literal">ChangeFxVol</code>, and <code class="literal">ChangeOverallVol</code>. These functions, on their turn, use the <code class="literal">SetFloat</code> command to effectively change the volume levels at runtime. However, before passing on the new volume levels, the script converts linear values (between <code class="literal">0.000025</code> and <code class="literal">1</code>) to the decibel levels that are used by the <span class="strong"><strong>Audio Mixer</strong></span>. This conversion is calculated through the <span class="emphasis"><em>log(x) * 20</em></span> mathematical function.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note43"/>Note</h3><p>For a full explanation on issues regarding the conversion of linear values to decibel levels and vice-versa, check out Aaron Brown's excellent article at <a class="ulink" href="http://www.playdotsound.com/portfolio-item/decibel-db-to-float-value-calculator-making-sense-of-linear-values-in-audio-tools/">http://www.playdotsound.com/portfolio-item/decibel-db-to-float-value-calculator-making-sense-of-linear-values-in-audio-tools/</a>.</p></div></div><p>It's worth mentioning that the <code class="literal">VolumeControl</code> script also includes code to enable and disable the <span class="strong"><strong>GUI</strong></span> and<a class="indexterm" id="id983"/> the<a class="indexterm" id="id984"/> <span class="strong"><strong>EventSystem</strong></span>, depending upon if the player hits the Escape key to activate/deactivate the volume control sliders.</p><p>A very important note—do not change the volume of any <span class="strong"><strong>MainMixer'</strong></span>s tracks; leave them at <code class="literal">0</code> dB. The reason is that our <code class="literal">VolumeControl</code> script sets their maximum volume level. For general adjustments, use the secondary Mixers <span class="strong"><strong>MusicMixer</strong></span> and <span class="strong"><strong>FxMixer</strong></span>.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec274"/>There's more...</h2></div></div></div><p>Here is some extra information<a class="indexterm" id="id985"/> on Audio Mixers.</p><div class="section" title="Playing with Audio Production"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec69"/>Playing with Audio Production</h3></div></div></div><p>There are many <a class="indexterm" id="id986"/>creative uses for exposed parameters. We can, for instance, add effects<a class="indexterm" id="id987"/> such as <span class="strong"><strong>Distortion</strong></span>, <span class="strong"><strong>Flange</strong></span>, and <span class="strong"><strong>Chorus</strong></span> to audio<a class="indexterm" id="id988"/> channels, allowing users to operate virtual sound tables/mixing<a class="indexterm" id="id989"/> boards.</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec275"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Making a dynamic soundtrack with Snapshots</em></span> recipe in this chapter</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Balancing the in-game audio with Ducking</em></span> in this chapter</li></ul></div></div></div>
<div class="section" title="Making a dynamic soundtrack with Snapshots"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec94"/>Making a dynamic soundtrack with Snapshots</h1></div></div></div><p>Dynamic soundtracks are the<a class="indexterm" id="id990"/> ones that change according to what is happening to the player in the game, musically reflecting that place or moment of the character's adventure. In this recipe, we will implement a soundtrack that changes twice; the first time when entering a tunnel, and the second time when coming out of its end. To achieve this, we will use the new <span class="strong"><strong>Snapshot</strong></span> feature of the <span class="strong"><strong>Audio Mixer</strong></span>.</p><p>Snapshots are a way of saving the state of your <span class="strong"><strong>Audio Mixer</strong></span>, keeping your preferences for volume levels, audio effects, and more. We can access these states through script, creating transitions between mixes, and by bringing up the desired sonic ambience for each moment of the player's journey.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec276"/>Getting ready</h2></div></div></div><p>For this recipe, we have prepared a basic game level, contained inside the Unity package named <code class="literal">DynamicSoundtrack</code>, and two soundtrack audio clips in <code class="literal">.ogg</code> format: <code class="literal">Theme01_Percussion</code> and <code class="literal">Theme01_Synths</code>. All these files can be found in the <code class="literal">1362_09_06</code> folder.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec277"/>How to do it...</h2></div></div></div><p>To make a dynamic soundtrack, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Import the <code class="literal">DynamicSoundtrack</code> package and both <code class="literal">.ogg</code> files to your Unity Project.</li><li class="listitem">Open the level named <span class="strong"><strong>Dynamic</strong></span>.</li><li class="listitem">From the <span class="strong"><strong>Project</strong></span> view, use the <span class="strong"><strong>Create</strong></span> drop-down menu to add <span class="strong"><strong>Audio Mixer</strong></span> to the project. Name it <span class="strong"><strong>MusicMixer</strong></span>. Double-click on it to open the <span class="strong"><strong>Audio Mixer</strong></span> window.</li><li class="listitem">From the <span class="strong"><strong>Groups</strong></span> view, highlight <span class="strong"><strong>Master</strong></span> and click the <span class="strong"><strong>+</strong></span> sign to add a child to the <span class="strong"><strong>Master</strong></span><a class="indexterm" id="id991"/> group. Name it as <span class="strong"><strong>Music</strong></span>. Then, add two child groups to <span class="strong"><strong>Music</strong></span>: <span class="strong"><strong>Percussion </strong></span>and <span class="strong"><strong>Synths</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_25.jpg"/></div></li><li class="listitem">From the <span class="strong"><strong>Hierarchy</strong></span> view, create a new <span class="strong"><strong>Empty</strong></span> GameObject. Name it <span class="strong"><strong>Music</strong></span>. Then, add two <span class="strong"><strong>Empty Child</strong></span> GameObjects to it. Name them as <span class="strong"><strong>Percussion</strong></span> and <span class="strong"><strong>Synth</strong></span>.</li><li class="listitem">From the <span class="strong"><strong>Project</strong></span> view, drag the <span class="strong"><strong>Audio Clip</strong></span> named <span class="strong"><strong>Theme01_Percussion </strong></span>into the <span class="strong"><strong>Percussion</strong></span> GameObject in <span class="strong"><strong>Hierarchy</strong></span>. Select <span class="strong"><strong>Percussion</strong></span> and in the <span class="strong"><strong>Inspector</strong></span> view, access the <span class="strong"><strong>Audio Source</strong></span> component. Change its <span class="strong"><strong>Output</strong></span> to <span class="strong"><strong>Percussion (MusicMixer)</strong></span>, make sure the <span class="strong"><strong>Play On Awake</strong></span> option is checked, check the <span class="strong"><strong>Loop</strong></span> option, and make sure its <span class="strong"><strong>Spatial Blend</strong></span> is set to <span class="strong"><strong>2D</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_26.jpg"/></div></li><li class="listitem">Now, drag the <a class="indexterm" id="id992"/><span class="strong"><strong>Theme01_Synths</strong></span> audio file into the <span class="strong"><strong>Synths</strong></span> GameObject. From the <span class="strong"><strong>Inspector</strong></span> view, change its <span class="strong"><strong>Output</strong></span> to <span class="strong"><strong>Synths (MusicMixer)</strong></span>, make sure the <span class="strong"><strong>Play On Awake</strong></span> option is checked, check the <span class="strong"><strong>Loop</strong></span> option, and make sure its <span class="strong"><strong>Spatial Blend</strong></span> is set to <span class="strong"><strong>2D</strong></span>, as shown:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_27.jpg"/></div></li><li class="listitem">Open the <span class="strong"><strong>Audio Mixer</strong></span> and play the scene. We will now use the mixer to set the soundtrack for the start of the scene. With the scene playing, click on the <span class="strong"><strong>Edit in Play Mode</strong></span><a class="indexterm" id="id993"/> button, as shown in the screenshot, at the top of the <span class="strong"><strong>Audio Mixer</strong></span>. Then, drop the volume on the <span class="strong"><strong>Synths</strong></span> track down to <span class="strong"><strong>-30 dB</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_28.jpg"/></div></li><li class="listitem">Now, select the <span class="strong"><strong>Percussion</strong></span> track. Right-click on <span class="strong"><strong>Attenuation</strong></span> and add the <span class="strong"><strong>High-pass</strong></span> effect before it:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_29.jpg"/></div></li><li class="listitem">From the<a class="indexterm" id="id994"/> <span class="strong"><strong>Inspector</strong></span> view, change the <span class="strong"><strong>Cutoff frequency</strong></span> of the <span class="strong"><strong>High-pass</strong></span> effect to <span class="strong"><strong>544.00 Hz</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_30.jpg"/></div></li><li class="listitem">Every change, so far, has been assigned to the current <span class="strong"><strong>Snapshot</strong></span>. From the <span class="strong"><strong>Snaphots</strong></span> view, right-click on the current <span class="strong"><strong>Snapshot</strong></span> and rename it to <span class="strong"><strong>Start</strong></span>. Then, right-click on <span class="strong"><strong>Start</strong></span> and select the <span class="strong"><strong>Duplicate</strong></span> option. Rename the new snapshot as <span class="strong"><strong>Tunnel</strong></span>, as shown:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_31.jpg"/></div></li><li class="listitem">Select the <span class="strong"><strong>Tunnel</strong></span> snapshot. Then, from the <span class="strong"><strong>Inspector</strong></span> view, change the <span class="strong"><strong>Cutoff frequency</strong></span> of the <span class="strong"><strong>Highpass</strong></span> effect to <span class="strong"><strong>10.00 Hz</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_32.jpg"/></div></li><li class="listitem">Switch<a class="indexterm" id="id995"/> between the <span class="strong"><strong>Tunnel</strong></span> and <span class="strong"><strong>Start</strong></span> snapshots. You'll be able to hear the difference.</li><li class="listitem">Duplicate the <span class="strong"><strong>Tunnel</strong></span> snapshot, rename it as <span class="strong"><strong>OtherSide</strong></span>, and select it.</li><li class="listitem">Raise the volume of the <span class="strong"><strong>Synths</strong></span> track up to <span class="strong"><strong>0 dB</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_33.jpg"/></div></li><li class="listitem">Now that we have our three <span class="strong"><strong>Snapshots</strong></span>, it's time to create triggers to make transitions among them. From the <span class="strong"><strong>Hierarchy</strong></span> view, use the <span class="strong"><strong>Create</strong></span> drop-down menu to add a <span class="strong"><strong>Cube</strong></span> to the scene (<span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>3D Object</strong></span> | <span class="strong"><strong>Cube</strong></span>).</li><li class="listitem">Select the new <a class="indexterm" id="id996"/><span class="strong"><strong>Cube</strong></span> and rename it <code class="literal">SnapshotTriggerTunnel</code>. Then, from the <span class="strong"><strong>Inspector</strong></span> view, access the <span class="strong"><strong>Box Collider</strong></span> component and check the <span class="strong"><strong>Is Trigger</strong></span> option, as shown in the following screenshot. Also, uncheck its <span class="strong"><strong>Mesh Renderer</strong></span> component. Finally, adjust its size and position to the scene tunnel's interior:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_34.jpg"/></div></li><li class="listitem">Make two copies of <code class="literal">SnapshotTriggerTunnel</code> and rename them to <code class="literal">SnapshotTriggerStart</code> and <code class="literal">SnapshotTriggerOtherSide</code>. Then, adjust their size and position, so that they occupy the areas before the tunnel's entrance (where the character is) and after its other end, as shown in the following screenshot:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_35.jpg"/></div></li><li class="listitem">In the <span class="strong"><strong>Project</strong></span> <a class="indexterm" id="id997"/>view, create a new <span class="strong"><strong>C# Script</strong></span> file and rename it to <code class="literal">SnapshotTrigger</code>.</li><li class="listitem">Open the script in your editor and replace everything with the following code:<div class="informalexample"><pre class="programlisting">using UnityEngine;
using UnityEngine.Audio;
using System.Collections;

public class SnapshotTrigger : MonoBehaviour{
  public AudioMixerSnapshot snapshot;
  public float crossfade;

  private void OnTriggerEnter(Collider other){
    snapshot.TransitionTo (crossfade);
  }
}</pre></div></li><li class="listitem">Save your script and attach it to <code class="literal">SnapshotTriggerTunnel</code>, <code class="literal">SnapshotTriggerStart</code>, and <code class="literal">SnapshotTriggerOtherSide</code> objects.</li><li class="listitem">Select <code class="literal">SnapshotTriggerTunnel</code>. Then, from the <span class="strong"><strong>Inspector</strong></span> view, access the <span class="strong"><strong>Snapshot Trigger</strong></span> component, setting <span class="strong"><strong>Snapshot</strong></span> as <span class="strong"><strong>Tunnel</strong></span>, and <span class="strong"><strong>Crossfade</strong></span> as <code class="literal">2</code>, as shown in the following screenshot:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_36.jpg"/></div></li><li class="listitem">Make changes to <code class="literal">SnapshotTriggerStart</code> and <code class="literal">SnapshotTriggerOtherSide</code> by setting their <span class="strong"><strong>Snapshots</strong></span> to <span class="strong"><strong>Start</strong></span> and <span class="strong"><strong>OtherSide</strong></span> respectively.</li><li class="listitem">Test the scene. The <a class="indexterm" id="id998"/>background music will change as the character moves from its starting point, through the tunnel, and into the other side.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec278"/>How it works...</h2></div></div></div><p>The <span class="strong"><strong>Snapshot</strong></span> feature allows you to save <span class="strong"><strong>Audio Mixer</strong></span> states (including all volume levels, every filter setting, and so on) so that you can change those mixing preferences at runtime, making the audio design more suitable for specific locations or gameplay settings. For this recipe, we have created three <span class="strong"><strong>Snapshots</strong></span> for different moments in the player's journey: before entering the tunnel, inside the tunnel, and outside the tunnel. We have used the <span class="strong"><strong>Highpass</strong></span> filter to make the initial Snapshot less intense. We have also turned the <span class="strong"><strong>Synths</strong></span> track volume up to emphasize the open environment outside the tunnel. Hopefully, changes in the audio mix will collaborate with setting the right mood for the game.</p><p>To activate our snapshots, we have placed <span class="strong"><strong>trigger colliders</strong></span>, featuring our <span class="strong"><strong>Snapshot Trigger</strong></span> component in which we set the desired Snapshot and the time in seconds, that it takes to make the transition (a crossfade) between the previous Snapshot and the next. In fact, the function in<a class="indexterm" id="id999"/> our script is really this straightforward—the line of <code class="literal">snapshot.TransitionTo (crossfade)</code> code simply starts a transition lasting <code class="literal">crossfade</code> seconds to the desired <code class="literal">Snapshot</code>.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec279"/>There's more...</h2></div></div></div><p>Here is some information on how to fine-tune and customize this recipe.</p><div class="section" title="Reducing the need for multiple audio clips"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec70"/>Reducing the need for multiple audio clips</h3></div></div></div><p>You might have <a class="indexterm" id="id1000"/>noticed how different the <code class="literal">Theme01_Percussion</code> audio clip sounds when the <span class="strong"><strong>Cutoff frequency</strong></span> of the <span class="strong"><strong>High-pass</strong></span> filter is set as <code class="literal">10.00 Hz</code>. The reason for this is that the high-pass filter, as its name suggests, cuts off lower frequencies of the audio signal. In this case, it attenuated the bass drum down to inaudible levels while keeping the shakers audible. The opposite effect can be achieved through the <span class="strong"><strong>Lowpass</strong></span> filter. A major benefit is the opportunity of virtually having two separate tracks into the same audio clip.</p></div><div class="section" title="Dealing with audio file formats and compression rates"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec71"/>Dealing with audio file formats and compression rates</h3></div></div></div><p>To avoid loss of<a class="indexterm" id="id1001"/> audio quality, you should import your<a class="indexterm" id="id1002"/> sound clips using the appropriate file format, depending upon your target platform. If you are not sure which format to use, please check out Unity's documentation on the subject at <a class="ulink" href="http://docs.unity3d.com/Manual/AudioFiles.html">http://docs.unity3d.com/Manual/AudioFiles.html</a>.</p></div><div class="section" title="Applying Snapshots to background noise"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec72"/>Applying Snapshots to background noise</h3></div></div></div><p>Although we have applied Snapshots to our music soundtrack, background noise can also benefit immensely. If <a class="indexterm" id="id1003"/>your character travels across places that are significantly different, transitioning from open spaces to indoor environments, you should consider applying snapshots to your environment audio mix. Be careful, however, to create separate Audio Mixers for Music and Environment—unless you don't mind having musical and ambient sound tied to the same Snapshot.</p></div><div class="section" title="Getting creative with effects"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec73"/>Getting creative with effects</h3></div></div></div><p>In this recipe, we have<a class="indexterm" id="id1004"/> mentioned the High-pass and Low-pass filters. However, there are many effects that can make audio clips sound radically different. Experiment! Try applying effects such as Distortion, Flange, and Chorus. In fact, we encourage you to try every effect, playing with their settings. The creative use of these effects can bring out different expressions to a single audio clip.</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec280"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Adding volume control with Audio Mixers</em></span> recipe in this chapter</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Balancing soundtrack volume with Ducking</em></span> recipe<a class="indexterm" id="id1005"/> in this chapter</li></ul></div></div></div>
<div class="section" title="Balancing in-game audio with Ducking"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec95"/>Balancing in-game audio with Ducking</h1></div></div></div><p>As much as the background music can be important in establishing the right atmosphere, there will be times when other audio clips should be emphasized, and the music volume turned down for the <a class="indexterm" id="id1006"/>duration of that clip. This effect is known as <span class="strong"><strong>Ducking</strong></span>. Maybe you will need it for dramatic effect (simulating hearing loss after an explosion took place), or maybe you want to make sure that the player listens to a specific bit <a class="indexterm" id="id1007"/>of information. In this recipe, we will learn how to emphasize a piece of dialog by ducking the audio whenever a specific sound message is played. For that effect, we will use the new <span class="strong"><strong>Audio Mixer</strong></span> to send information between tracks.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec281"/>Getting ready</h2></div></div></div><p>For this recipe, we have provided the <code class="literal">soundtrack.mp3</code> audio clip and a Unity package named <code class="literal">Ducking.unitypackage</code>, containing an initial scene. All these files are available inside the <code class="literal">1362_09_07</code> folder.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec282"/>How to do it...</h2></div></div></div><p>To apply Audio<a class="indexterm" id="id1008"/> Ducking to your soundtrack, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Import <code class="literal">Ducking.unitypackage</code> and <code class="literal">soundtrack.mp3</code> into your project.</li><li class="listitem">Open the <span class="strong"><strong>Ducking</strong></span> scene (available in the <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Ducking</strong></span> folder). Play the scene and walk towards the semitransparent green wall in the tunnel, using the <span class="emphasis"><em>W A S D</em></span> keys (by pressing <span class="emphasis"><em>Shift</em></span> to run). You will hear the <span class="strong"><strong>robotDucking</strong></span> audio clip play as the character collides with the wall.</li><li class="listitem">From the <span class="strong"><strong>Create</strong></span> drop-down at the top of the <span class="strong"><strong>Hierarchy</strong></span> view, choose <span class="strong"><strong>Create Empty</strong></span> to add a new GameObject to the scene. Name it <span class="strong"><strong>Soundtrack</strong></span>.</li><li class="listitem">Drag the <span class="strong"><strong>soundtrack</strong></span> audio clip you have imported into the <span class="strong"><strong>Soundtrack</strong></span> GameObject. Then, select the <span class="strong"><strong>Soundtrack</strong></span> object and from the <span class="strong"><strong>Inspector</strong></span> view, <span class="strong"><strong>Audio Source</strong></span> component, check the <span class="strong"><strong>Loop</strong></span> option. Make sure the <span class="strong"><strong>Play On Awake</strong></span> option is checked and <span class="strong"><strong>Spatial Blend</strong></span> set to <span class="strong"><strong>2D</strong></span>, as shown in the following in the following screenshot:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_37.jpg"/></div></li><li class="listitem">Test the scene again. The soundtrack music should be playing.</li><li class="listitem">From the <span class="strong"><strong>Project</strong></span> view, use the <span class="strong"><strong>Create</strong></span> drop-down menu to add an <span class="strong"><strong>Audio Mixer</strong></span> to the project. Name it <span class="strong"><strong>MainMixer</strong></span>. Double-click on it to open the <span class="strong"><strong>Audio Mixer</strong></span><a class="indexterm" id="id1009"/> window.</li><li class="listitem">From the <span class="strong"><strong>Groups</strong></span> view, highlight <span class="strong"><strong>Master</strong></span> and click the <span class="strong"><strong>+</strong></span> sign to add a child to the <span class="strong"><strong>Master</strong></span> group. Name it <span class="strong"><strong>Music</strong></span>. Then, highlight <span class="strong"><strong>Master</strong></span> again and add a new child group named <span class="strong"><strong>FX</strong></span>, as shown in the following screenshot. Finally, add a third child to the <span class="strong"><strong>Master</strong></span> group, named <span class="strong"><strong>Input</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_38.jpg"/></div></li><li class="listitem">From the <span class="strong"><strong>Mixers</strong></span> view, highlight <span class="strong"><strong>MainMixer</strong></span> and click the <span class="strong"><strong>+</strong></span> sign to add a new <span class="strong"><strong>Mixer</strong></span> to the project. Name it <span class="strong"><strong>MusicMixer</strong></span>. Then, drag it into the <span class="strong"><strong>MainMixer</strong></span> and select the group <span class="strong"><strong>Music</strong></span> as its <span class="strong"><strong>Output</strong></span>. Repeat the operation to add a mixer <a class="indexterm" id="id1010"/>named <span class="strong"><strong>FxMixer</strong></span> to the project, selecting the <span class="strong"><strong>FX</strong></span> group as the output:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_39.jpg"/></div></li><li class="listitem">Now, select <span class="strong"><strong>MusicMixer</strong></span>. Select its <span class="strong"><strong>Master</strong></span> group and add a child named <span class="strong"><strong>Soundtrack</strong></span>. Then, select <span class="strong"><strong>FxMixer</strong></span> and add a child named <span class="strong"><strong>Bells</strong></span>, as shown:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_40.jpg"/></div></li><li class="listitem">From the <span class="strong"><strong>Hierarchy</strong></span> view, select the <span class="strong"><strong>DialogueTrigger</strong></span> object. Then, in the <span class="strong"><strong>Inspector</strong></span> view, <span class="strong"><strong>Audio Source</strong></span> component, Change its <span class="strong"><strong>Output</strong></span> track to <span class="strong"><strong>MainMixer</strong></span> | <span class="strong"><strong>Input</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_41.jpg"/></div></li><li class="listitem">Now, select the <span class="strong"><strong>Soundtrack</strong></span> GameObject and in the <span class="strong"><strong>Inspector</strong></span> view, in the <span class="strong"><strong>Audio Source</strong></span> component, change its <span class="strong"><strong>Output</strong></span> track to <span class="strong"><strong>MusicMixer</strong></span> | <span class="strong"><strong>Soundtrack</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_42.jpg"/></div></li><li class="listitem">Finally, from<a class="indexterm" id="id1011"/> the <span class="strong"><strong>Assets</strong></span> folder in the <span class="strong"><strong>Project</strong></span> view, select the <span class="strong"><strong>Signal</strong></span> prefab. From the <span class="strong"><strong>Inspector</strong></span> view, access its the <span class="strong"><strong>Audio Source</strong></span> component and change its <span class="strong"><strong>Output</strong></span> to <span class="strong"><strong>FxMixer</strong></span> | <span class="strong"><strong>Bells</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_43.jpg"/></div></li><li class="listitem">Open the<a class="indexterm" id="id1012"/> <span class="strong"><strong>Audio Mixer</strong></span> window. Choose <span class="strong"><strong>MainMixer</strong></span>, select the <span class="strong"><strong>Music</strong></span> track controller, right-click on <span class="strong"><strong>Attenuation</strong></span>, and using the context menu, add the <span class="strong"><strong>Duck Volume</strong></span> effect before <span class="strong"><strong>Attenuation</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_44.jpg"/></div></li><li class="listitem">Now, select the <span class="strong"><strong>Input</strong></span> track, right-click on <span class="strong"><strong>Attenuation</strong></span>, and using the context menu, add <span class="strong"><strong>Send</strong></span> after <span class="strong"><strong>Attenuation</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_45.jpg"/></div></li><li class="listitem">With <span class="strong"><strong>Input</strong></span><a class="indexterm" id="id1013"/> track still selected, go to the <span class="strong"><strong>Inspector</strong></span> view and change the <span class="strong"><strong>Receive</strong></span> setting in <span class="strong"><strong>Send</strong></span> to <span class="strong"><strong>Music\Duck Volume</strong></span> and its <span class="strong"><strong>Send</strong></span> level to <code class="literal">0.00 db</code>, as shown:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_46.jpg"/></div></li><li class="listitem">Select the <span class="strong"><strong>Music</strong></span> track. From the <span class="strong"><strong>Inspector</strong></span> view, change the settings on the <span class="strong"><strong>Duck Volume</strong></span> as follows: <span class="strong"><strong>Threshold</strong></span>: -<code class="literal">40.00 db</code>; <span class="strong"><strong>Ratio</strong></span>: <code class="literal">300.00 %</code>; <span class="strong"><strong>Attack Time</strong></span>: <code class="literal">100.00 ms</code>; <span class="strong"><strong>Release Time</strong></span>: <code class="literal">2000.00 ms</code>, as shown in the following screenshot:<div class="mediaobject"><img alt="How to do it..." src="graphics/1362_09_47.jpg"/></div></li><li class="listitem">Test the scene again. Entering the trigger object will cause the soundtrack volume to drop considerably, recovering the original volume in 2 seconds.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec283"/>How it works...</h2></div></div></div><p>In this recipe, we have created, in addition to Music and Sound FX, a group named <span class="strong"><strong>Input</strong></span>, to which we<a class="indexterm" id="id1014"/> have routed the audio clip that triggers the <span class="strong"><strong>Duck Volume</strong></span> effect attached to our music track. The <span class="strong"><strong>Duck Volume</strong></span> effect changes the track's volume whenever it receives an input that is louder than indicated in its <span class="strong"><strong>Threshold</strong></span> setting. In our case, we have sent the <span class="strong"><strong>Input</strong></span> track as input, and adjusted the settings so the volume will be reduced as soon as 0.1 seconds after the input had been received, turning back to its original value of 2 seconds after the input has ceased. The amount of volume reduction was determined by our <span class="strong"><strong>Ratio</strong></span> of <span class="strong"><strong>300.00 %</strong></span>. Playing around with the setting values will give you a better idea on how each parameter affects the final result. Also, make sure to visualize the graphic as the trigger sound is played. You will be able to see how the <span class="strong"><strong>Input</strong></span> sound passes the threshold, triggering the effect.</p><div class="mediaobject"><img alt="How it works..." src="graphics/1362_09_48.jpg"/><div class="caption"><p>Duck Volume</p></div></div><p>Also, please note that we have organized our tracks so that the other sound clips (other than speech) will not <a class="indexterm" id="id1015"/>affect the volume of the music—but every music clip will be affected by audio clips sent to the input track.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec284"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Adding volume control with Audio Mixers</em></span> recipe in this chapter</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Making a dynamic soundtrack with Snapshots</em></span> recipe in this chapter</li></ul></div></div></div></body></html>