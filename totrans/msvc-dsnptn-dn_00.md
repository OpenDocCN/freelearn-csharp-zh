# 前言

嗨，大家好！我们在这里是为了探索在设计和发展模式中我们可以利用的，当我们使用 .NET 构建微服务应用程序时。微服务架构涉及将可能复杂的应用程序分解成更小、更易于维护的服务，这些服务必须协同工作。本质上，我们取一个大的应用程序并将其分解成更小的部分。

这种方法在应用程序的设计中引入了一系列新的复杂性，因为这些现在分离的服务需要协作以向最终用户提供统一体验。因此，我们需要了解这种架构方法的缺点，并制定策略来解决各种问题。

我们将专注于使用 .NET，因为微软在发布和支持顶级工具和支持最新技术方面有着良好的记录，这些技术使我们能够开发前沿的解决方案。我们专注于使用 .NET 的原因如下：

+   **维护良好**：微软不断推动边界，引入新的方法来完成旧事物，以及新的方法来实现解决方案并提高生产力。这是一个维护良好、受支持且文档齐全的生态系统。

+   **性能**：.NET 在每个新版本中都提高了性能。微服务必须尽可能高效和响应迅速，以确保最终用户的体验尽可能干净。

+   **跨平台**：.NET Core 是跨平台的，几乎可以在任何技术栈上部署。这减少了使用 .NET 技术编写的服务的部署和支持限制。

+   **支持各种技术**：每个问题都有一种技术帮助我们实施解决方案。.NET 支持许多技术，使其成为通用开发需求的优秀候选者。

我们希望确保我们了解在基于微服务架构开发应用程序时所需的可能性和策略。我们将回顾每个问题的理论背景，然后探讨潜在解决方案和技术，这些解决方案和技术帮助我们实施最佳解决方案，以应对我们在开发解决方案时面临的挑战。

# 这本书面向的对象

这本书是为希望揭开微服务架构各种组成部分神秘面纱的 .NET 开发者设计的。为了最大限度地利用本书，你最好符合以下类别之一：

+   **团队领导**：需要理解各种组成部分以及需要做出的设计决策背后的理论

+   **高级开发者**：需要理解如何指导开发工作并实现复杂代码块的开发者

+   **中级 .NET 开发者**：对 .NET 生态系统有实际了解的 .NET 开发者，希望深入了解开发更复杂解决方案

本书整体内容将帮助您理解微服务应用程序设计的动态性，并帮助您达到开发的新水平。

# 本书涵盖的内容

*第一章*, *微服务简介* *–* *全景图*，从高层次上审视微服务架构，并试图理解我们可能遇到的早期问题，并探讨解决这些问题的设计模式。

*第二章*, *使用聚合模式工作*，探讨了领域驱动设计和聚合模式如何为需求范围和微服务设计奠定基础。

*第三章*, *微服务间的同步通信*，探讨了如何使微服务同步通信及其潜在缺点。

*第四章*, *微服务间的异步通信*，考察了服务间的异步通信，这允许我们在调用其他微服务时发送数据并继续前进，无论其可用性或潜在的长时间运行。

*第五章*, *使用 CQRS 模式工作*，探讨了 CQRS 模式及其在微服务开发中的实用性。

*第六章*, *应用事件源模式*，讨论了事件源技术的复杂性以及我们如何实现它以确保服务间数据保持同步。

*第七章*, *使用每个服务一个数据库模式处理每个微服务的数据*，涵盖了在不同服务中实现不同数据库的最佳实践。

*第八章*, *使用 Saga 模式在微服务间实现事务*，探讨了 Saga 模式及其如何帮助我们实现微服务间的事务处理。

*第九章*, *构建弹性微服务*，回顾了实现重试和退出策略逻辑，以增强服务间通信的弹性。

*第十章*, *对您的服务进行健康检查*，回顾了如何在 ASP.NET Core API 中实现健康检查以及为什么它们是必不可少的。

*第十一章*, *实现 API 和 BFF 网关模式*，深入探讨了 API 网关、前端后端模式以及它们如何帮助我们创建一个健壮的微服务应用程序。

*第十二章*, *使用 Bearer Tokens 保护微服务安全*，回顾了如何使用 Bearer Tokens 来保护每个服务之间的通信。

*第十三章*, *微服务容器托管*，探讨了容器化以及我们如何利用容器高效地托管微服务。

*第十四章*，*为微服务实现集中式日志记录*，探讨了将多个服务的日志聚合到一个查看区域中的步骤和最佳实践。

*第十五章*，*总结全文*，讨论了每一章的关键点，并强调了每一章在开发微服务应用程序中的作用。

# 要充分利用本书

您需要具备使用 ASP.NET Core 进行 API 开发的知识以及基本的数据库开发知识。本书最适合希望提高对开发设计模式理解的中级开发者。

| **本书涵盖的软件/硬件** | **操作系统要求** |
| --- | --- |
| ASP.NET Core 6/7 | Windows、macOS 或 Linux |
| C# 9/10 | Windows、macOS 或 Linux |
| Docker | Windows、macOS 或 Linux |

大多数示例都是使用 NuGet 包管理器命令和 Visual Studio 2022 展示的。这些命令可以转换为 dotnet CLI 命令，可以在任何操作系统和替代 IDE（如 Visual Studio）中使用。

# 下载示例代码文件

您可以从 GitHub 下载本书的示例代码文件[`github.com/PacktPublishing/Microservices-Design-Patterns-in-.NET`](https://github.com/PacktPublishing/Microservices-Design-Patterns-in-.NET)。如果代码有更新，它将在 GitHub 仓库中更新。

我们还有其他来自我们丰富图书和视频目录的代码包可供在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)找到。查看它们吧！

# 下载彩色图像

我们还提供了一份包含本书中使用的截图和图表彩色图像的 PDF 文件。您可以从这里下载：[`packt.link/dD3Jv`](https://packt.link/dD3Jv)。

# 使用的约定

本书使用了几个文本约定。

`文本中的代码`：表示文本中的代码词汇、数据库表名、文件夹名、文件名、文件扩展名、路径名、命令和关键字。以下是一个示例：“目前，我们的`CreateAppointmentHandler`将处理该情况下所需的所有内容。”

代码块设置如下：

```cs
public class AppointmentCreated : IDomainEvent
    {
        public Appointment { get; set; }
        public DateTime ActionDate { get; private set; }
```

**粗体**：表示新术语、重要词汇或屏幕上看到的词汇。例如，菜单或对话框中的单词会以**粗体**显示。以下是一个示例：“从**管理**面板中选择**系统信息**。”

小贴士或重要注意事项

看起来是这样的。

# 联系我们

我们欢迎读者的反馈。

**一般反馈**：如果您对本书的任何方面有疑问，请通过电子邮件发送至 customercare@packtpub.com，并在邮件主题中提及书名。

**勘误**: 尽管我们已经尽一切努力确保内容的准确性，但错误仍然可能发生。如果你在这本书中发现了错误，我们将不胜感激，如果你能向我们报告这一点。请访问[www.packtpub.com/support/errata](https://www.packtpub.com/support/errata)并填写表格。

**盗版**: 如果你在互联网上以任何形式遇到我们作品的非法副本，如果你能提供位置地址或网站名称，我们将不胜感激。请通过版权@packt.com 与我们联系，并提供材料的链接。

**如果你有兴趣成为作者**：如果你在某个领域有专业知识，并且有兴趣撰写或为书籍做出贡献，请访问[authors.packtpub.com](https://authors.packtpub.com)。

# 分享你的想法

一旦你阅读了《.NET 微服务设计模式》，我们很乐意听听你的想法！请[点击此处直接进入此书的亚马逊评论页面](https://packt.link/r/1804610305)并分享你的反馈。

你的评论对我们和科技社区都很重要，并将帮助我们确保我们提供高质量的内容。

# 下载本书的免费 PDF 副本

感谢您购买本书！

你喜欢在路上阅读，但无法携带你的印刷书籍到处走？

你的电子书购买是否与你的选择设备不兼容？

别担心，现在每购买一本 Packt 书籍，你都可以免费获得该书的 DRM 免费 PDF 版本。

在任何地方、任何设备上阅读。直接从你最喜欢的技术书籍中搜索、复制和粘贴代码到你的应用程序中。

优惠远不止这些，你还可以获得独家折扣、时事通讯和每日免费内容的邮箱访问权限。

按照以下简单步骤获取优惠：

1.  扫描下面的二维码或访问以下链接

![](img/B19100_QR_Free_PDF.jpg)

[`packt.link/free-ebook/9781804610305`](https://packt.link/free-ebook/9781804610305)

1.  提交你的购买证明

1.  就这些！我们将直接将你的免费 PDF 和其他优惠发送到你的邮箱。

# 第一部分：理解微服务和设计模式

本部分重点介绍微服务设计模式的基础知识。你将了解许多动态部分和范围技术，这些技术对于决定设计微服务应用程序的整体方法至关重要。在本部分结束时，你将意识到围绕这种开发模式的复杂性，并了解这种方法的优缺点。

本部分包含以下章节：

+   *第一章*, *微服务简介* *–* *全景图*

+   *第二章*, *使用聚合器模式工作*

+   *第三章*, *微服务之间的同步通信*

+   *第四章*, *微服务之间的异步通信*

+   *第五章*, *使用 CQRS 模式*

+   *第六章*, *应用事件源模式*
