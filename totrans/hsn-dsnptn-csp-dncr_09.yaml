- en: Implementing Design Patterns for Web Applications - Part 2
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 实现网络应用程序的设计模式 - 第 2 部分
- en: In the previous chapter, we extended our FlixOne inventory management console
    application to a web application while illustrating different patterns. We also
    covered **User Interface** (**UI**) architectural patterns such as **Model-View-Controller**
    (**MVC**), **Model View Presenter** (**MVP**), and others. The previous chapter
    aimed to discuss patterns such as MVC. We now need to extend our existing application
    to incorporate more patterns.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们在说明不同模式的同时，将 FlixOne 库存管理控制台应用程序扩展为网络应用程序。我们还涵盖了**用户界面**（**UI**）架构模式，如**模型-视图-控制器**（**MVC**）、**模型视图演示者**（**MVP**）等。上一章旨在讨论如
    MVC 这样的模式。我们现在需要扩展现有应用程序以包含更多模式。
- en: In this chapter, we will continue with our existing FlixOne web application
    and extend the application by working on code to see the implementation of authentication
    and authorization. In addition to this, we will discuss **Test-Driven Development**
    (**TDD**).
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将继续使用现有的 FlixOne 网络应用程序，并通过编写代码来扩展应用程序，以查看身份验证和授权的实现。此外，我们还将讨论**测试驱动开发**（**TDD**）。
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: Authentication and authorization
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 身份验证和授权
- en: Creating a .NET Core web test project
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建 .NET Core 网络测试项目
- en: Technical requirements
  id: totrans-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: This chapter contains various code examples to explain the concepts. The code
    is kept simple and is just for demonstration purposes. Most of the examples involve
    a .NET Core console application that is written in C#.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 本章包含各种代码示例，用于解释概念。代码保持简单，仅用于演示目的。大多数示例涉及一个用 C# 编写的 .NET Core 控制台应用程序。
- en: To run and execute the code, Visual Studio 2019 is a prerequisite (you can also
    use Visual Studio 2017 to run the application).
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 要运行和执行代码，Visual Studio 2019 是必备条件（您也可以使用 Visual Studio 2017 来运行应用程序）。
- en: Installing Visual Studio
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装 Visual Studio
- en: 'To run these code examples, you need to install Visual Studio (the preferred
    **Integrated Development Environment** (**IDE**)). To do so, follow these instructions:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 要运行这些代码示例，您需要安装 Visual Studio（首选的**集成开发环境**（**IDE**））。为此，请按照以下说明操作：
- en: 'Download Visual Studio from the following download link, which contains installation
    instructions: [https://docs.microsoft.com/en-us/visualstudio/install/install-visual-studio](https://docs.microsoft.com/en-us/visualstudio/install/install-visual-studio).'
  id: totrans-11
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从以下下载链接下载 Visual Studio，其中包含安装说明：[https://docs.microsoft.com/en-us/visualstudio/install/install-visual-studio](https://docs.microsoft.com/en-us/visualstudio/install/install-visual-studio).
- en: Follow the installation instructions you find there. Multiple versions are available
    for Visual Studio installation. Here, we are using Visual Studio for Windows.
  id: totrans-12
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照您在那里找到的安装说明操作。Visual Studio 安装有多种版本可供选择。在这里，我们使用的是 Windows 版本的 Visual Studio。
- en: Setting up .NET Core
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置 .NET Core
- en: 'If you do not have .NET Core installed, you need to follow these instructions:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您尚未安装 .NET Core，您需要按照以下说明操作：
- en: Download .NET Core for Windows using [https://www.microsoft.com/net/download/windows](https://www.microsoft.com/net/download/windows).
  id: totrans-15
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 [https://www.microsoft.com/net/download/windows](https://www.microsoft.com/net/download/windows)
    下载 Windows 版本的 .NET Core。
- en: For multiple versions and a related library, visit [https://dotnet.microsoft.com/download/dotnet-core/2.2](https://dotnet.microsoft.com/download/dotnet-core/2.2).
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要获取多个版本和相关库，请访问 [https://dotnet.microsoft.com/download/dotnet-core/2.2](https://dotnet.microsoft.com/download/dotnet-core/2.2).
- en: Installing SQL Server
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装 SQL Server
- en: 'If you do not have SQL Server installed, you need to follow these instructions:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您尚未安装 SQL Server，您需要按照以下说明操作：
- en: 'Download SQL Server from the following link: [https://www.microsoft.com/en-in/download/details.aspx?id=1695](https://www.microsoft.com/en-in/download/details.aspx?id=1695).'
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从以下链接下载 SQL Server：[https://www.microsoft.com/en-in/download/details.aspx?id=1695](https://www.microsoft.com/en-in/download/details.aspx?id=1695).
- en: 'You can find installation instructions here: [https://docs.microsoft.com/en-us/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-2017](https://docs.microsoft.com/en-us/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-2017).'
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您可以在此处找到安装说明：[https://docs.microsoft.com/en-us/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-2017](https://docs.microsoft.com/en-us/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-2017).
- en: 'For troubleshooting and for more information, refer to the following link:
    [https://www.blackbaud.com/files/support/infinityinstaller/content/installermaster/tkinstallsqlserver2008r2.htm](https://www.blackbaud.com/files/support/infinityinstaller/content/installermaster/tkinstallsqlserver2008r2.htm).'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 对于故障排除和更多信息，请参阅以下链接：[https://www.blackbaud.com/files/support/infinityinstaller/content/installermaster/tkinstallsqlserver2008r2.htm](https://www.blackbaud.com/files/support/infinityinstaller/content/installermaster/tkinstallsqlserver2008r2.htm)。
- en: 'The complete source code is available from the following link: [https://github.com/PacktPublishing/Hands-On-Design-Patterns-with-C-and-.NET-Core/tree/master/Chapter7](https://github.com/PacktPublishing/Hands-On-Design-Patterns-with-C-and-.NET-Core/tree/master/Chapter7).'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 完整的源代码可以从以下链接获取：[https://github.com/PacktPublishing/Hands-On-Design-Patterns-with-C-and-.NET-Core/tree/master/Chapter7](https://github.com/PacktPublishing/Hands-On-Design-Patterns-with-C-and-.NET-Core/tree/master/Chapter7)。
- en: Extending the .NET Core web application
  id: totrans-23
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 扩展 .NET Core 网络应用程序
- en: In this chapter, we will continue with our FlixOne inventory application. Throughout
    this chapter, we will discuss web application patterns and extend the web application
    that we developed in the previous chapter.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将继续我们的 FlixOne 库存应用程序。在本章中，我们将讨论网络应用程序模式，并扩展我们在上一章中开发的应用程序。
- en: This chapter continues with the web application developed in the previous chapter.
    If you skipped the previous chapter, please revisit it to Synchronization with
    the current chapter.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 本章继续上一章开发的网络应用程序。如果您跳过了上一章，请重新阅读以与本章同步。
- en: In this section, we will go through the process of requirement gathering, and
    then discuss the various challenges with our web application that we developed
    before now.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将讨论需求收集的过程，然后讨论我们之前开发的网络应用程序所面临的各种挑战。
- en: Project kickoff
  id: totrans-27
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 项目启动
- en: 'In [Chapter 6](8e089021-1efb-4b88-8bf2-e26f69f883b9.xhtml), *Implementing Design
    Patterns for Web Applications – Part 1*, we extended our FlixOne inventory console
    application and developed a web application. We extended the application after
    considering the following points:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第6章](8e089021-1efb-4b88-8bf2-e26f69f883b9.xhtml)，“实现网络应用程序的设计模式 – 第1部分”，我们扩展了我们的
    FlixOne 库存控制台应用程序并开发了一个网络应用程序。在考虑以下要点后，我们扩展了应用程序：
- en: Our business needs a rich UI.
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们的业务需要一个丰富的用户界面。
- en: New opportunities demand a responsive web application.
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 新的机会需要响应式网络应用程序。
- en: Requirements
  id: totrans-31
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 需求
- en: 'After several meetings and discussions with the management, **Business Analysts**
    (**BAs**), and presales folks, management decided to work on the following high-level
    requirements: **business requirements** and **technical requirements**.'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 在与管理层、**业务分析师**（**BAs**）和预销售人员的多次会议和讨论后，管理层决定着手以下高级需求：**商业需求**和**技术需求**。
- en: Business requirements
  id: totrans-33
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 商业需求
- en: 'The business team eventually came up with the following business requirements:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 业务团队最终提出了以下商业需求：
- en: '**Product categorization**: There are several products, but if a user wants
    to search for a specific product, they can do so by filtering all products by
    their categories. For example, products such as mangoes, bananas, and more should
    come under a category called `Fruits`.'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**产品分类**：有几种产品，但如果用户想要搜索特定产品，他们可以通过按类别过滤所有产品来实现。例如，芒果、香蕉等应归入名为“水果”的类别。'
- en: '**Product addition**: There should be an interface that provides us with a
    feature to add new products. This feature should only be available to users who
    have the `Add Products` privilege.'
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**产品添加**：应该有一个界面，提供添加新产品的功能。此功能仅对具有“添加产品”权限的用户可用。'
- en: '**Product updation**: There should be a new interface where product updates
    should be possible.'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**产品更新**：应该有一个新的界面，以便进行产品更新。'
- en: '**Product deletion**: There is a requirement for administrators to delete products.'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**产品删除**：需要管理员删除产品。'
- en: Technical requirements
  id: totrans-39
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术需求
- en: 'The actual requirements for meeting the business needs are now ready for development.
    After several discussions with business folks, we concluded that the following
    are the requirements:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 满足商业需求的实际需求现在已准备好开发。在多次与业务人员进行讨论后，我们得出以下结论：以下是需要满足的需求：
- en: '**You should have a landing or home page**:'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**您应该有一个着陆页或主页**：'
- en: Should be a dashboard that contains various widgets
  id: totrans-42
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应该是一个包含各种小部件的仪表板
- en: Should show an at-a-glance picture of the store
  id: totrans-43
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应显示商店的直观图片
- en: '**You should have a product page**:'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**您应该有一个产品页面**：'
- en: Should have the capability to add, update, and delete products
  id: totrans-45
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应该具有添加、更新和删除产品的功能
- en: Should have the capability to add, update, and delete product categories
  id: totrans-46
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应该具有添加、更新和删除产品类别的功能
- en: The FlixOne Inventory Management web application is an imaginary product. We
    are creating this application to discuss the various design patterns required/used
    in web projects.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: FlixOne库存管理Web应用程序是一个虚构的产品。我们创建这个应用程序是为了讨论在Web项目中需要/使用的各种设计模式。
- en: Challenges
  id: totrans-48
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 挑战
- en: Although we have extended our existing console application to a new web application,
    it has various challenges for both developers and businesses. In this section,
    we will discuss these challenges, and then we will find out the solution to overcome
    these challenges.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管我们已经将现有的控制台应用程序扩展到新的Web应用程序，但它对开发者和企业都带来了各种挑战。在本节中，我们将讨论这些挑战，然后我们将找出克服这些挑战的解决方案。
- en: Challenges for developers
  id: totrans-50
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 开发者面临的挑战
- en: 'The following are the challenges that arose due to a big change in the application.
    These were also a result of major extensions to upgrading a console application
    to a web application:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是由于应用程序发生重大变化而出现的一些挑战。这些也是将控制台应用程序升级到Web应用程序的主要扩展的结果：
- en: '**No support for TDD**: Currently, there is no test project incorporated in
    the solution. Consequently, developers can''t follow the TDD approach, which could
    lead to more bugs in the application.'
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**不支持TDD**：目前，解决方案中未包含测试项目。因此，开发者无法遵循TDD方法，这可能导致应用程序中出现更多错误。'
- en: '**Security**: In the current application, there is no mechanism to restrict
    or permit the user from providing access to a particular screen or module of the
    application. There is also nothing related to authentication and authorization.'
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**安全性**：在当前的应用程序中，没有机制来限制或允许用户访问应用程序的特定屏幕或模块。也没有与认证和授权相关的内容。'
- en: '**UI and User Experience (UX)**: Our app is promoted from a console-based application,
    so the UI is not very rich.'
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**UI和用户体验（UX）**：我们的应用程序从基于控制台的应用程序升级，因此UI并不丰富。'
- en: Challenges for businesses
  id: totrans-55
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 商业挑战
- en: 'It takes time to achieve the final output, which delays the product, resulting
    in a loss for the business. The following challenges occur as we adapt a new technology
    stack, and there are plenty of changes in the code:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 实现最终输出需要时间，这延迟了产品，导致业务损失。当我们采用新的技术堆栈时，会出现以下挑战，并且代码中有很多变化：
- en: '**Loss of clients**: Here, we are still in the stage of development but the
    demand for our business is very high; however, the development team is taking
    longer than expected to deliver the product.'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**客户流失**：在这里，我们仍然处于开发阶段，但对我们业务的需求非常高；然而，开发团队交付产品的速度比预期要慢。'
- en: '**It takes more time to roll out the production updates**: Development efforts
    are time-consuming at the moment, which delays the subsequent activities and leads
    to a delay in production.'
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**推出生产更新需要更多时间**：目前开发工作耗时较长，这延迟了后续活动，导致生产延迟。'
- en: Finding a solution to the problems/challenges
  id: totrans-59
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 寻找解决这些问题/挑战的方案
- en: After several meetings and brainstorming sessions, the development team came
    to the conclusion that we have to stabilize our web-based solution. To overcome
    these challenges and provide the solution, the tech team and the business team
    got together to identify the various solutions and points.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 经过几次会议和头脑风暴会议后，开发团队得出结论，我们必须稳定我们的基于Web的解决方案。为了克服这些挑战并提供解决方案，技术团队和业务团队聚集在一起，确定各种解决方案和要点。
- en: 'The following points are supported by the solution:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 以下点是解决方案支持的：
- en: Implementing authentication and authorization
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 实施认证和授权
- en: Following TDD
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 遵循TDD
- en: Redesigning the UI to meet the UX
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 重新设计UI以满足UX
- en: Authentication and authorization
  id: totrans-65
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 认证和授权
- en: 'In the previous chapter—where we started upgrading our console application
    to a web application—we added **Create, Read, Update, and Delete** (**CRUD**)
    operations, which are available publicly to any user who is able to perform them.
    There is nothing coded to restrict a particular user from performing these operations.
    The risk with this is that users who are not supposed to perform these operations
    can easily do so. The consequences of this are as follows:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章——我们开始将控制台应用程序升级到Web应用程序时——我们添加了**创建、读取、更新和删除**（**CRUD**）操作，这些操作对任何能够执行它们的用户都是公开的。没有任何代码来限制特定用户执行这些操作。这种风险是，那些不应该执行这些操作的用户可以轻易地这样做。其后果如下：
- en: Unattended access
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 未受关注的访问
- en: An open door for hackers/attackers
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为黑客/攻击者敞开的大门
- en: Data leakage issues
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据泄露问题
- en: Now, if we are keen to safeguard our application and restrict the operations
    to permitted users only, then we have to implement a design that only allows these
    users to perform operations. There may be scenarios in which we could allow open
    access for a few operations. In our case, most operations are only for restricted
    access. In simple terms, we can try something that tells our application that
    the incoming user is the one who belongs to our application and can perform the
    specified task.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，如果我们热衷于保护我们的应用程序并仅限制允许的用户执行操作，那么我们必须实施一个设计，只允许这些用户执行操作。可能存在我们可以允许对一些操作开放访问的场景。在我们的案例中，大多数操作仅限于受限访问。简单来说，我们可以尝试告诉我们的应用程序，传入的用户属于我们的应用程序并且可以执行指定的任务。
- en: '**Authentication** is simply a process in which a system verifies or identifies
    the incoming requests through credentials (generally a user ID and password).
    If the system finds that the provided credentials are wrong, then it notifies
    the user (generally via a message on the GUI screen) and terminates the authorization
    process.'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: '**认证**是一个简单的过程，其中系统通过凭证（通常是一个用户ID和密码）验证或识别传入的请求。如果系统发现提供的凭证错误，那么它会通知用户（通常是通过GUI屏幕上的消息），并终止授权过程。'
- en: '**Authorization** always comes after authentication. This is a process that
    allows the authenticated user who raised the request to access resources or data
    after verifying that they have access to the specific resources or data.'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: '**授权**总是在认证之后。这是一个允许已认证的用户在验证他们有权访问特定资源或数据后访问资源或数据的过程。'
- en: 'In the previous paragraph, we have discussed some mechanisms that stop unattended
    access to our application''s operations. Let''s refer to the following diagram
    and discuss what it shows:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一段中，我们讨论了一些阻止对应用程序操作无人值守访问的机制。让我们参考以下图表并讨论它展示了什么：
- en: '![](img/00ea38bd-deaf-44bf-ae88-d05a91e2597e.png)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/00ea38bd-deaf-44bf-ae88-d05a91e2597e.png)'
- en: 'The preceding diagram depicts a scenario in which the system does not allow
    unattended access. This is simply defined as follows: an incoming request is received
    and the internal system (an authentication mechanism) checks whether a request
    is authenticated or not. If a request is authenticated, then a user is allowed
    to perform the operations for which they are authorized. This is not only the
    single check, but for a typical system, authorization comes in place after authentication.
    We will discuss this in the upcoming sections.'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 上述图示描述了一个系统不允许无人值守访问的场景。这可以简单地定义为以下内容：接收到一个传入请求，内部系统（一个认证机制）检查该请求是否已认证。如果请求已认证，则允许用户执行他们被授权的操作。这不仅仅是一次检查，对于典型的系统，授权是在认证之后进行的。我们将在接下来的章节中讨论这一点。
- en: 'To understand this in a better way, let''s write a simple login application.
    Let''s follow the steps given here:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更好地理解这一点，让我们编写一个简单的登录应用程序。让我们遵循这里给出的步骤：
- en: Open Visual Studio 2018.
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开Visual Studio 2018。
- en: Open File | New | New project.
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 文件 | 打开 | 新建 | 新项目。
- en: From the Project window, give a name to your project.
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在“项目”窗口中，给你的项目命名。
- en: 'Select ASP.NET Core 2.2 for the Web Application (Model-View-Controller) template:'
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择ASP.NET Core 2.2的Web应用程序（模型-视图-控制器）模板：
- en: '![](img/e1b73f2c-6bb3-472c-83fa-148167c195de.png)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/e1b73f2c-6bb3-472c-83fa-148167c195de.png)'
- en: You can choose various authentications that are available as part of the selected
    template.
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您可以选择作为所选模板一部分的多种认证方式。
- en: 'By default, the template provides an option named No Authentication, as shown
    here:'
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 默认情况下，模板提供了一个名为“无认证”的选项，如下所示：
- en: '![](img/56f9fe22-d905-4a1c-aaa3-9967f6e3011f.png)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/56f9fe22-d905-4a1c-aaa3-9967f6e3011f.png)'
- en: 'Press *F5* and run the application. From here, you will see the default home
    page:'
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按*F5*运行应用程序。从这里，您将看到默认的主页：
- en: '![](img/36015566-2dc3-4f85-a9a6-5479287ae8ef.png)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/36015566-2dc3-4f85-a9a6-5479287ae8ef.png)'
- en: You will now notice that you can navigate every page without any restrictions.
    This is obvious and makes sense as these pages are available as open access. The
    Home and Privacy pages are open access and do not require any authentication,
    meaning that anyone can access/view these pages. On the other hand, we may have
    a few pages that are meant for unattended access, such as the User Profile, and
    Admin pages.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你会发现你可以无限制地浏览每一页。这是显而易见且合理的，因为这些页面是公开访问的。主页和隐私页面是公开访问的，不需要任何认证，这意味着任何人都可以访问/查看这些页面。另一方面，我们可能有一些页面是为了无人值守访问而设计的，例如用户资料和管理员页面。
- en: Refer to the GitHub repository for the chapter at [https://github.com/PacktPublishing/Hands-On-Design-Patterns-with-C-and-.NET-Core/tree/master/Chapter6](https://github.com/PacktPublishing/Hands-On-Design-Patterns-with-C-and-.NET-Core/tree/master/Chapter6),
    and go through the entire application that we have built using ASP.NET Core MVC.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 请参考GitHub仓库中的该章节[https://github.com/PacktPublishing/Hands-On-Design-Patterns-with-C-and-.NET-Core/tree/master/Chapter6](https://github.com/PacktPublishing/Hands-On-Design-Patterns-with-C-and-.NET-Core/tree/master/Chapter6)，并浏览我们使用ASP.NET
    Core MVC构建的整个应用程序。
- en: 'To continue with our SimpleLogin application, let''s add a screen that is meant
    for restricted access: the Products screen. In this chapter, we are not going
    to discuss how to add a new controller or views to an existing project. If you
    want to know how we can add these to our project, revisit [Chapter 6](8e089021-1efb-4b88-8bf2-e26f69f883b9.xhtml),
    *Implementing Design Patterns for Web Applications – Part 1*.'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 要继续我们的SimpleLogin应用程序，让我们添加一个用于受限访问的屏幕：产品屏幕。在本章中，我们不会讨论如何向现有项目添加新的控制器或视图。如果你想知道我们如何将这些添加到我们的项目中，请回顾[第6章](8e089021-1efb-4b88-8bf2-e26f69f883b9.xhtml)，*实现Web应用程序的设计模式
    – 第1部分*。
- en: 'We have added new functionality to our project to showcase products with CRUD
    operations. Now, hit *F5* and check the output:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经向我们的项目添加了新的功能来展示具有CRUD操作的产品。现在，按*F5*并检查输出：
- en: '![](img/e1323798-b41f-4647-91e2-9b02aee64b03.png)'
  id: totrans-91
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/e1323798-b41f-4647-91e2-9b02aee64b03.png)'
- en: You will get the output that is shown in the previous screenshot. You might
    notice that we now have a new menu named Products.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 你将看到之前截图中的输出。你可能注意到我们现在有一个名为“产品”的新菜单。
- en: 'Let''s navigate through the new menu options. Click on the Products menu:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们浏览一下新菜单选项。点击“产品”菜单：
- en: '![](img/e4d9a790-7ca3-413c-953e-c7ffd7085696.png)'
  id: totrans-94
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/e4d9a790-7ca3-413c-953e-c7ffd7085696.png)'
- en: The previous screenshot shows our Product page. This page is available to all
    and anyone can view it without any restrictions. You might have a look and observe
    that this page has the feature to Create New products, and to Edit and Delete
    existing products. Now, imagine a scenario where one unknown user came and deleted
    a specific product that is very important and attracts a high sales volume. You
    can imagine the scenario and how much this hampers a business. There might even
    be a chance that customers are lost.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 之前的截图显示了我们的产品页面。这个页面对所有用户开放，任何人都可以无限制地查看。你可以查看并观察这个页面具有创建新产品、编辑和删除现有产品的功能。现在，想象一下这样一个场景：一个未知用户进来并删除了一个非常重要且吸引大量销售的产品。你可以想象这个场景以及这对业务有多大的阻碍。甚至可能失去客户。
- en: 'In our scenario, we can protect our Product page in two ways:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的场景中，我们可以以两种方式保护我们的产品页面：
- en: '**Prior Authenticate**: On this page, the link to Products is not available
    for everyone; it is only available for authenticated requests/users.'
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**预先认证**：在本页面上，并非所有人都可以访问“产品”链接；它仅对经过认证的请求/用户可用。'
- en: '**Post Authenticate**: On this page, the link to Products is available for
    everyone. However, once someone requests to access the page, the system performs
    an authentication check.'
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**后认证**：在本页面上，所有人都可访问“产品”链接。然而，一旦有人请求访问页面，系统将执行认证检查。'
- en: Authentication in action
  id: totrans-99
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 认证行动
- en: In this section, we will see how to implement authentication and make our web
    pages restricted for unauthenticated requests.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将了解如何实现认证并使我们的网页对未经认证的请求受限。
- en: To achieve authentication, we should adopt some sort of mechanism that provides
    us with a way to authenticate a user. In general cases, if a user is logged in,
    that means they are already authenticated.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 要实现认证，我们应该采用某种机制，为我们提供一种认证用户的方法。在一般情况下，如果用户已登录，这意味着他们已经经过认证。
- en: 'In our web application, we will also follow the same approach and make sure
    that the user is logged in before accessing the restricted pages, views, and operations:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的Web应用程序中，我们也将遵循相同的方法，确保在访问受限制的页面、视图和操作之前用户已登录：
- en: '[PRE0]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The previous class is a typical `User` model/entity that represents our database
    `User` table. This table will persist all the information regarding `User`. Here
    is what every field looks like:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 之前的类是一个典型的`User`模型/实体，它代表我们的数据库`User`表。此表将持久化有关`User`的所有信息。以下是每个字段的外观：
- en: '`Id` is a **Globally Unique Identifier** (**GUID**) and primary key in the
    table.'
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Id`是**全局唯一标识符**（**GUID**）和表中的主键。'
- en: '`UserName` is typically used during login and other related operations. It
    is a programmatically generated field.'
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`UserName`通常在登录和其他相关操作期间使用。这是一个程序生成的字段。'
- en: '`FirstName` and `LastName` combine the full name of the user.'
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`FirstName`和`LastName`组合了用户的完整姓名。'
- en: '`Emailid` is the valid email ID of the user. It should be a valid email because
    we will validate this after/during the registration process.'
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Emailid`是用户的有效电子邮件ID。它应该是一个有效的电子邮件，因为我们将在注册过程之后/期间进行验证。'
- en: '`PasswordHash` and `PasswordSalt` are the byte arrays that are based on a **Hash-Based
    Message Authentication Code, Secure Hash Algorithm** (**HMAC****SHA**) 512\. A
    value for `PasswordHash` attribute is 64 bytes and `PasswordSalt` is 128 bytes.'
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`PasswordHash`和`PasswordSalt`是基于**基于哈希的消息认证码，安全哈希算法**（**HMAC**-**SHA**）512的字节数组。`PasswordHash`属性的值是64字节，而`PasswordSalt`是128字节。'
- en: '`SecretKey` is a Base64-encoded string.'
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`SecretKey`是Base64编码的字符串。'
- en: '`Mobilie` is a valid mobile number that depends on the validity check by the
    system.'
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Mobilie`是有效的手机号码，它依赖于系统的有效性检查。'
- en: '`EmailToken` and `OTP` are the **One-Time Passwords** (**OTPs**) that are randomly
    generated to validate `emailId` and `Mobile number`.'
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`EmailToken`和`OTP`是随机生成的**一次性密码**（**OTPs**），用于验证`emailId`和手机号码。'
- en: '`EmailTokenDateTime` and `OtpDateTime` are the properties of the `datetime`
    data type; they represent the date and time in which `EmailToken` and `OTP` are
    issued for the user.'
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`EmailTokenDateTime`和`OtpDateTime`是`datetime`数据类型的属性；它们代表为用户签发`EmailToken`和`OTP`的日期和时间。'
- en: '`IsMobileVerified` and `IsEmailverified` are Boolean values (`true`/`false`)
    that tell the system whether the mobile number and/or email ID are verified or
    not.'
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`IsMobileVerified`和`IsEmailverified`是布尔值（`true`/`false`），用于告诉系统手机号码和/或电子邮件ID是否已验证。'
- en: '`IsActive` is a Boolean value (`true`/`false`) that tells the system whether
    a `User` model is active or not.'
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`IsActive`是一个布尔值（`true`/`false`），用于告诉系统`User`模型是否处于活动状态。'
- en: '`Image` is a Base64-encoded string of an image. It represents the profile picture
    of a user.'
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Image`是图像的Base64编码字符串。它代表用户的个人资料图片。'
- en: 'We need to add our new class/entity to our `Context` class. Let''s add what
    we can see in the following screenshot:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要将我们的新类/实体添加到我们的`Context`类中。让我们添加以下截图中所看到的内容：
- en: '![](img/e66ab985-bf29-4c24-a451-510908e88c54.png)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e66ab985-bf29-4c24-a451-510908e88c54.png)'
- en: 'By adding the previous line in our `Context` class, we can access our `User`
    table directly using **Entity Framework** (**EF**) functionality:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 通过在我们的`Context`类中添加上一行，我们可以直接使用**实体框架**（**EF**）功能访问我们的`User`表：
- en: '[PRE1]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '`LoginViewModel` is used to authenticate the user. The values of this `viewmodel`
    come from the Login page (we will discuss and create this page in the upcoming
    section). It contains the following:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: '`LoginViewModel`用于验证用户。此`viewmodel`的值来自登录页面（我们将在下一节中讨论和创建此页面）。它包含以下内容：'
- en: '`UserName`: This is a unique name that is used to identify the user. This is
    a human-readable value that can be easily identified. It is not like the GUID
    value.'
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`UserName`：这是一个用于识别用户的唯一名称。这是一个易于识别的、可读的值。它不像GUID值。'
- en: '`Password`: This is a secret and sensitive value for any user.'
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Password`：这是任何用户的秘密和敏感值。'
- en: '`RememberMe`: This tells us whether the user wants to allow the current system
    to persist cookies which store values in cookies at the client browser.'
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`RememberMe`：这告诉我们用户是否希望允许当前系统持久化cookie，这些cookie在客户端浏览器中存储值。'
- en: 'To perform the CRUD operations, let''s add the following code to the `UserManager`
    class:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 要执行CRUD操作，让我们向`UserManager`类添加以下代码：
- en: '[PRE2]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'The following is the code snippet from the rest of the methods of the `UserManager`
    class:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的代码片段来自`UserManager`类的其他方法：
- en: '[PRE3]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The preceding code is the `UserManager` class, which gives us the ability to
    interact with our `User` table using EF:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 上一段代码是`UserManager`类，它使我们能够使用EF与我们的`User`表交互：
- en: 'The following code shows the View of the Login screen:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码显示了登录屏幕的视图：
- en: '[PRE4]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The previous code snippet is from our `Login.cshtml` page/view. This page provides
    a form to enter the `Login` details. These details come to our `Account` controller
    and are then validated to authenticate the user:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 之前的代码片段来自我们的`Login.cshtml`页面/视图。此页面提供了一个表单来输入登录详细信息。这些详细信息传送到我们的`Account`控制器，然后进行验证以认证用户：
- en: 'The following is the `Login` action method:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是`Login`操作方法：
- en: '[PRE5]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'The preceding code snippet is a `Get /Account/Login` request that displays
    the empty login page, which is shown in the following screenshot:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 上述代码片段是一个`Get /Account/Login`请求，它显示了一个空白的登录页面，如下面的截图所示：
- en: '![](img/49b3bb00-4948-47d3-a661-8124331d513d.png)'
  id: totrans-136
  prefs: []
  type: TYPE_IMG
  zh: '![](img/49b3bb00-4948-47d3-a661-8124331d513d.png)'
- en: The previous screenshot appears as soon as the user clicks on the Login menu
    option. This is a simple form used to enter the Login details.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 之前的截图在用户点击登录菜单选项时立即出现。这是一个简单的表单，用于输入登录详细信息。
- en: 'The following code shows the `Login` action method that handles the `Login`
    functionality of the application:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码显示了处理应用程序`Login`功能的`Login`操作方法：
- en: '[PRE6]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The preceding code snippet is a `Post /Account/Login` request from a login
    page that posts the entire `LoginViewModel` class:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 上述代码片段是一个来自登录页面的`Post /Account/Login`请求，它发布了整个`LoginViewModel`类：
- en: 'The following is the screenshot of our Login view:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是我们登录视图的截图：
- en: '![](img/f6723286-de50-440c-8d2b-5a2dafc67aa9.png)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f6723286-de50-440c-8d2b-5a2dafc67aa9.png)'
- en: 'In the previous screenshot, we are trying to log in using our default user
    credentials (Username: `aroraG` and Password: `test123`). The information related
    to this login is being persisted in cookies, but only if the Remember Me checkbox
    is checked by the user. The system remembers the logged-in session on the current
    computer until the user hits the Logout button.'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 在之前的截图中，我们正在尝试使用我们的默认用户凭据（用户名：`aroraG`和密码：`test123`）进行登录。与此次登录相关的信息将被保存在cookie中，但仅当用户勾选了“记住我”复选框时。系统将记住当前计算机上的登录会话，直到用户点击注销按钮。
- en: 'As soon as the user hits the Login button, the system authenticates their login
    details and redirects them to the home page, as shown in the following screenshot:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦用户点击登录按钮，系统就会验证他们的登录详细信息，并将他们重定向到主页，如下面的截图所示：
- en: '![](img/dd11bc73-c8d1-4c6b-b7bc-7e33fd058cd7.png)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![](img/dd11bc73-c8d1-4c6b-b7bc-7e33fd058cd7.png)'
- en: 'You might observe text in the menu, such as `Welcome Gaurav`. This welcome
    text is not coming automatically, but we did instruct our system to show this
    text by adding a few lines of code, as shown in the following code:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能会在菜单中观察到文本，如`Welcome Gaurav`。这个欢迎文本不是自动出现的，但我们通过添加几行代码来指示系统显示此文本，如下所示：
- en: '[PRE7]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The previous code snippet is taken from the `_Layout.cshtml` view/page. In
    the previous code snippet, we are checking whether `IsAuthenticated` returns true.
    If so, then the welcome message is displayed. This welcome message comes along
    with the Logout option, but it displays the `Login` menu when `IsAuthenticated`
    returns the `false` value:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 之前的代码片段是从`_Layout.cshtml`视图/页面中提取的。在之前的代码片段中，我们正在检查`IsAuthenticated`是否返回`true`。如果是这样，则显示欢迎信息。这个欢迎信息伴随着注销选项，但当`IsAuthenticated`返回`false`值时，它显示的是`Login`菜单：
- en: '[PRE8]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '`IsAuthenticated` is a `ReadOnly` property of the `AuthManager` class that
    checked whether the request is authenticated or not. Before we move ahead, let''s
    revisit our `Login` method:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: '`IsAuthenticated`是`AuthManager`类的`ReadOnly`属性，用于检查请求是否已认证。在我们继续之前，让我们回顾一下`Login`方法：'
- en: '[PRE9]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'The previous `Login` method simply validates the user. Take a look at this
    statement—`var result = _authManager.Login(model);`. This calls a `Login` method
    from `AuthManager`:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 之前的`Login`方法只是验证用户。看看这个语句——`var result = _authManager.Login(model);`。这调用来自`AuthManager`的`Login`方法：
- en: '![](img/dde59675-3690-45ac-8590-ca3a459137f8.png)'
  id: totrans-153
  prefs: []
  type: TYPE_IMG
  zh: '![](img/dde59675-3690-45ac-8590-ca3a459137f8.png)'
- en: 'If the `Login` method returns `true`, then it redirects the current Login page
    to the Home page. Otherwise, it remains on the same Login page by complaining
    about an Invalid login attempt. The following is the code of the `Login` method:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 如果`Login`方法返回`true`，则它将当前登录页面重定向到主页。否则，它将停留在相同的登录页面，并抱怨无效的登录尝试。以下是`Login`方法的代码：
- en: '[PRE10]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'The `Login` method is a typical method of the `AuthManager` class, which calls
    the `FindBy(model)` method of `UserManager` and checks whether it exists or not.
    If it exists, then it further calls the `SignInCookie(model,user)` method of the
    `AuthManager` class, otherwise, it simply returns as `false`, meaning that the
    Login is unsuccessful:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: '`Login`方法是`AuthManager`类的典型方法，它调用`UserManager`的`FindBy(model)`方法并检查其是否存在。如果存在，它将进一步调用`AuthManager`类的`SignInCookie(model,user)`方法，否则，它将简单地返回`false`，这意味着登录失败：'
- en: '[PRE11]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'The following code snippet makes sure that if the user is authenticated, then
    their details should be persisted in `HttpContext` so that the system can authenticate
    each and every incoming request from users. You might observe the `_httpContext.SignInAsync(CookieAuthenticationDefaults.AuthenticationScheme,
    principal, props).Wait();` statement that actually signed in and enabled the cookie
    authentication:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码片段确保如果用户已认证，则他们的详细信息应持久化在`HttpContext`中，以便系统可以验证来自用户的每个请求。您可能会注意到`_httpContext.SignInAsync(CookieAuthenticationDefaults.AuthenticationScheme,
    principal, props).Wait();`这个实际上执行了登录并启用了cookie认证的语句：
- en: '[PRE12]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: The previous statements help us to enable cookie authentication and claims for
    incoming requests for our application. Finally, the `app.UseAuthentication();`
    statement adds the authentication mechanism ability into our application. These
    statements should be added to the `Startup.cs` class.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 之前的语句帮助我们启用对应用程序的cookie认证和声明。最后，`app.UseAuthentication();`语句将认证机制能力添加到我们的应用程序中。这些语句应添加到`Startup.cs`类中。
- en: Why does it make a difference?
  id: totrans-161
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 这为什么很重要？
- en: 'We have added plenty of code into our web application, but does this really
    help us to restrict our pages/views from unattended requests? The **Products**
    page/view is still open; therefore, I can perform any available actions from the
    Products page/view:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经将大量代码添加到我们的Web应用程序中，但这真的能帮助我们限制页面/视图的未授权请求吗？**产品**页面/视图仍然开放；因此，我可以从产品页面/视图中执行任何可用的操作：
- en: '![](img/503ea6e8-df37-4c0b-b2bd-d0ae1a348a07.png)'
  id: totrans-163
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/503ea6e8-df37-4c0b-b2bd-d0ae1a348a07.png)'
- en: 'As a user, I can see the Products option whether I am logged in or not:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 作为用户，无论我是否登录，我都能看到“产品”选项：
- en: '![](img/5e25140c-009d-4976-8bee-da343dc28458.png)'
  id: totrans-165
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/5e25140c-009d-4976-8bee-da343dc28458.png)'
- en: The previous screenshot shows the same Products menu option after login as before
    login.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了登录前后相同的“产品”菜单选项。
- en: 'We can restrict the access of the Products page like this:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以像这样限制对产品页面的访问：
- en: '[PRE13]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'The following is the home screen of the application:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是该应用程序的主屏幕：
- en: '![](img/bf5954af-e1af-4505-958e-413ae4cfd1bd.png)'
  id: totrans-170
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/bf5954af-e1af-4505-958e-413ae4cfd1bd.png)'
- en: The previous code helps systems to only display the Products menu option once
    the user is logged in/authenticated. The Products menu options will not get displayed
    on the screen. Like this, we can restrict the unattended access. However, this
    approach has its own cons. The biggest one is that if someone knows the URL of
    the Products page—which will lead you to `/Product/Index`—then they can perform
    restricted operations. These operations are restricted as they are not meant to
    be used by a user who is not logged in.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 之前的代码帮助系统在用户登录/认证后仅显示产品菜单选项。产品菜单选项不会显示在屏幕上。这样，我们可以限制未授权访问。然而，这种方法有其自身的缺点。最大的缺点是，如果有人知道产品页面的URL——这将带您到`/Product/Index`——那么他们可以执行受限操作。这些操作是受限的，因为它们不是为未登录的用户设计的。
- en: Authorization in action
  id: totrans-172
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 授权操作
- en: In the previous section, we discussed how to avoid unattended access to a particular
    or restricted screen/page. We have seen that Login actually authenticates the
    user and allows them to make a request to the system. On the other hand, authentication
    does not mean that if a user is authenticated, then they are authorized to access
    a particular section, page, or screen.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一节中，我们讨论了如何避免未授权访问特定或受限的屏幕/页面。我们了解到登录实际上验证了用户的身份，并允许他们向系统发出请求。另一方面，认证并不意味着如果用户已认证，那么他们就有权访问特定的部分、页面或屏幕。
- en: 'The following depicts a typical authorization and authentication process:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 以下描述了一个典型的授权和认证过程：
- en: '![](img/8ce628c8-963b-4240-a461-128fba886d7e.png)'
  id: totrans-175
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/8ce628c8-963b-4240-a461-128fba886d7e.png)'
- en: In this process, the first request/user gets authenticated (typically, it is
    a login form), then a request is authorized to perform a particular/requested
    operation(s). There may be many scenarios where a request is authenticated but
    not authorized to access a specific resource or perform a specific operation.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 在此过程中，第一个请求/用户被认证（通常是一个登录表单），然后请求被授权执行特定的/请求的操作。可能有许多场景，请求被认证但未授权访问特定的资源或执行特定的操作。
- en: In our application (created in the previous section), we have a `Products` page
    with CRUD operations. The `Products` page is not a public page, which means that
    this page is not available for all; it is available with restricted access.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们之前创建的应用程序中，我们有一个具有CRUD操作的`Products`页面。`Products`页面不是一个公开页面，这意味着此页面不是对所有用户都可用；它是受限制访问的。
- en: 'We come back to the following main problem that we left within the previous
    section: "What if a user is authenticated but they are not authorized to access
    a particular page/resource? It does not matter whether we hide the page from the
    unauthorized user because they can easily access or view it by entering its URL.*"*
    To overcome this challenge/issue, we can implement the following steps:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 我们回到上一节中留下的主要问题：“如果用户已经认证但未授权访问特定的页面/资源怎么办？无论我们是否隐藏页面以防止未经授权的用户访问，因为他们可以很容易地通过输入URL来访问或查看它。*"*
    为了克服这个挑战/问题，我们可以实施以下步骤：
- en: Check the authorization on each access of the restricted resource, which means
    that whenever a user tries to access the resource (by entering a direct URL in
    the browser), the system checks for authorization, so that incoming requests to
    access the resource can be authorized. If the incoming request of the user is
    not authorized, then they would not be able to perform the specified operation.
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查对受限制资源的每次访问的授权，这意味着每当用户尝试访问资源（通过在浏览器中输入直接URL）时，系统都会检查授权，以便授权访问资源的传入请求。如果用户的传入请求未经授权，那么他们就无法执行指定的操作。
- en: Checking authorization on each operation of the restricted resource means that
    if the user is authenticated, they would be able to access the restricted page/view,
    but the operations of this page/view can only be accessible if the user is authorized.
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在受限制资源的每次操作上检查授权意味着如果用户已认证，他们可以访问受限制的页面/视图，但此页面/视图的操作只能由授权用户访问。
- en: The `Microsoft.AspNetCore.Authorization` namespace provides built-in functions
    to authorize specific resources.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: '`Microsoft.AspNetCore.Authorization`命名空间提供了内置函数来授权特定资源。'
- en: 'To restrict access and avoid unattended access to a particular resource, we
    can use the `Authorize` attribute:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 为了限制访问并避免未授权访问特定资源，我们可以使用`Authorize`属性：
- en: '![](img/4d449cc2-19f6-4522-8811-b1b9a59ef4af.png)'
  id: totrans-183
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/4d449cc2-19f6-4522-8811-b1b9a59ef4af.png)'
- en: The previous screenshot shows that we are putting the `Authorize` attribute
    into our `ProductController`. Now, hit *F5* and run the application.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 上一张截图显示我们将`Authorize`属性添加到了`ProductController`中。现在，按*F5*键并运行应用程序。
- en: If the user is not logged in to the system, they would not able to see the Product
    page as we have already added the condition. If the user is validated, then display
    Products in the menu bar.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 如果用户未登录到系统，他们将无法看到产品页面，因为我们已经添加了条件。如果用户经过验证，则在菜单栏中显示产品。
- en: Do not log in to the system and enter the product URL, `http://localhost:56229/Product`,
    directly to your browser. This will redirect the user to the Login screen. Please
    see the following screenshot and check the URL; you might notice that the URL
    contains a ReturnUrl part that will instruct the system on where to be redirected
    upon a successful login attempt.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 不要登录到系统，直接在浏览器中输入产品URL，`http://localhost:56229/Product`。这将使用户重定向到登录屏幕。请查看以下截图并检查URL；您可能会注意到URL中包含一个ReturnUrl部分，该部分将指导系统在成功登录尝试后重定向到何处。
- en: 'See the following screenshot; note that the URL contains the ReturnUrl part.
    The system redirects the application to this URL once the user is logged in:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 看以下截图；请注意，URL中包含ReturnUrl部分。一旦用户登录，系统将重定向应用程序到该URL：
- en: '![](img/c7be2aef-4be7-4eb3-acbc-ff8900abfcf1.png)'
  id: totrans-188
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/c7be2aef-4be7-4eb3-acbc-ff8900abfcf1.png)'
- en: 'The following screenshot shows Product Listing:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了产品列表：
- en: '![](img/ecde544b-f171-4a84-ab26-ccb3fda4cb3b.png)'
  id: totrans-190
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/ecde544b-f171-4a84-ab26-ccb3fda4cb3b.png)'
- en: 'Our Product Listing screen provides operations such as Create New, Edit, Delete,
    and Details. The current application allows the user to perform these operations.
    Therefore, does it make sense that any visiting and authenticated user can create,
    update, and delete a product? If we allow this for every user, the consequences
    can be as follows:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的产品列表屏幕提供了创建新项、编辑、删除和详细信息等操作。当前应用程序允许用户执行这些操作。因此，任何访问和认证用户都可以创建、更新和删除产品，这有意义吗？如果我们允许每个用户这样做，后果可能如下：
- en: We can have many products that have been already added to the system.
  id: totrans-192
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以有许多已经添加到系统中的产品。
- en: Unavoidable removal/deletion of products.
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 产品不可避免地需要删除/删除。
- en: Unavoidable updating of products.
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 产品不可避免地需要更新。
- en: Can we have something such as user types that differentiate all users of the
    `Admin` type from normal users, allowing only users with admin rights—not the
    normal users—to perform these operations? A better idea is to add roles for users;
    therefore, we would need to make a user of a specific type.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 我们能否有一种像用户类型这样的东西，将所有`Admin`类型的用户与普通用户区分开来，只允许具有管理员权限的用户——而不是普通用户——执行这些操作？一个更好的想法是为用户添加角色；因此，我们需要创建一个特定类型的用户。
- en: 'Let''s add a new entity into our project and name it `Role`:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们在我们的项目中添加一个新的实体，并将其命名为`Role`：
- en: '[PRE14]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'The previous code snippet that defines the `Role` class for a user has properties,
    as explained in the following list:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 之前代码片段中定义用户`Role`类的代码具有以下属性，如下所述：
- en: '`Id`: This uses `GUID` as a primary key.'
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Id`：这使用`GUID`作为主键。'
- en: '`Name`: A `Role` name of a `string` type.'
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Name`：`Role`的字符串类型名称。'
- en: '`ShortName`: A short or abbreviated name of the role that is of a `string`
    type.'
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ShortName`：角色的简短或缩写名称，为字符串类型。'
- en: 'We need to add our new class/entity to our `Context` class. Let''s add this
    as follows:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要将我们的新类/实体添加到我们的`Context`类中。让我们按照以下方式添加：
- en: '![](img/41ec1447-9387-4dad-900d-b7264329c630.png)'
  id: totrans-203
  prefs: []
  type: TYPE_IMG
  zh: '![](img/41ec1447-9387-4dad-900d-b7264329c630.png)'
- en: 'The previous code provides the ability to work various DB operations using
    EF:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 之前的代码提供了使用EF执行各种数据库操作的能力：
- en: '[PRE15]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'The three methods of the `UserManager` class that appeared in the previous
    code snippet provide us with the ability to get `Roles` from the database:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 之前代码片段中出现的`UserManager`类的三个方法为我们提供了从数据库中获取`Roles`的能力：
- en: '[PRE16]'
  id: totrans-207
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'We have added `Roles` to our `Claims` by modifying the `SigningCookie` method
    of the `AuthManager` class:'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 我们通过修改`AuthManager`类的`SigningCookie`方法将`Roles`添加到我们的`Claims`中：
- en: '![](img/b2f40509-4128-4d60-864b-84b5bc9fc064.png)'
  id: totrans-209
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b2f40509-4128-4d60-864b-84b5bc9fc064.png)'
- en: 'The previous screenshot shows that a user named `Gaurav` has two roles: `Admin`
    and `Manager`:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 之前的截图显示，名为`Gaurav`的用户有两个角色：`Admin`和`Manager`：
- en: '![](img/7dff3042-7c28-4700-a762-c9d3dbab96ac.png)'
  id: totrans-211
  prefs: []
  type: TYPE_IMG
  zh: '![](img/7dff3042-7c28-4700-a762-c9d3dbab96ac.png)'
- en: 'We restrict `ProductController` for the user(s) with the `Admin` and `Manager`
    roles only. Now, try to log in with user `aroraG` and you will see `Product Listing`,
    as shown in the following screenshot:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 我们仅对具有`Admin`和`Manager`角色的用户限制`ProductController`。现在，尝试使用用户`aroraG`登录，你将看到如下截图所示的`Product
    Listing`：
- en: '![](img/f3bb9f93-2966-43f8-a046-9632d5670f63.png)'
  id: totrans-213
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f3bb9f93-2966-43f8-a046-9632d5670f63.png)'
- en: 'Now, let''s try to log in with a second user, `aroraG1`, which has the role
    of `Editor`. This will throw an `AccessDenied` error. For this, see the following
    screenshot:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们尝试使用第二个用户`aroraG1`登录，该用户具有`Editor`角色。这将抛出`AccessDenied`错误。有关此内容，请参阅以下截图：
- en: '![](img/edba9b44-843e-42d3-8a6b-ea4845d3e9e3.png)'
  id: totrans-215
  prefs: []
  type: TYPE_IMG
  zh: '![](img/edba9b44-843e-42d3-8a6b-ea4845d3e9e3.png)'
- en: In this way, we can safeguard our restricted resources. There are a lot of ways
    to achieve this. .NET Core MVC provides built-in functionality to achieve this,
    and you can also do so in a customizable way. If you do not want to use these
    available built-in features, you can easily draft your own functionality of required
    features by adding to the existing code. If you want to do this, you need to start
    from scratch. Furthermore, if something is available, then there is no sense in
    creating something similar again. If you do not find the functionality for available
    components, then you should customize the existing functionality/features rather
    than writing the entire code from scratch.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 以这种方式，我们可以保护我们的受限资源。有许多方法可以实现这一点。.NET Core MVC提供了内置功能来实现这一点，你也可以以可定制的方式做到这一点。如果你不想使用这些可用的内置功能，你可以很容易地通过添加到现有代码中来制定所需功能的自定义功能。如果你想这样做，你需要从头开始。此外，如果某些功能可用，那么再次创建类似功能就没有意义了。如果你找不到可用组件的功能，那么你应该定制现有的功能/特性，而不是从头编写整个代码。
- en: '**A developer should implement an authentication mechanism that can''t be tampered
    with.** In this section, we have discussed a lot to do with authentication and
    authorization, as well as writing code and creating our web application. In regard
    to authentication, we should use a good mechanism for the authentication so that
    no one can tamper with or bypass it. There are two more designs you can start
    with:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: '**开发者应该实现一个无法被篡改的认证机制**。在本节中，我们讨论了很多与认证和授权、编写代码以及创建我们的Web应用程序相关的内容。关于认证，我们应该使用一个好的认证机制，以确保没有人可以篡改或绕过它。你可以从以下两个设计开始：'
- en: Authentication filters
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 认证过滤器
- en: Authenticating individual requests/endpoints
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 认证单个请求/端点
- en: 'After the implementation of the previous steps, every request that comes via
    any mode should be authenticated and authorized before the system responds to
    the user or the client that made the call. This process mainly includes the following:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 在实施前几步之后，任何通过任何模式传入的请求都应该在系统响应用户或发起调用的客户端之前进行认证和授权。这个过程主要包括以下内容：
- en: '**Confidentiality**: The secured system makes sure that any sensitive data
    is not exposed to unauthenticated and unauthorized access requests.'
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**保密性**：安全系统确保任何敏感数据不会被未认证和未经授权的访问请求暴露。'
- en: '**Availability**: The security measures in the system make sure that the system
    is available for users who are genuine, as confirmed through the system''s authentication
    and authorization mechanism.'
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**可用性**：系统中的安全措施确保系统对经过系统认证和授权的真正用户可用。'
- en: '**Integrity**: In a secured system, data tampering is not possible, so the
    data is secure.'
  id: totrans-223
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**完整性**：在一个安全系统中，数据篡改是不可能的，因此数据是安全的。'
- en: Creating a web test project
  id: totrans-224
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建Web测试项目
- en: Unit testing is the one that checks code health. This means that if the code
    is buggy (unhealthy), that would be the basis of many unknown and unwanted issues
    in the application. To overcome this approach, we could follow the TDD approach.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 单元测试是检查代码健康状况的一种方法。这意味着如果代码有bug（不健康），那么这将是应用程序中许多未知和不受欢迎问题的根源。为了克服这种方法，我们可以遵循TDD方法。
- en: 'You can practice TDD with Katas. You can refer to [https://www.codeproject.com/Articles/886492/Learning-Test-Driven-Development-with-TDD-Katas](https://www.codeproject.com/Articles/886492/Learning-Test-Driven-Development-with-TDD-Katas)
    to find out more about TDD katas. If you want to practice this approach, use this
    repository: [https://github.com/garora/TDD-Katas](https://github.com/garora/TDD-Katas).'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以用Katas练习TDD。你可以参考[https://www.codeproject.com/Articles/886492/Learning-Test-Driven-Development-with-TDD-Katas](https://www.codeproject.com/Articles/886492/Learning-Test-Driven-Development-with-TDD-Katas)了解更多关于TDD
    Katas的信息。如果你想练习这种方法，请使用此存储库：[https://github.com/garora/TDD-Katas](https://github.com/garora/TDD-Katas)。
- en: 'We have already discussed a lot about TDD in previous chapters, so we are not
    going to discuss this in detail here. Instead, let''s create a test project as
    follows:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经在之前的章节中讨论了很多关于TDD的内容，所以在这里我们不会详细讨论。相反，让我们创建一个测试项目，如下所示：
- en: Open our web application.
  id: totrans-228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开我们的Web应用程序。
- en: 'From Solution Explorer in Visual Studio, right-click on Solution and click
    on Add | New Project..., as shown in the following screenshot:'
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Visual Studio的解决方案资源管理器中，右键单击解决方案，然后单击添加 | 新项目...，如图所示：
- en: '![](img/7fce068c-4813-4bfd-b558-c91398c93cfb.png)'
  id: totrans-230
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/7fce068c-4813-4bfd-b558-c91398c93cfb.png)'
- en: 'From the Add New Project template, select .NET Core and xUnit Test Project
    (.NET Core) and provide a meaningful name:'
  id: totrans-231
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从添加新项目模板中，选择.NET Core和xUnit测试项目(.NET Core)并提供一个有意义的名称：
- en: '![](img/68d046c1-29af-4cb9-a4c1-c6a62a091e86.png)'
  id: totrans-232
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/68d046c1-29af-4cb9-a4c1-c6a62a091e86.png)'
- en: 'You will get a default unit `test` class with an empty test code, as shown
    in the following code snippet:'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 你将获得一个默认的单元`test`类，其中包含空白的测试代码，如下面的代码片段所示：
- en: '[PRE17]'
  id: totrans-234
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'You can change the name of this class or discard this class if you want to
    write your own `test` class:'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以更改这个类的名称，或者如果你想编写自己的`test`类，可以删除这个类：
- en: '[PRE18]'
  id: totrans-236
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'The previous code is from our newly added `ProductDate` class. Please add this
    to a new folder called `Fake`. This class just creates dummy data so that we can
    test our web application for the product:'
  id: totrans-237
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 上述代码来自我们新添加的`ProductDate`类。请将其添加到一个名为`Fake`的新文件夹中。这个类仅创建模拟数据，以便我们可以测试我们的Web应用程序的产品：
- en: '[PRE19]'
  id: totrans-238
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Add a new file called `ProductTests` in the `Services` folder. Please note that
    we are using `Stubs` and `Mocks` in this code.
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Services`文件夹中添加一个名为`ProductTests`的新文件。请注意，我们在代码中使用`Stubs`和`Mocks`。
- en: 'Our previous code will complain about the error using red squiggly lines, as
    shown in the following screenshot:'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 我们之前的代码将使用红色波浪线显示错误，如下截图所示：
- en: '![](img/de3be8e2-682c-40e9-a3ac-2c5f2bc64507.png)'
  id: totrans-241
  prefs: []
  type: TYPE_IMG
  zh: '![](img/de3be8e2-682c-40e9-a3ac-2c5f2bc64507.png)'
- en: 'The previous code has errors as we did not add certain packages that were required
    for us to perform tests. To overcome these errors, we should install `moq` support
    to our `test` project. Pass the following command in your Package Manager Console:'
  id: totrans-242
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 之前的代码有错误，因为我们没有添加执行测试所需的某些包。为了克服这些错误，我们应该在我们的 `test` 项目中安装 `moq` 支持。在包管理控制台中输入以下命令：
- en: '[PRE20]'
  id: totrans-243
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'The preceding command will install the `moq` framework in the test project.
    Please note that while firing the preceding command, you should select the test
    project that we have created:'
  id: totrans-244
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 上述命令将在测试项目中安装 `moq` 框架。请注意，在执行上述命令时，您应该选择我们创建的测试项目：
- en: '![](img/0f6d860c-70f3-447d-b6a2-e3bdd6e3ec46.png)'
  id: totrans-245
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0f6d860c-70f3-447d-b6a2-e3bdd6e3ec46.png)'
- en: Once `moq` is installed, you can go ahead and start testing.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦安装了 `moq`，您就可以开始测试了。
- en: 'Important points to note while you''re working with the `xUnit` test projects
    are as follows:'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 在您使用 `xUnit` 测试项目时需要注意的重要点如下：
- en: '**Fact** is an attribute and is used for a normal test method that is without
    parameters.'
  id: totrans-248
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事实** 是一个属性，用于没有参数的正常测试方法。'
- en: '**Theory** is an attribute and is used for a parameterized test method.'
  id: totrans-249
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**理论** 是一个属性，用于参数化测试方法。'
- en: 'All set. Now, click on Test explorer and run your tests:'
  id: totrans-250
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一切就绪。现在，点击测试资源管理器并运行您的测试：
- en: '![](img/f0688d2c-d36b-46e4-9c3f-a397ad044b51.png)'
  id: totrans-251
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f0688d2c-d36b-46e4-9c3f-a397ad044b51.png)'
- en: Finally, our tests have passed! This means that our controller methods are good,
    and we do not have any issues or bugs in our code that can break the functionality
    of the application/system.
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们的测试通过了！这意味着我们的控制器方法是好的，我们的代码中没有问题或错误，这些错误可能会破坏应用程序/系统的功能。
- en: Summary
  id: totrans-253
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: The main goal of this chapter was to make it possible for our web application
    to safeguard against unattended requests. This chapter covered a step-by-step
    creation of a web application using Visual Studio and discussed authentication
    and authorization. We also discussed TDD and created a new xUnit web test project
    where we used `Stubs` and `Mocks`.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的主要目标是使我们的 Web 应用程序能够保护不受注意的请求。本章详细介绍了使用 Visual Studio 创建 Web 应用程序的步骤，并讨论了认证和授权。我们还讨论了
    TDD，并在新的 xUnit Web 测试项目中使用了 `Stubs` 和 `Mocks`。
- en: In the next chapter, we will discuss the best practices and patterns while using
    concurrent programming in .NET Core.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将讨论在 .NET Core 中使用并发编程的最佳实践和模式。
- en: Questions
  id: totrans-256
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: 'The following questions will allow you to consolidate the information contained
    in this chapter:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 以下问题将帮助您巩固本章包含的信息：
- en: What are authentication and authorization?
  id: totrans-258
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 认证和授权是什么？
- en: Is it safe to use authentication at the first level of request and then allow
    incoming requests for restricted areas?
  id: totrans-259
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在请求的第一级使用认证然后允许对受限区域的传入请求是否安全？
- en: How can you prove that authorization always comes after authentication?
  id: totrans-260
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你如何证明授权总是在认证之后？
- en: What is TDD and why do developers care about it?
  id: totrans-261
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: TDD 是什么，为什么开发者关心它？
- en: Define TDD katas. How do they help us to improve our TDD approach?
  id: totrans-262
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义 TDD katas。它们如何帮助我们改进 TDD 方法？
- en: Further reading
  id: totrans-263
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'Congratulations, you''ve completed this chapter! To learn more about the topics
    covered in this chapter, refer to the following books:'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 恭喜你，你已经完成了这一章！要了解更多关于本章涉及的主题，请参阅以下书籍：
- en: '*Building RESTful Web services with .NET Core*, by *Gaurav Aroraa, Tadit Dash*,
    published by *Packt Publishing*: [https://www.packtpub.com/application-development/building-restful-web-services-net-core](https://www.packtpub.com/application-development/building-restful-web-services-net-core)'
  id: totrans-265
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由 *Gaurav Aroraa* 和 *Tadit Dash* 撰写，并由 *Packt Publishing* 出版的《*使用 .NET Core
    构建 RESTful Web 服务*》：[https://www.packtpub.com/application-development/building-restful-web-services-net-core](https://www.packtpub.com/application-development/building-restful-web-services-net-core)
- en: '*C# and .NET Core Test Driven Development*, by *Ayobami Adewole*, published
    by *Packt Publishing*: [https://www.packtpub.com/in/application-development/c-and-net-core-test-driven-development](https://www.packtpub.com/in/application-development/c-and-net-core-test-driven-development)'
  id: totrans-266
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由 *Ayobami Adewole* 撰写，并由 *Packt Publishing* 出版的《*C# 和 .NET Core 测试驱动开发*》：[https://www.packtpub.com/in/application-development/c-and-net-core-test-driven-development](https://www.packtpub.com/in/application-development/c-and-net-core-test-driven-development)
