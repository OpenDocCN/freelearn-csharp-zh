<html><head></head><body>
  <div><h1 class="chapter-number" id="_idParaDest-56">
    <a id="_idTextAnchor056">
    </a>
    
     4
    
   </h1>
   <h1 id="_idParaDest-57">
    <a id="_idTextAnchor057">
    </a>
    
     Documentation with Swagger
    
   </h1>
   <p>
    
     In this chapter, we’ll look at documenting your project with Swagger.
    
    
     Human-readable documentation is critical in an API.
    
    
     It allows your clients to understand each endpoint and the potential
    
    
     
      responses quickly.
     
    
   </p>
   <p>
    
     We’ll ensure that our Swagger documentation adheres to the OpenAPI (formerly Swagger) Specification by utilizing XML and incorporating attributes within the code.
    
    
     You can learn more
    
    <a id="_idIndexMarker077">
    </a>
    
     about OpenAPI
    
    
     
      at
     
    
    <a href="https://swagger.io/docs/specification/about/">
     
      
       https://swagger.io/docs/specification/about/
      
     
    </a>
    
     
      .
     
    
   </p>
   <p>
    
     Swagger needs an OpenAPI implementation, and in the case of .NET, Swashbuckle serves as the
    
    
     
      designated option.
     
    
   </p>
   <p>
    
     In this chapter, we will cover the
    
    
     
      following topics:
     
    
   </p>
   <ul>
    <li>
     
      What
     
     
      
       Swagger is
      
     
    </li>
    <li>
     
      How Swagger
     
     
      
       is used
      
     
    </li>
    <li>
     
      How to set
     
     
      
       up Swagger
      
     
    </li>
    <li>
     
      How to pass parameters
     
     
      
       to Swagger
      
     
    </li>
   </ul>
   <h1 id="_idParaDest-58">
    <a id="_idTextAnchor058">
    </a>
    
     Technical requirements
    
   </h1>
   <p>
    
     For this chapter, all you will need is Visual Studio.
    
    
     All of the features we’ll be using come with Visual Studio, or can be obtained for free
    
    
     
      through NuGet.
     
    
   </p>
   <p>
    
     The code files for this book are available in the book’s GitHub repository :
    
    <a href="https://github.com/PacktPublishing/Programming-APIs-with-C-Sharp-and-.NET/tree/main/Chapter04">
     
      
       https://github.com/PacktPublishing/Programming-APIs-with-C-Sharp-and-.NET/tree/main/Chapter04
      
     
    </a>
   </p>
   <h1 id="_idParaDest-59">
    <a id="_idTextAnchor059">
    </a>
    
     Setting up the Swagger documentation
    
   </h1>
   <p>
    
     To install
    
    <a id="_idIndexMarker078">
    </a>
    
     Swagger, open your solution and from the menu, select
    
    <strong class="bold">
     
      Tools
     
    </strong>
    
     |
    
    <strong class="bold">
     
      NuGet Package Manager
     
    </strong>
    
     |
    
    <strong class="bold">
     
      Manage NuGet Packages for Solution
     
    </strong>
    
     .
    
    
     Install the latest version
    
    
     
      of
     
    
    
     <strong class="source-inline">
      
       Swashbuckle.AspNetCore
      
     </strong>
    
    
     
      .
     
    
   </p>
   <p>
    
     Right-click on your project file and click on
    
    <strong class="bold">
     
      Properties
     
    </strong>
    
     .
    
    
     On the left of your screen, choose
    
    <strong class="bold">
     
      Application
     
    </strong>
    
     .
    
    
     On the right, choose
    
    <strong class="bold">
     
      Console Application
     
    </strong>
    
     , as shown in
    
    
     <em class="italic">
      
       Figure 4
      
     </em>
    
    
     <em class="italic">
      
       .1
      
     </em>
    
    
     
      :
     
    
   </p>
   <div><div><img alt="Figure 4.1 – Installation part 1" src="img/B21988_04_01.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.1 – Installation part 1
    
   </p>
   <p>
    
     Under
    
    <strong class="bold">
     
      Build
     
    </strong>
    
     , choose
    
    <strong class="bold">
     
      Output
     
    </strong>
    
     and scroll down to
    
    <strong class="bold">
     
      Documentation file
     
    </strong>
    
     .
    
    
     Check the
    
    <strong class="bold">
     
      Generate a file containing API documentation
     
    </strong>
    
     box, as shown in
    
    
     <em class="italic">
      
       Figure 4
      
     </em>
    
    
     <em class="italic">
      
       .2
      
     </em>
    
    
     
      :
     
    
   </p>
   <div><div><img alt="Figure 4.2 – Setting up Swagger output" src="img/B21988_04_02.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.2 – Setting up Swagger output
    
   </p>
   <p class="callout-heading">
    
     Note
    
   </p>
   <p class="callout">
    
     In
    
    
     <em class="italic">
      
       Figure 4
      
     </em>
    
    <em class="italic">
     
      .2
     
    </em>
    
     ,
    
    <strong class="bold">
     
      Generate a file containing API documentation
     
    </strong>
    
     is checked.
    
    
     The file that is generated can be imported into other applications, such as Postman, for an integrated documentation and
    
    
     
      testing experience.
     
    
   </p>
   <p>
    
     Open
    
    <strong class="source-inline">
     
      Program.cs
     
    </strong>
    
     (typically the last file in Solution Explorer) and add the Swagger generator
    
    <a id="_idIndexMarker079">
    </a>
    
     to the
    
    
     
      services collection:
     
    
   </p>
   <pre class="source-code">
builder.Services.AddSwaggerGen(
 x =&gt;
 {
     x.SwaggerDoc(
         "v1",
         new OpenApiInfo
         {
             Title = $"{Assembly.GetExecutingAssembly().GetName().
             Name}",
             Version = "Version 1",
             Description = "Create documentation for Cars",
             Contact = new OpenApiContact
             {
                 Name = "Jesse Liberty",
                 Email = "jesseliberty@gmail.com",
                 Url = new Uri("https://jesseliberty.com")
             }
         });
             var xmlFilename = System.IO.Path.Combine(System.
             AppContext.BaseDirectory, $"{Assembly.
             GetExecutingAssembly().GetName().Name}.xml");
             x.IncludeXmlComments(xmlFilename);
});</pre>
   <p>
    
     Save
    
    <a id="_idIndexMarker080">
    </a>
    
     everything.
    
    
     That’s it.
    
    
     This is only done once.
    
    
     You have now set up Swagger documentation.
    
    
     In fact, you’ve already added the description, name, and contact information.
    
    
     The result is shown in
    
    
     <em class="italic">
      
       Figure 4
      
     </em>
    
    <em class="italic">
     
      .3
     
    </em>
    
     .
    
    
     This is what you will see when you start your program and Swagger opens a browser window to display
    
    
     
      its interface:
     
    
   </p>
   <div><div><img alt="Figure 4.3 – Top of Swagger documentation" src="img/B21988_04_03.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.3 – Top of Swagger documentation
    
   </p>
   <p>
    
     Notice that on this page, the website and email are live links and the text
    
    <strong class="source-inline">
     
      Create documentation for Cars
     
    </strong>
    
     is what you put in the description in the
    
    
     
      preceding code.
     
    
   </p>
   <h1 id="_idParaDest-60">
    <a id="_idTextAnchor060">
    </a>
    
     Swagger for the controller
    
   </h1>
   <p>
    
     Swagger
    
    <a id="_idIndexMarker081">
    </a>
    
     documentation is implemented using XML comments.
    
    
     XML comments are preceded by three slash marks.
    
    
     Here’s
    
    
     
      an example:
     
    
   </p>
   <pre class="source-code">
/// XML comment</pre>
   <p>
    
     XML comments are paired tags, such as
    
    
     
      the following:
     
    
   </p>
   <pre class="source-code">
/// &lt;summary&gt;
…
/// &lt;/summary&gt;</pre>
   <p>
    
     Let’s start with the controller of our Cars application.
    
    
     We’re going to put Swagger documentation above every method in
    
    
     
      the controller.
     
    
   </p>
   <p>
    
     The first comment we’ll add is
    
    
     
      the summary:
     
    
   </p>
   <pre class="source-code">
/// &lt;summary&gt;
/// Get all the cars in the Database
/// &lt;/summary&gt;</pre>
   <p>
    
     This comment will appear next to the route for the
    
    <strong class="bold">
     
      GET
     
    </strong>
    
     button, as shown in
    
    
     <em class="italic">
      
       Figure 4
      
     </em>
    
    
     <em class="italic">
      
       .4
      
     </em>
    
    
     
      :
     
    
   </p>
   <div><div><img alt="Figure 4.4 – Display the summary" src="img/B21988_04_04.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.4 – Display the summary
    
   </p>
   <p>
    
     Before we
    
    <a id="_idIndexMarker082">
    </a>
    
     go any further, let’s look at what we get from Swagger without writing any
    
    
     
      additional code.
     
    
   </p>
   <h2 id="_idParaDest-61">
    <a id="_idTextAnchor061">
    </a>
    
     Swagger out of the box
    
   </h2>
   <p>
    
     Note that Swagger will
    
    <a id="_idIndexMarker083">
    </a>
    
     come up automatically just after you start
    
    
     
      your application.
     
    
   </p>
   <p>
    
     To see the auto-generated documentation, click on the arrow on the far right as circled in
    
    
     <em class="italic">
      
       Figure 4
      
     </em>
    
    <em class="italic">
     
      .4
     
    </em>
    
     .
    
    
     Swagger opens the details of the
    
    <strong class="bold">
     
      Get
     
    </strong>
    
     command, as shown in
    
    
     <em class="italic">
      
       Figure 4
      
     </em>
    
    
     <em class="italic">
      
       .5
      
     </em>
    
    
     
      :
     
    
   </p>
   <div><div><img alt="Figure 4.5 – Swagger out of the box" src="img/B21988_04_05.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.5 – Swagger out of the box
    
   </p>
   <p>
    
     This is a little
    
    <a id="_idIndexMarker084">
    </a>
    
     hard to see, so let’s zoom in on a couple of important parts.
    
    
     In the upper-left corner is an area for all the parameters you’ll be sending in for the
    
    <strong class="source-inline">
     
      GetAll
     
    </strong>
    
     command.
    
    
     We are sending in
    
    <strong class="source-inline">
     
      returnDeletedRecords
     
    </strong>
    
     with a default value of
    
    <strong class="source-inline">
     
      false
     
    </strong>
    
     .
    
    
     <em class="italic">
      
       Figure 4
      
     </em>
    
    <em class="italic">
     
      .6
     
    </em>
    
     shows how Swagger
    
    
     
      depicts this:
     
    
   </p>
   <div><div><img alt="Figure 4.6 – Parameters" src="img/B21988_04_06.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.6 – Parameters
    
   </p>
   <p>
    
     Notice the
    
    <a id="_idIndexMarker085">
    </a>
    
     dropdown.
    
    
     It lets you try out both possible values (
    
    <strong class="source-inline">
     
      false
     
    </strong>
    
     
      and
     
    
    
     <strong class="source-inline">
      
       true
      
     </strong>
    
    
     
      ).
     
    
   </p>
   <p>
    
     Next, on the left side are the code and description for the potential responses from the server.
    
    
     <em class="italic">
      
       Figure 4
      
     </em>
    
    <em class="italic">
     
      .7
     
    </em>
    
     shows that the first potential response is
    
    
     <strong class="source-inline">
      
       200: Success
      
     </strong>
    
    
     
      :
     
    
   </p>
   <div><div><img alt="Figure 4.7 – Success" src="img/B21988_04_07.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.7 – Success
    
   </p>
   <p>
    
     Beneath the first response code is the schema that tells you what properties there are and what their type is, as shown in
    
    
     <em class="italic">
      
       Figure 4
      
     </em>
    
    
     <em class="italic">
      
       .8
      
     </em>
    
    
     
      :
     
    
   </p>
   <div><div><img alt="Figure 4.8 – Schema" src="img/B21988_04_08.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.8 – Schema
    
   </p>
   <p>
    
     We are all set to
    
    <a id="_idIndexMarker086">
    </a>
    
     see the effects of our comments.
    
    
     Let’s take a look at what happens when we start the application and Swagger
    
    
     
      comes up.
     
    
   </p>
   <h1 id="_idParaDest-62">
    <a id="_idTextAnchor062">
    </a>
    
     Running your API in Swagger
    
   </h1>
   <p>
    
     Most
    
    <a id="_idIndexMarker087">
    </a>
    
     importantly, in the upper-right corner is a
    
    <strong class="bold">
     
      Try It Out
     
    </strong>
    
     button.
    
    
     Clicking on this button puts Swagger into interactive mode, and allows you to try out your code.
    
    
     When that button is clicked, two other buttons appear:
    
    <strong class="bold">
     
      Execute
     
    </strong>
    
     and
    
    <strong class="bold">
     
      Clear
     
    </strong>
    
     .
    
    
     Pressing
    
    <strong class="bold">
     
      Execute
     
    </strong>
    
     causes the code to run and in our case returns the list of cars, along with some other metadata.
    
    
     Let’s zero in on that (
    
    <strong class="bold">
     
      Clear
     
    </strong>
    
     removes the results so that you can
    
    
     
      try again).
     
    
   </p>
   <p>
    
     The first thing we see is marked as
    
    <strong class="bold">
     
      Curl
     
    </strong>
    
     , as shown in
    
    
     <em class="italic">
      
       Figure 4
      
     </em>
    
    
     <em class="italic">
      
       .9
      
     </em>
    
    
     
      :
     
    
   </p>
   <div><div><img alt="Figure 4.9 – Every Swagger page displays the curl for the endpoint" src="img/B21988_04_09.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.9 – Every Swagger page displays the curl for the endpoint
    
   </p>
   <p>
    
     According to Wikipedia, “
    
    <em class="italic">
     
      Curl combines text markup (as in HTML), scripting (as in JavaScript), and heavy-duty computing (as in Java, C#, or C++) within one unified framework
     
    </em>
    
     ”.
    
    
     We will be ignoring Curl in
    
    
     
      this book.
     
    
   </p>
   <p>
    
     Below that, we
    
    <a id="_idIndexMarker088">
    </a>
    
     see the request URL that we submitted to the server, as shown in
    
    
     <em class="italic">
      
       Figure 4
      
     </em>
    
    
     <em class="italic">
      
       .10
      
     </em>
    
    
     
      :
     
    
   </p>
   <div><div><img alt="Figure 4.10 – Request URL as displayed in Swagger" src="img/B21988_04_10.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.10 – Request URL as displayed in Swagger
    
   </p>
   <p>
    
     Notice that we are working with port
    
    <strong class="source-inline">
     
      7025
     
    </strong>
    
     (yours may differ) on localhost and that we pass our parameter (
    
    <strong class="source-inline">
     
      returnDeletedRecords=false
     
    </strong>
    
     ) as we would with
    
    
     
      any HTML.
     
    
   </p>
   <p>
    
     Next comes the most important server response: the response body, as shown in
    
    
     <em class="italic">
      
       Figure 4
      
     </em>
    
    
     <em class="italic">
      
       .11
      
     </em>
    
    
     
      :
     
    
   </p>
   <div><div><img alt="Figure 4.11 – Server response" src="img/B21988_04_11.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.11 – Server response
    
   </p>
   <p>
    
     Finally, the schema
    
    <a id="_idIndexMarker089">
    </a>
    
     of the response object is displayed, as shown in
    
    
     <em class="italic">
      
       Figure 4
      
     </em>
    
    
     <em class="italic">
      
       .12
      
     </em>
    
    
     
      :
     
    
   </p>
   <div><div><img alt="Figure 4.12 – Response schema" src="img/B21988_04_12.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.12 – Response schema
    
   </p>
   <p>
    
     Swagger is terrific for
    
    <a id="_idIndexMarker090">
    </a>
    
     documentation, but somewhat limited as a way to test your application.
    
    
     As we’ll see, Postman is a much more powerful application
    
    
     
      for testing.
     
    
   </p>
   <h2 id="_idParaDest-63">
    <a id="_idTextAnchor063">
    </a>
    
     param tag
    
   </h2>
   <p>
    
     If your verb has
    
    <a id="_idIndexMarker091">
    </a>
    
     parameters, you can document them in the Swagger attributes using the
    
    <strong class="source-inline">
     
      param
     
    </strong>
    
     keyword.
    
    
     For example, in our case, we want to document the
    
    <strong class="source-inline">
     
      returnDeletedRecords
     
    </strong>
    
     parameter.
    
    
     We can do so
    
    
     
      like this:
     
    
   </p>
   <pre class="source-code">
/// &lt;summary&gt;
/// Get all the cars in the Database
/// &lt;/summary&gt;
/// &lt;param name="returnDeletedRecords"&gt;If true, the method will return all the records, including the ones that have been deleted&lt;/param&gt;</pre>
   <p>
    
     The result is that the parameter is documented in Swagger, as shown in
    
    
     <em class="italic">
      
       Figure 4
      
     </em>
    
    
     <em class="italic">
      
       .13
      
     </em>
    
    
     
      :
     
    
   </p>
   <div><div><img alt="Figure 4.13 – Documenting the parameters" src="img/B21988_04_13.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.13 – Documenting the parameters
    
   </p>
   <h2 id="_idParaDest-64">
    <a id="_idTextAnchor064">
    </a>
    
     Response codes
    
   </h2>
   <p>
    
     You
    
    <a id="_idIndexMarker092">
    </a>
    
     can (and should) document all the possible response codes and what
    
    
     
      they indicate:
     
    
   </p>
   <pre class="source-code">
/// &lt;response code="200"&gt;Cars returned&lt;/response&gt;
/// &lt;response code="404"&gt;Specified Car not found&lt;/response&gt;
/// &lt;response code="500"&gt;An Internal Server Error prevented the request from being executed.&lt;/response&gt;</pre>
   <p>
    
     The result is that the return codes are documented in Swagger, as shown in
    
    
     <em class="italic">
      
       Figure 4
      
     </em>
    
    
     <em class="italic">
      
       .14
      
     </em>
    
    
     
      :
     
    
   </p>
   <div><div><img alt="Figure 4.14 – Documenting the return codes" src="img/B21988_04_14.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.14 – Documenting the return codes
    
   </p>
   <p>
    
     While this all
    
    <a id="_idIndexMarker093">
    </a>
    
     takes a bit of effort, it becomes routine and is a best practice.
    
    
     It also makes the lives of your clients
    
    
     
      far easier.
     
    
   </p>
   <h1 id="_idParaDest-65">
    <a id="_idTextAnchor065">
    </a>
    
     Summary
    
   </h1>
   <p>
    
     In this chapter, you learned how to set up Swashbuckle to enable Swagger.
    
    
     Swagger provides extensive documentation of your API, allowing (human) clients to learn about each endpoint and what it is for.
    
    
     In addition, you can also document each parameter and the potential
    
    
     
      error codes.
     
    
   </p>
   <p>
    
     In the next chapter, you’ll see how we can validate endpoint requests on the way in – preventing wasted resources and protecting you from various attacks against
    
    
     
      your system.
     
    
   </p>
   <h1 id="_idParaDest-66">
    <a id="_idTextAnchor066">
    </a>
    
     You try it
    
   </h1>
   <p>
    
     Install Swagger and create the documentation for the
    
    <strong class="source-inline">
     
      Insert
     
    </strong>
    
     endpoint in the
    
    <strong class="source-inline">
     
      Car
     
    </strong>
    
     controller.
    
    
     Run Swagger to ensure that all your documentation is
    
    
     
      displayed properly.
     
    
   </p>
  </div>
 </body></html>