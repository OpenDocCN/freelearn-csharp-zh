<html><head></head><body>
<div id="_idContainer023">
<h1 class="chapter-number" id="_idParaDest-30"><a id="_idTextAnchor031"/><span class="koboSpan" id="kobo.1.1">2</span></h1>
<h1 id="_idParaDest-31"><a id="_idTextAnchor032"/><span class="koboSpan" id="kobo.2.1">CI/CD – Building Quality Software Automatically</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In my career, someone once said to me, “</span><em class="italic"><span class="koboSpan" id="kobo.4.1">CI/CD is dead, long live CI/CD</span></em><span class="koboSpan" id="kobo.5.1">.” </span><span class="koboSpan" id="kobo.5.2">Of course, this phrase doesn’t mean it’s completely dead. </span><span class="koboSpan" id="kobo.5.3">It simply means CI/CD is now becoming the standard for software development, a common practice developers should adopt and learn during a software development life cycle. </span><span class="koboSpan" id="kobo.5.4">It is now considered part of your development process as opposed to being a shiny, </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">new process.</span></span></p>
<p><span class="koboSpan" id="kobo.7.1">In this chapter, we’ll review what </span><strong class="bold"><span class="koboSpan" id="kobo.8.1">Continuous Integration</span></strong><span class="koboSpan" id="kobo.9.1">/</span><strong class="bold"><span class="koboSpan" id="kobo.10.1">Continuous Deployment</span></strong><span class="koboSpan" id="kobo.11.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.12.1">CI</span></strong><span class="koboSpan" id="kobo.13.1">/</span><strong class="bold"><span class="koboSpan" id="kobo.14.1">CD</span></strong><span class="koboSpan" id="kobo.15.1">) means and how to prepare your code for a pipeline. </span><span class="koboSpan" id="kobo.15.2">Once we’ve covered the necessary changes to include in your code, we’ll discuss what a common pipeline looks like for building software. </span><span class="koboSpan" id="kobo.15.3">Once we understand the pipeline process, we’ll look at two ways to recover from an unsuccessful deployment and how to deploy databases. </span><span class="koboSpan" id="kobo.15.4">We’ll also cover the three different types of cloud services available to you (on and off-premises and hybrid) and review a list of the top CI/CD providers on the internet. </span><span class="koboSpan" id="kobo.15.5">Finally, we’ll walk you through the process of creating a build for a sample application, along with other types </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">of projects.</span></span></p>
<p><span class="koboSpan" id="kobo.17.1">In this chapter, we will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.19.1">What </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">is CI/CD?</span></span></li>
<li><span class="koboSpan" id="kobo.21.1">Preparing </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">your Code</span></span></li>
<li><span class="koboSpan" id="kobo.23.1">Understanding </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1">the Pipeline</span></span></li>
<li><span class="koboSpan" id="kobo.25.1">The Two “</span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">Falling” Approaches</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.27.1">Deploying Databases</span></span></li>
<li><span class="koboSpan" id="kobo.28.1">The three Types of </span><span class="No-Break"><span class="koboSpan" id="kobo.29.1">Build Providers</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.30.1">CI/CD Providers</span></span></li>
<li><span class="koboSpan" id="kobo.31.1">Walkthrough of </span><span class="No-Break"><span class="koboSpan" id="kobo.32.1">Azure Pipelines</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.33.1">After you’ve completed this chapter, you’ll be able to identify flaws in software when you’re preparing code for software deployment, understand what a common pipeline includes in producing quality software, identify two ways of recovering from an unsuccessful deployment, know how to deploy databases through a pipeline, understand the different types of CI/CD providers, and know some key players in the CI/CD </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">provider space.</span></span></p>
<p><span class="koboSpan" id="kobo.35.1">Finally, we’ll walk through a common pipeline in Azure Pipelines to encompass everything we’ve learned in </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">this chapter.</span></span></p>
<h1 id="_idParaDest-32"><a id="_idTextAnchor033"/><span class="koboSpan" id="kobo.37.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.38.1">For this chapter, the only technical requirements include having access to a laptop and an account for one of the cloud providers mentioned in the </span><em class="italic"><span class="koboSpan" id="kobo.39.1">CI/CD providers</span></em><span class="koboSpan" id="kobo.40.1"> section (preferably Microsoft’s Azure Pipelines – don’t worry, </span><span class="No-Break"><span class="koboSpan" id="kobo.41.1">it’s free).</span></span></p>
<p><span class="koboSpan" id="kobo.42.1">Once you have reviewed how pipelines are created, you’ll be able to apply the same concepts to other cloud providers and their </span><span class="No-Break"><span class="koboSpan" id="kobo.43.1">pipeline strategies.</span></span></p>
<h1 id="_idParaDest-33"><a id="_idTextAnchor034"/><span class="koboSpan" id="kobo.44.1">What is CI/CD?</span></h1>
<p><span class="koboSpan" id="kobo.45.1">In this section, we’ll learn about what continuous integration and continuous deployment mean </span><span class="No-Break"><span class="koboSpan" id="kobo.46.1">to developers.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.47.1">Continuous Integration</span></strong><span class="koboSpan" id="kobo.48.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.49.1">CI</span></strong><span class="koboSpan" id="kobo.50.1">) is the process of merging all developers’ code</span><a id="_idIndexMarker043"/><span class="koboSpan" id="kobo.51.1"> into a mainline to trigger an automatic build process so that you can quickly identify issues with a code base using unit tests and </span><span class="No-Break"><span class="koboSpan" id="kobo.52.1">code analysis.</span></span></p>
<p><span class="koboSpan" id="kobo.53.1">When a developer checks their code into a branch, it’s reviewed by peer developers. </span><span class="koboSpan" id="kobo.53.2">Once accepted, it’s merged into a mainline and automatically starts a build process. </span><span class="koboSpan" id="kobo.53.3">This build process will be </span><span class="No-Break"><span class="koboSpan" id="kobo.54.1">covered shortly.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.55.1">Continuous Deployment</span></strong><span class="koboSpan" id="kobo.56.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.57.1">CD</span></strong><span class="koboSpan" id="kobo.58.1">) is the process of consistently creating</span><a id="_idIndexMarker044"/><span class="koboSpan" id="kobo.59.1"> software to deploy it at </span><span class="No-Break"><span class="koboSpan" id="kobo.60.1">any time.</span></span></p>
<p><span class="koboSpan" id="kobo.61.1">Once everything has been built through the automated process, the build prepares the compiled code and creates artifacts. </span><span class="koboSpan" id="kobo.61.2">These artifacts are used for consistent deployments across various environments, such as development, staging, </span><span class="No-Break"><span class="koboSpan" id="kobo.62.1">and production.</span></span></p>
<p><span class="koboSpan" id="kobo.63.1">The benefits of implementing a CI/CD pipeline</span><a id="_idIndexMarker045"/><span class="koboSpan" id="kobo.64.1"> outweigh not </span><span class="No-Break"><span class="koboSpan" id="kobo.65.1">having one:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.66.1">Automated Testing</span></strong><span class="koboSpan" id="kobo.67.1">: When a commit is triggered, your tests are automatically executed along with your build. </span><span class="koboSpan" id="kobo.67.2">Think of this as someone always checking your code </span><span class="No-Break"><span class="koboSpan" id="kobo.68.1">on commit.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.69.1">Faster Feedback Loops</span></strong><span class="koboSpan" id="kobo.70.1">: As a developer, it’s always great to receive immediate feedback to find out whether something works or not. </span><span class="koboSpan" id="kobo.70.2">If you receive an email where the build broke, you’re on </span><span class="No-Break"><span class="koboSpan" id="kobo.71.1">your own.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.72.1">Consistent Builds</span></strong><span class="koboSpan" id="kobo.73.1">: Once you have a project being built on a build server, you can create builds on-demand – and consistently – </span><span class="No-Break"><span class="koboSpan" id="kobo.74.1">with tests.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.75.1">Collaboration Between Teams</span></strong><span class="koboSpan" id="kobo.76.1">: We’re all in this together and CI/CD includes developers, system administrators, project managers/SCRUM masters, and QA testers, to name a few, to accomplish the goal of creating </span><span class="No-Break"><span class="koboSpan" id="kobo.77.1">great software.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.78.1">In this section, we reviewed the definition of what continuous integration and continuous deployment mean when developing software in an automated fashion and the benefits of implementing a </span><span class="No-Break"><span class="koboSpan" id="kobo.79.1">CI/CD pipeline.</span></span></p>
<p><span class="koboSpan" id="kobo.80.1">In the next section, we’ll learn about certain code practices to avoid when automating </span><span class="No-Break"><span class="koboSpan" id="kobo.81.1">software builds.</span></span></p>
<h1 id="_idParaDest-34"><a id="_idTextAnchor035"/><span class="koboSpan" id="kobo.82.1">Preparing your Code</span></h1>
<p><span class="koboSpan" id="kobo.83.1">In this section, we’ll cover certain aspects of your code</span><a id="_idIndexMarker046"/><span class="koboSpan" id="kobo.84.1"> and how they could impact the deployment of your software. </span><span class="koboSpan" id="kobo.84.2">Such software issues could include code not compiling (broken builds), avoiding relative path names, and making sure you wrote proper unit tests. </span><span class="koboSpan" id="kobo.84.3">These are a couple of the common errors I’ve experienced over the years; in this section, I’ll also provide solutions on how to </span><span class="No-Break"><span class="koboSpan" id="kobo.85.1">fix them.</span></span></p>
<p><span class="koboSpan" id="kobo.86.1">Before we review a CI pipeline, there are a few caveats we should address beforehand. </span><span class="koboSpan" id="kobo.86.2">Even though we covered a lot in the previous chapter regarding version control, your code needs to be in a certain state to achieve “</span><span class="No-Break"><span class="koboSpan" id="kobo.87.1">one-button” builds.</span></span></p>
<p><span class="koboSpan" id="kobo.88.1">In the following sections, you’ll learn how to prepare your code</span><a id="_idIndexMarker047"/><span class="koboSpan" id="kobo.89.1"> so that it’s “CI/CD-ready” and examine the problems you could experience when deploying your software and how to </span><span class="No-Break"><span class="koboSpan" id="kobo.90.1">avoid them.</span></span></p>
<h2 id="_idParaDest-35"><a id="_idTextAnchor036"/><span class="koboSpan" id="kobo.91.1">Building Flawlessly</span></h2>
<p><span class="koboSpan" id="kobo.92.1">If a new person is hired</span><a id="_idIndexMarker048"/><span class="koboSpan" id="kobo.93.1"> and starts immediately, you want them to hit the ground running and begin developing software without delay. </span><span class="koboSpan" id="kobo.93.2">This means being able to point them to a repository and pull the code so that you can </span><em class="italic"><span class="koboSpan" id="kobo.94.1">immediately</span></em><span class="koboSpan" id="kobo.95.1"> run the code </span><em class="italic"><span class="koboSpan" id="kobo.96.1">with </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.97.1">minimal setup</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.98.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.99.1">I say “minimal setup” because there may be permissions involved to gain access to certain resources in the company so that they can be </span><span class="No-Break"><span class="koboSpan" id="kobo.100.1">run locally.</span></span></p>
<p><span class="koboSpan" id="kobo.101.1">Nevertheless, the code should be in a runnable state, send you to a simple screen of some kind, and notify the user to follow up on a permissions issue or provide some notification to resolve </span><span class="No-Break"><span class="koboSpan" id="kobo.102.1">the problem.</span></span></p>
<p><span class="koboSpan" id="kobo.103.1">In the previous chapter, we mentioned how the code should compile at all times. </span><span class="koboSpan" id="kobo.103.2">This means </span><span class="No-Break"><span class="koboSpan" id="kobo.104.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.105.1">The code should always compile after a clone </span><span class="No-Break"><span class="koboSpan" id="kobo.106.1">or checkout</span></span></li>
<li><span class="koboSpan" id="kobo.107.1">Unit tests should be included with the build, not in </span><span class="No-Break"><span class="koboSpan" id="kobo.108.1">separate projects</span></span></li>
<li><span class="koboSpan" id="kobo.109.1">Your commit messages to version control should be meaningful (they may be used for </span><span class="No-Break"><span class="koboSpan" id="kobo.110.1">Release Notes)</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.111.1">These standards allow your pipeline to fall into the pit of success. </span><span class="koboSpan" id="kobo.111.2">They help you create a build even faster and easier when your code is in a </span><span class="No-Break"><span class="koboSpan" id="kobo.112.1">clean state.</span></span></p>
<h2 id="_idParaDest-36"><a id="_idTextAnchor037"/><span class="koboSpan" id="kobo.113.1">Avoiding Relative Path Names with File-based Operations</span></h2>
<p><span class="koboSpan" id="kobo.114.1">One of the troublesome</span><a id="_idIndexMarker049"/><span class="koboSpan" id="kobo.115.1"> issues I’ve seen over the years when it comes to web applications is how files are accessed in a </span><span class="No-Break"><span class="koboSpan" id="kobo.116.1">web application.</span></span></p>
<p><span class="koboSpan" id="kobo.117.1">I’ve also seen file-based operations through a web page, where files were moved using relative paths and it went wrong. </span><span class="koboSpan" id="kobo.117.2">It involved deleting directories and it didn’t </span><span class="No-Break"><span class="koboSpan" id="kobo.118.1">end well.</span></span></p>
<p><span class="koboSpan" id="kobo.119.1">For example, let’s say you had a relative path to an image, </span><span class="No-Break"><span class="koboSpan" id="kobo.120.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.121.1">
../images/myimage.jpg</span></pre> <p><span class="koboSpan" id="kobo.122.1">Now, let’s say you’re sitting on a web page, such </span><span class="No-Break"><span class="koboSpan" id="kobo.123.1">as </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.124.1">https://localhost/kitchen/chairs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.125.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.126.1">If you went back one directory, you’d be in the kitchen with a missing image, not at the root of the website. </span><span class="koboSpan" id="kobo.126.2">According to your relative path, you’re looking for an image directory </span><span class="No-Break"><span class="koboSpan" id="kobo.127.1">at </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.128.1">https://localhost/kitchen/images/myimage.jpg</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.129.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.130.1">To make matters worse, if you’re using custom routing, this may not even be the normal path, and who knows where it’s looking for </span><span class="No-Break"><span class="koboSpan" id="kobo.131.1">the image.</span></span></p>
<p><span class="koboSpan" id="kobo.132.1">The best approach when preparing your code is to use a single slash (</span><strong class="source-inline"><span class="koboSpan" id="kobo.133.1">/</span></strong><span class="koboSpan" id="kobo.134.1">) at the beginning of your URL since it’s </span><span class="No-Break"><span class="koboSpan" id="kobo.135.1">considered “absolute:”</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.136.1">
/images/myimage.jpg</span></pre> <p><span class="koboSpan" id="kobo.137.1">This makes it easier to navigate</span><a id="_idIndexMarker050"/><span class="koboSpan" id="kobo.138.1"> to the root when you’re locating files on a website, regardless of what environment you’re in. </span><span class="koboSpan" id="kobo.138.2">It doesn’t matter if you are on </span><a href="https://www.myfakewebsite.com/"><span class="koboSpan" id="kobo.139.1">https://www.myfakewebsite.com/</span></a><span class="koboSpan" id="kobo.140.1"> or </span><a href="http://localhost/"><span class="koboSpan" id="kobo.141.1">http://localhost/</span></a><span class="koboSpan" id="kobo.142.1">, the root is the root, and you’ll always find your files when using a single slash at the beginning of </span><span class="No-Break"><span class="koboSpan" id="kobo.143.1">your sources.</span></span></p>
<h2 id="_idParaDest-37"><a id="_idTextAnchor038"/><span class="koboSpan" id="kobo.144.1">Confirming that your Unit Tests are Unit Tests</span></h2>
<p><span class="koboSpan" id="kobo.145.1">Tests in your code are created to provide</span><a id="_idIndexMarker051"/><span class="koboSpan" id="kobo.146.1"> checks and balances so that your code works as expected. </span><span class="koboSpan" id="kobo.146.2">Each test needs to be examined carefully to confirm it isn’t doing anything out of </span><span class="No-Break"><span class="koboSpan" id="kobo.147.1">the ordinary.</span></span></p>
<p><span class="koboSpan" id="kobo.148.1">Unit tests are considered tests against code in memory, whereas integration tests are tests that require </span><em class="italic"><span class="koboSpan" id="kobo.149.1">ANY</span></em> <span class="No-Break"><span class="koboSpan" id="kobo.150.1">external resources:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.151.1">Do your tests access any files? </span><span class="No-Break"><span class="koboSpan" id="kobo.152.1">Integration test.</span></span></li>
<li><span class="koboSpan" id="kobo.153.1">Do you connect to a database to test something? </span><span class="No-Break"><span class="koboSpan" id="kobo.154.1">Integration test.</span></span></li>
<li><span class="koboSpan" id="kobo.155.1">Are you testing business logic? </span><span class="No-Break"><span class="koboSpan" id="kobo.156.1">Unit test.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.157.1">As you’re beginning to surmise, when you build your application on another machine, cloud services do not have access to your database server and also may not have the additional files you need for each test </span><span class="No-Break"><span class="koboSpan" id="kobo.158.1">to pass.</span></span></p>
<p><span class="koboSpan" id="kobo.159.1">If you are accessing external resources, it may be a better approach to refactor your tests into something a little more memory-driven. </span><span class="koboSpan" id="kobo.159.2">I’ll explain why in </span><a href="B19493_07.xhtml#_idTextAnchor163"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.160.1">Chapter 7</span></em></span></a><span class="koboSpan" id="kobo.161.1">, when we’ll cover </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.162.1">unit testing</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.163.1">.</span></span></p>
<h2 id="_idParaDest-38"><a id="_idTextAnchor039"/><span class="koboSpan" id="kobo.164.1">Creating Environment Settings</span></h2>
<p><span class="koboSpan" id="kobo.165.1">Whether you are in the middle</span><a id="_idIndexMarker052"/><span class="koboSpan" id="kobo.166.1"> of a project or are clicking </span><strong class="bold"><span class="koboSpan" id="kobo.167.1">Create New Project…</span></strong><span class="koboSpan" id="kobo.168.1"> for the first time, you need a way to create environment settings for your </span><span class="No-Break"><span class="koboSpan" id="kobo.169.1">web application.</span></span></p>
<p><span class="koboSpan" id="kobo.170.1">In ASP.NET Core applications, we are given </span><strong class="source-inline"><span class="koboSpan" id="kobo.171.1">appsettings.json</span></strong><span class="koboSpan" id="kobo.172.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.173.1">appsettings.Development.json</span></strong><span class="koboSpan" id="kobo.174.1"> configuration files out of the box. </span><span class="koboSpan" id="kobo.174.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.175.1">appsettings.json</span></strong><span class="koboSpan" id="kobo.176.1"> file is meant to be a base configuration file and, depending on the environment, each </span><strong class="source-inline"><span class="koboSpan" id="kobo.177.1">appsettings</span></strong><span class="koboSpan" id="kobo.178.1"> file is applied and only existing properties are overwritten to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.179.1">appsettings.json</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.180.1"> file.</span></span></p>
<p><span class="koboSpan" id="kobo.181.1">One common example of this is connection strings and application paths. </span><span class="koboSpan" id="kobo.181.2">Depending on the environment, each file will have its </span><span class="No-Break"><span class="koboSpan" id="kobo.182.1">own settings.</span></span></p>
<p><span class="koboSpan" id="kobo.183.1">The environments need to be defined upfront as well. </span><span class="koboSpan" id="kobo.183.2">There will always be a development and release environment. </span><span class="koboSpan" id="kobo.183.3">There may be an option to create another environment called QA on another machine somewhere, so an </span><strong class="source-inline"><span class="koboSpan" id="kobo.184.1">appsettings.qa.json</span></strong><span class="koboSpan" id="kobo.185.1"> file would be required with its own </span><span class="No-Break"><span class="koboSpan" id="kobo.186.1">environment-specific settings.</span></span></p>
<p><span class="koboSpan" id="kobo.187.1">Confirm that these settings have been saved for each relevant environment since they are important in a CI/CD pipeline. </span><em class="italic"><span class="koboSpan" id="kobo.188.1">These environment settings should always be checked into version control with your solution/project</span></em><span class="koboSpan" id="kobo.189.1"> to assist the pipeline in deploying the right settings to the </span><span class="No-Break"><span class="koboSpan" id="kobo.190.1">right environment.</span></span></p>
<p><span class="koboSpan" id="kobo.191.1">In this section, we covered ways to prepare your code for a CI/CD pipeline by making sure we can build immediately after cloning or pulling the repository down locally, why we should avoid relative-based file paths, and confirmed we were using environment-specific application settings, making it easy to build and deploy </span><span class="No-Break"><span class="koboSpan" id="kobo.192.1">our application.</span></span></p>
<p><span class="koboSpan" id="kobo.193.1">With your code checked in, we can now move forward and describe all of the stages of a </span><span class="No-Break"><span class="koboSpan" id="kobo.194.1">common pipeline.</span></span></p>
<h1 id="_idParaDest-39"><a id="_idTextAnchor040"/><span class="koboSpan" id="kobo.195.1">Understanding the Pipeline</span></h1>
<p><span class="koboSpan" id="kobo.196.1">In this section, we’ll cover the steps</span><a id="_idIndexMarker053"/><span class="koboSpan" id="kobo.197.1"> of what a common pipeline includes for building software when using a CI/CD service. </span><span class="koboSpan" id="kobo.197.2">When you reach the end of this section, you’ll understand every step of the process in a common pipeline so that you can produce </span><span class="No-Break"><span class="koboSpan" id="kobo.198.1">quality software.</span></span></p>
<p><span class="koboSpan" id="kobo.199.1">A CI pipeline is a collection of steps required to code, build, test, and deploy software. </span><span class="koboSpan" id="kobo.199.2">Each step is not owned by a particular person but by a team working together and focusing on the goal to produce exceptional software. </span><span class="koboSpan" id="kobo.199.3">The good news is that if you followed the previous chapter’s recommendations, you’re already ahead of </span><span class="No-Break"><span class="koboSpan" id="kobo.200.1">the game.</span></span></p>
<p><span class="koboSpan" id="kobo.201.1">Each company’s pipeline can vary from product to product, but there will always be a common set of steps for a CI process. </span><span class="koboSpan" id="kobo.201.2">It depends on how detailed your pipeline becomes based on your needs. </span><span class="koboSpan" id="kobo.201.3">The stages in the pipelines can be influenced by each stakeholder involved in the process. </span><span class="koboSpan" id="kobo.201.4">Of course, pulling code and building and testing are required for the developers, but a QA team requires the finished product (artifact) to be sent to another server for </span><span class="No-Break"><span class="koboSpan" id="kobo.202.1">test purposes.</span></span></p>
<p><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.203.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.204.1">.1</span></em><span class="koboSpan" id="kobo.205.1"> shows one </span><span class="No-Break"><span class="koboSpan" id="kobo.206.1">common pipeline:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer012">
<span class="koboSpan" id="kobo.207.1"><img alt="Figure 2.1 – One example of a build pipeline" src="image/Figure_2.01_B19493.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.208.1">Figure 2.1 – One example of a build pipeline</span></p>
<p><span class="koboSpan" id="kobo.209.1">As shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.210.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.211.1">.1</span></em><span class="koboSpan" id="kobo.212.1">, the process is sequential when creating a software deployment. </span><span class="koboSpan" id="kobo.212.2">Here’s a summary of </span><span class="No-Break"><span class="koboSpan" id="kobo.213.1">the steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.214.1">Pull code from a </span><span class="No-Break"><span class="koboSpan" id="kobo.215.1">single repository.</span></span></li>
<li><span class="koboSpan" id="kobo.216.1">Build </span><span class="No-Break"><span class="koboSpan" id="kobo.217.1">the application.</span></span></li>
<li><span class="koboSpan" id="kobo.218.1">Run unit tests/code analysis against the code that was built in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.219.1">step 2</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.220.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.221.1">Create </span><span class="No-Break"><span class="koboSpan" id="kobo.222.1">the artifacts.</span></span></li>
<li><span class="koboSpan" id="kobo.223.1">Create a </span><span class="No-Break"><span class="koboSpan" id="kobo.224.1">container (optional).</span></span></li>
<li><span class="koboSpan" id="kobo.225.1">Deploy the artifact(s) to a </span><span class="No-Break"><span class="koboSpan" id="kobo.226.1">server (development/QA/staging/production).</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.227.1">Now that we’ve defined a common pipeline, let’s dig deeper into each step to learn what each process includes when you’re building </span><span class="No-Break"><span class="koboSpan" id="kobo.228.1">your software.</span></span></p>
<p><span class="koboSpan" id="kobo.229.1">In the following subsections, we’ll examine each process in detail based on the steps </span><span class="No-Break"><span class="koboSpan" id="kobo.230.1">defined here.</span></span></p>
<h2 id="_idParaDest-40"><a id="_idTextAnchor041"/><span class="koboSpan" id="kobo.231.1">Pulling Code</span></h2>
<p><span class="koboSpan" id="kobo.232.1">Before we build</span><a id="_idIndexMarker054"/><span class="koboSpan" id="kobo.233.1"> the application, we need to identify the project we’re building in our pipeline. </span><span class="koboSpan" id="kobo.233.2">The pipeline service requires a repository location. </span><span class="koboSpan" id="kobo.233.3">Once you’ve provided the repository URL, the service can prepare the repository for compilation on </span><span class="No-Break"><span class="koboSpan" id="kobo.234.1">their server.</span></span></p>
<p><span class="koboSpan" id="kobo.235.1">In the previous section, we mentioned why your code needs to compile flawlessly after cloning. </span><span class="koboSpan" id="kobo.235.2">The code is cloned and built on a completely different machine from yours. </span><span class="koboSpan" id="kobo.235.3">If the application only works on your computer and no one else’s, as the saying goes, “We’ll have to ship your computer to all of our users.” </span><span class="koboSpan" id="kobo.235.4">While this is a humorous saying in the industry, it’s generally frowned upon when writing and deploying software in the </span><span class="No-Break"><span class="koboSpan" id="kobo.236.1">real world.</span></span></p>
<p><span class="koboSpan" id="kobo.237.1">Each of the DevOps services has its benefits. </span><span class="koboSpan" id="kobo.237.2">For example, Azure Pipelines can examine your repository and make assumptions based on the structure of </span><span class="No-Break"><span class="koboSpan" id="kobo.238.1">your project.</span></span></p>
<p><span class="koboSpan" id="kobo.239.1">After analyzing</span><a id="_idIndexMarker055"/><span class="koboSpan" id="kobo.240.1"> the project, it uses a file format called YAML (pronounced Ya-mel) to define how the project should be built. </span><span class="koboSpan" id="kobo.240.2">While YAML is now considered a standard in the industry, we won’t deep-dive into everything YAML encompasses. </span><span class="koboSpan" id="kobo.240.3">YAML functionality could be a book on </span><span class="No-Break"><span class="koboSpan" id="kobo.241.1">its own.</span></span></p>
<p><span class="koboSpan" id="kobo.242.1">Azure takes your project’s assumptions and creates a YAML template on how it should build </span><span class="No-Break"><span class="koboSpan" id="kobo.243.1">your application.</span></span></p>
<p><span class="koboSpan" id="kobo.244.1">It knows how to compile the application, identify whether a container is included in the project, and also retrieve NuGet packages before performing </span><span class="No-Break"><span class="koboSpan" id="kobo.245.1">the build.</span></span></p>
<p><span class="koboSpan" id="kobo.246.1">One last thing to mention is that most DevOp services allow one repository per project. </span><span class="koboSpan" id="kobo.246.2">The benefits of this approach include </span><span class="No-Break"><span class="koboSpan" id="kobo.247.1">the following:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.248.1">Simplicity</span></strong><span class="koboSpan" id="kobo.249.1">: It’s simpler to manage and build one application as opposed to orchestrating hundreds of applications in </span><span class="No-Break"><span class="koboSpan" id="kobo.250.1">a project.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.251.1">Collaboration</span></strong><span class="koboSpan" id="kobo.252.1">: Instead of multiple teams focusing on one large project, it’s easier to have one or two smaller teams working on a single, more </span><span class="No-Break"><span class="koboSpan" id="kobo.253.1">manageable project.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.254.1">Faster builds</span></strong><span class="koboSpan" id="kobo.255.1">: CI/CD pipelines are meant to provide fast feedback and even faster improvement. </span><span class="koboSpan" id="kobo.255.2">The smaller the project, the faster a build, test, and deployment</span><a id="_idIndexMarker056"/> <span class="No-Break"><span class="koboSpan" id="kobo.256.1">will occur.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.257.1">With that said, we are now ready to build </span><span class="No-Break"><span class="koboSpan" id="kobo.258.1">the application.</span></span></p>
<h2 id="_idParaDest-41"><a id="_idTextAnchor042"/><span class="koboSpan" id="kobo.259.1">Building the application</span></h2>
<p><span class="koboSpan" id="kobo.260.1">As mentioned previously, YAML files</span><a id="_idIndexMarker057"/><span class="koboSpan" id="kobo.261.1"> define how the service proceeds with building </span><span class="No-Break"><span class="koboSpan" id="kobo.262.1">your application.</span></span></p>
<p><span class="koboSpan" id="kobo.263.1">It’s always a good practice to confirm the YAML file contains everything you need before building. </span><span class="koboSpan" id="kobo.263.2">If you have a simple project, the boilerplate included in the wizard may be all you need, but it allows you to make updates in case additional files are required, or other </span><span class="No-Break"><span class="koboSpan" id="kobo.264.1">application checks.</span></span></p>
<p><span class="koboSpan" id="kobo.265.1">It may take a couple of attempts to massage the YAML file, but once you get the file in a stable state, it’s great to see everything work </span><span class="No-Break"><span class="koboSpan" id="kobo.266.1">as expected.</span></span></p>
<p><span class="koboSpan" id="kobo.267.1">Make sure you have retrieved all your code before building the application. </span><span class="koboSpan" id="kobo.267.2">If this step fails, the process kicks out of </span><span class="No-Break"><span class="koboSpan" id="kobo.268.1">the pipeline.</span></span></p>
<p><span class="koboSpan" id="kobo.269.1">If you checked in bad code and the build fails, the proper authorities (developers or administrators) will be notified based on the alert level and you’ll be given the dunce hat or the stuffed monkey for breaking the build until someone else </span><span class="No-Break"><span class="koboSpan" id="kobo.270.1">breaks it.</span></span></p>
<p><span class="koboSpan" id="kobo.271.1">Next, we’ll focus on running unit tests and other tests against </span><span class="No-Break"><span class="koboSpan" id="kobo.272.1">the application.</span></span></p>
<h2 id="_idParaDest-42"><a id="_idTextAnchor043"/><span class="koboSpan" id="kobo.273.1">Running Unit Tests/Code Analysis</span></h2>
<p><span class="koboSpan" id="kobo.274.1">Once the build is done, we can move forward</span><a id="_idIndexMarker058"/><span class="koboSpan" id="kobo.275.1"> with the unit tests and/or </span><span class="No-Break"><span class="koboSpan" id="kobo.276.1">code analysis.</span></span></p>
<p><span class="koboSpan" id="kobo.277.1">Unit tests should run against the compiled application. </span><span class="koboSpan" id="kobo.277.2">This includes unit tests and integration tests, but as we mentioned previously, be wary of integration tests. </span><span class="koboSpan" id="kobo.277.3">The pipeline services may not have access to certain resources, causing your tests </span><span class="No-Break"><span class="koboSpan" id="kobo.278.1">to fail.</span></span></p>
<p><span class="koboSpan" id="kobo.279.1">Unit tests, by nature, should be extremely fast. </span><span class="koboSpan" id="kobo.279.2">Why? </span><span class="koboSpan" id="kobo.279.3">Because you don’t want to wait for 30 minutes for unit tests to run (which is painful). </span><span class="koboSpan" id="kobo.279.4">If you have unit tests taking that long, identify the longest-running unit tests and </span><span class="No-Break"><span class="koboSpan" id="kobo.280.1">refactor them.</span></span></p>
<p><span class="koboSpan" id="kobo.281.1">Once the code has been compiled and loaded, unit tests should be running every 10-30 seconds as a general guideline since they </span><span class="No-Break"><span class="koboSpan" id="kobo.282.1">are memory-based.</span></span></p>
<p><span class="koboSpan" id="kobo.283.1">While unit and integration</span><a id="_idIndexMarker059"/><span class="koboSpan" id="kobo.284.1"> tests are common in most testing scenarios, there are additional checks you can add to your pipeline, which include identifying security issues and code metrics to generate reports at the end of </span><span class="No-Break"><span class="koboSpan" id="kobo.285.1">your build.</span></span></p>
<p><span class="koboSpan" id="kobo.286.1">Next, our build creates artifacts to be used </span><span class="No-Break"><span class="koboSpan" id="kobo.287.1">for deployments.</span></span></p>
<h2 id="_idParaDest-43"><a id="_idTextAnchor044"/><span class="koboSpan" id="kobo.288.1">Creating Artifacts</span></h2>
<p><span class="koboSpan" id="kobo.289.1">Once the build succeeds</span><a id="_idIndexMarker060"/><span class="koboSpan" id="kobo.290.1"> and all of the tests pass, the next step is to create an artifact of our build and store it in a </span><span class="No-Break"><span class="koboSpan" id="kobo.291.1">central location.</span></span></p>
<p><span class="koboSpan" id="kobo.292.1">As a general rule, it’s best to only create your binaries once. </span><span class="koboSpan" id="kobo.292.2">Once they’ve been built, they’re available at a moment’s notice. </span><span class="koboSpan" id="kobo.292.3">These artifacts can deploy a version to a server on a whim without going through the entire build </span><span class="No-Break"><span class="koboSpan" id="kobo.293.1">process again.</span></span></p>
<p><span class="koboSpan" id="kobo.294.1">The artifacts should be tamper-proof and never be modified by anyone. </span><span class="koboSpan" id="kobo.294.2">If there is an issue with the artifact, the pipeline should start from the beginning and create a </span><span class="No-Break"><span class="koboSpan" id="kobo.295.1">new artifact.</span></span></p>
<p><span class="koboSpan" id="kobo.296.1">Let’s move on </span><span class="No-Break"><span class="koboSpan" id="kobo.297.1">to containers.</span></span></p>
<h2 id="_idParaDest-44"><a id="_idTextAnchor045"/><span class="koboSpan" id="kobo.298.1">Creating a Container</span></h2>
<p><span class="koboSpan" id="kobo.299.1">Once you have created</span><a id="_idIndexMarker061"/><span class="koboSpan" id="kobo.300.1"> the self-contained artifact, an </span><em class="italic"><span class="koboSpan" id="kobo.301.1">optional</span></em><span class="koboSpan" id="kobo.302.1"> step is to build a container around it or install the artifact in the container. </span><span class="koboSpan" id="kobo.302.2">While most enterprises use various platforms and environments, such as Linux or Windows, “containerizing” an application with a tool such as Docker allows it to run on any platform while isolating </span><span class="No-Break"><span class="koboSpan" id="kobo.303.1">the application.</span></span></p>
<p><span class="koboSpan" id="kobo.304.1">With containers considered a standard in the industry, it makes sense to create a container so that it can easily be deployed to any platform, such as Azure, </span><strong class="bold"><span class="koboSpan" id="kobo.305.1">Amazon Web Services</span></strong><span class="koboSpan" id="kobo.306.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.307.1">AWS</span></strong><span class="koboSpan" id="kobo.308.1">), or Google Cloud Provider. </span><span class="koboSpan" id="kobo.308.2">Again, this is an optional step, but it’s becoming an inevitable one in </span><span class="No-Break"><span class="koboSpan" id="kobo.309.1">the industry.</span></span></p>
<p><span class="koboSpan" id="kobo.310.1">When creating a new project with Visual Studio, you automatically get a container wrapper through a generated Docker file. </span><span class="koboSpan" id="kobo.310.2">This Dockerfile defines how the container will allow access to </span><span class="No-Break"><span class="koboSpan" id="kobo.311.1">your application.</span></span></p>
<p><span class="koboSpan" id="kobo.312.1">Once you’ve added the Dockerfile to your project, Azure identifies this as a container project and creates the container</span><a id="_idIndexMarker062"/><span class="koboSpan" id="kobo.313.1"> with the </span><span class="No-Break"><span class="koboSpan" id="kobo.314.1">included project.</span></span></p>
<p><span class="koboSpan" id="kobo.315.1">Lastly, we’ll examine deploying </span><span class="No-Break"><span class="koboSpan" id="kobo.316.1">the software.</span></span></p>
<h2 id="_idParaDest-45"><a id="_idTextAnchor046"/><span class="koboSpan" id="kobo.317.1">Deploying the software</span></h2>
<p><span class="koboSpan" id="kobo.318.1">Once everything</span><a id="_idIndexMarker063"/><span class="koboSpan" id="kobo.319.1"> has been generated, all we need to do is deploy </span><span class="No-Break"><span class="koboSpan" id="kobo.320.1">the software.</span></span></p>
<p><span class="koboSpan" id="kobo.321.1">Remember the environment settings in your </span><strong class="source-inline"><span class="koboSpan" id="kobo.322.1">appsettings.json</span></strong><span class="koboSpan" id="kobo.323.1"> file? </span><span class="koboSpan" id="kobo.323.2">This is where they come in handy </span><span class="No-Break"><span class="koboSpan" id="kobo.324.1">for deployments.</span></span></p>
<p><span class="koboSpan" id="kobo.325.1">Based on your environment, you can assign a task to merge the appropriate environment JSON file into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.326.1">appsettings.json</span></strong><span class="koboSpan" id="kobo.327.1"> file </span><span class="No-Break"><span class="koboSpan" id="kobo.328.1">on deployment.</span></span></p>
<p><span class="koboSpan" id="kobo.329.1">Once you have your environment settings in order, you can define the destinations of your deployments any way </span><span class="No-Break"><span class="koboSpan" id="kobo.330.1">you like.</span></span></p>
<p><span class="koboSpan" id="kobo.331.1">Deployments can range from FTP-ing or WebDeploy-ing the artifact or pushing the container to a server somewhere. </span><span class="koboSpan" id="kobo.331.2">All of these options are available out of </span><span class="No-Break"><span class="koboSpan" id="kobo.332.1">the box.</span></span></p>
<p><span class="koboSpan" id="kobo.333.1">However, you must deploy the same way to every environment. </span><span class="koboSpan" id="kobo.333.2">The only thing that changes is the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.334.1">appsettings</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.335.1"> file.</span></span></p>
<p><span class="koboSpan" id="kobo.336.1">After a successful (or unsuccessful) deployment, a report or notification should be sent to everyone involved in the </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">deployment’s outcome.</span></span></p>
<p><span class="koboSpan" id="kobo.338.1">In this section, we learned what a common pipeline includes and how each step relies on a successful previous step. </span><span class="koboSpan" id="kobo.338.2">If one step fails throughout the pipeline, the process immediately stops. </span><span class="koboSpan" id="kobo.338.3">This “conveyor belt” approach to software development provides repeatable steps, quality-driven software, and </span><span class="No-Break"><span class="koboSpan" id="kobo.339.1">deployable software.</span></span></p>
<h1 id="_idParaDest-46"><a id="_idTextAnchor047"/><span class="koboSpan" id="kobo.340.1">The Two “Falling” Approaches</span></h1>
<p><span class="koboSpan" id="kobo.341.1">In this section, we’ll learn about two ways to recover from a failed software deployment. </span><span class="koboSpan" id="kobo.341.2">After finishing this section, you’ll know how to use these two approaches to make a justified decision on recovering from a </span><span class="No-Break"><span class="koboSpan" id="kobo.342.1">bad deployment.</span></span></p>
<p><span class="koboSpan" id="kobo.343.1">In a standard pipeline, companies sometimes experience software glitches when deploying to a web server. </span><span class="koboSpan" id="kobo.343.2">Users may see an error message when they perform an action on </span><span class="No-Break"><span class="koboSpan" id="kobo.344.1">the website.</span></span></p>
<p><span class="koboSpan" id="kobo.345.1">What do you do when the software doesn’t work as expected? </span><span class="koboSpan" id="kobo.345.2">How does this work in the </span><span class="No-Break"><span class="koboSpan" id="kobo.346.1">DevOps pipeline?</span></span></p>
<p><span class="koboSpan" id="kobo.347.1">Every time you build software, there’s always a chance something could go wrong. </span><span class="koboSpan" id="kobo.347.2">You always need a backup plan </span><em class="italic"><span class="koboSpan" id="kobo.348.1">before</span></em><span class="koboSpan" id="kobo.349.1"> the software </span><span class="No-Break"><span class="koboSpan" id="kobo.350.1">is deployed.</span></span></p>
<p><span class="koboSpan" id="kobo.351.1">Let’s cover the two types of recovery methods we can use when software deployments </span><span class="No-Break"><span class="koboSpan" id="kobo.352.1">don’t succeed.</span></span></p>
<h2 id="_idParaDest-47"><a id="_idTextAnchor048"/><span class="koboSpan" id="kobo.353.1">Falling Backward (or fallback)</span></h2>
<p><span class="koboSpan" id="kobo.354.1">If various bugs were introduced</span><a id="_idIndexMarker064"/><span class="koboSpan" id="kobo.355.1"> into the product and the previous version doesn’t appear to have these errors, it makes sense to revert the software or fall back to the </span><span class="No-Break"><span class="koboSpan" id="kobo.356.1">previous version.</span></span></p>
<p><span class="koboSpan" id="kobo.357.1">In a pipeline, the process at the end creates artifacts, which are self-contained, deployable versions of </span><span class="No-Break"><span class="koboSpan" id="kobo.358.1">your product.</span></span></p>
<p><span class="koboSpan" id="kobo.359.1">Here is an example</span><a id="_idIndexMarker065"/><span class="koboSpan" id="kobo.360.1"> of </span><span class="No-Break"><span class="koboSpan" id="kobo.361.1">falling backward:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.362.1">Your software deployment was a success last week and was marked as version </span><span class="No-Break"><span class="koboSpan" id="kobo.363.1">1.1 (v1.1).</span></span></li>
<li><span class="koboSpan" id="kobo.364.1">Over 2 weeks, development created two new features for the software and wanted to release them as soon </span><span class="No-Break"><span class="koboSpan" id="kobo.365.1">as possible.</span></span></li>
<li><span class="koboSpan" id="kobo.366.1">A new build was created and released called version </span><span class="No-Break"><span class="koboSpan" id="kobo.367.1">1.3 (v1.3).</span></span></li>
<li><span class="koboSpan" id="kobo.368.1">While users were using the latest version (v1.3), they experienced issues with one of the new features, causing the website to </span><span class="No-Break"><span class="koboSpan" id="kobo.369.1">show errors.</span></span></li>
<li><span class="koboSpan" id="kobo.370.1">Since the previous version (v1.1) doesn’t have this issue and the impact is not severe, developers can redeploy v1.1 to the server so that users can continue to be </span><span class="No-Break"><span class="koboSpan" id="kobo.371.1">productive</span></span><span class="No-Break"><a id="_idIndexMarker066"/></span><span class="No-Break"><span class="koboSpan" id="kobo.372.1"> again.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.373.1">This type of release is called </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.374.1">falling backward</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.375.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.376.1">If you have to replace a current version (v1.3) with a previous version (v1.1) (except for databases, which I’ll cover in a bit), you can easily identify and deploy the </span><span class="No-Break"><span class="koboSpan" id="kobo.377.1">last-known artifact.</span></span></p>
<h2 id="_idParaDest-48"><a id="_idTextAnchor049"/><span class="koboSpan" id="kobo.378.1">Falling Forward</span></h2>
<p><span class="koboSpan" id="kobo.379.1">If the fallback approach</span><a id="_idIndexMarker067"/><span class="koboSpan" id="kobo.380.1"> isn’t a viable recovery strategy, the alternative is to </span><span class="No-Break"><span class="koboSpan" id="kobo.381.1">fall forward.</span></span></p>
<p><span class="koboSpan" id="kobo.382.1">When falling forward, the product team accepts the deployment with errors (warts and all) and continues to move forward with newer releases while placing a high priority on these errors and </span><em class="italic"><span class="koboSpan" id="kobo.383.1">acknowledging the errors will be fixed in the next or </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.384.1">future release</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.386.1">Here is a similar example</span><a id="_idIndexMarker068"/><span class="koboSpan" id="kobo.387.1"> of </span><span class="No-Break"><span class="koboSpan" id="kobo.388.1">falling forward:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.389.1">Again, a software deployment was successful last week and was marked as version </span><span class="No-Break"><span class="koboSpan" id="kobo.390.1">1.5 (v1.5).</span></span></li>
<li><span class="koboSpan" id="kobo.391.1">Over another 2 weeks, development created another new large feature for </span><span class="No-Break"><span class="koboSpan" id="kobo.392.1">the software.</span></span></li>
<li><span class="koboSpan" id="kobo.393.1">A new build was created and released called version </span><span class="No-Break"><span class="koboSpan" id="kobo.394.1">1.6 (v1.6).</span></span></li>
<li><span class="koboSpan" id="kobo.395.1">While users were using the latest version (v1.6), they experienced issues with one of the new features, causing the website to </span><span class="No-Break"><span class="koboSpan" id="kobo.396.1">show errors.</span></span></li>
<li><span class="koboSpan" id="kobo.397.1">After analysis, the developers realized this was a “quick fix,” created the proper unit tests to show it was fixed, pushed a new release through the pipeline, and immediately deployed the fixed code in a new </span><span class="No-Break"><span class="koboSpan" id="kobo.398.1">release (v1.7).</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.399.1">This type of release is called </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.400.1">falling forward</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.401.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.402.1">The product team may have to examine each error and make a decision as to which recovery method is the best approach for the </span><span class="No-Break"><span class="koboSpan" id="kobo.403.1">product’s reputation.</span></span></p>
<p><span class="koboSpan" id="kobo.404.1">For example, if product features such as business logic or user interface updates are the issue, the best recovery method may be to fall forward since the impact on the system is minimal and a user’s workflow is not interrupted </span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">and productive.</span></span></p>
<p><span class="koboSpan" id="kobo.406.1">However, if code </span><em class="italic"><span class="koboSpan" id="kobo.407.1">and</span></em><span class="koboSpan" id="kobo.408.1"> database updates are involved, the better approach would be to fall back – that is, restore the database and use a previous version of </span><span class="No-Break"><span class="koboSpan" id="kobo.409.1">the artifact.</span></span></p>
<p><span class="koboSpan" id="kobo.410.1">If it’s a critical feature and reverting is not an option, a “hotfix” approach (as mentioned in the previous chapter) may be required to patch </span><span class="No-Break"><span class="koboSpan" id="kobo.411.1">the software.</span></span></p>
<p><span class="koboSpan" id="kobo.412.1">Again, it depends on the impact each issue has left on the system as to which recovery strategy is the </span><span class="No-Break"><span class="koboSpan" id="kobo.413.1">best approach.</span></span></p>
<p><span class="koboSpan" id="kobo.414.1">In this section, we learned </span><a id="_idIndexMarker069"/><span class="koboSpan" id="kobo.415.1">about two ways to recover from unsuccessful software deployments: falling backward and falling forward. </span><span class="koboSpan" id="kobo.415.2">While neither option is a mandatory choice, each approach should be weighed heavily based on the error type, the recovery time of the fix, and the software’s </span><span class="No-Break"><span class="koboSpan" id="kobo.416.1">deployment schedule.</span></span></p>
<h1 id="_idParaDest-49"><a id="_idTextAnchor050"/><span class="koboSpan" id="kobo.417.1">Deploying Databases</span></h1>
<p><span class="koboSpan" id="kobo.418.1">Deploying application code</span><a id="_idIndexMarker070"/><span class="koboSpan" id="kobo.419.1"> is one thing but deploying databases can be a daunting task if not done properly. </span><span class="koboSpan" id="kobo.419.2">There are two pain points when deploying databases: structure </span><span class="No-Break"><span class="koboSpan" id="kobo.420.1">and records.</span></span></p>
<p><span class="koboSpan" id="kobo.421.1">With a database’s structure, you have the issue of adding, updating, and removing columns/fields from tables, along with updating the corresponding stored procedures, views, and other table-related functions to reflect the </span><span class="No-Break"><span class="koboSpan" id="kobo.422.1">table updates.</span></span></p>
<p><span class="koboSpan" id="kobo.423.1">With records, the process isn’t as tricky as changing a table’s structure. </span><span class="koboSpan" id="kobo.423.2">The frequency of updating records is not as regular, but when it does, happen that’s when you either want to seed a database with default records or update those seed records with </span><span class="No-Break"><span class="koboSpan" id="kobo.424.1">new values.</span></span></p>
<p><span class="koboSpan" id="kobo.425.1">The following sections will cover some common practices when deploying databases in a </span><span class="No-Break"><span class="koboSpan" id="kobo.426.1">CI/CD pipeline.</span></span></p>
<h2 id="_idParaDest-50"><a id="_idTextAnchor051"/><span class="koboSpan" id="kobo.427.1">Backing up Before Deploying</span></h2>
<p><span class="koboSpan" id="kobo.428.1">Since company </span><a id="_idIndexMarker071"/><span class="koboSpan" id="kobo.429.1">data is essential to a business, it’s mandatory to back it up before making any modifications or updates to </span><span class="No-Break"><span class="koboSpan" id="kobo.430.1">the database.</span></span></p>
<p><span class="koboSpan" id="kobo.431.1">One recommendation is to make the entire database deploy a two-step process: back up the database, then apply the </span><span class="No-Break"><span class="koboSpan" id="kobo.432.1">database updates.</span></span></p>
<p><span class="koboSpan" id="kobo.433.1">The DevOps team can include a pre-deployment script to </span><em class="italic"><span class="koboSpan" id="kobo.434.1">automatically</span></em><span class="koboSpan" id="kobo.435.1"> back up the database before applying the database updates. </span><span class="koboSpan" id="kobo.435.2">If the backup was successful, you can continue deploying your changes to the database. </span><span class="koboSpan" id="kobo.435.3">If not, you can immediately stop the deployment and determine the cause </span><span class="No-Break"><span class="koboSpan" id="kobo.436.1">of failure.</span></span></p>
<p><span class="koboSpan" id="kobo.437.1">As discussed in the previous section, this is necessary for a “fallback” approach instead of a “fall </span><span class="No-Break"><span class="koboSpan" id="kobo.438.1">forward” strategy.</span></span></p>
<h2 id="_idParaDest-51"><a id="_idTextAnchor052"/><span class="koboSpan" id="kobo.439.1">Creating a Strategy for Table Structures</span></h2>
<p><span class="koboSpan" id="kobo.440.1">One strategy for updating a table</span><a id="_idIndexMarker072"/><span class="koboSpan" id="kobo.441.1"> is to take a </span><span class="No-Break"><span class="koboSpan" id="kobo.442.1">non-destructive approach:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.443.1">Adding a column</span></strong><span class="koboSpan" id="kobo.444.1">: When adding columns, place a default value on the column for when a record is created. </span><span class="koboSpan" id="kobo.444.2">This will prevent the application from erroring out when you add a record, notifying the user that a field didn’t have a value or </span><span class="No-Break"><span class="koboSpan" id="kobo.445.1">is required.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.446.1">Updating/renaming a column</span></strong><span class="koboSpan" id="kobo.447.1">: Updating a column is a little different because you may be changing a data type or value in the database. </span><span class="koboSpan" id="kobo.447.2">If you’re changing the column name and/or type to something else, add a new column with the new column type, make sure you default the value, and proceed to use it in your application code. </span><span class="koboSpan" id="kobo.447.3">Once the code is solid and is performing as expected, remove the old column from the table and then from </span><span class="No-Break"><span class="koboSpan" id="kobo.448.1">your code.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.449.1">Removing a column</span></strong><span class="koboSpan" id="kobo.450.1">: There are several different ways to handle this process. </span><span class="koboSpan" id="kobo.450.2">If the field was created with a default value, make the appropriate changes in your application code to stop using the column. </span><span class="koboSpan" id="kobo.450.3">When records are added to the table, the default value won’t create an error. </span><span class="koboSpan" id="kobo.450.4">Once the application code has been updated, </span><em class="italic"><span class="koboSpan" id="kobo.451.1">rename</span></em><span class="koboSpan" id="kobo.452.1"> the column in the table instead of deleting it. </span><span class="koboSpan" id="kobo.452.2">If your code is still using it, you’ll be able to identify the code issue and fix it. </span><span class="koboSpan" id="kobo.452.3">Once your code is running without error, it’ll be safe to remove the column from </span><span class="No-Break"><span class="koboSpan" id="kobo.453.1">your table.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.454.1">While making the appropriate</span><a id="_idIndexMarker073"/><span class="koboSpan" id="kobo.455.1"> changes to table structures, don’t forget about updating the additional database code to reflect the table changes, including stored procedures, views, </span><span class="No-Break"><span class="koboSpan" id="kobo.456.1">and functions.</span></span></p>
<h2 id="_idParaDest-52"><a id="_idTextAnchor053"/><span class="koboSpan" id="kobo.457.1">Creating a Database Project</span></h2>
<p><span class="koboSpan" id="kobo.458.1">If your Visual Studio solution</span><a id="_idIndexMarker074"/><span class="koboSpan" id="kobo.459.1"> connects to a database, there’s another project</span><a id="_idIndexMarker075"/><span class="koboSpan" id="kobo.460.1"> type you need to add to your solution called the Database Project type. </span><span class="koboSpan" id="kobo.460.2">When you add this project to your solution, it takes a snapshot of your database and adds it to your project </span><span class="No-Break"><span class="koboSpan" id="kobo.461.1">as code.</span></span></p>
<p><span class="koboSpan" id="kobo.462.1">Why include this in your solution? </span><span class="koboSpan" id="kobo.462.2">There are three reasons to include it in </span><span class="No-Break"><span class="koboSpan" id="kobo.463.1">your solution:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.464.1">It provides a database schema as T-SQL when you create a database </span><span class="No-Break"><span class="koboSpan" id="kobo.465.1">from scratch.</span></span></li>
<li><span class="koboSpan" id="kobo.466.1">It allows you</span><a id="_idIndexMarker076"/><span class="koboSpan" id="kobo.467.1"> to version your database, in keeping with the </span><strong class="bold"><span class="koboSpan" id="kobo.468.1">Infrastructure as Code</span></strong><span class="koboSpan" id="kobo.469.1"> (</span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.470.1">IaC</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.471.1">) paradigm.</span></span></li>
<li><span class="koboSpan" id="kobo.472.1">When you’re building your solution in Visual Studio, it automatically generates a DAC file from your Database Project for deployment with the option to attach a custom script. </span><span class="koboSpan" id="kobo.472.2">With the DAC included in your solution, the pipeline can deploy and update the database with the DAC file first. </span><span class="koboSpan" id="kobo.472.3">Once the database deployment (and backup) is finished, the pipeline can deploy </span><span class="No-Break"><span class="koboSpan" id="kobo.473.1">the artifact.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.474.1">As you can see, it’s pretty handy to include with </span><span class="No-Break"><span class="koboSpan" id="kobo.475.1">your solution.</span></span></p>
<h2 id="_idParaDest-53"><a id="_idTextAnchor054"/><span class="koboSpan" id="kobo.476.1">Using Entity Framework Core’s Migrations</span></h2>
<p><span class="koboSpan" id="kobo.477.1">Entity Framework</span><a id="_idIndexMarker077"/><span class="koboSpan" id="kobo.478.1"> has come a long way since</span><a id="_idIndexMarker078"/><span class="koboSpan" id="kobo.479.1"> its early days. </span><span class="koboSpan" id="kobo.479.2">Migrations are another way to include database changes through C# as opposed </span><span class="No-Break"><span class="koboSpan" id="kobo.480.1">to T-SQL.</span></span></p>
<p><span class="koboSpan" id="kobo.481.1">Upon creating a migration, Entity Framework Core takes a snapshot of the database and </span><strong class="source-inline"><span class="koboSpan" id="kobo.482.1">DbContext</span></strong><span class="koboSpan" id="kobo.483.1"> and creates the delta between the database schema and </span><strong class="source-inline"><span class="koboSpan" id="kobo.484.1">DbContext</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.485.1">using C#.</span></span></p>
<p><span class="koboSpan" id="kobo.486.1">With the initial migration, the entire C# code is generated with an </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.487.1">Up()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.488.1"> method.</span></span></p>
<p><span class="koboSpan" id="kobo.489.1">Any subsequent migrations will contain an </span><strong class="source-inline"><span class="koboSpan" id="kobo.490.1">Up()</span></strong><span class="koboSpan" id="kobo.491.1"> method and a </span><strong class="source-inline"><span class="koboSpan" id="kobo.492.1">Down()</span></strong><span class="koboSpan" id="kobo.493.1"> method for upgrading and downgrading the database, respectively. </span><span class="koboSpan" id="kobo.493.2">This allows developers to save their database delta changes, along with their </span><span class="No-Break"><span class="koboSpan" id="kobo.494.1">code changes.</span></span></p>
<p><span class="koboSpan" id="kobo.495.1">Entity Framework Core’s migrations are an alternative to using DACs and custom scripts. </span><span class="koboSpan" id="kobo.495.2">These migrations can perform database changes based on the </span><span class="No-Break"><span class="koboSpan" id="kobo.496.1">C# code.</span></span></p>
<p><span class="koboSpan" id="kobo.497.1">If you require seed records, then you can use Entity Framework Core’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.498.1">.HasData()</span></strong><span class="koboSpan" id="kobo.499.1"> method for easily creating seed records </span><span class="No-Break"><span class="koboSpan" id="kobo.500.1">for tables.</span></span></p>
<p><span class="koboSpan" id="kobo.501.1">In this section, we learned </span><a id="_idIndexMarker079"/><span class="koboSpan" id="kobo.502.1">how to prepare our database deployment by always creating a backup, looked at a common strategy for adding, updating, and deleting table fields, and learned</span><a id="_idIndexMarker080"/><span class="koboSpan" id="kobo.503.1"> how to deploy databases in a CI/CD pipeline using either a DAC or Entity Framework </span><span class="No-Break"><span class="koboSpan" id="kobo.504.1">Core’s migrations.</span></span></p>
<h1 id="_idParaDest-54"><a id="_idTextAnchor055"/><span class="koboSpan" id="kobo.505.1">The three Types of Build Providers</span></h1>
<p><span class="koboSpan" id="kobo.506.1">Now that we’ve learned how a standard pipeline works, in this section, we’ll look at the different types of </span><span class="No-Break"><span class="koboSpan" id="kobo.507.1">pipeline providers.</span></span></p>
<p><span class="koboSpan" id="kobo.508.1">The three types of providers are on-premises, off-premises, </span><span class="No-Break"><span class="koboSpan" id="kobo.509.1">and hybrid.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.510.1">On-premises</span></strong><span class="koboSpan" id="kobo.511.1"> (meaning on-site or on-premises) relates to the software</span><a id="_idIndexMarker081"/><span class="koboSpan" id="kobo.512.1"> you own, which you can use to build your product at your company’s location. </span><span class="koboSpan" id="kobo.512.2">An advantage of on-premises build services is that once you purchase the software, you own it; there isn’t a subscription fee. </span><span class="koboSpan" id="kobo.512.3">So, if there’s a problem with the build server, you can easily look at the software locally to identify and fix </span><span class="No-Break"><span class="koboSpan" id="kobo.513.1">the problem.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.514.1">Off-premises</span></strong><span class="koboSpan" id="kobo.515.1"> (or cloud) providers are the more common</span><a id="_idIndexMarker082"/><span class="koboSpan" id="kobo.516.1"> services used nowadays. </span><span class="koboSpan" id="kobo.516.2">Since everyone wants everything yesterday, it’s quicker to set up and is usually an immediate way to create a </span><span class="No-Break"><span class="koboSpan" id="kobo.517.1">software pipeline.</span></span></p>
<p><span class="koboSpan" id="kobo.518.1">As you can guess, </span><strong class="bold"><span class="koboSpan" id="kobo.519.1">hybrid services</span></strong><span class="koboSpan" id="kobo.520.1"> are a mix of on-premises and off-premises services. </span><span class="koboSpan" id="kobo.520.2">Some companies like to keep</span><a id="_idIndexMarker083"/><span class="koboSpan" id="kobo.521.1"> control of certain aspects of software development and send the artifacts to a remote server for </span><span class="No-Break"><span class="koboSpan" id="kobo.522.1">deployment purposes.</span></span></p>
<p><span class="koboSpan" id="kobo.523.1">While hybrid services</span><a id="_idIndexMarker084"/><span class="koboSpan" id="kobo.524.1"> are an option, it makes more sense to use off-premises services for automated </span><span class="No-Break"><span class="koboSpan" id="kobo.525.1">software builds.</span></span></p>
<p><span class="koboSpan" id="kobo.526.1">In this section, we learned about three types of providers: on-premises, off-premises, and hybrid services. </span><span class="koboSpan" id="kobo.526.2">While these services are used in various companies, the majority of companies lean toward off-premises (or cloud) services to automate their </span><span class="No-Break"><span class="koboSpan" id="kobo.527.1">software builds.</span></span></p>
<h1 id="_idParaDest-55"><a id="_idTextAnchor056"/><span class="koboSpan" id="kobo.528.1">CI/CD Providers</span></h1>
<p><span class="koboSpan" id="kobo.529.1">In this section, we’ll review</span><a id="_idIndexMarker085"/><span class="koboSpan" id="kobo.530.1"> a current list of providers on the internet to help you automate your builds. </span><span class="koboSpan" id="kobo.530.2">While there are other providers available, these are considered what developers use in the industry as </span><span class="No-Break"><span class="koboSpan" id="kobo.531.1">a standard.</span></span></p>
<p><span class="koboSpan" id="kobo.532.1">Since we are targeting ASP.NET Core, rest assured, each of these providers supports ASP.NET Core in its build processes </span><span class="No-Break"><span class="koboSpan" id="kobo.533.1">and deployments.</span></span></p>
<h2 id="_idParaDest-56"><a id="_idTextAnchor057"/><span class="koboSpan" id="kobo.534.1">Microsoft Azure Pipelines</span></h2>
<p><span class="koboSpan" id="kobo.535.1">Since Microsoft created ASP.NET Core, it only</span><a id="_idIndexMarker086"/><span class="koboSpan" id="kobo.536.1"> makes sense to mention its off-premises</span><a id="_idIndexMarker087"/><span class="koboSpan" id="kobo.537.1"> cloud offerings. </span><span class="koboSpan" id="kobo.537.2">It does offer on-premises and hybrid support as well. </span><span class="koboSpan" id="kobo.537.3">Azure Pipelines provides the most automated support for ASP.NET Core applications and deployment mechanisms </span><span class="No-Break"><span class="koboSpan" id="kobo.538.1">to date.</span></span></p>
<p><span class="koboSpan" id="kobo.539.1">While Azure is considered one of the biggest cloud providers in the world, I consider Azure Pipelines a small component under the </span><span class="No-Break"><span class="koboSpan" id="kobo.540.1">Azure moniker.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.541.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.542.1">You can learn</span><a id="_idIndexMarker088"/><span class="koboSpan" id="kobo.543.1"> more about Azure Pipelines </span><span class="No-Break"><span class="koboSpan" id="kobo.544.1">here: </span></span><a href="https://azure.microsoft.com/en-us/products/devops/pipelines/"><span class="No-Break"><span class="koboSpan" id="kobo.545.1">https://azure.microsoft.com/en-us/products/devops/pipelines/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.546.1">.</span></span></p>
<h2 id="_idParaDest-57"><a id="_idTextAnchor058"/><span class="koboSpan" id="kobo.547.1">GitHub Actions</span></h2>
<p><span class="koboSpan" id="kobo.548.1">When Microsoft</span><a id="_idIndexMarker089"/><span class="koboSpan" id="kobo.549.1"> purchased GitHub back in June of 2018, GitHub came out with an automation pipeline with GitHub Actions in October of the </span><span class="No-Break"><span class="koboSpan" id="kobo.550.1">same year.</span></span></p>
<p><span class="koboSpan" id="kobo.551.1">Since GitHub is a provider of all things source code-related, GitHub Actions was considered an inevitable step toward making </span><span class="No-Break"><span class="koboSpan" id="kobo.552.1">code deployable.</span></span></p>
<p><span class="koboSpan" id="kobo.553.1">After signing up to Actions, you’ll notice the screens are very “Azure-ish” and provide a very similar interface when you’re building </span><span class="No-Break"><span class="koboSpan" id="kobo.554.1">software pipelines.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.555.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.556.1">You can learn more about GitHub Actions </span><span class="No-Break"><span class="koboSpan" id="kobo.557.1">here: </span></span><a href="https://github.com/features/actions"><span class="No-Break"><span class="koboSpan" id="kobo.558.1">https://github.com/features/actions</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.559.1">.</span></span></p>
<h2 id="_idParaDest-58"><a id="_idTextAnchor059"/><span class="koboSpan" id="kobo.560.1">Amazon CodePipeline</span></h2>
<p><span class="koboSpan" id="kobo.561.1">With Amazon commanding</span><a id="_idIndexMarker090"/><span class="koboSpan" id="kobo.562.1"> a large lead in the e-commerce landscape</span><a id="_idIndexMarker091"/><span class="koboSpan" id="kobo.563.1"> and with its Amazon Web Services (AWS offering), it also provides automated pipelines </span><span class="No-Break"><span class="koboSpan" id="kobo.564.1">for developers.</span></span></p>
<p><span class="koboSpan" id="kobo.565.1">Its pipelines are broken down </span><span class="No-Break"><span class="koboSpan" id="kobo.566.1">into categories:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.567.1">CodeCommit</span></strong><span class="koboSpan" id="kobo.568.1">: For identifying source </span><span class="No-Break"><span class="koboSpan" id="kobo.569.1">code repositories</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.570.1">CodeArtifact</span></strong><span class="koboSpan" id="kobo.571.1">: A centralized location for </span><span class="No-Break"><span class="koboSpan" id="kobo.572.1">build artifacts</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.573.1">CodeBuild</span></strong><span class="koboSpan" id="kobo.574.1">: A dedicated service for building your product based on updates in your repository, which are defined </span><span class="No-Break"><span class="koboSpan" id="kobo.575.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.576.1">CodeCommit</span></strong></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.577.1">CodeDeploy</span></strong><span class="koboSpan" id="kobo.578.1">: For managing environments for </span><span class="No-Break"><span class="koboSpan" id="kobo.579.1">deploying software</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.580.1">CodePipelne</span></strong><span class="koboSpan" id="kobo.581.1">: The glue that holds it </span><span class="No-Break"><span class="koboSpan" id="kobo.582.1">all together</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.583.1">You can pick and choose the services you need based on your requirements. </span><span class="koboSpan" id="kobo.583.2">Amazon CodePipeline is similar to most cloud services, where you can use one service or all </span><span class="No-Break"><span class="koboSpan" id="kobo.584.1">of them.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.585.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.586.1">You can learn more about</span><a id="_idIndexMarker092"/><span class="koboSpan" id="kobo.587.1"> Amazon CodePipeline </span><span class="No-Break"><span class="koboSpan" id="kobo.588.1">here: </span></span><a href="https://aws.amazon.com/codepipeline/"><span class="No-Break"><span class="koboSpan" id="kobo.589.1">https://aws.amazon.com/codepipeline/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.590.1">.</span></span></p>
<h2 id="_idParaDest-59"><a id="_idTextAnchor060"/><span class="koboSpan" id="kobo.591.1">Google CI</span></h2>
<p><span class="koboSpan" id="kobo.592.1">The final cloud provider</span><a id="_idIndexMarker093"/><span class="koboSpan" id="kobo.593.1"> is none other than Google CI. </span><span class="koboSpan" id="kobo.593.2">Google CI also provides the tools</span><a id="_idIndexMarker094"/><span class="koboSpan" id="kobo.594.1"> required to perform automated builds </span><span class="No-Break"><span class="koboSpan" id="kobo.595.1">and deployments.</span></span></p>
<p><span class="koboSpan" id="kobo.596.1">Google CI provides similar tools, such as Artifact Registry, source repositories, Cloud Build, and even private </span><span class="No-Break"><span class="koboSpan" id="kobo.597.1">container registries.</span></span></p>
<p><span class="koboSpan" id="kobo.598.1">As mentioned previously, once you understand how one cloud provider works, you’ll start to see similar offerings in other </span><span class="No-Break"><span class="koboSpan" id="kobo.599.1">cloud providers.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.600.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.601.1">You can learn more</span><a id="_idIndexMarker095"/><span class="koboSpan" id="kobo.602.1"> about Google CI </span><span class="No-Break"><span class="koboSpan" id="kobo.603.1">here: </span></span><a href="https://cloud.google.com/solutions/continuous-integration"><span class="No-Break"><span class="koboSpan" id="kobo.604.1">https://cloud.google.com/solutions/continuous-integration</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.605.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.606.1">In this section, we examined four CI/CD cloud providers: Microsoft’s Azure Pipelines, GitHub Actions, Amazon’s CodePipeline, and Google’s CI. </span><span class="koboSpan" id="kobo.606.2">Any one of these providers is a suitable candidate for creating an ASP.NET </span><span class="No-Break"><span class="koboSpan" id="kobo.607.1">Core pipeline.</span></span></p>
<h1 id="_idParaDest-60"><a id="_idTextAnchor061"/><span class="koboSpan" id="kobo.608.1">Walkthrough of Azure Pipelines</span></h1>
<p><span class="koboSpan" id="kobo.609.1">With everything we’ve discussed </span><a id="_idIndexMarker096"/><span class="koboSpan" id="kobo.610.1">so far, this section will take us through a standard pipeline with a web application every developer should be familiar with: the ASP.NET Core </span><span class="No-Break"><span class="koboSpan" id="kobo.611.1">web application.</span></span></p>
<p><span class="koboSpan" id="kobo.612.1">If you have a web application of your own, you’ll be able to follow along and make the modifications to your web application </span><span class="No-Break"><span class="koboSpan" id="kobo.613.1">as well.</span></span></p>
<p><span class="koboSpan" id="kobo.614.1">In this section, we’ll demonstrate what a pipeline consists of by considering a sample application and walking through all of the components that will make it a </span><span class="No-Break"><span class="koboSpan" id="kobo.615.1">successful build.</span></span></p>
<h2 id="_idParaDest-61"><a id="_idTextAnchor062"/><span class="koboSpan" id="kobo.616.1">Preparing the Application</span></h2>
<p><span class="koboSpan" id="kobo.617.1">Before we move forward, we need</span><a id="_idIndexMarker097"/><span class="koboSpan" id="kobo.618.1"> to confirm whether the application in our version control is ready for </span><span class="No-Break"><span class="koboSpan" id="kobo.619.1">a pipeline:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.620.1">Does the application compile and clone </span><span class="No-Break"><span class="koboSpan" id="kobo.621.1">without errors?</span></span></li>
<li><span class="koboSpan" id="kobo.622.1">Do </span><em class="italic"><span class="koboSpan" id="kobo.623.1">all</span></em><span class="koboSpan" id="kobo.624.1"> the unit tests that accompany the </span><span class="No-Break"><span class="koboSpan" id="kobo.625.1">application pass?</span></span></li>
<li><span class="koboSpan" id="kobo.626.1">Do you have the correct environment settings in your application? </span><span class="koboSpan" id="kobo.626.2">(For example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.627.1">appsettings.json</span></strong><span class="koboSpan" id="kobo.628.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.629.1">appsettings.qa.json</span></strong><span class="koboSpan" id="kobo.630.1">, and </span><span class="No-Break"><span class="koboSpan" id="kobo.631.1">so on.)</span></span></li>
<li><span class="koboSpan" id="kobo.632.1">Will you deploy this application to a Docker container? </span><span class="koboSpan" id="kobo.632.2">If so, confirm you have a Dockerfile in the root of </span><span class="No-Break"><span class="koboSpan" id="kobo.633.1">your application.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.634.1">Again, the Dockerfile is optional, but most companies include one since they have numerous environments running on different operating systems. </span><span class="koboSpan" id="kobo.634.2">We’ll include the Dockerfile in our web application to complete </span><span class="No-Break"><span class="koboSpan" id="kobo.635.1">the walkthrough.</span></span></p>
<p><span class="koboSpan" id="kobo.636.1">Once everything has been confirmed in our checklist, we can move forward and create </span><span class="No-Break"><span class="koboSpan" id="kobo.637.1">our pipeline.</span></span></p>
<h2 id="_idParaDest-62"><a id="_idTextAnchor063"/><span class="koboSpan" id="kobo.638.1">Introducing Azure Pipelines</span></h2>
<p><span class="koboSpan" id="kobo.639.1">Azure Pipelines is a free service</span><a id="_idIndexMarker098"/><span class="koboSpan" id="kobo.640.1"> for developers to use to automate, test, and deploy their software to </span><span class="No-Break"><span class="koboSpan" id="kobo.641.1">any platform.</span></span></p>
<p><span class="koboSpan" id="kobo.642.1">Since Azure is user-specific, you’ll have to log in to your</span><a id="_idIndexMarker099"/><span class="koboSpan" id="kobo.643.1"> Azure Pipelines account or create a new one at </span><a href="https://azure.microsoft.com/en-us/products/devops/pipelines/"><span class="koboSpan" id="kobo.644.1">https://azure.microsoft.com/en-us/products/devops/pipelines/</span></a><span class="koboSpan" id="kobo.645.1">. </span><span class="koboSpan" id="kobo.645.2">Don’t worry – it’s free to sign up and </span><span class="No-Break"><span class="koboSpan" id="kobo.646.1">create pipelines:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.647.1">To continue with this walkthrough, click on the </span><strong class="bold"><span class="koboSpan" id="kobo.648.1">Start free with GitHub</span></strong><span class="koboSpan" id="kobo.649.1"> button, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.650.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.651.1">.2</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.652.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer013">
<span class="koboSpan" id="kobo.653.1"><img alt="Figure 2.2 – The Azure Pipelines web page" src="image/Figure_2.02_B19493.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.654.1">Figure 2.2 – The Azure Pipelines web page</span></p>
<p><span class="koboSpan" id="kobo.655.1">Once you’ve logged in to Azure Pipelines, you are ready to create </span><span class="No-Break"><span class="koboSpan" id="kobo.656.1">a project.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.657.1">Click </span><strong class="bold"><span class="koboSpan" id="kobo.658.1">New Project</span></strong><span class="koboSpan" id="kobo.659.1"> in the top right-hand corner. </span><span class="koboSpan" id="kobo.659.2">Enter details for </span><strong class="bold"><span class="koboSpan" id="kobo.660.1">Project Name</span></strong><span class="koboSpan" id="kobo.661.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.662.1">Description</span></strong><span class="koboSpan" id="kobo.663.1"> and determine whether it’s </span><strong class="bold"><span class="koboSpan" id="kobo.664.1">Private</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.665.1">or </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.666.1">Public</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.667.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.668.1">Upon clicking </span><strong class="bold"><span class="koboSpan" id="kobo.669.1">Create</span></strong><span class="koboSpan" id="kobo.670.1">, we need</span><a id="_idIndexMarker100"/><span class="koboSpan" id="kobo.671.1"> to define which repository to use in </span><span class="No-Break"><span class="koboSpan" id="kobo.672.1">our pipeline.</span></span></li>
</ol>
<h2 id="_idParaDest-63"><a id="_idTextAnchor064"/><span class="koboSpan" id="kobo.673.1">Identifying the Repository</span></h2>
<p><span class="koboSpan" id="kobo.674.1">We haven’t designated</span><a id="_idIndexMarker101"/><span class="koboSpan" id="kobo.675.1"> a repository for Azure Pipelines to use yet. </span><span class="koboSpan" id="kobo.675.2">So, we need to import an </span><span class="No-Break"><span class="koboSpan" id="kobo.676.1">existing repository:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.677.1"> If you click on any option under </span><strong class="bold"><span class="koboSpan" id="kobo.678.1">Files</span></strong><span class="koboSpan" id="kobo.679.1">, you’ll notice a message saying </span><strong class="bold"><span class="koboSpan" id="kobo.680.1">&lt;YourProjectNameHere&gt; is empty. </span><span class="koboSpan" id="kobo.680.2">Add some code!</span></strong><span class="koboSpan" id="kobo.681.1">. </span><span class="koboSpan" id="kobo.681.2">Sounds like </span><span class="No-Break"><span class="koboSpan" id="kobo.682.1">solid advice.</span></span></li>
<li><span class="koboSpan" id="kobo.683.1">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.684.1">Import</span></strong><span class="koboSpan" id="kobo.685.1"> button under the </span><strong class="bold"><span class="koboSpan" id="kobo.686.1">Import a repository</span></strong><span class="koboSpan" id="kobo.687.1"> section, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.688.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.689.1">.3</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.690.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer014">
<span class="koboSpan" id="kobo.691.1"><img alt="Figure 2.3 – Importing a repository" src="image/Figure_2.03_B19493.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.692.1">Figure 2.3 – Importing a repository</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.693.1">Clicking on the </span><strong class="bold"><span class="koboSpan" id="kobo.694.1">Import</span></strong><span class="koboSpan" id="kobo.695.1"> button</span><a id="_idIndexMarker102"/><span class="koboSpan" id="kobo.696.1"> will result in a side panel popping out, asking where your source</span><a id="_idIndexMarker103"/><span class="koboSpan" id="kobo.697.1"> code is located. </span><span class="koboSpan" id="kobo.697.2">Currently, there is only Git and </span><strong class="bold"><span class="koboSpan" id="kobo.698.1">Team Foundation Version </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.699.1">Control</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.700.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.701.1">TFVC</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.702.1">).</span></span></li>
<li><span class="koboSpan" id="kobo.703.1">Since the code for </span><strong class="source-inline"><span class="koboSpan" id="kobo.704.1">DefaultWebApp</span></strong><span class="koboSpan" id="kobo.705.1"> is in Git, I copied the clone URL and pasted it into the text box, and then clicked the </span><strong class="bold"><span class="koboSpan" id="kobo.706.1">Import</span></strong><span class="koboSpan" id="kobo.707.1"> button at the bottom of the side panel, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.708.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.709.1">.4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.710.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer015">
<span class="koboSpan" id="kobo.711.1"><img alt="Figure 2.4 – Identifying the repository Azure Pipelines will use" src="image/Figure_2.04_B19493.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.712.1">Figure 2.4 – Identifying the repository Azure Pipelines will use</span></p>
<p><span class="koboSpan" id="kobo.713.1">Azure Pipelines will proceed to import the repository. </span><span class="koboSpan" id="kobo.713.2">The next screen will be the standard </span><strong class="bold"><span class="koboSpan" id="kobo.714.1">Explorer</span></strong><span class="koboSpan" id="kobo.715.1"> view everyone is used to seeing, with a tree view on the left of your repository and a detailed</span><a id="_idIndexMarker104"/><span class="koboSpan" id="kobo.716.1"> list of files from the current directory on the </span><span class="No-Break"><span class="koboSpan" id="kobo.717.1">right-hand side.</span></span></p>
<p><span class="koboSpan" id="kobo.718.1">With that, we have finished importing the repository into </span><span class="No-Break"><span class="koboSpan" id="kobo.719.1">Azure Pipelines.</span></span></p>
<h2 id="_idParaDest-64"><a id="_idTextAnchor065"/><span class="koboSpan" id="kobo.720.1">Creating the Build</span></h2>
<p><span class="koboSpan" id="kobo.721.1">Now that we’ve imported</span><a id="_idIndexMarker105"/><span class="koboSpan" id="kobo.722.1"> our repository, Azure Pipelines makes this process extremely easy for us by adding a button called </span><strong class="bold"><span class="koboSpan" id="kobo.723.1">Set up build</span></strong><span class="koboSpan" id="kobo.724.1">, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.725.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.726.1">.5</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.727.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer016">
<span class="koboSpan" id="kobo.728.1"><img alt="Figure 2.5 – Imported repository with a “Set up build” button as the next step" src="image/Figure_2.05_B19493.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.729.1">Figure 2.5 – Imported repository with a “Set up build” button as the next step</span></p>
<p><span class="koboSpan" id="kobo.730.1">As vast as Azure Pipelines’ features can be, there are several preset templates to use for your builds. </span><span class="koboSpan" id="kobo.730.2">Each template pertains to a particular project in the .NET ecosystem, along with not-so-common projects </span><span class="No-Break"><span class="koboSpan" id="kobo.731.1">as well:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.732.1">For our purposes, we’ll select the </span><strong class="bold"><span class="koboSpan" id="kobo.733.1">ASP.NET Core (.NET </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.734.1">Framework)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.735.1"> option.</span></span></li>
<li><span class="koboSpan" id="kobo.736.1">After the </span><strong class="bold"><span class="koboSpan" id="kobo.737.1">Configure</span></strong><span class="koboSpan" id="kobo.738.1"> step in our wizard (see the top?), we will come to the </span><strong class="bold"><span class="koboSpan" id="kobo.739.1">Review</span></strong><span class="koboSpan" id="kobo.740.1"> step, where we can examine the </span><span class="No-Break"><span class="koboSpan" id="kobo.741.1">YAML file.</span></span></li>
<li><span class="koboSpan" id="kobo.742.1">With that said, you aren’t excluded from adding tasks at any time. </span><span class="koboSpan" id="kobo.742.2">There is </span><strong class="bold"><span class="koboSpan" id="kobo.743.1">Show Assistant</span></strong><span class="koboSpan" id="kobo.744.1"> to help you with adding new tasks to your existing </span><span class="No-Break"><span class="koboSpan" id="kobo.745.1">YAML file.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.746.1">For the DefaultWebApp example, we don’t need</span><a id="_idIndexMarker106"/><span class="koboSpan" id="kobo.747.1"> to update our YAML file because we don’t have any changes; this is because we want something very simple to create our build. </span><span class="koboSpan" id="kobo.747.2">The default YAML file looks </span><span class="No-Break"><span class="koboSpan" id="kobo.748.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.749.1">
# ASP.NET Core (.NET Framework)
# Build and test ASP.NET Core projects targeting the full .NET Framework.
</span><span class="koboSpan" id="kobo.749.2"># Add steps that publish symbols, save build artifacts, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/dotnet-core
trigger:
- master
pool:
  vmImage: 'windows-latest'
variables:
  solution: '**/*.sln'
  buildPlatform: 'Any CPU'
  buildConfiguration: 'Release'
steps:
- task: NuGetToolInstaller@1
- task: NuGetCommand@2
  inputs:
    restoreSolution: '$(solution)'
- task: VSBuild@1
  inputs:
    solution: '$(solution)'
    msbuildArgs: '/p:DeployOnBuild=true /p:WebPublishMethod=Package /p:PackageAsSingleFile=true /p:SkipInvalidConfigurations=true /p:DesktopBuildPackageLocation="$(build.artifactStagingDirectory)\WebApp.zip" /p:DeployIisAppPath="Default Web Site"'
    platform: '$(buildPlatform)'
    configuration: '$(buildConfiguration)'
- task: VSTest@2
  inputs:
    platform: '$(buildPlatform)'
    configuration: '$(buildConfiguration)'</span></pre> <p><span class="koboSpan" id="kobo.750.1">This new file that Azure Pipelines created is called </span><strong class="source-inline"><span class="koboSpan" id="kobo.751.1">azure-pipelines.yml</span></strong><span class="koboSpan" id="kobo.752.1">. </span><span class="koboSpan" id="kobo.752.2">So, where does this new </span><strong class="source-inline"><span class="koboSpan" id="kobo.753.1">azure-pipelines.yml</span></strong><span class="koboSpan" id="kobo.754.1"> file reside when it’s created? </span><span class="koboSpan" id="kobo.754.2">It’s committed to the root of your repository. </span><span class="koboSpan" id="kobo.754.3">Once we’ve confirmed everything looks good in the YAML file, we can click the </span><strong class="bold"><span class="koboSpan" id="kobo.755.1">Save and </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.756.1">run</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.757.1"> button.</span></span></p>
<p><span class="koboSpan" id="kobo.758.1">Once you’ve done this, a side panel </span><a id="_idIndexMarker107"/><span class="koboSpan" id="kobo.759.1">will appear, asking you for a commit message and optional description, as well as to specify options on whether to commit directly to the master branch or create a new branch for this commit. </span><span class="koboSpan" id="kobo.759.2">Once you’ve clicked the </span><strong class="bold"><span class="koboSpan" id="kobo.760.1">Save and run</span></strong><span class="koboSpan" id="kobo.761.1"> button at the bottom of the side panel, it will commit your new YAML file to your repository and execute the </span><span class="No-Break"><span class="koboSpan" id="kobo.762.1">pipeline immediately.</span></span></p>
<h2 id="_idParaDest-65"><a id="_idTextAnchor066"/><span class="koboSpan" id="kobo.763.1">Creating the Artifacts</span></h2>
<p><span class="koboSpan" id="kobo.764.1">Once the build</span><a id="_idIndexMarker108"/><span class="koboSpan" id="kobo.765.1"> is running, you’ll see something similar to </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.766.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.767.1">.6</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.768.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer017">
<span class="koboSpan" id="kobo.769.1"><img alt="Figure 2.6 – Queueing up our DefaultWebApp build process" src="image/Figure_2.06_B19493.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.770.1">Figure 2.6 – Queueing up our DefaultWebApp build process</span></p>
<p><span class="koboSpan" id="kobo.771.1">As shown at the bottom of the preceding screenshot, my job’s status is </span><strong class="bold"><span class="koboSpan" id="kobo.772.1">Queued</span></strong><span class="koboSpan" id="kobo.773.1">. </span><span class="koboSpan" id="kobo.773.2">Once it’s out of the queue and executing, you can watch the builds progress by clicking on </span><strong class="bold"><span class="koboSpan" id="kobo.774.1">Job</span></strong><span class="koboSpan" id="kobo.775.1"> next to the blue clock at </span><span class="No-Break"><span class="koboSpan" id="kobo.776.1">the bottom.</span></span></p>
<p><span class="koboSpan" id="kobo.777.1">In terms of </span><strong class="bold"><span class="koboSpan" id="kobo.778.1">DefaultWebApp</span></strong><span class="koboSpan" id="kobo.779.1">, this is what the build process looks as seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.780.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.781.1">.7</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.782.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer018">
<span class="koboSpan" id="kobo.783.1"><img alt="Figure 2.7 – The build progress of DefaultWebApp" src="image/Figure_2.07_B19493.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.784.1">Figure 2.7 – The build progress of DefaultWebApp</span></p>
<p><span class="koboSpan" id="kobo.785.1">Congratulations! </span><span class="koboSpan" id="kobo.785.2">You have created a successful pipeline </span><span class="No-Break"><span class="koboSpan" id="kobo.786.1">and artifact.</span></span></p>
<p><span class="koboSpan" id="kobo.787.1">For the sake of not writing</span><a id="_idIndexMarker109"/><span class="koboSpan" id="kobo.788.1"> an entire book on Azure Pipelines, next, we will move on to </span><span class="No-Break"><span class="koboSpan" id="kobo.789.1">creating releases.</span></span></p>
<h2 id="_idParaDest-66"><a id="_idTextAnchor067"/><span class="koboSpan" id="kobo.790.1">Creating a Release</span></h2>
<p><span class="koboSpan" id="kobo.791.1">With a completed and successful</span><a id="_idIndexMarker110"/><span class="koboSpan" id="kobo.792.1"> build, we can now focus on releasing our software. </span><span class="koboSpan" id="kobo.792.2">Follow </span><span class="No-Break"><span class="koboSpan" id="kobo.793.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.794.1">If you click on </span><strong class="bold"><span class="koboSpan" id="kobo.795.1">Releases</span></strong><span class="koboSpan" id="kobo.796.1">, you’ll see we need to create a new release pipeline. </span><span class="koboSpan" id="kobo.796.2">Click the </span><strong class="bold"><span class="koboSpan" id="kobo.797.1">New </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.798.1">Pipeline</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.799.1"> button.</span></span></li>
<li><span class="koboSpan" id="kobo.800.1">Immediately, you’ll see a side panel appear with a list of templates you can choose from. </span><span class="koboSpan" id="kobo.800.2">Select </span><strong class="bold"><span class="koboSpan" id="kobo.801.1">Empty job</span></strong><span class="koboSpan" id="kobo.802.1"> at the top of the side panel, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.803.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.804.1">.8</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.805.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer019">
<span class="koboSpan" id="kobo.806.1"><img alt="Figure 2.8 – Selecting an empty job template" src="image/Figure_2.08_B19493.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.807.1">Figure 2.8 – Selecting an empty job template</span></p>
<p><span class="koboSpan" id="kobo.808.1">There is a term in </span><strong class="bold"><span class="koboSpan" id="kobo.809.1">Releases</span></strong><span class="koboSpan" id="kobo.810.1"> called </span><strong class="bold"><span class="koboSpan" id="kobo.811.1">Stages</span></strong><span class="koboSpan" id="kobo.812.1"> where your software can go through several stages before it’s sent to the final stage. </span><span class="koboSpan" id="kobo.812.2">These stages can also be synonymous with environments. </span><span class="koboSpan" id="kobo.812.3">These stages include development, QA, staging, and production. </span><span class="koboSpan" id="kobo.812.4">Once one stage has been approved (development), it moves to the next stage (QA) until the final one, which is usually production. </span><span class="koboSpan" id="kobo.812.5">However, these stages can get </span><span class="No-Break"><span class="koboSpan" id="kobo.813.1">extremely complicated.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.814.1">After you click the </span><strong class="bold"><span class="koboSpan" id="kobo.815.1">Apply</span></strong><span class="koboSpan" id="kobo.816.1"> button, you will see another side panel where you can define your stage. </span><span class="koboSpan" id="kobo.816.2">Since we are simply</span><a id="_idIndexMarker111"/><span class="koboSpan" id="kobo.817.1"> deploying the website, we’ll call this the </span><strong class="bold"><span class="koboSpan" id="kobo.818.1">Push to </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.819.1">Site</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.820.1"> stage.</span></span></li>
<li><span class="koboSpan" id="kobo.821.1">After entering your </span><strong class="bold"><span class="koboSpan" id="kobo.822.1">Stage</span></strong><span class="koboSpan" id="kobo.823.1"> name (that just doesn’t sound right), click the </span><strong class="bold"><span class="koboSpan" id="kobo.824.1">X</span></strong><span class="koboSpan" id="kobo.825.1"> button to close the side panel and examine </span><span class="No-Break"><span class="koboSpan" id="kobo.826.1">the pipeline.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.827.1">As shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.828.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.829.1">.9</span></em><span class="koboSpan" id="kobo.830.1">, we need to add </span><span class="No-Break"><span class="koboSpan" id="kobo.831.1">an artifact:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer020">
<span class="koboSpan" id="kobo.832.1"><img alt="Figure 2.9 – The Push ﻿to Site stage is defined, but there’s no artifact" src="image/Figure_2.09_B19493.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.833.1">Figure 2.9 – The Push to Site stage is defined, but there’s no artifact</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.834.1">When you click </span><strong class="bold"><span class="koboSpan" id="kobo.835.1">Add an Artifact</span></strong><span class="koboSpan" id="kobo.836.1">, another side panel will slide open and ask you to add the artifact. </span><span class="koboSpan" id="kobo.836.2">Since we created</span><a id="_idIndexMarker112"/><span class="koboSpan" id="kobo.837.1"> an artifact in the previous subsection, we can populate all of our inputs with the </span><strong class="bold"><span class="koboSpan" id="kobo.838.1">DefaultWebApp</span></strong><span class="koboSpan" id="kobo.839.1"> project and source, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.840.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.841.1">.10</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.842.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer021">
<span class="koboSpan" id="kobo.843.1"><img alt="Figure 2.10 – Adding the DefaultWebApp artifact to our release pipeline" src="image/Figure_2.10_B19493.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.844.1">Figure 2.10 – Adding the DefaultWebApp artifact to our release pipeline</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.845.1">Click </span><strong class="bold"><span class="koboSpan" id="kobo.846.1">Add</span></strong><span class="koboSpan" id="kobo.847.1"> to add your artifact</span><a id="_idIndexMarker113"/><span class="koboSpan" id="kobo.848.1"> to </span><span class="No-Break"><span class="koboSpan" id="kobo.849.1">the pipeline.</span></span></li>
</ol>
<h2 id="_idParaDest-67"><a id="_idTextAnchor068"/><span class="koboSpan" id="kobo.850.1">Deploying the Build</span></h2>
<p><span class="koboSpan" id="kobo.851.1">Once we have defined</span><a id="_idIndexMarker114"/><span class="koboSpan" id="kobo.852.1"> our stages, we can attach certain deployment conditions, both before and after, to each stage. </span><span class="koboSpan" id="kobo.852.2">The ability to define post-deployment approvals, gates, and auto-redeploy triggers is possible but disabled by default for </span><span class="No-Break"><span class="koboSpan" id="kobo.853.1">each stage.</span></span></p>
<p><span class="koboSpan" id="kobo.854.1">In any stage, you can add, edit, or remove any task you want by clicking on the “x job, x tasks” link under each stage’s name, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.855.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.856.1">.11</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.857.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer022">
<span class="koboSpan" id="kobo.858.1"><img alt="Figure 2.11 – Stages allow you to add any number of tasks" src="image/Figure_2.11_B19493.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.859.1">Figure 2.11 – Stages allow you to add any number of tasks</span></p>
<p><span class="koboSpan" id="kobo.860.1">Each stage has an agent job, which can perform any number of tasks. </span><span class="koboSpan" id="kobo.860.2">The list of tasks to choose from is mind-numbing. </span><span class="koboSpan" id="kobo.860.3">If you can think of it, there is a task </span><span class="No-Break"><span class="koboSpan" id="kobo.861.1">for it.</span></span></p>
<p><span class="koboSpan" id="kobo.862.1">For example, we can deploy a website using Azure, IIS Web Deploy, or even simply a file that’s been copied from one directory to another. </span><span class="koboSpan" id="kobo.862.2">Want to FTP the files over to a server? </span><span class="koboSpan" id="kobo.862.3">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.863.1">Utility</span></strong><span class="koboSpan" id="kobo.864.1"> tab and find </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.865.1">FTP Upload</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.866.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.867.1">Each task you add has parameters per topic and can easily be modified to suit a </span><span class="No-Break"><span class="koboSpan" id="kobo.868.1">developer’s requirements.</span></span></p>
<p><span class="koboSpan" id="kobo.869.1">In this section, we covered how to create a pipeline by preparing the application to meet certain requirements. </span><span class="koboSpan" id="kobo.869.2">We did this by introducing Azure Pipelines by logging in and adding our sample project, identifying the repository we’ll be using in our pipeline, and creating the build. </span><span class="koboSpan" id="kobo.869.3">Once we’d done</span><a id="_idIndexMarker115"/><span class="koboSpan" id="kobo.870.1"> this, we found our artifacts, created a release, and found a way to deploy </span><span class="No-Break"><span class="koboSpan" id="kobo.871.1">the build.</span></span></p>
<h1 id="_idParaDest-68"><a id="_idTextAnchor069"/><span class="koboSpan" id="kobo.872.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.873.1">In this chapter, we identified ways to prepare our code for a CI/CD pipeline so that we can build flawlessly, avoid relative path names with file-based operations, confirm our unit tests </span><em class="italic"><span class="koboSpan" id="kobo.874.1">are</span></em><span class="koboSpan" id="kobo.875.1"> unit tests, and create environment settings for our application. </span><span class="koboSpan" id="kobo.875.2">Once our code was ready, we examined what’s included in a common CI/CD pipeline, including a way to pull the code, build it, run unit tests with optional code analysis, create artifacts, wrap our code in a container, and deploy </span><span class="No-Break"><span class="koboSpan" id="kobo.876.1">an artifact.</span></span></p>
<p><span class="koboSpan" id="kobo.877.1">We also covered two ways to recover from a failed deployment using a fall-back or fall-forward approach. </span><span class="koboSpan" id="kobo.877.2">Then, we discussed common ways to prepare for deploying a database, which includes backing up your data, creating a strategy for modifying tables, adding a database project to your Visual Studio solution, and using Entity Framework Core’s migrations so that you can use C# to modify </span><span class="No-Break"><span class="koboSpan" id="kobo.878.1">your tables.</span></span></p>
<p><span class="koboSpan" id="kobo.879.1">We also reviewed the three types of CI/CD providers: on-premises, off-premises, and hybrid providers, with each one specific to a company’s needs, and then examined four cloud providers who offer full pipeline services: Microsoft’s DevOps Pipelines, GitHub Actions, Amazon’s CodePipeline, and </span><span class="No-Break"><span class="koboSpan" id="kobo.880.1">Google’s CI.</span></span></p>
<p><span class="koboSpan" id="kobo.881.1">Finally, we learned how to create a sample pipeline by preparing the application so that it meets certain requirements, logging in to Azure Pipelines and defining our sample project, identifying the repository we’ll be using in our pipeline, and creating the build. </span><span class="koboSpan" id="kobo.881.2">Once the build was complete, it generated our artifacts, and we learned how to create a release and find a way to deploy </span><span class="No-Break"><span class="koboSpan" id="kobo.882.1">the build.</span></span></p>
<p><span class="koboSpan" id="kobo.883.1">In the next chapter, we’ll learn about some of the best approaches for using middleware in </span><span class="No-Break"><span class="koboSpan" id="kobo.884.1">ASP.NET Core.</span></span></p>
</div>
</body></html>