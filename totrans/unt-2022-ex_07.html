<html><head></head><body>
<div><div><h1 class="chapter-number" id="_idParaDest-78"><a id="_idTextAnchor079" class="pcalibre1 pcalibre calibre6"/>4</h1>
<h1 id="_idParaDest-79" class="calibre5"><a id="_idTextAnchor080" class="pcalibre1 pcalibre calibre6"/>Creating a 2D Adventure Game</h1>
<p class="calibre3">In <a href="B18347_03.xhtml#_idTextAnchor058" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 3</em></a>, you were introduced to Cinemachine for creating a quick but powerful camera-follow system. We learned how to implement a game mechanic for collecting items and displaying game progression with Unity UI, and how to approach game balance while considering win-and-lose conditions.</p>
<p class="calibre3">By completing the collection game, the previous chapters provided foundational knowledge that we’ll continue to build upon in this chapter as we start to make a 2D adventure game. We’ll explore importing artwork and creating assets to build out a 2D side-on environment <a id="_idIndexMarker401" class="pcalibre1 pcalibre calibre6"/>and level design using additional Unity 2D tooling, namely <strong class="bold">Sprite Shape</strong>.</p>
<p class="calibre3">We’ll finish the chapter by adding dynamic moving platforms and triggers that will provide secondary actions to create a more engaging player experience, and some optimization techniques to keep the game performant and polished for increased immersion.</p>
<p class="calibre3">In this chapter, we’re going to cover the following main topics.</p>
<ul class="calibre17">
<li class="calibre15">Extending the <strong class="bold">Game Design Document</strong> (<strong class="bold">GDD</strong>) – Introducing the 2D adventure game</li>
<li class="calibre15">Importing assets to use with Sprite Shape – A different kind of 2D environment builder</li>
<li class="calibre15">Level and environment design – Guiding the player</li>
<li class="calibre15">Moving platforms and triggers – Creating a dynamic interactable environment</li>
<li class="calibre15">Adding polish to our environment to immerse the player and optimizing</li>
</ul>
<p class="calibre3">By the end of this chapter, you’ll have another example of a GDD to use for your projects and be able to import and use original artwork to create an environment that guides the player while designing a level using Sprite Shape. You’ll also be able to create an interactive and dynamic moving environment that is optimized and visually polished.</p>
<h1 id="_idParaDest-80" class="calibre5"><a id="_idTextAnchor081" class="pcalibre1 pcalibre calibre6"/>Technical requirements</h1>
<p class="calibre3">To follow along in this chapter with the same artwork created for the project in the book, download the assets from the GitHub link provided in this section. To follow along with your own artwork, you’ll need to create similar artwork using Adobe Photoshop, or a graphics program that can export layered Photoshop PSD/PSB files (for example, Gimp, MediBang Paint, or Krita).</p>
<p class="calibre3">Additionally, to follow along with the player input section, you’ll want a compatible game controller for your system (although this is optional since keyboard input will also be provided).</p>
<p class="calibre3">You can download the complete project on GitHub at <a href="https://github.com/PacktPublishing/Unity-2022-by-Example" class="pcalibre1 pcalibre calibre6">https://github.com/PacktPublishing/Unity-2022-by-Example</a>.</p>
<h1 id="_idParaDest-81" class="calibre5"><a id="_idTextAnchor082" class="pcalibre1 pcalibre calibre6"/>Extending the GDD – Introducing the 2D adventure game</h1>
<p class="calibre3">We’re continuing<a id="_idIndexMarker402" class="pcalibre1 pcalibre calibre6"/> with the next game concept now – while continuing with the overall theme for the projects in the book – so let’s go ahead and update the GDD and extend upon it where needed.</p>
<p class="calibre3">Let’s first update the following overview sections that we’ve previously covered; this will also serve as your introduction to the game:</p>
<table class="no-table-style" id="table001-3">
<colgroup class="calibre11">
<col class="calibre12"/>
<col class="calibre12"/>
</colgroup>
<tbody class="calibre13">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="bold">Name </strong><strong class="bold">of game</strong></p>
</td>
<td class="no-table-style2">
<p class="calibre3">Outer World</p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="bold">Describe the gameplay, the core loop, </strong><strong class="bold">and progression.</strong></p>
</td>
<td class="no-table-style2">
<p class="calibre3">Find your way to the habitat station while searching for parts of the key required to gain access to the entryway and neutralize infected robots that attempt to halt your mission.</p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="bold">What is the core game mechanic for the </strong><strong class="bold">adventure game?</strong></p>
</td>
<td class="no-table-style2">
<p class="calibre3">The player will repeatedly engage in battle with infected robots that impede progress to the habitat station.</p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="bold">What is the secondary game mechanic for the </strong><strong class="bold">adventure game?</strong></p>
</td>
<td class="no-table-style2">
<p class="calibre3">The player will search the environment for hidden parts of a key. The pieces will need to be combined correctly as input to gain access to the entryway of the habitat station.</p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="bold">What systems need to be implemented to support the </strong><strong class="bold">game mechanics?</strong></p>
</td>
<td class="no-table-style2">
<p class="calibre3">The player movement, equipping a weapon with ammo reloading and shooting capabilities, a pickup with inventory, puzzle solver, health, and damage</p>
</td>
</tr>
</tbody>
</table>
<p class="img---caption" lang="en-US" xml:lang="en-US">Table 4.1 – The GDD for the adventure game</p>
<p class="calibre3">We’ve added a <a id="_idIndexMarker403" class="pcalibre1 pcalibre calibre6"/>new section to the end of the preceding table that takes the game mechanic details a step further into the <em class="italic">development requirements</em> realm. With some systems defined, we can start thinking about the code architecture and what <em class="italic">problems need solving</em> – this is where we can apply some design patterns.</p>
<p class="calibre3">Now, instead of a nerf, this time, let’s add a buff for the player:</p>
<table class="no-table-style" id="table002-1">
<colgroup class="calibre11">
<col class="calibre12"/>
<col class="calibre12"/>
</colgroup>
<tbody class="calibre13">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="bold">What is a buff mechanic for the player in the </strong><strong class="bold">adventure game?</strong></p>
</td>
<td class="no-table-style2">
<p class="calibre3">The player will be able to collect energy shards (<em class="italic">water diamonds</em>) scattered throughout the environment, which, when a certain quantity has been collected, will give a power-up state to all of the weapons (increasing damage dealt).</p>
</td>
</tr>
</tbody>
</table>
<p class="img---caption" lang="en-US" xml:lang="en-US">Table 4.2 – Adding a buff to the GDD</p>
<p class="calibre3">Our player character and the enemies in the game will be much further developed compared to the collection game. Let’s add sections in the GDD for these characters’ bios and details about the player’s challenge structure:</p>
<table class="no-table-style" id="table003">
<colgroup class="calibre11">
<col class="calibre12"/>
<col class="calibre12"/>
</colgroup>
<tbody class="calibre13">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="bold">Main character:</strong></p>
<p class="calibre3"><strong class="bold">Describe the main character of the game and how they drive the story. Who is this </strong><strong class="bold">player character?</strong></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><strong class="bold">Type</strong>: Kryk’zylx race of humanoids.</p>
<p class="calibre3"><strong class="bold">Backstory</strong>: The people of Kryk’zylx have outgrown their home planet and are searching the galaxy for suitable planets to colonize. Scouts are sent to establish habitat stations on planet surfaces with the potential to sustain life.</p>
<p class="calibre3"><strong class="bold">Goals</strong>: Establish and maintain a habitat station with an automated crew of construction and maintenance robots.</p>
<p class="calibre3"><strong class="bold">Skills</strong>: Power suit jumping and charging.</p>
<p class="calibre3"><strong class="bold">Weaknesses</strong>: Atmosphere not breathable.</p>
</td>
</tr>
</tbody>
</table>
<p class="calibre3">Kryk’zylx scouts <a id="_idIndexMarker404" class="pcalibre1 pcalibre calibre6"/>must wear power suits to survive the planet’s hostile atmosphere outside of the habitat station. Here is an example of a power suit helmet:</p>
<div><div><img alt="Figure 4.1 – Power suit helmet" src="img/B18347_04_01.jpg" class="calibre52"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 4.1 – Power suit helmet</p>
<p class="calibre3">And now, we’ll continue by adding the sections for the details of the player’s challenge structure:</p>
<table class="no-table-style" id="table004">
<colgroup class="calibre11">
<col class="calibre12"/>
<col class="calibre12"/>
</colgroup>
<tbody class="calibre13">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="bold"><a id="_idTextAnchor083" class="pcalibre1 pcalibre calibre6"/>What is the main character’s </strong><strong class="bold">challenge structure?</strong></p>
</td>
<td class="no-table-style2">
<p class="calibre3">Navigate platforms, make their way past infected robots, and solve the critical puzzle.</p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="bold">Enemy A:</strong></p>
<p class="calibre3"><strong class="bold">Describe the first enemy in the game and how they drive the story. Who is </strong><strong class="bold">this enemy?</strong></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><strong class="bold">Type</strong>: Construction Robot, Biped</p>
<p class="calibre3"><strong class="bold">Backstory</strong>: Robot deployed on pre-colonization missions for habitat station construction and maintenance.</p>
<p class="calibre3"><strong class="bold">Goals</strong>: Construction and maintenance.</p>
<p class="calibre3"><strong class="bold">Skills</strong>: High mobility, including onrough terrain.</p>
<p class="calibre3"><strong class="bold">Weaknesses</strong>: Long charging.</p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="bold">Enemy B:</strong></p>
<p class="calibre3"><strong class="bold">Describe the second enemy in the game and how they drive the story. Who is </strong><strong class="bold">this enemy?</strong></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><strong class="bold">Type</strong>: Maintenance Robot, Wheeled</p>
<p class="calibre3"><strong class="bold">Backstory</strong>: Robot deployed on pre-colonization missions for habitat maintenance and support.</p>
<p class="calibre3"><strong class="bold">Goals</strong>: Maintenance and personnel support.</p>
<p class="calibre3"><strong class="bold">Skills</strong>: Quick charging.</p>
<p class="calibre3"><strong class="bold">Weaknesses</strong>: Limited mobility.</p>
</td>
</tr>
</tbody>
</table>
<p class="img---caption" lang="en-US" xml:lang="en-US">Table 4.3 – Adding character and enemy bios</p>
<p class="calibre3">We will take<a id="_idIndexMarker405" class="pcalibre1 pcalibre calibre6"/> the document further and introduce a section that gives the environment some attention. The description here will help maintain the game’s visual direction while the environment and level are being designed and the art assets are created:</p>
<table class="no-table-style" id="table005">
<colgroup class="calibre11">
<col class="calibre12"/>
<col class="calibre12"/>
</colgroup>
<tbody class="calibre13">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="bold">Describe the environment in which the game takes place. What does it look like, who inhabits it, and what are the points </strong><strong class="bold">of interest?</strong></p>
</td>
<td class="no-table-style2">
<p class="calibre3">The game takes place on the surface of a prospective planet to colonize, even though this particular planet does not have a breathable atmosphere. The planet comprises areas of purple-red rock and thick vegetation (which moves in such a way as to suggest it may have the capacity to think).</p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="bold">Describe the </strong><strong class="bold">game level(s).</strong></p>
</td>
<td class="no-table-style2">
<p class="calibre3">The game level is a combination of static and moving platforms with obstacles needing to be overcome or avoided by the player as they make their way to the habitat station.</p>
</td>
</tr>
</tbody>
</table>
<p class="img---caption" lang="en-US" xml:lang="en-US">Table 4.4 – Environment and level</p>
<p class="calibre3">Let’s add a<a id="_idIndexMarker406" class="pcalibre1 pcalibre calibre6"/> section on the input controls. Previously, we used the keyboard and mouse for the collection game, but this time, we’ll also be adding support for input from a game controller:</p>
<table class="no-table-style" id="table006">
<colgroup class="calibre11">
<col class="calibre12"/>
<col class="calibre12"/>
</colgroup>
<tbody class="calibre13">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="bold">Define the input/control </strong><strong class="bold">methods actions.</strong></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><strong class="bold">Keyboard</strong>: <em class="italic">W</em>, <em class="italic">A</em>, <em class="italic">S</em>, and <em class="italic">D</em> keys to move; the space bar to jump; the mouse to aim, the left mouse button to shoot the primary weapon, and the right mouse button hold/release to launch the secondary weapon while aiming with the mouse (the left mouse button to cancel); and the <em class="italic">E</em> key to interact with things.</p>
<p class="calibre3"><strong class="bold">Game Controller</strong>: The left stick/D pad to move; <em class="italic">X</em> to jump; the right stick to aim and the right trigger or <em class="italic">Y</em> to shoot; the right shoulder hold/release to launch the secondary weapon while aiming with the right stick (the right trigger to cancel); and button <em class="italic">A</em> to interact.</p>
</td>
</tr>
</tbody>
</table>
<p class="img---caption" lang="en-US" xml:lang="en-US">Table 4.5 – Input/control methods actions</p>
<p class="calibre3">Finally, let’s define how all the pieces interact to make a complete game experience for the player:</p>
<table class="no-table-style" id="table007">
<colgroup class="calibre11">
<col class="calibre12"/>
<col class="calibre12"/>
</colgroup>
<tbody class="calibre13">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="bold">How do all the </strong><strong class="bold">pieces interact?</strong></p>
</td>
<td class="no-table-style2">
<p class="calibre3">The player interacts with the environment through exploration, discovering what is required to reach and enter the habitat station using parts of a puzzle key found throughout the level while fending off robots that have become infected by the strange plants that cover the planet’s surface.</p>
</td>
</tr>
</tbody>
</table>
<p class="img---caption" lang="en-US" xml:lang="en-US">Table 4.6 – Putting all the pieces together</p>
<p class="callout-heading">Full GDD for the 2D adventure game</p>
<p class="callout">To view the full GDD document for the 2D adventure game, visit the project GitHub repo here: <a href="https://github.com/PacktPublishing/Unity-2022-by-Example/tree/main/ch4/GDD" class="pcalibre1 pcalibre calibre6">https://github.com/PacktPublishing/Unity-2022-by-Example/tree/main/ch4/GDD</a></p>
<p class="calibre3">Refer to the<a id="_idIndexMarker407" class="pcalibre1 pcalibre calibre6"/> GDD any time you are unsure about what comes next. So long as you’re following what you’ve written, the next steps should come as a natural progression you can iterate upon. However, don’t feel like you’re locked into what you’ve written as your first draft of the GDD – as a living document, let ideas organically change as you work through them, and new ideas come to light (just as I have done throughout writing this book!).</p>
<p class="calibre3">In this section, you learned how to extend upon our GDD to include additional details for the main characters in the game and describe the game world and how everything works together to create an immersive experience for the player. We’ll continue importing original artwork to start building the game level with Sprite Shape in the next section.</p>
<h1 id="_idParaDest-82" class="calibre5"><a id="_idTextAnchor084" class="pcalibre1 pcalibre calibre6"/>Importing assets to use with Sprite Shape – A different kind of 2D environment builder</h1>
<p class="calibre3">The artwork that <a id="_idIndexMarker408" class="pcalibre1 pcalibre calibre6"/>we’ll be using for the 2D adventure <a id="_idIndexMarker409" class="pcalibre1 pcalibre calibre6"/>game is an original artwork and the result of a collaboration with the artist, Nica Monami. The <a id="_idIndexMarker410" class="pcalibre1 pcalibre calibre6"/>art assets have all been created specifically for this project in the book. Nica has lent her talent for creating fantastic painterly-looking art to create a unique environment for the game, and I am very excited to be working with these assets.</p>
<div><div><img alt="Figure 4.2 – Original game artwork" src="img/B18347_04_02.jpg" class="calibre53"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 4.2 – Original game artwork</p>
<p class="callout-heading">Adventure game 2D art assets</p>
<p class="callout">To follow along in this chapter, download the art assets from the project GitHub here: <a href="https://github.com/PacktPublishing/Unity-2022-by-Example/tree/main/ch4/Art-Assets" class="pcalibre1 pcalibre calibre6">https://github.com/PacktPublishing/Unity-2022-by-Example/tree/main/ch4/Art-Assets</a></p>
<p class="callout">Nica Monami has permitted the use of the provided game art for learning purposes only; commercial use is strictly prohibited. Nica’s portfolio can be viewed on ArtStation at <a href="https://www.artstation.com/dnanica213" class="pcalibre1 pcalibre calibre6">https://www.artstation.com/dnanica213</a></p>
<p class="calibre3">In addition to Sprite Shape – the 2D feature we’ll be using to build out most of the adventure game’s level – we’ll cover most of<a id="_idIndexMarker411" class="pcalibre1 pcalibre calibre6"/> the tooling provided by the <strong class="bold">2D Animation package</strong>. We’ll first cover importing and performing any required prep for the artwork to get started.</p>
<h2 id="_idParaDest-83" class="calibre8"><a id="_idTextAnchor085" class="pcalibre1 pcalibre calibre6"/>Importing and preparing the artwork</h2>
<p class="calibre3">Let’s start by creating a new Unity project for the adventure game, again using the 2D <strong class="bold">Universal Render Pipeline</strong> (<strong class="bold">URP</strong>) Core <a id="_idIndexMarker412" class="pcalibre1 pcalibre calibre6"/>template. We’ll continue exploring different gameplay styles by making the 2D adventure<a id="_idIndexMarker413" class="pcalibre1 pcalibre calibre6"/> game a side-on orthographic game view (similar in style to many other Mario Bros or Metroid-inspired platformer games).</p>
<p class="calibre3">Once the project opens, import the artwork under a new <code>Assets/Sprites</code> folder.</p>
<p class="callout-heading">Dutiful organizational reminder</p>
<p class="callout">Maintaining an adequately named folder structure can help keep things sorted and easy to find and work with later.</p>
<p class="calibre3">Viewing all of the<a id="_idIndexMarker414" class="pcalibre1 pcalibre calibre6"/> imported Sprite assets – in the event you did lose track of something or work with many assets at once – is easily accomplished with the <strong class="bold">Search by Type</strong> option in the project window’s <strong class="bold">Search</strong> tool, as seen in the following figure:</p>
<div><div><img alt="Figure 4.3 – Filtering on Sprite in the project window" src="img/B18347_04_03.jpg" class="calibre54"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 4.3 – Filtering on Sprite in the project window</p>
<p class="calibre3">The image assets imported will serve different purposes and use additional Sprite tooling. Here is a quick overview of how we’ll be working with the imported assets, by folder, throughout<a id="_idIndexMarker415" class="pcalibre1 pcalibre calibre6"/> the remainder of this chapter:</p>
<ul class="calibre17">
<li class="calibre15"><code>Assets/Sprites/Sprite Shapes</code>: Images in this folder will be used with Unity’s 2D <strong class="bold">Sprite Shape</strong> tool. Sprite Shape is a spline-based tool that provides the ability to make open-ended paths or enclosed shapes that can be used as parts of the level that the player character can walk on, adding background elements or quickly decorating the environment.</li>
</ul>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><em class="italic">2D Sprite </em><em class="italic">Shape:</em> <a href="https://docs.unity3d.com/Packages/com.unity.2d.spriteshape%409.0/manual/index.xhtml" class="pcalibre1 pcalibre calibre6">https://docs.unity3d.com/Packages/com.unity.2d.spriteshape%409.0/manual/index.xhtml</a></p>
<ul class="calibre17">
<li class="calibre15"><code>Assets/Sprites/Sprite Skins</code>: Images in this folder will be used with Unity’s 2D <code>SpriteSkin</code> component.</li>
</ul>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><em class="italic">Sprite </em><em class="italic">Skin</em>: <a href="https://docs.unity3d.com/Packages/com.unity.2d.animation%409.0/manual/SpriteSkin.xhtml" class="pcalibre1 pcalibre calibre6">https://docs.unity3d.com/Packages/com.unity.2d.animation%409.0/manual/SpriteSkin.xhtml</a></p>
<ul class="calibre17">
<li class="calibre15"><code>Assets/Sprites/Tilemap</code>: Images in this folder will be used to create a <strong class="bold">Tilemap</strong>; we <a id="_idIndexMarker417" class="pcalibre1 pcalibre calibre6"/>are already familiar with this 2D feature from building the collection game in <a href="B18347_01.xhtml#_idTextAnchor015" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 1</em></a>.</li>
<li class="calibre15"><code>Assets/Sprites/Background</code>: Images in this folder will be used to create our game environment’s layered background. We won’t use any particular Unity feature this time, but we will use a script to add parallax movement.</li>
</ul>
<p class="callout-heading">Background parallax</p>
<p class="callout">Parallax is a technique applied to background images that moves images further away from the camera across the frame more slowly than foreground images, creating a sense of depth in 2D scenes. This technique was popularized in 2D video games starting in the early 1980s (although it was limited in the number of background planes due to hardware limitations of the time – thankfully, we’re not stuck with the limitations of those that came before us because we have no such limitations today).</p>
<ul class="calibre17">
<li class="calibre15"><code>Assets/Sprites/Background/Clouds</code>: Images in this folder will be used to<a id="_idIndexMarker418" class="pcalibre1 pcalibre calibre6"/> create clouds that continuously scroll and loop across the sky in the background of the game environment, furthering the sense of depth and immersion. We’ll use Unity’s <strong class="bold">Spline</strong> package and the corresponding <strong class="bold">Spline Animate</strong> component to make this quick and easy work (similar to the moving platforms mentioned earlier).</li>
<li class="calibre15"><code>Assets/Sprites/Object Elements</code>: Images in this folder will be used to detail the environment and provide some possible special areas of interest. There is nothing special here, just the Sprite Renderer and 2D colliders to facilitate interactions with the player character.</li>
</ul>
<p class="calibre3">With the fundamental review of the imported assets by folder finished, let’s do the prep work for the sprites that require it before usage.</p>
<h3 class="calibre10">Preparing the artwork for Sprite Shape</h3>
<p class="calibre3">The <a id="_idIndexMarker419" class="pcalibre1 pcalibre calibre6"/>Sprite Shape feature creates dynamic and <em class="italic">flexible</em> shapes that <a id="_idIndexMarker420" class="pcalibre1 pcalibre calibre6"/>can either be open paths or closed and filled areas. The sprite that is assigned for the Sprite Shape’s spline path is tiled and deformed along the defined outline. Because of the tiling, we need to take some special steps to prepare the sprite used here by adding a border at the locations on the left and right edges where it will tile seamlessly.</p>
<p class="calibre3">Follow these steps while referring to <em class="italic">Figure 4</em><em class="italic">.4</em> to ensure that the sprite will be compatible and work well with Sprite Shape:</p>
<ol class="calibre14">
<li class="calibre15">Select the sprite in the project folder.</li>
<li class="calibre15">In <strong class="bold">Import Settings (Inspector)</strong>, click the <strong class="bold">Sprite </strong><strong class="bold">Editor</strong> button.</li>
<li class="calibre15">Click<a id="_idIndexMarker421" class="pcalibre1 pcalibre calibre6"/> on the image and drag in both the left and<a id="_idIndexMarker422" class="pcalibre1 pcalibre calibre6"/> right sides by using the green boxes or typing in values into the <strong class="bold">L</strong> and <strong class="bold">R</strong> fields of <strong class="bold">Border</strong> in the <strong class="bold">Sprite</strong> dialog – for the tileable position in the sprite. Click <strong class="bold">Apply</strong> when finished.</li>
<li class="calibre15">Set the <strong class="bold">Mesh Type</strong> to <strong class="bold">Full Rect</strong> (this is required for use with Sprite Shape and will produce a warning on the Sprite Shape asset if not set accordingly).</li>
</ol>
<div><div><img alt="Figure 4.4 – Sprite Editor for Sprite Shape art" src="img/B18347_04_04.jpg" class="calibre55"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 4.4 – Sprite Editor for Sprite Shape art</p>
<p class="callout-heading">Package Manager samples</p>
<p class="callout">Most packages in the Unity Package Manager have additional content as additional installations on their respective Package Manager pages. In Sprite Shape’s case, samples and extras that demonstrate many of its capabilities can be imported. I encourage you to check out the package samples for additional learning.</p>
<h3 class="calibre10">Preparing artwork for Sprite Skin</h3>
<p class="calibre3">The<a id="_idIndexMarker423" class="pcalibre1 pcalibre calibre6"/> Sprite Skin<a id="_idIndexMarker424" class="pcalibre1 pcalibre calibre6"/> feature is commonly used to create rigged limbed characters and is imported from a layered Photoshop <a id="_idIndexMarker425" class="pcalibre1 pcalibre calibre6"/>PSB/PSD file (using the <strong class="bold">PSD Importer</strong> package). We’ll use this 2D animation package feature in <a href="B18347_05.xhtml#_idTextAnchor096" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 5</em></a>, when we create the adventure game’s player character. Still, for now, in this chapter, we’re just going to add some movement to some environmental elements.</p>
<p class="calibre3">We’ll be animating individual PNG images imported into the <code>Sprites/Sprite Skins</code> folder. Aside <a id="_idIndexMarker426" class="pcalibre1 pcalibre calibre6"/>from keeping these as separate images (for the sake of simplicity), there is nothing extra we need to do with the import settings.</p>
<h3 class="calibre10">Preparing artwork for Tilemap</h3>
<p class="calibre3">We used <a id="_idIndexMarker427" class="pcalibre1 pcalibre calibre6"/>Tilemap extensively in <a href="B18347_02.xhtml#_idTextAnchor041" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 2</em></a>; you should be a pro with it by now! Let’s quickly recap the <a id="_idIndexMarker428" class="pcalibre1 pcalibre calibre6"/>image preparation process by creating a new Tile Palette for the <code>Tilemap-01</code> sprite sheet image imported to <code>Sprites/Tilemap</code>, as seen in the following figure:</p>
<div><div><img alt="Figure 4.5 – Slicing the Sprite Sheet for Tilemap tiles" src="img/B18347_04_05.jpg" class="calibre56"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 4.5 – Slicing the Sprite Sheet for Tilemap tiles</p>
<p class="calibre3">Use the following steps to prepare the artwork for use with Tilemap:</p>
<ol class="calibre14">
<li class="calibre15">Select the sprite sheet image in the project folder.</li>
<li class="calibre15">In <strong class="bold">Import Settings (Inspector)</strong>, set <strong class="bold">Sprite Mode</strong> to <strong class="bold">Multiple</strong>.</li>
<li class="calibre15">Apply the changes and click the <strong class="bold">Sprite </strong><strong class="bold">Editor</strong> button.</li>
<li class="calibre15">Select the <strong class="bold">Slice</strong> dropdown menu and then select <strong class="bold">Grid By Cell Size</strong> for <strong class="bold">Type</strong> of slicing.</li>
<li class="calibre15">The supplied Tilemap image uses a 64x64 pixel size grid (same as the collection game), so <a id="_idIndexMarker429" class="pcalibre1 pcalibre calibre6"/>verify<a id="_idIndexMarker430" class="pcalibre1 pcalibre calibre6"/> the correct size and click <strong class="bold">Slice</strong>.</li>
<li class="calibre15">Click <strong class="bold">Apply</strong>, or close <strong class="bold">Sprite Editor</strong> and save, and that’s it for the Tilemap prep work!</li>
</ol>
<h3 class="calibre10">Normal maps</h3>
<p class="calibre3">A <strong class="bold">Normal map</strong> is a <a id="_idIndexMarker431" class="pcalibre1 pcalibre calibre6"/>special type of image where encoding in the RGB channels represents the direction a pixel faces. It’s easy to add fake volume and details to achieve a simulated 3D effect using a sprite’s pixels and 2D lights with URP.</p>
<p class="calibre3">You’ll need to use <a id="_idIndexMarker432" class="pcalibre1 pcalibre calibre6"/>special third-party software to create normal maps outside of Unity, as the following figure shows for a rock that we’ll use in the environment:</p>
<div><div><img alt="Figure 4.6 – Normal map image of a rock in Laigter" src="img/B18347_04_06.jpg" class="calibre39"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 4.6 – Normal map image of a rock in Laigter</p>
<p class="callout-heading">Normal maps generation software</p>
<p class="callout">The program used to create all of the 2D sprite normal maps for the 2D adventure game’s artwork is<a id="_idIndexMarker433" class="pcalibre1 pcalibre calibre6"/> Laigter (available for free at <a href="https://azagaya.itch.io/laigter" class="pcalibre1 pcalibre calibre6">https://azagaya.itch.io/laigter</a>). Other programs that can export 2D normal maps include Photoshop, SpriteIlluminator, Sprite Dlight, and Sprite Lamp.</p>
<p class="calibre3">Note that when<a id="_idIndexMarker434" class="pcalibre1 pcalibre calibre6"/> importing 2D sprite normal maps, <strong class="bold">Texture Type</strong> for the image import settings will be <strong class="bold">Sprite (2D and UI,)</strong> and not <strong class="bold">Normal Map</strong> – because sprites that will be affected by 2D lights need to have the normal map texture assigned in the Sprite Editor (2D lights will also need to have normal maps enabled for affecting the sprites).</p>
<p class="calibre3">All of the images provided in the example 2D adventure game project have accompanying normal maps. For your own images, go ahead and generate the normal maps and then assign them to the sprites by following these steps:</p>
<ol class="calibre14">
<li class="calibre15">Select the sprite in the project folder.</li>
<li class="calibre15">Click the <strong class="bold">Sprite Editor</strong> button in <strong class="bold">Import </strong><strong class="bold">Settings (Inspector)</strong>.</li>
<li class="calibre15">From the <strong class="bold">Sprite Editor</strong> dropdown menu, select <strong class="bold">Secondary Texture</strong>.</li>
<li class="calibre15">In the <strong class="bold">Secondary Texture</strong> dialog that opens, select <strong class="bold">_NormalMap</strong> from the <strong class="bold">Name</strong> dropdown menu.</li>
<li class="calibre15">Assign the sprite’s normal map image by dragging it into the <strong class="bold">Texture</strong> field from the project window.</li>
</ol>
<p class="calibre3">Refer to the preceding <em class="italic">Figure 4</em><em class="italic">.4</em> for an example of the <strong class="bold">Secondary </strong><strong class="bold">Texture</strong> dialog.</p>
<p class="calibre3">With that, we’ve successfully prepared the project’s imported art assets to be used with the 2D tooling used in the coming sections. In the next section, we’ll take another look at level design before putting the art to use in creating different types of platforms.</p>
<h1 id="_idParaDest-84" class="calibre5"><a id="_idTextAnchor086" class="pcalibre1 pcalibre calibre6"/>Level and environment design – Guiding the player</h1>
<p class="calibre3">Let’s <a id="_idIndexMarker435" class="pcalibre1 pcalibre calibre6"/>take a <a id="_idIndexMarker436" class="pcalibre1 pcalibre calibre6"/>quick break from the technical aspects of the project and talk about some game design concepts again before moving on to the features we’ll use to build the game level.</p>
<p class="calibre3">Having the GDD is great, but it doesn’t provide any concrete visuals for communicating the theme and style of the game. Art can quickly elicit emotional responses and build excitement that <a id="_idIndexMarker437" class="pcalibre1 pcalibre calibre6"/>is hard to compare to the <a id="_idIndexMarker438" class="pcalibre1 pcalibre calibre6"/>written words of a GDD. For example, have a look at this concept art created for the <em class="italic">Outer </em><em class="italic">World</em> game:</p>
<div><div><img alt="Figure 4.7 – Original “Outer World” environment concept art" src="img/B18347_04_07.jpg" class="calibre57"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 4.7 – Original “Outer World” environment concept art</p>
<p class="calibre3">You should immediately have a sense of what it would be like to be a player in this environment! Games are often marketed early on with an artist’s rendering for visualizing concepts to gain interest and excitement for a project. They are also used internally to inspire the production team to build the product.</p>
<p class="calibre3">With excitement buzzing, let’s introduce a new game design principle to guide players and get them to explore this unique environment.</p>
<h2 id="_idParaDest-85" class="calibre8"><a id="_idTextAnchor087" class="pcalibre1 pcalibre calibre6"/>Signposting</h2>
<p class="calibre3">We’ve <a id="_idIndexMarker439" class="pcalibre1 pcalibre calibre6"/>discussed guiding the player in <a href="B18347_02.xhtml#_idTextAnchor041" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 2</em></a>, by introducing shapes to nudge the player in the desired direction. The game design principle we’ll present here is focal points in the environment, which is called <strong class="bold">signposting</strong>. Signposting helps the player know what they should do or tells <a id="_idIndexMarker440" class="pcalibre1 pcalibre calibre6"/>them their destination.</p>
<p class="calibre3">We want the player<a id="_idIndexMarker441" class="pcalibre1 pcalibre calibre6"/> to have a goal in mind as they are playing – the player should hardly ever experience the feeling of being lost in the game (only when they are spending a long time not progressing, point them in the right direction to avoid player frustration or worse, leaving the game). This type of signposting is also referred to <a id="_idIndexMarker442" class="pcalibre1 pcalibre calibre6"/>as a <strong class="bold">journey</strong>.</p>
<p class="calibre3">The journey we’re setting our player on in the adventure game can be seen in the following figure, where a habitat station is visible in the distance in the background:</p>
<div><div><img alt="Figure 4.8 – Signposting the habitat station for the player" src="img/B18347_04_08.jpg" class="calibre57"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 4.8 – Signposting the habitat station for the player</p>
<p class="calibre3">The player has a goal now. Always consider designing the level with a purpose… what do we want the player to try to do, what should the player accomplish, or where should the player get to?</p>
<p class="calibre3">Keep these things in mind when designing your level using the tools we’ll introduce in the following sections, starting with adding the platforms that the player will walk on.</p>
<h2 id="_idParaDest-86" class="calibre8"><a id="_idTextAnchor088" class="pcalibre1 pcalibre calibre6"/>Creating platforms</h2>
<p class="calibre3">You can’t have a<a id="_idIndexMarker443" class="pcalibre1 pcalibre calibre6"/> platformer game without platforms! Unity’s 2D tooling provides different tools for building platforms for 2D games. We’ve already used Tilemap to create a rigid and grid-based level design for the collection game. While we’ll still use Tilemap for sections of the adventure game level, we’ll start by creating platforms without the same constraints using Sprite Shape.</p>
<h3 class="calibre10">Creating a closed Sprite Shape profile</h3>
<p class="calibre3">We can use<a id="_idIndexMarker444" class="pcalibre1 pcalibre calibre6"/> two types of shapes when creating with Sprite Shape: open and closed shapes. An open shape provides a sprite outline of the spline path, whereas a closed shape includes a fill texture for creating an enclosed shape where both sides and a bottom sprite can also be defined.</p>
<p class="calibre3">Let’s start the level design with a closed Sprite Shape platform where the player will spawn. To do so, we’ll start by creating the Sprite Shape profile asset in the project before adding the platform to the scene by following these steps:</p>
<ol class="calibre14">
<li class="calibre15">In the project window, within the <code>Assets/Sprites/Sprite Shapes</code> folder, select <strong class="bold">Create</strong> | <strong class="bold">2D</strong> | <strong class="bold">Sprite Shape Profile</strong> and name it <em class="italic">Platform </em><em class="italic">Closed 1</em>.</li>
<li class="calibre15">Assign the sprite for the top edge of the platform by, first, clicking on the blue border of the circle that defines <strong class="bold">Angle Ranges</strong>.</li>
<li class="calibre15">Adjust the <code>45</code> and an <code>-45</code>.</li>
<li class="calibre15">With the region for the top edge now defined, assign the <code>sprite_strip_rock</code> sprite by dragging it from the project window and into the <code>SpriteShapeEdge</code> placeholder).</li>
<li class="calibre15">Do the same for both the left and right sides of the Sprite Shape, using <code>45</code> and <code>135</code> for the angles, respectively, and <code>sprite_side_rock</code> as the sprite, as seen in the following figure:</li>
</ol>
<div><div><img alt="Figure 4.9 – Closed Sprite Shape asset properties (top, left, and right)" src="img/B18347_04_09.jpg" class="calibre58"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 4.9 – Closed Sprite Shape asset properties (top, left, and right)</p>
<ol class="calibre14">
<li value="6" class="calibre15">The last step<a id="_idIndexMarker445" class="pcalibre1 pcalibre calibre6"/> for creating a closed Sprite Shape is to assign the fill texture, so assign the <code>sprite_fill_rock</code> sprite to the <strong class="bold">Fill</strong> | <strong class="bold">Texture</strong> field (replacing <strong class="bold">Sprite Shape</strong> fill placeholder).</li>
</ol>
<p class="calibre3">If the size of the sprites assigned is not to your liking, you can revisit the sprite import settings and change the <strong class="bold">Pixels Per Unit</strong> value to something that looks better (this can be adjusted at any time). The images being used for Sprite Shape are high resolution, so you have the flexibility to change the size without a loss in display quality.</p>
<ol class="calibre14">
<li value="7" class="calibre15">Similarly, we can adjust the scale of the fill texture, but we’ll do that on the <code>SpriteShapeController</code> component when added to the scene – use the <strong class="bold">Fill</strong> | <strong class="bold">Pixels Per Unit</strong> field to adjust the fill texture scale.</li>
<li class="calibre15">With the profile asset created, we can now make the first platform for our player by clicking <strong class="bold">GameObject</strong> | <strong class="bold">2D Object</strong> | <strong class="bold">Sprite Shape</strong> | <strong class="bold">Closed Shape</strong>.</li>
<li class="calibre15">Assign the Sprite Shape asset <code>SpriteShapeController</code> component. Adjust the spline shape<a id="_idIndexMarker446" class="pcalibre1 pcalibre calibre6"/> by manipulating and adding or removing knots, as seen in the following figure:</li>
</ol>
<div><div><img alt="Figure 4.10 – Closed Sprite Shape platform in the scene" src="img/B18347_04_10.jpg" class="calibre39"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 4.10 – Closed Sprite Shape platform in the scene</p>
<p class="calibre3">The last step required to make this closed Sprite Shape a walkable platform for the player character is to add a collider. For Sprite Shape platforms, we use the <code>edge</code>.</p>
<ol class="calibre14">
<li value="10" class="calibre15">Once added, select <strong class="bold">Sprite Shape Controller</strong> | <strong class="bold">Collider</strong> | <strong class="bold">Updated Collider</strong> to enable it. Then, adjust the <strong class="bold">Offset</strong> value to line up with the top edge sprite – this can also be adjusted later when the player character is added to the scene.</li>
</ol>
<p class="callout-heading">Optimization note</p>
<p class="callout">By default, the Sprite Shape API allows you to change the spline nodes at runtime. If you don’t require runtime changes, you can bake or cache the geometry of the spline for a performance boost. So, if you don’t need to modify the spline at runtime, select <strong class="bold">Sprite Shape Controller</strong>, enable <strong class="bold">Edit Spline</strong>, and click <em class="italic">Cache Geometry</em> to bake the mesh. Otherwise, install the Burst package (version 1.3 or later) from the Package Manager to improve performance when modifying the spline at runtime.</p>
<p class="calibre3">Another thing to<a id="_idIndexMarker448" class="pcalibre1 pcalibre calibre6"/> note is that Sprite Shape’s Renderer works like any other Sprite Renderer component and utilizes <strong class="bold">Sorting Layers</strong>. We’ll be using <strong class="bold">Sorting Layers</strong> throughout the project to properly layer the different artwork that will make up the level’s platforms and overall environment. We’ll keep all the level’s platforms on the default layer, so we have nothing to change.</p>
<p class="callout-heading">Bonus activity</p>
<p class="callout">Sprite Shape can also be used to distribute a variety of sprites along an updateable spline path. Explore Sprite Shape’s features to discover how you can decorate the platforms with the <em class="italic">vine</em> and <em class="italic">toxins</em> assets provided.</p>
<p class="calibre3">Now that you’ve learned how to create flexible shaped platforms using Sprite Shape, we’ll have a quick review of setting up a Tile Palette to use for drawing platforms with Tilemap before moving on to creating dynamic and interactive features in the level.</p>
<h3 class="calibre10">Tilemap</h3>
<p class="calibre3">This section will <a id="_idIndexMarker449" class="pcalibre1 pcalibre calibre6"/>be a quick refresher for creating platforms in our level design using Tilemap since we’ve covered this topic extensively in <a href="B18347_02.xhtml#_idTextAnchor041" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 2</em></a>.</p>
<p class="calibre3">To create the tiles to be used for painting using the Tile Palette, follow these steps:</p>
<ol class="calibre14">
<li class="calibre15">Open the Tile Palette by going to <strong class="bold">Window</strong> | <strong class="bold">2D</strong> | <strong class="bold">Tile Palette</strong>.</li>
<li class="calibre15">Select <code>Environment</code> while using the default properties for a Rectangle Grid.</li>
<li class="calibre15">Click the <code>Assets/Sprites/Tilemap/Tile Palettes</code>.</li>
<li class="calibre15">From the <code>Asset/Sprites/Tilemap</code> folder, click and drag the <code>Tilemap-01</code> image into the <code>Assets/Sprites/Tilemap/Tiles</code> folder when prompted.</li>
</ol>
<p class="calibre3">Now that the<a id="_idIndexMarker450" class="pcalibre1 pcalibre calibre6"/> tiles we’ll use for the Tilemap portion of our level are created, let’s go ahead and make a platform to the right of the Sprite Shape platform using these steps:</p>
<ol class="calibre14">
<li class="calibre15">In the <strong class="bold">Hierarchy</strong> window, create a new Tilemap by using the <strong class="bold">Create</strong> or <strong class="bold">GameObject</strong> menu and selecting <strong class="bold">2D Object</strong> | <strong class="bold">Tilemap</strong> | <strong class="bold">Rectangular</strong>.</li>
<li class="calibre15">We’ll use the same <strong class="bold">Default</strong> Sorting Layer on <strong class="bold">Tilemap Renderer</strong> as we did for the Sprite Shape Renderer.</li>
<li class="calibre15">Draw the platform using the brush and flood fill tools while using the correct tiles for the top, sides, bottom, and corners, as shown in the following figure:</li>
</ol>
<div><div><img alt="Figure 4.11 – Tilemap platform added to the scene" src="img/B18347_04_11.jpg" class="calibre39"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 4.11 – Tilemap platform added to the scene</p>
<ol class="calibre14">
<li value="4" class="calibre15">As a last step, add a <strong class="bold">Tilemap Collider 2D</strong> component to the Tilemap object, so it’s walkable by the player character.</li>
</ol>
<p class="calibre3">We now <a id="_idIndexMarker451" class="pcalibre1 pcalibre calibre6"/>have two different styles of platforms we can use to create visually distinct areas in the level. In the next section, we’ll take platforms to the next level by introducing movement and triggering interactions in the environment with a C# script.</p>
<h1 id="_idParaDest-87" class="calibre5"><a id="_idTextAnchor089" class="pcalibre1 pcalibre calibre6"/>Moving platforms and triggers – Creating a dynamic interactable environment</h1>
<p class="calibre3">Adding<a id="_idIndexMarker452" class="pcalibre1 pcalibre calibre6"/> moving platforms <a id="_idIndexMarker453" class="pcalibre1 pcalibre calibre6"/>to our game’s level adds to the visual interest and provides additional challenges <a id="_idIndexMarker454" class="pcalibre1 pcalibre calibre6"/>for the player. Unity again provides<a id="_idIndexMarker455" class="pcalibre1 pcalibre calibre6"/> tooling that makes creating moving <a id="_idIndexMarker456" class="pcalibre1 pcalibre calibre6"/>platforms a simple and straightforward task right in the scene View and without needing to write any code.</p>
<p class="calibre3">We previously used Sprite Shape to make a closed platform, but Sprite Shape also allows the creation of open shapes, and that will be perfect here for making a small platform that we can move.</p>
<h2 id="_idParaDest-88" class="calibre8"><a id="_idTextAnchor090" class="pcalibre1 pcalibre calibre6"/>Moving a Sprite Shape platform with Splines</h2>
<p class="calibre3">Introduced for<a id="_idIndexMarker457" class="pcalibre1 pcalibre calibre6"/> the Unity 2022 tech stream, we have a new 2D package<a id="_idIndexMarker458" class="pcalibre1 pcalibre calibre6"/> called <code>Spline</code> component is used. And the <code>Sprite Animate</code> component is used for moving a platform along the spline path and doing so without using any code. Nice!</p>
<p class="callout-heading">Splines</p>
<p class="callout">Smooth shapes can be created with splines by having a generated line pass through any arbitrary number of control points. Different approaches for interpolating the line and providing adjustments between hard edges and rounded corners are available, such as Catmull-Rom (helpful in calculating a curve that passes through all control points), Bézier curves (which provide handles to adjust the tangents of the line in relation to points), and B-Splines (similar to Catmull-Rom splines but the generated line does not necessarily pass through the control points).</p>
<p class="callout">The Unity 2022 <strong class="source-inline1">Splines</strong> package specifically supports Linear, Catmull-Rom, and Bézier types.</p>
<p class="calibre3">To use<a id="_idIndexMarker459" class="pcalibre1 pcalibre calibre6"/> Splines in our project, we’ll need to verify that the package is<a id="_idIndexMarker460" class="pcalibre1 pcalibre calibre6"/> installed. Open <code>splines</code> or find <strong class="bold">Splines</strong> in the <strong class="bold">Packages</strong> list to select and install.</p>
<p class="calibre3">The first step of creating a moving platform is creating the platform.</p>
<h3 class="calibre10">Creating an open Sprite Shape profile</h3>
<p class="calibre3">We already had <a id="_idIndexMarker461" class="pcalibre1 pcalibre calibre6"/>an introduction to Sprite Shape when we created the closed platform in the <em class="italic">Creating a closed Sprite Shape profile</em> section. Creating an open Sprite Shape is even easier!</p>
<p class="calibre3">Use the following few steps to create an open Sprite Shape profile asset:</p>
<ol class="calibre14">
<li class="calibre15">In the project window, within the <code>Assets/Sprites/Sprite Shapes</code> folder, select <strong class="bold">Create</strong> | <strong class="bold">2D</strong> | <strong class="bold">Sprite Shape Profile</strong> and name it <em class="italic">Platform </em><em class="italic">Open 1</em>.</li>
<li class="calibre15">Assign the <code>sprite_strip_rock</code> sprite by dragging it from the project window and into the <code>SpriteShapeEdge</code> placeholder).</li>
</ol>
<div><div><img alt="Figure 4.12 – Open Sprite Shape asset properties" src="img/B18347_04_12.jpg" class="calibre59"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 4.12 – Open Sprite Shape asset properties</p>
<ol class="calibre14">
<li value="3" class="calibre15">With the<a id="_idIndexMarker462" class="pcalibre1 pcalibre calibre6"/> profile asset created, we can now add our first open Sprite Shape moving platform to the scene by clicking <strong class="bold">GameObject</strong> | <strong class="bold">2D Object</strong> | <strong class="bold">Sprite Shape</strong> | <strong class="bold">Open Shape</strong>.</li>
<li class="calibre15">Assign the <code>SpriteShapeController</code> component’s <strong class="bold">Profile</strong> field, then use the <strong class="bold">Shape</strong> editing tool in the scene Toolbar overlay to make a small straight platform (as seen in <em class="italic">Figure 4</em><em class="italic">.13</em>). Hint: Use only two knots with <strong class="bold">Tangent Mode</strong> set to <strong class="bold">Linear</strong>.</li>
</ol>
<p class="calibre3">As before, the last step required to make this open Sprite Shape a walkable platform for the player character is to add a collider – we also use the <code>edge</code>.</p>
<ol class="calibre14">
<li value="5" class="calibre15">Once added, ensure the <strong class="bold">Sprite Shape Controller</strong> | <strong class="bold">Collider</strong> | <strong class="bold">Updated Collider</strong> field is<a id="_idIndexMarker464" class="pcalibre1 pcalibre calibre6"/> enabled, then adjust the <strong class="bold">Offset</strong> value to line up with the top edge sprite (this can be adjusted at any time).</li>
</ol>
<p class="calibre3">Lastly, let’s keep our moving platforms on the same Sorting Layer as all the other platforms in the level: <strong class="bold">Default</strong>.</p>
<p class="calibre3">The next step in creating the moving platform is setting the path it will take.</p>
<h3 class="calibre10">Spline path</h3>
<p class="calibre3">Much like how <a id="_idIndexMarker465" class="pcalibre1 pcalibre calibre6"/>we work with splines to create the Sprite Shape platforms, we can use Unity’s <strong class="bold">Splines</strong> feature tooling to create generic spline paths for any number of gameplay reasons. Here, we’re simply building a path for a platform to move between two points (it could be more, but we’re only creating a simple vertical or horizontal moving platform).</p>
<p class="calibre3">In the <strong class="bold">Hierarchy</strong> window, use the <strong class="bold">Create</strong> menu or click <strong class="bold">GameObject</strong> | <strong class="bold">3D Object</strong> | <strong class="bold">Spline</strong> | <strong class="bold">Draw Spline Tool…</strong> to add a new Spline to the scene (rename it or hit <em class="italic">Enter</em> to accept the default). Yes, Splines are considered 3D objects because the spline path’s knots are Vector3 positions (relative to the GameObject’s transform position, so they are in <strong class="bold">Local Space</strong>). We’ll <a id="_idIndexMarker466" class="pcalibre1 pcalibre calibre6"/>be using them solely in 2D (<em class="italic">X</em> and <em class="italic">Y</em> axes) for this project, so just be mindful that the <em class="italic">Z</em> axis should always have a zero value.</p>
<p class="calibre3">With the <code>0</code>, <code>0</code>, <code>0</code>) – the <strong class="bold">Spline</strong> object position will be set to the clicked position).</p>
<p class="calibre3">Click to add a second knot some distance below the first one and use the <strong class="bold">Sprite Inspector</strong> overlay to set its <em class="italic">X</em> position value to zero so the knots are vertically aligned, as seen in the following figure:</p>
<div><div><img alt="Figure 4.13 – Working with Bezier Splines for an open Sprite Shape platform" src="img/B18347_04_13.jpg" class="calibre39"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 4.13 – Working with Bezier Splines for an open Sprite Shape platform</p>
<p class="calibre3">Note that <a id="_idIndexMarker467" class="pcalibre1 pcalibre calibre6"/>the <strong class="bold">Spline Inspector</strong> overlay may be docked to the side of the scene View when the Spline tool is selected and as shown in <em class="italic">Figure 4</em><em class="italic">.13</em>. You can click on the icon in the overlay toolbar or drag it into the scene View window to work with the selected Spline knot’s properties.</p>
<p class="calibre3">If you need to edit the position, or the knot’s <strong class="bold">Tangent Mode</strong>, use the <strong class="bold">Spline Transform</strong> tool, and for adding knots to the spline, use the <strong class="bold">Draw Splines</strong> tool (both are available<a id="_idIndexMarker468" class="pcalibre1 pcalibre calibre6"/> in the <strong class="bold">Toolbar</strong> overlay when a Spline object is selected in <strong class="bold">Hierarchy</strong>).</p>
<p class="callout-heading">Additional reading | Unity documentation | New in Unity 2022</p>
<p class="callout"><strong class="bold">Splines</strong>: <a href="https://docs.unity3d.com/Packages/com.unity.splines%401.0/manual/getting-started-with-splines.xhtml" class="pcalibre1 pcalibre calibre6">https://docs.unity3d.com/Packages/com.unity.splines%401.0/manual/getting-started-with-splines.xhtml</a></p>
<p class="calibre3">Now it’s time to get things moving!</p>
<h3 class="calibre10">Spline Animate</h3>
<p class="calibre3">The <code>Splines</code> package<a id="_idIndexMarker469" class="pcalibre1 pcalibre calibre6"/> provides additional components covering some common use cases for spline paths. We will use one of <a id="_idIndexMarker470" class="pcalibre1 pcalibre calibre6"/>them here – the <strong class="bold">Spline </strong><strong class="bold">Animate</strong> component.</p>
<p class="calibre3">A bit of housekeeping is in order to make our moving platform not only easy to animate and work with but also so that we can create a prefab that will make it quick and easy work to add additional moving platforms throughout the level.</p>
<p class="calibre3">Right now, we have an open Sprite Shape platform object and a Spline path object at the root of the hierarchy. To make this a reusable prefab, where we have the most control over the position of the spline path and platform, we’ll want to end up with this object hierarchy:</p>
<div><div><img alt="Figure 4.14 – Hierarchy relationships" src="img/B18347_04_14.jpg" class="calibre60"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 4.14 – Hierarchy relationships</p>
<p class="calibre3">Use the <strong class="bold">Create Empty</strong> or <strong class="bold">Create Empty Parent</strong> options available in the <strong class="bold">Hierarchy</strong> window’s <strong class="bold">Create</strong> menu to accomplish this – empty GameObjects are a great way to organize or provide an additional way to manipulate objects!</p>
<p class="calibre3">Just be sure the Spline and platform object’s transform positions are at (<code>0</code>, <code>0</code>, <code>0</code>) since we should be using the root object (<code>Moving Platform 1</code>) transform position to place the platform in the level.</p>
<p class="calibre3">Part of the reason for creating the object hierarchy this way was to add the object we’ll move with the <strong class="bold">Sprite Animate</strong> component – the <strong class="bold">Platform Mover</strong> object. Add the <strong class="bold">Spite Animate</strong> component now by selecting <strong class="bold">Platform Mover</strong> and clicking <strong class="bold">Add Component</strong> in the <strong class="bold">Inspector</strong> window. Assign the <strong class="bold">Spline</strong> object to the <strong class="bold">Spline</strong> field, select <strong class="bold">Spline Object</strong> in the <strong class="bold">Align To</strong> field, then set <strong class="bold">Loop Mode</strong> to <strong class="bold">Ping Pong</strong> (so the platform moves back and forth between the spline knots).</p>
<p class="calibre3">Adjust <strong class="bold">Duration</strong> and <strong class="bold">Easing</strong> to your liking using the following figure as a reference.</p>
<div><div><img alt="Figure 4.15 – Moving the platform with Spline Animate" src="img/B18347_04_15.jpg" class="calibre61"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 4.15 – Moving the platform with Spline Animate</p>
<p class="calibre3">And that’s it! I said<a id="_idIndexMarker471" class="pcalibre1 pcalibre calibre6"/> it would be easy<a id="_idIndexMarker472" class="pcalibre1 pcalibre calibre6"/> to get our platform moving… it just required a bit of setup. You can preview the movement of the platform right in the scene View without having to enter <strong class="bold">Play Mode</strong>. Use the <strong class="bold">Play</strong>, <strong class="bold">Pause</strong>, and <strong class="bold">Reset</strong> controls to adjust the duration, type of easing, position of the spline knots, and offset position of <strong class="bold">Platform Open 1</strong> until you’re satisfied with the positioning and movement.</p>
<p class="calibre3">Finish up by dragging the <code>Moving Platform 1</code> object to the <code>Assets/Prefabs</code> folder in the project window to create the prefab asset.</p>
<h2 id="_idParaDest-89" class="calibre8"><a id="_idTextAnchor091" class="pcalibre1 pcalibre calibre6"/>Triggering actions in the level</h2>
<p class="calibre3">Games<a id="_idIndexMarker473" class="pcalibre1 pcalibre calibre6"/> often have interactions that are triggered in the environment when the player moves into a specific <a id="_idIndexMarker474" class="pcalibre1 pcalibre calibre6"/>area or touches something– think rocks falling, doors opening, alerting the enemy, turning lights on/off, transitioning to a cutscene, or whatever your game requires. This is pretty trivial to add if we leverage the Unity physics engine similar to how we previously performed collecting items in the collection game.</p>
<p class="calibre3">The process is as follows:</p>
<ol class="calibre14">
<li class="calibre15">We first add a sprite for the object to our game level.</li>
<li class="calibre15">Create a collider volume around the object to define a trigger area – using the least expensive 2D collider type, the better (e.g., <code>CircleCollider2D</code>).</li>
<li class="calibre15">Enable <strong class="bold">IsTrigger</strong> on the collider so that it does not physically interact with any other objects in the scene.</li>
<li class="calibre15">Add a component that will invoke an event when the Unity physics message, <code>OnTriggerEnter2D()</code>, is called when the player enters the collider.</li>
</ol>
<p class="calibre3">We’re also <a id="_idIndexMarker475" class="pcalibre1 pcalibre calibre6"/>going to take<a id="_idIndexMarker476" class="pcalibre1 pcalibre calibre6"/> a designer-friendly approach and make the action assignable in the <strong class="bold">Inspector</strong> window so we won’t have to create a custom script for every type of triggered event. This will make the triggered event component reusable anywhere in the game we want the player to trigger an interaction. Yay!</p>
<h3 class="calibre10">UnityEvent</h3>
<p class="calibre3">The event<a id="_idIndexMarker477" class="pcalibre1 pcalibre calibre6"/> delegate<a id="_idIndexMarker478" class="pcalibre1 pcalibre calibre6"/> type we’ll use here is <strong class="bold">UnityEvent</strong> – we’ve previously used <strong class="bold">UnityAction</strong>. The difference is that <strong class="bold">UnityEvent</strong> is serialized and becomes <a id="_idIndexMarker479" class="pcalibre1 pcalibre calibre6"/>available in the <strong class="bold">Inspector</strong> to assign public methods.</p>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><em class="italic">UnityEvent</em>: <a href="https://docs.unity3d.com/2022.3/Documentation/ScriptReference/Events.UnityEvent.xhtml" class="pcalibre1 pcalibre calibre6">https://docs.unity3d.com/2022.3/Documentation/ScriptReference/Events.UnityEvent.xhtml</a></p>
<p class="callout">In Unity 2022, the <strong class="bold">UnityEvent</strong> list in the <strong class="bold">Inspector</strong> is now reorderable!</p>
<p class="calibre3">Let’s see how this works by creating a new script named <code>TriggeredEvent</code>, with the following <a id="_idIndexMarker480" class="pcalibre1 pcalibre calibre6"/>code:</p>
<pre class="source-code">
[RequireComponent(typeof(Collider2D))]
public class TriggeredEvent : MonoBehaviour
{
    [Tooltip("Requires the player character
        to have the 'Player' tag assigned.")]
    public bool IsTriggeredByPlayer = true;
    public UnityEvent OnTriggered;
    private void OnTriggerEnter2D(Collider2D collision)
    {
      if (IsTriggeredByPlayer &amp;&amp;
          !collision.CompareTag(Tags.Player))
              return;
      OnTriggered?.Invoke();
    }
}</pre> <p class="calibre3">Let’s break this down, especially since there are several new items worth noting:</p>
<ol class="calibre14">
<li class="calibre15">The class declaration is decorated with the <code>RequireComponent</code> attribute. This means that when the <code>TriggeredEvent</code> script is added as a component to a GameObject, it will require that the specified type exists as a sibling component on the GameObject. If possible, the required component will be added.</li>
<li class="calibre15">In our case, we only specified the base <code>Collider2D</code> type that all of the 2D colliders inherit<a id="_idIndexMarker481" class="pcalibre1 pcalibre calibre6"/> from – this allows us to add any type of collider as a trigger volume for the triggered event. If we try to add the script to a GameObject that does not already have a 2D collider added, we’ll receive this error:</li>
</ol>
<div><div><img alt="Figure 4.16 – Can’t add script for the required component" src="img/B18347_04_16.jpg" class="calibre62"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 4.16 – Can’t add script for the required component</p>
<p class="calibre3">The solution is to add a 2D collider (appropriate for the player interaction scenario) to the GameObject before adding the <code>TriggeredEvent</code> script. For this example, we’ve added a <code>CircleCollider2D</code>, placed and sized it in front of a peculiar rock formation, and triggered a particle system to start playing (as seen in <em class="italic">Figure 4</em><em class="italic">.16</em>).</p>
<ol class="calibre14">
<li value="3" class="calibre15">Next is the <code>IsTriggeredByPlayer</code> Boolean that we’ll set in the <strong class="bold">Inspector</strong>. A few lines below it will be used to determine whether only the player can trigger the interaction. This field is optional but a quick and easy addition that could provide some exciting behavior if, say, enemies or other objects enter the collider (think outside the box here for all the different things that could be triggered in the environment).</li>
<li class="calibre15">As just discussed, the <code>UnityEvent</code> declaration is what allows us, as the developer and designer, to add the specific interaction – one or many – in the <strong class="bold">Inspector</strong> that is invoked when triggered (as seen in the <strong class="bold">Inspector</strong> under the darker gray <strong class="bold">On Triggered ()</strong> section in <em class="italic">Figure 4</em><em class="italic">.16</em>).</li>
<li class="calibre15">The <code>if</code> block determines whether we’ll continue running the triggered code or not if we require the event only to be triggered by the player. So if <code>IsTriggeredByPlayer</code> is set to <code>true,</code> the conditional AND operator (<code>&amp;&amp;</code>) will evaluate whether the object collided is tagged <code>Player</code>. And if not, it will stop <a id="_idIndexMarker482" class="pcalibre1 pcalibre calibre6"/>executing this method’s code (by using the <code>return</code> statement).</li>
</ol>
<p class="callout-heading">&amp;&amp; (C#)</p>
<p class="callout">The conditional AND (<strong class="source-inline1">&amp;&amp;</strong>) operator means both statements must logically equate to <strong class="source-inline1">true</strong> for executing the code in the block. Note that this has “short-circuiting” logic, meaning that if the first expression evaluates to <strong class="source-inline1">false</strong>, then the second expression will not be evaluated.</p>
<p class="calibre3">The other thing to note here is that <code>Tags.Player</code> will give you a compiler error because the <code>Tags</code> type has not been defined yet (identified by a red squiggly underline). Let’s fix that now. We’ll use the built-in refactoring tooling in the IDE by either right-clicking on the word <strong class="bold">Tags</strong> (or clicking anywhere on <strong class="bold">Tags</strong> and pressing <em class="italic">Alt</em> + <em class="italic">Enter</em>, or <em class="italic">Ctrl</em> + <em class="italic">.</em>, depending on your IDE).</p>
<p class="calibre3">In the dialog that opens, select <strong class="bold">Refactoring...</strong> | <strong class="bold">Generate type ‘Tags’</strong> | <strong class="bold">Generate class ‘Tags’ in a </strong><strong class="bold">new file</strong>.</p>
<p class="callout-heading">Optimization note</p>
<p class="callout">For performance reasons, you should always use <strong class="source-inline1">CompareTag()</strong> over evaluating the <strong class="source-inline1">.tag</strong> property of a GameObject with the <strong class="source-inline1">==</strong> operator.</p>
<p class="calibre3">With the new file created, add a constant for the <code>Player</code> tag string like the following:</p>
<pre class="source-code">
internal class Tags
{
    // Ensure all tags are spelled correctly!
    public const string Player = "Player";
}</pre> <p class="calibre3">Note that this class does not inherit from <code>MonoBehaviour</code> because we won’t be adding it to a GameObject in the scene. It will be used solely when we need to specify an object’s tag anywhere in our code – minimizing the use of string literals <a id="_idIndexMarker483" class="pcalibre1 pcalibre calibre6"/>throughout the code, issues related to simple spelling mistakes that are easy to overlook, and providing CodeLens references for everywhere it’s being used. Anytime you need to reference a tag for any other object in the game, just add it here.</p>
<p class="callout-heading">Const (C#)</p>
<p class="callout">A variable declared as a constant is an immutable value that does not change for the program’s life (that is, known at compile time). A <strong class="source-inline1">const</strong> (<strong class="source-inline1">string</strong>, <strong class="source-inline1">int</strong>, <strong class="source-inline1">float</strong>, etc.) declared with a public accessor is available to other classes without an instance reference – similar to how a static variable would be used.</p>
<ol class="calibre14">
<li value="6" class="calibre15">The last line invokes the event(s) assigned in the <code>OnTriggered?.Invoke();</code> – note that the <code>?.</code> (null-conditional) operator is optional here, but I always include it for invoked member types for code consistency.</li>
</ol>
<p class="calibre3">Now, with the setup shown in the following figure, when the player enters the collider, particles will spawn from the rock!</p>
<div><div><img alt="Figure 4.17 – TriggerEvent collider with scene View icon" src="img/B18347_04_17.jpg" class="calibre39"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 4.17 – TriggerEvent collider with scene View icon</p>
<p class="calibre3">With this <a id="_idIndexMarker484" class="pcalibre1 pcalibre calibre6"/>kind of reusable component for triggering any type of event, it is now trivial to add interactions throughout the game level by both developers and designers working on the project. Easy-peasy!</p>
<p class="calibre3">In this section, we’ve now finished up with all the 2D feature tooling used to create all the walkable platforms, including those moving, as well as interactivity in the level. In the next section, we’ll look at finalizing the game’s environment, adding polish, and optimizing the draw calls for better performance.</p>
<h1 id="_idParaDest-90" class="calibre5"><a id="_idTextAnchor092" class="pcalibre1 pcalibre calibre6"/>Adding polish to our environment to immerse the player and optimizing</h1>
<p class="calibre3">With the tools<a id="_idIndexMarker485" class="pcalibre1 pcalibre calibre6"/> and techniques introduced in the previous sections, you should now explore building out your level design. Closed Sprite Shapes for the primary platforms, open Sprite Shapes for platforms that are both static and moving, and Tilemap platforms mixed in for a particular area of the level – all used to give the player an experience and challenge on their journey to the habitat station we provide a signpost for in the background.</p>
<p class="calibre3">Platforms on a blank screen are rather dull. Let’s add some polish to the level by adding a background and some movement.</p>
<h2 id="_idParaDest-91" class="calibre8"><a id="_idTextAnchor093" class="pcalibre1 pcalibre calibre6"/>Polishing the environment</h2>
<p class="calibre3">With your<a id="_idIndexMarker486" class="pcalibre1 pcalibre calibre6"/> game level now well on its <a id="_idIndexMarker487" class="pcalibre1 pcalibre calibre6"/>way to being defined (we’ll, of course, be making plenty of adjustments once we add the player character and can start play-testing the level), let’s have a look at finishing and polishing the environment, starting with adding the background and foreground elements to more fully flesh out the game design – providing immersion and setting the tone for the player experience.</p>
<h3 class="calibre10">Background parallax effect</h3>
<p class="calibre3">As mentioned <a id="_idIndexMarker488" class="pcalibre1 pcalibre calibre6"/>previously, we’ll be applying a relatively old 2D game design technique called parallax to layered images in the background to create depth and a sense of immersion in the environment. We’ll accomplish this with a custom C# script since Unity does not provide a 2D feature specifically geared toward tackling this technique.</p>
<p class="calibre3">Let’s start by creating a new C# script in the <code>Assets/Scripts</code> folder and name it <code>ParallaxLayers</code>. This script will be a reusable component that we can use to add parallax movement to any number of layered images. In the 2D adventure game, we’ll use this for the background and a few foreground elements.</p>
<p class="calibre3">Let’s have a look at the following code:</p>
<pre class="source-code">
public class ParallaxLayers : MonoBehaviour
{
    public List&lt;Layer&gt; Layers;
    [System.Serializable]
    public class Layer    // Nested class.
    {
      public Renderer Image;
      [Tooltip("How far away is the image from the
          camera?"), Range(0, 10000)]
      public int Zdepth;
    }
    private Camera _camera;
    private Vector3 _cameraLastScreenPosition;
    private void Awake()
    {
      _camera = Camera.main;
      _cameraLastScreenPosition =
          _camera.transform.position;
    }
    private void LateUpdate()
    {
      if (_camera.transform.position.x ==
          _cameraLastScreenPosition.x)
              return;
      foreach (var item in Layers)
      {
        float parallaxSpeed = 1 – Mathf.Clamp01(
            Mathf.Abs(_camera.transform.position.z
                / item.Zdepth));
        float difference = _camera.transform.position.x
            - _cameraLastScreenPosition.x;
        item.Image.transform.Translate(
            difference * parallaxSpeed * Vector3.right);
      }
      _cameraLastScreenPosition =
          _camera.transform.position;
    }
}</pre> <p class="calibre3">Let’s break down <a id="_idIndexMarker489" class="pcalibre1 pcalibre calibre6"/>the code item by item:</p>
<ol class="calibre14">
<li class="calibre15">The first public variable declared is a list of the images we’ll use for the parallax layers that will be moved at different speeds based on their depth (this is how the parallax effect is achieved; objects in the distance appear to move slower than nearby objects). We use C# <code>List&lt;T&gt;</code> specifying <code>Layer</code> as the type, where <code>Layer</code> is a custom class [object] we declare to hold the reference for a specific image and the depth value assigned to it for calculating its movement speed relative to the camera movement.</li>
</ol>
<p class="callout-heading">List (C#)</p>
<p class="callout"><strong class="source-inline1">List&lt;T&gt;</strong> is a<a id="_idIndexMarker490" class="pcalibre1 pcalibre calibre6"/> collection of strongly typed objects that can be added, accessed by index, or returned by methods it provides for searching. Methods are also provided for <a id="_idIndexMarker491" class="pcalibre1 pcalibre calibre6"/>sorting and manipulating objects in different ways.</p>
<p class="callout">Additional reading: https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.list-1</p>
<ol class="calibre14">
<li value="2" class="calibre15">Next is the <code>Layer</code> nested class declaration with public fields for <code>Image</code> with a type of <code>Renderer</code> (all sprites, meshes, lines, trails, and particles are drawn with a component derived from the <code>Renderer</code> class) and <code>ZDepth</code>, which is an <code>int</code> value<a id="_idIndexMarker492" class="pcalibre1 pcalibre calibre6"/> for the image’s distance away from the camera.</li>
<li class="calibre15">The <code>ZDepth</code> variable declaration is also decorated with the <code>Tooltip</code> and <code>Range</code> attributes (these can be comma delimited in a single <code>[]</code> statement). The <code>Tooltip</code> attribute displays the specified message text when the mouse hovers over the field label in the <code>Range</code> attribute will limit the values valid for the field between the range specified.</li>
</ol>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><em class="italic">Attributes</em>: <a href="https://docs.unity3d.com/2022.3/Documentation/Manual/Attributes.xhtml" class="pcalibre1 pcalibre calibre6">https://docs.unity3d.com/2022.3/Documentation/Manual/Attributes.xhtml</a></p>
<ol class="calibre14">
<li value="4" class="calibre15">The <code>Layer</code> class declaration itself is decorated with the <code>System.Serializable</code> attribute. A class declaration is not available in the <code>Layers</code> accessor is public, that alone is not enough to serialize the class.</li>
<li class="calibre15">The private <code>_camera</code> member is used to cache the main camera reference because we’re getting values from it multiple times in our calculation, and we want this to be performant.</li>
<li class="calibre15"><code>LateUpdate()</code> is executed after <code>Update()</code> and after the internal animation update is processed. After everything in the game loop has been updated, we can use <code>LateUpdate()</code> to affect those updates further. In this case, we want to move the background layers only after the camera movement.</li>
</ol>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><em class="italic">LateUpdate</em>: <a href="https://docs.unity3d.com/2022.3/Documentation/ScriptReference/MonoBehaviour.LateUpdate.xhtml" class="pcalibre1 pcalibre calibre6">https://docs.unity3d.com/2022.3/Documentation/ScriptReference/MonoBehaviour.LateUpdate.xhtml</a></p>
<p class="callout"><strong class="bold">Order of execution for event </strong><strong class="bold">functions</strong>: <a href="https://docs.unity3d.com/2022.3/Documentation/Manual/ExecutionOrder.xhtml" class="pcalibre1 pcalibre calibre6">https://docs.unity3d.com/2022.3/Documentation/Manual/ExecutionOrder.xhtml</a></p>
<ol class="calibre14">
<li value="7" class="calibre15">Did the <a id="_idIndexMarker493" class="pcalibre1 pcalibre calibre6"/>camera move? A quick evaluation on the <code>_cameraLastScreenPosition</code> Boolean value will tell – if not, don’t execute further (using the <code>return</code> statement). Don’t run code that you don’t have to!</li>
<li class="calibre15">This is where the magic happens… using the <code>foreach</code> iterator, we’ll go through each of the <code>Layer</code> items added in the <strong class="bold">Inspector</strong> and move it the calculated distance relative to how far the camera moved:<pre class="source-code">
foreach (var item in Layers)
{</pre><ul class="calibre22"><li class="calibre15"><code>parallaxSpeed</code>: we start by getting a ratio for the depth of the image from the camera position (order of operations for math), returning the absolute value (a positive number), clamping the value to a range of <code>0</code> to <code>1</code>, and finally subtracting the clamped value from <code>1</code> to get a percentage of the camera’s movement to move the image:<pre class="source-code">float parallaxSpeed = 1 - Mathf.Clamp01(
    Mathf.Abs(_camera.transform.position.z /
        item.ZDepth));</pre></li><li class="calibre15"> <code>difference</code>: How far the camera moved from its current position compared to its last position:<pre class="source-code">float difference = _camera.transform.position.x
    - _cameraLastScreenPosition.x;</pre></li><li class="calibre15"><code>transform.Translate()</code>: Move the image horizontally on the <em class="italic">X</em> axis (due to <code>Vector3.right</code>) by the <a id="_idIndexMarker494" class="pcalibre1 pcalibre calibre6"/>distance the camera moved multiplied by the speed factor (effectively, speed values closer to <code>1</code> move relatively the same distance as the camera):<pre class="source-code">item.Image.transform.Translate(
    difference * parallaxSpeed * Vector3.right);</pre></li></ul></li> </ol>
<p class="callout-heading">foreach (C#)</p>
<p class="callout">The <strong class="source-inline1">foreach</strong> statement<a id="_idIndexMarker495" class="pcalibre1 pcalibre calibre6"/> iterates over a collection of items and executes its code block for each. Each list element is of the type specified when the list is declared.</p>
<p class="callout">Additional reading on<a id="_idIndexMarker496" class="pcalibre1 pcalibre calibre6"/> C# iteration statements: <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/statements/iteration-statements" class="pcalibre1 pcalibre calibre6">https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/statements/iteration-statements</a></p>
<ol class="calibre14">
<li value="9" class="calibre15">Finish off by updating the variable that holds the camera’s last position after moving.</li>
</ol>
<p class="callout-heading">int versus float divide by zero</p>
<p class="callout">You might be thinking, <em class="italic">Hey, wait a second, Scott, with the </em><strong class="source-inline1">Range</strong><em class="italic"> attribute, you’re allowing a zero value for distance, and to calculate the parallax speed, we’re dividing by the distance. So, if the distance is zero, then won’t that throw a divide-by-zero exception error?</em> What an astute observation to make that point; thank you for asking! You would be correct if the camera’s <strong class="source-inline1">transform.position.z</strong> value is an integer type. It would absolutely throw an exception, but it is a float value, so dividing by zero will never throw an exception because, in C#, floating-point types are based on the IEEE 754 standard, which <a id="_idIndexMarker497" class="pcalibre1 pcalibre calibre6"/>allows for numbers representing infinity and <strong class="bold">Not a </strong><strong class="bold">Number</strong> (<strong class="bold">NaN)</strong>.</p>
<p class="callout"><strong class="bold">Additional </strong><strong class="bold">reading</strong>: <a href="https://docs.microsoft.com/en-us/dotnet/api/system.dividebyzeroexception?view=net-6.0" class="pcalibre1 pcalibre calibre6">https://docs.microsoft.com/en-us/dotnet/api/system.dividebyzeroexception?view=net-6.0</a></p>
<p class="calibre3">Now that we have completed our parallax effect script, let’s add the background layers to the scene and assign the field values.</p>
<p class="calibre3">The <a id="_idIndexMarker498" class="pcalibre1 pcalibre calibre6"/>following <code>ZDepth</code> value of 10,000 – meaning they’ll appear to be stationary – and images closer to the camera having values less than 1,000 – meaning they’ll move more closely to the camera movement:</p>
<div><div><img alt="Figure 4.18 – Parallax background layers assigned to the Inspector" src="img/B18347_04_18.jpg" class="calibre63"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 4.18 – Parallax background layers assigned to the Inspector</p>
<p class="calibre3">The preceding figure also shows an object hierarchy we can use to organize the images for the background layers (and foreground images using the same technique). Drag the background images from <code>Assets/Sprites/Background</code> into the scene and parent the objects in <strong class="bold">Hierarchy</strong> to a <strong class="bold">Background</strong> empty GameObject.</p>
<p class="calibre3">With the objects in the scene, you can position them and use the Sorting Layer and Order in Layer (Sprite Renderer) to set their display. Be sure to add a new <strong class="bold">Background</strong> Sorting Layer and position it at <strong class="bold">Layer 0</strong> so that our platforms’ <strong class="bold">Default</strong> layer will draw in front of the background images.</p>
<p class="calibre3">This is more art than technical so play around with the position and scale, background image order, and so on, until things look good!</p>
<p class="calibre3">Now, add the <code>ZDepth</code> value for each image – assign higher values for the images further in the distance.</p>
<p class="calibre3">You can<a id="_idIndexMarker499" class="pcalibre1 pcalibre calibre6"/> test the parallax effect by entering <code>ZDepth</code> value so that it works within the bounds of your level design.</p>
<p class="calibre3">Let’s continue adding polish to the environment with some clouds animated to move across the sky. This will be super easy by again leveraging the <strong class="bold">Spline </strong><strong class="bold">Animate</strong> component.</p>
<h3 class="calibre10">Animated clouds</h3>
<p class="calibre3">Earlier in this <a id="_idIndexMarker500" class="pcalibre1 pcalibre calibre6"/>chapter, you learned how to easy it is to create a moving platform using a simple spline path and a component to animate its position. We’ll use the same approach to create two layers of different-style clouds moving across the sky at different speeds. The only difference here, compared to the platform, is that the clouds will start off-screen and loop continuously, instead of a ping-pong movement (clouds usually only move in one direction across the sky, after all).</p>
<p class="calibre3">Use the following steps to create two layers of clouds moving across the sky:</p>
<ol class="calibre14">
<li class="calibre15">Add a Spline object to the scene using <code>90</code>, <code>0</code>, <code>0</code>).</li></ol></li>
<li class="calibre15">Add cloud <a id="_idIndexMarker501" class="pcalibre1 pcalibre calibre6"/>sprites to the scene and parent along with the Spline to a new empty GameObject named <code>Clouds 1</code> (you can add as many cloud layers as desired, just increment the count, as shown in <em class="italic">Figure 4</em><em class="italic">.18</em>). We have two cloud layers, and multiple cloud sprites added for the <code>Clouds </code><code>2</code> object.</li>
<li class="calibre15">Add a <strong class="bold">Spline Animate</strong> component to the cloud image GameObject and set the following properties:<ol class="calibre42"><li class="calibre15">Assign the Spline object from <strong class="bold">Hierarchy</strong> to the <strong class="bold">Spline</strong> field.</li><li class="calibre15">Set <strong class="bold">Align To</strong> as <strong class="bold">Spline Object</strong>.</li><li class="calibre15">Set the <strong class="bold">Duration</strong> field to a value that sets the clouds moving slowly across the sky – make sure to set this value to a different time, so multiple cloud layers are offset from one another!</li><li class="calibre15">Set <strong class="bold">Loop Mode</strong> as <strong class="bold">Loop Continuous</strong> because we want the clouds to restart the animation over again on the right side once they reach the end knot on the left side.</li></ol></li>
</ol>
<div><div><img alt="Figure 4.19 – Animated background clouds setup" src="img/B18347_04_19.jpg" class="calibre39"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 4.19 – Animated background clouds setup</p>
<p class="calibre3">This is a<a id="_idIndexMarker502" class="pcalibre1 pcalibre calibre6"/> quick and easy way to bring more life to the environment. The same is true for the next 2D tooling feature we’ll introduce to add more polish.</p>
<h3 class="calibre10">Animated environment art with sprite skin</h3>
<p class="calibre3">Let’s now<a id="_idIndexMarker503" class="pcalibre1 pcalibre calibre6"/> set up some of the plant entity’s vines to sway and move in different ways in the background, giving the player a sense of presence by the unnatural forces at work here.</p>
<p class="calibre3">We’ve already imported and prepared artwork to use with <code>Assets/Sprites/Sprite Skins</code> folder and open <strong class="bold">Sprite Editor</strong>.</p>
<p class="calibre3">Use the following steps to create a mesh geometry that is deformable by a set of weighted bones:</p>
<ol class="calibre14">
<li class="calibre15">From the <strong class="bold">Sprite Editor</strong> dropdown menu, select <strong class="bold">Skinning Editor</strong> and enable the <strong class="bold">Visibility</strong> tool (top-right of the window next to <strong class="bold">Revert </strong><strong class="bold">and Apply</strong>).</li>
<li class="calibre15">Under the <strong class="bold">Bones</strong> section (left side of the window), select the <strong class="bold">Create </strong><strong class="bold">Bone</strong> button.</li>
<li class="calibre15">The<a id="_idIndexMarker504" class="pcalibre1 pcalibre calibre6"/> next step is essential and not apparent in the <strong class="bold">Skinning Editor</strong> workflow – double-click on the sprite!</li>
</ol>
<p class="calibre3">You should now have a cursor with a red dot at the tip. Start creating bones by dragging the bones to the desired length, click to add a new bone, and hit the <em class="italic">Esc</em> key when finished. Refer to <em class="italic">Figure 4</em><em class="italic">.19</em> for an example of how to approach the bones layout (keep in mind that it is more performant to use fewer bones while still allowing for the desired deformation).</p>
<ol class="calibre14">
<li value="4" class="calibre15">When satisfied with the bones, select <strong class="bold">Auto Geometry</strong> under the <strong class="bold">Geometry</strong> section and click the <strong class="bold">Generate For </strong><strong class="bold">Selected</strong> button:</li>
</ol>
<div><div><img alt="Figure 4.20 – Animating a vine with Sprite Skinning" src="img/B18347_04_20.jpg" class="calibre55"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 4.20 – Animating a vine with Sprite Skinning</p>
<ol class="calibre14">
<li value="5" class="calibre15">Lastly, select <strong class="bold">Auto Weights</strong> under the <strong class="bold">Weights</strong> section and click the <strong class="bold">Generate</strong> button (bottom-right corner of the window).</li>
</ol>
<p class="calibre3">At this<a id="_idIndexMarker505" class="pcalibre1 pcalibre calibre6"/> point, click the <strong class="bold">Apply</strong> button, and we have created our first Sprite Skin. Yay, ready for animation! You can test the deformation in <strong class="bold">Skinning Editor</strong> by clicking the <strong class="bold">Preview Pose</strong> button under the <strong class="bold">Pose</strong> section.</p>
<p class="calibre3">Now that our vine is <em class="italic">skinned</em>, it’s ready for animating!</p>
<h4 class="calibre29">Animating a Sprite Skin</h4>
<p class="calibre3">Let’s now<a id="_idIndexMarker506" class="pcalibre1 pcalibre calibre6"/> add the vine sprite to the game environment as a background element and prepare it to be animated:</p>
<ol class="calibre14">
<li class="calibre15">Drag the vine sprite into the <strong class="bold">Scene Hierarchy</strong> as a child of one of your background images (so that it will move along with the background parallax), position, and set the Sorting Layer and Order in Layer accordingly.</li>
<li class="calibre15">With the sprite selected, in the <code>skin</code>.</li>
<li class="calibre15">In the <strong class="bold">Sprite Skin</strong> component, click the <strong class="bold">Create </strong><strong class="bold">Bones</strong> button.</li>
</ol>
<p class="calibre3">Now we need to add animation to the vine. While the vine is selected, open the <code>.anim</code>) that we’ll name <code>Vine 1 Idle</code> and save to the <code>Assets/Animation</code> folder. Put your animator hat on now… because it’s time to animate!</p>
<p class="calibre3">Using <em class="italic">Figure 4</em><em class="italic">.20</em> as a reference, by clicking the red record button (the <strong class="bold">Animation</strong> window), a keyframe will be recorded in the <strong class="bold">Animation</strong> timeline any time you rotate or position a bone (using the same transform tools we manipulate any object with). Scrub the timeline and repeat the process to get the desired movement for the vine.</p>
<p class="calibre3">Again, this is more art than technical and takes some trial and error. With practice, this becomes more intuitive and quicker to achieve good results. Use the playback controls and adjust accordingly – you’ve got this!</p>
<div><div><img alt="Figure 4.21 – Animating the vine with keyframed bone rotation" src="img/B18347_04_21.jpg" class="calibre39"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 4.21 – Animating the vine with keyframed bone rotation</p>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><em class="italic">Animation</em>: <a href="https://docs.unity3d.com/2022.3/Documentation/Manual/AnimationSection.xhtml" class="pcalibre1 pcalibre calibre6">https://docs.unity3d.com/2022.3/Documentation/Manual/AnimationSection.xhtml</a></p>
<p class="calibre3">From the <a id="_idIndexMarker507" class="pcalibre1 pcalibre calibre6"/>static pictures in this book, you can’t get a proper sense of how creepy these vines look when animated! Enter <strong class="bold">Play Mode</strong> to experience this yourself in your level design, or make sure to check out the completed project code or play the game online from the GitHub repo.</p>
<p class="calibre3">Let’s look at how to keep the vine animations performant in our game now.</p>
<h4 class="calibre29">Sprite Skin performance</h4>
<p class="calibre3">As the last step for<a id="_idIndexMarker508" class="pcalibre1 pcalibre calibre6"/> increasing animation performance with Sprite Skin, install the <strong class="bold">Burst</strong> and <strong class="bold">Collections</strong> packages to <a id="_idIndexMarker509" class="pcalibre1 pcalibre calibre6"/>enable <strong class="bold">deformation batching</strong>:</p>
<div><div><img alt="Figure 4.22 – Installing Burst and Collections for optimization" src="img/B18347_04_22.jpg" class="calibre64"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 4.22 – Installing Burst and Collections for optimization</p>
<p class="calibre3">Continuing on the performance optimization topic, before we move on to importing and setting up the player character and enemies for the game, let’s look at optimizing the sprite draw calls to help keep our framerate from dropping to unacceptable levels.</p>
<h2 id="_idParaDest-92" class="calibre8"><a id="_idTextAnchor094" class="pcalibre1 pcalibre calibre6"/>Optimizing draw calls</h2>
<p class="calibre3">The most impactful <a id="_idIndexMarker510" class="pcalibre1 pcalibre calibre6"/>performance optimization we can make is addressing the draw calls. This was discussed briefly in a callout in <a href="B18347_02.xhtml#_idTextAnchor041" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 2</em></a> in the <em class="italic">Importing Sprites</em> section when we <a id="_idIndexMarker511" class="pcalibre1 pcalibre calibre6"/>created a <strong class="bold">Sprite Atlas</strong>. Not surprising, we’re going to do the same thing here now.</p>
<h3 class="calibre10">Sprite Atlas</h3>
<p class="calibre3">Use the <code>Assets/Sprites</code> folder, then choose <code>Sprite Atlas</code>. Note that we won’t be adding any of the 2D sprite normal maps as those will be handled internally with the Sprite Atlas in the same way they are in <strong class="bold">Sprite Editor</strong>.</p>
<p class="calibre3">Assign the individual <a id="_idIndexMarker513" class="pcalibre1 pcalibre calibre6"/>sprite images from the <code>Assets/Sprites</code> folders to the <code>Assets/Sprites/Background </code><code>Normal Maps</code>).</p>
<p class="calibre3">When there are too many images to fit into a single texture, Sprite Atlas will create additional textures and indicate that with a dropdown indicator labeled <strong class="bold">#0</strong> in the title bar of the <strong class="bold">Preview</strong> window. In some cases (for example, larger games), it may be desirable to use multiple Sprite Atlases where you will determine which one to bind at runtime.</p>
<p class="calibre3">Note for compatibility reasons, while using <strong class="bold">Sprite Shape,</strong> we’ll have to make sure to disable both <strong class="bold">Allow Rotation</strong> and <strong class="bold">Tight Packing</strong>.</p>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><em class="italic">Sprite </em><em class="italic">Atlas</em>: <a href="https://docs.unity3d.com/2022.3/Documentation/Manual/class-SpriteAtlas.xhtml" class="pcalibre1 pcalibre calibre6">https://docs.unity3d.com/2022.3/Documentation/Manual/class-SpriteAtlas.xhtml</a></p>
<p class="calibre3">In this section, we <a id="_idIndexMarker514" class="pcalibre1 pcalibre calibre6"/>looked at polishing the visuals of the <em class="italic">Outer World</em> 2D adventure game by adding a parallax background effect and animated elements. We then looked at keeping our game performant by reducing sprite draw calls.</p>
<p class="callout-heading">Downloading the completed game code</p>
<p class="callout">Remember, the example code for this book can be downloaded from the GitHub repo here: <a href="https://github.com/PacktPublishing/Unity-2022-by-Example" class="pcalibre1 pcalibre calibre6">https://github.com/PacktPublishing/Unity-2022-by-Example</a></p>
<h1 id="_idParaDest-93" class="calibre5"><a id="_idTextAnchor095" class="pcalibre1 pcalibre calibre6"/>Summary</h1>
<p class="calibre3">This chapter first covered the game, level, and environment design by introducing new elements for the GDD to cover the larger scope of the adventure game, importing and prepping artwork for use with Unity’s 2D features, and introducing a new level design principle to guide the player to a goal.</p>
<p class="calibre3">We continued with the imported artwork by creating static and moving platforms to challenge players on their journey. Then, we immersed the player in the game world by setting up a parallax background and animated environmental elements.</p>
<p class="calibre3">Finally, we optimized the draw calls for the sprites that define all the elements of the level and environment with a Sprite Atlas.</p>
<p class="calibre3">In the next chapter, we’ll set up the player character with an imported rig using the PSD Importer, which will allow a quick setup of the character for animating. We’ll also learn how to add a player weapon that shoots projectiles in an optimized way by implementing another feature new for Unity 2022, and start introducing the enemy characters the player will be fending off on their journey to the habitat station.</p>
</div>
</div></body></html>