<html><head></head><body>
  <div><h1 class="chapter-number" id="_idParaDest-124">
    <a id="_idTextAnchor124">
    </a>
    
     7
    
   </h1>
   <h1 id="_idParaDest-125">
    <a id="_idTextAnchor125">
    </a>
    
     Machine Learning Integration
    
   </h1>
   <p>
    
     In this chapter, we will embark on an exploration of integrating
    
    <strong class="bold">
     
      machine learning
     
    </strong>
    
     (
    
    <strong class="bold">
     
      ML
     
    </strong>
    
     ) seamlessly
    
    <a id="_idIndexMarker451">
    </a>
    
     into software development workflows using Visual Studio.
    
    
     As we continue to advance in the digital age, the integration of ML capabilities into applications has become increasingly pivotal, enabling intelligent decision-making and automation within our
    
    
     
      software systems.
     
    
   </p>
   <p>
    
     Our journey begins with an introduction to ML, demystifying its core concepts and applications.
    
    
     Next, we will
    
    <a id="_idIndexMarker452">
    </a>
    
     dive into the practical aspects by harnessing the power of
    
    <strong class="bold">
     
      ML.NET
     
    </strong>
    
     and
    
    <strong class="bold">
     
      Model Builder
     
    </strong>
    
     within
    
    <a id="_idIndexMarker453">
    </a>
    
     Visual Studio.
    
    
     Through hands-on examples and guided tutorials, we’ll demonstrate how to create and train ML models directly within the familiar Visual
    
    
     
      Studio environment.
     
    
   </p>
   <p>
    
     As we progress, the focus shifts toward deployment strategies for ML models.
    
    
     We’ll explore how to deploy a trained model within an ASP.NET Core web API, enabling real-time inference and integration with web-based applications.
    
    
     Additionally, we’ll explore deploying models within Azure Functions, leveraging serverless computing for scalable and cost-effective
    
    
     
      deployment scenarios.
     
    
   </p>
   <p>
    
     Key topics covered in this chapter include
    
    
     
      the following:
     
    
   </p>
   <ul>
    <li>
     
      Introduction
     
     
      
       to ML
      
     
    </li>
    <li>
     
      Creating machine learning models with ML.NET and
     
     
      
       Model Builder
      
     
    </li>
    <li>
     
      Deploying models in an ASP.NET Core
     
     
      
       web API
      
     
    </li>
    <li>
     
      Deploying models in
     
     
      
       Azure Functions
      
     
    </li>
   </ul>
   <p>
    
     On this journey, we will unlock the potential of integrating ML into our software projects using Visual Studio, empowering us to build intelligent and adaptive applications that resonate with today’s
    
    
     
      technology landscape.
     
    
   </p>
   <h1 id="_idParaDest-126">
    <a id="_idTextAnchor126">
    </a>
    
     Technical requirements
    
   </h1>
   <p>
    
     I wrote this chapter with the following version of Visual Studio
    
    
     
      in mind:
     
    
   </p>
   <ul>
    <li>
     
      Visual Studio Enterprise 2022
     
     
      
       Version
      
     
     
      
       17.12.0
      
     
    </li>
    <li>
     
      
       Preview 1.0
      
     
    </li>
   </ul>
   <p>
    
     The code files for this chapter can be found
    
    
     
      at
     
    
    <a href="https://github.com/PacktPublishing/Mastering-Visual-Studio-2022/tree/main/ch07">
     
      
       https://github.com/PacktPublishing/Mastering-Visual-Studio-2022/tree/main/ch07
      
     
    </a>
   </p>
   <h1 id="_idParaDest-127">
    <a id="_idTextAnchor127">
    </a>
    
     Introduction to ML
    
   </h1>
   <p>
    <strong class="bold">
     
      ML
     
    </strong>
    
     is a branch of
    
    <strong class="bold">
     
      artificial intelligence
     
    </strong>
    
     (
    
    <strong class="bold">
     
      AI
     
    </strong>
    
     ) focused on developing algorithms and statistical
    
    <a id="_idIndexMarker454">
    </a>
    
     models that enable computers to perform tasks without explicit programming.
    
    
     These tasks can range from basic pattern recognition to
    
    <a id="_idIndexMarker455">
    </a>
    
     complex decision-making processes.
    
    
     At its core, ML involves machines learning from data to improve the algorithms’  performance
    
    
     
      over time.
     
    
   </p>
   <p>
    
     There are three primary types
    
    
     
      of ML:
     
    
   </p>
   <ul>
    <li>
     <strong class="bold">
      
       Supervised learning
      
     </strong>
     
      : This
     
     <a id="_idIndexMarker456">
     </a>
     
      involves training
     
     <a id="_idIndexMarker457">
     </a>
     
      a model on labeled data to predict outputs based on input data, such as regression (predicting continuous values) and classification (predicting
     
     
      
       discrete labels)
      
     
    </li>
    <li>
     <strong class="bold">
      
       Unsupervised learning
      
     </strong>
     
      : This
     
     <a id="_idIndexMarker458">
     </a>
     
      involves training a model on unlabeled data to identify patterns or structures
     
     <a id="_idIndexMarker459">
     </a>
     
      within the dataset, such as clustering (grouping similar data points) and dimensionality reduction (reducing
     
     
      
       input variables)
      
     
    </li>
    <li>
     <strong class="bold">
      
       Reinforcement learning
      
     </strong>
     
      : Models
     
     <a id="_idIndexMarker460">
     </a>
     
      learn to make decisions by interacting with an environment, and receiving
     
     <a id="_idIndexMarker461">
     </a>
     
      feedback in the form of rewards or penalties to maximize the
     
     
      
       cumulative reward
      
     
    </li>
   </ul>
   <p>
    
     ML utilizes
    
    <a id="_idIndexMarker462">
    </a>
    
     various algorithms such as decision trees,
    
    <strong class="bold">
     
      support vector machines
     
    </strong>
    
     (
    
    <strong class="bold">
     
      SVMs
     
    </strong>
    
     ), and neural networks, chosen based on specific problems, data characteristics, and
    
    
     
      desired outcomes.
     
    
   </p>
   <p>
    
     ML.NET, an open source, cross-platform ML framework by Microsoft, simplifies ML for .NET developers, enabling the integration of ML capabilities into applications without requiring deep expertise in ML or
    
    
     
      data science.
     
    
   </p>
   <p>
    
     Key features
    
    <a id="_idIndexMarker463">
    </a>
    
     of ML.NET include
    
    
     
      the following:
     
    
   </p>
   <ul>
    <li>
     <strong class="bold">
      
       Cross-platform compatibility
      
     </strong>
     
      : It works seamlessly on Windows, Linux,
     
     
      
       and macOS
      
     
    </li>
    <li>
     <strong class="bold">
      
       Integration with .NET
      
     </strong>
     
      : It easily incorporates ML capabilities into .
     
     
      
       NET projects
      
     
    </li>
    <li>
     <strong class="bold">
      
       Customizable models
      
     </strong>
     
      : Developers can tailor models to their needs, including training on
     
     
      
       custom datasets
      
     
    </li>
    <li>
     <strong class="bold">
      
       Transparency and explainability
      
     </strong>
     
      : It provides tools for understanding how models make predictions, essential for building trust
     
     
      
       in AI
      
     
    </li>
    <li>
     <strong class="bold">
      
       Open source and community-driven
      
     </strong>
     
      : It benefits from community contributions, leading to ongoing improvements and
     
     
      
       new features
      
     
    </li>
   </ul>
   <p>
    <strong class="bold">
     
      ML.NET
     
    </strong>
    
     is a versatile
    
    <a id="_idIndexMarker464">
    </a>
    
     framework that simplifies the integration of ML capabilities into .NET applications.
    
    
     Features
    
    <a id="_idIndexMarker465">
    </a>
    
     such as
    
    <strong class="bold">
     
      automated ML
     
    </strong>
    
     (
    
    <strong class="bold">
     
      AutoML
     
    </strong>
    
     ) and tools
    
    <a id="_idIndexMarker466">
    </a>
    
     such as ML.NET CLI and Model Builder make
    
    <a id="_idIndexMarker467">
    </a>
    
     the process straightforward, even for developers without extensive data science experience.
    
    
     It supports cross-platform development and seamlessly integrates with popular Python libraries such as TensorFlow and ONNX
    
    
     
      through NimbusML.
     
    
   </p>
   <p>
    
     The Model Builder tool within ML.NET streamlines model creation with AutoML, enabling developers to deploy models swiftly by loading their data.
    
    
     This tool automates the entire model-building process, including code generation for consuming these models.
    
    
     Combined with its flexibility to leverage existing ML libraries, ML.NET offers a robust solution for .NET developers seeking to incorporate ML into
    
    
     
      their applications.
     
    
   </p>
   <p>
    
     Now, let’s dive
    
    <a id="_idIndexMarker468">
    </a>
    
     into creating an ML model using ML.NET and the intuitive Model Builder
    
    <strong class="bold">
     
      user
     
    </strong>
    
     <strong class="bold">
      
       interface
      
     </strong>
    
    
     
      (
     
    
    
     <strong class="bold">
      
       UI
      
     </strong>
    
    
     
      ).
     
    
   </p>
   <h1 id="_idParaDest-128">
    <a id="_idTextAnchor128">
    </a>
    
     Creating an ML model with ML.NET and the Model 
Builder UI
    
   </h1>
   <p>
    
     Initially introduced as a preview feature in Visual Studio 2019, Model Builder has transitioned to a stable feature as of 2022.
    
    
     In this section, we will explore how to use Model
    
    <a id="_idIndexMarker469">
    </a>
    
     Builder to create an ML model
    
    
     
      with ML.NET.
     
    
   </p>
   <p>
    
     First, let’s
    
    <a id="_idIndexMarker470">
    </a>
    
     ensure that the Model Builder component is installed correctly in our instance of Visual Studio.
    
    
     To
    
    <a id="_idIndexMarker471">
    </a>
    
     do so, we open
    
    <a id="_idIndexMarker472">
    </a>
    
     the Visual Studio Installer and confirm that ML.NET Model Builder is selected under the
    
    <strong class="bold">
     
      Individual
     
    </strong>
    
     <strong class="bold">
      
       components
      
     </strong>
    
    
     
      tab:
     
    
   </p>
   <div><div><img alt="Figure 7.1 – Installer – ML.NET Model Builder" src="img/B22218_07_1.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 7.1 – Installer – ML.NET Model Builder
    
   </p>
   <p>
    
     Then, we can create a new empty console project as a foundation for supporting our ML process.
    
    
     Now, we are all set, and we can create our ML.NET by using the file-adding menu by right-clicking on the project and selecting
    
    <strong class="bold">
     
      Add
     
    </strong>
    
     |
    
    <strong class="bold">
     
      Machine
     
    </strong>
    
     <strong class="bold">
      
       Learning Model…
      
     </strong>
    
    
     
      :
     
    
   </p>
   <div><div><img alt="Figure 7.2 – Add an ML model" src="img/B22218_07_2.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 7.2 – Add an ML model
    
   </p>
   <p>
    
     The
    
    <a id="_idIndexMarker473">
    </a>
    
     preceding action will initiate
    
    <a id="_idIndexMarker474">
    </a>
    
     the
    
    <strong class="source-inline">
     
      .mbconfig
     
    </strong>
    
     file.
    
    
     This
    
    <a id="_idIndexMarker475">
    </a>
    
     file is a JSON
    
    <a id="_idIndexMarker476">
    </a>
    
     file that keeps track of the state of the UI, including the model’s configuration, data transforms, algorithm, and settings such as learning rate, number of layers, and number
    
    
     
      of neurons.
     
    
   </p>
   <p>
    
     The first step prompted by Model Builder, after choosing a name for the
    
    <strong class="source-inline">
     
      .mbconfig
     
    </strong>
    
     file, is to select a
    
    <strong class="bold">
     
      Scenario
     
    </strong>
    
     option for our
    
    
     
      ML model.
     
    
   </p>
   <div><div><img alt="Figure 7.3 – Configuring .mbconfig" src="img/B22218_07_3.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 7.3 – Configuring .mbconfig
    
   </p>
   <p>
    
     The
    
    <a id="_idIndexMarker477">
    </a>
    
     selection window of Model
    
    <a id="_idIndexMarker478">
    </a>
    
     Builder offers several
    
    <a id="_idIndexMarker479">
    </a>
    
     scenarios
    
    <a id="_idIndexMarker480">
    </a>
    
     organized into three
    
    
     
      main categories:
     
    
   </p>
   <ul>
    <li>
     <strong class="bold">
      
       Tabular
      
     </strong>
     
      : This
     
     <a id="_idIndexMarker481">
     </a>
     
      category includes scenarios for tasks such as regression, classification, and clustering, where the data is organized in a
     
     
      
       tabular format
      
     
    </li>
   </ul>
   <p class="IMG---Figure">
   </p>
   <div><div><img alt="Figure 7.4 – Tabular" src="img/B22218_07_4.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 7.4 – Tabular
    
   </p>
   <ul>
    <li>
     <strong class="bold">
      
       Computer Vision
      
     </strong>
     
      : This
     
     <a id="_idIndexMarker482">
     </a>
     
      category encompasses scenarios related to image classification, object detection, and other computer
     
     
      
       vision tasks
      
     
    </li>
   </ul>
   <div><div><img alt="Figure 7.5 –  Computer Vision" src="img/B22218_07_5.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 7.5 –  Computer Vision
    
   </p>
   <ul>
    <li>
     <strong class="bold">
      
       Natural Language Processing
      
     </strong>
     
      : This category includes scenarios for natural language
     
     <a id="_idIndexMarker483">
     </a>
     
      processing tasks, such as sentiment analysis, text classification, and
     
     
      
       language translation
      
     
    </li>
   </ul>
   <div><div><img alt="Figure 7.6 – Natural Language Processing" src="img/B22218_07_6.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 7.6 – Natural Language Processing
    
   </p>
   <p>
    
     In our example, we will choose the
    
    <strong class="bold">
     
      Data Classification
     
    </strong>
    
     scenario under the
    
    
     <strong class="bold">
      
       Tabular
      
     </strong>
    
    
     
      category.
     
    
   </p>
   <p>
    
     The second step is to select the training environment.
    
    
     We have the option to train our ML
    
    <a id="_idIndexMarker484">
    </a>
    
     model either
    
    <a id="_idIndexMarker485">
    </a>
    
     locally on our machines or in the cloud on Azure, depending on the situation.
    
    
     When we train locally, we
    
    <a id="_idIndexMarker486">
    </a>
    
     operate within the
    
    <a id="_idIndexMarker487">
    </a>
    
     limitations of our computer resources (CPU, memory, and disk).
    
    
     However, when we train in the cloud, we can scale up our resources to address the requirements of our scenario, particularly for handling large datasets.
    
    
     Notice that the availability of the environment depends on the scenario we choose.
    
    
     Here’s a table of the current
    
    
     
      availability combination:
     
    
   </p>
   <table class="No-Table-Style" id="table001-1">
    <colgroup>
     <col/>
     <col/>
     <col/>
     <col/>
    </colgroup>
    <tbody>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        
         <strong class="bold">
          
           Scenario
          
         </strong>
        
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        
         <strong class="bold">
          
           Local CPU
          
         </strong>
        
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        
         <strong class="bold">
          
           Local GPU
          
         </strong>
        
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        
         <strong class="bold">
          
           Azure
          
         </strong>
        
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        
         
          Data classification
         
        
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         
          ✔️
         
        </strong>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         
          ❌
         
        </strong>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         
          ❌
         
        </strong>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        
         
          Value prediction
         
        
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         
          ✔️
         
        </strong>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         
          ❌
         
        </strong>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         
          ❌
         
        </strong>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        
         
          Recommendation
         
        
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         
          ✔️
         
        </strong>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         
          ❌
         
        </strong>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         
          ❌
         
        </strong>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        
         
          Forecasting
         
        
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         
          ✔️
         
        </strong>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         
          ❌
         
        </strong>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         
          ❌
         
        </strong>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        
         
          Image classification
         
        
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         
          ✔️
         
        </strong>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         
          ✔️
         
        </strong>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         
          ✔️
         
        </strong>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        
         
          Object detection
         
        
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         
          ❌
         
        </strong>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         
          ❌
         
        </strong>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         
          ✔️
         
        </strong>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        
         
          Text classification
         
        
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         
          ✔️
         
        </strong>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         
          ✔️
         
        </strong>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         
          ❌
         
        </strong>
       </p>
      </td>
     </tr>
    </tbody>
   </table>
   <p>
    
     Now that we have chosen our scenario and training environment, we must gather the data that will be used for training.
    
    
     Model Builder will guide us through the process according to our selected scenario, helping us upload
    
    
     
      the data.
     
    
   </p>
   <p>
    
     Finally, we can launch the training of our ML model.
    
    
     We can set a specific time for training to begin.
    
    
     Model Builder automatically chooses a training time based on our
    
    
     
      dataset size.
     
    
   </p>
   <div><div><img alt="Figure 7.7 –Train" src="img/B22218_07_7.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 7.7 –Train
    
   </p>
   <p>
    
     During
    
    <a id="_idIndexMarker488">
    </a>
    
     the
    
    <strong class="bold">
     
      Evaluate
     
    </strong>
    
     step, we’ll
    
    <a id="_idIndexMarker489">
    </a>
    
     discover
    
    <a id="_idIndexMarker490">
    </a>
    
     the best-performing
    
    <a id="_idIndexMarker491">
    </a>
    
     algorithm and its highest accuracy, providing valuable insights into our model’s performance.
    
    
     This step also enables us to experiment with the model directly within
    
    
     
      the UI.
     
    
   </p>
   <p>
    
     In the
    
    <strong class="bold">
     
      Try your model
     
    </strong>
    
     section, we can input sample data to generate predictions.
    
    
     The textbox comes pre-filled with the first line of data from our dataset, but we have the flexibility to modify the input and click the
    
    <strong class="bold">
     
      Predict
     
    </strong>
    
     button to observe different
    
    
     
      price predictions.
     
    
   </p>
   <div><div><img alt="Figure 7.8 – Evaluate" src="img/B22218_07_8.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 7.8 – Evaluate
    
   </p>
   <p>
    
     The
    
    <a id="_idIndexMarker492">
    </a>
    
     last panel of Model
    
    <a id="_idIndexMarker493">
    </a>
    
     Builder is about consuming
    
    <a id="_idIndexMarker494">
    </a>
    
     the model we just
    
    <a id="_idIndexMarker495">
    </a>
    
     created.
    
    
     Let’s explore how we can integrate our model into a web API using
    
    
     
      Visual Studio.
     
    
   </p>
   <h1 id="_idParaDest-129">
    <a id="_idTextAnchor129">
    </a>
    
     Deploying a model in an ASP.NET Core web API
    
   </h1>
   <p>
    
     In this
    
    <a id="_idIndexMarker496">
    </a>
    
     section, we will learn how
    
    <a id="_idIndexMarker497">
    </a>
    
     to integrate our ML.NET model into an existing web API.
    
    
     To do so, we will jump to the
    
    <strong class="bold">
     
      Consume
     
    </strong>
    
     panel of
    
    
     
      Model Builder.
     
    
   </p>
   <div><div><img alt="Figure 7.9 – Consume" src="img/B22218_07_9.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 7.9 – Consume
    
   </p>
   <p>
    
     The
    
    <strong class="bold">
     
      Consume
     
    </strong>
    
     panel within
    
    <a id="_idIndexMarker498">
    </a>
    
     Model Builder is a critical tool for integrating our trained ML models into .NET applications.
    
    
     Once we’ve completed the evaluation
    
    <a id="_idIndexMarker499">
    </a>
    
     phase, Model Builder
    
    <a id="_idIndexMarker500">
    </a>
    
     generates a model file and the necessary code to incorporate the model into our application.
    
    
     These models are saved as a
    
    <strong class="source-inline">
     
      .zip
     
    </strong>
    
     file, and the code to load and use our model is added as a new project within our solution.
    
    
     Additionally, Model Builder provides a sample console application that we can run to see our model
    
    
     
      in action.
     
    
   </p>
   <p>
    
     The
    
    <strong class="bold">
     
      Consume
     
    </strong>
    
     panel gives us options to create projects that consume our model, such as
    
    
     
      the following:
     
    
   </p>
   <ul>
    <li>
     <strong class="bold">
      
       Console app
      
     </strong>
     
      : Generates
     
     <a id="_idIndexMarker501">
     </a>
     
      a .NET console application specifically for making predictions using
     
     
      
       our model
      
     
    </li>
    <li>
     <strong class="bold">
      
       Web API
      
     </strong>
     
      : Sets up
     
     <a id="_idIndexMarker502">
     </a>
     
      an ASP.NET Core web API, allowing us to consume our model over
     
     
      
       the internet
      
     
    </li>
   </ul>
   <p>
    
     These projects are crucial for deploying our model in various environments, whether for local testing or web-based applications
    
    
     
      accessible online.
     
    
   </p>
   <p>
    
     Let’s click on the
    
    <strong class="bold">
     
      Add web app to the solution
     
    </strong>
    
     link to create the new ASP.NET Core web API exposing our model.
    
    
     That will set up a working web API, enabling us to expose the model we just trained, using the minimal
    
    
     
      API way.
     
    
   </p>
   <p>
    
     Now, to
    
    <a id="_idIndexMarker503">
    </a>
    
     understand how it’s articulate, we
    
    <a id="_idIndexMarker504">
    </a>
    
     will take a look at what the wizard generates for us.
    
    
     Let’s explore the
    
    
     
      project structure:
     
    
   </p>
   <div><div><img alt="Figure 7.10 – Generating a web API project structure" src="img/B22218_07_10.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 7.10 – Generating a web API project structure
    
   </p>
   <p>
    
     The template utilizes the following packages to make ML.NET models accessible
    
    
     
      for ML:
     
    
   </p>
   <ul>
    <li>
     
      <strong class="source-inline">
       
        Microsoft.ML
       
      </strong>
     
    </li>
    <li>
     
      <strong class="source-inline">
       
        Microsoft.Extensions.ML
       
      </strong>
     
    </li>
   </ul>
   <p>
    
     Among these libraries, in the
    
    <strong class="source-inline">
     
      Program.cs
     
    </strong>
    
     file, we observe that Visual Studio generates a POST request.
    
    
     Here’s the
    
    
     
      code snippet:
     
    
   </p>
   <pre class="source-code">
app.MapPost("/predict",
    async (PredictionEnginePool&lt;SampleML.ModelInput,
           SampleML.ModelOutput&gt; predictionEnginePool,
           SampleML.ModelInput input) =&gt;
        await Task.FromResult(
            predictionEnginePool.Predict(input)
        )
);</pre>
   <p>
    
     This
    
    <a id="_idIndexMarker505">
    </a>
    
     code snippet uses the models
    
    <a id="_idIndexMarker506">
    </a>
    
     generated by the model builder to set up an HTTP POST
    
    <strong class="source-inline">
     
      endpoint /predict
     
    </strong>
    
     in an ASP.NET Core minimal
    
    
     
      API application.
     
    
   </p>
   <p>
    
     This is possible because of the following lines
    
    
     
      of code:
     
    
   </p>
   <pre class="source-code">
builder.Services
    .AddPredictionEnginePool&lt;SampleML.ModelInput,
        SampleML.ModelOutput&gt;()
    .FromFile("SampleML.mlnet");</pre>
   <p>
    
     This code is configuring an ASP.NET Core application to use an ML model stored in a file named
    
    <strong class="source-inline">
     
      SampleML.mlnet
     
    </strong>
    
     for making predictions.
    
    
     The model expects inputs of the
    
    <strong class="source-inline">
     
      SampleML.ModelInput
     
    </strong>
    
     type and produces outputs of the
    
    <strong class="source-inline">
     
      SampleML.ModelOutput
     
    </strong>
    
     type.
    
    
     This setup allows the application to efficiently manage and reuse the ML model across different parts of
    
    
     
      the application.
     
    
   </p>
   <p>
    
     Now, we can test the endpoints using the endpoints explorer and
    
    <strong class="source-inline">
     
      .http
     
    </strong>
    
     file, as we saw in
    
    <a href="B22218_06.xhtml#_idTextAnchor112">
     
      <em class="italic">
       
        Chapter 6
       
      </em>
     
    </a>
    
     .
    
    
     Since the HTTP verb used for this endpoint is
    
    <strong class="source-inline">
     
      POST
     
    </strong>
    
     , we have to add a body to
    
    
     
      our request.
     
    
   </p>
   <p>
    
     Here’s the proper syntax to set up our working request in the
    
    <strong class="source-inline">
     
      .
     
    </strong>
    
     <strong class="source-inline">
      
       http
      
     </strong>
    
    
     
      file:
     
    
   </p>
   <pre class="source-code">
@SampleML_WebApi_HostAddress = https://localhost:63555
POST {{SampleML_WebApi_HostAddress}}/predict
Content-Type: application/json
{
    "Month": "2-Jan"
}</pre>
   <p>
    
     Now, we
    
    <a id="_idIndexMarker507">
    </a>
    
     can validate that we own
    
    <a id="_idIndexMarker508">
    </a>
    
     a web API able to consume our model generated by Model Builder.
    
    
     This web API can be seamlessly deployed like any other API in the .
    
    
     
      NET ecosystem.
     
    
   </p>
   <p>
    
     There is another way to consume our generated ML model, and that is to consume it through
    
    
     
      Azure Functions.
     
    
   </p>
   <h1 id="_idParaDest-130">
    <a id="_idTextAnchor130">
    </a>
    
     Deploying a model in Azure Functions
    
   </h1>
   <p>
    
     In this section, we will learn how to integrate the ML model generated by Model Builder into
    
    <a id="_idIndexMarker509">
    </a>
    
     Azure Functions.
    
    
     This
    
    <a id="_idIndexMarker510">
    </a>
    
     process will be less straightforward as no template
    
    
     
      is provided.
     
    
   </p>
   <p>
    <strong class="bold">
     
      Azure Functions
     
    </strong>
    
     is a
    
    <a id="_idIndexMarker511">
    </a>
    
     serverless computing service offered by Microsoft Azure.
    
    
     Serverless computing is a cloud computing execution model where the cloud provider runs the server, and dynamically manages the allocation of machine resources.
    
    
     Pricing is based on the actual number of resources consumed by an application, rather than pre-purchased units
    
    
     
      of capacity.
     
    
   </p>
   <p>
    
     First, we need to ensure that the Azure development workload is well installed in our Visual Studio instance by navigating to the Visual
    
    
     
      Studio Installer.
     
    
   </p>
   <div><div><img alt="Figure 7.11 – Azure development workload" src="img/B22218_07_11.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 7.11 – Azure development workload
    
   </p>
   <p>
    
     Once
    
    <a id="_idIndexMarker512">
    </a>
    
     the workload
    
    <a id="_idIndexMarker513">
    </a>
    
     is installed, we can start by creating a new Azure Functions project, for example, we will name it
    
    <strong class="source-inline">
     
      SampleML_AzureFunction
     
    </strong>
    
     , and we will keep all parameters
    
    
     
      by default.
     
    
   </p>
   <div><div><img alt="Figure 7.12 – Azure Functions project" src="img/B22218_07_12.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 7.12 – Azure Functions project
    
   </p>
   <p>
    
     This time, we need to add both libraries by ourselves, as seen in the previous section, using the NuGet Manager.
    
    
     We will open the NuGet Manager by right-clicking on the project name, selecting
    
    <strong class="bold">
     
      Manage NuGet Packages…
     
    </strong>
    
     , and then browsing for our needed libraries, to finally
    
    
     
      install them:
     
    
   </p>
   <ul>
    <li>
     
      <strong class="source-inline">
       
        Microsoft.ML
       
      </strong>
     
    </li>
    <li>
     
      <strong class="source-inline">
       
        Microsoft.Extension.ML
       
      </strong>
     
    </li>
   </ul>
   <p>
    
     Now, to be able to use our pre-trained model, all we need to do is copy the
    
    <strong class="source-inline">
     
      .mbconfig
     
    </strong>
    
     file to Azure Functions.
    
    
     After that, to be sure you can access the
    
    <strong class="source-inline">
     
      .mlnet
     
    </strong>
    
     package after compiling, we need to set the
    
    <strong class="bold">
     
      Copy to Output Directory
     
    </strong>
    
     properties to
    
    <strong class="bold">
     
      Copy
     
    </strong>
    
     <strong class="bold">
      
       if newer
      
     </strong>
    
    
     
      .
     
    
   </p>
   <div><div><img alt="Figure 7.13 – The SampleML.Net properties" src="img/B22218_07_13.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 7.13 – The SampleML.Net properties
    
   </p>
   <p>
    
     Once
    
    <a id="_idIndexMarker514">
    </a>
    
     we are all set, we
    
    <a id="_idIndexMarker515">
    </a>
    
     can develop our function following these
    
    
     
      simple steps:
     
    
   </p>
   <ol>
    <li>
     
      Add
     
     <strong class="source-inline">
      
       startup.cs
      
     </strong>
     
      to configure our Azure Functions project to
     
     
      
       use
      
     
     
      <strong class="source-inline">
       
        SampleML.mlnet
       
      </strong>
     
     
      
       :
      
     
     <pre class="source-code">
[assembly: FunctionsStartup(typeof(Startup))]
namespace SampleML_AzureFunction;
public class Startup : FunctionsStartup
{
    public override void Configure(
        IFunctionsHostBuilder builder)
    {
        builder.Services
            .AddPredictionEnginePool&lt;
                SampleML.ModelInput,
                SampleML.ModelOutput&gt;()
            .FromFile("SampleML.mlnet");
    }
}</pre>
    </li>
    <li>
     
      Call
     
     <a id="_idIndexMarker516">
     </a>
     
      the
     
     <strong class="source-inline">
      
       predict
      
     </strong>
     
      method
     
     <a id="_idIndexMarker517">
     </a>
     
      of the ML.NET package in the Azure’s
     
     
      <strong class="source-inline">
       
        run
       
      </strong>
     
     
      
       method:
      
     
     <pre class="source-code">
    public class FunctionML
    {
        private PredictionEnginePool&lt;
            SampleML.ModelInput, SampleML.ModelOutput&gt;
            _predictionEnginePool;
        public FunctionML(
            PredictionEnginePool&lt;SampleML.ModelInput,
                SampleML.ModelOutput&gt;
            predictionEnginePool)
        {
            _predictionEnginePool =
                predictionEnginePool;
        }
        [FunctionName("FunctionML")]
        public async Task&lt;IActionResult&gt; Run(
            [HttpTrigger(
                AuthorizationLevel.Anonymous,
                "post",
                Route = null)] HttpRequest req)
        {
            string requestBody = await new
                StreamReader(req.Body)
                .ReadToEndAsync();
            SampleML.ModelInput input = JsonConvert
                .DeserializeObject&lt;
                    SampleML.ModelInput&gt;(
                requestBody);
            SampleML.ModelOutput responseMessage =
                await Task.FromResult(
                    _predictionEnginePool
                        .Predict(input));
            return new OkObjectResult(
                responseMessage);
        }
    }</pre>
    </li>
   </ol>
   <p>
    
     Finally, we can test the Azure function using the Endpoints Explorer and
    
    <strong class="source-inline">
     
      .http
     
    </strong>
    
     , like how you tested the web API in the
    
    
     
      previous section.
     
    
   </p>
   <h1 id="_idParaDest-131">
    <a id="_idTextAnchor131">
    </a>
    
     Summary
    
   </h1>
   <p>
    
     In this chapter, we explored the integration of ML capabilities into software development workflows using Visual Studio, equipping developers with essential skills to leverage intelligent decision-making
    
    
     
      within applications.
     
    
   </p>
   <p>
    
     We began by introducing the fundamental concepts of ML, providing an overview to understand its applications and significance in modern software development.
    
    
     Next, we delved into practical implementation by demonstrating how to create and train ML models using ML.NET and Model Builder within Visual Studio.
    
    
     Moving forward, we explored deployment strategies for trained models, showcasing how to deploy ML models within an ASP.NET Core web API for real-time inference and integration with web applications.
    
    
     Additionally, we discussed deploying models within Azure Functions to leverage serverless computing for scalable and efficient
    
    
     
      deployment scenarios.
     
    
   </p>
   <p>
    
     In this chapter, you gained hands-on experience in building, training, and deploying ML models using Visual Studio, enabling you to infuse intelligent capabilities into
    
    
     
      your applications.
     
    
   </p>
   <p>
    
     In the upcoming chapter, we’ll continue on track toward advanced cloud integration and services through Visual
    
    
     
      Studio 2022.
     
    
   </p>
  </div>
 </body></html>