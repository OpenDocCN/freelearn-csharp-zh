<html><head></head><body>
		<div id="_idContainer108">
			<h1 id="_idParaDest-102" class="chapter-number"><a id="_idTextAnchor105"/>7</h1>
			<h1 id="_idParaDest-103"><a id="_idTextAnchor106"/>Interactive CLI Applications</h1>
			<p>So far, the interaction with our CLI application (<em class="italic">Bookmarkr</em>) has mostly been text-based, meaning that the application responds to a text input with a text output. In a sense, it was mostly a request-response kind <span class="No-Break">of application.</span></p>
			<p>Yes, weâ€™ve also added some colors to the text output so that the user can easily and instantly know whether the request was processed successfully or it ended with errors <span class="No-Break">or warnings.</span></p>
			<p>However, even though CLI applications donâ€™t provide a <strong class="bold">graphical user interface</strong> (<strong class="bold">GUI</strong>), that doesnâ€™t mean they canâ€™t be fun to <span class="No-Break">use! </span><span class="No-Break">ðŸ˜‰</span></p>
			<p>In this chapter, weâ€™ll learn how to enhance the output of our CLI application to make it more user-friendly. Weâ€™ll learn how to add the <span class="No-Break">following elements:</span></p>
			<ul>
				<li>Progress bars and checkmarks to let the user know of the progress of their request. This is especially useful for time-consuming, long-running operations (such as downloading or encoding <span class="No-Break">a file).</span></li>
				<li>Lists of items to make it easier to pick a selection from a list of predefined items. Note that this list doesnâ€™t have to be static; it can dynamically adapt to the current context of the user (for example, their permissions) and the request (for example, the requested command and the values of <span class="No-Break">its options).</span></li>
			</ul>
			<p>By relying on such enhancements, not only are we making our CLI application more fun to use, but weâ€™re also making it more <strong class="bold">interactive</strong> as it can have a conversation with the user, keeping them updated on the progress of their operations or presenting them with a list of options to choose from that are tailored to their <span class="No-Break">specific context.</span></p>
			<h1 id="_idParaDest-104"><a id="_idTextAnchor107"/>Technical requirements</h1>
			<p>The code for this chapter can be found in the GitHub repository accompanying this <span class="No-Break">book, </span><a href="https://github.com/PacktPublishing/Building-CLI-Applications-with-C-Sharp-and-.NET/tree/main/Chapter07"><span class="No-Break">https://github.com/PacktPublishing/Building-CLI-Applications-with-C-Sharp-and-.NET/tree/main/Chapter07</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-105"><a id="_idTextAnchor108"/>Building interactive command-line applications</h1>
			<p>As you <a id="_idIndexMarker203"/>may have noticed â€“ and Iâ€™m sure that you did ðŸ˜‰ â€“ weâ€™ve already created some helper methods to display text in different colors for different scenarios: green for success messages, yellow for warnings, and red for errors. The code for these helper methods can be found in the <span class="No-Break"><strong class="source-inline">Helper.cs</strong></span><span class="No-Break"> file.</span></p>
			<p>We <a id="_idIndexMarker204"/>could certainly add more methods to this file to support other features, such as progress bars and drop-down lists. However, as I mentioned earlier, I trust that youâ€™re smart, so you wonâ€™t want to reinvent the wheel and rather rely on an existing library that fits the <span class="No-Break">job </span><span class="No-Break">ðŸ˜Š</span><span class="No-Break">.</span></p>
			<p>Although multiple libraries may exist to fit this purpose, the one weâ€™ll be using in this chapter <span class="No-Break">is </span><span class="No-Break"><strong class="source-inline">Spectre.Console</strong></span><span class="No-Break">.</span></p>
			<p>The <strong class="source-inline">Spectre.Console</strong> library <a id="_idIndexMarker205"/>is designed to enhance the creation of visually appealing console applications by going way beyond colored text. It also allows you to render trees, drop-down lists, tables, progress bars, and many other <span class="No-Break">graphical elements.</span></p>
			<p>This wide range of features allows us to create rich user interfaces within the console environment of our <span class="No-Break">CLI applications.</span></p>
			<p>For more details about <strong class="source-inline">Spectre.Console</strong>, you can visit <a id="_idIndexMarker206"/>its GitHub page at <a href="https://github.com/spectreconsole/spectre.console">https://github.com/spectreconsole/spectre.console</a>. In particular, I recommend checking out the two <span class="No-Break">following repositories:</span></p>
			<ul>
				<li><strong class="source-inline">spectre.console</strong>: The official repository of the project, which means it contains the code of <span class="No-Break">the library</span></li>
				<li><strong class="source-inline">Examples</strong>: This repository contains various examples of using <span class="No-Break">the library</span></li>
			</ul>
			<p>So, letâ€™s start by adding the <strong class="source-inline">Spectre.Console</strong> library to our application. This can be achieved with the <span class="No-Break">following command:</span></p>
			<pre class="console">
dotnet add package Spectre.Console</pre>			<p>Letâ€™s start by adding a new command that weâ€™ll call <strong class="source-inline">interactive</strong>. This command will be a child of the <strong class="source-inline">root</strong> command. Letâ€™s also add a handler for <span class="No-Break">the command:</span></p>
			<pre class="source-code">
var interactiveCommand = new Command("interactive", "Manage bookmarks interactively")
{
};
rootCommand.AddCommand(interactiveCommand);
interactiveCommand.SetHandler(OnInteractiveCommand);</pre>			<p>Letâ€™s add the handler method for this <span class="No-Break">new command:</span></p>
			<pre class="source-code">
static void OnInteractiveCommand()
{
}</pre>			<p>Since we are <a id="_idIndexMarker207"/>using the <strong class="source-inline">Spectre.Console</strong> library, letâ€™s <span class="No-Break">reference it:</span></p>
			<pre class="source-code">
using Spectre.Console;</pre>			<h2 id="_idParaDest-106"><a id="_idTextAnchor109"/>Adding a FIGlet</h2>
			<p>A FIGlet is a <a id="_idIndexMarker208"/>way to generate large text banners using ordinary screen characters, in the form of ASCII art. Originally released in 1991, it became popular for creating eye-catching text in terminal sessions. So, itâ€™s perfect for making our CLI applications <span class="No-Break">more user-friendly!</span></p>
			<p>So, letâ€™s <a id="_idIndexMarker209"/>add a <a id="_idIndexMarker210"/>FIGlet <span class="No-Break">to </span><span class="No-Break"><em class="italic">Bookmarkr</em></span><span class="No-Break">!</span></p>
			<p>We donâ€™t need to create the ASCII art ourselves since <strong class="source-inline">Spectre.Console</strong> already<strong class="source-inline"> </strong>provides this capability. So, letâ€™s take advantage <span class="No-Break">of it.</span></p>
			<p>Letâ€™s update our command handler method, <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
static void OnInteractiveCommand()
{
Â Â Â Â AnsiConsole.Write(new FigletText("Bookmarkr").Centered().
Â Â Â Â Color(Color.SteelBlue));
}</pre>			<p>The preceding code creates some FIGlet text, centers it, and displays it in a shade <span class="No-Break">of blue.</span></p>
			<p>Now, letâ€™s run the application and see what weâ€™ve got <span class="No-Break">so far:</span></p>
			<pre class="console">
dotnet run -- interactive</pre>			<p>We should be presented with the <span class="No-Break">following output:</span></p>
			<div>
				<div id="_idContainer101" class="IMG---Figure">
					<img src="image/B22400_07_01.jpg" alt="Figure 7.1 â€“ A FIGlet for Bookmarkr"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.1 â€“ A FIGlet for Bookmarkr</p>
			<p>Wow! This <a id="_idIndexMarker211"/>is awesome. This is a great start for our interactive <a id="_idIndexMarker212"/>CLI application, isnâ€™t <span class="No-Break">it? </span><span class="No-Break">ðŸ˜Š</span></p>
			<p class="callout-heading">AnsiConsole versus Console</p>
			<p class="callout">As you may have noticed, we arenâ€™t using the <strong class="source-inline">Console.Write</strong> method provided by .NET but the one provided by <a id="_idIndexMarker213"/>the <strong class="source-inline">AnsiConsole</strong> class, which is part of the <strong class="source-inline">Spectre.Console</strong> library. This is due to the <span class="No-Break">following reasons:</span></p>
			<p class="callout">1. <strong class="bold">Enhanced functionality</strong>: The <strong class="source-inline">AnsiConsole</strong> class provides a much richer set of features compared to <a id="_idIndexMarker214"/>the <strong class="source-inline">Console</strong> class, such as advanced text formatting, colors, styles, and <span class="No-Break">interactive elements.</span></p>
			<p class="callout">2. <strong class="bold">Cross-platform compatibility</strong>: The <strong class="source-inline">AnsiConsole</strong> class is designed to work consistently across different <a id="_idIndexMarker215"/>operating systems and terminal emulators. It automatically detects the capabilities of the current terminal and adjusts its <span class="No-Break">output accordingly.</span></p>
			<p class="callout">3. <strong class="bold">Improved rendering capabilities</strong>: The <strong class="source-inline">AnsiConsole</strong> class offers support for 24-bit colors, text styling (such as bold and italic), and various <a id="_idIndexMarker216"/>widgets, such as tables, trees, and even <span class="No-Break">ASCII images.</span></p>
			<p class="callout">4. <strong class="bold">Interactive elements</strong>: The <strong class="source-inline">AnsiConsole</strong> class enables the creation of interactive prompts, selection menus, and other user <a id="_idIndexMarker217"/>input mechanisms that are more sophisticated than whatâ€™s possible with the standard <span class="No-Break"><strong class="source-inline">Console</strong></span><span class="No-Break"> class.</span></p>
			<p class="callout">5. <strong class="bold">Live rendering</strong>: The <strong class="source-inline">AnsiConsole</strong> class supports <a id="_idIndexMarker218"/>live-rendering capabilities, allowing you to dynamically update content such as progress bars and <span class="No-Break">status indicators.</span></p>
			<p class="callout">6. <strong class="bold">Markup language</strong>: The <strong class="source-inline">AnsiConsole</strong> class provides a rich markup language<a id="_idIndexMarker219"/> that makes it easy to apply colors and styles to text without <span class="No-Break">complex code.</span></p>
			<p class="callout">7. <strong class="bold">Abstraction for testing</strong>: By <a id="_idIndexMarker220"/>using the <strong class="source-inline">IAnsiConsole</strong> interface instead of the static <strong class="source-inline">AnsiConsole</strong> class, it becomes possible to unit test command handlers and other <span class="No-Break">console-related code.</span></p>
			<p>At this point, weâ€™ve laid the foundations for an interactive version of our CLI application. In the next section, weâ€™ll add more features to make <em class="italic">Bookmarkr</em> even <span class="No-Break">more user-friendly!</span></p>
			<h1 id="_idParaDest-107"><a id="_idTextAnchor110"/>Designing user-friendly CLI applications</h1>
			<p>Although <a id="_idIndexMarker221"/>tons of features are provided by <strong class="source-inline">Spectre.Console</strong> (and I encourage you to check them out by visiting the documentation at <a href="https://spectreconsole.net">https://spectreconsole.net</a>), weâ€™ll be focusing on a subset of these capabilities to add more interactivity to our <span class="No-Break"><em class="italic">Bookmarkr</em></span><span class="No-Break"> application.</span></p>
			<h2 id="_idParaDest-108"><a id="_idTextAnchor111"/>Enhancing text display using markup</h2>
			<p>Letâ€™s improve our <strong class="source-inline">Helper.cs</strong> class by<a id="_idIndexMarker222"/> leveraging the markup capabilities <a id="_idIndexMarker223"/>provided by <strong class="source-inline">Spectre.Console</strong>. These capabilities allow us to style and format text and even render emojis! However, note that some terminal environments (especially older systems or restricted environments, such as CI/CD systems) might not support <span class="No-Break">emoji rendering.</span></p>
			<p>First, letâ€™s review our three methods: <strong class="source-inline">ShowErrorMessage</strong>, <strong class="source-inline">ShowWarningMessage</strong>, <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">ShowSuccessMessage</strong></span><span class="No-Break">.</span></p>
			<p>These methods differ in the color in which they display the text thatâ€™s received as a parameter, but theyâ€™re similar in the way that they all follow the <span class="No-Break">same process:</span></p>
			<ul>
				<li>First, they save the current foreground color to a <span class="No-Break">temporary variable.</span></li>
				<li>Then, they change the foreground color to the intended color (red, yellow, <span class="No-Break">or green).</span></li>
				<li>Next, they display the received text using <span class="No-Break">that color.</span></li>
				<li>Finally, they restore the foreground color to the <span class="No-Break">saved color.</span></li>
			</ul>
			<p>This is <a id="_idIndexMarker224"/>made easier by the <strong class="source-inline">Spectre.Console</strong> library. We <a id="_idIndexMarker225"/>donâ€™t have to save and restore the current foreground color (the library does this for us). It also opens some new possibilities. Letâ€™s explore some while redefining <span class="No-Break">these methods!</span></p>
			<h3>The ShowErrorMessage method</h3>
			<p>We still want the error message to be <a id="_idIndexMarker226"/>displayed in red, but we also want to use emojis to make it <span class="No-Break">more eye-catching.</span></p>
			<p>The code looks <span class="No-Break">like this:</span></p>
			<pre class="source-code">
public static void ShowErrorMessage(string[] errorMessages)
{
Â Â Â Â Console.OutputEncoding = System.Text.Encoding.UTF8;
Â Â Â Â AnsiConsole.MarkupLine(
Â Â Â Â Â Â Â Â Emoji.Known.CrossMark + " [bold red]ERROR[/] :cross_mark:");
Â Â Â Â Â Â Â Â foreach(var message in errorMessages)
Â Â Â Â {
Â Â Â Â Â Â Â Â AnsiConsole.MarkupLineInterpolated($"[red]{message}[/]");
Â Â Â Â }
}</pre>			<p>There are many things worth mentioning in this <span class="No-Break">code sample:</span></p>
			<ul>
				<li>First, we set the encoding to UTF-8. This ensures that emojis are rendered properly. Otherwise, theyâ€™ll be replaced by <span class="No-Break">question marks.</span></li>
				<li>Speaking about emojis, notice that we can display them in two ways: we can either use the <strong class="source-inline">Known</strong> enumeration under the <strong class="source-inline">Emoji</strong> class or use markup code (here, we used<strong class="source-inline">:cross_mark:</strong>). The full list of supported emojis, along with their markup codes and enumeration constants, can be found <span class="No-Break">at </span><a href="https://spectreconsole.net/appendix/emojis"><span class="No-Break">https://spectreconsole.net/appendix/emojis</span></a><span class="No-Break">.</span></li>
				<li>We use <strong class="source-inline">AnsiConsole.MarkupLine(â€¦)</strong> to display the word <em class="italic">ERROR</em> in bold and red surrounded by cross marks. The syntax is based on <span class="No-Break"><strong class="source-inline">BBCode</strong></span><span class="No-Break"> (</span><a href="https://en.wikipedia.org/wiki/BBCode"><span class="No-Break">https://en.wikipedia.org/wiki/BBCode</span></a><span class="No-Break">).</span></li>
				<li>Since the <strong class="source-inline">ShowErrorMessage</strong> method receives an array of strings, we display each <a id="_idIndexMarker227"/>string in red. However, this time, we rely on the <strong class="source-inline">MarkupLineInterpolated</strong> method of the <strong class="source-inline">AnsiConsole</strong> class because weâ€™re performing <span class="No-Break">string interpolation.</span></li>
			</ul>
			<p>Letâ€™s see what happens if we call the <span class="No-Break"><strong class="source-inline">ShowErrorMessage</strong></span><span class="No-Break"> method:</span></p>
			<div>
				<div id="_idContainer102" class="IMG---Figure">
					<img src="image/B22400_07_02.jpg" alt="Figure 7.2 â€“ The updated ShowErrorMessage method in action"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.2 â€“ The updated ShowErrorMessage method in action</p>
			<p>Notice that<a id="_idIndexMarker228"/> the <em class="italic">Hello!</em> message isnâ€™t displayed in red but rather in the previous foreground color of the terminal, without us having to <span class="No-Break">handle this.</span></p>
			<p>Now, letâ€™s update the <strong class="source-inline">ShowWarningMessage</strong> and <span class="No-Break"><strong class="source-inline">ShowSuccessMessage</strong></span><span class="No-Break"> methods.</span></p>
			<h3>The ShowWarningMessage method</h3>
			<p>We still want to display the warning <a id="_idIndexMarker229"/>message in yellow, but letâ€™s also align it so that itâ€™s in the center of the screen (and, yes, weâ€™ll use emojis <span class="No-Break">too </span><span class="No-Break">ðŸ˜Š</span><span class="No-Break">).</span></p>
			<p>The updated code looks <span class="No-Break">like this:</span></p>
			<pre class="source-code">
public static void ShowWarningMessage(string[] errorMessages)
{
Â Â Â Â Console.OutputEncoding = System.Text.Encoding.UTF8;
Â Â Â Â var m = new Markup(
Â Â Â Â Â Â Â Â Emoji.Known.Warning + " [bold yellow]Warning[/] :warning:"
Â Â Â Â );
Â Â Â Â m.Centered();
Â Â Â Â AnsiConsole.Write(m);
Â Â Â Â AnsiConsole.WriteLine();
Â Â Â Â foreach(var message in errorMessages)
Â Â Â Â {
Â Â Â Â Â Â Â Â AnsiConsole.MarkupLineInterpolated(
Â Â Â Â Â Â Â Â Â Â Â Â $"[yellow]{message}[/]"
Â Â Â Â Â Â Â Â );
Â Â Â Â }
}</pre>			<p>This code is very similar<a id="_idIndexMarker230"/> to the code for <strong class="source-inline">ShowErrorMessage</strong>. However, thereâ€™s a slight difference: instead of calling the <strong class="source-inline">MarkupLine</strong> method to display the <em class="italic">Warning</em> text surrounded by emojis, we instantiate an object of the <strong class="source-inline">Markup</strong> type, then call its <strong class="source-inline">Centered()</strong> method before passing it as a parameter to the <strong class="source-inline">Write</strong> method. This is required so that we can center that text on <span class="No-Break">the screen.</span></p>
			<p>Also, notice that just after that, we call the <strong class="source-inline">WriteLine</strong> method without any parameter. This ensures that a line break is performed before the warning information <span class="No-Break">is displayed.</span></p>
			<p>Letâ€™s see what happens if we call the <span class="No-Break"><strong class="source-inline">ShowWarningMessage</strong></span><span class="No-Break"> method:</span></p>
			<div>
				<div id="_idContainer103" class="IMG---Figure">
					<img src="image/B22400_07_03.jpg" alt="Figure 7.3 â€“ The updated ShowWarningMessage method in action"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.3 â€“ The updated ShowWarningMessage method in action</p>
			<p>Once again, notice<a id="_idIndexMarker231"/> that the <em class="italic">Hello!</em> message isnâ€™t displayed in red but rather in the previous foreground color of the terminal, without us having to <span class="No-Break">handle this.</span></p>
			<h3>The ShowSuccessMessage method</h3>
			<p>We still want to display the success<a id="_idIndexMarker232"/> message <span class="No-Break">in green.</span></p>
			<p>The updated code looks <span class="No-Break">like this:</span></p>
			<pre class="source-code">
public static void ShowSuccessMessage(string[] errorMessages)
{
Â Â Â Â Console.OutputEncoding = System.Text.Encoding.UTF8;
Â Â Â Â AnsiConsole.MarkupLine(Emoji.Known.BeatingHeart + " [bold green]
Â Â Â Â SUCCESS[/] :beating_heart:");
Â Â Â Â foreach(var message in errorMessages)
Â Â Â Â {
Â Â Â Â Â Â Â Â AnsiConsole.MarkupLineInterpolated($"[green]{message}[/]");
Â Â Â Â }
}</pre>			<p>Thereâ€™s absolutely nothing worth mentioning here, except maybe that we decided to use heart emojis to celebrate the success of the operation! ðŸ˜Š Congratulations â€“ youâ€™re starting to master the skills of styling and formatting text <span class="No-Break">using </span><span class="No-Break"><strong class="source-inline">Spectre.Console</strong></span><span class="No-Break">!</span></p>
			<p>Letâ€™s see what happens if we call the <span class="No-Break"><strong class="source-inline">ShowSuccessMessage</strong></span><span class="No-Break"> method:</span></p>
			<div>
				<div id="_idContainer104" class="IMG---Figure">
					<img src="image/B22400_07_04.jpg" alt="Figure 7.4 â€“ The updated ShowSuccessMessage method in action"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.4 â€“ The updated ShowSuccessMessage method in action</p>
			<p>Once again, notice that <a id="_idIndexMarker233"/>the <em class="italic">Hello!</em> message isnâ€™t displayed in red but rather in the previous foreground color of the terminal, without us having to <span class="No-Break">handle this.</span></p>
			<p>Now that we can make our text more eye-catching, letâ€™s improve our interactive command by adding <span class="No-Break">more features.</span></p>
			<h2 id="_idParaDest-109"><a id="_idTextAnchor112"/>Offering choices to the user using selection prompts</h2>
			<p>Showing text in a visually pleasant manner is important, but interacting with the user and getting their input is equally important. Fortunately, <strong class="source-inline">Spectre.Console</strong> provides many ways to interact with the user. Letâ€™s explore one <span class="No-Break">of these.</span></p>
			<p>For now, our interactive command only shows a FIGlet. Itâ€™s certainly great, but letâ€™s make it more valuable to the user. One thing we can add is a list of all operations a user can perform. To do so, we will use<a id="_idIndexMarker234"/> a <strong class="bold">selection prompt</strong>. This will allow the user to navigate the list using the up and down arrows on their keyboard and confirm the operation to <span class="No-Break">be executed.</span></p>
			<p>Hereâ€™s what it looks<a id="_idIndexMarker235"/> like <span class="No-Break">in action:</span></p>
			<div>
				<div id="_idContainer105" class="IMG---Figure">
					<img src="image/B22400_07_05.jpg" alt="Figure 7.5 â€“ The selection prompt in action"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.5 â€“ The selection prompt in action</p>
			<p>Hereâ€™s the updated <a id="_idIndexMarker236"/>code of the <span class="No-Break"><strong class="source-inline">OnInteractiveCommand</strong></span><span class="No-Break"> method:</span></p>
			<pre class="source-code">
static void OnInteractiveCommand()
{
Â Â Â Â bool isRunning = true;
Â Â Â Â while(isRunning)
Â Â Â Â {
Â Â Â Â Â Â Â Â AnsiConsole.Write(
Â Â Â Â Â Â Â Â Â Â Â Â new FigletText("Bookmarkr")
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .Centered()
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .Color(Color.SteelBlue)
Â Â Â Â Â Â Â Â );
Â Â Â Â Â Â Â Â var selectedOperation = AnsiConsole.Prompt(
Â Â Â Â Â Â Â Â Â Â Â Â new SelectionPrompt&lt;string&gt;()
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .Title("[blue]What do you wanna do?[/]")
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .AddChoices([
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "Export bookmarks to file",
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "View Bookmarks",
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "Exit Program"
Â Â Â Â Â Â Â Â Â Â Â Â ])
Â Â Â Â Â Â Â Â );
Â Â Â Â Â Â Â Â switch(selectedOperation)
Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â case "Export bookmarks to file":
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ExportBookmarks();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â break;
Â Â Â Â Â Â Â Â Â Â Â Â case "View Bookmarks":
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ViewBookmarks();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â break;
Â Â Â Â Â Â Â Â Â Â Â Â default:
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â isRunning = false;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â break;
Â Â Â Â Â Â Â Â }
Â Â Â Â }
}</pre>			<p>Letâ€™s take a closer<a id="_idIndexMarker237"/> look at <span class="No-Break">this code:</span></p>
			<ul>
				<li>We want the user to be able to keep picking up operations until they decide to exit the program (by selecting the <em class="italic">Exit Program</em> option from the selection prompt). Thatâ€™s why we placed our code inside a <strong class="source-inline">while</strong> loop that relies on the value of a Boolean variable thatâ€™s initially set to <strong class="source-inline">true</strong>. When the user selects <em class="italic">Exit Program</em>, the Boolean variable is set to <strong class="source-inline">false</strong> and the program is exited. Otherwise, the selection prompt is displayed to the user after each <span class="No-Break">completed operation.</span></li>
				<li>We instantiate the <strong class="source-inline">SelectionPrompt</strong> class (provided by <strong class="source-inline">Spectre.Console</strong>), specifying a title and a list of available options that will be displayed to the user. The user can then navigate this list using the up and down arrows and confirm their selection by hitting the <em class="italic">Enter</em> key. When they do, the <strong class="source-inline">selectedOperation</strong> variable is set to the <span class="No-Break">selected value.</span></li>
				<li>Finally, we use a <strong class="source-inline">switch</strong> statement to call a specific method, depending on the value of the <strong class="source-inline">selectedOperation</strong> variable. That method will process the requested operation. Note that these methods havenâ€™t been implemented yet â€“ weâ€™ll focus on them<a id="_idIndexMarker238"/> in the <span class="No-Break">upcoming sections.</span></li>
			</ul>
			<p class="callout-heading">Multi-selection</p>
			<p class="callout">The <strong class="source-inline">Spectre.Console</strong> library also provides multi-selection prompts, which allow the user to select more than one item from a list of possible choices. You can find an illustrative example, along with a code sample, <span class="No-Break">at </span><a href="https://spectreconsole.net/prompts/multiselection"><span class="No-Break">https://spectreconsole.net/prompts/multiselection</span></a><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-110"><a id="_idTextAnchor113"/>Showing live progress of the export command</h2>
			<p>The previous iteration of our<a id="_idIndexMarker239"/> export command was a little bitâ€¦ dry! It certainly exported the bookmarks to the specified output file as expected, but it didnâ€™t give us information on the progress of the operation. We couldnâ€™t know whether it was halfway done or whether it was still at the very first few items out of a thousand. Thanks to the capabilities of <strong class="source-inline">Spectre.Console</strong>, we can display live progress along <span class="No-Break">the way.</span></p>
			<p>Thereâ€™s both a synchronous and an asynchronous method for showing live progress. Since our export code is asynchronous, weâ€™ll use <span class="No-Break">the latter.</span></p>
			<p>So, letâ€™s implement the <strong class="source-inline">ExportBookmarks</strong> method we saw in the previous section. Hereâ€™s <span class="No-Break">the code:</span></p>
			<pre class="source-code">
static void ExportBookmarks()
{
Â Â Â Â // ask for the outputfilePath
Â Â Â Â var outputfilePath = AnsiConsole.Prompt(
Â Â Â Â Â Â Â Â Â Â new TextPrompt&lt;string&gt;("Please provide the output file name 
Â Â Â Â Â Â Â Â Â Â (default: 'bookmarks.json')")
Â Â Â Â Â Â Â Â Â Â .DefaultValue("bookmarks.json"));
Â Â Â Â // export the bookmarks to the specified file, while showing 
Â Â Â Â // progress.
Â Â Â Â AnsiConsole.Progress()
Â Â Â Â Â Â Â Â .AutoRefresh(true) // Turns on auto refresh
Â Â Â Â Â Â Â Â .AutoClear(false)Â Â Â // Avoids removing the task list when 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // completed
Â Â Â Â Â Â Â Â .HideCompleted(false)Â Â Â // Avoids hiding tasks as they are 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // completed
Â Â Â Â Â Â Â Â .Columns(
Â Â Â Â Â Â Â Â [
Â Â Â Â Â Â Â Â Â Â Â Â new TaskDescriptionColumn(),Â Â Â Â // Shows the task 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // description
Â Â Â Â Â Â Â Â Â Â Â Â new ProgressBarColumn(),Â Â Â Â Â Â Â Â // Shows the progress bar
Â Â Â Â Â Â Â Â Â Â Â Â new PercentageColumn(),Â Â Â Â Â Â Â Â Â // Shows the current 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // percentage
Â Â Â Â Â Â Â Â Â Â Â Â new RemainingTimeColumn(),Â Â Â Â Â Â // Shows the remaining 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // time
Â Â Â Â Â Â Â Â Â Â Â Â new SpinnerColumn(),Â Â Â Â Â Â Â Â Â Â Â Â // Shows the spinner, 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // indicating that the 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // operation is ongoing
Â Â Â Â Â Â Â Â ])
Â Â Â Â Â Â Â Â .Start(ctx =&gt;
Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â // Get the list of all bookmarks
Â Â Â Â Â Â Â Â Â Â Â Â var bookmarks = service.GetAll();
Â Â Â Â Â Â Â Â Â Â Â Â // export the bookmarks to the file
Â Â Â Â Â Â Â Â Â Â Â Â // 1. Create the task
Â Â Â Â Â Â Â Â Â Â Â Â var task = ctx.AddTask("[yellow]exporting all bookmarks to 
Â Â Â Â Â Â Â Â Â Â Â Â file...[/]");
Â Â Â Â Â Â Â Â Â Â Â Â // 2. Set the total steps for the progress bar
Â Â Â Â Â Â Â Â Â Â Â Â task.MaxValue = bookmarks.Count;
Â Â Â Â Â Â Â Â Â Â Â Â // 3. Open the file for writing
Â Â Â Â Â Â Â Â Â Â Â Â using (StreamWriter writer = new 
Â Â Â Â Â Â Â Â Â Â Â Â StreamWriter(outputfilePath))
Â Â Â Â Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â while (!ctx.IsFinished)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â foreach (var bookmark in bookmarks)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // 3.1. Serialize the current bookmark as JSON 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //and write it to the file asynchronously
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â writer.WriteLine(JsonSerializer.
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Serialize(bookmark));
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // 3.2. Increment the progress bar
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â task.Increment(1);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // 3.3. Slow down the process so we can see 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // the progress (since this operation is not 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // that much time-consuming)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Thread.Sleep(1500);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â });
Â Â Â Â AnsiConsole.MarkupLine("[green]All bookmarks have been 
Â Â Â Â successfully exported![/]");
}</pre>			<p>Letâ€™s take a <a id="_idIndexMarker240"/>closer look at <span class="No-Break">this code:</span></p>
			<ol>
				<li>First, we ask the user for the filename. We achieved this by using <strong class="source-inline">AnsiConsole.Prompt</strong> and passing an instance of <strong class="source-inline">TextPrompt</strong>. This class also allows us to specify a default value if no value has been provided by the user or if theyâ€™re fine <span class="No-Break">with it.</span></li>
				<li>Next, we display the progress bar by calling <strong class="source-inline">AnsiConsole.Progress</strong>. The processing of the export operation is implemented as a delegate within the <span class="No-Break"><strong class="source-inline">Start</strong></span><span class="No-Break"> method:</span><ol><li class="Alphabets">We start by retrieving the list of bookmarks to <span class="No-Break">be exported.</span></li><li class="Alphabets">Next, we create an instance of the <strong class="source-inline">Task</strong> class, which will be responsible for tracking the processing of the export operation and incrementing the progress barâ€™s percentage. We also set the maximum value for that task to the number of bookmarks to <span class="No-Break">be exported.</span></li><li class="Alphabets">Then, we open a stream writer to the export file. While the task hasnâ€™t been completed (indicated by the <strong class="source-inline">ctx.IsFinished</strong> Boolean value), we serialize each bookmark as JSON and write it to the file, increment the task (which, in turn, will update the progress bar), and wait 1.5s (this is optional, but since the export operation isnâ€™t that time-consuming, adding a delay allows us to see the animation of the progress <span class="No-Break">bar </span><span class="No-Break">ðŸ˜Š</span><span class="No-Break">).</span></li></ol></li>
				<li>You may<a id="_idIndexMarker241"/> have noticed some lines of code before the <strong class="source-inline">Start</strong> method is called. These are here to configure the look and behavior of the <span class="No-Break">progress bar:</span><ul><li><strong class="source-inline">AutoRefresh(true)</strong>: We enable auto-refresh of the progress bar. Otherwise, even if we increment the value of the task, the progress bar wonâ€™t be animated to reflect the <span class="No-Break">updated value.</span></li><li><strong class="source-inline">AutoClear(false)</strong>: This prevents the task from being removed once completed. This is especially useful if we display the progress of multiple, <span class="No-Break">concurrent operations.</span></li><li><strong class="source-inline">HideCompleted(false)</strong>: This prevents the task from being hidden once completed. This is especially useful if we display the progress of multiple, <span class="No-Break">concurrent operations.</span></li><li><strong class="source-inline">Columns</strong>: This collection controls the look of the progress bar. In this case, we decided to display the description of the task, the progress bar, the current percentage of the operation, the remaining time to complete the operation, and a spinner indicating that the operation is ongoing (this proves helpful in situations where dealing with time-consuming operations for which the progress bar may be updated at longer intervals but since the spinner keeps, wellâ€¦ spinning, the user has that sentiment that the operation is <span class="No-Break">still ongoing).</span></li></ul></li>
			</ol>
			<p>Now that the code has been implemented, letâ€™s run the program and see what <span class="No-Break">we get:</span></p>
			<div>
				<div id="_idContainer106" class="IMG---Figure">
					<img src="image/B22400_07_06.jpg" alt="Figure 7.6 â€“ Showing live progress while exporting bookmarks"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.6 â€“ Showing live progress while exporting bookmarks</p>
			<p>Now, our export<a id="_idIndexMarker242"/> operation is more user-friendly (and, letâ€™s face it, more fun to use ðŸ˜Š). The user is informed of the progress of the export operation as it continues <span class="No-Break">to run.</span></p>
			<p class="callout-heading">Important note</p>
			<p class="callout">If the terminal isnâ€™t considered interactive (for example, when running in a continuous integration system), any progress will be displayed in a simpler way (such as the current percentage value being displayed on a <span class="No-Break">new line).</span></p>
			<p>With that, weâ€™ve exported our bookmarks to a file and we can view them from there. Awesome! But what if we wanted to view them right from within the CLI application? Letâ€™s see how we can have a visually pleasant representation of <span class="No-Break">these bookmarks.</span></p>
			<h2 id="_idParaDest-111"><a id="_idTextAnchor114"/>Displaying bookmarks in a tree view</h2>
			<p>The <strong class="source-inline">Spectre.Console</strong> library<a id="_idIndexMarker243"/> provides various options to display a list of <a id="_idIndexMarker244"/>elements. We can use tables, trees, layouts, panels, grids, and <span class="No-Break">so on.</span></p>
			<p>Since we want to display the list of our bookmarks based on the categories to which they belong, weâ€™ll use a tree representation. So, letâ€™s implement the <span class="No-Break"><strong class="source-inline">ViewBookmarks</strong></span><span class="No-Break"> method.</span></p>
			<p>Hereâ€™s the code for <span class="No-Break">this method:</span></p>
			<pre class="source-code">
static void ViewBookmarks()
{
Â Â Â Â // Create the tree
Â Â Â Â var root = new Tree("Bookmarks");
Â Â Â Â // Add some nodes
Â Â Â Â var techBooksCategory = root.AddNode("[yellow]Tech Books[/]");
Â Â Â Â var carsCategory = root.AddNode("[yellow]Cars[/]");
Â Â Â Â var socialMediaCategory = root.AddNode("[yellow]Social Media[/]");
Â Â Â Â var cookingCategory = root.AddNode("[yellow]Cooking[/]");
Â Â Â Â // add bookmarks for the Tech Book category
Â Â Â Â var techBooks = service.GetBookmarksByCategory("Tech Books");
Â Â Â Â foreach(var techbook in techBooks)
Â Â Â Â {
Â Â Â Â Â Â Â Â techBooksCategory.AddNode($"{techbook.Name} | {techbook.
Â Â Â Â Â Â Â Â Url}");
Â Â Â Â }
Â Â Â Â // ... do the same for the other categories ;)
Â Â Â Â // Render the tree
Â Â Â Â AnsiConsole.Write(root);
}</pre>			<p>Letâ€™s explain <span class="No-Break">this code:</span></p>
			<ol>
				<li>First, we <a id="_idIndexMarker245"/>create the root element of the tree, and we label it <em class="italic">Bookmarks</em>.  This label will be displayed to indicate what elements this tree <a id="_idIndexMarker246"/><span class="No-Break">is presenting.</span></li>
				<li>Next, we add four nodes (one for each category). These labels are children of the root node, and their labels are displayed <span class="No-Break">in yellow.</span></li>
				<li>Then, we call the <strong class="source-inline">GetBookmarksByCategory</strong> method of <strong class="source-inline">BookmarkService</strong> to retrieve the list of bookmarks associated with the specified category (in this case, <em class="italic">Tech Books</em>). After, we iterate over this list and add each bookmark as a child node to the <span class="No-Break"><strong class="source-inline">techBooksCategory</strong></span><span class="No-Break"> node.</span></li>
				<li>We do the same thing for the other categories. The preceding code sample has been simplified and only shows the code for the <em class="italic">Tech Books</em> category for clarity. However, the complete code can be found in this bookâ€™s <span class="No-Break">GitHub repository.</span></li>
				<li>Finally, we display the label in <span class="No-Break">the console.</span></li>
			</ol>
			<p>Pretty straightforward, <span class="No-Break">isnâ€™t it?</span></p>
			<p>Now, letâ€™s run the program and see how <span class="No-Break">it looks:</span></p>
			<div>
				<div id="_idContainer107" class="IMG---Figure">
					<img src="image/B22400_07_07.jpg" alt="Figure 7.7 â€“ Showing bookmarks as a tree view, grouped by categories"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.7 â€“ Showing bookmarks as a tree view, grouped by categories</p>
			<p>Wow. What an improvement! The interactive version of our CLI application looks great and is more user-friendly and engaging, donâ€™t you <span class="No-Break">think? </span><span class="No-Break">ðŸ˜‰</span></p>
			<h1 id="_idParaDest-112"><a id="_idTextAnchor115"/>To be or not to be interactive?</h1>
			<p>Providing an interactive version of a CLI application certainly enhances the user experience. So, shouldnâ€™t we always provide it? Shouldnâ€™t it be the default version? These are great questions. Thanks for <span class="No-Break">asking! </span><span class="No-Break">ðŸ˜Š</span></p>
			<p>Letâ€™s start with the first one: <strong class="bold">shouldnâ€™t we always provide it?</strong> We certainly should as it (as mentioned previously) improves the user experience <span class="No-Break">and engagement.</span></p>
			<p><strong class="bold">Shouldnâ€™t it be the default version?</strong> It could! It depends on your <span class="No-Break">target audience:</span></p>
			<ul>
				<li>If your CLI application is primarily intended to be run by humans, then yes! You should make the interactive version the default one. In this case, your commands could provide a <strong class="source-inline">--non-interactive</strong> option to disable this interactive behavior when that command is executed by a program (in a CI/CD pipeline, <span class="No-Break">for example).</span></li>
				<li>If your CLI application is primarily intended to be run by programs (such as one for processing a large batch of files or a CI/CD pipeline), your commands could provide a <strong class="source-inline">--interactive</strong> option to enable interactive behavior when theyâ€™re executed <span class="No-Break">by humans.</span></li>
			</ul>
			<p>In other words, interactivity is fantastic, but use <span class="No-Break">it wisely!</span></p>
			<h1 id="_idParaDest-113"><a id="_idTextAnchor116"/>Summary</h1>
			<p>In this chapter, we made <em class="italic">Bookmarkr</em> more user-friendly and graphically appealing by introducing progress bars, checkmarks, and lists of items for easier user selection and ensuring that only valid values <span class="No-Break">are selected.</span></p>
			<p>We learned that these additions, in combination with text coloring, help make our CLI applications more compelling and fun to use and showed that CLI applications have nothing to be ashamed of in front of <span class="No-Break">GUI applications.</span></p>
			<p>But thatâ€™s not all! We also learned that these additions help make our CLI applications more conversational (that is, interactive) with <span class="No-Break">the user.</span></p>
			<p>In the next chapter, weâ€™ll learn how to make our CLI application have a more modular design so that itâ€™s easier <span class="No-Break">to extend.</span></p>
			<h1 id="_idParaDest-114"><a id="_idTextAnchor117"/>Your turn!</h1>
			<p>Following along with the provided code is a great way to learn <span class="No-Break">through practice.</span></p>
			<p>A better way is by challenging yourself to achieve tasks. Hence, I challenge you to improve the <em class="italic">Bookmarkr</em> application by adding <span class="No-Break">various features.</span></p>
			<h2 id="_idParaDest-115"><a id="_idTextAnchor118"/>Task 1 â€“ present a bookmark in a user-friendly way</h2>
			<p>Youâ€™ve been asked to add a <strong class="source-inline">show</strong> command that takes the name of a bookmark and displays it in a three-column grid â€“ one for the name, one for the URL, and one for <span class="No-Break">the category.</span></p>
			<p>The grid should contain a row for the headers (name, URL, <span class="No-Break">and category).</span></p>
			<p>The name should be displayed in yellow and bold; the URL should be presented as a link; and the category should be presented in italics <span class="No-Break">and green.</span></p>
			<p>The syntax of the command should be <span class="No-Break">as follows:</span></p>
			<pre class="console">
bookmarkr link show --name &lt;name of the bookmark&gt;</pre>			<h2 id="_idParaDest-116"><a id="_idTextAnchor119"/>Task 2 â€“ change the category of a bookmark interactively</h2>
			<p>Youâ€™ve been asked to implement a new command called <strong class="source-inline">category change</strong> that changes the category of an <span class="No-Break">existing URL.</span></p>
			<p>The command must display the list of existing categories as a selection menu; the user will have to select which one will be set as the new category for that bookmark based on its URL. This update will then be saved to <span class="No-Break">the database.</span></p>
			<p>The syntax of the command should be <span class="No-Break">as follows:</span></p>
			<pre class="console">
bookmarkr category change --for-url &lt;url of the bookmark&gt;</pre>		</div>
	</body></html>