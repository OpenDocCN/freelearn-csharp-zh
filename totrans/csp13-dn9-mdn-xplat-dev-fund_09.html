<html><head></head><body><div><div><div><h1 class="chapterNumber">9</h1>
    <h1 id="_idParaDest-560" class="chapterTitle">Working with Files, Streams, and Serialization</h1>
    <p class="normal">This chapter is about reading and writing to files and streams, text encoding, and serialization. Applications that do not interact with a filesystem are extraordinarily rare. As a .NET developer, almost every application that you build will need to manage the filesystem and create, open, read, and write to and from files. Most of those files will contain text, so it is important to understand how text is encoded. And finally, after working with objects in memory, you will need to store them somewhere permanently for later reuse. You do that using a technique called serialization.</p>
    <p class="normal">In this chapter, we will cover the following topics:</p>
    <ul>
      <li class="bulletList">Managing a filesystem</li>
      <li class="bulletList">Reading and writing with streams</li>
      <li class="bulletList">Encoding and decoding text</li>
      <li class="bulletList">Serializing object graphs</li>
    </ul>
    <h1 id="_idParaDest-561" class="heading-1">Managing a filesystem</h1>
    <p class="normal">Your applications<a id="_idIndexMarker1392"/> will often need to perform input and output operations with files and directories in different environments. The <code class="inlineCode">System</code> and <code class="inlineCode">System.IO</code> namespaces contain classes for this purpose.</p>
    <h2 id="_idParaDest-562" class="heading-2">Handling cross-platform environments and filesystems</h2>
    <p class="normal">Let’s explore <a id="_idIndexMarker1393"/>how to handle cross-platform <a id="_idIndexMarker1394"/>environments and the differences between Windows, Linux, and macOS. Paths are different for Windows, macOS, and Linux, so we will start by exploring how .NET handles this:</p>
    <ol>
      <li class="numberedList" value="1">Use your preferred code editor to create a new project, as defined in the following list:<ul>
          <li class="bulletList level-2">Project template: <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code></li>
          <li class="bulletList level-2">Project file and folder: <code class="inlineCode">WorkingWithFileSystems</code></li>
          <li class="bulletList level-2">Solution file and folder: <code class="inlineCode">Chapter09</code></li>
        </ul>
      </li>
      <li class="numberedList">In the project file, add a package reference for <code class="inlineCode">Spectre.Console</code>, and then add elements to import the following classes statically and globally, <code class="inlineCode">System.Console</code>, <code class="inlineCode">System.IO.Directory</code>, <code class="inlineCode">System.IO.Path</code>, and <code class="inlineCode">System.Environment</code>, as shown in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;PackageReference Include="Spectre.Console" Version="0.47.0" /&gt;
&lt;/ItemGroup&gt;
&lt;ItemGroup&gt;
  &lt;Using Include="System.Console" Static="true" /&gt;
  &lt;Using Include="System.IO.Directory" Static="true" /&gt;
  &lt;Using Include="System.IO.Path" Static="true" /&gt;
  &lt;Using Include="System.Environment" Static="true" /&gt;
&lt;/ItemGroup&gt;
</code></pre>
      </li>
      <li class="numberedList">Build the <code class="inlineCode">WorkingWithFileSystems</code> project to restore packages.</li>
      <li class="numberedList">Add a new class file named <code class="inlineCode">Program.Helpers.cs</code>.</li>
      <li class="numberedList">In <code class="inlineCode">Program.Helpers.cs</code>, add a partial <code class="inlineCode">Program</code> class with a <code class="inlineCode">SectionTitle</code> method, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">// null namespace to merge with auto-generated Program.
partial class Program
{
  private static void SectionTitle(string title)
  {
    WriteLine();
    ConsoleColor previousColor = ForegroundColor;
    // Use a color that stands out on your system.
    ForegroundColor = ConsoleColor.DarkYellow;
    WriteLine($"*** {title} ***");
    ForegroundColor = previousColor;
  }
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, add statements to use a <code class="inlineCode">Spectre.Console</code> table to do the following:<ul>
          <li class="bulletList level-2">Output<a id="_idIndexMarker1395"/> the <a id="_idIndexMarker1396"/>path and directory separation characters.</li>
          <li class="bulletList level-2">Output the path of the current directory.</li>
          <li class="bulletList level-2">Output some special paths for system files, temporary files, and documents:</li>
        </ul>
        <pre class="programlisting code-one"><code class="hljs-code">using Spectre.Console; // To use Table.
#region Handling cross-platform environments and filesystems
SectionTitle("Handling cross-platform environments and filesystems");
// Create a Spectre Console table.
Table table = new();
// Add two columns with markup for colors.
table.AddColumn("[blue]MEMBER[/]");
table.AddColumn("[blue]VALUE[/]");
// Add rows.
table.AddRow("Path.PathSeparator", PathSeparator.ToString());
table.AddRow("Path.DirectorySeparatorChar",
  DirectorySeparatorChar.ToString());
table.AddRow("Directory.GetCurrentDirectory()",
  GetCurrentDirectory());
table.AddRow("Environment.CurrentDirectory", CurrentDirectory);
table.AddRow("Environment.SystemDirectory", SystemDirectory);
table.AddRow("Path.GetTempPath()", GetTempPath());
table.AddRow("");
table.AddRow("GetFolderPath(SpecialFolder", "");
table.AddRow("  .System)", GetFolderPath(SpecialFolder.System));
table.AddRow("  .ApplicationData)",
  GetFolderPath(SpecialFolder.ApplicationData));
table.AddRow("  .MyDocuments)",
  GetFolderPath(SpecialFolder.MyDocuments));
table.AddRow("  .Personal)",
  GetFolderPath(SpecialFolder.Personal));
// Render the table to the console
AnsiConsole.Write(table);
#endregion
</code></pre>
        <div><p class="normal">The <code class="inlineCode">Environment</code> type has many other useful members that we did not use in this code, including the <code class="inlineCode">OSVersion</code> and <code class="inlineCode">ProcessorCount</code> properties.</p>
        </div>
      </li>
    </ol>
    <ol>
      <li class="numberedList" value="7">Run the code<a id="_idIndexMarker1397"/> and<a id="_idIndexMarker1398"/> view the result, as shown using Visual Studio on Windows in <em class="italic">Figure 9.1</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B22322_09_01.png" alt="" width="816" height="291"/></figure>
    <p class="packt_figref">Figure 9.1: Showing filesystem information with Visual Studio on Windows</p>
    <div><p class="normal"><strong class="keyWord">More Information</strong>: You can learn more about using <code class="inlineCode">Spectre Console</code> tables at the following link: <a href="https://spectreconsole.net/widgets/table">https://spectreconsole.net/widgets/table</a>.</p>
    </div>
    <p class="normal">When running<a id="_idIndexMarker1399"/> the<a id="_idIndexMarker1400"/> console app using <code class="inlineCode">dotnet run</code> on a Mac, the path and directory separator characters are different, and the <code class="inlineCode">CurrentDirectory</code> will be the project folder, not a folder inside <code class="inlineCode">bin</code>, as shown in <em class="italic">Figure 9.2</em>:</p>
    <figure class="mediaobject"><img src="img/B22322_09_02.png" alt="" width="825" height="355"/></figure>
    <p class="packt_figref">Figure 9.2: Showing filesystem information with the CLI on macOS</p>
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: Windows uses a backslash (<code class="inlineCode">\</code>) for the directory separator character. macOS and Linux use a forward slash (<code class="inlineCode">/</code>) for the directory separator character. Do not assume which character is used in your code when combining paths; use <code class="inlineCode">Path.DirectorySeparatorChar</code>.</p>
    </div>
    <p class="normal">In future sections of this chapter, we will create directories and files in the <code class="inlineCode">Personal</code> special<a id="_idIndexMarker1401"/> folder, so<a id="_idIndexMarker1402"/> make a note of where that is for your operating system. For example, if you’re using Linux, it should be <code class="inlineCode">$USER/Documents</code>.</p>
    <h2 id="_idParaDest-563" class="heading-2">Managing drives</h2>
    <p class="normal">To manage<a id="_idIndexMarker1403"/> drives, use the <code class="inlineCode">DriveInfo</code> type, which has a<a id="_idIndexMarker1404"/> static method that returns information about all the drives connected to your computer. Each drive has a drive type.</p>
    <p class="normal">Let’s explore drives:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, write statements to get all the drives and output their name, type, size, available free space, and format, but only if the drive is ready, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">SectionTitle("Managing drives");
Table drives = new();
drives.AddColumn("[blue]NAME[/]");
drives.AddColumn("[blue]TYPE[/]");
drives.AddColumn("[blue]FORMAT[/]");
drives.AddColumn(new TableColumn(
  "[blue]SIZE (BYTES)[/]").RightAligned());
drives.AddColumn(new TableColumn(
  "[blue]FREE SPACE[/]").RightAligned());
foreach (DriveInfo drive in DriveInfo.GetDrives())
{
  if (drive.IsReady)
  {
    drives.AddRow(drive.Name, drive.DriveType.ToString(),
      drive.DriveFormat, drive.TotalSize.ToString("N0"),
      drive.AvailableFreeSpace.ToString("N0"));
  }
  else
  {
    drives.AddRow(drive.Name, drive.DriveType.ToString(),
      string.Empty, string.Empty, string.Empty);
  }
}
AnsiConsole.Write(drives);
</code></pre>
      </li>
    </ol>
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: Check that a drive is ready before reading properties such as <code class="inlineCode">TotalSize</code>, or you will see an exception thrown with removable drives.</p>
    </div>
    <div><p class="normal">On Linux, by<a id="_idIndexMarker1405"/> default, your console app will only have<a id="_idIndexMarker1406"/> permission to read the <code class="inlineCode">Name</code> and <code class="inlineCode">DriveType</code> properties when run as a normal user. An <code class="inlineCode">UnauthorizedAccessException</code> is thrown for <code class="inlineCode">DriveFormat</code>, <code class="inlineCode">TotalSize</code>, and <code class="inlineCode">AvailableFreeSpace</code>. Run the console app as a superuser to avoid this issue, as shown in the following command: <code class="inlineCode">sudo dotnet run</code>. Using <code class="inlineCode">sudo</code> is fine in a development environment, but in a production environment, it’s recommended to edit your permissions to avoid running with elevated permissions. On Linux, the name and drive format columns might also need to be wider, for example, 55 and 12 characters wide, respectively.</p>
    </div>
    <ol>
      <li class="numberedList" value="2">Run the code and view the result, as shown in <em class="italic">Figure 9.3</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B22322_09_03.png" alt="" width="817" height="438"/></figure>
    <figure class="mediaobject">Figure 9.3: Showing drive information on Windows and macOS</figure>
    <h2 id="_idParaDest-564" class="heading-2">Managing directories</h2>
    <p class="normal">To manage<a id="_idIndexMarker1407"/> directories, use the <code class="inlineCode">Directory</code>, <code class="inlineCode">Path</code>, and <code class="inlineCode">Environment</code> static <a id="_idIndexMarker1408"/>classes. These types include many members to work with the filesystem.</p>
    <p class="normal">When constructing custom paths, you must be careful to write your code so that it makes no assumptions about the platform, for example, what to use for the directory separator character:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, write statements to do the following:<ul>
          <li class="bulletList level-2">Define a custom path under the user’s home directory by creating an array of strings for the directory names, and then properly combine them with the <code class="inlineCode">Path</code> type’s <code class="inlineCode">Combine</code> method.</li>
          <li class="bulletList level-2">Check for the existence of the custom directory path using the <code class="inlineCode">Exists</code> method of the <code class="inlineCode">Directory</code> class.</li>
          <li class="bulletList level-2">Create and then delete the directory, including the files and subdirectories within it, using the <code class="inlineCode">CreateDirectory</code> and <code class="inlineCode">Delete</code> methods<a id="_idIndexMarker1409"/> of the <code class="inlineCode">Directory</code> class:
            <pre class="programlisting code"><code class="hljs-code">SectionTitle("Managing directories");
string newFolder = Combine(
  GetFolderPath(SpecialFolder.Personal), "NewFolder");
WriteLine($"Working with: {newFolder}");
// We must explicitly say which Exists method to use
// because we statically imported both Path and Directory.
WriteLine($"Does it exist? {Path.Exists(newFolder)}");
WriteLine("Creating it...");
CreateDirectory(newFolder);
// Let's use the Directory.Exists method this time.
WriteLine($"Does it exist? {Directory.Exists(newFolder)}");
Write("Confirm the directory exists, and then press any key.");
ReadKey(intercept: true);
WriteLine("Deleting it...");
Delete(newFolder, recursive: true);
WriteLine($"Does it exist? {Path.Exists(newFolder)}");
</code></pre>
            <div><p class="normal">In .NET 6 and<a id="_idIndexMarker1410"/> earlier, only the <code class="inlineCode">Directory</code> class had an <code class="inlineCode">Exists</code> method. In .NET 7 or later, the <code class="inlineCode">Path</code> class also has an <code class="inlineCode">Exists</code> method. Both can be used to check for the existence of a path.</p>
            </div>
          </li>
        </ul>
      </li>
    </ol>
    <ol>
      <li class="numberedList" value="2">Run the code, view the result, and use your favorite file management tool to confirm that the directory has been created before pressing <em class="keystroke">Enter</em> to delete it, as<a id="_idIndexMarker1411"/> shown in the following <a id="_idIndexMarker1412"/>output:
        <pre class="programlisting con-one"><code class="hljs-con">Working with: C:\Users\markj\OneDrive\Documents\NewFolder
Does it exist? False
Creating it...
Does it exist? True
Confirm the directory exists, and then press any key.
Deleting it...
Does it exist? False
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-565" class="heading-2">Managing files</h2>
    <p class="normal">When working with <a id="_idIndexMarker1413"/>files, you can statically import the file <a id="_idIndexMarker1414"/>type, just as we did for the directory type. However, for the next example, we will not do so because it has some of the same methods as the directory type, and they would conflict. The file type has a short enough name not to matter in this case. The steps are as follows:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, write statements to do the following:<ol class="alphabeticList level-2" style="list-style-type: lower-alpha;">
          <li class="alphabeticList level-2" value="1">Check for the existence of a file.</li>
          <li class="alphabeticList level-2">Create a text file.</li>
          <li class="alphabeticList level-2">Write a line of text to the file.</li>
          <li class="alphabeticList level-2">Close the file to release system resources and file locks (this would normally be done inside a <code class="inlineCode">try</code>-<code class="inlineCode">finally</code> statement block to ensure that the file is closed, even if an exception occurs when writing to it).</li>
          <li class="alphabeticList level-2">Copy the file to a backup.</li>
          <li class="alphabeticList level-2">Delete the original file.</li>
          <li class="alphabeticList level-2">Read the backup file’s contents and then close it:
            <pre class="programlisting code"><code class="hljs-code">SectionTitle("Managing files");
// Define a directory path to output files starting
// in the user's folder.
string dir = Combine(
  GetFolderPath(SpecialFolder.Personal), "OutputFiles");
CreateDirectory(dir);
// Define file paths.
string textFile = Combine(dir, "Dummy.txt");
string backupFile = Combine(dir, "Dummy.bak");
WriteLine($"Working with: {textFile}");
WriteLine($"Does it exist? {File.Exists(textFile)}");
// Create a new text file and write a line to it.
StreamWriter textWriter = File.CreateText(textFile);
textWriter.WriteLine("Hello, C#!");
textWriter.Close(); // Close file and release resources.
WriteLine($"Does it exist? {File.Exists(textFile)}");
// Copy the file, and overwrite if it already exists.
File.Copy(sourceFileName: textFile,
  destFileName: backupFile, overwrite: true);
WriteLine(
  $"Does {backupFile} exist? {File.Exists(backupFile)}");
Write("Confirm the files exist, and then press any key.");
ReadKey(intercept: true);
// Delete the file.
File.Delete(textFile);
WriteLine($"Does it exist? {File.Exists(textFile)}");
// Read from the text file backup.
WriteLine($"Reading contents of {backupFile}:");
StreamReader textReader = File.OpenText(backupFile);
WriteLine(textReader.ReadToEnd());
textReader.Close();
</code></pre>
          </li>
        </ol>
      </li>
      <li class="numberedList">Run the code <a id="_idIndexMarker1415"/>and view the result, as shown in <a id="_idIndexMarker1416"/>the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Working with: C:\Users\markj\OneDrive\Documents\OutputFiles\Dummy.txt
Does it exist? False
Does it exist? True
Does C:\Users\markj\OneDrive\Documents\OutputFiles\Dummy.bak exist? True
Confirm the files exist, and then press any key.
Does it exist? False
Reading contents of C:\Users\markj\OneDrive\Documents\OutputFiles\Dummy.bak:
Hello, C#!
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-566" class="heading-2">Managing paths</h2>
    <p class="normal">Sometimes, you <a id="_idIndexMarker1417"/>need to work with parts of a path; for<a id="_idIndexMarker1418"/> example, you might want to extract just the folder name, the filename, or the extension. Sometimes, you need to generate temporary folders and filenames. You can do this with static methods of the <code class="inlineCode">Path</code> class:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, add the following statements:
        <pre class="programlisting code-one"><code class="hljs-code">SectionTitle("Managing paths");
WriteLine($"Folder Name: {GetDirectoryName(textFile)}");
WriteLine($"File Name: {GetFileName(textFile)}");
WriteLine("File Name without Extension: {0}",
  GetFileNameWithoutExtension(textFile));
WriteLine($"File Extension: {GetExtension(textFile)}");
WriteLine($"Random File Name: {GetRandomFileName()}");
WriteLine($"Temporary File Name: {GetTempFileName()}");
</code></pre>
      </li>
      <li class="numberedList">Run the code and view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Folder Name: C:\Users\markj\OneDrive\Documents\OutputFiles
File Name: Dummy.txt
File Name without Extension: Dummy
File Extension: .txt
Random File Name: u45w1zki.co3
Temporary File Name:
C:\Users\markj\AppData\Local\Temp\tmphdmipz.tmp
</code></pre>
      </li>
    </ol>
    <div><p class="normal"><code class="inlineCode">GetTempFileName</code> creates a zero-byte file and returns its name, ready for you to use. <code class="inlineCode">GetRandomFileName</code> just <a id="_idIndexMarker1419"/>returns a filename; it doesn’t<a id="_idIndexMarker1420"/> create the file.</p>
    </div>
    <h2 id="_idParaDest-567" class="heading-2">Getting file information</h2>
    <p class="normal">To get more <a id="_idIndexMarker1421"/>information about a file or <a id="_idIndexMarker1422"/>directory, for example, its size or when it was last accessed, you can create an instance of the <code class="inlineCode">FileInfo</code> or <code class="inlineCode">DirectoryInfo</code> class.</p>
    <p class="normal"><code class="inlineCode">FileInfo</code> and <code class="inlineCode">DirectoryInfo</code> both inherit from <code class="inlineCode">FileSystemInfo</code>, so they both have members such as <code class="inlineCode">LastAccessTime</code> and <code class="inlineCode">Delete</code>, as well as extra members specific to themselves, as shown in <em class="italic">Table 9.1</em>:</p>
    <table id="table001-8" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Class</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Members</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">FileSystemInfo</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Fields: <code class="inlineCode">FullPath</code> and <code class="inlineCode">OriginalPath</code></p>
            <p class="normal">Properties: <code class="inlineCode">Attributes</code>, <code class="inlineCode">CreationTime</code>, <code class="inlineCode">CreationTimeUtc</code>, <code class="inlineCode">Exists</code>, <code class="inlineCode">Extension</code>, <code class="inlineCode">FullName</code>, <code class="inlineCode">LastAccessTime</code>, <code class="inlineCode">LastAccessTimeUtc</code>, <code class="inlineCode">LastWriteTime</code>, <code class="inlineCode">LastWriteTimeUtc</code>, and <code class="inlineCode">Name</code></p>
            <p class="normal">Methods: <code class="inlineCode">Delete</code>, <code class="inlineCode">GetObjectData</code>, and <code class="inlineCode">Refresh</code></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">DirectoryInfo</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Properties: <code class="inlineCode">Parent</code> and <code class="inlineCode">Root</code></p>
            <p class="normal">Methods: <code class="inlineCode">Create</code>, <code class="inlineCode">CreateSubdirectory</code>, <code class="inlineCode">EnumerateDirectories</code>, <code class="inlineCode">EnumerateFiles</code>, <code class="inlineCode">EnumerateFileSystemInfos</code>, <code class="inlineCode">GetAccessControl</code>, <code class="inlineCode">GetDirectories</code>, <code class="inlineCode">GetFiles</code>, <code class="inlineCode">GetFileSystemInfos</code>, <code class="inlineCode">MoveTo</code>, and <code class="inlineCode">SetAccessControl</code></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">FileInfo</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Properties: <code class="inlineCode">Directory</code>, <code class="inlineCode">DirectoryName</code>, <code class="inlineCode">IsReadOnly</code>, and <code class="inlineCode">Length</code></p>
            <p class="normal">Methods: <code class="inlineCode">AppendText</code>, <code class="inlineCode">CopyTo</code>, <code class="inlineCode">Create</code>, <code class="inlineCode">CreateText</code>, <code class="inlineCode">Decrypt</code>, <code class="inlineCode">Encrypt</code>, <code class="inlineCode">GetAccessControl</code>, <code class="inlineCode">MoveTo</code>, <code class="inlineCode">Open</code>, <code class="inlineCode">OpenRead</code>, <code class="inlineCode">OpenText</code>, <code class="inlineCode">OpenWrite</code>, <code class="inlineCode">Replace</code>, and <code class="inlineCode">SetAccessControl</code></p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 9.1: Classes to get information about files and directories</p>
    <p class="normal">Let’s write some code that uses a <code class="inlineCode">FileInfo</code> instance to efficiently perform multiple actions on a file:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, add statements to create an instance of <code class="inlineCode">FileInfo</code> for the backup file, and write<a id="_idIndexMarker1423"/> information about it to the console, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">SectionTitle("Getting file information");
FileInfo info = new(backupFile);
WriteLine($"{backupFile}:");
WriteLine($"  Contains {info.Length} bytes.");
WriteLine($"  Last accessed: {info.LastAccessTime}");
WriteLine($"  Has readonly set to {info.IsReadOnly}.");
</code></pre>
      </li>
      <li class="numberedList">Run the code and view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">C:\Users\markj\OneDrive\Documents\OutputFiles\Dummy.bak:
  Contains 12 bytes.
  Last accessed: 13/07/2023 12:11:12
  Has readonly set to False.
</code></pre>
      </li>
    </ol>
    <p class="normal">The number<a id="_idIndexMarker1424"/> of bytes might be different on <a id="_idIndexMarker1425"/>your operating system because operating systems can use different line endings.</p>
    <h2 id="_idParaDest-568" class="heading-2">Controlling how you work with files</h2>
    <p class="normal">When working <a id="_idIndexMarker1426"/>with files, you often need to control how they are opened. The <code class="inlineCode">File.Open</code> method has overloads to specify additional options using <code class="inlineCode">enum</code> values.</p>
    <p class="normal">The <code class="inlineCode">enum</code> types are as follows:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">FileMode</code>: This controls what you want to do with a file, like <code class="inlineCode">CreateNew</code>, <code class="inlineCode">OpenOrCreate</code>, or <code class="inlineCode">Truncate</code>.</li>
      <li class="bulletList"><code class="inlineCode">FileAccess</code>: This controls what level of access you need, like <code class="inlineCode">ReadWrite</code>.</li>
      <li class="bulletList"><code class="inlineCode">FileShare</code>: This controls locks on a file to allow other processes the specified level of access, like <code class="inlineCode">Read</code>.</li>
    </ul>
    <p class="normal">You might want to open a file and read from it, allowing other processes to read it too, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">FileStream file = File.Open(pathToFile,
  FileMode.Open, FileAccess.Read, FileShare.Read);
</code></pre>
    <p class="normal">There is also an <code class="inlineCode">enum</code> for attributes of a file, <code class="inlineCode">FileAttributes</code>, that checks a <code class="inlineCode">FileSystemInfo</code>-derived type’s <code class="inlineCode">Attributes</code> property for values like <code class="inlineCode">Archive</code> and <code class="inlineCode">Encrypted</code>. For <a id="_idIndexMarker1427"/>example, you could check a file or directory’s attributes, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">FileInfo info = new(backupFile);
WriteLine("Is the backup file compressed? {0}",
  info.Attributes.HasFlag(FileAttributes.Compressed));
</code></pre>
    <p class="normal">All the methods of the <code class="inlineCode">File</code> class that manage a file have a parameter to specify the path to the file as a <code class="inlineCode">string</code> value. Additional parameters of the <code class="inlineCode">File</code> class, its methods, and what the methods return are shown in <em class="italic">Table 9.2</em>:</p>
    <table id="table002-8" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Method</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Special parameters</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Returns</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Notes</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Open</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">FileMode</code>, <code class="inlineCode">FileAccess</code>, <code class="inlineCode">FileShare</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">FileStream</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Byte-level access to a file.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">OpenWrite</code></p>
          </td>
          <td class="table-cell"/>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">FileStream</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Overwrites from the start but does not truncate.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Create</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">FileOptions</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">FileStream</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Overwrites and truncates.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">OpenText</code></p>
          </td>
          <td class="table-cell"/>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">StreamReader</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">For reading a text file.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">CreateText</code></p>
          </td>
          <td class="table-cell"/>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">StreamWriter</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Overwrites and truncates.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">AppendText</code></p>
          </td>
          <td class="table-cell"/>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">StreamWriter</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Creates the file if it does not exist.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">ReadAllLines</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Encoding</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">string[]</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Warning! This uses a lot of memory for large files.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">ReadAllText</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Encoding</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">string</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Warning! This uses a lot of memory for large files.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">WriteAllText</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">string</code>, <code class="inlineCode">Encoding</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">void</code></p>
          </td>
          <td class="table-cell"/>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">AppendAllText</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">string</code>, <code class="inlineCode">Encoding</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">void</code></p>
          </td>
          <td class="table-cell"/>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">WriteAllLines</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">string[]</code>, <code class="inlineCode">IEnumerable&lt;string&gt;</code>, <code class="inlineCode">Encoding</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">void</code></p>
          </td>
          <td class="table-cell"/>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">AppendAllLines</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">string[]</code>, <code class="inlineCode">IEnumerable&lt;string&gt;</code>, <code class="inlineCode">Encoding</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">void</code></p>
          </td>
          <td class="table-cell"/>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 9.2: File class and its methods</p>
    <p class="normal">Now that you’ve learned some common ways to work with the directories and files in a filesystem, we <a id="_idIndexMarker1428"/>next need to learn how to read and write data stored in a file, that is, how to work with streams.</p>
    <h1 id="_idParaDest-569" class="heading-1">Reading and writing with streams</h1>
    <p class="normal">In <em class="chapterRef">Chapter 10</em>, <em class="italic">Working with Data Using Entity Framework Core</em>, you will use a file named <code class="inlineCode">Northwind.db</code>, but<a id="_idIndexMarker1429"/> you will not work with the file directly. Instead, you will interact with the SQLite database engine, which, in turn, will read and write to the file. In scenarios where there is no other system that “owns” the file and does the reading and writing for you, you will use a file stream to work directly with the file.</p>
    <p class="normal">A <strong class="keyWord">stream</strong> is a sequence of bytes that can be read from and written to. Although files can be processed rather like arrays, with random access provided by knowing the position of a byte within the file, it is more efficient to process a file as a stream in which the bytes can be accessed in sequential order. When a human does the processing, they tend to need random access so that they can jump around the data, make changes, and then return to the data they worked on earlier. When an automated system does the processing, it tends to be able to work sequentially and only needs to “touch” the data once.</p>
    <p class="normal">Streams can also be used to process terminal input and output and networking resources, such as sockets and ports, that do not provide random access and cannot seek (that is, move) to a position. You can write code to process some arbitrary bytes without knowing or caring where they come from. Your code simply reads or <a id="_idIndexMarker1430"/>writes to a stream, and another piece of code handles where the bytes are stored.</p>
    <h2 id="_idParaDest-570" class="heading-2">Understanding abstract and concrete streams</h2>
    <p class="normal">There is an <code class="inlineCode">abstract</code> class named <code class="inlineCode">Stream</code> that represents any type of stream. Remember <a id="_idIndexMarker1431"/>that an <code class="inlineCode">abstract</code> class cannot <a id="_idIndexMarker1432"/>be instantiated<a id="_idIndexMarker1433"/> using <code class="inlineCode">new</code>; it can only be inherited. This is because it is only partially implemented.</p>
    <p class="normal">There are many concrete classes that inherit from this base class, including <code class="inlineCode">FileStream</code>, <code class="inlineCode">MemoryStream</code>, <code class="inlineCode">BufferedStream</code>, <code class="inlineCode">GZipStream</code>, and <code class="inlineCode">SslStream</code>. They all work the same way. All streams implement <code class="inlineCode">IDisposable</code>, so they have a <code class="inlineCode">Dispose</code> method to release unmanaged resources.</p>
    <p class="normal">Some of the common members of the <code class="inlineCode">Stream</code> class are described in <em class="italic">Table 9.3</em>:</p>
    <table id="table003-6" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Member</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">CanRead</code> and <code class="inlineCode">CanWrite</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">These properties determine if you can read from and write to the stream.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Length</code> and <code class="inlineCode">Position</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">These properties determine the total number of bytes and the current position within the stream. These properties may throw a <code class="inlineCode">NotSupportedException</code> for some types of streams, for example, if <code class="inlineCode">CanSeek</code> returns <code class="inlineCode">false</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Close</code> and <code class="inlineCode">Dispose</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This method closes the stream and releases its resources. You can call either method, since the implementation of <code class="inlineCode">Dispose</code> calls <code class="inlineCode">Close</code>!</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Flush</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">If the stream has a buffer, then this method writes the bytes in the buffer to the stream, and the buffer is cleared.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">CanSeek</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This property determines if the <code class="inlineCode">Seek</code> method can be used.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Seek</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This method moves the current position to the one specified in its parameter.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Read</code> and <code class="inlineCode">ReadAsync</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">These methods read a specified number of bytes from the stream into a byte array and advance the position.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">ReadByte</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This method reads the next byte from the stream and advances the position.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Write</code> and <code class="inlineCode">WriteAsync</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">These methods write the contents of a byte array into the stream.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">WriteByte</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This <a id="_idIndexMarker1434"/>method<a id="_idIndexMarker1435"/> writes <a id="_idIndexMarker1436"/>a byte to the stream.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 9.3: Common members of the Stream class</p>
    <h2 id="_idParaDest-571" class="heading-2">Understanding storage streams</h2>
    <p class="normal">Some storage <a id="_idIndexMarker1437"/>streams that represent a location where bytes <a id="_idIndexMarker1438"/>will be stored are described in <em class="italic">Table 9.4</em>:</p>
    <table id="table004-6" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Namespace</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Class</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System.IO</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">FileStream</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Bytes stored in the filesystem</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System.IO</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">MemoryStream</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Bytes stored in memory in the current process</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System.Net.Sockets</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">NetworkStream</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Bytes stored at a network location</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 9.4: Storage stream classes</p>
    <div><p class="normal"><code class="inlineCode">FileStream</code> has been rewritten in .NET 6 to have much higher performance and reliability on Windows. You can read more about this at the following link: <a href="https://devblogs.microsoft.com/dotnet/file-io-improvements-in-dotnet-6/">https://devblogs.microsoft.com/dotnet/file-io-improvements-in-dotnet-6/</a>.</p>
    </div>
    <h2 id="_idParaDest-572" class="heading-2">Understanding function streams</h2>
    <p class="normal">Function streams<a id="_idIndexMarker1439"/> cannot exist on their own and can only be “plugged into” other<a id="_idIndexMarker1440"/> streams to add functionality. Some are described in <em class="italic">Table 9.5</em>:</p>
    <table id="table005-5" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Namespace</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Class</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System.Security.Cryptography</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">CryptoStream</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This encrypts and decrypts the stream.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System.IO.Compression</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">GZipStream</code>, <code class="inlineCode">DeflateStream</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">These compress and decompress the stream.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System.Net.Security</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">AuthenticatedStream</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This sends credentials across the stream.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 9.5: Function stream classes</p>
    <h2 id="_idParaDest-573" class="heading-2">Understanding stream helpers</h2>
    <p class="normal">Although there <a id="_idIndexMarker1441"/>will be occasions where you need to work with <a id="_idIndexMarker1442"/>streams at a low level, most often, you can plug helper classes into the chain to make things easier. All the helper types for streams implement <code class="inlineCode">IDisposable</code>, so they have a <code class="inlineCode">Dispose</code> method to release unmanaged resources.</p>
    <p class="normal">Some helper classes to handle common scenarios are described in <em class="italic">Table 9.6</em>:</p>
    <table id="table006-5" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Namespace</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Class</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System.IO</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">StreamReader</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This reads from the underlying stream as plain text.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System.IO</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">StreamWriter</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This writes to the underlying stream as plain text.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System.IO</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">BinaryReader</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This reads from streams as .NET types. For example, the <code class="inlineCode">ReadDecimal</code> method reads the next 16 bytes from the underlying stream as a <code class="inlineCode">decimal</code> value, and the <code class="inlineCode">ReadInt32</code> method reads the next 4 bytes as an <code class="inlineCode">int</code> value.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System.IO</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">BinaryWriter</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This writes to streams as .NET types. For example, the <code class="inlineCode">Write</code> method with a <code class="inlineCode">decimal</code> parameter writes 16 bytes to the underlying stream, and the <code class="inlineCode">Write</code> method with an <code class="inlineCode">int</code> parameter writes 4 bytes.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System.Xml</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">XmlReader</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This reads from the underlying stream using the XML format.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">System.Xml</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">XmlWriter</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">This writes to the underlying stream using the XML format.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 9.6: Stream helper classes</p>
    <h2 id="_idParaDest-574" class="heading-2">Building a stream pipeline</h2>
    <p class="normal">It is very <a id="_idIndexMarker1443"/>common to combine a helper, like <code class="inlineCode">StreamWriter</code>, and multiple function streams, like <code class="inlineCode">GZipStream</code> and <code class="inlineCode">CryptoStream</code>, with a storage stream, like <code class="inlineCode">FileStream</code>, into a pipeline, as shown in <em class="italic">Figure 9.4</em>:</p>
    <figure class="mediaobject"><img src="img/B22322_09_04.png" alt="" width="878" height="74"/></figure>
    <p class="packt_figref">Figure 9.4: Writing plain text, and then encrypting and compressing it into a file stream</p>
    <p class="normal">Your code would just call a simple helper method, like <code class="inlineCode">WriteLine</code>, to send a <code class="inlineCode">string</code> value, like <code class="inlineCode">"Hello"</code>, through the pipeline until it arrives at its final destination, having been compressed and then encrypted so that it gets written to the file as <code class="inlineCode">"</code><code class="inlineCode">G7x"</code> (or whatever it would be).</p>
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: “<em class="italic">Good encryption will generate relatively uncompressible data. If you switch the order of the operations so that you first compress and then encrypt, not only should you end up with a smaller file, but the encryption will most likely take less time as it’ll be operating on less data</em>.” From an article by Stephen Toub: <a href="https://learn.microsoft.com/en-us/archive/msdn-magazine/2008/february/net-matters-stream-pipeline">https://learn.microsoft.com/en-us/archive/msdn-magazine/2008/february/net-matters-stream-pipeline</a>.</p>
    </div>
    <h2 id="_idParaDest-575" class="heading-2">Writing to text streams</h2>
    <p class="normal">When you <a id="_idIndexMarker1444"/>open a file to read or write to it, you use <a id="_idIndexMarker1445"/>resources outside of .NET. These are called <strong class="keyWord">unmanaged resources</strong> and <a id="_idIndexMarker1446"/>must be disposed of when you are done working with them.</p>
    <p class="normal">To deterministically control when these resources are disposed of, we can call the <code class="inlineCode">Dispose</code> method. When the <code class="inlineCode">Stream</code> class was first designed, all cleanup code was expected to go in the <code class="inlineCode">Close</code> method. But later, the concept of <code class="inlineCode">IDisposable</code> was added to .NET, and <code class="inlineCode">Stream</code> had to implement a <code class="inlineCode">Dispose</code> method. Later, the <code class="inlineCode">using</code> statement was added to .NET, which can automatically call <code class="inlineCode">Dispose</code>. So today, you can call either <code class="inlineCode">Close</code> or <code class="inlineCode">Dispose</code>, which actually do the same thing.</p>
    <p class="normal">Let’s type some code to write text to a stream:</p>
    <ol>
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code> project, named <code class="inlineCode">WorkingWithStreams</code>, to the <code class="inlineCode">Chapter09</code> solution:</li>
      <li class="numberedList">In the project file, add an element to import the <code class="inlineCode">System.Console</code>, <code class="inlineCode">System.Environment</code>, and <code class="inlineCode">System.IO.Path</code> classes, statically and globally.</li>
      <li class="numberedList">Add a new class file named <code class="inlineCode">Program.Helpers.cs</code>.</li>
      <li class="numberedList">In <code class="inlineCode">Program.Helpers.cs</code>, add a partial <code class="inlineCode">Program</code> class with a <code class="inlineCode">SectionTitle</code> and an <code class="inlineCode">OutputFileInfo</code> method, as <a id="_idIndexMarker1447"/>shown in<a id="_idIndexMarker1448"/> the following code:
        <pre class="programlisting code-one"><code class="hljs-code">// null namespace to merge with auto-generated Program.
partial class Program
{
  private static void SectionTitle(string title)
  {
    ConsoleColor previousColor = ForegroundColor;
    ForegroundColor = ConsoleColor.DarkYellow;
    WriteLine($"*** {title} ***");
    ForegroundColor = previousColor;
  }
  private static void OutputFileInfo(string path)
  {
    WriteLine("**** File Info ****");
    WriteLine($"File: {GetFileName(path)}");
    WriteLine($"Path: {GetDirectoryName(path)}");
    WriteLine($"Size: {new FileInfo(path).Length:N0} bytes.");
    WriteLine("/------------------");
    WriteLine(File.ReadAllText(path));
    WriteLine("------------------/");
  }
}
</code></pre>
      </li>
      <li class="numberedList">Add a new class file named <code class="inlineCode">Viper.cs</code>.</li>
      <li class="numberedList">In <code class="inlineCode">Viper.cs</code>, define a static class named <code class="inlineCode">Viper</code> with a static array of <code class="inlineCode">string</code> values, named <code class="inlineCode">Callsigns</code>, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">namespace Packt.Shared;
public static class Viper
{
  // Define an array of Viper pilot call signs.
  public static string[] Callsigns = new[]
  {
    "Husker", "Starbuck", "Apollo", "Boomer",
    "Bulldog", "Athena", "Helo", "Racetrack"
  };
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete the existing statements, and then import the namespace to <a id="_idIndexMarker1449"/>work with the <code class="inlineCode">Viper</code> class, as<a id="_idIndexMarker1450"/> shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">using Packt.Shared; // To use Viper.
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, add statements to enumerate the <code class="inlineCode">Viper</code> call signs, writing each one on its own line in a single text file, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">SectionTitle("Writing to text streams");
// Define a file to write to.
string textFile = Combine(CurrentDirectory, "streams.txt");
// Create a text file and return a helper writer.
StreamWriter text = File.CreateText(textFile);
// Enumerate the strings, writing each one to the stream
// on a separate line.
foreach (string item in Viper.Callsigns)
{
  text.WriteLine(item);
}
text.Close(); // Release unmanaged file resources.
OutputFileInfo(textFile);
</code></pre>
      </li>
    </ol>
    <div><p class="normal">Calling <code class="inlineCode">Close</code> on the stream writer helper will call <code class="inlineCode">Close</code> on the underlying stream. This in turn calls <code class="inlineCode">Dispose</code> to release unmanaged file resources.</p>
    </div>
    <ol>
      <li class="numberedList" value="9">Run the code and view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">**** File Info ****
File: streams.txt
Path: C:\cs13net9\Chapter09\WorkingWithStreams\bin\Debug\net9.0
Size: 68 bytes.
/------------------
Husker
Starbuck
Apollo
Boomer
Bulldog
Athena
Helo
Racetrack
------------------/
</code></pre>
      </li>
      <li class="numberedList">Open the<a id="_idIndexMarker1451"/> file<a id="_idIndexMarker1452"/> that was created, and confirm that it contains the list of call signs as well as a blank line, as we are effectively calling <code class="inlineCode">WriteLine</code> twice: once when we write the last call sign to the file, and again when we read the whole file and write it out to the console.</li>
    </ol>
    <div><p class="normal">Remember that if you run the project at the command prompt using <code class="inlineCode">dotnet run</code>, then the path <a id="_idIndexMarker1453"/>will be the project folder. It will not include <code class="inlineCode">bin\Debug\net9.0</code>.</p>
    </div>
    <h2 id="_idParaDest-576" class="heading-2">Writing to XML streams</h2>
    <p class="normal">There are<a id="_idIndexMarker1454"/> two <a id="_idIndexMarker1455"/>ways to write an XML element, as follows:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">WriteStartElement</code> and <code class="inlineCode">WriteEndElement</code>: Use this pair when an element might have child elements.</li>
      <li class="bulletList"><code class="inlineCode">WriteElementString</code>: Use this when an element does not have children.</li>
    </ul>
    <p class="normal">Now, let’s try storing the Viper pilot call signs array of <code class="inlineCode">string</code> values in an XML file:</p>
    <ol>
      <li class="numberedList" value="1">At the top of <code class="inlineCode">Program.cs</code>, import the <code class="inlineCode">System.Xml</code> namespace, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">using System.Xml; // To use XmlWriter and so on.
</code></pre>
      </li>
      <li class="numberedList">At the bottom of <code class="inlineCode">Program.cs</code>, add statements that enumerate the call signs, writing each one as an element in a single XML file, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">SectionTitle("Writing to XML streams");
// Define a file path to write to.
string xmlFile = Combine(CurrentDirectory, "streams.xml");
// Declare variables for the filestream and XML writer.
FileStream? xmlFileStream = null;
XmlWriter? xml = null;
try
{
  xmlFileStream = File.Create(xmlFile);
  // Wrap the file stream in an XML writer helper and tell it
  // to automatically indent nested elements.
  xml = XmlWriter.Create(xmlFileStream,
    new XmlWriterSettings { Indent = true });
  // Write the XML declaration.
  xml.WriteStartDocument();
  // Write a root element.
  xml.WriteStartElement("callsigns");
  // Enumerate the strings, writing each one to the stream.
  foreach (string item in Viper.Callsigns)
  {
    xml.WriteElementString("callsign", item);
  }
  // Write the close root element.
  xml.WriteEndElement();
}
catch (Exception ex)
{
  // If the path doesn't exist the exception will be caught.
  WriteLine($"{ex.GetType()} says {ex.Message}");
}
finally
{
  if (xml is not null)
  {
    xml.Close();
    WriteLine("The XML writer's unmanaged resources have been disposed.");
  }
  if (xmlFileStream is not null)
  {
    xmlFileStream.Close();
    WriteLine("The file stream's unmanaged resources have been disposed.");
  }
}
OutputFileInfo(xmlFile);
</code></pre>
      </li>
      <li class="numberedList">Optionally, right-click in the <code class="inlineCode">Close</code> method of <code class="inlineCode">xmlFileStream</code>, select <strong class="screenText">Go To Implementation</strong>, and note the implementations of the <code class="inlineCode">Dispose</code>, <code class="inlineCode">Close</code>, and <code class="inlineCode">Dispose(bool)</code> methods, as <a id="_idIndexMarker1456"/>shown<a id="_idIndexMarker1457"/> in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">public void Dispose() =&gt; Close();
public virtual void Close()
{
  // When initially designed, Stream required that all cleanup logic
  // went into Close(), but this was thought up before IDisposable
  // was added and never revisited. All subclasses
  // should put their cleanup now in Dispose(bool).
  Dispose(true);
  GC.SuppressFinalize(this);
}
protected virtual void Dispose(bool disposing)
{
  // Note: Never change this to call other virtual methods on Stream
  // like Write, since the state on subclasses has already been
  // torn down.  This is the last code to run on cleanup for a stream.
}
</code></pre>
      </li>
    </ol>
    <div><p class="normal">The <code class="inlineCode">Close</code> and <code class="inlineCode">Dispose(bool)</code> methods are <code class="inlineCode">virtual</code> in the <code class="inlineCode">Stream</code> class because they are designed to be overridden in a derived class, like <code class="inlineCode">FileStream</code>, to do the work of releasing unmanaged resources.</p>
    </div>
    <ol>
      <li class="numberedList" value="4">Run the code and view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">**** File Info ****
The XML writer's unmanaged resources have been disposed.
The file stream's unmanaged resources have been disposed.
File: streams.xml
Path: C:\cs13net9\Chapter09\WorkingWithStreams\bin\Debug\net9.0
Size: 320 bytes.
/------------------
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;callsigns&gt;
  &lt;callsign&gt;Husker&lt;/callsign&gt;
  &lt;callsign&gt;Starbuck&lt;/callsign&gt;
  &lt;callsign&gt;Apollo&lt;/callsign&gt;
  &lt;callsign&gt;Boomer&lt;/callsign&gt;
  &lt;callsign&gt;Bulldog&lt;/callsign&gt;
  &lt;callsign&gt;Athena&lt;/callsign&gt;
  &lt;callsign&gt;Helo&lt;/callsign&gt;
  &lt;callsign&gt;Racetrack&lt;/callsign&gt;
&lt;/callsigns&gt;
-------------------/
</code></pre>
      </li>
    </ol>
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: Before <a id="_idIndexMarker1458"/>calling the <code class="inlineCode">Dispose</code> method, check<a id="_idIndexMarker1459"/> that the object is not <code class="inlineCode">null</code>.</p>
    </div>
    <h2 id="_idParaDest-577" class="heading-2">Simplifying disposal by using the using statement</h2>
    <p class="normal">You can<a id="_idIndexMarker1460"/> simplify the code that<a id="_idIndexMarker1461"/> needs to check for a <code class="inlineCode">null</code> object and then call its <code class="inlineCode">Dispose</code> method by using the <code class="inlineCode">using</code> statement. Unless you need a greater level of control, I would generally recommend using <code class="inlineCode">using</code> rather than manually calling <code class="inlineCode">Dispose</code>, as it’s less code to write.</p>
    <p class="normal">Confusingly, there are two uses for the <code class="inlineCode">using</code> keyword: importing a namespace and generating a <code class="inlineCode">finally</code> statement that calls <code class="inlineCode">Dispose</code> on an object implementing <code class="inlineCode">IDisposable</code>.</p>
    <p class="normal">The compiler changes a <code class="inlineCode">using</code> statement block into a <code class="inlineCode">try</code>-<code class="inlineCode">finally</code> statement without a <code class="inlineCode">catch</code> statement. You can use nested <code class="inlineCode">try</code> statements, so if you do want to catch any exceptions, you can, as shown in the following code example:</p>
    <pre class="programlisting code"><code class="hljs-code">using (FileStream file2 = File.OpenWrite(
  Path.Combine(path, "file2.txt")))
{
  using (StreamWriter writer2 = new StreamWriter(file2))
  {
    try
    {
      writer2.WriteLine("Welcome, .NET!");
    }
    catch(Exception ex)
    {
      WriteLine($"{ex.GetType()} says {ex.Message}");
    }
  } // Automatically calls Dispose if the object is not null.
} // Automatically calls Dispose if the object is not null.
</code></pre>
    <p class="normal">You can even<a id="_idIndexMarker1462"/> simplify the code further by not explicitly specifying the braces and indentation for the <code class="inlineCode">using</code> statements, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">using FileStream file2 = File.OpenWrite(
  Path.Combine(path, "file2.txt"));
using StreamWriter writer2 = new(file2);
try
{
  writer2.WriteLine("Welcome, .NET!");
}
catch(Exception ex)
{
  WriteLine($"{ex.GetType()} says {ex.Message}");
}
</code></pre>
    <p class="normal">To make this clearer, let’s review a simpler example. You can use a <code class="inlineCode">using</code> block to ensure that the <code class="inlineCode">Dispose</code> method is called at the end of the scope, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">using (ObjectWithUnmanagedResources thing = new())
{
  // Statements that use thing.
}
</code></pre>
    <div><p class="normal"><strong class="keyWord">More Information</strong>: You can learn how the preceding code is lowered into a <code class="inlineCode">try-catch</code> block at the following link: <a href="https://github.com/markjprice/cs13net9/blob/main/docs/ch06-memory.md#ensuring-that-dispose-is-called">https://github.com/markjprice/cs13net9/blob/main/docs/ch06-memory.md#ensuring-that-dispose-is-called</a>. If you haven’t already, you should also read the following online section: <a href="https://github.com/markjprice/cs13net9/blob/main/docs/ch06-memory.md#releasing-unmanaged-resources">https://github.com/markjprice/cs13net9/blob/main/docs/ch06-memory.md#releasing-unmanaged-resources</a>.</p>
    </div>
    <p class="normal">You can also <a id="_idIndexMarker1463"/>use a simplified<a id="_idIndexMarker1464"/> syntax without braces, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">using ObjectWithUnmanagedResources thing = new();
// Statements that use thing.
// Dispose called at the end of the container scope e.g. method.
</code></pre>
    <p class="normal">In the preceding code example, there is no explicit block defined by braces, so an implicit block is defined<a id="_idIndexMarker1465"/> that ends at the<a id="_idIndexMarker1466"/> end of the containing scope.</p>
    <div><p class="normal"><strong class="keyWord">More Information</strong>: You can learn more about this at the following links: <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/proposals/csharp-8.0/using">https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/proposals/csharp-8.0/using</a> and <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/statements#1314-the-using-statement">https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/statements#1314-the-using-statement</a>.</p>
    </div>
    <h2 id="_idParaDest-578" class="heading-2">Compressing streams</h2>
    <p class="normal">XML is relatively<a id="_idIndexMarker1467"/> verbose, so it takes up more space in bytes than plain text. Let’s see how we can squeeze the XML using a common compression algorithm, known as GZIP.</p>
    <p class="normal">In .NET Core 2.1, Microsoft introduced an implementation of the Brotli compression algorithm. In performance, Brotli is like the algorithm used in DEFLATE and GZIP, but the output is about 20% denser.</p>
    <p class="normal">Let’s compare the two compression algorithms:</p>
    <ol>
      <li class="numberedList" value="1">Add a new class file named <code class="inlineCode">Program.Compress.cs</code>.</li>
      <li class="numberedList">In <code class="inlineCode">Program.Compress.cs</code>, write statements to use instances of <code class="inlineCode">GZipStream</code> or <code class="inlineCode">BrotliStream</code> to create a compressed file that contains the same XML elements as before, and then decompress it while reading it and outputting to the console, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">using Packt.Shared; // To use Viper.
using System.IO.Compression; // To use BrotliStream, GZipStream.
using System.Xml; // To use XmlWriter, XmlReader.
partial class Program
{
  private static void Compress(string algorithm = "gzip")
  {
    // Define a file path using the algorithm as file extension.
    string filePath = Combine(
      CurrentDirectory, $"streams.{algorithm}");
    FileStream file = File.Create(filePath);
    Stream compressor;
    if (algorithm == "gzip")
    {
      compressor = new GZipStream(file, CompressionMode.Compress);
    }
    else
    {
      compressor = new BrotliStream(file, CompressionMode.Compress);
    }
    using (compressor)
    {
      using (XmlWriter xml = XmlWriter.Create(compressor))
      {
        xml.WriteStartDocument();
        xml.WriteStartElement("callsigns");
        foreach (string item in Viper.Callsigns)
        {
          xml.WriteElementString("callsign", item);
        }
      }
    } // Also closes the underlying stream.
    OutputFileInfo(filePath);
    // Read the compressed file.
    WriteLine("Reading the compressed XML file:");
    file = File.Open(filePath, FileMode.Open);
    Stream decompressor;
    if (algorithm == "gzip")
    {
      decompressor = new GZipStream(
        file, CompressionMode.Decompress);
    }
    else
    {
      decompressor = new BrotliStream(
        file, CompressionMode.Decompress);
    }
    using (decompressor)
  
    using (XmlReader reader = XmlReader.Create(decompressor))
  
    while (reader.Read())
    {
      // Check if we are on an element node named callsign.
      if ((reader.NodeType == XmlNodeType.Element)
        &amp;&amp; (reader.Name == "callsign"))
      {
        reader.Read(); // Move to the text inside element.
        WriteLine($"{reader.Value}"); // Read its value.
      }
      // Alternative syntax with property pattern matching:
      // if (reader is { NodeType: XmlNodeType.Element,
      //   Name: "callsign" })
    }
  }
}
</code></pre>
      </li>
    </ol>
    <div><p class="normal">The code that uses the <code class="inlineCode">decompressor</code> object does not use the simplified <code class="inlineCode">using</code> syntax. Instead, it uses the fact that <code class="inlineCode">using</code> blocks can omit their braces for a single “statement,” just like <code class="inlineCode">if</code> statements. Remember that <code class="inlineCode">if</code> statements can have explicit braces even if only one statement is executed within a block, as shown in the <a id="_idIndexMarker1468"/>following code:</p>
      <pre class="programlisting code"><code class="hljs-code">if (c = 1)
{
// Execute a single statement.
}
if (c = 1)
// Execute a single statement.
using (someObject)
{
// Execute a single statement.
}
using (someObject)
// Execute a single statement
</code></pre>
      <p class="normal">In the preceding code, <code class="inlineCode">using (XmlReader reader = XmlReader.Create(decompressor))</code> and the entire <code class="inlineCode">while (reader.Read()) { ... }</code> block are equivalent to single statements, so we can remove the braces and the code works as expected.</p>
    </div>
    <ol>
      <li class="numberedList" value="3">In <code class="inlineCode">Program.cs</code>, add calls to <code class="inlineCode">Compress</code> with parameters to use the <code class="inlineCode">gzip</code> and <code class="inlineCode">brotli</code> algorithms, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">SectionTitle("Compressing streams");
Compress(algorithm: "gzip");
Compress(algorithm: "brotli");
</code></pre>
      </li>
      <li class="numberedList">Run the code, and compare the sizes of the XML file and the compressed<a id="_idIndexMarker1469"/> XML file using the <code class="inlineCode">gzip</code> and <code class="inlineCode">brotli</code> algorithms, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">**** File Info ****
File: streams.gzip
Path: C:\cs13net9\Chapter09\WorkingWithStreams\bin\Debug\net9.0
Size: 151 bytes.
/------------------
­?
z?{??}En?BYjQqf~???????Bj^r~Jf^??RiI??????MrbNNqfz^1?i?QZ??Zd?@H?$%?&amp;gc?t,
?????*????H?????t?&amp;?d??%b??H?aUPbrjIQ"??b;????9
------------------/
Reading the compressed XML file:
Husker
Starbuck
Apollo
Boomer
Bulldog
Athena
Helo
Racetrack
**** File Info ****
File: streams.brotli
Path: C:\cs13net9\Chapter09\WorkingWithStreams\bin\Debug\net9.0
Size: 117 bytes.
/-------------------
 ??d?&amp;?_????\@?Gm????/?h&gt;?6????? ??^?__???wE?'?t&lt;J??]??
???b?\fA?&gt;?+??F??]
?T?\?~??A?J?Q?q6 ?-??
???
--------------------/
Reading the compressed XML file:
Husker
Starbuck
Apollo
Boomer
Bulldog
Athena
Helo
Racetrack
</code></pre>
      </li>
    </ol>
    <p class="normal">To summarize<a id="_idIndexMarker1470"/> the file sizes:</p>
    <ul>
      <li class="bulletList">Uncompressed: 320 bytes</li>
      <li class="bulletList">GZIP-compressed: 151 bytes</li>
      <li class="bulletList">Brotli-compressed: 117 bytes</li>
    </ul>
    <div><p class="normal">As well as choosing a compression mode, you can also choose a compression level. You can learn more about this at the following link: <a href="https://learn.microsoft.com/en-us/dotnet/api/system.io.compression.compressionlevel">https://learn.microsoft.com/en-us/dotnet/api/system.io.compression.compressionlevel</a>.</p>
    </div>
    <h2 id="_idParaDest-579" class="heading-2">Reading and writing with random access handles</h2>
    <p class="normal">For the first 20 years <a id="_idIndexMarker1471"/>of .NET’s life, the <a id="_idIndexMarker1472"/>only API to work directly with files was the one for stream classes. These work great for automated tasks that only need to process data sequentially. But when a human interacts with the data, they often want to jump around and return multiple times to the same location.</p>
    <p class="normal">With .NET 6 and later, there is a new API for working with files without needing a file stream and in a random access way. Let’s see a simple example:</p>
    <ol>
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code> project named <code class="inlineCode">WorkingWithRandomAccess</code> to the <code class="inlineCode">Chapter09</code> solution:</li>
      <li class="numberedList">In the project file, add an element to import the <code class="inlineCode">System.Console</code> class statically and globally.</li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete the existing statements, and then get a handle to a file named <code class="inlineCode">coffee.txt</code>, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">using Microsoft.Win32.SafeHandles; // To use SafeFileHandle.
using System.Text; // To use Encoding.
using SafeFileHandle handle =
  File.OpenHandle(path: "coffee.txt",
    mode: FileMode.OpenOrCreate,
    access: FileAccess.ReadWrite);
</code></pre>
      </li>
      <li class="numberedList">Write some<a id="_idIndexMarker1473"/> text encoded as a byte array, and then store it in a read-only memory buffer to the file, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">string message = "Café £4.39";
ReadOnlyMemory&lt;byte&gt; buffer = new(Encoding.UTF8.GetBytes(message));
await RandomAccess.WriteAsync(handle, buffer, fileOffset: 0);
</code></pre>
      </li>
      <li class="numberedList">To read from the file, get the length of the file, allocate a memory buffer for the contents using that length, and then read the file, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">long length = RandomAccess.GetLength(handle);
Memory&lt;byte&gt; contentBytes = new(new byte[length]);
await RandomAccess.ReadAsync(handle, contentBytes, fileOffset: 0);
string content = Encoding.UTF8.GetString(contentBytes.ToArray());
WriteLine($"Content of file: {content}");
</code></pre>
      </li>
      <li class="numberedList">Run the code, and<a id="_idIndexMarker1474"/> note the content of the file, as shown in the following<a id="_idIndexMarker1475"/> output:
        <pre class="programlisting con-one"><code class="hljs-con">Content of file: Café £4.39
</code></pre>
      </li>
    </ol>
    <h1 id="_idParaDest-580" class="heading-1">Encoding and decoding text</h1>
    <p class="normal">Text characters<a id="_idIndexMarker1476"/> can be represented in different ways. For example, the<a id="_idIndexMarker1477"/> alphabet can be encoded using Morse code into a series of dots and dashes for transmission over a telegraph line.</p>
    <p class="normal">In a similar way, text inside a computer is stored as bits (ones and zeros) representing a code point within a code space. Most code points represent a single character, but they can also have other meanings, like formatting.</p>
    <p class="normal">For example, ASCII has a code space with 128 code points. .NET uses a standard called <strong class="keyWord">Unicode</strong> to encode<a id="_idIndexMarker1478"/> text internally. Unicode has more than 1 million code points.</p>
    <p class="normal">Sometimes, you will need to move text outside .NET for use by systems that do not use Unicode or a variation of it, so it is important to learn how to convert between encodings.</p>
    <p class="normal">Some common text encodings used by computers are shown in <em class="italic">Table 9.7</em>:</p>
    <table id="table007-2" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Encoding</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">ASCII</p>
          </td>
          <td class="table-cell">
            <p class="normal">This encodes a limited range of characters using the lower 7 bits of a byte.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">UTF-8</p>
          </td>
          <td class="table-cell">
            <p class="normal">This represents each Unicode code point as a sequence of 1 to 4 bytes.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">UTF-7</p>
          </td>
          <td class="table-cell">
            <p class="normal">This is designed to be more efficient over 7-bit channels than UTF-8, but it has security and robustness issues, so UTF-8 is recommended over UTF-7.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">UTF-16</p>
          </td>
          <td class="table-cell">
            <p class="normal">This represents each Unicode code point as a sequence of one or two 16-bit integers.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">UTF-32</p>
          </td>
          <td class="table-cell">
            <p class="normal">This represents each Unicode code point as a 32-bit integer and is, therefore, a fixed-length encoding, unlike the other Unicode encodings, which are all variable-length encodings.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">ANSI/ISO encodings</p>
          </td>
          <td class="table-cell">
            <p class="normal">This provides support for a variety of code pages that are used to support a specific language or group of languages.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 9.7: Common text encodings</p>
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: In most<a id="_idIndexMarker1479"/> cases <a id="_idIndexMarker1480"/>today, UTF-8 is a good default, which is why it is literally the default encoding, that is, <code class="inlineCode">Encoding.Default</code>. You should avoid using <code class="inlineCode">Encoding.UTF7</code> because it is not secure. Due to this, the C# compiler will warn you when you try to use UTF-7. Of course, you might need to generate text using that encoding for compatibility with another system, so it needs to remain an option in .NET.</p>
    </div>
    <h2 id="_idParaDest-581" class="heading-2">Encoding strings as byte arrays</h2>
    <p class="normal">Let’s<a id="_idIndexMarker1481"/> explore<a id="_idIndexMarker1482"/> text <a id="_idIndexMarker1483"/>encodings:</p>
    <ol>
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code> project, named <code class="inlineCode">WorkingWithEncodings</code>, to the <code class="inlineCode">Chapter09</code> solution.</li>
      <li class="numberedList">In the project file, add an element to statically and globally import the <code class="inlineCode">System.Console</code> class.</li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete the existing statements, import the <code class="inlineCode">System.Text</code> namespace, add statements to encode a <code class="inlineCode">string</code> using an encoding chosen by the user, loop through each byte, and then decode the encoded value back into a <code class="inlineCode">string</code> and output it, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">using System.Text; // To use Encoding.
WriteLine("Encodings");
WriteLine("[1] ASCII");
WriteLine("[2] UTF-7");
WriteLine("[3] UTF-8");
WriteLine("[4] UTF-16 (Unicode)");
WriteLine("[5] UTF-32");
WriteLine("[6] Latin1");
WriteLine("[any other key] Default encoding");
WriteLine();
Write("Press a number to choose an encoding.");
ConsoleKey number = ReadKey(intercept: true).Key;
WriteLine(); WriteLine();
Encoding encoder = number switch
{
  ConsoleKey.D1 or ConsoleKey.NumPad1 =&gt; Encoding.ASCII,
  ConsoleKey.D2 or ConsoleKey.NumPad2 =&gt; Encoding.UTF7,
  ConsoleKey.D3 or ConsoleKey.NumPad3 =&gt; Encoding.UTF8,
  ConsoleKey.D4 or ConsoleKey.NumPad4 =&gt; Encoding.Unicode,
  ConsoleKey.D5 or ConsoleKey.NumPad5 =&gt; Encoding.UTF32,
  ConsoleKey.D6 or ConsoleKey.NumPad6 =&gt; Encoding.Latin1,
  _  =&gt; Encoding.Default
};
// Define a string to encode
string message = "Café £4.39";
WriteLine($"Text to encode: {message}  Characters: {message.Length}.");
// Encode the string into a byte array.
byte[] encoded = encoder.GetBytes(message);
// Check how many bytes the encoding needed.
WriteLine("{0} used {1:N0} bytes.",
  encoder.GetType().Name, encoded.Length);
WriteLine();
// Enumerate each byte.
WriteLine("BYTE | HEX | CHAR");
foreach (byte b in encoded)
{
  WriteLine($"{b,4} | {b,3:X} | {(char)b,4}");
}
// Decode the byte array back into a string and display it.
string decoded = encoder.GetString(encoded);
WriteLine($"Decoded: {decoded}");
</code></pre>
      </li>
      <li class="numberedList">Run the code, press <em class="keystroke">1</em> to <a id="_idIndexMarker1484"/>choose <a id="_idIndexMarker1485"/>ASCII, and note that <a id="_idIndexMarker1486"/>when outputting the bytes, the pound sign (<code class="inlineCode">£</code>) and accented e (<code class="inlineCode">é</code>) cannot be represented in ASCII, so it uses a question mark instead:
        <pre class="programlisting con-one"><code class="hljs-con">Text to encode: Café £4.39  Characters: 10
ASCIIEncodingSealed used 10 bytes.
BYTE | HEX | CHAR
  67 |  43 |    C
  97 |  61 |    a
 102 |  66 |    f
  63 |  3F |    ?
  32 |  20 |
  63 |  3F |    ?
  52 |  34 |    4
  46 |  2E |    .
  51 |  33 |    3
  57 |  39 |    9
Decoded: Caf? ?4.39
</code></pre>
      </li>
      <li class="numberedList">Rerun the code and press <em class="keystroke">3</em> to choose UTF-8. Note that UTF-8 requires 2 extra bytes for the two characters that need 2 bytes each (12 bytes instead of 10 bytes in total), but it can encode and decode the <code class="inlineCode">é</code> and <code class="inlineCode">£</code> characters:
        <pre class="programlisting con-one"><code class="hljs-con">Text to encode: Café £4.39  Characters: 10
UTF8EncodingSealed used 12 bytes.
BYTE | HEX | CHAR
  67 |  43 |    C
  97 |  61 |    a
 102 |  66 |    f
 195 |  C3 |    Ã
 169 |  A9 |    ©
  32 |  20 |
 194 |  C2 |    Â
 163 |  A3 |    £
  52 |  34 |    4
  46 |  2E |    .
  51 |  33 |    3
  57 |  39 |    9
Decoded: Café £4.39
</code></pre>
      </li>
      <li class="numberedList">Rerun the code and press <em class="keystroke">4</em> to choose Unicode (UTF-16). Note that UTF-16 requires 2 bytes for every character, so 20 bytes in total, and it can<a id="_idIndexMarker1487"/> encode <a id="_idIndexMarker1488"/>and<a id="_idIndexMarker1489"/> decode the <code class="inlineCode">é</code> and <code class="inlineCode">£</code> characters. This encoding is used internally by .NET to store <code class="inlineCode">char</code> and <code class="inlineCode">string</code> values.</li>
    </ol>
    <h2 id="_idParaDest-582" class="heading-2">Encoding and decoding text in files</h2>
    <p class="normal">When using <a id="_idIndexMarker1490"/>stream helper classes, such as <code class="inlineCode">StreamReader</code> and <code class="inlineCode">StreamWriter</code>, you can specify the encoding you want to use. As you write to the helper, the text will be automatically encoded, and as you read from the helper, the bytes will be automatically decoded.</p>
    <p class="normal">To specify an encoding, pass the encoding as a second parameter to the helper type’s constructor, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">StreamReader reader = new(stream, Encoding.UTF8);
StreamWriter writer = new(stream, Encoding.UTF8);
</code></pre>
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: Often, you won’t have the choice of which encoding to use because you will generate a file for use by another system. However, if you do, pick one that uses the least number of bytes but can store every character you need.</p>
    </div>
    <h1 id="_idParaDest-583" class="heading-1">Serializing object graphs</h1>
    <p class="normal">An <strong class="keyWord">object graph</strong> is<a id="_idIndexMarker1491"/> a structure of multiple objects that are related to each other, either through a direct reference or indirectly through a chain of references.</p>
    <p class="normal"><strong class="keyWord">Serialization</strong> is the<a id="_idIndexMarker1492"/> process of converting a live object graph into a sequence of bytes using a specified <a id="_idIndexMarker1493"/>format. <strong class="keyWord">Deserialization</strong> is the reverse process.</p>
    <p class="normal">You would use serialization to save the current state of a live object so that you can recreate it in the future, for example, saving the current state of a game so that you can continue at the same place tomorrow. The stream produced from a serialized object is usually stored in a file or database.</p>
    <p class="normal">There are dozens of formats you can choose for serialization, but the two most common text-based<a id="_idIndexMarker1494"/> human-readable formats are <strong class="keyWord">eXtensible Markup Language</strong> (<strong class="keyWord">XML</strong>) and <strong class="keyWord">JavaScript Object Notation</strong> (<strong class="keyWord">JSON</strong>). There <a id="_idIndexMarker1495"/>are also more efficient binary formats like Protobuf, used by gRPC.</p>
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: JSON is more compact and is best for web and mobile applications. XML is more verbose but is better supported in more legacy systems. Use JSON to minimize the size of serialized object graphs. JSON is also a good choice when sending object graphs to web applications and mobile applications, as it is the native serialization format for JavaScript, and mobile apps often make calls over limited bandwidth, so the number of bytes is important.</p>
    </div>
    <p class="normal">.NET has multiple <a id="_idIndexMarker1496"/>classes that will serialize to and from XML and JSON. We will start by looking at <code class="inlineCode">XmlSerializer</code> and <code class="inlineCode">JsonSerializer</code>.</p>
    <h2 id="_idParaDest-584" class="heading-2">Serializing as XML</h2>
    <p class="normal">Let’s start by <a id="_idIndexMarker1497"/>looking at XML, probably the world’s <a id="_idIndexMarker1498"/>most used serialization format (for now). To show a typical example, we will define a custom class to store information about a person and then create an object graph, using a list of <code class="inlineCode">Person</code> instances with nesting:</p>
    <ol>
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Console App </strong>/ <code class="inlineCode">console</code> project named <code class="inlineCode">WorkingWithSerialization</code> to the <code class="inlineCode">Chapter09</code> solution.</li>
      <li class="numberedList">In the project file, add elements to statically and globally import the following classes:<ul>
          <li class="bulletList level-2">System.Console to use ForegroundColor and WriteLine</li>
          <li class="bulletList level-2">System.Environment to use CurrentDirectory</li>
          <li class="bulletList level-2">System.IO.Path to use Combine, GetFileName, and GetDirectoryName</li>
        </ul>
      </li>
      <li class="numberedList">Add a new class file named <code class="inlineCode">Program.Helpers.cs</code>.</li>
      <li class="numberedList">In <code class="inlineCode">Program.Helpers.cs</code>, add a partial <code class="inlineCode">Program</code> class with a <code class="inlineCode">SectionTitle</code> and an <code class="inlineCode">OutputFileInfo</code> method, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">// null namespace to merge with auto-generated Program.
partial class Program
{
  private static void SectionTitle(string title)
  {
    ConsoleColor previousColor = ForegroundColor;
    ForegroundColor = ConsoleColor.DarkYellow;
    WriteLine($"*** {title} ***");
    ForegroundColor = previousColor;
  }
  private static void OutputFileInfo(string path)
  {
    WriteLine("**** File Info ****");
    WriteLine($"File: {GetFileName(path)}");
    WriteLine($"Path: {GetDirectoryName(path)}");
    WriteLine($"Size: {new FileInfo(path).Length:N0} bytes.");
    WriteLine("/------------------");
    WriteLine(File.ReadAllText(path));
    WriteLine("------------------/");
  }
}
</code></pre>
      </li>
      <li class="numberedList">Add a new <a id="_idIndexMarker1499"/>class <a id="_idIndexMarker1500"/>file, named <code class="inlineCode">Person.cs</code>, to define a <code class="inlineCode">Person</code> class with a <code class="inlineCode">Salary</code> property that is <code class="inlineCode">protected</code>, meaning it is only accessible to itself and derived classes. To populate the salary, the class has a constructor with a single parameter to set the initial salary, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">namespace Packt.Shared;
public class Person
{
  public Person(decimal initialSalary)
  {
    Salary = initialSalary;
  }
  public string? FirstName { get; set; }
  public string? LastName { get; set; }
  public DateTime DateOfBirth { get; set; }
  public HashSet&lt;Person&gt;? Children { get; set; }
  protected decimal Salary { get; set; }
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete the existing statements, and then import namespaces to work with XML serialization and the <code class="inlineCode">Person</code> class, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">using System.Xml.Serialization; // To use XmlSerializer.
using Packt.Shared; // To use Person.
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, add statements to create an object graph of <code class="inlineCode">Person</code> instances, as <a id="_idIndexMarker1501"/>shown in the following<a id="_idIndexMarker1502"/> code:
        <pre class="programlisting code-one"><code class="hljs-code">List&lt;Person&gt; people = new()
{
  new(initialSalary: 30_000M)
  {
    FirstName = "Alice",
    LastName = "Smith",
    DateOfBirth = new(year: 1974, month: 3, day: 14)
  },
  new(initialSalary: 40_000M)
  {
    FirstName = "Bob",
    LastName = "Jones",
    DateOfBirth = new(year: 1969, month: 11, day: 23)
  },
  new(initialSalary: 20_000M)
  {
    FirstName = "Charlie",
    LastName = "Cox",
    DateOfBirth = new(year: 1984, month: 5, day: 4),
    Children = new()
    {
      new(initialSalary: 0M)
      {
        FirstName = "Sally",
        LastName = "Cox",
        DateOfBirth = new(year: 2012, month: 7, day: 12)
      }
    }
  }
};
SectionTitle("Serializing as XML");
// Create serializer to format a "List of Person" as XML.
XmlSerializer xs = new(type: people.GetType());
// Create a file to write to.
string path = Combine(CurrentDirectory, "people.xml");
using (FileStream stream = File.Create(path))
{
  // Serialize the object graph to the stream.
  xs.Serialize(stream, people);
} // Closes the stream.
OutputFileInfo(path);
</code></pre>
      </li>
      <li class="numberedList">Run the <a id="_idIndexMarker1503"/>code, view <a id="_idIndexMarker1504"/>the result, and note that an exception is thrown, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Unhandled Exception: System.InvalidOperationException: Packt.Shared.Person cannot be serialized because it does not have a parameterless constructor.
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Person.cs</code>, add a statement to define a parameterless constructor, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">// A parameterless constructor is required for XML serialization.
public Person() { }
</code></pre>
      </li>
    </ol>
    <div><p class="normal">The constructor does not need to do anything, but it must exist so that the <code class="inlineCode">XmlSerializer</code> can call it to instantiate new <code class="inlineCode">Person</code> instances during the deserialization process.</p>
    </div>
    <ol>
      <li class="numberedList" value="10">Run the code and view the result, and note that the object graph is serialized as XML elements, like <code class="inlineCode">&lt;FirstName&gt;Bob&lt;/FirstName&gt;</code>, and that the <code class="inlineCode">Salary</code> property is not included because it is not a <code class="inlineCode">public</code> property, as <a id="_idIndexMarker1505"/>shown in the following <a id="_idIndexMarker1506"/>output:
        <pre class="programlisting con-one"><code class="hljs-con">**** File Info ****
File: people.xml
Path: C:\cs13net9\Chapter09\WorkingWithSerialization\bin\Debug\net9.0
Size: 793 bytes.
/------------------
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;ArrayOfPerson  &gt;
  &lt;Person&gt;
    &lt;FirstName&gt;Alice&lt;/FirstName&gt;
    &lt;LastName&gt;Smith&lt;/LastName&gt;
    &lt;DateOfBirth&gt;1974-03-14T00:00:00&lt;/DateOfBirth&gt;
  &lt;/Person&gt;
  &lt;Person&gt;
    &lt;FirstName&gt;Bob&lt;/FirstName&gt;
    &lt;LastName&gt;Jones&lt;/LastName&gt;
    &lt;DateOfBirth&gt;1969-11-23T00:00:00&lt;/DateOfBirth&gt;
  &lt;/Person&gt;
  &lt;Person&gt;
    &lt;FirstName&gt;Charlie&lt;/FirstName&gt;
    &lt;LastName&gt;Cox&lt;/LastName&gt;
    &lt;DateOfBirth&gt;1984-05-04T00:00:00&lt;/DateOfBirth&gt;
    &lt;Children&gt;
      &lt;Person&gt;
        &lt;FirstName&gt;Sally&lt;/FirstName&gt;
        &lt;LastName&gt;Cox&lt;/LastName&gt;
        &lt;DateOfBirth&gt;2012-07-12T00:00:00&lt;/DateOfBirth&gt;
      &lt;/Person&gt;
    &lt;/Children&gt;
  &lt;/Person&gt;
&lt;/ArrayOfPerson&gt;
------------------/
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-585" class="heading-2">Generating compact XML</h2>
    <p class="normal">We could make<a id="_idIndexMarker1507"/> the XML more compact using <a id="_idIndexMarker1508"/>attributes instead of elements for some fields:</p>
    <ol>
      <li class="numberedList" value="1">At the top of <code class="inlineCode">Person.cs</code>, import the <code class="inlineCode">System.Xml.Serialization</code> namespace so that you can decorate some properties with the <code class="inlineCode">[XmlAttribute]</code> attribute, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">using System.Xml.Serialization; // To use [XmlAttribute].
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Person.cs</code>, decorate the first name, last name, and date of birth properties with the <code class="inlineCode">[XmlAttribute]</code> attribute, and set a short name for each property, as highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><strong class="hljs-slc">[</strong><strong class="hljs-meta-slc">XmlAttribute(</strong><strong class="hljs-string-slc">"fname"</strong><strong class="hljs-meta-slc">)</strong><strong class="hljs-slc">]</strong>
public string? FirstName { get; set; }
<strong class="hljs-slc">[</strong><strong class="hljs-meta-slc">XmlAttribute(</strong><strong class="hljs-string-slc">"lname"</strong><strong class="hljs-meta-slc">)</strong><strong class="hljs-slc">]</strong>
public string? LastName { get; set; }
<strong class="hljs-slc">[</strong><strong class="hljs-meta-slc">XmlAttribute(</strong><strong class="hljs-string-slc">"dob"</strong><strong class="hljs-meta-slc">)</strong><strong class="hljs-slc">]</strong>
public DateTime DateOfBirth { get; set; }
</code></pre>
      </li>
      <li class="numberedList">Run the code, and note that the size of the file has reduced from 793 to 488 bytes, a space-saving of more than a third. This reduction was achieved by outputting property values as XML attributes, as shown in the following<a id="_idIndexMarker1509"/> output:
        <pre class="programlisting con-one"><code class="hljs-con">**** File Info ****
File: people.xml
Path: C:\cs13net9\Chapter09\WorkingWithSerialization\bin\Debug\net9.0
Size: 488 bytes.
/------------------
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;ArrayOfPerson  &gt;
  &lt;Person fname="Alice" lname="Smith" dob="1974-03-14T00:00:00" /&gt;
  &lt;Person fname="Bob" lname="Jones" dob="1969-11-23T00:00:00" /&gt;
  &lt;Person fname="Charlie" lname="Cox" dob="1984-05-04T00:00:00"&gt;
    &lt;Children&gt;
      &lt;Person fname="Sally" lname="Cox" dob="2012-07-12T00:00:00" /&gt;
    &lt;/Children&gt;
  &lt;/Person&gt;
&lt;/ArrayOfPerson&gt;
------------------/
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-586" class="heading-2">Deserializing XML files</h2>
    <p class="normal">Now, let’s try <a id="_idIndexMarker1510"/>deserializing the XML file back <a id="_idIndexMarker1511"/>into live objects in memory:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, add statements to open the XML file, and then deserialize it, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">SectionTitle("Deserializing XML files");
using (FileStream xmlLoad = File.Open(path, FileMode.Open))
{
  // Deserialize and cast the object graph into a "List of Person".
  List&lt;Person&gt;? loadedPeople =
    xs.Deserialize(xmlLoad) as List&lt;Person&gt;;
  if (loadedPeople is not null)
  {
    foreach (Person p in loadedPeople)
    {
      WriteLine("{0} has {1} children.",
        p.LastName, p.Children?.Count ?? 0);
    }
  }
}
</code></pre>
      </li>
      <li class="numberedList">Run the code, and<a id="_idIndexMarker1512"/> note that the people are loaded successfully from the XML file and then enumerated, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Smith has 0 children.
Jones has 0 children.
Cox has 1 children.
</code></pre>
      </li>
    </ol>
    <div><p class="normal"><strong class="keyWord">More Information</strong>: There are many other attributes defined in the <code class="inlineCode">System.Xml.Serialization</code> namespace that can be used to control the XML generated. A good place to start is the official documentation for the <code class="inlineCode">XmlAttributeAttribute</code> class found here: <a href="https://learn.microsoft.com/en-us/dotnet/api/system.xml.serialization.xmlattributeattribute">https://learn.microsoft.com/en-us/dotnet/api/system.xml.serialization.xmlattributeattribute</a>. Do not get this class confused with the <code class="inlineCode">XmlAttribute</code> class in the <code class="inlineCode">System.Xml</code> namespace. That is used to represent an XML attribute when reading and writing XML, using <code class="inlineCode">XmlReader</code> and <code class="inlineCode">XmlWriter</code>.</p>
    </div>
    <p class="normal">If you don’t use any<a id="_idIndexMarker1513"/> annotations, <code class="inlineCode">XmlSerializer</code> performs <a id="_idIndexMarker1514"/>a case-insensitive match using the property name when deserializing.</p>
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: When using <code class="inlineCode">XmlSerializer</code>, remember that only the public fields and properties are included, and the type must have a parameterless constructor. You can customize the output with attributes.</p>
    </div>
    <h2 id="_idParaDest-587" class="heading-2">Serializing with JSON</h2>
    <p class="normal">One of the most<a id="_idIndexMarker1515"/> popular .NET libraries to work<a id="_idIndexMarker1516"/> with the JSON serialization format is <strong class="keyWord">Newtonsoft.Json</strong>, known as <strong class="keyWord">Json.NET</strong>. It is <a id="_idIndexMarker1517"/>mature <a id="_idIndexMarker1518"/>and powerful.</p>
    <p class="normal"><code class="inlineCode">Newtonsoft.Json</code> is so popular that it overflowed the bounds of the 32-bit integer used for the download count in the NuGet package manager, as shown in the following post in <em class="italic">Figure 9.5</em>:</p>
    <figure class="mediaobject"><img src="img/B22322_09_05.png" alt="" width="877" height="358"/></figure>
    <p class="packt_figref">Figure 9.5: Negative 2 billion downloads for Newtonsoft.Json in August 2022</p>
    <p class="normal">Let’s see it in action:</p>
    <ol>
      <li class="numberedList" value="1">In the <code class="inlineCode">WorkingWithSerialization</code> project, add a package reference for the latest version of <code class="inlineCode">Newtonsoft.Json</code>, as<a id="_idIndexMarker1519"/> shown in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;PackageReference Include="Newtonsoft.Json" Version="13.0.3" /&gt;
&lt;/ItemGroup&gt;
</code></pre>
      </li>
      <li class="numberedList">Build the <code class="inlineCode">WorkingWithSerialization</code> project to restore packages.</li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, add statements to create a text file, and then serialize the people into the file as JSON, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">SectionTitle("Serializing with JSON");
// Create a file to write to.
string jsonPath = Combine(CurrentDirectory, "people.json");
using (StreamWriter jsonStream = File.CreateText(jsonPath))
{
  Newtonsoft.Json.JsonSerializer jss = new();
  // Serialize the object graph into a string.
  jss.Serialize(jsonStream, people);
} // Closes the file stream and release resources.
OutputFileInfo(jsonPath);
</code></pre>
      </li>
      <li class="numberedList">Run the code, and note that JSON requires fewer than half the number of bytes compared to XML with elements. It’s even smaller than the XML file, which uses attributes (366 compared to 488), as shown in <a id="_idIndexMarker1520"/>the <a id="_idIndexMarker1521"/>following output:
        <pre class="programlisting con-one"><code class="hljs-con">**** File Info ****
File: people.json
Path: C:\cs13net9\Chapter09\WorkingWithSerialization\bin\Debug\net9.0
Size: 366 bytes.
/------------------
[{"FirstName":"Alice","LastName":"Smith","DateOfBirth":"1974-03-14T00:00:00","Children":null},{"FirstName":"Bob","LastName":"Jones","DateOfBirth":"1969-11-23T00:00:00","Children":null},{"FirstName":"Charlie","LastName":"Cox","DateOfBirth":"1984-05-04T00:00:00","Children":[{"FirstName":"Sally","LastName":"Cox","DateOfBirth":"2012-07-12T00:00:00","Children":null}]}]
------------------/
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-588" class="heading-2">High-performance JSON processing</h2>
    <p class="normal">.NET Core 3 introduced <a id="_idIndexMarker1522"/>a new <a id="_idIndexMarker1523"/>namespace to work with JSON, <code class="inlineCode">System.Text.Json</code>, which is optimized for performance by leveraging APIs like <code class="inlineCode">Span&lt;T&gt;</code>.</p>
    <p class="normal">Also, older libraries like <code class="inlineCode">Json.NET</code> are implemented by reading UTF-16. It would be more performant to read and write JSON documents using UTF-8 because most network protocols, including HTTP, use UTF-8, and you can avoid transcoding UTF-8 to and from Json.NET’s Unicode <code class="inlineCode">string</code> values.</p>
    <p class="normal">With the new API, Microsoft achieved between 1.3x and 5x improvement, depending on the scenario.</p>
    <p class="normal">The original author of Json.NET, James Newton-King, joined Microsoft and is working with them to develop their new JSON types. As he says in a comment discussing the new<a id="_idIndexMarker1524"/> JSON APIs, “<em class="italic">Json.NET isn’t going away</em>,” as shown in <em class="italic">Figure 9.6</em>:</p>
    <figure class="mediaobject"><img src="img/B22322_09_06.png" alt="" width="877" height="188"/></figure>
    <p class="packt_figref">Figure 9.6: A comment by the original author of Json.NET</p>
    <h2 id="_idParaDest-589" class="heading-2">Deserializing JSON files</h2>
    <p class="normal">Let’s see how to<a id="_idIndexMarker1525"/> use the modern JSON APIs to<a id="_idIndexMarker1526"/> deserialize a JSON file:</p>
    <ol>
      <li class="numberedList" value="1">In the <code class="inlineCode">WorkingWithSerialization</code> project, at the top of <code class="inlineCode">Program.cs</code>, import the new JSON class to perform serialization, using an alias to avoid conflicting names with the Json.NET one we used before, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">using FastJson = System.Text.Json.JsonSerializer;
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, add statements to open the JSON file, deserialize it, and output the names and counts of the children of the people, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">SectionTitle("Deserializing JSON files");
await using (FileStream jsonLoad = File.Open(jsonPath, FileMode.Open))
{
  // Deserialize object graph into a "List of Person".
  List&lt;Person&gt;? loadedPeople =
    await FastJson.DeserializeAsync(utf8Json: jsonLoad,
      returnType: typeof(List&lt;Person&gt;)) as List&lt;Person&gt;;
  if (loadedPeople is not null)
  {
    foreach (Person p in loadedPeople)
    {
      WriteLine("{0} has {1} children.",
        p.LastName, p.Children?.Count ?? 0);
    }
  }
}
</code></pre>
      </li>
      <li class="numberedList">Run the code<a id="_idIndexMarker1527"/> and view the result, as <a id="_idIndexMarker1528"/>shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Smith has 0 children.
Jones has 0 children.
Cox has 1 children.
</code></pre>
        <div><p class="normal"><strong class="keyWord">Good Practice</strong>: Choose Json.NET for developer productivity and a large feature set, or <code class="inlineCode">System.Text.Json</code> for performance. You can review a list of the differences at the following link: <a href="https://learn.microsoft.com/en-us/dotnet/standard/serialization/system-text-json-migrate-from-newtonsoft-how-to#table-of-differences-between-newtonsoftjson-and-systemtextjson">https://learn.microsoft.com/en-us/dotnet/standard/serialization/system-text-json-migrate-from-newtonsoft-how-to#table-of-differences-between-newtonsoftjson-and-systemtextjson</a>.</p>
        </div>
      </li>
    </ol>
    <h2 id="_idParaDest-590" class="heading-2">JSON schema exporter</h2>
    <p class="normal">.NET 9 introduced<a id="_idIndexMarker1529"/> a class to make it easy to<a id="_idIndexMarker1530"/> generate JSON schemas for .NET types. As a result, serialization is simplified and data conforms to expected formats.</p>
    <p class="normal">Let’s see a working example:</p>
    <ol>
      <li class="numberedList" value="1">In the <code class="inlineCode">WorkingWithSerialization</code> project, at the top of <code class="inlineCode">Program.cs</code>, import the namespaces to perform JSON serialization and work with JSON schemas, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">using System.Text.Json; // To use JsonSerializerOptions.
using System.Text.Json.Schema; // To use JsonSchemaExporter.
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, add statements to export the JSON schema for the <code class="inlineCode">Person</code> class, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">SectionTitle("JSON schema exporter");
WriteLine(JsonSchemaExporter.GetJsonSchemaAsNode(
  JsonSerializerOptions.Default, typeof(Person)));
</code></pre>
      </li>
      <li class="numberedList">Run the code <a id="_idIndexMarker1531"/>and view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">{
  "type": [
    "object",
    "null"
  ],
  "properties": {
    "FirstName": {
      "type": [
        "string",
        "null"
      ]
    },
    "LastName": {
      "type": [
        "string",
        "null"
      ]
    },
    "DateOfBirth": {
      "type": "string",
      "format": "date-time"
    },
    "Children": {
      "type": [
        "array",
        "null"
      ],
      "items": {
        "$ref": "#"
      }
    }
  }
}
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-591" class="heading-2">Controlling JSON processing</h2>
    <p class="normal">There are many <a id="_idIndexMarker1532"/>options to take control <a id="_idIndexMarker1533"/>of how JSON is processed, as shown in the following list:</p>
    <ul>
      <li class="bulletList">Including and excluding fields</li>
      <li class="bulletList">Setting a casing policy</li>
      <li class="bulletList">Selecting a case-sensitivity policy</li>
      <li class="bulletList">Choosing between compact and prettified whitespace</li>
    </ul>
    <p class="normal">Let’s see some in action:</p>
    <ol>
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Console App </strong>/ <code class="inlineCode">console</code> project, named <code class="inlineCode">ControllingJson</code>, to the <code class="inlineCode">Chapter09</code> solution.</li>
      <li class="numberedList">In the project file, add elements to statically and globally import the <code class="inlineCode">System.Console</code>, <code class="inlineCode">System.Environment</code>, and <code class="inlineCode">System.IO.Path</code> classes.</li>
      <li class="numberedList">In the <code class="inlineCode">ControllingJson</code> project, add a new class file named <code class="inlineCode">Book.cs</code>.</li>
      <li class="numberedList">In <code class="inlineCode">Book.cs</code>, define a class<a id="_idIndexMarker1534"/> named <code class="inlineCode">Book</code>, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">using System.Text.Json.Serialization; // To use [JsonInclude].
namespace Packt.Shared;
public class Book
{
  // Constructor to set non-nullable property.
  public Book(string title)
  {
    Title = title;
  }
  // Properties.
  public string Title { get; set; }
  public string? Author { get; set; }
  // Fields.
  [JsonInclude] // Include this field.
  public DateTime PublishDate;
  [JsonInclude] // Include this field.
  public DateTimeOffset Created;
  public ushort Pages;
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete the existing statements, and then import the namespaces to <a id="_idIndexMarker1535"/>work with high-performance JSON and <code class="inlineCode">Book</code>, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">using Packt.Shared; // To use Book.
using System.Text.Json; // To use JsonSerializer.
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, add statements to create an instance of the <code class="inlineCode">Book</code> class and serialize it to JSON, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">Book csharpBook = new(title:
  "C# 13 and .NET 9 - Modern Cross-Platform Development Fundamentals")
{
  Author = "Mark J Price",
  PublishDate = new(year: 2024, month: 11, day: 12),
  Pages = 823,
  Created = DateTimeOffset.UtcNow,
};
JsonSerializerOptions options = new()
{
  IncludeFields = true, // Includes all fields.
  PropertyNameCaseInsensitive = true,
  WriteIndented = true,
  PropertyNamingPolicy = JsonNamingPolicy.CamelCase,
};
string path = Combine(CurrentDirectory, "book.json");
using (Stream fileStream = File.Create(path))
{
  JsonSerializer.Serialize(
    utf8Json: fileStream, value: csharpBook, options);
}
WriteLine("**** File Info ****");
WriteLine($"File: {GetFileName(path)}");
WriteLine($"Path: {GetDirectoryName(path)}");
WriteLine($"Size: {new FileInfo(path).Length:N0} bytes.");
WriteLine("/------------------");
WriteLine(File.ReadAllText(path));
WriteLine("------------------/");
</code></pre>
      </li>
      <li class="numberedList">Run <a id="_idIndexMarker1536"/>the code and view the <a id="_idIndexMarker1537"/>result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">**** File Info ****
File: book.json
Path: C:\cs13net9\Chapter09\ControllingJson\bin\Debug\net9.0
Size: 221 bytes.
/------------------
{
  "title": "C# 13 and .NET 9 - Modern Cross-Platform Development Fundamentals",
  "author": "Mark J Price",
  "publishDate": "2024-11-12T00:00:00",
  "created": "2024-07-13T14:29:07.119631+00:00",
  "pages": 823
}
------------------/
</code></pre>
      </li>
    </ol>
    <p class="normal-one">Note the following:</p>
    <ul>
      <li class="bulletList level-2">The JSON file is 221 bytes.</li>
      <li class="bulletList level-2">The member names use camelCasing, for example, <code class="inlineCode">publishDate</code>. This is best for subsequent processing in a browser with JavaScript.</li>
      <li class="bulletList level-2">All fields are included due to the options set, including <code class="inlineCode">pages</code>.</li>
      <li class="bulletList level-2">JSON is prettified for easier human legibility.</li>
      <li class="bulletList level-2"><code class="inlineCode">DateTime</code> and <code class="inlineCode">DateTimeOffset</code> values are stored as a single standard <code class="inlineCode">string</code> format.</li>
    </ul>
    <ol>
      <li class="numberedList" value="8">In <code class="inlineCode">Program.cs</code>, when setting the <code class="inlineCode">JsonSerializerOptions</code>, comment out the setting of a casing policy, write with an indent, and include fields.</li>
      <li class="numberedList">Run the code <a id="_idIndexMarker1538"/>and view the <a id="_idIndexMarker1539"/>result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">**** File Info ****
File: book.json
Path: C:\cs13net9\Chapter09\ControllingJson\bin\Debug\net9.0
Size: 184 bytes.
/------------------
{"Title":"C# 13 and .NET 9 - Modern Cross-Platform Development Fundamentals","Author":"Mark J Price","PublishDate":"2024-11-12T00:00:00","Created":"2024-07-13T14:30:29.2205861+00:00"}
------------------/
</code></pre>
      </li>
    </ol>
    <p class="normal-one">Note the following:</p>
    <ul>
      <li class="bulletList level-2">The JSON file has about a 20% reduction.</li>
      <li class="bulletList level-2">The member names use normal casing, for example, <code class="inlineCode">PublishDate</code>.</li>
      <li class="bulletList level-2">The <code class="inlineCode">Pages</code> field is missing. The other fields are included due to the <code class="inlineCode">[JsonInclude]</code> attribute<a id="_idIndexMarker1540"/> on <a id="_idIndexMarker1541"/>the <code class="inlineCode">PublishDate</code> and <code class="inlineCode">Created</code> fields.</li>
    </ul>
    <h2 id="_idParaDest-592" class="heading-2">A warning about binary serialization using BinaryFormatter</h2>
    <p class="normal">The <code class="inlineCode">BinaryFormatter</code> class is<a id="_idIndexMarker1542"/> a serialization<a id="_idIndexMarker1543"/> class <a id="_idIndexMarker1544"/>that can convert a live object, or a graph of connected objects, into a binary format that can be stored or transmitted and later reconstructed. This class has been part of .NET since its early versions and is in the <code class="inlineCode">System.Runtime.Serialization.Formatters.Binary</code> namespace. But <code class="inlineCode">BinaryFormatter</code> is problematic for several reasons, primarily related to security and robustness.</p>
    <p class="normal">For example, <code class="inlineCode">BinaryFormatter</code> is vulnerable to deserialization attacks, where malicious input can execute arbitrary code during the deserialization process. This makes any application using <code class="inlineCode">BinaryFormatter</code> susceptible to <strong class="keyWord">remote code execution </strong>(<strong class="keyWord">RCE</strong>) if an <a id="_idIndexMarker1545"/>attacker can control the serialized data. <code class="inlineCode">BinaryFormatter</code> does not perform any validation or checks on the data it deserializes, making it inherently insecure when handling untrusted data.</p>
    <p class="normal"><code class="inlineCode">BinaryFormatter</code> does not support many modern serialization features, like JSON or XML serialization capabilities, which are more secure and flexible.</p>
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: Microsoft recommends using serialization libraries like <code class="inlineCode">System.Text.Json</code>, <code class="inlineCode">System.Xml.Serialization</code>, or <code class="inlineCode">Google.Protobuf</code>.</p>
    </div>
    <p class="normal">In the first version of .NET Core, the Microsoft team removed <code class="inlineCode">BinaryFormatter</code> entirely due to its known risks, but without a clear path to using something safer, customers demanded that it be brought back, which the team did with .NET Core 1.1. Since then, the team has disabled it by default but allowed developers to explicitly re-enable it, by setting flags if they accept the risks.</p>
    <p class="normal">With .NET 9, the flags to enable <code class="inlineCode">BinaryFormatter</code> have been removed, and any use of it will throw an exception. But there is still a way to re-enable it, by referencing a NuGet package marked as being permanently <a id="_idIndexMarker1546"/>vulnerable and setting <a id="_idIndexMarker1547"/>some<a id="_idIndexMarker1548"/> configuration.</p>
    <div><p class="normal"><strong class="keyWord">More Information</strong>: You can learn more about why and how the <code class="inlineCode">BinaryFormatter</code> class is being removed in .NET 9 at the following link: <code class="inlineCode">https://devblogs.microsoft.com/dotnet/binaryformatter-removed-from-dotnet-9/</code>.</p>
    </div>
    <h1 id="_idParaDest-593" class="heading-1">Practicing and exploring</h1>
    <p class="normal">Test your knowledge and understanding by answering some questions, getting some hands-on practice, and exploring this chapter’s topics with more in-depth research.</p>
    <h2 id="_idParaDest-594" class="heading-2">Exercise 9.1 – Online material</h2>
    <p class="normal">Online material can be extra content written by me for this book, or it can be references to content created by Microsoft or third parties.</p>
    <h3 id="_idParaDest-595" class="heading-3">Working with tar archives</h3>
    <p class="normal">If you use Linux, then you will be interested in how to programmatically work with tar archives. I have written an online-only section to introduce you to them that can be found at the following link:</p>
    <p class="normal"><a href="https://github.com/markjprice/cs13net9/blob/main/docs/ch09-tar-archives.md">https://github.com/markjprice/cs13net9/blob/main/docs/ch09-tar-archives.md</a></p>
    <h3 id="_idParaDest-596" class="heading-3">Migrating from Newtonsoft to new JSON</h3>
    <p class="normal">If you have existing code that uses the Newtonsoft <code class="inlineCode">Json.NET</code> library and you want to migrate to the new <code class="inlineCode">System.Text.Json</code> namespace, then Microsoft has specific documentation for that, which you can find at the following link:</p>
    <p class="normal"><a href="https://learn.microsoft.com/en-us/dotnet/standard/serialization/system-text-json-migrate-from-newtonsoft-how-to">https://learn.microsoft.com/en-us/dotnet/standard/serialization/system-text-json-migrate-from-newtonsoft-how-to</a></p>
    <h2 id="_idParaDest-597" class="heading-2">Exercise 9.2 – Practice exercises</h2>
    <p class="normal">Practice exercises go deeper into the topics for this chapter.</p>
    <h3 id="_idParaDest-598" class="heading-3">Serializing as XML</h3>
    <p class="normal">In the <code class="inlineCode">Chapter09</code> solution, create a console app named <code class="inlineCode">Exercise_SerializingShapes</code> that creates a list of shapes, uses serialization to save it to the filesystem with XML, and then deserializes it back:</p>
    <pre class="programlisting code"><code class="hljs-code">// Create a list of Shapes to serialize.
List&lt;Shape&gt; listOfShapes = new()
{
  new Circle { Colour = "Red", Radius = 2.5 },
  new Rectangle { Colour = "Blue", Height = 20.0, Width = 10.0 },
  new Circle { Colour = "Green", Radius = 8.0 },
  new Circle { Colour = "Purple", Radius = 12.3 },
  new Rectangle { Colour = "Blue", Height = 45.0, Width = 18.0 }
};
</code></pre>
    <p class="normal">Shapes should have a read-only property named <code class="inlineCode">Area</code> so that when you deserialize, you can output a list of shapes, including their areas, as shown here:</p>
    <pre class="programlisting code"><code class="hljs-code">List&lt;Shape&gt; loadedShapesXml =
  serializerXml.Deserialize(fileXml) as List&lt;Shape&gt;;
foreach (Shape item in loadedShapesXml)
{
  WriteLine("{0} is {1} and has an area of {2:N2}",
    item.GetType().Name, item.Colour, item.Area);
}
</code></pre>
    <p class="normal">This is what your output should look like when you run your console application:</p>
    <pre class="programlisting con"><code class="hljs-con">Loading shapes from XML:
Circle is Red and has an area of 19.63
Rectangle is Blue and has an area of 200.00
Circle is Green and has an area of 201.06
Circle is Purple and has an area of 475.29
Rectangle is Blue and has an area of 810.00
</code></pre>
    <h2 id="_idParaDest-599" class="heading-2">Exercise 9.3 – Test your knowledge</h2>
    <p class="normal">Answer the following questions:</p>
    <ol>
      <li class="numberedList" value="1">What is the difference between using the <code class="inlineCode">File</code> class and the <code class="inlineCode">FileInfo</code> class?</li>
      <li class="numberedList">What is the difference between the <code class="inlineCode">ReadByte</code> method and the <code class="inlineCode">Read</code> method of a stream?</li>
      <li class="numberedList">When would you use the <code class="inlineCode">StringReader</code>, <code class="inlineCode">TextReader</code>, and <code class="inlineCode">StreamReader</code> classes?</li>
      <li class="numberedList">What does the <code class="inlineCode">DeflateStream</code> type do?</li>
      <li class="numberedList">How many bytes per character does UTF-8 encoding use?</li>
      <li class="numberedList">What is an object graph?</li>
      <li class="numberedList">What is the best serialization format to choose to minimize space requirements?</li>
      <li class="numberedList">What is the best serialization format to choose for cross-platform compatibility?</li>
      <li class="numberedList">Why is it bad to use a <code class="inlineCode">string</code> value like <code class="inlineCode">"\Code\Chapter01"</code> to represent a path, and what should you do instead?</li>
      <li class="numberedList">Where can you find information about NuGet packages and their dependencies?</li>
    </ol>
    <h2 id="_idParaDest-600" class="heading-2">Exercise 9.4 – Explore topics</h2>
    <p class="normal">Use the links on the following page to learn more details about the topics covered in this chapter:</p>
    <p class="normal"><a href="https://github.com/markjprice/cs13net9/blob/main/docs/book-links.md#chapter-9---working-with-files-streams-and-serialization">https://github.com/markjprice/cs13net9/blob/main/docs/book-links.md#chapter-9---working-with-files-streams-and-serialization</a></p>
    <h1 id="_idParaDest-601" class="heading-1">Summary</h1>
    <p class="normal">In this chapter, you learned how to:</p>
    <ul>
      <li class="bulletList">Read from and write to text files.</li>
      <li class="bulletList">Read from and write to XML files.</li>
      <li class="bulletList">Compress and decompress files.</li>
      <li class="bulletList">Encode and decode text.</li>
      <li class="bulletList">Serialize an object graph into JSON and XML.</li>
      <li class="bulletList">Deserialize an object graph from JSON and XML.</li>
    </ul>
    <p class="normal">In the next chapter, you will learn how to work with databases using Entity Framework Core.</p>
  </div>
</div></div></body></html>