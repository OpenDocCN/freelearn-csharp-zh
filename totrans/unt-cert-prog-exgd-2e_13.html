<html><head></head><body>
		<div id="_idContainer560">
			<h1 id="_idParaDest-216"><em class="italic"><a id="_idTextAnchor219"/>Chapter 13</em>: Effects, Testing, Performance, and Alt Controls</h1>
			<p>In this final chapter, we are going to go through the process of checking, supporting, polishing, and preparing our game so that it's built and ready to be played on a device, making it platform-independent. Because our game will be ready to be played on various devices, we need the game to support as many screen ratios as possible. Back in <a href="B18381_08_Epub.xhtml#_idTextAnchor150"><em class="italic">Chapter 8</em></a>, <em class="italic">Adding Custom Fonts and UI</em>, we made our game's UI support various screen ratios. The game, however, was built purposely for a 1,920 x 1,080 resolution, as discussed in <a href="B18381_02_Epub.xhtml#_idTextAnchor048"><em class="italic">Chapter 2</em></a>, <em class="italic">Adding and Manipulating Objects</em>.</p>
			<p>In this chapter, we will make our game run at different screen ratios to support the use of mobile devices. This will involve changing Unity's Canvas scale and updating our <strong class="source-inline">Player</strong> script controls to update its screen boundaries, touch screen capability, and our ability to tap to move our ship. Furthermore, we will make our game aware that it is being played on a mobile device, and we'll make some changes, such as removing the <strong class="bold">AD</strong> button in the shop, as adverts aren't supported on PC devices.</p>
			<p>The PC version of Killer Wave will have more polished effects applied, such as post-processing, which will basically make our game more pretty with effects such as motion blur, chromatic aberration, color grading, and a few more effects on top. We will also be looking at reflection probes to create a mirrored effect for some of our art assets in the <strong class="source-inline">level3</strong> scene.</p>
			<p>In this chapter, we'll be covering the following topics:</p>
			<ul>
				<li>Applying physics with <strong class="bold">RigidBody</strong></li>
				<li>Customizing for different platforms</li>
				<li>Preparing to build Killer Wave for mobile</li>
				<li>Applying PC visual improvements</li>
				<li>Adding global illumination and other settings</li>
				<li>Building and testing our game</li>
			</ul>
			<p>The next section will specify the exam objectives that will be covered in this chapter.</p>
			<h1 id="_idParaDest-217"><a id="_idTextAnchor220"/>Core exam skills being covered in this chapter</h1>
			<p>The following are the core exam skills that will be covered in this chapter:</p>
			<p><em class="italic">Programming core interactions</em>:</p>
			<ul>
				<li>Implement and configure game object behavior and physics.</li>
				<li>Implement and configure input and controls.</li>
				<li>Implement and configure camera views and movement.</li>
			</ul>
			<p><em class="italic">Working in the art pipeline</em>:</p>
			<ul>
				<li>Understand materials, textures, and shaders, and write scripts that interact with Unity's rendering API.</li>
				<li>Understand lighting, and write scripts that interact with Unity's lighting API.</li>
			</ul>
			<p><em class="italic">Optimizing for performance and platforms</em>:</p>
			<ul>
				<li>Evaluate errors and performance issues using tools such as the Unity Profiler.</li>
				<li>Identify optimizations to address requirements for specific build platforms and/or hardware configurations.</li>
			</ul>
			<p><em class="italic">Working in professional software development teams</em>:</p>
			<ul>
				<li>Demonstrate knowledge of developer testing and its impact on the software development process, including the Unity Profiler and traditional debugging and testing techniques.</li>
				<li>Recognize techniques for structuring scripts for modularity, readability, and reusability.</li>
			</ul>
			<h1 id="_idParaDest-218"><a id="_idTextAnchor221"/>Technical requirements</h1>
			<p>The project content for this chapter can be found at <a href="https://github.com/PacktPublishing/Unity-Certified-Programmer-Exam-Guide-Second-Edition/tree/main/Chapter_13">https://github.com/PacktPublishing/Unity-Certified-Programmer-Exam-Guide-Second-Edition/tree/main/Chapter_13</a>.</p>
			<p>You can download the entirety of each chapter's project files at <a href="https://github.com/PacktPublishing/Unity-Certified-Programmer-Exam-Guide-Second-Edition">https://github.com/PacktPublishing/Unity-Certified-Programmer-Exam-Guide-Second-Edition</a>.</p>
			<p>All the content for this chapter is held in this chapter's <strong class="source-inline">unitypackage</strong> file. This file includes a <strong class="source-inline">Complete</strong> folder, which holds all of the work we'll carry out in this chapter. So, if at any point you need some reference material or extra guidance, check it out.</p>
			<p>Check out the following video to see the <em class="italic">Code in Action</em>: https://bit.ly/3rYA6k4.</p>
			<h1 id="_idParaDest-219"><a id="_idTextAnchor222"/>Applying physics with RigidBody</h1>
			<p>Throughout<a id="_idIndexMarker1390"/> this<a id="_idIndexMarker1391"/> book, we have used colliders and trigger boxes to detect hits from a bullet or a selection made in the first rendition of our shop. We have also referred to applying a <strong class="bold">RigidBody</strong> component to some of these game objects with colliders to ensure that a collision is detected. We haven't made use of <strong class="bold">Rigidbody</strong> any other way so far. However, in this section, we are going to make more use of <strong class="bold">Rigidbody</strong> by making a collision happen – the blocks will collapse by our <strong class="source-inline">level3</strong> boss game object going through them.</p>
			<p>The following image shows the cargo art assets being smashed out of the way by applying and tweaking <strong class="bold">Rigidbody</strong> components, which is what we will achieve in this section:</p>
			<div>
				<div id="_idContainer486" class="IMG---Figure">
					<img src="image/Figure_13.01_B18381.jpg" alt="Figure 13.1 – Boxes go flying when hit thanks to Unity's Rigidbody Component&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.1 – Boxes go flying when hit thanks to Unity's Rigidbody Component</p>
			<p>Let's make a start by setting up our <strong class="source-inline">level3</strong> scene with some pre-made assets:</p>
			<ol>
				<li>In the <strong class="bold">Project</strong> window, navigate to the <strong class="source-inline">Assets/Scene</strong> folder.</li>
				<li>Double-click the <strong class="source-inline">level3</strong> scene to open it.</li>
				<li>In the <strong class="bold">Project</strong> window, drag and drop <strong class="source-inline">physicsBarrier</strong> from <strong class="source-inline">Assets/Prefab</strong> into the <strong class="bold">Hierarchy</strong> window.</li>
				<li>Select <a id="_idIndexMarker1392"/>the <strong class="source-inline">physicsBarrier</strong> game object in<a id="_idIndexMarker1393"/> the <strong class="bold">Hierarchy</strong> window and make sure its <strong class="bold">Transform</strong> <strong class="bold">Position</strong> and <strong class="bold">Rotation</strong> property values in the <strong class="bold">Inspector</strong> window are set to zero. Note that <strong class="bold">Scale</strong> should be <strong class="source-inline">1</strong> on all axes.</li>
			</ol>
			<p>The following screenshot shows <strong class="source-inline">physicsBarrier</strong> in the <strong class="source-inline">level3</strong> scene. Note the green outline, which shows that this is our series of box colliders, which will contain our physics.</p>
			<div>
				<div id="_idContainer487" class="IMG---Figure">
					<img src="image/Figure_13.02_B18381.jpg" alt="Figure 13.2 – The wireframe is our collision area for our boxes&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.2 – The wireframe is our collision area for our boxes</p>
			<ol>
				<li value="5">In the <strong class="bold">Hierarchy</strong> window, expand <strong class="source-inline">physicsBarrier</strong> to show its three children game objects.</li>
				<li>Select all three of these child objects and set their <strong class="bold">Rigidbody</strong> component so that <strong class="bold">Is Kinematic</strong> is ticked.</li>
				<li>The following screenshot shows all three game objects selected and the <strong class="bold">Rigidbody</strong> settings being updated:</li>
			</ol>
			<div>
				<div id="_idContainer488" class="IMG---Figure">
					<img src="image/Figure_13.03_B18381.jpg" alt="Figure 13.3 – All 'physicsBarrier' gameobject children have a Rigidbody with Is Kinematic marked as true"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.3 – All 'physicsBarrier' gameobject children have a Rigidbody with Is Kinematic marked as true</p>
			<p><strong class="bold">Is Kinematic</strong> will ensure that these three game objects aren't affected by the physics in the scene. Even if we did tick the <strong class="bold">Use Gravity</strong> box, the game objects won't begin to fall when the scene starts as expected. So, whatever happens in our scene regarding collisions, these <a id="_idIndexMarker1394"/>three game objects will remain still<a id="_idIndexMarker1395"/> and solid so that they cage all of the physics engine's reactions.</p>
			<p class="callout-heading">Further Information</p>
			<p class="callout">With a game object selected that holds a <strong class="bold">Rigidbody</strong> component, the following properties will alter the game object's behavior when it's manipulated by Unity's physics engine:</p>
			<p class="callout"><strong class="bold">Mass</strong>: The game object's mass in kilograms (Default value: <strong class="bold">1</strong>)</p>
			<p class="callout"><strong class="bold">Drag</strong>: The air resistance, with zero being no resistance (Default value: <strong class="bold">0</strong>)</p>
			<p class="callout"><strong class="bold">Angular Drag</strong>: Air resistance based on rotation (Default value: <strong class="bold">0.05</strong>)</p>
			<p class="callout">More information<a id="_idIndexMarker1396"/> about <strong class="bold">Rigidbody</strong> and its properties can be found here: <a href="https://docs.unity3d.com/ScriptReference/Rigidbody.html">https://docs.unity3d.com/ScriptReference/Rigidbody.html</a>.</p>
			<p>Now, we can bring our cargo boxes into the scene.</p>
			<ol>
				<li value="1">In the <strong class="bold">Project</strong> window, drag and drop the <strong class="source-inline">cargoBulk</strong> prefab from <strong class="source-inline">Assets /Prefab</strong> into the <strong class="bold">Hierarchy</strong> window. As with the <strong class="source-inline">physicsBarrier</strong> prefab, make sure that the <strong class="bold">Transform</strong> property values are set to their default values.</li>
				<li>The <strong class="source-inline">cargoBulk</strong> prefab should be in place and look like the one shown in the following screenshot:</li>
			</ol>
			<div>
				<div id="_idContainer489" class="IMG---Figure">
					<img src="image/Figure_13.04_B18381.jpg" alt="Figure 13.4 – The wall of boxes&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.4 – The wall of boxes</p>
			<p>To reinforce <strong class="source-inline">cargoBulk</strong> so that it collapses at the right time, a script needs to be applied called <strong class="source-inline">TurnOnPhysics</strong>. This will set all of the cargo game objects from <strong class="bold">Is Kinematic</strong> that are <strong class="source-inline">true</strong> to <strong class="source-inline">false</strong> after <strong class="source-inline">38</strong> seconds, (feel free to open the <strong class="source-inline">TurnOnPhysics</strong> script and adjust 38 to a different number in the <strong class="source-inline">Update</strong> function) which is the time the boss is due to crash through the cargo boxes.</p>
			<p><strong class="source-inline">physicsBarrier</strong> and <strong class="source-inline">cargoBulk</strong> and their children game objects are all set as colliders. Currently, our boss is set as a trigger for when they are shot by the player. However, we <a id="_idIndexMarker1397"/>don't <a id="_idIndexMarker1398"/>want it to be a trigger here, as the boss will move through the cargo boxes like a ghost.</p>
			<p>We can make <strong class="source-inline">boss</strong> start as a non-trigger and then, at the end of the level, turn its trigger on with the use of <strong class="bold">Timeline</strong>. To alter the <strong class="bold">Is Trigger</strong> tick box, we need to do the following:</p>
			<ol>
				<li value="1">Select the <strong class="bold">Timeline</strong> game object in the <strong class="bold">Hierarchy</strong> window.</li>
				<li>Right-click the <strong class="source-inline">boss</strong> <strong class="bold">Timeline</strong> <strong class="bold">track asset</strong>, and from the dropdown, select <strong class="bold">Edit in Animation Window</strong>.</li>
			</ol>
			<p>The following screenshot shows where to right-click and load the <strong class="bold">Animation</strong> window:</p>
			<div>
				<div id="_idContainer490" class="IMG---Figure">
					<img src="image/Figure_13.05_B18381.jpg" alt="Figure 13.5 – Load the Animation Window to update the 'boss' game object animation&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.5 – Load the Animation Window to update the 'boss' game object animation</p>
			<p>Our <strong class="bold">Animation</strong> window appears along with the keyframes from the <strong class="source-inline">boss</strong> game object that we placed in the previous chapter. We can add two keyframes to this window to turn it on and then off with the <strong class="bold">Is Trigger</strong> box. To do this, follow these steps:</p>
			<ol>
				<li value="1">Drag <strong class="bold">Animation Indicator</strong> to the beginning of the animation track in the <strong class="bold">Animation</strong> window.</li>
				<li>Click the <strong class="bold">record</strong> button.</li>
				<li>In the <strong class="bold">Hierarchy</strong> window, select the <strong class="source-inline">boss</strong> game object and select <strong class="bold">Is Trigger</strong> to be unchecked in the <strong class="bold">Sphere Collider</strong> component in the <strong class="bold">Inspector</strong> window.</li>
				<li>Back in the <strong class="bold">Animation</strong> window, drag <strong class="bold">Animation Indicator</strong> all the way to frame <strong class="source-inline">1193</strong> (this will be the part where the <strong class="source-inline">boss</strong> game object has already burst through the boxes).</li>
				<li>Select the <strong class="bold">Is Trigger</strong> box in the <strong class="bold">Inspector</strong> window so that it's ticked.</li>
				<li>Finally, back in the <strong class="bold">Animation</strong> window, press <strong class="bold">record</strong> to turn it off and close the <strong class="bold">Animation</strong> window.</li>
				<li>Save the scene and press <strong class="bold">Play</strong> in the Unity Editor to play <strong class="source-inline">level3</strong>.</li>
			</ol>
			<p>However, after<a id="_idIndexMarker1399"/> doing this, something doesn't seem right. By the <a id="_idIndexMarker1400"/>time we reach the end of the level, the boxes have already collapsed and when the <strong class="source-inline">boss</strong> game object collides with them, the boxes appear to float away. This is because the game objects in our scene aren't scaled to real-world size, but the gravity is. To make things look heavier, we can change the gravity of the project, as follows:</p>
			<ol>
				<li value="1">At the top of the Unity Editor, go to <strong class="bold">Edit</strong> | <strong class="bold">Project Settings</strong> | <strong class="bold">Physics</strong>.</li>
			</ol>
			<p>Here, we have <strong class="bold">Physics Manager</strong>, which is where the gravity has been set to its default world scale.</p>
			<ol>
				<li value="2">Change the <strong class="bold">Y</strong> value of <strong class="bold">Gravity</strong> from <strong class="source-inline">-9.81</strong> to <strong class="source-inline">-1000</strong>.</li>
				<li>Another potential issue could be that the boss goes right through the cargo boxes?  To fix this, change the boss GameObject's <strong class="bold">Update Mode</strong> from <strong class="bold">Normal</strong> to <strong class="bold">Animate Physics</strong>. and make sure that<strong class="bold"> Apply</strong> <strong class="bold">Root Motion</strong> is unchecked. Finally, because your boss is colliding with boxes, be sure it has a Rigidbody with <strong class="bold">Is Kinematic</strong> ticked.<p class="callout-heading">Further Information</p><p class="callout">Your project's gravity can also be changed through scripting, as shown here: <a href="https://docs.unity3d.com/ScriptReference/Physics-gravity.html">https://docs.unity3d.com/ScriptReference/Physics-gravity.html</a>.</p></li>
				<li>Save the scene again. Now, if we press <strong class="bold">Play</strong>, our cargo boxes will remain, and our <strong class="source-inline">boss</strong> game object will burst through them, as shown in the following screenshot:</li>
			</ol>
			<div>
				<div id="_idContainer491" class="IMG---Figure">
					<img src="image/Figure_13.06_B18381.jpg" alt="Figure 13.6 – The 'boss' game object colliding with the boxes&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.6 – The 'boss' game object colliding with the boxes</p>
			<p class="callout-heading">Further Information</p>
			<p class="callout"><strong class="bold">Physics Manager</strong> contains global settings for your project's physics. One of the many useful settings at the bottom of <strong class="bold">Physics Manager</strong> is <strong class="bold">Layer Collision Matrix</strong>. This holds all the names of the layers in your project that can and cannot collide with each other. If you would like to know<a id="_idIndexMarker1401"/> more about <strong class="bold">Layer Collision Matrix</strong>, check out the following link: <a href="https://docs.unity3d.com/Manual/LayerBasedCollision.html">https://docs.unity3d.com/Manual/LayerBasedCollision.html</a>.</p>
			<p>If you aren't happy with the way the <strong class="source-inline">cargo</strong> game objects react when they're hit by the <strong class="source-inline">boss</strong> game object, tweak its <strong class="bold">Rigidbody</strong> property values (including the ones mentioned in the first tip, earlier in this section).</p>
			<p>Every collider can have a physics material applied to it, which will affect an object's bounciness and friction.</p>
			<p>Creating <a id="_idIndexMarker1402"/>and<a id="_idIndexMarker1403"/> applying a physics material can be done in three steps:</p>
			<ol>
				<li value="1">In the <strong class="bold">Project</strong> window, right-click and select <strong class="bold">Create</strong> | <strong class="bold">Physic Material</strong>.</li>
				<li>Select <strong class="bold">New Physic Material</strong> and change its property values in the <strong class="bold">Inspector</strong> window (you can also rename the file so that it represents what physical material you're trying to achieve).</li>
				<li>Select a game object with a collider. Then, click the <strong class="bold">remote</strong> button next to the <strong class="bold">Material</strong> field and select <strong class="bold">New Physic Material</strong>.</li>
			</ol>
			<div>
				<div id="_idContainer492" class="IMG---Figure">
					<img src="image/Figure_13.07_B18381.jpg" alt="Figure 13.7 – Creating a Physic Material, updating its properties, and adding the material to a Box Collider"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.7 – Creating a Physic Material, updating its properties, and adding the material to a Box Collider</p>
			<p class="callout-heading">Further Information</p>
			<p class="callout">More information<a id="_idIndexMarker1404"/> about <strong class="bold">Physic Material</strong> can be found at <a href="https://docs.unity3d.com/Manual/class-PhysicMaterial.html">https://docs.unity3d.com/Manual/class-PhysicMaterial.html</a>.</p>
			<p>Our game now has some physics effects applied to it. Now, each time the boss crashes through the cubes, the reaction will be different each time and not like a fixed animation. This<a id="_idIndexMarker1405"/> is because all the movement is based on the Unity <a id="_idIndexMarker1406"/>engine's physics.</p>
			<p>Now, let's move on and make our game more customized for multiple platforms.</p>
			<h1 id="_idParaDest-220"><a id="_idTextAnchor223"/>Customizing for different platforms</h1>
			<p>Throughout this<a id="_idIndexMarker1407"/> book, we have been developing and playing our game in the Unity Editor. In this section, we are going to start making some considerations regarding what will differ between the Android and PC versions of our game. For example, mobile devices have a touchscreen, so it would be useful if our game could detect that it's being played on a mobile device and, therefore, implement the correct controls.</p>
			<p>Also, our game has been developed with a strict 1,920 x 1,080 resolution; we have introduced flexibility with the shop scene's UI and ensured that it accommodates various aspect ratios. In this section, we will go further and make our game support various aspect ratios.</p>
			<p>Let's get started and modify our <strong class="source-inline">Player</strong> script so that it supports touchscreen movement and fires on mobile devices.</p>
			<h2 id="_idParaDest-221"><a id="_idTextAnchor224"/>Navigating and firing the player's ship with the touchscreen</h2>
			<p>In this<a id="_idIndexMarker1408"/> section, we are going to revisit<a id="_idIndexMarker1409"/> the <strong class="source-inline">Player</strong> script and add some functionality so that if and when our game is ported to an Android device, the player has touchscreen capabilities.</p>
			<p>To allow our player to auto-fire and navigate to a touch position, we need to do the following:</p>
			<ol>
				<li value="1">In the <strong class="bold">Project</strong> window, navigate to the <strong class="source-inline">Assets/Script</strong> folder and open the <strong class="source-inline">Player</strong> script.</li>
			</ol>
			<p>At the top of the <strong class="source-inline">Player</strong> script, we are going to add some new variables to support the new control system.</p>
			<ol>
				<li value="2">Add the following code, along with the rest of the variables, to the <strong class="source-inline">Player</strong> script:<p class="source-code">Vector3 direction;</p><p class="source-code">Rigidbody rb;</p><p class="source-code">public static bool mobile = false;</p></li>
			</ol>
			<p>The <strong class="source-inline">direction</strong> variable will hold the player's touchscreen location; <strong class="source-inline">rb</strong> will hold a <strong class="bold">Rigidbody</strong> reference for our player's ship so that it can access other properties within, and the <strong class="source-inline">mobile</strong> variable is simply a <strong class="source-inline">static</strong> switch that lets the rest of the game know the player's controls.</p>
			<p>We need to make the game recognize which platform the game is running on so that it can implement the player's mobile controls. Unity has a platform-dependent compilation that lets us choose from a list of directives so that we can determine what platform the game is running on.</p>
			<ol>
				<li value="3">Scroll down to the <strong class="source-inline">Start</strong> function in the <strong class="source-inline">Player</strong> script and add the following code inside the <strong class="source-inline">Start</strong> function's scope:<p class="source-code">mobile = false;</p><p class="source-code">#if UNITY_ANDROID &amp;&amp; !UNITY_EDITOR</p><p class="source-code">    mobile = true; </p><p class="source-code">    InvokeRepeating("Attack",0,0.3f); </p><p class="source-code">    rb = GetComponent&lt;Rigidbody&gt;();</p><p class="source-code">    #endif</p></li>
			</ol>
			<p>Within <a id="_idIndexMarker1410"/>the <strong class="source-inline">Start</strong> function, we<a id="_idIndexMarker1411"/> set our <strong class="source-inline">mobile</strong> <strong class="source-inline">bool</strong> variable to <strong class="source-inline">false</strong>. Then, we run a platform defined directives check to see whether we are running an Android device and not using the Unity Editor.</p>
			<p class="callout-heading">Further Information</p>
			<p class="callout">If you would like to<a id="_idIndexMarker1412"/> find out more about other platform-dependent compilations, check out the following link:</p>
			<p class="callout"><a href="https://docs.unity3d.com/Manual/PlatformDependentCompilation.html">https://docs.unity3d.com/Manual/PlatformDependentCompilation.html</a>.</p>
			<p>If we are using an Android device, we fall into the scope of this special type of <strong class="source-inline">if</strong> statement and do the following:</p>
			<ul>
				<li>We set the <strong class="source-inline">bool</strong> <strong class="source-inline">mobile</strong> variable to <strong class="source-inline">true</strong>.</li>
				<li>Make our <strong class="source-inline">Attack</strong> method get called every <strong class="source-inline">0.3</strong> seconds with Unity's own <strong class="source-inline">InvokeRepeating</strong> function, which acts as an auto-fire tool.</li>
				<li>Assign the <strong class="source-inline">player_ship</strong> game object's <strong class="bold">Rigidbody</strong> to the <strong class="source-inline">rb</strong> variables.</li>
				<li>Finally, we close the <strong class="source-inline">if</strong> statement. </li>
			</ul>
			<p>To make our <strong class="source-inline">InvokeRepeating</strong> method fire a bullet with the use of the <strong class="source-inline">Attack</strong> method at <strong class="source-inline">0.3</strong> seconds, we need to modify the <strong class="source-inline">Attack</strong> method's <strong class="source-inline">if</strong> statement.</p>
			<ol>
				<li value="4">Scroll down to the <strong class="source-inline">Attack</strong> method in the <strong class="source-inline">Player</strong> script and replace the <strong class="source-inline">if</strong> statement with the following:<p class="source-code">  if (Input.GetButtonDown("Fire1") || mobile)</p></li>
			</ol>
			<p>By adding the <strong class="source-inline">mobile</strong> variable to the <strong class="source-inline">if</strong> statement's condition, we can check whether the player is pressing the fire button or whether the <strong class="source-inline">mobile</strong> <strong class="source-inline">bool</strong> variable is set to <strong class="source-inline">true</strong>.</p>
			<p>Now, we need to add more functionality to the <strong class="source-inline">Update</strong> function within our <strong class="source-inline">Player</strong> script, which includes two new methods we haven't coded in yet but will after the following code block.</p>
			<ol>
				<li value="5">Replace the current <strong class="source-inline">Update</strong> function in the <strong class="source-inline">Player</strong> script and its content with the following <a id="_idIndexMarker1413"/>code so that it <a id="_idIndexMarker1414"/>supports PC and mobile controls:<p class="source-code">void Update ()</p><p class="source-code"> {</p><p class="source-code">   if(Time.timeScale == 1)</p><p class="source-code">    {</p><p class="source-code">      PlayersSpeedWithCamera();        </p><p class="source-code">      if (mobile)</p><p class="source-code">       {</p><p class="source-code">         MobileControls();</p><p class="source-code">       }</p><p class="source-code">       else</p><p class="source-code">       {</p><p class="source-code">         Movement();</p><p class="source-code">         Attack(); </p><p class="source-code">       }</p><p class="source-code">     }</p><p class="source-code">  }</p></li>
			</ol>
			<p>Our refreshed <strong class="source-inline">Update</strong> function contains the following:</p>
			<ul>
				<li>An <strong class="source-inline">if</strong> statement to check whether the game has been paused. If it has, we bypass the rest of the <strong class="source-inline">Update</strong> content. If you want to find out more about pausing the game, check out <a href="B18381_10_Epub.xhtml#_idTextAnchor173"><em class="italic">Chapter 10</em></a><em class="italic">, Pausing the Game, Altering Sound, and a Mock Test</em>.</li>
				<li>Within the <strong class="source-inline">if</strong> statement, we run a new method called <strong class="source-inline">PlayersSpeedWithCamera</strong>, which will contain code we have already coded. We're simply moving the code into the method so that it covers PC and mobile controls for when the camera has speed applied to it.</li>
				<li>Then, we have a second <strong class="source-inline">if</strong> statement that checks whether the <strong class="source-inline">mobile</strong> <strong class="source-inline">bool</strong> variable is set to <strong class="source-inline">true</strong> or <strong class="source-inline">false</strong>. If <strong class="source-inline">true</strong>, we run our <strong class="source-inline">MobileControls</strong> method; otherwise, our PC <strong class="source-inline">Movement</strong> and <strong class="source-inline">Attack</strong> methods will run.</li>
				<li>As mentioned previously, we have two new methods (<strong class="source-inline">PlayersSpeedWithCamera</strong> and <strong class="source-inline">MobileControls</strong>). The first method is a simple cut and paste of code from the current <strong class="source-inline">Movement</strong> method, which we want to accommodate for PC and mobile controls. The second method will cover touch controls for when the player places their finger on the screen and the <strong class="source-inline">player_ship</strong> game object moves to that location.</li>
			</ul>
			<ol>
				<li value="6">So, let's start with the <strong class="source-inline">PlayersSpeedWithCamera</strong> method first. Still in the <strong class="source-inline">Player</strong> script, scroll down to the <strong class="source-inline">Movement</strong> method and select and cut the first <strong class="source-inline">if</strong> statement. The<a id="_idIndexMarker1415"/> following<a id="_idIndexMarker1416"/> is the code that I want you to cut:<p class="source-code">if(camTravelSpeed &gt; 1)</p><p class="source-code">   {</p><p class="source-code">       transform.position += Vector3.right * Time.                   </p><p class="source-code">           deltaTime* camTravelSpeed;</p><p class="source-code">      movingScreen += Time.deltaTime * camTravelSpeed;</p><p class="source-code">   }</p></li>
				<li>Then, create a new method in the <strong class="source-inline">Player</strong> script called <strong class="source-inline">PlayersSpeedWithCamera</strong> and paste the previous <strong class="source-inline">if</strong> statement code block inside the scope of the <strong class="source-inline">PlayersSpeedWithCamera</strong> method.</li>
			</ol>
			<p>Now, the content of the <strong class="source-inline">PlayersSpeedWithCamera</strong> method will run for mobile and standalone platforms. If you would like to refresh yourself on the details of the camera's travel speed, take a look at <em class="italic">, NavMesh, Timeline, and a Mock Test</em>.</p>
			<p>Now, let's take a look at the second method called <strong class="source-inline">MobileControls</strong>, which can be found in the <strong class="source-inline">Player</strong> script.</p>
			<ol>
				<li value="8">Write the following method inside the <strong class="source-inline">Player</strong> script so that the player can navigate <strong class="source-inline">player_ship</strong> around the screen:<p class="source-code">    void MobileControls()</p><p class="source-code">    {</p><p class="source-code">        if (Input.touchCount &gt; 0)</p><p class="source-code">        {</p><p class="source-code">            Touch touch = Input.GetTouch(0);</p><p class="source-code">            Vector3 touchPosition = Camera.main.                ScreenToWorldPoint(new Vector3(touch.                    position.x,touch.position.y,300));</p><p class="source-code">            touchPosition.z = 0;</p><p class="source-code">            direction = (touchPosition - transform                 .position);</p><p class="source-code">            rb.velocity = new Vector3(direction.x,                 direction.y,0)* 5;</p><p class="source-code">            direction.x += movingScreen;</p><p class="source-code">           </p><p class="source-code">            if (touch.phase == TouchPhase.Ended)</p><p class="source-code">            {</p><p class="source-code">                rb.velocity = Vector3.zero;</p><p class="source-code">            }</p><p class="source-code">        }</p><p class="source-code">    }</p></li>
			</ol>
			<p>Keep in<a id="_idIndexMarker1417"/> mind <a id="_idIndexMarker1418"/>that the <strong class="source-inline">MobileControls</strong> method is called on every frame in the <strong class="source-inline">Update</strong> function. Inside the <strong class="source-inline">MobileControls</strong> method, we do the following:</p>
			<ul>
				<li>Run an <strong class="source-inline">if</strong> statement to check whether there has been more than one touch on the screen of the device. If a finger has touched the screen, we fall into the <strong class="source-inline">if</strong> statement's scope.</li>
				<li>We assign a touch to a <strong class="source-inline">touch</strong> variable.<p class="callout-heading">Further Information</p><p class="callout">If you would like to know more about the <strong class="source-inline">Touch</strong> struct and its other properties, such as <strong class="source-inline">deltaPosition</strong>, which is useful for measuring swipe gestures, take a look at <a href="https://docs.unity3d.com/ScriptReference/Touch.html">https://docs.unity3d.com/ScriptReference/Touch.html</a>.</p></li>
				<li>Next, we take a ready-made function from Unity to convert the screen's touch position and store it in a world space position.<p class="callout-heading">Further Information</p><p class="callout">If you would like to know more about converting a point into world space, check out the following link: <a href="https://docs.unity3d.com/ScriptReference/Camera.ScreenToWorldPoint.html">https://docs.unity3d.com/ScriptReference/Camera.ScreenToWorldPoint.html</a>.</p></li>
				<li>Because we aren't affecting the player ship's <em class="italic">z</em> axis, we set <strong class="source-inline">touchPosition</strong> on the Z axis to zero.</li>
				<li>Store the <strong class="source-inline">Vector3</strong> position of <strong class="source-inline">touchPosition</strong>, minus the <strong class="source-inline">Vector3</strong> position of the player's ship.</li>
				<li>Send the <strong class="source-inline">player_ship</strong> game object to the <strong class="source-inline">Vector3</strong> position that is stored in <strong class="source-inline">direction</strong>. Multiply it by <strong class="source-inline">5</strong> to make it move slightly faster.</li>
				<li>Apply whatever value is in the <strong class="source-inline">movingScreen</strong> variable to the <strong class="source-inline">direction</strong> <em class="italic">x</em> position.</li>
				<li>Finally, if the state of the touch phase has ended (a finger taken off the screen), apply a zero value to the <strong class="source-inline">rb velocity</strong> variable.</li>
			</ul>
			<p>So, now, the player's ship automatically fires and can move around the screen thanks to its <strong class="bold">Rigidbody</strong> component. Now, we need to make it that when either level ends, we stop the player from firing automatically and <strong class="bold">Rigidbody</strong> no longer has an effect on the player's movement. Otherwise, when the level ends, the player's ship won't stop firing, running the <a id="_idIndexMarker1419"/>risk of not being able to<a id="_idIndexMarker1420"/> animate out of the level.</p>
			<p>To fix our player from continuously shooting and being able to be moved at the end of the level, we need to do the following:</p>
			<ol>
				<li value="1">In the <strong class="bold">Project</strong> window, navigate to the <strong class="source-inline">Assets/Script</strong> folder and open the <strong class="source-inline">ScenesManager</strong> script.</li>
				<li>Inside the <strong class="source-inline">ScenesManager</strong> script, scroll down to the <strong class="source-inline">if</strong> statement that checks whether the game has ended (<strong class="source-inline">!gameEnding</strong>) and add the following line of code within its <strong class="source-inline">if</strong> statement:<p class="source-code">     if (!gameEnding)</p><p class="source-code">      {</p><p class="source-code">        gameEndine = true;</p><p class="source-code">StartCoroutine(MusicVolume(MusicMode.fadeDown));</p><p class="source-code">        GameObject player = GameObject.Find("Player");                     // ADD THIS CODE</p><p class="source-code">        player.GetComponent&lt;Rigidbody&gt;().isKinematic = true;               // ADD THIS CODE</p><p class="source-code">        Player.mobile = false;                                          // ADD THIS CODE</p><p class="source-code">        CancelInvoke();                                                 // ADD THIS CODE</p><p class="source-code">        if (SceneManager.GetActiveScene().name != "level3")</p></li>
			</ol>
			<p>In the previous code block, we have added four new lines of code that will do the following:</p>
			<ul>
				<li>Cache a reference from our <strong class="source-inline">player_ship</strong> game object</li>
				<li>Access the <strong class="source-inline">player_ship</strong> <strong class="bold">Rigidbody</strong> component and set <strong class="bold">isKinematic</strong> to <strong class="source-inline">true</strong></li>
				<li>Set the <strong class="source-inline">mobile</strong> <strong class="source-inline">bool</strong> <strong class="source-inline">static</strong> variable to <strong class="source-inline">false</strong></li>
				<li>Run Unity's <strong class="source-inline">CancelInvoke</strong> function to stop all invokes running in our scene (stops auto-fire) </li>
			</ul>
			<ol>
				<li value="3">Save the <strong class="source-inline">ScenesManager</strong> script.</li>
			</ol>
			<p>Now, we need to go into <strong class="bold">Input Manager</strong> and look at the <strong class="bold">Fire1</strong> button. Here, the left mouse button is set to the <strong class="bold">Alt Positive Button</strong> property. To fix this in the Unity Editor, do the following:</p>
			<ol>
				<li value="1">Go to <strong class="bold">Edit | Project Settings | Input Manager.</strong></li>
				<li>Set <strong class="bold">Alt Positive Button</strong> to <strong class="source-inline">mouse 0</strong>.</li>
			</ol>
			<p>Our game is now self-aware of what device it will run on, and if the device does run on a mobile<a id="_idIndexMarker1421"/> Android device, the touch controls will<a id="_idIndexMarker1422"/> be implemented.</p>
			<p>Now, let's widen the support for our game and ensure our game covers various screen ratios and screen boundaries on either platform.</p>
			<h2 id="_idParaDest-222"><a id="_idTextAnchor225"/>Extending screen ratio support</h2>
			<p>In this section, we <a id="_idIndexMarker1423"/>are going to do two things. The first is to make it that no matter what aspect ratio our game is running at, our player will be able to fly around. The second is to make sure that the Text UI isn't affected by the different screen ratios.</p>
			<p>So, let's start with our first task of making our game support multiple screen ratios during levels.</p>
			<p>In the <strong class="bold">Project</strong> window, navigate to the <strong class="source-inline">Assets/Script</strong> folder and open the <strong class="source-inline">Player</strong> script. Then, follow these steps:</p>
			<ol>
				<li value="1">At the top of the script, where the variables are, comment out the width and height floats; we are going to replace them:<p class="source-code">    // float width;</p><p class="source-code">    // float height;</p></li>
				<li>Add the following <strong class="source-inline">GameObject</strong> array to hold our new points:<p class="source-code">GameObject[] screenPoints = new GameObject[2];</p></li>
			</ol>
			<p>The array we've just added will hold two points to represent our screen's boundaries.</p>
			<ol>
				<li value="3">Next, in the <strong class="source-inline">Player</strong> script's <strong class="source-inline">Start</strong> function, we need to comment out the following:<p class="source-code">  // height = 1/(Camera.main.WorldToViewportPoint(new</p><p class="source-code">        Vector3(1,1,0)).y - .5f);</p><p class="source-code">  // width = 1/(Camera.main.WorldToViewportPoint(new</p><p class="source-code">        Vector3(1,1,0)).x - .5f);</p><p class="source-code">  // movingScreen = width;</p></li>
				<li>Add the following method name:<p class="source-code">CalculateBoundaries();</p></li>
			</ol>
			<p>The method we've just entered does not exist yet, so let's add this new method now.</p>
			<ol>
				<li value="5">Still in the <strong class="source-inline">Player</strong> script, add the following method and its content to create our new <a id="_idIndexMarker1424"/>screen's boundaries:<p class="source-code">    void CalculateBoundaries()</p><p class="source-code">    {</p><p class="source-code">        screenPoints[0] = new GameObject("p1");</p><p class="source-code">        screenPoints[1] = new GameObject("p2");</p><p class="source-code">        Vector3 v1 = Camera.main.ViewportToWorldPoint   </p><p class="source-code">            (new Vector3(0, 1, 300));</p><p class="source-code">        Vector3 v2 = Camera.main.ViewportToWorldPoint             (new Vector3(1, 0, 300));</p><p class="source-code">        screenPoints[0].transform.position = v1;</p><p class="source-code">        screenPoints[1].transform.position = v2;</p><p class="source-code">        screenPoints[0].transform.SetParent(this.    transform.parent);</p><p class="source-code">        screenPoints[1].transform.SetParent(this.    transform.parent);</p><p class="source-code">        movingScreen = screenPoints[1].transform.    position.x;</p><p class="source-code">    }</p></li>
			</ol>
			<p>So, let's go through the steps of the <strong class="source-inline">CalculateBoundaries</strong> method and see what it does to our game:</p>
			<ol>
				<li>First, it creates two new game objects and names them <strong class="source-inline">"p1"</strong> and <strong class="source-inline">"p2"</strong>.</li>
				<li>We then make use of the <strong class="source-inline">ViewportToWorldPoint</strong> function, which will give us our game's world space positions for our screen's boundaries.</li>
				<li>Then, we apply our new <strong class="source-inline">Vector3</strong> variables, <strong class="source-inline">v1</strong> and <strong class="source-inline">v2</strong>, to our array of game object positions – that is, <strong class="source-inline">"p1"</strong> and <strong class="source-inline">"p2"</strong>.</li>
				<li>Now that <strong class="source-inline">"p1"</strong> and <strong class="source-inline">"p2"</strong> represent the boundaries, we need to make them children of the <strong class="source-inline">Player</strong> script, which will update their <strong class="bold">Transform</strong> <strong class="bold">Position</strong> values.</li>
				<li>Finally, we update the <strong class="source-inline">movingScreen</strong> <strong class="source-inline">float</strong> value with our <strong class="source-inline">screenPoint</strong> value for when the game has a moving camera.</li>
			</ol>
			<p>Continuing with the <strong class="source-inline">Player</strong> script, we now need to update the <strong class="source-inline">Movement</strong> method's directional conditions so that they support our new game boundaries.</p>
			<ol>
				<li value="6">Scroll down to the <strong class="source-inline">Movement</strong> method and replace all four of the old <strong class="source-inline">if</strong> statements<a id="_idIndexMarker1425"/> with the new ones:<p class="source-code">//OLD</p><p class="source-code">if (transform.localPosition.x &lt; width + width/0.9f)</p><p class="source-code">//NEW</p><p class="source-code">if (transform.localPosition.x &lt; (screenPoints[1].transform.localPosition.x - screenPoints[1].transform.localPosition.x/30f)+movingScreen)</p><p class="source-code">//OLD</p><p class="source-code">if (transform.localPosition.x &gt; width + width/6)</p><p class="source-code">//NEW</p><p class="source-code">if (transform.localPosition.x &gt; (screenPoints[0].transform.localPosition.x + screenPoints[0].transform.localPosition.x/30f)+movingScreen)</p><p class="source-code">//OLD</p><p class="source-code">if (transform.localPosition.y &gt; -height/3f)</p><p class="source-code">//NEW</p><p class="source-code">if (transform.localPosition.y &gt; (screenPoints[1].transform.localPosition.y - screenPoints[1].transform.localPosition.y/3f))</p><p class="source-code">//OLD</p><p class="source-code">if (transform.localPosition.y &lt; height/2.5f)</p><p class="source-code">//NEW</p><p class="source-code">if (transform.localPosition.y &lt; (screenPoints[0].transform.localPosition.y - screenPoints[0].transform.localPosition.y/5f))</p></li>
			</ol>
			<p>Each of the new <strong class="source-inline">if</strong> statements in the previous lines of code will hold the same purpose of taking the value from the <strong class="source-inline">p1</strong> or <strong class="source-inline">p2</strong> game objects to get a restriction of the boundaries of the screen. This ensures that the player ship doesn't go too far out of view.</p>
			<p>The following screenshot shows the <strong class="source-inline">level1</strong> scene, with <strong class="source-inline">p1</strong> and <strong class="source-inline">p2</strong> representing the new gameplay boundaries in a different resolution from the usual 1,920 x 1,080 to show the flexibility that our gameplay boundary <a id="_idIndexMarker1426"/>now has:</p>
			<div>
				<div id="_idContainer493" class="IMG---Figure">
					<img src="image/Figure_13.08_B18381.jpg" alt="Figure 13.8 – Our new gameplay boundaries&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.8 – Our new gameplay boundaries</p>
			<p>Lastly, we need to update our <strong class="source-inline">PlayerSpeedWithCamera</strong> method and set the <strong class="source-inline">movingScreen</strong> variable to zero if the game camera isn't moving to the right.</p>
			<ol>
				<li value="7">Inside the <strong class="source-inline">Player</strong> script, go to the <strong class="source-inline">PlayersSpeedWithCamera</strong> method and add the following <strong class="source-inline">else</strong> condition:<p class="source-code">    else</p><p class="source-code">        {</p><p class="source-code">            movingScreen = 0;</p><p class="source-code"> }</p></li>
				<li>Save the <strong class="source-inline">Player</strong> script.</li>
			</ol>
			<p>Now, let's move on <a id="_idIndexMarker1427"/>and look at the second part of this fix. Here, even though the gameplay window now supports various aspect ratios, some images and text will struggle to look cosmetically pleasing. The following screenshots show what would happen to our game's pause screen if we changed the typical 1,920 x 1,080 resolution:</p>
			<div>
				<div id="_idContainer494" class="IMG---Figure">
					<img src="image/Figure_13.09_B18381.jpg" alt="Figure 13.9 – Pause Screen difference in alternative ratios&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.9 – Pause Screen difference in alternative ratios</p>
			<p>As you can see, the text and images lose their scale when they're in different aspect ratios. We can fix this by doing the following:</p>
			<ol>
				<li value="1">In the <strong class="bold">Project</strong> window, navigate to the <strong class="source-inline">Assets/Scene</strong> folder and double-click the <strong class="source-inline">level1</strong> scene.</li>
				<li>Select the <strong class="source-inline">Canvas</strong> game object in the <strong class="bold">Hierarchy</strong> window. Then, in the <strong class="bold">Inspector</strong> window, change <strong class="bold">UI Scale Mode</strong> in <strong class="bold">Canvas Scaler</strong> to <strong class="bold">Scale</strong> <strong class="bold">With Screen Size</strong>, as shown in the following screenshot:</li>
			</ol>
			<div>
				<div id="_idContainer495" class="IMG---Figure">
					<img src="image/Figure_13.10_B18381.jpg" alt="Figure 13.10 – Updating the Canvas Scaler | Scale Mode&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.10 – Updating the Canvas Scaler | Scale Mode</p>
			<ol>
				<li value="3">Change the <strong class="bold">Reference Resolution</strong> property to <strong class="bold">X</strong>: <strong class="source-inline">1920</strong> and <strong class="bold">Y</strong>: <strong class="source-inline">1080</strong>.</li>
			</ol>
			<p>Now, our <strong class="bold">Game</strong> window, when shown at various screen sizes, will look more in proportion.</p>
			<div>
				<div id="_idContainer496" class="IMG---Figure">
					<img src="image/Figure_13.11_B18381.jpg" alt="Figure 13.11 – Our Pause Screen looks more uniform in the other ratios&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.11 – Our Pause Screen looks more uniform in the other ratios</p>
			<ol>
				<li value="4">Save the <strong class="source-inline">level1</strong> scene and update <strong class="bold">Canvas Scaler</strong> for all the scenes in the project.</li>
			</ol>
			<p>With that, we've made our game more compatible in that it supports various aspect ratios for platforms other than a standard 1,920 x 1,080 resolution. Also, our game controls are self-aware of whether the game's being played on a PC or Android device. We also made<a id="_idIndexMarker1428"/> use of the <strong class="source-inline">Touch</strong> struct to move our player around the scene.</p>
			<p>In the next section, we are going to finalize our game for mobile before adding extra effects and general polish for the PC build.</p>
			<h1 id="_idParaDest-223"><a id="_idTextAnchor226"/>Preparing to build Killer Wave for mobile</h1>
			<p>In this section, we <a id="_idIndexMarker1429"/>will be finalizing our version of Killer <a id="_idIndexMarker1430"/>Wave for Android. Before we build our game to Android, we need to apply some fixes that will only be necessary for the Android build. </p>
			<p>The fixes we will be applying in this section are as follows:</p>
			<ul>
				<li>Adjusting the lighting so that it suits our Android device</li>
				<li>Making it that when pressing the pause button, our ship doesn't move to its location</li>
				<li>Making it that our game stays in landscape mode</li>
				<li>Stopping the screen from dimming when the device hasn't been touched for a while</li>
				<li>Setting the game textures to a lower resolution</li>
				<li>Adding a prefab explosion to enemies and players</li>
			</ul>
			<p>After we've applied these minor fixes, we will build the game for our Android device.</p>
			<p>So, let's get started with our first task by altering the lighting.</p>
			<h2 id="_idParaDest-224"><a id="_idTextAnchor227"/>Setting up the lighting for Killer Waves for Android</h2>
			<p>Each scene <a id="_idIndexMarker1431"/>that contains a 3D model will require lighting to be generated. The Unity Editor's lighting will differ from the lighting provided on an Android device.</p>
			<p>With the current default lighting settings applied, the following screenshot shows the difference between both platforms. The image on the left was taken on a PC, while the one on the right was taken from a mobile device:</p>
			<p class="figure-caption"> </p>
			<div>
				<div id="_idContainer497" class="IMG---Figure">
					<img src="image/Figure_13.12_B18381.jpg" alt="Figure 13.12 – The difference in lighting between platforms&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.12 – The difference in lighting between platforms</p>
			<p>So, let's adjust the lighting so that both platforms have a similar level of brightness and contrast:</p>
			<ol>
				<li value="1">At the top of the Unity Editor, go to <strong class="bold">Window</strong> | <strong class="bold">Lighting</strong> | <strong class="bold">Settings</strong>.</li>
				<li>Press the <strong class="bold">Environment</strong> button at the top of the <strong class="bold">Lighting</strong> window and apply the following values:</li>
			</ol>
			<div>
				<div id="_idContainer498" class="IMG---Figure">
					<img src="image/Figure_13.13_B18381.jpg" alt="Figure 13.13 – The updated values for the &quot;Lighting&quot; windows properties&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.13 – The updated values for the "Lighting" windows properties</p>
			<ol>
				<li value="3">Next click on the <strong class="bold">Scene</strong> tab. At the top of the window click on the <strong class="bold">New Lighting Settings</strong> button. Untick <strong class="bold">Realtime Global Illumination</strong> and <strong class="bold">Baked Global Illumination</strong>.</li>
			</ol>
			<p>We will cover these two settings when we apply visual improvements, but for now, <strong class="bold">Realtime Global Illumination</strong> affects the indirect lighting that's applied to other objects to help create a more realistic, soft-colored light. <strong class="bold">Baked Global Illumination</strong> will have lights stuck on 3D assets to give the appearance of light shining on a surface, but the majority of our lights move, so this will not work as a baked light.</p>
			<p>The following screenshots now show that the PC and mobile versions are starting to look similar:</p>
			<div>
				<div id="_idContainer499" class="IMG---Figure">
					<img src="image/Figure_13.14_B18381.jpg" alt="Figure 13.14 – PC versus Mobile lighting now looks similar &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.14 – PC versus Mobile lighting now looks similar </p>
			<ol>
				<li value="4">Now, we<a id="_idIndexMarker1432"/> need to enable and adjust the emission of the following enemy materials in the <strong class="bold">Project</strong> window under <strong class="source-inline">Assets/Material</strong>:<ul><li><strong class="source-inline">basicEnemyShip_Inner</strong>: <strong class="bold">Emission</strong> ticked, <strong class="bold">Color</strong>: <strong class="source-inline">993600 (Hex)</strong>, and <strong class="bold">Intensity</strong>: <strong class="source-inline">0.6</strong></li><li><strong class="source-inline">basicEnemyShip_Outer</strong>: <strong class="bold">Emission</strong> ticked, <strong class="bold">Color</strong>: <strong class="source-inline">4C0000(Hex)</strong>, and <strong class="bold">Intensity</strong>: <strong class="source-inline">0.3</strong></li><li><strong class="source-inline">darkRed</strong>: <strong class="bold">Emission</strong> ticked, <strong class="bold">Color</strong>: <strong class="source-inline">801616(Hex)</strong>, and <strong class="bold">Intensity</strong>: <strong class="source-inline">0.5</strong></li></ul></li>
			</ol>
			<p>We explained how to change the emission of a material back in <a href="B18381_02_Epub.xhtml#_idTextAnchor048"><em class="italic">Chapter 2</em></a><em class="italic">, Adding and Manipulating Objects</em>. Changing these values will give us the following output:</p>
			<div>
				<div id="_idContainer500" class="IMG---Figure">
					<img src="image/Figure_13.15_B18381.jpg" alt="Figure 13.15 – PC versus Mobile; both lighting and colors look near enough the same&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.15 – PC versus Mobile; both lighting and colors look near enough the same</p>
			<p>Our game now<a id="_idIndexMarker1433"/> looks nice and bright on either platform. Next, we'll fix the small issue with pausing the mobile version of the game.</p>
			<h2 id="_idParaDest-225"><a id="_idTextAnchor228"/>Stopping involuntary player controls</h2>
			<p>When it <a id="_idIndexMarker1434"/>comes to playing the game on a mobile device, we will want to press the pause button. But if and when we do, the game will also consider the press as a movement command, and the player's ship will move into the top-left corner where the press was made.</p>
			<p>So, to fix this minor issue, we will apply an extra condition to our <strong class="source-inline">MobileControls</strong> method, as follows:</p>
			<ol>
				<li value="1">In the <strong class="bold">Project</strong> window, navigate to the <strong class="source-inline">Assets/Script</strong> folder and open the <strong class="source-inline">Player</strong> script.</li>
				<li>Inside the <strong class="source-inline">Player</strong> script, scroll down to the <strong class="source-inline">MobileControls</strong> method and replace the current <strong class="source-inline">if</strong> statement condition with the following one:<p class="source-code"> if (Input.touchCount &gt; 0  &amp;&amp;</p><p class="source-code">   EventSystem.current.currentSelectedGameObject == null)</p></li>
			</ol>
			<p>The<a id="_idIndexMarker1435"/> preceding code block will run a check to see whether a finger is touching the screen as before but will also check that there isn't a game object in the location when being pressed. If any of these conditions aren't met, then the player will not move.</p>
			<ol>
				<li value="3">Finally, to import <strong class="source-inline">EventSystem</strong>, scroll to the top of the <strong class="source-inline">Player</strong> script and add the following namespace:<p class="source-code">using UnityEngine.EventSystems;</p></li>
				<li>Save the <strong class="source-inline">Player</strong> script. </li>
			</ol>
			<p>In the next section, we will do some final texture optimizations and apply a ready-made and well-earned explosion prefab.</p>
			<h2 id="_idParaDest-226"><a id="_idTextAnchor229"/>Final optimizations for Killer Wave</h2>
			<p>In this section, we<a id="_idIndexMarker1436"/> will be adding some optimization to our mobile version of the game by reducing the size of the textures. We will also add explosions to our enemies and player. </p>
			<p>Let's start by reducing our textures and compressing them.</p>
			<h3>Reducing texture sizes and compression</h3>
			<p>To reduce the<a id="_idIndexMarker1437"/> size of the <strong class="source-inline">.apk</strong> file that gets installed on Android devices, as well as the overall performance increase, we can reduce the size of the textures of our game through Unity and also apply compression, which lowers the size even more.</p>
			<p>The trick is to reduce the size of the texture but not too much; otherwise, the textures themselves will begin to blur and look cheap.</p>
			<p>In this section, we will be reducing the texture sizes of the following:</p>
			<ul>
				<li><strong class="source-inline">PlayerShip</strong> and its extras (shop upgrades and thrusters)</li>
				<li>The background wallpaper texture of the stars in our two levels</li>
				<li>Shop button icons</li>
			</ul>
			<p>Let's start by selecting and reducing the player ship's texture sizes and compressing them:</p>
			<ol>
				<li value="1">In the <strong class="bold">Project</strong> window, navigate to the <strong class="source-inline">Assets/Texture</strong> folder.</li>
				<li>Select all of the following filenames:<ul><li><strong class="source-inline">playerShip_diff</strong></li><li><strong class="source-inline">playerShip_em</strong></li><li><strong class="source-inline">playerShip_met</strong></li><li><strong class="source-inline">playerShip_nrm</strong></li><li><strong class="source-inline">playerShip_oc</strong></li></ul></li>
				<li>All these files have a texture size of 512 x 512, so let's reduce them to 256 x 256, compress <a id="_idIndexMarker1438"/>them, and turn off any filtering by setting them to the values shown in the following screenshot of the <strong class="bold">Inspector</strong> window:</li>
			</ol>
			<div>
				<div id="_idContainer501" class="IMG---Figure">
					<img src="image/Figure_13.16_B18381.jpg" alt="Figure 13.16 – Reduce the texture size from 512 x 512 to 256 x 256&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.16 – Reduce the texture size from 512 x 512 to 256 x 256</p>
			<ol>
				<li value="4">Do the same to the following textures, all of which can be in the same folder. However, this time, set the texture size from 1,024 x 1,024 all the way down to 64 x 64:<ul><li><strong class="source-inline">b. Shot_diff</strong></li><li><strong class="source-inline">b. Shot_nrm</strong></li><li><strong class="source-inline">c. Bomb_diff</strong></li><li><strong class="source-inline">c. Bomb_nrm</strong></li></ul></li>
			</ol>
			<p>Continue doing this for the rest of the textures, and see what the results look like in the game by playing between the <strong class="source-inline">shop</strong> and <strong class="source-inline">level1</strong> scenes. Do this at your own discretion.</p>
			<p class="callout-heading">Further Information</p>
			<p class="callout">If you would like to know more about the textures that get imported into a project and how to adjust their quality levels, check out the following link: <a href="https://docs.unity3d.com/Manual/ImportingTextures.html">https://docs.unity3d.com/Manual/ImportingTextures.html</a>.</p>
			<p>Now, let's move on and add a ready-made particle explosion to each of our players and enemies by making some minor scripting tweaks.</p>
			<h3>Adding explosions to our players and enemies</h3>
			<p>The time has <a id="_idIndexMarker1439"/>come to add a prefab explosion to our game objects to represent their destruction and their general effect on the boss when they are being shot at. We covered particle systems back in <a href="B18381_04_Epub.xhtml#_idTextAnchor087"><em class="italic">Chapter 4</em></a>, <em class="italic">Applying Art, Animation, and Particles</em>. Here, we will apply some scripting so that when a <strong class="source-inline">Die</strong> method is called, we will instantiate our <strong class="source-inline">explode</strong> prefab.</p>
			<p>To instantiate the explode prefab when an enemy dies, we need to do the following:</p>
			<ol>
				<li value="1">In the <strong class="bold">Project</strong> window, navigate to the <strong class="source-inline">Assets/Script</strong> folder and open the <strong class="source-inline">EnemyWave</strong> script.</li>
				<li>Inside the <strong class="source-inline">Die</strong> method, replace its content with the following to instantiate the <strong class="source-inline">explode</strong> game object:<p class="source-code">GameObject explode =</p><p class="source-code">   GameObject.Instantiate(Resources.Load("explode")) </p><p class="source-code">       as GameObject;</p><p class="source-code">explode.transform.position = this.gameObject.transform.position;</p><p class="source-code">Destroy(this.gameObject);</p></li>
			</ol>
			<p>In the previous code block, we added two extra lines above the current <strong class="source-inline">Destroy</strong> function. We covered this in detail in <a href="B18381_02_Epub.xhtml#_idTextAnchor048"><em class="italic">Chapter 2</em></a>, <em class="italic">Adding and Manipulating Objects</em>. The two extra lines do the following:</p>
			<ul>
				<li>When the <strong class="source-inline">Die</strong> method runs, it will create the <strong class="source-inline">explode</strong> prefab from <strong class="source-inline">Assets/Prefab</strong>.</li>
				<li>The position of the <strong class="source-inline">explode</strong> instance is updated with the same location as the enemies.</li>
			</ul>
			<ol>
				<li value="3">Save the <strong class="source-inline">EnemyWave</strong> script and repeat this process for the <strong class="source-inline">EnemyFlee</strong> and <strong class="source-inline">BossScript</strong> scripts.</li>
			</ol>
			<p>Finally, for our <strong class="source-inline">Player</strong>, we will add something similar but also add a delay for when <strong class="source-inline">player_ship</strong> gets destroyed so that we can see the explosion before we reload the scene again.</p>
			<ol>
				<li value="4">Still in the same <strong class="bold">Project</strong> window, open the <strong class="source-inline">Player</strong> script, scroll down to the <strong class="source-inline">Die</strong> method, and replace its content with the following:<p class="source-code">    GameObject explode =</p><p class="source-code">      GameObject.Instantiate(Resources.Load("Prefab/explode")) </p><p class="source-code">        as GameObject;</p><p class="source-code">    explode.transform.position = this.gameObject.transform.position;</p><p class="source-code">    GameManager.Instance.LifeLost();</p><p class="source-code">    Destroy(this.gameObject);</p></li>
			</ol>
			<p>In the previous code, we have updated the player's <strong class="source-inline">Die</strong> method so that it creates a prefab explosion and houses its position where the player's position is.</p>
			<p>However, we need to add a delay in the <strong class="source-inline">GameManager</strong> script where the previous code block was introduced.</p>
			<ol>
				<li value="5">Save the <strong class="source-inline">Player</strong> script before continuing with the <strong class="source-inline">GameManager</strong> script.</li>
				<li>Open the <strong class="source-inline">GameManager</strong> script so that you can add a delay to the scene when it's updated.</li>
				<li>In the <strong class="source-inline">GameManager</strong> script, scroll down to the <strong class="source-inline">LifeLost</strong> method, select its content, <em class="italic">Cut</em> it (cut, not <em class="italic">Delete</em>, as<a id="_idIndexMarker1440"/> we are going to paste it somewhere else), and replace the <strong class="source-inline">LifeLost</strong> method with the following code:<p class="source-code">StartCoroutine(DelayedLifeLost());</p></li>
			</ol>
			<p>Here, we are delaying the content from our <strong class="source-inline">LifeLost</strong> method. However, here, we will be using <strong class="source-inline">StartCoroutine</strong> to create the delay, as shown in the previous line of code.</p>
			<ol>
				<li value="8">Next, we will paste the content from the original <strong class="source-inline">LifeLost</strong> method inside the following code block:<p class="source-code">  IEnumerator DelayedLifeLost()</p><p class="source-code">  {</p><p class="source-code">    yield return new WaitForSeconds(2);</p><p class="source-code">// PASTE LIFELOST CONTENT HERE</p><p class="source-code">  }</p></li>
			</ol>
			<p>In the preceding code block, we have added <strong class="source-inline">IEnumerator</strong>. This will be executed from <strong class="source-inline">StartCoroutine</strong>, along with a 2-second wait. If your <strong class="source-inline">IEnumerator</strong> has an error underlined in the IDE.  Add the library <strong class="source-inline">using System.Collections</strong>; at the top of the script.</p>
			<p>Paste in the <strong class="source-inline">LifeLost</strong> content we cut earlier and then save the <strong class="source-inline">GameManager</strong> script.</p>
			<p>The following screenshot shows our game object with particle explosions applied:</p>
			<div>
				<div id="_idContainer502" class="IMG---Figure">
					<img src="image/Figure_13.17_B18381.jpg" alt="Figure 13.17 – Particle Effects&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.17 – Particle Effects</p>
			<p>Now, the <a id="_idIndexMarker1441"/>time has come to create a build of our Android platform.</p>
			<h2 id="_idParaDest-227"><a id="_idTextAnchor230"/>Setting up the build settings for Android</h2>
			<p>In this section, we <a id="_idIndexMarker1442"/>are going to set up our <strong class="bold">Player Settings</strong> and <a id="_idIndexMarker1443"/>build our Unity Project for an Android device. For testing purposes, I will be using a fairly old tablet and a recent phone to see whether there are any differences in terms of the setup between the two devices.</p>
			<p>Before setting up our <strong class="bold">Player Settings</strong>, ensure you have copies of the Java Development Kit and Android SDK installed. To check this, do the following: </p>
			<ol>
				<li value="1">At the top of the Unity Editor, go to <strong class="bold">Edit</strong> | <strong class="bold">Preferences</strong>.</li>
				<li>Then, click on <strong class="bold">External Tools</strong> in the <strong class="bold">Unity Preferences</strong> window.</li>
				<li>The following screenshot shows these two development kits, along with <strong class="bold">Download</strong> buttons for them. If you don't have either, these can be installed via the Unity Hub, which we covered in <a href="B18381_01_Epub.xhtml#_idTextAnchor016"><em class="italic">Chapter 1</em></a><em class="italic">, Setting Up and Structuring Our Project</em>.</li>
			</ol>
			<div>
				<div id="_idContainer503" class="IMG---Figure">
					<img src="image/Figure_13.18_B18381.jpg" alt="Figure 13.18 – Both Development Kits are installed&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.18 – Both Development Kits are installed</p>
			<p class="callout-heading">Further Information</p>
			<p class="callout">If you require any more specific information about the development kit installation process, check out the following link: <a href="https://docs.unity3d.com/Manual/Preferences.html">https://docs.unity3d.com/Manual/Preferences.html</a>.</p>
			<p>Now, let's continue to <strong class="bold">Player Settings</strong> and set up our game:</p>
			<ol>
				<li value="4">At the top of the Unity Editor, go to <strong class="bold">File</strong> | <strong class="bold">Build Settings…</strong>.</li>
				<li>Make sure you have all of the scenes set up in <strong class="bold">Scenes In Build</strong>.</li>
				<li>Select <strong class="bold">Android</strong> from <a id="_idIndexMarker1444"/>the <strong class="bold">Platform</strong> list <a id="_idIndexMarker1445"/>and click <strong class="bold">Switch Platform</strong>.</li>
			</ol>
			<div>
				<div id="_idContainer504" class="IMG---Figure">
					<img src="image/Figure_13.19_B18381.jpg" alt="Figure 13.19 – In Build Settings, select &quot;Android&quot; and then &quot;Switch Platform&quot;&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.19 – In Build Settings, select "Android" and then "Switch Platform"</p>
			<ol>
				<li value="7">Click <strong class="bold">Player Settings...</strong> to <a id="_idIndexMarker1446"/>move<a id="_idIndexMarker1447"/> on to the next stage of setting up for Android.</li>
				<li>In the <strong class="bold">Inspector</strong> window, at the top of the window, update the <strong class="bold">Company Name</strong> and <strong class="bold">Product Name</strong> fields to whatever you wish.</li>
				<li>Select the <strong class="bold">Resolution and Presentation</strong> tab and untick <strong class="bold">Portrait</strong> and <strong class="bold">Portrait Upside Down</strong>.</li>
				<li>Select the <strong class="bold">Other Settings</strong> tab.</li>
				<li>Scroll down to the <strong class="bold">Identification</strong> section. In the following screenshot, you will see the <strong class="bold">Package Name</strong> field is filled out with our company name and product name (<strong class="bold">com.Packt.KillerWave</strong>):</li>
			</ol>
			<div>
				<div id="_idContainer505" class="IMG---Figure">
					<img src="image/Figure_13.20_B18381.jpg" alt="Figure 13.20 – Adding our package name in the 'Identification' section (Player Settings)&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.20 – Adding our package name in the 'Identification' section (Player Settings)</p>
			<ol>
				<li value="12">Also, set <strong class="bold">Minimum API Level</strong> to <strong class="bold">23</strong> or above if your device can handle it. If it can't, when we go to build, you will receive an error in the <strong class="bold">Console</strong> window regarding changing the <strong class="bold">Minimum API Level</strong> value.</li>
				<li>Go <a id="_idIndexMarker1448"/>back <a id="_idIndexMarker1449"/>to the <strong class="bold">Build Settings</strong> window and click the <strong class="bold">Build</strong> button.</li>
				<li>You will be asked to give <strong class="source-inline">apk</strong> a name and location. Pick wherever and whatever you want to name the file and click <strong class="bold">Save</strong>.<p class="callout-heading">Tips</p><p class="callout">If you get a <strong class="bold">Gradle build failed</strong> error, try changing <strong class="bold">Build System</strong> in the <strong class="bold">Build Settings</strong> window to <strong class="bold">Internal</strong>.</p></li>
				<li>Finally, ensure you have your Android device in USB debugging mode and copy <strong class="source-inline">apk</strong> over to the device.</li>
				<li>Go to the location where <strong class="source-inline">apk</strong> has been copied on the device and select it to install and run it.<p class="callout-heading">Tip</p><p class="callout">When testing the game on an Android device, you may find it distracting that your device's brightness dims when the screen isn't being touched.</p><p class="callout">We can fix this by adding the following code, ideally in the <strong class="source-inline">Awake</strong> function of the <strong class="source-inline">GameManager</strong> script, as this relates to the game's overall interaction:</p><p class="callout"><strong class="source-inline">#if UNITY_ANDROID</strong></p><p class="callout"><strong class="source-inline">       Screen.sleepTimeout = SleepTimeout.NeverSleep;</strong></p><p class="callout"><strong class="source-inline">#endif</strong></p></li>
			</ol>
			<p>This brings us to the end of building our game for mobile. In this section, we covered setting up our lighting settings so that they matched what we were seeing in the Unity Editor. After that, we cleared up some small fixes so that we wouldn't unintentionally move the player ship to where the pause button is when we press it on our device. We also reduced the size of our <strong class="source-inline">apk</strong> by reducing the size of the textures for our game. This also helps with the performance of Android devices when they're playing our game. Then, we added our <strong class="source-inline">explode</strong> prefab and made some fixes to our script to instantiate our explosions in the right place at the right time.</p>
			<p>Finally, we went through the procedure of setting up our Unity build file and copied it over to the Android device so that it can be installed and run.</p>
			<p>Congratulations if you have made it this far, built the game, and everything works as expected! If not, or you met some issues along the way, don't worry – other Unity users will have had<a id="_idIndexMarker1450"/> similar <a id="_idIndexMarker1451"/>problems, and the solutions to them aren't too hard to find with some Googling. Now, we will start bug-testing our game.</p>
			<div>
				<div id="_idContainer506" class="IMG---Figure">
					<img src="image/Figure_13.21_B18381.jpg" alt="Figure 13.21 – Killer Wave running on an old tablet&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.21 – Killer Wave running on an old tablet</p>
			<p>In the <a id="_idIndexMarker1452"/>next<a id="_idIndexMarker1453"/> section, we'll apply polish and shine to our PC version.</p>
			<h1 id="_idParaDest-228"><a id="_idTextAnchor231"/>Applying PC visual improvements</h1>
			<p>In this section, we <a id="_idIndexMarker1454"/>are going to focus on the PC version, where we will have more leg room to apply effects, as it's likely the PC playing this game will be more powerful than a mobile device.</p>
			<p>We will cover things such as post-processing, where we can create pretty effects to make our game shine even more. We can do this by applying effects such as blur motion, blurring to the edges of the screen, bending the screen to give it a dome screen effect, and altering the coloring.</p>
			<p>We'll also be taking a look at lighting and reflections so that we have a slightly modified shop scene that will hold multiple lights and make the game stand out more. In the <strong class="source-inline">level3</strong> scene, we will be adding reflective assets to show off the use of these reflection probes<a id="_idIndexMarker1455"/> on our art assets.</p>
			<p>Let's start by discussing post-processing.</p>
			<h2 id="_idParaDest-229"><a id="_idTextAnchor232"/>Post-processing</h2>
			<p>In this section, we will<a id="_idIndexMarker1456"/> be installing and applying post-processing effects to our game. This will provide us with effects that are used in films, such as film grain, chromatic abbreviation, color grading, and lens distortion. Let's make a start by installing this package into our project.</p>
			<h3>Installing post-processing</h3>
			<p><strong class="bold">Post Processing</strong> is <a id="_idIndexMarker1457"/>installed via the <strong class="bold">Package Manager</strong> directly into our project. In the previous chapter, we installed <strong class="bold">Default Playables</strong> in a similar way. This time, we won't be going to the Asset Store; we can download and install <strong class="bold">Post Processing</strong> from <strong class="bold">Packages: Unity Registry</strong>. </p>
			<p>The following steps will take you through the process of installing <strong class="bold">Post Processing</strong> in the project:</p>
			<ol>
				<li value="1">In the Unity Editor at the top, click <strong class="bold">Window</strong> | <strong class="bold">Package Manager</strong>. </li>
				<li>At the top-left corner of the <strong class="bold">Package Manager</strong> window, change its dropdown to <strong class="bold">Packages: Unity Registry</strong>.</li>
				<li>A long list of packages will be displayed; from the list, either scroll down and select <strong class="bold">Post Processing</strong> or select the search bar at the top-right corner and type <strong class="source-inline">Post Processing</strong> into it.</li>
				<li>Finally, click <strong class="bold">Install</strong> at the bottom-right corner.</li>
				<li>The following screenshot shows <strong class="bold">Package Manager</strong> with <strong class="bold">Post Processing</strong> selected:</li>
			</ol>
			<div>
				<div id="_idContainer507" class="IMG---Figure">
					<img src="image/Figure_13.22_B18381.jpg" alt="Figure 13.22 – The Package Manager with Post Processing selected to install&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.22 – The Package Manager with Post Processing selected to install</p>
			<ol>
				<li value="6">At the top of the Unity Editor, go to <strong class="bold">File</strong> | <strong class="bold">Build Settings...</strong>.</li>
				<li>Select <strong class="bold">PC, Mac &amp; Linux Standalone</strong>, followed by <strong class="bold">Switch Platform</strong>.</li>
			</ol>
			<p>Our Unity project now has post-processing installed. With that, we can begin preparing some scenes for<a id="_idIndexMarker1458"/> our standalone game.</p>
			<h3>Preparing and applying post-processing to our title and level scenes</h3>
			<p>In this<a id="_idIndexMarker1459"/> section, we are going<a id="_idIndexMarker1460"/> to make some changes to our <strong class="source-inline">title</strong> scene so that it supports our image and text being affected by post-processing. By the end of this section, our <strong class="source-inline">title</strong> scene will look more impressive, as shown in the following screenshots:</p>
			<div>
				<div id="_idContainer508" class="IMG---Figure">
					<img src="image/Figure_13.23_B18381.jpg" alt="Figure 13.23 – Difference between post-processing and not&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.23 – Difference between post-processing and not</p>
			<p>To apply post-processing to our <strong class="source-inline">title</strong> scene, we need to do the following:</p>
			<ol>
				<li value="1">In the <strong class="bold">Project</strong> window, navigate to <strong class="source-inline">Assets/Scene</strong> and open <strong class="source-inline">title</strong>.</li>
			</ol>
			<p>We now need to change some property values in the <strong class="source-inline">Canvas</strong> game object so that the post-processing changes come from the camera's feed, not just the <strong class="source-inline">Canvas</strong> itself.</p>
			<ol>
				<li value="2">In the <strong class="bold">Hierarchy</strong> window, select the <strong class="source-inline">Canvas</strong> game object.</li>
				<li>In the <strong class="bold">Inspector</strong> window, change the <strong class="source-inline">Canvas</strong> component property's <strong class="bold">Render Mode</strong> option to <strong class="bold">Screen Space - Camera.</strong></li>
				<li>Drag <strong class="bold">Main Camera</strong> from the <strong class="bold">Hierarchy</strong> window into the <strong class="bold">Render Camera</strong> property field. </li>
			</ol>
			<p>Next, we will add two post-processing components to our <strong class="bold">Main Camera</strong> game object.</p>
			<ol>
				<li value="5">Select <strong class="bold">Main Camera</strong> in the <strong class="bold">Hierarchy</strong> window.</li>
				<li>Click the <strong class="bold">Add Component</strong> button in the <strong class="bold">Inspector</strong> window.</li>
				<li>Type <strong class="source-inline">Post Process Layer</strong> into the drop-down list. When you see its name in the list, select it.</li>
				<li>In the <strong class="bold">Post Process Layer</strong> component, change the <strong class="bold">Layer</strong> property value to <strong class="bold">Everything</strong>. This means it will affect all the layers in the scene. This normally isn't recommended, but because there isn't very much in our scene, there isn't a lot to affect.<p class="callout-heading">Tip</p><p class="callout">If you want to change the <strong class="bold">Post Processing Layer</strong> component from <strong class="bold">Everything</strong> to something else, you will need to create a new layer at the top-right of the <strong class="bold">Inspector</strong> window, as we did in <a href="B18381_02_Epub.xhtml#_idTextAnchor048"><em class="italic">Chapter 2</em></a>, <em class="italic">Adding and Manipulating Objects.</em> Give it a name such as <strong class="source-inline">PostProcessing</strong> and change <strong class="bold">Everything</strong> to <strong class="bold">PostProcessing</strong> to remove the warning message in the <strong class="bold">Post Processing Layer</strong> component. </p></li>
				<li>Click the <strong class="bold">Add Component</strong> button again and type <strong class="source-inline">Post Process Volume</strong> until you see it on the list. Then, select it.</li>
				<li>At the top of the <strong class="bold">Post Process Volume</strong> component, tick the <strong class="bold">Is Global</strong> box.</li>
				<li>In the <strong class="bold">Project</strong> window, drag and drop the <strong class="bold">TEXT</strong> asset from the <strong class="source-inline">Assets/Scene</strong> folder <a id="_idIndexMarker1461"/>into<a id="_idIndexMarker1462"/> the <strong class="bold">Profile</strong> parameter in the <strong class="bold">Inspector</strong> window.</li>
				<li>The <strong class="bold">Game</strong> window will have the <strong class="bold">Profile</strong> post-processing effect applied to it, which may or may not be too extreme for you. We can set <strong class="bold">Weight</strong> from <strong class="bold">1</strong> all the way down to <strong class="bold">0</strong>. I'm setting mine to <strong class="bold">0.6</strong>.</li>
			</ol>
			<p>The following screenshot shows our title scene <strong class="bold">Game</strong> window, along with the two <strong class="bold">Post Process Layer</strong> and <strong class="bold">Post Process Volume</strong> components and the highlighted areas mentioned in the previous steps for reference:</p>
			<div>
				<div id="_idContainer509" class="IMG---Figure">
					<img src="image/Figure_13.24_B18381.jpg" alt="Figure 13.24 – Post Processing components (on the Main Camera game object) with the property values changed"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.24 – Post Processing components (on the Main Camera game object) with the property values changed</p>
			<ol>
				<li value="13">Save the scene.</li>
				<li>Repeat <em class="italic">steps 2–12</em> for the <strong class="source-inline">shop</strong> scene, but instead of applying the <strong class="bold">TEXT</strong> post-processing profile, use <strong class="bold">SHOP</strong> instead. The following screenshot shows the final result this has on the <strong class="source-inline">shop</strong> scene before and after post-processing has been applied (with the <strong class="bold">Weight</strong> property set to <strong class="bold">1</strong>), also if your camera background isn't set to black. Change it to black now.:</li>
			</ol>
			<div>
				<div id="_idContainer510" class="IMG---Figure">
					<img src="image/Figure_13.25_B18381.jpg" alt="Figure 13.25 – Post-processing effects applied and not applied to our shop scene&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.25 – Post-processing effects applied and not applied to our shop scene</p>
			<ol>
				<li value="15">Now, repeat <em class="italic">steps 2–13</em> for the <strong class="source-inline">gameOver</strong> scene. The end result should look similar to the following:</li>
			</ol>
			<div>
				<div id="_idContainer511" class="IMG---Figure">
					<img src="image/Figure_13.26_B18381.jpg" alt="Figure 13.26 – The Game Over screen with Post Processing Effects applied&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.26 – The Game Over screen with Post Processing Effects applied</p>
			<ol>
				<li value="16">Repeat <em class="italic">steps 5–13</em>, but<a id="_idIndexMarker1463"/> instead <a id="_idIndexMarker1464"/>of applying the <strong class="bold">TEXT</strong> post-processing profile, add the <strong class="bold">DEFAULT</strong> post-processing profile.</li>
			</ol>
			<p>The following image shows an example of the <strong class="source-inline">level3</strong> scene with and without the <strong class="bold">DEFAULT</strong> post-processing profile applied:</p>
			<div>
				<div id="_idContainer512" class="IMG---Figure">
					<img src="image/Figure_13.27_B18381.jpg" alt="Figure 13.27 – Game screens with no post-processing applied and post-processing applied &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.27 – Game screens with no post-processing applied and post-processing applied </p>
			<p>That's all of the scenes we need to implement for a post-processing profile. In the next section, we will briefly go through each of the effects that we have and can apply.</p>
			<h3>Post-processing effects (overrides)</h3>
			<p>In this section, we <a id="_idIndexMarker1465"/>are briefly going to discuss the effects the post-processing package offers us. By the end of this section, you will be more familiar with the effects and be able to make your own post-processing profile.</p>
			<p>Now that we've seen what post-processing does to our game, we can talk about each of the effects. Let's start by loading up the <strong class="source-inline">title</strong> scene and altering what we have:</p>
			<ol>
				<li value="1">In the <strong class="bold">Project</strong> window, navigate to the <strong class="source-inline">Assets/Scene</strong> folder and load up the <strong class="source-inline">title</strong> scene.</li>
				<li>Select <strong class="bold">Main Camera</strong> in the <strong class="bold">Hierarchy</strong> window.</li>
			</ol>
			<p>Our main focus for this<a id="_idIndexMarker1466"/> section will be the <strong class="bold">Overrides</strong> section in the <strong class="bold">Post-process Volume</strong> component:</p>
			<div>
				<div id="_idContainer513" class="IMG---Figure">
					<img src="image/Figure_13.28_B18381.jpg" alt="Figure 13.28 – The 'Bloom', 'Chromatic Aberration', and 'Color Grading' locations in the Post Process Volume Component"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.28 – The 'Bloom', 'Chromatic Aberration', and 'Color Grading' locations in the Post Process Volume Component</p>
			<p>So, let's go through some of these <strong class="bold">Overrides</strong> for <strong class="bold">Post Process Volume</strong> in the <strong class="bold">Inspector</strong> window. Then, I will provide a link that I encourage you to explore so that you can play around with some of the values.</p>
			<h4>Bloom</h4>
			<p>This effect <a id="_idIndexMarker1467"/>creates fringes of light extending <a id="_idIndexMarker1468"/>from the borders of bright areas in an image.</p>
			<p>We can extend the content by selecting the arrow to the left of the <strong class="bold">Bloom</strong> tick box (at the top-left corner in the following screenshot):</p>
			<div>
				<div id="_idContainer514" class="IMG---Figure">
					<img src="image/Figure_13.29_B18381.jpg" alt="Figure 13.29 – Setting the Bloom property values &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.29 – Setting the Bloom property values </p>
			<p>In the preceding screenshot, we have turned all of the properties on. Simply deselect and select each property to see what influences (if any) are made to each of the properties. Also, try and change some of the values. Use the preceding screenshot as a fallback if you feel you have gone too far with the effect.</p>
			<p>An interesting property to take a look at here is the <strong class="bold">Threshold</strong> property, where, if we lower its value to under <strong class="source-inline">1.14</strong>, the bloom effect will increase. However, if we make the value too low, we can overcook it and destroy the look of our game, as shown in the following:</p>
			<div>
				<div id="_idContainer515" class="IMG---Figure">
					<img src="image/Figure_13.30_B18381.jpg" alt="Figure 13.30 – The 'Threshold' property levels &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.30 – The 'Threshold' property levels </p>
			<p>Hopefully, I have<a id="_idIndexMarker1469"/> made you curious enough to <a id="_idIndexMarker1470"/>continue playing and experimenting with the bloom effect.</p>
			<p class="callout-heading">Further Information</p>
			<p class="callout">More information <a id="_idIndexMarker1471"/>about the <strong class="bold">Bloom</strong> effect can be found at <a href="mailto:https://docs.unity3d.com/Packages/com.unity.postprocessing@2.1/manual/Bloom.html">https://docs.unity3d.com/Packages/com.unity.postprocessing@2.1/manual/Bloom.html</a>. </p>
			<p>Next, we'll look at <strong class="bold">Chromatic Aberration</strong>.</p>
			<h4>Chromatic Aberration</h4>
			<p>This effect <a id="_idIndexMarker1472"/>mimics <a id="_idIndexMarker1473"/>what a real-world camera produces when its lens fails to join all the colors at the same point.</p>
			<p>The following screenshot shows our current settings:</p>
			<div>
				<div id="_idContainer516" class="IMG---Figure">
					<img src="image/Figure_13.31_B18381.jpg" alt="Figure 13.31 – Setting the Chromatic Aberration property values &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.31 – Setting the Chromatic Aberration property values </p>
			<p>This effect is more noticeable around the edges of the <strong class="bold">Game</strong> window. As an example, in the following screenshots, I have moved the image and its text up so that we can see these two components begin to warp more obviously:</p>
			<div>
				<div id="_idContainer517" class="IMG---Figure">
					<img src="image/Figure_13.32_B18381.jpg" alt="Figure 13.32 – 'Chromatic Aberration' – off versus on&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.32 – 'Chromatic Aberration' – off versus on</p>
			<p class="callout-heading">Further Information</p>
			<p class="callout">More information <a id="_idIndexMarker1474"/>about the <strong class="bold">Chromatic Aberration</strong> effect can be found at <a href="mailto:https://docs.unity3d.com/Packages/com.unity.postprocessing@2.1/manual/Chromatic-Aberration.html">https://docs.unity3d.com/Packages/com.unity.postprocessing@2.1/manual/Chromatic-Aberration.html</a>.</p>
			<p>Next, we'll look at the final effect we applied to our <strong class="source-inline">title</strong> scene – <strong class="bold">Color Grading</strong>.</p>
			<h4>Color Grading</h4>
			<p>This effect<a id="_idIndexMarker1475"/> alters the color and luminance<a id="_idIndexMarker1476"/> of the final image that Unity produces. <strong class="bold">Color Grading</strong> has the biggest range of properties throughout all of the post-processing effects. I've split these properties up into bulleted segments:</p>
			<ul>
				<li><strong class="bold">Mode</strong>:</li>
			</ul>
			<div>
				<div id="_idContainer518" class="IMG---Figure">
					<img src="image/Figure_13.33_B18381.jpg" alt="Figure 13.33 – Setting the 'Color Grading' override values&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.33 – Setting the 'Color Grading' override values</p>
			<p>Here, we have a choice of three-color grading modes so that we can alter the camera's final image. In the preceding screenshot, Unity gave us a warning regarding changing <strong class="bold">ColorSpace</strong> from <strong class="bold">Gamma</strong> to <strong class="bold">Linear</strong>. If you want to do this, it can be changed in <strong class="bold">Edit</strong> | <strong class="bold">Project Settings</strong> | <strong class="bold">Player</strong> | <strong class="bold">Player Settings</strong> | <strong class="bold">Other Settings</strong>.</p>
			<ul>
				<li><strong class="bold">Tonemapping</strong>:</li>
			</ul>
			<div>
				<div id="_idContainer519" class="IMG---Figure">
					<img src="image/Figure_13.34_B18381.jpg" alt="Figure 13.34 – Tonemapping&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.34 – Tonemapping</p>
			<p>This hosts a selection of tonemapping algorithms that we can use at the end of the color grading process.</p>
			<ul>
				<li><strong class="bold">White Balance</strong>:</li>
			</ul>
			<div>
				<div id="_idContainer520" class="IMG---Figure">
					<img src="image/Figure_13.35_B18381.jpg" alt="Figure 13.35 – White Balance&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.35 – White Balance</p>
			<p>This alters the temperature and tint of the final picture.</p>
			<ul>
				<li><strong class="bold">Tone</strong>:</li>
			</ul>
			<div>
				<div id="_idContainer521" class="IMG---Figure">
					<img src="image/Figure_13.36_B18381.jpg" alt="Figure 13.36 – Tone&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.36 – Tone</p>
			<p>Here, you can adjust the <strong class="bold">Saturation</strong>, <strong class="bold">Contrast</strong>, <strong class="bold">Hue Shift</strong>, <strong class="bold">Color filter</strong>, and <strong class="bold">Post-exposure (EV)</strong> options, which, similar to the <strong class="bold">Bloom</strong> effect's <strong class="bold">Threshold</strong> property, can easily be overcooked and provide some powerfully bright or dark results.</p>
			<ul>
				<li><strong class="bold">Channel Mixer</strong>:</li>
			</ul>
			<div>
				<div id="_idContainer522" class="IMG---Figure">
					<img src="image/Figure_13.37_B18381.jpg" alt="Figure 13.37 – Channel Mixer&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.37 – Channel Mixer</p>
			<p>This changes each overall image's RGB channel.</p>
			<ul>
				<li><strong class="bold">Trackballs</strong>:</li>
			</ul>
			<div>
				<div id="_idContainer523" class="IMG---Figure">
					<img src="image/Figure_13.38_B18381.jpg" alt="Figure 13.38 – Trackballs&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.38 – Trackballs</p>
			<p>Here, the<a id="_idIndexMarker1477"/> three<a id="_idIndexMarker1478"/> trackballs (<strong class="bold">Lift</strong> adjusts dark tones, <strong class="bold">Gamma</strong> adjusts mid-tones, and <strong class="bold">Gain</strong> adjusts highlights) affect the overall hue of the final image.</p>
			<ul>
				<li><strong class="bold">Grading Curves</strong>:</li>
			</ul>
			<div>
				<div id="_idContainer524" class="IMG---Figure">
					<img src="image/Figure_13.39_B18381.jpg" alt="Figure 13.39 – Grading Curves&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.39 – Grading Curves</p>
			<p><strong class="bold">Grading Curves</strong> is an advanced way to adjust specific ranges in hue, saturation, or luminosity in the final image.</p>
			<p class="callout-heading">Further Information</p>
			<p class="callout">More information <a id="_idIndexMarker1479"/>about the <strong class="bold">Color Grading</strong> effect can be found at <a href="mailto:https://docs.unity3d.com/Packages/com.unity.postprocessing@2.1/manual/Color-Grading.html">https://docs.unity3d.com/Packages/com.unity.postprocessing@2.1/manual/Color-Grading.html</a>.</p>
			<p>That concludes our look at all three of the post-processing overrides for the <strong class="source-inline">title</strong> scene. If you would like to know more about the rest of the effects that are available, check out the following link, where you can read up on the other 11 effects that can be applied to a Unity scene: <a href="mailto:https://docs.unity3d.com/Packages/com.unity.postprocessing@2.1/manual/index.html">https://docs.unity3d.com/Packages/com.unity.postprocessing@2.1/manual/index.html</a>.</p>
			<h4>Anti-aliasing modes</h4>
			<p>In this section, we are <a id="_idIndexMarker1480"/>going to view<a id="_idIndexMarker1481"/> the different types of anti-aliasing in the <strong class="bold">Post Process Layer</strong> component. As you may know, anti-aliasing smooths the rough edges of game objects in our game to get rid of staircase effects. Unity offers three different algorithms that smooth edges.</p>
			<p>The following modes are offered:</p>
			<ul>
				<li><strong class="bold">Fast Approximate Anti-Aliasing (FXAA)</strong>: This is <a id="_idIndexMarker1482"/>typically used with mobile platforms due to its quick algorithm. It is the most efficient technique but doesn't support motion vectors.</li>
				<li><strong class="bold">Subpixel Morphological Anti-Aliasing (SMAA)</strong>: This is high-quality but is more demanding<a id="_idIndexMarker1483"/> in terms of system performance.</li>
				<li><strong class="bold">Temporal Anti-Aliasing (TAA)</strong>: An <a id="_idIndexMarker1484"/>advanced, high-demanding technique that uses motion vectors (a motion vector is a key element in the motion estimation process).</li>
			</ul>
			<p>The following screenshots show the player's ship with different anti-aliasing techniques applied to it:</p>
			<div>
				<div id="_idContainer525" class="IMG---Figure">
					<img src="image/Figure_13.40_B18381.jpg" alt="Figure 13.40 – Visual differences with anti-aliasing modes&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.40 – Visual differences with anti-aliasing modes</p>
			<p>As you can see, the purpose of anti-aliasing is to take off jagged edges, but with our game, these edges aren't as noticeable, since it's full of dark backgrounds.</p>
			<p class="callout-heading">Further Information</p>
			<p class="callout">If you would like to apply<a id="_idIndexMarker1485"/> anti-aliasing and want to find out more, check out the following link: <a href="https://docs.unity3d.com/Manual/PostProcessing-Antialiasing.html">https://docs.unity3d.com/Manual/PostProcessing-Antialiasing.html</a>.</p>
			<p>Next, we'll look at creating and applying our own post-processing profiles, which we created at the <a id="_idIndexMarker1486"/>start of the <em class="italic">Applying PC visual improvements</em> section.</p>
			<h4>Creating and applying post-processing profiles</h4>
			<p>In the final section on<a id="_idIndexMarker1487"/> post-processing, we will discuss creating a post-processing profile. From there, you can (if you want to – I encourage you to) create your own profile and apply it to the <strong class="bold">Post Process Volume</strong> component in the <strong class="bold">Inspector</strong> window. Finally, you will be able to add/remove your own effects to alter the final look of the standalone game.</p>
			<p>So, to create and add our own effects, I suggest that we go back to a scene that we have already prepared – the <strong class="source-inline">title</strong> scene:</p>
			<ol>
				<li value="1">In the <strong class="bold">Project</strong> window, navigate back to <strong class="source-inline">Assets/Scene</strong> and open the <strong class="source-inline">title</strong> scene.</li>
				<li>Select the <strong class="bold">Main Camera</strong> game object in the <strong class="bold">Hierarchy</strong> window.</li>
				<li>Press the <strong class="bold">New</strong> button inside the <strong class="bold">Post Process Volume</strong> component (as shown in the following screenshot):</li>
			</ol>
			<div>
				<div id="_idContainer526" class="IMG---Figure">
					<img src="image/Figure_13.41_B18381.jpg" alt="Figure 13.41 – Creating a new post-processing profile&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.41 – Creating a new post-processing profile</p>
			<ol>
				<li value="4">To add your <a id="_idIndexMarker1488"/>own post-processing effects, click the <strong class="bold">Add effect...</strong> button (as shown in the preceding screenshot) at the bottom of the <strong class="bold">Post Process Volume</strong> component and select an effect from the drop-down list.</li>
				<li>Once you have applied the effect, click <strong class="bold">All</strong> to turn all the properties on (as shown in the following screenshot):</li>
			</ol>
			<div>
				<div id="_idContainer527" class="IMG---Figure">
					<img src="image/Figure_13.42_B18381.jpg" alt="Figure 13.42 – Turning all the properties on&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.42 – Turning all the properties on</p>
			<ol>
				<li value="6">If you want to remove the effect, click in the top-right corner of the effect (above the <strong class="bold">Off</strong> button) and select <strong class="bold">Remove</strong> from the drop-down list (as shown in the preceding screenshot).</li>
				<li>It's as simple as that! If you want to see where the file is located, click on the <strong class="bold">PostProcessProfile</strong> field, as shown in the following screenshot:</li>
			</ol>
			<div>
				<div id="_idContainer528" class="IMG---Figure">
					<img src="image/Figure_13.43_B18381.jpg" alt="Figure 13.43 – Applying and locating the post-processing profile&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.43 – Applying and locating the post-processing profile</p>
			<ol>
				<li value="8">The location will <a id="_idIndexMarker1489"/>ping yellow in the <strong class="bold">Project</strong> window (as shown in the preceding screenshot), which is also where you can rename the file to something that resembles the use of the profile (right-click the file and select <strong class="bold">Rename</strong> from the dropdown).</li>
				<li>If you don't like what you've created, you can delete the <strong class="bold">PostProcessProfile</strong> file from the <strong class="bold">Project</strong> window and click the small <strong class="bold">remote</strong> button to the right of the <strong class="bold">Profile</strong> parameter in <strong class="bold">Post Process Volume</strong> to add the <strong class="bold">TEXT</strong> profile once more (or whichever profile you want).</li>
			</ol>
			<p>This was an extensive overview of the post-processing package that Unity has to offer. In this section, we imported our Unity package and added post-processing components to each of our game scenes. From there, we applied ready-made profiles to customize the scenes' post-processing effects. We then lightly reviewed some of the effects that can be added to the <strong class="bold">Post Process Volume</strong> component, which was already in our scenes.</p>
			<p>We ended this section by altering our scene's anti-aliasing properties. With this, we took the rough edges off our art assets.</p>
			<p>I encourage you to make your own profiles, but if you feel like you need more profiles to play around with, you can purchase a compilation of profiles from the Asset Store for a small price.</p>
			<p>In the next section, we are going to take a look at the lighting settings and apply some global illumination, lighting, and fog to our shop scene.</p>
			<h1 id="_idParaDest-230"><a id="_idTextAnchor233"/>Adding global illumination and other settings</h1>
			<p>In this section, we<a id="_idIndexMarker1490"/> are <a id="_idIndexMarker1491"/>going to give our shop scene a background by adding art assets from the <strong class="source-inline">level3</strong> scene and adding a red emission material.</p>
			<p>Unity is currently working on a new global illumination lighting package, which means this version we are using will be eventually phased out. The good news is that it will be supported during 2020 LTS.</p>
			<p>We will activate the scene's real-time global illumination, which is where the red emission material will glow on the surface of the corridor. We will also be adding extra lights to our shop display and the player ship to make it stand out more. Finally, we will add some black fog to create some darkness creeping around the glowing lights.</p>
			<p>The following screenshots show a comparison between the shop scene before and after we complete this section:</p>
			<div>
				<div id="_idContainer529" class="IMG---Figure">
					<img src="image/Figure_13.44_B18381.jpg" alt="Figure 13.44 – Global illumination/Lighting/Fog – off versus on&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.44 – Global illumination/Lighting/Fog – off versus on</p>
			<p>So, let's <a id="_idIndexMarker1492"/>start <a id="_idIndexMarker1493"/>this section off by adding the art assets that we are going to use for the shop scene.</p>
			<h2 id="_idParaDest-231"><a id="_idTextAnchor234"/>Adding art assets to our shop scene</h2>
			<p>In this section, we <a id="_idIndexMarker1494"/>are going to drag and drop some pre-made art assets into our <strong class="source-inline">shop</strong> scene. From there, we can continue setting up our <strong class="bold">Lighting</strong> settings.</p>
			<p>To apply the art assets to our <strong class="source-inline">shop</strong> scene, we need to do the following:</p>
			<ol>
				<li value="1">First, load up the <strong class="source-inline">shop</strong> scene itself from the <strong class="bold">Project</strong> window by going to <strong class="source-inline">Assets/Scene</strong>. Then, double-click the <strong class="source-inline">shop</strong> scene.</li>
				<li>In the <strong class="bold">Project</strong> settings, navigate to the <strong class="source-inline">Assets/Prefab</strong> folder.</li>
				<li>Drag and drop the <strong class="bold">Environment</strong> prefab into the <strong class="bold">Hierarchy</strong> window.</li>
			</ol>
			<p>The scene, when viewed from the <strong class="bold">Game</strong> window, will look as follows:</p>
			<div>
				<div id="_idContainer530" class="IMG---Figure">
					<img src="image/Figure_13.45_B18381.jpg" alt="Figure 13.45 – Current look of our shop scene&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.45 – Current look of our shop scene</p>
			<p>The art assets that we have brought into the <strong class="source-inline">shop</strong> scene should be marked as <strong class="bold">static</strong>. Specifically, it's <strong class="bold">Contribute GI</strong> that needs to be marked so that we can generate the lights we need from our red emission strips, as shown in the preceding screenshot. </p>
			<ol>
				<li value="4">The following screenshot shows the <strong class="bold">Inspector</strong> window with the <strong class="bold">Environment</strong> game<a id="_idIndexMarker1495"/> object (and all its children) marked as <strong class="bold">Static</strong>:</li>
			</ol>
			<div>
				<div id="_idContainer531" class="IMG---Figure">
					<img src="image/Figure_13.46_B18381.jpg" alt="Figure 13.46 – The 'Environment' game object and its children marked as static&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.46 – The 'Environment' game object and its children marked as static</p>
			<p class="callout-heading">Further Information</p>
			<p class="callout">If we did have moving game objects in the scene that we wanted to be affected by the lighting of the scene, we would need to add <strong class="bold">Light Probes</strong> to update any indirect colors on that moving game object.</p>
			<p class="callout">If you would like to know<a id="_idIndexMarker1496"/> more about <strong class="bold">Light Probes</strong>, check out <a href="https://docs.unity3d.com/Manual/LightProbes.html">https://docs.unity3d.com/Manual/LightProbes.html</a>.</p>
			<p>Now, we need to disable any kind of light we currently have in our scene so that we don't dilute the effect we are trying to achieve:</p>
			<ol>
				<li value="1">If the <strong class="bold">Hierarchy</strong> window contains <strong class="bold">Directional Light</strong>, select it and press <em class="italic">delete</em> on your keyboard.</li>
			</ol>
			<p>Now, we can set up our <strong class="bold">Lighting</strong> settings so that they support <strong class="bold">Realtime Global Illumination</strong>. To do that, we need to access our <strong class="bold">Lighting</strong> window and enter some values.</p>
			<ol>
				<li value="2">If the <strong class="bold">Lighting</strong> window hasn't loaded, in the Unity Editor, at the top of the screen, select <strong class="bold">Window</strong> | <strong class="bold">Rendering</strong> | <strong class="bold">Lighting</strong>.</li>
				<li>Select the <strong class="bold">Scene</strong> button in the <strong class="bold">Lighting</strong> window. Now, let's start turning off all <strong class="bold">Environment</strong> lights. Set your <strong class="bold">Environment</strong> settings to the ones shown in the following screenshot:</li>
			</ol>
			<div>
				<div id="_idContainer532" class="IMG---Figure">
					<img src="image/Figure_13.47_B18381.jpg" alt="Figure 13.47 – The 'Lighting' window and its updated property values in the 'Scene' tab&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.47 – The 'Lighting' window and its updated property values in the 'Scene' tab</p>
			<ol>
				<li value="4">As shown in the <a id="_idIndexMarker1497"/>preceding screenshot, we have knocked out any kind of light that our scene might have had. Now, we can go back to the <strong class="bold">Scene</strong> tab and turn <strong class="bold">Realtime Global Illumination</strong> on, which is just below the <strong class="bold">Environment</strong> segment of the <strong class="bold">Lighting</strong> window. If all settings are grayed out, we need to create a <strong class="bold">New Lighting Settings</strong> at the top-right of the <strong class="bold">Scene</strong> tab.</li>
			</ol>
			<div>
				<div id="_idContainer533" class="IMG---Figure">
					<img src="image/Figure_13.48_B18381.jpg" alt="Figure 13.48 – Tick 'Realtime Global Illumination'&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.48 – Tick 'Realtime Global Illumination'</p>
			<ol>
				<li value="5">Make sure <strong class="bold">Baked Global Illumination</strong> is unticked, as we don't want our lights to be computed at runtime. This is because it uses up RAM and HDD/SSD space.</li>
			</ol>
			<p>Still inside the <strong class="bold">Lighting</strong> window's settings, we can lower some of the <strong class="bold">Lightmapping Settings</strong> values so that the map isn't as detailed and is also quicker to generate light on slower systems.</p>
			<ol>
				<li value="6">Leave <strong class="bold">Lightmapping Settings</strong> at its default values, as shown in the following screenshot:</li>
			</ol>
			<div>
				<div id="_idContainer534" class="IMG---Figure">
					<img src="image/Figure_13.49_B18381.jpg" alt="Figure 13.49 – Update the 'Lightmapping Settings' property values to the ones shown here &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.49 – Update the 'Lightmapping Settings' property values to the ones shown here </p>
			<ol>
				<li value="7">At the bottom of the <strong class="bold">Lighting</strong> window, make sure <strong class="bold">Auto Generate</strong> is unticked and click the <strong class="bold">Generate Lighting</strong> button.</li>
				<li>Wait for the <a id="_idIndexMarker1498"/>blue bar at the bottom-right corner of the Unity Editor to complete and disappear. </li>
			</ol>
			<p>We will be presented with the following output in the <strong class="bold">Game</strong> window:</p>
			<div>
				<div id="_idContainer535" class="IMG---Figure">
					<img src="image/Figure_13.50_B18381.jpg" alt="Figure 13.50 – Our 'Game' window shows our shop scene is washed out in a strong light&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.50 – Our 'Game' window shows our shop scene is washed out in a strong light</p>
			<p class="callout-heading">Further Information</p>
			<p class="callout">We can (if we want to) check the indirect lighting that we have created from our current <strong class="bold">Lighting</strong> settings by selecting the <strong class="bold">Shaded</strong> button below the <strong class="bold">Scene</strong> tab and selecting <strong class="bold">Indirect</strong> from the dropdown (don't forget to change it back to <strong class="bold">Shaded</strong> once you're done).</p>
			<p>Our <strong class="source-inline">shop</strong> scene looks overly bright red and has drowned the scene out. However, we nearly have what we want. Now, we can turn on some <strong class="bold">fog</strong> from the <strong class="bold">Lighting</strong> window to create a dark alley with the red emission bleeding through.</p>
			<ol>
				<li value="9">To add <strong class="bold">fog</strong> to the <strong class="source-inline">shop</strong> scene, in our <strong class="bold">Lighting</strong> window, near the bottom, we need to apply the following values:</li>
			</ol>
			<div>
				<div id="_idContainer536" class="IMG---Figure">
					<img src="image/Figure_13.51_B18381.jpg" alt="Figure 13.51 – The 'Fog' settings property values&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.51 – The 'Fog' settings property values</p>
			<p>Our <strong class="bold">Game</strong> window <a id="_idIndexMarker1499"/>will now have faded darkness in the background of our <strong class="source-inline">shop</strong> scene, as shown in the following screenshot:</p>
			<div>
				<div id="_idContainer537" class="IMG---Figure">
					<img src="image/Figure_13.52_B18381.jpg" alt="Figure 13.52 – The 'Game' window with a black fog background&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.52 – The 'Game' window with a black fog background</p>
			<ol>
				<li value="10">The final touch is to drag and drop the <strong class="source-inline">shopLights</strong> prefab from <strong class="source-inline">Assets/Prefab</strong> into the <strong class="bold">Hierarchy</strong> window to light up the player ship:</li>
			</ol>
			<div>
				<div id="_idContainer538" class="IMG---Figure">
					<img src="image/Figure_13.53_B18381.jpg" alt="Figure 13.53 – Small light added to the player ship&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.53 – Small light added to the player ship</p>
			<ol>
				<li value="11">Save the <strong class="source-inline">shop</strong> scene.</li>
			</ol>
			<p>With that, we have successfully removed the default lighting from our <strong class="source-inline">shop</strong> scene and applied <strong class="bold">Realtime Global Illumination</strong> from the emission material and added darkness (fog) to <a id="_idIndexMarker1500"/>our <strong class="source-inline">shop</strong> scene's background.</p>
			<p>In the next section, we will be discussing and implementing a small section of our <strong class="source-inline">level3</strong> scene so that we can start adding art assets with reflections.</p>
			<h2 id="_idParaDest-232"><a id="_idTextAnchor235"/>Reflection probe</h2>
			<p>In this section, we are <a id="_idIndexMarker1501"/>going to introduce the final art asset for our game. This asset will reflect the environment in the scene, as shown by the two-sphere statues in the following screenshot:</p>
			<div>
				<div id="_idContainer539" class="IMG---Figure">
					<img src="image/Figure_13.54_B18381.jpg" alt="Figure 13.54 – Reflective orbs in the background&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.54 – Reflective orbs in the background</p>
			<p>You can imagine how useful it would be to have a material that reflects its surroundings like a mirror. We are going to add the <strong class="bold">shinySphere</strong> art asset to our <strong class="source-inline">level3</strong> scene and calibrate its property values to get a decent result without affecting our system's resources.</p>
			<p>So, let's start by loading up the <strong class="source-inline">level3</strong> scene:</p>
			<ol>
				<li value="1">In the <strong class="bold">Project</strong> window, navigate to the <strong class="source-inline">Assets/Scene</strong> folder and double-click on the <strong class="source-inline">level3</strong> scene.</li>
			</ol>
			<p>Now, we are going to place our <strong class="bold">shinySphere</strong> asset in the scene.</p>
			<ol>
				<li value="2">In the <strong class="bold">Project</strong> window, navigate to the <strong class="source-inline">Assets/Prefab</strong> folder.</li>
				<li>Drag <strong class="bold">shinySphere</strong> into the <strong class="bold">Hierarchy</strong> window.</li>
				<li>Select the <strong class="bold">shinySphere</strong> asset in the <strong class="bold">Hierarchy</strong> window and make sure that its <strong class="bold">Transform</strong> values are set as shown in the following screenshot:</li>
			</ol>
			<div>
				<div id="_idContainer540" class="IMG---Figure">
					<img src="image/Figure_13.55_B18381.jpg" alt="Figure 13.55 – The 'shinySphere' Transform property values&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.55 – The 'shinySphere' Transform property values</p>
			<p>The <strong class="bold">shinySphere</strong> game object should now be in a location next to the cargo blocks at the end of the level, as shown in the following screenshot:</p>
			<div>
				<div id="_idContainer541" class="IMG---Figure">
					<img src="image/Figure_13.56_B18381.jpg" alt="Figure 13.56 – The placement of the 'shinySphere' game object&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.56 – The placement of the 'shinySphere' game object</p>
			<p>Before we add<a id="_idIndexMarker1502"/> the second <strong class="bold">shinySphere</strong> game object, let's add a <strong class="bold">Reflection Probe</strong> component to this game object, as follows:</p>
			<ol>
				<li value="1">In the <strong class="bold">Hierarchy</strong> window, expand the <strong class="bold">shinySphere</strong> game object and select the <strong class="bold">spheres</strong> child game object.</li>
				<li>Right-click the <strong class="bold">spheres</strong> game object in the <strong class="bold">Hierarchy</strong> window and select <strong class="bold">Light</strong> | <strong class="bold">Reflection Probe</strong>.</li>
				<li>The <strong class="bold">spheres</strong> game object now has a child game object called <strong class="bold">Reflection Probe</strong>. Select this game object.</li>
				<li>In the <strong class="bold">Inspector</strong> window, we have the <strong class="bold">Reflection Probe</strong> component, along with its values. First, let's change the <strong class="bold">Type</strong> values to the ones shown in the following screenshot to make our game object reflect its environment:</li>
			</ol>
			<div>
				<div id="_idContainer542" class="IMG---Figure">
					<img src="image/Figure_13.57_B18381.jpg" alt="Figure 13.57 – The 'Type' values updated to the ones shown here to create a reflection&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.57 – The 'Type' values updated to the ones shown here to create a reflection</p>
			<p>Our <strong class="bold">shinySphere</strong> game object will now update its reflection on every frame. </p>
			<ol>
				<li value="5">Next, we will alter the <strong class="bold">Runtime settings</strong> values to increase the accuracy of the reflection. If the <strong class="bold">Box Projection</strong> is grayed out, switch from <strong class="bold">Android</strong> to <strong class="bold">PC</strong>, <strong class="bold">Mac &amp; Linux Standalone</strong> build in <strong class="bold">Build Settings</strong>. Use the values shown in the following screenshot:</li>
			</ol>
			<div>
				<div id="_idContainer543" class="IMG---Figure">
					<img src="image/Figure_13.58_B18381.jpg" alt="Figure 13.58 – Increasing the accuracy reflection in 'Runtime Settings' &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.58 – Increasing the accuracy reflection in 'Runtime Settings' </p>
			<p class="callout-heading">Further Information</p>
			<p class="callout"><strong class="bold">Box Projection</strong> will help improve the accuracy of the reflections given in the environment. If you would like to know more, check out the following link: <a href="https://docs.unity3d.com/Manual/AdvancedRefProbe.html">https://docs.unity3d.com/Manual/AdvancedRefProbe.html</a>.</p>
			<ol>
				<li value="6">The last property <a id="_idIndexMarker1503"/>values to update can be found in <strong class="bold">Cubemap capture settings</strong>. Changing these values will change the final look of the reflections (simply estimate what color the <strong class="bold">Background</strong> property should be so that it suits your scene):</li>
			</ol>
			<div>
				<div id="_idContainer544" class="IMG---Figure">
					<img src="image/Figure_13.59_B18381.jpg" alt="Figure 13.59 – The 'Cubemap capture settings' property values updated to the ones shown here&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.59 – The 'Cubemap capture settings' property values updated to the ones shown here</p>
			<p>The reflection probe can create performance issues if it's not used carefully, depending on the platform the game is being pointed toward. For example, with the previous settings, a higher resolution will show a clearer reflection but will obviously require more resources.</p>
			<p class="callout-heading">Further Information</p>
			<p class="callout">For more information about reflection probes and their performance, check out the following link: <a href="https://docs.unity3d.com/Manual/RefProbePerformance.html">https://docs.unity3d.com/Manual/RefProbePerformance.html</a>.</p>
			<p>To duplicate the <strong class="bold">shinySphere</strong> game object in our <strong class="source-inline">level3</strong> scene, we need to do the following:</p>
			<ol>
				<li value="1">Select the <strong class="bold">shinySphere</strong> game object in the <strong class="bold">Hierarchy</strong> window and click <strong class="bold">Overrides | Apply All</strong> at the top-right corner of the <strong class="bold">Inspector</strong> window to update the prefab.</li>
				<li>To copy and paste the <strong class="bold">shinySphere</strong> game object, right-click <strong class="bold">shinySphere</strong> in the <strong class="bold">Hierarchy</strong> window and select <strong class="bold">Copy</strong> from the drop-down list.</li>
				<li>Right-click in the <strong class="bold">Hierarchy</strong> window (in an open space, near the bottom) and select <strong class="bold">Paste</strong> from the drop-down list.</li>
				<li>Finally, move<a id="_idIndexMarker1504"/> the <strong class="bold">shinySphere</strong> game object to the right of the <em class="italic">x</em> axis.</li>
				<li>Save the scene.</li>
			</ol>
			<p>The following screenshot shows the two <strong class="bold">shinySphere</strong> game objects reflecting the environment:</p>
			<div>
				<div id="_idContainer545" class="IMG---Figure">
					<img src="image/Figure_13.60_B18381.jpg" alt="Figure 13.60 – Both 'shinySphere' game objects with reflections&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.60 – Both 'shinySphere' game objects with reflections</p>
			<p>If, in any other future Unity Projects, you are required to create a shiny surface, marble floor, a brand-new shiny car, and so on, making use of a reflection probe would cover these requirements.</p>
			<p>With that, we have reached the point where our game is complete, and we've covered everything specified in the Game Design Document. Now would be a good time to build our standalone <a id="_idIndexMarker1505"/>version of the game and see how well it runs. Are there any bugs? How are we going to test our game? Let's move on and see how we can tackle such issues.</p>
			<h1 id="_idParaDest-233"><a id="_idTextAnchor236"/>Building and testing our game</h1>
			<p>We have reached the <a id="_idIndexMarker1506"/>point where we can build and run our game instead of just testing our game's scenes in the Unity Editor. This section will be about not only building the game, as we did earlier for the Android version of the game, but also to see whether we have any bugs with our final build. We will also look for any potential issues along the way by using performance spikes in the profiler.</p>
			<p>Let's start building our game and see how well it runs before we do any tests.</p>
			<p>To build our game for a PC, we need to do the following:</p>
			<ol>
				<li value="1">At the top of the Unity Editor, go to <strong class="bold">File</strong> | <strong class="bold">Build Settings...</strong></li>
				<li>Make sure all the scenes are in the <strong class="bold">Scenes In Build</strong> list and in the correct order.</li>
				<li><strong class="bold">Platform</strong> should be set to <strong class="bold">PC, Mac &amp; Linux Standalone</strong>. If not, select it and select the <strong class="bold">Switch Platform</strong> button.</li>
			</ol>
			<p>Next, we need to add the aspect ratios that this game is intended for in the <strong class="bold">Player Settings...</strong> window:</p>
			<ol>
				<li value="1">Select<a id="_idIndexMarker1507"/> the <strong class="bold">Player</strong> tab.</li>
				<li>In the <strong class="bold">Inspector</strong> window, expand the <strong class="bold">Resolution and Presentation</strong> content.</li>
				<li>Expand the <strong class="bold">Supported Aspect Ratios</strong> content.</li>
			</ol>
			<p>Deselect the aspect ratios shown in the following screenshot:</p>
			<div>
				<div id="_idContainer546" class="IMG---Figure">
					<img src="image/Figure_13.61_B18381.jpg" alt="Figure 13.61 – Select the 16:10 and 16:9 aspect ratios (typical widescreen ratios)&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.61 – Select the 16:10 and 16:9 aspect ratios (typical widescreen ratios)</p>
			<ol>
				<li value="4">Back in the <strong class="bold">Build Settings</strong> window, press the <strong class="bold">Build</strong> button. </li>
			</ol>
			<p>The following screenshot shows these references highlighted:</p>
			<div>
				<div id="_idContainer547" class="IMG---Figure">
					<img src="image/Figure_13.62_B18381.jpg" alt="Figure 13.62 – All game scenes added and in order (Scenes In Build), 'PC, Mac &amp; Linux Standalone' selected in the 'Platform' settings, and 'Build' clicked&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.62 – All game scenes added and in order (Scenes In Build), 'PC, Mac &amp; Linux Standalone' selected in the 'Platform' settings, and 'Build' clicked</p>
			<ol>
				<li value="5">In the <strong class="bold">Windows Explorer</strong> window that appears, select a location where you wish to install the game and click the <strong class="bold">Save</strong> button.</li>
				<li>Once <a id="_idIndexMarker1508"/>the game has been built, run its <strong class="source-inline">.exe</strong> file.</li>
			</ol>
			<p>Now, let's fix any potential issues that may arise in our game.</p>
			<h2 id="_idParaDest-234"><a id="_idTextAnchor237"/>Tackling bugs</h2>
			<p>Imagine we<a id="_idIndexMarker1509"/> have sent our game off to be bug-tested and get a response from several bug testers questioning bugs, the game's UI, and the performance of the game.</p>
			<p>The following sections contain four reports that I want you to read and think about. We will go through the answers near the end of this chapter.</p>
			<p>Let's start with the first bug report.</p>
			<h3>Bug report – Standalone AD button</h3>
			<p>It has been<a id="_idIndexMarker1510"/> reported that when our bug tester plays the PC version of the game, they can't watch an advert in the shop scene.</p>
			<p>How can we resolve this issue?</p>
			<p>The following screenshot shows the <strong class="source-inline">AD</strong> button in the <strong class="source-inline">shop</strong> scene:</p>
			<div>
				<div id="_idContainer548" class="IMG---Figure">
					<img src="image/Figure_13.63_B18381.jpg" alt="Figure 13.63 – The AD and Start buttons from the shop scene&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.63 – The AD and Start buttons from the shop scene</p>
			<p><strong class="bold">Hint</strong>: Do we need the AD button in the standalone version of the shop scene? Is it supported by Unity?</p>
			<h3>Bug report – Resetting the player's lives</h3>
			<p>A second report <a id="_idIndexMarker1511"/>has been given to us, suggesting that when the game is completed, the player's lives don't reset.</p>
			<p>Why is this happening and how do we fix this issue?</p>
			<p>The following screenshot shows the player's lives counter on level 1:</p>
			<div>
				<div id="_idContainer549" class="IMG---Figure">
					<img src="image/Figure_13.64_B18381.jpg" alt="Figure 13.64 – Player's Lives&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.64 – Player's Lives</p>
			<p><strong class="bold">Hint</strong>: Does this happen when you quit the game through the pause screen? Do the player's lives reset when all their lives are lost?</p>
			<h3>Bug report – Slower systems on level 3</h3>
			<p>When the<a id="_idIndexMarker1512"/> Android version is played on slower systems, it has been reported that level 3 runs slower than levels 1 and 2.</p>
			<p>What amendments can be made, if any, to fix this problem?</p>
			<p>The following screenshot shows where the game slows down:</p>
			<div>
				<div id="_idContainer550" class="IMG---Figure">
					<img src="image/Figure_13.65_B18381.jpg" alt="Figure 13.65 – Halfway through Level 3&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.65 – Halfway through Level 3</p>
			<p><strong class="bold">Hint</strong>: What changes can be made that won't upset standalone or more powerful performing Android devices?</p>
			<h3>Bug report – Sometimes, the game ends too quickly</h3>
			<p>Some bug testers have <a id="_idIndexMarker1513"/>reported that, when starting a game, it ends earlier than intended, with the player ship animating out of the screen.</p>
			<p>Why is this happening and how can this be amended?</p>
			<p>The following screenshot shows the tail end of the player ship's thrusters as it leaves the level too soon:</p>
			<div>
				<div id="_idContainer551" class="IMG---Figure">
					<img src="image/Figure_13.66_B18381.jpg" alt="Figure 13.66 – Player has left too early&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.66 – Player has left too early</p>
			<p><strong class="bold">Hint</strong>: Which level does this happen on? Does it happen in the Unity Editor? Does it happen all the time? If not, what are you doing and what's different?</p>
			<p>You may be able to solve some of these questions by Googling key problems. Others are more specific, and you may need to add <strong class="source-inline">Debug.Log()</strong> to parts of your code holding variable names so that you can see what's changed after a certain point in the game. For example, does <strong class="source-inline">GameManager.playerLives</strong> debug a different value than it should at certain points in the game? If you're using Microsoft Visual Studio as your IDE, you may want to start adding breakpoints and step through your code to see what changes. If you<a id="_idIndexMarker1514"/> don't know what breakpoints are, I suggest that you check out the following link: <a href="https://docs.microsoft.com/en-us/visualstudio/debugger/using-breakpoints?view=vs-2019">https://docs.microsoft.com/en-us/visualstudio/debugger/using-breakpoints?view=vs-2019</a>.</p>
			<p>To potentially help with these performance issues, we are going to check out the <strong class="bold">Profiler</strong> tool and see how it can help us with checking the performance of our game.</p>
			<h2 id="_idParaDest-235"><a id="_idTextAnchor238"/>Understanding the Profiler tools</h2>
			<p>In this <a id="_idIndexMarker1515"/>section, we <a id="_idIndexMarker1516"/>will be checking out one of the Unity Editor's tools – <strong class="bold">Profiler</strong>. This handy tool will show us where our game may spike in demands for system resources and/or show where our game is using too many resources at once.</p>
			<p>Let's open the <strong class="bold">Profiler</strong> window and see its default layout before going into any more detail about it:</p>
			<ol>
				<li value="1">At the top of the Unity Editor, select <strong class="bold">Window</strong> | <strong class="bold">Profiler</strong>.</li>
			</ol>
			<p>The <strong class="bold">Profiler</strong> window behaves like any other new window in Unity. Typically, <strong class="bold">Profiler</strong> should run well in fullscreen mode on a second screen. Otherwise, dock <strong class="bold">Profiler</strong> down with <strong class="bold">Console</strong>, as shown in the following screenshot:</p>
			<div>
				<div id="_idContainer552" class="IMG---Figure">
					<img src="image/Figure_13.67_B18381.jpg" alt="Figure 13.67 – The 'Profiler' window&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.67 – The 'Profiler' window</p>
			<ol>
				<li value="2">At the top of the Unity Editor, press the <strong class="bold">Play</strong> button. After about 5 seconds (roughly), press the <strong class="bold">Pause</strong> button (it doesn't matter which scene is running).</li>
			</ol>
			<p>The <strong class="bold">Profiler</strong> window will come alive, showing a graph and a table of information. This will be split into four sections, as shown in the following screenshot:</p>
			<div>
				<div id="_idContainer553" class="IMG---Figure">
					<img src="image/Figure_13.68_B18381.jpg" alt="Figure 13.68 – Sections of the 'Profiler' window&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.68 – Sections of the 'Profiler' window</p>
			<p>Let's take <a id="_idIndexMarker1517"/>a<a id="_idIndexMarker1518"/> look at these sections in more depth:</p>
			<ol>
				<li value="3"><strong class="bold">Profiler Modules</strong> – A breakdown of modules that give measurements for each property that can be added.</li>
			</ol>
			<div>
				<div id="_idContainer554" class="IMG---Figure">
					<img src="image/Figure_13.69_B18381.jpg" alt="Figure 13.69 – Profiler Modules&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.69 – Profiler Modules</p>
			<ol>
				<li value="4"><strong class="bold">Profiler Controls</strong> – Navigation of controls to move through frames.</li>
				<li><strong class="bold">Frame Chart</strong> – In this section, we can click and scrub (drag) the mouse to see an indicator on the area. The <strong class="bold">Module Details Panel</strong> will list an update on what resources are being used during play mode (depending on which module is selected).</li>
				<li><strong class="bold">Module Details Panel</strong> – Selecting each profiler module will give further details in the module details panel. For example, if <strong class="bold">CPU Usage</strong> is selected, there will be an "<strong class="bold">Overview</strong>" with an individual breakdown of which resources are used the most. If <strong class="bold">GPU Usage</strong> is selected, we are given two different types of <strong class="bold">Hierarchy</strong> panels (<strong class="bold">Hierarchy</strong> and <strong class="bold">Hierarchy Raw</strong>). We'll explain more about a scenario using the profiler and the module details panel next.</li>
			</ol>
			<p>Let's take a further<a id="_idIndexMarker1519"/> look <a id="_idIndexMarker1520"/>at the profiler and how to diagnose a performance spike.</p>
			<p>The following screenshot shows a highlighted spike (denoted by <strong class="bold">i</strong>), along with the indicator. We can uncheck each of the properties within the "GPU Usage" module (denoted by ii) to see what is causing the spike in the <strong class="bold">Frame Chart</strong>. Also, update the <strong class="bold">Module Details Panel</strong> (denoted by iii) list to show what's causing the performance spike.</p>
			<p class="figure-caption"> </p>
			<div>
				<div id="_idContainer555" class="IMG---Figure">
					<img src="image/Figure_13.70_B18381.jpg" alt="Figure 13.70 – 'Profiler' showing signs of a performance spike while the game is running&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.70 – 'Profiler' showing signs of a performance spike while the game is running</p>
			<p>In the <strong class="bold">Module Details Panel</strong> window (the "<strong class="bold">Hierarchy</strong>" section), at the top of the list, we have the culprit of what's causing the spike, <strong class="source-inline">UpdateDepthTexture.</strong></p>
			<p>With a quick Google search, we can see why this is happening and whether there is anything we can do to fix the issue. According to a topic on the Unity forums, this issue is caused by the profiler itself, which is fine, as we won't be requiring the profiler in the final build. Try to reproduce spikes, cross-compare, and check more than one answer to verify as much as possible that your spike relates. It's likely you will find a way to minimize/remove the issue.</p>
			<p>Another way of checking this, and one that will possibly solve the issue, is to run our game outside of the Unity Editor to remove any resources being used up. One way of tackling this is to build and run (denoted by iii) our game as a standalone (denoted by i) <strong class="bold">Development Build</strong> and auto-connect it to the <strong class="bold">Profiler</strong> window (denoted by ii), as shown in <a id="_idIndexMarker1521"/>the<a id="_idIndexMarker1522"/> following screenshots:</p>
			<div>
				<div id="_idContainer556" class="IMG---Figure">
					<img src="image/Figure_13.71_B18381.jpg" alt="Figure 13.71 – Killer Wave running with 'Profiler' outside of the Unity Editor&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.71 – Killer Wave running with 'Profiler' outside of the Unity Editor</p>
			<p>As you can see, we no longer have this resource issue showing up in our <strong class="bold">Development Build</strong> (denoted by <strong class="bold">*</strong> in the preceding screenshot).</p>
			<p class="callout-heading">Further Information</p>
			<p class="callout">If you would like to know more about the <strong class="bold">Profiler</strong> window, check out the following link: <a href="https://docs.unity3d.com/Manual/Profiler.html">https://docs.unity3d.com/Manual/Profiler.html</a>.</p>
			<p>As we have seen, the <strong class="bold">Profiler</strong> window is a helpful tool that helps us rectify any issues with memory<a id="_idIndexMarker1523"/> leaks, garbage<a id="_idIndexMarker1524"/> collection, and any other possible issues.</p>
			<p>Now, we'll look at our last Unity tool, which we can use to see how the graphics pipeline is being used to display our game.</p>
			<h2 id="_idParaDest-236"><a id="_idTextAnchor239"/>Frame Debugger</h2>
			<p><strong class="bold">Frame Debugger</strong> can be<a id="_idIndexMarker1525"/> used to show how each frame is <a id="_idIndexMarker1526"/>created for our game in the Unity Editor. This can help us with any potential shader issues regarding how a piece of art is displayed. However, this is also a healthy reminder of how a scene is brought together and challenges potentially any unnecessary effects/materials used.</p>
			<p>To access the <strong class="bold">Frame Debugger</strong> tool, do the following:</p>
			<ol>
				<li value="1">At the top of the Unity Editor, select <strong class="bold">Window</strong> | <strong class="bold">Frame Debugger</strong>.</li>
			</ol>
			<p>Our <strong class="bold">Frame Debug</strong> window will appear.</p>
			<ol>
				<li value="2">Now, let's load up our <strong class="source-inline">title</strong> scene from the <strong class="bold">Project</strong> window (<strong class="source-inline">Assets/Scene</strong>).</li>
				<li>Click on the <strong class="bold">Enable</strong> button at the top of the <strong class="bold">Frame Debug</strong> window to see how the frame is created.</li>
				<li>The <strong class="bold">Frame Debug</strong> window will come alive and show us a list of tools and properties being implemented.</li>
				<li>With the <strong class="bold">Game</strong> window in view, scroll the slider (highlighted in the following screenshot) in the <strong class="bold">Frame Debug</strong> window from the right slowly to the left to see how<a id="_idIndexMarker1527"/> this <a id="_idIndexMarker1528"/>frame is created.</li>
			</ol>
			<p>The following screenshots show the <strong class="bold">Frame Debug</strong> window with the <strong class="bold">Enable</strong> button highlighted, along with three steps (<strong class="bold">4</strong>, <strong class="bold">8</strong>, and <strong class="bold">26</strong>):</p>
			<div>
				<div id="_idContainer557" class="IMG---Figure">
					<img src="image/Figure_13.72_B18381.jpg" alt="Figure 13.72 – The 'Frame Debugger' tool going through each step of your game&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.72 – The 'Frame Debugger' tool going through each step of your game</p>
			<p>Note that <em class="italic">step 4</em> shows the image that has been applied to the <strong class="bold">Bloom</strong> texture to create the shiny glow in <em class="italic">step 26</em>.</p>
			<p>After going through each of these steps and seeing all the maps, render targets, and all the other necessary steps to make a frame, it's also possible to select draw calls (a call to the graphics card) from the <strong class="bold">Frame Debug</strong> window, which will highlight the game object it's referring to.</p>
			<p>In the following screenshots, we have the <strong class="source-inline">shop</strong> scene with a total of <strong class="source-inline">47</strong> steps, as shown at the top of <strong class="bold">Frame Debug</strong>. If one of the draw calls is selected within the <strong class="bold">Frame Debug</strong> window (the middle highlighted rectangle), it will ping which game object it is referring to in the <strong class="bold">Hierarchy</strong> window, as shown on the left-hand side:</p>
			<div>
				<div id="_idContainer558" class="IMG---Figure">
					<img src="image/Figure_13.73_B18381.jpg" alt="Figure 13.72 – The 'Frame Debugger' tool going through each step of your game&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.73 – Frame Debugger showing which game object it's referring to </p>
			<p class="callout-heading">Further Information</p>
			<p class="callout">If you would like to<a id="_idIndexMarker1529"/> find out more about <strong class="bold">Frame Debugger</strong> and its capabilities, check out the following link: <a href="https://docs.unity3d.com/Manual/FrameDebugger.html">https://docs.unity3d.com/Manual/FrameDebugger.html</a>.</p>
			<p>Hopefully, you will be able to make great use of <strong class="bold">Frame Debugger</strong> and debug any graphical issues and understand the graphical pipeline more with Unity.</p>
			<p>Before we <a id="_idIndexMarker1530"/>summarize <a id="_idIndexMarker1531"/>this chapter, we are going to go through each of the four bug reports from our game's bug testers.</p>
			<h2 id="_idParaDest-237"><a id="_idTextAnchor240"/>Tackling bugs – answers</h2>
			<p>As programmers, we<a id="_idIndexMarker1532"/> need to, for example, follow a value through a series of steps to see whether it's the reason why code is not doing what it's supposed to do. However, there are also different methods for carrying out testing, and it's also good to think about checking your or someone else's code after an update has been applied to the project's code.</p>
			<p>As a programmer, you will likely hear of different types of methodology that are carried out and how much of a project's code should be tested.</p>
			<p>Here are the more popular types of tests you will carry out on your own and other projects:</p>
			<ul>
				<li><strong class="bold">Unit</strong>: A unit test is typically the first test that's carried out whenever a new piece of code has been added to a project before you carry out further testing on a larger scale. These tests can be as small as checking a <strong class="source-inline">for</strong> loop or a method to make sure a small block of code is working correctly.</li>
				<li><strong class="bold">Integration</strong>: This type of test is used when multiple sections of code (which could be from other programmers) are brought together and tested to see whether any issues occur when the game is running.</li>
				<li><strong class="bold">Smoke</strong>: These are tests that are carried out to determine whether the current build is stable. This type of test helps bug testers decide whether to proceed with further tests. Smoke tests should be minimal and frequent between builds.</li>
				<li><strong class="bold">Regression</strong>: When adding code to a project, there is always a chance that the existing code may clash with the new code that's been added. Here, you check the existing code to make sure that a change or addition hasn't created errors. These tests can be run manually for small projects or a suite of tests each time an update has been implemented for larger projects.</li>
				<li><strong class="bold">System</strong>: Typically, a system test would be conducted after an integration test to check the project code as a whole for any defects and general code behavior.</li>
			</ul>
			<p>Testing often helps you to keep track of a project overall and not be solely focused on one part of it. This is also why it's important to have some kind of plan; for example, we have our Game Design Brief. We could also be even more technical and have a UML diagram to help us see the connections between our scripts. So, we shouldn't think any differently about coding. Now that we have our code, we can hopefully improve it, make it more efficient, and remind ourselves of the SOLID principles.</p>
			<p>Speaking of bug-testing, have you thought of any solutions to the four bug reports that were made for our game back in the <em class="italic">Tackling bugs</em> section? Hopefully, you have, as we are going to go through each of them now.</p>
			<h3>Bug report – "Standalone AD button" solution</h3>
			<p>As you may recall, we <a id="_idIndexMarker1533"/>have our <strong class="source-inline">shop</strong> scene, which features an <strong class="source-inline">AD</strong> button. When pressed, the player will watch an advert and receive shop credits as a reward. This works fine in the mobile version of the game, but it had been reported that this button does not work on the standalone version.</p>
			<p>The short answer to this is that Unity doesn't support adverts for standalone builds. This leaves us either looking for a solution to have an advert in our game or turning off the <strong class="source-inline">AD</strong> button game object, either through scripting or manually through the <strong class="bold">Hierarchy</strong> window. Either way, this is a simple quick fix, as removing the <strong class="source-inline">AD</strong> button will automatically make the <strong class="source-inline">Start</strong> button resize, thanks to <strong class="bold">Vertical Layout Group</strong>. Some redesign would need to be implemented to solve this issue, rather than it being solely a programmer problem:</p>
			<div>
				<div id="_idContainer559" class="IMG---Figure">
					<img src="image/Figure_13.74_B18381.jpg" alt="Figure 13.74 – The Shop button layout without the AD button&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.74 – The Shop button layout without the AD button</p>
			<h3>Bug report – "Resetting the player's lives" solution</h3>
			<p>To make the player's lives reset correctly, we need to apply a fix in the <strong class="source-inline">TitleComponent</strong> script so that when our game restarts back at the beginning from either quitting or the player losing all of their lives, <strong class="source-inline">GameManager.playerLives</strong> is reset back to <strong class="source-inline">3</strong>.</p>
			<p>In the <strong class="source-inline">TitleComponent</strong> script, add the following code to reset the player's lives back to <strong class="source-inline">3</strong>:</p>
			<p class="source-code">  void Start() </p>
			<p class="source-code">  {</p>
			<p class="source-code">    if (GameManager.playerLives &lt;= 2)</p>
			<p class="source-code">        GameManager.playerLives = 3;</p>
			<p class="source-code">  }</p>
			<p>Save the <strong class="source-inline">TitleComponent</strong> script.</p>
			<h3>Bug report – "Slower systems on level 3" solution</h3>
			<p>The benefit of having multiple devices to run a series of tests is vital. If your game supports a low spec device, then you are also appealing to a wider audience. Reports for our game are coming in stating that the device struggles with lower-powered devices. To fix this, you need to ensure the following:</p>
			<ul>
				<li>Post-processing is disabled.</li>
				<li>Fewer enemies are in the levels on the screen at once. You can do this by changing the speed of <strong class="source-inline">EnemySpawner</strong> in the <strong class="bold">Inspector</strong> window.</li>
				<li>Remove any global illumination from scenes and apply basic lighting.</li>
				<li>Remove additional backgrounds from the <strong class="source-inline">shop</strong> scene.</li>
				<li>Change the <strong class="source-inline">CameraMovement</strong> script's <strong class="source-inline">Start</strong> function. Invoke from a <strong class="source-inline">6</strong>-second wait to <strong class="source-inline">7</strong> seconds to give the device more time to load.</li>
			</ul>
			<h3>Bug report – "Sometimes, the game ends too quickly" solution</h3>
			<p>It has been reported<a id="_idIndexMarker1534"/> that levels finish earlier than they should do, so instead of a level lasting 25 seconds, it has been reported to last only 5–10 seconds.</p>
			<p>This is happening because the <strong class="source-inline">BeginGame</strong> method in the <strong class="source-inline">ScenesManager</strong> script is not resetting the <strong class="source-inline">gameTimer</strong> variable back to zero. Follow these steps to fix this bug:</p>
			<ol>
				<li value="1">Open the <strong class="source-inline">ScenesManager</strong> script.</li>
				<li>Scroll down to the <strong class="source-inline">BeginGame</strong> method, and at the top of the method, add the following line:<p class="source-code"> gameTimer = 0;</p></li>
				<li>Save the <strong class="source-inline">ScenesManager</strong> script.</li>
			</ol>
			<p>Test your code, keep revisiting it, and keep polishing it. Continue to look at other ways of improving your script. Accept that the first few lines of code aren't going to be your best and that it's okay to revisit and keep optimizing your code.</p>
			<p class="callout-heading">Further Information</p>
			<p class="callout">If you would like to continue looking into how to improve the code for the game you've created, check out the following link from Unity: <a href="https://learn.unity.com/tutorial/fixing-performance-problems#5c7f8528edbc2a002053b595">https://learn.unity.com/tutorial/fixing-performance-problems#5c7f8528edbc2a002053b595</a>. </p>
			<p>That brings us to the end of this section, where we built our standalone version of our game and looked at potential issues that we needed to overcome, which we picked up with our bug testers. After that, we looked at the <strong class="bold">Profiler</strong> window, which we can use to monitor the <a id="_idIndexMarker1535"/>performance of our game, and <strong class="bold">Frame Debugger</strong>, which shows what steps are followed to make a frame. We then discussed how and when to test our game, before looking at the bugs we were issued and how to correct <a id="_idIndexMarker1536"/>them.</p>
			<p>Now, let's discuss this chapter as a whole.</p>
			<h1 id="_idParaDest-238"><a id="_idTextAnchor241"/>Summary</h1>
			<p>This chapter was about taking the game we have been developing throughout this book and putting it together as it reached its end. We spoke about how we could push our game further by adding physics collisions other than bullets or buttons. We set up collisions that got us more involved with tweaking the Rigidbody component to make our game objects behave in different ways. We did this by adding drag and affecting our scene's gravity.</p>
			<p>We then moved on and discussed how we could improve our game's screen ratio by updating its Canvas Scaler and how it would make our UI look more stable under different ratios. We also made our game-playing area more flexible under the different resolutions using different Unity functions, such as <strong class="source-inline">WorldToViewportPoint</strong>.</p>
			<p>At this point, our mobile version was ready to be built and tested so that we could see how well it ran with updated touchscreen controls. We also looked into its optimization in terms of textures and compressed them to decrease the size of our game and make it run better overall.</p>
			<p>After the mobile build, we looked at the PC version and made some more changes to improve the look of the game. We did this because the standalone machine was likely going to have a more powerful CPU, graphics card, memory, and so on. Then, we added effects such as post-processing to change the look and feel of our game to make it more polished. We continued adding more polish to our game by adding global illumination and fogging effects from our <strong class="bold">Lighting</strong> settings window. This made our materials shine red and bleed through the foggy darkness to give them more of a futuristic feel. We also added reflective statues to our end level. These made use of the reflection probe component. After that, we discussed how to optimize it in terms of the size of its reflective texture.</p>
			<p>Finally, we looked into building and testing our standalone version and also introduced some bug-testing scenarios, where our bug testers found issues with things not working the way they should. We reviewed and addressed them together.</p>
			<p>Making a game isn't easy, and there are many ways in which a game can be made. Someone will always have a better way than you and likely pick holes in it. However, as mentioned in this chapter, a game can be made in sweeps and improved at each sweep; the worst thing to do is to try and make a perfect game the first time around. If you think like that, you'll end up with no game at all.</p>
			<p>Are you ready for the full mock test? You should be; see what you've remembered by reading (and hopefully recreating) this book. If there are any problems with the questions that you can't answer, there are reference numbers next to each question (example: <strong class="source-inline">CH1,</strong> meaning Chapter 1) to help jog your memory. This will all be explained thoroughly in the next chapter – enjoy it.</p>
		</div>
	</body></html>