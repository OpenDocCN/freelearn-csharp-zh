# 前言

这是一本关于设计模式的书籍，它是在 C#编程语言的背景下编写的。我知道你可能正在想什么。这究竟是什么意思呢？好吧，我可以告诉你，但那样就会破坏这本书的剩余部分，相信我，那部分内容非常精彩！

设计模式是一套针对软件问题中经常出现的最佳实践，我们可以学会识别它们，并立即知道如何解决它们。这些模式中发现的重复问题的解决方案已经使用了数十年，并且已被证明是有效的。

由于模式无处不在，它们也成为了开发者的战斗语言。这个想法来源于流行的电视和电影系列《星际迷航》。在《星际迷航》中，被称为克林贡人的战士种族有两种语言。他们在克林贡幼儿园学习的是常规的克林贡语，而在战斗中使用的则是简化的版本。短语“*装载鱼雷管 1 和 2 并发射全弹*”可以缩减为一到两个词。所有克林贡人都知道这个短语的意思，他们之所以能赢得战斗，是因为他们比语言能力受限的对手快了几秒钟。同样，你可以说“*就使用装饰者模式*。”任何研究过模式的开发者都会知道接下来该做什么。

模式并不特定于 C#语言。然而，为了有效地学习模式，你需要一种实现语言。关于模式的原始书籍是由 Erich Gamma、Richard Helm、Ralph Johnson 和 John Vlissides 共同撰写的，他们合称为**四人帮**，简称**GoF**。他们的书《设计模式：可复用面向对象软件元素》通常被称为**GoF 书**。

GoF（设计模式：可复用面向对象软件元素）这本书是在 1994 年出版的，这使得它成为了一个技术上的恐龙。虽然它可能已经过时了，但书中解释的模式仍然非常相关。我对 GoF 书的批评是它采用了非常学术的格式，而且它的实现语言是你现在很少见到的。实现语言是一个重要的细节。GoF 书涵盖了 23 个模式，这与肯德基原味秘制配方中使用的香料和草药数量相同。这不会是巧合。这本书并没有涵盖所有 23 个模式，这很好，因为太多的炸鸡对你的健康并不好。我已经专注于你在大多数你参与的项目中每天都会用到的模式。我在书的末尾的*第八章*中简要地介绍了剩余的部分。

有些书籍试图使用伪代码来使其通用。我认为这样的书籍对大多数人来说没有用。如果你像我一样，你在这方面可能也是这样，你希望看到一个易于阅读、不太聪明且基于现实世界的代码示例。那些试图用“`类 A`继承自`类 B`，而`类 B`依赖于`类 C`”之类的短语教你模式的书籍和博客网站过于模糊，无法使用。同样令人烦恼的是那些试图用 20 种语言展示模式的书籍和网站。它们通常对这 20 种语言都做得很差，而不是专注于只做好一种。我只使用 C#和**统一建模语言**（**UML**）。

如果你之前从未听说过 UML，不要让它吓到你。UML 是一种用于创建图表的约定。有 14 种 UML 图表类型。我只使用一种图表类型：类图。我包括了一个入门指南在*附录 2*，如果你对 UML 不熟悉，这将有所帮助。

这本书是关于现实世界的，或者至少是一个非常接近的复制品。我写这本书使用了在真实软件项目中使用的相同技术。书中包含了解决真实商业问题的实际代码。还包括了设计错误，以及解决问题的深思熟虑的方法。

学术书籍的另一个问题是它们冗长且难以阅读。我努力将枯燥的主题变得不无聊。我意识到没有人故意写一本无聊的书。不幸的是，很多人做到了。我认为这种无聊的主要原因在于许多科技作者看待写书任务的方式。我认为许多作者写书是为了证明自己有多聪明。这些书往往非常学术化。它们旨在给其他学者留下深刻印象。那很好！世界需要学者。大多数开发者并不是专业的学者。我敢说，很多开发者从未正式上过计算机科学课程。我写这本书的目的不是证明我有多聪明或有多能干。我的妻子会告诉你，我总是过分地自我贬低。相反，我的目的是帮助你越过那堵阻碍你提升编程水平的墙。我必须独自攀登这堵墙，对我来说，这并不容易。然而，如果我能做到，你也能，在我的帮助下。

与枯燥的学术处理方式不同，这本书讲述了一个在现实世界中可能发生的故事。故事中涉及的科学幻想元素恰到好处，使其“仅仅是一个故事”。然而，故事中的情况非常真实，即使你在该领域工作了几年，你也会认出它们。

关于这一点，我想澄清几点。这本书中的故事是虚构的。虽然我是一个**出色的**软件工程师，但我不是机器人学家或机械工程师，也不是合格的自行车修理工。在即将到来的故事中的几个点上，如果你对这些主题很熟悉，你可能需要暂时放下你的怀疑。 

# 这本书面向的对象

这本书是为任何想要成为更好的软件开发者的人而写的。我希望我可以说得简单一些，但可能不行。让我再补充几点，关于谁会从这本书中受益。

简单的回答是，我称之为*中级*开发者。这些开发者拥有几年的 C#经验，并且对面向对象编程的基本原则非常熟悉。理想情况下，你已经看过一些 UML 类图。

这本书的另一个受益者是正在学习 C#的学生。如果你对基本面向对象概念，如继承和组合，感到稍微舒适，并且熟悉**集成开发环境**（**IDE**），我希望你阅读这本书。当然，中级开发者可能会更容易一些，但学习模式和 SOLID 原则会给你打下坚实的基础。你可能会避免养成一些坏习惯，或者纠正你已经学到的那些。

我也鼓励你阅读这本书，如果你是大学或代码训练营的应届毕业生。如果你没有做过很多 C#工作，但你在 Java、C++、Python 或 JavaScript 等其他语言中工作过，我也邀请你阅读这本书。我在这本书的*附录 1*中包含了一段关于 C#和面向对象编程概念的详细入门，希望能给你一些帮助。

我最想接触的一个群体。

我特别希望鼓励像我这样的自学开发者。这个群体的人往往只学习绝对必要的知识，作为生存当前冲刺的手段。如果你的老师是 YouTube 和博客圈，那么你很可能会迅速识别出*第一章*中发现的反模式，因为你现在可能已经犯过与软件工程相关的每一个错误。我只知道这一点，因为我犯过。因此，我知道你从阅读这本书中受益最大。

正如我说的，这本书是为任何想要成为更好的软件开发者的人而写的。我想我应该坚持这一点。

# 这本书涵盖的内容

*第一章*，*你的意大利面盘上有一大团泥巴*：在我们深入研究模式之前，让我们先探讨一下为什么我们需要它们。软件开发的世界非常混乱，但不必如此。混乱源于我们工作中的一系列退化力量，你一定会认识到的。

*第二章*，*为 C#中模式在实际现实世界应用中的准备*：为了克服*第一章*中提到的退化力量，你必须提高你的水平。这一章提出了一些规则和原则。如果你能坚持这些规则，你将拥有使用设计模式达到最大效果所需的纪律。

*第三章*，*运用创建型模式进行创新*：现在你已经充分准备，本章介绍了我们的故事。它涵盖了设计模式，旨在使你的类实例化更加健壮和灵活。阅读本章后，你将不会再以同样的方式看待`new`关键字。

*第四章*，*用结构模式加固你的代码*：本章介绍了你可以用来为你的类结构化以实现最大灵活性同时遵守在*第二章*中提到的 SOLID 原则的技术。

*第五章*，*通过应用行为模式处理问题代码*：你有算法吗？你需要一组灵活的模式来最大化其效果和灵活性。你需要行为模式。

*第六章*，*在编码前使用模式进行设计*：在本章中，我们考虑了在 IDE 中编写第一行代码之前使用模式来设计我们的代码的方法。在我们的故事中发生了一些不幸的事件后，我们发现我们的公司急剧且迅速地改变方向。我们需要一个新的产品设计，而且我们需要它在上周！让我们先在 UML 中绘制我们的设计！这可以节省大量的时间和精力，并防止某些自以为是的老板告诉我们发货原型。

*第七章*，*除了打字别无他法 – 实现轮椅项目*：在上一个章节中，我们提出了一套优雅的设计图。在本章中，我们将进行打字。你将实现本书中早期学到的相同模式，但这次，你将在一个真实的项目中使用它们。

*第八章*，*你已经了解了一些模式。接下来是什么？*：到目前为止，我们已经愉快地学习了很多模式，但这只是冰山一角。模式无处不在！它们不仅限于面向对象实践。在本章中，我们涵盖了我们在故事中没有涉及到的 GoF 模式。

*第九章*，*附录 1* *– C#面向对象原则简要回顾*：本附录是为那些刚接触 C#或可能有一段时间没有使用它，或者是从其他语言过来的读者设计的。

*第十章*，*附录 2* *– 统一建模语言入门*：统一建模语言是软件开发者使用的文档规范。它定义了本书中使用的模式设计图的架构。虽然 UML 有 14 种不同的图类型，但我们实际上只使用类图。大多数关于模式的演示都有两个图。我画了一个通用的图，以及一个反映项目代码的第二张图。本附录展示了图中使用的规范。

# 为了最大限度地利用这本书

为了充分利用这本书，你应该熟悉 C#。你需要能够熟练使用三种流行的 IDE 之一：Visual Studio、Rider 或 Visual Studio Code。你还应该了解基本的面向对象编程原则，如抽象、继承、封装和组合。

我在这本书中并没有花很多时间来介绍如何使用你的集成开发环境（IDE）。然而，我确实包括了*附录 1*，它涵盖了如何创建项目，以防你有些生疏。这本书的设计并不是要逐步引导你通过一系列项目。示例项目中的代码并不重要。我们关注的是代码的结构，而不是类的内容。

这本书中的所有项目都是命令行或库项目。我们不会处理任何前端或用户界面代码。这样做是为了减少项目中的噪音水平。我希望你专注于类的结构，而不是它们内部的内容，甚至不是程序真正在做什么。

我使用 Windows 10 创建了这本书中的代码。如果你想跟随书中的代码，你可能会使用 macOS 或 Linux。然而，我没有明确涵盖那些操作系统，也没有在其他操作系统上测试示例代码。

如果你打算与本书的英雄一起编码，你需要设置一个合适的 IDE 和 .NET Core 6 或更高版本。我使用 Rider 作为我的 IDE，但我在 Visual Studio 2022 和 Visual Studio Code 中验证了代码。

| **本书涵盖的软件/硬件** | **操作系统要求** |
| --- | --- |
| C# 10 | Windows |
| .NET Core 6 | Windows |
| Rider、Visual Studio 或 Visual Studio Code | Windows |

**如果你使用的是这本书的数字版，我们建议你亲自输入代码或从书的 GitHub 仓库（下一节中有一个链接）获取代码。这样做将帮助你避免与代码复制粘贴相关的任何潜在错误。**

我强烈建议你亲手输入书中的代码。通过这样做，你会从打字中学习更多，通过犯错误，然后自己修复它们。

# 下载示例代码文件

你可以从 GitHub 下载这本书的示例代码文件，链接为 [`github.com/Kpackt/Real-World-Implementation-of-C-Design-Patterns`](https://github.com/Kpackt/Real-World-Implementation-of-C-Design-Patterns)。请注意，GitHub 不允许我们在 C# 中使用 # 字符，所以仓库的名称有些误导。如果代码有更新，它将在 GitHub 仓库中更新。

我们还有来自我们丰富的图书和视频目录的其他代码包，可在 [`github.com/PacktPublishing/`](https://github.com/PacktPublishing/) 获取。查看它们！

这本书有一个由作者开发的配套网站。你可以在 [`csharppatterns.dev`](https://csharppatterns.dev) 找到它。

# 下载图片

我们还提供了一份包含本书中使用的截图和图表彩色图像的 PDF 文件。您可以从这里下载：[`packt.link/3KWzG`](https://packt.link/3KWzG)。

# 使用的约定

本书使用了多种文本约定。

`文本中的代码`：表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称。以下是一个示例：“Kitty 首先为构建者将要生产的内容创建一个抽象——即产品。她创建了一个名为`IBicycleProduct`的接口。”

代码块设置如下：

```cs
public interface IBicycleProduct
{
  public IFrame Frame { get; set; }
  public ISuspension Suspension { get; set; }
  public IHandlebars Handlebars { get; set; }
  public IDrivetrain Drivetrain { get; set; }
  public ISeat Seat { get; set; }
  public IBrakes Brakes { get; set; }
}
```

当我们希望将您的注意力引到代码块的一个特定部分时，相关的行或项目将以粗体显示：

```cs
namespace WheelchairProject;
public abstract class WheelchairComponent
{
```

任何命令行输入或输出都如下所示：

```cs
$ dotnet build
$ dotnet run hillcrest
```

小贴士或重要提示

看起来是这样的。

# 联系我们

我们欢迎读者的反馈。

**一般反馈**: 如果你对本书的任何方面有疑问，请通过客户关怀@packtpub.com 给我们发邮件，并在邮件主题中提及书名。

**勘误表**: 尽管我们已经尽一切努力确保内容的准确性，但错误仍然可能发生。如果您在本书中发现错误，我们将不胜感激，如果您能向我们报告，请访问[www.packtpub.com/support/errata](http://www.packtpub.com/support/errata)并填写表格。

**盗版**: 如果你在互联网上以任何形式遇到我们作品的非法副本，如果你能提供位置地址或网站名称，我们将不胜感激。请通过版权@packt.com 与我们联系，并提供材料的链接。

**如果您有兴趣成为作者**：如果您在某个领域有专业知识，并且您有兴趣撰写或为书籍做出贡献，请访问[authors.packtpub.com](http://authors.packtpub.com)。

# 分享您的想法

读完《C#设计模式的实际应用》后，我们非常乐意听到您的想法！请[点击此处直接进入此书的亚马逊评论页面](https://packt.link/r/1-803-24273-6)并分享您的反馈。

您的评论对我们和科技社区都很重要，并将帮助我们确保我们提供高质量的内容。

![](img/part-1-big-ball-of-mud-on-you-plate-of-spaghetti-2-bw.jpg)

# 第一部分：模式的介绍（意大利面）和反模式（反意大利面）

我们将在第一部分中描述模式是什么，它们从何而来，以及它们是如何工作的概述，以及为什么你想学习它们。

本部分涵盖了以下章节：

+   *第一章*，*你的意大利面盘上有一大团泥巴*

+   *第二章*，*为 C#中模式的应用做准备*
