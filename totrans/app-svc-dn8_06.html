<html><head></head><body>
  <div><h1 class="chapterNumber">6</h1>
    <h1 class="chapterTitle" id="_idParaDest-226">Using Popular Third-Party Libraries</h1>
    <p class="normal">This chapter is about some popular third-party libraries for .NET that enable you to perform actions that either are not possible with the core .NET libraries or are better than the built-in functionality. These actions include manipulating images with <strong class="keyWord">ImageSharp</strong>, logging with <strong class="keyWord">Serilog</strong>, mapping objects to other objects with <strong class="keyWord">AutoMapper</strong>, making unit test assertions with <strong class="keyWord">FluentAssertions</strong>, validating data with <strong class="keyWord">FluentValidation</strong>, and generating PDFs with <strong class="keyWord">QuestPDF</strong>.</p>
    <p class="normal">This chapter covers the following topics:</p>
    <ul>
      <li class="bulletList">Which third-party libraries are most popular?</li>
      <li class="bulletList">Working with images</li>
      <li class="bulletList">Logging with Serilog</li>
      <li class="bulletList">Mapping between objects</li>
      <li class="bulletList">Making fluent assertions in unit testing</li>
      <li class="bulletList">Validating data</li>
      <li class="bulletList">Generating PDFs</li>
    </ul>
    <h1 class="heading-1" id="_idParaDest-227">Which third-party libraries are most popular?</h1>
    <p class="normal">To help me decide which third-party libraries to include in this book, I researched which are downloaded most frequently at <a href="https://www.nuget.org/stats/packages">https://www.nuget.org/stats/packages</a>, and, as shown in <em class="italic">Table 6.1</em>, they are:</p>
    <table class="table-container" id="table001-4">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Rank</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Package</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Downloads</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">1</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">newtonsoft.json</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">167,927,712</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">2</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">serilog</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">42,436,567</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">3</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">awssdk.core</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">36,423,449</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">4</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">castle.core</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">28,383,411</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">5</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">newtonsoft.json.bson</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">26,547,661</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">6</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">swashbuckle.aspnetcore.swagger</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">25,828,940</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">7</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">swashbuckle.aspnetcore.swaggergen</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">25,823,941</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">8</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">polly</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">22,487,368</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">9</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">automapper</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">21,679,921</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">10</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">swashbuckle.aspnetcore.swaggerui</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">21,373,873</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">12</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">moq</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">19,408,440</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">15</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">fluentvalidation</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">17,739,259</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">16</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">humanizer.core</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">17,602,598</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">23</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">stackexchange.redis</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">15,771,377</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">36</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">fluentassertions</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">12,244,097</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">40</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">dapper</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">10,819,569</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">52</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">rabbitmq.client</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">8,591,362</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">83</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">hangfire.core</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">5,479,381</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">94</p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">nodatime</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">4,944,830</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 6.1: The most downloaded NuGet packages</p>
    <h2 class="heading-2" id="_idParaDest-228">What is covered in my books</h2>
    <p class="normal">My book <em class="italic">C# 12 and .NET 8 – Modern Cross-Platform Development Fundamentals</em> introduces processing JSON using <code class="inlineCode">newtonsoft.json</code> and documenting web services using <code class="inlineCode">swashbuckle</code>.</p>
    <p class="normal">For now, using Castle Core to generate dynamic proxies and typed dictionaries, or deploying to and integrating with <strong class="keyWord">Amazon Web Services</strong> (<strong class="keyWord">AWS</strong>), is out of scope for this book.</p>
    <p class="normal">As well as raw download numbers, questions from readers and the usefulness of the library also contributed to my decision to include a library in this chapter, as summarized in the following list:</p>
    <ul>
      <li class="bulletList">Most popular library for manipulating images: <strong class="keyWord">ImageSharp</strong></li>
      <li class="bulletList">Most popular library for manipulating text: <strong class="keyWord">Humanizer</strong></li>
      <li class="bulletList">Most popular library for logging: <strong class="keyWord">Serilog</strong></li>
      <li class="bulletList">Most popular library for object mapping: <strong class="keyWord">AutoMapper</strong></li>
      <li class="bulletList">Most popular library for unit test assertions: <strong class="keyWord">FluentAssertions</strong></li>
      <li class="bulletList">Most popular library for data validation: <strong class="keyWord">FluentValidation</strong></li>
      <li class="bulletList">Open-source library for generating PDFs: <strong class="keyWord">QuestPDF</strong></li>
    </ul>
    <p class="normal">In <em class="chapterRef">Chapter 7</em>, <em class="italic">Handling Dates, Times, and Internationalization</em>, I cover the most popular library for handling dates and times: <strong class="keyWord">Noda Time</strong>.</p>
    <p class="normal">In <em class="chapterRef">Chapter 9</em>, <em class="italic">Caching, Queuing, and Resilient Background Services</em>, I cover a few more popular libraries, as summarized in the following list:</p>
    <ul>
      <li class="bulletList">Most popular library for resilience and transient fault handling: <strong class="keyWord">Polly</strong></li>
      <li class="bulletList">Most popular library for scheduling jobs and implementing background services: <strong class="keyWord">Hangfire</strong></li>
      <li class="bulletList">Most popular library for distributed caching: <strong class="keyWord">Redis</strong></li>
      <li class="bulletList">Most popular library for queuing: <strong class="keyWord">RabbitMQ</strong></li>
    </ul>
    <h1 class="heading-1" id="_idParaDest-229">Working with images</h1>
    <p class="normal"><strong class="keyWord">ImageSharp</strong> is a <a id="_idIndexMarker473"/>third-party cross-platform 2D graphics library. When .NET Core 1.0 was in development, there was negative feedback from the community <a id="_idIndexMarker474"/>about the missing <code class="inlineCode">System.Drawing</code> namespace for working with 2D images. The ImageSharp project was started to fill that gap for modern .NET applications.</p>
    <p class="normal">In their official documentation for <code class="inlineCode">System.Drawing</code>, Microsoft says, “The <code class="inlineCode">System.Drawing</code> namespace is not recommended for new development due to not being supported within a Windows or ASP.NET service, and it is not cross-platform. ImageSharp and SkiaSharp are recommended as alternatives.”</p>
    <div><p class="normal">Six Labors released ImageSharp 3.0 in March 2023. It now requires .NET 6 or later and major future versions will target LTS releases of .NET, like .NET 8. You can read the announcement at the following link: <a href="https://sixlabors.com/posts/announcing-imagesharp-300/">https://sixlabors.com/posts/announcing-imagesharp-300/</a>.</p>
    </div>
    <h2 class="heading-2" id="_idParaDest-230">Generating grayscale thumbnails</h2>
    <p class="normal">Let’s see<a id="_idIndexMarker475"/> what can be achieved with ImageSharp:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Use your preferred code editor to create a console app project, as defined in the following list:<ul>
          <li class="bulletList">Project template: <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code></li>
          <li class="bulletList">Solution file and folder: <code class="inlineCode">Chapter06</code></li>
          <li class="bulletList">Project file and folder: <code class="inlineCode">WorkingWithImages</code></li>
          <li class="bulletList"><strong class="screenText">Do not use top-level statements</strong>: Cleared</li>
          <li class="bulletList"><strong class="screenText">Enable native AOT publish</strong>: Cleared</li>
        </ul>
      </li>
      <li class="numberedList">In the <code class="inlineCode">WorkingWithImages</code> project, create an <code class="inlineCode">images</code> folder and download the nine images from the following link to it: <a href="https://github.com/markjprice/apps-services-net8/tree/master/images/Categories">https://github.com/markjprice/apps-services-net8/tree/master/images/Categories</a>. </li>
      <li class="numberedList">If you are using Visual Studio 2022, then the <code class="inlineCode">images</code> folder and its files must be copied to the <code class="inlineCode">WorkingWithImages\bin\Debug\net8</code> folder where the compiled console app will run. We can configure Visual Studio to do this for us, as shown in the following steps:<ol class="numberedList" style="list-style-type: decimal;">
          <li class="numberedList" value="1">In <strong class="screenText">Solution Explorer</strong>, select all nine images.</li>
          <li class="numberedList">In <strong class="screenText">Properties</strong>, set <strong class="screenText">Copy to Output Directory</strong> to <strong class="screenText">Copy always</strong>, as shown in <em class="italic">Figure 6.1</em>:</li>
        </ol>
        <figure class="mediaobject"><img alt="A picture containing text, screenshot, software, computer icon  Description automatically generated" src="img/B19587_06_01.png"/></figure>
        <p class="packt_figref">Figure 6.1: Setting images to always copy to the output directory</p>
        <ol class="numberedList" style="list-style-type: decimal;">
          <li class="numberedList" value="3">Open<a id="_idIndexMarker476"/> the project file and note the <code class="inlineCode">&lt;ItemGroup&gt;</code> entries that will copy the nine images to the correct folder, as partially shown in the following markup:
            <pre class="programlisting code"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;None Update="images\categories.jpeg"&gt;
    &lt;CopyToOutputDirectory&gt;Always&lt;/CopyToOutputDirectory&gt;
  &lt;/None&gt;
  &lt;None Update="images\category1.jpeg"&gt;
    &lt;CopyToOutputDirectory&gt;Always&lt;/CopyToOutputDirectory&gt;
  &lt;/None&gt;
...
</code></pre>
          </li>
        </ol>
      </li>
      <li class="numberedList">In the <code class="inlineCode">WorkingWithImages</code> project, treat warnings as errors, globally and statically import the <code class="inlineCode">System.Console</code> class, and add a package reference for <code class="inlineCode">SixLabors.ImageSharp</code>, as shown highlighted in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;Project Sdk="Microsoft.NET.Sdk"&gt;
  &lt;PropertyGroup&gt;
    &lt;OutputType&gt;Exe&lt;/OutputType&gt;
    &lt;TargetFramework&gt;net8.0&lt;/TargetFramework&gt;
    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
    &lt;Nullable&gt;enable&lt;/Nullable&gt;
<strong class="hljs-slc">    &lt;TreatWarningsAsErrors&gt;</strong><strong class="hljs-literal-slc">true</strong><strong class="hljs-slc">&lt;/TreatWarningsAsErrors&gt;</strong>
  &lt;/PropertyGroup&gt;
<strong class="hljs-slc">  &lt;ItemGroup&gt;</strong>
<strong class="hljs-slc">    &lt;Using Include=</strong><strong class="hljs-string-slc">"System.Console"</strong><strong class="hljs-slc"> Static=</strong><strong class="hljs-string-slc">"true"</strong><strong class="hljs-slc"> /&gt;</strong>
<strong class="hljs-slc">  &lt;/ItemGroup&gt;</strong>
<strong class="hljs-slc">  &lt;ItemGroup&gt;</strong>
<strong class="hljs-slc">    &lt;PackageReference Include=</strong><strong class="hljs-string-slc">"SixLabors.ImageSharp"</strong><strong class="hljs-slc"> Version=</strong><strong class="hljs-string-slc">"3.0.2"</strong><strong class="hljs-slc"> /&gt;</strong>
<strong class="hljs-slc">  &lt;/ItemGroup&gt;</strong>
...
</code></pre>
      
    <div><p class="normal">To save space, in other steps like this in this chapter, I will not show the markup to treat warnings as errors or to globally and statically import the <code class="inlineCode">System.Console</code> class. I will only show the <code class="inlineCode">ItemGroup</code> and <code class="inlineCode">PackageReference</code> for task-specific libraries.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Build <a id="_idIndexMarker477"/>the <code class="inlineCode">WorkingWithImages</code> project.</li>
      <li class="numberedList">If you are using Visual Studio 2022, then in <strong class="screenText">Solution Explorer</strong>, toggle <strong class="screenText">Show All Files</strong>.</li>
      <li class="numberedList">In the <code class="inlineCode">obj\Debug\net8.0</code> folder, open <code class="inlineCode">WorkingWithImages.GlobalUsings.g.cs</code>, and note that referencing the <code class="inlineCode">SixLabors.ImageSharp</code> package adds three global namespace imports alongside the usual ones added by the .NET SDK, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">// &lt;auto-generated/&gt;
global using global::SixLabors.ImageSharp;
global using global::SixLabors.ImageSharp.PixelFormats;
global using global::SixLabors.ImageSharp.Processing;
...
</code></pre>
      
    <div><p class="normal">If you reference older versions of <code class="inlineCode">SixLabors.ImageSharp</code> like 2.0.0, then it does not do this so you must manually import those three namespaces in each code file. This feature is one reason why version 3.0 and later have a minimum requirement of .NET 6.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="8">In <code class="inlineCode">Program.cs</code>, delete<a id="_idIndexMarker478"/> the existing statements and then add statements to convert all the files in the <code class="inlineCode">images</code> folder into grayscale thumbnails at one-tenth size, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">string imagesFolder = Path.Combine(
  Environment.CurrentDirectory, "images");
WriteLine($"I will look for images in the following folder:\n{imagesFolder}");
WriteLine();
if (!Directory.Exists(imagesFolder))
{
  WriteLine();
  WriteLine("Folder does not exist!");
  return;
}
IEnumerable&lt;string&gt; images =
  Directory.EnumerateFiles(imagesFolder);
foreach (string imagePath in images)
{
  if (Path.GetFileNameWithoutExtension(imagePath).EndsWith("-thumbnail"))
  {
    WriteLine($"Skipping:\n  {imagePath}");
    WriteLine();
    continue; // This file has already been converted.
  }
  string thumbnailPath = Path.Combine(
    Environment.CurrentDirectory, "images",
    Path.GetFileNameWithoutExtension(imagePath)
    + "-thumbnail" + Path.GetExtension(imagePath));
  using (Image image = Image.Load(imagePath))
  {
    WriteLine($"Converting:\n  {imagePath}");
    WriteLine($"To:\n  {thumbnailPath}");
    image.Mutate(x =&gt; x.Resize(image.Width / 10, image.Height / 10));
    image.Mutate(x =&gt; x.Grayscale());
    image.Save(thumbnailPath);
    WriteLine();
  }
}
WriteLine("Image processing complete.");
if (OperatingSystem.IsWindows())
{
  Process.Start("explorer.exe", imagesFolder);
}
else
{
  WriteLine("View the images folder.");
}
</code></pre>
      </li>
      <li class="numberedList">Run the<a id="_idIndexMarker479"/> console app and note the images should be converted into grayscale thumbnails, as shown in the following partial output:
        <pre class="programlisting con"><code class="hljs-con">I will look for images in the following folder:
C:\apps-services-net8\Chapter06\WorkingWithImages\bin\Debug\net8.0\images
Converting:
  C:\apps-services-net8\Chapter06\WorkingWithImages\bin\Debug\net8.0\images\categories.jpeg
To:
  C:\apps-services-net8\Chapter06\WorkingWithImages\bin\Debug\net8.0\images\categories-thumbnail.jpeg
Converting:
  C:\apps-services-net8\Chapter06\WorkingWithImages\bin\Debug\net8.0\images\category1.jpeg
To:
  C:\apps-services-net8\Chapter06\WorkingWithImages\bin\Debug\net8.0\images\category1-thumbnail.jpeg
...
Converting:
  C:\apps-services-net8\Chapter06\WorkingWithImages\bin\Debug\net8.0\images\category8.jpeg
To:
  C:\apps-services-net8\Chapter06\WorkingWithImages\bin\Debug\net8.0\images\category8-thumbnail.jpeg
Image processing complete.
</code></pre>
      </li>
      <li class="numberedList">In the<a id="_idIndexMarker480"/> filesystem, open the appropriate <code class="inlineCode">images</code> folder and note the much-smaller-in-bytes grayscale thumbnails, as shown in <em class="italic">Figure 6.2</em>:</li>
    </ol>
    <figure class="mediaobject"><img alt="" src="img/B19587_06_02.png"/></figure>
    <p class="packt_figref">Figure 6.2: Images after processing</p>
    <h2 class="heading-2" id="_idParaDest-231">ImageSharp packages for drawing and the web</h2>
    <p class="normal">ImageSharp <a id="_idIndexMarker481"/>also has NuGet packages for programmatically drawing images and working with images on the web, as shown in the following list:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">SixLabors.ImageSharp.Drawing</code></li>
      <li class="bulletList"><code class="inlineCode">SixLabors.ImageSharp.Web</code>
        <div><p class="normal"><strong class="keyWord">More Information</strong>: Learn more details at the following link: <a href="https://docs.sixlabors.com/">https://docs.sixlabors.com/</a>.</p>
        </div>
      </li>
    </ul>
    <h1 class="heading-1" id="_idParaDest-232">Working with text and numbers using Humanizer</h1>
    <p class="normal">Humanizer manipulates text in <code class="inlineCode">string</code> values, names of <code class="inlineCode">enum</code> values, dates, times, numbers, and quantities.</p>
    <h2 class="heading-2" id="_idParaDest-233">Working with text</h2>
    <p class="normal">The<a id="_idIndexMarker482"/> built-in <code class="inlineCode">string</code> type has methods to manipulate<a id="_idIndexMarker483"/> text like <code class="inlineCode">Substring</code> and <code class="inlineCode">Trim</code>. But there are plenty of other common manipulations that we might want to perform on text. For example:</p>
    <ul>
      <li class="bulletList">You might have an ugly string generated by some code and you want to make it look friendlier to display to a user. This is common with <code class="inlineCode">enum</code> types that cannot use spaces in multi-word values.</li>
      <li class="bulletList">You might build a web content management system, and when a user enters an article title, you need to convert what they enter into a format suitable for a URL path.</li>
      <li class="bulletList">You might have a long <code class="inlineCode">string</code> value that needs to be truncated to show in the limited space of a mobile user interface.</li>
    </ul>
    <h2 class="heading-2" id="_idParaDest-234">Humanizer case transformations</h2>
    <p class="normal">Complex transformations<a id="_idIndexMarker484"/> can be performed in sequence by passing multiple Humanizer transformations to the <code class="inlineCode">Transform</code> method. Transforms implement the <code class="inlineCode">IStringTransformer</code> or <code class="inlineCode">ICulturedStringTransformer</code> interfaces so you can implement your own custom transforms. </p>
    <p class="normal">The built-in transforms are all casing transformations, and they are listed in <em class="italic">Table 6.2</em> along with<a id="_idIndexMarker485"/> convenient alternative methods that extend the <code class="inlineCode">string</code> type:</p>
    <table class="table-container" id="table002-4">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Transform</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Example</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">To.LowerCase</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Transforms all characters in the <code class="inlineCode">string</code> to lowercase.</p>
          </td>
          <td class="table-cell">
            <p class="normal">the cat sat on the mat</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">To.UpperCase</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Transforms all characters in the <code class="inlineCode">string</code> to uppercase.</p>
          </td>
          <td class="table-cell">
            <p class="normal">THE CAT SAT ON THE MAT</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">To.TitleCase</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Transforms the first character of each word in the <code class="inlineCode">string</code> to uppercase.</p>
          </td>
          <td class="table-cell">
            <p class="normal">The Cat Sat on the Mat</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">To.SentenceCase</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Transforms the first character in the <code class="inlineCode">string</code> to uppercase. It ignores periods (full stops) so it does not recognize sentences!</p>
          </td>
          <td class="table-cell">
            <p class="normal">The cat sat on the mat</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 6.2: Humanizer casing transforms</p>
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: It is important to consider the casing of the original text. If it is already uppercase, the title and sentence casing options will <em class="italic">not</em> convert to lowercase! You might need to transform to lowercase first, then transform to title or sentence case.</p>
    </div>
    <p class="normal">As well as calling the <code class="inlineCode">Transform</code> method with a transform object like <code class="inlineCode">To.TitleCase</code>, there are convenience methods for manipulating the case of text, as shown in <em class="italic">Table 6.3</em>:</p>
    <table class="table-container" id="table003-4">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">String extension method</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Titleize</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Equivalent to transforming with <code class="inlineCode">To.TitleCase</code></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Pascalize</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Converts strings to upper camel case, also removing underscores</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Camelize</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Same as <code class="inlineCode">Pascalize</code> except that the first character is lowercase</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 6.3: Humanizer text extension methods</p>
    <h2 class="heading-2" id="_idParaDest-235">Humanizer spacing conversions</h2>
    <p class="normal">There are<a id="_idIndexMarker486"/> convenient methods for manipulating the spacing of text, by adding underscores and dashes, as shown in <em class="italic">Table 6.4</em>:</p>
    <table class="table-container" id="table004-4">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">String extension method</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Underscore</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Separates the input words with an underscore</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Dasherize</code>, <code class="inlineCode">Hyphenate</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Replaces underscores with dashes (hyphens) in the string</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Kebaberize</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Separates the input words with dashes (hyphens)</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 6.4: Humanizer spacing conversion methods</p>
    <h2 class="heading-2" id="_idParaDest-236">Humanizer’s Singularize and Pluralize methods</h2>
    <p class="normal">Humanizer <a id="_idIndexMarker487"/>has two extension methods for the <code class="inlineCode">string</code> class that <a id="_idIndexMarker488"/>automate converting between the singular and plural versions of a word, as shown in <em class="italic">Table 6.5</em>:</p>
    <table class="table-container" id="table005-3">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">String extension method</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Singularize</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">If the <code class="inlineCode">string</code> contains a plural word, it is converted to the singular equivalent.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Pluralize</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">If the <code class="inlineCode">string</code> contains a singular word, it is converted to the plural equivalent.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 6.5: Humanizer’s Singularize and Pluralize methods</p>
    <div><p class="normal">These methods are used by Microsoft Entity Framework Core to singularize and pluralize the names of entity classes and their members.</p>
    </div>
    <h2 class="heading-2" id="_idParaDest-237">Exploring text manipulations with a console app</h2>
    <p class="normal">Let’s explore<a id="_idIndexMarker489"/> some examples of text manipulation using Humanizer:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code> project named <code class="inlineCode">HumanizingData</code> to the <code class="inlineCode">Chapter06</code> solution. In Visual Studio 2022, set the startup project to the current selection.</li>
      <li class="numberedList">In the <code class="inlineCode">HumanizingData</code> project, treat warnings as errors, globally and statically import the <code class="inlineCode">System.Console</code> class, and add a package reference for <code class="inlineCode">Humanizer</code>, as shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;PackageReference Include="Humanizer" Version="2.14.1" /&gt;
&lt;/ItemGroup&gt;
</code></pre>
      
    <div><p class="normal">We are referencing a <code class="inlineCode">Humanizer</code> package that includes all languages. If you only need the English language, then you can reference <code class="inlineCode">Humanizer.Core</code> instead. If you also need a subset of languages, reference specific language packages using the pattern <code class="inlineCode">Humanizer.Core.&lt;lang&gt;</code>, for example, <code class="inlineCode">Humanizer.Core.fr</code> for French.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">Build <a id="_idIndexMarker490"/>the <code class="inlineCode">HumanizingData</code> project to restore packages.</li>
      <li class="numberedList">Add a new class file to the project named <code class="inlineCode">Program.Functions.cs</code>.</li>
      <li class="numberedList">In <code class="inlineCode">Program.Functions.cs</code>, add statements to import the namespace for working with globalization, and to define a method to configure the console to enable easy switching of the current culture and enable the use of special characters, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using System.Globalization; // To use CultureInfo.
partial class Program
{
  private static void ConfigureConsole(string culture = "en-US")
  {
    // To enable special characters like … (ellipsis) as a single character.
    OutputEncoding = System.Text.Encoding.UTF8;
    Thread t = Thread.CurrentThread;
    t.CurrentCulture = CultureInfo.GetCultureInfo(culture);
    t.CurrentUICulture = t.CurrentCulture;
    WriteLine("Current culture: {0}", t.CurrentCulture.DisplayName);
    WriteLine();
  }
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete the existing statements, and then call the <code class="inlineCode">ConfigureConsole</code> method, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">ConfigureConsole(); // Defaults to en-US culture.
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.Functions.cs</code>, add a statement to import the namespace for working with extension methods provided by Humanizer, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using Humanizer; // To use common Humanizer extension methods.
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.Functions.cs</code>, add statements to define a method to output an original <code class="inlineCode">string</code> and then the results of transforming it using the built-in casing<a id="_idIndexMarker491"/> transforms, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">private static void OutputCasings(string original)
{
  WriteLine("Original casing: {0}", original);
  WriteLine("Lower casing: {0}", original.Transform(To.LowerCase));
  WriteLine("Upper casing: {0}", original.Transform(To.UpperCase));
  WriteLine("Title casing: {0}", original.Transform(To.TitleCase));
  WriteLine("Sentence casing: {0}", original.Transform(To.SentenceCase));
  WriteLine("Lower, then Sentence casing: {0}", 
    original.Transform(To.LowerCase, To.SentenceCase));
  WriteLine();
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, call the <code class="inlineCode">OutputCasings</code> method with three different <code class="inlineCode">string</code> values, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">OutputCasings("The cat sat on the mat.");
OutputCasings("THE CAT SAT ON THE MAT.");
OutputCasings("the cat sat on the mat. the frog jumped.");
</code></pre>
      </li>
      <li class="numberedList">Run the code and view the result, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">Current culture: English (United States)
Original casing: The cat sat on the mat.
Lower casing: the cat sat on the mat.
Upper casing: THE CAT SAT ON THE MAT.
Title casing: The Cat Sat on the Mat.
Sentence casing: The cat sat on the mat.
Lower, then Sentence casing: The cat sat on the mat.
Original casing: THE CAT SAT ON THE MAT.
Lower casing: the cat sat on the mat.
Upper casing: THE CAT SAT ON THE MAT.
Title casing: THE CAT SAT ON THE MAT.
Sentence casing: THE CAT SAT ON THE MAT.
Lower, then Sentence casing: The cat sat on the mat.
Original casing: the cat sat on the mat. the frog jumped.
Lower casing: the cat sat on the mat. the frog jumped.
Upper casing: THE CAT SAT ON THE MAT. THE FROG JUMPED.
Title casing: The Cat Sat on the Mat. the Frog Jumped.
Sentence casing: The cat sat on the mat. the frog jumped.
Lower, then Sentence casing: The cat sat on the mat. the frog jumped.
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.Functions.cs</code>, add statements to define a method that outputs an ugly <code class="inlineCode">string</code> value <a id="_idIndexMarker492"/>using various Humanizer extension methods, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">private static void OutputSpacingAndDashes()
{
  string ugly = "ERROR_MESSAGE_FROM_SERVICE";
  WriteLine("Original string: {0}", ugly);
  WriteLine("Humanized: {0}", ugly.Humanize());
  // LetterCasing is legacy and will be removed in future.
  WriteLine("Humanized, lower case: {0}", 
    ugly.Humanize(LetterCasing.LowerCase));
  // Use Transform for casing instead.
  WriteLine("Transformed (lower case, then sentence case): {0}",
    ugly.Transform(To.LowerCase, To.SentenceCase));
  WriteLine("Humanized, Transformed (lower case, then sentence case): {0}",
    ugly.Humanize().Transform(To.LowerCase, To.SentenceCase));
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, comment out the previous method calls and then add a statement to call the new method, as shown highlighted in the following code:
        <pre class="programlisting code"><code class="hljs-code"><strong class="hljs-comment-slc">/*</strong>
OutputCasings("The cat sat on the mat.");
OutputCasings("THE CAT SAT ON THE MAT.");
OutputCasings("the cat sat on the mat. the frog jumped.");
<strong class="hljs-comment-slc">*/</strong>
<strong class="hljs-slc">OutputSpacingAndDashes();</strong>
</code></pre>
      </li>
      <li class="numberedList">Run the<a id="_idIndexMarker493"/> code and view the result, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">Original string: ERROR_MESSAGE_FROM_SERVICE
Humanized: ERROR MESSAGE FROM SERVICE
Humanized, lower case: error message from service
Transformed (lower case, then sentence case): Error_message_from_service
Humanized, Transformed (lower case, then sentence case): Error message from service
</code></pre>
      </li>
      <li class="numberedList">Add a new class file to the project named <code class="inlineCode">WondersOfTheAncientWorld.cs</code>.</li>
      <li class="numberedList">Modify the <code class="inlineCode">WondersOfTheAncientWorld.cs</code> file, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">namespace Packt.Shared;
public enum WondersOfTheAncientWorld : byte
{
  None                     = 0b_0000_0000, // i.e. 0
  GreatPyramidOfGiza       = 0b_0000_0001, // i.e. 1
  HangingGardensOfBabylon  = 0b_0000_0010, // i.e. 2
  StatueOfZeusAtOlympia    = 0b_0000_0100, // i.e. 4
  TempleOfArtemisAtEphesus = 0b_0000_1000, // i.e. 8
  MausoleumAtHalicarnassus = 0b_0001_0000, // i.e. 16
  ColossusOfRhodes         = 0b_0010_0000, // i.e. 32
  LighthouseOfAlexandria   = 0b_0100_0000  // i.e. 64
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.Functions.cs</code>, import the namespace for using the <code class="inlineCode">enum</code> that we just defined, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using Packt.Shared; // To use WondersOfTheAncientWorld.
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.Functions.cs</code>, define a method to create the <code class="inlineCode">WondersOfTheWorld</code> variable and output its name using various Humanizer extension<a id="_idIndexMarker494"/> methods, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">private static void OutputEnumNames()
{
  var favoriteAncientWonder = WondersOfTheAncientWorld.StatueOfZeusAtOlympia;
  WriteLine("Raw enum value name: {0}", favoriteAncientWonder);
  WriteLine("Humanized: {0}", favoriteAncientWonder.Humanize());
  WriteLine("Humanized, then Titleized: {0}", 
    favoriteAncientWonder.Humanize().Titleize());
  WriteLine("Truncated to 8 characters: {0}", 
    favoriteAncientWonder.ToString().Truncate(length: 8));
  WriteLine("Kebaberized: {0}", 
    favoriteAncientWonder.ToString().Kebaberize());
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, comment out the previous method call, and then add a call to <code class="inlineCode">OutputEnumNames</code>, as shown highlighted in the following code:
        <pre class="programlisting code"><code class="hljs-code"><strong class="hljs-comment-slc">//</strong>OutputSpacingAndDashes();
<strong class="hljs-slc">OutputEnumNames();</strong>
</code></pre>
      </li>
      <li class="numberedList">Run the code and view the result, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">Raw enum value name: StatueOfZeusAtOlympia
Humanized: Statue of zeus at olympia
Humanized, then Titlerized: Statue of Zeus at Olympia
Truncated to 8 characters: StatueO…
Kebaberized: statue-of-zeus-at-olympia
</code></pre>
      </li>
    </ol>
    <div><p class="normal">Note the <code class="inlineCode">Truncate</code> method uses the single-character <code class="inlineCode">…</code> (ellipsis) by default. If you ask to truncate to a length of 8, it can return the first seven characters followed by the ellipsis character. You can specify a different character using an overload of the <code class="inlineCode">Truncate</code> method.</p>
    </div>
    <h2 class="heading-2" id="_idParaDest-238">Working with numbers</h2>
    <p class="normal">Now let’s see <a id="_idIndexMarker495"/>how Humanizer can help us with numbers:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">In <code class="inlineCode">Program.Functions.cs</code>, define a method to create some numbers and then output them using various Humanizer extension methods, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">private static void NumberFormatting()
{
  int number = 123;
  WriteLine($"Original number: {number}");
  WriteLine($"Roman: {number.ToRoman()}");
  WriteLine($"Words: {number.ToWords()}");
  WriteLine($"Ordinal words: {number.ToOrdinalWords()}");
  WriteLine();
  string[] things = { "fox", "person", "sheep", 
    "apple", "goose", "oasis", "potato", "die", "dwarf",
    "attorney general", "biceps"};
  for (int i = 1; i &lt;= 3; i++)
  {
    for (int j = 0; j &lt; things.Length; j++)
    {
      Write(things[j].ToQuantity(i, ShowQuantityAs.Words));
      if (j &lt; things.Length - 1) Write(", ");
    }
    WriteLine();
  }
  WriteLine();
  int thousands = 12345;
  int millions = 123456789;
  WriteLine("Original: {0}, Metric: About {1}", thousands,
    thousands.ToMetric(decimals: 0));
  WriteLine("Original: {0}, Metric: {1}", thousands,
    thousands.ToMetric(MetricNumeralFormats.WithSpace 
      | MetricNumeralFormats.UseShortScaleWord, 
      decimals: 0));
  WriteLine("Original: {0}, Metric: {1}", millions,
    millions.ToMetric(decimals: 1));
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, comment <a id="_idIndexMarker496"/>out the previous method call and add a call to <code class="inlineCode">NumberFormatting</code>, as shown highlighted in the following code:
        <pre class="programlisting code"><code class="hljs-code"><strong class="hljs-comment-slc">//</strong>OutputEnumNames();
<strong class="hljs-slc">NumberFormatting();</strong>
</code></pre>
      </li>
      <li class="numberedList">Run the code and view the result, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">Original number: 123
Roman: CXXIII
Words: one hundred and twenty-three
Ordinal words: hundred and twenty-third
one fox, one person, one sheep, one apple, one goose, one oasis, one potato, one die, one dwarf, one attorney general, one bicep
two foxes, two people, two sheep, two apples, two geese, two oases, two potatoes, two dice, two dwarves, two attorney generals, two biceps
three foxes, three people, three sheep, three apples, three geese, three oases, three potatoes, three dice, three dwarves, three attorney generals, three biceps
Original: 12345, Metric: About 12k
Original: 12345, Metric: About 12 thousand
Original: 123456789, Metric: 123.5M
</code></pre>
      
    <div><p class="normal">Humanizer’s default vocabulary is quite decent, but it does not correctly pluralize attorney general (the plural is <em class="italic">attorneys general</em>) or biceps (the singular is <em class="italic">biceps</em> and the plural is <em class="italic">bicepses</em>).</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">In <code class="inlineCode">Program.Functions.cs</code>, import the namespace for working with Humanizer <a id="_idIndexMarker497"/>vocabularies, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using Humanizer.Inflections; // To use Vocabularies.
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.Functions.cs</code>, at the top of the <code class="inlineCode">NumberFormatting</code> method, add statements to register two irregular words, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">Vocabularies.Default.AddIrregular("biceps", "bicepses");
Vocabularies.Default.AddIrregular("attorney general", "attorneys general");
</code></pre>
      </li>
      <li class="numberedList">Run the code, view the result, and note that the two irregular words now output correctly.</li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-239">Working with dates and times</h2>
    <p class="normal">Now let’s see <a id="_idIndexMarker498"/>how Humanizer can help us with dates and times:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">In <code class="inlineCode">Program.Functions.cs</code>, define a method to get the current date and time and some number of days, and then output them using various Humanizer extension methods, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">private static void DateTimeFormatting()
{
  DateTimeOffset now = DateTimeOffset.Now;
  // By default, all Humanizer comparisons are to Now (UTC).
  WriteLine($"Now (UTC): {now}");
  WriteLine("Add 3 hours, Humanized: {0}", 
    now.AddHours(3).Humanize());
  WriteLine("Add 3 hours and 1 minute, Humanized: {0}", 
    now.AddHours(3).AddMinutes(1).Humanize());
  WriteLine("Subtract 3 hours, Humanized: {0}", 
    now.AddHours(-3).Humanize());
  WriteLine("Add 24 hours, Humanized: {0}", 
    now.AddHours(24).Humanize());
  WriteLine("Add 25 hours, Humanized: {0}", 
    now.AddHours(25).Humanize());
  WriteLine("Add 7 days, Humanized: {0}", 
    now.AddDays(7).Humanize());
  WriteLine("Add 7 days and 1 minute, Humanized: {0}", 
    now.AddDays(7).AddMinutes(1).Humanize());
  WriteLine("Add 1 month, Humanized: {0}", 
    now.AddMonths(1).Humanize());
  WriteLine();
  // Examples of TimeSpan humanization.
  int[] daysArray = { 12, 13, 14, 15, 16 };
  foreach (int days in daysArray)
  {
    WriteLine("{0} days, Humanized: {1}",
      days, TimeSpan.FromDays(days).Humanize());
    WriteLine("{0} days, Humanized with precision 2: {1}",
      days, TimeSpan.FromDays(days).Humanize(precision: 2));
    WriteLine("{0} days, Humanized with max unit days: {1}",
      days, TimeSpan.FromDays(days).Humanize(
        maxUnit: Humanizer.Localisation.TimeUnit.Day));
    WriteLine();
  }
  // Examples of clock notation.
  TimeOnly[] times = { new TimeOnly(9, 0),
    new TimeOnly(9, 15), new TimeOnly(15, 30) };
  foreach (TimeOnly time in times)
  {
    WriteLine("{0}: {1}", time, time.ToClockNotation());
  }
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, comment out the previous method call and add a call to <code class="inlineCode">DateTimeFormatting</code>, as shown highlighted in the following code:
        <pre class="programlisting code"><code class="hljs-code"><strong class="hljs-comment-slc">//</strong>NumberFormatting();
<strong class="hljs-slc">DateTimeFormatting();</strong>
</code></pre>
      </li>
      <li class="numberedList">Run the <a id="_idIndexMarker499"/>code and view the result, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">Current culture: English (United States)
Now (UTC): 5/30/2023 8:12:51 AM +01:00
Add 3 hours, Humanized: 2 hours from now
Add 3 hours and 1 minute, Humanized: 3 hours from now
Subtract 3 hours, Humanized: 3 hours ago
Add 24 hours, Humanized: 23 hours from now
Add 25 hours, Humanized: tomorrow
Add 7 days, Humanized: 6 days from now
Add 7 days and 1 minute, Humanized: 7 days from now
Add 1 month, Humanized: one month from now
12 days, Humanized: 1 week
12 days, Humanized with precision 2: 1 week, 5 days
12 days, Humanized with max unit days: 12 days
13 days, Humanized: 1 week
13 days, Humanized with precision 2: 1 week, 6 days
13 days, Humanized with max unit days: 13 days
14 days, Humanized: 2 weeks
14 days, Humanized with precision 2: 2 weeks
14 days, Humanized with max unit days: 14 days
15 days, Humanized: 2 weeks
15 days, Humanized with precision 2: 2 weeks, 1 day
15 days, Humanized with max unit days: 15 days
16 days, Humanized: 2 weeks
16 days, Humanized with precision 2: 2 weeks, 2 days
16 days, Humanized with max unit days: 16 days
9:00 AM: nine o'clock
9:15 AM: a quarter past nine
3:30 PM: half past three
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, specify <a id="_idIndexMarker500"/>the French language and region when configuring the console, as shown highlighted in the following code:
        <pre class="programlisting code"><code class="hljs-code">ConfigureConsole(<strong class="hljs-string-slc">"fr-FR"</strong>); // Defaults to en-US culture.
</code></pre>
      </li>
      <li class="numberedList">Run the code, view the result, and note that the text is localized to French.</li>
    </ol>
    <h1 class="heading-1" id="_idParaDest-240">Logging with Serilog</h1>
    <p class="normal">Although .NET includes<a id="_idIndexMarker501"/> logging frameworks, third-party logging providers give more power<a id="_idIndexMarker502"/> and flexibility by using <strong class="keyWord">structured event data</strong>. Serilog is the most popular.</p>
    <h2 class="heading-2" id="_idParaDest-241">Structured event data</h2>
    <p class="normal">Most systems write plain text messages to their logs. </p>
    <p class="normal">Serilog <a id="_idIndexMarker503"/>can be told to write serialized structured data to the log. The <code class="inlineCode">@</code> symbol prefixing a parameter tells Serilog to serialize the object passed in, instead of just the result of calling the <code class="inlineCode">ToString</code> method. </p>
    <p class="normal">Later, that complex object can be queried for improved search and sort capabilities in the logs.</p>
    <p class="normal">For example: </p>
    <pre class="programlisting code"><code class="hljs-code">var lineitem = new { ProductId = 11, UnitPrice = 25.49, Quantity = 3 };
log.Information("Added {@LineItem} to shopping cart.", lineitem);
</code></pre>
    <div><p class="normal">You can learn more about how Serilog handles structured data at the following link: <a href="https://github.com/serilog/serilog/wiki/Structured-Data">https://github.com/serilog/serilog/wiki/Structured-Data</a>.</p>
    </div>
    <h2 class="heading-2" id="_idParaDest-242">Serilog sinks</h2>
    <p class="normal">All logging <a id="_idIndexMarker504"/>systems need to record the log entries somewhere. That could be to the console output, a file, or a more complex data store like a relational database or cloud data store. Serilog calls these <strong class="keyWord">sinks</strong>.</p>
    <p class="normal">Serilog has hundreds of official and third-party sink packages for all the possible places you might want to record your logs. To use them, just include the appropriate package. The most popular are shown in the following list:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">serilog.sinks.file</code></li>
      <li class="bulletList"><code class="inlineCode">serilog.sinks.console</code></li>
      <li class="bulletList"><code class="inlineCode">serilog.sinks.periodicbatching</code></li>
      <li class="bulletList"><code class="inlineCode">serilog.sinks.debug</code></li>
      <li class="bulletList"><code class="inlineCode">serilog.sinks.rollingfile</code> (deprecated; use <code class="inlineCode">serilog.sinks.file</code> instead)</li>
      <li class="bulletList"><code class="inlineCode">serilog.sinks.applicationinsights</code></li>
      <li class="bulletList"><code class="inlineCode">serilog.sinks.mssqlserver</code></li>
    </ul>
    <div><p class="normal">There are more than 470 packages currently listed on Microsoft’s public NuGet feed: <a href="https://www.nuget.org/packages?q=serilog.sinks">https://www.nuget.org/packages?q=serilog.sinks</a>.</p>
    </div>
    <h2 class="heading-2" id="_idParaDest-243">Logging to the console and a rolling file with Serilog</h2>
    <p class="normal">Let’s start:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Use<a id="_idIndexMarker505"/> your<a id="_idIndexMarker506"/> preferred code editor to add a new <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code> project named <code class="inlineCode">Serilogging</code> to a <code class="inlineCode">Chapter06</code> solution.</li>
      <li class="numberedList">In the <code class="inlineCode">Serilogging</code> project, treat warnings as errors, globally and statically import the <code class="inlineCode">System.Console</code> class, and add a package reference for <code class="inlineCode">Serilog</code>, including sinks for <code class="inlineCode">console</code> and <code class="inlineCode">file</code> (which also supports rolling files), as shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;PackageReference Include="Serilog" Version="3.1.1" /&gt;
  &lt;PackageReference Include="Serilog.Sinks.Console" Version="5.0.0" /&gt;
  &lt;PackageReference Include="Serilog.Sinks.File" Version="5.0.0" /&gt;
&lt;/ItemGroup&gt;
</code></pre>
      </li>
      <li class="numberedList">Build the <code class="inlineCode">Serilogging</code> project.</li>
      <li class="numberedList">In the <code class="inlineCode">Serilogging</code> project, add a new folder named <code class="inlineCode">Models</code>.</li>
      <li class="numberedList">In the <code class="inlineCode">Serilogging</code> project, in the <code class="inlineCode">Models</code> folder, add a new class file named <code class="inlineCode">ProductPageView.cs</code>, and modify its contents, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">namespace Serilogging.Models;
public class ProductPageView
{
  public int ProductId { get; set; }
  public string? PageTitle { get; set; }
  public string? SiteSection { get; set; }
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete the existing statements and then import some namespaces for working with Serilog, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using Serilog; // To use Log, LoggerConfiguration, RollingInterval.
using Serilog.Core; // To use Logger.
using Serilogging.Models; // To use ProductPageView.
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, create a logger configuration that will write to the console as well as <a id="_idIndexMarker507"/>configure a rolling interval that means a <a id="_idIndexMarker508"/>new file is created each day, and write various levels of log entries, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">// Create a new logger that will write to the console and to
// a text file, one-file-per-day, named with the date.
using Logger log = new LoggerConfiguration()
    .WriteTo.Console()
    .WriteTo.File("log.txt", rollingInterval: RollingInterval.Day)
    .CreateLogger();
// Assign the new logger to the static entry point for logging.
Log.Logger = log;
Log.Information("The global logger has been configured.");
// Log some example entries of differing severity.
Log.Warning("Danger, Serilog, danger!");
Log.Error("This is an error!");
Log.Fatal("Fatal problem!");
ProductPageView pageView = new() { 
  PageTitle = "Chai", 
  SiteSection = "Beverages", 
  ProductId = 1 };
Log.Information("{@PageView} occurred at {Viewed}",
  pageView, DateTimeOffset.UtcNow);
// For a log with a buffer, like a text file logger, you
// must flush before ending the app.
Log.CloseAndFlush();
</code></pre>
      </li>
      <li class="numberedList">Run <a id="_idIndexMarker509"/>the <a id="_idIndexMarker510"/>console app and note the messages, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">[07:09:43 INF] The global logger has been configured.
[07:09:43 WRN] Danger, Serilog, danger!
[07:09:43 ERR] This is an error!
[07:09:43 FTL] Fatal problem!
[07:09:43 INF] {"ProductId": 1, "PageTitle": "Chai", "SiteSection": "Beverages", "$type": "ProductPageView"} occurred at 09/07/2023 15:08:44 +00:00
</code></pre>
      </li>
      <li class="numberedList">Open the <code class="inlineCode">logYYYYMMDD.txt</code> file, where <code class="inlineCode">YYYY</code> is the year, <code class="inlineCode">MM</code> is the month, and <code class="inlineCode">DD</code> is the day, and note it contains the same messages:<ul>
          <li class="bulletList">For Visual Studio 2022, the log file will be written to the <code class="inlineCode">Serilogging\bin\Debug\net8.0</code> folder.</li>
          <li class="bulletList">For Visual Studio Code and <code class="inlineCode">dotnet run</code>, the log file will be written to the <code class="inlineCode">Serilogging</code> folder.<div><p class="normal"><strong class="keyWord">More Information</strong>: Learn more details at the following link: <a href="https://serilog.net/">https://serilog.net/</a>.</p>
            </div>
          </li>
        </ul>
      </li>
    </ol>
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: Disable logging when it is not needed. Logging can get costly fast. For example, one organization was spending $10,000 per month on cloud resources, much more than predicted, and they didn’t know why. It turned out they were logging every SQL statement executed in production. By “flipping a switch” to stop that logging they saved $8,500 per month! You can read Milan Jovanović’s story at the following link: <a href="https://www.linkedin.com/posts/milan-jovanovic_i-helped-a-team-save-100k-in-azure-cloud-activity-7109887614664474625-YDiU/">https://www.linkedin.com/posts/milan-jovanovic_i-helped-a-team-save-100k-in-azure-cloud-activity-7109887614664474625-YDiU/</a>.</p>
    </div>
    <h1 class="heading-1" id="_idParaDest-244">Mapping between objects</h1>
    <p class="normal">One of the most <a id="_idIndexMarker511"/>boring parts of being a programmer is mapping between objects. It is common to need to integrate systems or components that have conceptually similar objects but with different structures. </p>
    <p class="normal">Models for data are different for different parts of an application. Models that represent data in storage are often <a id="_idIndexMarker512"/>called <strong class="keyWord">entity models</strong>. Models that represent data that must be passed between layers are often called <strong class="keyWord">data transfer objects </strong>(<strong class="keyWord">DTOs</strong>). Models<a id="_idIndexMarker513"/> that represent only the data that must be presented to a user are often <a id="_idIndexMarker514"/>called <strong class="keyWord">view models</strong>. All these models are likely to have commonalities but different structures.</p>
    <p class="normal"><strong class="keyWord">AutoMapper</strong> is a<a id="_idIndexMarker515"/> popular package for mapping objects because it has conventions that make the work as easy as possible. For example, if you have a source member called <code class="inlineCode">CompanyName</code>, it will be mapped to a destination member with the name <code class="inlineCode">CompanyName</code>.</p>
    <div><p class="normal">AutoMapper’s creator, Jimmy Bogard, has written an article about its design philosophy that is worth reading, available at the following link: <a href="https://jimmybogard.com/automappers-design-philosophy/">https://jimmybogard.com/automappers-design-philosophy/</a>.</p>
    </div>
    <p class="normal">Let’s see an <a id="_idIndexMarker516"/>example of AutoMapper in action. You will create four projects:</p>
    <ul>
      <li class="bulletList">A class library for the entity and view models.</li>
      <li class="bulletList">A class library to create mapper configurations for reuse in unit tests and actual projects.</li>
      <li class="bulletList">A unit test project to test the mappings.</li>
      <li class="bulletList">A console app to perform a live mapping.</li>
    </ul>
    <p class="normal">We will construct an example object model that represents an e-commerce website customer and their shopping cart with a couple of items, and then map it to a summary view model to present to the user.</p>
    <h2 class="heading-2" id="_idParaDest-245">Defining models for an AutoMapper configuration</h2>
    <p class="normal">To test the<a id="_idIndexMarker517"/> mapping, we will define some <code class="inlineCode">record</code> types. As a reminder, a <code class="inlineCode">record</code> (or <code class="inlineCode">record class</code>) is a reference type that has value-based equality. A <code class="inlineCode">class</code> is a reference type that has memory address-based equality (except for <code class="inlineCode">string</code>, which overrides this behavior).</p>
    <p class="normal">It is good practice to always validate your configuration for mappings before using them, so we will start by defining some models and a mapping between them, and then create a unit test for the mappings:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Class Library</strong> / <code class="inlineCode">classlib</code> project named <code class="inlineCode">MappingObjects.Models</code> to the <code class="inlineCode">Chapter06</code> solution.</li>
      <li class="numberedList">In the <code class="inlineCode">MappingObjects.Models</code> project, delete the file named <code class="inlineCode">Class1.cs</code>.</li>
      <li class="numberedList">In the <code class="inlineCode">MappingObjects.Models</code> project, add a new class file named <code class="inlineCode">Customer.cs</code> and modify its contents to define an immutable record type named <code class="inlineCode">Customer</code> by using constructor syntax, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">namespace Northwind.EntityModels;
// This record will only have a constructor with the parameters below.
// Objects will be immutable after instantiation using this constructor.
// It will not have a default parameterless constructor.
public record class Customer(
  string FirstName,
  string LastName
);
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">MappingObjects.Models</code> project, add a new class file named <code class="inlineCode">LineItem.cs</code> and modify its contents, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">namespace Northwind.EntityModels;
public record class LineItem(
  string ProductName,
  decimal UnitPrice,
  int Quantity
);
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">MappingObjects.Models</code> project, add a new class file named <code class="inlineCode">Cart.cs</code> and modify its contents, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">namespace Northwind.EntityModels;
public record class Cart(
  Customer Customer,
  List&lt;LineItem&gt; Items
);
</code></pre>
      </li>
      <li class="numberedList">In<a id="_idIndexMarker518"/> the <code class="inlineCode">MappingObjects.Models</code> project, add a new class file named <code class="inlineCode">Summary.cs</code> in the <code class="inlineCode">Northwind.ViewModels</code> namespace (not <code class="inlineCode">Northwind.EntityModels</code>), delete any existing statements, and then define a record type that can have its properties set <em class="italic">after</em> instantiating with a default parameterless constructor, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">namespace Northwind.ViewModels;
public record class Summary
{
  // These properties can be initialized once but then never changed.
  public string? FullName { get; init; }
  public decimal Total { get; init; }
  // This record class will have a default parameterless constructor.
  // The following commented statement is automatically generated:
  // public Summary() { }
}
</code></pre>
      </li>
    </ol>
    <div><p class="normal">For the entity models, we used <code class="inlineCode">record class</code> types defined using the constructor syntax to make them immutable. But an instance of <code class="inlineCode">Summary</code> will need to be created using a default parameterless constructor and then its members set by AutoMapper. Therefore, it must be a <code class="inlineCode">record class</code> with public properties that can be set during initialization but not after that. To do this, we use the <code class="inlineCode">init</code> keyword.</p>
    </div>
    <h2 class="heading-2" id="_idParaDest-246">Defining mappers for an AutoMapper configuration</h2>
    <p class="normal">Now we can<a id="_idIndexMarker519"/> define the mappings between models:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Class Library</strong> / <code class="inlineCode">classlib</code> project named <code class="inlineCode">MappingObjects.Mappers</code> to the <code class="inlineCode">Chapter06</code> solution.</li>
      <li class="numberedList">In the <code class="inlineCode">MappingObjects.Mappers</code> project, treat warnings as errors, add a reference to the latest <code class="inlineCode">AutoMapper</code> package, and add a reference to the <code class="inlineCode">Models</code> project, as shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;PackageReference Include="AutoMapper" Version="12.0.1" /&gt;
&lt;/ItemGroup&gt;
&lt;ItemGroup&gt;
  &lt;ProjectReference Include=
    "..\MappingObjects.Models\MappingObjects.Models.csproj" /&gt;
&lt;/ItemGroup&gt;
</code></pre>
      </li>
      <li class="numberedList">Build the <code class="inlineCode">MappingObjects.Mappers</code> project to restore packages and compile referenced projects.</li>
      <li class="numberedList">In the <code class="inlineCode">MappingObjects.Mappers</code> project, delete the file named <code class="inlineCode">Class1.cs</code>.</li>
      <li class="numberedList">In the <code class="inlineCode">MappingObjects.Mappers</code> project, add a new class file named <code class="inlineCode">CartToSummaryMapper.cs</code> and modify its contents to create a mapper configuration that maps the <code class="inlineCode">FullName</code> of the <code class="inlineCode">Summary</code> to a combination of the <code class="inlineCode">FirstName</code> and <code class="inlineCode">LastName</code> from <code class="inlineCode">Customer</code>, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using AutoMapper; // To use MapperConfiguration.
using AutoMapper.Internal; // To use the Internal() extension method.
using Northwind.EntityModels; // To use Cart.
using Northwind.ViewModels; // To use Summary.
namespace MappingObjects.Mappers;
public static class CartToSummaryMapper
{
  public static MapperConfiguration GetMapperConfiguration()
  {
    MapperConfiguration config = new(cfg =&gt;
    {
      // To fix an issue with the MaxInteger method:
      // https://github.com/AutoMapper/AutoMapper/issues/3988
      cfg.Internal().MethodMappingEnabled = false;
      // Configure the mapper using projections.
      cfg.CreateMap&lt;Cart, Summary&gt;()
        // Map the first and last names formatted to the full name.
       .ForMember(dest =&gt; dest.FullName, opt =&gt; opt.MapFrom(src =&gt;
          string.Format("{0} {1}", 
            src.Customer.FirstName,
            src.Customer.LastName)
        ));
    });
    return config;
  }
}
</code></pre>
      </li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-247">Performing tests for an AutoMapper configuration</h2>
    <p class="normal">Now we can<a id="_idIndexMarker520"/> define unit tests for the mapper:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">xUnit Test Project</strong> / <code class="inlineCode">xunit</code> named <code class="inlineCode">MappingObjects.Tests</code> to the <code class="inlineCode">Chapter06</code> solution.</li>
      <li class="numberedList">In the <code class="inlineCode">MappingObjects.Tests</code> project file, add a package reference to <code class="inlineCode">AutoMapper</code>, as shown highlighted in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;ItemGroup&gt;
<strong class="hljs-slc">  &lt;PackageReference Include=</strong><strong class="hljs-string-slc">"AutoMapper"</strong><strong class="hljs-slc"> Version=</strong><strong class="hljs-string-slc">"12.0.1"</strong><strong class="hljs-slc"> /&gt;</strong>
  &lt;PackageReference Include="Microsoft.NET.Test.Sdk" Version="17.8.0" /&gt;
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">MappingObjects.Tests</code> project file, add project references to <code class="inlineCode">MappingObjects.Models</code> and <code class="inlineCode">MappingObjects.Mappers</code>, as shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;ProjectReference Include=
    "..\MappingObjects.Mappers\MappingObjects.Mappers.csproj" /&gt;
  &lt;ProjectReference Include=
    "..\MappingObjects.Models\MappingObjects.Models.csproj" /&gt;
&lt;/ItemGroup&gt;
</code></pre>
      </li>
      <li class="numberedList">Build the <code class="inlineCode">MappingObjects.Tests</code> project to restore packages and build referenced projects.</li>
      <li class="numberedList">In the <code class="inlineCode">MappingObjects.Tests</code> project, rename <code class="inlineCode">UnitTest1.cs</code> to <code class="inlineCode">TestAutoMapperConfig.cs</code>.</li>
      <li class="numberedList">Modify <a id="_idIndexMarker521"/>the contents of <code class="inlineCode">TestAutoMapperConfig.cs</code> to get the mapper and then assert that the mapping is complete, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using AutoMapper; // To use MapperConfiguration.
using MappingObjects.Mappers; // To use CartToSummaryMapper.
namespace MappingObjects.Tests;
public class TestAutoMapperConfig
{  
  [Fact]
  public void TestSummaryMapping()
  {
    MapperConfiguration config = CartToSummaryMapper.GetMapperConfiguration();
    config.AssertConfigurationIsValid();
  }
}
</code></pre>
      </li>
      <li class="numberedList">Run the test:<ul>
          <li class="bulletList">In Visual Studio 2022, navigate to <strong class="screenText">Test</strong> | <strong class="screenText">Run All Tests</strong>.</li>
          <li class="bulletList">In Visual Studio Code, in <strong class="screenText">Terminal</strong>, enter <code class="inlineCode">dotnet test</code>.</li>
        </ul>
      </li>
      <li class="numberedList">Note the test fails because the <code class="inlineCode">Total</code> member of the <code class="inlineCode">Summary</code> view model is unmapped, as shown in <em class="italic">Figure 6.3</em>:</li>
    </ol>
    <figure class="mediaobject"><img alt="" src="img/B19587_06_03.png"/></figure>
    <p class="packt_figref">Figure 6.3: The test fails because the Total member is unmapped</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="9">In<a id="_idIndexMarker522"/> the <code class="inlineCode">MappingObjects.Mappers</code> project, in the mapper configuration, after the mapping for the <code class="inlineCode">FullName</code> member, add a mapping for the <code class="inlineCode">Total</code> member, as shown highlighted in the following code:
        <pre class="programlisting code"><code class="hljs-code">cfg.CreateMap&lt;Cart, Summary&gt;()
  // Map the first and last names formatted to the full name.
  .ForMember(dest =&gt; dest.FullName, opt =&gt; opt.MapFrom(src =&gt;
    string.Format("{0} {1}", 
      src.Customer.FirstName, src.Customer.LastName)
  )) <strong class="hljs-comment-slc">// We have removed a semi-colon from here.</strong>
<strong class="hljs-slc">  </strong><strong class="hljs-comment-slc">// Map the sum of items to the Total member.</strong>
<strong class="hljs-slc">  .ForMember(dest =&gt; dest.Total, opt =&gt; opt.MapFrom(</strong>
<strong class="hljs-slc">    src =&gt; src.Items.Sum(item =&gt; item.UnitPrice * item.Quantity)));</strong>
});
</code></pre>
      </li>
      <li class="numberedList">Run the test and note that, this time, it passes.</li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-248">Performing live mappings between models</h2>
    <p class="normal">Now that <a id="_idIndexMarker523"/>we have validated the configuration of our mapping, we can use it in a live console app:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code> project named <code class="inlineCode">MappingObjects.Console</code> to the <code class="inlineCode">Chapter06</code> solution.</li>
      <li class="numberedList">In the <code class="inlineCode">MappingObjects.Console</code> project, treat warnings as errors, globally and statically import the <code class="inlineCode">System.Console</code> class, add a project reference for the two class libraries, and add a package reference for <code class="inlineCode">AutoMapper</code>, as shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;ProjectReference Include=
    "..\MappingObjects.Mappers\MappingObjects.Mappers.csproj" /&gt;
  &lt;ProjectReference Include=
    "..\MappingObjects.Models\MappingObjects.Models.csproj" /&gt;
&lt;/ItemGroup&gt;
&lt;ItemGroup&gt;
  &lt;PackageReference Include="AutoMapper" Version="12.0.1" /&gt;
&lt;/ItemGroup&gt;
</code></pre>
      </li>
      <li class="numberedList">Build the <code class="inlineCode">MappingObjects.Console</code> project.</li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete the existing statements, add some statements to construct an example object model that represents a customer and their shopping cart with a couple of items, and then map it to a summary view model to present to the user, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using AutoMapper; // To use MapperConfiguration, IMapper.
using MappingObjects.Mappers; // To use CartToSummaryMapper.
using Northwind.EntityModels; // To use Customer, Cart, LineItem.
using Northwind.ViewModels; // To use Summary.
using System.Text; // To use Encoding.
// Set the console's output encoding to UTF-8 to support
// Unicode characters like the Euro currency symbol.
OutputEncoding = Encoding.UTF8;
// Create an object model from "entity" model types that
// might have come from a data store like SQL Server.
Cart cart = new(
  Customer: new(
    FirstName: "John",
    LastName: "Smith"
  ), 
  Items: new()
  {
    new(ProductName: "Apples", UnitPrice: 0.49M, Quantity: 10),
    new(ProductName: "Bananas", UnitPrice: 0.99M, Quantity: 4)
  }
);
WriteLine("*** Original data before mapping.");
WriteLine($"{cart.Customer}");
foreach (LineItem item in cart.Items)
{
  WriteLine($"  {item}");
}
// Get the mapper configuration for converting a Cart to a Summary.
MapperConfiguration config = CartToSummaryMapper.GetMapperConfiguration();
// Create a mapper using the configuration.
IMapper mapper = config.CreateMapper();
// Perform the mapping.
Summary summary = mapper.Map&lt;Cart, Summary&gt;(cart);
// Output the result.
WriteLine();
WriteLine("*** After mapping.");
WriteLine($"Summary: {summary.FullName} spent {summary.Total:C}.");
</code></pre>
      </li>
      <li class="numberedList">Run the console app and note the successful result, as shown in the following code:
        <pre class="programlisting con"><code class="hljs-con">*** Original data before mapping.
Customer { FirstName = John, LastName = Smith }
  LineItem { ProductName = Apples, UnitPrice = 0.49, Quantity = 10 }
  LineItem { ProductName = Bananas, UnitPrice = 0.99, Quantity = 4 }
*** After mapping.
Summary: John Smith spent £8.86.
</code></pre>
      </li>
      <li class="numberedList">Optionally, write <a id="_idIndexMarker524"/>a unit test to perform a similar check as the preceding code to assert that the <code class="inlineCode">Summary</code> has the correct full name and total.</li>
    </ol>
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: There is a debate about when AutoMapper should be used that you can read about in an article (which has more links at the bottom) at the following link: <a href="https://www.anthonysteele.co.uk/AgainstAutoMapper.html">https://www.anthonysteele.co.uk/AgainstAutoMapper.html</a>.</p>
    </div>
    <div><p class="normal"><strong class="keyWord">More Information</strong>: Learn more details at the following link: <a href="https://automapper.org/">https://automapper.org/</a>.</p>
    </div>
    <h1 class="heading-1" id="_idParaDest-249">Making fluent assertions in unit testing</h1>
    <p class="normal"><strong class="keyWord">FluentAssertions</strong> are <a id="_idIndexMarker525"/>a set of extension methods that make writing and reading the code in unit tests and the error messages of failing tests more similar to a natural human language like English.</p>
    <p class="normal">It works <a id="_idIndexMarker526"/>with most unit testing frameworks, including xUnit. When you add a package reference for a test framework, FluentAssertions will automatically find the package and use it for throwing exceptions.</p>
    <p class="normal">After importing the <code class="inlineCode">FluentAssertions</code> namespace, call the <code class="inlineCode">Should()</code> extension method on a variable and then one of the hundreds of other extension methods to make assertions in a human-readable way. You can chain multiple assertions using the <code class="inlineCode">And()</code> extension method or have separate statements, each calling <code class="inlineCode">Should()</code>.</p>
    <h2 class="heading-2" id="_idParaDest-250">Making assertions about strings</h2>
    <p class="normal">Let’s start by <a id="_idIndexMarker527"/>making assertions about a single <code class="inlineCode">string</code> value:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">xUnit Test Project</strong> / <code class="inlineCode">xunit</code> named <code class="inlineCode">FluentTests</code> to a <code class="inlineCode">Chapter06</code> solution.</li>
      <li class="numberedList">In the <code class="inlineCode">FluentTests</code> project, add a package reference to <code class="inlineCode">FluentAssertions</code>, as highlighted in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;ItemGroup&gt;
<strong class="hljs-slc">  &lt;PackageReference Include=</strong><strong class="hljs-string-slc">"FluentAssertions"</strong><strong class="hljs-slc"> Version=</strong><strong class="hljs-string-slc">"6.12.0"</strong><strong class="hljs-slc"> /&gt;</strong>
  &lt;PackageReference Include="Microsoft.NET.Test.Sdk" Version="17.8.0" /&gt;
</code></pre>
      
    <div><p class="normal"><code class="inlineCode">FluentAssertions</code> <code class="inlineCode">7.0</code> should be available by the time this book is published. You can check at the following link: <a href="https://www.nuget.org/packages/FluentAssertions/">https://www.nuget.org/packages/FluentAssertions/</a>.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">Build the <code class="inlineCode">FluentTests</code> project.</li>
      <li class="numberedList">Rename <code class="inlineCode">UnitTest1.cs</code> to <code class="inlineCode">FluentExamples.cs</code>.</li>
      <li class="numberedList">In <code class="inlineCode">FluentExamples.cs</code>, import the namespace to make the <code class="inlineCode">FluentAssertions</code> extension methods available and write a test method for a <code class="inlineCode">string</code> value, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using FluentAssertions; // To use common fluent assertions extension methods.
namespace FluentTests;
public class FluentExamples
{
  [Fact]
  public void TestString()
  {
    string city = "London";
    string expectedCity = "London";
    city.Should().StartWith("Lo")
      .And.EndWith("on")
      .And.Contain("do")
      .And.HaveLength(6);
     city.Should().NotBeNull()
      .And.Be("London")
      .And.BeSameAs(expectedCity)
      .And.BeOfType&lt;string&gt;();
    city.Length.Should().Be(6);
  }
}
</code></pre>
      </li>
      <li class="numberedList">Run the test:<ul>
          <li class="bulletList">In Visual Studio 2022, navigate to <strong class="screenText">Test</strong> | <strong class="screenText">Run All Tests</strong>.</li>
          <li class="bulletList">In Visual Studio Code, in <strong class="screenText">Terminal</strong>, enter <code class="inlineCode">dotnet test</code>.</li>
        </ul>
      </li>
      <li class="numberedList">Note <a id="_idIndexMarker528"/>the test passes.</li>
      <li class="numberedList">In the <code class="inlineCode">TestString</code> method, for the <code class="inlineCode">city</code> variable, delete the last <code class="inlineCode">n</code> in <code class="inlineCode">London</code>.</li>
      <li class="numberedList">Run the test and note it fails, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">Expected city "Londo" to end with "on".
</code></pre>
      </li>
      <li class="numberedList">Add the <code class="inlineCode">n</code> back in <code class="inlineCode">London</code>.</li>
      <li class="numberedList">Run the test again to confirm the fix.</li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-251">Making assertions about collections and arrays</h2>
    <p class="normal">Now let’s<a id="_idIndexMarker529"/> continue by making assertions about collections and arrays:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">In <code class="inlineCode">FluentExamples.cs</code>, add a test method to explore collection assertions, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">[Fact]
public void TestCollections()
{
  string[] names = { "Alice", "Bob", "Charlie" };
  names.Should().HaveCountLessThan(4,
    "because the maximum items should be 3 or fewer");
  names.Should().OnlyContain(name =&gt; name.Length &lt;= 6);
}
</code></pre>
      </li>
      <li class="numberedList">Run the tests and note the collections test fails, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">Expected names to contain only items matching (name.Length &lt;= 6), but {"Charlie"} do(es) not match.
</code></pre>
      </li>
      <li class="numberedList">Change <code class="inlineCode">Charlie</code> to <code class="inlineCode">Charly</code>.</li>
      <li class="numberedList">Run <a id="_idIndexMarker530"/>the tests and note they succeed.</li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-252">Making assertions about dates and times</h2>
    <p class="normal">Let’s start by<a id="_idIndexMarker531"/> making assertions about date and time values:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">In <code class="inlineCode">FluentExamples.cs</code>, import the namespace for adding more extension methods for named months and other useful date/time-related functionality, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using FluentAssertions.Extensions; // To use February, March extension methods.
</code></pre>
      </li>
      <li class="numberedList">Add a test method to explore date/time assertions, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">[Fact]
public void TestDateTimes()
{
  DateTime when = new(
    hour: 9, minute: 30, second: 0,
    day: 25, month: 3, year: 2024);
  when.Should().Be(25.March(2024).At(9, 30));
  when.Should().BeOnOrAfter(23.March(2024));
  when.Should().NotBeSameDateAs(12.February(2024));
  when.Should().HaveYear(2024);
  DateTime due = new(
    hour: 11, minute: 0, second: 0,
    day: 25, month: 3, year: 2024);
  when.Should().BeAtLeast(2.Hours()).Before(due);
}
</code></pre>
      </li>
      <li class="numberedList">Run the <a id="_idIndexMarker532"/>tests and note the date/time test fails, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">Expected when &lt;2024-03-25 09:30:00&gt; to be at least 2h before &lt;2024-03-25 11:00:00&gt;, but it is behind by 1h and 30m.
</code></pre>
      </li>
      <li class="numberedList">For the <code class="inlineCode">due</code> variable, change the hour from <code class="inlineCode">11</code> to <code class="inlineCode">13</code>.</li>
      <li class="numberedList">Run the tests and note that the date/time test succeeds.</li>
    </ol>
    <div><p class="normal"><strong class="keyWord">More Information</strong>: You can<a id="_idIndexMarker533"/> learn more details about FluentAssertions at the following link: <a href="https://fluentassertions.com/">https://fluentassertions.com/</a>.</p>
    </div>
    <h1 class="heading-1" id="_idParaDest-253">Validating data</h1>
    <p class="normal"><strong class="keyWord">FluentValidation</strong> allows <a id="_idIndexMarker534"/>you to define strongly typed validation rules in a human-readable way.</p>
    <p class="normal">You create a <a id="_idIndexMarker535"/>validator for a type by inheriting from <code class="inlineCode">AbstractValidator&lt;T&gt;</code>, where <code class="inlineCode">T</code> is the type that you want to validate. In the constructor, you call the <code class="inlineCode">RuleFor</code> method to define one or more rules. If a rule should run only in specified scenarios, then you call the <code class="inlineCode">When</code> method.</p>
    <h2 class="heading-2" id="_idParaDest-254">Understanding the built-in validators</h2>
    <p class="normal">FluentValidation ships<a id="_idIndexMarker536"/> with lots of useful built-in validator extension methods for defining rules, as shown in the following partial list, some of which you will explore in the coding task in this section:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">Null</code>, <code class="inlineCode">NotNull</code>, <code class="inlineCode">Empty</code>, <code class="inlineCode">NotEmpty</code></li>
      <li class="bulletList"><code class="inlineCode">Equal</code>, <code class="inlineCode">NotEqual</code></li>
      <li class="bulletList"><code class="inlineCode">Length</code>, <code class="inlineCode">MaxLength</code>, <code class="inlineCode">MinLength</code></li>
      <li class="bulletList"><code class="inlineCode">LessThan</code>, <code class="inlineCode">LessThanOrEqualTo</code>, <code class="inlineCode">GreaterThan</code>, <code class="inlineCode">GreaterThanOrEqualTo</code></li>
      <li class="bulletList"><code class="inlineCode">InclusiveBetween</code>, <code class="inlineCode">ExclusiveBetween</code></li>
      <li class="bulletList"><code class="inlineCode">ScalePrecision</code></li>
      <li class="bulletList"><code class="inlineCode">Must</code> (aka predicate)</li>
      <li class="bulletList"><code class="inlineCode">Matches</code> (aka regular expression), <code class="inlineCode">EmailAddress</code>, <code class="inlineCode">CreditCard</code></li>
      <li class="bulletList"><code class="inlineCode">IsInEnum</code>, <code class="inlineCode">IsEnumName</code></li>
    </ul>
    <h2 class="heading-2" id="_idParaDest-255">Performing custom validation</h2>
    <p class="normal">The<a id="_idIndexMarker537"/> easiest way to create custom rules is to use <code class="inlineCode">Predicate</code> to write a custom validation function. You can also call the <code class="inlineCode">Custom</code> method to get maximum control.</p>
    <h2 class="heading-2" id="_idParaDest-256">Customizing validation messages</h2>
    <p class="normal">There<a id="_idIndexMarker538"/> are a few extension methods that are used to customize the validation messages’ output when data fails to pass the rules:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">WithName</code>: Change the name used for a property in the message.</li>
      <li class="bulletList"><code class="inlineCode">WithSeverity</code>: Change the default severity from <code class="inlineCode">Error</code> to <code class="inlineCode">Warning</code> or some other level.</li>
      <li class="bulletList"><code class="inlineCode">WithErrorCode</code>: Assign an error code that can be output in the message.</li>
      <li class="bulletList"><code class="inlineCode">WithState</code>: Add some state that can be used in the message.</li>
      <li class="bulletList"><code class="inlineCode">WithMessage</code>: Customize the format of the default message.</li>
    </ul>
    <h2 class="heading-2" id="_idParaDest-257">Defining a model and validator</h2>
    <p class="normal">Let’s see an<a id="_idIndexMarker539"/> example of FluentValidation in action. You<a id="_idIndexMarker540"/> will create three projects:</p>
    <ul>
      <li class="bulletList">A class library for a model to validate that represents an order made by a customer.</li>
      <li class="bulletList">A class library for the validator for the model.</li>
      <li class="bulletList">A console app to perform a live validation.</li>
    </ul>
    <p class="normal">Let’s start:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Class Library</strong> / <code class="inlineCode">classlib</code> project named <code class="inlineCode">FluentValidation.Models</code> to the <code class="inlineCode">Chapter06</code> solution.</li>
      <li class="numberedList">In the <code class="inlineCode">FluentValidation.Models</code> project, delete the file named <code class="inlineCode">Class1.cs</code>.</li>
      <li class="numberedList">In the <code class="inlineCode">FluentValidation.Models</code> project, add a new class file named <code class="inlineCode">CustomerLevel.cs</code> and modify its contents to define an <code class="inlineCode">enum</code> with three customer levels, <code class="inlineCode">Bronze</code>, <code class="inlineCode">Silver</code>, and <code class="inlineCode">Gold</code>, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">namespace FluentValidation.Models;
public enum CustomerLevel
{
  Bronze,
  Silver,
  Gold
}
</code></pre>
      </li>
      <li class="numberedList">In<a id="_idIndexMarker541"/> the <code class="inlineCode">FluentValidation.Models</code> project, add<a id="_idIndexMarker542"/> a new class file named <code class="inlineCode">Order.cs</code> and modify its contents, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">namespace FluentValidation.Models;
public class Order
{
  public long OrderId { get; set; }
  public string? CustomerName { get; set; }
  public string? CustomerEmail { get; set; } 
  public CustomerLevel CustomerLevel { get; set; }
  public decimal Total { get; set; }
  public DateTime OrderDate { get; set; }
  public DateTime ShipDate { get; set; }
}
</code></pre>
      </li>
      <li class="numberedList">Use your preferred code editor to add a new <strong class="screenText">Class Library</strong> / <code class="inlineCode">classlib</code> project named <code class="inlineCode">FluentValidation.Validators</code> to the <code class="inlineCode">Chapter06</code> solution.</li>
      <li class="numberedList">In the <code class="inlineCode">FluentValidation.Validators</code> project, add a project reference to the <code class="inlineCode">Models</code> project and a package reference to the <code class="inlineCode">FluentValidation</code> package, as shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;PackageReference Include="FluentValidation" Version="11.8.1" /&gt;
&lt;/ItemGroup&gt;
&lt;ItemGroup&gt;
  &lt;ProjectReference Include=
    "..\FluentValidation.Models\FluentValidation.Models.csproj" /&gt;
&lt;/ItemGroup&gt;
</code></pre>
      </li>
      <li class="numberedList">Build the <code class="inlineCode">FluentValidation.Validators</code> project.</li>
      <li class="numberedList">In the <code class="inlineCode">FluentValidation.Validators</code> project, delete the file named <code class="inlineCode">Class1.cs</code>.</li>
      <li class="numberedList">In the <code class="inlineCode">FluentValidation.Validators</code> project, add a new class file named <code class="inlineCode">OrderValidator.cs</code> and <a id="_idIndexMarker543"/>modify its contents, as<a id="_idIndexMarker544"/> shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using FluentValidation.Models;
namespace FluentValidation.Validators;
public class OrderValidator : AbstractValidator&lt;Order&gt;
{
  public OrderValidator()
  {
    RuleFor(order =&gt; order.OrderId)
      .NotEmpty(); // Not default(long) which is 0.
    RuleFor(order =&gt; order.CustomerName)
      .NotNull()
      .WithName("Name"); // Use Name instead of CustomerName in messages.
    RuleFor(order =&gt; order.CustomerName)
      .MinimumLength(5)
      .WithSeverity(Severity.Warning);
    RuleFor(order =&gt; order.CustomerEmail)
      .NotEmpty()
      .EmailAddress();
    RuleFor(order =&gt; order.CustomerLevel)
      .IsInEnum();
    RuleFor(order =&gt; order.Total)
      .GreaterThan(0);
    RuleFor(order =&gt; order.ShipDate)
      .GreaterThan(order =&gt; order.OrderDate);
    When(order =&gt; order.CustomerLevel == CustomerLevel.Gold, () =&gt;
    {
      RuleFor(order =&gt; order.Total).LessThan(50M);
      RuleFor(order =&gt; order.Total).GreaterThanOrEqualTo(20M);
    }).Otherwise(() =&gt;
    {
      RuleFor(order =&gt; order.Total).LessThan(20M);
    });
  }
}
</code></pre>
      </li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-258">Testing the validator</h2>
    <p class="normal">Now we are<a id="_idIndexMarker545"/> ready to create a console app to test the validator on the model:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code> project named <code class="inlineCode">FluentValidation.Console</code> to a <code class="inlineCode">Chapter06</code> solution.</li>
      <li class="numberedList">In the <code class="inlineCode">FluentValidation.Console</code> project, treat warnings as errors, globally and statically import the <code class="inlineCode">System.Console</code> class, and add project references for <code class="inlineCode">FluentValidation.Validators</code> and <code class="inlineCode">FluentValidation.Models</code>, as shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;ProjectReference Include=
    "..\FluentValidation.Models\FluentValidation.Models.csproj" /&gt;
  &lt;ProjectReference Include=
    "..\FluentValidation.Validators\FluentValidation.Validators.csproj" /&gt;
&lt;/ItemGroup&gt;
</code></pre>
      </li>
      <li class="numberedList">Build the <code class="inlineCode">FluentValidation.Console</code> project to build referenced projects.</li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete the existing statements, and then add statements to create an order and<a id="_idIndexMarker546"/> validate it, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using FluentValidation.Models; // To use Order.
using FluentValidation.Results; // To use ValidationResult.
using FluentValidation.Validators; // To use OrderValidator.
using System.Globalization; // To use CultureInfo.
using System.Text; // To use Encoding.
OutputEncoding = Encoding.UTF8; // Enable Euro symbol.
// Control the culture used for formatting of dates and currency,
// and for localizing error messages to local language.
Thread t = Thread.CurrentThread;
t.CurrentCulture = CultureInfo.GetCultureInfo("en-US");
t.CurrentUICulture = t.CurrentCulture;
WriteLine($"Current culture: {t.CurrentCulture.DisplayName}");
WriteLine();
Order order = new()
{
  // Start with a deliberately invalid order.
};
OrderValidator validator = new();
ValidationResult result = validator.Validate(order);
// Output the order data.
WriteLine($"CustomerName:  {order.CustomerName}");
WriteLine($"CustomerEmail: {order.CustomerEmail}");
WriteLine($"CustomerLevel: {order.CustomerLevel}");
WriteLine($"OrderId:       {order.OrderId}");
WriteLine($"OrderDate:     {order.OrderDate}");
WriteLine($"ShipDate:      {order.ShipDate}");
WriteLine($"Total:         {order.Total:C}");
WriteLine();
// Output if the order is valid and any rules that were broken.
WriteLine($"IsValid:  {result.IsValid}");
foreach (var item in result.Errors)
{
  WriteLine($"  {item.Severity}: {item.ErrorMessage}");
}
</code></pre>
      </li>
      <li class="numberedList">Run the<a id="_idIndexMarker547"/> console app and note the failed rules, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">Current culture: English (United States)
CustomerName:
CustomerEmail:
CustomerLevel: Bronze
OrderId:       0
OrderDate:     01/01/0001 12:00:00 AM
ShipDate:      01/01/0001 12:00:00 AM
Total:         $0.00
IsValid:  False
  Error: 'Order Id' must not be empty.
  Error: 'Name' must not be empty.
  Error: 'Customer Email' must not be empty.
  Error: 'Total' must be greater than '0'.
  Error: 'Ship Date' must be greater than '01/01/0001 12:00:00 AM'.
</code></pre>
      </li>
      <li class="numberedList">Comment out the two statements that set the culture to see the output in your local language and region. For example, if you are in France (<code class="inlineCode">fr-FR</code>), it would look like the following:
        <pre class="programlisting con"><code class="hljs-con">Current culture: français (France)
CustomerName:
CustomerEmail:
CustomerLevel: Bronze
OrderId:       0
OrderDate:     01/01/0001 00:00:00
ShipDate:      01/01/0001 00:00:00
Total:         0,00 €
IsValid:  False
  Error: 'Order Id' ne doit pas être vide.
  Error: 'Name' ne doit pas avoir la valeur null.
  Error: 'Customer Email' ne doit pas être vide.
  Error: 'Total' doit être plus grand que '0'.
  Error: 'Ship Date' doit être plus grand que '01/01/0001 00:00:00'.
</code></pre>
      </li>
      <li class="numberedList">Set some property values for the order, as shown highlighted in the following code:
        <pre class="programlisting code"><code class="hljs-code">Order order = new()
{
<strong class="hljs-slc">  OrderId = </strong><strong class="hljs-number-slc">10001</strong><strong class="hljs-slc">,</strong>
<strong class="hljs-slc">  CustomerName = </strong><strong class="hljs-string-slc">"Abc"</strong><strong class="hljs-slc">,</strong>
<strong class="hljs-slc">  CustomerEmail = </strong><strong class="hljs-string-slc">"abc&amp;example.com"</strong><strong class="hljs-slc">,</strong>
<strong class="hljs-slc">  CustomerLevel = (CustomerLevel)</strong><strong class="hljs-number-slc">4</strong><strong class="hljs-slc">,</strong>
<strong class="hljs-slc">  OrderDate = </strong><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc">(</strong><strong class="hljs-number-slc">2022</strong><strong class="hljs-slc">, month: </strong><strong class="hljs-number-slc">12</strong><strong class="hljs-slc">, day: </strong><strong class="hljs-number-slc">1</strong><strong class="hljs-slc">),</strong>
<strong class="hljs-slc">  ShipDate = </strong><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc">(</strong><strong class="hljs-number-slc">2022</strong><strong class="hljs-slc">, month: </strong><strong class="hljs-number-slc">11</strong><strong class="hljs-slc">, day: </strong><strong class="hljs-number-slc">5</strong><strong class="hljs-slc">),</strong>
<strong class="hljs-slc">  Total = </strong><strong class="hljs-number-slc">49.99</strong><strong class="hljs-slc">M</strong>
};
</code></pre>
      </li>
      <li class="numberedList">Set the current <a id="_idIndexMarker548"/>culture to US English to make sure you see the same output as in this book. You can experiment with your own culture later.</li>
      <li class="numberedList">Run the console app and note the failed rules, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">Current culture: English (United States)
CustomerName:  Abc
CustomerEmail: abc&amp;example.com
CustomerLevel: 4
OrderId:       10001
OrderDate:     12/1/2022 12:00:00 AM
ShipDate:      11/5/2022 12:00:00 AM
Total:         $49.99
IsValid:  False
  Warning: The length of 'Customer Name' must be at least 5 characters. You entered 3 characters.
  Error: 'Customer Email' is not a valid email address.
  Error: 'Customer Level' has a range of values which does not include '4'.
  Error: 'Ship Date' must be greater than '12/1/2022 12:00:00 AM'.
  Error: 'Total' must be less than '20'.
</code></pre>
      </li>
      <li class="numberedList">Modify some property values for the order, as shown highlighted in the following code:
        <pre class="programlisting code"><code class="hljs-code">Order order = new()
{
  OrderId = 10001,
  CustomerName = "Abc<strong class="hljs-string-slc">def</strong>",
  CustomerEmail = "abc<strong class="hljs-string-slc">@</strong>example.com",
  CustomerLevel = <strong class="hljs-slc">CustomerLevel.Gold</strong>,
  OrderDate = new(2022, month: 12, day: 1),
  ShipDate = new(2022, month: 12, day: 5),
  // CustomerLevel is Gold so Total can be &gt;20.
  Total = 49.99M
};
</code></pre>
      </li>
      <li class="numberedList">Run the<a id="_idIndexMarker549"/> console app and note the order is now valid, as shown in the following output:
        <pre class="programlisting con"><code class="hljs-con">IsValid:  True
</code></pre>
      </li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-259">Validating data with ASP.NET Core</h2>
    <p class="normal">For <a id="_idIndexMarker550"/>automatic data validation with ASP.NET Core, FluentValidation supports .NET Core 3.1 and later.</p>
    <div><p class="normal"><strong class="keyWord">More Information</strong>: Learn more details at the following link: <a href="https://cecilphillip.com/fluent-validation-rules-with-asp-net-core/">https://cecilphillip.com/fluent-validation-rules-with-asp-net-core/</a>.</p>
    </div>
    <h1 class="heading-1" id="_idParaDest-260">Generating PDFs</h1>
    <p class="normal">One of the<a id="_idIndexMarker551"/> most common questions I get when teaching C# and .NET is, “What open-source library is available to generate PDF files?”</p>
    <p class="normal">There are many licensed libraries for generating PDF files, but over the years, it has been difficult to find cross-platform open-source ones. </p>
    <p class="normal">QuestPDF says, “<em class="italic">If you are consuming the QuestPDF library as a Direct Package Dependency for usage in a Closed Source software in the capacity of a for-profit company/individual with more than 1M USD annual gross revenue, you must purchase the QuestPDF Professional or Enterprise License, depending on the number of software developers. Please refer to the QuestPDF License and Pricing webpage for more details. (</em><a href="https://www.questpdf.com/pricing.html">https://www.questpdf.com/pricing.html</a><em class="italic">)</em>”</p>
    <p class="normal">The older 2022.12.X release <a id="_idIndexMarker552"/>will always be available under the MIT license, free for commercial usage. If you want to support library development, please consider purchasing the Professional License for version 2023.1.X or later.</p>
    <h2 class="heading-2" id="_idParaDest-261">Using QuestPDF on Apple silicon Macs</h2>
    <p class="normal">QuestPDF uses<a id="_idIndexMarker553"/> SkiaSharp, which has<a id="_idIndexMarker554"/> implementations for Windows, Mac, and Linux operating systems. The console app that you create in this section to generate PDFs is therefore cross-platform. But on an Apple silicon Mac, like my Mac mini M1, I had to install the x64 version of .NET SDK and start the project using <code class="inlineCode">dotnet new -a x64</code>. This tells the .NET SDK to use the x64 architecture, otherwise the SkiaSharp libraries give an error because they have not yet been built to target ARM64.</p>
    <h2 class="heading-2" id="_idParaDest-262">Creating class libraries to generate PDF documents</h2>
    <p class="normal">Let’s see an <a id="_idIndexMarker555"/>example of QuestPDF in action. You will create three projects:</p>
    <ul>
      <li class="bulletList">A class library for a model that represents a catalog of product categories with names and images.</li>
      <li class="bulletList">A class library for the document template.</li>
      <li class="bulletList">A console app to perform a live generation of a PDF file.</li>
    </ul>
    <p class="normal">Let’s start:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Class Library</strong> / <code class="inlineCode">classlib</code> project named <code class="inlineCode">GeneratingPdf.Models</code> to the <code class="inlineCode">Chapter06</code> solution.</li>
      <li class="numberedList">In the <code class="inlineCode">GeneratingPdf.Models</code> project, delete the file named <code class="inlineCode">Class1.cs</code>.</li>
      <li class="numberedList">In the <code class="inlineCode">GeneratingPdf.Models</code> project, add a new class file named <code class="inlineCode">Category.cs</code> and modify its contents to define a class with two properties for the name and identifier of a category, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">namespace GeneratingPdf.Models;
public class Category
{
  public int CategoryId { get; set; }
  public string CategoryName { get; set; } = null!;
}
</code></pre>
      
    <div><p class="normal">Later, you will create an <code class="inlineCode">images</code> folder with filenames that use the pattern <code class="inlineCode">categoryN.jpeg</code>, where <code class="inlineCode">N</code> is a number from 1 to 8 that matches the <code class="inlineCode">CategoryId</code> values.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">In the <code class="inlineCode">GeneratingPdf.Models</code> project, add a new class file named <code class="inlineCode">Catalog.cs</code> and modify its contents to define a class with a property to store the eight categories, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">namespace GeneratingPdf.Models;
public class Catalog
{
  public List&lt;Category&gt; Categories { get; set; } = null!;
}
</code></pre>
      </li>
      <li class="numberedList">Use <a id="_idIndexMarker556"/>your preferred code editor to add a new <strong class="screenText">Class Library</strong> / <code class="inlineCode">classlib</code> project named <code class="inlineCode">GeneratingPdf.Document</code> to the <code class="inlineCode">Chapter06</code> solution.</li>
      <li class="numberedList">In the <code class="inlineCode">GeneratingPdf.Document</code> project, add a package reference for <code class="inlineCode">QuestPDF</code> and a project reference for the <code class="inlineCode">Models</code> class library, as shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;!-- The newest version with an MIT license. --&gt;
  &lt;PackageReference Include="QuestPDF" Version="2022.12.6" /&gt;
&lt;/ItemGroup&gt;
&lt;ItemGroup&gt;
  &lt;ProjectReference Include=
    "..\GeneratingPdf.Models\GeneratingPdf.Models.csproj" /&gt;
&lt;/ItemGroup&gt;
</code></pre>
      </li>
      <li class="numberedList">Build the <code class="inlineCode">GeneratingPdf.Document</code> project.</li>
      <li class="numberedList">In the <code class="inlineCode">GeneratingPdf.Document</code> project, delete the file named <code class="inlineCode">Class1.cs</code>.</li>
      <li class="numberedList">In the <code class="inlineCode">GeneratingPdf.Document</code> project, add a new class file named <code class="inlineCode">CatalogDocument.cs</code>. </li>
      <li class="numberedList">In <code class="inlineCode">CatalogDocument.cs</code>, define a class that implements the <code class="inlineCode">IDocument</code> interface to define a template with a header and a footer, and then output the eight <a id="_idIndexMarker557"/>categories, including name and image, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using GeneratingPdf.Models; // Catalog
using QuestPDF.Drawing; // DocumentMetadata
using QuestPDF.Fluent; // Page
using QuestPDF.Helpers; // Colors
using QuestPDF.Infrastructure; // IDocument, IDocumentContainer
namespace GeneratingPdf.Document;
public class CatalogDocument : IDocument
{
  public Catalog Model { get; }
  public CatalogDocument(Catalog model)
  {
    Model = model;
  }
  public void Compose(IDocumentContainer container)
  {
    container
      .Page(page =&gt;
      {
        page.Margin(50 /* points */);
        page.Header()
          .Height(100).Background(Colors.Grey.Lighten1)
          .AlignCenter().Text("Catalogue")
          .Style(TextStyle.Default.FontSize(20));
        page.Content()
          .Background(Colors.Grey.Lighten3)
          .Table(table =&gt;
          {
            table.ColumnsDefinition(columns =&gt;
            {
              columns.ConstantColumn(100);
              columns.RelativeColumn();
            });
            foreach (var item in Model.Categories)
            {
              table.Cell().Text(item.CategoryName);
              string imagePath = Path.Combine(
                Environment.CurrentDirectory, "images", 
                $"category{item.CategoryId}.jpeg");
              
              table.Cell().Image(imagePath);
            }
          });
        page.Footer()
          .Height(50).Background(Colors.Grey.Lighten1)
          .AlignCenter().Text(x =&gt;
          {
            x.CurrentPageNumber();
            x.Span(" of ");
            x.TotalPages();
          });
      });
  }
  public DocumentMetadata GetMetadata() =&gt; DocumentMetadata.Default;
}
</code></pre>
      </li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-263">Creating a console app to generate PDF documents</h2>
    <p class="normal">Now we can <a id="_idIndexMarker558"/>create a console app project that will use the class libraries to generate a PDF document:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code> project named <code class="inlineCode">GeneratingPdf.Console</code> to a <code class="inlineCode">Chapter06</code> solution.</li>
      <li class="numberedList">In the <code class="inlineCode">GeneratingPdf.Console</code> project, create an <code class="inlineCode">images</code> folder and download the eight category images 1 to 8 from the following link to it: <a href="https://github.com/markjprice/apps-services-net8/tree/master/images/Categories">https://github.com/markjprice/apps-services-net8/tree/master/images/Categories</a>.</li>
      <li class="numberedList">If you are using Visual Studio 2022 or JetBrains Rider, then the <code class="inlineCode">images</code> folder and its files must be copied to the <code class="inlineCode">GeneratingPdf.Console\bin\Debug\net8</code> folder:<ol class="numberedList" style="list-style-type: decimal;">
          <li class="numberedList" value="1">In <strong class="screenText">Solution Explorer</strong>, select all the images.</li>
          <li class="numberedList">In <strong class="screenText">Properties</strong>, set <strong class="screenText">Copy To Output Directory</strong> to <strong class="screenText">Copy Always</strong>.</li>
          <li class="numberedList">Open the project file and note the <code class="inlineCode">&lt;ItemGroup&gt;</code> entries that will copy the eight images to the correct folder, as partially shown in the following markup:</li>
        </ol>
        <pre class="programlisting code"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;None Update="images\category1.jpeg"&gt;
    &lt;CopyToOutputDirectory&gt;Always&lt;/CopyToOutputDirectory&gt;
  &lt;/None&gt;
...
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">GeneratingPdf.Console</code> project, treat warnings as errors, globally and <a id="_idIndexMarker559"/>statically import the <code class="inlineCode">System.Console</code> class, and add a project reference for the <code class="inlineCode">Document</code> template class library, as shown in the following markup:
        <pre class="programlisting code"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;ProjectReference Include=
    "..\GeneratingPdf.Document\GeneratingPdf.Document.csproj" /&gt;
&lt;/ItemGroup&gt;
</code></pre>
      </li>
      <li class="numberedList">Build the <code class="inlineCode">GeneratingPdf.Console</code> project.</li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete the existing statements and then add statements to create a catalog model, pass it to a catalog document, generate a PDF file, and then attempt to open the file using the appropriate operating system command, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code">using GeneratingPdf.Document; // To use CatalogDocument.
using GeneratingPdf.Models; // To use Catalog, Category.
using QuestPDF.Fluent; // To use the GeneratePdf extension method.
using QuestPDF.Infrastructure; // To use LicenseType.
// For evaluation purposes, feel free to use the QuestPDF Community 
// License in a non-production environment.
QuestPDF.Settings.License = LicenseType.Community;
string filename = "catalog.pdf";
Catalog model = new()
{
  Categories = new()
  {
    new() { CategoryId = 1, CategoryName = "Beverages"},
    new() { CategoryId = 2, CategoryName = "Condiments"},
    new() { CategoryId = 3, CategoryName = "Confections"},
    new() { CategoryId = 4, CategoryName = "Dairy Products"},
    new() { CategoryId = 5, CategoryName = "Grains/Cereals"},
    new() { CategoryId = 6, CategoryName = "Meat/Poultry"},
    new() { CategoryId = 7, CategoryName = "Produce"},
    new() { CategoryId = 8, CategoryName = "Seafood"}
  }
};
CatalogDocument document = new(model);
document.GeneratePdf(filename);
WriteLine("PDF catalog has been created: {0}",
  Path.Combine(Environment.CurrentDirectory, filename));
try
{
  if (OperatingSystem.IsWindows())
  {
    System.Diagnostics.Process.Start("explorer.exe", filename);
  }
  else
  {
    WriteLine("Open the file manually.");
  }
}
catch (Exception ex)
{
  WriteLine($"{ex.GetType()} says {ex.Message}");
}
</code></pre>
      
    <div><p class="normal">The <code class="inlineCode">Process</code> class and its <code class="inlineCode">Start</code> method should also be able to start processes on Mac and Linux, but getting the paths right can be tricky, so I’ve left that as an optional exercise for the reader. You can learn more about the <code class="inlineCode">Process</code> class and its <code class="inlineCode">Start</code> method at the following link: <a href="https://learn.microsoft.com/en-us/dotnet/api/system.diagnostics.process.start">https://learn.microsoft.com/en-us/dotnet/api/system.diagnostics.process.start</a>.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="7">Run the <a id="_idIndexMarker560"/>console app and note the PDF file generated, as shown in <em class="italic">Figure 6.4</em>:</li>
    </ol>
    <figure class="mediaobject"><img alt="" src="img/B19587_06_04.png"/></figure>
    <p class="packt_figref">Figure 6.4: A PDF file generated from C# code</p>
    <div><p class="normal"><strong class="keyWord">More Information</strong>: Learn more details at the following link: <a href="https://www.questpdf.com/">https://www.questpdf.com/</a>.</p>
    </div>
    <h1 class="heading-1" id="_idParaDest-264">Practicing and exploring</h1>
    <p class="normal">Test your knowledge and understanding by answering some questions, getting some hands-on practice, and doing deeper research into the topics in this chapter.</p>
    <h2 class="heading-2" id="_idParaDest-265">Exercise 6.1 – Test your knowledge</h2>
    <p class="normal">Use the web to answer the following questions:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">What is the most downloaded third-party <code class="inlineCode">NuGet</code> package of all time?</li>
      <li class="numberedList">What method do you call on the <code class="inlineCode">ImageSharp Image</code> class to make a change like resizing the image or replacing colors with grayscale?</li>
      <li class="numberedList">What is a key benefit of using <code class="inlineCode">Serilog</code> for logging?</li>
      <li class="numberedList">What is a Serilog sink?</li>
      <li class="numberedList">Should you always use a package like <code class="inlineCode">AutoMapper</code> to map between objects?</li>
      <li class="numberedList">Which <code class="inlineCode">FluentAssertions</code> method should you call to start a fluent assertion on a value?</li>
      <li class="numberedList">Which <code class="inlineCode">FluentAssertions</code> method should you call to assert that all items in a sequence conform to a condition, like a <code class="inlineCode">string</code> item must have less than six characters?</li>
      <li class="numberedList">Which <code class="inlineCode">FluentValidation</code> class should you inherit from to define a custom validator?</li>
      <li class="numberedList">With <code class="inlineCode">FluentValidation</code>, how can you set a rule to only apply in certain conditions?</li>
      <li class="numberedList">With <code class="inlineCode">QuestPDF</code>, which interface must you implement to define a document for a PDF and what methods of that interface must you implement?</li>
    </ol>
    <h2 class="heading-2" id="_idParaDest-266">Exercise 6.2 – Explore topics</h2>
    <p class="normal">Use the links on the following page to learn more details about the topics covered in this chapter:</p>
    <p class="normal"><a href="https://github.com/markjprice/apps-services-net8/blob/main/docs/book-links.md#chapter-6---implementing-popular-third-party-libraries">https://github.com/markjprice/apps-services-net8/blob/main/docs/book-links.md#chapter-6---implementing-popular-third-party-libraries</a></p>
    <h1 class="heading-1" id="_idParaDest-267">Summary</h1>
    <p class="normal">In this chapter, you explored some third-party libraries that are popular with .NET developers to perform functions, including:</p>
    <ul>
      <li class="bulletList">Manipulating images using a Microsoft-recommended third-party library named ImageSharp.</li>
      <li class="bulletList">Making text, numbers, dates, and times friendlier with Humanizer.</li>
      <li class="bulletList">Logging structured data with Serilog.</li>
      <li class="bulletList">Mapping between objects, for example, entity models to view models.</li>
      <li class="bulletList">Making fluent assertions in unit testing.</li>
      <li class="bulletList">Validating data in a local culture language-readable way.</li>
      <li class="bulletList">Generating a PDF file.</li>
    </ul>
    <p class="normal">In the next chapter, we will learn how to handle internationalization with dates and times and localization, including a new type in .NET 8 for making it easier to unit test components with a dependency on the current time.</p>
    <h1 class="heading-1" id="_idParaDest-268">Learn more on Discord</h1>
    <p class="normal">To join the Discord community for this book – where you can share feedback, ask questions to the author, and learn about new releases – follow the QR code below:</p>
    <p class="normal"><a href="https://packt.link/apps_and_services_dotnet8">https://packt.link/apps_and_services_dotnet8</a></p>
    <p class="normal"><img alt="" src="img/QR_Code3048220001028652625.png"/></p>
  </div>
</body></html>