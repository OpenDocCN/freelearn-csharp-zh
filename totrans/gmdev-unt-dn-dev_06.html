<html><head></head><body>
		<div id="_idContainer231">
			<p><a id="_idTextAnchor061"/></p>
			<h1 id="_idParaDest-66"><em class="italic"><a id="_idTextAnchor062"/>Chapter 4</em>: Creating Animations with the Unity Animation System</h1>
			<p>Whether for 2D games or 3D games, if you want a game to be lively and interesting, good animation is essential. As a very popular game engine, Unity provides easy-to-use and powerful animation development tools. In this chapter, we will explore the animation system in Unity, sometimes referred<a id="_idIndexMarker367"/> to as <strong class="bold">Mecanim</strong>, to make Scenes and characters in your game not static, but dynamic. Then, we will demonstrate how to implement 3D and 2D animation in Unity with two examples. Finally, we'll cover how to improve the performance of the animation system in Unity.</p>
			<p>We will cover the following key topics in this chapter:</p>
			<ul>
				<li>Exploring the Unity animation system's concepts</li>
				<li>Implementing 3D animation in Unity</li>
				<li>Implementing 2D animation in Unity</li>
				<li>Improving the performance of Unity's animation system</li>
			</ul>
			<p>By the end of this chapter, you will be able to create 3D and 2D animations in Unity, as well as knowing how to control animations through C# code and how to optimize animation performance.</p>
			<h1 id="_idParaDest-67"><a id="_idTextAnchor063"/>Technical requirements</h1>
			<p>Before starting, I recommend you first download <strong class="bold">Unity-Chan! Model</strong> from Unity Asset Store: <a href="https://assetstore.unity.com/packages/3d/characters/unity-chan-model-18705">https://assetstore.unity.com/packages/3d/characters/unity-chan-model-18705</a>.</p>
			<p>This cute 3D girl model asset is produced by Unity Technologies Japan, and it's available for all developers to download and make games with it.</p>
			<p>The following content is included in this asset:</p>
			<ul>
				<li>3D models with beautiful textures</li>
				<li>"Unity-Chan!" original shaders</li>
				<li>31 animations</li>
				<li>31 still poses</li>
				<li>12 emotions made from blend shapes</li>
				<li>A sample locomotion scene and other sample Scenes</li>
			</ul>
			<p>Now, let's get started!</p>
			<h1 id="_idParaDest-68"><a id="_idTextAnchor064"/>Exploring the Unity animation system's concepts</h1>
			<p>Animation is an important<a id="_idIndexMarker368"/> aspect of game development. In this section, we will first learn the basic concepts of the Unity animation system. Specifically, we will introduce the following concepts:</p>
			<ul>
				<li>What Animation Clips are and how to create an Animation Clip in Unity</li>
				<li>How to create an Animator Controller to manage a set of animations for characters</li>
				<li>How to use the Avatar system to work with animation rigging</li>
				<li>What the Animator component is and how to use it to assign animation to a GameObject</li>
			</ul>
			<p>Let's move on!</p>
			<h2 id="_idParaDest-69"><a id="_idTextAnchor065"/>Animation Clips</h2>
			<p>Animation in Unity can <a id="_idIndexMarker369"/>range from simple cube rotation to complex character movement and actions, and they are all based on <strong class="bold">Animation Clips</strong>, which are used to store keyframe-based animations in Unity. </p>
			<p>We can manually create an Animation Clip file in the Unity Editor to implement some simple traditional keyframe animation effects via the <strong class="bold">Animation</strong> window, such as simple movement, rotation, and so on. </p>
			<p>The following steps show how to animate a GameObject in a Scene:</p>
			<ol>
				<li>Right-click<a id="_idIndexMarker370"/> in the <strong class="bold">Hierarchy</strong> window (on the right-hand side) and select <strong class="bold">3D Object | Cube</strong> from the pop-up menu to create a new <strong class="bold">Cube</strong> object in the Scene.</li>
			</ol>
			<div>
				<div id="_idContainer173" class="IMG---Figure">
					<img src="image/Figure_4.01_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.1 – Create a new Cube object in the Scene</p>
			<ol>
				<li value="2">Select the <strong class="bold">Cube</strong> object in the Scene view. Then navigate to <strong class="bold">Window | Animation | Animation</strong> to open the <strong class="bold">Animation</strong> window. In addition to opening this window from the menu, we can also use the <em class="italic">Ctrl + 6</em> shortcut to open it: </li>
			</ol>
			<div>
				<div id="_idContainer174" class="IMG---Figure">
					<img src="image/Figure_4.02_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.2 – Open the Animation window</p>
			<ol>
				<li value="3">Click on<a id="_idIndexMarker371"/> the <strong class="bold">Create</strong> button in the <strong class="bold">Animation</strong> window to create a new Animation Clip:</li>
			</ol>
			<div>
				<div id="_idContainer175" class="IMG---Figure">
					<img src="image/Figure_4.03_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.3 – The Animation window</p>
			<ol>
				<li value="4">Click on the <strong class="bold">Add Property</strong> button to display a list of available properties that can be animated. As shown in <em class="italic">Figure 4.4</em>, we can not only modify <strong class="bold">Position</strong> and <strong class="bold">Rotation</strong> but also modify the properties of other components. Here we can add <strong class="bold">Scale</strong> as the property that will be animated by clicking the <strong class="bold">+</strong> button next to it:</li>
			</ol>
			<div>
				<div id="_idContainer176" class="IMG---Figure">
					<img src="image/Figure_4.04_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.4 – Add Property</p>
			<ol>
				<li value="5">When a <a id="_idIndexMarker372"/>property is added, two keyframes are created by default: the first keyframe and the second keyframe are at <em class="italic">0:00</em> and <em class="italic">1:00</em> on the timeline respectively. So, we need to create a third keyframe to change the <strong class="bold">Scale</strong> property of this Cube:<ol><li>Place your cursor at <em class="italic">0:10</em> on the timeline.</li><li>Right-click in the <strong class="bold">Animation</strong> window and click on <strong class="bold">Add Key</strong> from the pop-up menu to add a new keyframe. </li><li>Set <strong class="bold">Scale.x</strong> to <strong class="source-inline">0.5</strong>, as shown in <em class="italic">Figure 4.5</em>:</li></ol></li>
			</ol>
			<div>
				<div id="_idContainer177" class="IMG---Figure">
					<img src="image/Figure_4.05_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.5 – Add keyframes</p>
			<ol>
				<li value="6">In order to <a id="_idIndexMarker373"/>preview the animation, click on the <strong class="bold">Play</strong> button to play the <a id="_idIndexMarker374"/>Animation Clip. You will see that the volume of the Cube shrinks rapidly and then slowly enlarges.</li>
			</ol>
			<div>
				<div id="_idContainer178" class="IMG---Figure">
					<img src="image/Figure_4.06_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.6 – Play the Animation Clip</p>
			<p>We can also<a id="_idIndexMarker375"/> use <strong class="bold">recording mode</strong> to create an <a id="_idIndexMarker376"/>Animation Clip in Unity, as demonstrated in these steps:</p>
			<ol>
				<li value="1">The steps to create a new GameObject and open the <strong class="bold">Animation</strong> window are the same as before. So, let's start directly with how to use recording mode to create an Animation Clip for a Sphere object in the Scene. We can click the record button to enable keyframe recording mode, as shown in <em class="italic">Figure 4.7</em>:</li>
			</ol>
			<div>
				<div id="_idContainer179" class="IMG---Figure">
					<img src="image/Figure_4.07_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.7 – Enable keyframe recording mode</p>
			<ol>
				<li value="2">After clicking the record button, it will enter recording mode. Now, we can modify the point in time that we want it to be at by dragging on the timeline:</li>
			</ol>
			<p class="figure-caption"> </p>
			<div>
				<div id="_idContainer180" class="IMG---Figure">
					<img src="image/Figure_4.08_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.8 – Drag on the timeline</p>
			<p>In <a id="_idIndexMarker377"/>recording mode, whether <a id="_idIndexMarker378"/>you move, rotate, or scale the target GameObject in the Scene, Unity will automatically add the keyframe of the current time point to the Animation Clip. Here we can move the GameObject from its original position (0, 0, 0) to a new position, let's say, (1, 0, 0). And you can see in the following figure that Unity created keyframes for the Sphere object:</p>
			<div>
				<div id="_idContainer181" class="IMG---Figure">
					<img src="image/Figure_4.09_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.9 – Unity creates keyframes</p>
			<ol>
				<li value="3">Finally, click<a id="_idIndexMarker379"/> on the record button again<a id="_idIndexMarker380"/> to exit recording mode and click the <strong class="bold">Play</strong> button to play the Animation Clip we just created:</li>
			</ol>
			<div>
				<div id="_idContainer182" class="IMG---Figure">
					<img src="image/Figure_4.10_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.10 – Play the Animation Clip</p>
			<p>In addition, importing external animation assets into the Unity Editor can also automatically create Animation Clip files. </p>
			<div>
				<div id="_idContainer183" class="IMG---Figure">
					<img src="image/Figure_4.11_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.11 – Animation Clips created automatically after importing animation assets</p>
			<p>Animation files<a id="_idIndexMarker381"/> such as generic <strong class="bold">FBX</strong> files, <strong class="bold">Autodesk® 3ds Max® (.max)</strong> files, native <strong class="bold">Autodesk® Maya® (.mb or .ma)</strong> files, and <strong class="bold">Blender™ (.blend)</strong> files need to be imported into our Unity project first before they<a id="_idIndexMarker382"/> can be used by Unity. After animation files are imported, Unity will generate Animation Clip files. We can open the <strong class="bold">Animation </strong>window to view an Animation Clip by double-clicking the Animation Clip file in the Unity Editor, as shown in <em class="italic">Figure 4.11</em>.</p>
			<p>Now that you understand what an Animation Clip is and how to create a new one in Unity, let's move on to the next concept: the Animator Controller.</p>
			<h2 id="_idParaDest-70"><a id="_idTextAnchor066"/>Animator Controller</h2>
			<p>Imagine that our game character has multiple animations. For example, say a character can both run and attack – it is very important to manage both of these animations for the character. In a <a id="_idIndexMarker383"/>Unity project, we use the <strong class="bold">Animator Controller</strong> asset to arrange and maintain a set of animations for characters or other animated GameObjects.</p>
			<p>An <strong class="bold">Animator Controller</strong> will reference the Animation Clips it uses and use a so-called <strong class="bold">state machine</strong> to <a id="_idIndexMarker384"/>manage various animation states and transitions between them.</p>
			<p>We can import the <strong class="bold">Unity-Chan! Model</strong> asset that we downloaded earlier. </p>
			<div>
				<div id="_idContainer184" class="IMG---Figure">
					<img src="image/Figure_4.12_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.12 – Unity-Chan! Model ActionCheck Scene</p>
			<p>This asset provides multiple <a id="_idIndexMarker385"/>demo Scenes; we chose to open the <strong class="bold">ActionCheck</strong> Scene. You can find these Scenes in the <strong class="source-inline">Assets/unity-chan!/Unity-chan! Model/Scenes</strong> folder.</p>
			<div>
				<div id="_idContainer185" class="IMG---Figure">
					<img src="image/Figure_4.13_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.13 – Unity-Chan! Model</p>
			<p>As <em class="italic">Figure 4.13</em> shows, the Unity-Chan! model has been set up in the Scene. If we open the Animator Controller file used by this model, we can see all the Animation Clips used by this model and the transitions between Animation Clips in the state machine displayed in the <strong class="bold">Animator</strong> window, as shown in <em class="italic">Figure 4.14</em>.</p>
			<div>
				<div id="_idContainer186" class="IMG---Figure">
					<img src="image/Figure_4.14_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.14 – Animator Controller</p>
			<p>We can also follow these steps <a id="_idIndexMarker386"/>to manually create an <strong class="bold">Animator Controller</strong> asset in the Unity Editor:</p>
			<ol>
				<li value="1">Select the <strong class="bold">Project</strong> view and right-click to open the menu.</li>
				<li>Select <strong class="bold">Create | Animator Controller</strong> to create a new <strong class="bold">Animator Controller</strong> asset: </li>
			</ol>
			<div>
				<div id="_idContainer187" class="IMG---Figure">
					<img src="image/Figure_4.15_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.15 – Create a new Animator Controller</p>
			<ol>
				<li value="3">Double-click<a id="_idIndexMarker387"/> the <strong class="bold">Animator Controller</strong> asset we just created to open the <strong class="bold">Animator</strong> window.</li>
				<li>Here, drag the <strong class="bold">POSE01</strong> Animation Clip into the <strong class="bold">Animator</strong> window directly to create a new state. In the state machine, a state is represented by a box because the <strong class="bold">POSE01</strong> Animation Clip is the first animation we dragged, so we can see this animation is connected to the entry point of the Animator Controller, indicating that this animation will be the default animation. <div id="_idContainer188" class="IMG---Figure"><img src="image/Figure_4.16_B17146.jpg" alt=""/></div></li>
			</ol>
			<p class="figure-caption"> </p>
			<p class="figure-caption">Figure 4.16 – Create a new state</p>
			<ol>
				<li value="5">Create the <a id="_idIndexMarker388"/>second state by dragging the <strong class="bold">POSE02</strong> Animation Clip into the <strong class="bold">Animator</strong> window.</li>
				<li>Select the <strong class="bold">POSE01</strong> state and right-click to open a menu, then select <strong class="bold">Make Transition</strong> to make a transition between <strong class="bold">POSE01</strong> and <strong class="bold">POSE02</strong>.</li>
			</ol>
			<div>
				<div id="_idContainer189" class="IMG---Figure">
					<img src="image/Figure_4.17_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.17 – Make Transition</p>
			<p>Now, we've created an Animator Controller asset and added some Animation Clips to the state machine. </p>
			<h2 id="_idParaDest-71"><a id="_idTextAnchor067"/>Avatar</h2>
			<p>Unlike the animation we created for Unity's built-in Cube model earlier, the model imported from the external tools into the Unity Editor may be more complicated. For example, the Unity-Chan! model is a human-like model. A model in Unity is represented by a mesh of <strong class="bold">triangles</strong>, and a triangle is composed of <strong class="bold">vertices</strong>. When the model is animated, the position of the vertices will be modified. Obviously, when many vertices make up a model, moving each vertex individually is an inefficient operation. Therefore, a common technique in computer animation is not to move each triangle individually during the animation <a id="_idIndexMarker389"/>but to<a id="_idIndexMarker390"/> skin the model before it is animated. This technique is called <strong class="bold">skeletal animation</strong> or <strong class="bold">rigging.</strong></p>
			<p>Unity uses a system called <strong class="bold">Avatar</strong> to<a id="_idIndexMarker391"/> identify whether the animation model is a humanoid layout and which parts of the model correspond to the head, body, arms, legs, and so on.</p>
			<div>
				<div id="_idContainer190" class="IMG---Figure">
					<img src="image/Figure_4.18_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.18 – Import Settings</p>
			<p>We can open the <strong class="bold">Import Settings</strong> window for Unity-Chan! by clicking the model in the Unity Editor. As <em class="italic">Figure 4.18</em> shows, we can specify the kind of rig it is in the <strong class="bold">Rig</strong> tab of the window, and in this case, <strong class="bold">Animation Type</strong> for this model is <strong class="bold">Humanoid</strong>. The animation system will try to match the model's existing bone structure with the <strong class="bold">Avatar</strong> bone structure. If the bone structure can be successfully mapped, then an <strong class="bold">Avatar</strong> asset will be created automatically as shown in <em class="italic">Figure 4.19</em>.</p>
			<div>
				<div id="_idContainer191" class="IMG---Figure">
					<img src="image/Figure_4.19_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.19 – unitychanAvatar</p>
			<p class="callout-heading">Note</p>
			<p class="callout"><strong class="bold">Bones</strong> are a hierarchical set of interconnected parts of <strong class="bold">skeletal animation</strong>. <strong class="bold">Skinning</strong> makes each vertex of the triangle depend on the bone.</p>
			<p>On the other <a id="_idIndexMarker392"/>hand, if the animation system cannot automatically match the model's existing bone structure with the <strong class="bold">Avatar</strong> bone structure, we need to configure the <strong class="bold">Avatar</strong> manually. In addition, even if the bone structure can be successfully mapped, sometimes we want to manually adjust things to achieve better results. At this time, we can also modify it by configuring the <strong class="bold">Avatar</strong> asset. </p>
			<div>
				<div id="_idContainer192" class="IMG---Figure">
					<img src="image/Figure_4.20_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.20 – Configure Avatar</p>
			<p>Follow these <a id="_idIndexMarker393"/>steps to configure it:</p>
			<ol>
				<li value="1">Click on the model to open the <strong class="bold">Import Settings</strong> window for it.</li>
				<li>Click the <strong class="bold">Configure</strong> button in the <strong class="bold">Rig</strong> tab of the window to open the <strong class="bold">Avatar Inspector</strong> window.</li>
				<li>Configure the bones in the <strong class="bold">Avatar Inspector</strong> window as shown in <em class="italic">Figure 4.20</em>.</li>
			</ol>
			<h3>Avatar Mask</h3>
			<p>After we create a mapping <a id="_idIndexMarker394"/>between the bones of the model and the bone structure of Unity's Avatar system, we can play the animation of this character. However, sometimes we may not want to animate all the bones of the character. A common example is that the walking animation may involve a character swinging their arms, but if they pick up a phone to make a call, their arms should hold the phone instead of swinging as they walk. In this case, we want to restrict an animation to specific body parts, and the <strong class="bold">Avatar Mask</strong> asset provided by Unity can help us achieve this goal.</p>
			<p>We can create a new <strong class="bold">Avatar Mask</strong> asset <a id="_idIndexMarker395"/>by selecting <strong class="bold">Assets | Create | Avatar Mask</strong> as shown in <em class="italic">Figure 4.21</em>.</p>
			<div>
				<div id="_idContainer193" class="IMG---Figure">
					<img src="image/Figure_4.21_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.21 – Create an Avatar Mask</p>
			<p>After creating a new <strong class="bold">Avatar Mask</strong> asset, we can configure it to define which parts of the animation should be masked. As <em class="italic">Figure 4.22</em> shows, the <strong class="bold">Avatar Mask</strong> <strong class="bold">Inspector</strong> window allows us to click on a diagram of a humanoid body to select or deselect certain parts to mask. Here we mask an arm of Unity-Chan!, which means some animation will not affect this arm at runtime.</p>
			<div>
				<div id="_idContainer194" class="IMG---Figure">
					<img src="image/Figure_4.22_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.22 – Avatar Mask</p>
			<p>In order for this <a id="_idIndexMarker396"/>Avatar Mask asset to take effect, we need to apply it to an Animator Controller. </p>
			<div>
				<div id="_idContainer195" class="IMG---Figure">
					<img src="image/Figure_4.23_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.23 – Apply the Avatar Mask asset</p>
			<p>In this case, we will apply this <a id="_idIndexMarker397"/>Avatar Mask asset to the Animator Controller we created earlier as follows:</p>
			<ol>
				<li value="1">Double-click the <strong class="bold">New Animator Controller</strong> file to open the <strong class="bold">Animator</strong> window.</li>
				<li>Click on the gear icon of the <strong class="bold">Base Layer</strong> item to open the <strong class="bold">Layer settings</strong> panel.</li>
				<li>Then, click the radio button next to the <strong class="bold">Mask</strong> field and select the New <strong class="bold">Avatar Mask</strong> asset to apply from the <strong class="bold">Select AvatarMask</strong> window that pops up, as shown in <em class="italic">Figure 4.23</em>.</li>
			</ol>
			<p>In this way, we can limit the animation to specific body parts.</p>
			<p>Next, we will explore another important concept in Unity's Animation development solution, namely the <strong class="bold">Animator</strong> component. By using Animator, we can use this Animator Controller asset in our game.</p>
			<h2 id="_idParaDest-72"><a id="_idTextAnchor068"/>Animator component</h2>
			<p>In the previous sections, we explored Animation Clips, Animator Controllers, and Avatar in Unity. However, just creating Animation Clips, Animator Controllers, and Avatar assets is not enough to animate the characters in a game Scene. We still need the Animator component to<a id="_idIndexMarker398"/> assign animation to the GameObject in the Scene. </p>
			<p class="callout-heading">Note</p>
			<p class="callout">Animator Controllers and Animator components have similar names but different functions. An Animator component uses an associated Animator Controller to apply animations to a GameObject.</p>
			<p>If you see an Animator component on a GameObject, you will find that it will bring together all the various assets we discussed before. It is the root of the binding system in Unity's animation solution, so it is very important. </p>
			<div>
				<div id="_idContainer196" class="IMG---Figure">
					<img src="image/Figure_4.24_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.24 – Animator component</p>
			<p>Here we can drag the Unity-Chan! model into the Scene to create a new character GameObject, and add an Animator component to the GameObject, as <em class="italic">Figure 4.24</em> shows. This is how the<a id="_idIndexMarker399"/> Animator component was configured:</p>
			<ul>
				<li>The Animator component needs to reference an Animator Controller, which defines the Animation Clips to be used. We can assign the Animator Controller that we created in the <em class="italic">Animator Controller</em> section to it, with the name <strong class="bold">New Animator Controller</strong>.</li>
				<li>Since the Unity-Chan! model is a humanoid model, provide the corresponding Avatar asset to this Animator component.</li>
				<li>The <strong class="bold">Apply Root Motion</strong> setting of the Animator component determines whether or not any change to the position or rotation of the root node will be applied.</li>
				<li>The <strong class="bold">Update Mode</strong> setting of the Animator component determines the update mode of the Animator component. There are three different options, namely <strong class="bold">Normal</strong>, <strong class="bold">Animate Physics</strong>, and <strong class="bold">Unscaled Time</strong>.</li>
			</ul>
			<div>
				<div id="_idContainer197" class="IMG---Figure">
					<img src="image/Figure_4.25_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.25 – The Update Mode setting</p>
			<ul>
				<li>The last <a id="_idIndexMarker400"/>setting is <strong class="bold">Culling</strong> <strong class="bold">Mode</strong>, which determines whether the animations of the Animator component should play off-screen. There are three different options, namely <strong class="bold">Always Animate</strong>, <strong class="bold">Cull Update Transforms</strong>, and <strong class="bold">Cull Completely</strong>.</li>
			</ul>
			<div>
				<div id="_idContainer198" class="IMG---Figure">
					<img src="image/Figure_4.26_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.26 – The Culling Mode setting</p>
			<p>After reading this section, we have an understanding of the concepts of Unity's animation system. We will use this system to create 3D animations in the next section!</p>
			<h1 id="_idParaDest-73"><a id="_idTextAnchor069"/>Implementing 3D animation in Unity</h1>
			<p>We have covered some important concepts, such as <strong class="bold">Animation Clips</strong>, <strong class="bold">Animator Controllers</strong>, <strong class="bold">Avatar</strong>, and <strong class="bold">Animator components</strong>, in the Unity animation system in the previous sections. In this section, you will learn how to implement animation for 3D models with these concepts.</p>
			<h2 id="_idParaDest-74"><a id="_idTextAnchor070"/>Importing animation assets</h2>
			<p>First, we need to know <a id="_idIndexMarker401"/>how to import animation assets into Unity<a id="_idIndexMarker402"/> from <strong class="bold">digital content creation</strong> (<strong class="bold">DCC</strong>) software. As a demonstration, we still use the Unity-Chan! model asset as an example. We can find all the animation assets in the <strong class="source-inline">/Assets/unity-chan!/Unity-chan! Model/Art/Animations</strong> folder as shown in the following screenshot:</p>
			<div>
				<div id="_idContainer199" class="IMG---Figure">
					<img src="image/Figure_4.27_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.27 – The Animations folder</p>
			<p>Here we can select one animation asset in the <strong class="bold">Project</strong> window to open its <strong class="bold">Import Settings</strong> window.</p>
			<div>
				<div id="_idContainer200" class="IMG---Figure">
					<img src="image/Figure_4.28_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.28 – Import settings for animations</p>
			<p>As shown in <em class="italic">Figure 4.28</em>, click <strong class="bold">Animation</strong> in the <strong class="bold">Inspector</strong> window to switch to the <strong class="bold">Animation</strong> tab, and you can <a id="_idIndexMarker403"/>see all the Animation Clips contained in the animation asset.</p>
			<h3>Animation compression</h3>
			<p>In addition, in the <strong class="bold">Animation</strong> tab, we can<a id="_idIndexMarker404"/> also find animation-related import settings.</p>
			<div>
				<div id="_idContainer201" class="IMG---Figure">
					<img src="image/Figure_4.29_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.29 – The Anim. Compression setting</p>
			<p>As shown in <em class="italic">Figure 4.29</em>, there is a setting called <strong class="bold">Anim. Compression</strong>, whose value is <strong class="bold">Off</strong> by default, which means that Unity doesn't reduce the keyframe count on import. In this case, Unity will keep the highest precision animation, but at the expense of a large animation size. If reducing the size of the animation, whether on our hard disk or in memory, is important, we can consider the two other <strong class="bold">Anim. Compression</strong> options, which are <strong class="bold">Keyframe Reduction</strong> and <strong class="bold">Optimal</strong>.</p>
			<div>
				<div id="_idContainer202" class="IMG---Figure">
					<img src="image/Figure_4.30_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.30 – Optimal</p>
			<p>If the <strong class="bold">Keyframe Reduction</strong> option is selected, the <strong class="bold">Animation Compression Error</strong> options will be displayed, as<a id="_idIndexMarker405"/> shown in the preceding figure. The values mean how much to reduce the precision of the Animation Clip to. The default value is <strong class="source-inline">0.5</strong>; the smaller the value, the higher the precision.</p>
			<p>If the <strong class="bold">Optimal</strong> option is selected, Unity will decide how to compress the Animation Clip.</p>
			<h3>Animation Events</h3>
			<p>We can also modify the <a id="_idIndexMarker406"/>properties of a single Animation Clip. After selecting an Animation Clip in the list, we can scroll down to see the settings for this particular Animation Clip.</p>
			<div>
				<div id="_idContainer203" class="IMG---Figure">
					<img src="image/Figure_4.31_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.31 – Settings for the Animation Clip</p>
			<p>As the preceding figure shows, there is an option for the Animation Clip to add an Animation Event, which allows us to call functions in a script at a specified point in the timeline.</p>
			<p>In order to create a new Animation Event, first, we need to position the point in the timeline where we want to add the event, then click the <strong class="bold">Add Event</strong> button in the upper-left corner. A small white marker on the timeline will be created, which indicates the new event. </p>
			<p>After creating a new <a id="_idIndexMarker407"/>event, we also need to configure it by following these steps: </p>
			<ol>
				<li value="1">As we can see in <em class="italic">Figure 4.32</em>, there are multiple fields to fill in, and we entered the name <strong class="source-inline">PrintStringFromAnimationEvent</strong> in the <strong class="bold">Function</strong> field, which means this event is set up to call the <strong class="source-inline">PrintStringFromAnimationEvent</strong> function in a script attached to the GameObject. Several other fields can pass in different types of parameters for this function, such as <strong class="source-inline">Float</strong>, <strong class="source-inline">Int</strong>, and <strong class="source-inline">String</strong>.</li>
			</ol>
			<div>
				<div id="_idContainer204" class="IMG---Figure">
					<img src="image/Figure_4.32_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.32 – Add an Animation Event</p>
			<ol>
				<li value="2">After setting the event, remember to click the <strong class="bold">Apply</strong> button to make the configuration of the event take effect.</li>
			</ol>
			<p>At the same time, we need to implement a function whose name must exactly match the name already filled in the function field, namely <strong class="source-inline">PrintStringFromAnimationEvent</strong>:</p>
			<p class="source-code">    public void PrintStringFromAnimationEvent(string</p>
			<p class="source-code">      stringValue)</p>
			<p class="source-code">    {</p>
			<p class="source-code">        Debug.Log("PrintStringFromAnimationEvent is called</p>
			<p class="source-code">          with a value of " + stringValue);</p>
			<p class="source-code">    }</p>
			<p>This function will <a id="_idIndexMarker408"/>accept a string type parameter; once this Animation Event is triggered, this function will be called, and the string value will be printed in the <strong class="bold">Console</strong> window, as shown in the following figure:</p>
			<div>
				<div id="_idContainer205" class="IMG---Figure">
					<img src="image/Figure_4.33_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.33 – Print the string value in the Console window</p>
			<p>Now that we know more about importing animation assets into Unity and how to set up Animation Events, let's turn our attention to setting up the Animator Controller!</p>
			<h2 id="_idParaDest-75"><a id="_idTextAnchor071"/>Configuring the Animator Controller</h2>
			<p>After importing <a id="_idIndexMarker409"/>animation assets, we need to set up an Animator Controller to reference these Animation Clips that will be used in our game. In fact, we created an Animator Controller when we introduced it earlier and referenced two Animation Clips that will be used. However, we did not configure this Animator Controller; for instance, we did not configure how to switch between the two animations. In this section, we will explore how to configure an Animator Controller and use C# code to switch between different animations.</p>
			<h3>Adjusting the animation speed</h3>
			<p>We can view the <a id="_idIndexMarker410"/>settings of a specific state in the Animator Controller by selecting the state in the <strong class="bold">Animator</strong> window.</p>
			<div>
				<div id="_idContainer206" class="IMG---Figure">
					<img src="image/Figure_4.34_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.34 – Settings of an animation's state</p>
			<p>There are multiple <a id="_idIndexMarker411"/>settings, such as <strong class="bold">Speed</strong>, <strong class="bold">Multiplier</strong>, and <strong class="bold">Motion Time</strong>. First, let's review the <strong class="bold">Speed</strong> setting and adjust the animation speed. The default value of <strong class="bold">Speed</strong> is <strong class="source-inline">1</strong>. If the <strong class="bold">Speed</strong> value is <strong class="source-inline">0.5</strong>, the play speed of <strong class="bold">Motion Time</strong> will be halved, so it needs twice the play time. Similarly, a speed of <strong class="source-inline">2</strong> will make the play speed of <strong class="bold">Motion Time</strong> twice the normal speed and halve the play time.</p>
			<h3>Animator parameters</h3>
			<p>As we can see in <em class="italic">Figure 4.35</em>, there are other settings that require parameters to be used. These parameters <a id="_idIndexMarker412"/>are called <strong class="bold">animation parameters</strong> and they are variables defined in the Animator Controller that can be accessed and assigned values from a C# script. Therefore, they are an important part of using C# code to control animation. In order to add new parameters and edit existing parameters, we should switch to the <strong class="bold">Parameters</strong> section of the <strong class="bold">Animator</strong> window by clicking the <strong class="bold">Parameters</strong> button in the top-right corner.</p>
			<div>
				<div id="_idContainer207" class="IMG---Figure">
					<img src="image/Figure_4.35_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.35 – The Parameters section</p>
			<p>As shown in the <a id="_idIndexMarker413"/>preceding figure, the parameters can be one of the following four types:</p>
			<ul>
				<li><strong class="bold">Float</strong></li>
				<li><strong class="bold">Int</strong></li>
				<li><strong class="bold">Bool</strong></li>
				<li><strong class="bold">Trigger</strong></li>
			</ul>
			<p>As a demonstration, we can add a new parameter called <strong class="bold">SpeedMultiplier</strong>. Then, we open the settings of the <strong class="bold">POSE01</strong> animation state again and check the <strong class="bold">Parameter</strong> checkbox after the <strong class="bold">Multiplier</strong> setting, and you can see that the newly created <strong class="bold">SpeedMultiplier</strong> parameter appears.</p>
			<div>
				<div id="_idContainer208" class="IMG---Figure">
					<img src="image/Figure_4.36_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.36 – The SpeedMultiplier parameter</p>
			<p>As we mentioned earlier, these<a id="_idIndexMarker414"/> parameters can be accessed and assigned values using C# code. Therefore, we can create a new script to access and set a value of the <strong class="source-inline">SpeedMultiplier</strong> parameter as shown in the following code snippet:</p>
			<p class="source-code">using UnityEngine;</p>
			<p class="source-code">public class AnimationParametersTest : MonoBehaviour</p>
			<p class="source-code">{</p>
			<p class="source-code">[SerializeField] </p>
			<p class="source-code">private <strong class="bold">Animator</strong> _animator;</p>
			<p class="source-code">[SerializeField] </p>
			<p class="source-code">private float _speedMultiplier;</p>
			<p class="source-code">    // Start is called before the first frame update</p>
			<p class="source-code">    void Start()</p>
			<p class="source-code">    {</p>
			<p class="source-code">        if(_animator == null)</p>
			<p class="source-code">        {</p>
			<p class="source-code">            _animator = GetComponent&lt;Animator&gt;();</p>
			<p class="source-code">        }</p>
			<p class="source-code">        _animator.<strong class="bold">SetFloat("SpeedMultiplier",</strong></p>
			<p class="source-code"><strong class="bold">          _speedMultiplier)</strong>;</p>
			<p class="source-code">    }</p>
			<p class="source-code">}</p>
			<p>Here, we create a<a id="_idIndexMarker415"/> new C# script named <strong class="source-inline">AnimationParametersTest</strong> and obtain a reference to the Animator component, then we set the value of the parameter by calling the <strong class="bold">SetFloat</strong> method of the Animator component, because the type of this parameter is float. Similarly, the Animator component also has, <strong class="bold">SetInteger</strong>, <strong class="bold">SetBool</strong>, and <strong class="bold">SetTrigger</strong> methods, which are used to set values for different types of parameters.</p>
			<h3>Configuring transitions</h3>
			<p>Animation parameters can also be used to implement animation switching. We can use animation transitions to connect two animation states and switch between them. However, by default, animation transitions<a id="_idIndexMarker416"/> will automatically switch between two connected animation states, but we obviously prefer to be able to control the switching of animations when developing games. </p>
			<div>
				<div id="_idContainer209" class="IMG---Figure">
					<img src="image/Figure_4.37_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.37 – Animation transitions</p>
			<p>We can set a transition to occur only when certain conditions are true, and animation parameters can be used to determine whether these conditions are met, so we can use them here to control the switching of the animation.</p>
			<p>The following steps demonstrate how to add a<a id="_idIndexMarker417"/> new parameter, set up a condition, and control the switching of different animations from C# code:</p>
			<ol>
				<li value="1">Switch to the <strong class="bold">Parameters</strong> section of the <strong class="bold">Animator</strong> window and create a new <strong class="source-inline">bool</strong> variable parameter called <strong class="bold">Run</strong>; its default value is <strong class="bold">false</strong>, as shown in the following screenshot.</li>
			</ol>
			<div>
				<div id="_idContainer210" class="IMG---Figure">
					<img src="image/Figure_4.38_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.38 – A new parameter</p>
			<ol>
				<li value="2">Select the transition we want to apply the condition to; here we choose the transition from <strong class="bold">POSE01</strong> to <strong class="bold">POSE02</strong>.</li>
				<li>In the <strong class="bold">Inspector</strong> window of the <strong class="bold">POSE01 -&gt; POSE02</strong> transition, we can give a name such as <strong class="source-inline">Go To Run</strong> to this transition, as shown in <em class="italic">Figure 4.39</em>. </li>
			</ol>
			<p class="figure-caption">                 </p>
			<div>
				<div id="_idContainer211" class="IMG---Figure">
					<img src="image/Figure_4.39_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.39 – Name the transition</p>
			<ol>
				<li value="4">At the bottom of the <a id="_idIndexMarker418"/>same window, all the conditions for this transition are listed. By clicking the <strong class="bold">+</strong> button, add a new condition for this <strong class="bold">Go To Run</strong> transition, as shown here:</li>
			</ol>
			<div>
				<div id="_idContainer212" class="IMG---Figure">
					<img src="image/Figure_4.40_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.40 – Add a new condition</p>
			<ol>
				<li value="5">After adding a new condition, we also need to select a parameter, the value of which is considered as the condition. The parameter here is <strong class="bold">Run</strong>. When the value of the <strong class="bold">Run</strong> parameter is <strong class="bold">true</strong>, it can be considered that the condition is met.</li>
			</ol>
			<div>
				<div id="_idContainer213" class="IMG---Figure">
					<img src="image/Figure_4.41_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.41 – Select a parameter as the condition</p>
			<ol>
				<li value="6">However, the <a id="_idIndexMarker419"/>default value of the <strong class="bold">Run</strong> parameter is <strong class="bold">false</strong>. Therefore, in order to switch from <strong class="bold">POSE1</strong> to <strong class="bold">POSE2</strong>, create a C# script to set the value as follows:</li>
			</ol>
			<p class="figure-caption"> </p>
			<div>
				<div id="_idContainer214" class="IMG---Figure">
					<img src="image/Figure_4.42_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.42 – C# code snippets</p>
			<p>The <strong class="source-inline">Input.GetKey</strong> method will return <strong class="source-inline">true</strong> when the user holds down the key identified by <strong class="source-inline">KeyCode</strong>; otherwise, it will return <strong class="source-inline">false</strong>, and then we use this value to set the value of the <strong class="bold">Run</strong> parameter. Therefore, we can control the switching of the animation by pressing the key.</p>
			<p>After reading this section, we have learned how to implement animation for 3D models and how to control animation through C# code in Unity. Next, we will discuss how to implement animation for 2D assets.</p>
			<h1 id="_idParaDest-76"><a id="_idTextAnchor072"/>Implementing 2D animation in Unity</h1>
			<p>In this section, we <a id="_idIndexMarker420"/>will use the tools we explored earlier to implement 2D animation in Unity.</p>
			<p>The implementation of 2D animation is different from the implementation of 3D animation. A common implementation technique for 2D animation is to use <strong class="bold">Sprite Animations</strong>, which are <a id="_idIndexMarker421"/>Animation Clips that are created for 2D assets. </p>
			<p>There are many ways to create Sprite Animations; we can create them directly in the <strong class="bold">Animation</strong> window of the Unity Editor or create them in external tools, such as Aseprite, a popular animation sprite editor, and Piskel, a free online sprite editor.</p>
			<p>Here, we use the sprite animation created by an external tool. You can download this asset from Unity Asset Store here: <a href="https://assetstore.unity.com/packages/2d/characters/free-pixel-mob-113577">https://assetstore.unity.com/packages/2d/characters/free-pixel-mob-113577</a>.</p>
			<div>
				<div id="_idContainer215" class="IMG---Figure">
					<img src="image/Figure_4.43_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.43 – A Sprite Sheet</p>
			<p>After downloading the assets, we can find that this image contains many different Sprites, as shown in <em class="italic">Figure 4.43</em>. We call this a <strong class="bold">Sprite Sheet</strong>, which is an image containing sequential Sprites commonly used for <a id="_idIndexMarker422"/>animation for 2D assets. </p>
			<p class="callout-heading">Note</p>
			<p class="callout">If an image contains a set of non-sequential Sprite images, we<a id="_idIndexMarker423"/> call it a <strong class="bold">Sprite Atlas</strong>, which is often used to implement UI.</p>
			<p>Then, we should<a id="_idIndexMarker424"/> import this image file into the Unity Editor by performing the following steps:</p>
			<ol>
				<li value="1">As shown in <em class="italic">Figure 4.44</em>, since this image contains a series of Sprite images, we set <strong class="bold">Sprite Mode</strong> to <strong class="bold">Multiple</strong> in the <strong class="bold">Import Settings</strong> window:</li>
			</ol>
			<div>
				<div id="_idContainer216" class="IMG---Figure">
					<img src="image/Figure_4.44_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.44 – Import Settings of the Sprite Sheet</p>
			<ol>
				<li value="2">Click the <strong class="bold">Sprite Editor</strong> button to open <strong class="bold">Sprite Editor</strong> in Unity. <strong class="bold">Sprite Editor</strong> provides tools that allow us to modify Sprite Sheets, such as slicing Sprite Sheets into individual Sprites.  </li>
			</ol>
			<div>
				<div id="_idContainer217" class="IMG---Figure">
					<img src="image/Figure_4.45_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.45 – Sprite Editor in Unity</p>
			<ol>
				<li value="3">By clicking<a id="_idIndexMarker425"/> the <strong class="bold">Slice</strong> button, we can open the drop-down menu where we can set <strong class="bold">Type</strong> to <strong class="bold">Grid By Cell Count</strong>. Since there are <strong class="bold">16</strong> individual Sprite images here, in the <strong class="bold">Grid By Cell Count</strong> option, change the value of <strong class="bold">Column</strong> to <strong class="source-inline">16</strong>, change the value of <strong class="bold">Row</strong> to <strong class="source-inline">1</strong>, and then click the <strong class="bold">Slice</strong> button at the bottom of the drop-down menu and close <strong class="bold">Sprite Editor</strong>, as shown in the following screenshot:</li>
			</ol>
			<p class="figure-caption"> </p>
			<div>
				<div id="_idContainer218" class="IMG---Figure">
					<img src="image/Figure_4.46_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.46 – Grid By Cell Count</p>
			<ol>
				<li value="4">Then we can select this <strong class="bold">Sprite Sheet</strong> asset in the <strong class="bold">Project</strong> window to expand it, and you can see all the individual Sprites in it:</li>
			</ol>
			<div>
				<div id="_idContainer219" class="IMG---Figure">
					<img src="image/Figure_4.47_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.47 – Sprites in the Sprite Sheet</p>
			<p>At this point, we <a id="_idIndexMarker426"/>have imported the assets and created these sprites. The next question is, how do we use these Sprites to create Animation Clips in Unity? The answer is not complicated. We only need to select the Sprites that make up the Animation Clip we want to create and drag them into the scene. The Unity Editor will automatically create the Animation Clip and ask us to select the folder where the Animation Clip file will be stored, as shown in the following screenshot:</p>
			<div>
				<div id="_idContainer220" class="IMG---Figure">
					<img src="image/Figure_4.48_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.48 – Create an Animation Clip file</p>
			<p>In this case, we select the first eight Sprites from the Sprite Sheet and drag them to the Scene view of the Unity Editor. Then, we rename the Animation Clip file to <strong class="source-inline">walk</strong> and save it.</p>
			<p>Unity will create the <a id="_idIndexMarker427"/>Animation Clip file, as I mentioned earlier, and a new Animator Controller asset as well. A new GameObject with an Animator component attached will also be created in the Scene, which references the Animator Controller, as shown in <em class="italic">Figure 4.49</em>.</p>
			<div>
				<div id="_idContainer221" class="IMG---Figure">
					<img src="image/Figure_4.49_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.49 – New GameObject in the Scene</p>
			<p>Now we can run the game to play the animation by clicking the <strong class="bold">Play</strong> button in the Unity Editor, and we can see the <strong class="bold">walk</strong> animation is playing!</p>
			<div>
				<div id="_idContainer222" class="IMG---Figure">
					<img src="image/Figure_4.50_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.50 – Play the walk animation</p>
			<p>After reading this section, you have learned how to implement animation for 2D assets; next, we will share some tips to improve animation performance.</p>
			<h1 id="_idParaDest-77"><a id="_idTextAnchor073"/>Improving the performance of Unity's animation system</h1>
			<p>In Unity, the <a id="_idIndexMarker428"/>implementation of animation may cause excessive memory usage and CPU overhead. In this section, we will talk about how to avoid performance problems caused by animation. Specifically, we'll first introduce the <strong class="bold">Unity Profiler</strong> tool and how to use it to view animation-related performance metrics, and then we'll look at how to reduce the CPU overhead and memory footprint of animations.</p>
			<h2 id="_idParaDest-78"><a id="_idTextAnchor074"/>The Unity Profiler</h2>
			<p>First, we should<a id="_idIndexMarker429"/> learn how to use tools to view and locate performance bottlenecks rather than relying on subjective guesses and experience. Of course, it's not that experience is not important, but using tools will help you locate problems more quickly.</p>
			<p>The Unity Editor provides developers with a Profiler tool, which we can use to view the detailed memory usage of the game and real-time CPU overhead.</p>
			<p>In order to view performance data about the CPU overhead of animation, we should follow these steps:</p>
			<ol>
				<li value="1">Click <strong class="bold">Window | Analysis | Profiler</strong> to open the <strong class="bold">Profiler</strong> window.</li>
				<li>Click the <strong class="bold">CPU Usage</strong> module area in the <strong class="bold">Profiler</strong> window to view the performance data on the CPU overhead, such as the CPU time consumed by <strong class="bold">Animator.Update</strong>, as shown in <em class="italic">Figure 4.51</em>.</li>
			</ol>
			<p class="figure-caption"> </p>
			<div>
				<div id="_idContainer223" class="IMG---Figure">
					<img src="image/Figure_4.51_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.51 – The Unity Profiler</p>
			<ol>
				<li value="3">The Unity Profiler <a id="_idIndexMarker430"/>also allows us to switch from the <strong class="bold">Hierarchy</strong> view to the <strong class="bold">Timeline</strong> view, which is more intuitive in some cases.</li>
			</ol>
			<p class="figure-caption"> </p>
			<div>
				<div id="_idContainer224" class="IMG---Figure">
					<img src="image/Figure_4.52_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.52 – The Timeline view in the Profiler window</p>
			<p>In addition to the <strong class="bold">CPU Usage</strong> module, we can also view the detailed memory consumption of the game in the <strong class="bold">Memory</strong> module.</p>
			<ol>
				<li value="4">Click on the <strong class="bold">Memory</strong> module<a id="_idIndexMarker431"/> area in the <strong class="bold">Profiler</strong> window to view the performance data of memory consumption. The default display mode is <strong class="bold">Simple</strong> mode, and the memory consumption is counted by types in the <strong class="bold">Profiler</strong> window. For example, the memory usage of <strong class="bold">Textures</strong> is about 106.3 MB, and the memory usage of <strong class="bold">Meshes</strong> is about 4.5 MB, as shown here:</li>
			</ol>
			<div>
				<div id="_idContainer225" class="IMG---Figure">
					<img src="image/Figure_4.53_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.53 – Memory data in the Profiler window</p>
			<ol>
				<li value="5">Compared with <strong class="bold">Simple</strong> mode, <strong class="bold">Detailed</strong> mode is more powerful. We can switch from <strong class="bold">Simple</strong> mode to <strong class="bold">Detailed</strong> mode by selecting <strong class="bold">Detailed</strong> from the drop-down menu in the upper-left corner.</li>
			</ol>
			<p class="figure-caption"> </p>
			<div>
				<div id="_idContainer226" class="IMG---Figure">
					<img src="image/Figure_4.54_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.54 – Switch to Detailed mode</p>
			<p><strong class="bold">Detailed</strong> mode does not display memory consumption data in real time like <strong class="bold">Simple</strong> mode. Instead, we need to manually click the <strong class="bold">Take Sample</strong><em class="italic"> </em><strong class="bold">Playmode</strong> button to sample the game memory at the current time. </p>
			<div>
				<div id="_idContainer227" class="IMG---Figure">
					<img src="image/Figure_4.55_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.55 – Take a memory sample</p>
			<p>Depending on the <a id="_idIndexMarker432"/>number of objects created in the game or how much memory is consumed, the sampling time will be different. But once the sampling is complete, we will see the detailed memory overhead; for example, in the following screenshot, there are 82 Animation Clips taking up 50.1 MB of memory.</p>
			<p class="figure-caption"> </p>
			<div>
				<div id="_idContainer228" class="IMG---Figure">
					<img src="image/Figure_4.56_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.56 – Detailed memory data in the Profiler window</p>
			<p>From the preceding introduction, we can see that the optimization of animation should mainly focus on CPU overhead and memory consumption. Therefore, the following two best practices need to be considered when using Unity's animation system to implement animation.</p>
			<h2 id="_idParaDest-79"><a id="_idTextAnchor075"/>Animator's Culling Mode</h2>
			<p>In order to reduce the CPU <a id="_idIndexMarker433"/>overhead of animation, we should set the <strong class="bold">Animator</strong> window's <strong class="bold">Culling Mode</strong> property to <strong class="bold">Cull Update Transforms</strong> or <strong class="bold">Cull Completely</strong>.</p>
			<div>
				<div id="_idContainer229" class="IMG---Figure">
					<img src="image/Figure_4.57_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.57 – Animator's Culling Mode</p>
			<p>By setting it to <strong class="bold">Cull Update Transforms</strong>, Unity will disable some features of the animation system such as Retarget, Inverse Kinematics (IK) Transforms when the Animator is not visible on screen. If it is set to <strong class="bold">Cull Completely</strong>, Unity will completely disable the animation when the Animator is not visible. Therefore, the goal of reducing CPU overhead can be achieved.</p>
			<h2 id="_idParaDest-80"><a id="_idTextAnchor076"/>Anim. Compression</h2>
			<p>Another best <a id="_idIndexMarker434"/>practice is to set <strong class="bold">Anim. Compression</strong> in the animation import settings window to save memory.</p>
			<div>
				<div id="_idContainer230" class="IMG---Figure">
					<img src="image/Figure_4.58_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.58 – Anim. Compression</p>
			<p>By setting it to <strong class="bold">Keyframe Reduction</strong>, Unity will reduce keyframes on import and compress keyframes when storing animations in files. If it is set to <strong class="bold">Optimal</strong>, Unity will decide how to compress, either by reducing keyframes or by using a dense format.</p>
			<h1 id="_idParaDest-81"><a id="_idTextAnchor077"/>Summary</h1>
			<p>In this chapter, we started by introducing some of the most important concepts of the Unity animation system, such as Animation Clips, Animator Controllers, Avatar, and the Animator component. Then, we demonstrated how to implement 3D animation in Unity, including how to import animation assets into the Unity Editor, how to create an Animation Event on an Animation Clip, how to set up animation parameters to control an animation via C# code, and so on.</p>
			<p>We also discussed how to implement 2D animation in Unity. The implementation of 2D animation is different from the implementation of 3D animation. A common implementation technique for 2D animation is to use Sprite Animations, which are Animation Clips that are created for 2D assets.</p>
			<p>Finally, we explored some best practices for implementing animation in Unity to optimize the performance problems caused by the animation system.</p>
			<p>In the next chapter, we will learn about the Physics system in Unity, and at the same time, we will also introduce how to optimize Physics performance in Unity.</p>
		</div>
	</body></html>