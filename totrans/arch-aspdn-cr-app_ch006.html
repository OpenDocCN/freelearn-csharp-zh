<html xml:lang="en-US" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
<meta charset="utf-8"/>
<meta content="packt" name="generator"/>
<title>5 Minimal API</title>
<link href="../styles/stylesheet1.css" rel="stylesheet" type="text/css"/>
<link href="../styles/stylesheet2.css" rel="stylesheet" type="text/css"/>
<!-- kobo-style -->
<style id="koboSpanStyle" type="text/css" xmlns="http://www.w3.org/1999/xhtml">.koboSpan { -webkit-text-combine: inherit; }</style>
</head>
<body>
<section class="level1 pkt" data-number="6" id="minimal-api">
<h1 data-number="6"><span class="koboSpan" id="kobo.1.1" xmlns="http://www.w3.org/1999/xhtml">5 Minimal API</span></h1>
<section class="level2" data-number="6.1" id="before-you-begin-join-our-book-community-on-discord-4">
<h2 data-number="6.1"><span class="koboSpan" id="kobo.2.1" xmlns="http://www.w3.org/1999/xhtml">Before you begin: Join our book community on Discord</span></h2>
<p><span class="koboSpan" id="kobo.3.1" xmlns="http://www.w3.org/1999/xhtml">Give your feedback straight to the author himself and chat to other early readers on our Discord server (find the "architecting-aspnet-core-apps-3e" channel under EARLY ACCESS SUBSCRIPTION).</span></p>
<p><a href="https://packt.link/EarlyAccess"><span class="koboSpan" id="kobo.4.1" xmlns="http://www.w3.org/1999/xhtml">https://packt.link/EarlyAccess</span></a></p>
<p><span class="koboSpan" id="kobo.5.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Qr code Description automatically generated" src="../media/file24.png" style="width:10em"/></span></p>
<p><span class="koboSpan" id="kobo.6.1" xmlns="http://www.w3.org/1999/xhtml">This chapter covers Minimal APIs, a simplified way of setting up and running .NET applications. </span><span class="koboSpan" id="kobo.6.2" xmlns="http://www.w3.org/1999/xhtml">We explore what makes Minimal Hosting and Minimal APIs a pivotal update in ASP.NET Core as we unravel the simplicity of creating APIs with less ceremony. </span><span class="koboSpan" id="kobo.6.3" xmlns="http://www.w3.org/1999/xhtml">We cover many possibilities that ASP.NET Core Minimal API brings, like how to configure, customize, and organize those endpoints.We also explore using Minimal APIs with Data Transfer Objects (DTOs), combining simplicity with effective data management to structure API contracts effectively.Inspired by other technologies, these topics bring a fresh perspective to the .NET world, allowing us to build lean and performant APIs without compromising resiliency.In this chapter, we cover the following topics:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.7.1" xmlns="http://www.w3.org/1999/xhtml">Top-level statements</span></li>
<li><span class="koboSpan" id="kobo.8.1" xmlns="http://www.w3.org/1999/xhtml">Minimal Hosting</span></li>
<li><span class="koboSpan" id="kobo.9.1" xmlns="http://www.w3.org/1999/xhtml">Minimal APIs</span></li>
<li><span class="koboSpan" id="kobo.10.1" xmlns="http://www.w3.org/1999/xhtml">Using Minimal APIs with Data Transfer Objects</span></li>
</ul>
<p><span class="koboSpan" id="kobo.11.1" xmlns="http://www.w3.org/1999/xhtml">Let’s begin with Top-level statements.</span></p>
</section>
<section class="level2" data-number="6.2" id="top-level-statements">
<h2 data-number="6.2"><span class="koboSpan" id="kobo.12.1" xmlns="http://www.w3.org/1999/xhtml">Top-level statements</span></h2>
<p><span class="koboSpan" id="kobo.13.1" xmlns="http://www.w3.org/1999/xhtml">The .NET team introduced top-level statements to the language in .NET 5 and C# 9. </span><span class="koboSpan" id="kobo.13.2" xmlns="http://www.w3.org/1999/xhtml">From that point, writing statements before declaring namespaces and other members is possible. </span><span class="koboSpan" id="kobo.13.3" xmlns="http://www.w3.org/1999/xhtml">Under the hood, the compiler emits those statements into a </span><code><span class="koboSpan" id="kobo.14.1" xmlns="http://www.w3.org/1999/xhtml">Program.Main</span></code><span class="koboSpan" id="kobo.15.1" xmlns="http://www.w3.org/1999/xhtml"> method.With top-level statements, a minimal .NET “Hello World” console program looked like this (</span><code><span class="koboSpan" id="kobo.16.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.17.1" xmlns="http://www.w3.org/1999/xhtml">):</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.18.1" xmlns="http://www.w3.org/1999/xhtml">using System;
Console.WriteLine("Hello world!");</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.19.1" xmlns="http://www.w3.org/1999/xhtml">Unfortunately, we still need a project to run it, so we have to create a </span><code><span class="koboSpan" id="kobo.20.1" xmlns="http://www.w3.org/1999/xhtml">.csproj</span></code><span class="koboSpan" id="kobo.21.1" xmlns="http://www.w3.org/1999/xhtml"> file with the following content:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.22.1" xmlns="http://www.w3.org/1999/xhtml">&lt;Project Sdk="Microsoft.NET.Sdk"&gt;
    &lt;PropertyGroup&gt;
        &lt;TargetFramework&gt;net5.0&lt;/TargetFramework&gt;
        &lt;OutputType&gt;Exe&lt;/OutputType&gt;
    &lt;/PropertyGroup&gt;
&lt;/Project&gt;</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.23.1" xmlns="http://www.w3.org/1999/xhtml">From there, we can use the .NET CLI to </span><code><span class="koboSpan" id="kobo.24.1" xmlns="http://www.w3.org/1999/xhtml">dotnet run</span></code><span class="koboSpan" id="kobo.25.1" xmlns="http://www.w3.org/1999/xhtml"> the application, and it will output the following in the console before the program terminates:</span></p>
<div class="C0-ConsolePACKT">
<pre><code><span class="koboSpan" id="kobo.26.1" xmlns="http://www.w3.org/1999/xhtml">Hello world!</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.27.1" xmlns="http://www.w3.org/1999/xhtml">On top of such statements, we can also declare other members, like classes, and use them in our application. </span><span class="koboSpan" id="kobo.27.2" xmlns="http://www.w3.org/1999/xhtml">However, we must declare classes at the end of the top-level code.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.28.1" xmlns="http://www.w3.org/1999/xhtml">Be aware that the top-level statement code is not part of any namespace, and creating classes in a namespace is recommended, so you should limit the number of declarations done in the </span><code><span class="koboSpan" id="kobo.29.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.30.1" xmlns="http://www.w3.org/1999/xhtml"> file to what is internal to its inner workings, if anything.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.31.1" xmlns="http://www.w3.org/1999/xhtml">Top-level statements are great for getting started with C#, writing code samples, and cutting out boilerplate code.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.32.1" xmlns="http://www.w3.org/1999/xhtml">The highlighted line of the preceding C# code (</span><code><span class="koboSpan" id="kobo.33.1" xmlns="http://www.w3.org/1999/xhtml">using System;</span></code><span class="koboSpan" id="kobo.34.1" xmlns="http://www.w3.org/1999/xhtml">) is unnecessary when the </span><em><span class="koboSpan" id="kobo.35.1" xmlns="http://www.w3.org/1999/xhtml">implicit usings</span></em><span class="koboSpan" id="kobo.36.1" xmlns="http://www.w3.org/1999/xhtml"> feature is enabled, which is the default in .NET 6+ projects. </span><span class="koboSpan" id="kobo.36.2" xmlns="http://www.w3.org/1999/xhtml">The templates add the following line to the </span><code><span class="koboSpan" id="kobo.37.1" xmlns="http://www.w3.org/1999/xhtml">.csproj</span></code><span class="koboSpan" id="kobo.38.1" xmlns="http://www.w3.org/1999/xhtml"> file:</span></p>
</blockquote>
<pre><code><span class="koboSpan" id="kobo.39.1" xmlns="http://www.w3.org/1999/xhtml">&lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;</span></code></pre>
<p><span class="koboSpan" id="kobo.40.1" xmlns="http://www.w3.org/1999/xhtml">Next, we explore the minimal hosting model built using top-level statements.</span></p>
</section>
<section class="level2" data-number="6.3" id="minimal-hosting-1">
<h2 data-number="6.3"><span class="koboSpan" id="kobo.41.1" xmlns="http://www.w3.org/1999/xhtml">Minimal Hosting</span></h2>
<p><span class="koboSpan" id="kobo.42.1" xmlns="http://www.w3.org/1999/xhtml">.NET 6 introduced the minimal hosting model. </span><span class="koboSpan" id="kobo.42.2" xmlns="http://www.w3.org/1999/xhtml">It combines the </span><code><span class="koboSpan" id="kobo.43.1" xmlns="http://www.w3.org/1999/xhtml">Startup</span></code><span class="koboSpan" id="kobo.44.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.45.1" xmlns="http://www.w3.org/1999/xhtml">Program</span></code><span class="koboSpan" id="kobo.46.1" xmlns="http://www.w3.org/1999/xhtml"> classes into a single </span><code><span class="koboSpan" id="kobo.47.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.48.1" xmlns="http://www.w3.org/1999/xhtml"> file. </span><span class="koboSpan" id="kobo.48.2" xmlns="http://www.w3.org/1999/xhtml">It leverages top-level statements to minimize the boilerplate code necessary to bootstrap the application. </span><span class="koboSpan" id="kobo.48.3" xmlns="http://www.w3.org/1999/xhtml">It also uses </span><em><span class="koboSpan" id="kobo.49.1" xmlns="http://www.w3.org/1999/xhtml">global using directives</span></em><span class="koboSpan" id="kobo.50.1" xmlns="http://www.w3.org/1999/xhtml"> and the </span><em><span class="koboSpan" id="kobo.51.1" xmlns="http://www.w3.org/1999/xhtml">implicit usings</span></em><span class="koboSpan" id="kobo.52.1" xmlns="http://www.w3.org/1999/xhtml"> feature to reduce the amount of boilerplate code further. </span><span class="koboSpan" id="kobo.52.2" xmlns="http://www.w3.org/1999/xhtml">This model only requires one file with the following three lines of code to create a web application:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.53.1" xmlns="http://www.w3.org/1999/xhtml">var builder = WebApplication.CreateBuilder(args);
var app = builder.Build();
app.Run();</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.54.1" xmlns="http://www.w3.org/1999/xhtml">Let’s call that way leaner than before. </span><span class="koboSpan" id="kobo.54.2" xmlns="http://www.w3.org/1999/xhtml">Of course, the preceding code starts an app that does nothing, but doing the same before would have required tens of lines of code.The minimal hosting code is divided into two pieces:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.55.1" xmlns="http://www.w3.org/1999/xhtml">The </span><em><span class="koboSpan" id="kobo.56.1" xmlns="http://www.w3.org/1999/xhtml">web application builder</span></em><span class="koboSpan" id="kobo.57.1" xmlns="http://www.w3.org/1999/xhtml"> we use to configure the application, register services, settings, environment, logging, and more (the highlighted code).</span></li>
<li><span class="koboSpan" id="kobo.58.1" xmlns="http://www.w3.org/1999/xhtml">The </span><em><span class="koboSpan" id="kobo.59.1" xmlns="http://www.w3.org/1999/xhtml">web application</span></em><span class="koboSpan" id="kobo.60.1" xmlns="http://www.w3.org/1999/xhtml"> we use to configure the HTTP pipeline and routes (the non-highlighted lines).</span></li>
</ul>
<p><span class="koboSpan" id="kobo.61.1" xmlns="http://www.w3.org/1999/xhtml">That simplified model led to minimal APIs that we explore next.</span></p>
</section>
<section class="level2" data-number="6.4" id="minimal-apis">
<h2 data-number="6.4"><span class="koboSpan" id="kobo.62.1" xmlns="http://www.w3.org/1999/xhtml">Minimal APIs</span></h2>
<p><span class="koboSpan" id="kobo.63.1" xmlns="http://www.w3.org/1999/xhtml">ASP.NET Core’s Minimal APIs are built on the minimal hosting model and bring a lean approach to constructing web applications. </span><span class="koboSpan" id="kobo.63.2" xmlns="http://www.w3.org/1999/xhtml">Highly inspired by Node.js, they facilitate the development of APIs by reducing the boilerplate code. </span><span class="koboSpan" id="kobo.63.3" xmlns="http://www.w3.org/1999/xhtml">By emphasizing simplicity and performance, they enhance readability and maintainability. </span><span class="koboSpan" id="kobo.63.4" xmlns="http://www.w3.org/1999/xhtml">They are an excellent fit for microservices architecture and applications that aim to remain lean.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.64.1" xmlns="http://www.w3.org/1999/xhtml">You can also build large applications using Minimal APIs; the word minimal refers to their lean approach, not the type of application you can make with them.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.65.1" xmlns="http://www.w3.org/1999/xhtml">This minimalist approach does compromise a little on functionalities but improves flexibility and speed, ensuring you have complete control over your API’s behavior while keeping your project lean and efficient. </span><span class="koboSpan" id="kobo.65.2" xmlns="http://www.w3.org/1999/xhtml">Minimal APIs include the necessary features we need for most applications, like model binding, dependency injection, filters, and a route-to-delegate model. </span><span class="koboSpan" id="kobo.65.3" xmlns="http://www.w3.org/1999/xhtml">If you need all the features from MVC, you can still opt to use MVC. </span><span class="koboSpan" id="kobo.65.4" xmlns="http://www.w3.org/1999/xhtml">You can even use both; this is not one or the other.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.66.1" xmlns="http://www.w3.org/1999/xhtml">We explore the Model-View-Controller (MVC) pattern in </span><em><span class="koboSpan" id="kobo.67.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 6</span></em><span class="koboSpan" id="kobo.68.1" xmlns="http://www.w3.org/1999/xhtml">, </span><em><span class="koboSpan" id="kobo.69.1" xmlns="http://www.w3.org/1999/xhtml">MVC</span></em><span class="koboSpan" id="kobo.70.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.71.1" xmlns="http://www.w3.org/1999/xhtml">Let’s have a look at how to map routes next.</span></p>
<section class="level3" data-number="6.4.1" id="map-route-to-delegate">
<h3 data-number="6.4.1"><span class="koboSpan" id="kobo.72.1" xmlns="http://www.w3.org/1999/xhtml">Map route-to-delegate</span></h3>
<p><span class="koboSpan" id="kobo.73.1" xmlns="http://www.w3.org/1999/xhtml">How does it work? </span><span class="koboSpan" id="kobo.73.2" xmlns="http://www.w3.org/1999/xhtml">Minimal APIs bring multiple extension methods to configure the HTTP pipeline and configure endpoints. </span><span class="koboSpan" id="kobo.73.3" xmlns="http://www.w3.org/1999/xhtml">We can use those methods to map a route (a URL pattern) to a </span><code><span class="koboSpan" id="kobo.74.1" xmlns="http://www.w3.org/1999/xhtml">RequestDelegate</span></code><span class="koboSpan" id="kobo.75.1" xmlns="http://www.w3.org/1999/xhtml"> delegate.We can use the following methods to map different HTTP methods:</span></p>
<table>
<tbody>
<tr class="odd">
<td><strong><span class="koboSpan" id="kobo.76.1" xmlns="http://www.w3.org/1999/xhtml">Method</span></strong></td>
<td><strong><span class="koboSpan" id="kobo.77.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></strong></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.78.1" xmlns="http://www.w3.org/1999/xhtml">MapGet</span></code></td>
<td><span class="koboSpan" id="kobo.79.1" xmlns="http://www.w3.org/1999/xhtml">Maps a </span><code><span class="koboSpan" id="kobo.80.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code><span class="koboSpan" id="kobo.81.1" xmlns="http://www.w3.org/1999/xhtml"> request to a </span><code><span class="koboSpan" id="kobo.82.1" xmlns="http://www.w3.org/1999/xhtml">RequestDelegate</span></code><span class="koboSpan" id="kobo.83.1" xmlns="http://www.w3.org/1999/xhtml"> .</span></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.84.1" xmlns="http://www.w3.org/1999/xhtml">MapPost</span></code></td>
<td><span class="koboSpan" id="kobo.85.1" xmlns="http://www.w3.org/1999/xhtml">Maps a </span><code><span class="koboSpan" id="kobo.86.1" xmlns="http://www.w3.org/1999/xhtml">POST</span></code><span class="koboSpan" id="kobo.87.1" xmlns="http://www.w3.org/1999/xhtml"> request to a </span><code><span class="koboSpan" id="kobo.88.1" xmlns="http://www.w3.org/1999/xhtml">RequestDelegate</span></code><span class="koboSpan" id="kobo.89.1" xmlns="http://www.w3.org/1999/xhtml"> .</span></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.90.1" xmlns="http://www.w3.org/1999/xhtml">MapPut</span></code></td>
<td><span class="koboSpan" id="kobo.91.1" xmlns="http://www.w3.org/1999/xhtml">Maps a </span><code><span class="koboSpan" id="kobo.92.1" xmlns="http://www.w3.org/1999/xhtml">PUT</span></code><span class="koboSpan" id="kobo.93.1" xmlns="http://www.w3.org/1999/xhtml"> request to a </span><code><span class="koboSpan" id="kobo.94.1" xmlns="http://www.w3.org/1999/xhtml">RequestDelegate</span></code><span class="koboSpan" id="kobo.95.1" xmlns="http://www.w3.org/1999/xhtml"> .</span></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.96.1" xmlns="http://www.w3.org/1999/xhtml">MapDelete</span></code></td>
<td><span class="koboSpan" id="kobo.97.1" xmlns="http://www.w3.org/1999/xhtml">Maps a </span><code><span class="koboSpan" id="kobo.98.1" xmlns="http://www.w3.org/1999/xhtml">DELETE</span></code><span class="koboSpan" id="kobo.99.1" xmlns="http://www.w3.org/1999/xhtml"> request to a </span><code><span class="koboSpan" id="kobo.100.1" xmlns="http://www.w3.org/1999/xhtml">RequestDelegate</span></code><span class="koboSpan" id="kobo.101.1" xmlns="http://www.w3.org/1999/xhtml"> .</span></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.102.1" xmlns="http://www.w3.org/1999/xhtml">MapMethods</span></code></td>
<td><span class="koboSpan" id="kobo.103.1" xmlns="http://www.w3.org/1999/xhtml">Maps a route pattern and multiple HTTP methods to a </span><code><span class="koboSpan" id="kobo.104.1" xmlns="http://www.w3.org/1999/xhtml">RequestDelegate</span></code><span class="koboSpan" id="kobo.105.1" xmlns="http://www.w3.org/1999/xhtml"> .</span></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.106.1" xmlns="http://www.w3.org/1999/xhtml">Map</span></code></td>
<td><span class="koboSpan" id="kobo.107.1" xmlns="http://www.w3.org/1999/xhtml">Maps a route pattern to a </span><code><span class="koboSpan" id="kobo.108.1" xmlns="http://www.w3.org/1999/xhtml">RequestDelegate</span></code><span class="koboSpan" id="kobo.109.1" xmlns="http://www.w3.org/1999/xhtml"> .</span></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.110.1" xmlns="http://www.w3.org/1999/xhtml">MapFallback</span></code></td>
<td><span class="koboSpan" id="kobo.111.1" xmlns="http://www.w3.org/1999/xhtml">Maps a fallback </span><code><span class="koboSpan" id="kobo.112.1" xmlns="http://www.w3.org/1999/xhtml">RequestDelegate</span></code><span class="koboSpan" id="kobo.113.1" xmlns="http://www.w3.org/1999/xhtml"> which runs when no other routes match.</span></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.114.1" xmlns="http://www.w3.org/1999/xhtml">MapGroup</span></code></td>
<td><span class="koboSpan" id="kobo.115.1" xmlns="http://www.w3.org/1999/xhtml">Allows configuring a route pattern and properties that apply to all endpoints defined under that group.</span></td>
</tr>
</tbody>
</table><span class="koboSpan" id="kobo.116.1" xmlns="http://www.w3.org/1999/xhtml">
Table 5.1: Map route-to-delegate extension methods.
</span><p><span class="koboSpan" id="kobo.117.1" xmlns="http://www.w3.org/1999/xhtml">Here’s a minimal GET example:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.118.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGet("minimal-endpoint-inline", () =&gt; "GET!");</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.119.1" xmlns="http://www.w3.org/1999/xhtml">When executing the program, navigating to the </span><code><span class="koboSpan" id="kobo.120.1" xmlns="http://www.w3.org/1999/xhtml">/minimal-endpoint-inline</span></code><span class="koboSpan" id="kobo.121.1" xmlns="http://www.w3.org/1999/xhtml"> URI routes the request to the registered </span><code><span class="koboSpan" id="kobo.122.1" xmlns="http://www.w3.org/1999/xhtml">RequestDelegate</span></code><span class="koboSpan" id="kobo.123.1" xmlns="http://www.w3.org/1999/xhtml"> (highlighted code), which outputs the following string:</span></p>
<div class="C0-ConsolePACKT">
<pre><code><span class="koboSpan" id="kobo.124.1" xmlns="http://www.w3.org/1999/xhtml">GET!</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.125.1" xmlns="http://www.w3.org/1999/xhtml">As simple as that, we can route requests to delegates and create endpoints.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.126.1" xmlns="http://www.w3.org/1999/xhtml">On top of registering endpoints, we can also register middleware like any other ASP.NET Core application. </span><span class="koboSpan" id="kobo.126.2" xmlns="http://www.w3.org/1999/xhtml">Moreover, the built-in middlewares, like authentication and CORS, work the same with Minimal APIs.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.127.1" xmlns="http://www.w3.org/1999/xhtml">Next, we explore ways to configure endpoints so we can create better APIs than an endpoint returning a literal string.</span></p>
</section>
<section class="level3" data-number="6.4.2" id="configuring-endpoints">
<h3 data-number="6.4.2"><span class="koboSpan" id="kobo.128.1" xmlns="http://www.w3.org/1999/xhtml">Configuring endpoints</span></h3>
<p><span class="koboSpan" id="kobo.129.1" xmlns="http://www.w3.org/1999/xhtml">Now that we know that with minimal APIs, we map routes to delegates and that we have learned of a few methods to do that, let’s explore how to register the delegates:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.130.1" xmlns="http://www.w3.org/1999/xhtml">Inline, as with the preceding example.</span></li>
<li><span class="koboSpan" id="kobo.131.1" xmlns="http://www.w3.org/1999/xhtml">Using a method.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.132.1" xmlns="http://www.w3.org/1999/xhtml">To declare the delegate inline, we can do the following:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.133.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGet("minimal-endpoint-inline", () =&gt; "GET!");</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.134.1" xmlns="http://www.w3.org/1999/xhtml">To use a method, we can do the following:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.135.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGet("minimal-endpoint-method", MyMethod);
void MyMethod() { }</span></code></pre>
</div>
<blockquote>
<p><span class="koboSpan" id="kobo.136.1" xmlns="http://www.w3.org/1999/xhtml">When enabled, ASP.NET Core registers the class name that contains the method with the </span><code><span class="koboSpan" id="kobo.137.1" xmlns="http://www.w3.org/1999/xhtml">ApiExplorer</span></code><span class="koboSpan" id="kobo.138.1" xmlns="http://www.w3.org/1999/xhtml"> as a tag. </span><span class="koboSpan" id="kobo.138.2" xmlns="http://www.w3.org/1999/xhtml">We dig deeper into metadata further in the chapter.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.139.1" xmlns="http://www.w3.org/1999/xhtml">All the concepts we explore in this chapter apply to both ways of registering delegates. </span><span class="koboSpan" id="kobo.139.2" xmlns="http://www.w3.org/1999/xhtml">Let’s start by studying how to input data in our endpoints.</span></p>
<section class="level4" data-number="6.4.2.1" id="inputs">
<h4 data-number="6.4.2.1"><span class="koboSpan" id="kobo.140.1" xmlns="http://www.w3.org/1999/xhtml">Inputs</span></h4>
<p><span class="koboSpan" id="kobo.141.1" xmlns="http://www.w3.org/1999/xhtml">An endpoint rarely has no parameter (no input value). </span><span class="koboSpan" id="kobo.141.2" xmlns="http://www.w3.org/1999/xhtml">Minimal APIs, like MVC, support a wide variety of binding sources. </span><span class="koboSpan" id="kobo.141.3" xmlns="http://www.w3.org/1999/xhtml">A binding source represents the conversion from the HTTP request into a strongly typed C# object, inputted as a parameter. </span><span class="koboSpan" id="kobo.141.4" xmlns="http://www.w3.org/1999/xhtml">Most of the parameter binding happens implicitly, but in case you need to bind a parameter explicitly, here are the supported binding sources:</span></p>
<table>
<tbody>
<tr class="odd">
<td><strong><span class="koboSpan" id="kobo.142.1" xmlns="http://www.w3.org/1999/xhtml">Source</span></strong></td>
<td><strong><span class="koboSpan" id="kobo.143.1" xmlns="http://www.w3.org/1999/xhtml">Attribute</span></strong></td>
<td><strong><span class="koboSpan" id="kobo.144.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></strong></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.145.1" xmlns="http://www.w3.org/1999/xhtml">Route</span></code></td>
<td><code><span class="koboSpan" id="kobo.146.1" xmlns="http://www.w3.org/1999/xhtml">[FromRoute]</span></code></td>
<td><span class="koboSpan" id="kobo.147.1" xmlns="http://www.w3.org/1999/xhtml">Binds the route value that matches the name of the parameter.</span></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.148.1" xmlns="http://www.w3.org/1999/xhtml">Query</span></code></td>
<td><code><span class="koboSpan" id="kobo.149.1" xmlns="http://www.w3.org/1999/xhtml">[FromQuery]</span></code></td>
<td><span class="koboSpan" id="kobo.150.1" xmlns="http://www.w3.org/1999/xhtml">Binds the query string value that matches the name of the parameter.</span></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.151.1" xmlns="http://www.w3.org/1999/xhtml">Header</span></code></td>
<td><code><span class="koboSpan" id="kobo.152.1" xmlns="http://www.w3.org/1999/xhtml">[FromHeader]</span></code></td>
<td><span class="koboSpan" id="kobo.153.1" xmlns="http://www.w3.org/1999/xhtml">Binds the HTTP header value that matches the name of the parameter.</span></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.154.1" xmlns="http://www.w3.org/1999/xhtml">Body</span></code></td>
<td><code><span class="koboSpan" id="kobo.155.1" xmlns="http://www.w3.org/1999/xhtml">[FromBody]</span></code></td>
<td><span class="koboSpan" id="kobo.156.1" xmlns="http://www.w3.org/1999/xhtml">Binds the JSON body of the request to the parameter’s type.</span></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.157.1" xmlns="http://www.w3.org/1999/xhtml">Form</span></code></td>
<td><code><span class="koboSpan" id="kobo.158.1" xmlns="http://www.w3.org/1999/xhtml">[FromForm]</span></code></td>
<td><span class="koboSpan" id="kobo.159.1" xmlns="http://www.w3.org/1999/xhtml">Binds the form value that matches the name of the parameter.</span></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.160.1" xmlns="http://www.w3.org/1999/xhtml">Services</span></code></td>
<td><code><span class="koboSpan" id="kobo.161.1" xmlns="http://www.w3.org/1999/xhtml">[FromServices]</span></code></td>
<td><span class="koboSpan" id="kobo.162.1" xmlns="http://www.w3.org/1999/xhtml">Inject the service from the ASP.NET Core dependency container.</span></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.163.1" xmlns="http://www.w3.org/1999/xhtml">Custom</span></code></td>
<td><code><span class="koboSpan" id="kobo.164.1" xmlns="http://www.w3.org/1999/xhtml">[AsParameters]</span></code></td>
<td><span class="koboSpan" id="kobo.165.1" xmlns="http://www.w3.org/1999/xhtml">Binds the form values to a type. </span><span class="koboSpan" id="kobo.165.2" xmlns="http://www.w3.org/1999/xhtml">The matches happen between the form keys and the properties' names.</span></td>
</tr>
</tbody>
</table><span class="koboSpan" id="kobo.166.1" xmlns="http://www.w3.org/1999/xhtml">
Table 5.2: supported binding sources
</span><p><span class="koboSpan" id="kobo.167.1" xmlns="http://www.w3.org/1999/xhtml">Next is a demo where we implicitly bind the </span><code><span class="koboSpan" id="kobo.168.1" xmlns="http://www.w3.org/1999/xhtml">id</span></code><span class="koboSpan" id="kobo.169.1" xmlns="http://www.w3.org/1999/xhtml"> parameter from the route (highlighted code) to a parameter in the delegate:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.170.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGet(
    "minimal-endpoint-input-route-implicit/{id}", 
    (int id) =&gt; $"The id was {id}."
</span><span class="koboSpan" id="kobo.170.2" xmlns="http://www.w3.org/1999/xhtml">);</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.171.1" xmlns="http://www.w3.org/1999/xhtml">In most cases, the bindings work implicitly. </span><span class="koboSpan" id="kobo.171.2" xmlns="http://www.w3.org/1999/xhtml">However, you can explicitly bind the delegate’s parameters like this:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.172.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGet(
    "minimal-endpoint-input-route-explicit/{id}",
    ([FromRoute] int id) =&gt; $"The id was {id}."
</span><span class="koboSpan" id="kobo.172.2" xmlns="http://www.w3.org/1999/xhtml">);</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.173.1" xmlns="http://www.w3.org/1999/xhtml">We can also implicitly inject dependencies into our delegates and even mix that with a route parameter like this:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.174.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGet(
    "minimal-endpoint-input-service/{value}",
    (string value, SomeInternalService service)
        =&gt; service.Respond(value)
);
public class SomeInternalService {
    public string Respond(string value)
        =&gt; $"The value was {value}";
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.175.1" xmlns="http://www.w3.org/1999/xhtml">Following this pattern opens endless possibilities to input data into our endpoints.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.176.1" xmlns="http://www.w3.org/1999/xhtml">If you are unfamiliar with Dependency Injection (DI), we explore DI more in-depth in </span><em><span class="koboSpan" id="kobo.177.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 8</span></em><span class="koboSpan" id="kobo.178.1" xmlns="http://www.w3.org/1999/xhtml">, </span><em><span class="koboSpan" id="kobo.179.1" xmlns="http://www.w3.org/1999/xhtml">Dependency Injection</span></em><span class="koboSpan" id="kobo.180.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.180.2" xmlns="http://www.w3.org/1999/xhtml">Meanwhile, remember that we can bind objects to parameters, whether they are a DTO or a service.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.181.1" xmlns="http://www.w3.org/1999/xhtml">On top of that, ASP.NET Core provides us with a few special types, which we explore next.</span></p>
<section class="level5" data-number="6.4.2.1.1" id="special-types">
<h5 data-number="6.4.2.1.1"><span class="koboSpan" id="kobo.182.1" xmlns="http://www.w3.org/1999/xhtml">Special types</span></h5>
<p><span class="koboSpan" id="kobo.183.1" xmlns="http://www.w3.org/1999/xhtml">We can inject the following objects into our delegates as parameters, and ASP.NET Core manages them for us:</span></p>
<table>
<colgroup>
<col style="width: 50%"/>
<col style="width: 50%"/>
</colgroup>
<tbody>
<tr class="odd">
<td><strong><span class="koboSpan" id="kobo.184.1" xmlns="http://www.w3.org/1999/xhtml">Class</span></strong></td>
<td><strong><span class="koboSpan" id="kobo.185.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></strong></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.186.1" xmlns="http://www.w3.org/1999/xhtml">HttpContext</span></code></td>
<td><p><span class="koboSpan" id="kobo.187.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.188.1" xmlns="http://www.w3.org/1999/xhtml">HttpContext</span></code><span class="koboSpan" id="kobo.189.1" xmlns="http://www.w3.org/1999/xhtml"> encompasses all the current HTTP request and response details.</span></p>
<p><span class="koboSpan" id="kobo.190.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.191.1" xmlns="http://www.w3.org/1999/xhtml">HttpContext</span></code><span class="koboSpan" id="kobo.192.1" xmlns="http://www.w3.org/1999/xhtml"> exposes all the other special types we are exploring here, so if you need more than one, you can inject the </span><code><span class="koboSpan" id="kobo.193.1" xmlns="http://www.w3.org/1999/xhtml">HttpContext</span></code><span class="koboSpan" id="kobo.194.1" xmlns="http://www.w3.org/1999/xhtml"> directly to reduce the number of parameters.</span></p></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.195.1" xmlns="http://www.w3.org/1999/xhtml">HttpRequest</span></code></td>
<td><span class="koboSpan" id="kobo.196.1" xmlns="http://www.w3.org/1999/xhtml">We can use the </span><code><span class="koboSpan" id="kobo.197.1" xmlns="http://www.w3.org/1999/xhtml">HttpRequest</span></code><span class="koboSpan" id="kobo.198.1" xmlns="http://www.w3.org/1999/xhtml"> to do basic HTTP operations on the current request, like query the parameters manually and bypass the ASP.NET Core data-binding mechanism. </span><span class="koboSpan" id="kobo.198.2" xmlns="http://www.w3.org/1999/xhtml">Same as the </span><code><span class="koboSpan" id="kobo.199.1" xmlns="http://www.w3.org/1999/xhtml">HttpContext.Request</span></code><span class="koboSpan" id="kobo.200.1" xmlns="http://www.w3.org/1999/xhtml"> property.</span></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.201.1" xmlns="http://www.w3.org/1999/xhtml">HttpResponse</span></code></td>
<td><span class="koboSpan" id="kobo.202.1" xmlns="http://www.w3.org/1999/xhtml">Like the </span><code><span class="koboSpan" id="kobo.203.1" xmlns="http://www.w3.org/1999/xhtml">HttpRequest</span></code><span class="koboSpan" id="kobo.204.1" xmlns="http://www.w3.org/1999/xhtml"> , we can leverage the </span><code><span class="koboSpan" id="kobo.205.1" xmlns="http://www.w3.org/1999/xhtml">HttpResponse</span></code><span class="koboSpan" id="kobo.206.1" xmlns="http://www.w3.org/1999/xhtml"> object to execute manual operations on the HTTP response, like writing directly to the response stream, managing HTTP headers manually, etc. </span><span class="koboSpan" id="kobo.206.2" xmlns="http://www.w3.org/1999/xhtml">Same as the </span><code><span class="koboSpan" id="kobo.207.1" xmlns="http://www.w3.org/1999/xhtml">HttpContext.Response</span></code><span class="koboSpan" id="kobo.208.1" xmlns="http://www.w3.org/1999/xhtml"> property.</span></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.209.1" xmlns="http://www.w3.org/1999/xhtml">CancellationToken</span></code></td>
<td><span class="koboSpan" id="kobo.210.1" xmlns="http://www.w3.org/1999/xhtml">Passing a cancellation token to an asynchronous operation is a recommended practice. </span><span class="koboSpan" id="kobo.210.2" xmlns="http://www.w3.org/1999/xhtml">In this case, it allows canceling the operation when the request is canceled. </span><span class="koboSpan" id="kobo.210.3" xmlns="http://www.w3.org/1999/xhtml">Same as the </span><code><span class="koboSpan" id="kobo.211.1" xmlns="http://www.w3.org/1999/xhtml">HttpContext.RequestAborted</span></code><span class="koboSpan" id="kobo.212.1" xmlns="http://www.w3.org/1999/xhtml"> property.</span></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.213.1" xmlns="http://www.w3.org/1999/xhtml">ClaimsPrincipal</span></code></td>
<td><span class="koboSpan" id="kobo.214.1" xmlns="http://www.w3.org/1999/xhtml">To access the current user, we can inject a </span><code><span class="koboSpan" id="kobo.215.1" xmlns="http://www.w3.org/1999/xhtml">ClaimsPrincipal</span></code><span class="koboSpan" id="kobo.216.1" xmlns="http://www.w3.org/1999/xhtml"> instance. </span><span class="koboSpan" id="kobo.216.2" xmlns="http://www.w3.org/1999/xhtml">Same as the </span><code><span class="koboSpan" id="kobo.217.1" xmlns="http://www.w3.org/1999/xhtml">HttpContext.User</span></code><span class="koboSpan" id="kobo.218.1" xmlns="http://www.w3.org/1999/xhtml"> property.</span></td>
</tr>
</tbody>
</table><span class="koboSpan" id="kobo.219.1" xmlns="http://www.w3.org/1999/xhtml">
Tabel 5.3: special HTTP types
</span><p><span class="koboSpan" id="kobo.220.1" xmlns="http://www.w3.org/1999/xhtml">Here’s an example where two endpoints write to the response stream, one using the </span><code><span class="koboSpan" id="kobo.221.1" xmlns="http://www.w3.org/1999/xhtml">HttpContext</span></code><span class="koboSpan" id="kobo.222.1" xmlns="http://www.w3.org/1999/xhtml"> and the other the </span><code><span class="koboSpan" id="kobo.223.1" xmlns="http://www.w3.org/1999/xhtml">HttpResponse</span></code><span class="koboSpan" id="kobo.224.1" xmlns="http://www.w3.org/1999/xhtml"> object:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.225.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGet(
    "minimal-endpoint-input-HttpContext/",
    (HttpContext context)
        =&gt; context.Response.WriteAsync("HttpContext!")
);
app.MapGet(
    "minimal-endpoint-input-HttpResponse/",
    (HttpResponse response)
        =&gt; response.WriteAsync("HttpResponse!")
);</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.226.1" xmlns="http://www.w3.org/1999/xhtml">We can treat those special types like any other bindings and seamlessly integrate them with other types, such as route values and services.We cover one last piece of data-binding next.</span></p>
</section>
<section class="level5" data-number="6.4.2.1.2" id="custom-binding">
<h5 data-number="6.4.2.1.2"><span class="koboSpan" id="kobo.227.1" xmlns="http://www.w3.org/1999/xhtml">Custom binding</span></h5>
<p><span class="koboSpan" id="kobo.228.1" xmlns="http://www.w3.org/1999/xhtml">We can manually bind data from the request to an instance of a custom class. </span><span class="koboSpan" id="kobo.228.2" xmlns="http://www.w3.org/1999/xhtml">We can achieve this in the following ways:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.229.1" xmlns="http://www.w3.org/1999/xhtml">Create a static </span><code><span class="koboSpan" id="kobo.230.1" xmlns="http://www.w3.org/1999/xhtml">TryParse</span></code><span class="koboSpan" id="kobo.231.1" xmlns="http://www.w3.org/1999/xhtml"> method that parses a string from a route, query, or header value.</span></li>
<li><span class="koboSpan" id="kobo.232.1" xmlns="http://www.w3.org/1999/xhtml">Create a static </span><code><span class="koboSpan" id="kobo.233.1" xmlns="http://www.w3.org/1999/xhtml">BindAsync</span></code><span class="koboSpan" id="kobo.234.1" xmlns="http://www.w3.org/1999/xhtml"> method that directly controls the binding process using the </span><code><span class="koboSpan" id="kobo.235.1" xmlns="http://www.w3.org/1999/xhtml">HttpContext</span></code><span class="koboSpan" id="kobo.236.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.237.1" xmlns="http://www.w3.org/1999/xhtml">We must write those static methods in the class we intend to create using the HTTP request’s data. </span><span class="koboSpan" id="kobo.237.2" xmlns="http://www.w3.org/1999/xhtml">We explore those two scenarios next.</span></p>
<section class="level6" data-number="6.4.2.1.2.1" id="manual-parsing">
<h6 data-number="6.4.2.1.2.1"><span class="koboSpan" id="kobo.238.1" xmlns="http://www.w3.org/1999/xhtml">Manual parsing</span></h6>
<p><span class="koboSpan" id="kobo.239.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.240.1" xmlns="http://www.w3.org/1999/xhtml">TryParse</span></code><span class="koboSpan" id="kobo.241.1" xmlns="http://www.w3.org/1999/xhtml"> method takes a string and an </span><code><span class="koboSpan" id="kobo.242.1" xmlns="http://www.w3.org/1999/xhtml">out</span></code><span class="koboSpan" id="kobo.243.1" xmlns="http://www.w3.org/1999/xhtml"> parameter of the type itself. </span><span class="koboSpan" id="kobo.243.2" xmlns="http://www.w3.org/1999/xhtml">The framework uses that method to parse a value into the desired type.The parsing API supports the implementation of one of the following methods:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.244.1" xmlns="http://www.w3.org/1999/xhtml">public static bool TryParse(string value, TSelf out result);
public static bool TryParse(string value, IFormatProvider provider, TSelf out result);</span></code></pre>
</div>
<blockquote>
<p><span class="koboSpan" id="kobo.245.1" xmlns="http://www.w3.org/1999/xhtml">Implementing the </span><code><span class="koboSpan" id="kobo.246.1" xmlns="http://www.w3.org/1999/xhtml">IParsable&lt;TSelf&gt;</span></code><span class="koboSpan" id="kobo.247.1" xmlns="http://www.w3.org/1999/xhtml"> interface provides the appropriate </span><code><span class="koboSpan" id="kobo.248.1" xmlns="http://www.w3.org/1999/xhtml">TryParse</span></code><span class="koboSpan" id="kobo.249.1" xmlns="http://www.w3.org/1999/xhtml"> method.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.250.1" xmlns="http://www.w3.org/1999/xhtml">Here is an example that parses latitude and longitude coordinates:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.251.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGet(
    "minimal-endpoint-input-Coordinate/",
    (Coordinate coordinate) =&gt; coordinate
);
public class Coordinate : IParsable&lt;Coordinate&gt;
{
    public double Latitude { get; set; }
    public double Longitude { get; set; }
    public static Coordinate Parse(
        string value, 
        IFormatProvider? </span><span class="koboSpan" id="kobo.251.2" xmlns="http://www.w3.org/1999/xhtml">provider)
    {
        if (TryParse(value, provider, out var result))
        {
            return result;
        }
        throw new ArgumentException(
            "Cannot parse the value into a Coordinate.",
            nameof(value)
        );
    }
    public static bool TryParse(
        [NotNullWhen(true)] string? </span><span class="koboSpan" id="kobo.251.3" xmlns="http://www.w3.org/1999/xhtml">s,
        IFormatProvider? </span><span class="koboSpan" id="kobo.251.4" xmlns="http://www.w3.org/1999/xhtml">provider,
        [MaybeNullWhen(false)] out Coordinate result)
    {
        var segments = s?.Split(
            ',',
            StringSplitOptions.TrimEntries |
            StringSplitOptions.RemoveEmptyEntries
        );
        if (segments?.Length == 2)
        {
            var latitudeIsValid = double.TryParse(
                segments[0],
                out var latitude
            );
            var longitudeIsValid = double.TryParse(
                segments[1],
                out var longitude
            );
            if (latitudeIsValid &amp;&amp; longitudeIsValid)
            {
                result = new() {
                    Latitude = latitude,
                    Longitude = longitude
                };
                return true;
            }
        }
        result = null;
        return false;
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.252.1" xmlns="http://www.w3.org/1999/xhtml">In the preceding code, the endpoint returns a JSON representation of the </span><code><span class="koboSpan" id="kobo.253.1" xmlns="http://www.w3.org/1999/xhtml">Coordinate</span></code><span class="koboSpan" id="kobo.254.1" xmlns="http://www.w3.org/1999/xhtml"> class, while the </span><code><span class="koboSpan" id="kobo.255.1" xmlns="http://www.w3.org/1999/xhtml">TryParse</span></code><span class="koboSpan" id="kobo.256.1" xmlns="http://www.w3.org/1999/xhtml"> method parses the input string into a </span><code><span class="koboSpan" id="kobo.257.1" xmlns="http://www.w3.org/1999/xhtml">Coordinate</span></code><span class="koboSpan" id="kobo.258.1" xmlns="http://www.w3.org/1999/xhtml"> object.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.259.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.260.1" xmlns="http://www.w3.org/1999/xhtml">Parse</span></code><span class="koboSpan" id="kobo.261.1" xmlns="http://www.w3.org/1999/xhtml"> method of the </span><code><span class="koboSpan" id="kobo.262.1" xmlns="http://www.w3.org/1999/xhtml">Coordinate</span></code><span class="koboSpan" id="kobo.263.1" xmlns="http://www.w3.org/1999/xhtml"> class comes from the </span><code><span class="koboSpan" id="kobo.264.1" xmlns="http://www.w3.org/1999/xhtml">IParsable&lt;TSelf&gt;</span></code><span class="koboSpan" id="kobo.265.1" xmlns="http://www.w3.org/1999/xhtml"> interface and is not needed for model binding.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.266.1" xmlns="http://www.w3.org/1999/xhtml">For example, if we request the following URI:</span></p>
<div class="C0-ConsolePACKT">
<pre><code><span class="koboSpan" id="kobo.267.1" xmlns="http://www.w3.org/1999/xhtml">/minimal-endpoint-input-Coordinate?coordinate=45.501690%2C%20-73.567253</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.268.1" xmlns="http://www.w3.org/1999/xhtml">The endpoint returns:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.269.1" xmlns="http://www.w3.org/1999/xhtml">{
  "latitude": 45.50169,
  "longitude": -73.567253
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.270.1" xmlns="http://www.w3.org/1999/xhtml">Parsing a string into an object is a viable choice for simple scenarios. </span><span class="koboSpan" id="kobo.270.2" xmlns="http://www.w3.org/1999/xhtml">However, more complex scenarios require another technique that we explore next.</span></p>
</section>
<section class="level6" data-number="6.4.2.1.2.2" id="manual-binding">
<h6 data-number="6.4.2.1.2.2"><span class="koboSpan" id="kobo.271.1" xmlns="http://www.w3.org/1999/xhtml">Manual binding</span></h6>
<p><span class="koboSpan" id="kobo.272.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.273.1" xmlns="http://www.w3.org/1999/xhtml">BindAsync</span></code><span class="koboSpan" id="kobo.274.1" xmlns="http://www.w3.org/1999/xhtml"> method takes an </span><code><span class="koboSpan" id="kobo.275.1" xmlns="http://www.w3.org/1999/xhtml">HttpContext</span></code><span class="koboSpan" id="kobo.276.1" xmlns="http://www.w3.org/1999/xhtml"> and a </span><code><span class="koboSpan" id="kobo.277.1" xmlns="http://www.w3.org/1999/xhtml">ParameterInfo</span></code><span class="koboSpan" id="kobo.278.1" xmlns="http://www.w3.org/1999/xhtml"> parameter and returns a </span><code><span class="koboSpan" id="kobo.279.1" xmlns="http://www.w3.org/1999/xhtml">ValueTask&lt;TSelf&gt;</span></code><span class="koboSpan" id="kobo.280.1" xmlns="http://www.w3.org/1999/xhtml"> where </span><code><span class="koboSpan" id="kobo.281.1" xmlns="http://www.w3.org/1999/xhtml">TSelf</span></code><span class="koboSpan" id="kobo.282.1" xmlns="http://www.w3.org/1999/xhtml"> is the type we are writing data binding for. </span><span class="koboSpan" id="kobo.282.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.283.1" xmlns="http://www.w3.org/1999/xhtml">HttpContext</span></code><span class="koboSpan" id="kobo.284.1" xmlns="http://www.w3.org/1999/xhtml"> represents the source of the data (the HTTP request), and the </span><code><span class="koboSpan" id="kobo.285.1" xmlns="http://www.w3.org/1999/xhtml">ParameterInfo</span></code><span class="koboSpan" id="kobo.286.1" xmlns="http://www.w3.org/1999/xhtml"> represents the delegate’s parameter, from which we could want to know something, like its name.The data-binding API supports the implementation of one of the following methods:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.287.1" xmlns="http://www.w3.org/1999/xhtml">public static ValueTask&lt;TSelf?&gt; BindAsync(HttpContext context, ParameterInfo parameter);
public static ValueTask&lt;TSelf?&gt; BindAsync(HttpContext context);</span></code></pre>
</div>
<blockquote>
<p><span class="koboSpan" id="kobo.288.1" xmlns="http://www.w3.org/1999/xhtml">Implementing the </span><code><span class="koboSpan" id="kobo.289.1" xmlns="http://www.w3.org/1999/xhtml">IBindableFromHttpContext&lt;TSelf&gt;</span></code><span class="koboSpan" id="kobo.290.1" xmlns="http://www.w3.org/1999/xhtml"> interface provides the appropriate </span><code><span class="koboSpan" id="kobo.291.1" xmlns="http://www.w3.org/1999/xhtml">BindAsync</span></code><span class="koboSpan" id="kobo.292.1" xmlns="http://www.w3.org/1999/xhtml"> method.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.293.1" xmlns="http://www.w3.org/1999/xhtml">Here is an example that binds a </span><code><span class="koboSpan" id="kobo.294.1" xmlns="http://www.w3.org/1999/xhtml">Person</span></code><span class="koboSpan" id="kobo.295.1" xmlns="http://www.w3.org/1999/xhtml"> from the HTTP request’s query parameters:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.296.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGet(
    "minimal-endpoint-input-Person/",
    (Person person) =&gt; person
);
public class Person : IBindableFromHttpContext&lt;Person&gt;
{
    public required string Name { get; set; }
    public required DateOnly Birthday { get; set; }
    public static ValueTask&lt;Person?&gt; BindAsync(
        HttpContext context,
        ParameterInfo parameter)
    {
        var name = context.Request.Query["name"].Single();
        var birthdayIsValid = DateOnly.TryParse(
            context.Request.Query["birthday"],
            out var birthday
        );
        if (name is not null &amp;&amp; birthdayIsValid) {
            var person = new Person() {
                Name = name,
                Birthday = birthday
            };
            return ValueTask.FromResult(person)!;
        }
        return ValueTask.FromResult(default(Person));
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.297.1" xmlns="http://www.w3.org/1999/xhtml">The preceding code returns a JSON representation of the person. </span><span class="koboSpan" id="kobo.297.2" xmlns="http://www.w3.org/1999/xhtml">For example, if we request the following URI:</span></p>
<div class="C0-ConsolePACKT">
<pre><code><span class="koboSpan" id="kobo.298.1" xmlns="http://www.w3.org/1999/xhtml">/minimal-endpoint-input-Person?name=John%20Doe&amp;birthday=2023-06-14</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.299.1" xmlns="http://www.w3.org/1999/xhtml">The endpoint returns:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.300.1" xmlns="http://www.w3.org/1999/xhtml">{
  "name": "John Doe",
  "birthday": "2023-06-14"
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.301.1" xmlns="http://www.w3.org/1999/xhtml">As we can see, the </span><code><span class="koboSpan" id="kobo.302.1" xmlns="http://www.w3.org/1999/xhtml">BindAsync</span></code><span class="koboSpan" id="kobo.303.1" xmlns="http://www.w3.org/1999/xhtml"> method is way more powerful than the </span><code><span class="koboSpan" id="kobo.304.1" xmlns="http://www.w3.org/1999/xhtml">TryParse</span></code><span class="koboSpan" id="kobo.305.1" xmlns="http://www.w3.org/1999/xhtml"> method because we can access a broader range of options using the </span><code><span class="koboSpan" id="kobo.306.1" xmlns="http://www.w3.org/1999/xhtml">HttpContext</span></code><span class="koboSpan" id="kobo.307.1" xmlns="http://www.w3.org/1999/xhtml">, allowing us to cover complex use cases.However, in this case, we could have leveraged the </span><code><span class="koboSpan" id="kobo.308.1" xmlns="http://www.w3.org/1999/xhtml">[AsParameters]</span></code><span class="koboSpan" id="kobo.309.1" xmlns="http://www.w3.org/1999/xhtml"> attribute to achieve the same result and get the data from the query without needing to write the data-binding code manually. </span><span class="koboSpan" id="kobo.309.2" xmlns="http://www.w3.org/1999/xhtml">What a great opportunity to explore this attribute; here’s the updated version of the same code:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.310.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGet(
    "minimal-endpoint-input-Person2/",
    ([AsParameters] Person2 person) =&gt; person
);
public class Person2
{
    public required string Name { get; set; }
    public required DateOnly Birthday { get; set; }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.311.1" xmlns="http://www.w3.org/1999/xhtml">That’s it; the </span><code><span class="koboSpan" id="kobo.312.1" xmlns="http://www.w3.org/1999/xhtml">AsParameters</span></code><span class="koboSpan" id="kobo.313.1" xmlns="http://www.w3.org/1999/xhtml"> attribute did the work for us!Now that we covered reading the input values from different places in the HTTP request, it is time to explore how to output results.</span></p>
</section>
</section>
</section>
<section class="level4" data-number="6.4.2.2" id="outputs">
<h4 data-number="6.4.2.2"><span class="koboSpan" id="kobo.314.1" xmlns="http://www.w3.org/1999/xhtml">Outputs</span></h4>
<p><span class="koboSpan" id="kobo.315.1" xmlns="http://www.w3.org/1999/xhtml">There are several ways to output data from our delegates:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.316.1" xmlns="http://www.w3.org/1999/xhtml">Return a serializable object.</span></li>
<li><span class="koboSpan" id="kobo.317.1" xmlns="http://www.w3.org/1999/xhtml">Return an </span><code><span class="koboSpan" id="kobo.318.1" xmlns="http://www.w3.org/1999/xhtml">IResult</span></code><span class="koboSpan" id="kobo.319.1" xmlns="http://www.w3.org/1999/xhtml"> implementation.</span></li>
<li><span class="koboSpan" id="kobo.320.1" xmlns="http://www.w3.org/1999/xhtml">Return a </span><code><span class="koboSpan" id="kobo.321.1" xmlns="http://www.w3.org/1999/xhtml">Results&lt;TResult1, TResult2, …, TResultN&gt;</span></code><span class="koboSpan" id="kobo.322.1" xmlns="http://www.w3.org/1999/xhtml"> where the </span><code><span class="koboSpan" id="kobo.323.1" xmlns="http://www.w3.org/1999/xhtml">TResult</span></code><span class="koboSpan" id="kobo.324.1" xmlns="http://www.w3.org/1999/xhtml"> generic parameters represent the different </span><code><span class="koboSpan" id="kobo.325.1" xmlns="http://www.w3.org/1999/xhtml">IResult</span></code><span class="koboSpan" id="kobo.326.1" xmlns="http://www.w3.org/1999/xhtml"> implementation the endpoint can return.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.327.1" xmlns="http://www.w3.org/1999/xhtml">We explore those possibilities next.</span></p>
<section class="level5" data-number="6.4.2.2.1" id="serializable-object">
<h5 data-number="6.4.2.2.1"><span class="koboSpan" id="kobo.328.1" xmlns="http://www.w3.org/1999/xhtml">Serializable object</span></h5>
<p><span class="koboSpan" id="kobo.329.1" xmlns="http://www.w3.org/1999/xhtml">The first is to return a serializable object, as we did in the previous section about inputs. </span><span class="koboSpan" id="kobo.329.2" xmlns="http://www.w3.org/1999/xhtml">ASP.NET Core serializes the object into a JSON string and sets the </span><code><span class="koboSpan" id="kobo.330.1" xmlns="http://www.w3.org/1999/xhtml">Content-Type</span></code><span class="koboSpan" id="kobo.331.1" xmlns="http://www.w3.org/1999/xhtml"> header to </span><code><span class="koboSpan" id="kobo.332.1" xmlns="http://www.w3.org/1999/xhtml">application/json</span></code><span class="koboSpan" id="kobo.333.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.333.2" xmlns="http://www.w3.org/1999/xhtml">This is the easiest way to do it but also the less flexible.For example, the following code:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.334.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGet(
    "minimal-endpoint-output-coordinate/",
    () =&gt; new Coordinate {
        Latitude = 43.653225,
        Longitude = -79.383186
    }
);</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.335.1" xmlns="http://www.w3.org/1999/xhtml">Outputs the following JSON string:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.336.1" xmlns="http://www.w3.org/1999/xhtml">{
  "latitude": 43.653225,
  "longitude": -79.383186
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.337.1" xmlns="http://www.w3.org/1999/xhtml">The problem with this approach is that we don’t control the status code, nor can we return multiple different results from the endpoint. </span><span class="koboSpan" id="kobo.337.2" xmlns="http://www.w3.org/1999/xhtml">For example, if the endpoint returns </span><code><span class="koboSpan" id="kobo.338.1" xmlns="http://www.w3.org/1999/xhtml">200 OK</span></code><span class="koboSpan" id="kobo.339.1" xmlns="http://www.w3.org/1999/xhtml"> in one case and </span><code><span class="koboSpan" id="kobo.340.1" xmlns="http://www.w3.org/1999/xhtml">404 Not Found</span></code><span class="koboSpan" id="kobo.341.1" xmlns="http://www.w3.org/1999/xhtml"> in another. </span><span class="koboSpan" id="kobo.341.2" xmlns="http://www.w3.org/1999/xhtml">To help us with this, we explore the </span><code><span class="koboSpan" id="kobo.342.1" xmlns="http://www.w3.org/1999/xhtml">IResult</span></code><span class="koboSpan" id="kobo.343.1" xmlns="http://www.w3.org/1999/xhtml"> abstraction next.</span></p>
</section>
<section class="level5" data-number="6.4.2.2.2" id="iresult">
<h5 data-number="6.4.2.2.2"><span class="koboSpan" id="kobo.344.1" xmlns="http://www.w3.org/1999/xhtml">IResult</span></h5>
<p><span class="koboSpan" id="kobo.345.1" xmlns="http://www.w3.org/1999/xhtml">The next option is to return the </span><code><span class="koboSpan" id="kobo.346.1" xmlns="http://www.w3.org/1999/xhtml">IResult</span></code><span class="koboSpan" id="kobo.347.1" xmlns="http://www.w3.org/1999/xhtml"> interface. </span><span class="koboSpan" id="kobo.347.2" xmlns="http://www.w3.org/1999/xhtml">We can leverage the </span><code><span class="koboSpan" id="kobo.348.1" xmlns="http://www.w3.org/1999/xhtml">Results</span></code><span class="koboSpan" id="kobo.349.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code><span class="koboSpan" id="kobo.350.1" xmlns="http://www.w3.org/1999/xhtml">TypedResults</span></code><span class="koboSpan" id="kobo.351.1" xmlns="http://www.w3.org/1999/xhtml"> classes from the </span><code><span class="koboSpan" id="kobo.352.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft.AspNetCore.Http</span></code><span class="koboSpan" id="kobo.353.1" xmlns="http://www.w3.org/1999/xhtml"> namespace to do that.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.354.1" xmlns="http://www.w3.org/1999/xhtml">I recommend defaulting to using </span><code><span class="koboSpan" id="kobo.355.1" xmlns="http://www.w3.org/1999/xhtml">TypedResults</span></code><span class="koboSpan" id="kobo.356.1" xmlns="http://www.w3.org/1999/xhtml">, which .NET 7 introduced.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.357.1" xmlns="http://www.w3.org/1999/xhtml">The main difference between the two is that the methods in the </span><code><span class="koboSpan" id="kobo.358.1" xmlns="http://www.w3.org/1999/xhtml">Results</span></code><span class="koboSpan" id="kobo.359.1" xmlns="http://www.w3.org/1999/xhtml"> class return </span><code><span class="koboSpan" id="kobo.360.1" xmlns="http://www.w3.org/1999/xhtml">IResult</span></code><span class="koboSpan" id="kobo.361.1" xmlns="http://www.w3.org/1999/xhtml">, while those in </span><code><span class="koboSpan" id="kobo.362.1" xmlns="http://www.w3.org/1999/xhtml">TypedResults</span></code><span class="koboSpan" id="kobo.363.1" xmlns="http://www.w3.org/1999/xhtml"> return a typed implementation of the </span><code><span class="koboSpan" id="kobo.364.1" xmlns="http://www.w3.org/1999/xhtml">IResult</span></code><span class="koboSpan" id="kobo.365.1" xmlns="http://www.w3.org/1999/xhtml"> interface. </span><span class="koboSpan" id="kobo.365.2" xmlns="http://www.w3.org/1999/xhtml">This difference may sound insignificant, but it changes everything regarding discoverability by the API Explorer. </span><span class="koboSpan" id="kobo.365.3" xmlns="http://www.w3.org/1999/xhtml">The API Explorer can’t automatically discover the API contract of the former, while it can for the latter. </span><span class="koboSpan" id="kobo.365.4" xmlns="http://www.w3.org/1999/xhtml">This is possible because the compiler can infer the return type, but it creates challenges when returning more than one result type.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.366.1" xmlns="http://www.w3.org/1999/xhtml">This choice impacts the amount of work you’ll have to put into getting well-crafted OpenAPI specifications automatically (or not so automatically).</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.367.1" xmlns="http://www.w3.org/1999/xhtml">The following two endpoints explicitly state the result is 200 OK, one with each class:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.368.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGet(
    "minimal-endpoint-output-coordinate-ok1/",
    () =&gt; Results.Ok(new Coordinate {
        Latitude = 43.653225,
        Longitude = -79.383186
    })
);
app.MapGet(
    "minimal-endpoint-output-coordinate-ok2/",
    () =&gt; TypedResults.Ok(new Coordinate {
        Latitude = 43.653225,
        Longitude = -79.383186
    })
);</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.369.1" xmlns="http://www.w3.org/1999/xhtml">When looking at the generated OpenAPI specifications, the first endpoint has no return value, while the other has a </span><code><span class="koboSpan" id="kobo.370.1" xmlns="http://www.w3.org/1999/xhtml">Coordinate</span></code><span class="koboSpan" id="kobo.371.1" xmlns="http://www.w3.org/1999/xhtml"> definition mimicking our C# class. </span><span class="koboSpan" id="kobo.371.2" xmlns="http://www.w3.org/1999/xhtml">Next, we dig deeper into the </span><code><span class="koboSpan" id="kobo.372.1" xmlns="http://www.w3.org/1999/xhtml">TypedResults</span></code><span class="koboSpan" id="kobo.373.1" xmlns="http://www.w3.org/1999/xhtml"> class.</span></p>
</section>
<section class="level5" data-number="6.4.2.2.3" id="typed-results">
<h5 data-number="6.4.2.2.3"><span class="koboSpan" id="kobo.374.1" xmlns="http://www.w3.org/1999/xhtml">Typed results</span></h5>
<p><span class="koboSpan" id="kobo.375.1" xmlns="http://www.w3.org/1999/xhtml">We can use the methods of the </span><code><span class="koboSpan" id="kobo.376.1" xmlns="http://www.w3.org/1999/xhtml">TypedResults</span></code><span class="koboSpan" id="kobo.377.1" xmlns="http://www.w3.org/1999/xhtml"> class to generate strongly-typed outputs. </span><span class="koboSpan" id="kobo.377.2" xmlns="http://www.w3.org/1999/xhtml">They allow us to control the output while informing ASP.NET Core of the specifics, like the status code and return type.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.378.1" xmlns="http://www.w3.org/1999/xhtml">Please note that for the sake of simplicity, I've omitted variants and overloads, focusing solely on the fundamental of each method in the tables.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.379.1" xmlns="http://www.w3.org/1999/xhtml">Let’s start with the successful status code, where the </span><code><span class="koboSpan" id="kobo.380.1" xmlns="http://www.w3.org/1999/xhtml">200 OK</span></code><span class="koboSpan" id="kobo.381.1" xmlns="http://www.w3.org/1999/xhtml"> status code is most likely the most common:</span></p>
<table>
<tbody>
<tr class="odd">
<td><strong><span class="koboSpan" id="kobo.382.1" xmlns="http://www.w3.org/1999/xhtml">Method</span></strong></td>
<td><strong><span class="koboSpan" id="kobo.383.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></strong></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.384.1" xmlns="http://www.w3.org/1999/xhtml">Accepted</span></code></td>
<td><span class="koboSpan" id="kobo.385.1" xmlns="http://www.w3.org/1999/xhtml">Produces a </span><code><span class="koboSpan" id="kobo.386.1" xmlns="http://www.w3.org/1999/xhtml">202 Accepted</span></code><span class="koboSpan" id="kobo.387.1" xmlns="http://www.w3.org/1999/xhtml"> response, indicating the beginning of an asynchronous process.</span></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.388.1" xmlns="http://www.w3.org/1999/xhtml">Created</span></code></td>
<td><span class="koboSpan" id="kobo.389.1" xmlns="http://www.w3.org/1999/xhtml">Produces a </span><code><span class="koboSpan" id="kobo.390.1" xmlns="http://www.w3.org/1999/xhtml">201 Created</span></code><span class="koboSpan" id="kobo.391.1" xmlns="http://www.w3.org/1999/xhtml"> response, indicating the system created the entity, the location of the entity, and the entity itself.</span></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.392.1" xmlns="http://www.w3.org/1999/xhtml">Ok</span></code></td>
<td><span class="koboSpan" id="kobo.393.1" xmlns="http://www.w3.org/1999/xhtml">Produces a </span><code><span class="koboSpan" id="kobo.394.1" xmlns="http://www.w3.org/1999/xhtml">200 OK</span></code><span class="koboSpan" id="kobo.395.1" xmlns="http://www.w3.org/1999/xhtml"> response, indicating the operation was successful.</span></td>
</tr>
</tbody>
</table><span class="koboSpan" id="kobo.396.1" xmlns="http://www.w3.org/1999/xhtml">
Table 5.4: TypedResults successful status code methods.
</span><p><span class="koboSpan" id="kobo.397.1" xmlns="http://www.w3.org/1999/xhtml">On top of the successes, we must know how to tell clients about the errors. </span><span class="koboSpan" id="kobo.397.2" xmlns="http://www.w3.org/1999/xhtml">For example, the </span><code><span class="koboSpan" id="kobo.398.1" xmlns="http://www.w3.org/1999/xhtml">400 Bad Request</span></code><span class="koboSpan" id="kobo.399.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.400.1" xmlns="http://www.w3.org/1999/xhtml">404 Not Found</span></code><span class="koboSpan" id="kobo.401.1" xmlns="http://www.w3.org/1999/xhtml"> are very common to point out the issues with the request. </span><span class="koboSpan" id="kobo.401.2" xmlns="http://www.w3.org/1999/xhtml">The following table contains methods to assist in indicating such issues to the clients:</span></p>
<table>
<tbody>
<tr class="odd">
<td><strong><span class="koboSpan" id="kobo.402.1" xmlns="http://www.w3.org/1999/xhtml">Method</span></strong></td>
<td><strong><span class="koboSpan" id="kobo.403.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></strong></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.404.1" xmlns="http://www.w3.org/1999/xhtml">BadRequest</span></code></td>
<td><span class="koboSpan" id="kobo.405.1" xmlns="http://www.w3.org/1999/xhtml">Produces a </span><code><span class="koboSpan" id="kobo.406.1" xmlns="http://www.w3.org/1999/xhtml">400 Bad Request</span></code><span class="koboSpan" id="kobo.407.1" xmlns="http://www.w3.org/1999/xhtml"> response, indicating an issue with the client request, often a validation error.</span></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.408.1" xmlns="http://www.w3.org/1999/xhtml">Conflict</span></code></td>
<td><span class="koboSpan" id="kobo.409.1" xmlns="http://www.w3.org/1999/xhtml">Produces a </span><code><span class="koboSpan" id="kobo.410.1" xmlns="http://www.w3.org/1999/xhtml">409 Conflict</span></code><span class="koboSpan" id="kobo.411.1" xmlns="http://www.w3.org/1999/xhtml"> response, indicating a conflict occurred when processing the request, often a concurrency error.</span></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.412.1" xmlns="http://www.w3.org/1999/xhtml">NotFound</span></code></td>
<td><span class="koboSpan" id="kobo.413.1" xmlns="http://www.w3.org/1999/xhtml">Produces a </span><code><span class="koboSpan" id="kobo.414.1" xmlns="http://www.w3.org/1999/xhtml">404 Not Found</span></code><span class="koboSpan" id="kobo.415.1" xmlns="http://www.w3.org/1999/xhtml"> response, indicating the resource was not found.</span></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.416.1" xmlns="http://www.w3.org/1999/xhtml">Problem</span></code></td>
<td><span class="koboSpan" id="kobo.417.1" xmlns="http://www.w3.org/1999/xhtml">Produces a response adhering to the </span><em><span class="koboSpan" id="kobo.418.1" xmlns="http://www.w3.org/1999/xhtml">Problem Details</span></em><span class="koboSpan" id="kobo.419.1" xmlns="http://www.w3.org/1999/xhtml"> structure defined by </span><strong><span class="koboSpan" id="kobo.420.1" xmlns="http://www.w3.org/1999/xhtml">RFC7807</span></strong><span class="koboSpan" id="kobo.421.1" xmlns="http://www.w3.org/1999/xhtml"> , providing a standardized encapsulation of the error. </span><span class="koboSpan" id="kobo.421.2" xmlns="http://www.w3.org/1999/xhtml">We can modify the status code, which defaults to a </span><code><span class="koboSpan" id="kobo.422.1" xmlns="http://www.w3.org/1999/xhtml">500 Internal Server Error</span></code><span class="koboSpan" id="kobo.423.1" xmlns="http://www.w3.org/1999/xhtml"> .</span></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.424.1" xmlns="http://www.w3.org/1999/xhtml">UnprocessableEntity</span></code></td>
<td><span class="koboSpan" id="kobo.425.1" xmlns="http://www.w3.org/1999/xhtml">Produces a </span><code><span class="koboSpan" id="kobo.426.1" xmlns="http://www.w3.org/1999/xhtml">422 Unprocessable Content</span></code><span class="koboSpan" id="kobo.427.1" xmlns="http://www.w3.org/1999/xhtml"> response, indicating that while the server comprehends the request's content type and the syntax is correct, it cannot process the instructions or the entity.</span></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.428.1" xmlns="http://www.w3.org/1999/xhtml">ValidationProblem</span></code></td>
<td><span class="koboSpan" id="kobo.429.1" xmlns="http://www.w3.org/1999/xhtml">Produces a </span><code><span class="koboSpan" id="kobo.430.1" xmlns="http://www.w3.org/1999/xhtml">400 Bad Request</span></code><span class="koboSpan" id="kobo.431.1" xmlns="http://www.w3.org/1999/xhtml"> response adhering to the </span><em><span class="koboSpan" id="kobo.432.1" xmlns="http://www.w3.org/1999/xhtml">Problem Details</span></em><span class="koboSpan" id="kobo.433.1" xmlns="http://www.w3.org/1999/xhtml"> structure defined by </span><strong><span class="koboSpan" id="kobo.434.1" xmlns="http://www.w3.org/1999/xhtml">RFC7807</span></strong><span class="koboSpan" id="kobo.435.1" xmlns="http://www.w3.org/1999/xhtml"> . </span><span class="koboSpan" id="kobo.435.2" xmlns="http://www.w3.org/1999/xhtml">We can use this method to communicate input validation problems to the client.</span></td>
</tr>
</tbody>
</table><span class="koboSpan" id="kobo.436.1" xmlns="http://www.w3.org/1999/xhtml">
Table 5.5: TypedResults problematic status code.
</span><blockquote>
<p><span class="koboSpan" id="kobo.437.1" xmlns="http://www.w3.org/1999/xhtml">Leveraging the </span><em><span class="koboSpan" id="kobo.438.1" xmlns="http://www.w3.org/1999/xhtml">Problem Details</span></em><span class="koboSpan" id="kobo.439.1" xmlns="http://www.w3.org/1999/xhtml"> structure improves the interoperability of our API by choosing a standard instead of crafting a custom way of returning our API errors.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.440.1" xmlns="http://www.w3.org/1999/xhtml">It is rarer in APIs than with conventional web applications to send redirections to clients, yet, we can redirect the clients to another URL with one of the following methods when needed:</span></p>
<table>
<colgroup>
<col style="width: 50%"/>
<col style="width: 50%"/>
</colgroup>
<tbody>
<tr class="odd">
<td><strong><span class="koboSpan" id="kobo.441.1" xmlns="http://www.w3.org/1999/xhtml">Method</span></strong></td>
<td><strong><span class="koboSpan" id="kobo.442.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></strong></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.443.1" xmlns="http://www.w3.org/1999/xhtml">LocalRedirect</span></code></td>
<td><p><span class="koboSpan" id="kobo.444.1" xmlns="http://www.w3.org/1999/xhtml">Produces a </span><code><span class="koboSpan" id="kobo.445.1" xmlns="http://www.w3.org/1999/xhtml">301 Moved Permanently</span></code><span class="koboSpan" id="kobo.446.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.447.1" xmlns="http://www.w3.org/1999/xhtml">302 Found</span></code><span class="koboSpan" id="kobo.448.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.449.1" xmlns="http://www.w3.org/1999/xhtml">307 Temporary Redirect</span></code><span class="koboSpan" id="kobo.450.1" xmlns="http://www.w3.org/1999/xhtml">, or </span><code><span class="koboSpan" id="kobo.451.1" xmlns="http://www.w3.org/1999/xhtml">308 Permanent Redirect</span></code><span class="koboSpan" id="kobo.452.1" xmlns="http://www.w3.org/1999/xhtml"> based on the specified arguments.</span></p>
<p><span class="koboSpan" id="kobo.453.1" xmlns="http://www.w3.org/1999/xhtml">This method throws an exception at runtime if the URL is not local, which is an excellent option to ensure dynamically generated URLs are not sending users away. </span><span class="koboSpan" id="kobo.453.2" xmlns="http://www.w3.org/1999/xhtml">For example, when the URL is composed using user inputs.</span></p></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.454.1" xmlns="http://www.w3.org/1999/xhtml">Redirect</span></code></td>
<td><span class="koboSpan" id="kobo.455.1" xmlns="http://www.w3.org/1999/xhtml">Produces a </span><code><span class="koboSpan" id="kobo.456.1" xmlns="http://www.w3.org/1999/xhtml">301 Moved Permanently</span></code><span class="koboSpan" id="kobo.457.1" xmlns="http://www.w3.org/1999/xhtml"> , </span><code><span class="koboSpan" id="kobo.458.1" xmlns="http://www.w3.org/1999/xhtml">302 Found</span></code><span class="koboSpan" id="kobo.459.1" xmlns="http://www.w3.org/1999/xhtml"> , </span><code><span class="koboSpan" id="kobo.460.1" xmlns="http://www.w3.org/1999/xhtml">307 Temporary Redirect</span></code><span class="koboSpan" id="kobo.461.1" xmlns="http://www.w3.org/1999/xhtml"> , or </span><code><span class="koboSpan" id="kobo.462.1" xmlns="http://www.w3.org/1999/xhtml">308 Permanent Redirect</span></code><span class="koboSpan" id="kobo.463.1" xmlns="http://www.w3.org/1999/xhtml"> based on the specified arguments.</span></td>
</tr>
</tbody>
</table><span class="koboSpan" id="kobo.464.1" xmlns="http://www.w3.org/1999/xhtml">
Table 5.6: TypedResults redirection status code.
</span><p><span class="koboSpan" id="kobo.465.1" xmlns="http://www.w3.org/1999/xhtml">Sending files to the client is another helpful feature; for example, the API could protect the files using authorization. </span><span class="koboSpan" id="kobo.465.2" xmlns="http://www.w3.org/1999/xhtml">The following table showcases a few helper methods to send files to the client:</span></p>
<table>
<colgroup>
<col style="width: 50%"/>
<col style="width: 50%"/>
</colgroup>
<tbody>
<tr class="odd">
<td><strong><span class="koboSpan" id="kobo.466.1" xmlns="http://www.w3.org/1999/xhtml">Method</span></strong></td>
<td><strong><span class="koboSpan" id="kobo.467.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></strong></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.468.1" xmlns="http://www.w3.org/1999/xhtml">File</span></code></td>
<td><p><span class="koboSpan" id="kobo.469.1" xmlns="http://www.w3.org/1999/xhtml">Writes the file content to the response stream.</span></p>
<p><span class="koboSpan" id="kobo.470.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.471.1" xmlns="http://www.w3.org/1999/xhtml">File</span></code><span class="koboSpan" id="kobo.472.1" xmlns="http://www.w3.org/1999/xhtml"> methods are aliases for the </span><code><span class="koboSpan" id="kobo.473.1" xmlns="http://www.w3.org/1999/xhtml">Bytes</span></code><span class="koboSpan" id="kobo.474.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.475.1" xmlns="http://www.w3.org/1999/xhtml">Stream</span></code><span class="koboSpan" id="kobo.476.1" xmlns="http://www.w3.org/1999/xhtml"> methods. </span><span class="koboSpan" id="kobo.476.2" xmlns="http://www.w3.org/1999/xhtml">We look at those soon.</span></p></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.477.1" xmlns="http://www.w3.org/1999/xhtml">PhysicalFile</span></code></td>
<td><p><span class="koboSpan" id="kobo.478.1" xmlns="http://www.w3.org/1999/xhtml">Writes the content of a physical file to the response using an absolute or relative path.</span></p>
<p><span class="koboSpan" id="kobo.479.1" xmlns="http://www.w3.org/1999/xhtml">Caution: Do not expose this method to raw user inputs because it can read files outside the web content root. </span><span class="koboSpan" id="kobo.479.2" xmlns="http://www.w3.org/1999/xhtml">So a malicious actor could craft a request to access restricted files.</span></p></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.480.1" xmlns="http://www.w3.org/1999/xhtml">VirtualFile</span></code></td>
<td><p><span class="koboSpan" id="kobo.481.1" xmlns="http://www.w3.org/1999/xhtml">Writes the content of a physical file to the response using an absolute or relative path.</span></p>
<p><span class="koboSpan" id="kobo.482.1" xmlns="http://www.w3.org/1999/xhtml">This method limits the file's location to the web content root and is safer when dealing with user inputs.</span></p></td>
</tr>
</tbody>
</table><span class="koboSpan" id="kobo.483.1" xmlns="http://www.w3.org/1999/xhtml">
Table 5.7: TypedResults methods for downloading files.
</span><p><span class="koboSpan" id="kobo.484.1" xmlns="http://www.w3.org/1999/xhtml">On top of the methods we have explored so far, the following table lists ways to handle the content directly in its raw format. </span><span class="koboSpan" id="kobo.484.2" xmlns="http://www.w3.org/1999/xhtml">These content-handling methods can become handy when you need more control over what is happening:</span></p>
<table>
<colgroup>
<col style="width: 50%"/>
<col style="width: 50%"/>
</colgroup>
<tbody>
<tr class="odd">
<td><strong><span class="koboSpan" id="kobo.485.1" xmlns="http://www.w3.org/1999/xhtml">Method</span></strong></td>
<td><strong><span class="koboSpan" id="kobo.486.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></strong></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.487.1" xmlns="http://www.w3.org/1999/xhtml">Bytes</span></code></td>
<td><span class="koboSpan" id="kobo.488.1" xmlns="http://www.w3.org/1999/xhtml">Writes the byte-array or </span><code><span class="koboSpan" id="kobo.489.1" xmlns="http://www.w3.org/1999/xhtml">ReadOnlyMemory&lt;byte&gt;</span></code><span class="koboSpan" id="kobo.490.1" xmlns="http://www.w3.org/1999/xhtml"> content directly to the response. </span><span class="koboSpan" id="kobo.490.2" xmlns="http://www.w3.org/1999/xhtml">It defaults to sending an </span><code><span class="koboSpan" id="kobo.491.1" xmlns="http://www.w3.org/1999/xhtml">application/octet-stream</span></code><span class="koboSpan" id="kobo.492.1" xmlns="http://www.w3.org/1999/xhtml"> MIME Type to the client. </span><span class="koboSpan" id="kobo.492.2" xmlns="http://www.w3.org/1999/xhtml">This default behavior can be customized as needed.</span></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.493.1" xmlns="http://www.w3.org/1999/xhtml">Content</span></code></td>
<td><span class="koboSpan" id="kobo.494.1" xmlns="http://www.w3.org/1999/xhtml">Writes the specified content </span><code><span class="koboSpan" id="kobo.495.1" xmlns="http://www.w3.org/1999/xhtml">string</span></code><span class="koboSpan" id="kobo.496.1" xmlns="http://www.w3.org/1999/xhtml"> to the response stream. </span><span class="koboSpan" id="kobo.496.2" xmlns="http://www.w3.org/1999/xhtml">It defaults to sending a </span><code><span class="koboSpan" id="kobo.497.1" xmlns="http://www.w3.org/1999/xhtml">text/plain</span></code><span class="koboSpan" id="kobo.498.1" xmlns="http://www.w3.org/1999/xhtml"> MIME Type to the client. </span><span class="koboSpan" id="kobo.498.2" xmlns="http://www.w3.org/1999/xhtml">This default behavior can be customized as needed.</span></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.499.1" xmlns="http://www.w3.org/1999/xhtml">Json</span></code></td>
<td><p><span class="koboSpan" id="kobo.500.1" xmlns="http://www.w3.org/1999/xhtml">Serializes the specified object to JSON. </span><span class="koboSpan" id="kobo.500.2" xmlns="http://www.w3.org/1999/xhtml">It defaults to sending an </span><code><span class="koboSpan" id="kobo.501.1" xmlns="http://www.w3.org/1999/xhtml">application/json</span></code><span class="koboSpan" id="kobo.502.1" xmlns="http://www.w3.org/1999/xhtml"> MIME Type to the client with a </span><code><span class="koboSpan" id="kobo.503.1" xmlns="http://www.w3.org/1999/xhtml">200 OK</span></code><span class="koboSpan" id="kobo.504.1" xmlns="http://www.w3.org/1999/xhtml"> status code. </span><span class="koboSpan" id="kobo.504.2" xmlns="http://www.w3.org/1999/xhtml">These default behaviors can be customized as needed.</span></p>
<p><span class="koboSpan" id="kobo.505.1" xmlns="http://www.w3.org/1999/xhtml">Compared to the other methods, like the </span><code><span class="koboSpan" id="kobo.506.1" xmlns="http://www.w3.org/1999/xhtml">Ok</span></code><span class="koboSpan" id="kobo.507.1" xmlns="http://www.w3.org/1999/xhtml"> method, the primary advantage is that it allows us to use a non-default instance of the </span><code><span class="koboSpan" id="kobo.508.1" xmlns="http://www.w3.org/1999/xhtml">JsonSerializerOptions</span></code><span class="koboSpan" id="kobo.509.1" xmlns="http://www.w3.org/1999/xhtml"> class to configure the serialization of the response.</span></p></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.510.1" xmlns="http://www.w3.org/1999/xhtml">NoContent</span></code></td>
<td><span class="koboSpan" id="kobo.511.1" xmlns="http://www.w3.org/1999/xhtml">Produces an empty </span><code><span class="koboSpan" id="kobo.512.1" xmlns="http://www.w3.org/1999/xhtml">204 No Content</span></code><span class="koboSpan" id="kobo.513.1" xmlns="http://www.w3.org/1999/xhtml"> response.</span></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.514.1" xmlns="http://www.w3.org/1999/xhtml">StatusCode</span></code></td>
<td><span class="koboSpan" id="kobo.515.1" xmlns="http://www.w3.org/1999/xhtml">Produces an empty response with the specified status code.</span></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.516.1" xmlns="http://www.w3.org/1999/xhtml">Stream</span></code></td>
<td><p><span class="koboSpan" id="kobo.517.1" xmlns="http://www.w3.org/1999/xhtml">Allows writing directly to the response stream from another </span><code><span class="koboSpan" id="kobo.518.1" xmlns="http://www.w3.org/1999/xhtml">Stream</span></code><span class="koboSpan" id="kobo.519.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.519.2" xmlns="http://www.w3.org/1999/xhtml">It defaults to sending an </span><code><span class="koboSpan" id="kobo.520.1" xmlns="http://www.w3.org/1999/xhtml">application/octet-stream</span></code><span class="koboSpan" id="kobo.521.1" xmlns="http://www.w3.org/1999/xhtml"> MIME Type to the client. </span><span class="koboSpan" id="kobo.521.2" xmlns="http://www.w3.org/1999/xhtml">This default behavior can be customized as needed.</span></p>
<p><span class="koboSpan" id="kobo.522.1" xmlns="http://www.w3.org/1999/xhtml">This method is highly customizable, returns a </span><code><span class="koboSpan" id="kobo.523.1" xmlns="http://www.w3.org/1999/xhtml">200 OK</span></code><span class="koboSpan" id="kobo.524.1" xmlns="http://www.w3.org/1999/xhtml"> status code by default, and supports range requests that produce a status code </span><code><span class="koboSpan" id="kobo.525.1" xmlns="http://www.w3.org/1999/xhtml">206 Partial Content</span></code><span class="koboSpan" id="kobo.526.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code><span class="koboSpan" id="kobo.527.1" xmlns="http://www.w3.org/1999/xhtml">416 Range Not Satisfiable</span></code><span class="koboSpan" id="kobo.528.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.529.1" xmlns="http://www.w3.org/1999/xhtml">Text</span></code></td>
<td><span class="koboSpan" id="kobo.530.1" xmlns="http://www.w3.org/1999/xhtml">Writes the content string to the HTTP response. </span><span class="koboSpan" id="kobo.530.2" xmlns="http://www.w3.org/1999/xhtml">It defaults to sending a </span><code><span class="koboSpan" id="kobo.531.1" xmlns="http://www.w3.org/1999/xhtml">text/plain</span></code><span class="koboSpan" id="kobo.532.1" xmlns="http://www.w3.org/1999/xhtml"> MIME Type to the client. </span><span class="koboSpan" id="kobo.532.2" xmlns="http://www.w3.org/1999/xhtml">This default behavior can be customized as needed, as well as the text encoding.</span></td>
</tr>
</tbody>
</table><span class="koboSpan" id="kobo.533.1" xmlns="http://www.w3.org/1999/xhtml">
Table 5.8: TypedResults raw content handling methods.
</span><blockquote>
<p><span class="koboSpan" id="kobo.534.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.535.1" xmlns="http://www.w3.org/1999/xhtml">application/octet-stream</span></code><span class="koboSpan" id="kobo.536.1" xmlns="http://www.w3.org/1999/xhtml"> MIME Type suggests that the response body is a file without specifying its type, which typically prompts the browser to download the file.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.537.1" xmlns="http://www.w3.org/1999/xhtml">Finally, we can leverage the following methods of the </span><code><span class="koboSpan" id="kobo.538.1" xmlns="http://www.w3.org/1999/xhtml">TypedResults</span></code><span class="koboSpan" id="kobo.539.1" xmlns="http://www.w3.org/1999/xhtml"> class to create security flows. </span><span class="koboSpan" id="kobo.539.2" xmlns="http://www.w3.org/1999/xhtml">Most of these methods rely on the current implementation of the </span><code><span class="koboSpan" id="kobo.540.1" xmlns="http://www.w3.org/1999/xhtml">IAuthenticationService</span></code><span class="koboSpan" id="kobo.541.1" xmlns="http://www.w3.org/1999/xhtml"> interface, which dictates their behavior:</span></p>
<table>
<colgroup>
<col style="width: 50%"/>
<col style="width: 50%"/>
</colgroup>
<tbody>
<tr class="odd">
<td><strong><span class="koboSpan" id="kobo.542.1" xmlns="http://www.w3.org/1999/xhtml">Method</span></strong></td>
<td><strong><span class="koboSpan" id="kobo.543.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></strong></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.544.1" xmlns="http://www.w3.org/1999/xhtml">Challenge</span></code></td>
<td><span class="koboSpan" id="kobo.545.1" xmlns="http://www.w3.org/1999/xhtml">Initiates a challenge for authentication when an unauthenticated user requests an endpoint that necessitates authentication.</span></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.546.1" xmlns="http://www.w3.org/1999/xhtml">Forbid</span></code></td>
<td><p><span class="koboSpan" id="kobo.547.1" xmlns="http://www.w3.org/1999/xhtml">Invoke when an authenticated user tries to access a resource for which they do not have the necessary permissions.</span></p>
<p><span class="koboSpan" id="kobo.548.1" xmlns="http://www.w3.org/1999/xhtml">By default, it produces a </span><code><span class="koboSpan" id="kobo.549.1" xmlns="http://www.w3.org/1999/xhtml">403 Forbidden</span></code><span class="koboSpan" id="kobo.550.1" xmlns="http://www.w3.org/1999/xhtml"> response, although the behavior may vary depending on the specific authentication scheme.</span></p></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.551.1" xmlns="http://www.w3.org/1999/xhtml">SignIn</span></code></td>
<td><span class="koboSpan" id="kobo.552.1" xmlns="http://www.w3.org/1999/xhtml">Commences the sign-in process for a user, based on the specified authentication scheme.</span></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.553.1" xmlns="http://www.w3.org/1999/xhtml">SignOut</span></code></td>
<td><span class="koboSpan" id="kobo.554.1" xmlns="http://www.w3.org/1999/xhtml">Initiates the sign-out process for the given authentication scheme.</span></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.555.1" xmlns="http://www.w3.org/1999/xhtml">Unauthorized</span></code></td>
<td><span class="koboSpan" id="kobo.556.1" xmlns="http://www.w3.org/1999/xhtml">Produces a </span><code><span class="koboSpan" id="kobo.557.1" xmlns="http://www.w3.org/1999/xhtml">401 Unauthorized</span></code><span class="koboSpan" id="kobo.558.1" xmlns="http://www.w3.org/1999/xhtml"> response.</span></td>
</tr>
</tbody>
</table><span class="koboSpan" id="kobo.559.1" xmlns="http://www.w3.org/1999/xhtml">
Table 5.9: TypedResults security-related methods.
</span><p><span class="koboSpan" id="kobo.560.1" xmlns="http://www.w3.org/1999/xhtml">Now that we have covered the </span><code><span class="koboSpan" id="kobo.561.1" xmlns="http://www.w3.org/1999/xhtml">TypedResults</span></code><span class="koboSpan" id="kobo.562.1" xmlns="http://www.w3.org/1999/xhtml"> possibilities, we explore how to return those typed results next.</span></p>
</section>
<section class="level5" data-number="6.4.2.2.4" id="returning-multiple-typed-results">
<h5 data-number="6.4.2.2.4"><span class="koboSpan" id="kobo.563.1" xmlns="http://www.w3.org/1999/xhtml">Returning multiple typed results</span></h5>
<p><span class="koboSpan" id="kobo.564.1" xmlns="http://www.w3.org/1999/xhtml">While returning a single typed result is helpful, the capability to produce multiple results is better aligned with real-life scenarios. </span><span class="koboSpan" id="kobo.564.2" xmlns="http://www.w3.org/1999/xhtml">As we previously examined, it's possible to return multiple </span><code><span class="koboSpan" id="kobo.565.1" xmlns="http://www.w3.org/1999/xhtml">IResult</span></code><span class="koboSpan" id="kobo.566.1" xmlns="http://www.w3.org/1999/xhtml"> objects, but we're restricted to a single typed result. </span><span class="koboSpan" id="kobo.566.2" xmlns="http://www.w3.org/1999/xhtml">This limitation arises from the compiler's inability to identify a shared interface and deduce an </span><code><span class="koboSpan" id="kobo.567.1" xmlns="http://www.w3.org/1999/xhtml">IResult</span></code><span class="koboSpan" id="kobo.568.1" xmlns="http://www.w3.org/1999/xhtml"> return type from the typed results. </span><span class="koboSpan" id="kobo.568.2" xmlns="http://www.w3.org/1999/xhtml">Even if the compiler could, that wouldn't enhance discoverability.To overcome this limitation, .NET 7 introduced the </span><code><span class="koboSpan" id="kobo.569.1" xmlns="http://www.w3.org/1999/xhtml">Results&lt;T1, TN&gt;</span></code><span class="koboSpan" id="kobo.570.1" xmlns="http://www.w3.org/1999/xhtml"> types, allowing us to return up to six different typed results.Here’s an example that returns </span><code><span class="koboSpan" id="kobo.571.1" xmlns="http://www.w3.org/1999/xhtml">200 OK</span></code><span class="koboSpan" id="kobo.572.1" xmlns="http://www.w3.org/1999/xhtml"> when the random number is even and </span><code><span class="koboSpan" id="kobo.573.1" xmlns="http://www.w3.org/1999/xhtml">209 Conflict</span></code><span class="koboSpan" id="kobo.574.1" xmlns="http://www.w3.org/1999/xhtml"> when it is odd:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.575.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGet(
    "multiple-TypedResults/",
    Results&lt;Ok, Conflict&gt; ()
        =&gt; Random.Shared.Next(0, 100)  %  2  ==  0
            ? </span><span class="koboSpan" id="kobo.575.2" xmlns="http://www.w3.org/1999/xhtml">TypedResults.Ok()
            : TypedResults.Conflict()
);</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.576.1" xmlns="http://www.w3.org/1999/xhtml">This also works with methods like this:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.577.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGet(
    "multiple-TypedResults-delegate/",
    MultipleResultsDelegate
);
Results&lt;Ok, Conflict&gt; MultipleResultsDelegate()
{
    return Random.Shared.Next(0, 100) % 2 == 0
        ? </span><span class="koboSpan" id="kobo.577.2" xmlns="http://www.w3.org/1999/xhtml">TypedResults.Ok()
        : TypedResults.Conflict();
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.578.1" xmlns="http://www.w3.org/1999/xhtml">Adopting this approach enhances the API Explorer's comprehension of the API, thereby allowing libraries like Swagger and Swagger UI to automatically generate more accurate and detailed API documentation.Next, we explore adding more metadata to endpoints.</span></p>
</section>
</section>
<section class="level4" data-number="6.4.2.3" id="metadata">
<h4 data-number="6.4.2.3"><span class="koboSpan" id="kobo.579.1" xmlns="http://www.w3.org/1999/xhtml">Metadata</span></h4>
<p><span class="koboSpan" id="kobo.580.1" xmlns="http://www.w3.org/1999/xhtml">Sometimes, relying solely on automatic metadata is not enough. </span><span class="koboSpan" id="kobo.580.2" xmlns="http://www.w3.org/1999/xhtml">That’s why ASP.NET Core offers different helper methods to fine-tune the metadata of our endpoints. </span><span class="koboSpan" id="kobo.580.3" xmlns="http://www.w3.org/1999/xhtml">We can use most helper methods with groups and routes. </span><span class="koboSpan" id="kobo.580.4" xmlns="http://www.w3.org/1999/xhtml">In the case of a group, the metadata cascades to its children, whether it is another group or a route. </span><span class="koboSpan" id="kobo.580.5" xmlns="http://www.w3.org/1999/xhtml">However, a child can override the inherited values by changing the metadata.Here’s a partial list of helpers and their usage:</span></p>
<table>
<colgroup>
<col style="width: 50%"/>
<col style="width: 50%"/>
</colgroup>
<tbody>
<tr class="odd">
<td><strong><span class="koboSpan" id="kobo.581.1" xmlns="http://www.w3.org/1999/xhtml">Method</span></strong></td>
<td><strong><span class="koboSpan" id="kobo.582.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></strong></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.583.1" xmlns="http://www.w3.org/1999/xhtml">Accepts</span></code></td>
<td><p><span class="koboSpan" id="kobo.584.1" xmlns="http://www.w3.org/1999/xhtml">Specifies the supported request content types.</span></p>
<p><em><span class="koboSpan" id="kobo.585.1" xmlns="http://www.w3.org/1999/xhtml">Only applicable to routes.</span></em></p></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.586.1" xmlns="http://www.w3.org/1999/xhtml">AllowAnonymous</span></code></td>
<td><span class="koboSpan" id="kobo.587.1" xmlns="http://www.w3.org/1999/xhtml">Specifies that anonymous users can access the endpoint(s).</span></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.588.1" xmlns="http://www.w3.org/1999/xhtml">CacheOutput</span></code></td>
<td><span class="koboSpan" id="kobo.589.1" xmlns="http://www.w3.org/1999/xhtml">Adds an output caching policy to the endpoint(s).</span></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.590.1" xmlns="http://www.w3.org/1999/xhtml">DisableRateLimiting</span></code></td>
<td><span class="koboSpan" id="kobo.591.1" xmlns="http://www.w3.org/1999/xhtml">Turns off the rate-limiting feature on the endpoint(s).</span></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.592.1" xmlns="http://www.w3.org/1999/xhtml">ExcludeFromDescription</span></code></td>
<td><span class="koboSpan" id="kobo.593.1" xmlns="http://www.w3.org/1999/xhtml">Excludes the item from the API Explorer data.</span></td>
</tr>
<tr class="odd">
<td><p><code><span class="koboSpan" id="kobo.594.1" xmlns="http://www.w3.org/1999/xhtml">Produces</span></code></p>
<p><code><span class="koboSpan" id="kobo.595.1" xmlns="http://www.w3.org/1999/xhtml">ProducesProblem</span></code></p>
<p><code><span class="koboSpan" id="kobo.596.1" xmlns="http://www.w3.org/1999/xhtml">ProducesValidationProblem</span></code></p></td>
<td><p><span class="koboSpan" id="kobo.597.1" xmlns="http://www.w3.org/1999/xhtml">Describes a response, including its type, content type, and status code.</span></p>
<p><em><span class="koboSpan" id="kobo.598.1" xmlns="http://www.w3.org/1999/xhtml">Only applicable to routes.</span></em></p></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.599.1" xmlns="http://www.w3.org/1999/xhtml">RequireAuthorization</span></code></td>
<td><p><span class="koboSpan" id="kobo.600.1" xmlns="http://www.w3.org/1999/xhtml">Specifies that only authorized users can access the endpoint(s). </span><span class="koboSpan" id="kobo.600.2" xmlns="http://www.w3.org/1999/xhtml">We can be more granular by using one of the overloads. </span><span class="koboSpan" id="kobo.600.3" xmlns="http://www.w3.org/1999/xhtml">For example, we can specify a policy name or an </span><code><span class="koboSpan" id="kobo.601.1" xmlns="http://www.w3.org/1999/xhtml">AuthorizationPolicy</span></code><span class="koboSpan" id="kobo.602.1" xmlns="http://www.w3.org/1999/xhtml"> instance.</span></p>
<p><em><span class="koboSpan" id="kobo.603.1" xmlns="http://www.w3.org/1999/xhtml">You must configure authorization for this to work</span></em><span class="koboSpan" id="kobo.604.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.605.1" xmlns="http://www.w3.org/1999/xhtml">RequireCors</span></code></td>
<td><p><span class="koboSpan" id="kobo.606.1" xmlns="http://www.w3.org/1999/xhtml">Specifies that the endpoint(s) must follow a CORS policy.</span></p>
<p><em><span class="koboSpan" id="kobo.607.1" xmlns="http://www.w3.org/1999/xhtml">You must configure CORS for this to work</span></em><span class="koboSpan" id="kobo.608.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.609.1" xmlns="http://www.w3.org/1999/xhtml">RequireRateLimiting</span></code></td>
<td><p><span class="koboSpan" id="kobo.610.1" xmlns="http://www.w3.org/1999/xhtml">Adds a rate-limiting policy to the endpoint(s).</span></p>
<p><em><span class="koboSpan" id="kobo.611.1" xmlns="http://www.w3.org/1999/xhtml">You must configure rate-limiting for this to work</span></em><span class="koboSpan" id="kobo.612.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.613.1" xmlns="http://www.w3.org/1999/xhtml">WithDescription</span></code></td>
<td><p><span class="koboSpan" id="kobo.614.1" xmlns="http://www.w3.org/1999/xhtml">Describes the route.</span></p>
<p><span class="koboSpan" id="kobo.615.1" xmlns="http://www.w3.org/1999/xhtml">When used on a group, the description cascades to all routes within that group.</span></p></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.616.1" xmlns="http://www.w3.org/1999/xhtml">WithName</span></code></td>
<td><p><span class="koboSpan" id="kobo.617.1" xmlns="http://www.w3.org/1999/xhtml">Attributes a name to the route. </span><span class="koboSpan" id="kobo.617.2" xmlns="http://www.w3.org/1999/xhtml">We can use this name to identify the route, which must be unique.</span></p>
<p><span class="koboSpan" id="kobo.618.1" xmlns="http://www.w3.org/1999/xhtml">For example, we can use the route name with the </span><code><span class="koboSpan" id="kobo.619.1" xmlns="http://www.w3.org/1999/xhtml">LinkGenerator</span></code><span class="koboSpan" id="kobo.620.1" xmlns="http://www.w3.org/1999/xhtml"> class to generate the URL of that endpoint.</span></p></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.621.1" xmlns="http://www.w3.org/1999/xhtml">WithOpenApi</span></code></td>
<td><p><span class="koboSpan" id="kobo.622.1" xmlns="http://www.w3.org/1999/xhtml">Ensure the builder adds the compatible metadata about the endpoint so tools like Swagger can generate the Open API specifications.</span></p>
<p><span class="koboSpan" id="kobo.623.1" xmlns="http://www.w3.org/1999/xhtml">We can also use this method to configure the operation and parameters instead of the other extension methods.</span></p>
<p><em><span class="koboSpan" id="kobo.624.1" xmlns="http://www.w3.org/1999/xhtml">You must call this method for many others to work.</span></em></p></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.625.1" xmlns="http://www.w3.org/1999/xhtml">WithSummary</span></code></td>
<td><p><span class="koboSpan" id="kobo.626.1" xmlns="http://www.w3.org/1999/xhtml">Add a summary to the route.</span></p>
<p><span class="koboSpan" id="kobo.627.1" xmlns="http://www.w3.org/1999/xhtml">When used on a group, the summary cascades to all routes within that group.</span></p></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.628.1" xmlns="http://www.w3.org/1999/xhtml">WithTags</span></code></td>
<td><p><span class="koboSpan" id="kobo.629.1" xmlns="http://www.w3.org/1999/xhtml">Add tags to the route.</span></p>
<p><span class="koboSpan" id="kobo.630.1" xmlns="http://www.w3.org/1999/xhtml">When used on a group, the tags cascade to all routes within that group.</span></p></td>
</tr>
</tbody>
</table><span class="koboSpan" id="kobo.631.1" xmlns="http://www.w3.org/1999/xhtml">
Table 5.10: Metadata helper methods.
</span><p><span class="koboSpan" id="kobo.632.1" xmlns="http://www.w3.org/1999/xhtml">Let’s look at an example that creates a group, tags it, then ensures that all routes under that group have their metadata harvestable by SwaggerGen (the API Explorer):</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.633.1" xmlns="http://www.w3.org/1999/xhtml">var metadataGroup = app
    .MapGroup("minimal-endpoint-metadata")
    .WithTags("Metadata Endpoints")
    .WithOpenApi()
;</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.634.1" xmlns="http://www.w3.org/1999/xhtml">We can now define endpoints on that group using the </span><code><span class="koboSpan" id="kobo.635.1" xmlns="http://www.w3.org/1999/xhtml">metadataGroup</span></code><span class="koboSpan" id="kobo.636.1" xmlns="http://www.w3.org/1999/xhtml"> as if it was the </span><code><span class="koboSpan" id="kobo.637.1" xmlns="http://www.w3.org/1999/xhtml">app</span></code><span class="koboSpan" id="kobo.638.1" xmlns="http://www.w3.org/1999/xhtml"> variable. </span><span class="koboSpan" id="kobo.638.2" xmlns="http://www.w3.org/1999/xhtml">Next, we create an endpoint that we name </span><code><span class="koboSpan" id="kobo.639.1" xmlns="http://www.w3.org/1999/xhtml">"Named Endpoint"</span></code><span class="koboSpan" id="kobo.640.1" xmlns="http://www.w3.org/1999/xhtml"> and describe it using the </span><code><span class="koboSpan" id="kobo.641.1" xmlns="http://www.w3.org/1999/xhtml">WithOpenApi</span></code><span class="koboSpan" id="kobo.642.1" xmlns="http://www.w3.org/1999/xhtml"> method, including deprecating it:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.643.1" xmlns="http://www.w3.org/1999/xhtml">const string NamedEndpointName = "Named Endpoint";
metadataGroup
    .MapGet(
        "with-name",
        () =&gt; $"Endpoint with name '{NamedEndpointName}'."
    </span><span class="koboSpan" id="kobo.643.2" xmlns="http://www.w3.org/1999/xhtml">)
    .WithName(NamedEndpointName)
    .WithOpenApi(operation =&gt; {
        operation.Description = "An endpoint that returns its name.";
        operation.Summary = $"Endpoint named '{NamedEndpointName}'.";
        operation.Deprecated = true;
        return operation;
    })
;</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.644.1" xmlns="http://www.w3.org/1999/xhtml">Next, we generate a URL based on the preceding named endpoint, we describe the endpoint using the </span><code><span class="koboSpan" id="kobo.645.1" xmlns="http://www.w3.org/1999/xhtml">WithDescription</span></code><span class="koboSpan" id="kobo.646.1" xmlns="http://www.w3.org/1999/xhtml"> method and add metadata to the </span><code><span class="koboSpan" id="kobo.647.1" xmlns="http://www.w3.org/1999/xhtml">endpointName</span></code><span class="koboSpan" id="kobo.648.1" xmlns="http://www.w3.org/1999/xhtml"> parameter, including an example. </span><span class="koboSpan" id="kobo.648.2" xmlns="http://www.w3.org/1999/xhtml">Once again we leverage the </span><code><span class="koboSpan" id="kobo.649.1" xmlns="http://www.w3.org/1999/xhtml">WithOpenApi</span></code><span class="koboSpan" id="kobo.650.1" xmlns="http://www.w3.org/1999/xhtml"> method:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.651.1" xmlns="http://www.w3.org/1999/xhtml">metadataGroup
    .MapGet(
        "url-of-named-endpoint/{endpointName?}",
        (string? </span><span class="koboSpan" id="kobo.651.2" xmlns="http://www.w3.org/1999/xhtml">endpointName, LinkGenerator linker) =&gt; {
            var name = endpointName ?? </span><span class="koboSpan" id="kobo.651.3" xmlns="http://www.w3.org/1999/xhtml">NamedEndpointName;
            return new {
                name,
                uri = linker.GetPathByName(name)
            };
        }
    )
    .WithDescription("Return the URL of the specified named endpoint.")
    .WithOpenApi(operation =&gt; {
        var endpointName = operation.Parameters[0];
        endpointName.Description = "The name of the endpoint to get the URL for.";
        endpointName.AllowEmptyValue = true;
        endpointName.Example = new OpenApiString(NamedEndpointName);
        return operation;
    })
;</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.652.1" xmlns="http://www.w3.org/1999/xhtml">When requesting the preceding endpoint, we get the URL of the specified route. </span><span class="koboSpan" id="kobo.652.2" xmlns="http://www.w3.org/1999/xhtml">By default, we get the URL of the </span><code><span class="koboSpan" id="kobo.653.1" xmlns="http://www.w3.org/1999/xhtml">"Named Endpoint"</span></code><span class="koboSpan" id="kobo.654.1" xmlns="http://www.w3.org/1999/xhtml"> route—our only named route—in the following JSON format:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.655.1" xmlns="http://www.w3.org/1999/xhtml">{
  "name": "Named Endpoint",
  "uri": "/minimal-endpoint-metadata/with-name"
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.656.1" xmlns="http://www.w3.org/1999/xhtml">As a last example, we can exclude a route from the metadata with the </span><code><span class="koboSpan" id="kobo.657.1" xmlns="http://www.w3.org/1999/xhtml">ExcludeFromDescription</span></code><span class="koboSpan" id="kobo.658.1" xmlns="http://www.w3.org/1999/xhtml"> method:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.659.1" xmlns="http://www.w3.org/1999/xhtml">metadataGroup
    .MapGet("excluded-from-open-api", () =&gt; { })
    .ExcludeFromDescription()
;</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.660.1" xmlns="http://www.w3.org/1999/xhtml">When looking at the Swagger UI, we can see the following section representing the group we just defined:</span></p>
<figure>
<span class="koboSpan" id="kobo.661.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 5.1: a screenshot of the Swagger UI “Metadata Endpoints” route group." src="../media/file25.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.662.1" xmlns="http://www.w3.org/1999/xhtml">Figure 5.1: a screenshot of the Swagger UI “Metadata Endpoints” route group.</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.663.1" xmlns="http://www.w3.org/1999/xhtml">We can see two endpoints in the preceding screenshot and, as expected, the third endpoint was excluded.The first route is marked as deprecated and shows a summary. </span><span class="koboSpan" id="kobo.663.2" xmlns="http://www.w3.org/1999/xhtml">When we open it, we see a warning, a description, no parameters, and one 200 OK response with a mime-type </span><code><span class="koboSpan" id="kobo.664.1" xmlns="http://www.w3.org/1999/xhtml">text/plain</span></code><span class="koboSpan" id="kobo.665.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.666.1" xmlns="http://www.w3.org/1999/xhtml">I omitted to add a screenshot of the Swagger UI for the first endpoint since it does not add much and would be hard to read. </span><span class="koboSpan" id="kobo.666.2" xmlns="http://www.w3.org/1999/xhtml">It is better to run the </span><code><span class="koboSpan" id="kobo.667.1" xmlns="http://www.w3.org/1999/xhtml">Minimal.API</span></code><span class="koboSpan" id="kobo.668.1" xmlns="http://www.w3.org/1999/xhtml"> program and navigate to the </span><code><span class="koboSpan" id="kobo.669.1" xmlns="http://www.w3.org/1999/xhtml">/swagger/index.html</span></code><span class="koboSpan" id="kobo.670.1" xmlns="http://www.w3.org/1999/xhtml"> URL instead.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.671.1" xmlns="http://www.w3.org/1999/xhtml">The second route does not have a summary, but when we open it, we have a description. </span><span class="koboSpan" id="kobo.671.2" xmlns="http://www.w3.org/1999/xhtml">The metadata we added for the </span><code><span class="koboSpan" id="kobo.672.1" xmlns="http://www.w3.org/1999/xhtml">endpointName</span></code><span class="koboSpan" id="kobo.673.1" xmlns="http://www.w3.org/1999/xhtml"> parameter is there, and most interestingly, the example became the default value:</span></p>
<figure>
<span class="koboSpan" id="kobo.674.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 5.2: a screenshot of the Swagger UI showcasing the metadata of the endpointName parameter." src="../media/file26.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.675.1" xmlns="http://www.w3.org/1999/xhtml">Figure 5.2: a screenshot of the Swagger UI showcasing the metadata of the </span><code><span class="koboSpan" id="kobo.676.1" xmlns="http://www.w3.org/1999/xhtml">endpointName</span></code><span class="koboSpan" id="kobo.677.1" xmlns="http://www.w3.org/1999/xhtml"> parameter.</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.678.1" xmlns="http://www.w3.org/1999/xhtml">Swagger UI can become very handy for manually calling our API during development or leveraging other Open API compatible tools. </span><span class="koboSpan" id="kobo.678.2" xmlns="http://www.w3.org/1999/xhtml">For example, we could generate code based on the Open API specs, like a TypeScript client.Next, we explore how to configure the Minimal API JSON serializer.</span></p>
</section>
<section class="level4" data-number="6.4.2.4" id="configuring-json-serialization">
<h4 data-number="6.4.2.4"><span class="koboSpan" id="kobo.679.1" xmlns="http://www.w3.org/1999/xhtml">Configuring JSON serialization</span></h4>
<p><span class="koboSpan" id="kobo.680.1" xmlns="http://www.w3.org/1999/xhtml">In ASP.NET Core, we can customize the JSON serializer globally or create a new one for a specific scenario.To change the default serializer behaviors, we can invoke the </span><code><span class="koboSpan" id="kobo.681.1" xmlns="http://www.w3.org/1999/xhtml">ConfigureHttpJsonOptions</span></code><span class="koboSpan" id="kobo.682.1" xmlns="http://www.w3.org/1999/xhtml"> method, which configures the </span><code><span class="koboSpan" id="kobo.683.1" xmlns="http://www.w3.org/1999/xhtml">JsonOptions</span></code><span class="koboSpan" id="kobo.684.1" xmlns="http://www.w3.org/1999/xhtml"> object. </span><span class="koboSpan" id="kobo.684.2" xmlns="http://www.w3.org/1999/xhtml">From there, we can change the options like this:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.685.1" xmlns="http://www.w3.org/1999/xhtml">builder.Services.ConfigureHttpJsonOptions(options =&gt; {
    options.SerializerOptions.PropertyNamingPolicy = JsonNamingPolicy.KebabCaseLower;
});</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.686.1" xmlns="http://www.w3.org/1999/xhtml">With the preceding code in the </span><code><span class="koboSpan" id="kobo.687.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.688.1" xmlns="http://www.w3.org/1999/xhtml"> file, we tell the serializer to serialize the property name following a </span><code><span class="koboSpan" id="kobo.689.1" xmlns="http://www.w3.org/1999/xhtml">lower-case-kebab</span></code><span class="koboSpan" id="kobo.690.1" xmlns="http://www.w3.org/1999/xhtml"> naming convention. </span><span class="koboSpan" id="kobo.690.2" xmlns="http://www.w3.org/1999/xhtml">Here is an example:</span></p>
<table>
<colgroup>
<col style="width: 50%"/>
<col style="width: 50%"/>
</colgroup>
<tbody>
<tr class="odd">
<td><strong><span class="koboSpan" id="kobo.691.1" xmlns="http://www.w3.org/1999/xhtml">Endpoint</span></strong></td>
<td><strong><span class="koboSpan" id="kobo.692.1" xmlns="http://www.w3.org/1999/xhtml">Response</span></strong></td>
</tr>
<tr class="even">
<td><p><span class="koboSpan" id="kobo.693.1" xmlns="http://www.w3.org/1999/xhtml">jsonGroup.MapGet(</span></p>
<p><span class="koboSpan" id="kobo.694.1" xmlns="http://www.w3.org/1999/xhtml">"kebab-person/",</span></p>
<p><span class="koboSpan" id="kobo.695.1" xmlns="http://www.w3.org/1999/xhtml">() =&gt; new {</span></p>
<p><span class="koboSpan" id="kobo.696.1" xmlns="http://www.w3.org/1999/xhtml">FirstName = "John",</span></p>
<p><span class="koboSpan" id="kobo.697.1" xmlns="http://www.w3.org/1999/xhtml">LastName = "Doe"</span></p>
<p><span class="koboSpan" id="kobo.698.1" xmlns="http://www.w3.org/1999/xhtml">}</span></p>
<p><span class="koboSpan" id="kobo.699.1" xmlns="http://www.w3.org/1999/xhtml">);</span></p></td>
<td><p><span class="koboSpan" id="kobo.700.1" xmlns="http://www.w3.org/1999/xhtml">{</span></p>
<p><span class="koboSpan" id="kobo.701.1" xmlns="http://www.w3.org/1999/xhtml">"first-name": "John",</span></p>
<p><span class="koboSpan" id="kobo.702.1" xmlns="http://www.w3.org/1999/xhtml">"last-name": "Doe"</span></p>
<p><span class="koboSpan" id="kobo.703.1" xmlns="http://www.w3.org/1999/xhtml">}</span></p></td>
</tr>
</tbody>
</table><span class="koboSpan" id="kobo.704.1" xmlns="http://www.w3.org/1999/xhtml">
Table 5.11: Showcasing the output of the JsonNamingPolicy.KebabCaseLower policy.
</span><p><span class="koboSpan" id="kobo.705.1" xmlns="http://www.w3.org/1999/xhtml">We can achieve the same for specific endpoints by using the </span><code><span class="koboSpan" id="kobo.706.1" xmlns="http://www.w3.org/1999/xhtml">TypedResults.Json</span></code><span class="koboSpan" id="kobo.707.1" xmlns="http://www.w3.org/1999/xhtml"> method and specifying an instance of </span><code><span class="koboSpan" id="kobo.708.1" xmlns="http://www.w3.org/1999/xhtml">JsonSerializerOptions</span></code><span class="koboSpan" id="kobo.709.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.709.2" xmlns="http://www.w3.org/1999/xhtml">The following code accomplishes the same outcome while preserving the default serialization options:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.710.1" xmlns="http://www.w3.org/1999/xhtml">var kebabSerializer = new JsonSerializerOptions(JsonSerializerDefaults.Web)
{
    PropertyNamingPolicy = JsonNamingPolicy.KebabCaseLower
};
jsonGroup.MapGet(
    "kebab-person/",
    () =&gt; TypedResults.Json(new {
        FirstName = "John",
        LastName = "Doe"
    }, kebabSerializer)
);</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.711.1" xmlns="http://www.w3.org/1999/xhtml">I highlighted the changes between this code and the previous example. </span><span class="koboSpan" id="kobo.711.2" xmlns="http://www.w3.org/1999/xhtml">First, we create an instance of the </span><code><span class="koboSpan" id="kobo.712.1" xmlns="http://www.w3.org/1999/xhtml">JsonSerializerOptions</span></code><span class="koboSpan" id="kobo.713.1" xmlns="http://www.w3.org/1999/xhtml"> class. </span><span class="koboSpan" id="kobo.713.2" xmlns="http://www.w3.org/1999/xhtml">To simplify the configuration, we start with the default web serialization values by passing the </span><code><span class="koboSpan" id="kobo.714.1" xmlns="http://www.w3.org/1999/xhtml">JsonSerializerDefaults.Web</span></code><span class="koboSpan" id="kobo.715.1" xmlns="http://www.w3.org/1999/xhtml"> argument to the constructor. </span><span class="koboSpan" id="kobo.715.2" xmlns="http://www.w3.org/1999/xhtml">Then, in the object initializer, we set the value of the </span><code><span class="koboSpan" id="kobo.716.1" xmlns="http://www.w3.org/1999/xhtml">PropertyNamingPolicy</span></code><span class="koboSpan" id="kobo.717.1" xmlns="http://www.w3.org/1999/xhtml"> property to </span><code><span class="koboSpan" id="kobo.718.1" xmlns="http://www.w3.org/1999/xhtml">JsonNamingPolicy.KebabCaseLower</span></code><span class="koboSpan" id="kobo.719.1" xmlns="http://www.w3.org/1999/xhtml">, which end up with the same result as before. </span><span class="koboSpan" id="kobo.719.2" xmlns="http://www.w3.org/1999/xhtml">Finally, to use our options, we pass the </span><code><span class="koboSpan" id="kobo.720.1" xmlns="http://www.w3.org/1999/xhtml">kebabSerializer</span></code><span class="koboSpan" id="kobo.721.1" xmlns="http://www.w3.org/1999/xhtml"> variable as the second argument of the </span><code><span class="koboSpan" id="kobo.722.1" xmlns="http://www.w3.org/1999/xhtml">TypedResults.Json</span></code><span class="koboSpan" id="kobo.723.1" xmlns="http://www.w3.org/1999/xhtml"> method.</span></p>
<section class="level5" data-number="6.4.2.4.1" id="serializing-enums-as-string">
<h5 data-number="6.4.2.4.1"><span class="koboSpan" id="kobo.724.1" xmlns="http://www.w3.org/1999/xhtml">Serializing enums as string</span></h5>
<p><span class="koboSpan" id="kobo.725.1" xmlns="http://www.w3.org/1999/xhtml">I often find myself changing a configuration to output the string representation of an </span><code><span class="koboSpan" id="kobo.726.1" xmlns="http://www.w3.org/1999/xhtml">enum</span></code><span class="koboSpan" id="kobo.727.1" xmlns="http://www.w3.org/1999/xhtml"> value. </span><span class="koboSpan" id="kobo.727.2" xmlns="http://www.w3.org/1999/xhtml">To do so, we must register an instance of the </span><code><span class="koboSpan" id="kobo.728.1" xmlns="http://www.w3.org/1999/xhtml">JsonStringEnumConverter</span></code><span class="koboSpan" id="kobo.729.1" xmlns="http://www.w3.org/1999/xhtml"> class. </span><span class="koboSpan" id="kobo.729.2" xmlns="http://www.w3.org/1999/xhtml">Afterward, enums will be serialized as strings. </span><span class="koboSpan" id="kobo.729.3" xmlns="http://www.w3.org/1999/xhtml">Here is an example:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.730.1" xmlns="http://www.w3.org/1999/xhtml">var enumSerializer = new JsonSerializerOptions(JsonSerializerDefaults.Web);
enumSerializer.Converters.Add(new JsonStringEnumConverter());
jsonGroup.MapGet(
    "enum-as-string/",
    () =&gt; TypedResults.Json(new {
        FirstName = "John",
        LastName = "Doe",
        Rating = Rating.Good,
    }, enumSerializer)
);</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.731.1" xmlns="http://www.w3.org/1999/xhtml">When executing the preceding code, we obtain the following result:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.732.1" xmlns="http://www.w3.org/1999/xhtml">{
  "firstName": "John",
  "lastName": "Doe",
  "rating": "Good"
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.733.1" xmlns="http://www.w3.org/1999/xhtml">Using the default options yields the following instead:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.734.1" xmlns="http://www.w3.org/1999/xhtml">{
  "firstName": "John",
  "lastName": "Doe",
  "rating": 2
}</span></code></pre>
</div>
<blockquote>
<p><span class="koboSpan" id="kobo.735.1" xmlns="http://www.w3.org/1999/xhtml">I usually change this option globally since having a human-readable value instead of a number is more explicit, easier to understand for a human, and easier to leverage for a client (machine).</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.736.1" xmlns="http://www.w3.org/1999/xhtml">Many other options exist to tweak the serializer, but we can’t explore them all here. </span><span class="koboSpan" id="kobo.736.2" xmlns="http://www.w3.org/1999/xhtml">Next, we look at endpoint filters.</span></p>
</section>
</section>
</section>
<section class="level3" data-number="6.4.3" id="leveraging-endpoint-filters">
<h3 data-number="6.4.3"><span class="koboSpan" id="kobo.737.1" xmlns="http://www.w3.org/1999/xhtml">Leveraging endpoint filters</span></h3>
<p><span class="koboSpan" id="kobo.738.1" xmlns="http://www.w3.org/1999/xhtml">ASP.NET Core 7.0 added the possibility to register endpoint filters. </span><span class="koboSpan" id="kobo.738.2" xmlns="http://www.w3.org/1999/xhtml">This way, we can encapsulate and reuse cross-cutting concerns and logic across endpoints.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.739.1" xmlns="http://www.w3.org/1999/xhtml">An example of reusability is that I prefer FluentValidation to .NET attributes, so I created an open-source project implementing a filter that ties Minimal APIs with FluentValidation. </span><span class="koboSpan" id="kobo.739.2" xmlns="http://www.w3.org/1999/xhtml">I can then reuse that filter across projects by referencing a NuGet package. </span><span class="koboSpan" id="kobo.739.3" xmlns="http://www.w3.org/1999/xhtml">We explore FluentValidation in </span><em><span class="koboSpan" id="kobo.740.1" xmlns="http://www.w3.org/1999/xhtml">Section 4: Application Patterns</span></em><span class="koboSpan" id="kobo.741.1" xmlns="http://www.w3.org/1999/xhtml">, and I left a link to that project in the </span><em><span class="koboSpan" id="kobo.742.1" xmlns="http://www.w3.org/1999/xhtml">Further Reading</span></em><span class="koboSpan" id="kobo.743.1" xmlns="http://www.w3.org/1999/xhtml"> section.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.744.1" xmlns="http://www.w3.org/1999/xhtml">How does it work?</span></p>
<ul>
<li><span class="koboSpan" id="kobo.745.1" xmlns="http://www.w3.org/1999/xhtml">We can register endpoint filters inline or by creating a class.</span></li>
<li><span class="koboSpan" id="kobo.746.1" xmlns="http://www.w3.org/1999/xhtml">We can add filters to an endpoint or a group using the </span><code><span class="koboSpan" id="kobo.747.1" xmlns="http://www.w3.org/1999/xhtml">AddEndpointFilter</span></code><span class="koboSpan" id="kobo.748.1" xmlns="http://www.w3.org/1999/xhtml"> method.</span></li>
<li><span class="koboSpan" id="kobo.749.1" xmlns="http://www.w3.org/1999/xhtml">When adding a filter to a group, it applies to all its children.</span></li>
<li><span class="koboSpan" id="kobo.750.1" xmlns="http://www.w3.org/1999/xhtml">We can add multiple filters per endpoint or group.</span></li>
<li><span class="koboSpan" id="kobo.751.1" xmlns="http://www.w3.org/1999/xhtml">ASP.NET Core executes the filters in the order they are registered.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.752.1" xmlns="http://www.w3.org/1999/xhtml">Let’s look at a simple inline filter:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.753.1" xmlns="http://www.w3.org/1999/xhtml">inlineGroup
    .MapGet("basic", () =&gt; { })
    .AddEndpointFilter((context, next) =&gt;
    {
        return next(context);
    });</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.754.1" xmlns="http://www.w3.org/1999/xhtml">The highlighted code represents the filter in the form of a delegate. </span><span class="koboSpan" id="kobo.754.2" xmlns="http://www.w3.org/1999/xhtml">The filter does nothing but executes the next delegate in the chain, in this case, the endpoint delegate itself.In the following example, we use the </span><code><span class="koboSpan" id="kobo.755.1" xmlns="http://www.w3.org/1999/xhtml">Rating</span></code><span class="koboSpan" id="kobo.756.1" xmlns="http://www.w3.org/1999/xhtml"> enum and only accept positive ratings in the endpoint. </span><span class="koboSpan" id="kobo.756.2" xmlns="http://www.w3.org/1999/xhtml">To achieve this, we add a filter that validates the input value before reaching the endpoint:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.757.1" xmlns="http://www.w3.org/1999/xhtml">public enum Rating
{
    Bad = 0,
    Ok,
    Good,
    Amazing
}
// ...
</span><span class="koboSpan" id="kobo.757.2" xmlns="http://www.w3.org/1999/xhtml">inlineGroup
    .MapGet("good-rating/{rating}", (Rating rating)
        =&gt; TypedResults.Ok(new { Rating = rating }))
    .AddEndpointFilter(async (context, next) =&gt;
    {
        var rating = context.GetArgument&lt;Rating&gt;(0);
        if (rating == Rating.Bad)
        {
            return TypedResults.Problem(
                detail: "This endpoint is biased and only accepts positive ratings.",
                statusCode: StatusCodes.Status400BadRequest
            );
        }
        return await next(context);
    });</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.758.1" xmlns="http://www.w3.org/1999/xhtml">From the filter, we leveraged the </span><code><span class="koboSpan" id="kobo.759.1" xmlns="http://www.w3.org/1999/xhtml">EndpointFilterFactoryContext</span></code><span class="koboSpan" id="kobo.760.1" xmlns="http://www.w3.org/1999/xhtml"> to access the rating argument. </span><span class="koboSpan" id="kobo.760.2" xmlns="http://www.w3.org/1999/xhtml">The code then validates that the rating is not </span><code><span class="koboSpan" id="kobo.761.1" xmlns="http://www.w3.org/1999/xhtml">Bad</span></code><span class="koboSpan" id="kobo.762.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.762.2" xmlns="http://www.w3.org/1999/xhtml">If the rating is </span><code><span class="koboSpan" id="kobo.763.1" xmlns="http://www.w3.org/1999/xhtml">Bad</span></code><span class="koboSpan" id="kobo.764.1" xmlns="http://www.w3.org/1999/xhtml">, the filter immediately returns a </span><em><span class="koboSpan" id="kobo.765.1" xmlns="http://www.w3.org/1999/xhtml">problem details</span></em><span class="koboSpan" id="kobo.766.1" xmlns="http://www.w3.org/1999/xhtml"> with a </span><code><span class="koboSpan" id="kobo.767.1" xmlns="http://www.w3.org/1999/xhtml">400 Bad Request</span></code><span class="koboSpan" id="kobo.768.1" xmlns="http://www.w3.org/1999/xhtml"> status code before reaching out to the endpoint delegate. </span><span class="koboSpan" id="kobo.768.2" xmlns="http://www.w3.org/1999/xhtml">Otherwise, the endpoint code is executed.You probably wonder how useful writing code like this can be; well, this case is purely educational and not that useful in a real-world scenario. </span><span class="koboSpan" id="kobo.768.3" xmlns="http://www.w3.org/1999/xhtml">We could have validated the parameter in the endpoint delegate directly and saved ourselves the trouble of accessing it through its index. </span><span class="koboSpan" id="kobo.768.4" xmlns="http://www.w3.org/1999/xhtml">Nonetheless, it shows how filters work so that you can build helpful real-life filters with this knowledge; remember that coding is like playing LEGO® blocks.To improve on this foundation and make the previous example reusable, we can extract the filter logic into a class and apply it to multiple endpoints. </span><span class="koboSpan" id="kobo.768.5" xmlns="http://www.w3.org/1999/xhtml">We could also move the inline implementation to a group so it affects all its children. </span><span class="koboSpan" id="kobo.768.6" xmlns="http://www.w3.org/1999/xhtml">Let’s have a look at making our inline filter a class.A filter class must implement the </span><code><span class="koboSpan" id="kobo.769.1" xmlns="http://www.w3.org/1999/xhtml">IEndpointFilter</span></code><span class="koboSpan" id="kobo.770.1" xmlns="http://www.w3.org/1999/xhtml"> interface. </span><span class="koboSpan" id="kobo.770.2" xmlns="http://www.w3.org/1999/xhtml">Here’s the reimplementation of the previous logic in the </span><code><span class="koboSpan" id="kobo.771.1" xmlns="http://www.w3.org/1999/xhtml">GoodRatingFilter</span></code><span class="koboSpan" id="kobo.772.1" xmlns="http://www.w3.org/1999/xhtml"> class, and two endpoints using it:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.773.1" xmlns="http://www.w3.org/1999/xhtml">filterGroup
    .MapGet("good-rating/{rating}", (Rating rating)
        =&gt; TypedResults.Ok(new { Rating = rating }))
    .AddEndpointFilter&lt;GoodRatingFilter&gt;();
;
filterGroup
    .MapPut("good-rating/{rating}", (Rating rating)
        =&gt; TypedResults.Ok(new { Rating = rating }))
    .AddEndpointFilter&lt;GoodRatingFilter&gt;();
;
public class GoodRatingFilter : IEndpointFilter
{
    public async ValueTask&lt;object?&gt; InvokeAsync(
        EndpointFilterInvocationContext context, 
        EndpointFilterDelegate next)
    {
        var rating = context.GetArgument&lt;Rating&gt;(0);
        if (rating == Rating.Bad)
        {
            return TypedResults.Problem(
                detail: "This endpoint is biased and only accepts positive ratings.",
                statusCode: StatusCodes.Status400BadRequest
            );
        }
        return await next(context);
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.774.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.775.1" xmlns="http://www.w3.org/1999/xhtml">GoodRatingFilter</span></code><span class="koboSpan" id="kobo.776.1" xmlns="http://www.w3.org/1999/xhtml"> class </span><code><span class="koboSpan" id="kobo.777.1" xmlns="http://www.w3.org/1999/xhtml">InvokeAsync</span></code><span class="koboSpan" id="kobo.778.1" xmlns="http://www.w3.org/1999/xhtml"> method code is the same as the inline version. </span><span class="koboSpan" id="kobo.778.2" xmlns="http://www.w3.org/1999/xhtml">However, we used it twice, keeping our code DRY.Encapsulating pieces of logic in filters can be very beneficial, whether it is input validation, logging, exception handling, or another scenario.And this is not it; there is one more thing about filters we must explore.</span></p>
</section>
<section class="level3" data-number="6.4.4" id="leveraging-the-endpoint-filter-factory">
<h3 data-number="6.4.4"><span class="koboSpan" id="kobo.779.1" xmlns="http://www.w3.org/1999/xhtml">Leveraging the endpoint filter factory</span></h3>
<p><span class="koboSpan" id="kobo.780.1" xmlns="http://www.w3.org/1999/xhtml">We can use an endpoint filter factory to run code when ASP.NET Core builds the endpoint (makes the </span><code><span class="koboSpan" id="kobo.781.1" xmlns="http://www.w3.org/1999/xhtml">RequestDelegate</span></code><span class="koboSpan" id="kobo.782.1" xmlns="http://www.w3.org/1999/xhtml">) before declaring the filter. </span><span class="koboSpan" id="kobo.782.2" xmlns="http://www.w3.org/1999/xhtml">Then, from the factory, we control the creation of the filter itself.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.783.1" xmlns="http://www.w3.org/1999/xhtml">We explore the factory pattern in </span><em><span class="koboSpan" id="kobo.784.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 7</span></em><span class="koboSpan" id="kobo.785.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.786.1" xmlns="http://www.w3.org/1999/xhtml">The following code registers an endpoint filter factory:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.787.1" xmlns="http://www.w3.org/1999/xhtml">inlineGroup
    .MapGet("endpoint-filter-factory", () =&gt; "RAW")
    .AddEndpointFilterFactory((filterFactoryContext, next) =&gt;
    {
        // Building RequestDelegate code here.
        </span><span class="koboSpan" id="kobo.787.2" xmlns="http://www.w3.org/1999/xhtml">var logger = filterFactoryContext.ApplicationServices
            .GetRequiredService&lt;ILoggerFactory&gt;()
            .CreateLogger("endpoint-filter-factory");
        logger.LogInformation("Code that runs when ASP.NET Core builds the RequestDelegate");
        // Returns the EndpointFilterDelegate ASP.NET Core executes as part of the pipeline.
        </span><span class="koboSpan" id="kobo.787.3" xmlns="http://www.w3.org/1999/xhtml">return async invocationContext =&gt;
        {
            logger.LogInformation("Code that ASP.NET Core executes as part of the pipeline");
            // Filter code here
            return await next(invocationContext);
        };
    });</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.788.1" xmlns="http://www.w3.org/1999/xhtml">The preceding code adds an endpoint filter factory that logs some information to the console, which allows us to track what is happening. </span><span class="koboSpan" id="kobo.788.2" xmlns="http://www.w3.org/1999/xhtml">The highlighted code represents the filter itself. </span><span class="koboSpan" id="kobo.788.3" xmlns="http://www.w3.org/1999/xhtml">For example, we could write the same code as the </span><code><span class="koboSpan" id="kobo.789.1" xmlns="http://www.w3.org/1999/xhtml">GoodRatingFilter</span></code><span class="koboSpan" id="kobo.790.1" xmlns="http://www.w3.org/1999/xhtml"> class there.Next, let’s look at what happens when we execute the program and load the endpoint five times:</span></p>
<div class="C0-ConsolePACKT">
<pre><code><span class="koboSpan" id="kobo.791.1" xmlns="http://www.w3.org/1999/xhtml">[11:22:56.673] info: Microsoft.Hosting.Lifetime[14]
      Now listening on: https://localhost:7298
[11:22:56.698] info: Microsoft.Hosting.Lifetime[14]
      Now listening on: http://localhost:5085
[11:22:56.702] info: Microsoft.Hosting.Lifetime[0]
      Application started. </span><span class="koboSpan" id="kobo.791.2" xmlns="http://www.w3.org/1999/xhtml">Press Ctrl+C to shut down.
</span><span class="koboSpan" id="kobo.791.3" xmlns="http://www.w3.org/1999/xhtml">[11:22:56.705] info: Microsoft.Hosting.Lifetime[0]
      Hosting environment: Development
[11:22:56.708] info: Microsoft.Hosting.Lifetime[0]
      Content root path: .../C05/Minimal.API
[11:23:28.349] info: endpoint-filter-factory[0]
      Code that runs when ASP.NET Core builds the RequestDelegate
[11:23:45.181] info: endpoint-filter-factory[0]
      Code that runs when ASP.NET Core builds the RequestDelegate
[11:24:56.043] info: endpoint-filter-factory[0]
      Code that ASP.NET Core executes as part of the pipeline
[11:24:57.439] info: endpoint-filter-factory[0]
      Code that ASP.NET Core executes as part of the pipeline
[11:24:58.443] info: endpoint-filter-factory[0]
      Code that ASP.NET Core executes as part of the pipeline
[11:24:59.262] info: endpoint-filter-factory[0]
      Code that ASP.NET Core executes as part of the pipeline
[11:25:00.154] info: endpoint-filter-factory[0]
      Code that ASP.NET Core executes as part of the pipeline</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.792.1" xmlns="http://www.w3.org/1999/xhtml">Here’s what happened from the preceding output:</span></p>
<ol>
<li><span class="koboSpan" id="kobo.793.1" xmlns="http://www.w3.org/1999/xhtml">The API starts (the first ten lines).</span></li>
<li><span class="koboSpan" id="kobo.794.1" xmlns="http://www.w3.org/1999/xhtml">ASP.NET Core executes the factory code when building the </span><code><span class="koboSpan" id="kobo.795.1" xmlns="http://www.w3.org/1999/xhtml">RequestDelegate</span></code><span class="koboSpan" id="kobo.796.1" xmlns="http://www.w3.org/1999/xhtml"> from the </span><code><span class="koboSpan" id="kobo.797.1" xmlns="http://www.w3.org/1999/xhtml">EndpointRoutingMiddleware</span></code><span class="koboSpan" id="kobo.798.1" xmlns="http://www.w3.org/1999/xhtml"> (the next two lines).</span></li>
<li><code><span class="koboSpan" id="kobo.799.1" xmlns="http://www.w3.org/1999/xhtml">SwaggerGen</span></code><span class="koboSpan" id="kobo.800.1" xmlns="http://www.w3.org/1999/xhtml">, using the </span><code><span class="koboSpan" id="kobo.801.1" xmlns="http://www.w3.org/1999/xhtml">ApiExplorer</span></code><span class="koboSpan" id="kobo.802.1" xmlns="http://www.w3.org/1999/xhtml">, also does the same from the </span><code><span class="koboSpan" id="kobo.803.1" xmlns="http://www.w3.org/1999/xhtml">SwaggerMiddleware</span></code><span class="koboSpan" id="kobo.804.1" xmlns="http://www.w3.org/1999/xhtml">, hence the second factory call (the next two lines).</span></li>
<li><span class="koboSpan" id="kobo.805.1" xmlns="http://www.w3.org/1999/xhtml">Afterward, ASP.NET Core only executes the filters during requests—in this case, five times (the last 10 lines).</span></li>
</ol>
<p><span class="koboSpan" id="kobo.806.1" xmlns="http://www.w3.org/1999/xhtml">Now that we’ve seen how it runs, it is time to learn how it works.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.807.1" xmlns="http://www.w3.org/1999/xhtml">Don’t worry if you don’t understand how the </span><code><span class="koboSpan" id="kobo.808.1" xmlns="http://www.w3.org/1999/xhtml">GetRequiredService</span></code><span class="koboSpan" id="kobo.809.1" xmlns="http://www.w3.org/1999/xhtml"> method or the </span><code><span class="koboSpan" id="kobo.810.1" xmlns="http://www.w3.org/1999/xhtml">ILoggerFactory</span></code><span class="koboSpan" id="kobo.811.1" xmlns="http://www.w3.org/1999/xhtml"> interface work; we explore those topics in </span><em><span class="koboSpan" id="kobo.812.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 8</span></em><span class="koboSpan" id="kobo.813.1" xmlns="http://www.w3.org/1999/xhtml">, </span><em><span class="koboSpan" id="kobo.814.1" xmlns="http://www.w3.org/1999/xhtml">Dependency Injection</span></em><span class="koboSpan" id="kobo.815.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><em><span class="koboSpan" id="kobo.816.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 10</span></em><span class="koboSpan" id="kobo.817.1" xmlns="http://www.w3.org/1999/xhtml">, </span><em><span class="koboSpan" id="kobo.818.1" xmlns="http://www.w3.org/1999/xhtml">Logging</span></em><span class="koboSpan" id="kobo.819.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.820.1" xmlns="http://www.w3.org/1999/xhtml">We start by registering the endpoint filter factory using the </span><code><span class="koboSpan" id="kobo.821.1" xmlns="http://www.w3.org/1999/xhtml">AddEndpointFilterFactory</span></code><span class="koboSpan" id="kobo.822.1" xmlns="http://www.w3.org/1999/xhtml"> method, which applies to groups and individual routes (we dig deeper into groups next). </span><span class="koboSpan" id="kobo.822.2" xmlns="http://www.w3.org/1999/xhtml">The factory delegate is of type </span><code><span class="koboSpan" id="kobo.823.1" xmlns="http://www.w3.org/1999/xhtml">Func&lt;EndpointFilterFactoryContext, EndpointFilterDelegate, EndpointFilterDelegate&gt;</span></code><span class="koboSpan" id="kobo.824.1" xmlns="http://www.w3.org/1999/xhtml">.Inside the delegate, using the </span><code><span class="koboSpan" id="kobo.825.1" xmlns="http://www.w3.org/1999/xhtml">EndpointFilterFactoryContext</span></code><span class="koboSpan" id="kobo.826.1" xmlns="http://www.w3.org/1999/xhtml"> parameter named </span><code><span class="koboSpan" id="kobo.827.1" xmlns="http://www.w3.org/1999/xhtml">filterFactoryContext</span></code><span class="koboSpan" id="kobo.828.1" xmlns="http://www.w3.org/1999/xhtml">, we have access to the following objects:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.829.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.830.1" xmlns="http://www.w3.org/1999/xhtml">ApplicationServices</span></code><span class="koboSpan" id="kobo.831.1" xmlns="http://www.w3.org/1999/xhtml"> property provides access to an </span><code><span class="koboSpan" id="kobo.832.1" xmlns="http://www.w3.org/1999/xhtml">IServiceProvider</span></code><span class="koboSpan" id="kobo.833.1" xmlns="http://www.w3.org/1999/xhtml"> interface, allowing us to extract services from the container, as demonstrated with the </span><code><span class="koboSpan" id="kobo.834.1" xmlns="http://www.w3.org/1999/xhtml">ILoggerFactory</span></code><span class="koboSpan" id="kobo.835.1" xmlns="http://www.w3.org/1999/xhtml"> interface.</span></li>
<li><span class="koboSpan" id="kobo.836.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.837.1" xmlns="http://www.w3.org/1999/xhtml">MethodInfo</span></code><span class="koboSpan" id="kobo.838.1" xmlns="http://www.w3.org/1999/xhtml"> property offers a </span><code><span class="koboSpan" id="kobo.839.1" xmlns="http://www.w3.org/1999/xhtml">MethodInfo</span></code><span class="koboSpan" id="kobo.840.1" xmlns="http://www.w3.org/1999/xhtml"> object granting access to the caller to which we add the endpoint filter factory. </span><span class="koboSpan" id="kobo.840.2" xmlns="http://www.w3.org/1999/xhtml">This object encapsulates the reflection data, including types, generic parameters, attributes, and more.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.841.1" xmlns="http://www.w3.org/1999/xhtml">Finally, the factory delegate returns the filter ASP.NET Core executes when a request hits the endpoint(s). </span><span class="koboSpan" id="kobo.841.2" xmlns="http://www.w3.org/1999/xhtml">In this case, the filter is the following:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.842.1" xmlns="http://www.w3.org/1999/xhtml">async invocationContext =&gt;
{
    logger.LogInformation("Code that ASP.NET Core executes as part of the pipeline");
    return await next(invocationContext);
};</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.843.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.844.1" xmlns="http://www.w3.org/1999/xhtml">next</span></code><span class="koboSpan" id="kobo.845.1" xmlns="http://www.w3.org/1999/xhtml"> parameter (highlighted code) represents the next filter in line or the endpoint itself—it works the same here as with any endpoint filter. </span><span class="koboSpan" id="kobo.845.2" xmlns="http://www.w3.org/1999/xhtml">Not calling the </span><code><span class="koboSpan" id="kobo.846.1" xmlns="http://www.w3.org/1999/xhtml">next</span></code><span class="koboSpan" id="kobo.847.1" xmlns="http://www.w3.org/1999/xhtml"> parameter means ASP.NET Core will never execute the endpoint code, which is a way to control the flow of the application.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.848.1" xmlns="http://www.w3.org/1999/xhtml">To make an endpoint filter factory more reusable, we could create a class, an extension method, or return an existing filter class. </span><span class="koboSpan" id="kobo.848.2" xmlns="http://www.w3.org/1999/xhtml">We can also combine those ways to craft a more testable and DRY implementation of an endpoint filter factory. </span><span class="koboSpan" id="kobo.848.3" xmlns="http://www.w3.org/1999/xhtml">While we won't delve into these specific approaches in this context, by the end of the book, you should have acquired enough knowledge to achieve these tasks by yourself.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.849.1" xmlns="http://www.w3.org/1999/xhtml">Next, we look at organizing our endpoints.</span></p>
</section>
<section class="level3" data-number="6.4.5" id="organizing-endpoints">
<h3 data-number="6.4.5"><span class="koboSpan" id="kobo.850.1" xmlns="http://www.w3.org/1999/xhtml">Organizing endpoints</span></h3>
<p><span class="koboSpan" id="kobo.851.1" xmlns="http://www.w3.org/1999/xhtml">Grouping endpoints using the </span><code><span class="koboSpan" id="kobo.852.1" xmlns="http://www.w3.org/1999/xhtml">MapGroup</span></code><span class="koboSpan" id="kobo.853.1" xmlns="http://www.w3.org/1999/xhtml"> method is an effective organizational strategy. </span><span class="koboSpan" id="kobo.853.2" xmlns="http://www.w3.org/1999/xhtml">However, defining all routes directly within the </span><code><span class="koboSpan" id="kobo.854.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.855.1" xmlns="http://www.w3.org/1999/xhtml"> file can result in a long and challenging-to-navigate file. </span><span class="koboSpan" id="kobo.855.2" xmlns="http://www.w3.org/1999/xhtml">To mitigate this, we can arrange these groups of endpoints in separate classes and create an extension method to add these endpoints to the </span><code><span class="koboSpan" id="kobo.856.1" xmlns="http://www.w3.org/1999/xhtml">IEndpointRouteBuilder</span></code><span class="koboSpan" id="kobo.857.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.857.2" xmlns="http://www.w3.org/1999/xhtml">We can also encapsulate the groups, or even multiple groups, within another assembly, which we can load from the API.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.858.1" xmlns="http://www.w3.org/1999/xhtml">We explore ways to design applications in </span><em><span class="koboSpan" id="kobo.859.1" xmlns="http://www.w3.org/1999/xhtml">Section 4: Application Patterns</span></em><span class="koboSpan" id="kobo.860.1" xmlns="http://www.w3.org/1999/xhtml">, including in </span><em><span class="koboSpan" id="kobo.861.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 18</span></em><span class="koboSpan" id="kobo.862.1" xmlns="http://www.w3.org/1999/xhtml">, </span><em><span class="koboSpan" id="kobo.863.1" xmlns="http://www.w3.org/1999/xhtml">Request-EndPoint-Response (REPR)</span></em><span class="koboSpan" id="kobo.864.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><em><span class="koboSpan" id="kobo.865.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 20</span></em><span class="koboSpan" id="kobo.866.1" xmlns="http://www.w3.org/1999/xhtml">, </span><em><span class="koboSpan" id="kobo.867.1" xmlns="http://www.w3.org/1999/xhtml">Modular Monolith</span></em><span class="koboSpan" id="kobo.868.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.869.1" xmlns="http://www.w3.org/1999/xhtml">Let’s start with simple groups.</span></p>
<section class="level4" data-number="6.4.5.1" id="mapgroup">
<h4 data-number="6.4.5.1"><span class="koboSpan" id="kobo.870.1" xmlns="http://www.w3.org/1999/xhtml">MapGroup</span></h4>
<p><span class="koboSpan" id="kobo.871.1" xmlns="http://www.w3.org/1999/xhtml">Creating groups is the first tool to organize the routes of our APIs. </span><span class="koboSpan" id="kobo.871.2" xmlns="http://www.w3.org/1999/xhtml">It comes with the following advantages:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.872.1" xmlns="http://www.w3.org/1999/xhtml">We can create a shared URL prefix for the group’s children.</span></li>
<li><span class="koboSpan" id="kobo.873.1" xmlns="http://www.w3.org/1999/xhtml">We can add metadata that applies to the group’s children.</span></li>
<li><span class="koboSpan" id="kobo.874.1" xmlns="http://www.w3.org/1999/xhtml">We can add endpoint filters that apply to the group’s children.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.875.1" xmlns="http://www.w3.org/1999/xhtml">Here is an example of a group that configures those three items:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.876.1" xmlns="http://www.w3.org/1999/xhtml">// Create a reusable logger
var loggerFactory = app.ServiceProvider
    .GetRequiredService&lt;ILoggerFactory&gt;();
var groupLogger = loggerFactory
    .CreateLogger("organizing-endpoints");
// Create the group
var group = app
    .MapGroup("organizing-endpoints")
    .WithTags("Organizing Endpoints")
    .AddEndpointFilter(async (context, next) =&gt; {
        groupLogger.LogTrace("Entering organizing-endpoints");
        // Omited argument logging 
        var result = await next(context);
        groupLogger.LogTrace("Exiting organizing-endpoints");
        return result;
    })
;
// Map endpoints in the group
group.MapGet("demo/", ()
    =&gt; "GET endpoint from the organizing-endpoints group.");
group.MapGet("demo/{id}", (int id)
    =&gt; $"GET {id} endpoint from the organizing-endpoints group.");</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.877.1" xmlns="http://www.w3.org/1999/xhtml">The highlighted code does the following:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.878.1" xmlns="http://www.w3.org/1999/xhtml">Configures the </span><code><span class="koboSpan" id="kobo.879.1" xmlns="http://www.w3.org/1999/xhtml">organizing-endpoints</span></code><span class="koboSpan" id="kobo.880.1" xmlns="http://www.w3.org/1999/xhtml"> URL prefix.</span></li>
<li><span class="koboSpan" id="kobo.881.1" xmlns="http://www.w3.org/1999/xhtml">Add the </span><code><span class="koboSpan" id="kobo.882.1" xmlns="http://www.w3.org/1999/xhtml">Organizing Endpoints</span></code><span class="koboSpan" id="kobo.883.1" xmlns="http://www.w3.org/1999/xhtml"> tag (metadata).</span></li>
<li><span class="koboSpan" id="kobo.884.1" xmlns="http://www.w3.org/1999/xhtml">Add an inline filter that logs information about the requests.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.885.1" xmlns="http://www.w3.org/1999/xhtml">We can reach the endpoints at the following URL:</span></p>
<ul>
<li><code><span class="koboSpan" id="kobo.886.1" xmlns="http://www.w3.org/1999/xhtml">/organizing-endpoints/demo</span></code></li>
<li><code><span class="koboSpan" id="kobo.887.1" xmlns="http://www.w3.org/1999/xhtml">/organizing-endpoints/demo/123</span></code></li>
</ul>
<p><span class="koboSpan" id="kobo.888.1" xmlns="http://www.w3.org/1999/xhtml">As the following Swagger UI screenshot shows, the two endpoints are tagged correctly:</span></p>
<figure>
<span class="koboSpan" id="kobo.889.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 5.3: The two endpoints under the Organizing Endpoints tag" src="../media/file27.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.890.1" xmlns="http://www.w3.org/1999/xhtml">Figure 5.3: The two endpoints under the Organizing Endpoints tag</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.891.1" xmlns="http://www.w3.org/1999/xhtml">Then, after requesting the two endpoints, we end up with the following logs excerpt:</span></p>
<div class="C0-ConsolePACKT">
<pre><code><span class="koboSpan" id="kobo.892.1" xmlns="http://www.w3.org/1999/xhtml">[23:55:01.516] trce: organizing-endpoints[0]
      Entering organizing-endpoints
[23:55:01.516] trce: organizing-endpoints[0]
      Exiting organizing-endpoints
[23:55:06.028] trce: organizing-endpoints[0]
      Entering organizing-endpoints
[23:55:06.028] dbug: organizing-endpoints[0]
      Argument 1: Int32 = 123
[23:55:06.028] trce: organizing-endpoints[0]
      Exiting organizing-endpoints</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.893.1" xmlns="http://www.w3.org/1999/xhtml">As demonstrated, leveraging groups for shared configuration streamlines the process of setting up aspects like authorization rules, caching, and more. </span><span class="koboSpan" id="kobo.893.2" xmlns="http://www.w3.org/1999/xhtml">By adopting this approach, we uphold the DRY (Don't Repeat Yourself) principle, improving the maintainability of our code.Next, we encapsulate mapping endpoints into classes.</span></p>
</section>
<section class="level4" data-number="6.4.5.2" id="create-a-custom-map-extension-method">
<h4 data-number="6.4.5.2"><span class="koboSpan" id="kobo.894.1" xmlns="http://www.w3.org/1999/xhtml">Create a custom Map extension method</span></h4>
<p><span class="koboSpan" id="kobo.895.1" xmlns="http://www.w3.org/1999/xhtml">Now that we explored how to create groups, it is time to move the endpoints out of the </span><code><span class="koboSpan" id="kobo.896.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.897.1" xmlns="http://www.w3.org/1999/xhtml"> file. </span><span class="koboSpan" id="kobo.897.2" xmlns="http://www.w3.org/1999/xhtml">One way is to create an extension method that registers the route. </span><span class="koboSpan" id="kobo.897.3" xmlns="http://www.w3.org/1999/xhtml">To achieve this, we must extend the </span><code><span class="koboSpan" id="kobo.898.1" xmlns="http://www.w3.org/1999/xhtml">IEndpointRouteBuilder</span></code><span class="koboSpan" id="kobo.899.1" xmlns="http://www.w3.org/1999/xhtml"> interface as follows:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.900.1" xmlns="http://www.w3.org/1999/xhtml">namespace Minimal.API;
public static class OrganizingEndpoints
{
    public static void MapOrganizingEndpoints(
        this IEndpointRouteBuilder app)
    {
        // Map endpoints and groups here
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.901.1" xmlns="http://www.w3.org/1999/xhtml">Then we must call our extension method in the </span><code><span class="koboSpan" id="kobo.902.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.903.1" xmlns="http://www.w3.org/1999/xhtml"> file, as follows:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.904.1" xmlns="http://www.w3.org/1999/xhtml">var builder = WebApplication.CreateBuilder(args);
var app = builder.Build();
app.MapOrganizingEndpoints();
app.Run();</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.905.1" xmlns="http://www.w3.org/1999/xhtml">And with that, we've seen how a simple technique allows us to group our routes together, offering an organized way to structure our APIs.We can improve on this technique by returning the </span><code><span class="koboSpan" id="kobo.906.1" xmlns="http://www.w3.org/1999/xhtml">IEndpointRouteBuilder</span></code><span class="koboSpan" id="kobo.907.1" xmlns="http://www.w3.org/1999/xhtml"> instead of </span><code><span class="koboSpan" id="kobo.908.1" xmlns="http://www.w3.org/1999/xhtml">void</span></code><span class="koboSpan" id="kobo.909.1" xmlns="http://www.w3.org/1999/xhtml"> in our extension method, which makes our extension “fluent”, as demonstrated below:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.910.1" xmlns="http://www.w3.org/1999/xhtml">namespace Minimal.API;
public static class OrganizingEndpoints
{
    public static IEndpointRouteBuilder MapOrganizingEndpointsFluently(
        this IEndpointRouteBuilder app)
    {
        var group = app
            .MapGroup("organizing-endpoints-fluently")
            .WithTags("Organizing Fluent Endpoints")
        ;
        // Map endpoints and groups here
        return app;
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.911.1" xmlns="http://www.w3.org/1999/xhtml">Then from the </span><code><span class="koboSpan" id="kobo.912.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.913.1" xmlns="http://www.w3.org/1999/xhtml"> file, we can call multiple maps in a “single line of code” like the following:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.914.1" xmlns="http://www.w3.org/1999/xhtml">app
    .MapOrganizingEndpointsFluently()
    .MapOrganizingEndpoints()
;</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.915.1" xmlns="http://www.w3.org/1999/xhtml">Creating fluent APIs is very convenient, especially in such cases.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.916.1" xmlns="http://www.w3.org/1999/xhtml">This technique allows you to create fluent APIs for anything, not just registering routes.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.917.1" xmlns="http://www.w3.org/1999/xhtml">Another variation of this pattern exists that's worth noting. </span><span class="koboSpan" id="kobo.917.2" xmlns="http://www.w3.org/1999/xhtml">Rather than returning the </span><code><span class="koboSpan" id="kobo.918.1" xmlns="http://www.w3.org/1999/xhtml">IEndpointRouteBuilder</span></code><span class="koboSpan" id="kobo.919.1" xmlns="http://www.w3.org/1999/xhtml">, the extension method can return the </span><code><span class="koboSpan" id="kobo.920.1" xmlns="http://www.w3.org/1999/xhtml">RouteGroupBuilder</span></code><span class="koboSpan" id="kobo.921.1" xmlns="http://www.w3.org/1999/xhtml"> instead, granting the caller access to the group itself. </span><span class="koboSpan" id="kobo.921.2" xmlns="http://www.w3.org/1999/xhtml">Here is an example:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.922.1" xmlns="http://www.w3.org/1999/xhtml">namespace Minimal.API;
public static class OrganizingEndpoints
{
    public static RouteGroupBuilder MapOrganizingEndpointsComposable(
        this IEndpointRouteBuilder app)
    {
        var group = app
            .MapGroup("organizing-endpoints-composable")
            .WithTags("Organizing Composable Endpoints")
        ;
        // Map endpoints and groups here
        return group;
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.923.1" xmlns="http://www.w3.org/1999/xhtml">We can use such methods to create a complex hierarchy of routes and groups by splitting the registration into multiple files. </span><span class="koboSpan" id="kobo.923.2" xmlns="http://www.w3.org/1999/xhtml">The second version is the most common way. </span><span class="koboSpan" id="kobo.923.3" xmlns="http://www.w3.org/1999/xhtml">It does not expose the group to the outside (encapsulation) and allows fluent chaining of other method calls.And voilà! </span><span class="koboSpan" id="kobo.923.4" xmlns="http://www.w3.org/1999/xhtml">We now know how basic extension methods can help us organize our endpoints. </span><span class="koboSpan" id="kobo.923.5" xmlns="http://www.w3.org/1999/xhtml">Next, we explore how to move those extension methods into class libraries.</span></p>
</section>
<section class="level4" data-number="6.4.5.3" id="class-libraries">
<h4 data-number="6.4.5.3"><span class="koboSpan" id="kobo.924.1" xmlns="http://www.w3.org/1999/xhtml">Class libraries</span></h4>
<p><span class="koboSpan" id="kobo.925.1" xmlns="http://www.w3.org/1999/xhtml">This last technique allows us to create and register routes from class libraries using the previously explored techniques.First, we must create a class library project, which we can do using the </span><code><span class="koboSpan" id="kobo.926.1" xmlns="http://www.w3.org/1999/xhtml">dotnet new classlib</span></code><span class="koboSpan" id="kobo.927.1" xmlns="http://www.w3.org/1999/xhtml"> CLI command.Unfortunately, a class library project cannot access everything we need, like the </span><code><span class="koboSpan" id="kobo.928.1" xmlns="http://www.w3.org/1999/xhtml">IEndpointRouteBuilder</span></code><span class="koboSpan" id="kobo.929.1" xmlns="http://www.w3.org/1999/xhtml"> interface. </span><span class="koboSpan" id="kobo.929.2" xmlns="http://www.w3.org/1999/xhtml">The good news is that it is trivial to change this fact. </span><span class="koboSpan" id="kobo.929.3" xmlns="http://www.w3.org/1999/xhtml">All we have to do is add a </span><code><span class="koboSpan" id="kobo.930.1" xmlns="http://www.w3.org/1999/xhtml">FrameworkReference</span></code><span class="koboSpan" id="kobo.931.1" xmlns="http://www.w3.org/1999/xhtml"> element in an </span><code><span class="koboSpan" id="kobo.932.1" xmlns="http://www.w3.org/1999/xhtml">ItemGroup</span></code><span class="koboSpan" id="kobo.933.1" xmlns="http://www.w3.org/1999/xhtml"> element in the </span><code><span class="koboSpan" id="kobo.934.1" xmlns="http://www.w3.org/1999/xhtml">csproj</span></code><span class="koboSpan" id="kobo.935.1" xmlns="http://www.w3.org/1999/xhtml"> file, as follows:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.936.1" xmlns="http://www.w3.org/1999/xhtml">&lt;Project Sdk="Microsoft.NET.Sdk"&gt;
    &lt;PropertyGroup&gt;
        &lt;TargetFramework&gt;net8.0&lt;/TargetFramework&gt;
        &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
        &lt;Nullable&gt;enable&lt;/Nullable&gt;
    &lt;/PropertyGroup&gt;
    &lt;ItemGroup&gt;
        &lt;FrameworkReference Include="Microsoft.AspNetCore.App" /&gt;
    &lt;/ItemGroup&gt;
&lt;/Project&gt;</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.937.1" xmlns="http://www.w3.org/1999/xhtml">That minor addition equips us with everything necessary to create an ASP.NET Core-enabled library, including mapping endpoints! </span><span class="koboSpan" id="kobo.937.2" xmlns="http://www.w3.org/1999/xhtml">Transferring the preceding C# code into this class library project should yield the same functional results as in a web application.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.938.1" xmlns="http://www.w3.org/1999/xhtml">I used this technique in the </span><code><span class="koboSpan" id="kobo.939.1" xmlns="http://www.w3.org/1999/xhtml">Shared</span></code><span class="koboSpan" id="kobo.940.1" xmlns="http://www.w3.org/1999/xhtml"> project of the solution we explore in this chapter and the next. </span><span class="koboSpan" id="kobo.940.2" xmlns="http://www.w3.org/1999/xhtml">If you are curious, the complete source code is available on GitHub.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.941.1" xmlns="http://www.w3.org/1999/xhtml">Next, we mix Minimal APIs and DTOs.</span></p>
</section>
</section>
</section>
<section class="level2" data-number="6.5" id="using-minimal-apis-with-data-transfer-objects">
<h2 data-number="6.5"><span class="koboSpan" id="kobo.942.1" xmlns="http://www.w3.org/1999/xhtml">Using Minimal APIs with Data Transfer Objects</span></h2>
<p><span class="koboSpan" id="kobo.943.1" xmlns="http://www.w3.org/1999/xhtml">This section explores leveraging the </span><strong><span class="koboSpan" id="kobo.944.1" xmlns="http://www.w3.org/1999/xhtml">Data Transfer Object</span></strong><span class="koboSpan" id="kobo.945.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><strong><span class="koboSpan" id="kobo.946.1" xmlns="http://www.w3.org/1999/xhtml">DTO</span></strong><span class="koboSpan" id="kobo.947.1" xmlns="http://www.w3.org/1999/xhtml">) pattern with minimal APIs.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.948.1" xmlns="http://www.w3.org/1999/xhtml">This section is the same as we explore in </span><em><span class="koboSpan" id="kobo.949.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 6</span></em><span class="koboSpan" id="kobo.950.1" xmlns="http://www.w3.org/1999/xhtml">, </span><em><span class="koboSpan" id="kobo.951.1" xmlns="http://www.w3.org/1999/xhtml">MVC</span></em><span class="koboSpan" id="kobo.952.1" xmlns="http://www.w3.org/1999/xhtml">, but in the context of Minimal APIs. </span><span class="koboSpan" id="kobo.952.2" xmlns="http://www.w3.org/1999/xhtml">Moreover, the two code projects are part of the same Visual Studio solution for convenience, allowing you to compare the two implementations.</span></p>
</blockquote>
<section class="level3" data-number="6.5.1" id="goal-1">
<h3 data-number="6.5.1"><span class="koboSpan" id="kobo.953.1" xmlns="http://www.w3.org/1999/xhtml">Goal</span></h3>
<p><span class="koboSpan" id="kobo.954.1" xmlns="http://www.w3.org/1999/xhtml">As a reminder, DTOs aim to </span><em><span class="koboSpan" id="kobo.955.1" xmlns="http://www.w3.org/1999/xhtml">control the inputs and outputs of an endpoint</span></em><span class="koboSpan" id="kobo.956.1" xmlns="http://www.w3.org/1999/xhtml"> by decoupling the API contract from the application’s inner workings. </span><span class="koboSpan" id="kobo.956.2" xmlns="http://www.w3.org/1999/xhtml">DTOs empower us to define our APIs without thinking about the underlying data structures, leaving us to craft our REST APIs how we want.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.957.1" xmlns="http://www.w3.org/1999/xhtml">We discuss REST APIs and DTOs more in-depth in </span><em><span class="koboSpan" id="kobo.958.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 4</span></em><span class="koboSpan" id="kobo.959.1" xmlns="http://www.w3.org/1999/xhtml">, </span><em><span class="koboSpan" id="kobo.960.1" xmlns="http://www.w3.org/1999/xhtml">REST APIs</span></em><span class="koboSpan" id="kobo.961.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.962.1" xmlns="http://www.w3.org/1999/xhtml">Other possible objectives are to save bandwidth by limiting the amount of information the API transmits, flattening the data structure, or adding API features that cross multiple entities.</span></p>
</section>
<section class="level3" data-number="6.5.2" id="design-1">
<h3 data-number="6.5.2"><span class="koboSpan" id="kobo.963.1" xmlns="http://www.w3.org/1999/xhtml">Design</span></h3>
<p><span class="koboSpan" id="kobo.964.1" xmlns="http://www.w3.org/1999/xhtml">Let’s start by analyzing a diagram that shows how minimal APIs work with DTOs:</span></p>
<figure>
<span class="koboSpan" id="kobo.965.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 5.4: An input DTO hitting some domain logic, then the endpoint returning an output DTO" src="../media/file28.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.966.1" xmlns="http://www.w3.org/1999/xhtml">Figure 5.4: An input DTO hitting some domain logic, then the endpoint returning an output DTO</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.967.1" xmlns="http://www.w3.org/1999/xhtml">DTOs allow the decoupling of the domain (3) from the request (1) and the response (5). </span><span class="koboSpan" id="kobo.967.2" xmlns="http://www.w3.org/1999/xhtml">This model empowers us to manage the inputs and outputs of our REST APIs independently from the domain. </span><span class="koboSpan" id="kobo.967.3" xmlns="http://www.w3.org/1999/xhtml">Here’s the flow:</span></p>
<ol>
<li><span class="koboSpan" id="kobo.968.1" xmlns="http://www.w3.org/1999/xhtml">The client sends a request to the server.</span></li>
<li><span class="koboSpan" id="kobo.969.1" xmlns="http://www.w3.org/1999/xhtml">ASP.NET Core leverages its data binding and parsing mechanism to convert the information of the HTTP request to C# (input DTO).</span></li>
<li><span class="koboSpan" id="kobo.970.1" xmlns="http://www.w3.org/1999/xhtml">The endpoint does what it is supposed to do.</span></li>
<li><span class="koboSpan" id="kobo.971.1" xmlns="http://www.w3.org/1999/xhtml">ASP.NET Core serializes the output DTO to the HTTP response.</span></li>
<li><span class="koboSpan" id="kobo.972.1" xmlns="http://www.w3.org/1999/xhtml">The client receives and handles the response.</span></li>
</ol>
<p><span class="koboSpan" id="kobo.973.1" xmlns="http://www.w3.org/1999/xhtml">Let’s explore some code to understand the concept better.</span></p>
</section>
<section class="level3" data-number="6.5.3" id="project-minimal-api">
<h3 data-number="6.5.3"><span class="koboSpan" id="kobo.974.1" xmlns="http://www.w3.org/1999/xhtml">Project – Minimal API</span></h3>
<p><em><span class="koboSpan" id="kobo.975.1" xmlns="http://www.w3.org/1999/xhtml">This code sample is the same as the next chapter but uses Minimal APIs instead of the MVC framework</span></em><span class="koboSpan" id="kobo.976.1" xmlns="http://www.w3.org/1999/xhtml">.</span><strong><span class="koboSpan" id="kobo.977.1" xmlns="http://www.w3.org/1999/xhtml">Context</span></strong><span class="koboSpan" id="kobo.978.1" xmlns="http://www.w3.org/1999/xhtml">: we must build an application to manage customers and contracts. </span><span class="koboSpan" id="kobo.978.2" xmlns="http://www.w3.org/1999/xhtml">We must track the state of each contract and have a primary contact in case the business needs to contact the customer. </span><span class="koboSpan" id="kobo.978.3" xmlns="http://www.w3.org/1999/xhtml">Finally, we must display the number of contracts and the number of opened contracts for each customer on a dashboard.The model is the following:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.979.1" xmlns="http://www.w3.org/1999/xhtml">namespace Shared.Models;
public record class Customer(
    int Id,
    string Name,
    List&lt;Contract&gt; Contracts
);
public record class Contract(
    int Id,
    string Name,
    string Description,
    WorkStatus Status,
    ContactInformation PrimaryContact
);
public record class WorkStatus(int TotalWork, int WorkDone)
{
    public WorkState State =&gt;
        WorkDone == 0 ? </span><span class="koboSpan" id="kobo.979.2" xmlns="http://www.w3.org/1999/xhtml">WorkState.New :
        WorkDone == TotalWork ? </span><span class="koboSpan" id="kobo.979.3" xmlns="http://www.w3.org/1999/xhtml">WorkState.Completed :
        WorkState.InProgress;
}
public record class ContactInformation(
    string FirstName,
    string LastName,
    string Email
);
public enum WorkState
{
    New,
    InProgress,
    Completed
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.980.1" xmlns="http://www.w3.org/1999/xhtml">The preceding code is straightforward. </span><span class="koboSpan" id="kobo.980.2" xmlns="http://www.w3.org/1999/xhtml">The only piece of logic is the </span><code><span class="koboSpan" id="kobo.981.1" xmlns="http://www.w3.org/1999/xhtml">WorkStatus.State</span></code><span class="koboSpan" id="kobo.982.1" xmlns="http://www.w3.org/1999/xhtml"> property that returns </span><code><span class="koboSpan" id="kobo.983.1" xmlns="http://www.w3.org/1999/xhtml">WorkState.New</span></code><span class="koboSpan" id="kobo.984.1" xmlns="http://www.w3.org/1999/xhtml"> when the work has not yet started on that contract, </span><code><span class="koboSpan" id="kobo.985.1" xmlns="http://www.w3.org/1999/xhtml">WorkState.Completed</span></code><span class="koboSpan" id="kobo.986.1" xmlns="http://www.w3.org/1999/xhtml"> when all the work is completed, or </span><code><span class="koboSpan" id="kobo.987.1" xmlns="http://www.w3.org/1999/xhtml">WorkState.InProgress</span></code><span class="koboSpan" id="kobo.988.1" xmlns="http://www.w3.org/1999/xhtml"> otherwise.The endpoints (</span><code><span class="koboSpan" id="kobo.989.1" xmlns="http://www.w3.org/1999/xhtml">CustomersEndpoints.cs</span></code><span class="koboSpan" id="kobo.990.1" xmlns="http://www.w3.org/1999/xhtml">) leverage the </span><code><span class="koboSpan" id="kobo.991.1" xmlns="http://www.w3.org/1999/xhtml">ICustomerRepository</span></code><span class="koboSpan" id="kobo.992.1" xmlns="http://www.w3.org/1999/xhtml"> interface to simulate database operations. </span><span class="koboSpan" id="kobo.992.2" xmlns="http://www.w3.org/1999/xhtml">The implementation is unimportant. </span><span class="koboSpan" id="kobo.992.3" xmlns="http://www.w3.org/1999/xhtml">It uses a </span><code><span class="koboSpan" id="kobo.993.1" xmlns="http://www.w3.org/1999/xhtml">List&lt;Customer&gt;</span></code><span class="koboSpan" id="kobo.994.1" xmlns="http://www.w3.org/1999/xhtml"> as the database. </span><span class="koboSpan" id="kobo.994.2" xmlns="http://www.w3.org/1999/xhtml">Here’s the interface that allows querying and updating the data:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.995.1" xmlns="http://www.w3.org/1999/xhtml">using Shared.Models;
namespace Shared.Data;
public interface ICustomerRepository
{
    Task&lt;IEnumerable&lt;Customer&gt;&gt; AllAsync(
        CancellationToken cancellationToken);
    Task&lt;Customer&gt; CreateAsync(
        Customer customer, 
        CancellationToken cancellationToken);
    Task&lt;Customer?&gt; DeleteAsync(
        int customerId, 
        CancellationToken cancellationToken);
    Task&lt;Customer?&gt; FindAsync(
        int customerId, 
        CancellationToken cancellationToken);
    Task&lt;Customer?&gt; UpdateAsync(
        Customer customer, 
        CancellationToken cancellationToken);
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.996.1" xmlns="http://www.w3.org/1999/xhtml">Now that we know about the underlying foundation, we explore CRUD endpoints that do not leverage DTOs.</span></p>
<section class="level4" data-number="6.5.3.1" id="raw-crud-endpoints">
<h4 data-number="6.5.3.1"><span class="koboSpan" id="kobo.997.1" xmlns="http://www.w3.org/1999/xhtml">Raw CRUD endpoints</span></h4>
<p><span class="koboSpan" id="kobo.998.1" xmlns="http://www.w3.org/1999/xhtml">Many issues can arise if we create CRUD endpoints to manage the customers directly (see </span><code><span class="koboSpan" id="kobo.999.1" xmlns="http://www.w3.org/1999/xhtml">CustomersEndpoints.cs</span></code><span class="koboSpan" id="kobo.1000.1" xmlns="http://www.w3.org/1999/xhtml">). </span><span class="koboSpan" id="kobo.1000.2" xmlns="http://www.w3.org/1999/xhtml">First, a little mistake from the client could erase several data points. </span><span class="koboSpan" id="kobo.1000.3" xmlns="http://www.w3.org/1999/xhtml">For example, if the client forgets to send the contracts during a </span><code><span class="koboSpan" id="kobo.1001.1" xmlns="http://www.w3.org/1999/xhtml">PUT</span></code><span class="koboSpan" id="kobo.1002.1" xmlns="http://www.w3.org/1999/xhtml"> operation, that would delete all the contracts associated with that customer. </span><span class="koboSpan" id="kobo.1002.2" xmlns="http://www.w3.org/1999/xhtml">Here’s the controller code:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.1003.1" xmlns="http://www.w3.org/1999/xhtml">// PUT raw/customers/1
group.MapPut("/{customerId}", async (int customerId, Customer input, ICustomerRepository customerRepository, CancellationToken cancellationToken) =&gt;
{
    var updatedCustomer = await customerRepository.UpdateAsync(
        input, 
        cancellationToken
    );
    if (updatedCustomer == null)
    {
        return Results.NotFound();
    }
    return Results.Ok(updatedCustomer);
});</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.1004.1" xmlns="http://www.w3.org/1999/xhtml">The highlighted code represents the customer update. </span><span class="koboSpan" id="kobo.1004.2" xmlns="http://www.w3.org/1999/xhtml">So to mistakenly remove all contracts, a client could send the following HTTP request (from the </span><code><span class="koboSpan" id="kobo.1005.1" xmlns="http://www.w3.org/1999/xhtml">Minimal.API.http</span></code><span class="koboSpan" id="kobo.1006.1" xmlns="http://www.w3.org/1999/xhtml"> file):</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.1007.1" xmlns="http://www.w3.org/1999/xhtml">PUT {{Minimal.API.BaseAddress}}/customers/1
Content-Type: application/json
{
  "id": 1,
  "name": "Some new name",
  "contracts": []
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.1008.1" xmlns="http://www.w3.org/1999/xhtml">That request would result in the following response entity:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.1009.1" xmlns="http://www.w3.org/1999/xhtml">{
  "id": 1,
  "name": "Some new name",
  "contracts": []
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.1010.1" xmlns="http://www.w3.org/1999/xhtml">Previously, however, that customer had contracts (seeded when we started the application). </span><span class="koboSpan" id="kobo.1010.2" xmlns="http://www.w3.org/1999/xhtml">Here’s the original data:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.1011.1" xmlns="http://www.w3.org/1999/xhtml">{
  "id": 1,
  "name": "Jonny Boy Inc.",
  "contracts": [
    {
      "id": 1,
      "name": "First contract",
      "description": "This is the first contract.",
      "status": {
        "totalWork": 100,
        "workDone": 100,
        "state": "Completed"
      },
      "primaryContact": {
        "firstName": "John",
        "lastName": "Doe",
        "email": "john.doe@jonnyboy.com"
      }
    },
    {
      "id": 2,
      "name": "Some other contract",
      "description": "This is another contract.",
      "status": {
        "totalWork": 100,
        "workDone": 25,
        "state": "InProgress"
      },
      "primaryContact": {
        "firstName": "Jane",
        "lastName": "Doe",
        "email": "jane.doe@jonnyboy.com"
      }
    }
  ]
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.1012.1" xmlns="http://www.w3.org/1999/xhtml">As we can see, by exposing our entities directly, we are giving a lot of power to the consumers of our API. </span><span class="koboSpan" id="kobo.1012.2" xmlns="http://www.w3.org/1999/xhtml">Another issue with this design is the dashboard. </span><span class="koboSpan" id="kobo.1012.3" xmlns="http://www.w3.org/1999/xhtml">The user interface would have to calculate the statistics about the contracts. </span><span class="koboSpan" id="kobo.1012.4" xmlns="http://www.w3.org/1999/xhtml">Moreover, if we implement paging the contracts over time, the user interface could become increasingly complex and even overquery the database, hindering our performance.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.1013.1" xmlns="http://www.w3.org/1999/xhtml">I implemented the entire API, which is available on GitHub but without UI.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.1014.1" xmlns="http://www.w3.org/1999/xhtml">Next, we explore how we can fix those two use cases using DTOs.</span></p>
</section>
<section class="level4" data-number="6.5.3.2" id="dto-enabled-endpoints">
<h4 data-number="6.5.3.2"><span class="koboSpan" id="kobo.1015.1" xmlns="http://www.w3.org/1999/xhtml">DTO-enabled endpoints</span></h4>
<p><span class="koboSpan" id="kobo.1016.1" xmlns="http://www.w3.org/1999/xhtml">To solve our problems, we reimplement the endpoints using DTOs. </span><span class="koboSpan" id="kobo.1016.2" xmlns="http://www.w3.org/1999/xhtml">These endpoints use methods instead of inline delegates and returns </span><code><span class="koboSpan" id="kobo.1017.1" xmlns="http://www.w3.org/1999/xhtml">Results&lt;T1, T2, …&gt;</span></code><span class="koboSpan" id="kobo.1018.1" xmlns="http://www.w3.org/1999/xhtml"> instead </span><code><span class="koboSpan" id="kobo.1019.1" xmlns="http://www.w3.org/1999/xhtml">IResult</span></code><span class="koboSpan" id="kobo.1020.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1020.2" xmlns="http://www.w3.org/1999/xhtml">So, let’s start with the declaration of the endpoints:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.1021.1" xmlns="http://www.w3.org/1999/xhtml">var group = routes
    .MapGroup("/dto/customers")
    .WithTags("Customer DTO")
    .WithOpenApi()
;
group.MapGet("/", GetCustomersSummaryAsync)
    .WithName("GetAllCustomersSummary");
group.MapGet("/{customerId}", GetCustomerDetailsAsync)
    .WithName("GetCustomerDetailsById");
group.MapPut("/{customerId}", UpdateCustomerAsync)
    .WithName("UpdateCustomerWithDto");
group.MapPost("/", CreateCustomerAsync)
    .WithName("CreateCustomerWithDto");
group.MapDelete("/{customerId}", DeleteCustomerAsync)
    .WithName("DeleteCustomerWithDto");</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.1022.1" xmlns="http://www.w3.org/1999/xhtml">Next, to make it easier to follow along, here are all the DTOs as a reference:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.1023.1" xmlns="http://www.w3.org/1999/xhtml">namespace Shared.DTO;
public record class ContractDetails(
    int Id,
    string Name,
    string Description,
    int StatusTotalWork,
    int StatusWorkDone,
    string StatusWorkState,
    string PrimaryContactFirstName,
    string PrimaryContactLastName,
    string PrimaryContactEmail
);
public record class CustomerDetails(
    int Id,
    string Name,
    IEnumerable&lt;ContractDetails&gt; Contracts
);
public record class CustomerSummary(
    int Id,
    string Name,
    int TotalNumberOfContracts,
    int NumberOfOpenContracts
);
public record class CreateCustomer(string Name);
public record class UpdateCustomer(string Name);</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.1024.1" xmlns="http://www.w3.org/1999/xhtml">First, let’s fix our update problem, starting with the reimplementation of the update endpoint leveraging DTOs (see the </span><code><span class="koboSpan" id="kobo.1025.1" xmlns="http://www.w3.org/1999/xhtml">DTOEndpoints.cs</span></code><span class="koboSpan" id="kobo.1026.1" xmlns="http://www.w3.org/1999/xhtml"> file):</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.1027.1" xmlns="http://www.w3.org/1999/xhtml">// PUT dto/customers/1
private static async Task&lt;Results&lt;
    Ok&lt;CustomerDetails&gt;,
    NotFound,
    Conflict
&gt;&gt; UpdateCustomerAsync(
        int customerId,
        UpdateCustomer input,
        ICustomerRepository customerRepository,
        CancellationToken cancellationToken)
{
    // Get the customer
    var customer = await customerRepository.FindAsync(
        customerId,
        cancellationToken
    );
    if (customer == null)
    {
        return TypedResults.NotFound();
    }
    // Update the customer's name using the UpdateCustomer DTO
    var updatedCustomer = await customerRepository.UpdateAsync(
        customer with { Name = input.Name },
        cancellationToken
    );
    if (updatedCustomer == null)
    {
        return TypedResults.Conflict();
    }
    // Map the updated customer to a CustomerDetails DTO
    var dto = MapCustomerToCustomerDetails(updatedCustomer);
    // Return the DTO
    return TypedResults.Ok(dto);
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.1028.1" xmlns="http://www.w3.org/1999/xhtml">In the preceding code, the main differences are (highlighted):</span></p>
<ul>
<li><span class="koboSpan" id="kobo.1029.1" xmlns="http://www.w3.org/1999/xhtml">The request body is now bound to the </span><code><span class="koboSpan" id="kobo.1030.1" xmlns="http://www.w3.org/1999/xhtml">UpdateCustomer</span></code><span class="koboSpan" id="kobo.1031.1" xmlns="http://www.w3.org/1999/xhtml"> class instead of the </span><code><span class="koboSpan" id="kobo.1032.1" xmlns="http://www.w3.org/1999/xhtml">Customer</span></code><span class="koboSpan" id="kobo.1033.1" xmlns="http://www.w3.org/1999/xhtml"> itself.</span></li>
<li><span class="koboSpan" id="kobo.1034.1" xmlns="http://www.w3.org/1999/xhtml">The action method returns an instance of the </span><code><span class="koboSpan" id="kobo.1035.1" xmlns="http://www.w3.org/1999/xhtml">CustomerDetails</span></code><span class="koboSpan" id="kobo.1036.1" xmlns="http://www.w3.org/1999/xhtml"> class instead of the </span><code><span class="koboSpan" id="kobo.1037.1" xmlns="http://www.w3.org/1999/xhtml">Customer</span></code><span class="koboSpan" id="kobo.1038.1" xmlns="http://www.w3.org/1999/xhtml"> itself when the operation succeeds.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.1039.1" xmlns="http://www.w3.org/1999/xhtml">However, we can see more code in our endpoint than before. </span><span class="koboSpan" id="kobo.1039.2" xmlns="http://www.w3.org/1999/xhtml">That’s because it now handles the changes instead of the clients. </span><span class="koboSpan" id="kobo.1039.3" xmlns="http://www.w3.org/1999/xhtml">The action now does:</span></p>
<ol>
<li><span class="koboSpan" id="kobo.1040.1" xmlns="http://www.w3.org/1999/xhtml">Load the data from the database.</span></li>
<li><span class="koboSpan" id="kobo.1041.1" xmlns="http://www.w3.org/1999/xhtml">Ensure the entity exists.</span></li>
<li><span class="koboSpan" id="kobo.1042.1" xmlns="http://www.w3.org/1999/xhtml">Use the input DTO to update the data, limiting the clients to a subset of properties.</span></li>
<li><span class="koboSpan" id="kobo.1043.1" xmlns="http://www.w3.org/1999/xhtml">Proceed with the update.</span></li>
<li><span class="koboSpan" id="kobo.1044.1" xmlns="http://www.w3.org/1999/xhtml">Ensure the entity still exists (handles conflicts).</span></li>
<li><span class="koboSpan" id="kobo.1045.1" xmlns="http://www.w3.org/1999/xhtml">Copy the Customer into the output DTO and return it.</span></li>
</ol>
<p><span class="koboSpan" id="kobo.1046.1" xmlns="http://www.w3.org/1999/xhtml">By doing this, we now control what the clients can do when they send a </span><code><span class="koboSpan" id="kobo.1047.1" xmlns="http://www.w3.org/1999/xhtml">PUT</span></code><span class="koboSpan" id="kobo.1048.1" xmlns="http://www.w3.org/1999/xhtml"> request through the input DTO (</span><code><span class="koboSpan" id="kobo.1049.1" xmlns="http://www.w3.org/1999/xhtml">UpdateCustomer</span></code><span class="koboSpan" id="kobo.1050.1" xmlns="http://www.w3.org/1999/xhtml">). </span><span class="koboSpan" id="kobo.1050.2" xmlns="http://www.w3.org/1999/xhtml">Moreover, we encapsulated the logic to calculate the statistics on the server. </span><span class="koboSpan" id="kobo.1050.3" xmlns="http://www.w3.org/1999/xhtml">We hid the computation behind the output DTO (</span><code><span class="koboSpan" id="kobo.1051.1" xmlns="http://www.w3.org/1999/xhtml">CustomerDetails</span></code><span class="koboSpan" id="kobo.1052.1" xmlns="http://www.w3.org/1999/xhtml">), which lowers the complexity of our user interface and allows us to improve the performance without impacting any of our clients (loose coupling).Furthermore, we now use the </span><code><span class="koboSpan" id="kobo.1053.1" xmlns="http://www.w3.org/1999/xhtml">customerId</span></code><span class="koboSpan" id="kobo.1054.1" xmlns="http://www.w3.org/1999/xhtml"> parameter.If we send the same HTTP request as before, which sends more data than we accept, only the customer's name will change. </span><span class="koboSpan" id="kobo.1054.2" xmlns="http://www.w3.org/1999/xhtml">On top of that, we get all the data we need to display the customer’s statistics. </span><span class="koboSpan" id="kobo.1054.3" xmlns="http://www.w3.org/1999/xhtml">Here’s a response example:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.1055.1" xmlns="http://www.w3.org/1999/xhtml">{
  "id": 1,
  "name": "Some new name",
  "contracts": [
    {
      "id": 1,
      "name": "First contract",
      "description": "This is the first contract.",
      "statusTotalWork": 100,
      "statusWorkDone": 100,
      "statusWorkState": "Completed",
      "primaryContactFirstName": "John",
      "primaryContactLastName": "Doe",
      "primaryContactEmail": "john.doe@jonnyboy.com"
    },
    {
      "id": 2,
      "name": "Some other contract",
      "description": "This is another contract.",
      "statusTotalWork": 100,
      "statusWorkDone": 25,
      "statusWorkState": "InProgress",
      "primaryContactFirstName": "Jane",
      "primaryContactLastName": "Doe",
      "primaryContactEmail": "jane.doe@jonnyboy.com"
    }
  ]
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.1056.1" xmlns="http://www.w3.org/1999/xhtml">As we can see from the preceding response, only the customer’s name changed, but we now received the </span><code><span class="koboSpan" id="kobo.1057.1" xmlns="http://www.w3.org/1999/xhtml">statusWorkDone</span></code><span class="koboSpan" id="kobo.1058.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.1059.1" xmlns="http://www.w3.org/1999/xhtml">statusTotalWork</span></code><span class="koboSpan" id="kobo.1060.1" xmlns="http://www.w3.org/1999/xhtml"> fields. </span><span class="koboSpan" id="kobo.1060.2" xmlns="http://www.w3.org/1999/xhtml">Lastly, we flattened the data structure.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.1061.1" xmlns="http://www.w3.org/1999/xhtml">DTOs are a great resource to flatten data structures, but you don’t have to. </span><span class="koboSpan" id="kobo.1061.2" xmlns="http://www.w3.org/1999/xhtml">You must always design your systems, including DTOs and data contracts, for specific use cases.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.1062.1" xmlns="http://www.w3.org/1999/xhtml">As for the dashboard, the “get all customers” endpoint achieves this by doing something similar. </span><span class="koboSpan" id="kobo.1062.2" xmlns="http://www.w3.org/1999/xhtml">It outputs a collection of </span><code><span class="koboSpan" id="kobo.1063.1" xmlns="http://www.w3.org/1999/xhtml">CustomerSummary</span></code><span class="koboSpan" id="kobo.1064.1" xmlns="http://www.w3.org/1999/xhtml"> objects instead of the customers themselves. </span><span class="koboSpan" id="kobo.1064.2" xmlns="http://www.w3.org/1999/xhtml">In this case, the endpoint executes the calculations and copies the entity's relevant properties to the DTO. </span><span class="koboSpan" id="kobo.1064.3" xmlns="http://www.w3.org/1999/xhtml">Here’s the code:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.1065.1" xmlns="http://www.w3.org/1999/xhtml">// GET: dto/customers
private static async Task&lt;Ok&lt;IEnumerable&lt;CustomerSummary&gt;&gt;&gt; GetCustomersSummaryAsync(
    ICustomerRepository customerRepository,
    CancellationToken cancellationToken)
{
    // Get all customers
    var customers = await customerRepository
        .AllAsync(cancellationToken);
    // Map customers to CustomerSummary DTOs
    var customersSummary = customers.Select(customer =&gt; new CustomerSummary(
        Id: customer.Id,
        Name: customer.Name,
        TotalNumberOfContracts: customer.Contracts.Count,
        NumberOfOpenContracts: customer.Contracts
            .Count(x =&gt; x.Status.State != WorkState.Completed)
    ));
    // Return the DTOs
    return TypedResults.Ok(customersSummary);
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.1066.1" xmlns="http://www.w3.org/1999/xhtml">In the preceding code, the action method:</span></p>
<ol>
<li><span class="koboSpan" id="kobo.1067.1" xmlns="http://www.w3.org/1999/xhtml">Read the entities</span></li>
<li><span class="koboSpan" id="kobo.1068.1" xmlns="http://www.w3.org/1999/xhtml">Create the DTOs and calculate the number of open contracts.</span></li>
<li><span class="koboSpan" id="kobo.1069.1" xmlns="http://www.w3.org/1999/xhtml">Return the DTOs.</span></li>
</ol>
<p><span class="koboSpan" id="kobo.1070.1" xmlns="http://www.w3.org/1999/xhtml">As simple as that, we now encapsulated the computation on the server.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.1071.1" xmlns="http://www.w3.org/1999/xhtml">You should optimize such code based on your real-life data source. </span><span class="koboSpan" id="kobo.1071.2" xmlns="http://www.w3.org/1999/xhtml">In this case, a </span><code><span class="koboSpan" id="kobo.1072.1" xmlns="http://www.w3.org/1999/xhtml">static</span></code> <code><span class="koboSpan" id="kobo.1073.1" xmlns="http://www.w3.org/1999/xhtml">List&lt;T&gt;</span></code><span class="koboSpan" id="kobo.1074.1" xmlns="http://www.w3.org/1999/xhtml"> is low latency. </span><span class="koboSpan" id="kobo.1074.2" xmlns="http://www.w3.org/1999/xhtml">However, querying the whole database to get a count can become a bottleneck.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.1075.1" xmlns="http://www.w3.org/1999/xhtml">Calling the endpoint results in the following:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.1076.1" xmlns="http://www.w3.org/1999/xhtml">[
  {
    "id": 1,
    "name": "Some new name",
    "totalNumberOfContracts": 2,
    "numberOfOpenContracts": 1
  },
  {
    "id": 2,
    "name": "Some mega-corporation",
    "totalNumberOfContracts": 1,
    "numberOfOpenContracts": 1
  }
]</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.1077.1" xmlns="http://www.w3.org/1999/xhtml">It is now super easy to build our dashboard. </span><span class="koboSpan" id="kobo.1077.2" xmlns="http://www.w3.org/1999/xhtml">We can query that endpoint once and display the data in the UI. </span><span class="koboSpan" id="kobo.1077.3" xmlns="http://www.w3.org/1999/xhtml">The UI offloaded the calculation to the backend.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.1078.1" xmlns="http://www.w3.org/1999/xhtml">User interfaces tend to be more complex than APIs because they are stateful. </span><span class="koboSpan" id="kobo.1078.2" xmlns="http://www.w3.org/1999/xhtml">As such, offloading as much complexity to the backend helps. </span><span class="koboSpan" id="kobo.1078.3" xmlns="http://www.w3.org/1999/xhtml">You can use a Backend-for-frontend (BFF) to help with this task. </span><span class="koboSpan" id="kobo.1078.4" xmlns="http://www.w3.org/1999/xhtml">We explore ways to layer APIs, including the BFF pattern in </span><em><span class="koboSpan" id="kobo.1079.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 19</span></em><span class="koboSpan" id="kobo.1080.1" xmlns="http://www.w3.org/1999/xhtml">, </span><em><span class="koboSpan" id="kobo.1081.1" xmlns="http://www.w3.org/1999/xhtml">Introduction to Microservices Architecture</span></em><span class="koboSpan" id="kobo.1082.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.1083.1" xmlns="http://www.w3.org/1999/xhtml">Lastly, you can play with the API using the HTTP requests in the </span><code><span class="koboSpan" id="kobo.1084.1" xmlns="http://www.w3.org/1999/xhtml">MVC.API.DTO.http</span></code><span class="koboSpan" id="kobo.1085.1" xmlns="http://www.w3.org/1999/xhtml"> file. </span><span class="koboSpan" id="kobo.1085.2" xmlns="http://www.w3.org/1999/xhtml">I implemented all the endpoints using a similar technique. </span><span class="koboSpan" id="kobo.1085.3" xmlns="http://www.w3.org/1999/xhtml">If your endpoints become too complex, it is good practice to encapsulate them into other classes. </span><span class="koboSpan" id="kobo.1085.4" xmlns="http://www.w3.org/1999/xhtml">We explore many techniques to organize application code in </span><em><span class="koboSpan" id="kobo.1086.1" xmlns="http://www.w3.org/1999/xhtml">Section 4</span></em><span class="koboSpan" id="kobo.1087.1" xmlns="http://www.w3.org/1999/xhtml">: </span><em><span class="koboSpan" id="kobo.1088.1" xmlns="http://www.w3.org/1999/xhtml">Applications patterns</span></em><span class="koboSpan" id="kobo.1089.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</section>
</section>
<section class="level3" data-number="6.5.4" id="conclusion-5">
<h3 data-number="6.5.4"><span class="koboSpan" id="kobo.1090.1" xmlns="http://www.w3.org/1999/xhtml">Conclusion</span></h3>
<p><span class="koboSpan" id="kobo.1091.1" xmlns="http://www.w3.org/1999/xhtml">A data transfer object allows us to design an API endpoint with a specific data contract (input and output) instead of exposing the domain or data model. </span><span class="koboSpan" id="kobo.1091.2" xmlns="http://www.w3.org/1999/xhtml">This separation between the presentation and the domain is a crucial element that leads to having multiple independent components instead of a bigger, more fragile one.We use DTOs to control the endpoints' inputs and outputs, giving us more control over what the clients can do or receive.Using the data transfer object pattern helps us follow the SOLID principles in the following ways:</span></p>
<ul>
<li><strong><span class="koboSpan" id="kobo.1092.1" xmlns="http://www.w3.org/1999/xhtml">S</span></strong><span class="koboSpan" id="kobo.1093.1" xmlns="http://www.w3.org/1999/xhtml">: A DTO adds clear boundaries between the domain or data model and the API contract. </span><span class="koboSpan" id="kobo.1093.2" xmlns="http://www.w3.org/1999/xhtml">Moreover, having an input and an output DTO help further separate the responsibilities.</span></li>
<li><strong><span class="koboSpan" id="kobo.1094.1" xmlns="http://www.w3.org/1999/xhtml">O</span></strong><span class="koboSpan" id="kobo.1095.1" xmlns="http://www.w3.org/1999/xhtml">: N/A</span></li>
<li><strong><span class="koboSpan" id="kobo.1096.1" xmlns="http://www.w3.org/1999/xhtml">L</span></strong><span class="koboSpan" id="kobo.1097.1" xmlns="http://www.w3.org/1999/xhtml">: N/A</span></li>
<li><strong><span class="koboSpan" id="kobo.1098.1" xmlns="http://www.w3.org/1999/xhtml">I</span></strong><span class="koboSpan" id="kobo.1099.1" xmlns="http://www.w3.org/1999/xhtml">: A DTO is a small, specifically crafted data contract (abstraction) with a clear purpose in the API contract.</span></li>
<li><strong><span class="koboSpan" id="kobo.1100.1" xmlns="http://www.w3.org/1999/xhtml">D</span></strong><span class="koboSpan" id="kobo.1101.1" xmlns="http://www.w3.org/1999/xhtml">: Due to those smaller interfaces (ISP), DTOs allow changing the implementation details of the endpoint without affecting the clients because they depend only on the API contract (the abstraction).</span></li>
</ul>
<p><span class="koboSpan" id="kobo.1102.1" xmlns="http://www.w3.org/1999/xhtml">You should now understand the added value of DTOs and what part in an API contract they play. </span><span class="koboSpan" id="kobo.1102.2" xmlns="http://www.w3.org/1999/xhtml">Finally, you should have a strong base of Minimal APIs possibilities.</span></p>
</section>
</section>
<section class="level2" data-number="6.6" id="summary-4">
<h2 data-number="6.6"><span class="koboSpan" id="kobo.1103.1" xmlns="http://www.w3.org/1999/xhtml">Summary</span></h2>
<p><span class="koboSpan" id="kobo.1104.1" xmlns="http://www.w3.org/1999/xhtml">Throughout the chapter, we explored ASP.NET Core Minimal APIs and their integration with the DTO pattern. </span><span class="koboSpan" id="kobo.1104.2" xmlns="http://www.w3.org/1999/xhtml">Minimal APIs simplify web application development by reducing boilerplate code. </span><span class="koboSpan" id="kobo.1104.3" xmlns="http://www.w3.org/1999/xhtml">The DTO pattern helps us decouple the API contract from the application's inner workings, allowing flexibility in crafting REST APIs. </span><span class="koboSpan" id="kobo.1104.4" xmlns="http://www.w3.org/1999/xhtml">DTOs can also save bandwidth and flatten or change data structures. </span><span class="koboSpan" id="kobo.1104.5" xmlns="http://www.w3.org/1999/xhtml">Endpoints exposing their domain or data entities directly can lead to issues, while DTO-enabled endpoints offer better control over data exchanges. </span><span class="koboSpan" id="kobo.1104.6" xmlns="http://www.w3.org/1999/xhtml">We also discussed numerous Minimal APIs aspects, including input binding, outputting data, metadata, JSON serialization, endpoint filters, and endpoint organization. </span><span class="koboSpan" id="kobo.1104.7" xmlns="http://www.w3.org/1999/xhtml">With this foundational knowledge, we can begin to design ASP.NET Core minimal APIs.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.1105.1" xmlns="http://www.w3.org/1999/xhtml">For more information about Minimal APIs and what they have to offer, you can visit the </span><em><span class="koboSpan" id="kobo.1106.1" xmlns="http://www.w3.org/1999/xhtml">Minimal APIs quick reference</span></em><span class="koboSpan" id="kobo.1107.1" xmlns="http://www.w3.org/1999/xhtml"> page of the official documentation: </span><a href="https://adpg.link/S47i"><span class="koboSpan" id="kobo.1108.1" xmlns="http://www.w3.org/1999/xhtml">https://adpg.link/S47i</span></a></p>
</blockquote>
<p><span class="koboSpan" id="kobo.1109.1" xmlns="http://www.w3.org/1999/xhtml">In the next chapter, we revisit the same notions in an ASP.NET Core MVC context.</span></p>
</section>
<section class="level2" data-number="6.7" id="questions-4">
<h2 data-number="6.7"><span class="koboSpan" id="kobo.1110.1" xmlns="http://www.w3.org/1999/xhtml">Questions</span></h2>
<p><span class="koboSpan" id="kobo.1111.1" xmlns="http://www.w3.org/1999/xhtml">Let’s look at a few practice questions:</span></p>
<ol>
<li><span class="koboSpan" id="kobo.1112.1" xmlns="http://www.w3.org/1999/xhtml">How to map different HTTP requests to delegates with Minimal APIs?</span></li>
<li><span class="koboSpan" id="kobo.1113.1" xmlns="http://www.w3.org/1999/xhtml">Can we use middleware with Minimal APIs?</span></li>
<li><span class="koboSpan" id="kobo.1114.1" xmlns="http://www.w3.org/1999/xhtml">Can you name at least two binding sources that minimal APIs supports?</span></li>
<li><span class="koboSpan" id="kobo.1115.1" xmlns="http://www.w3.org/1999/xhtml">What is the difference between using the </span><code><span class="koboSpan" id="kobo.1116.1" xmlns="http://www.w3.org/1999/xhtml">Results</span></code><span class="koboSpan" id="kobo.1117.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.1118.1" xmlns="http://www.w3.org/1999/xhtml">TypedResults</span></code><span class="koboSpan" id="kobo.1119.1" xmlns="http://www.w3.org/1999/xhtml"> classes?</span></li>
<li><span class="koboSpan" id="kobo.1120.1" xmlns="http://www.w3.org/1999/xhtml">What is the purpose of endpoint filters?</span></li>
</ol>
</section>
<section class="level2" data-number="6.8" id="further-reading-4">
<h2 data-number="6.8"><span class="koboSpan" id="kobo.1121.1" xmlns="http://www.w3.org/1999/xhtml">Further reading</span></h2>
<p><span class="koboSpan" id="kobo.1122.1" xmlns="http://www.w3.org/1999/xhtml">Here are some links to build on what we have learned in the chapter:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.1123.1" xmlns="http://www.w3.org/1999/xhtml">Minimal APIs quick reference: </span><a href="https://adpg.link/S47i"><span class="koboSpan" id="kobo.1124.1" xmlns="http://www.w3.org/1999/xhtml">https://adpg.link/S47i</span></a></li>
<li><span class="koboSpan" id="kobo.1125.1" xmlns="http://www.w3.org/1999/xhtml">Problem Details for HTTP APIs (RFC7807): </span><a href="https://adpg.link/1hpM"><span class="koboSpan" id="kobo.1126.1" xmlns="http://www.w3.org/1999/xhtml">https://adpg.link/1hpM</span></a></li>
<li><span class="koboSpan" id="kobo.1127.1" xmlns="http://www.w3.org/1999/xhtml">FluentValidation.AspNetCore.Http: </span><a href="https://adpg.link/sRtU"><span class="koboSpan" id="kobo.1128.1" xmlns="http://www.w3.org/1999/xhtml">https://adpg.link/sRtU</span></a></li>
</ul>
</section>
<section class="level2" data-number="6.9" id="answers-1">
<h2 data-number="6.9"><span class="koboSpan" id="kobo.1129.1" xmlns="http://www.w3.org/1999/xhtml">Answers</span></h2>
<ol>
<li><span class="koboSpan" id="kobo.1130.1" xmlns="http://www.w3.org/1999/xhtml">Minimal APIs provide extension methods such as </span><code><span class="koboSpan" id="kobo.1131.1" xmlns="http://www.w3.org/1999/xhtml">MapGet</span></code><span class="koboSpan" id="kobo.1132.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.1133.1" xmlns="http://www.w3.org/1999/xhtml">MapPost</span></code><span class="koboSpan" id="kobo.1134.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.1135.1" xmlns="http://www.w3.org/1999/xhtml">MapPut</span></code><span class="koboSpan" id="kobo.1136.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code><span class="koboSpan" id="kobo.1137.1" xmlns="http://www.w3.org/1999/xhtml">MapDelete</span></code><span class="koboSpan" id="kobo.1138.1" xmlns="http://www.w3.org/1999/xhtml"> to configure the HTTP pipeline and map specific HTTP requests to delegates.</span></li>
<li><span class="koboSpan" id="kobo.1139.1" xmlns="http://www.w3.org/1999/xhtml">Yes, we can use middleware with Minimal APIs, just like any other ASP.NET Core application.</span></li>
<li><span class="koboSpan" id="kobo.1140.1" xmlns="http://www.w3.org/1999/xhtml">Minimal APIs support various binding sources, including </span><code><span class="koboSpan" id="kobo.1141.1" xmlns="http://www.w3.org/1999/xhtml">Route</span></code><span class="koboSpan" id="kobo.1142.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.1143.1" xmlns="http://www.w3.org/1999/xhtml">Query</span></code><span class="koboSpan" id="kobo.1144.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.1145.1" xmlns="http://www.w3.org/1999/xhtml">Header</span></code><span class="koboSpan" id="kobo.1146.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.1147.1" xmlns="http://www.w3.org/1999/xhtml">Body</span></code><span class="koboSpan" id="kobo.1148.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.1149.1" xmlns="http://www.w3.org/1999/xhtml">Form</span></code><span class="koboSpan" id="kobo.1150.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code><span class="koboSpan" id="kobo.1151.1" xmlns="http://www.w3.org/1999/xhtml">Services</span></code><span class="koboSpan" id="kobo.1152.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li><span class="koboSpan" id="kobo.1153.1" xmlns="http://www.w3.org/1999/xhtml">The methods in the </span><code><span class="koboSpan" id="kobo.1154.1" xmlns="http://www.w3.org/1999/xhtml">Results</span></code><span class="koboSpan" id="kobo.1155.1" xmlns="http://www.w3.org/1999/xhtml"> class return </span><code><span class="koboSpan" id="kobo.1156.1" xmlns="http://www.w3.org/1999/xhtml">IResult</span></code><span class="koboSpan" id="kobo.1157.1" xmlns="http://www.w3.org/1999/xhtml">, while those in </span><code><span class="koboSpan" id="kobo.1158.1" xmlns="http://www.w3.org/1999/xhtml">TypedResults</span></code><span class="koboSpan" id="kobo.1159.1" xmlns="http://www.w3.org/1999/xhtml"> return a typed implementation of the </span><code><span class="koboSpan" id="kobo.1160.1" xmlns="http://www.w3.org/1999/xhtml">IResult</span></code><span class="koboSpan" id="kobo.1161.1" xmlns="http://www.w3.org/1999/xhtml"> interface. </span><span class="koboSpan" id="kobo.1161.2" xmlns="http://www.w3.org/1999/xhtml">This difference is significant because the API Explorer can automatically discover the API contract from the typed results (</span><code><span class="koboSpan" id="kobo.1162.1" xmlns="http://www.w3.org/1999/xhtml">TypedResults</span></code><span class="koboSpan" id="kobo.1163.1" xmlns="http://www.w3.org/1999/xhtml"> methods) but not from the generic </span><code><span class="koboSpan" id="kobo.1164.1" xmlns="http://www.w3.org/1999/xhtml">IResult</span></code><span class="koboSpan" id="kobo.1165.1" xmlns="http://www.w3.org/1999/xhtml"> interface (</span><code><span class="koboSpan" id="kobo.1166.1" xmlns="http://www.w3.org/1999/xhtml">Results</span></code><span class="koboSpan" id="kobo.1167.1" xmlns="http://www.w3.org/1999/xhtml"> methods).</span></li>
<li><span class="koboSpan" id="kobo.1168.1" xmlns="http://www.w3.org/1999/xhtml">Endpoint filters allow encapsulation and reuse of cross-cutting logic across endpoints. </span><span class="koboSpan" id="kobo.1168.2" xmlns="http://www.w3.org/1999/xhtml">For example, they're helpful for input validation, logging, exception handling, and promoting code reusability.</span></li>
</ol>
</section>
</section>
</body>
</html>
