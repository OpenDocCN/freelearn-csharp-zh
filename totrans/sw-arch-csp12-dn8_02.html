<html><head></head><body>
<div><h1 class="chapterNumber">2</h1>
<h1 class="chapterTitle" id="_idParaDest-44">Non-Functional Requirements</h1>
<p class="normal">Once you have gathered the system requirements, it is time to think about the impact they have on the architectural design. Scalability, availability, resiliency, performance, multithreading, interoperability, security, and other aspects need to be analyzed so that we can meet user needs. We refer to these aspects as non-functional requirements.</p>
<p class="normal">We will cover the following topics in this chapter:</p>
<ul>
<li class="bulletList">Enabling scalability, availability, and resiliency with Azure and .NET 8</li>
<li class="bulletList">Performance issues that need to be considered when programming in C#</li>
<li class="bulletList">Software usability: how to design effective user interfaces</li>
<li class="bulletList">Interoperability with .NET 8</li>
<li class="bulletList">Achieving security by design</li>
</ul>
<p class="normal">The main purpose of discussing non-functional requirements here is that they are highly relevant to software architects: even though they are not so important to getting the software working in terms of functionality, they can make all the difference when comparing good software and bad software.</p>
<h1 class="heading-1" id="_idParaDest-45">Technical requirements</h1>
<p class="normal">The samples provided in this chapter require Visual Studio 2022 Community Edition with the .NET 8 SDK installed.</p>
<p class="normal">You can find the sample code for this chapter at <a href="https://github.com/PacktPublishing/Software-Architecture-with-C-Sharp-12-and-.NET-8-4E">https://github.com/PacktPublishing/Software-Architecture-with-C-Sharp-12-and-.NET-8-4E</a>.</p>
<h1 class="heading-1" id="_idParaDest-46">Enabling scalability, availability, and resiliency with Azure and .NET 8</h1>
<p class="normal">A quick search online<a id="_idIndexMarker088"/> for a definition of “scalability” returns<a id="_idIndexMarker089"/> something <a id="_idIndexMarker090"/>along the lines<a id="_idIndexMarker091"/> of “the ability of a system<a id="_idIndexMarker092"/> to keep working well<a id="_idIndexMarker093"/> when there is an increase in demand.” When<a id="_idIndexMarker094"/> developers<a id="_idIndexMarker095"/> go by this definition, many of them incorrectly conclude that scalability<a id="_idIndexMarker096"/> only means adding more hardware<a id="_idIndexMarker097"/> to keep things<a id="_idIndexMarker098"/> working without stopping<a id="_idIndexMarker099"/> their apps.</p>
<p class="normal">Scalability relies on hardware solutions to some extent. However, as a software architect, you need to be aware that good software will keep scalability in a sustainable model, which means that well-architected software can save a lot of money. Hence, scalability is not just a matter of hardware but also a matter of overall software design. The point here is that the running costs of a system should also be a factor in architectural decisions.</p>
<p class="normal">In <em class="chapterRef">Chapter 1</em>,<em class="italic"> Understanding the Importance of Software Architecture</em>, while discussing software performance, we presented some good tips to overcome performance issues. The same tips will help you with scalability, too. The fewer resources we spend on each process, the more users an application can handle.</p>
<p class="normal">Although scalability is important, cloud computing applications must be designed to work with system failures. Every time you guarantee that your application can recover from a failure without exposing the failure to the end user, you are creating a resilient application.</p>
<div><p class="normal">You may find cloud architecture<a id="_idIndexMarker100"/> resiliency patterns at <a href="https://docs.microsoft.com/en-us/azure/architecture/framework/resiliency/reliability-patterns#resiliency">https://docs.microsoft.com/en-us/azure/architecture/framework/resiliency/reliability-patterns#resiliency</a>.</p>
</div>
<p class="normal">The reason why resiliency is especially important in cloud scenarios is that the infrastructure provided to you may need a small amount of time to manage updates, resets, and even hardware upgrades. You are also more likely to have to work with multiple systems, and transient errors are likely to occur in communicating with them. That is why the non-functional requirement of resiliency has gained a higher profile in recent years.</p>
<p class="normal">The possibility of having scalable and resilient solutions gets more exciting when you can enable high availability in the system. All the approaches presented in this book will help you to design solutions with good availability, but in some cases, you will need to design specific alternatives to achieve your specific goal.</p>
<p class="normal">It is worth<a id="_idIndexMarker101"/> knowing<a id="_idIndexMarker102"/> that<a id="_idIndexMarker103"/> Azure <a id="_idIndexMarker104"/>and .NET 8 web<a id="_idIndexMarker105"/> apps<a id="_idIndexMarker106"/> can<a id="_idIndexMarker107"/> be<a id="_idIndexMarker108"/> configured<a id="_idIndexMarker109"/> to achieve<a id="_idIndexMarker110"/> these<a id="_idIndexMarker111"/> non-functional<a id="_idIndexMarker112"/> requirements. Let us check this out in the following subsections.</p>
<h2 class="heading-2" id="_idParaDest-47">Creating a scalable web app in Azure</h2>
<p class="normal">It is simple to create a web app<a id="_idIndexMarker113"/> in Azure that is ready for scaling. The reason why you must do so is to be able to maintain different numbers of users during different seasons. The more users you have, the more hardware you will need. Let us show you how to create a scalable web application in Azure.</p>
<p class="normal">As soon as you log in to your Azure account, you will be able to create a new resource (web app, database, virtual machine, and so on), as you can see in the following screenshot:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B19820_02_01.png"/></figure>
<p class="packt_figref">Figure 2.1: Microsoft Azure – Create a resource</p>
<p class="normal">After that, you can select <strong class="keyWord">App Services in Popular Options</strong> or even type it into the <strong class="keyWord">Search the Marketplace</strong> textbox. Then, you can choose to create a <strong class="keyWord">web app</strong>. This action will take you to the following<a id="_idIndexMarker114"/> screen:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B19820_02_02.png"/></figure>
<p class="packt_figref">Figure 2.2: Microsoft Azure – Creating a web app</p>
<p class="normal">The required <strong class="keyWord">Project Details</strong> are as follows:</p>
<ul>
<li class="bulletList"><strong class="keyWord">Subscription</strong>: This is the account that will be charged for all application costs.</li>
<li class="bulletList"><strong class="keyWord">Resource Group</strong>: This is the collection of resources you can define to organize policies and permissions. You may specify a new resource group name or add the web app to a group specified during the definition of other resources.</li>
</ul>
<p class="normal">Besides these, the <strong class="keyWord">Instance Details</strong> are as follows:</p>
<ul>
<li class="bulletList"><strong class="keyWord">Name</strong>: As you can see, the web app name is the URL that your solution will assume after its creation. The name must be globally unique and is checked to ensure it is available.</li>
<li class="bulletList"><strong class="keyWord">Publish</strong>: This parameter indicates whether the web app will be delivered directly, a static web app, or whether it is going to use Docker technology to publish content. Docker will be discussed in more detail in <em class="chapterRef">Chapter 11</em>, <em class="italic">Applying a Microservice Architecture to Your Enterprise Application</em>. If you opt for the Docker container publication, you will be able to configure the <strong class="keyWord">Image Source</strong>, <strong class="keyWord">Access Type</strong>, and <strong class="keyWord">Image</strong> and tag information to have it deployed to the web app.</li>
<li class="bulletList"><strong class="keyWord">Runtime stack</strong>: This option is obviously only available when you decide to deliver code directly. You could define stacks for .NET, Go, Java, Node.js, PHP, Python, and Ruby.</li>
<li class="bulletList"><strong class="keyWord">Operating System</strong>: This is the option for defining the OS that will host the web app. Both Windows and Linux may be used for .NET projects in the newest versions.</li>
<li class="bulletList"><strong class="keyWord">Region</strong>: You may consider<a id="_idIndexMarker115"/> where you want to deploy your application; Azure has many different data centers all over the world.</li>
<li class="bulletList"><strong class="keyWord">Pricing Plans</strong>: This is where you define the hardware plan that is used to handle the web app and the region of the servers. This choice defines application scalability, performance, and costs.</li>
<li class="bulletList"><strong class="keyWord">Zone redundancy: </strong>Starting with premium pricing plans, you will be able to activate zone redundancy, which will increase the availability of the solution.</li>
<li class="bulletList"><strong class="keyWord">Deployment:</strong> It is possible to define the GitHub repository that is responsible for continuously deploying the application.</li>
<li class="bulletList"><strong class="keyWord">Networking:</strong> You may select the network behavior of the application according to its requirements and proposal.</li>
<li class="bulletList"><strong class="keyWord">Monitoring</strong>: This is a useful Azure toolset for monitoring and troubleshooting web apps. In this section, you can enable <strong class="keyWord">Application Insights</strong>. It is always recommended that you keep the same regions for the different components of your solution since this will save costs in terms of traffic exchange from one data center to another.</li>
</ul>
<p class="normal">Once you have created<a id="_idIndexMarker116"/> your web app, this application may be scaled in two conceptually different ways: vertically (<strong class="screenText">scale up</strong>) and horizontally (<strong class="screenText">scale out</strong>). Both are available in the web app settings, as you can see in the following screenshot:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B19820_02_03.png"/></figure>
<p class="packt_figref">Figure 2.3: Scaling options for web apps</p>
<p class="normal">Let us check out the two types of scaling.</p>
<h3 class="heading-3" id="_idParaDest-48">Vertical scaling (scaling up)</h3>
<p class="normal">Scaling up means changing<a id="_idIndexMarker117"/> the specification of the hardware<a id="_idIndexMarker118"/> that will host your application. In Azure, you have the opportunity to start with free, shared hardware and move to an isolated machine in a few clicks. The following screenshot shows the user interface for scaling up a web app:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B19820_02_04.png"/></figure>
<p class="packt_figref">Figure 2.4: Vertical scaling options</p>
<p class="normal">By choosing one of the options provided, you can select more powerful hardware (machines with more CPUs, storage, and RAM). Monitoring your application and its App Service plan will guide you on how to decide the best infrastructure for running your solution. It will also offer key insights, such as possible CPU, memory, and I/O bottlenecks.</p>
<h3 class="heading-3" id="_idParaDest-49">Horizontal scaling (scaling out)</h3>
<p class="normal">Scaling out means splitting<a id="_idIndexMarker119"/> requests between <a id="_idIndexMarker120"/>more servers and using the same capacity instead of using more powerful machines. The load on all the servers is automatically balanced by the Azure infrastructure. This solution is advised when the overall load may change considerably in the future since horizontal scaling can automatically adapt to a given load. The following screenshot shows an automatic <strong class="screenText">Scale out</strong> strategy defined by two simple rules, triggered by CPU usage:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B19820_02_05.png"/></figure>
<p class="packt_figref">Figure 2.5: Horizontal scaling sample</p>
<p class="normal">It is worth highlighting that you can choose to have a hardcoded instance count or implement rules for automatic scale in/out.</p>
<p class="normal">A complete description of all the available<a id="_idIndexMarker121"/> autoscale rules is beyond<a id="_idIndexMarker122"/> the scope of this book. However, they are quite self-explanatory, and the <em class="italic">Further reading</em> section contains links to the full documentation.</p>
<p class="normal">The <strong class="keyWord">Scale out</strong> feature is only available in paid service plans.</p>
<p class="normal">In general, horizontal scaling<a id="_idIndexMarker123"/> is a way to guarantee<a id="_idIndexMarker124"/> availability in an application even with several simultaneous accesses. For sure, its use is not the only way to keep a system available, but it does help.</p>
<h2 class="heading-2" id="_idParaDest-50">Creating a scalable web app with .NET 8</h2>
<p class="normal">Among all the available frameworks<a id="_idIndexMarker125"/> for implementing web apps, running<a id="_idIndexMarker126"/> web apps with ASP.NET Core in .NET 8 ensures good performance, together with low production and maintenance costs. The union of C#, a strongly typed and advanced general-purpose language, and continuous performance improvements achieved in ASP.NET Core distinguish this option as one of the best for enterprise development.</p>
<p class="normal">The steps in this section will guide you through the creation of an ASP.NET Core Runtime 8-based web app. All the steps are quite simple, but some details require particular attention.</p>
<p class="normal">It is worth mentioning that .NET 8 gives you the opportunity to develop for any platform – desktops (WPF, Windows Forms, and UWP), web (ASP.NET), cloud (Azure), mobile (Xamarin), gaming (Unity), IoT (ARM32 and ARM64), or AI (ML.NET and .NET for Apache Spark). So, the recommendation from now on is to only use .NET 8. In this scenario, you can run your web app on either Windows servers or cheaper Linux servers.</p>
<p class="normal">Nowadays, Microsoft recommends classic .NET, just in case the features you need are not available in .NET Core/5+ or you are deploying your web app in an environment that does not support .NET Core. In any other case, you should prefer .NET Core/5+ because it allows you to do the following:</p>
<ul>
<li class="bulletList">Run your web app in Windows, Linux, macOS, or Docker containers</li>
<li class="bulletList">Design your solution with microservices</li>
<li class="bulletList">Have high-performance and scalable systems</li>
</ul>
<p class="normal">Containers and microservices will be covered in <em class="chapterRef">Chapter 11</em>,<em class="italic"> Applying a Microservice Architecture to Your Enterprise Application</em>. There, you will get a better understanding of the advantages of these technologies. For now, it is enough to say that .NET 8 and microservices were designed for performance and scalability, which is why you should prefer .NET 8 in all your new projects. Besides, .NET 8 is guaranteed by Microsoft as a Long Term Support version, which means three years of patches and free support.</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B19820_02_06.png"/></figure>
<p class="packt_figref">Figure 2.6: .NET 8 support policy</p>
<p class="normal">The following procedure<a id="_idIndexMarker127"/> will show you how to create an ASP.NET Core web<a id="_idIndexMarker128"/> app in Visual Studio 2022 with .NET 8:</p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1">As soon as you start VS 2022, you will be able to click on <strong class="screenText">Create a new project</strong>.</li>
<li class="numberedList">Once you select <strong class="screenText">ASP.NET Core Web App</strong>, you will be directed to a screen where you will be asked to set up <strong class="screenText">Project name</strong>, <strong class="screenText">Location</strong>, and <strong class="screenText">Solution name</strong>:</li>
</ol>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B19820_02_07.png"/></figure>
<p class="packt_figref">Figure 2.7: Creating an ASP.NET Core web application</p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3">After that, you<a id="_idIndexMarker129"/> will be able to select the .NET version<a id="_idIndexMarker130"/> to use. Select <strong class="screenText">.NET 8.0</strong> to get the most advanced and up-to-date platform.</li>
<li class="numberedList">Click <strong class="screenText">Create</strong> to create your ASP.NET Core 8 web app.</li>
<li class="numberedList">Now that you are done with adding the basic details, you can connect your web app project to your Azure account and publish it.</li>
<li class="numberedList">If you right-click the project you created in Solution Explorer, you have the option to <strong class="screenText">Publish</strong>.</li>
<li class="numberedList">You will find different targets in terms of where to publish your web app. Select <strong class="screenText">Azure</strong> as the target:</li>
</ol>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B19820_02_08.png"/></figure>
<p class="packt_figref">Figure 2.8: Targeting Azure to publish the app</p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="8">Then, you will be able<a id="_idIndexMarker131"/> to decide the specific target<a id="_idIndexMarker132"/> to publish. Select <strong class="screenText">Azure App Service (Windows)</strong> for this demo.</li>
<li class="numberedList">You may be required to define your Microsoft Account credentials at this time. This is because there is full integration between Visual Studio and Azure. This gives you the opportunity to view all the resources you created in the Azure portal in your development environment.</li>
</ol>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B19820_02_09.png"/></figure>
<p class="packt_figref">Figure 2.9: Integration between Visual Studio and Azure</p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="10">If you want to create<a id="_idIndexMarker133"/> a new web app using Visual <a id="_idIndexMarker134"/>Studio, make sure to select the <strong class="screenText">Free Size</strong> tier of pricing during the App Service creation process so that this does not incur any costs:</li>
</ol>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B19820_02_10.png"/></figure>
<p class="packt_figref">Figure 2.10: Creating a New Hosting Plan</p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="11">The usual way to deploy<a id="_idIndexMarker135"/> using Visual Studio<a id="_idIndexMarker136"/> is by selecting <strong class="screenText">Publish Profile</strong>, which generates a <code class="inlineCode">.pubxml</code> file, which is a Visual Studio publish profile. In this case, you currently have two modes for deployment.
    <p class="normal">The first, <strong class="screenText">Framework-dependent</strong>, will require a web app configured with the target framework. The second, <strong class="screenText">Self-contained</strong>, will not need this feature since the binaries of the framework will be published together with the application. Once the file<a id="_idIndexMarker137"/> is created and the options are selected, you just click<a id="_idIndexMarker138"/> on the <strong class="screenText">Publish</strong> button, and the process will start:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B19820_02_11.png"/></figure>
<p class="packt_figref">Figure 2.11: Publish profile web deploy</p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="12">It is worth mentioning that to publish ASP.NET Preview versions in <strong class="screenText">Framework-dependent</strong> mode, you must add an extension in the web app setup panel in the Azure portal, as shown in the following screenshot. However, consider using <strong class="screenText">Self-contained</strong> mode, especially when you are under preview versions and using Windows apps:</li>
</ol>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B19820_02_12.png"/></figure>
<p class="packt_figref">Figure 2.12: Adding extensions in Azure App Service</p>
<div><p class="normal">For more information<a id="_idIndexMarker139"/> on deploying ASP.NET Core 8.0 to Azure App Service, please refer to the following link: <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/azure-apps/?view=aspnetcore-8.0&amp;tabs=visual-studio">https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/azure-apps/?view=aspnetcore-8.0&amp;tabs=visual-studio</a>.</p>
</div>
<p class="normal">Although publishing<a id="_idIndexMarker140"/> using Visual Studio 2022 may be considered a good option<a id="_idIndexMarker141"/> for demonstration, in the real world, it is almost impossible to keep your publishing strategy using it. For this reason, you might consider using a CI/CD flow based on GitHub Actions, which automatically enables deployment on the code being pushed to a GitHub repo. It is worth mentioning that you must be connected to a GitHub repo to access this new function. Let us use this new feature for this demonstration. We will discuss it in more depth in <em class="chapterRef">Chapter 8</em><em class="italic">, Understanding DevOps Principles and CI/CD</em>.</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B19820_02_13.png"/></figure>
<p class="packt_figref">Figure 2.13: Deploying a web app using GitHub actions</p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1">Once you have pushed<a id="_idIndexMarker142"/> your code, you can go to the GitHub Actions<a id="_idIndexMarker143"/> pane and select the way you want to deploy the web app.</li>
<li class="numberedList">For this second demo, you can select <strong class="screenText">Deploy a .NET Core app to an Azure Web App</strong>. With this option, you will have a YAML file created with all the instructions needed to connect your code to the web app.
    <figure class="mediaobject"><img alt="" role="presentation" src="img/B19820_02_14.png"/></figure>
<p class="packt_figref">Figure 2.14: YAML file used to deploy the application</p>
<div><p class="normal">Depending on the web app you want to deploy, you will need a different script. These scripts are documented at <a href="https://github.com/Azure/webapps-deploy">https://github.com/Azure/webapps-deploy</a>.</p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3">Once you have set the correct<a id="_idIndexMarker144"/> script, you will be able to check<a id="_idIndexMarker145"/> the execution of the GitHub Action:</li>
</ol>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B19820_02_15.png"/></figure>
<p class="packt_figref">Figure 2.15: GitHub Actions tab</p>
<p class="normal">Here, we described two ways<a id="_idIndexMarker146"/> to deploy a web app. In <em class="chapterRef">Chapter 8</em><em class="italic">, Understanding DevOps Principles and CI/CD</em>, we will go further into <strong class="keyWord">Continuous Integration/Continuous Delivery</strong> (<strong class="keyWord">CI/CD</strong>) strategies to guarantee all the steps<a id="_idIndexMarker147"/> required to get an application to production, that is, building, testing, deployment to staging, and deployment to production.</p>
<p class="normal">Now that you have learned a great<a id="_idIndexMarker148"/> way to make your web apps run<a id="_idIndexMarker149"/> on Azure, using Visual Studio as a helpful tool, it is essential to understand some performance issues that may cause struggles while creating a solution.</p>
<h1 class="heading-1" id="_idParaDest-51">Performance issues that need to be considered when programming in C#</h1>
<p class="normal">Nowadays, C# is one of the most<a id="_idIndexMarker150"/> used programming languages in the world, so awareness of C# programming best practices is fundamental for the design of good architectures that satisfy the most common non-functional requirements.</p>
<p class="normal">The following sections mention a few simple but effective tips – the associated code samples are available in this book’s GitHub repository. It is worth mentioning that .NET Foundation<a id="_idIndexMarker151"/> has developed a library dedicated to benchmarking called BenchmarkDotNet. You may find it useful <a id="_idIndexMarker152"/>for your scenarios. Check it out at <a href="https://benchmarkdotnet.org/">https://benchmarkdotnet.org/</a>.</p>
<h2 class="heading-2" id="_idParaDest-52">String concatenation</h2>
<p class="normal">This is a classic one! A naive concatenation<a id="_idIndexMarker153"/> of strings with the <code class="inlineCode">+</code> string operator<a id="_idIndexMarker154"/> may cause serious performance issues since every time two strings are concatenated; their contents are copied into a new string.</p>
<p class="normal">So, if we concatenate, for instance, 10 strings that have an average length of 100, the first operation has a cost of 200, the second one has a cost of <code class="inlineCode">200+100=300</code>, the third one has a cost of <code class="inlineCode">300+100=400</code>, and so on. It is not difficult to convince yourself that the overall cost grows as <code class="inlineCode">m*n</code><sup class="superscript">2</sup>, where <code class="inlineCode">n</code> is the number of strings and <code class="inlineCode">m</code> is their average length. <code class="inlineCode">n</code><sup class="superscript">2</sup> is not too big for small <code class="inlineCode">n</code> (say, <code class="inlineCode">n &lt; 10</code>), but it becomes quite big when <code class="inlineCode">n</code> reaches the magnitude of 100-1,000 and is unacceptable for magnitudes of 10,000-100,000.</p>
<p class="normal">Let us look at this with some test code that compares naive concatenation with the same operation but performed with the help of the <code class="inlineCode">StringBuilder</code> class (the code is available in this book’s GitHub repository):</p>
<figure class="mediaobject"><img alt="Text  Description automatically generated" src="img/B19820_02_16.png"/></figure>
<p class="packt_figref">Figure 2.16: Concatenation test code result</p>
<p class="normal">If you create a <code class="inlineCode">StringBuilder</code> class with something like <code class="inlineCode">var sb = new System.Text.StringBuilder()</code>, and then you add each string to it with <code class="inlineCode">sb.Append(currString)</code>, the strings are not copied; instead, their pointers are queued in a list. They are copied in the final string just once when you call <code class="inlineCode">sb.ToString()</code> to get the final result. Accordingly, the cost of <code class="inlineCode">StringBuilder</code>-based concatenation grows simply as <code class="inlineCode">m*n</code>.</p>
<p class="normal">Of course, you will probably never find a piece of software with a function like the preceding one that concatenates 100,000 strings. However, you need to recognize pieces of code like these where the concatenation of some 20-100 strings, say, in a web server that handles several requests<a id="_idIndexMarker155"/> simultaneously might cause bottlenecks<a id="_idIndexMarker156"/> that damage your non-functional requirements for performance.</p>
<h2 class="heading-2" id="_idParaDest-53">Exceptions</h2>
<p class="normal">Always remember<a id="_idIndexMarker157"/> that exceptions<a id="_idIndexMarker158"/> are much slower than normal code flow! So, the usage of <code class="inlineCode">try-catch</code> needs to be concise and essential; otherwise, you will have big performance issues.</p>
<p class="normal">The following two samples compare the usage of <code class="inlineCode">try-catch</code> and <code class="inlineCode">Int32.TryParse</code> to check whether a string can be converted into an integer, as follows:</p>
<pre class="programlisting code"><code class="hljs-code">private static string ParseIntWithTryParse()
{
    string result = string.Empty;
    if (int.TryParse(result, out var value))
        result = value.ToString();
    else
        result = "There is no int value";
    return $"Final result: {result}";
}
private static string ParseIntWithException()
{
    string result = string.Empty;
    try
    {
        result = Convert.ToInt32(result).ToString();
    }
    catch (Exception)
    {
        result = "There is no int value";
    }
    return $"Final result: {result}";
}
</code></pre>
<p class="normal">The second function does not look dangerous, but it is thousands of times slower than the first one:</p>
<figure class="mediaobject"><img alt="Text  Description automatically generated" src="img/B19820_02_17.png"/></figure>
<p class="packt_figref">Figure 2.17: Exception test code result</p>
<p class="normal">To sum this up, exceptions must be used to deal with exceptional cases that break the normal flow of control, for instance, situations<a id="_idIndexMarker159"/> when operations must be aborted for some unexpected reasons, and control<a id="_idIndexMarker160"/> must be returned several levels up in the call stack.</p>
<h2 class="heading-2" id="_idParaDest-54">Multithreading environments for better results – dos and don’ts</h2>
<p class="normal">If you want to take advantage<a id="_idIndexMarker161"/> of all the hardware<a id="_idIndexMarker162"/> that the system you are building provides, you must use multithreading. This way, when a thread is waiting for an operation to complete, the application can leave the CPU to other threads instead of wasting CPU time.</p>
<p class="normal">On the other hand, no matter how hard Microsoft works to help with this, parallel code is not as simple as eating a piece of cake: it is error-prone and difficult to test and debug. The most important thing to remember as a software architect when you start considering using threads is <em class="italic">does your system require them?</em> Non-functional and some functional requirements will answer this question for you.</p>
<p class="normal">As soon as you are sure that you need a multithreading<a id="_idIndexMarker163"/> system, you should decide on which technology is more adequate. There are a few options<a id="_idIndexMarker164"/> here, as follows:</p>
<ul>
<li class="bulletList"><strong class="keyWord">Creating an instance of</strong> <code class="inlineCode">System.Threading.Thread</code>: This is a classic way of creating threads in C#. The entire thread life cycle will be in your hands. This is good when you are sure about what you are going to do, but you need to worry about every single detail of the implementation. The resulting code is hard to conceive and debug/test/maintain. So, to keep development costs acceptable, this approach should be confined to a few fundamental, performance-critical modules.</li>
<li class="bulletList"><strong class="keyWord">Managing threads using </strong><code class="inlineCode">System.Threading.ThreadPool</code>: You can reduce the complexity of this implementation by using the <code class="inlineCode">ThreadPool</code> class. Especially if you intend to develop a solution in which you will have many threads being executed, this could be a good option. It is worth mentioning that the .NET thread pool has been re-implemented in .NET 6 as a C# class, which will bring new possibilities for experimentation or customization.</li>
<li class="bulletList"><strong class="keyWord">Programming using</strong> <code class="inlineCode">System.Threading.Tasks.Parallel</code> classes: Since .NET Framework 4.0, you can use parallel classes to enable threads in a simpler way. This is good because you do not need to worry about the life cycle of the threads you create, but it will give you less control over what is happening in each thread.</li>
<li class="bulletList"><strong class="keyWord">Developing using asynchronous programming</strong>: This is, for sure, the easiest way to develop multithreaded applications since the compiler takes on most of the work. Depending on the way you call an asynchronous method, you may have the <code class="inlineCode">Task</code> created running in parallel with the <code class="inlineCode">Thread</code> that was used to call it or even keep that <code class="inlineCode">Thread</code> waiting without suspending for the <code class="inlineCode">Task</code> that was created to conclude. This way, asynchronous code mimics the behavior of classical synchronous code while keeping most of the performance advantages of general parallel programming:<ul>
<li class="bulletList">The overall behavior is deterministic and does not depend on the time taken by each task to complete, so non-reproducible bugs are less likely to happen, and the resulting code is easy to test/debug/maintain. Defining a method as an asynchronous task or not is the only choice left to the programmer; everything else is automatically handled by the runtime. The only thing you should be concerned about is which methods should have asynchronous behavior. It is worth mentioning that defining a method as <code class="inlineCode">async</code> does not mean it will execute on a separate thread. You may find useful information<a id="_idIndexMarker165"/> in a great sample at <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/async/">https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/async/</a>.</li>
<li class="bulletList">Later in this book, we will provide some simple examples of asynchronous programming. For more information about asynchronous programming<a id="_idIndexMarker166"/> and its related<a id="_idIndexMarker167"/> patterns, please check out <em class="italic">Task-Based Asynchronous Patterns</em> in the Microsoft documentation (<a href="https://docs.microsoft.com/en-us/dotnet/standard/asynchronous-programming-patterns/task-based-asynchronous-pattern-tap">https://docs.microsoft.com/en-us/dotnet/standard/asynchronous-programming-patterns/task-based-asynchronous-pattern-tap</a>).
    <div><p class="normal"><strong class="keyWord">TAP</strong> is the evolution<a id="_idIndexMarker168"/> of <strong class="keyWord">EAP</strong> (<strong class="keyWord">Event-Based Asynchronous Pattern</strong>), which, in turn, is<a id="_idIndexMarker169"/> the successor to <strong class="keyWord">APM</strong> (<strong class="keyWord">Asynchronous Programming Model Pattern</strong>).</p>
</div></li>
</ul>
</li>
</ul>
<p class="normal">No matter the option<a id="_idIndexMarker170"/> you choose, there are some dos and don’ts that, as a software <a id="_idIndexMarker171"/>architect, you must pay attention to. These are as follows:</p>
<ul>
<li class="bulletList"><strong class="keyWord">Do use concurrent collections</strong> (<code class="inlineCode">System.Collections.Concurrent</code>): As soon as you start a multithreading application, you have to use these collections. The reason for this is that your program will probably manage the same list, dictionary, and so on from different threads. The use of concurrent collections is the most convenient option for developing thread-safe programs.</li>
<li class="bulletList"><strong class="keyWord">Do worry about static variables</strong>: It is not possible to say that static variables are prohibited in multithreading development, but you should pay attention to them. Again, multiple threads taking care of the same variable can cause a lot of trouble. If you decorate a static variable with the <code class="inlineCode">[ThreadStatic]</code> attribute, each thread will see a different copy of that variable, hence solving the problem of several threads competing on the same value. However, <code class="inlineCode">ThreadStatic </code>variables cannot be used for extra-thread communications since values written by a thread cannot be read by other threads. In asynchronous programming, <code class="inlineCode">AsyncLocal&lt;T&gt;</code> is the option for doing something like that.</li>
<li class="bulletList"><strong class="keyWord">Do test system performance after multithreading implementations</strong>: Threads give you the ability to take full advantage of your hardware, but in some cases, badly written threads can waste CPU time just doing nothing! Similar situations may result in almost 100% CPU usage and unacceptable system slowdowns. In some cases, the problem can be mitigated or solved by adding a simple <code class="inlineCode">Thread.Sleep(1)</code> call in the main loop of some threads to prevent them from wasting too much CPU time, but you need to test this. A use case for this implementation is a Windows service with many threads running in the background.</li>
<li class="bulletList"><strong class="keyWord">Do not consider multithreading easy</strong>: Multithreading is not as simple as it seems in some syntax<a id="_idIndexMarker172"/> implementations. While<a id="_idIndexMarker173"/> writing a multithreading application, you should consider things such as the synchronization of the user interface, threading termination, and coordination. In many cases, programs just stop working well due to bad implementation of multithreading.</li>
<li class="bulletList"><strong class="keyWord">Do not forget to plan the number of threads your system should have</strong>: This is especially important for 32-bit programs. There is a limitation regarding how many threads you can have in any environment. You should consider this when you are designing your system.</li>
<li class="bulletList"><strong class="keyWord">Do not forget to end your threads</strong>: If you do not have the correct termination procedure for each thread, you will probably have trouble with memory and handling<a id="_idIndexMarker174"/> leaks.</li>
</ul>
<p class="normal">Scalability, performance tips, and multithreading<a id="_idIndexMarker175"/> are the main tools we can use to tune machine performance. However, the effectiveness of the system you design depends on the overall performance of the entire processing pipeline, which includes both humans and machines. For this reason, in the next section, we will discuss how to design effective user interfaces.</p>
<h1 class="heading-1" id="_idParaDest-55">Software usability: how to design effective user interfaces</h1>
<p class="normal">As a software architect, you cannot improve<a id="_idIndexMarker176"/> the performance of humans, but you can improve the performance of human-machine interaction by designing an effective <strong class="keyWord">user interface</strong> (<strong class="keyWord">UI</strong>), that is, a UI that ensures fast interaction with humans, which, in turn, means the following:</p>
<ul>
<li class="bulletList">The UI must be easy to learn to reduce the time that is needed for the target users to learn how to operate it. This constraint is fundamental if UI changes are frequent and for public websites that need to attract the greatest possible number of users.</li>
<li class="bulletList">The UI must not cause any kind of slowdown in data insertion; data entry speed must be limited only by the user’s ability to type, not by system delays or additional gestures that could be avoided.</li>
<li class="bulletList">Today, we must also consider the accessibility aspects of our solutions since doing so allows us to include more users.</li>
</ul>
<p class="normal">It is worth mentioning that we have UX experts in the market. As a software architect, you must decide when they are essential to the success of the project. The following are a few simple tips when it comes to designing <em class="italic">easy-to-learn</em> user interfaces:</p>
<ul>
<li class="bulletList">Each input screen must state its purpose clearly.</li>
<li class="bulletList">Use the language of the user, not the language of developers.</li>
<li class="bulletList">Avoid complications. Design the UI with the average case in mind; more complicated cases can be handled with extra inputs that appear only when needed. Split complex screens into more input steps.</li>
<li class="bulletList">Use past inputs to understand user intentions and to put users on the right path with messages and automatic UI changes, for instance, cascading drop-down menus.</li>
<li class="bulletList">Error messages are not bad notes that the system gives to the users who do something that’s wrong, but they must explain how to insert the correct input.</li>
</ul>
<p class="normal">Fast UIs result from efficacious solutions to the following three requirements:</p>
<ul>
<li class="bulletList">Input fields must be placed in the order they are usually filled, and it should be possible to move to the next input with the <em class="keystroke">Tab</em> or <em class="keystroke">Enter </em>key. Moreover, fields that often remain empty should be placed at the bottom of the form. Simply put, the usage of the mouse while filling in a form should be minimized. This way, the number of user gestures is kept to a minimum. In a web application, once the optimal placement of input fields has been decided, it is enough to use the <code class="inlineCode">tabindex</code> attribute to define the right way for users to move from one input field to the next with the <em class="keystroke">Tab</em> key.</li>
<li class="bulletList">System reactions to user input must be as fast as possible. Error messages (or information ones) must appear as soon as the user leaves the input field. The simplest way to achieve this is to move most of the help and input validation logic to the client side so that system reactions do not need to pass through both communication lines and servers.</li>
<li class="bulletList">Efficacious selection logic: Selecting an existing item should be as easy as possible; for example, selecting one out of some thousands of products in an offer must be possible with a few gestures and with no need to remember the exact product name or its barcode. The next subsection analyzes techniques we can use to decrease complexity to achieve fast selection.</li>
</ul>
<p class="normal">In <em class="chapterRef">Chapter 19</em><em class="italic">, Client Frameworks: Blazor</em>, we will discuss how<a id="_idIndexMarker177"/> this Microsoft technology can help us with the challenges of building web-based applications with C# code in the frontend.</p>
<h2 class="heading-2" id="_idParaDest-56">Designing fast selection logic</h2>
<p class="normal">When all possible choices<a id="_idIndexMarker178"/> are in the order of magnitude of 1-50, the usual drop-down menu is enough. For instance, take this currency selection drop-down menu:</p>
<figure class="mediaobject"><img alt="A picture containing calendar  Description automatically generated" src="img/B19820_02_18.png"/></figure>
<p class="packt_figref">Figure 2.18: Simple drop-down menu</p>
<p class="normal">When the order of magnitude is higher but less than a few thousand, an autocomplete that shows the names of all the items that start with the characters typed by the user is usually a good choice:</p>
<figure class="mediaobject"><img alt="Graphical user interface, text, application, chat or text message  Description automatically generated" src="img/B19820_02_19.png"/></figure>
<p class="packt_figref">Figure 2.19: Complex drop-down menu</p>
<p class="normal">A similar solution can be implemented with a low computational cost since all the main databases can efficiently select strings that start with a given substring.</p>
<p class="normal">When names are quite complex, when searching<a id="_idIndexMarker179"/> for the characters that were typed in by the user, they should be extended inside each item string. This operation cannot be performed efficiently with the usual databases and requires ad hoc data structures, nor can we forget the debouncing aspect that can happen while typing as a performance issue.</p>
<p class="normal">Finally, when we are searching inside descriptions composed of several words, more complex search patterns are needed. This is the case, for instance, with product descriptions. If the chosen database supports full-text search, the system can efficiently search for the occurrence of several words that have been typed by the user inside all the descriptions.</p>
<p class="normal">However, when descriptions are made up of names instead of common words, it might be difficult for the user to remember a few exact names contained in the target description. This happens, for instance, with multi-country company names. In these cases, we need algorithms that find the best match for the character that was typed by the user. Substrings of the string that was typed by the user must be searched in different places of each description. In general, similar algorithms cannot be implemented efficiently with databases based on indexes but require all the descriptions to be loaded in memory and ranked somehow against the string that was typed by the user.</p>
<p class="normal">The most famous algorithm<a id="_idIndexMarker180"/> in this class is probably the <strong class="keyWord">Levenshtein</strong> algorithm, which is used by most spellcheckers to find a word that best fits the one that was mistyped by the user. This algorithm minimizes the Levenshtein distance between the description and the string typed by the user, that is, the minimum number of character removals and additions needed to transform one string into another.</p>
<p class="normal">The Levenshtein algorithm<a id="_idIndexMarker181"/> works great but has a very high computational cost. Here, we use a faster algorithm that works well for searching character occurrences in descriptions. Characters typed by the user do not need to occur consecutively in the description but must occur in the same order. Some characters may be missing. Each description is given a penalty that depends on the missing characters and on how far the occurrences of the characters typed by the user are from the others.</p>
<p class="normal">More specifically, the algorithm ranks each description with two numbers:</p>
<ul>
<li class="bulletList">The number of characters typed by the user that occurs in the description: the more characters contained in the description, the higher its rank.</li>
<li class="bulletList">Each description is given a penalty equal to the total distance among the occurrences of the characters typed by the user in the description.</li>
</ul>
<p class="normal">The following screenshot shows how the word <strong class="screenText">Ireland</strong> is ranked against the string <strong class="screenText">ilad</strong>, which was typed by the user:</p>
<figure class="mediaobject"><img alt="A picture containing diagram  Description automatically generated" src="img/B19820_02_20.png"/></figure>
<p class="packt_figref">Figure 2.20: Sample of Levenshtein usage</p>
<p class="normal">The number of occurrences is four, while the total distance between character occurrences is three.</p>
<p class="normal">Once all the descriptions have been<a id="_idIndexMarker182"/> rated, they are sorted according to the number of occurrences. Descriptions with the same number of occurrences are sorted according to the lowest penalties. The following is an autocomplete that implements the preceding algorithm:</p>
<figure class="mediaobject"><img alt="Diagram  Description automatically generated with medium confidence" src="img/B19820_02_21.png"/></figure>
<p class="packt_figref">Figure 2.21: Levenshtein algorithm UI experience</p>
<p class="normal">The full class code, along with a test console<a id="_idIndexMarker183"/> project, is available in this book’s GitHub repository.</p>
<h2 class="heading-2" id="_idParaDest-57">Selecting from a huge number of items</h2>
<p class="normal">Here, <em class="italic">huge</em> does not refer to the amount of space needed to store the data but to the difficulty the user has in remembering the features of each item. When an item must be selected from among more than 10,000-100,000 items, there is no hope of finding it by searching for character occurrences inside a description. Here, the user must be driven toward the right item through a hierarchy of categories.</p>
<p class="normal">In this case, several user gestures are needed to perform a single selection. In other words, each selection requires interaction with several input fields. Once it is decided that the selection can’t be done with a single<a id="_idIndexMarker184"/> input field, the simplest option is cascading drop-down menus, that is, a chain of drop-down menus whose selection list depends on the values that were selected in the previous drop-down menus.</p>
<p class="normal">For example, if the user needs to select a town located anywhere in the world, we may use the first drop-down menu to select the country, and once the country has been chosen, we may use this choice to populate a second one with all the towns in the selected country. A simple example is as follows:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B19820_02_22.png"/></figure>
<p class="packt_figref">Figure 2.22: Cascading drop-down menu example</p>
<p class="normal">Clearly, each drop-down menu<a id="_idIndexMarker185"/> can be replaced by an autocomplete when required due to having a high number of options.</p>
<p class="normal">If making the right selection can be done by intersecting several different hierarchies, cascading drop-down menus become inefficient too, and we need<a id="_idIndexMarker186"/> a filter form, as follows:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B19820_02_23.png"/></figure>
<p class="packt_figref">Figure 2.23: Filter form sample</p>
<p class="normal">Now, let us understand interoperability with .NET 6.</p>
<h1 class="heading-1" id="_idParaDest-58">Interoperability with .NET 8</h1>
<p class="normal">Since .NET Core, Microsoft<a id="_idIndexMarker187"/> has brought to C# developers the ability to deliver their software to various platforms. And you, as a software architect, need to pay attention to this, considering developing for Linux and macOS as a great opportunity to deliver new features to your customers. Therefore, we need to ensure performance and multi-platform support, two common non-functional requirements for many systems.</p>
<p class="normal">Both console applications and web apps designed with .NET 8 in Windows are almost completely compatible with Linux and macOS, too. This means you do not have to build the app again to run it on these platforms.</p>
<div><p class="normal">Microsoft offers scripts<a id="_idIndexMarker188"/> to help you install .NET on Linux and macOS. You can find them at <a href="https://docs.microsoft.com/dotnet/core/tools/dotnet-install-script">https://docs.microsoft.com/dotnet/core/tools/dotnet-install-script</a>. Once you have the SDK installed, you just need to call <code class="inlineCode">dotnet</code> the same way you do in Windows.</p>
</div>
<p class="normal">However, you must be aware<a id="_idIndexMarker189"/> of some features that are not fully compatible with Linux and macOS systems. For instance, no equivalent to the Windows Registry exists in these OSes, and you must develop an alternative yourself. If needed, an encrypted JSON config file can be a good option.</p>
<p class="normal">Another important point is that Linux is case-sensitive, while Windows is not. Please remember this when you work with files. Another important thing is that the Linux path separator is different from the Windows separator. You can use the <code class="inlineCode">Path.PathSeparator</code> field and all the other <code class="inlineCode">Path</code> class members to ensure your code is multi-platform. <code class="inlineCode">Environment.NewLine</code> can also be useful in some situations.</p>
<p class="normal">Besides, you can also adapt your code to the underlying OS by using the runtime checks provided by .NET 8, as follows:</p>
<pre class="programlisting code"><code class="hljs-code">using System.Runtime.InteropServices;
if (RuntimeInformation.IsOSPlatform(OSPlatform.Windows))
	Console.WriteLine("Here you have Windows World!");
else if(RuntimeInformation.IsOSPlatform(OSPlatform.Linux))
	Console.WriteLine("Here you have Linux World!");
else if (RuntimeInformation.IsOSPlatform(OSPlatform.OSX))
	Console.WriteLine("Here you have macOS World!");
</code></pre>
<h2 class="heading-2" id="_idParaDest-59">Tip – creating a service in Linux</h2>
<p class="normal">There are some good ways to create a service<a id="_idIndexMarker190"/> when you are developing<a id="_idIndexMarker191"/> on Windows, but how can we get the same result if we are developing for the Linux platform? The following script can be used to encapsulate a command-line .NET 8 app in Linux. The idea is that this service works like a Windows service. This can be useful, considering that most Linux installations are command-line-only and run without a user logged in:</p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1">The first step is to create a file that will run the command-line app. The name of the app is <code class="inlineCode">app.dll</code>, and it is installed in <code class="inlineCode">appfolder</code>. The application will be checked every 5,000 milliseconds. This service was created on a CentOS 7 system. Using a Linux terminal, you can type this:
        <pre class="programlisting con"><code class="hljs-con">cat &gt;sample.service&lt;&lt;EOF
[Unit]
Description=Your Linux Service
After=network.target
[Service]
ExecStart=/usr/bin/dotnet $(pwd)/appfolder/app.dll 5000
Restart=on-failure
[Install]
WantedBy=multi-user.target
EOF
</code></pre>
</li>
<li class="numberedList">Once the file has been created, you must copy the service file to a system location. After that, you must reload the system and enable the service so that it will restart on reboots:
        <pre class="programlisting con"><code class="hljs-con">sudo cp sample.service /lib/systemd/system
sudo systemctl daemon-reload
sudo systemctl enable sample
</code></pre>
</li>
<li class="numberedList">Done! Now, you can start, stop, and check the service using the following commands. The whole input<a id="_idIndexMarker192"/> that you need to provide in your command-line app<a id="_idIndexMarker193"/> is as follows:
        <pre class="programlisting con"><code class="hljs-con"># Start the service
sudo systemctl start sample
# View service status
sudo systemctl status sample
# Stop the service
sudo systemctl stop sample
</code></pre>
</li>
</ol>
<p class="normal">Now that we have learned about a few concepts, let us learn how to implement them in our use case.</p>
<h1 class="heading-1" id="_idParaDest-60">Achieving security by design</h1>
<p class="normal">As we have seen up to this point<a id="_idIndexMarker194"/> in the book, the opportunities and techniques we have for developing software are incredible. If you add all the information you will read about in relation to cloud computing in the next chapters, you will see that the opportunities just increase, as does the complexity involved in maintaining this computing environment.</p>
<p class="normal">As a software architect, you must understand that these opportunities come with many responsibilities. The world has changed a lot in recent years. The second decade of the 21st century has required lots of technology. Apps, social media, Industry 4.0, big data, and artificial intelligence are no longer future objectives but current projects that you will lead and deal with within your daily routine. However, the third decade of our century will require much more attention when it comes to cybersecurity.</p>
<p class="normal">The world now regulates companies that manage personal data. For instance, the GDPR – the General Data Protection Regulation – is mandatory not only for European territory but also for the whole world; it has changed the way software is developed. There are many initiatives comparable to the GDPR that must be added to your glossary of techniques and regulations, considering that the software you design will be impacted by them.</p>
<p class="normal">Security by design must be one of your areas of focus for designing new applications. This subject is huge, and it is not going to be completely covered in this book, but as a software architect, you must understand the necessity of having a specialist in the information security area in your team to guarantee the policies and practices needed to avoid cyber-attacks and maintain the confidentiality, privacy, integrity, authenticity, and availability of the services you architect.</p>
<p class="normal">When it comes to protecting your ASP.NET Core application, it is worth mentioning that the framework has many features to help you out with that. For instance, it includes authentication and authorization patterns. In the OWASP Cheat Sheet Series, you can read about many other .NET practices.</p>
<div><p class="normal">The <strong class="keyWord">Open Web Application Security Project</strong>® (<strong class="keyWord">OWASP</strong>) is a nonprofit foundation that works to improve<a id="_idIndexMarker195"/> the security of software. Check it out at <a href="https://owasp.org/">https://owasp.org/</a>.</p>
</div>
<p class="normal">ASP.NET Core also provides features to help us out with the GDPR. Basically, there are APIs and templates to guide<a id="_idIndexMarker196"/> you in the implementation of policy declaration and cookie usage consent.</p>
<h2 class="heading-2" id="_idParaDest-61">List of practices for achieving a safe architecture</h2>
<p class="normal">The following list of practices<a id="_idIndexMarker197"/> related to security certainly does not cover the entirety of the subject. However, these practices will help you, as a software architect, to explore some solutions related to this topic.</p>
<h2 class="heading-2" id="_idParaDest-62">Authentication</h2>
<p class="normal">Define an authentication method<a id="_idIndexMarker198"/> for your web app. There are many authentication options available nowadays, from ASP.NET Core Identity to external provider authentication methods, such as Facebook or Google. As a software architect, you must consider who the target audience of the application is. It would also be worth considering using Azure <strong class="screenText">Active Directory</strong> (<strong class="screenText">AD</strong>) as a starting point if you choose to go down this route.</p>
<p class="normal">You may find it useful to design authentication associated with Azure AD, a component for managing the Active Directory of the company you are working for. This alternative is pretty good<a id="_idIndexMarker199"/> in some scenarios, especially<a id="_idIndexMarker200"/> for internal usage. Azure currently offers Active Directory for usage as <strong class="keyWord">B2B</strong> (<strong class="keyWord">Business to Business</strong>) or <strong class="keyWord">B2C</strong> (<strong class="keyWord">Business to Consumer</strong>).</p>
<p class="normal">Depending on the scenario<a id="_idIndexMarker201"/> of the solution you are building, you might need to implement <strong class="keyWord">MFA</strong> – <strong class="keyWord">Multi-Factor Authentication</strong>. The idea of this pattern is to ask for at least two forms of proof of identity before allowing the solution to be used. It is worth mentioning that Azure AD facilitates this for you.</p>
<p class="normal">You may also find it useful to implement authentication to your platform<a id="_idIndexMarker202"/> using as basis <strong class="keyWord">Microsoft Identity Platform</strong>. In this case, the usage of the <strong class="keyWord">Microsoft Authentication Library</strong> (<strong class="keyWord">MSAL</strong>) will facilitate your<a id="_idIndexMarker203"/> work hugely. Check how to implement it by reading its documentation at <a href="https://learn.microsoft.com/en-us/azure/active-directory/develop/msal-overview">https://learn.microsoft.com/en-us/azure/active-directory/develop/msal-overview</a>.</p>
<p class="normal">Do not forget that you must determine an authentication method for the APIs you provide. JSON Web Token is a pretty good pattern, and its usage is totally cross-platform.</p>
<p class="normal">You must determine the authorization model you will use in your web app. There are four model options:</p>
<ul>
<li class="bulletList"><strong class="keyWord">Simple</strong>, where you just use the <code class="inlineCode">[Authorize]</code> attribute in the class or method.</li>
<li class="bulletList"><strong class="keyWord">Role-based</strong>, in which you may declare <code class="inlineCode">Roles</code> for accessing the <code class="inlineCode">Controller</code> you are developing.</li>
<li class="bulletList"><strong class="keyWord">Claims-based</strong>, where you can define values that must be received during the authentication to indicate that the user is authorized.</li>
<li class="bulletList"><strong class="keyWord">Policy-based</strong>, in which there is a policy established to define the access in that <code class="inlineCode">Controller</code>.</li>
</ul>
<p class="normal">You may also define a controller or method in a class as being fully accessible to any user by defining the <code class="inlineCode">[AllowAnonymous] </code>attribute. Be sure this kind of implementation will not cause any vulnerabilities<a id="_idIndexMarker204"/> in the system you are designing.</p>
<p class="normal">The model you decide to use will define exactly what each user will be able to do in the application.</p>
<h2 class="heading-2" id="_idParaDest-63">Sensitive data</h2>
<p class="normal">While designing, you, as a software<a id="_idIndexMarker205"/> architect, will have to decide which part of the data you store is sensitive, and it will need to be protected. By connecting to Azure, your web app will be able to store protected data in components such as Azure Storage and Azure Key Vault. Storage in Azure will be discussed in <em class="chapterRef">Chapter 12</em>, <em class="italic">Choosing Your Data Storage in the Cloud</em>.</p>
<div><p class="normal">It is highly recommended to check the <strong class="keyWord">Data Protection Framework</strong> that your solution will need to deal with, considering where it will be placed.</p>
</div>
<p class="normal">It is worth mentioning<a id="_idIndexMarker206"/> that Azure Key Vault is used to protect secrets your app may have. Consider using this solution when you have this kind of requirement.</p>
<h2 class="heading-2" id="_idParaDest-64">Web security</h2>
<p class="normal">It is totally unacceptable<a id="_idIndexMarker207"/> to have a production solution deployed without the HTTPS protocol enabled. Azure Web Apps and ASP.NET Core solutions have various options to not only use but enforce the usage of this security protocol.</p>
<p class="normal">There are many known attacks and malicious patterns, such as cross-site request forgery, open redirect, and cross-site scripting. ASP.NET Core provides APIs to solve them. You need to find the ones that are useful for your solution.</p>
<p class="normal">Good programming practices, such as avoiding SQL injection by using parameters in your queries, is another important goal to achieve.</p>
<div><p class="normal">You may find cloud<a id="_idIndexMarker208"/> architecture security patterns at <a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/category/security">https://docs.microsoft.com/en-us/azure/architecture/patterns/category/security</a>.</p>
</div>
<p class="normal">To finish, it is worth mentioning that security needs to be treated using the onion approach, which means that there are many layers of security to be implemented. You must have determined a policy to guarantee a process to access the data, including physical access for people who use the system you are developing. In addition, you also must develop a disaster recovery solution in case the system is attacked. The disaster recovery solution will depend on your cloud solution. We will discuss this later, in <em class="chapterRef">Chapter 10</em>, <em class="italic">Deciding on the Best Cloud-Based Solution</em>.</p>
<h1 class="heading-1" id="_idParaDest-65">Summary</h1>
<p class="normal">Functional requirements that describe system behavior must be complemented with non-functional requirements that constrain system performance, scalability, availability, resilience, interoperability, usability, and security.</p>
<p class="normal">Performance requirements come from response time and system load requirements. As a software architect, you should ensure you have the required performance at the minimum cost, building efficient algorithms and taking full advantage of the available hardware resources with multithreading.</p>
<p class="normal">Scalability is the ability of a system to be adapted to an increasing load. Systems can be scaled vertically by providing more powerful hardware or horizontally by replicating and load balancing the same hardware, which increases the availability. The cloud, in general, and Azure can help us implement strategies dynamically, with no need to stop your application.</p>
<p class="normal">Tools such as .NET 8 that run on several platforms can ensure interoperability, that is, the capability of your software to run on different target machines and with different operating systems (Windows, Linux, macOS, Android, and so on).</p>
<p class="normal">Usability is ensured by taking care of input field order, the effectiveness of the item selection logic, and how easy your system is to learn.</p>
<p class="normal">Besides, the more complex your solution is, the better resilience it should have. The idea of resilience is not to guarantee that the solution does not fail. Instead, the idea is to guarantee that the solution has an action defined when each part of the software fails.</p>
<p class="normal">As a software architect, you must consider security from the very beginning of the design. Following the guidelines to determine the correct patterns and having a security specialist on your team is the best way to comply with all the current regulations we have.</p>
<p class="normal">In the next chapter, you will learn how Azure DevOps and GitHub can help us when it comes to collecting, defining, and documenting our requirements.</p>
<h1 class="heading-1" id="_idParaDest-66">Questions</h1>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1">What are the two conceptual ways to scale a system?</li>
<li class="numberedList">Can you deploy your web app automatically from Visual Studio to Azure?</li>
<li class="numberedList">What is multithreading useful for?</li>
<li class="numberedList">What are the main advantages of the asynchronous pattern over other multithreading techniques?</li>
<li class="numberedList">Why is the order of input fields so important?</li>
<li class="numberedList">Why is the <code class="inlineCode">Path</code> class so important for interoperability?</li>
<li class="numberedList">What is the advantage of a .NET standard class library?</li>
<li class="numberedList">List the <em class="italic">most-used</em> types of .NET Visual Studio projects.</li>
</ol>
<h1 class="heading-1" id="_idParaDest-67">Further reading</h1>
<p class="normal">The following are some books and links you may consider reading to gather more information in relation to this chapter:</p>
<ul>
<li class="bulletList">Cloud computing models<ul>
<li class="bulletList"><a href="https://docs.microsoft.com/en-us/azure/architecture/best-practices/auto-scaling">https://docs.microsoft.com/en-us/azure/architecture/best-practices/auto-scaling</a></li>
<li class="bulletList"><a href="https://docs.microsoft.com/en-us/aspnet/core/host-and-deploy/azure-apps/">https://docs.microsoft.com/en-us/aspnet/core/host-and-deploy/azure-apps/</a></li>
</ul>
</li>
<li class="bulletList">Parallel programming<ul>
<li class="bulletList"><a href="https://docs.microsoft.com/en-us/dotnet/standard/parallel-processing-and-concurrency">https://docs.microsoft.com/en-us/dotnet/standard/parallel-processing-and-concurrency</a></li>
<li class="bulletList"><a href="https://docs.microsoft.com/en-us/dotnet/standard/parallel-programming/">https://docs.microsoft.com/en-us/dotnet/standard/parallel-programming/</a></li>
</ul>
</li>
<li class="bulletList">Performance improvements in .NET<ul>
<li class="bulletList"><a href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-8/">https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-8/</a></li>
<li class="bulletList"><a href="https://benchmarkdotnet.org/">https://benchmarkdotnet.org/</a></li>
</ul>
</li>
<li class="bulletList">Security aspects<ul>
<li class="bulletList"><a href="https://docs.microsoft.com/en-us/aspnet/core/security/">https://docs.microsoft.com/en-us/aspnet/core/security/</a></li>
<li class="bulletList"><a href="https://cheatsheetseries.owasp.org/cheatsheets/DotNet_Security_Cheat_Sheet.html">https://cheatsheetseries.owasp.org/cheatsheets/DotNet_Security_Cheat_Sheet.html</a></li>
<li class="bulletList"><a href="https://docs.microsoft.com/en-us/aspnet/core/security/gdpr">https://docs.microsoft.com/en-us/aspnet/core/security/gdpr</a></li>
<li class="bulletList"><a href="https://learn.microsoft.com/en-us/azure/active-directory/develop/msal-overview">https://learn.microsoft.com/en-us/azure/active-directory/develop/msal-overview</a></li>
</ul>
</li>
<li class="bulletList">Service consistency aspects<ul>
<li class="bulletList"><a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/category/resiliency">https://docs.microsoft.com/en-us/azure/architecture/patterns/category/resiliency</a></li>
<li class="bulletList"><a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/category/availability">https://docs.microsoft.com/en-us/azure/architecture/patterns/category/availability</a></li>
</ul>
</li>
<li class="bulletList">Dotnet support<ul>
<li class="bulletList"><a href="https://dotnet.microsoft.com/platform/support/policy">https://dotnet.microsoft.com/platform/support/policy</a></li>
</ul>
</li>
</ul>
<h1 class="heading-1">Learn more on Discord</h1>
<p class="normal">To join the Discord community for this book – where you can share feedback, ask questions to the authors, and learn about new releases – follow the QR code below:</p>
<p class="normal"><a href="https://packt.link/SoftwareArchitectureCSharp12Dotnet8">https://packt.link/SoftwareArchitectureCSharp12Dotnet8</a></p>
<p class="normal"><img alt="" role="presentation" src="img/QR_Code175081751210902046.png"/></p>
</div>
</body></html>