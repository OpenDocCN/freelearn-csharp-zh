<html><head></head><body><div class="chapter" title="Chapter&#xA0;8.&#xA0;Moving to BizTalk Services"><div class="titlepage"><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Moving to BizTalk Services</h1></div></div></div><p>In this final chapter, we will discuss how to move to BizTalk Services. All through this book, we've looked at the new features of BizTalk Services and what they enable, but the likelihood is that you'll be wanting to move existing solutions to BizTalk Services. As you're reading this book, we'll make a further assumption that you want to know more about moving BizTalk Server solutions on-premises to BizTalk Services.</p><p>In this chapter, we'll look at the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">What's available to help move BizTalk Server solutions to BizTalk Services</li><li class="listitem" style="list-style-type: disc">How to deal with differences between the products</li><li class="listitem" style="list-style-type: disc">Future plans for BizTalk Services</li></ul></div><p>By the end of this chapter, you should have a good understanding of how to tackle moving the existing BizTalk Server solutions to BizTalk Services and what is planned in the evolution of BizTalk Services to make this even easier.</p><div class="section" title="Moving from BizTalk Server"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec67"/>Moving from BizTalk Server</h1></div></div></div><p>BizTalk Server consists of a number of architectural components, only some of which have parity in BizTalk Services. These are listed in the following table, which shows the comparison of BizTalk Server and BizTalk Services:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>BizTalk Server</p>
</th><th style="text-align: left" valign="bottom">
<p>BizTalk Services</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Map</p>
</td><td style="text-align: left" valign="top">
<p>Transform</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Pipeline</p>
</td><td style="text-align: left" valign="top">
<p>Bridge</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Business Rules Engine</p>
</td><td style="text-align: left" valign="top">
<p>No equivalent / custom coding needed</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Business Activity Monitoring</p>
</td><td style="text-align: left" valign="top">
<p>No equivalent / custom coding needed</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Orchestration</p>
</td><td style="text-align: left" valign="top">
<p>Workflow outside of service</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Adapters</p>
</td><td style="text-align: left" valign="top">
<p>Bridge sources and destinations</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Schema</p>
</td><td style="text-align: left" valign="top">
<p>Schema</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Tracking</p>
</td><td style="text-align: left" valign="top">
<p>Tracking</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Trading Partner Management</p>
</td><td style="text-align: left" valign="top">
<p>Trading Partner Management</p>
</td></tr></tbody></table></div><p>As you can see from the preceding table, there are a number of functional differences between BizTalk Services v1.0 and BizTalk Server. This is to be expected, as BizTalk Server is an established, mature product that was first shipped in 2000; it has received numerous updates over time. BizTalk Services, on the other hand, was GA'd (released for general availability) on November 21, 2013. However, all is certainly not lost, as there are several ways to mitigate the effort of moving from one to the other. In the following sections, we'll look at the different types of artifacts in a BizTalk Server solution and how to migrate to BizTalk Services.</p><div class="section" title="Maps"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec48"/>Maps</h2></div></div></div><p><a class="link" href="ch02.html" title="Chapter 2. Messages and Transforms">Chapter 2</a>, <span class="emphasis"><em>Messages and Transforms</em></span>, covered mapping in detail and mentioned <a id="id447" class="indexterm"/>a tool we'll look at more closely here. First though, let's answer<a id="id448" class="indexterm"/> the question of whether you even need a tool.</p><p>BizTalk Server provides the ability to run custom <span class="strong"><strong>Extensible Stylesheet Language Transformations</strong></span> (<span class="strong"><strong>XSLT</strong></span>)—just provide the path to an XSLT template file and the map contents<a id="id449" class="indexterm"/> are ignored. Maps written in this way do not need the conversion tool as you can simply take the XSLT and configure it in the same way in a BizTalk Services transform.</p><p>The functional equivalent of maps in BizTalk are transforms in BizTalk Services, as you have already seen. The implementation of these technologies is, however, very different, and it is not possible to execute BizTalk Server maps in BizTalk Services.</p><p>Microsoft has released a conversion tool that takes a BizTalk map, a <code class="literal">.btm</code> file, as the input, and outputs a BizTalk Services transform file, <code class="literal">.trfm</code>. Let's see how this works.</p><p>In <a class="link" href="ch02.html" title="Chapter 2. Messages and Transforms">Chapter 2</a>, <span class="emphasis"><em>Messages and Transforms</em></span>, we looked at a BizTalk Services transform and the source and target schemas for it. Here, we'll revisit these schemas and look at the equivalent original BizTalk Server map. This is shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7401EN_08_01.jpg" alt="Maps"/><div class="caption"><p>A BizTalk Server map</p></div></div><p>The<a id="id450" class="indexterm"/> conversion tool is part of the BizTalk Services SDK available <a id="id451" class="indexterm"/>at <a class="ulink" href="http://www.microsoft.com/en-us/download/details.aspx?id=39087">http://www.microsoft.com/en-us/download/details.aspx?id=39087</a>. Select the <code class="literal">Tools.zip</code> download and unzip it on your<a id="id452" class="indexterm"/> local machine. This is a command-line-driven tool, so here, I'll open a command window as shown in the following screenshot. The executable takes only two parameters: the path to the BizTalk <code class="literal">.btm</code> file and the output <code class="literal">.trfm</code> file (which is actually optional).</p><div class="mediaobject"><img src="graphics/7401EN_08_02.jpg" alt="Maps"/><div class="caption"><p>The BizTalk map conversion tool</p></div></div><p>The resultant BizTalk Services transform is shown in the following screenshot. Running this yields exactly the same output as the transform we created in <a class="link" href="ch02.html" title="Chapter 2. Messages and Transforms">Chapter 2</a>, <span class="emphasis"><em>Messages and Transforms</em></span>.</p><div class="mediaobject"><img src="graphics/7401EN_08_03.jpg" alt="Maps"/><div class="caption"><p>A converted map</p></div></div><p>As you've<a id="id453" class="indexterm"/> just seen, the conversion tool is a useful way to reuse existing <a id="id454" class="indexterm"/>maps in BizTalk Services. It is often the case that a large investment has been made in BizTalk maps, and this tool allows them to be converted with minimal effort in many cases. However, the tool is not without a few limitations that will require some rework to the resultant transforms.</p><p>One fix that may be required to the generated transform if it won't load correctly is to change the ID values in the file as it can sometimes emit duplicates. When you attempt to open the map in Visual Studio, you may see the error shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7401EN_08_04.jpg" alt="Maps"/><div class="caption"><p>The mapping error message</p></div></div><p>This <a id="id455" class="indexterm"/>should be a simple case of finding the ID that is flagged <a id="id456" class="indexterm"/>as a duplicate when you try and open the transform and substituting its value with a new, unique one. If the ID refers to a script, there will be at least two places where the duplicate ID will need to be changed. An example is shown in the following code where the contents of the <code class="literal">Value</code> tag contain a duplicate ID. Changing this to a unique value, for example, <code class="literal">14</code>, will fix this in the sample accompanying this chapter.</p><div class="informalexample"><pre class="programlisting">&lt;a1:KeyValueOfstringanyType&gt;
   &lt;a1:Key&gt;Id&lt;/a1:Key&gt;
   &lt;a1:Value i:type="xs:int"&gt;13&lt;/a1:Value&gt;
&lt;/a1:KeyValueOfstringanyType&gt;</pre></div><p>Generally, if the tool cannot convert the map, it will convert as much as it can and substitute functoids that cannot be converted with an arithmetic expression functoid in the transform. This will be empty and therefore won't compile to indicate that you need to review it. If a functoid conversion is not possible, the equivalent functoid in the transform will have no inputs to it, again to indicate that something has not been converted. A full list of current limitations is provided in the <code class="literal">ReadMe.txt</code> file in the same location as the tool itself.</p><p>The tool emits a logfile indicating the steps it took to convert the map. The <code class="literal">Log.txt</code> file will be written to the folder in which the tool was run in the command line.</p></div><div class="section" title="Pipelines"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec49"/>Pipelines</h2></div></div></div><p>Pipelines<a id="id457" class="indexterm"/> in BizTalk Server are used to process data between<a id="id458" class="indexterm"/> adapters and the MessageBox. This requirement is now provided by bridges in BizTalk Services. We've covered bridges in detail elsewhere in this book (<a class="link" href="ch03.html" title="Chapter 3. Bridges">Chapter 3</a>, <span class="emphasis"><em>Bridges</em></span> and <a class="link" href="ch04.html" title="Chapter 4. Enterprise Application Integration">Chapter 4</a>, <span class="emphasis"><em>Enterprise Application Integration</em></span>). You should find that usage of bridges and the ability to deploy custom code in them provides most of the functionality you would encounter with the pipelines and custom pipeline components. The BizTalk Services standard bridge stages match quite closely to those of BizTalk Server, as illustrated in the following table:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>BizTalk Server stage</p>
</th><th style="text-align: left" valign="bottom">
<p>BizTalk Services stage</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Receive: Decode</p>
</td><td style="text-align: left" valign="top">
<p>Enrich (1)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Receive: Disassemble</p>
</td><td style="text-align: left" valign="top">
<p>Message Type / Enrich (2)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Receive: Validate</p>
</td><td style="text-align: left" valign="top">
<p>Validate</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Receive: ResolveParty</p>
</td><td style="text-align: left" valign="top">
<p>N/A</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Send: Pre-assemble</p>
</td><td style="text-align: left" valign="top">
<p>Enrich (1)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Send: Assemble</p>
</td><td style="text-align: left" valign="top">
<p>Enrich (2)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Send: Encode</p>
</td><td style="text-align: left" valign="top">
<p>Send Reply</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Receive and Send: Port maps</p>
</td><td style="text-align: left" valign="top">
<p>Transform stage</p>
</td></tr></tbody></table></div><p>If the <a id="id459" class="indexterm"/>stages in the preceding table seem a little arbitrary, it's <a id="id460" class="indexterm"/>because they are. Just as in BizTalk Server it was perfectly possible to do everything in a single stage (depending on which stage it is of course), so is the case with BizTalk Services. While BizTalk Services doesn't have the concept of pipeline components, it provides enough stage placeholders for your own code and, of course, provides many of the things out of the box for which you'd have traditionally written a custom pipeline component anyway, such as property promotion. Even though BizTalk Server provides four receive pipeline stages, and in fact, pipeline stages are actually configurable (you can define your own), no one really has ever bothered with that and nearly all solutions just use the decode and validate stages (if that). The send pipeline is even less important, but again, BizTalk Services provides a similar mirror image of stages in which you are able to perform work with the messages flowing through should you need to.</p><p>All this being said, it should be clear that if you encounter a solution that has custom pipeline components, you have some work to do, that is, to try and convert to BizTalk Services.</p></div><div class="section" title="Schema"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec50"/>Schema</h2></div></div></div><p>Schema<a id="id461" class="indexterm"/> support is largely the same in BizTalk Services, and <a id="id462" class="indexterm"/>generally, you should not encounter too many issues moving your schemas between the two. There are some notable exceptions such as the ability to pass multiple schemas into BizTalk Server maps, which is currently not possible with BizTalk Services, but generally, schemas can be reused in a straightforward manner.</p></div><div class="section" title="Adapters"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec51"/>Adapters</h2></div></div></div><p>BizTalk <a id="id463" class="indexterm"/>Services shares the same concept of adapters, albeit with <a id="id464" class="indexterm"/>a much smaller set. Additionally, BizTalk Services provides two approaches to integration: sources and destinations for a bridge as well as the BizTalk Adapter Service, which uses the Service Bus relay to pass messages to an Internet Information Services (IIS)-hosted Line of Business (LOB) adapter (actually, the same LOB adapters BizTalk ships with). Therefore, if the adapters your BizTalk Server solution needs are represented in the BizTalk Services set, the conversion is straightforward. However, there are hundreds of adapters available for BizTalk Server and a dozen or so for BizTalk Services, so clearly, there are some gaps. Some just won't make sense for a cloud-hosted platform (for example, the much-loved File adapter), but for others, this could present a problem.</p><p>Microsoft recognizes this potential issue and will, of course, seek to introduce new sources and destinations over time based on customer feedback. Microsoft is also planning to open up the architecture to provide an adapter SDK to enable you (or third parties) to build your own, thus offering another solution. Therefore, over time, this problem is likely to diminish.</p></div><div class="section" title="Trading Partner Management (TPM)"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec52"/>Trading Partner Management (TPM)</h2></div></div></div><p>BizTalk<a id="id465" class="indexterm"/> Server uses TPM to define<a id="id466" class="indexterm"/> and manage EDI trading partners. Organizations that use BizTalk's EDI capabilities will likely have hundreds or even thousands of trading partners set up in BizTalk and will want a way to migrate these partners to BizTalk Services if they wish to adopt it.</p><p>BizTalk Services takes the same approach to partner management as BizTalk, and changes made in BizTalk Server 2010 to the TPM model and schema were adopted in BizTalk Services. What this means is that the two are actually very similar and migration can be accomplished in a couple of ways.</p><p>For existing BizTalk Server users, the TPM Data Migration Tool is provided by Microsoft. This is included in the same <code class="literal">Tools.zip</code> download as the map conversion tool discussed earlier, and it is capable of migrating the TPM data from either BizTalk Server 2010 or 2013.</p><p>The BizTalk Server management console is shown in the following screenshot. Here, you can see two parties and an agreement that we want to migrate to BizTalk Services.</p><div class="mediaobject"><img src="graphics/7401EN_08_05.jpg" alt="Trading Partner Management (TPM)"/><div class="caption"><p>The BizTalk Server management console</p></div></div><p>To <a id="id467" class="indexterm"/>launch it, double-click on<a id="id468" class="indexterm"/> <code class="literal">TPMMigration.exe</code> and the application will appear as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7401EN_08_06.jpg" alt="Trading Partner Management (TPM)"/><div class="caption"><p>The TPM Data Migration Tool</p></div></div><p>The tool takes the SQL Server machine name for where the BizTalk Server management database resides and the ACS connection details for BizTalk Services as the input. It then displays<a id="id469" class="indexterm"/> the available partners to<a id="id470" class="indexterm"/> migrate as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7401EN_08_07.jpg" alt="Trading Partner Management (TPM)"/><div class="caption"><p>Selecting partners to migrate</p></div></div><p>Here, I've picked the two partners from the BizTalk Server management console. Clicking on <span class="strong"><strong>Next</strong></span> then displays the agreements. I only have one, shown in the following screenshot, which is between the two parties, so selecting this and clicking on <span class="strong"><strong>Next</strong></span> will start the process of moving the partners and agreements to BizTalk Services:</p><div class="mediaobject"><img src="graphics/7401EN_08_08.jpg" alt="Trading Partner Management (TPM)"/><div class="caption"><p>Selecting agreements</p></div></div><p>Once<a id="id471" class="indexterm"/> the partners and agreements<a id="id472" class="indexterm"/> have been created in BizTalk Services, a <span class="strong"><strong>Summary</strong></span> page details the work completed, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7401EN_08_09.jpg" alt="Trading Partner Management (TPM)"/><div class="caption"><p>The migration summary</p></div></div><p>Now, looking<a id="id473" class="indexterm"/> in the BizTalk<a id="id474" class="indexterm"/> Services portal, we can see that the partners and agreement have been created, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7401EN_08_10.jpg" alt="Trading Partner Management (TPM)"/><div class="caption"><p>The BizTalk Services portal</p></div></div><p>The<a id="id475" class="indexterm"/> tool should be able to migrate<a id="id476" class="indexterm"/> all the parties and agreements you have set up in BizTalk Server. The one limitation the tool has is that it won't move the certificates that you use to secure the conversations between your organization and the trading partners. These need to be migrated manually.</p><p>The TPM Data Migration Tool is useful when moving from BizTalk Server 2010/2013 to BizTalk Services. However, another option exists if you need to move from a different product or an earlier version of BizTalk Server. This option is also a useful approach if you want to programmatically create trading partners perhaps, from a custom application or via integration with another product. This approach uses the TPM API. In fact, the migration tool leverages this API as well to do its jobs.</p><p>Previously, the API that TPM used was not documented, and as such, customers were not supported if they wished to create trading partners in BizTalk programmatically. This is no longer the case. Microsoft has now published the API on MSDN, thus allowing customers to leverage it in a supported way.</p><p>The BizTalk Services TPM API is documented at the following location:</p><p><a class="ulink" href="http://msdn.microsoft.com/en-us/library/windowsazure/dn232369.aspx">http://msdn.microsoft.com/en-us/library/windowsazure/dn232369.aspx</a></p><p>In order to call the TPM API, an OAuth WRAP token is necessary for authentication. This token is simply a string consisting of the following pieces of information:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">User name: <code class="literal">owner</code></li><li class="listitem" style="list-style-type: disc">Password: Issuer Key from ACS</li><li class="listitem" style="list-style-type: disc">BizTalk Services endpoint name: <code class="literal">https://&lt;yourservice&gt;.biztalk.windows.net/</code></li></ul></div><p>The<a id="id477" class="indexterm"/> process of calling the API is made <a id="id478" class="indexterm"/>up of two steps. First, POST a WRAP request and receive a WRAP token, which is then passed in on subsequent requests. The API is REST-based just like the other APIs we looked at in <a class="link" href="ch06.html" title="Chapter 6. API">Chapter 6</a>, <span class="emphasis"><em>API</em></span>. It is harder (although not impossible) to invoke them in Fiddler (or the browser) because of the OAuth requirement (as opposed to mutual certificate authentication). Therefore, let's look at the code necessary to retrieve a list of partners as an example.</p><p>The following code will call Azure with the WRAP request and obtain a token:</p><div class="informalexample"><pre class="programlisting">string nameSpace = "&lt;your WABS  namespace&gt;"; // WABS namespace
string defaultIssuer = "owner"; // WABS issuer - usually "owner"
string defaultKey = "&lt;your WABS key&gt;"; // WABS issuer key
string serviceName = "gettingstartedwabs";
string address = string.Format((IFormatProvider)CultureInfo.InvariantCulture, "https://{0}.{1}/{2}/",
nameSpace, "accesscontrol.windows.net", "WRAPv0.9");
string payload = string.Format((IFormatProvider) CultureInfo.InvariantCulture,
"wrap_name={0}&amp;wrap_password={1}&amp;wrap_scope={2}", defaultIssuer,
                Uri.EscapeDataString(defaultKey),
                Uri.EscapeDataString("http://" + serviceName + ".biztalk.windows.net/default/$PartnerManagement/Partners"));
            HttpContent content = new StringContent(payload);
            content.Headers.ContentType.MediaType = "application/x-www-form-urlencoded";
using (var client = new HttpClient())
{
   // get WRAP token
   var response = await client.PostAsync(address, content);
   response.EnsureSuccessStatusCode();
   string token = await response.Content.ReadAsStringAsync();
   token = Uri.UnescapeDataString(token.Split('&amp;')[0]);
}</pre></div><p>This is quite straightforward. There are four pieces of information required. To obtain the ACS details for your BizTalk Services instance, go to the Azure portal, click on <span class="strong"><strong>BizTalk Services</strong></span> in the left margin, select your instance, and click on <span class="strong"><strong>Connection Information</strong></span>. You will find the namespace, issuer, and key here to substitute in the preceding code. The service name is the name you gave the BizTalk Services instance when you created it and will be the title displayed on the Azure portal dashboard.</p><p>This information is concatenated and sent to ACS. It validates and returns an authentication token—a string that can be used on subsequent calls.</p><p>The <a id="id479" class="indexterm"/>following piece of code (which<a id="id480" class="indexterm"/> should be placed just inside the preceding closing curly brace of the <code class="literal">using</code> statement) will pass in the token with the request and receive a list of partners in the specified BizTalk Services instance:</p><div class="informalexample"><pre class="programlisting">// get partner list
client.DefaultRequestHeaders.Add("x-ms-version", "1.0");
client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("WRAP", "access_token=\"" + token.Substring(18) + "\"");
response = await client.GetAsync("https://" + serviceName + ".biztalk.windows.net/default/$PartnerManagement/Partners");
// write out partner list
Console.WriteLine("Partners:");
System.Xml.XmlDocument doc = new XmlDocument();
doc.LoadXml(await response.Content.ReadAsStringAsync());
foreach (XmlElement node in doc.SelectNodes("//*[local-name()='feed']//*[local-name()='entry']//*[local-name()='content']//*[local-name()='properties']//*[local-name()='Name']"))
{
   Console.WriteLine(node.InnerText);
}
Console.ReadLine(); // wait</pre></div><p>The preceding code performs an HTTP GET request on your BizTalk Services instance endpoint, appending the operation (<code class="literal">$PartnerManagement/Partners</code>) and passing the token. The response is an XML document containing all the partners set up in the BizTalk Services instance. To try this out, create a console application in Visual Studio and paste the code in the <code class="literal">Main</code> method, replacing the values marked in the code with your own service details. The resulting output from the partner import performed earlier is shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7401EN_08_11.jpg" alt="Trading Partner Management (TPM)"/><div class="caption"><p>List of partners</p></div></div><p>There is much more that can be done with the API, such as creating partners and updating or <a id="id481" class="indexterm"/>deleting them. However, the<a id="id482" class="indexterm"/> approach is always the same, so feel free to explore on your own and see what you can do!</p></div><div class="section" title="EDIFACT support"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec53"/>EDIFACT support</h2></div></div></div><p>BizTalk <a id="id483" class="indexterm"/>Services first shipped with support for <a id="id484" class="indexterm"/>X12 and AS/2. As of the February 2014 service update, EDIFACT support is now also provided and will be particularly welcome for European customers.</p></div><div class="section" title="Business Rules Engine (BRE)"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec54"/>Business Rules Engine (BRE)</h2></div></div></div><p>Now we<a id="id485" class="indexterm"/> come to a few areas that are more <a id="id486" class="indexterm"/>problematic. BizTalk Server has provided a Business Rules Engine and editor since 2004, and as such, it is used in many BizTalk Server solutions. There is no equivalent in BizTalk Services currently.</p><p>Microsoft is planning to provide a rules engine as part of BizTalk Services at some point, but there is no timeline for it yet. The intention is to provide parity with BizTalk Server and improved tooling, and both of these developments will make moving from Server to Services easier when introduced.</p><p>In the meantime, one option is to convert BizTalk BRE rules to code. There are a number of solutions available that are able to convert BizTalk rules to Windows Workflow rules, and Windows Workflow rules are defined in code. Windows Workflow is also a part of the .NET framework, so there is no license cost in using it. Therefore, it is possible to run the code somewhere in the BizTalk Services solution, for example, in a bridge or transform. Of course, this is trivializing the problem slightly as BRE rules can access databases and other resources, so it may involve significantly more work than simple conversion. However, it is an option depending on what the rules are doing.</p></div><div class="section" title="Orchestration"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec55"/>Orchestration</h2></div></div></div><p>Probably<a id="id487" class="indexterm"/> the biggest challenge in moving BizTalk Server <a id="id488" class="indexterm"/>solutions to BizTalk Services is orchestration. Currently, there is no silver-bullet, automatic, or zero-effort way to convert or migrate orchestrations to BizTalk Services. There are some options though.</p><p>Microsoft plans to introduce workflow to BizTalk Services, and this will certainly help fill the gap. It means that orchestrations can be recoded to workflows and keep a similar architecture.</p><p>First, remember that a bridge is actually a workflow. This means that bridges already offer some capabilities that orchestrations may have been used for earlier, such as message enrichment and routing (which is a large percentage), and as such, it may already be possible to migrate orchestration-based solutions.</p><p>In the<a id="id489" class="indexterm"/> intervening period though, an alternative solution <a id="id490" class="indexterm"/>may have to be found. One solution is to use a workflow hosted in Azure, for example, in a worker role cloud service. BizTalk Services could invoke the cloud service by passing a message or data, and the service would run the workflow and return the results. This does change the architecture somewhat though as typically, the orchestration is in control—it may wait for a set interval or for specific responses from other systems and typically, an orchestration is used as the driver for a business process. It is worth remembering that bridges can be chained, so this style of process definition can be mimicked with BizTalk Services, where messages are processed, decisions are taken on routing (to more bridges), and so on. However, such a solution is likely to become complex and is best avoided.</p><p>It is perhaps unfortunate then that an overuse of orchestration in BizTalk Server has always been prevalent. Orchestration was seen as the "aha" moment in early BizTalk when acronyms such as Business Process Management (BPM) were in vogue. It's unfortunate because orchestration has often been used when it is not necessary, and a simpler solution could have been created without it. While education over time has helped somewhat, there is still a large body of complex orchestration-centric BizTalk Server applications. If we face this scenario, migration to BizTalk Services today will be challenging.</p></div></div></div>
<div class="section" title="When not to move"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec68"/>When not to move</h1></div></div></div><p>Before closing, its worth pointing out that BizTalk Services is not meant to replace BizTalk Server. While there are certainly many similarities in the capabilities offered (and more on the way), there are different reasons for using each. Here are some of the reasons you should continue using BizTalk Server on-premises:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">All of your connectivity points (applications, services, and so on) are on-premises</li><li class="listitem" style="list-style-type: disc">A large investment in BizTalk Server-specific solutions—as this would be likely to require a complete rewrite, therefore, outweighing some of the benefits</li><li class="listitem" style="list-style-type: disc">Usage of capabilities that are not in BizTalk Services or will not fit the cloud model, for example, File and MQ Series adapters</li><li class="listitem" style="list-style-type: disc">Cloud is not the right solution because for example, security and/or regulatory restrictions, data classifications, or local laws may preclude sending such data over the public Internet or prevent storage of data off-premises</li></ul></div></div>
<div class="section" title="The future"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec69"/>The future</h1></div></div></div><p>Microsoft has<a id="id491" class="indexterm"/> committed to continuing investments in BizTalk Server and a strong roadmap for BizTalk Services. The following are the key announced developments coming for both products:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">BizTalk Server will ship a major release every alternate year</li><li class="listitem" style="list-style-type: disc">A platform update release of BizTalk Server will ship every other year starting with BizTalk Server 2013 R2 this year</li><li class="listitem" style="list-style-type: disc">The following additions are planned for BizTalk Services with a target of a quarterly release cadence:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Workflow integration</li><li class="listitem" style="list-style-type: disc">Rules engine integration</li><li class="listitem" style="list-style-type: disc">Business Activity Monitoring</li><li class="listitem" style="list-style-type: disc">Adapter extensibility/SDK</li><li class="listitem" style="list-style-type: disc">Custom code improvements in bridges</li><li class="listitem" style="list-style-type: disc">Integration with Windows Azure Active Directory (WAAD)</li><li class="listitem" style="list-style-type: disc">Business Process Modelling Notation (BPMN) support</li><li class="listitem" style="list-style-type: disc">Windows Azure store for third-party components</li><li class="listitem" style="list-style-type: disc">Scheduled backups</li></ul></div></li></ul></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec70"/>Summary</h1></div></div></div><p>In this chapter, we've looked at strategies and approaches for moving from BizTalk Server to BizTalk Services and some of the features that will be added to BizTalk Services that will make this easier. We tried to cover all the main building blocks of the BizTalk Server architecture and their equivalents (or alternatives) in BizTalk Services. As you've seen, while there is a significant overlap of functionality, it will take time for the BizTalk Services feature set to mature to the same level. The future for BizTalk Services is bright, and a fundamental tenet of Microsoft's cloud-first vision is to deliver frequent updates and enhancements in a way that simply isn't possible with shrink-wrapped on-premises products. Therefore, one can expect Microsoft to become even more customer focused and be able to action feedback and feature requests quicker than previously possible, all of which will enable Microsoft to help you move your existing solutions to the cloud.</p></div></body></html>