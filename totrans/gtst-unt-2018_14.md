# 虚拟现实

在上一章中，我们探讨了几个诊断Unity游戏的过程和技术，以帮助提高性能。我们通过优化脚本、垃圾回收和图形渲染来实现这一点。我们还探讨了如何将我们的Unity游戏部署到多个分发平台。

在本章中，我们将探讨Unity在虚拟现实方面的能力。我们将从虚拟现实的快速介绍开始，包括硬件要求，然后查看如何使用Unity游戏引擎创建虚拟现实游戏。这是一章额外内容，不需要您拥有昂贵的虚拟现实硬件。本章的目的是为您介绍虚拟现实及其与Unity游戏引擎的可能性。

具体来说，本章将涵盖以下内容：

+   欢迎来到虚拟现实

+   在Unity中启用虚拟现实

+   入门内容

# 欢迎来到虚拟现实

虚拟现实不是一个新术语，但最近它受到了极大的关注。3D图形和立体镜的出现促进了今天虚拟现实的状态。以下图表说明了立体镜的基本概念以及它们如何创建虚拟3D图像：

![图片](img/8ad20066-be78-4848-883c-5d7818d0e4d4.png)

如您所见，相同的图像从不同的角度呈现了两次。这产生了虚拟3D图像。视频也存在同样的概念。

从概念上讲，虚拟现实相当简单。它是一个合成且可信的虚拟环境或世界的创造。有两个基本组成部分：硬件和软件。硬件组件通常涉及一个头戴式设备，每个眼睛都有一个单独的镜头，每个镜头后面都有一个或多个显示屏。通常，我们是在头戴式设备中插入我们的手机，而不是显示屏。专业镜头用于将手机表面的光线聚焦到您的视网膜上。

要看到专业镜头的价值，请将您的手机举到离眼睛大约2英寸的距离。您的眼睛无法聚焦在屏幕上——它太近了。专业镜头使我们能够看到如此近的屏幕。

一些高级头戴式设备包括运动和位置跟踪硬件，以下是一些示例：

+   **惯性测量单元**（**IMUs**）用于高速运动跟踪

+   各种位置跟踪技术，例如使用摄像头、激光和磁场

软件组件包括用户与之交互的游戏或模拟软件。在虚拟现实游戏或模拟中创建该内容并将其实例化是虚拟现实的重头戏。

# 开发工具

可用的虚拟现实硬件和软件解决方案越来越多。在本书出版时，Unity原生支持Oculus、Gear VR、OpenVR和PlayStation VR。以下是对每个的简要描述。

# Oculus

Oculus是一个包含Facebook旗下的Oculus VR和虚拟现实头戴式设备Oculus Rift的统称。

你可以在以下官方网站上了解更多关于Oculus的信息：

+   **硬件网站**：[https://www.oculus.com/](https://www.oculus.com/)

+   **开发者网站**：[https://developer.oculus.com/](https://developer.oculus.com/)

# GearVR

GearVR是一个将手机插入其中的头戴式设备。它需要以下之一：

+   三星Galaxy S6

+   三星Galaxy S6 Edge

+   三星Galaxy S6 Edge+

+   三星Galaxy S7

+   三星Galaxy S7 Edge

+   三星Galaxy S8

+   三星Galaxy S8+

你可以在官方网站上了解更多关于GearVR的信息，[http://www.samsung.com/global/galaxy/gear-vr/](http://www.samsung.com/global/galaxy/gear-vr/).

# OpenVR

OpenVR是一个包含运行时和**应用程序编程接口**（**API**）的**软件开发工具包**（**SDK**）。OpenVR支持对多种VR硬件的通用访问。这种类型的访问消除了为特定虚拟现实硬件开发的需求。

你可以在GitHub网站上了解更多关于OpenVR的信息，[https://github.com/ValveSoftware/openvr](https://github.com/ValveSoftware/openvr).

# PlayStation VR

PlayStation虚拟现实，正式称为Morpheus项目，是索尼互动娱乐为PlayStation硬件平台提供的VR解决方案。

你可以在以下官方网站上了解更多关于PlayStation VR的信息：

+   **硬件**：[https://www.playstation.com/en-us/explore/playstation-vr/](https://www.playstation.com/en-us/explore/playstation-vr/)

+   **开发**：[https://www.playstation.com/en-us/develop/](https://www.playstation.com/en-us/develop/)

# 在Unity中启用虚拟现实

在Unity中启用虚拟现实包括两个基本步骤。过程从确保您已安装所需的SDK或运行时环境开始，下一步是配置Unity项目。我们将在本节中查看这两个步骤，然后是Unity技术推荐的硬件和软件。

# 必需的SDKs

例如，如果你正在为Oculus Rift设备开发虚拟现实游戏，你将在Oculus开发者网站上获得以下可用的软件包 ([https://developer.oculus.com/downloads/](https://developer.oculus.com/downloads/)):

+   **Oculus Utilities for Unity**：这是开发虚拟现实游戏的核心包。由于Unity原生支持Oculus Rift，因此此包是可选的。除了包含Oculus `OVRPlugin`之外，此包还包括预制件、脚本、示例场景和其他资产，以帮助您开始。

+   **OculusAvatar SDK**：如果您在虚拟现实游戏中实现手部存在感或使用触摸控制器，此SDK非常有用。您还可以使用此包将Oculus Home中创建的化身集成进来。

+   **Oculus平台SDK**：平台SDK用于将以下组件集成到您的虚拟现实游戏中：成就、云存储、应用内购买、匹配和语音聊天。此SDK包含一个示例应用程序，可以帮助您比从头开始开发这些功能更快地入门。

+   **Unity 5项目Oculus示例框架**：此示例项目让您通过查看工作场景来学习。它还演示了虚拟现实功能，如准星、驾驶、第一人称移动和手部存在感。

+   **立方体贴图查看器**：此工具提供了一个虚拟现实立方体贴图查看应用程序。您可以使用它来预览提交到应用商店作为提交过程一部分的立方体贴图快照。

+   **OS X版Oculus远程监控工具**：此客户端工具连接到在远程设备上运行的移动虚拟现实应用程序，用于捕获数据、显示数据和存储数据。据称，这种数据捕获、显示和存储的目的是为了性能评估和测试。

+   **Windows版Oculus远程监控工具**：此工具类似于OS X版Oculus远程监控工具。

此外，还有几个音频包可供您使用。这些包包括：

+   Oculus Ambisonics Starter Pack

+   Oculus Audio Loudness Meter

+   Oculus Audio Pack 1

+   Windows版Oculus音频分析器

+   Oculus Lipsync Unity

+   Oculus OVRVoiceMod for Unity 5

+   Oculus Spatializer DAW Mac

+   Oculus Spatializer DAW Windows

+   Oculus Spatializer FMOD

+   Oculus Spatializer Native

+   Oculus Spatializer Unity

+   Oculus Spatializer Wwise

# 配置您的Unity项目

一旦安装了所有必要的SDK，您就可以创建一个新的Unity项目。您会像创建任何其他Unity项目一样这样做。在新项目打开后，您将选择“编辑”|“项目设置”|“玩家”。这将暴露出检查器面板中的PlayerSettings。如图所示，有一个“其他设置”选项：

![](img/63d9c94b-30a0-4681-a4ca-e79776ade280.png)

点击“其他设置”按钮会显示几个可切换的选项。要启用虚拟现实，您需要选中“虚拟现实支持”复选框。如图所示，开启该选项会显示虚拟现实SDK：

![](img/e9c02e7e-568c-4b58-b253-474223221f16.png)

# Unity技术推荐

在虚拟现实游戏中确保良好的游戏体验，拥有强大的硬件和最新的软件是关键组成部分。有一些关键考虑因素可以极大地影响用户体验。这些包括：

+   确保图形驱动程序是最新的

+   确保帧率与头戴式显示器的刷新率相匹配

+   更新了核心处理器

+   更新了显卡

+   确保您有足够的易失性内存

播放设备上的操作系统也很重要。以Oculus为例，以下是被支持的：

+   Windows 7、8、8.1和10

+   安卓操作系统Lollipop 5.1及更高版本

您可能已经注意到Mac OS没有被列出。在撰写本文时，Oculus不再支持OS X。这意味着您将需要使用Windows PC上的Unity来开发原生支持的虚拟现实游戏。

# 启动内容

在游戏行业，硬件制造商希望您购买他们的产品，软件工具制造商希望您使用他们的软件。并且，在硬件和软件方面，他们的创作者希望您开发游戏，以便人们可以玩。更具体地说，VR头戴设备制造商希望尽可能多地销售头戴设备，因此他们通过提供免费工具和资产来鼓励开发者。这并不是一个邪恶的计划，而是一种硬件制造商和游戏开发者之间的共生关系。

由于商店的动态性质，Unity资产商店的任何查看都是时间快照。在撰写本文时，有几个来自不同硬件制造商的免费VR相关资产。本节将回顾这些资产。

# Oculus VR

Oculus VR在Unity资产商店提供了一些免费资产，以支持您为Oculus Rift和Samsung Gear VR的开发。

# Oculus 样式框架

第一个包是Oculus 样式框架。它包含三个样本场景以及如何实现基本VR相关功能的指南。以下部分脚本列表让您了解您可以使用这个免费资产包发现的功能类型：

+   边界

+   摄像机架

+   调试头控制器

+   显示

+   可抓取

+   抓取器

+   触觉

+   触觉夹

+   输入

+   完成监听器

+   遮罩

+   平台菜单

+   重置方向

+   触摸板

+   追踪器

此资产包还包括动画、材质、网格、预制体、场景、着色器和纹理。此外，还有帮助文本文件。

使用这个资产包是启动您的虚拟现实探索的绝佳方式。

# Oculus 立体阴影重投影样本

2017年8月，Oculus发布了Oculus 立体阴影重投影样本资产包到Unity资产商店。此包提供了一种创新技术来优化VR渲染。该技术采用两步法。在第一步中，从一只眼睛渲染的像素被重新投影到另一只眼睛。然后，在第二步渲染中，填补空缺。

Oculus 立体阴影重投影样本资产包包含一个教学文本文件以及所有必要的内容，如材质、预制体、着色器、脚本、纹理以及场景。

Oculus VR报告称，这种重投影方法每帧可节省超过20%的GPU成本。您的结果可能会有所不同，但在这个规模上优化纯粹的可能性使得检查这个资产包成为必须。

# Oculus集成

Oculus集成资产包为Oculus Rift、Gear VR和Touch提供了脚本示例。这些示例包括：

+   输入和触觉

+   分层渲染

+   平台：

    +   成就

    +   云存储

    +   权限检查

    +   身份

    +   应用内购买

    +   键盘

    +   排行榜

    +   匹配

    +   对等网络

    +   房间

    +   IP语音（VoIP）

+   渲染音频：

    +   Reverb的房间模型设置

    +   早期反射的房间模型设置

    +   空间化微调

+   渲染化身：

    +   定制外观

    +   社交存在

    +   触摸和手建模

+   社交渲染

+   房间规模

+   跟踪

这是Oculus提供的庞大样本列表，使我们的虚拟现实游戏开发更容易，并有助于确保我们的成功。

# Vive软件

Vive软件在Unity Asset Store中提供了一些免费资产，以支持您为HTC Vive的开发。

# Vive立体渲染工具包

Vive立体渲染工具包包括一套可重复使用的游戏资产，可用于创建立体渲染效果。此工具包与Unity的本地VR渲染兼容。

立体渲染效果包括以下内容：

+   基本示例

+   回调示例

+   镜像示例

+   传送门门示例

+   渲染器创建示例

与立体渲染效果相关的网格、材料、纹理、着色器和脚本包含在资产包中。

# Vive输入实用工具

Vive输入实用工具是一个插件，它为您提供了访问Vive设备状态（包括Vive Tracker）的权限。该插件具有以下功能：

+   碰撞事件

+   指针3D

+   姿态追踪器

+   Vive输入实用工具

    +   2D拖放

    +   3D拖放

    +   传送

该插件还包含材料、预制体、脚本、动画、模型、精灵和着色器，以支持资产包中的示例。此包还包括几个教程。

# Vive媒体解码器

Vive媒体解码器插件可用于在Windows上支持流媒体。该插件支持Windows 7和DirectX 11。此插件的两个主要功能是：

+   高性能解码

+   视频流

# NVIDIA

NVIDIA是我们游戏电脑中使用的GPU的主要制造商。他们在Unity Asset Store中有几个免费资产，以帮助展示他们GPU的强大功能。其中两个免费资产专门针对VR，在本节中进行了介绍。

# NVIDIA VRWorks

此资产包包含基于文本的指南和用于创建以下内容的脚本和着色器：

+   镜头匹配着色

+   多分辨率着色

+   单次传递立体

+   VR SLI

使用此包，您必须具备以下条件：

+   Windows PC

+   DX11

+   NVIDIA GeForce 9或更高版本

+   VS 2015重新分发

+   Unity 2017.1.0b6或更高版本

# NVIDIA VR样本

此包有助于展示现代GPU的功能，并集成了VRWorks包。包含在此资产包中的示例包括：

+   抗锯齿

+   花瓣和闪光

+   模糊

+   摄像机运动

+   色彩校正

+   对比度

+   停止着色

+   景深

+   边缘检测

+   鱼眼

+   全局雾效

+   灰度

+   图像效果

+   动态模糊

+   噪音和颗粒

+   噪音和划痕

+   后期效果

+   四边形

+   屏幕叠加

+   屏幕空间环境遮挡和遮挡

+   褐色调

+   日光束

+   虚化

+   色调映射

+   三角形

+   旋转

+   暗角和色差

+   漩涡

支持示例的着色器、纹理、模型、场景、动画、控制器、网格、音频、字体、材质、预制体和脚本都包含在资产包中。

# Unity Technologies

Unity Technologies，这家公司制作了Unity并拥有资产商店，有一个强大的VR示例资产包。它包含一个菜单和四个迷你游戏，可以帮助你开始为Oculus DK2和GearVR创建虚拟现实游戏。

下面是资产包中包含的基本内容：

+   漂浮世界空间GUI

+   静态世界空间GUI

+   飞行器

+   迷宫

+   射击游戏

正如你所预期，所有相关的着色器、音频、字体、材质、纹理、动画、控制器、混合器、网格、模型、预制体、场景和脚本都包含在内。

# 摘要

在本章中，我们探讨了Unity在虚拟现实方面的能力。我们从一个关于虚拟现实的快速介绍开始，包括硬件要求，然后探讨了如何使用Unity游戏引擎创建虚拟现实游戏。我们还查看了一些来自Unity资产商店的可用起始内容。

阅读完这本书后，你将能够使用Unity创建自己的动态游戏，并且对制作虚拟现实游戏所需的内容有一个大致的了解。你正处于一个良好的起点：虚拟现实仍然是一个非常年轻的技术。例如，为了获得高质量的虚拟现实体验，人眼大约需要每只眼睛16,000 x 16,000像素，但当前最好的VR显示器提供的分辨率最高为1080 x 780。因此，我们在这一技术上还有很长的路要走，其未来前景广阔。
