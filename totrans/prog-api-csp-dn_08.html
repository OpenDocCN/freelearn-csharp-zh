<html><head></head><body>
  <div id="_idContainer091">
   <h1 class="chapter-number" id="_idParaDest-105">
    <a id="_idTextAnchor105">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     8
    </span>
   </h1>
   <h1 id="_idParaDest-106">
    <a id="_idTextAnchor106">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Advanced Topics
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.3.1">
     In this chapter, we will examine a few advanced topics not covered elsewhere in the book.
    </span>
    <span class="koboSpan" id="kobo.3.2">
     This includes Implementing an Advanced API using a more complex data structure, Storage Tables, and the very exciting new (at the time of this writing)
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.4.1">
      Aspire feature.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.5.1">
     In this chapter, we will cover the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.6.1">
      following topics:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.7.1">
      Implementing an
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.8.1">
       advanced API
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.9.1">
      Updating
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.10.1">
       the database
      </span>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.11.1">
       Supporting implementation
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.12.1">
      Creating Azure
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.13.1">
       Storage Tables
      </span>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.14.1">
       Aspire dashboard
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.15.1">
      Adding Aspire to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.16.1">
       existing projects
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-107">
    <a id="_idTextAnchor107">
    </a>
    <span class="koboSpan" id="kobo.17.1">
     Technical requirements
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.18.1">
     For this chapter, you’ll need
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.19.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.20.1">
       Visual Studio.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.21.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.22.1">
       Azure.Data.Tables
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.23.1">
       NuGet package.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.24.1">
      An Azure account (you can get a free starter account
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.25.1">
       at
      </span>
     </span>
     <a href="https://azure.microsoft.com/en-us/">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.26.1">
        https://azure.microsoft.com/en-us/
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.27.1">
       ).
      </span>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.28.1">
       Aspire comes with Visual Studio 2022 (version 17.10 or higher) and requires .
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.29.1">
        NET 8.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.30.1">
      You will need to install Docker Desktop (which is free and can be obtained
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.31.1">
       at
      </span>
     </span>
     <a href="https://www.docker.com/Products/docker-desktop/">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.32.1">
        https://www.docker.com/Products/docker-desktop/
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.33.1">
       ).
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.34.1">
     The code files for this chapter can be found in the GitHub repository
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.35.1">
      here:
     </span>
    </span>
    <a href="https://github.com/PacktPublishing/Programming-APIs-with-C-Sharp-and-.NET/tree/main/Chapter08">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.36.1">
       https://github.com/PacktPublishing/Programming-APIs-with-C-Sharp-and-.NET/tree/main/Chapter08
      </span>
     </span>
    </a>
   </p>
   <h1 id="_idParaDest-108">
    <a id="_idTextAnchor108">
    </a>
    <span class="koboSpan" id="kobo.37.1">
     Implementing an advanced API
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.38.1">
     Until now, we’ve been working with a very simple database, and implementing pretty straightforward APIs.
    </span>
    <span class="koboSpan" id="kobo.38.2">
     From time to time, however, your client will ask for something more difficult
    </span>
    <a id="_idIndexMarker216">
    </a>
    <span class="koboSpan" id="kobo.39.1">
     or complex.
    </span>
    <span class="koboSpan" id="kobo.39.2">
     Let’s take a look at one
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.40.1">
      such requirement.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.41.1">
     The client has asked for the ability to see a car with all its options.
    </span>
    <span class="koboSpan" id="kobo.41.2">
     We’ll provide that in JSON for easy display on the web, phone, and so on.
    </span>
    <span class="koboSpan" id="kobo.41.3">
     The JSON will look
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.42.1">
      like this:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.43.1">
{
    "id": 2,
    "name": "buick skylark 320",
    "mpg": null,
    "cylinders": null,
    "displacement": null,
    "horsepower": null,
    "weight": null,
    "acceleration": null,
    "modelYear": null,
    "origin": null,
    "is_Deleted": null,
    "options": [
        {
            "optionId": 1,
            "optionName": "Winter Package",
            "optionPrice": 3700
        },
        {
            "optionId": 2,
            "optionName": "Mats",
            "optionPrice": 250
        },
        {
            "optionId": 3,
            "optionName": "Summer Package",
            "optionPrice": 2250
        }
    ]
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.44.1">
     To implement
    </span>
    <a id="_idIndexMarker217">
    </a>
    <span class="koboSpan" id="kobo.45.1">
     this, we’ll need to add a table to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.46.1">
      database:
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.47.1">
       Options
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.48.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-109">
    <a id="_idTextAnchor109">
    </a>
    <span class="koboSpan" id="kobo.49.1">
     Updating the database
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.50.1">
     We need
    </span>
    <a id="_idIndexMarker218">
    </a>
    <span class="koboSpan" id="kobo.51.1">
     to track various features (options) the user may select, such as a sunroof, the winter package, and so on.
    </span>
    <span class="koboSpan" id="kobo.51.2">
     To do this, we will create a new table,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.52.1">
      Options
     </span>
    </strong>
    <span class="koboSpan" id="kobo.53.1">
     , which will have
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.54.1">
      four columns:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.55.1">
       car_id
      </span>
     </strong>
     <span class="koboSpan" id="kobo.56.1">
      : The ID of the car to which this option will
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.57.1">
       be added
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.58.1">
       option_id
      </span>
     </strong>
     <span class="koboSpan" id="kobo.59.1">
      : The ID of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.60.1">
       the option
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.61.1">
       option_name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.62.1">
      : The name of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.63.1">
       the feature
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.64.1">
       option_price
      </span>
     </strong>
     <span class="koboSpan" id="kobo.65.1">
      : The MSRP for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.66.1">
       this feature
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.67.1">
     Here is a sample of the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.68.1">
       Options
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.69.1">
      table:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer073">
     <span class="koboSpan" id="kobo.70.1">
      <img alt="Figure 8.1 – Sample rows from the Options table" src="image/B21998_08_01.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.71.1">
     Figure 8.1 – Sample rows from the Options table
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.72.1">
     You’ll want to create at least 10 rows using arbitrary values.
    </span>
    <span class="koboSpan" id="kobo.72.2">
     Note that there is no table with the
    </span>
    <a id="_idIndexMarker219">
    </a>
    <span class="koboSpan" id="kobo.73.1">
     option names and values.
    </span>
    <span class="koboSpan" id="kobo.73.2">
     This is a simple mostly non-relational database, though you are free to add
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.74.1">
      such tables.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.75.1">
     With this table, we can create our one relationship; that is between the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.76.1">
      car
     </span>
    </strong>
    <span class="koboSpan" id="kobo.77.1">
     table and the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.78.1">
      Options
     </span>
    </strong>
    <span class="koboSpan" id="kobo.79.1">
     table.
    </span>
    <span class="koboSpan" id="kobo.79.2">
     Add
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.80.1">
      car_id
     </span>
    </strong>
    <span class="koboSpan" id="kobo.81.1">
     to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.82.1">
      car
     </span>
    </strong>
    <span class="koboSpan" id="kobo.83.1">
     table, and create our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.84.1">
      Select
     </span>
    </strong>
    <span class="koboSpan" id="kobo.85.1">
     statement with a join to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.86.1">
      options table:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.87.1">
select top(10) * from car c join options o on o.car_id = c.id</span></pre>
   <p>
    <span class="koboSpan" id="kobo.88.1">
     The result looks like the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.89.1">
      car
     </span>
    </strong>
    <span class="koboSpan" id="kobo.90.1">
     table, but has the options for each car appended to the end, as shown in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.91.1">
       Figure 8
      </span>
     </em>
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.92.1">
       .2
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.93.1">
      :
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer074">
     <span class="koboSpan" id="kobo.94.1">
      <img alt="Figure 8.2 – Joined tables" src="image/B21998_08_02.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.95.1">
     Figure 8.2 – Joined tables
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.96.1">
     Note that
    </span>
    <a id="_idIndexMarker220">
    </a>
    <span class="koboSpan" id="kobo.97.1">
     your table will look a bit different as I’ve cut out the middle to make it fit
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.98.1">
      the page.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.99.1">
     You can see that the option values are appended to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.100.1">
      car
     </span>
    </strong>
    <span class="koboSpan" id="kobo.101.1">
     rows.
    </span>
    <span class="koboSpan" id="kobo.101.2">
     This is just what
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.102.1">
      we need.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.103.1">
     For most applications, this would be sufficient, however, our client has asked for the JSON structure shown in the code under the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.104.1">
      Implementing an advanced
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.105.1">
       API
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.106.1">
      heading.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.107.1">
     This will be a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.108.1">
      bit tricky.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-110">
    <a id="_idTextAnchor110">
    </a>
    <span class="koboSpan" id="kobo.109.1">
     Creating the classes
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.110.1">
     We need a class to represent the entire row, with the car and the options together.
    </span>
    <span class="koboSpan" id="kobo.110.2">
     Each instance
    </span>
    <a id="_idIndexMarker221">
    </a>
    <span class="koboSpan" id="kobo.111.1">
     of the class will represent one full row in the table, as shown in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.112.1">
       Figure 8
      </span>
     </em>
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.113.1">
      .2
     </span>
    </em>
    <span class="koboSpan" id="kobo.114.1">
     .
    </span>
    <span class="koboSpan" id="kobo.114.2">
     Let’s call that
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.115.1">
      class
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.116.1">
       carFlat
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.117.1">
      :
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.118.1">
  public class CarFlat : Car
  {
      public int? </span><span class="koboSpan" id="kobo.118.2">car_id { get; set; }
      public int? </span><span class="koboSpan" id="kobo.118.3">option_id { get; set; }
      public string? </span><span class="koboSpan" id="kobo.118.4">option_name { get; set; }
      public float option_price { get; set; }
  }</span></pre>
   <p>
    <span class="koboSpan" id="kobo.119.1">
     Notice that
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.120.1">
      CarFlat
     </span>
    </strong>
    <span class="koboSpan" id="kobo.121.1">
     inherits from
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.122.1">
      Car
     </span>
    </strong>
    <span class="koboSpan" id="kobo.123.1">
     , picking up all the properties of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.124.1">
      Car
     </span>
    </strong>
    <span class="koboSpan" id="kobo.125.1">
     and adding the properties of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.126.1">
      Options
     </span>
    </strong>
    <span class="koboSpan" id="kobo.127.1">
     (along
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.128.1">
      with
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.129.1">
       car_id
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.130.1">
      ).
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.131.1">
     Note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.132.1">
     In my programming, I typically use Pascal case (initial cap)
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.133.1">
      for properties.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.134.1">
     Now, we need
    </span>
    <a id="_idIndexMarker222">
    </a>
    <span class="koboSpan" id="kobo.135.1">
     a class to represent the row without the options (representing the car) but each car will have a collection of options.
    </span>
    <span class="koboSpan" id="kobo.135.2">
     Let’s call
    </span>
    <a id="_idIndexMarker223">
    </a>
    <span class="koboSpan" id="kobo.136.1">
     that class
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.137.1">
      carDto
     </span>
    </strong>
    <span class="koboSpan" id="kobo.138.1">
     as it will be our
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.139.1">
      data transfer object
     </span>
    </strong>
    <span class="koboSpan" id="kobo.140.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.141.1">
      DTO
     </span>
    </strong>
    <span class="koboSpan" id="kobo.142.1">
     ) for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.143.1">
      the car.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.144.1">
     We will be passing options around, so let’s create an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.145.1">
      OptionsDto
     </span>
    </strong>
    <span class="koboSpan" id="kobo.146.1">
     class
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.147.1">
      as well.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.148.1">
     Here’s what they
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.149.1">
      look like:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.150.1">
    public class CarDto
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public string Mpg { get; set; }
        public string Cylinders { get; set; }
        public string Displacement { get; set; }
        public string Horsepower { get; set; }
        public string Weight { get; set; }
        public string Acceleration { get; set; }
        public string ModelYear { get; set; }
        public string Origin { get; set; }
        public string Is_Deleted { get; set; }
        public List&lt;OptionsDto&gt; Options { get; set; }
    }</span></pre>
   <p>
    <span class="koboSpan" id="kobo.151.1">
     The important thing to note here is that
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.152.1">
      CarDto
     </span>
    </strong>
    <span class="koboSpan" id="kobo.153.1">
     has a property that is the list of all this car’s options; notice that the final property is a list of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.154.1">
      OptionsDtos
     </span>
    </strong>
    <span class="koboSpan" id="kobo.155.1">
     .
    </span>
    <span class="koboSpan" id="kobo.155.2">
     Let’s look at that
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.156.1">
      class now:
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.157.1">
     Here
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.158.1">
      is
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.159.1">
       OptionsDto
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.160.1">
      :
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.161.1">
    public class OptionsDto
    {
        public int OptionId { get; set; }
        public string OptionName { get; set; }
        public float OptionPrice { get; set; }
    }</span></pre>
   <p>
    <span class="koboSpan" id="kobo.162.1">
     Notice the
    </span>
    <a id="_idIndexMarker224">
    </a>
    <span class="koboSpan" id="kobo.163.1">
     capitalization and absence of underscores in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.164.1">
      the DTO.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.165.1">
     We need a way to link the DTO to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.166.1">
      Car
     </span>
    </strong>
    <span class="koboSpan" id="kobo.167.1">
     object.
    </span>
    <span class="koboSpan" id="kobo.167.2">
     That is what profiles
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.168.1">
      are for.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.169.1">
     The profile
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.170.1">
     We’ll need a profile to map the various classes to one another.
    </span>
    <span class="koboSpan" id="kobo.170.2">
     The DTO is used to transfer
    </span>
    <a id="_idIndexMarker225">
    </a>
    <span class="koboSpan" id="kobo.171.1">
     the object (hence the name) but it must be mapped to the original object.
    </span>
    <span class="koboSpan" id="kobo.171.2">
     Thus, we want to map
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.172.1">
      Car.Dto
     </span>
    </strong>
    <span class="koboSpan" id="kobo.173.1">
     to the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.174.1">
       Car
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.175.1">
      class.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.176.1">
     This is the trickiest part, and mapping is what makes this
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.177.1">
      all work.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.178.1">
     The first map is pretty straightforward, mapping the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.179.1">
      Car
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.180.1">
      to
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.181.1">
       CarDto
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.182.1">
      :
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.183.1">
CreateMap&lt;CarDto, Car&gt;()
    .ForMember(car =&gt; car.id, opt =&gt; opt.MapFrom(carDto =&gt; carDto.Id))
    .ForMember(car =&gt; car.name, opt =&gt; opt.MapFrom(carDto =&gt; carDto.
</span><span class="koboSpan" id="kobo.183.2">    Name))
    .ForMember(car =&gt; car.mpg, opt =&gt; opt.MapFrom(carDto =&gt; carDto.
</span><span class="koboSpan" id="kobo.183.3">    Mpg))
    .ForMember(car =&gt; car.cylinders, opt =&gt; opt.MapFrom(carDto =&gt; 
    carDto.Cylinders))
    .ForMember(car =&gt; car.displacement, opt =&gt; opt.MapFrom(carDto =&gt; 
    carDto.Displacement))
    .ForMember(car =&gt; car.horsepower, opt =&gt; opt.MapFrom(carDto =&gt; 
    carDto.Horsepower))
    .ForMember(car =&gt; car.weight, opt =&gt; opt.MapFrom(carDto =&gt; carDto.
</span><span class="koboSpan" id="kobo.183.4">    Weight))
    .ForMember(car =&gt; car.acceleration, opt =&gt; opt.MapFrom(carDto =&gt; 
    carDto.Acceleration))
    .ForMember(car =&gt; car.model_year, opt =&gt; opt.MapFrom(carDto =&gt; 
    carDto.ModelYear))
    .ForMember(car =&gt; car.origin, opt =&gt; opt.MapFrom(carDto =&gt; carDto.
</span><span class="koboSpan" id="kobo.183.5">    Origin))
    .ReverseMap();</span></pre>
   <p>
    <span class="koboSpan" id="kobo.184.1">
     We start by identifying the types in the map, and then for each member, we map using Lambda
    </span>
    <a id="_idIndexMarker226">
    </a>
    <span class="koboSpan" id="kobo.185.1">
     expressions.
    </span>
    <span class="koboSpan" id="kobo.185.2">
     Note the last line,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.186.1">
      .ReerseMap
     </span>
    </strong>
    <span class="koboSpan" id="kobo.187.1">
     – this saves us the trouble of re-writing the entire map going the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.188.1">
      other way.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.189.1">
     Next comes the heart of the program, mapping
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.190.1">
      CarFlat
     </span>
    </strong>
    <span class="koboSpan" id="kobo.191.1">
     to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.192.1">
      CarDto
     </span>
    </strong>
    <span class="koboSpan" id="kobo.193.1">
     and mapping
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.194.1">
      OptionsDto
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.195.1">
      to
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.196.1">
       CarFlat
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.197.1">
      :
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.198.1">
CreateMap&lt;List&lt;CarFlat&gt;, CarDto&gt;()
     .ForPath(dest =&gt; dest.Id, opt =&gt; opt.MapFrom(src =&gt; src.First().
</span><span class="koboSpan" id="kobo.198.2">     id))
     .ForPath(dest =&gt; dest.Name, opt =&gt; opt.MapFrom(src =&gt; src.
</span><span class="koboSpan" id="kobo.198.3">     First().name))
     .ForMember(dest =&gt; dest.Options, opt =&gt; opt.MapFrom(src =&gt; src));
CreateMap&lt;OptionsDto, CarFlat&gt;()
     .ForMember(dest =&gt; dest.option_id, opt =&gt; opt.MapFrom(src =&gt; src.
</span><span class="koboSpan" id="kobo.198.4">     OptionId))
     .ForMember(dest =&gt; dest.option_name, opt =&gt; opt.MapFrom(src =&gt; 
     src.OptionName))
     .ForMember(dest =&gt; dest.option_price, opt =&gt; opt.MapFrom(src =&gt; 
     src.OptionPrice))</span></pre>
   <p>
    <span class="koboSpan" id="kobo.199.1">
     The magic
    </span>
    <a id="_idIndexMarker227">
    </a>
    <span class="koboSpan" id="kobo.200.1">
     is performed by AutoMapper.
    </span>
    <span class="koboSpan" id="kobo.200.2">
     If you have not installed AutoMapper yet, this is a good time to do so.
    </span>
    <span class="koboSpan" id="kobo.200.3">
     AutoMapper will make this job infinitely easier.
    </span>
    <span class="koboSpan" id="kobo.200.4">
     AutoMapper simplifies the mapping process between different object models, reducing the need for manual transformations.
    </span>
    <span class="koboSpan" id="kobo.200.5">
     All we need to do is tell AutoMapper to map from one class to another, as
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.201.1">
      shown next.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-111">
    <a id="_idTextAnchor111">
    </a>
    <span class="koboSpan" id="kobo.202.1">
     Supporting implementation
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.203.1">
     With the
    </span>
    <a id="_idIndexMarker228">
    </a>
    <span class="koboSpan" id="kobo.204.1">
     profile written, we’ll go back to the controller.
    </span>
    <span class="koboSpan" id="kobo.204.2">
     Here, we’re going to map
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.205.1">
      CarDto
     </span>
    </strong>
    <span class="koboSpan" id="kobo.206.1">
     to the car.
    </span>
    <span class="koboSpan" id="kobo.206.2">
     Notice the next to last line of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.207.1">
      this code:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.208.1">
       [HttpGet("{id}")]
       public async Task&lt;ActionResult&lt;CarDto&gt;&gt; Get(int id)
       {
           var car = await _carService.Get(id);
           if (car == null)
           {
               return NotFound();
           }
           </span><strong class="bold"><span class="koboSpan" id="kobo.209.1">var carDto = _mapper.Map&lt;CarDto&gt;(car);</span></strong><span class="koboSpan" id="kobo.210.1">
           return carDto;
       }</span></pre>
   <p>
    <span class="koboSpan" id="kobo.211.1">
     Nothing new or special here, but note that at the bottom of the method, we use a mapper to turn our car into a DTO, which is what we return to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.212.1">
      client application.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.213.1">
     The only logic in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.214.1">
      CarService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.215.1">
     is to ensure we have a valid
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.216.1">
      car ID:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.217.1">
public async Task&lt;List&lt;CarFlat&gt;&gt; Get(int id)
 {
     if (id == 0)
     {
         throw new Exception("Invalid Id");
     }
     return await _carRepository.Get(id);
 }</span></pre>
   <p>
    <span class="koboSpan" id="kobo.218.1">
     This brings
    </span>
    <a id="_idIndexMarker229">
    </a>
    <span class="koboSpan" id="kobo.219.1">
     us to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.220.1">
      the repository:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.221.1">
public async Task&lt;List&lt;CarFlat?&gt;&gt; Get(int id)
 {
     var query = "select * from car c left join options o on o.car_id 
     = c.id where c.id = @id";
     using var db = databaseConnectionFactory.GetConnection();
     return (await db.QueryAsync&lt;CarFlat&gt;(query, new {id})).ToList();
 }</span></pre>
   <p>
    <span class="koboSpan" id="kobo.222.1">
     The method is surprisingly simple.
    </span>
    <span class="koboSpan" id="kobo.222.2">
     We set up and execute the query.
    </span>
    <span class="koboSpan" id="kobo.222.3">
     Notice that we are using
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.223.1">
      QueryAsync
     </span>
    </strong>
    <span class="koboSpan" id="kobo.224.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.225.1">
      ToList
     </span>
    </strong>
    <span class="koboSpan" id="kobo.226.1">
     as if we were getting all the cars.
    </span>
    <span class="koboSpan" id="kobo.226.2">
     Actually, what we are getting is a list of the options for a single car, as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.227.1">
      next listing:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.228.1">
{
    "id": 2,
    "name": "buick skylark 320",
    "mpg": null,
    "cylinders": null,
    "displacement": null,
    "horsepower": null,
    "weight": null,
    "acceleration": null,
    "modelYear": null,
    "origin": null,
    "is_Deleted": null,
    "options": [
        {
            "optionId": 1,
            "optionName": "Winter Package",
            "optionPrice": 3700
        },
        {
            "optionId": 2,
            "optionName": "Mats",
            "optionPrice": 250
        },
        {
            "optionId": 3,
            "optionName": "Summer Package",
            "optionPrice": 2250
        }
    ]
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.229.1">
     Beautiful!
    </span>
    <span class="koboSpan" id="kobo.229.2">
     This should look familiar, as it is what we specified at the beginning of the chapter.
    </span>
    <span class="koboSpan" id="kobo.229.3">
     Each car has its options as a sub-set in the JSON.
    </span>
    <span class="koboSpan" id="kobo.229.4">
     This will make it much easier to display
    </span>
    <a id="_idIndexMarker230">
    </a>
    <span class="koboSpan" id="kobo.230.1">
     the cars with their options (e.g., on a web page).
    </span>
    <span class="koboSpan" id="kobo.230.2">
     Tuck this in your pocket; you don’t use it often, but when you need to make this kind of display, the technique is powerful but
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.231.1">
      not obvious.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.232.1">
     In this next section, we will introduce Azure Storage Tables, a powerful yet simple way to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.233.1">
      store data.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-112">
    <a id="_idTextAnchor112">
    </a>
    <span class="koboSpan" id="kobo.234.1">
     Azure Storage Tables
    </span>
   </h1>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.235.1">
      Storage Tables
     </span>
    </strong>
    <span class="koboSpan" id="kobo.236.1">
     are a great way to persist relatively simple data structures.
    </span>
    <span class="koboSpan" id="kobo.236.2">
     Creating and using storage tables is quick
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.237.1">
      and easy.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.238.1">
     Azure offers
    </span>
    <a id="_idIndexMarker231">
    </a>
    <span class="koboSpan" id="kobo.239.1">
     a number of ways to store your data.
    </span>
    <span class="koboSpan" id="kobo.239.2">
     The most popular are SQL Server, Cosmos, and storage tables.
    </span>
    <span class="koboSpan" id="kobo.239.3">
     Storage tables are the most limited, but they are also the simplest generally speaking, and the fastest to create.
    </span>
    <span class="koboSpan" id="kobo.239.4">
     They are very popular for keeping track of simple information.
    </span>
    <span class="koboSpan" id="kobo.239.5">
     For example, you might use storage tables to record each time you send a message or each time something anomalous happens.
    </span>
    <span class="koboSpan" id="kobo.239.6">
     For these examples, you would enter one row per incident, as described in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.240.1">
      following section.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-113">
    <a id="_idTextAnchor113">
    </a>
    <span class="koboSpan" id="kobo.241.1">
     Exploring the essentials
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.242.1">
     Storage
    </span>
    <a id="_idIndexMarker232">
    </a>
    <span class="koboSpan" id="kobo.243.1">
     tables are not inherently relational.
    </span>
    <span class="koboSpan" id="kobo.243.2">
     While you can index, it isn’t simple, and it isn’t particularly powerful.
    </span>
    <span class="koboSpan" id="kobo.243.3">
     The reason behind all this is to keep storage tables simple.
    </span>
    <span class="koboSpan" id="kobo.243.4">
     This makes them ideal for keeping lists, logging, creating progress entries, and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.244.1">
      so forth.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.245.1">
     We will create a storage table that tracks exceptions thrown during the execution of our program.
    </span>
    <span class="koboSpan" id="kobo.245.2">
     The table we create will look like this
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.246.1">
      on Azure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer075">
     <span class="koboSpan" id="kobo.247.1">
      <img alt="Figure 8.3 – The left portion of a storage table" src="image/B21998_08_03.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.248.1">
     Figure 8.3 – The left portion of a storage table
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.249.1">
     Due to space concerns, I’m not showing the entire table here.
    </span>
    <span class="koboSpan" id="kobo.249.2">
     There are columns for the exception type, the time of the exception, the message, and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.250.1">
      so forth.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.251.1">
     To keep
    </span>
    <a id="_idIndexMarker233">
    </a>
    <span class="koboSpan" id="kobo.252.1">
     things as simple as possible, and to focus 100% on Table Storage, we’ll create a console application that simply throws exceptions and stores them in the table.
    </span>
    <span class="koboSpan" id="kobo.252.2">
     To get started, follow
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.253.1">
      these steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.254.1">
      Create a new project and select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.255.1">
       Console App
      </span>
     </strong>
     <span class="koboSpan" id="kobo.256.1">
      , as shown in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.257.1">
        Figure 8
       </span>
      </em>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.258.1">
        .4
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.259.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer076">
     <span class="koboSpan" id="kobo.260.1">
      <img alt="Figure 8.4 – Selecting console app" src="image/B21998_08_04.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.261.1">
     Figure 8.4 – Selecting console app
    </span>
   </p>
   <ol>
    <li value="2">
     <span class="koboSpan" id="kobo.262.1">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.263.1">
       Next
      </span>
     </strong>
     <span class="koboSpan" id="kobo.264.1">
      and fill in your project name (I used
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.265.1">
       TableStorageConsoleApp
      </span>
     </strong>
     <span class="koboSpan" id="kobo.266.1">
      ), its location on your local disk, and the name of the solution (typically the same as your project).
     </span>
     <span class="koboSpan" id="kobo.266.2">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.267.1">
       Next
      </span>
     </strong>
     <span class="koboSpan" id="kobo.268.1">
      and select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.269.1">
       .NET 8
      </span>
     </strong>
     <span class="koboSpan" id="kobo.270.1">
      (or later) and, most important, check
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.271.1">
       Do not use top-level statements
      </span>
     </strong>
     <span class="koboSpan" id="kobo.272.1">
      , as shown in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.273.1">
       following figure:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer077">
     <span class="koboSpan" id="kobo.274.1">
      <img alt="Figure 8.5 – Additional information" src="image/B21998_08_05.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.275.1">
     Figure 8.5 – Additional information
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.276.1">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.277.1">
       Create
      </span>
     </strong>
     <span class="koboSpan" id="kobo.278.1">
      and your console app will be created, complete with a main entry point and a single line of code, writing the canonical “Hello, World” greeting.
     </span>
     <span class="koboSpan" id="kobo.278.2">
      You can delete
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.279.1">
       that line.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.280.1">
     To keep
    </span>
    <a id="_idIndexMarker234">
    </a>
    <span class="koboSpan" id="kobo.281.1">
     things simple, we’ll have
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.282.1">
      Main
     </span>
    </strong>
    <span class="koboSpan" id="kobo.283.1">
     call
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.284.1">
      ThrowException
     </span>
    </strong>
    <span class="koboSpan" id="kobo.285.1">
     , a method we’ll write that will throw a random exception every two seconds.
    </span>
    <span class="koboSpan" id="kobo.285.2">
     Thus,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.286.1">
      Main
     </span>
    </strong>
    <span class="koboSpan" id="kobo.287.1">
     is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.288.1">
      very simple:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.289.1">
public class Program
 {
     static void Main(string[] args)
     {
         Console.WriteLine("Loading...");
         for(; ; )
         {
             ThrowException();
         }
     }</span></pre>
   <p>
    <span class="koboSpan" id="kobo.290.1">
     You can see that
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.291.1">
      ThrowException
     </span>
    </strong>
    <span class="koboSpan" id="kobo.292.1">
     is enclosed in a forever loop and will continue until you close the program.
    </span>
    <span class="koboSpan" id="kobo.292.2">
     Putting in a more sophisticated way to stop it is, as they say, left as an exercise for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.293.1">
      the reader.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.294.1">
     The job of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.295.1">
      ThrowException
     </span>
    </strong>
    <span class="koboSpan" id="kobo.296.1">
     is, as said earlier, to throw exceptions randomly.
    </span>
    <span class="koboSpan" id="kobo.296.2">
     For this, I need nothing more than a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.297.1">
      random
     </span>
    </strong>
    <span class="koboSpan" id="kobo.298.1">
     generator and a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.299.1">
      switch
     </span>
    </strong>
    <span class="koboSpan" id="kobo.300.1">
     statement.
    </span>
    <span class="koboSpan" id="kobo.300.2">
     We begin by
    </span>
    <a id="_idIndexMarker235">
    </a>
    <span class="koboSpan" id="kobo.301.1">
     enclosing the random generation of exceptions within a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.302.1">
      try statement:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.303.1">
try
{
    Random rand = new Random();
    var random = rand.Next(0, 10);
    switch (random)
    {
        case 0:
            throw new ArgumentException("Argument Exception");
        case 1:
            throw new ArgumentNullException("Argument Null 
            Exception");
        case 2:
            throw new ArgumentOutOfRangeException("Argument Out Of 
            Range Exception");
        case 3:
            throw new DivideByZeroException("Divide By Zero 
            Exception");
        case 4:
            throw new FileNotFoundException("File Not Found 
            Exception");
        case 5:
            throw new FormatException("Format Exception");
        case 6:
            throw new IndexOutOfRangeException("Index Out Of Range 
            Exception");
        case 7:
            throw new InvalidOperationException("Invalid Operation 
            Exception");
        case 8:
            throw new KeyNotFoundException("Key Not Found Exception");
        case 9:
            throw new NotImplementedException("Not Implemented 
            Exception");
        case 10:
            throw new NotSupportedException("Not Supported 
            Exception");
        default:
            throw new Exception("Generic Exception - you should never 
            see this");
    }
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.304.1">
     With that, we can
    </span>
    <a id="_idIndexMarker236">
    </a>
    <span class="koboSpan" id="kobo.305.1">
     catch each exception and write it to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.306.1">
      our table:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.307.1">
catch (Exception ex)
{
    Console.WriteLine(ex.Message);
    TableModel entity = new TableModel
    {
        PartitionKey = ex.GetType().Name,
        RowKey = $"TableStorageConsoleApp-{DateTime.UtcNow.
</span><span class="koboSpan" id="kobo.307.2">        ToString("yyyy-MM-ddTHH:mm:ss.fffffffZ")}",
        Message = ex.Message,
        Timestamp = DateTimeOffset.UtcNow
    };
    TableServiceClient tableServiceClient = new 
    TableServiceClient("DefaultEndpointsProtocol=
    https;AccountName=&lt;your account name&gt;;AccountKey=
    &lt;your account key&gt;;EndpointSuffix=core.windows.net");
    var storageTableService = new 
    StorageTableService(tableServiceClient);
    storageTableService.UpsertEntityAsync(entity).Wait();
    Thread.Sleep(2000);
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.308.1">
     There’s quite
    </span>
    <a id="_idIndexMarker237">
    </a>
    <span class="koboSpan" id="kobo.309.1">
     a bit to see here.
    </span>
    <span class="koboSpan" id="kobo.309.2">
     We begin by creating
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.310.1">
      TableModel
     </span>
    </strong>
    <span class="koboSpan" id="kobo.311.1">
     .
    </span>
    <span class="koboSpan" id="kobo.311.2">
     We’ll create that data structure in just
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.312.1">
      a moment.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.313.1">
     Within that model, we’ll have
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.314.1">
      PartitionKey
     </span>
    </strong>
    <span class="koboSpan" id="kobo.315.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.316.1">
      RowKey
     </span>
    </strong>
    <span class="koboSpan" id="kobo.317.1">
     .
    </span>
    <span class="koboSpan" id="kobo.317.2">
     These are critical to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.318.1">
      TableStorage
     </span>
    </strong>
    <span class="koboSpan" id="kobo.319.1">
     .
    </span>
    <span class="koboSpan" id="kobo.319.2">
     Together, they make the unique identifier for each row in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.320.1">
      the table.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.321.1">
     All of the entries with the same
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.322.1">
      PartitionKey
     </span>
    </strong>
    <span class="koboSpan" id="kobo.323.1">
     are clustered, and in that cluster are all their
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.324.1">
      RowKeys
     </span>
    </strong>
    <span class="koboSpan" id="kobo.325.1">
     .
    </span>
    <span class="koboSpan" id="kobo.325.2">
     This makes retrieval infinitely faster.
    </span>
    <span class="koboSpan" id="kobo.325.3">
     Rather than having to scan through all the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.326.1">
      RowKeys
     </span>
    </strong>
    <span class="koboSpan" id="kobo.327.1">
     , retrieval can be achieved by jumping to the right
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.328.1">
      PartitionKey
     </span>
    </strong>
    <span class="koboSpan" id="kobo.329.1">
     and searching
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.330.1">
      from there.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.331.1">
     We also store the exception’s message and the current time as
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.332.1">
      a timestamp.
     </span>
    </span>
   </p>
   <p>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.333.1">
      TableServiceClient
     </span>
    </strong>
    <span class="koboSpan" id="kobo.334.1">
     is supplied by the NuGet package (see requirements at the beginning of this chapter).
    </span>
    <span class="koboSpan" id="kobo.334.2">
     The address you’ll initialize with is supplied by Azure as shown later in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.335.1">
      this chapter.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.336.1">
     We then call
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.337.1">
      UpsertEntityAsync
     </span>
    </strong>
    <span class="koboSpan" id="kobo.338.1">
     , passing in the entity we created earlier, and go to sleep
    </span>
    <a id="_idIndexMarker238">
    </a>
    <span class="koboSpan" id="kobo.339.1">
     for two seconds (the amount of time you sleep is entirely up
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.340.1">
      to you).
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.341.1">
     Please note that you will need your own
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.342.1">
      AccountKey
     </span>
    </strong>
    <span class="koboSpan" id="kobo.343.1">
     and preferably your
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.344.1">
      own
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.345.1">
       accountName
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.346.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-114">
    <a id="_idTextAnchor114">
    </a>
    <span class="koboSpan" id="kobo.347.1">
     TableModel
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.348.1">
     I promised
    </span>
    <a id="_idIndexMarker239">
    </a>
    <span class="koboSpan" id="kobo.349.1">
     earlier to show you the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.350.1">
      TableModel
     </span>
    </strong>
    <span class="koboSpan" id="kobo.351.1">
     .
    </span>
    <span class="koboSpan" id="kobo.351.2">
     It is quite
    </span>
    <a id="_idIndexMarker240">
    </a>
    <span class="koboSpan" id="kobo.352.1">
     simple, just enough to capture the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.353.1">
      essential information:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.354.1">
public class TableModel : ITableEntity
 {
     required public string PartitionKey { get; set; }
     required public string RowKey { get; set; }
     public DateTimeOffset? </span><span class="koboSpan" id="kobo.354.2">Timestamp { get; set; }
     public string? </span><span class="koboSpan" id="kobo.354.3">Message { get; set; }
     public ETag ETag { get; set; } = ETag.All;
 }</span></pre>
   <p>
    <span class="koboSpan" id="kobo.355.1">
     Note that
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.356.1">
      ETag
     </span>
    </strong>
    <span class="koboSpan" id="kobo.357.1">
     must be in every table model.
    </span>
    <span class="koboSpan" id="kobo.357.2">
     This is used for optimistic concurrency during updates.
    </span>
    <span class="koboSpan" id="kobo.357.3">
     We won’t be doing updates and don’t care about this except that it must
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.358.1">
      be there.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-115">
    <a id="_idTextAnchor115">
    </a>
    <span class="koboSpan" id="kobo.359.1">
     StorageTableService
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.360.1">
     The heart
    </span>
    <a id="_idIndexMarker241">
    </a>
    <span class="koboSpan" id="kobo.361.1">
     of the application is
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.362.1">
      StorageTableService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.363.1">
     .
    </span>
    <span class="koboSpan" id="kobo.363.2">
     Here is
    </span>
    <a id="_idIndexMarker242">
    </a>
    <span class="koboSpan" id="kobo.364.1">
     where
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.365.1">
      UpsertEntityAsync
     </span>
    </strong>
    <span class="koboSpan" id="kobo.366.1">
     lives, which does the work of interacting with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.367.1">
      our table:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.368.1">
public async Task&lt;Response&gt; UpsertEntityAsync(TableModel entity)
{
     var response = await _tableCreationTask;
     var table = _tableServiceClient.GetTableClient(response.Value.
</span><span class="koboSpan" id="kobo.368.2">     Name);
     return await table.UpsertEntityAsync(entity);
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.369.1">
     To get started, we declare two member variables at the top of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.370.1">
      the class:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.371.1">
private readonly TableServiceClient _tableServiceClient;
private readonly Task&lt;Response&lt;TableItem&gt;&gt; _tableCreationTask;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.372.1">
     Notice that the second member is of type
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.373.1">
      Task&lt;Response&lt;TableItem&gt;
     </span>
    </strong>
    <span class="koboSpan" id="kobo.374.1">
     .
    </span>
    <span class="koboSpan" id="kobo.374.2">
     Both
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.375.1">
      Response
     </span>
    </strong>
    <span class="koboSpan" id="kobo.376.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.377.1">
      TableItem
     </span>
    </strong>
    <span class="koboSpan" id="kobo.378.1">
     are supplied by the Azure NuGet package.
    </span>
    <span class="koboSpan" id="kobo.378.2">
     The constructor takes
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.379.1">
      TableServiceClient
     </span>
    </strong>
    <span class="koboSpan" id="kobo.380.1">
     (also supplied in the same
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.381.1">
      NuGet package).
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.382.1">
public StorageTableService(TableServiceClient tableServiceClient)
{
     _tableServiceClient = tableServiceClient;
     _tableCreationTask = _tableServiceClient.
</span><span class="koboSpan" id="kobo.382.2">     CreateTableIfNotExistsAsync("ExceptionsTable");
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.383.1">
     It is here that we create the table if it doesn’t exist and name it
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.384.1">
      ExceptionsTable
     </span>
    </strong>
    <span class="koboSpan" id="kobo.385.1">
     (feel free to name yours whatever
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.386.1">
      you like).
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.387.1">
     All
    </span>
    <a id="_idIndexMarker243">
    </a>
    <span class="koboSpan" id="kobo.388.1">
     the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.389.1">
      Upsert
     </span>
    </strong>
    <span class="koboSpan" id="kobo.390.1">
     method needs to do is call
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.391.1">
      tableCreationTask
     </span>
    </strong>
    <span class="koboSpan" id="kobo.392.1">
     and wait to get back
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.393.1">
      Response&lt;TableItem&gt;
     </span>
    </strong>
    <span class="koboSpan" id="kobo.394.1">
     .
    </span>
    <span class="koboSpan" id="kobo.394.2">
     With that
    </span>
    <a id="_idIndexMarker244">
    </a>
    <span class="koboSpan" id="kobo.395.1">
     in hand, it is ready to call
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.396.1">
      GetTableClient
     </span>
    </strong>
    <span class="koboSpan" id="kobo.397.1">
     on
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.398.1">
      TableServiceClient
     </span>
    </strong>
    <span class="koboSpan" id="kobo.399.1">
     , passing in the name of the table.
    </span>
    <span class="koboSpan" id="kobo.399.2">
     Finally, we call
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.400.1">
      UpsertEntityAsync
     </span>
    </strong>
    <span class="koboSpan" id="kobo.401.1">
     on the table passing
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.402.1">
      in
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.403.1">
       TableModel
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.404.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.405.1">
     Please make sure you understand the previous paragraph as it is the heart of working
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.406.1">
      with
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.407.1">
       StorageTables
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.408.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-116">
    <a id="_idTextAnchor116">
    </a>
    <span class="koboSpan" id="kobo.409.1">
     Populating the table in Azure
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.410.1">
     With
    </span>
    <a id="_idIndexMarker245">
    </a>
    <span class="koboSpan" id="kobo.411.1">
     what we’ve written, populating the table in Azure is automatic.
    </span>
    <span class="koboSpan" id="kobo.411.2">
     Run the program; your output should look something like
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.412.1">
       Figure 8
      </span>
     </em>
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.413.1">
       .6
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.414.1">
      .
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer078">
     <span class="koboSpan" id="kobo.415.1">
      <img alt="Figure 8.6 – Generated exceptions" src="image/B21998_08_06.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.416.1">
     Figure 8.6 – Generated exceptions
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.417.1">
     Note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.418.1">
     You’ll need an Azure account for this part.
    </span>
    <span class="koboSpan" id="kobo.418.2">
     As noted earlier, you can get a free starter account at the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.419.1">
      link provided.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.420.1">
     Now, let’s go to Azure and see what
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.421.1">
      we’ve got:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.422.1">
      Log in to your account and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.423.1">
       Home
      </span>
     </strong>
     <span class="koboSpan" id="kobo.424.1">
      and then on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.425.1">
       Storage browser
      </span>
     </strong>
     <span class="koboSpan" id="kobo.426.1">
      , as shown in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.427.1">
       following figure:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer079">
     <span class="koboSpan" id="kobo.428.1">
      <img alt="Figure 8.7 – Storage browser" src="image/B21998_08_07.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.429.1">
     Figure 8.7 – Storage browser
    </span>
   </p>
   <ol>
    <li value="2">
     <span class="koboSpan" id="kobo.430.1">
      From
     </span>
     <a id="_idIndexMarker246">
     </a>
     <span class="koboSpan" id="kobo.431.1">
      there, click on your
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.432.1">
       TableStorage
      </span>
     </strong>
     <span class="koboSpan" id="kobo.433.1">
      account.
     </span>
     <span class="koboSpan" id="kobo.433.2">
      That will bring up a dashboard.
     </span>
     <span class="koboSpan" id="kobo.433.3">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.434.1">
       Tables
      </span>
     </strong>
     <span class="koboSpan" id="kobo.435.1">
      , as shown in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.436.1">
        Figure 8
       </span>
      </em>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.437.1">
        .8
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.438.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer080">
     <span class="koboSpan" id="kobo.439.1">
      <img alt="Figure 8.8 – Selecting tables" src="image/B21998_08_08.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.440.1">
     Figure 8.8 – Selecting tables
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.441.1">
      You should be brought to a page where your tables should be listed as links.
     </span>
     <span class="koboSpan" id="kobo.441.2">
      Click on the table we created.
     </span>
     <span class="koboSpan" id="kobo.441.3">
      The entries that match what we saw in the application will pop up, as shown (in part) in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.442.1">
        Figure 8
       </span>
      </em>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.443.1">
        .9
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.444.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer081">
     <span class="koboSpan" id="kobo.445.1">
      <img alt="Figure 8.9 – The table on Azure" src="image/B21998_08_09.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.446.1">
     Figure 8.9 – The table on Azure
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.447.1">
     Notice
    </span>
    <a id="_idIndexMarker247">
    </a>
    <span class="koboSpan" id="kobo.448.1">
     that the entries are not in the order in which they were created.
    </span>
    <span class="koboSpan" id="kobo.448.2">
     Rather, they are clustered by
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.449.1">
      PartitionKey
     </span>
    </strong>
    <span class="koboSpan" id="kobo.450.1">
     , as
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.451.1">
      described earlier.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.452.1">
     Shockingly, that’s all there is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.453.1">
      to it.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-117">
    <a id="_idTextAnchor117">
    </a>
    <span class="koboSpan" id="kobo.454.1">
     Introducing Microsoft Aspire
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.455.1">
     Microsoft has
    </span>
    <a id="_idIndexMarker248">
    </a>
    <span class="koboSpan" id="kobo.456.1">
     introduced Aspire, which it describes as
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.457.1">
      opinionated, cloud ready stack for building observable, Production-ready, distributed applications.
     </span>
    </em>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.458.1">
      Say what?
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.459.1">
     In this case,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.460.1">
      opinionated
     </span>
    </em>
    <span class="koboSpan" id="kobo.461.1">
     means that there are conventions and templates to make life easier.
    </span>
    <span class="koboSpan" id="kobo.461.2">
     With this and all things, you can customize, but the more you follow the conventions, the easier it is to write, and perhaps more important, to read
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.462.1">
      your code.
     </span>
    </span>
   </p>
   <p>
    <em class="italic">
     <span class="koboSpan" id="kobo.463.1">
      Cloud-ready stack
     </span>
    </em>
    <span class="koboSpan" id="kobo.464.1">
     indicates that you will be working locally but on code that can easily be moved to the cloud (read Azure).
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.465.1">
      Production-ready
     </span>
    </em>
    <span class="koboSpan" id="kobo.466.1">
     indicates that what you build will be non-trivial and ready to roll out, and
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.467.1">
      distributed
     </span>
    </em>
    <span class="koboSpan" id="kobo.468.1">
     means that you will be creating micro-services hosted in containers, in our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.469.1">
      case, Docker.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.470.1">
     Aspire provides
    </span>
    <a id="_idIndexMarker249">
    </a>
    <span class="koboSpan" id="kobo.471.1">
     you with a number of services that you could write yourself, but no longer have to.
    </span>
    <span class="koboSpan" id="kobo.471.2">
     Instead, you get fully tested code
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.472.1">
      automagically
     </span>
    </em>
    <span class="koboSpan" id="kobo.473.1">
     that provides, among other things, storage, messaging, and web services, and that can also provide interoperability with databases, caching,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.474.1">
      and more.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.475.1">
     Note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.476.1">
     You can use Aspire with Visual Studio Code or even the .NET CLI, but we’ll stick with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.477.1">
      Visual Studio.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-118">
    <a id="_idTextAnchor118">
    </a>
    <span class="koboSpan" id="kobo.478.1">
     Sample program
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.479.1">
     Aspire is
    </span>
    <a id="_idIndexMarker250">
    </a>
    <span class="koboSpan" id="kobo.480.1">
     very powerful, but it can be tricky to get all the pieces in place.
    </span>
    <span class="koboSpan" id="kobo.480.2">
     We
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.481.1">
      could
     </span>
    </em>
    <span class="koboSpan" id="kobo.482.1">
     write our own sample program, but that would be silly since Microsoft supplies one that you can create with just a few keystrokes in Visual Studio.
    </span>
    <span class="koboSpan" id="kobo.482.2">
     To get started, follow
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.483.1">
      these steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.484.1">
      Create a new project and select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.485.1">
       .NET Aspire Starter Application
      </span>
     </strong>
     <span class="koboSpan" id="kobo.486.1">
      .
     </span>
     <span class="koboSpan" id="kobo.486.2">
      Be sure to choose the one for C#, as shown in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.487.1">
        Figure 8
       </span>
      </em>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.488.1">
        .10
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.489.1">
       :
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer082">
     <span class="koboSpan" id="kobo.490.1">
      <img alt="Figure 8.10 - Choosing Aspire" src="image/B21998_08_10.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.491.1">
     Figure 8.10 - Choosing Aspire
    </span>
   </p>
   <ol>
    <li value="2">
     <span class="koboSpan" id="kobo.492.1">
      Enter a
     </span>
     <a id="_idIndexMarker251">
     </a>
     <span class="koboSpan" id="kobo.493.1">
      project name (I’ll use
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.494.1">
       AspirePackt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.495.1">
      ) and leave the rest of the values as
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.496.1">
       their defaults.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.497.1">
      On the next page, make sure you select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.498.1">
       .NET 8
      </span>
     </strong>
     <span class="koboSpan" id="kobo.499.1">
      and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.500.1">
       Use Redis for caching
      </span>
     </strong>
     <span class="koboSpan" id="kobo.501.1">
      , and while you always should create unit tests, we’ll skip that for now (in a “real” application, you want those unit tests), as shown in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.502.1">
        Figure 8
       </span>
      </em>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.503.1">
        .11
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.504.1">
       :
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer083">
     <span class="koboSpan" id="kobo.505.1">
      <img alt="Figure 8.11 – Selecting the frameworks" src="image/B21998_08_11.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.506.1">
     Figure 8.11 – Selecting the frameworks
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.507.1">
     Here’s what we’re going to see: a sample weather app that supports caching.
    </span>
    <span class="koboSpan" id="kobo.507.2">
     It will get the weather through an API, using random,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.508.1">
      demonstration values.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.509.1">
      Start the app up and the first thing that will happen is that the .NET Aspire dashboard will open in your browser, as partly shown in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.510.1">
        Figure 8
       </span>
      </em>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.511.1">
        .12
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.512.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer084">
     <span class="koboSpan" id="kobo.513.1">
      <img alt="Figure 8.12 – Aspire dashboard" src="image/B21998_08_12.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.514.1">
     Figure 8.12 – Aspire dashboard
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.515.1">
     This was
    </span>
    <a id="_idIndexMarker252">
    </a>
    <span class="koboSpan" id="kobo.516.1">
     all created for you in the sample program, which also created a Blazor application that will be used to display the data retrieved by
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.517.1">
      the API.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.518.1">
     Notice that the third line’s project in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.519.1">
       Figure 8
      </span>
     </em>
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.520.1">
      .13
     </span>
    </em>
    <span class="koboSpan" id="kobo.521.1">
     is
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.522.1">
      webfrontend
     </span>
    </strong>
    <span class="koboSpan" id="kobo.523.1">
     .
    </span>
    <span class="koboSpan" id="kobo.523.2">
     Click on the URL and you are brought to the iconic
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.524.1">
      Hello, world!
     </span>
    </strong>
    <span class="koboSpan" id="kobo.525.1">
     page.
    </span>
    <span class="koboSpan" id="kobo.525.2">
     On the left are three buttons, as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.526.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer085">
     <span class="koboSpan" id="kobo.527.1">
      <img alt="Figure 8.13 – The running application" src="image/B21998_08_13.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.528.1">
     Figure 8.13 – The running application
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.529.1">
     Now click
    </span>
    <a id="_idIndexMarker253">
    </a>
    <span class="koboSpan" id="kobo.530.1">
     on the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.531.1">
      Weather
     </span>
    </strong>
    <span class="koboSpan" id="kobo.532.1">
     option and
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.533.1">
      voilà
     </span>
    </em>
    <span class="koboSpan" id="kobo.534.1">
     !
    </span>
    <span class="koboSpan" id="kobo.534.2">
     The API is hit, and the weather data is displayed, as shown in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.535.1">
       Figure 8
      </span>
     </em>
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.536.1">
       .14
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.537.1">
      .
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer086">
     <span class="koboSpan" id="kobo.538.1">
      <img alt="Figure 8.14 – The displayed weather from the API" src="image/B21998_08_14.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.539.1">
     Figure 8.14 – The displayed weather from the API
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.540.1">
     If you refresh the screen a few times, you’ll see that it is instantly responsive as it is using the cache.
    </span>
    <span class="koboSpan" id="kobo.540.2">
     After about 10 seconds, it will generate
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.541.1">
      new data.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-119">
    <a id="_idTextAnchor119">
    </a>
    <span class="koboSpan" id="kobo.542.1">
     Exploring the Aspire dashboard
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.543.1">
     Going back to
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.544.1">
       Figure 8
      </span>
     </em>
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.545.1">
      .12
     </span>
    </em>
    <span class="koboSpan" id="kobo.546.1">
     , we see a number of useful features.
    </span>
    <span class="koboSpan" id="kobo.546.2">
     Click on
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.547.1">
      Resources
     </span>
    </strong>
    <span class="koboSpan" id="kobo.548.1">
     , for example, to see a list of information for all the .NET projects in your application.
    </span>
    <span class="koboSpan" id="kobo.548.2">
     These
    </span>
    <a id="_idIndexMarker254">
    </a>
    <span class="koboSpan" id="kobo.549.1">
     include the app state, endpoints, and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.550.1">
      environment variables.
     </span>
    </span>
   </p>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.551.1">
      Console
     </span>
    </strong>
    <span class="koboSpan" id="kobo.552.1">
     displays (surprise!) the console output from
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.553.1">
      each project.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.554.1">
     The
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.555.1">
      Structured
     </span>
    </strong>
    <span class="koboSpan" id="kobo.556.1">
     option displays logs as tables.
    </span>
    <span class="koboSpan" id="kobo.556.2">
     You can filter and search (either free-form or filtered).
    </span>
    <span class="koboSpan" id="kobo.556.3">
     You can expand the details for each entry by clicking on the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.557.1">
      View
     </span>
    </strong>
    <span class="koboSpan" id="kobo.558.1">
     button on the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.559.1">
      far right.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.560.1">
     The
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.561.1">
      Traces
     </span>
    </strong>
    <span class="koboSpan" id="kobo.562.1">
     button displays the request paths throughout your application.
    </span>
    <span class="koboSpan" id="kobo.562.2">
     Locate a request for
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.563.1">
      Weather
     </span>
    </strong>
    <span class="koboSpan" id="kobo.564.1">
     and select
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.565.1">
      View
     </span>
    </strong>
    <span class="koboSpan" id="kobo.566.1">
     .
    </span>
    <span class="koboSpan" id="kobo.566.2">
     The dashboard will display the request
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.567.1">
      in stages.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.568.1">
     Click on
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.569.1">
      ApiService | View
     </span>
    </strong>
    <span class="koboSpan" id="kobo.570.1">
     and you’ll see the time it took to hit the API.
    </span>
    <span class="koboSpan" id="kobo.570.2">
     Click on
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.571.1">
      View
     </span>
    </strong>
    <span class="koboSpan" id="kobo.572.1">
     on the right and the resources are displayed in detail.
    </span>
    <span class="koboSpan" id="kobo.572.2">
     Scroll down to see
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.573.1">
      more details.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.574.1">
     Finally, the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.575.1">
      Metrics
     </span>
    </strong>
    <span class="koboSpan" id="kobo.576.1">
     button will display instruments and meters, as they are available for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.577.1">
      your application.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-120">
    <a id="_idTextAnchor120">
    </a>
    <span class="koboSpan" id="kobo.578.1">
     What have you learned, Dorothy?
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.579.1">
     As you can see, the sample application consists of a number of projects.
    </span>
    <span class="koboSpan" id="kobo.579.2">
     The first, perhaps most
    </span>
    <a id="_idIndexMarker255">
    </a>
    <span class="koboSpan" id="kobo.580.1">
     essential is the app host, which acts as the orchestrator.
    </span>
    <span class="koboSpan" id="kobo.580.2">
     It will automatically set
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.581.1">
      IsAspireHost
     </span>
    </strong>
    <span class="koboSpan" id="kobo.582.1">
     in the project file
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.583.1">
      to true.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.584.1">
     Pour through the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.585.1">
      Program.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.586.1">
     file and you’ll see what you’d expect as an API developer, along with Aspire in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.587.1">
      APIService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.588.1">
     (and a couple of things added
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.589.1">
      for Blazor).
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.590.1">
     Note that the first line creates
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.591.1">
      DistributedApplication
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.592.1">
      using Docker.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.593.1">
     A critical line in this file is
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.594.1">
      AspirePackt.ApiService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.595.1">
     , which configures the service discovery and communication among the projects in your solution.
    </span>
    <span class="koboSpan" id="kobo.595.2">
     The name (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.596.1">
      apiservice
     </span>
    </strong>
    <span class="koboSpan" id="kobo.597.1">
     ) identifies the project and is used by projects that want to communicate
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.598.1">
      with it.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.599.1">
     Another important and universal project is
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.600.1">
      ServiceDefaults
     </span>
    </strong>
    <span class="koboSpan" id="kobo.601.1">
     , which is a shared project that manages configurations so that they can be used across projects.
    </span>
    <span class="koboSpan" id="kobo.601.2">
     This allows the application to have all the services share service discovery, telemetry,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.602.1">
      and more.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-121">
    <a id="_idTextAnchor121">
    </a>
    <span class="koboSpan" id="kobo.603.1">
     Adding Aspire to an existing app
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.604.1">
     We all love green-field projects, but the reality is that most of the time we’re working with
    </span>
    <a id="_idIndexMarker256">
    </a>
    <span class="koboSpan" id="kobo.605.1">
     existing code.
    </span>
    <span class="koboSpan" id="kobo.605.2">
     Aspire would not be very interesting if it only worked from scratch, but fortunately, you can add Aspire to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.606.1">
      existing applications.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.607.1">
     We could add Aspire to our car application, but once again, Microsoft assists, providing a reasonably complex application for us to work with.
    </span>
    <span class="koboSpan" id="kobo.607.2">
     To get started, clone their application by using the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.608.1">
      following command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.609.1">
git clone https://github.com/MicrosoftDocs/mslearn-dotnet-cloudnative-devops.git eShopLite</span></pre>
   <p>
    <span class="koboSpan" id="kobo.610.1">
     This sample consists of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.611.1">
      three projects:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.612.1">
      Data Entities is a class library that defines the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.613.1">
        Product
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.614.1">
       class
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.615.1">
       Products
      </span>
     </strong>
     <span class="koboSpan" id="kobo.616.1">
      is a web API that returns a list of all the Products in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.617.1">
       store’s catalog
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.618.1">
       Store
      </span>
     </strong>
     <span class="koboSpan" id="kobo.619.1">
      is a Blazor web app that displays the products on
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.620.1">
       a website
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.621.1">
     Note that we will not be focusing on Blazor.
    </span>
    <span class="koboSpan" id="kobo.621.2">
     We will use it only as far as it is part of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.622.1">
      this example
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-122">
    <a id="_idTextAnchor122">
    </a>
    <span class="koboSpan" id="kobo.623.1">
     Getting oriented with our new project
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.624.1">
     Let’s take
    </span>
    <a id="_idIndexMarker257">
    </a>
    <span class="koboSpan" id="kobo.625.1">
     a look at what the new project (out of the box) looks like.
    </span>
    <span class="koboSpan" id="kobo.625.2">
     To do so, follow these steps to create our “existing” project that we will add
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.626.1">
      Aspire to:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.627.1">
      Open
     </span>
     <a href="http://eShopLite.sln">
      <span class="koboSpan" id="kobo.628.1">
       eShopLite.sln
      </span>
     </a>
     <span class="koboSpan" id="kobo.629.1">
      .
     </span>
     <span class="koboSpan" id="kobo.629.2">
      Right-click on the solution and select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.630.1">
       Configure
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.631.1">
        Startup Projects
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.632.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.633.1">
      Choose multiple startup projects and in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.634.1">
       Action
      </span>
     </strong>
     <span class="koboSpan" id="kobo.635.1">
      column, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.636.1">
       S
      </span>
     </strong>
     <strong class="bold">
      <span class="koboSpan" id="kobo.637.1">
       tart
      </span>
     </strong>
     <span class="koboSpan" id="kobo.638.1">
      for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.639.1">
       Products and Store
      </span>
     </strong>
     <span class="koboSpan" id="kobo.640.1">
      , as shown in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.641.1">
       following figure:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer087">
     <span class="koboSpan" id="kobo.642.1">
      <img alt="Figure 8.15 – Setting the startup projects" src="image/B21998_08_15.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.643.1">
     Figure 8.15 – Setting the startup projects
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.644.1">
      Fire it up
     </span>
     <a id="_idIndexMarker258">
     </a>
     <span class="koboSpan" id="kobo.645.1">
      by pressing
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.646.1">
       F5
      </span>
     </em>
     <span class="koboSpan" id="kobo.647.1">
      and note that two browser pages open.
     </span>
     <span class="koboSpan" id="kobo.647.2">
      One page has the raw JSON and the second page is a simple browser application that lets you view that data (click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.648.1">
       Products
      </span>
     </strong>
     <span class="koboSpan" id="kobo.649.1">
      ), as shown in part in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.650.1">
        Figure 8
       </span>
      </em>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.651.1">
        .15
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.652.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer088">
     <span class="koboSpan" id="kobo.653.1">
      <img alt="Figure 8.16 – The raw JSON" src="image/B21998_08_16.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.654.1">
     Figure 8.16 – The raw JSON
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.655.1">
     At the top
    </span>
    <a id="_idIndexMarker259">
    </a>
    <span class="koboSpan" id="kobo.656.1">
     of the JSON is a checkbox for pretty print.
    </span>
    <span class="koboSpan" id="kobo.656.2">
     That will take this raw JSON and make it more readable, as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.657.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer089">
     <span class="koboSpan" id="kobo.658.1">
      <img alt="Figure 8.17 – Pretty print" src="image/B21998_08_17.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.659.1">
     Figure 8.17 – Pretty print
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.660.1">
     Blazor will give you a web-based view of that same data, as shown in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.661.1">
       Figure 8
      </span>
     </em>
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.662.1">
       .18
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.663.1">
      :
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer090">
     <span class="koboSpan" id="kobo.664.1">
      <img alt="Figure 8.18 – The browser display of the products" src="image/B21998_08_18.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.665.1">
     Figure 8.18 – The browser display of the products
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.666.1">
     Now that
    </span>
    <a id="_idIndexMarker260">
    </a>
    <span class="koboSpan" id="kobo.667.1">
     we have a working application, let’s refactor it to add Aspire.
    </span>
    <span class="koboSpan" id="kobo.667.2">
     We’ll do
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.668.1">
      that next.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-123">
    <a id="_idTextAnchor123">
    </a>
    <span class="koboSpan" id="kobo.669.1">
     Adding Aspire
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.670.1">
     Now that
    </span>
    <a id="_idIndexMarker261">
    </a>
    <span class="koboSpan" id="kobo.671.1">
     we have a working API solution, let’s add Aspire.
    </span>
    <span class="koboSpan" id="kobo.671.2">
     To do so, follow
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.672.1">
      these steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.673.1">
      Right-click on one of the projects (I’ll use
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.674.1">
       Store
      </span>
     </strong>
     <span class="koboSpan" id="kobo.675.1">
      ) and select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.676.1">
       Add
      </span>
     </strong>
     <span class="koboSpan" id="kobo.677.1">
      |
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.678.1">
       .Net Aspire Orchestrator Support
      </span>
     </strong>
     <span class="koboSpan" id="kobo.679.1">
      .
     </span>
     <span class="koboSpan" id="kobo.679.2">
      That brings up the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.680.1">
       dialog box.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.681.1">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.682.1">
       OK
      </span>
     </strong>
     <span class="koboSpan" id="kobo.683.1">
      and two new projects are added to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.684.1">
       your solution:
      </span>
     </span>
     <ul>
      <li>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.685.1">
          eShopLiteAppHost
         </span>
        </strong>
       </span>
      </li>
      <li>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.686.1">
          eShopLite.ServiceDefaults
         </span>
        </strong>
       </span>
      </li>
     </ul>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.687.1">
     Spend a few minutes exploring these projects.
    </span>
    <span class="koboSpan" id="kobo.687.2">
     The first,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.688.1">
      eShopLiteAppHost
     </span>
    </strong>
    <span class="koboSpan" id="kobo.689.1">
     , is an orchestrator project whose job is to connect (and configure) the various projects and services of your application.
    </span>
    <span class="koboSpan" id="kobo.689.2">
     It is automatically set as the startup project.
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.690.1">
      eShopServiceDefaults
     </span>
    </strong>
    <span class="koboSpan" id="kobo.691.1">
     holds configurations that will be used across projects, especially service discovery and telemetry (more about
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.692.1">
      these shortly).
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.693.1">
      Next, open
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.694.1">
       Program.cs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.695.1">
      in
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.696.1">
       AppHost
      </span>
     </strong>
     <span class="koboSpan" id="kobo.697.1">
      , where you will see
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.698.1">
       this code:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.699.1">
builder.AddProject&lt;Projects.Store&gt;("store");</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.700.1">
       This registers the store project in the orchestrator.
      </span>
      <span class="koboSpan" id="kobo.700.2">
       We now need to register the
      </span>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.701.1">
         Products
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.702.1">
        project.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.703.1">
      Right-click
     </span>
     <a id="_idIndexMarker262">
     </a>
     <span class="koboSpan" id="kobo.704.1">
      on it and select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.705.1">
       Add
      </span>
     </strong>
     <span class="koboSpan" id="kobo.706.1">
      |
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.707.1">
       .NET Aspire Orchestrator Support
      </span>
     </strong>
     <span class="koboSpan" id="kobo.708.1">
      .
     </span>
     <span class="koboSpan" id="kobo.708.2">
      You’ll get a dialog saying the orchestrator already exists; just
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.709.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.710.1">
        OK
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.711.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.712.1">
      Go back to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.713.1">
       AppHost
      </span>
     </strong>
     <span class="koboSpan" id="kobo.714.1">
      /
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.715.1">
       Program.cs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.716.1">
      and you can see that another line has been added, as you
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.717.1">
       might expect:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.718.1">
builder.AddProject&lt;Projects.Products&gt;("Products");</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.719.1">
     Now comes the fun part.
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.720.1">
      Store
     </span>
    </strong>
    <span class="koboSpan" id="kobo.721.1">
     needs to be able to find
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.722.1">
      Products
     </span>
    </strong>
    <span class="koboSpan" id="kobo.723.1">
     ’ backend address.
    </span>
    <span class="koboSpan" id="kobo.723.2">
     Rather than doing this by hand, we turn that responsibility over to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.724.1">
      the orchestrator.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.725.1">
     Discovery
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.726.1">
     While both
    </span>
    <a id="_idIndexMarker263">
    </a>
    <span class="koboSpan" id="kobo.727.1">
     projects are registered with the orchestrator,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.728.1">
      Store
     </span>
    </strong>
    <span class="koboSpan" id="kobo.729.1">
     needs to be able to discover the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.730.1">
      Products
     </span>
    </strong>
    <span class="koboSpan" id="kobo.731.1">
     ’ backend address.
    </span>
    <span class="koboSpan" id="kobo.731.2">
     To enable discovery, return to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.732.1">
      Program.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.733.1">
     and add a reference to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.734.1">
      Products
     </span>
    </strong>
    <span class="koboSpan" id="kobo.735.1">
     project.
    </span>
    <span class="koboSpan" id="kobo.735.2">
     Your
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.736.1">
      program.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.737.1">
     file should now look
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.738.1">
      like this:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.739.1">
var builder = DistributedApplication.CreateBuilder(args);
var Products = builder.AddProject&lt;Projects.Products&gt;("Products");
builder.AddProject&lt;Projects.Store&gt;("store")
       .WithExternalHttpEndpoints()
       .WithReference(Products);
builder.Build().Run();</span></pre>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.740.1">
     Note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.741.1">
     If you want to deploy this application, you’ll need to call
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.742.1">
      WithExternalHttpEndpoints
     </span>
    </strong>
    <span class="koboSpan" id="kobo.743.1">
     to make sure it is public to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.744.1">
      outside world.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.745.1">
     Almost done.
    </span>
    <span class="koboSpan" id="kobo.745.2">
     We need
    </span>
    <a id="_idIndexMarker264">
    </a>
    <span class="koboSpan" id="kobo.746.1">
     to update
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.747.1">
      appsettings.json
     </span>
    </strong>
    <span class="koboSpan" id="kobo.748.1">
     in the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.749.1">
       Store
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.750.1">
      project:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.751.1">
{
  "DetailedErrors": true,
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*",
  "ProductEndpoint": "http://Products",
  "ProductEndpointHttps": "https://Products"
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.752.1">
     The addresses for both endpoints now use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.753.1">
      Products
     </span>
    </strong>
    <span class="koboSpan" id="kobo.754.1">
     name.
    </span>
    <span class="koboSpan" id="kobo.754.2">
     Note that these names are used to discover the address of the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.755.1">
       Products
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.756.1">
      project.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.757.1">
     Press
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.758.1">
      F5
     </span>
    </em>
    <span class="koboSpan" id="kobo.759.1">
     to run it.
    </span>
    <span class="koboSpan" id="kobo.759.2">
     You’ve added Aspire, with all its features and dashboard, to your existing
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.760.1">
      API project.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-124">
    <a id="_idTextAnchor124">
    </a>
    <span class="koboSpan" id="kobo.761.1">
     Summary
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.762.1">
     In this chapter, you learned about three very powerful, advanced techniques.
    </span>
    <span class="koboSpan" id="kobo.762.2">
     First, we looked at creating more complex APIs that return hierarchical data.
    </span>
    <span class="koboSpan" id="kobo.762.3">
     We did this by adding and presenting options for each
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.763.1">
      car type.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.764.1">
     Next, we looked at Azure Storage Tables, a lightweight way to store data on Azure, side-stepping the complexity of Entity Framework
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.765.1">
      and Cosmos.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.766.1">
     Finally, we went on to look at Microsoft’s Aspire dashboard, a very powerful and useful tool for working
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.767.1">
      with APIs.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.768.1">
     In the next chapter, we’ll look at the critical issue of authentication and authorization, without which you cannot create an
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.769.1">
      enterprise API.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-125">
    <a id="_idTextAnchor125">
    </a>
    <span class="koboSpan" id="kobo.770.1">
     You try it
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.771.1">
     Creating an Aspire dashboard is pretty straightforward out of the box, but creating hierarchical data is not.
    </span>
    <span class="koboSpan" id="kobo.771.2">
     To take on a challenge, create a program that displays a few states and with them their principal cities.
    </span>
    <span class="koboSpan" id="kobo.771.3">
     The result might look something
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.772.1">
      like this:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.773.1">
{
    "statePostalCode": MA,
    "name": "Massachusetts",
    "capital": Boston,
    "cities": [
        {
            "city" : "Worchester",
            "longitude": "100.01.93",
            "latitude": -907-45-33
        },
        {
            "city": Acton,
            "longitude": "100.01.107",
            "latitude": -10-398-405
        },
    ]
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.774.1">
     Feel free to make up the longitude and latitude, or look it up online.
    </span>
    <span class="koboSpan" id="kobo.774.2">
     You’ll want at least two to three cities and two to three states.
    </span>
    <span class="koboSpan" id="kobo.774.3">
     Once you have your structure, save it as a flat file in an Azure
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.775.1">
      Storage Table.
     </span>
    </span>
   </p>
  </div>
 </body></html>