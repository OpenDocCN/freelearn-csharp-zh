<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer119">
			<h1 id="_idParaDest-124"><em class="italic"><a id="_idTextAnchor123"/>Chapter 8</em>: Story API – Accessing ink Variables and Functions</h1>
			<p>In this chapter, we will discuss how to use the ink Unity API to work with variables and functions. Any variables or functions defined in ink can be accessed from any point in its code. The API provided by the ink-Unity Integration plugin provides an interface through its <strong class="source-inline">variablesState</strong> property to access any defined variables. This is also true of a method provided by the <strong class="source-inline">EvaluateFunction()</strong> API, which can access any functions defined in the ink code. Understanding this functionality is key to creating more complex projects by using the ink-Unity Integration plugin as a bridge between an ink story and Unity code.</p>
			<p>In this chapter, we will cover the following main topics:</p>
			<ul>
				<li>Changing ink variables outside a story</li>
				<li>Calling ink functions externally</li>
				<li>Controlling a story through variables and functions</li>
			</ul>
			<h1 id="_idParaDest-125"><a id="_idTextAnchor124"/>Technical requirements</h1>
			<p>The examples used in this chapter, in the <strong class="source-inline">*.cs</strong> and <strong class="source-inline">*.ink</strong> files, can be found on GitHub at <a href="https://github.com/PacktPublishing/Dynamic-Story-Scripting-with-the-ink-Scripting-Language/tree/main/Chapter8">https://github.com/PacktPublishing/Dynamic-Story-Scripting-with-the-ink-Scripting-Language/tree/main/Chapter8</a>.</p>
			<h1 id="_idParaDest-126"><a id="_idTextAnchor125"/>Changing ink variables outside a story</h1>
			<p><strong class="bold">Variables</strong> were <a id="_idIndexMarker327"/>first introduced in <a href="B17597_04_Final_PG_ePub.xhtml#_idTextAnchor062"><em class="italic">Chapter 4</em></a>, <em class="italic">Variables, Lists, and Functions</em>. In ink, variables are created using the <strong class="source-inline">VAR</strong> keyword and an initial value. Throughout a story, the value of a variable can be changed. By comparing their values, variables can also influence the flow of a story.</p>
			<p>Variables are <em class="italic">global</em> in ink. Once created, they can be accessed by any other part of the code within the same story. This functionality is also carried over into a named property as part of the ink-Unity Integration plugin, called <strong class="source-inline">variablesState</strong>. Every variable defined in an Ink story can be accessed by using its name.</p>
			<p>In this topic, we will examine how to use this property to access and change values in a running ink story. We will begin by looking at how to use the <strong class="source-inline">variablesState</strong> property and comparing values in ink to control its flow outside the story.</p>
			<h2 id="_idParaDest-127"><a id="_idTextAnchor126"/>Accessing ink variables</h2>
			<p>The Story API in<a id="_idIndexMarker328"/> Unity provides access to ink variables. In this section, we will explore the <strong class="source-inline">variablesState</strong> property and how to access an ink variable by its name. Perform the following steps:</p>
			<ol>
				<li>Start by creating a new project in Unity based on the 2D built-in template. </li>
				<li>Import the ink-Unity Integration plugin.</li>
				<li>Add a new ink file and rename it <strong class="source-inline">InkVariables.ink</strong>. <p>The file that is created will hold the ink source code. Because the ink-Unity Integration plugin runs compiled ink stories, the source code for a story must exist before the API can be used to access and run its contents:</p><div id="_idContainer107" class="IMG---Figure"><img src="Images/Figure_8.1_B17597.jpg" alt="Figure 8.1 – The project window showing the InkVariables.ink file&#13;&#10;" width="358" height="183"/></div><p class="figure-caption">Figure 8.1 – The project window showing the InkVariables.ink file</p></li>
				<li>Open the <strong class="source-inline">InkVariables.ink</strong> file for editing in Inky.</li>
				<li>Change<a id="_idIndexMarker329"/> the contents to the <strong class="source-inline">Example 1 (InkVariables.ink)</strong> file. </li>
				<li>Save the file and return to Unity.<p class="callout-heading">Reminder</p><p class="callout">The automatic recompilation of ink source files can be changed by visiting the <strong class="bold">Project Settings</strong> window. You can do this by clicking on <strong class="bold">Edit</strong> and then <strong class="bold">Project Settings</strong>. Clicking on <strong class="bold">Ink</strong> and then changing the <strong class="bold">Compile All Ink Automatically</strong> setting allows you to update this value. If enabled, the plugin will automatically create a JSON file.</p></li>
				<li>Create a new, empty game object and name it <strong class="source-inline">InkStory</strong>.</li>
				<li>Create a new <strong class="source-inline">Script</strong> component in the <strong class="source-inline">InkStory</strong> game object and name the new C# file <strong class="source-inline">InkStoryScript.cs</strong>.</li>
				<li>Open the <strong class="source-inline">InkStoryScript.cs</strong> file for editing in Visual Studio.</li>
				<li>Update the <strong class="source-inline">InkStoryScript.cs</strong> file to <strong class="source-inline">Example</strong> <strong class="source-inline">1</strong> <strong class="source-inline">(InkStoryScript.cs)</strong>.<p>The updated code uses the <strong class="source-inline">GetVariableWithName()</strong> method as part of the <strong class="source-inline">VariablesState</strong> object. The <strong class="source-inline">variablesState</strong> property is used with the name of the variable in ink, <strong class="source-inline">number_example</strong>, as part of the <strong class="source-inline">GetVariableWithName()</strong> method. Additionally, the <strong class="source-inline">Debug.Log()</strong> method is used to display the value of the variable in the <strong class="bold">Console</strong> window when run in Unity.</p></li>
				<li>Associate the file with the code. You can do this using either the <strong class="bold">Select TextAsset</strong> window or by dragging and dropping the compiled JSON file into the new <strong class="source-inline">Ink JSON File</strong> property inside the <strong class="source-inline">Script</strong> component.</li>
				<li>Run the project in Unity.<p>Once the project starts running, open the <strong class="bold">Console</strong> window. A new message will have <a id="_idIndexMarker330"/>been added:</p><div id="_idContainer108" class="IMG---Figure"><img src="Images/Figure_8.2_B17597.jpg" alt="Figure 8.2 – The console window showing the value of the ink variable &#13;&#10;" width="403" height="148"/></div><p class="figure-caption">Figure 8.2 – The console window showing the value of the ink variable </p></li>
				<li>Stop the running project in Unity.</li>
			</ol>
			<p>If variables are defined before the first text content in ink, they are also loaded <em class="italic">before</em> the content. In <em class="italic">Example 1</em>, as is evident from <em class="italic">Step 8</em>, the initial values of the variables can be accessed immediately after loading an ink story. The functionality for accessing variables is separate from the functionality of loading and displaying text content.</p>
			<p>Any ink variable that is able to be accessed can also be changed. In the next section, we will discover how this functionality is key to using the <strong class="source-inline">variablesState</strong> property, as part of the Ink API, and how it allows you to create more complex projects in Unity when using the ink-Unity Integration plugin.</p>
			<h2 id="_idParaDest-128"><a id="_idTextAnchor127"/>Changing the value of the ink variables</h2>
			<p>The English <a id="_idIndexMarker331"/>word "variable" means <em class="italic">able to be changed</em>. All ink variables, once created, can be changed at any point. The <strong class="source-inline">variablesState</strong> property follows the same pattern. If a variable can be accessed, its value can be changed.</p>
			<p>The <strong class="source-inline">VariablesState</strong> class contains multiple methods in which to access and change the values of the variables within an ink story. However, it also contains a shorthand access operator using square brackets and the name of the variable in quotation marks. Often, this shorthand is used rather than directly using method names to change the values of variables within the <strong class="source-inline">variablesState</strong> property.</p>
			<p>Now, return to the project that we used as part of the <em class="italic">Accessing Ink variables</em> section. Perform the following steps:</p>
			<ol>
				<li value="1">Open the <strong class="source-inline">InkStoryScript.cs</strong> file for editing in Visual Studio.</li>
				<li>Change the existing code to <strong class="source-inline">Example 2 (InkStoryScript.cs)</strong>. </li>
				<li>Save the<a id="_idIndexMarker332"/> file and return to Unity.</li>
				<li>Run the project.<p>The <strong class="bold">Console</strong> window will show an updated message. Instead of showing the initial value of the variable, it will show an updated value:</p><div id="_idContainer109" class="IMG---Figure"><img src="Images/Figure_8.3_B17597.jpg" alt="Figure 8.3 – The updated value of the ink variable in the Console window" width="390" height="147"/></div><p class="figure-caption">Figure 8.3 – The updated value of the ink variable in the Console window</p><p>Once a story has been loaded, the values of its variables exist within the <strong class="source-inline">variablesState</strong> property. Any changes to these values are reflected in the next use of the <strong class="source-inline">Continue()</strong> or <strong class="source-inline">ContinueMaximally()</strong> methods.</p></li>
				<li>Stop the running project in Unity.</li>
			</ol>
			<p>Variables are not the only values that can be accessed from outside an ink story. The ink-Unity Integration plugin also adds the ability to call functions in ink from Unity. While accessing and changing the values of variables can be helpful, directly calling functions in ink and passing them values from Unity is often the preferred way in which to approach the exchange of data between Unity and ink. In the next section, we will review why using functions is frequently the better option for complex data or for when you want to<a id="_idIndexMarker333"/> process multiple values as part of the same task in ink.</p>
			<h1 id="_idParaDest-129"><a id="_idTextAnchor128"/>Calling ink functions externally</h1>
			<p>As with <a id="_idIndexMarker334"/>variables, functions are also global in ink. This means they can be accessed as part of any ink code that is part of the same story. As part of the Unity API provided by the <strong class="source-inline">Story</strong> class, the <strong class="source-inline">EvaluateFunction()</strong> method calls a function in the ink code based on the name passed to it. Because functions in ink are global, they can be called from outside the story itself. However, unlike working with the <strong class="source-inline">variablesState</strong> property and only accessing a single value, multiple values can be passed to an ink function at one time. Additionally, the <strong class="source-inline">EvaluateFunction()</strong> method can be configured to return the text output within the ink function or any returning data, too.</p>
			<p>In this section, we will begin by testing whether an ink function exists using the <strong class="source-inline">HasFunction()</strong> method. Next, we will examine how the <strong class="source-inline">EvaluateFunction()</strong> method is the preferred option for complex data or multiple data values when communicating between Unity and ink. Finally, we will review examples of how to use the text result and return data from an ink function within Unity code.</p>
			<h2 id="_idParaDest-130"><a id="_idTextAnchor129"/>Verifying and evaluating ink functions</h2>
			<p>When <a id="_idIndexMarker335"/>working <a id="_idIndexMarker336"/>with functions in ink, the <strong class="source-inline">HasFunction()</strong> method verifies whether an ink function exists. Note that it should always be used before working with an ink function to prevent any issues:</p>
			<ol>
				<li value="1">Create a new project in Unity based on the built-in 2D template.</li>
				<li>Import the ink-Unity Integration plugin.</li>
				<li>Create a new, empty game object named <strong class="source-inline">InkStory</strong>.</li>
				<li>Add a <strong class="source-inline">Script</strong> component to the <strong class="source-inline">InkStory</strong> game object and name the ink file <strong class="source-inline">InkStoryFunctions.cs</strong>.</li>
				<li>Add a new ink file and rename it <strong class="source-inline">InkFunctions.ink</strong>.</li>
				<li>Open the <strong class="source-inline">InkFunctions.ink</strong> file in Inky and change its contents to <strong class="source-inline">Example 4 (InkFunctions.ink)</strong>.</li>
				<li>Open <strong class="source-inline">InkStoryFunctions.cs</strong> for editing in Visual Studio.</li>
				<li>Update the <strong class="source-inline">InkStoryFunctions.cs</strong> file to <strong class="source-inline">Example 4 (InkStoryFunctions.cs)</strong>.</li>
				<li>Save the <strong class="source-inline">InkStoryFunctions.cs</strong> file.</li>
				<li>In Unity, associate<a id="_idIndexMarker337"/> the compiled JSON file for the <strong class="source-inline">InkFunctions.ink</strong> file <a id="_idIndexMarker338"/>with the <strong class="source-inline">Ink JSON File</strong> property, as part of the <strong class="source-inline">Script</strong> component of the <strong class="source-inline">InkStory</strong> game object.</li>
				<li>Run the project.<p>In the <strong class="bold">Console</strong> window, a message will appear, showing how the <strong class="source-inline">relationship</strong> ink variable has been changed as a result of calling two methods, <strong class="source-inline">HasFunction()</strong> and <strong class="source-inline">EvaluateFunction()</strong>. The <strong class="source-inline">HasFunction()</strong> method of the <strong class="source-inline">Story</strong> class returns a Boolean value. It also guarantees that a function exists before it is used. </p></li>
				<li>Stop the project.</li>
			</ol>
			<p>After verifying that a function exists, it can be evaluated. The code in the <strong class="source-inline">InkStoryFunctions.cs</strong> file uses two methods: <strong class="source-inline">HasFunction()</strong> and <strong class="source-inline">EvaluateFunction()</strong>. Within the ink API, the term <strong class="bold">evaluate</strong> is important. Functions in ink are a special form of knots, which means they are sections of a story. This potentially means that any usage of ink functions can be incredibly disruptive to the existing values in the story. The term <strong class="bold">evaluate</strong> informs the developer how the result of the action of working with a function might change existing values. In ink, functions are <em class="italic">evaluated</em> using the <strong class="source-inline">EvaluateFunction()</strong> method.</p>
			<p>When using the <strong class="source-inline">EvaluateFunction()</strong> method, the first parameter is the name of the function in ink. Any additional parameters are passed to the ink function directly. In the code that is used as part of the <strong class="source-inline">InkStoryFunctions.cs</strong> file, the use of the <strong class="source-inline">EvaluateFunction()</strong> method includes two parameters: the name of the <strong class="source-inline">increase()</strong> ink function and the amount of value to increase inside ink.</p>
			<p>This use of an ink function that has been called from Unity to change values is a very common pattern when using the ink-Unity Integration plugin. In this case, the <strong class="source-inline">increase()</strong> function in ink updates the <strong class="source-inline">relationship</strong> value inside ink. This allows ink values to be adjusted by ink functions. When working in Unity, values can be passed to ink to perform multiple tasks, depending on the ink functions defined for those tasks, without extra code on the Unity side.</p>
			<p>ink functions are special sections of a story. This means they can also produce text output along with other code-related actions. However, to gain access to the text output of an<a id="_idIndexMarker339"/> ink<a id="_idIndexMarker340"/> function using the <strong class="source-inline">EvaluateFunction()</strong> method, a special keyword is needed in C#: <strong class="source-inline">out</strong>. We will learn more about this keyword in the next section.</p>
			<h2 id="_idParaDest-131"><a id="_idTextAnchor130"/>Retrieving the ink function text output</h2>
			<p>The C# programming<a id="_idIndexMarker341"/> language allows you to define a variable and then pass it to a method. Internal to the method, it is expected that the value of the variable will change. Note that this will not be a change to the value passed to the method, but to the value contained within the variable itself. More generally, in programming, this is known as passing by reference. Instead of passing some data to a method, a reference (that is, where to find the variable to store the value) is passed instead.</p>
			<p>In C#, the <strong class="source-inline">out</strong> keyword can be used with a parameter to a method to specify that the variable, and not its value, should be passed by reference. This means that when the method is finished with its actions, the value within a variable that was passed to the method will change as a result. In C#, using the <strong class="source-inline">out</strong> keyword allows a developer to specify they want a value <em class="italic">out</em> of the method and into a specific variable.</p>
			<p>When working with the <strong class="source-inline">EvaluateFunction()</strong> method provided by the ink-Unity Integration plugin, if the second parameter uses the <strong class="source-inline">out</strong> keyword, the method knows to take any text produced during the evaluation and pass it <em class="italic">out</em> of the method back to the variable. Perform the following steps:</p>
			<ol>
				<li value="1">Return to the code used in the <em class="italic">Verifying and evaluating ink functions</em> section.</li>
				<li>Update the code in the <strong class="source-inline">InkStoryFunctions.cs</strong> file to <strong class="source-inline">Example 5 (InkStoryFunctions.cs)</strong>.</li>
				<li>Save the changed <strong class="source-inline">InkStoryFunctions.cs</strong> file.</li>
				<li>Return to Unity.</li>
				<li>Play the project.</li>
				<li>Stop the project.</li>
			</ol>
			<p>Using the <strong class="source-inline">out</strong> keyword with the <strong class="source-inline">functionOut</strong> variable as a parameter to the <strong class="source-inline">EvaluateFunction()</strong> method lets C# know to pass any text <em class="italic">out</em> of the method. Because the <strong class="source-inline">relationship</strong> value was updated internally in ink by calling the <strong class="source-inline">increase()</strong> function<a id="_idIndexMarker342"/> from Unity to ink, its value is shown as <strong class="source-inline">51</strong> in the <strong class="bold">Console</strong> window when the project is run. The <strong class="source-inline">functionOut</strong> variable in C# is given the text <em class="italic">out</em> of the use of the <strong class="source-inline">EvaluateFunction()</strong> method. This allows it to then pass its value to the <strong class="source-inline">Debug.Log()</strong> method and, ultimately, show the updated value in the <strong class="bold">Console</strong> window.</p>
			<p>When the <strong class="source-inline">out</strong> keyword is used with the <strong class="source-inline">EvaluateFunction()</strong> method in this way, any text output from a function can be captured and passed back from ink to Unity. Combined with creating ink functions to update ink values, this additional change to the pattern shown in the <em class="italic">Verifying and evaluating ink functions</em> section allows you to call ink functions to perform ink-related tasks. This allows for the separation between ink concerns and those in Unity.</p>
			<p>Within ink, a story can be controlled by different values. Using conditional options and a selective output, the text of a choice can be displayed or a diversion followed. Because the values of variables can be directly accessed using the <strong class="source-inline">variablesState</strong> property and functions that have been called using the <strong class="source-inline">EvaluateFunction()</strong> method, this means an ink story can be controlled from Unity. In the next section, we will learn how to connect user interface elements in Unity with ink variables and functions.</p>
			<h1 id="_idParaDest-132"><a id="_idTextAnchor131"/>Controlling a story through variables and functions</h1>
			<p>The <strong class="source-inline">variablesState</strong> property<a id="_idIndexMarker343"/> and the <strong class="source-inline">EvaluateFunction()</strong> method<a id="_idIndexMarker344"/> give the developer two ways in which to access values within an ink story. By using these two approaches, a story can be <em class="italic">controlled</em> by more than just the options that are presented to a player. User interface elements within Unity can be attached to methods that can then change ink values.</p>
			<p>In this section, we will connect ink to Unity. By using the <strong class="source-inline">variablesState</strong> property and the <strong class="source-inline">EvaluateFunction()</strong> method, we will review a code pattern where Unity provides the user interface and communicates with ink functions to adjust and react to values during runtime.</p>
			<p>Across the three sections of this topic, first, we will prepare a Unity project by creating the necessary game objects. Next, we will add the code to control the user interface. Finally, we will adjust the presentation of the user interface and run the project.</p>
			<h2 id="_idParaDest-133"><a id="_idTextAnchor132"/>Preparing a user interface</h2>
			<p>To begin work <a id="_idIndexMarker345"/>with Unity buttons, a new project is required. For simplicity, a 2D project is recommended. This will allow you to work easily with an interface without needing to worry about perspective. Perform the following steps:</p>
			<ol>
				<li value="1">Create a new project in Unity using the built-in 2D template and name this project <strong class="source-inline">Shopping Trip</strong>.</li>
				<li>Import the ink-Unity Integration plugin.</li>
				<li>Create a new, empty game object named <strong class="source-inline">InkStory</strong>.</li>
				<li>Create a new <strong class="source-inline">Script</strong> component inside the <strong class="source-inline">InkStory</strong> game object. Name the created C# file <strong class="source-inline">InkStoryShopping.cs</strong>.</li>
				<li>Create a new ink file named <strong class="source-inline">InkShopping.ink</strong>.</li>
				<li>Open the <strong class="source-inline">InkShopping.ink</strong> file for editing in Inky and change its contents to <strong class="source-inline">Example 6 (InkShopping.ink)</strong>.<p>In Unity, create a new <strong class="source-inline">Button</strong> game object. Select the automatically created <strong class="source-inline">Canvas</strong> game object in Unity and create a second <strong class="source-inline">Button</strong> game object so that both buttons are the children of the <strong class="source-inline">Canvas</strong> game object:</p><div id="_idContainer110" class="IMG---Figure"><img src="Images/Figure_8.4_B17597.jpg" alt="Figure 8.4 – The created buttons in Unity&#13;&#10;" width="348" height="259"/></div><p class="figure-caption">Figure 8.4 – The created buttons in Unity</p></li>
				<li>Select the <strong class="source-inline">Canvas</strong> game object again and create a <strong class="source-inline">Text</strong> game object. Both buttons, along<a id="_idIndexMarker346"/> with the newly created <strong class="source-inline">Text</strong> game object, should all be children of the <strong class="source-inline">Canvas</strong> game object.</li>
			</ol>
			<p>The ink file created as part of <em class="italic">Step 6</em> established the ink functions that will be called from future Unity code. The two buttons will serve as an interface for the buying and selling of an inventory that is also tracked by the ink code. In the next section, we will move from having set up everything to writing the Unity code to create a bridge between the interface and ink. This will track two values: <strong class="source-inline">money</strong> and <strong class="source-inline">inventory</strong>.</p>
			<h2 id="_idParaDest-134"><a id="_idTextAnchor133"/>Scripting user interface objects</h2>
			<p>In the previous <a id="_idIndexMarker347"/>section, we worked through the steps that were needed to create a new Unity 2D project and to create the necessary game objects. In this section, we will learn how to connect user actions (that is, clicking) with the user interface by adding code on the Unity side. Then, we will use the <strong class="source-inline">EvaluateFunction()</strong> method in Unity to communicate with ink functions within a running story to control its progression:</p>
			<ol>
				<li value="1">Open the <strong class="source-inline">InkStoryShopping.cs</strong> file for editing in Visual Studio. </li>
				<li>Change its content to <strong class="source-inline">Example 6 (InkStoryShopping.cs)</strong>.<p>In the new code, three new methods have been added to the Unity code. We have directly mapped the Unity methods to ink functions. For example, the name of the <strong class="source-inline">Sell()</strong> method in Unity almost matches the <strong class="source-inline">sell()</strong> name of the ink function. The differences in capitalization are only because of the recommended capitalization usage in each programming context.</p></li>
				<li>Associate the compiled ink JSON file with the new public property. Associate the <strong class="source-inline">Text</strong> game <a id="_idIndexMarker348"/>object with the <strong class="source-inline">Text Status</strong> property:<div id="_idContainer111" class="IMG---Figure"><img src="Images/Figure_8.5_B17597.jpg" alt="Figure 8.5 – Associating the Text GameObject with the Text Status property&#13;&#10;" width="696" height="235"/></div><p class="figure-caption">Figure 8.5 – Associating the Text GameObject with the Text Status property</p><p class="callout-heading">Recommendation</p><p class="callout">Because the two existing <strong class="source-inline">Button</strong> game objects have children <strong class="source-inline">Text</strong> game objects, it is recommended that you use the drag-and-drop approach to associate a game object with a property. This will prevent any issues with associating the wrong <strong class="source-inline">Text</strong> game object.</p></li>
				<li>Select the <strong class="source-inline">Canvas</strong> game object in Unity in the <strong class="bold">Hierarchy</strong> view. In the <strong class="bold">Inspector</strong> view, click on <strong class="bold">Add Component</strong>, <strong class="bold">Layout</strong>, and then <strong class="bold">Horizontal Layout Group</strong>. This will add a <strong class="source-inline">Horizontal Layout Group</strong> component.</li>
				<li>Change the <strong class="bold">Child Alignment</strong> property of the <strong class="source-inline">Horizontal Layout Group</strong> component from the default value of <strong class="bold">Upper Left</strong> to <strong class="bold">Middle Center</strong>:<div id="_idContainer112" class="IMG---Figure"><img src="Images/Figure_8.6_B17597.jpg" alt="Figure 8.6 – The adjusted Child Alignment property for Horizontal Layout Group&#13;&#10;" width="622" height="294"/></div><p class="figure-caption">Figure 8.6 – The adjusted Child Alignment property for Horizontal Layout Group</p><p>The addition of the <strong class="source-inline">Horizontal Layout Group</strong> component adds a layout structure<a id="_idIndexMarker349"/> to the <strong class="source-inline">Canvas</strong> game object. The adjustment of the <strong class="bold">Child Alignment</strong> property changes the starting position of all its children to the absolute-center positions of the available screen space.</p></li>
				<li>Select the first <strong class="source-inline">Button</strong> game object of the children game objects of the <strong class="source-inline">Canvas</strong> game object, in the <strong class="bold">Hierarchy</strong> view, in Unity. In the <strong class="bold">Inspector</strong> view, scroll down to the <strong class="bold">On Click ()</strong> component. At the bottom of this area, click on the small plus (<strong class="bold">+</strong>) symbol:<div id="_idContainer113" class="IMG---Figure"><img src="Images/Figure_8.7_B17597.jpg" alt="Figure 8.7 – Addition to the On Click () component&#13;&#10;" width="577" height="147"/></div><p class="figure-caption">Figure 8.7 – Addition to the On Click () component</p><p>Each <strong class="source-inline">Button</strong> game object can have one or more listener functions associated with its <strong class="source-inline">OnClick</strong> user event. When a user clicks on the <strong class="source-inline">Button</strong> game object, these functions will be called in the order in which they appear in the list.</p><p>Because <strong class="source-inline">Button</strong> is a <strong class="source-inline">GameObject</strong>, it can only communicate with other game objects. This is an important aspect of how Unity understands the differences between game objects and their components. A <strong class="source-inline">GameObject</strong> is a <em class="italic">container</em> for other components, including any <strong class="source-inline">script</strong> components. This means that to connect the <strong class="source-inline">OnClick</strong> user event for a <strong class="source-inline">Button</strong> game object to some code found in a <strong class="source-inline">script</strong> component, the <strong class="source-inline">GameObject</strong> that the <strong class="source-inline">script</strong> component is associated with must be used. For us, this means the <strong class="source-inline">InkStory</strong> game object.</p></li>
				<li>Associate the <strong class="source-inline">InkStory</strong> game object with the <strong class="source-inline">On Click ()</strong> component of the first <strong class="source-inline">Button</strong> game object. This can be done by dragging and dropping the <strong class="source-inline">InkStory</strong> game <a id="_idIndexMarker350"/>object onto the property:<div id="_idContainer114" class="IMG---Figure"><img src="Images/Figure_8.8_B17597.jpg" alt="Figure 8.8 – Associating the InkStory GameObject with the On Click () component&#13;&#10;" width="669" height="156"/></div><p class="figure-caption">Figure 8.8 – Associating the InkStory GameObject with the On Click () component</p><p>Once a <strong class="source-inline">GameObject</strong> has been associated with an entry in the <strong class="source-inline">On Click ()</strong> component listing, the <strong class="bold">No Function</strong> drop-down menu will be enabled. Upon this association, Unity will have processed the game object and looked for every possible method or function that might be used.</p></li>
				<li>Using the <strong class="bold">No Function</strong> drop-down menu, select the <strong class="bold">InkStoryShopping </strong>object and then the <strong class="bold">Buy ()</strong> method entry.<p>Once the method has been associated as a listening function, the value of the <strong class="bold">No Function</strong> drop-down menu will update to <strong class="source-inline">InkStoryShopping.Buy</strong>.</p></li>
				<li>Select the second <strong class="source-inline">Button</strong> game object of the children of the <strong class="source-inline">Canvas game object</strong>, in the <strong class="bold">Hierarchy</strong> view, in Unity. In the <strong class="bold">Inspector</strong> view, scroll down to the <strong class="source-inline">On Click ()</strong> component.</li>
				<li>Follow <em class="italic">Step 7</em> and <em class="italic">Step 8</em> to associate the <strong class="source-inline">InkStory</strong> game object with the <strong class="source-inline">On Click</strong> <strong class="source-inline">()</strong> component. For <em class="italic">Step 8</em>, instead of using the <strong class="source-inline">Buy</strong> <strong class="source-inline">()</strong> method, select the <strong class="source-inline">Sell</strong> <strong class="source-inline">()</strong> method:</li>
			</ol>
			<div>
				<div id="_idContainer115" class="IMG---Figure">
					<img src="Images/Figure_8.9_B17597.jpg" alt="Figure 8.9 – Associating the InkStoryShopping.Sell() method&#13;&#10;" width="588" height="139"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.9 – Associating the InkStoryShopping.Sell() method</p>
			<p>At the end of <em class="italic">Step 10</em>, the first <strong class="source-inline">Button</strong> game object is associated with the <strong class="source-inline">Buy()</strong> method, and the second is associated with the <strong class="source-inline">Sell()</strong> method. Internally, those methods are communicating with their corresponding ink functions. As you<a id="_idIndexMarker351"/> will discover shortly, clicking on the buttons will call Unity methods, which, in turn, will call ink functions.</p>
			<h2 id="_idParaDest-135"><a id="_idTextAnchor134"/>Adjusting the presentation values</h2>
			<p>In this final <a id="_idIndexMarker352"/>section, we will change the default values of the user interface game objects created in the previous section. Adjusting these values will help us to better understand the relationship between game objects and improve the experience of interacting with the onscreen buttons:</p>
			<ol>
				<li value="1">Select the first <strong class="source-inline">Button</strong> game object in the <strong class="bold">Hierarchy</strong> view in Unity. Using the drop-down arrow next to its name, expand the listing of these children and click on the first <strong class="source-inline">Text</strong> game object.</li>
				<li>Change the <strong class="source-inline">Text</strong> property value from its default setting of <strong class="source-inline">Button</strong> to <strong class="source-inline">Buy</strong>:<div id="_idContainer116" class="IMG---Figure"><img src="Images/Figure_8.10_B17597.jpg" alt="Figure 8.10 – Changing the Text property&#13;&#10;" width="390" height="232"/></div><p class="figure-caption">Figure 8.10 – Changing the Text property</p></li>
				<li>Select the second <strong class="source-inline">Button</strong> game object in the <strong class="bold">Hierarchy</strong> view in Unity. Using the drop-down arrow next to its name, expand the listing of these children and click on the first <strong class="source-inline">Text</strong> game object presented.</li>
				<li>Change the default text of the second <strong class="source-inline">Button</strong> game object from <strong class="source-inline">Button</strong> to <strong class="source-inline">Sell</strong>.</li>
				<li>Select the third child game object of the <strong class="source-inline">Canvas</strong> game object, that is, the <strong class="source-inline">Text</strong> game object. Be sure not to select the previous two <strong class="source-inline">Text</strong> game objects that were<a id="_idIndexMarker353"/> updated in the previous steps.</li>
				<li>Change the width and height of the <strong class="source-inline">Text</strong> game object to <strong class="source-inline">400</strong> and <strong class="source-inline">250</strong>:<div id="_idContainer117" class="IMG---Figure"><img src="Images/Figure_8.11_B17597.jpg" alt="Figure 8.11 – Adjusting the width and height of the Text game object&#13;&#10;" width="533" height="260"/></div><p class="figure-caption">Figure 8.11 – Adjusting the width and height of the Text game object</p></li>
				<li>Change the font size of the <strong class="source-inline">Text</strong> game object from its default value to <strong class="source-inline">32</strong>.</li>
				<li>Change the color of the <strong class="source-inline">Text</strong> game object from its default setting to a white or near-white color:<div id="_idContainer118" class="IMG---Figure"><img src="Images/Figure_8.12_B17597.jpg" alt="Figure 8.12 – Updating the color for the Text game object&#13;&#10;" width="510" height="388"/></div><p class="figure-caption">Figure 8.12 – Updating the color for the Text game object</p></li>
				<li>Play the project.<p>When played, the far-left side will show the updated status of the <strong class="source-inline">money</strong> and <strong class="source-inline">inventory</strong> variables in ink. Clicking on the buttons will call the Unity methods, which, in turn, will evaluate the ink functions and change the values inside the running ink story. This is a complete example of how to <em class="italic">control</em> an ink story through variables and functions.</p></li>
				<li>Stop the project.</li>
			</ol>
			<p>While multiple steps <a id="_idIndexMarker354"/>were involved to create the user interface elements and change the values of their properties, the code is relatively simple. Functions were created in ink to adjust the ink values. In Unity, methods were created matching the names of the ink functions. </p>
			<p>This section demonstrated how a simple shopping scene could be created in ink and manipulated from Unity. By knowing the name of the ink functions, C# methods in Unity can evaluate them to either adjust values or, in the case of the <strong class="source-inline">status()</strong> ink function, retrieve the text output. This was also a demonstration of how to separate user interface programming from story-related code. They communicated with each other, but they were written in different contexts.</p>
			<p>In the next chapter, we will examine a different approach to working with variables and functions in a story while continuing the trend of separating our narrative and game code. However, instead of clicking on buttons in Unity to trigger functions in ink, we will explore the reverse. Events will happen in ink and trigger changes in Unity. This chapter focused on how to control ink from Unity. The next chapter will demonstrate how to control parts of Unity from events happening within a running ink story.</p>
			<h1 id="_idParaDest-136"><a id="_idTextAnchor135"/>Summary</h1>
			<p>In this chapter, we began by demonstrating how the <strong class="source-inline">variablesState</strong> property exposes all of the variables in ink. We started by using the <strong class="source-inline">GetVariableWithName()</strong> method to access variables by name and the provided shorthand syntax of using square brackets. For completeness, the <strong class="source-inline">variablesState</strong> property was explained. However, in most situations, ink functions should change ink values. This helps to keep any code working with those values existing within the ink story and is easier to maintain over time, and we closed the chapter on this same theme. Additionally, we explored how buttons in Unity can call their methods and then call ink functions. By using the <strong class="source-inline">EvaluateFunction()</strong> method, we can access the ink function in Unity to either pass data into the project or retrieve possible text output with the <strong class="source-inline">out</strong> keyword in C#.</p>
			<p>In <a href="B17597_09_Final_PG_ePub.xhtml#_idTextAnchor137"><em class="italic">Chapter 9</em></a>, <em class="italic">Story API – Observing and Reacting to Story Events</em>, we will emphasize the ink-Unity Integration plugin and its API by inspecting a different approach to the relationship between Unity and ink. Instead of using Unity methods to call ink functions, we will examine some patterns to control parts of Unity from ink. Instead of having to click on buttons in Unity to change values, ink will cause changes that will then register in Unity. For projects requiring more real-time feedback from ink, these patterns will be a preferred approach to those shown in this chapter using the <strong class="source-inline">variablesState</strong> property and the <strong class="source-inline">EvaluateFunction()</strong> method.</p>
			<h1 id="_idParaDest-137"><a id="_idTextAnchor136"/>Questions</h1>
			<ol>
				<li value="1">Are variables global in ink?</li>
				<li>What effect does functions being global mean regarding how they are accessed in ink?</li>
				<li>Do the <strong class="source-inline">Continue()</strong> and <strong class="source-inline">ContinueMaximally()</strong> methods affect the values of variables in ink?</li>
				<li>What shorthand syntax does the <strong class="source-inline">VariablesState</strong> class provide to access variables based on their names?</li>
				<li>Should the name of an ink function be used to test whether it exists before you attempt to access it?</li>
				<li>How is the <strong class="source-inline">out</strong> C# keyword used with the <strong class="source-inline">EvaluateFunction()</strong> method as part of the Story API when working with the ink-Unity Integration plugin?</li>
			</ol>
		</div>
	</div></body></html>