<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Selecting the Data"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Selecting the Data</h1></div></div></div><p>Reports <a id="id76" class="indexterm"/>are formatted presentation of data. Reports are used to present the information stored in database(s). Hence the first step is to connect to a database to read data from it. In this chapter, we will see how we can connect to the database and run SQL queries using Microsoft Visual Studio. We will also talk about DataSet and TableAdapter and see how we can use them to fill the ComboBoxes in our application.</p><p>In this chapter, we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">SQL query in Visual Studio</li><li class="listitem" style="list-style-type: disc">Populate the ComboBoxes with data</li></ul></div><div class="section" title="SQL queries in Microsoft Visual Studio"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec18"/>SQL queries in Microsoft Visual Studio</h1></div></div></div><p>Generally SQL <a id="id77" class="indexterm"/>queries are categorized into data definition language and data manipulation language.</p><p>There are many types of SQL queries such as Select, Update, Delete, and Insert query. In this book we will talk only about the Select query because reports use the Select query. We will use Northwind database in our example queries and we will use Microsoft Visual Studio to run all SQL queries. So first, we need to connect to our database.</p><div class="section" title="Connecting to our database"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec16"/>Connecting to our database</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open our <a id="id78" class="indexterm"/>application, Monitor, in Microsoft Visual Studio.</li><li class="listitem">Click on <span class="strong"><strong>View</strong></span> and click on <span class="strong"><strong>Server Explorer</strong></span>.</li><li class="listitem">In <span class="strong"><strong>Server Explorer</strong></span>, right-click on <span class="strong"><strong>Data Connections</strong></span> and select <span class="strong"><strong>Add Connection...</strong></span>. A dialog box similar to the one shown in the next screenshot will appear:<div class="mediaobject"><img src="graphics/3-1.jpg" alt="Connecting to our database"/></div></li><li class="listitem">Make sure that <a id="id79" class="indexterm"/><span class="strong"><strong>Data source:</strong></span> is <span class="strong"><strong>Microsoft SQL Server(SqlClient)</strong></span>.</li><li class="listitem">Because we have installed Microsoft SQL Server on our machine, we can type in <code class="literal">localhost</code> as the server name or write the machine name.</li><li class="listitem">Select <span class="strong"><strong>Use SQL Server Authentication</strong></span> and enter <code class="literal">sa</code> as the <span class="strong"><strong>User name:</strong></span> and enter your password that you used while installing Microsoft SQL Server.</li><li class="listitem">Enter <code class="literal">Northwind</code> in the database field and click on the <span class="strong"><strong>Test Connection</strong></span> button.</li><li class="listitem">If a message box pops up saying that the test succeeded, it means we can go ahead. If not, reenter the data or troubleshoot if there is any connection problem with SQL Server.</li><li class="listitem">Click on the <span class="strong"><strong>OK</strong></span> button to connect to the database, and we will see our database in the <span class="strong"><strong>Server Explorer</strong></span>, as shown in to the following screenshot:<div class="mediaobject"><img src="graphics/3-2.jpg" alt="Connecting to our database"/></div></li></ol></div></div></div></div>
<div class="section" title="Add database diagram"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec19"/>Add database diagram</h1></div></div></div><p>To understand the Northwind database and relation between its tables we will create a new <a id="id80" class="indexterm"/>database diagram:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Right-click on <span class="strong"><strong>Database Diagrams</strong></span> and choose <span class="strong"><strong>Add New Diagram</strong></span>. Click on <span class="strong"><strong>Yes</strong></span> in the confirmation message box</li><li class="listitem">Select all tables in the <span class="strong"><strong>Add Tables</strong></span> dialog and click on the <span class="strong"><strong>Add</strong></span> button. We can see all the tables and relations between these tables in the next diagram.</li><li class="listitem">Save the diagram with the default name <code class="literal">Diagram1</code>.<div class="mediaobject"><img src="graphics/3-3.jpg" alt="Add database diagram"/></div></li></ol></div><div class="section" title="Test queries"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec17"/>Test queries</h2></div></div></div><p>We need a tool to run<a id="id81" class="indexterm"/> queries and test results. Microsoft Visual Studio has a good<a id="id82" class="indexterm"/> IDE to run SQL queries. We can see this IDE by right-clicking on any table name in our database in <span class="strong"><strong>Server Explorer</strong></span> and selecting <span class="strong"><strong>New Query</strong></span>. Then we will choose the tables that we will use in our query from the <span class="strong"><strong>Add Table</strong></span> dialog box and click on the <span class="strong"><strong>OK</strong></span> button. Refer to the following screenshot:</p><div class="mediaobject"><img src="graphics/3-4.jpg" alt="Test queries"/></div><p>As we can see<a id="id83" class="indexterm"/> in the previous screenshot, there are four sections in our Query IDE. Section<a id="id84" class="indexterm"/> one displays all tables we used in our query, section two displays simple query builder, section three displays SQL query code, and section four displays the query result. In our discussion we will talk about sections three and four.</p></div></div>
<div class="section" title="Populate the ComboBoxes with data"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec20"/>Populate the ComboBoxes with data</h1></div></div></div><p>In our application, we have many <a id="id85" class="indexterm"/>ComboBoxes. How do we populate them with data? In this<a id="id86" class="indexterm"/> section we will populate the ComboBoxes with data and talk about the basics of select SQL query. We have four main steps to populate any ComboBox in our application: SQL query, <code class="literal">TableAdapter</code>, <code class="literal">DataSource</code>, and Load Event. Before we start filling the first ComboBox, we need to add DataSet to our application to save the retrieved data by TableAdapter, in to it.</p><div class="section" title="Add DataSet to the application"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec18"/>Add DataSet to the application</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Right-click on the <a id="id87" class="indexterm"/>Monitor application in the Solution Explorer and navigate to <span class="strong"><strong>Add</strong></span> | <span class="strong"><strong>New Item</strong></span>.</li><li class="listitem">From the dialog box select <span class="strong"><strong>DataSet</strong></span> and we will keep it with the default name <code class="literal">DataSet1</code>.</li></ol></div></div><div class="section" title="Populate the cbEmpTitle ComboBox"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec19"/>Populate the cbEmpTitle ComboBox</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Select data</strong></span>: We <a id="id88" class="indexterm"/>need to populate this ComboBox with all employees' titles without any duplication.<p>As we can see in the following screenshot, we can use a <code class="literal">Select</code> query to select <code class="literal">Title</code> from <code class="literal">Employees</code> table and the <code class="literal">DISTINCT</code> keyword to avoid duplication.</p><div class="mediaobject"><img src="graphics/3-5.jpg" alt="Populate the cbEmpTitle ComboBox"/></div></li><li class="listitem"><span class="strong"><strong>Create TableAdapter</strong></span>: Open <code class="literal">DataSet1</code>, right-click on it and navigate to <span class="strong"><strong>Add</strong></span> | <span class="strong"><strong>TableAddapter</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/3-6.jpg" alt="Populate the cbEmpTitle ComboBox"/></div><p>In this step, we can create a new connection string to our database or use the connection string that we created to connect to our database in <span class="strong"><strong>Server Explorer</strong></span>. Here we will use the one we created before and then click on the <span class="strong"><strong>Next</strong></span> button; as we will see the following screenshot:</p><div class="mediaobject"><img src="graphics/3-7.jpg" alt="Populate the cbEmpTitle ComboBox"/></div><p>In our <a id="id89" class="indexterm"/>application, we will use the SQL statement to access the database, so select <span class="strong"><strong>Use SQL Statements</strong></span> and click on the <span class="strong"><strong>Next</strong></span> button to see the following screenshot:</p><div class="mediaobject"><img src="graphics/3-8.jpg" alt="Populate the cbEmpTitle ComboBox"/></div><p>In this dialog we will write the SQL query that we prepared in the previous step and click on the <span class="strong"><strong>Next</strong></span> button to see the following screenshot:</p><div class="mediaobject"><img src="graphics/3-9.jpg" alt="Populate the cbEmpTitle ComboBox"/></div><p>In this dialog<a id="id90" class="indexterm"/> we will change the method names to <code class="literal">FillTitle</code> and <code class="literal">GetTitle</code> then click on the <span class="strong"><strong>Next</strong></span> button to see the following screenshot:</p><div class="mediaobject"><img src="graphics/3-10.jpg" alt="Populate the cbEmpTitle ComboBox"/></div><p>We need to see this dialog to be sure that all the processes are configured successfully, then click on the <span class="strong"><strong>Finish</strong></span> button to see the TableAdapter shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/3-11.jpg" alt="Populate the cbEmpTitle ComboBox"/></div><p>In the previous screenshot, we changed the DataTable name to <code class="literal">EmpTitle</code> and TableAdapter name to <code class="literal">EmpTitleTableAdapter</code>.</p></li><li class="listitem"><span class="strong"><strong>Set comboboxDataSource</strong></span>: Open the Main Form; right-click on it and select <span class="strong"><strong>View Code</strong></span>. We will create a new <a id="id91" class="indexterm"/>method to publish our ComboBox data. Refer to the following screenshot:<div class="mediaobject"><img src="graphics/3-12.jpg" alt="Populate the cbEmpTitle ComboBox"/></div><p>In the <code class="literal">PublishEmpTitle</code> method, we create the object from <code class="literal">DataSet1</code> named <code class="literal">ds</code> and create another object from <code class="literal">EmpTitleTableAdapter</code> named <code class="literal">Adapter</code>. Then we fill our dataset <code class="literal">ds</code> by t<code class="literal">ableadapterAdapter</code> using the <code class="literal">FillTitle</code> method. In the end, we assign the <code class="literal">cbEmpTitleDataSource</code> to <code class="literal">ds</code> and <code class="literal">DisplayMember</code> to Title.</p></li><li class="listitem"><span class="strong"><strong>Update Load event</strong></span>: In the Main Form Load event <code class="literal">MainForm_Load</code>, we will call our method <code class="literal">PublishEmpTitle</code> as we can see in the following screenshot:<div class="mediaobject"><img src="graphics/3-13.jpg" alt="Populate the cbEmpTitle ComboBox"/></div></li><li class="listitem"><span class="strong"><strong>Test the result</strong></span>: Run our application to test the result. We can see that our ComboBox title is now filled with data; as seen in the following screenshot:<div class="mediaobject"><img src="graphics/3-14.jpg" alt="Populate the cbEmpTitle ComboBox"/></div></li></ol></div></div><div class="section" title="Populate the cbEmpCity ComboBox"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec20"/>Populate the cbEmpCity ComboBox</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Select data</strong></span>: We need to fill<a id="id92" class="indexterm"/> this ComboBox with all cities without any duplication. Refer to the following screenshot:<div class="mediaobject"><img src="graphics/3-15.jpg" alt="Populate the cbEmpCity ComboBox"/></div></li><li class="listitem"><span class="strong"><strong>Create TableAdapter</strong></span>: Please follow the same steps as in the last section to create the TableAdapter and name it as <code class="literal">EmpCity</code>. The TableAdapter will look like the following screenshot:<div class="mediaobject"><img src="graphics/3-16.jpg" alt="Populate the cbEmpCity ComboBox"/></div></li><li class="listitem"><span class="strong"><strong>Set comboboxDataSource</strong></span>: Refer to the code in the following screenshot:<div class="mediaobject"><img src="graphics/3-17.jpg" alt="Populate the cbEmpCity ComboBox"/></div></li><li class="listitem"><span class="strong"><strong>Update Load event</strong></span>: Refer<a id="id93" class="indexterm"/> to the code in the following screenshot:<div class="mediaobject"><img src="graphics/3-18.jpg" alt="Populate the cbEmpCity ComboBox"/></div></li><li class="listitem"><span class="strong"><strong>Test the result</strong></span>: The result will look like the following screenshot:<div class="mediaobject"><img src="graphics/3-19.jpg" alt="Populate the cbEmpCity ComboBox"/></div></li></ol></div></div><div class="section" title="Populate the cbEmpCountry ComboBox"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec21"/>Populate the cbEmpCountry ComboBox</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Select data</strong></span>: We need to fill this <a id="id94" class="indexterm"/>ComboBox with all employee countries without any duplication, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/3-20.jpg" alt="Populate the cbEmpCountry ComboBox"/></div></li><li class="listitem"><span class="strong"><strong>Create TableAdapter</strong></span>: Please <a id="id95" class="indexterm"/>follow the same steps as before to create the TableAdapter. The TableAdapter will look like the following screenshot:<div class="mediaobject"><img src="graphics/3-21.jpg" alt="Populate the cbEmpCountry ComboBox"/></div></li><li class="listitem"><span class="strong"><strong>Set comboboxDataSource</strong></span>: Refer to the code in the following screenshot:<div class="mediaobject"><img src="graphics/3-22.jpg" alt="Populate the cbEmpCountry ComboBox"/></div></li><li class="listitem"><span class="strong"><strong>Update Load event</strong></span>: Refer to the code in the following screenshot:<div class="mediaobject"><img src="graphics/3-23.jpg" alt="Populate the cbEmpCountry ComboBox"/></div></li><li class="listitem"><span class="strong"><strong>Test the result</strong></span>: The result <a id="id96" class="indexterm"/>will look like the following screenshot:<div class="mediaobject"><img src="graphics/3-24.jpg" alt="Populate the cbEmpCountry ComboBox"/></div></li></ol></div></div><div class="section" title="Populate the cbProductsCategory ComboBox"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec22"/>Populate the cbProductsCategory ComboBox</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Select data</strong></span>: We need to <a id="id97" class="indexterm"/>fill this ComboBox with all product categories without any duplication. Refer to the following screenshot:<div class="mediaobject"><img src="graphics/3-25.jpg" alt="Populate the cbProductsCategory ComboBox"/></div></li><li class="listitem"><span class="strong"><strong>Create TableAdapter</strong></span>: Again, please<a id="id98" class="indexterm"/> follow the same steps as before to create the TableAdapter. The TableAdapter will look like the following screenshot:<div class="mediaobject"><img src="graphics/3-26.jpg" alt="Populate the cbProductsCategory ComboBox"/></div></li><li class="listitem"><span class="strong"><strong>Set comboboxDataSource</strong></span>: Refer to the code in the following screenshot:<div class="mediaobject"><img src="graphics/3-27.jpg" alt="Populate the cbProductsCategory ComboBox"/></div></li><li class="listitem"><span class="strong"><strong>Update Load event</strong></span>: Refer to the code in the following screenshot:<div class="mediaobject"><img src="graphics/3-28.jpg" alt="Populate the cbProductsCategory ComboBox"/></div></li><li class="listitem"><span class="strong"><strong>Test the result</strong></span>: The<a id="id99" class="indexterm"/> result will look like the following screenshot:<div class="mediaobject"><img src="graphics/3-29.jpg" alt="Populate the cbProductsCategory ComboBox"/></div></li></ol></div></div><div class="section" title="Populate cbOrdersCountry ComboBox"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec23"/>Populate cbOrdersCountry ComboBox</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Select data</strong></span>: We need to fill <a id="id100" class="indexterm"/>this ComboBox with all the countries in the <code class="literal">Customers</code> table without any duplication. Refer to the following screenshot:<div class="mediaobject"><img src="graphics/3-30.jpg" alt="Populate cbOrdersCountry ComboBox"/></div></li><li class="listitem"><span class="strong"><strong>Create TableAdapter</strong></span>: Please<a id="id101" class="indexterm"/> follow the same steps as before to create the TableAdapter. The TableAdapter will look like the following screenshot:<div class="mediaobject"><img src="graphics/3-31.jpg" alt="Populate cbOrdersCountry ComboBox"/></div></li><li class="listitem"><span class="strong"><strong>Set comboboxDataSource</strong></span>: Refer to the code in the following screenshot:<div class="mediaobject"><img src="graphics/3-32.jpg" alt="Populate cbOrdersCountry ComboBox"/></div></li><li class="listitem"><span class="strong"><strong>Update Load event</strong></span>: To do this, please refer to the code in the following screenshot:<div class="mediaobject"><img src="graphics/3-33.jpg" alt="Populate cbOrdersCountry ComboBox"/></div></li><li class="listitem"><span class="strong"><strong>Test the result</strong></span>: The result will <a id="id102" class="indexterm"/>look like the following screenshot:<div class="mediaobject"><img src="graphics/3-34.jpg" alt="Populate cbOrdersCountry ComboBox"/></div></li></ol></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec21"/>Summary</h1></div></div></div><p>Valid data is more critical than the report design, so we need to select the right data before displaying this data in the report. Before we start any reporting application, we need to understand the database/data very well to ensure that our report has the correct data. In this chapter, we learned how to write our Select query in Visual Studio and how to run this query. We learned how to fill the ComboBox using the DataAdapter. In the next chapter, we begin to use Crystal Reports and we will see how to display this report in our application.</p></div></body></html>