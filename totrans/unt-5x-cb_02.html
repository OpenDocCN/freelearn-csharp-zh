<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Inventory GUIs</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating a simple 2D mini-game – SpaceGirl</li><li class="listitem" style="list-style-type: disc">Displaying single object pickups with carrying and not-carrying text</li><li class="listitem" style="list-style-type: disc">Displaying single object pickups with carrying and not-carrying icons</li><li class="listitem" style="list-style-type: disc">Displaying multiple pickups of the same object with text totals</li><li class="listitem" style="list-style-type: disc">Displaying multiple pickups of the same object with multiple status icons</li><li class="listitem" style="list-style-type: disc">Revealing icons for multiple object pickups by changing the size of a tiled image</li><li class="listitem" style="list-style-type: disc">Displaying multiple pickups of different objects as a list of text via a dynamic List&lt;&gt; of PickUp objects</li><li class="listitem" style="list-style-type: disc">Displaying multiple pickups of different objects as text totals via a dynamic Dictionary&lt;&gt; of PickUp objects and "enum" pickup types</li><li class="listitem" style="list-style-type: disc">Generalizing multiple icon displays using UI Grid Layout Groups (with scrollbars!)</li></ul></div><div><div><div><div><h1 class="title"><a id="ch02lvl1sec26"/>Introduction</h1></div></div></div><p>Many games involve the player collecting items or choosing from a selection of items.  Examples could be collecting keys to open doors, collecting ammo for weapons, choosing from a collection of spells to cast, and so on.</p><p>The recipes in this chapter offer a range of solutions for displaying to the player whether they are carrying an item or not, if they are allowed more than one of an item, and how many they have.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec64"/>The big picture</h2></div></div></div><p>The two parts of software design for implementing inventories relate to, first, how we choose to represent the data about inventory items (that is, the data types and structures to store the data) and, secondly, how we choose to display information about inventory items to the player (the UI: User Interface).</p><p>Also, whilst not strictly inventory items, player properties such as lives left, health, or time remaining can also be designed around the same concepts that we present in this chapter.</p><p>We need to first think about<a class="indexterm" id="id168"/> the nature of different inventory items for any particular game:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Single items:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Example(s): the only key for a level, our suit of magic armor</li><li class="listitem" style="list-style-type: disc">Data type: bool (true/false)</li><li class="listitem" style="list-style-type: disc">UI: nothing (if not carried) or text/image to show being carried<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Or perhaps text saying "no key"/"key", or two images, one showing an empty key outline and the second showing a full color key</li><li class="listitem" style="list-style-type: disc">If we wish to highlight to the player that there is an option to be carrying this item</li></ul></div></li></ul></div></li><li class="listitem" style="list-style-type: disc">Continuous item:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Example(s): time left, health, shield strength</li><li class="listitem" style="list-style-type: disc">Data type: float (for<a class="indexterm" id="id169"/> example, 0.00–1.00) or integer scale (for example, 0% .. 100%)</li><li class="listitem" style="list-style-type: disc">UI: text number or image progress bar/pie chart</li></ul></div></li><li class="listitem" style="list-style-type: disc">Two or more of same item<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Example(s): lives left, or<a class="indexterm" id="id170"/> number of arrows or bullets left</li><li class="listitem" style="list-style-type: disc">Data type: int (whole numbers)</li><li class="listitem" style="list-style-type: disc">UI: text count or images</li></ul></div></li><li class="listitem" style="list-style-type: disc">Collection of<a class="indexterm" id="id171"/> related items<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Example(s): keys of different colors to open correspondingly colored doors, potions of different strength with different titles</li><li class="listitem" style="list-style-type: disc">Data structure: a struct or class for the general item type (for example, class <code class="literal">Key</code> (color/cost/doorOpenTagString), stored as an array or List&lt;&gt;</li><li class="listitem" style="list-style-type: disc">UI: text list or list/grid arrangement of icons</li></ul></div></li><li class="listitem" style="list-style-type: disc">Collection of<a class="indexterm" id="id172"/> different items<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Example(s): keys, potions, weapons, tools—all in the same inventory system</li><li class="listitem" style="list-style-type: disc">Data structure: List&lt;&gt; or Dictionary&lt;&gt; or array of objects, which can be instances of different class for each item type</li></ul></div></li></ul></div><p>Each of the above representations and UI display methods are illustrated by the recipes in this chapter.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec27"/>Creating a simple 2D mini-game – SpaceGirl</h1></div></div></div><p>This recipe presents the steps to create the 2DSpaceGirl mini-game, on which all the recipes of this <a class="indexterm" id="id173"/>chapter are based.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec65"/>Getting ready</h2></div></div></div><p>For this recipe, we have prepared the images you need in a folder named <code class="literal">Sprites</code> in the <code class="literal">1362_02_01 </code>folder. We have also provided the completed game as a Unity package in this folder named <code class="literal">Simple2DGame_SpaceGirl</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec66"/>How to do it...</h2></div></div></div><p>To create the simple 2D mini-game <em>Space Girl</em> follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a<a class="indexterm" id="id174"/> new, empty 2D project.</li><li class="listitem">Import supplied folder <code class="literal">Sprites</code> into your project.</li><li class="listitem">Convert each sprite image to be of type <strong>Sprite (2D and UI)</strong>. To do this, select the sprite in the <strong>Project</strong> panel, then, in the <strong>Inspector</strong>, change choose <strong>Sprite (2D and UI)</strong> from the drop-down menu <strong>Texture Type</strong>, and click on the <strong>Apply</strong> button, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_54.jpg"/></div></li><li class="listitem">Set the Unity<a class="indexterm" id="id175"/> Player screen size to 800 x 600: choose the <strong>Edit</strong> | <strong>Project Settings</strong> | <strong>Player </strong>menu, then for option <strong>Resolution and Presentation</strong> uncheck <code class="literal">Default is Full Screen,</code> and set the width to <code class="literal">800</code> and height to <code class="literal">600</code>, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_03.jpg"/></div></li><li class="listitem">Select the <strong>Game</strong> panel; if not already chosen, then choose <strong>Standalone (800 x 600)</strong> from the drop-down menu, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_02.jpg"/></div></li><li class="listitem">Display the <strong>Tags &amp; Layers</strong> properties for the current Unity project. Choose menu <strong>Edit</strong> | <strong>Project Settings</strong> | <strong>Tags and Layers</strong>. Alternatively, if you are already editing a GameObject, then you can select the <strong>Add Layer…</strong> menu from the<a class="indexterm" id="id176"/> <strong>Layer</strong> drop-down menu at the top of the <strong>Inspector</strong> panel, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_51.jpg"/></div></li><li class="listitem">The <strong>Inspector</strong> should now being displaying the <strong>Tags &amp; Layers</strong> properties for the current Unity project. Use the expand/contract triangle tools to contract <strong>Tags</strong> and <strong>Layers</strong>, and to expand <strong>Sorting Layers</strong>.</li><li class="listitem">Use the plus sign <strong>+</strong> button to add two new sorting layers, as shown in the following screenshot: first, add one named <strong>Background</strong>, and next, add one named <strong>Foreground</strong>. The sequence is important, since Unity will draw items in layers further down this list on top of items earlier in the list.<div><img alt="How to do it..." src="img/1362OT_02_52.jpg"/></div></li><li class="listitem">Drag the sprite <code class="literal">background-blue </code>from the <strong>Project </strong>panel (folder <code class="literal">Sprites</code>) into either the <strong>Game</strong> or <strong>Hierarchy</strong> panel to create a GameObject for the current scene.</li><li class="listitem">Set the <strong>Sorting Layer </strong>of GameObject <code class="literal">background-blue </code>to <strong>Background</strong> (in the <strong>Sprite Renderer</strong> component).</li><li class="listitem">Drag sprite<a class="indexterm" id="id177"/> <code class="literal">star</code> from the <strong>Project</strong> panel (folder <code class="literal">Sprites</code>) into either the <strong>Game</strong> or <strong>Hierarchy</strong> panel to create a GameObject for the current scene.</li><li class="listitem">In the <strong>Inspector </strong>panel, add a new tag <strong>Star</strong> by selecting the <strong>Add Tag…</strong> option from the <strong>Tag</strong> drop-down menu at the top of the <strong>Inspector</strong> panel, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_04.jpg"/></div></li><li class="listitem">Apply the <strong>Star</strong> tag to GameObject <code class="literal">star</code> in the <strong>Hierarchy</strong> scene.</li><li class="listitem">Set the <strong>Sorting Layer</strong> of GameObject <code class="literal">star</code> to <strong>Foreground</strong> (in the <strong>Sprite Renderer</strong> component).</li><li class="listitem">Add to GameObject <code class="literal">star</code> a Box Collider 2D (<strong>Add Component</strong> | <strong>Physics 2D</strong> | <strong>Box Collider 2D</strong>) and check its <code class="literal">Is Trigger</code>, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_08.jpg"/></div></li><li class="listitem">Drag sprite <code class="literal">girl1</code> from the <strong>Project</strong> panel (folder <code class="literal">Sprites</code>) into either the <strong>Game</strong> or <strong>Hierarchy</strong> panel to create a GameObject for the player's character in the current scene. Rename this GameObject <code class="literal">player-SpaceGirl</code>.</li><li class="listitem">Set the <strong>Sorting Layer </strong>of GameObject <code class="literal">player-SpaceGirl</code> to <strong>Foreground</strong> (in the <strong>Sprite Renderer</strong> component).</li><li class="listitem">Add to <a class="indexterm" id="id178"/>GameObject <code class="literal">player-SpaceGirl</code> a Box Collider 2D (<strong>Add Component</strong> | <strong>Physics 2D</strong> | <strong>Box Collider 2D</strong>).</li><li class="listitem">Add to GameObject <code class="literal">player-SpaceGirl</code> a RigidBody 2D (<strong>Add Component</strong> | <strong>Physics 2D</strong> | <strong>Rigid Body 2D</strong>). Set its <strong>Gravity Scale</strong> to zero (so it isn't falling down the screen due to simulated gravity), as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_31.jpg"/></div></li><li class="listitem">Create a new<a class="indexterm" id="id179"/> folder for your scripts named <code class="literal">Scripts</code>.</li><li class="listitem">Create the following C# Script <code class="literal">PlayerMove</code> (in folder <code class="literal">Scripts</code>) and add an instance as a component to GameObject <code class="literal">player-SpaceGirl</code> in the <strong>Hierarchy</strong>:<div><pre class="programlisting">using UnityEngine;
using System.Collections;

public class PlayerMove : MonoBehaviour {
  public float speed = 10;
  private Rigidbody2D rigidBody2D;

  void Awake(){
    rigidBody2D = GetComponent&lt;Rigidbody2D&gt;();
  }

  void FixedUpdate(){
    float xMove = Input.GetAxis("Horizontal");
    float yMove = Input.GetAxis("Vertical");

    float xSpeed = xMove * speed;
    float ySpeed = yMove * speed;
    
    Vector2 newVelocity = new Vector2(xSpeed, ySpeed);
    
    rigidBody2D.velocity = newVelocity;
  }
}</pre></div></li><li class="listitem">Save the scene (name it <strong>Main Scene</strong> and save it into a new folder named <code class="literal">Scenes</code>).</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec67"/>How it works...</h2></div></div></div><p>You have created a player character in the scene, with its movement scripted component <code class="literal">PlayerMove</code>. You <a class="indexterm" id="id180"/>have also created a star GameObject (a pickup), tagged <code class="literal">Star</code> and with a 2D box collider that will trigger a collision when the player's character hits it. When you run the game, the <code class="literal">player-SpaceGirl</code> character should move around using the <em>W A S D</em>, arrow keys, or joystick. Currently, nothing will happen if the <code class="literal">player-SpaceGirl</code> character hits a star since that has yet to be scripted.</p><p>You have added a background (GameObject <code class="literal">background-blue</code>) to the scene, which will be behind everything since it is in the rearmost sorting layer <strong>Background</strong>. Items you want to appear in front of this background (the player's character and the star so far) are placed on sorting layer <a class="indexterm" id="id181"/><strong>Foreground</strong>. Learn more about Unity tags and layers at <a class="ulink" href="http://docs.unity3d.com/Manual/class-TagManager.html">http://docs.unity3d.com/Manual/class-TagManager.html</a>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec28"/>Displaying single object pickups with carrying and not-carrying text</h1></div></div></div><p>Often the <a class="indexterm" id="id182"/>simplest inventory situation is to display text to tell players if they are carrying a single item (or not).</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec68"/>Getting ready</h2></div></div></div><p>This recipe assumes that you are <a class="indexterm" id="id183"/>starting with the project <code class="literal">Simple2Dgame_SpaceGirl</code> setup from the first recipe in this chapter. So, either make a copy of that project or do the following:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new, empty 2D project.</li><li class="listitem">Import the <code class="literal">Simple2Dgame_SpaceGirl</code> package.</li><li class="listitem">Open scene <strong>Scene1</strong> (in the <code class="literal">Scenes</code> folder).</li><li class="listitem">Set the Unity Player screen size to 800 x 600 (see the previous recipe for how to do this) and select this resolution in the <strong>Game</strong> panel the drop-down menu.</li><li class="listitem">Convert each sprite image to be of type <strong>Sprite (2D and UI)</strong>. In the <strong>Inspector,</strong> choose <strong>Sprite (2D and UI)</strong> from drop-down menu <strong>Texture Type</strong>, and click on the <strong>Apply</strong> button.</li></ol></div><p>For this recipe, we have prepared the font you need in a folder named <code class="literal">Fonts</code> in the <code class="literal">1362_02_02</code> folder.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec69"/>How to do it...</h2></div></div></div><p>To display text to inform the user about the status of carrying a single object pickup, follow these<a class="indexterm" id="id184"/> steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Start with <a class="indexterm" id="id185"/>a new copy of mini-game <code class="literal">Simple2Dgame_SpaceGirl</code>.</li><li class="listitem">Add a UI <strong>Text</strong> object (<strong>Create</strong> | <strong>UI</strong> | <strong>Text</strong>). Rename it <code class="literal">Text-carrying-star</code>. Change its text to <code class="literal">Carrying star: false</code>.</li><li class="listitem">Import the provided <code class="literal">Fonts</code> folder into your project.</li><li class="listitem">In the <strong>Inspector</strong> panel, set the font of <code class="literal">Text-carrying-star</code> to <strong>Xolonium-Bold</strong> (folder <code class="literal">Fonts</code>), and set its color to yellow. Center the text horizontally and vertically, and set its <strong>Height</strong> to <code class="literal">50</code>, and set the <strong>Font Size</strong> to <code class="literal">32</code>, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_05.jpg"/></div></li><li class="listitem">In its <strong>Rect Transform</strong> component, set its <strong>Height</strong> to <code class="literal">50</code>, as shown in the next screenshot:<div><img alt="How to do it..." src="img/1362OT_02_53.jpg"/></div></li><li class="listitem">Edit its <strong>Rect Transform</strong>, and while holding down <em>SHIFT</em> and <em>ALT</em> (to set pivot and<a class="indexterm" id="id186"/> position), choose the top-stretch box, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_06.jpg"/></div></li><li class="listitem">Your text <a class="indexterm" id="id187"/>should now be positioned at the middle top of the <strong>Game</strong> panel, and its width should stretch to match that of the whole panel, as shown in the next screenshot:<div><img alt="How to do it..." src="img/1362OT_02_07.jpg"/></div></li><li class="listitem">Add the<a class="indexterm" id="id188"/> following<a class="indexterm" id="id189"/> C# Script <code class="literal">Player</code> to GameObject <code class="literal">player-SpaceGirl</code> in the <strong>Hierarchy</strong>:<div><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI;

public class Player : MonoBehaviour {
  public Text starText;
  private bool carryingStar = false;

  void Start(){
    UpdateStarText();
  }

  void OnTriggerEnter2D(Collider2D hit){
    if(hit.CompareTag("Star")){
      carryingStar = true;
      UpdateStarText();
      Destroy(hit.gameObject);
    }
  }

  private void UpdateStarText(){
    string starMessage = "no star :-(";
    if(carryingStar) starMessage = "Carrying star :-)";
    starText.text = starMessage;
  }
}</pre></div></li><li class="listitem">From the <strong>Hierarchy</strong> view, select the GameObject <code class="literal">player-SpaceGirl</code>. Then, from the <strong>Inspector</strong>, access the <strong>Player (Script)</strong> component and populate the <strong>Star Text</strong> public field with UI <strong>Text</strong> object <code class="literal">Text-carrying-star</code>, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_10.jpg"/></div></li><li class="listitem">When you play<a class="indexterm" id="id190"/> the scene, after moving the character into the star, the star should disappear, and the onscreen<a class="indexterm" id="id191"/> UI <strong>Text</strong> message should change to <strong>Carrying star :-)</strong> , as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_09.jpg"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec70"/>How it works...</h2></div></div></div><p>The <code class="literal">Text</code> variable <code class="literal">starText</code> is a reference to the UI <strong>Text</strong> object <code class="literal">Text-carrying-star</code>. The <code class="literal">bool</code> variable <code class="literal">carryingStar</code> represents whether or not the player is carrying the star at any point in time; it is initialized to false.</p><p>The <code class="literal">UpdateStarText()</code> method <a class="indexterm" id="id192"/>copies the contents of the <code class="literal">starMessage </code>string to the text property of <code class="literal">starText</code>. The default value of this string tells the user that the player is not carrying the<a class="indexterm" id="id193"/> star, but an <code class="literal">if</code> statement tests the value of <code class="literal">carryingKey</code>, and, if that is true, then the message is changed to inform the player that they are carrying the star.</p><p>Each time the player's character collides with any object that has its <strong>Is Trigger</strong> set to <code class="literal">true</code>, an <code class="literal">OnTriggerEnter2D()</code> event message is sent to both objects involved in the collision. The <code class="literal">OnTriggerEnter2D()</code> message is passed a parameter that is the <code class="literal">Collider2D</code> component inside the object just collided with.</p><p>Our player's <code class="literal">OnTriggerEnter2D()</code> method<a class="indexterm" id="id194"/> tests the <code class="literal">tag</code> string of the object collided with to see if it has the <a class="indexterm" id="id195"/>value <strong>Star</strong>. Since the GameObject <strong>star</strong> we created has its trigger set, and has the tag <strong>Star</strong>, the <code class="literal">if</code> statement inside this method will detect a collision with <strong>star</strong> and complete three actions: it sets the Boolean variable <code class="literal">carryingStar</code> to <code class="literal">true</code>, it calls the method <code class="literal">UpdateStarText()</code>, and it destroys the GameObject it has just collided with (in this case, <strong>star</strong>).</p><div><div><h3 class="title"><a id="note22"/>Note</h3><p>NOTE: Boolean variables are often<a class="indexterm" id="id196"/> referred to as <strong>flags.</strong>
</p><p>The use of a bool (true/false) variable to represent whether some feature of the game state is true or false is very common. Programmers often refer to these variables as flags. So, programmers might refer to the <code class="literal">carryingStar</code> variable as the star-carrying flag.</p></div></div><p>When the scene begins, via the <code class="literal">Start()</code>method, we call the <code class="literal">UpdateStarText()</code>method; this ensures that we are not relying on text typed into the UI <strong>Text</strong> object <code class="literal">Text-carrying-star</code> at design time, but that the UI seen by the user is always set by our run-time methods. This avoids problems where the words to be displayed to the user are changed in code and not in the <strong>Inspector</strong> panel—which leads to a mismatch between the onscreen text when the scene first runs and after it has been updated from a script.</p><div><div><h3 class="title"><a id="note23"/>Note</h3><p>A golden rule in Unity game design is to <strong>avoid duplicating content in more than one place</strong>, and, therefore, we avoid having to maintain two or more copies of the same content. Each duplicate is an opportunity for maintenance issues when some, but not all, copies of a value are changed.</p><p>Maximizing use of prefabs is another example of this principle in action. This is also know as the DRY principal - Do Not Repeat Yourself.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec71"/>There's more...</h2></div></div></div><p>Some details you don't want to miss:</p><div><div><div><div><h3 class="title"><a id="ch02lvl3sec18"/>The separation of view logic</h3></div></div></div><p>A game design pattern (best practice approach) called<a class="indexterm" id="id197"/> the <strong>Model-View-Controller</strong> pattern (<strong>MVC</strong>) is to separate the code that updates the UI from the code that changes player and game <a class="indexterm" id="id198"/>variables such as score and inventory item lists. Although this recipe has only one variable and one method to update the UI, well structured game architectures scale up to cope with more complex games, so it is often worth the effort of a little more code and an extra script class, even at this game-beginning stage, if we want our final game architecture to be well structured and maintainable.</p><p>To implement the separation of view pattern for this recipe, we need to do the following:</p><div><ol class="orderedlist arabic"><li class="listitem">Add the following C# Script <code class="literal">PlayerInventoryDisplay</code> to GameObject <code class="literal">player-SpaceGirl</code> in the <strong>Hierarchy</strong>:<div><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI;

public class PlayerInventoryDisplay : MonoBehaviour
{
  public Text starText;

  public void OnChangeCarryingStar(bool carryingStar){
    string starMessage = "no star :-(";
    if(carryingStar) starMessage = "Carrying star :-)";
    starText.text = starMessage;
  }
}</pre></div></li><li class="listitem">From the <strong>Hierarchy</strong> view, select the GameObject <code class="literal">player-SpaceGirl</code>. Then, from the <strong>Inspector</strong>, access the <code class="literal">PlayerInventoryDisplay</code><strong> (Script)</strong> component and populate the <strong>Score Text</strong> public field with the UI <strong>Text</strong> object <code class="literal">Text-carrying-star</code>.</li><li class="listitem">Remove the existing C# Script component <code class="literal">Player</code> and replace it with this C# Script <code class="literal">PlayerInventory</code> containing the following (simplified) code:<div><pre class="programlisting">using UnityEngine;
using System.Collections;

public class PlayerInventory : MonoBehaviour {
  private PlayerInventoryDisplay playerInventoryDisplay;
  private bool carryingStar = false;

  void Start(){
    playerInventoryDisplay = GetComponent&lt;PlayerInventoryDisplay&gt;();
  playerInventoryDisplay.OnChangeCarryingStar(carryingStar);
  }

  void OnTriggerEnter2D(Collider2D hit){
    if(hit.CompareTag("Star")){
      carryingStar = true;
  playerInventoryDisplay.OnChangeCarryingStar(carryingStar);
      Destroy(hit.gameObject);
    }
  }
}</pre></div></li></ol></div><p>As can be seen, the <a class="indexterm" id="id199"/>
<code class="literal">PlayerInventory</code> script class no longer has to maintain a link to the UI <strong>Text</strong> or worry about changing the text property of that UI component—all that work is now the responsibility of the <code class="literal">PlayerInventoryDisplay</code> script. When the Player instance component detects a collision with the star, after changing the <code class="literal">carryingStar</code> bool flag's value to <code class="literal">true</code>, it just calls the <code class="literal">OnChangeCarryingStar()</code>method of the <code class="literal">PlayerInventoryDisplay</code> component.</p><p>The result is that the code for the script class <code class="literal">PlayerInventory</code> concentrates on the player collision and status variables, while the code for the script class <code class="literal">PlayerInventoryDisplay</code> handles the communication to the user. Another advantage of this design pattern is that the method in which the information is communicated to the user via the UI can be changed (for example, from text to an icon), without any change to the code in script class <code class="literal">Player</code>.</p><div><div><h3 class="title"><a id="note24"/>Note</h3><p>Note: There is no difference in the experience of the player, and all the changes are to improve the architectural structure of our game code.</p></div></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec29"/>Displaying single object pickups with carrying and not-carrying icons</h1></div></div></div><p>Graphic icons are an effective way to inform the player that they are carrying an item. In this recipe, if no star is being carried, a grey-filled icon in a blocked-off circle is displayed; then, after<a class="indexterm" id="id200"/> the star has been picked up, a <a class="indexterm" id="id201"/>yellow-filled icon is displayed, as shown in the following screenshot.</p><div><img alt="Displaying single object pickups with carrying and not-carrying icons" src="img/1362OT_02_14.jpg"/></div><p>In many cases, icons are clearer (they don't require reading and thinking about) and can also be smaller onscreen than text messages for indicating player status and inventory items.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec72"/>Getting ready</h2></div></div></div><p>This recipe assumes that you are starting with the project <code class="literal">Simple2Dgame_SpaceGirl</code> setup from the first recipe in this chapter.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec73"/>How to do it...</h2></div></div></div><p>To toggle carrying and not-carrying icons for a single object pickup, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Start with a new copy of the mini-game <code class="literal">Simple2Dgame_SpaceGirl</code>.</li><li class="listitem">In the <strong>Hierarchy</strong> panel, add a new UI <strong>Image</strong> object (<strong>Create</strong> | <strong>UI</strong> | <strong>Image</strong>). Rename it <code class="literal">Image-star-icon</code>.</li><li class="listitem">Select <code class="literal">Image-star-icon</code> in the <strong>Hierarchy</strong> panel.</li><li class="listitem">From the <strong>Project</strong> panel, drag the sprite <strong>icon_nostar_100</strong> (folder <code class="literal">Sprites</code>) into the <strong>Source Image</strong> field in the <strong>Inspector</strong> (in the <strong>Image (Script)</strong> component).</li><li class="listitem">Click on the <strong>Set Native Size</strong> button for the <strong>Image</strong> component. This will resize the UI <strong>Image</strong> to fit the physical pixel width and height of sprite file <strong>icon_nostar_100</strong>, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_11.jpg"/></div></li><li class="listitem">Now, we <a class="indexterm" id="id202"/>will position our icon at the <strong>top </strong>and <strong>left</strong> of the <strong>Game</strong> panel. Edit the UI <strong>Image's Rect Transform</strong> component, and while holding down <em>SHIFT</em> and <em>ALT</em> (to set pivot and position), choose the top-left box. The UI <strong>Image</strong> should now be positioned at the<a class="indexterm" id="id203"/> top left of the <strong>Game</strong> panel, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_12.jpg"/></div></li><li class="listitem">Add the following C# Script <code class="literal">Player</code> to GameObject <code class="literal">player-SpaceGirl</code> in the <strong>Hierarchy</strong>:<div><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI;

public class Player : MonoBehaviour {
  public Image starImage;
  public Sprite iconStar;
  public Sprite iconNoStar;
  private bool carryingStar = false;

  void OnTriggerEnter2D(Collider2D hit){
    if(hit.CompareTag("Star")){
      carryingStar = true;
      UpdateStarImage();
      Destroy(hit.gameObject);
    }
  }

  private void UpdateStarImage(){
    if(carryingStar)
      starImage.sprite = iconStar;
    else
      starImage.sprite = iconNoStar;
  }
}</pre></div></li><li class="listitem">From the <strong>Hierarchy</strong> view, select the GameObject <code class="literal">player-SpaceGirl</code>. Then, from the <strong>Inspector</strong>, access the <strong>Player (Script)</strong> component and populate the <strong>Star Image</strong><a class="indexterm" id="id204"/> public field with UI <strong>Image</strong> object <code class="literal">Image-star-icon</code>.</li><li class="listitem">Now, populate the <a class="indexterm" id="id205"/><strong>Icon Star</strong> public field from the <strong>Project</strong> panel with sprite <code class="literal">icon_star_100</code> and populate the <strong>Icon No Star</strong> public field from the <strong>Project</strong> panel with sprite <code class="literal">icon_nostar_100</code>, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_13.jpg"/></div></li><li class="listitem">Now when you play the scene, you should see the no star icon (a grey-filled icon in a blocked-off circle) at the top left until you pick up the star, at which point it will change to show the carrying star icon (yellow-filled star).</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec74"/>How it works...</h2></div></div></div><p>The <code class="literal">Image</code> variable <a class="indexterm" id="id206"/>
<code class="literal">starImage</code> is a reference to the UI <strong>Image</strong> object <code class="literal">Image-star-icon</code>. <code class="literal">Sprite</code> variables <code class="literal">iconStar</code> and <code class="literal">iconNoStar</code> are references to the <code class="literal">Sprite</code> files in the <strong>Project</strong> panel—the sprites to tell the player whether or not a star is being carried. The <code class="literal">bool</code> variable <code class="literal">carryingStar</code> represents internally as program data whether or not the player is carrying the star at any point in time; it is<a class="indexterm" id="id207"/> initialized to <code class="literal">false</code>.</p><p>Much of the logic for this recipe is the same as the previous one. Each time the <code class="literal">UpdateStarImage()</code>method is called, it sets the UI <strong>Image</strong> to the sprite that corresponds to the value of bool variable <code class="literal">carryingsStar</code>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec30"/>Displaying multiple pickups of the same object with text totals</h1></div></div></div><p>When several items<a class="indexterm" id="id208"/> of the same type <a class="indexterm" id="id209"/>have been picked up, often the simplest way to convey what is being carried to the user is to display a text message showing the numeric total of each item type being carried, as shown in the following screenshot. In this recipe, the total number of stars collected is displayed using a UI <strong>Text</strong> object.</p><div><img alt="Displaying multiple pickups of the same object with text totals" src="img/1362OT_02_15.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec75"/>Getting ready</h2></div></div></div><p>This recipe <a class="indexterm" id="id210"/>assumes you are starting with project <code class="literal">Simple2Dgame_SpaceGirl</code> setup from the first recipe in this chapter. The font <a class="indexterm" id="id211"/>you need can be found in folder <code class="literal">1362_02_02</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec76"/>How to do it...</h2></div></div></div><p>To display inventory total text for multiple pickups of same type of object, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Start with a new copy of the mini-game <code class="literal">Simple2Dgame_SpaceGirl</code>.</li><li class="listitem">Add a UI <strong>Text</strong> object (<strong>Create</strong> | <strong>UI</strong> | <strong>Text</strong>). Rename it <code class="literal">Text-carrying-star</code>. Change its text to <strong>stars = 0</strong>.</li><li class="listitem">Import the provided <code class="literal">Fonts</code> folder into your project.</li><li class="listitem">In the <strong>Inspector</strong> panel, set the font of <code class="literal">Text-carrying-star</code> to <strong>Xolonium-Bold</strong> (folder <code class="literal">Fonts</code>) and set its color to yellow. Center the text horizontally and vertically, and set its <strong>Font Size</strong> to <code class="literal">32</code>.</li><li class="listitem">In its <strong>Rect Transform</strong> component, set its <strong>Height</strong> to <code class="literal">50</code>. Edit its <strong>Rect Transform</strong>, and while holding down <em>SHIFT</em> and <em>ALT</em> (to set pivot and position), choose the top-stretch box. Your text should now be positioned at the middle top of the <strong>Game</strong> panel, and its width should stretch to match that of the whole panel.</li><li class="listitem">Add the following C# Script <code class="literal">Player</code> to GameObject <code class="literal">player-SpaceGirl</code> in the <strong>Hierarchy</strong>:<div><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI;

public class Player : MonoBehaviour {
  public Text starText;
  private int totalStars = 0;

  void Start(){
    UpdateStarText();
  }

  void OnTriggerEnter2D(Collider2D hit){
    if(hit.CompareTag("Star")){
      totalStars++;
      UpdateStarText();
      Destroy(hit.gameObject);
    }
  }

  private void UpdateStarText(){
    string starMessage = "stars = " + totalStars;
    starText.text = starMessage;
  }
}</pre></div></li><li class="listitem">From the<a class="indexterm" id="id212"/> <strong>Hierarchy</strong> view, select the GameObject <code class="literal">player-SpaceGirl</code>. Then, from the <strong>Inspector</strong>, access the <strong>Player (Script)</strong> component and populate the <strong>Star Text</strong> public field with UI <strong>Text</strong> object <code class="literal">Text-carrying-star</code>.</li><li class="listitem">Select the GameObject <code class="literal">star</code> in the <strong>Hierarchy</strong> panel and make three more copies of this GameObject.<div><div><h3 class="title"><a id="note25"/>Note</h3><p>Note: Use keyboard shortcut <em>CTRL</em> + <em>D</em> (Windows) or <em>CMD</em> + <em>D</em> (Mac) to quickly duplicate GameObjects.</p></div></div></li><li class="listitem">Move these new GameObject to different parts of the screen.</li><li class="listitem">Play the game—each time you pick up a star, the total should be displayed in the form <strong>stars = 2</strong>.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec77"/>How it works...</h2></div></div></div><p>The <code class="literal">Text</code> variable <code class="literal">starText</code> is a reference to the UI <strong>Text</strong> object <code class="literal">Text-carrying-star</code>. The <code class="literal">int</code> variable <code class="literal">totalStars</code> represents how many stars have been collected so far; it is initialized to zero.</p><p>In the <code class="literal">OnTriggerEnter2D()</code> method, the<a class="indexterm" id="id213"/> <code class="literal">totalStars</code> counter is incremented by 1 each time the player's character hits an object tagged <strong>Star</strong>. The collided star GameObject is destroyed and a call is made to the <code class="literal">UpdateStarText()</code>method.</p><p>The <code class="literal">UpdateStarText()</code> method updates <a class="indexterm" id="id214"/>the text content of UI <strong>Text</strong> object <code class="literal">Text-carrying-star</code> with<a class="indexterm" id="id215"/> text string <code class="literal">stars =</code> concatenated with the integer value inside variable <code class="literal">totalStars</code> to display the updated total number of stars to the user.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec31"/>Displaying multiple pickups of the same object with multiple status icons</h1></div></div></div><p>If there is a small, fixed total number of an item to be collected rather than text totals, an alternative effective UI approach is to display placeholder icons (empty or greyed out pictures) to show the user how many of the item remain to be collected, and each time an item is picked up, a<a class="indexterm" id="id216"/> placeholder icon is replaced by a full color collected icon.</p><p>In this recipe, we use grey-filled star icons as the placeholders and yellow-filled star icons to indicate each collected star, as shown in the following screenshot.</p><p>Since our UI code is getting a little more complicated, this recipe will implement the MVC design pattern to separate the view code from the core player logic (as introduced at the end of recipe <em>Displaying single object pickups with carrying and not-carrying text</em>).</p><div><img alt="Displaying multiple pickups of the same object with multiple status icons" src="img/1362OT_02_16.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec78"/>Getting ready</h2></div></div></div><p>This recipe assumes that you are starting with the project <code class="literal">Simple2Dgame_SpaceGirl</code> setup from the first recipe in this chapter.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec79"/>How to do it...</h2></div></div></div><p>To display multiple<a class="indexterm" id="id217"/> inventory icons for multiple pickups of same type of object, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Start with a new copy of the mini-game <code class="literal">Simple2Dgame_SpaceGirl</code>.</li><li class="listitem">Add the following C# Script <code class="literal">Player</code> to GameObject <code class="literal">player-SpaceGirl</code> in the <strong>Hierarchy</strong>:<div><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI;

public class Player : MonoBehaviour {
  private PlayerInventoryDisplay playerInventoryDisplay;
  private int totalStars = 0;
  
  void Start(){
    playerInventoryDisplay = GetComponent&lt;PlayerInventoryDisplay&gt;();
  }
  
  void OnTriggerEnter2D(Collider2D hit){
    if(hit.CompareTag("Star")){
      totalStars++;
  playerInventoryDisplay.OnChangeStarTotal(totalStars);
      Destroy(hit.gameObject);
    }
  }
}</pre></div></li><li class="listitem">Select GameObject <code class="literal">star</code> in the <strong>Hierarchy</strong> panel and make three more copies of this GameObject (Windows <em>CTRL</em> + <em>D</em> / Mac <em>CMD</em> + <em>D</em>).</li><li class="listitem">Move these new GameObject to different parts of the screen.</li><li class="listitem">Add the following C# Script <code class="literal">PlayerInventoryDisplay</code> to the GameObject <code class="literal">player-SpaceGirl</code> in the <strong>Hierarchy:</strong><div><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI;

public class PlayerInventoryDisplay : MonoBehaviour
{
  public Image[] starPlaceholders;

  public Sprite iconStarYellow;
  public Sprite iconStarGrey;

  public void OnChangeStarTotal(int starTotal){
    for (int i = 0;i &lt; starPlaceholders.Length; ++i){
    if (i &lt; starTotal)
        starPlaceholders[i].sprite = iconStarYellow;
      else
        starPlaceholders[i].sprite = iconStarGrey;
    }
  }
}</pre></div></li><li class="listitem">Select the <strong>Canvas</strong> in the <strong>Hierarchy</strong> panel and add a new UI Image object (<strong>Create</strong> | <strong>UI</strong> | <strong>Image</strong>). Rename it <code class="literal">Image-star0</code>.</li><li class="listitem">Select <code class="literal">Image-star0</code> in the <strong>Hierarchy</strong> panel.</li><li class="listitem">From the <strong>Project</strong> <a class="indexterm" id="id218"/>panel, drag the sprite <code class="literal">icon_star_grey_100</code> (folder <code class="literal">Sprites</code>) into the <strong>Source Image</strong> field in the <strong>Inspector</strong> for the <strong>Image</strong> component.</li><li class="listitem">Click on the <strong>Set Native Size</strong> button for this for the <strong>Image</strong> component. This will resize the UI <strong>Image</strong> to fit the physical pixel width and height of sprite file <code class="literal">icon_star_grey_100</code>.</li><li class="listitem">Now we will position our icon at the <strong>top </strong>and <strong>left</strong> of the <strong>Game</strong> panel. Edit the UI <strong>Image's Rect Transform</strong> component, and while holding down <em>SHIFT</em> and <em>ALT</em> (to set pivot and position), choose the top-left box. The UI <strong>Image</strong> should now be positioned at the top left of the <strong>Game</strong> panel.</li><li class="listitem">Make three more copies of <code class="literal">Image-star0</code> in the <strong>Hierarchy</strong> panel, naming them <code class="literal">Image-star1</code>, <code class="literal">Image-star2</code>, and <code class="literal">Image-star3</code>.</li><li class="listitem">In the <strong>Inspector</strong> panel, change the <strong>Pos X</strong> position (in the <strong>Rect Transform</strong> component) of <code class="literal">Image-star1</code> to <code class="literal">100</code>, of <code class="literal">Image-star2</code> to <code class="literal">200</code>, and of <code class="literal">Image-star3</code> to <code class="literal">100</code>, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_17.jpg"/></div></li><li class="listitem">From the <strong>Hierarchy</strong> view, select the GameObject <code class="literal">player-SpaceGirl</code>. Then, from the <strong>Inspector</strong>, access the <strong>Player Inventory Display (Script)</strong> component and set the <strong>Size</strong> property of public field <strong>Star Playholders</strong> to <code class="literal">4</code>.</li><li class="listitem">Next, populate<a class="indexterm" id="id219"/> the <strong>Element 0/1/2/3 </strong>array values of public field <strong>Star Playholders </strong>with UI <strong>Image</strong> objects <code class="literal">Image-star0/1/2/3</code>.</li><li class="listitem">Now, populate the <strong>Icon Star Yellow</strong> and <strong>Icon Star Grey</strong> public fields from the <strong>Project</strong> panel with sprite <code class="literal">icon_star_100</code> and <code class="literal">icon_star_grey_100</code>, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_18.jpg"/></div></li><li class="listitem">Now, when you play the scene, you should see the sequence of four grey placeholder star icons initially, and each time you collide with a star, the next icon at the top should turn yellow.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec80"/>How it works...</h2></div></div></div><p>Four UI <strong>Image</strong> objects <code class="literal">Image-star0/1/2/3 </code>have been created at the top of the screen, initialized with the<a class="indexterm" id="id220"/> grey placeholder icon. The grey and yellow icon sprite files have been resized to be 100 x 100 pixels, making their arrangement horizontal positioning at design time easier, since their positions are (0,0), (100, 0), (200, 0), and (300,0). In a more complicated game screen, or one where real estate is precious, the actual size of the icons would probably be smaller and whatever the game graphic designer decides.</p><p>The <code class="literal">int</code> variable <code class="literal">totalStars</code> represents how many stars have been collected so far; it is initialized to zero. The <code class="literal">PlayerInventoryDisplay</code> variable <code class="literal">playerInventory</code> is a reference to the scripted component that manages our inventory display—this variable is set when the scene begins to run in the <code class="literal">Start()</code> method.</p><p>In the <code class="literal">OnTriggerEnter2D()</code>method, the <code class="literal">totalStars</code> counter is incremented by 1 each time the player's character hits an object tagged <strong>Star</strong>. As well as destroying the hit GameObject, the <code class="literal">OnChangeStarTotal(…)</code> method of the <code class="literal">PlayerInventoryDisplay</code> component is called, passing the new star total integer.</p><p>The <code class="literal">OnChangeStarTotal(…)</code>method of script class <code class="literal">PlayerInventoryDisplay</code> has references to the four UI <strong>Images</strong>, and loops through each item in the array of Image references, setting the given number of Images to yellow, and the remaining to grey. This method is public, allowing it to be called<a class="indexterm" id="id221"/> from an instance of script class <code class="literal">Player</code>.</p><p>As can be seen, the code in script class <code class="literal">Player</code> is still quite straightforward since we have moved all of the inventory UI logic to its own class, <code class="literal">PlayerInventory</code>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec32"/>Revealing icons for multiple object pickups by changing the size of a tiled image</h1></div></div></div><p>Another approach that could be taken to show increasing numbers of images is to make use of tiled images. The<a class="indexterm" id="id222"/> same visual effect as in the previous recipe can also be achieved by making use of a tiled grey star image of width 400 (showing four copies of the grey star icon), behind a tiled yellow star image, whose width is 100 times the number of stars collected. We'll adapt the previous recipe to illustrate this technique.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec81"/>Getting ready</h2></div></div></div><p>This recipe follows on from the previous recipe in this chapter.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec82"/>How to do it...</h2></div></div></div><p>To display grey and yellow star icons for multiple object pickups using tiled images, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Make a copy of your work for the previous recipe.</li><li class="listitem">In the <strong>Hierarchy</strong> panel, remove the four Image-star0/1/2/3 UI <strong>Images</strong> in the <strong>Canvas</strong>.</li><li class="listitem">Select the <strong>Canvas</strong> in the <strong>Hierarchy</strong> panel and add a new UI <strong>Image</strong> object (<strong>Create</strong> | <strong>UI</strong> | <strong>Image</strong>). Rename it <code class="literal">Image-stars-grey</code>.</li><li class="listitem">Select <code class="literal">Image-stars-grey</code> in the <strong>Hierarchy</strong> panel.</li><li class="listitem">From the <strong>Project</strong> panel, drag sprite <code class="literal">icon_star_grey_100</code> (folder <code class="literal">Sprites</code>) into the <strong>Source Image</strong> field in the <strong>Inspector</strong> (in the <strong>Image (Script)</strong> component).</li><li class="listitem">Click on the <strong>Set Native Size</strong> button for this for the <strong>Image</strong> component. This will resize the UI <strong>Image</strong> to fit the physical pixel width and height of sprite file <strong>star_empty_icon.</strong></li><li class="listitem">Now we will position our icon at the <strong>top </strong>and <strong>left</strong> of the <strong>Game</strong> panel. Edit the UI <strong>Image's Rect Transform</strong> component, and while holding down <em>SHIFT</em> and <em>ALT</em> (to set pivot and position), choose the top-left box. The UI <strong>Image</strong> should now be positioned at the top left of the <strong>Game</strong> panel.</li><li class="listitem">In the <strong>Inspector</strong> <a class="indexterm" id="id223"/>panel, change the <strong>Width</strong> (in the <strong>Rect Transform</strong> component) of <code class="literal">Image-stars-grey</code> to 400. Also, set the <strong>Image Type</strong> (in the <strong>Image (Script)</strong> component) to <strong>Tiled</strong>, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_19.jpg"/></div></li><li class="listitem">Make a copy of <code class="literal">Image-stars-grey</code> in the <strong>Hierarchy</strong> panel, naming the copy <code class="literal">Image-stars-yellow</code>.</li><li class="listitem">With <code class="literal">Image-stars-yellow</code> selected in <strong>Hierarchy</strong> panel, from the <strong>Project</strong> panel, drag the sprite <code class="literal">icon_star_100</code> (folder <code class="literal">Sprites</code>) into the <strong>Source Image</strong> field in the <strong>Inspector</strong> (in the <strong>Image (Script)</strong> component).</li><li class="listitem">Set the width of <code class="literal">Image-stars-yellow</code> to 0 (in the <strong>Rect Transform</strong> component). So, now we have the yellow stars tiled image above the grey tiled image, but since its width is zero, we don't see any of the yellow stars yet.</li><li class="listitem">Replace the existing C# Script <code class="literal">PlayerInventoryDisplay</code> with the following code:<div><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI;

public class PlayerInventoryDisplay : MonoBehaviour
{
  public Image iconStarsYellow;

  public void OnChangeStarTotal(int starTotal){
    float newWidth = 100 * starTotal;
    iconStarsYellow.rectTransform.SetSizeWithCurrentAnchors(RectTransform.Axis.Horizontal, newWidth);
  }
}</pre></div></li><li class="listitem">From the <strong>Hierarchy</strong> view, select the GameObject <code class="literal">player-SpaceGirl</code>. Then, from the <strong>Inspector</strong>, access the <strong>Player Inventory Display (Script)</strong> component<a class="indexterm" id="id224"/> and populate the <strong>Icons Stars Yellow</strong> public field with UI <strong>Image</strong> object <code class="literal">Image-stars-yellow</code>.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec83"/>How it works...</h2></div></div></div><p>UI <strong>Image</strong> <code class="literal">Image-stars-grey</code> is a tiled image, wide enough (400px) for grey sprite <strong>icon_star_grey_100</strong> to be shown four times. UI <strong>Image</strong> <code class="literal">Image-stars-yellow</code> is a tiled image, above the grey one, initially with width set to zero, so no yellow stars can be seen.</p><p>Each time a star is picked up, a call is made to the <code class="literal">OnChangeStarTotal(…)</code>method of the script class <code class="literal">PlayerInventoryDisplay</code> , passing the new integer number of stars collected. By multiplying this by the width of the yellow sprite image (100px), we get the correct width to set for UI <strong>Image</strong> <code class="literal">Image-stars-yellow</code> so that the corresponding number of yellow stars will now be seen by the user. Any stars that remain to be collected will still be seen as the grey stars that are not yet covered up.</p><p>The actual task of changing the width of UI <strong>Image</strong> <code class="literal">Image-stars-yellow</code> is completed by calling the <code class="literal">SetSizeWithCurrentAnchors(…) </code>method. The first parameter is the axis, so we pass constant <code class="literal">RectTransform.Axis.Horizontal</code> so that it will be the width that is changed. The second parameter is the new size for that axis—so we pass a value that is 100 times the number of stars collected so far (variable <code class="literal">newWidth</code>).</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec33"/>Displaying multiple pickups of different objects as a list of text via a dynamic List&lt;&gt; of PickUp objects</h1></div></div></div><p>When working <a class="indexterm" id="id225"/>with different kinds of pickups, one approach is to use a C# <strong>List</strong> to maintain a flexible-length data structure of the items currently in the inventory. In this recipe, we will show you how, each time an item is picked up, a new object is added to such a <strong>List</strong> collection. An iteration through the <strong>List</strong> is how the text display of items is generated each time the inventory changes. We introduce a very simple <code class="literal">PickUp</code> script class, demonstrating how information about a pickup can be stored in a scripted component, extracted upon collision, and stored in our <strong>List</strong>.</p><div><img alt="Displaying multiple pickups of different objects as a list of text via a dynamic List&lt;&gt; of PickUp objects" src="img/1362OT_02_36.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec84"/>Getting ready</h2></div></div></div><p>This recipe assumes that you are starting with the project <code class="literal">Simple2Dgame_SpaceGirl</code> setup from the first recipe in this chapter. The font you need can be found in the <code class="literal">1362_02_02</code> folder.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec85"/>How to do it...</h2></div></div></div><p>To display inventory total text for multiple pickups of different object types, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Start with a new copy of the mini-game <code class="literal">Simple2Dgame_SpaceGirl</code>.</li><li class="listitem">Edit the tags, changing tag <strong>Star</strong> to <strong>Pickup</strong>. Ensure that the <code class="literal">star</code> GameObject now has the tag <strong>Pickup</strong>.</li><li class="listitem">Add the following C# Script <code class="literal">PickUp</code> to GameObject <code class="literal">star</code> in the <strong>Hierarchy</strong>:<div><pre class="programlisting">using UnityEngine;
using System.Collections;

public class PickUp : MonoBehaviour {
  public string description;
}</pre></div></li><li class="listitem">In the <strong>Inspector</strong>, change the description property of component <strong>Pick Up (Script)</strong> of GameObject <code class="literal">star</code> to the text <code class="literal">star</code>, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_37.jpg"/></div></li><li class="listitem">Select the GameObject <code class="literal">star</code> in the <strong>Hierarchy</strong> panel and make a copy of this GameObject, renaming the copy <code class="literal">heart</code>.</li><li class="listitem">In the <strong>Inspector,</strong> change the description property of component <strong>Pick Up (Script)</strong> of <a class="indexterm" id="id226"/>GameObject <code class="literal">heart</code> to the text <code class="literal">heart</code>. Also, drag from the <strong>Project</strong> panel (folder <code class="literal">Sprites</code>) image <strong>healthheart</strong> into the Sprite property of GameObject <code class="literal">heart</code>. The player should now see the heart image on screen for this pickup item.</li><li class="listitem">Select the GameObject <code class="literal">star</code> in the <strong>Hierarchy</strong> panel and make a copy of this GameObject, renaming the copy <code class="literal">key</code>.</li><li class="listitem">In the <strong>Inspector,</strong> change the description property of component <strong>Pick Up (Script)</strong> of GameObject <code class="literal">key</code> to the text <code class="literal">key.</code> Also, drag from the <strong>Project</strong> panel (folder <strong>Sprites</strong>) image <strong>icon_key_green_100</strong> into the <strong>Sprite</strong> property of GameObject <code class="literal">key</code>. The player should now see the key image on screen for this pickup item.</li><li class="listitem">Make another one or two copies of each pickup GameObject and arrange them around the screen, so there are two or three each of star, heart, and key pickup GameObjects.</li><li class="listitem">Add the following C# Script <code class="literal">Player</code> to GameObject <code class="literal">player-SpaceGirl</code> in the <strong>Hierarchy</strong>:<div><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI;
using System.Collections.Generic;

public class Player : MonoBehaviour {
  private PlayerInventoryDisplay playerInventoryDisplay;
  private List&lt;PickUp&gt; inventory = new List&lt;PickUp&gt;();

  void Start(){
    playerInventoryDisplay = GetComponent&lt;PlayerInventoryDisplay&gt;();
    playerInventoryDisplay.OnChangeInventory(inventory);
  }
  
  void OnTriggerEnter2D(Collider2D hit){
    if(hit.CompareTag("Pickup")){
      PickUp item = hit.GetComponent&lt;PickUp&gt;();
      inventory.Add( item );
      playerInventoryDisplay.OnChangeInventory(inventory);
      Destroy(hit.gameObject);
    }
  }
}</pre></div></li><li class="listitem">Add a UI <strong>Text</strong> object (<strong>Create</strong> | <strong>UI</strong> | <strong>Text</strong>). Rename it <code class="literal">Text-inventory-list</code>. Change its text to <strong>the quick brown fox jumped over the lazy dog the quick brown fox jumped over the lazy dog</strong>, or another long list of nonsense words, to test the overflow settings you change in the next step.</li><li class="listitem">In the <strong>Text (Script)</strong> component, ensure that <strong>Horizontal Overflow</strong> is set to <strong>Wrap</strong>, and set <strong>Vertical Overflow</strong> to <strong>Overflow</strong>—this will ensure that the text will wrap onto a second or third line (if needed) and not be hidden if there are lots of pickups.</li><li class="listitem">In the <strong>Inspector</strong> panel, set its font to <strong>Xolonium-Bold</strong> (folder <code class="literal">Fonts</code>) and set its color to <a class="indexterm" id="id227"/>yellow. For the <strong>Alignment</strong> property, center the text horizontally and ensure that the text is top aligned vertically, and set the <strong>Font Size</strong> to 28 and choose a yellow text <strong>Color</strong>.</li><li class="listitem">Edit its <strong>Rect Transform</strong> and set its <strong>Height</strong> to <code class="literal">50</code>. Then, while holding down <em>SHIFT</em> and <em>ALT</em> (to set pivot and position), choose the top-stretch box. The text should now be positioned at the middle top of the <strong>Game</strong> panel, and its width should stretch to match that of the whole panel.</li><li class="listitem">Your text should now appear at the top of the game panel.</li><li class="listitem">Add the following C# Script <code class="literal">PlayerInventoryDisplay</code> to GameObject <code class="literal">player-SpaceGirl</code> in the <strong>Hierarchy</strong>:<div><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI;
using System.Collections.Generic;

public class PlayerInventoryDisplay : MonoBehaviour
{
  public Text inventoryText;

  public void OnChangeInventory(List&lt;PickUp&gt; inventory){
    // (1) clear existing display
    inventoryText.text = "";

    // (2) build up new set of items
    string newInventoryText = "carrying: ";
    int numItems = inventory.Count;
    for(int i = 0; i &lt; numItems; i++){
      string description = inventory[i].description;
      newInventoryText += " [" + description+ "]";
    }

    if(numItems &lt; 1) newInventoryText = "(empty inventory)";

    // (3) update screen display
    inventoryText.text = newInventoryText;
  }
}</pre></div></li><li class="listitem">From the <strong>Hierarchy</strong> view, select the GameObject <code class="literal">player-SpaceGirl</code>. Then, from the <strong>Inspector</strong>, access the <strong>Player Inventory Display (Script)</strong> component and<a class="indexterm" id="id228"/> populate the <strong>Inventory Text</strong> public field with the UI <strong>Text</strong> object <code class="literal">Text-inventory-list</code>.</li><li class="listitem">Play the game—each time you pick up a star or key or heart, the updated list of what you are carrying should be displayed in the form <strong>carrying: [key] [heart]</strong>.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec86"/>How it works...</h2></div></div></div><p>In the script class <code class="literal">Player</code>, the variable <code class="literal">inventory</code> is a C# <strong>List&lt;&gt;</strong>. This is a flexible data structure, which can be sorted, searched, and dynamically (at run time, when the game is being played) have items added to and removed from it. The <code class="literal">&lt;PickUp&gt;</code> in pointy brackets means that variable <code class="literal">inventory</code> will contain a list of <code class="literal">PickUp</code> objects. For this recipe, our <code class="literal">PickUp</code> class just has a single field, a string description, but we'll add more sophisticated data items in <code class="literal">PickUp</code> classes in later recipes.</p><p>When the scene starts, the <code class="literal">Start()</code> method of script class <code class="literal">Player</code> gets a reference to the <code class="literal">PlayerInventoryDisplay</code> scripted component and also initializes variable <code class="literal">inventory</code> to be a new, empty C# List of <code class="literal">PickUp</code> objects. When the <code class="literal">OnColliderEnter2D(…)</code> method detects collisions with items tagged <code class="literal">Pickup</code>, the <code class="literal">PickUp</code> object component of the item hit is added to our <code class="literal">inventory</code> list. A call is also made to the <code class="literal">OnChangeInventory(…)</code> method of <code class="literal">playerInventoryDisplay </code>to update out inventory display to the player, passing the updated <code class="literal">inventory</code> <strong>List</strong> as a parameter.</p><p>The script class <code class="literal">playerInventoryDisplay</code> has a public variable, linked to the UI <strong>Text</strong> object <code class="literal">Text-inventory-list</code>. The <code class="literal">OnChangeInventory(…)</code> method first sets the UI text to empty, and then loops through the inventory list, building up a string of each items description in square brackets ([key], [heart], and so on). If there were no items in the list, then the string is set to the text <code class="literal">(empty inventory)</code>. Finally, the text property of the UI <strong>Text</strong> object <code class="literal">Text-inventory-list</code> is set to the value of this string representation of what is inside <a class="indexterm" id="id229"/>variable <code class="literal">inventory</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec87"/>There's more...</h2></div></div></div><p>Some details you don't want to miss:</p><div><div><div><div><h3 class="title"><a id="ch02lvl3sec19"/>Order items in the inventory list alphabetically</h3></div></div></div><p>It would be<a class="indexterm" id="id230"/> nice to alphabetically sort the words in the <code class="literal">inventory</code> list—both for neatness and consistency (so, in a game, if we pick up a key and a heart, it will look the same regardless of which order), but also so that items of the same type will be listed together, so we can easily see how many of each item we are carrying.</p><div><img alt="Order items in the inventory list alphabetically" src="img/1362OT_02_38.jpg"/></div><p>To implement the alphabetic sorting of the items in the <code class="literal">inventory</code> list, we need to do the following:</p><div><ol class="orderedlist arabic"><li class="listitem">Add the following C# code to the beginning of method <code class="literal">OnChangeInventory(...)</code> in the script class <code class="literal">PlayerInventoryDisplay</code>:<div><pre class="programlisting">public void OnChangeInventory(List&lt;PickUp&gt; inventory){
  inventory.Sort(
    delegate(PickUp p1, PickUp p2){
      return p1.description.CompareTo(p2.description);
    }
  );

  // rest of the method as before …
}</pre></div></li><li class="listitem">You should now see all the items listed in alphabetic sequence. This C# code takes advantage of the <code class="literal">List.Sort(…)</code> method, a feature of collections whereby each<a class="indexterm" id="id231"/> item can be compared to the next, and they are swapped if in the wrong order (if the <code class="literal">CompareTo(…)</code> methods returns false).</li></ol></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec34"/>Displaying multiple pickups of different objects as text totals via a dynamic Dictionary&lt;&gt; of PickUp objects and "enum" pickup types</h1></div></div></div><p>While the previous<a class="indexterm" id="id232"/> recipe worked fine, any old text might have been typed into the description for a pickup or perhaps mistyped (<strong>star</strong>, <strong>Sstar</strong>, <strong>starr</strong>, and so on). A much better way of restricting game properties to one of a predefined (enumerated) list of possible values is to use C# enums. As well as removing the chance of mistyping a string, it also means that we can write code to appropriately deal <a class="indexterm" id="id233"/>with the predefined set of possible values. In this recipe, we will improve our general purpose <code class="literal">PickUp</code> class by introducing three possible pickup types (Star, Heart, and Key), and write inventory display code that counts the number of each type of pickup being carried and displays these totals via a UI <strong>Text</strong> object on screen. We also switch from using a <strong>List</strong> to using a <strong>Dictionary</strong>, since the Dictionary data structure is designed specifically for key-value pairs, perfect for associating a numeric total with an enumerated pickup type.</p><div><img alt="Displaying multiple pickups of different objects as text totals via a dynamic Dictionary&lt;&gt; of PickUp objects and &quot;enum&quot; pickup types" src="img/1362OT_02_39.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec88"/>Getting ready</h2></div></div></div><p>This recipe follows on from the previous recipe in this chapter.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec89"/>How to do it...</h2></div></div></div><p>To display multiple <a class="indexterm" id="id234"/>pickups of <a class="indexterm" id="id235"/>different objects as text totals via a dynamic <code class="literal">Dictionary</code>, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Make a copy of your work for the previous recipe.</li><li class="listitem">Replace the content of script class <code class="literal">PickUp</code> with the following code:<div><pre class="programlisting">using UnityEngine;
using System.Collections;

public class PickUp : MonoBehaviour {
  public enum PickUpType {
    Star, Key, Heart
  }

  public PickUpType type;
}</pre></div></li><li class="listitem">Replace the content of script class <code class="literal">Player</code> with the following code:<div><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI;
using System.Collections.Generic;

public class Player : MonoBehaviour {
  private InventoryManager inventoryManager;

  void Start(){
    inventoryManager = GetComponent&lt;InventoryManager&gt;();
  }
  
  void OnTriggerEnter2D(Collider2D hit){
    if(hit.CompareTag("Pickup")){
      PickUp item = hit.GetComponent&lt;PickUp&gt;();
      inventoryManager.Add( item );
      Destroy(hit.gameObject);
    }
  }
}</pre></div></li><li class="listitem">Replace the content of script class <code class="literal">PlayerInventoryDisplay</code> with the following code:<div><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI;
using System.Collections.Generic;

public class PlayerInventoryDisplay : MonoBehaviour {
  public Text inventoryText;
  private string newInventoryText;
  
  public void OnChangeInventory(Dictionary&lt;PickUp.PickUpType, int&gt; inventory){
    inventoryText.text = "";
    
    newInventoryText = "carrying: ";
    int numItems = inventory.Count;

    foreach(var item in inventory){
      int itemTotal = item.Value;
      string description = item.Key.ToString();
      newInventoryText += " [ " + description + " " + itemTotal +  " ]";
    }
    
    if(numItems &lt; 1) newInventoryText = "(empty inventory)";
    
    inventoryText.text = newInventoryText;
  }
}</pre></div></li><li class="listitem">Add the<a class="indexterm" id="id236"/> following C# Script<a class="indexterm" id="id237"/> <code class="literal">InventoryManager</code> to the GameObject <code class="literal">player-SpaceGirl</code> in the <strong>Hierarchy</strong>:<div><pre class="programlisting">using UnityEngine;
using System.Collections;
using System.Collections.Generic;

public class InventoryManager : MonoBehaviour {
  private PlayerInventoryDisplay playerInventoryDisplay;
  private Dictionary&lt;PickUp.PickUpType, int&gt; items = new Dictionary&lt;PickUp.PickUpType, int&gt;();
  
  void Start(){
    playerInventoryDisplay = GetComponent&lt;PlayerInventoryDisplay&gt;();
    playerInventoryDisplay.OnChangeInventory(items);
  }
  
  public void Add(PickUp pickup){
    PickUp.PickUpType type = pickup.type;
    int oldTotal = 0;
    if(items.TryGetValue(type, out oldTotal))
      items[type] = oldTotal + 1;
    else
      items.Add (type, 1);
    
    playerInventoryDisplay.OnChangeInventory(items);
  }
}</pre></div></li><li class="listitem">In the <strong>Hierarchy</strong> (or <strong>Scene</strong>) panel, select each pickup GameObject in turn, and choose<a class="indexterm" id="id238"/> from the<a class="indexterm" id="id239"/> drop-down menu its corresponding <strong>Type</strong> in the <strong>Inspector</strong> panel. As you can see, public variables that are of an <code class="literal">enum</code> type are automatically restricted to the set of possible values as a combo-box drop-down menu in the <strong>Inspector</strong> panel.<div><img alt="How to do it..." src="img/1362OT_02_40.jpg"/></div></li><li class="listitem">Play the game. First, you should see a message on screen stating the inventory is empty, and then as you pick up one or more items of each pickup type, you'll see text totals of each type you have collected.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec90"/>How it works...</h2></div></div></div><p>Each pickup GameObject in the scene has a scripted component of class <code class="literal">PickUp</code>. The <code class="literal">PickUp</code> object for each <code class="literal">Pickup</code> GameObject has a single property, a pickup type, which has to be one of the enumerated set of <code class="literal">Star, Key, Heart</code>. The <code class="literal">Player</code> script class gets a reference to the <code class="literal">InventoryManager</code> component via its <code class="literal">Start()</code> method, and each time the player's character collides with a pickup GameObject, it calls the <code class="literal">Add(…)</code> method of the inventory manager, passing the <code class="literal">PickUp</code> object of the object collided with.</p><p>In this recipe, the inventory being carried by the player is being represented by a C# <code class="literal">Dictionary</code>. In this case, we have in script class <code class="literal">InventoryManager</code> a dictionary of key-value pairs, where the key is one of the possible <code class="literal">PickUp.PickUpType</code> enumerated values, and the value is an integer total of how many of that type of pickup is being carried. Each <code class="literal">InventoryItemTotal</code> object has just two properties: a <code class="literal">PickUp</code> type and an integer total. This <a class="indexterm" id="id240"/>extra layer of the <code class="literal">InventoryManager</code> has been added between script class <code class="literal">Player</code> and <code class="literal">PlayerInventoryDisplay</code> to both separate the <code class="literal">Player</code> behavior from how the inventory is internally stored and to prevent the <code class="literal">Player</code> script class from becoming too large and attempting<a class="indexterm" id="id241"/> to handle too many different responsibilities.</p><p>C# dictionaries provide a <code class="literal">TryGetValue(…)</code> method, which receives parameters of a key and is passed a reference to a variable the same data type as the value for the <code class="literal">Dictionary</code>. When the <code class="literal">Add(…)</code> method of the inventory manager is called, the type of the <code class="literal">PickUp</code> object is tested to see if a total for this type is already in <code class="literal">Dictionary items</code>. If an item total is found inside the <code class="literal">Dictionary</code> for the given type, then the value for this item in the <code class="literal">Dictionary</code> is incremented. If no entry is found for the given type, then a new element is added to the <code class="literal">Dictionary</code> with a total of 1.</p><p>The last action of the <code class="literal">Add(…)</code> method is to call the <code class="literal">OnChangeInventory(…)</code> method of the <code class="literal">PlayerInventoryDisplay</code> scripted component of the player's GameObject to update the text totals displayed on screen. This method in <code class="literal">PlayerInventoryDisplay</code> iterates through the <code class="literal">Dictionary</code>, building up a string of the type names and totals, and then updates the text property of the UI Text object with the string showing the inventory totals to the player.</p><p>Learn more about using<a class="indexterm" id="id242"/> C# lists and dictionaries in Unity in the Unity Technologies tutorial at <a class="ulink" href="https://unity3d.com/learn/tutorials/modules/intermediate/scripting/lists-and-dictionaries">https://unity3d.com/learn/tutorials/modules/intermediate/scripting/lists-and-dictionaries</a>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec35"/>Generalizing multiple icon displays using UI Grid Layout Groups (with scrollbars!)</h1></div></div></div><p>The recipes in this chapter up to this point have been hand-crafted for each situation. While this is fine, more<a class="indexterm" id="id243"/> general and automated approaches to inventory UIs can sometimes save time and effort but still achieve visual and usability results of equal quality. In the next recipe, we will begin to explore a more engineered approach to inventory UIs by exploiting the automated sizing and layouts offered by Unity 5's Grid Layout Group component.</p><div><img alt="Generalizing multiple icon displays using UI Grid Layout Groups (with scrollbars!)" src="img/1362OT_02_20.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec91"/>Getting ready</h2></div></div></div><p>This recipe assumes that you are starting with the project <code class="literal">Simple2Dgame_SpaceGirl</code> setup from the first recipe in this chapter. The font you need can be found in the <code class="literal">1362_02_02 </code>folder.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec92"/>How to do it...</h2></div></div></div><p>To display grey<a class="indexterm" id="id244"/> and yellow star icons for multiple object pickups using UI grid layout groups, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Start with a new copy of the mini-game <code class="literal">Simple2Dgame_SpaceGirl</code>.</li><li class="listitem">In the <strong>Hierarchy</strong> panel, create a UI Panel <code class="literal">Panel–background </code>(<strong>Create</strong> | <strong>UI</strong> | <strong>Panel</strong>).</li><li class="listitem">Let's now position <code class="literal">Panel–background </code>at the <strong>top </strong>of the <strong>Game</strong> panel, stretching the horizontal width of the canvas. Edit the UI <strong>Image's Rect Transform</strong> component, and while holding down <em>SHIFT</em> and <em>ALT</em> (to set pivot and position), choose the top-stretch box. </li><li class="listitem">The panel will still be taking up the whole game window. So, now in the <strong>Inspector</strong> panel, change the <strong>Height</strong> (in the <strong>Rect Transform</strong> component) of <code class="literal">Panel–background </code>to 100, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_21.jpg"/></div></li><li class="listitem">Add a UI <strong>Text</strong> object (<strong>Create</strong> | <strong>UI</strong> | <strong>Text</strong>), rename it <code class="literal">Text-inventory</code>, and change its text to <strong>Inventory</strong>.</li><li class="listitem">In the <strong>Hierarchy</strong> panel, child this UI Text object to panel <code class="literal">Panel–background</code>.</li><li class="listitem">In the <strong>Inspector</strong> panel, also set the font of <code class="literal">Text-inventory</code> to <strong>Xolonium-Bold</strong> (the <code class="literal">Fonts</code> folder). Center the text horizontally, top align the text vertically, set its <strong>Height</strong> to <code class="literal">50</code>, and set the <strong>Font Size</strong> to <code class="literal">23</code>.</li><li class="listitem">Edit the <strong>Rect Transform</strong> of <code class="literal">Text-inventory</code>, and while holding down <em>SHIFT</em> and <em>ALT</em> (to set pivot and position), choose the top-stretch box. The text should now be positioned at the middle top of the <strong>UI Panel</strong> <code class="literal">Panel–background</code> <a class="indexterm" id="id245"/>and its width should stretch to match that of the whole panel.</li><li class="listitem">Select the <strong>Canvas</strong> in the <strong>Hierarchy</strong> panel and add a new UI Panel object (<strong>Create</strong> | <strong>UI</strong> | <strong>Image</strong>). Rename it <code class="literal">Panel-slot-grid</code>.</li><li class="listitem">Position <code class="literal">Panel-slot-grid</code> at the <strong>top </strong>of the <strong>Game</strong> panel, stretching the horizontal width of the canvas. Edit the UI <strong>Image's Rect Transform</strong> component, and while holding down <em>SHIFT</em> and <em>ALT</em> (to set pivot and position), choose the top-stretch box. </li><li class="listitem">In the <strong>Inspector</strong> panel, change the <strong>Height</strong> (in the <strong>Rect Transform</strong> component) of <code class="literal">Panel-slot-grid</code> to <code class="literal">80</code> and set its <strong>Top</strong> to <code class="literal">20</code> (so it is below UI <strong>Text</strong> GameObject <code class="literal">Text-inventory</code>).</li><li class="listitem">With the panel <code class="literal">Panel-slot-grid</code> selected in the <strong>Hierarchy</strong> panel, add a grid layout group component (<strong>Add Component</strong> | <strong>Layout</strong> | <strong>Grid Layout Group</strong>). Set <strong>Cell Size</strong> to <code class="literal">70</code> x <code class="literal">70</code> and <strong>Spacing</strong> to <code class="literal">5</code> x <code class="literal">5</code>. Also, set the <strong>Child Alignment</strong> to <strong>Middle Center</strong> (so our icons will have even spacing at the far left and right), as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_22.jpg"/></div></li><li class="listitem">With the panel <code class="literal">Panel-slot-grid</code> selected in the <strong>Hierarchy</strong> panel, add a mask (script) component (<strong>Add Component</strong> | <strong>UI</strong> | <strong>Mask</strong>). Uncheck the option <strong>Show Mask Graphic</strong>. Having this mask component means that any overflow of our grid will NOT be seen by the user—only content within the image area of the panel <code class="literal">Panel-slot-grid</code> will ever be visible.</li><li class="listitem">Add to your <a class="indexterm" id="id246"/><strong>Canvas</strong> a UI <strong>Image</strong> object (<strong>Create</strong> | <strong>UI</strong> | <strong>Image</strong>). Rename it <code class="literal">Image-slot</code>.</li><li class="listitem">In the <strong>Hierarchy</strong> panel, child UI <strong>Image</strong> object <code class="literal">Image-slot</code> to panel <code class="literal">Panel–slot-grid</code>.</li><li class="listitem">Set the <strong>Source Image</strong> of <code class="literal">Image-slot</code> to the Unity provided <strong>Knob</strong> (circle) image, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_23.jpg"/></div></li><li class="listitem">Since <code class="literal">Image-slot</code> is the only UI object inside <code class="literal">Panel-slot-grid,</code> it will be displayed (sized 70 x 70) in center in that panel, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_24.jpg"/></div></li><li class="listitem">Each image slot will have a yellow star child image and a grey star child image. Let's<a class="indexterm" id="id247"/> create those now.</li><li class="listitem">Add to your <strong>Canvas</strong> a UI <strong>Image</strong> object (<strong>Create | UI | Image</strong>). Rename it  <code class="literal">Image-star-yellow</code>.</li><li class="listitem">In the <strong>Hierarchy</strong> panel, child UI <strong>Image</strong> object <code class="literal">Image-star-yellow</code> to image <code class="literal">Image–slot</code>.</li><li class="listitem">Set the <strong>Source Image</strong> of <code class="literal">Image-star-yellow</code> to the <code class="literal">icon_star_100</code> image (in folder <code class="literal">Sprites</code>).</li><li class="listitem">Now we will set our yellow star icon image to fully fill its parent <code class="literal">Image-slot</code> by stretching horizontally and vertically. Edit the UI <strong>Image's Rect Transform</strong> component, and while holding down <em>SHIFT</em> and <em>ALT</em> (to set pivot and position), choose the bottom right option to fully <strong>stretch</strong> horizontally and vertically. The UI <strong>Image</strong> <code class="literal">Image-star-yellow</code> should now be visible in the middle of the <code class="literal">Image-slot </code>circular <strong>Knob</strong> image, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_25.jpg"/></div></li><li class="listitem">Duplicate <code class="literal">Image-star-yellow</code> in the <strong>Hierarchy</strong> panel, naming the copy <code class="literal">Image-star-grey</code>. This new GameObject should also be a child of <code class="literal">Image-slot</code>.</li><li class="listitem">Change the <strong>Source Image</strong> of <code class="literal">Image-star-grey</code> to the <code class="literal">icon_star_grey_100</code> image (in folder <code class="literal">Sprites</code>). At any time, our inventory slot can now display nothing, a yellow star icon, or a grey star icon, depending on whether <code class="literal">Image-star-yellow</code> and <code class="literal">Image-star-grey</code> are enabled<a class="indexterm" id="id248"/> or not: we'll control this through the inventory display code later in this recipe.</li><li class="listitem">In the <strong>Hierarchy</strong> panel, ensure that <code class="literal">Image-slot</code> is selected, and add the C# Script <code class="literal">PickupUI</code> with the following code:<div><pre class="programlisting">using UnityEngine;
using System.Collections;

public class PickupUI : MonoBehaviour {
  public GameObject starYellow;
  public GameObject starGrey;

  void Awake(){
    DisplayEmpty();
  }

  public void DisplayYellow(){
    starYellow.SetActive(true);
    starGrey.SetActive(false);
  }

  public void DisplayGrey(){
    starYellow.SetActive(false);
    starGrey.SetActive(true);
  }
  
  public void DisplayEmpty(){
    starYellow.SetActive(false);
    starGrey.SetActive(false);
  }
}</pre></div></li><li class="listitem">With the GameObject <code class="literal">Image-slot</code> selected in the <strong>Hierarchy</strong> panel, drag each of its two children <code class="literal">Image-star-yellow</code> and<code class="literal"> Image-star-grey</code> into their corresponding <strong>Inspector</strong> panel <strong>Pickup UI</strong> slots <strong>Star Yellow</strong> and <strong>Star Grey</strong>, as shown in<a class="indexterm" id="id249"/> the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_27.jpg"/></div></li><li class="listitem">In the <strong>Hierarchy</strong> panel, make nine duplicates of <code class="literal">Image-slot</code> in the <strong>Hierarchy</strong> panel; they should automatically be named <code class="literal">Image-slot 1 .. 9</code>. See the following screenshot to ensure the Hierarchy of your Canvas is correct—the parenting of <code class="literal">Image-slot</code> as a child of <code class="literal">Image-slot-grid</code>, and the parenting of <code class="literal">Image-star-yellow</code> and<code class="literal"> Image-star-grey</code> as children of each <code class="literal">Image-slot</code> is very important.<div><img alt="How to do it..." src="img/1362OT_02_26.jpg"/></div></li><li class="listitem">In the <strong>Hierarchy</strong> panel, ensure that <code class="literal">player-SpaceGirl</code> is selected, and add the C# script<a class="indexterm" id="id250"/> <code class="literal">Player</code> with the following code:<div><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI;

public class Player : MonoBehaviour {
  private PlayerInventoryModel playerInventoryModel;

  void Start(){
    playerInventoryModel = GetComponent&lt;PlayerInventoryModel&gt;();
  }
  
  void OnTriggerEnter2D(Collider2D hit){
    if(hit.CompareTag("Star")){
      playerInventoryModel.AddStar();
      Destroy(hit.gameObject);
    }
  }
}</pre></div></li><li class="listitem">In the <strong>Hierarchy</strong> panel, ensure that <code class="literal">player-SpaceGirl</code> is selected, and add the C# script <code class="literal">PlayerInventoryModel</code> with the following code:<div><pre class="programlisting">using UnityEngine;
using System.Collections;

public class PlayerInventoryModel : MonoBehaviour {
  private int starTotal = 0;
  private PlayerInventoryDisplay playerInventoryDisplay;
  
  void Start(){
    playerInventoryDisplay = GetComponent&lt;PlayerInventoryDisplay&gt;();
    playerInventoryDisplay.OnChangeStarTotal(starTotal);
  }
  
  public void AddStar(){
    starTotal++;
    playerInventoryDisplay.OnChangeStarTotal(starTotal);
  }
}</pre></div></li><li class="listitem">In the<a class="indexterm" id="id251"/> <strong>Hierarchy</strong> panel, ensure that <code class="literal">player-SpaceGirl</code> is selected, and add the C# script <code class="literal">PlayerInventoryDisplay</code> with the following code:<div><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI;

public class PlayerInventoryDisplay : MonoBehaviour
{
  const int NUM_INVENTORY_SLOTS = 10;
  public PickupUI[] slots = new PickupUI[NUM_INVENTORY_SLOTS];

  public void OnChangeStarTotal(int starTotal){
    for(int i = 0; i &lt; NUM_INVENTORY_SLOTS; i++){
      PickupUI slot = slots[i];
      if(i &lt; starTotal)
        slot.DisplayYellow();
      else
        slot.DisplayGrey();
    }
  }
}</pre></div></li><li class="listitem">With GameObject <code class="literal">player-SpaceGirl</code> selected in the <strong>Hierarchy</strong> panel, drag the ten <code class="literal">Image-slot </code>GameObjects into their corresponding locations in the <strong>Player Inventory Display (Script)</strong> component array <strong>Slots</strong>, in the <strong>Inspector</strong> panel, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_02_28.jpg"/></div></li><li class="listitem">Save the scene and play the game. As you pick up stars, you should see more of the grey stars change to yellow in the inventory display.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec93"/>How it works...</h2></div></div></div><p>We have created a simple panel (<code class="literal">Panel-background</code>) and text at the top of the game canvas—showing<a class="indexterm" id="id252"/> a greyish background rectangle and text "Inventory". We created a small panel inside this area (<code class="literal">Panel-slot-grid</code>), with a grid layout group component, which automatically sizes and lays out the 10 <code class="literal">Image-slot</code> GameObjects we created with the knob (circle) source image. By adding a mask component to <code class="literal">Panel-slot-grid</code>, we ensure that no content will overflow outside of the rectangle of the source image for this panel.</p><p>Each of the 10 <code class="literal">Image-slot</code> GameObjects that are children of <code class="literal">Panel-slot-grid</code> contains a yellow star image and a grey star image. Also, each <code class="literal">Image-slot</code> GameObjects has a script component <code class="literal">PickupUI</code>. The <code class="literal">PickupUI</code> script offers three public methods, which will show just the yellow star image, just the grey star image, or neither (so, an empty knob circle image will be seen).</p><p>Our player's character GameObject <code class="literal">player-SpaceGirl</code> has a very simple basic <code class="literal">Player</code> script—this just detected collisions with objects tagged <code class="literal">Star</code>, and when this happens, it removes the star GameObject collided with and calls the <code class="literal">AddStar()</code> method to its <code class="literal">playerInventoryModel</code> scripted component. The <code class="literal">PlayerInventoryModel</code> C# script class maintains a running integer total of the number of stars added to the inventory. Each time the <code class="literal">AddStar()</code> method is called, it increments (adds 1) to this total, and then calls the <code class="literal">OnChangeStarTotal(…)</code> method of scripted component <code class="literal">playerInventoryDisplay</code>. Also, when the scene starts, an initial call is made to the <code class="literal">OnChangeStarTotal(…)</code> method so that the UI display for the inventory is set up to show that we are initially carrying no stars.</p><p>The C# script class <code class="literal">PlayerInventoryDisplay</code> has two properties: one is a constant integer defining the number of slots in our inventory, which for this game we set to 10, and the other variable is an array of references to <code class="literal">PickupUI</code> scripted components—each of these is a reference to the scripted component in each of the 10 <code class="literal">Image-slot</code> GameObjects in our <code class="literal">Panel-slot-grid</code>. When the <code class="literal">OnChangeStarTotal(…)</code> method is passed the number of stars we are carrying, it loops through each of the 10 slots. While the current slot is less than our star total, a yellow star is displayed, by the calling of the <code class="literal">DisplayYellow()</code> method of the current slot (<code class="literal">PickupUI</code> scripted component). Once the loop counter is equal to or larger than our star total, then all remaining slots are made to display a grey star via the calling of method <code class="literal">DisplayGrey()</code>.</p><p>This recipe is an<a class="indexterm" id="id253"/> example of the<a class="indexterm" id="id254"/> <strong>low coupling</strong> of the MVC design pattern. We have designed our code to not rely or make too many assumptions about other parts of the game so that the chances of a change in some other part of our game breaking our inventory display code are much smaller. The display (view) is separated from the logical representation of what we are carrying (model), and changes to the model are made by public methods called from the player (controller).</p><div><div><h3 class="title"><a id="note26"/>Note</h3><p>Note: It might seem that we could make our code simpler by assuming that slots are always displaying grey (no star) and just changing one slot to yellow each time a yellow star is picked up. But this would lead to problems if something happens in the game (for example, hitting a black hole or being shot by an alien) that makes us drop one or more stars. C# script class <code class="literal">PlayerInventoryDisplay</code> makes no assumptions about which slots may or may not have been displayed grey or yellow or empty previously—each time it is called, it ensures that an appropriate number of yellow stars are displayed, and all other slots are displayed with grey stars.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec94"/>There's more...</h2></div></div></div><p>Some details you don't want to miss:</p><div><div><div><div><h3 class="title"><a id="ch02lvl3sec20"/>Add a horizontal scrollbar to the inventory slot display</h3></div></div></div><p>We can see 10 inventory slots now—but what if there are many more? One solution is to add a scroll bar so<a class="indexterm" id="id255"/> that the user can scroll left and right, viewing 10 at a time, as shown in the following screenshot. Let's add a horizontal scroll bar to our game. This can be achieved without any C# code changes, all through the Unity 5 UI system.</p><div><img alt="Add a horizontal scrollbar to the inventory slot display" src="img/1362OT_02_35.jpg"/></div><p>To implement a horizontal scrollbar for our inventory display, we need to do the following:</p><div><ol class="orderedlist arabic"><li class="listitem">Increase the height of <code class="literal">Panel-background</code> to 130 pixels.</li><li class="listitem">In the <strong>Inspector </strong>panel, set the <strong>Child Alignment</strong> property of component <strong>Grid Layout Group (Script) </strong>of <code class="literal">Panel-slot-grid</code> to Upper Left. Then, move this panel to the right a little so that the 10 inventory icons are centered on screen.</li><li class="listitem">In the <strong>Hierarchy</strong> panel, duplicate Image-slot 9 three more times so that there are now 13 inventory icons in <code class="literal">Panel-slot-grid</code>.</li><li class="listitem">In the <strong>Scene</strong> panel, drag the right-hand edge of panel <code class="literal">Panel-slot-grid</code> to make it wide enough so that all 13 inventory icons fit horizontally—of course the last three will be off screen, as shown in the following screenshot:<div><img alt="Add a horizontal scrollbar to the inventory slot display" src="img/1362OT_02_33.jpg"/></div></li><li class="listitem">Add a UI <strong>Panel</strong> to the <strong>Canvas</strong> and name it <code class="literal">Panel-scroll-container</code>, and tint it red by setting the <strong>Color</strong> property of its <strong>Image (Script)</strong> component to red.</li><li class="listitem">Size and position <code class="literal">Panel-scroll-container</code> so that it is just behind our <code class="literal">Panel-slot-grid</code>. So, you should now see a red rectangle behind the 10 inventory circle slots.</li><li class="listitem">In the <strong>Hierarchy </strong>panel, drag <code class="literal">Panel-slot-grid</code> so that it is now childed to <code class="literal">Panel-scroll-container</code>.</li><li class="listitem">Add a UI <strong>Mask </strong>to <code class="literal">Panel-scroll-container</code> so now you should only be able to see the 10 inventory icons that fit within the rectangle of this red-tinted panel.<div><div><h3 class="title"><a id="note27"/>Note</h3><p>Note: You <a class="indexterm" id="id256"/>may wish to temporarily set this mask component as inactive so that you can see and work on the unseen parts of <code class="literal">Panel-slot-grid</code> if required.</p></div></div></li><li class="listitem">Add a UI <strong>Scrollbar</strong> to the <strong>Canvas</strong> and name it <code class="literal">Scrollbar-horizontal</code>. Move it to be just below the 10 inventory icons, and resize it to be the same width as the red-tinted <code class="literal">Panel-scroll-container</code>, as shown in the following screenshot:<div><img alt="Add a horizontal scrollbar to the inventory slot display" src="img/1362OT_02_32.jpg"/></div></li><li class="listitem">Add a UI <strong>Scroll Rect</strong> component to <code class="literal">Panel-scroll-container</code>.</li><li class="listitem">In the <strong>Inspector </strong>panel, drag <code class="literal">Scrolbar-horizontal</code> to the Horizontal Scrollbar property of the <strong>Scroll Rect</strong> component of <code class="literal">Panel-scroll-container</code>.</li><li class="listitem">In the <strong>Inspector </strong>panel, drag <code class="literal">Panel-slot-grid</code> to the Content property of the <strong>Scroll Rect</strong> component of <code class="literal">Panel-scroll-container</code>, as shown in the following screenshot:<div><img alt="Add a horizontal scrollbar to the inventory slot display" src="img/1362OT_02_34.jpg"/></div></li><li class="listitem">Now, ensure the <strong>mask</strong> component of <code class="literal">Panel-scroll-container</code> is set as active so that we don't see the overflow of <code class="literal">Panel-slot-grid</code> and uncheck this <strong>mask</strong> components option to <strong>Show Mask Graphic</strong> (so that we don't see the red rectangle any more).</li></ol></div><p>You should now have a working scrollable inventory system. Note that the last three new icons will just be empty circles, since the inventory display script does not have references to, or attempt to<a class="indexterm" id="id257"/> make, any changes to these extra three slots; so the script code would need to be changed to reflect every additional slot we add to <code class="literal">Panel-slot-grid</code>.</p></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec21"/>The automation of PlayerInventoryDisplay getting references to all the slots</h3></div></div></div><p>There was a lot of dragging slots from the <strong>Hierarchy</strong> panel into the array for the scripted component <code class="literal">PlayerInventoryDisplay</code>. This takes a bit of work (and mistakes might be made when dragging items<a class="indexterm" id="id258"/> in the wrong order or the same item twice). Also, if we change the number of slots, then we may have to do this all over again or try to remember to drag more slots if we increase the number, and so on. A better way of doing things is to make the first task of the script class <code class="literal">PlayerInventoryDisplay</code> when the scene begins to create each of these <code class="literal">Image-slot</code> GameObjects as a child of <code class="literal">Panel-slot-grid</code> and populate the array at the same time.</p><p>To implement the automated population of our scripted array of PickupUI objects for this recipe, we need to do the following:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new folder named <code class="literal">Prefabs</code>. In this folder, create a new empty prefab named <code class="literal">starUI</code>.</li><li class="listitem">From the <strong>Hierarchy </strong>panel<strong>,</strong> drag the GameObject <code class="literal">Image-slot</code> into your new empty prefab named <code class="literal">starUI</code>. This prefab should now turn blue, showing it is populated.</li><li class="listitem">In the <strong>Hierarchy </strong>panel<strong>,</strong> delete GameObject <code class="literal">Image-slot</code> and all its copies<code class="literal"> Image-slot 1 – 9</code>.</li><li class="listitem">Replace C# Script <code class="literal">PlayerInventoryDisplay</code> in GameObject <code class="literal">player-SpaceGirl</code> with<a class="indexterm" id="id259"/> the following code:<div><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI;

public class PlayerInventoryDisplay : MonoBehaviour
{
  const int NUM_INVENTORY_SLOTS = 10;
  private PickupUI[] slots = new PickupUI[NUM_INVENTORY_SLOTS];
  public GameObject slotGrid;
  public GameObject starSlotPrefab;

  void Awake(){
    for(int i=0; i &lt; NUM_INVENTORY_SLOTS; i++){
      GameObject starSlotGO = (GameObject)
      Instantiate(starSlotPrefab);
      starSlotGO.transform.SetParent(slotGrid.transform);
      starSlotGO.transform.localScale = new Vector3(1,1,1);
      slots[i] = starSlotGO.GetComponent&lt;PickupUI&gt;();
    }
  }

  public void OnChangeStarTotal(int starTotal){
    for(int i = 0; i &lt; NUM_INVENTORY_SLOTS; i++){
     PickupUI slot = slots[i];
      if(i &lt; starTotal)
        slot.DisplayYellow();
      else
        slot.DisplayGrey();
    }
  }
}</pre></div></li><li class="listitem">With GameObject <code class="literal">player-SpaceGirl</code> selected in the <strong>Hierarchy</strong> panel, drag the GameObject <code class="literal">Panel-slot-grid </code>into <strong>Player Inventory Display (Script)</strong> variable <strong>Slot grid</strong>, in the <strong>Inspector</strong> panel.</li><li class="listitem">With GameObject <code class="literal">player-SpaceGirl</code> selected in the <strong>Hierarchy</strong> panel, drag from the <strong>Project</strong> panel prefab <code class="literal">starUI</code> into <strong>Player Inventory Display (Script)</strong> variable <strong>Star Slot Prefab</strong>, in the <strong>Inspector</strong> panel, as shown in the following<a class="indexterm" id="id260"/> screenshot:<div><img alt="The automation of PlayerInventoryDisplay getting references to all the slots" src="img/1362OT_02_29.jpg"/></div></li></ol></div><p>The public array has been made private and no longer needs to be populated through manual drag-and-drop. When you run the game, it will play just the same as before, with the population of the array of images in our inventory grid panel now automated. The <code class="literal">Awake()</code> method creates new instances of the prefab (as many as defined by constant <code class="literal">NUM_INVENTORY_SLOTS</code>) and immediately childed them to <code class="literal">Panel-slot-grid</code>. Since we have a grid layout group component, their placement is automatically neat and tidy in our panel.</p><div><div><h3 class="title"><a id="tip04"/>Tip</h3><p>Note: The scale property of the transform component of GameObjects is reset when a GameObject changes its parent (to maintain relative child size to parent size). So, it is a good idea to always reset the local scale of GameObjects to (1,1,1) immediately after they have been childed to another GameObject. We do this in the <code class="literal">for</code>-loop to <code class="literal">starSlotGO</code> immediately following the <code class="literal">SetParent(…)</code> statement.</p></div></div><p>Note that we use the <code class="literal">Awake() method </code>for creating the instances of the prefab in <code class="literal">PlayerInventoryDispay</code> so that we know this will be executed before the <code class="literal">Start()</code> method in <code class="literal">PlayerInventoryModel</code>—since no <code class="literal">Start()</code> method is executed until all <code class="literal">Awake()</code> methods for all<a class="indexterm" id="id261"/> GameObjects in the scene have been completed.</p></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec22"/>Automatically changing the grid cell size based on the number of slots in inventory</h3></div></div></div><p>Consider a situation where we wish to change the number of slots. Another alternative to using scrollbars is to change the cell size in the <strong>Grid Layout Group</strong> component. We can automate this through code so that the cell size is changed to ensure that <code class="literal">NUM_INVENTORY_SLOTS</code> will fit along the width of our panel at the top of the canvas.</p><p>To implement the <a class="indexterm" id="id262"/>automated resizing of the <strong>Grid Layout Group</strong> cell size for this recipe, we need to do the following:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Add the following method <code class="literal">Start()</code> to the C# Script <code class="literal">PlayerInventoryDisplay</code> in GameObject <code class="literal">player-SpaceGirl</code> with the following code:<div><pre class="programlisting">void Start(){
  float panelWidth = slotGrid.GetComponent&lt;RectTransform&gt;().rect.width;
  print ("slotGrid.GetComponent&lt;RectTransform&gt;().rect = " + slotGrid.GetComponent&lt;RectTransform&gt;().rect);
  
  GridLayoutGroup gridLayoutGroup = slotGrid.GetComponent&lt;GridLayoutGroup&gt;();
  float xCellSize = panelWidth / NUM_INVENTORY_SLOTS;
  xCellSize -= gridLayoutGroup.spacing.x;
  gridLayoutGroup.cellSize = new Vector2(xCellSize, xCellSize);
}</pre></div><div><img alt="Automatically changing the grid cell size based on the number of slots in inventory" src="img/1362OT_02_30.jpg"/></div></li></ul></div><p>We write our code in the <code class="literal">Start()</code> method, rather than adding to code in the <code class="literal">Awake()</code> method, to ensure that the <strong>RectTransform</strong> of GameObject <code class="literal">Panel-slot-grid </code>has finished sizing (in this recipe, it stretches based on the width of the <strong>Game</strong> panel). While we can't know the sequence in which <strong>Hierarchy</strong> GameObjects are created when a scene begins, we can rely on the Unity behavior that every GameObject sends the <code class="literal">Awake()</code>message, and only after all corresponding <code class="literal">Awake()</code> methods have finished executing all objects, and then sends the <code class="literal">Start()</code> message. So, any code in the <code class="literal">Start()</code> method can <a class="indexterm" id="id263"/>safely assume that every GameObject has been initialized.</p><p>The above screenshot shows the value of <code class="literal">NUM_INVENTORY_SLOTS</code> having been changed to 15, and the cell size, having been corresponding, changed, so that all 15 now fit horizontally in our panel. Note that the spacing between cells is subtracted from the calculated available with divided by the number of slots (<code class="literal">xCellSize -= gridLayoutGroup.spacing.x</code>) since that spacing is needed between each item displayed as well.</p></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec23"/>Add some help methods to the Rect Transform script class</h3></div></div></div><p>If we wish to further change, say, the <code class="literal">RectTransform</code> properties using code, we can add extension methods<a class="indexterm" id="id264"/> by creating a file containing special static methods and using the special "this" keyword. See the following code that adds <code class="literal">SetWidth(…)</code>, <code class="literal">SetHeight(…)</code>, and <code class="literal">SetSize(…)</code> methods to the <code class="literal">RectTransform</code> scripted component:</p><div><pre class="programlisting">using UnityEngine;
using System;
using System.Collections;

public static class RectTransformExtensions
{
  public static void SetSize(this RectTransform trans, Vector2 newSize) {
    Vector2 oldSize = trans.rect.size;
    Vector2 deltaSize = newSize - oldSize;
    trans.offsetMin = trans.offsetMin - new Vector2(deltaSize.x * trans.pivot.x, deltaSize.y * trans.pivot.y);
    trans.offsetMax = trans.offsetMax + new Vector2(deltaSize.x * (1f - trans.pivot.x), deltaSize.y * (1f - trans.pivot.y));
  }

  public static void SetWidth(this RectTransform trans, float newSize) {
    SetSize(trans, new Vector2(newSize, trans.rect.size.y));
  }

  public static void SetHeight(this RectTransform trans, float newSize) {
    SetSize(trans, new Vector2(trans.rect.size.x, newSize));
  }
}</pre></div><p>Unity C# allows us to add these extensions methods by declaring <code class="literal">static void</code> methods whose first argument is in the form this <code class="literal">&lt;ClassName&gt; &lt;var&gt;</code>. The method can then be called as a built-in method defined in the original class.</p><p>All we would need to do is create a new C# script class file <code class="literal">RectTransformExtensions</code> in the folder <strong>Scripts</strong> in the <strong>Project</strong> panel, containing the above code. In fact, you can find a whole set of <a class="indexterm" id="id265"/>useful extra <code class="literal">RectTransform</code> methods (on which the above is an extract) created by<a class="indexterm" id="id266"/> OrbcreationBV, and it is available online at <a class="ulink" href="http://www.orbcreation.com/orbcreation/page.orb?1099">http://www.orbcreation.com/orbcreation/page.orb?1099</a>.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec36"/>Conclusion</h1></div></div></div><p>In this chapter, we introduced recipes demonstrating a range of C# data representations for inventory items and a range of Unity UI interface components to display the status and contents of player inventories at run time.</p><p>Inventory UI needs good quality graphical assets for a high quality result. Some sources of assets that you might wish to explore include the following sites:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The graphics for our SpaceGirl mini game are from the Space Cute art by Daniel Cook; he generously publishes lots of 2D art for game developers to use:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://www.lostgarden.com/">http://www.lostgarden.com/</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://www.lostgarden.com/search?q=planet+cute">http://www.lostgarden.com/search?q=planet+cute</a></li></ul></div></li><li class="listitem" style="list-style-type: disc">Sethbyrd—lots of fun 2D graphics:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://www.sethbyrd.com/">http://www.sethbyrd.com/</a></li></ul></div></li><li class="listitem" style="list-style-type: disc">Royalty-free art for 2D games:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://www.gameart2d.com/freebies.html">http://www.gameart2d.com/freebies.html</a></li></ul></div></li></ul></div></div></body></html>