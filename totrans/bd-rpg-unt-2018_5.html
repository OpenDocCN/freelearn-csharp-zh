<html><head></head><body>
        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">GameMaster and Game Mechanics</h1>
                
            
            <article>
                
<p class="calibre3">In chapters 1 through 4, we learned how to make some of the necessary components needed for the design and implementation of our RPG. For instance, you should have a good understanding of how to organize and arrange your player character and non-player character assets and components.</p>
<p class="calibre3">Here is a breakdown of the chapter:</p>
<ul class="calibre11">
<li class="calibre12">GameMaster
<ul class="calibre32">
<li class="calibre12">Managing game settings and scenes</li>
<li class="calibre12">Managing scenes</li>
</ul>
</li>
<li class="calibre12">Improving GameMaster
<ul class="calibre32">
<li class="calibre12">Level controller</li>
<li class="calibre12">Audio controller</li>
</ul>
</li>
<li class="calibre12">Player data management
<ul class="calibre32">
<li class="calibre12">PC class enhancements</li>
<li class="calibre12">Character customization class update</li>
</ul>
</li>
<li class="calibre12">Changes to the UI controller</li>
<li class="calibre12">Testing</li>
</ul>
<p class="calibre3">In this chapter, we are going to make more adjustments and updates to everything we have done so far.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">GameMaster</h1>
                
            
            <article>
                
<p class="calibre3">Even though we have created a <kbd class="calibre13">GameMaster.cs</kbd> script, we have not really utilized it to manage our game. We have created bits and pieces of our game assets and used them to do quick testing. Now is the time to start looking at how to combine everything together and create a better game manager for our RPG.</p>
<p class="calibre3">There are a few things that I want <kbd class="calibre13">GameMaster.cs</kbd> to perform. These are as follows:</p>
<ul class="calibre11">
<li class="calibre12">Having a reference to the UI controller for each particular scene</li>
<li class="calibre12">Having a reference to the player character in the scene</li>
<li class="calibre12">Having a reference to the non-player character(s) in the scene</li>
<li class="calibre12">Having a reference to the audio source for control</li>
<li class="calibre12">There should always be one instance of the <kbd class="calibre13">GameMaster</kbd> class available</li>
</ul>
<p class="calibre3">As we create our GameMaster, we will add or subtract some of the elements as we see fit. Let's start by integrating the User Interface with the GameMaster.</p>
<p class="calibre3">Open up your <span class="calibre6">Main Menu</span> scene. It should look something like the following screenshot:</p>
<div class="mce-root1"><img src="../images/00107.jpeg" class="calibre101"/></div>
<p class="calibre3"/>
<p class="calibre3"/>
<p class="calibre3">The following screenshots display the main menu we have designed for our RPG:</p>
<div class="mce-root1"><img src="../images/00108.jpeg" class="calibre102"/></div>
<p class="calibre3">It is pretty simple, just to illustrate the concept. When the player clicks the <span class="calibre6">Options</span> button, they will get the <span class="calibre6">Options</span> window, where they will have the ability to adjust the volume within the game. When they are done, they will click the <span class="calibre6">close</span> button and go back to the main menu.</p>
<p class="calibre3"/>
<p class="calibre3"/>
<p class="calibre3">Here is a screenshot of the <span class="calibre6">Hierarchy</span> window for the <span class="calibre6">Main Menu</span> scene:</p>
<div class="mce-root1"><img src="../images/00109.jpeg" class="calibre103"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Managing game settings and audio</h1>
                
            
            <article>
                
<p class="calibre3">Create an <kbd class="calibre13">Empty</kbd> GameObject and name it <kbd class="calibre13">uiController</kbd>. We now need to create a UI Controller script that will handle the user interaction. Create a new C# script and name it <kbd class="calibre13">UiController.cs</kbd>.</p>
<div class="packt_infobox">Note: The scripts in this chapter will be updated and modified as we progress.</div>
<p class="calibre3">A listing of the UI controller is as follows:</p>
<pre class="calibre18">using UnityEngine; 
using UnityEngine.UI; 
 
namespace com.noorcon.rpg2e 
{ 
   public class UiController : MonoBehaviour 
   { 
      public RectTransform OptionsPanel; 
      public Slider ControlMainVolume; 
      public Slider ControlFXVolume; 
 
      public void Update() 
      { 
      } 
 
      public void DisplaySettings() 
      { 
         GameMaster.instance.DisplaySettings = !GameMaster.instance.DisplaySettings; 
         OptionsPanel.gameObject.SetActive(GameMaster.instance.DisplaySettings); 
      } 
 
      public void MainVolume() 
      { 
         GameMaster.instance.MasterVolume(ControlMainVolume.value); 
      } 
      public void FXVolume() 
      { 
         GameMaster.instance.SoundFxVolume(ControlFXVolume.value); 
      } 
   } 
} </pre>
<p class="calibre3">Currently, we have just a few functions defined: <kbd class="calibre13">DisplaySettings()</kbd> and <kbd class="calibre13">MainVolume()</kbd>. The functions are really simple; they are referencing the UI components needed to display the settings panel, as well as to retrieve the value of the volume control slider. The information is then passed to the <kbd class="calibre13">GameMaster.cs</kbd> script for further processing.</p>
<p class="calibre3">We need to make several changes to the <kbd class="calibre13">GameMaster.cs</kbd> script. A listing of the code is as follows:</p>
<pre class="calibre18">using UnityEngine; 
using UnityEngine.SceneManagement; 
 
namespace com.noorcon.rpg2e 
{ 
   public static class SceneName 
   { 
      public const string MainMenu = "MainMenu"; 
      public const string CharacterCustomization = "CharacterCustomization"; 
      public const string Level_1 = "Awakening"; 
   } 
 
 
   public class GameMaster : MonoBehaviour 
   { 
      public static GameMaster instance; 
 
      // let's have a reference to the player character 
      // and start position of player character 
      public GameObject Pc; 
      public GameObject StartPosition; 
      public GameObject CharacterCustomization; 
 
      // let's have a reference to the current scene/level 
      public Scene CurrentScene; 
 
      // Ref to UI Elements ... 
      public bool DisplaySettings = false; 
      public UiController uiController; 
 
      public int Level = 0; 
 
      // initial audio levels for background and 
      // sound FX 
      public float AudioLevel = 0.33f; 
      public float FxLevel = 0.33f; 
 
      void Awake() 
      { 
         // simple singleton 
         if (instance == null) 
         { 
            instance = this; 
         } 
         else if (instance != this) 
         { 
            Destroy(this); 
         } 
 
         // keep the game object when moving from 
         // one scene to the next scene 
         DontDestroyOnLoad(this); 
      } 
 
      // Use this for initialization 
      void Start() 
      { 
         // let's find a reference to the UI controller of the loaded scene 
         if (GameObject.FindGameObjectWithTag("UI") != null) 
         { 
            instance.uiController = GameObject.FindGameObjectWithTag("UI").GetComponent&lt;UiController&gt;(); 
         } 
 
         instance.uiController.OptionsPanel.gameObject.SetActive(instance.DisplaySettings); 
      } 
 
      // Update is called once per frame 
      void Update() 
      { 
 
      } 
 
      public void MasterVolume(float volume) 
      { 
         instance.AudioLevel = volume; 
         instance.GetComponent&lt;AudioSource&gt;().volume = instance.AudioLevel; 
      } 
 
      public void StartGame() 
      { 
         // NOTE: Start the game, load the scene that allows the player 
         // to customize their character 
         SceneManager.LoadScene(SceneName.CharacterCustomization); 
      } 
   } 
} </pre>
<p class="calibre3">This code needs a little bit of explanation. The first and most important concept to take away is the concept of a Singleton. This is done by first defining a static variable, which will be used to hold our <kbd class="calibre13">GameMaster</kbd> instance:</p>
<pre class="calibre18">public static GameMaster instance;</pre>
<p class="calibre3">Then, in our <kbd class="calibre13">Awake()</kbd> function, we need the following code:</p>
<pre class="calibre18">void Awake()<br class="title-page-name"/>{<br class="title-page-name"/>// simple singleton<br class="title-page-name"/>if (instance == null)<br class="title-page-name"/>{<br class="title-page-name"/>instance = this;<br class="title-page-name"/>}<br class="title-page-name"/>else if (instance != this)<br class="title-page-name"/>{<br class="title-page-name"/>Destroy(this);<br class="title-page-name"/>}<br class="title-page-name"/>// keep the game object when moving from<br class="title-page-name"/>// one scene to the next scene<br class="title-page-name"/>DontDestroyOnLoad(this);<br class="title-page-name"/>}</pre>
<p class="calibre3"/>
<p class="calibre3"/>
<p class="calibre3"/>
<p class="calibre3"/>
<p class="calibre3"/>
<p class="calibre3"/>
<p class="calibre3">In the <kbd class="calibre13">Awake()</kbd> function, we are checking to see if the <kbd class="calibre13">instance</kbd> variable has been initialized. It sets the <kbd class="calibre13">instance</kbd> variable once. The next check ensures that we always have one instance. In other words, if the <kbd class="calibre13">GameMaster</kbd> object gets instantiated a second time by mistake, it will destroy it. The last line of code, <kbd class="calibre13">DotDestroyOnLoad()</kbd>, will ensure that the GameObject does not get destroyed when we move from one scene to the next.</p>
<p class="calibre3">In the <kbd class="calibre13">Start()</kbd> function, we are checking to see if <kbd class="calibre13">uiController</kbd> is present, and if it is, we get a reference to it. Once we have a reference to <kbd class="calibre13">uiController</kbd>, we make sure that the <span class="calibre6">Settings</span> panel is disabled<span class="calibre6"> by default</span>, that is, hidden.</p>
<p class="calibre3">The <kbd class="calibre13">MasterVolume()</kbd> function gets called from the <kbd class="calibre13">UIController.cs</kbd> script, which then passes the actual value from the slider defined to control the volume of the background music.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Managing scenes</h1>
                
            
            <article>
                
<p class="calibre3">The next item I want to make is to have the <kbd class="calibre13">GameMaster</kbd> control loading the different scenes for the game. Let's look at how <kbd class="calibre13">GameMaster.cs</kbd> will look with the new addition of scene management:</p>
<pre class="calibre18">using UnityEngine;<br class="title-page-name"/>using UnityEngine.SceneManagement;<br class="title-page-name"/>namespace com.noorcon.rpg2e<br class="title-page-name"/>{<br class="title-page-name"/>public static class SceneName<br class="title-page-name"/>{<br class="title-page-name"/>public const string MainMenu = "MainMenu";<br class="title-page-name"/>public const string CharacterCustomization =<br class="title-page-name"/>"CharacterCustomization";<br class="title-page-name"/>public const string Level_1 = "Awakening";<br class="title-page-name"/>}<br class="title-page-name"/>[RequireComponent(typeof(AudioSource))]<br class="title-page-name"/>public class GameMaster : MonoBehaviour<br class="title-page-name"/>{<br class="title-page-name"/>public static GameMaster instance;<br class="title-page-name"/>// let's have a reference to the player character<br class="title-page-name"/>// and start position of player character<br class="title-page-name"/>public GameObject Pc;<br class="title-page-name"/>public GameObject StartPosition;<br class="title-page-name"/>public GameObject CharacterCustomization;<br class="title-page-name"/>// let's have a reference to the current scene/level<br class="title-page-name"/>public Scene CurrentScene;<br class="title-page-name"/>// Ref to UI Elements ...<br class="title-page-name"/>public bool DisplaySettings = false;<br class="title-page-name"/>public UiController Ui;<br class="title-page-name"/>public int Level = 0;<br class="title-page-name"/>// initial audio levels for background and<br class="title-page-name"/>// sound FX<br class="title-page-name"/>public float AudioLevel = 0.33f;<br class="title-page-name"/>public float FxAudioLevel = 0.33f;<br class="title-page-name"/>void Awake()<br class="title-page-name"/>{<br class="title-page-name"/>// simple singlton<br class="title-page-name"/>if (instance == null)<br class="title-page-name"/>{<br class="title-page-name"/>instance = this;<br class="title-page-name"/>}<br class="title-page-name"/>else if (instance != this)<br class="title-page-name"/>{<br class="title-page-name"/>Destroy(this);<br class="title-page-name"/>}<br class="title-page-name"/>// keep the game object when moving from<br class="title-page-name"/>// one scene to the next scene<br class="title-page-name"/>DontDestroyOnLoad(this);<br class="title-page-name"/>}<br class="title-page-name"/>// for each level/scene that has been loaded<br class="title-page-name"/>// do some of the preparation work<br class="title-page-name"/>void OnLevelWasLoaded()<br class="title-page-name"/>{<br class="title-page-name"/>instance.CurrentScene = SceneManager.GetActiveScene();<br class="title-page-name"/>if (instance.CurrentScene.name.Equals(SceneName.CharacterCustomization))<br class="title-page-name"/>{<br class="title-page-name"/>if (GameObject.FindGameObjectWithTag("BASE") != null)<br class="title-page-name"/>{<br class="title-page-name"/>instance.CharacterCustomization = GameObject.FindGameObjectWithTag("BASE") as GameObject;<br class="title-page-name"/>}<br class="title-page-name"/>}<br class="title-page-name"/>// If we are at any other scene except character customization<br class="title-page-name"/>// let's go ahead and get reference to player and player<br class="title-page-name"/>// stat position<br class="title-page-name"/>if (!this.CurrentScene.name.Equals(SceneName.CharacterCustomization))<br class="title-page-name"/>{<br class="title-page-name"/>// let's get a reference to our player character<br class="title-page-name"/>if (instance.Pc == null)<br class="title-page-name"/>{<br class="title-page-name"/>if (GameObject.FindGameObjectWithTag("Player") != null)<br class="title-page-name"/>{<br class="title-page-name"/>instance.Pc = GameObject.FindGameObjectWithTag("Player") as GameObject;<br class="title-page-name"/>}<br class="title-page-name"/>}</pre>
<p class="calibre3"/>
<p class="calibre3"/>
<p class="calibre3"/>
<pre class="calibre18">if (GameObject.FindGameObjectWithTag("START_POSITION") != null)<br class="title-page-name"/><a href="https://github.com/PacktPublishing/Building-an-RPG-with-Unity-2018-Second-Edition" class="calibre83">...</a></pre>
<p class="calibre3"><span class="calibre6">We have already discussed what the </span><kbd class="calibre13">Awake()</kbd><span class="calibre6"> function is doing, so let's take a look at the next important function, </span><kbd class="calibre13">OnLevelWasLoaded()</kbd><span class="calibre6">. Take a look at the following code:</span></p>
<pre class="calibre18">public void MasterVolume(float volume)<br class="title-page-name"/>{<br class="title-page-name"/>instance.AudioLevel = volume;<br class="title-page-name"/>instance.GetComponent&lt;AudioSource&gt;().volume = instance.AudioLevel;<br class="title-page-name"/>}<br class="title-page-name"/>public void SoundFxVolume(float volume)<br class="title-page-name"/>{<br class="title-page-name"/>instance.FxAudioLevel = volume;<br class="title-page-name"/>}<br class="title-page-name"/>public void StartGame()<br class="title-page-name"/>{<br class="title-page-name"/>// NOTE: Start the game, load the scene that allows the player<br class="title-page-name"/>// to customize their character<br class="title-page-name"/>SceneManager.LoadScene(SceneName.CharacterCustomization);<br class="title-page-name"/>}<br class="title-page-name"/>public void LoadLevel()<br class="title-page-name"/>{<br class="title-page-name"/>switch (instance.Level)<br class="title-page-name"/>{<br class="title-page-name"/>// load level 1<br class="title-page-name"/>case 1:<br class="title-page-name"/>{<br class="title-page-name"/>instance.Pc = GameObject.FindGameObjectWithTag("Player") as GameObject;<br class="title-page-name"/>SceneManager.LoadScene(SceneName.Level_1);<br class="title-page-name"/>break;<br class="title-page-name"/>}<br class="title-page-name"/>}<br class="title-page-name"/>}<br class="title-page-name"/>}<br class="title-page-name"/>}</pre>
<p class="calibre3">The <kbd class="calibre13">OnLevelWasLoaded()</kbd> function is called by Unity after the scene was loaded. We are using this function in the <kbd class="calibre13">GameMaster</kbd> script to perform a few tasks. The first thing we do is get the current scene we are in. This information will be used later to determine what <kbd class="calibre13">GameMaster</kbd> will do.</p>
<p class="calibre3"/>
<p class="calibre3"/>
<p class="calibre3"/>
<p class="calibre3"/>
<p class="calibre3"/>
<p class="calibre3"/>
<p class="calibre3"/>
<p class="calibre3"/>
<p class="calibre3">We check to see if we are in the character customization scene. This is where the player can customize the PC before they start playing the game. If we are in the character customization scene, we want to get a reference to the <kbd class="calibre13">Base</kbd> GameObject in the scene. If you recall, the <kbd class="calibre13">Base</kbd> GameObject has the <kbd class="calibre13">CharacterCutomization.cs</kbd> script attached to it, which is used to, well, customize the character.</p>
<p class="calibre3">If we are in any other scene, then we want to get a reference to the player character, as well as the starting position of the player character at the beginning of the scene, if there is one.</p>
<p class="calibre3">We then use the <kbd class="calibre13">DetermineLevel()</kbd> function to determine the level we are currently on, to make some more configurations.</p>
<p class="calibre3">The two functions currently implemented for starting the game and loading the levels are handled by the <kbd class="calibre13">StartGame()</kbd> function and the <kbd class="calibre13">LoadLevel()</kbd> function.</p>
<pre class="calibre18">public static class SceneName<br class="title-page-name"/>{<br class="title-page-name"/>public const string MainMenu = "MainMenu";<br class="title-page-name"/>public const string CharacterCustomization = "CharacterCustomization";<br class="title-page-name"/>public const string Level_1 = "Awakening";<br class="title-page-name"/>}</pre>
<p class="calibre3">The <kbd class="calibre13">SceneName</kbd> class is designed to make it easier to refer to the scene names in the C# code. This makes it easier to chance the actual scene name within the project, but have a consistent call name in the code.</p>
<p class="calibre3">This is all good so far, but we can try to make it better.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Improving GameMaster</h1>
                
            
            <article>
                
<p class="calibre3">The code we have so far works, but it is not very clean. Let's go ahead and structure the code a little better. Let's create a new script, called <kbd class="calibre13">GameLevelController.cs</kbd>. This new script will be handling the logic for our level management.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Level controller</h1>
                
            
            <article>
                
<p class="calibre3">A listing of <kbd class="calibre13">GameLevelController.cs</kbd> is as follows:</p>
<pre class="calibre18">using UnityEngine;<br class="title-page-name"/>using UnityEngine.SceneManagement;<br class="title-page-name"/>namespace com.noorcon.rpg2e<br class="title-page-name"/>{<br class="title-page-name"/>public static class SceneName<br class="title-page-name"/>{<br class="title-page-name"/>public const string MainMenu = "MainMenu";<br class="title-page-name"/>public const string CharacterCustomization = "CharacterCustomization";<br class="title-page-name"/>public const string Level_1 = "Awakening";<br class="title-page-name"/>}<br class="title-page-name"/>public class GameLevelController<br class="title-page-name"/>{<br class="title-page-name"/>// let's have a reference to the current scene/level<br class="title-page-name"/>public Scene CurrentScene<br class="title-page-name"/>{<br class="title-page-name"/>get { return SceneManager.GetActiveScene(); }<br class="title-page-name"/>}<br class="title-page-name"/>// keep the numerical level value<br class="title-page-name"/>public int Level = 0;<br class="title-page-name"/>public void OnLevelWasLoaded()<br class="title-page-name"/>{<br class="title-page-name"/>// if we are in the character customization scene,<br class="title-page-name"/>// let's get a reference to the Base game object for future use.<br class="title-page-name"/>if (CurrentScene.Equals(SceneName.CharacterCustomization))<br class="title-page-name"/>{<br class="title-page-name"/>if (GameObject.FindGameObjectWithTag("Base") != null)<br class="title-page-name"/>{<br class="title-page-name"/>GameMaster.instance.CharacterCustomization = GameObject.FindGameObjectWithTag("Base") as GameObject;<br class="title-page-name"/>}<br class="title-page-name"/>}<br class="title-page-name"/>// If we are at any other scene except character customization<br class="title-page-name"/>// let's go ahead and get reference to player and player<br class="title-page-name"/>// stat position<br class="title-page-name"/>if (CurrentScene.name.Equals(SceneName.CharacterCustomization))<br class="title-page-name"/>{<br class="title-page-name"/>// let's get a reference to our player character<br class="title-page-name"/>if (GameMaster.instance.Pc == null)<br class="title-page-name"/>{<br class="title-page-name"/>if (GameObject.FindGameObjectWithTag("Player") != null)<br class="title-page-name"/>{<br class="title-page-name"/>GameMaster.instance.Pc = GameObject.FindGameObjectWithTag("Player") as GameObject;<br class="title-page-name"/>}<br class="title-page-name"/>}<br class="title-page-name"/>if (GameObject.FindGameObjectWithTag("StartPosition") != null)<br class="title-page-name"/>{<br class="title-page-name"/>GameMaster.instance.StartPosition = GameObject.FindGameObjectWithTag("StartPosition") as GameObject;<br class="title-page-name"/>}<br class="title-page-name"/>if (GameMaster.instance.StartPosition != null &amp;&amp; GameMaster.instance.Pc != null)<br class="title-page-name"/>{<br class="title-page-name"/>GameMaster.instance.Pc.transform.position = GameMaster.instance.StartPosition.transform.position;<br class="title-page-name"/>GameMaster.instance.Pc.transform.rotation = GameMaster.instance.StartPosition.transform.rotation;<br class="title-page-name"/>}<br class="title-page-name"/>}<br class="title-page-name"/>// determine what level we are on<br class="title-page-name"/>DetermineLevel();<br class="title-page-name"/>}<br class="title-page-name"/>// this function will set a numerical value for our levels<br class="title-page-name"/>private void DetermineLevel()<br class="title-page-name"/>{<br class="title-page-name"/>switch (CurrentScene.name)<br class="title-page-name"/>{<br class="title-page-name"/>case SceneName.MainMenu:<br class="title-page-name"/>case SceneName.CharacterCustomization:<br class="title-page-name"/>{<br class="title-page-name"/>Level = 0;<br class="title-page-name"/>break;<br class="title-page-name"/>}<br class="title-page-name"/>case SceneName.Level_1:<br class="title-page-name"/>{<br class="title-page-name"/>Level = 1;<br class="title-page-name"/>GameMaster.instance.Pc.GetComponent&lt;IKHandle&gt;().enabled = true;<br class="title-page-name"/>break;<br class="title-page-name"/>}<br class="title-page-name"/>default:<br class="title-page-name"/>{<br class="title-page-name"/>Level = 0;<br class="title-page-name"/>break;<br class="title-page-name"/>}<br class="title-page-name"/>}<br class="title-page-name"/>}<br class="title-page-name"/><a href="https://github.com/PacktPublishing/Building-an-RPG-with-Unity-2018-Second-Edition" class="calibre83">.....</a></pre>
<p class="calibre3">What I have done is basically move all of the code that deals with level management into <kbd class="calibre13">GameLevelController.cs</kbd>. Our <kbd class="calibre13">GameMaster</kbd> script drives the LevelController class. We will see this a bit later.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Audio controller</h1>
                
            
            <article>
                
<p class="calibre3">The next code clean-up I want to do is for the audio. Let's create a new script, called <kbd class="calibre13">GameAudioController.cs</kbd>. The code for the new script is as follows:</p>
<pre class="calibre18">using UnityEngine;<br class="title-page-name"/>namespace com.noorcon.rpg2e<br class="title-page-name"/>{<br class="title-page-name"/>public class GameAudioController : MonoBehaviour<br class="title-page-name"/>{<br class="title-page-name"/>// initial audio levels for background and<br class="title-page-name"/>// sound FX<br class="title-page-name"/>public float AudioLevel = 0.33f;<br class="title-page-name"/>public float FxAudioLevel = 0.33f;<br class="title-page-name"/>public AudioSource audioSource;<br class="title-page-name"/>public void SetDefaultVolume()<br class="title-page-name"/>{<br class="title-page-name"/>audioSource.volume = AudioLevel;<br class="title-page-name"/>}<br class="title-page-name"/>public void MasterVolume(float volume)<br class="title-page-name"/>{<br class="title-page-name"/>AudioLevel = volume;<br class="title-page-name"/>audioSource.volume = AudioLevel;<br class="title-page-name"/>}<br class="title-page-name"/>public void SoundFxVolume(float volume)<br class="title-page-name"/>{<br class="title-page-name"/>FxAudioLevel = volume;<br class="title-page-name"/>}<br class="title-page-name"/>}<br class="title-page-name"/>}</pre>
<p class="calibre3">The code is pretty straightforward. Now, let's take a look at how <kbd class="calibre13">GameMaster.cs</kbd> looks:</p>
<pre class="calibre18">using UnityEngine;<br class="title-page-name"/>namespace com.noorcon.rpg2e<br class="title-page-name"/>{<br class="title-page-name"/>[RequireComponent(typeof(AudioSource))]<br class="title-page-name"/>public class GameMaster : MonoBehaviour<br class="title-page-name"/>{<br class="title-page-name"/>public static GameMaster instance;<br class="title-page-name"/>// let's have a reference to the player character<br class="title-page-name"/>// and start position of player character<br class="title-page-name"/>public GameObject Pc;<br class="title-page-name"/>public GameObject StartPosition;<br class="title-page-name"/>public GameObject CharacterCustomization;<br class="title-page-name"/>public GameLevelController LevelController;<br class="title-page-name"/>public GameAudioController AudioController;<br class="title-page-name"/>// Ref to UI Elements ...<br class="title-page-name"/>public bool DisplaySettings = false;<br class="title-page-name"/>public UiController Ui;<br class="title-page-name"/>void Awake()<br class="title-page-name"/>{<br class="title-page-name"/>// simple singlton<br class="title-page-name"/>if (instance == null)<br class="title-page-name"/>{<br class="title-page-name"/>instance = this;<br class="title-page-name"/>// initialize level controller<br class="title-page-name"/>instance.LevelController = new GameLevelController();<br class="title-page-name"/>// initialize audio controller<br class="title-page-name"/>instance.AudioController = new GameAudioController();<br class="title-page-name"/>instance.AudioController.audioSource = instance.GetComponent&lt;AudioSource&gt;();<br class="title-page-name"/>instance.AudioController.SetDefaultVolume();<br class="title-page-name"/>}<br class="title-page-name"/>else if (instance != this)<br class="title-page-name"/>{<br class="title-page-name"/>Destroy(this);<br class="title-page-name"/>}<br class="title-page-name"/>// keep the game object when moving from<br class="title-page-name"/>// one scene to the next scene<br class="title-page-name"/>DontDestroyOnLoad(this);<br class="title-page-name"/>}<br class="title-page-name"/>// for each level/scene that has been loaded<br class="title-page-name"/>// do some of the preparation work<br class="title-page-name"/>void OnLevelWasLoaded()<br class="title-page-name"/>{<br class="title-page-name"/>instance.LevelController.OnLevelWasLoaded();<br class="title-page-name"/>}<br class="title-page-name"/>// Use this for initialization<br class="title-page-name"/>void Start()<br class="title-page-name"/>{<br class="title-page-name"/>// let's find a reference to the UI controller of the loaded scene<br class="title-page-name"/>if (GameObject.FindGameObjectWithTag("Ui") != null)<br class="title-page-name"/>{<br class="title-page-name"/>instance.Ui = GameObject.FindGameObjectWithTag("Ui").GetComponent&lt;UiController&gt;();<br class="title-page-name"/>}<br class="title-page-name"/>instance.Ui.OptionsPanel.gameObject.SetActive(instance.DisplaySettings);<br class="title-page-name"/>}<br class="title-page-name"/>// Update is called once per frame<br class="title-page-name"/>void Update()<br class="title-page-name"/>{<br class="title-page-name"/>}<br class="title-page-name"/>public void MasterVolume(float volume)<br class="title-page-name"/>{<br class="title-page-name"/>instance.AudioController.MasterVolume(volume);<br class="title-page-name"/>}<br class="title-page-name"/>public void SoundFxVolume(float volume)<br class="title-page-name"/>{<br class="title-page-name"/>instance.AudioController.SoundFxVolume(volume);<br class="title-page-name"/>}<br class="title-page-name"/>public void StartGame()<br class="title-page-name"/>{<br class="title-page-name"/>instance.LoadLevel();<br class="title-page-name"/>}<br class="title-page-name"/>public void LoadLevel()<br class="title-page-name"/>{<br class="title-page-name"/>instance.LevelController.LoadLevel();<br class="title-page-name"/>}<br class="title-page-name"/>}<br class="title-page-name"/>}</pre>
<p class="calibre3">As you can see, the code is easier to read, and it is also structured better. GameMaster is using the controllers to perform each specific task. This also makes it easier to maintain code for different tasks within our game. For instance, all of the audio-related code can be now implemented in the controller, and so on.</p>
<p class="calibre3">For all this to work, you have to make sure that you have properly hooked up your <kbd class="calibre13">uiController</kbd> GameObject to communicate with the <kbd class="calibre13">UiController.cs</kbd> class when the user interacts with the Options/Settings menu, as shown in the following screenshot:</p>
<div class="mce-root1"><img src="../images/00110.jpeg" class="calibre45"/></div>
<div class="mce-root2">UI element events</div>
<p class="calibre3"/>
<p class="calibre3">Your project should also have the following <span class="calibre6">Tags</span> defined by now:</p>
<div class="mce-root1"><img src="../images/00111.jpeg" class="calibre104"/></div>
<p class="calibre3">These are used within the C# code to identify GameObjects at runtime.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Player data management</h1>
                
            
            <article>
                
<p class="calibre3">We have not saved the actual data representing the customization of our player. The next step is to enhance our <kbd class="calibre13">PlayerCharacter.cs</kbd> and <kbd class="calibre13">BarbarianCharacterCustomization.cs</kbd> scripts to actually save the selected data in our PC object.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">PC class enhancements</h1>
                
            
            <article>
                
<p class="calibre3">To do this, we need to modify our <kbd class="calibre13">PlayerCharacter.cs</kbd> code. The new listing is as follows:</p>
<pre class="calibre18">using System;<br class="title-page-name"/>namespace com.noorcon.rpg2e<br class="title-page-name"/>{<br class="title-page-name"/>[Serializable]<br class="title-page-name"/>public class PlayerCharacter : BaseCharacter<br class="title-page-name"/>{<br class="title-page-name"/>public enum ShoulderPad<br class="title-page-name"/>{<br class="title-page-name"/>none = 0,<br class="title-page-name"/>SP01 = 1,<br class="title-page-name"/>SP02 = 2,<br class="title-page-name"/>SP03 = 3,<br class="title-page-name"/>SP04 = 4<br class="title-page-name"/>};<br class="title-page-name"/>public enum BodyType { normal = 1, BT01 = 2, BT02 = 3<br class="title-page-name"/>};<br class="title-page-name"/>// Shoulder Pad<br class="title-page-name"/>public ShoulderPad selectedShoulderPad = ShoulderPad.none;<br class="title-page-name"/>public BodyType selectedBodyType = BodyType.normal;<br class="title-page-name"/>public bool kneePad = false;<br class="title-page-name"/>public bool legPlate = false;<br class="title-page-name"/>public enum WeaponType<br class="title-page-name"/>{<br class="title-page-name"/>none = 0,<br class="title-page-name"/>axe1 = 1,<br class="title-page-name"/>axe2 = 2,<br class="title-page-name"/>club1 = 3,<br class="title-page-name"/>club2 = 4,<br class="title-page-name"/>falchion = 5,<br class="title-page-name"/>gladius = 6,<br class="title-page-name"/>mace = 7,<br class="title-page-name"/>maul = 8,<br class="title-page-name"/>scimitar = 9,<br class="title-page-name"/>spear = 10,<br class="title-page-name"/>sword1 = 11,<br class="title-page-name"/>sword2 = 12,<br class="title-page-name"/>sword3 = 13<br class="title-page-name"/>};<br class="title-page-name"/>public WeaponType selectedWeapon = WeaponType.none;<br class="title-page-name"/>public enum HelmetType { none = 0, HL01 = 1, HL02 = 2, HL03 = 3, HL04 = 4 };<br class="title-page-name"/>public HelmetType selectedHelmet = HelmetType.none;<br class="title-page-name"/>public enum ShieldType { none = 0, SL01 = 1, SL02 = 2 };<br class="title-page-name"/>public ShieldType selectedShield = ShieldType.none;<br class="title-page-name"/>public int SKIN_ID = 1;<br class="title-page-name"/>public enum ShoeType { none = 0, BT01 = 1, BT02 = 2 };<br class="title-page-name"/>public ShoeType selectedBoot = ShoeType.none;<br class="title-page-name"/>}<br class="title-page-name"/>}</pre>
<p class="calibre3">We have defined several enumeration types that describe the different parts of the player character's customization. There are several advantages to using enumeration in our code, a few of them being named constants, the name describes what they are for, type safety, and it is easier to change the value of the enumeration without having to check a hundred different places within your code.</p>
<p class="calibre3">As stated in previous chapters, the character customization code is heavily related to your character model and how you have rigged up your character model to be used in the game.</p>
<div class="packt_infobox">You will need to modify the name of your UI elements to match the new code.</div>
<p class="calibre3">Take a look at the following screenshot:</p>
<div class="mce-root1"><img src="../images/00112.jpeg" class="calibre45"/></div>
<div class="mce-root2">Hooking up UI element events</div>
<p class="calibre3">There are a few things you will need to configure to make sure the code works properly. First, you will need to name your UI elements properly to match the enumeration. The preceding screenshot illustrates one of the UI elements representing a shoulder pad.</p>
<p class="calibre3"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Character customization class update</h1>
                
            
            <article>
                
<p class="calibre3">The events that drive character customization are attached to the <kbd class="calibre13">Base</kbd> prefab, which has the <kbd class="calibre13">CharacterCustomization.cs</kbd> script as a component. The <kbd class="calibre13">CharacterCustomization.cs</kbd> script is as follows:</p>
<pre class="calibre18">using System;<br class="title-page-name"/>using UnityEngine;<br class="title-page-name"/>using UnityEngine.UI;<br class="title-page-name"/><br class="title-page-name"/>namespace com.noorcon.rpg2e<br class="title-page-name"/>{<br class="title-page-name"/>  public class BarbarianCharacterCustomization : MonoBehaviour<br class="title-page-name"/>  {<br class="title-page-name"/>    public GameObject PLAYER_CHARACTER;<br class="title-page-name"/><br class="title-page-name"/>    public PlayerCharacter PlayerCharacterData;<br class="title-page-name"/><br class="title-page-name"/>    public Material[] PLAYER_SKIN;<br class="title-page-name"/><br class="title-page-name"/><a href="https://github.com/PacktPublishing/Building-an-RPG-with-Unity-2018-Second-Edition" class="calibre83">...</a><br class="title-page-name"/><br class="title-page-name"/>    // Use this for initialization<br class="title-page-name"/>    void Start()<br class="title-page-name"/>    {<br class="title-page-name"/>      PlayerCharacterData = PLAYER_CHARACTER.GetComponent&lt;PlayerAgent&gt;().playerCharacterData;<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    public bool ROTATE_MODEL = false;<br class="title-page-name"/><br class="title-page-name"/>    // Update is called once per frame<br class="title-page-name"/>    void Update()<br class="title-page-name"/>    {<br class="title-page-name"/>      if (Input.GetKeyUp(KeyCode.R))<br class="title-page-name"/>      {<br class="title-page-name"/>        ROTATE_MODEL = !ROTATE_MODEL;<br class="title-page-name"/>      }<br class="title-page-name"/><br class="title-page-name"/>      if (ROTATE_MODEL)<br class="title-page-name"/>      {<br class="title-page-name"/>        PLAYER_CHARACTER.transform.Rotate(new Vector3(0, 1, 0), 33.0f * Time.deltaTime);<br class="title-page-name"/>      }<br class="title-page-name"/><br class="title-page-name"/>      if (Input.GetKeyUp(KeyCode.L))<br class="title-page-name"/>      {<br class="title-page-name"/>        Debug.Log(PlayerPrefs.GetString("Name"));<br class="title-page-name"/>      }<br class="title-page-name"/><br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>        void DisableShoulderPads()<br class="title-page-name"/>        {<br class="title-page-name"/>            SHOULDER_PAD_R_01LOD0.SetActive(false);<br class="title-page-name"/>            SHOULDER_PAD_R_02LOD0.SetActive(false);<br class="title-page-name"/>            SHOULDER_PAD_R_03LOD0.SetActive(false);<br class="title-page-name"/>            SHOULDER_PAD_R_04LOD0.SetActive(false);<br class="title-page-name"/><br class="title-page-name"/>            SHOULDER_PAD_L_01LOD0.SetActive(false);<br class="title-page-name"/>            SHOULDER_PAD_L_02LOD0.SetActive(false);<br class="title-page-name"/>            SHOULDER_PAD_L_03LOD0.SetActive(false);<br class="title-page-name"/>            SHOULDER_PAD_L_04LOD0.SetActive(false);<br class="title-page-name"/>        }<br class="title-page-name"/><br class="title-page-name"/><br class="title-page-name"/>    public void SetShoulderPad(Toggle id)<br class="title-page-name"/>    {<br class="title-page-name"/>      try<br class="title-page-name"/>      {<br class="title-page-name"/>        PlayerCharacter.ShoulderPad name <br class="title-page-name"/>          = (PlayerCharacter.ShoulderPad)Enum.Parse(typeof(PlayerCharacter.ShoulderPad), id.name, true);<br class="title-page-name"/>        if (id.isOn)<br class="title-page-name"/>        {<br class="title-page-name"/>          PlayerCharacterData.SelectedShoulderPad = name;<br class="title-page-name"/>        }<br class="title-page-name"/>        else<br class="title-page-name"/>        {<br class="title-page-name"/>          PlayerCharacterData.SelectedShoulderPad <br class="title-page-name"/>            = PlayerCharacter.ShoulderPad.none;<br class="title-page-name"/>        }<br class="title-page-name"/>      }<br class="title-page-name"/>      catch<br class="title-page-name"/>      {<br class="title-page-name"/>        // if the value passed is not in the enumeration set it to none<br class="title-page-name"/>        PlayerCharacterData.SelectedShoulderPad <br class="title-page-name"/>          = PlayerCharacter.ShoulderPad.none;<br class="title-page-name"/>      }<br class="title-page-name"/><br class="title-page-name"/>            // disable before new selection<br class="title-page-name"/>            DisableShoulderPads();<br class="title-page-name"/><br class="title-page-name"/>            switch (id.name)<br class="title-page-name"/>      {<br class="title-page-name"/>        case "SP01":<br class="title-page-name"/>          {<br class="title-page-name"/>            SHOULDER_PAD_R_01LOD0.SetActive(id.isOn);<br class="title-page-name"/>            SHOULDER_PAD_L_01LOD0.SetActive(id.isOn);<br class="title-page-name"/>            break;<br class="title-page-name"/>          }<br class="title-page-name"/><a href="https://github.com/PacktPublishing/Building-an-RPG-with-Unity-2018-Second-Edition" class="calibre83">...</a><br class="title-page-name"/>        case "SP04":<br class="title-page-name"/>          {<br class="title-page-name"/>            SHOULDER_PAD_R_04LOD0.SetActive(id.isOn);<br class="title-page-name"/>            SHOULDER_PAD_L_04LOD0.SetActive(id.isOn);<br class="title-page-name"/>            break;<br class="title-page-name"/>          }<br class="title-page-name"/>      }<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/><a href="https://github.com/PacktPublishing/Building-an-RPG-with-Unity-2018-Second-Edition" class="calibre83">...</a></pre>
<p class="calibre3"><span class="calibre6">In the code listed, what we have done is add a new variable of type <kbd class="calibre13">PlayerCharacter</kbd> named <kbd class="calibre13">PlayerCharacterData</kbd>. The <kbd class="calibre13">PlayerCharacter</kbd> class is the player character class we have defined and enhanced to contain the data for our player character as follows:</span></p>
<pre class="calibre18">    public void SetKneePad(Toggle id)<br class="title-page-name"/>    {<br class="title-page-name"/>      KNEE_PAD_R_LOD0.SetActive(id.isOn);<br class="title-page-name"/>      KNEE_PAD_L_LOD0.SetActive(id.isOn);<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    public void SetLegPlate(Toggle id)<br class="title-page-name"/>    {<br class="title-page-name"/>      LEG_PLATE_R_LOD0.SetActive(id.isOn);<br class="title-page-name"/>      LEG_PLATE_L_LOD0.SetActive(id.isOn);<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>        void DisableWeapons()<br class="title-page-name"/>        {<br class="title-page-name"/>            AXE_01LOD0.SetActive(false);<br class="title-page-name"/>            AXE_02LOD0.SetActive(false);<br class="title-page-name"/>            CLUB_01LOD0.SetActive(false);<br class="title-page-name"/>            CLUB_02LOD0.SetActive(false);<br class="title-page-name"/>            FALCHION_LOD0.SetActive(false);<br class="title-page-name"/>            GLADIUS_LOD0.SetActive(false);<br class="title-page-name"/>            MACE_LOD0.SetActive(false);<br class="title-page-name"/>            MAUL_LOD0.SetActive(false);<br class="title-page-name"/>            SCIMITAR_LOD0.SetActive(false);<br class="title-page-name"/>            SPEAR_LOD0.SetActive(false);<br class="title-page-name"/>            SWORD_BASTARD_LOD0.SetActive(false);<br class="title-page-name"/>            SWORD_BOARD_01LOD0.SetActive(false);<br class="title-page-name"/>            SWORD_SHORT_LOD0.SetActive(false);<br class="title-page-name"/>        }<br class="title-page-name"/><br class="title-page-name"/>    public void SetWeaponType(Slider id)<br class="title-page-name"/>    {<br class="title-page-name"/>      try<br class="title-page-name"/>      {<br class="title-page-name"/>        PlayerCharacter.WeaponType weapon = (PlayerCharacter.WeaponType)Convert.ToInt32(id.value);<br class="title-page-name"/><br class="title-page-name"/>        PlayerCharacterData.SelectedWeapon = weapon;<br class="title-page-name"/>      }<br class="title-page-name"/>      catch<br class="title-page-name"/>      {<br class="title-page-name"/>        PlayerCharacterData.SelectedWeapon = PlayerCharacter.WeaponType.none;<br class="title-page-name"/>      }<br class="title-page-name"/><br class="title-page-name"/>            // disable weapons<br class="title-page-name"/>            DisableWeapons();<br class="title-page-name"/><br class="title-page-name"/>      switch (Convert.ToInt32(id.value))<br class="title-page-name"/>      {<br class="title-page-name"/>        case 0:<br class="title-page-name"/>          {<br class="title-page-name"/>                        DisableWeapons();<br class="title-page-name"/>            break;<br class="title-page-name"/>          }<br class="title-page-name"/>        case 1:<br class="title-page-name"/>          {<br class="title-page-name"/>            AXE_01LOD0.SetActive(true);<br class="title-page-name"/>            break;<br class="title-page-name"/>          }<br class="title-page-name"/><a href="https://github.com/PacktPublishing/Building-an-RPG-with-Unity-2018-Second-Edition" class="calibre83">...</a><br class="title-page-name"/>        case 13:<br class="title-page-name"/>          {<br class="title-page-name"/>            SWORD_SHORT_LOD0.SetActive(true);<br class="title-page-name"/>            break;<br class="title-page-name"/>          }<br class="title-page-name"/>      }<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    public void SetWeaponType(PlayerCharacter.WeaponType id)<br class="title-page-name"/>    {<br class="title-page-name"/>            // disable Weapons<br class="title-page-name"/>            DisableWeapons();<br class="title-page-name"/><br class="title-page-name"/>      switch (Convert.ToInt32(id))<br class="title-page-name"/>      {<br class="title-page-name"/>        case 0:<br class="title-page-name"/>          {<br class="title-page-name"/>                        DisableWeapons();<br class="title-page-name"/>            break;<br class="title-page-name"/>          }<br class="title-page-name"/>        case 1:<br class="title-page-name"/>          {<br class="title-page-name"/>            AXE_01LOD0.SetActive(true);<br class="title-page-name"/>            break;<br class="title-page-name"/>          }<br class="title-page-name"/><a href="https://github.com/PacktPublishing/Building-an-RPG-with-Unity-2018-Second-Edition" class="calibre83">...</a><br class="title-page-name"/>        case 13:<br class="title-page-name"/>          {<br class="title-page-name"/>            SWORD_SHORT_LOD0.SetActive(true);<br class="title-page-name"/>            break;<br class="title-page-name"/>          }<br class="title-page-name"/>      }<br class="title-page-name"/>    }</pre>
<p class="calibre3"><span class="calibre6">The next logic we need to implement is to detect which option the player has selected through the character customization UI, and appropriately set the data in the <kbd class="calibre13">PlayerCharacter</kbd> object. See the following code:</span></p>
<pre class="calibre18">        void DisableHelmets()<br class="title-page-name"/>        {<br class="title-page-name"/>            HELMET_01LOD0.SetActive(false);<br class="title-page-name"/>            HELMET_02LOD0.SetActive(false);<br class="title-page-name"/>            HELMET_03LOD0.SetActive(false);<br class="title-page-name"/>            HELMET_04LOD0.SetActive(false);<br class="title-page-name"/>        }<br class="title-page-name"/><br class="title-page-name"/>    public void SetHelmetType(Toggle id)<br class="title-page-name"/>    {<br class="title-page-name"/>      try<br class="title-page-name"/>      {<br class="title-page-name"/>        PlayerCharacter.HelmetType helmet <br class="title-page-name"/>          = (PlayerCharacter.HelmetType)Enum.Parse(typeof(PlayerCharacter.HelmetType), id.name, true);<br class="title-page-name"/>        if (id.isOn)<br class="title-page-name"/>        {<br class="title-page-name"/>          PlayerCharacterData.SelectedHelmet = helmet;<br class="title-page-name"/>        }<br class="title-page-name"/>        else<br class="title-page-name"/>        {<br class="title-page-name"/>          PlayerCharacterData.SelectedHelmet <br class="title-page-name"/>            = PlayerCharacter.HelmetType.none;<br class="title-page-name"/>        }<br class="title-page-name"/>      }<br class="title-page-name"/>      catch<br class="title-page-name"/>      {<br class="title-page-name"/>        // if the value passed is not in the enumeration set it to none<br class="title-page-name"/>        PlayerCharacterData.SelectedHelmet <br class="title-page-name"/>          = PlayerCharacter.HelmetType.none;<br class="title-page-name"/>      }<br class="title-page-name"/><br class="title-page-name"/>            // disable helmets<br class="title-page-name"/>            DisableHelmets();<br class="title-page-name"/><br class="title-page-name"/>      switch (id.name)<br class="title-page-name"/>      {<br class="title-page-name"/>        case "HL01":<br class="title-page-name"/>          {<br class="title-page-name"/>            HELMET_01LOD0.SetActive(id.isOn);<br class="title-page-name"/>            break;<br class="title-page-name"/>          }<br class="title-page-name"/>        case "HL02":<br class="title-page-name"/>          {<br class="title-page-name"/>            HELMET_02LOD0.SetActive(id.isOn);<br class="title-page-name"/>            break;<br class="title-page-name"/>          }<br class="title-page-name"/>        case "HL03":<br class="title-page-name"/>          {<br class="title-page-name"/>            HELMET_03LOD0.SetActive(id.isOn);<br class="title-page-name"/>            break;<br class="title-page-name"/>          }<br class="title-page-name"/>        case "HL04":<br class="title-page-name"/>          {<br class="title-page-name"/>            HELMET_04LOD0.SetActive(id.isOn);<br class="title-page-name"/>            break;<br class="title-page-name"/>          }<br class="title-page-name"/>      }<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/><a href="https://github.com/PacktPublishing/Building-an-RPG-with-Unity-2018-Second-Edition" class="calibre83">...</a><br class="title-page-name"/><br class="title-page-name"/>    public void SetShieldType(PlayerCharacter.ShieldType id)<br class="title-page-name"/>    {<br class="title-page-name"/>      switch (id.ToString())<br class="title-page-name"/>      {<br class="title-page-name"/>        case "SL01":<br class="title-page-name"/>          {<br class="title-page-name"/>            SHIELD_01LOD0.SetActive(true);<br class="title-page-name"/>            SHIELD_02LOD0.SetActive(false);<br class="title-page-name"/>            break;<br class="title-page-name"/>          }<br class="title-page-name"/>        case "SL02":<br class="title-page-name"/>          {<br class="title-page-name"/>            SHIELD_01LOD0.SetActive(false);<br class="title-page-name"/>            SHIELD_02LOD0.SetActive(true);<br class="title-page-name"/>            break;<br class="title-page-name"/>          }<br class="title-page-name"/>      }<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    public void SetSkinType(Slider id)<br class="title-page-name"/>    {<br class="title-page-name"/>      PlayerCharacterData.SkinId = Convert.ToInt32(id.value);<br class="title-page-name"/>      SKN_LOD0.GetComponent&lt;Renderer&gt;().material = PLAYER_SKIN[System.Convert.ToInt32(id.value)];<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/><a href="https://github.com/PacktPublishing/Building-an-RPG-with-Unity-2018-Second-Edition" class="calibre83">...</a></pre>
<p class="calibre3">The implementation concept is the same for all the different parts of the player character that can be customized. One of them is as follows:</p>
<pre class="calibre18">      public void SetClothingType(Toggle id)<br class="title-page-name"/>      {<br class="title-page-name"/>         try<br class="title-page-name"/>         {<br class="title-page-name"/>            PlayerCharacter.ClothingType clothing<br class="title-page-name"/>               = (PlayerCharacter.ClothingType)Enum.Parse(typeof(PlayerCharacter.ClothingType), id.name, true);<br class="title-page-name"/>            if (id.isOn)<br class="title-page-name"/>            {<br class="title-page-name"/>               PlayerCharacterData.selectedClothing = clothing;<br class="title-page-name"/>            }<br class="title-page-name"/>            else<br class="title-page-name"/>            {<br class="title-page-name"/>               PlayerCharacterData.selectedClothing<br class="title-page-name"/>                  = PlayerCharacter.ClothingType.none;<br class="title-page-name"/>            }<br class="title-page-name"/>         }<br class="title-page-name"/>         catch<br class="title-page-name"/>         {<br class="title-page-name"/>            // if the value passed is not in the enumeration set it to             none<br class="title-page-name"/>            PlayerCharacterData.selectedClothing<br class="title-page-name"/>               = PlayerCharacter.ClothingType.none;<br class="title-page-name"/>         }<br class="title-page-name"/><br class="title-page-name"/>         switch (id.name)<br class="title-page-name"/>         {<br class="title-page-name"/>            case "CT01":<br class="title-page-name"/>               {<br class="title-page-name"/>                  CLOTH_01LOD0.SetActive(id.isOn);<br class="title-page-name"/>                  CLOTH_02LOD0.SetActive(false);<br class="title-page-name"/>                  CLOTH_03LOD0.SetActive(false);<br class="title-page-name"/>                  break;<br class="title-page-name"/>               }<br class="title-page-name"/>            case "CT02":<br class="title-page-name"/>               {<br class="title-page-name"/>                  CLOTH_01LOD0.SetActive(false);<br class="title-page-name"/>                  CLOTH_02LOD0.SetActive(id.isOn);<br class="title-page-name"/>                  CLOTH_03LOD0.SetActive(false);<br class="title-page-name"/>                  break;<br class="title-page-name"/>               }<br class="title-page-name"/>            case "CT03":<br class="title-page-name"/>               {<br class="title-page-name"/>                  CLOTH_01LOD0.SetActive(false);<br class="title-page-name"/>                  CLOTH_02LOD0.SetActive(false);<br class="title-page-name"/>                  CLOTH_03LOD0.SetActive(id.isOn);<br class="title-page-name"/>                  break;<br class="title-page-name"/>               }<br class="title-page-name"/>            case "CT04":<br class="title-page-name"/>               {<br class="title-page-name"/>                  BELT_LOD0.SetActive(id.isOn);<br class="title-page-name"/>                  break;<br class="title-page-name"/>               }<br class="title-page-name"/>         }<br class="title-page-name"/>      }</pre>
<p class="calibre3">The preceding code is for the customization of the body type of the player character. The first thing it tries to do is to parse and convert the value passed to the function by the UI component. Next it sets the <kbd class="calibre13">selectedClothing</kbd> variable in the <kbd class="calibre13">PlayerCharacter</kbd> object. If, for some reason, the value passed does not exist in the enumeration, we will assign the default value to the <kbd class="calibre13">selectedClothing</kbd> variable. There are also debug statements to give you feedback about the current value.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Changes to the game level controller</h1>
                
            
            <article>
                
<p class="calibre3">The game level controller will also need to be updated now, to make the necessary changes to the <kbd class="calibre13">GameMaster</kbd> object. We will need to update the <kbd class="calibre13">LoadLevel()</kbd> function as follows:</p>
<pre class="calibre18">   public void LoadLevel()<br class="title-page-name"/>   {<br class="title-page-name"/>      switch (GameMaster.instance.LevelController.Level)<br class="title-page-name"/>      {<br class="title-page-name"/>         case 0:<br class="title-page-name"/>            {<br class="title-page-name"/>               SceneManager.LoadScene(SceneName.CharacterCustomization);<br class="title-page-name"/>               break;<br class="title-page-name"/>            }<br class="title-page-name"/><br class="title-page-name"/>         // load level 1<br class="title-page-name"/>         case 1:<br class="title-page-name"/>            {<br class="title-page-name"/>               GameMaster.instance.PlayerCharacterGameObject = GameObject.FindGameObjectWithTag("Player") as GameObject;<br class="title-page-name"/>               SceneManager.LoadScene(SceneName.Level_1);<br class="title-page-name"/>               break;<br class="title-page-name"/>            }<br class="title-page-name"/>      }<br class="title-page-name"/>   }</pre>
<p class="calibre3">This will make sure that GameMaster is updated with the proper player character data. Let's go ahead and test the code.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Testing</h1>
                
            
            <article>
                
<p class="calibre3">Starting from the <kbd class="calibre13">Main Menu</kbd> scene, make sure that you have the following GameObjects in the scene: <kbd class="calibre13">uiController</kbd> and <kbd class="calibre13">_GameMaster</kbd>. The <kbd class="calibre13">uiController</kbd> GameObject should have <kbd class="calibre13">UiController.cs</kbd> attached, and <kbd class="calibre13">_GameMaster</kbd> should have the following components attached: <kbd class="calibre13">GameMaster.cs</kbd> and an <kbd class="calibre13">AudioSource</kbd> component that will be used for the background music.</p>
<p class="calibre3">Have the <kbd class="calibre13">_GameMaster</kbd> GameObject selected in the <span class="calibre6">Hierarchy</span> window, and run the game. Select the <span class="calibre6">Start Game</span> button. This will load the character customization scene. The <kbd class="calibre13">_GameMaster</kbd> GameObject should still be selected. If not, go ahead and select it from the <span class="calibre6">Hierarchy</span> window, do some of the character customization, and click the <span class="calibre6">Save</span> button. Refer to the following screenshot:</p>
<div class="mce-root1"><img src="../images/00113.jpeg" class="calibre105"/></div>
<p class="calibre3">The first level should have been loaded with your character and the customization you have made to your character in the previous step. So visually, your character has retained all of the customization you have done, and from a data point of view, when you look at the <kbd class="calibre13">_GameMaster</kbd> GameObject in the <span class="calibre6">Inspector</span> window, you will notice that the data has been saved properly, as shown in the preceding screenshot.</p>
<p class="calibre3"/>
<p class="calibre3"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Summary</h1>
                
            
            <article>
                
<p class="calibre3">This chapter was mostly code. We enhanced the <kbd class="calibre13">GameMaster</kbd> class to handle the game settings and scene management. We began the chapter by making <kbd class="calibre13">GameMaster</kbd> handle the user interface, the player character data, and the game settings, which currently is just the volume for the background music.</p>
<p class="calibre3">We added a new UI element that displays the settings panel for the game. At the moment, it only contains the main volume control. Next, we added the necessary code in the <kbd class="calibre13">UiController</kbd> class and the <kbd class="calibre13">GameMaster</kbd> class to handle the display of the settings window, as well as the slider value passed from the UI component to <kbd class="calibre13">UiController</kbd> to the <kbd class="calibre13">GameMaster</kbd> class.</p>
<p class="calibre3">We also made the <kbd class="calibre13">GameMaster</kbd> class into a singleton. A singleton in software engineering is a design pattern that restricts the instantiation of a class to one object. This pattern fits perfectly for <kbd class="calibre13">GameMaster</kbd>, as we only need to have one instance of it active at any given time throughout the lifespan of the game.</p>
<p class="calibre3">We also looked at how to perform scene management. We defined a static class named <kbd class="calibre13">SceneName</kbd> that contains constant string variables identifying the scene references in our game.</p>
<p class="calibre3">We then took the next step to improve <kbd class="calibre13">GameMaster</kbd> and the internal structure for our code. We created a new class, called <kbd class="calibre13">GameLevelController.cs</kbd> that handles the scene management, which in turn is driven by <kbd class="calibre13">GameMaster</kbd>. We practically took the logic for level handling from within the <kbd class="calibre13">GameMaster</kbd> class, and reworked and improved it in the <kbd class="calibre13">GameLevelController</kbd> class.</p>
<p class="calibre3">Next we developed an <kbd class="calibre13">AudioController</kbd> class that basically manages the audio for our game. This class is also driven by <kbd class="calibre13">GameMaster</kbd>. By this time, <kbd class="calibre13">GameMaster</kbd> is a lean script that manages all of the other components.</p>
<p class="calibre3">The next big challenge was how to handle the player character data. Specifically, how to save the character customization data for the player character internally, after the player has customized the character. In order to save the data, we had to modify the <kbd class="calibre13">PlayerCharacter.cs</kbd> class.</p>
<p class="calibre3"/>
<p class="calibre3"/>
<p class="calibre3">We created several enumerations representing each part of the character that could be customized, such as the shoulder pad, the body type, the weapon type, the helmet type and so on. We used enumeration to make it easier to reference them within the code.</p>
<p class="calibre3">This approach forced us to make some modifications to the existing character customization setup that we implemented previously. We had to update the UI components to reflect the enumeration defined for each customizable type, and we also had to modify the <kbd class="calibre13">BarbarianCharacterCustomization.cs</kbd> class to handle the new changes.</p>
<p class="calibre3">The <kbd class="calibre13">BarbarianCharacterCustomization</kbd> class implemented a PC type variable to keep track of the customizations and finally pass the data along to <kbd class="calibre13">GameMaster</kbd>. During the process, we also improved the case handling of the <kbd class="calibre13">BarbarianCharacterCustomization</kbd> class for default values and so on.</p>
<p class="calibre3">Finally, we did a test run of the game to double-check everything worked as designed and implemented.</p>
<p class="calibre3">We have created a lot of code in this chapter. In the next chapter, we will start building our inventory system, and yes, that is going to involve more code!</p>


            </article>

            
        </section>
    </body></html>