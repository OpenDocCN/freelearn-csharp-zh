<html><head></head><body><div class="chapter" title="Chapter&#xA0;12.&#xA0;ALM &#x2013; App Stores and Publishing"><div class="titlepage"><div><div><h1 class="title"><a id="ch12"/>Chapter 12. ALM – App Stores and Publishing</h1></div></div></div><p>This chapter explains the processes related to app package preparation and release, which constitutes the last step of the application lifecycle. General information about application packages and bundles is followed by information about different release channels and release management tools. The chapter is divided into the following sections:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Release packages</li><li class="listitem" style="list-style-type: disc">Distribution options</li><li class="listitem" style="list-style-type: disc">Line of business apps</li></ul></div><div class="section" title="Release packages"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec70"/>Release packages</h1></div></div></div><p>On each Xamarin target platform, release<a class="indexterm" id="id696"/> packages differ in several ways from the development packages prepared during the development and testing phases. Release packages are optimized to take up less space and consume less resources in the runtime (both processing time and memory resources). They also do not contain symbol files<a class="indexterm" id="id697"/> or inter-process communication channels (such as <span class="strong"><strong>Java Debug Wire Protocol</strong></span> (<span class="strong"><strong>JDWP</strong></span>)) required for <span class="strong"><strong>just-in-time</strong></span> (<span class="strong"><strong>JIT</strong></span>) <a class="indexterm" id="id698"/>debugging. It is also important to mention that Xamarin.iOS and Xamarin.Android projects, once built for release, are virtually no different from applications built with native development tools.</p><p>In order to prepare the application for release, developers need to take several preparation steps before actually building the application. These steps differ slightly on each platform.</p><div class="section" title="Xamarin.Android app package (.apk)"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec142"/>Xamarin.Android app package (.apk)</h2></div></div></div><p>Developers preparing<a class="indexterm" id="id699"/> Xamarin.Android application<a class="indexterm" id="id700"/> release packages should follow a certain checklist to create an optimized package for release.</p><div class="section" title="Disabling debugging"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl3sec45"/>Disabling debugging</h3></div></div></div><p>The initial step of <a class="indexterm" id="id701"/>preparing a Xamarin.Android application for release is to disable the debugging channel, called Java Debug Wire Protocol, used by Xamarin tools or <code class="literal">adb</code> to communicate with the <span class="strong"><strong>Java Virtual Machine</strong></span> (<span class="strong"><strong>JVM</strong></span>). If not disabled, this channel can pose a security risk.</p><p>JDWP can be<a class="indexterm" id="id702"/> disabled by using either the application manifest or the <code class="literal">AssemblyInfo.cs</code> file. In order to disable debugging using the application manifest, the <code class="literal">android:debuggable</code> attribute needs to be set to <code class="literal">false</code> on the application node:</p><div class="informalexample"><pre class="programlisting">&lt;application android:label="Fibonnaci Calculator" 
              android:debuggable="false" 
              android:icon="@drawable/Icon"&gt;
&lt;/application&gt;</pre></div><p>The entry in the <code class="literal">AssemblyInfo.cs</code> looks similar:</p><div class="informalexample"><pre class="programlisting">[assembly: Application(Debuggable = false, BackupAgent = typeof(PreferencesBackupService))]</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip20"/>Tip</h3><p>Note that debug builds contain certain permissions, such as storage access and Internet usage, automatically enabled. Once the application is built with a release configuration, it is a good idea to run the application through another round of regression testing and, if necessary, modify the explicit permission declarations in the application manifest.</p></div></div></div><div class="section" title="Linking"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl3sec46"/>Linking</h3></div></div></div><p>During the development phase, application deployments generally contain the whole set of Xamarin.Android runtime assemblies (no linking). Linking is the process where only the required components <a class="indexterm" id="id703"/>are introduced into the application package to reduce the application package's size. A static analysis algorithm (that is, ahead-of-time compilation) is used <a class="indexterm" id="id704"/>during the linking process, in which the dependencies are identified and included in the bundle.</p><p>There are three available options that define which assemblies will be put through the process of linking:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>None</strong></span>: This is the<a class="indexterm" id="id705"/> default configuration value for debug builds. No linking is performed.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Sdk Assemblies Only</strong></span>: Only<a class="indexterm" id="id706"/> Xamarin.Android runtime assemblies are linked.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Sdk and User Assemblies</strong></span>: Both Xamarin.Android runtime assemblies and the application libraries are <a class="indexterm" id="id707"/>statically analyzed for code reach.<div class="mediaobject"><img alt="Linking" src="graphics/B04693_12_01.jpg"/><div class="caption"><p>Figure 1: Linker options</p></div></div></li></ul></div><p>In order to ensure<a class="indexterm" id="id708"/> that certain types and namespaces are included in the final package, even though they are not statically reachable, a simple public class declaration with public methods using the required types as parameters can create the necessary code reachability (see <code class="literal">LinkerPleaseInclude.cs</code>):</p><div class="informalexample"><pre class="programlisting">public class LinkerPleaseInclude
{
    public void Include(Activity act)
    {
        act.Title = act.Title + "";
    } 
}</pre></div><p>Linking certain types and methods can also be achieved using a link description file. In order to create a link description file, an XML file with the build action set to <code class="literal">LinkDescription</code> should be created in the Xamarin.Android project. The file schema for <code class="literal">LinkDescription</code> uses a simple declarative structure:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;linker&gt;
  &lt;assembly fullname="Mono.Android"&gt;
    &lt;type fullname="Android.App.Activity" &gt;
      &lt;method name="get_Title" /&gt;
      &lt;method name="set_Title" /&gt;
    &lt;/type&gt;
  &lt;/assembly&gt;
&lt;/linker&gt;</pre></div><p>Once the application<a class="indexterm" id="id709"/> is built and the package is exported, comparing the size of the signed <code class="literal">apk</code> packages for <code class="literal">None</code>, <code class="literal">Sdk</code>, and <code class="literal">All</code> assemblies shows a noticeable reduction in size:</p><div class="mediaobject"><img alt="Linking" src="graphics/B04693_12_02.jpg"/><div class="caption"><p>Figure 2: Android linker results</p></div></div><p>Just like the release build, after the linking step, it is highly advised to run another setup regression test to see if the application features are functioning as expected.</p></div><div class="section" title="Packing options"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl3sec47"/>Packing options</h3></div></div></div><p>Important application <a class="indexterm" id="id710"/>package-related configuration values can be found in the <span class="strong"><strong>Packaging</strong></span> section of the <span class="strong"><strong>Android Options</strong></span> tab of the <span class="strong"><strong>Project Properties</strong></span> page. In spite of the fact that most of the configuration values are disabled by default in a normal release build, they might be used for optimizing the release package in certain scenarios. <span class="strong"><strong>Use Shared Runtime</strong></span> and <span class="strong"><strong>Use Fast Deployment</strong></span> are, under normal circumstances, intended for debug builds and are used to increase the productivity of developers.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Bundle assemblies into native code</strong></span>: This option instructs the mono compiler to bundle the<a class="indexterm" id="id711"/> application assemblies into a native shared library as a security measure (only available with an Enterprise license).</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Generate one package (.apk) per selected ABI</strong></span>: Each selected <span class="strong"><strong>Application Binary Interface</strong></span> (<span class="strong"><strong>ABI</strong></span>) will cause<a class="indexterm" id="id712"/> the compiler to<a class="indexterm" id="id713"/> generate a separate package. For instance, if armeabi-v7a and x86 CPU architectures are selected, two application packages will be generated.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>AOT Compilation</strong></span> (experimental): Ahead-of-time compilation converts the application assemblies<a class="indexterm" id="id714"/> into native code to decrease the initialization time for the application while<a class="indexterm" id="id715"/> increasing the application package size (only available with Business or Enterprise licenses).</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Enable Multi-Dex</strong></span>: In order to work around the DEX method count limit, the Multi-Dex feature was<a class="indexterm" id="id716"/> introduced in the Android Lollipop (API 21) release and a retroactive support library was released for API levels 4 through 20. This option enables the use of multiple DEX files.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note40"/>Note</h3><p>Android application packages contain an executable bytecode file called the Dalvik Executable file (DEX). This file contains the compiled code used in the application runtime and has a limit of 64*210 (65536) methods referenced (including Android framework methods, library methods, and custom code introduced by the application).</p></div></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Enable ProGuard</strong></span>: ProGuard is another option that can help reduce the size of the application<a class="indexterm" id="id717"/> and the DEX declarations. For applications developed with a native toolset, ProGuard can also obfuscate the application code, but this option is currently not available for Xamarin.Android applications.</li></ul></div></div><div class="section" title="Packaging"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl3sec48"/>Packaging</h3></div></div></div><p>Once the preparation <a class="indexterm" id="id718"/>steps are complete, Xamarin.Android application packages can be created either with Visual Studio or Xamarin Studio. Xamarin Studio offers the option of archiving the builds so that they can be easily signed and pushed to available channels.</p><p>The application package can be archived using the <span class="strong"><strong>Archive for Publishing</strong></span> option in the project context menu. (Similarly, the <span class="strong"><strong>View Archives</strong></span> button can be used to access previous archives.) In the archives view, the selected application package can be signed and ready for store submission or ad-hoc (see <span class="emphasis"><em>Distribution options</em></span>) distribution.</p><div class="mediaobject"><img alt="Packaging" src="graphics/B04693_12_03.jpg"/><div class="caption"><p>Figure 3: Xamarin Studio package archives</p></div></div><p>Packages created<a class="indexterm" id="id719"/> with the <code class="literal">Export Android Package</code> option using Visual Studio are signed with the debug key. These packages should not, and in most cases cannot, be distributed through normal channels. In order to create the release-ready package, the unsigned package from the build directory should be located and the package should be signed using the <code class="literal">jarsigner</code> utility from Java SDK.</p></div></div><div class="section" title="Xamarin.iOS app bundle (.ipa)"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec143"/>Xamarin.iOS app bundle (.ipa)</h2></div></div></div><p>Before any iOS application <a class="indexterm" id="id720"/>can be published to the App Store, there are several configuration values that need to be configured and<a class="indexterm" id="id721"/> revised. More importantly, the build process should be configured as a release build and the package should be signed with a proper identity before it can be submitted through iTunes Connect.</p><div class="section" title="Build options"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl3sec49"/>Build options</h3></div></div></div><p>For a release <a class="indexterm" id="id722"/>build (ad-hoc or app-store), once the active build configuration is set, some of the values are automatically adjusted to the developers' convenience. For instance, options related to debugging such as <span class="strong"><strong>Enable Profiling</strong></span> and <span class="strong"><strong>Enable incremental builds</strong></span> are automatically disabled. These options, together with the <span class="strong"><strong>Enable Debugging</strong></span> option, produce larger application packages that are not valid for store submission.</p><p>Other than the debugging options, the supported CPU architectures must be carefully configured. While it is possible to combine the selections (such as ARMv7 + ARM64, as seen in the figure below), each architecture targets a certain iPhone or iPad model. ARMv6 was the initial CPU architecture that was used in iPhone 3G. This architecture is no longer supported by iOS compilers. Starting with iPhone 3GS, up until iPhone 5, including iPads, the CPU architecture used was ARMv7. ARMv7s and ARM64 were used in iPhone 5 and iPhone 5s respectively. iPhone 6 uses ARMv8, which is another 64-bit processor (that is, the build requirement would be ARM64).</p><div class="mediaobject"><img alt="Build options" src="graphics/B04693_12_04.jpg"/><div class="caption"><p>Figure 4: iOS build configuration</p></div></div><p><span class="strong"><strong>Low Level Virtual Machine</strong></span> (<span class="strong"><strong>LLVM</strong></span>) is the name of the set of tools/libraries designed for the compile-time optimization of programs written in various programming languages. It was<a class="indexterm" id="id723"/> released under an open source license. During the development phase, Xamarin tools only utilize mono compiler (<code class="literal">mtouch</code>). Mono compiler produces less optimized but more "accessible" binaries that make them possible to debug and diagnose. However, for release builds using LLVM, it can generate much more optimized results.</p><p>While LLVM provides both package size and runtime enhancements, the Thumb-2 instruction set is <a class="indexterm" id="id724"/>simply an executable size improvement. ARMv7 and ARMv7s processors use this compact instruction set. It can provide a significant reduction in the package size at the expense of slower execution time.</p></div><div class="section" title="Linking"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl3sec50"/>Linking</h3></div></div></div><p>Linking works in a similar way as in Xamarin.Android platform. In addition to arbitrary class creation with <a class="indexterm" id="id725"/>public methods to avoid certain classes being linked out, on Xamarin.iOS, <code class="literal">Preserve</code> attribute can be used on class declarations to inform the compiler about the necessity of a certain class and its members (such as <code class="literal">[Preserve(AllMembers = true)]</code>).</p></div><div class="section" title="Provisioning profile"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl3sec51"/>Provisioning profile</h3></div></div></div><p>Provisioning profiles <a class="indexterm" id="id726"/>are used to set up the entitlements and package signing information for iOS applications. In order to create a publishing-ready iOS package, users first need to create the application metadata on Apple's iOS provisioning portal.</p><p>On the provisioning portal, developers should first choose a unique application name and a bundle ID. These will be used to identify the application once it is published. Additionally, the App Services that are required by the application should be selected.</p><p>Other than the App ID, a distribution profile should be created for the application. In order to create the distribution profile, one would need to select the Provision-&gt;Distribution node on the application portal navigation tree. Using the <span class="strong"><strong>+</strong></span> button, a new distribution profile can be created. In the distribution profile wizard, the user need to select the distribution type (that is, <span class="strong"><strong>App Store</strong></span> or <span class="strong"><strong>Ad Hoc</strong></span>), select the App ID that was previously created, possible deployment devices, and a signing certificate (a signing certificate can be requested from Apple's Members Center).</p><p>Once the App ID and provisioning profile are created, the application metadata should be set up in the Xamarin.iOS project settings in the iOS <span class="strong"><strong>Application Settings</strong></span> section (<code class="literal">Info.plist</code> and <code class="literal">Entitlements.plist </code>files can also be directly configured).</p><p>Finally, the <span class="strong"><strong>Archive for Publishing</strong></span> button can be used to create the release package. Once the build is complete, the new package will be shown in the archives window. Selecting the correct application and using the <span class="strong"><strong>Sign and Distribute</strong></span> option will open the publishing wizard where the previously configured provisioning profile can be selected and applied to the current build package.</p></div></div><div class="section" title="Windows Phone app package (.appx)"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec144"/>Windows Phone app package (.appx)</h2></div></div></div><p>Windows Phone and <a class="indexterm" id="id727"/>Windows Store application<a class="indexterm" id="id728"/> packages are prepared using the available toolset for Windows app developers in Visual Studio. In the release preparation phase, Windows Phone applications do not require or interact with any Xamarin components.</p></div></div></div>
<div class="section" title="Distribution options"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec71"/>Distribution options</h1></div></div></div><p>Just like the beta builds, there<a class="indexterm" id="id729"/> are different distribution options for the release versions of Xamarin applications. Public app stores are the easiest and the most convenient way to distribute mobile applications, targeting the general public. On the other hand, private<a class="indexterm" id="id730"/> application distribution channels may be needed for enterprise application distribution scenarios.</p><div class="section" title="App store(s)"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec145"/>App store(s)</h2></div></div></div><p>For Xamarin.iOS and Windows Phone applications, the only official distribution stores are application stores maintained by Apple and Microsoft respectively. Each of these application stores has <a class="indexterm" id="id731"/>a well-defined submission flow involving both content validation (that is, whether the application meet the content guidelines) and technical validation (that is, does the application meets the quality criteria). It is highly advisable to read the appropriate application certification guidelines before submitting the release-ready package to either of these stores. In order to distribute applications using iTunes Connect tools and Apple App Store, developers need to apply for a developer account and pay an annual subscription fee. Windows App Store requires a developer account subscription, which at the moment is free of charge.</p><p>On the other hand, Android developers have a big pool of options as public app distribution channels. The most popular stores are the Google Play and Amazon App stores. Both of these stores allow developers to publish both paid and free applications.</p><p>The Google Play store serves as the official app store for the Android operating system. It was originally called the Android Market and later on merged with two other Google products, namely Google Music and Google eBookstore. The Google Play store requires developers to sign up with a small subscription fee before they can distribute applications. Security and quality testing is one of the most essential steps of the app certification process, which makes this store the most trusted among Android users.</p><p>On the other hand, the Amazon App store was initially created for Amazon Kindle Fire devices specifically, and yet it became the second biggest store for Android applications. Developers can sign up for a free developer account, and the revenue share model is the same as other popular stores (that is, 70% developer/30% store).</p><p>Other than the two biggest stores, there are other application stores for Android applications. The most intriguing app store provider is the F-Droid store, which focuses on free and open source software (FOSS) for the Android operating system. This store attracts many users since the store policy dictates that there is no tracking, advertising, or dependencies in distributed applications.</p></div><div class="section" title="Ad-hoc"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec146"/>Ad-hoc</h2></div></div></div><p>Ad-hoc distribution is the name given to the process by which application packages are distributed to users<a class="indexterm" id="id732"/> for testing or private use through various communication channels (such as shared storage, online sharing, e-mail, and so on).</p><p>This type of distribution was mentioned in the beta testing part of the previous chapter, but at times, applications built only for internal use can be distributed in this manner.</p><p>The ad-hoc distribution concept can be divided into two categories: signed and unsigned distribution. The official way<a class="indexterm" id="id733"/> of distributing application packages over the air is to digitally sign the application packages with a trusted certificate (that is, the signing identity should be created using the official channels such as signing certificate providers). Once the application package is digitally signed with a certificate from a trusted provider, the app can be sideloaded to mobile devices. Sideloading is the process of installing an app without using a public or private store.</p><p>If the application is signed by a self-signed certificate, the application publisher would simply be unidentifiable. In this type of scenario, either the owner of the device should allow applications to be installed from unknown sources (on Android and Windows 10 mobile devices) or the device should be developer unlocked (on Windows Phone) or jailbroken (on iOS). While unlocking a device is an official process on Windows Phone devices, jailbreaking violates the end-user license agreement for iOS.</p></div></div>
<div class="section" title="Line of Business apps"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec72"/>Line of Business apps</h1></div></div></div><p>Line of Business<a class="indexterm" id="id734"/> applications, or LOB apps, is a term generally used synonymously with enterprise applications. These applications are either developed in-house, or outsourced for the specific needs of a company. In other words, LOB apps can be categorized as business rather than consumer applications. They are generally domain-specific and target a small group with a specific need.</p><div class="section" title="Private channel distribution (Android)"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec147"/>Private channel distribution (Android)</h2></div></div></div><p>One way of <a class="indexterm" id="id735"/>distributing LOB applications built for Android platform is to use the Google Play private channels. Applications distributed through these channels are restricted to users of a specific domain. In order to use private channels, one needs to have a subscription to either Google Play for Work, Google Apps for Business, Education, or Government.</p><p>While app pricing and other distribution settings may still apply to these private apps, the testing and validation steps are skipped in the store submission process. App submissions can either be done by the owner of the channel or the permissions can be delegated to another user in the same domain.</p></div><div class="section" title="Apple Developer Enterprise Program"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec148"/>Apple Developer Enterprise Program</h2></div></div></div><p>The Apple Developer <a class="indexterm" id="id736"/>Enterprise Program is Apple's initiative to support companies to develop and distribute in-house applications. This<a class="indexterm" id="id737"/> program is only available for companies that exist as a legal entity (the D-U-N-S number is required). Once the organization is enrolled in the Enterprise Program, development and release management team members can be assigned roles, as well as digital certificates and<a class="indexterm" id="id738"/> provisioning profiles. However, these provisioning profiles cannot contain the App Store distribution method (that is, the only available provisioning profiles are in-house and ad-hoc).</p><div class="mediaobject"><img alt="Apple Developer Enterprise Program" src="graphics/B04693_12_05.jpg"/><div class="caption"><p>Figure 5: Provisioning profile for Apple Developer Enterprise Program</p></div></div><p>The applications built under the enterprise program can be distributed through native or third-party <a class="indexterm" id="id739"/>
<span class="strong"><strong>Mobile Device Management</strong></span> (<span class="strong"><strong>MDM</strong></span>) solutions, as well as ad-hoc packages.</p></div><div class="section" title="Windows Phone private distribution"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec149"/>Windows Phone private distribution</h2></div></div></div><p>Windows Phone applications<a class="indexterm" id="id740"/> can be developed and distributed for in-house utilization, using the application signing certificate purchased from Symantec (Symantec is currently the only provider of this type of certificate). Using the mobile signing certificate, application packages can signed and distributed through MDMs or sideloaded into company devices.</p><p>Most MDM providers, such as Microsoft Intune, come equipped with a company store application that can be used to provide applications for company devices. Device management systems also make it possible to install the company applications directly for domain users.</p><p>It is also possible to install the signing certificate on devices, which will benefit from in-house applications and distribute applications through custom company hub applications.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec73"/>Summary</h1></div></div></div><p>In this chapter, we briefly went over the package preparation process for Xamarin.Android and Xamarin.iOS applications (and also Windows Phone). As you can see, preparing the release package is a little more complicated then pressing the <span class="strong"><strong>Debug</strong></span> button on the development IDE of choice. However, each of these platforms have well-defined application certification guidelines and online resources.</p><p>Once the release packages are prepared, it is up to the developer to choose between different distribution options, including but not limited to, the public and private stores that can be used to publish the release packages. Public store applications can be delivered to the general public, while private distribution channels or ad-hoc deployments, involving sideloading and MDMs, can be used for LOB applications.</p></div></body></html>