<html xml:lang="en-US" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
<meta charset="utf-8"/>
<meta content="packt" name="generator"/>
<title>11 Structural Patterns</title>
<link href="../styles/stylesheet1.css" rel="stylesheet" type="text/css"/>
<link href="../styles/stylesheet2.css" rel="stylesheet" type="text/css"/>
<!-- kobo-style -->
<style id="koboSpanStyle" type="text/css" xmlns="http://www.w3.org/1999/xhtml">.koboSpan { -webkit-text-combine: inherit; }</style>
</head>
<body>
<section class="level1 pkt" data-number="12" id="structural-patterns">
<h1 data-number="12"><span class="koboSpan" id="kobo.1.1" xmlns="http://www.w3.org/1999/xhtml">11 Structural Patterns</span></h1>
<section class="level2" data-number="12.1" id="before-you-begin-join-our-book-community-on-discord-10">
<h2 data-number="12.1"><span class="koboSpan" id="kobo.2.1" xmlns="http://www.w3.org/1999/xhtml">Before you begin: Join our book community on Discord</span></h2>
<p><span class="koboSpan" id="kobo.3.1" xmlns="http://www.w3.org/1999/xhtml">Give your feedback straight to the author himself and chat to other early readers on our Discord server (find the "architecting-aspnet-core-apps-3e" channel under EARLY ACCESS SUBSCRIPTION).</span></p>
<p><a href="https://packt.link/EarlyAccess"><span class="koboSpan" id="kobo.4.1" xmlns="http://www.w3.org/1999/xhtml">https://packt.link/EarlyAccess</span></a></p>
<p><span class="koboSpan" id="kobo.5.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Qr code Description automatically generated" src="../media/file47.png" style="width:10em"/></span></p>
<p><span class="koboSpan" id="kobo.6.1" xmlns="http://www.w3.org/1999/xhtml">This chapter explores four design patterns from the well-known Gang of Four (GoF). </span><span class="koboSpan" id="kobo.6.2" xmlns="http://www.w3.org/1999/xhtml">We use Structural patterns to build and organize complex object hierarchies in a maintainable fashion. </span><span class="koboSpan" id="kobo.6.3" xmlns="http://www.w3.org/1999/xhtml">They allow us to dynamically add behaviors to existing classes, whether we designed the initial system this way or as an afterthought that emerges out of necessity later in the program’s lifecycle. </span><span class="koboSpan" id="kobo.6.4" xmlns="http://www.w3.org/1999/xhtml">Structural patterns promote reusability and enhance the overall flexibility of the system.In this chapter, we cover the following topics:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.7.1" xmlns="http://www.w3.org/1999/xhtml">Implementing the Decorator design pattern</span></li>
<li><span class="koboSpan" id="kobo.8.1" xmlns="http://www.w3.org/1999/xhtml">Implementing the Composite design pattern</span></li>
<li><span class="koboSpan" id="kobo.9.1" xmlns="http://www.w3.org/1999/xhtml">Implementing the Adapter design pattern</span></li>
<li><span class="koboSpan" id="kobo.10.1" xmlns="http://www.w3.org/1999/xhtml">Implementing the Façade design pattern</span></li>
</ul>
<p><span class="koboSpan" id="kobo.11.1" xmlns="http://www.w3.org/1999/xhtml">The first two patterns help us extend a class dynamically and efficiently manage a complex object structure. </span><span class="koboSpan" id="kobo.11.2" xmlns="http://www.w3.org/1999/xhtml">The last two help us adapt an interface to another or shield a complex system with a simple interface.Let's dive into unlocking the power of structural patterns!</span></p>
</section>
<section class="level2" data-number="12.2" id="implementing-the-decorator-design-pattern">
<h2 data-number="12.2"><span class="koboSpan" id="kobo.12.1" xmlns="http://www.w3.org/1999/xhtml">Implementing the Decorator design pattern</span></h2>
<p><span class="koboSpan" id="kobo.13.1" xmlns="http://www.w3.org/1999/xhtml">The Decorator Pattern allows us to dynamically add new functionality to an object by wrapping it with one or more decorator objects. </span><span class="koboSpan" id="kobo.13.2" xmlns="http://www.w3.org/1999/xhtml">This pattern follows the Open-Closed principle, allowing us to add additional behaviors to an object at runtime without modifying its original code. </span><span class="koboSpan" id="kobo.13.3" xmlns="http://www.w3.org/1999/xhtml">This pattern enables us to separate responsibilities into multiple smaller pieces. </span><span class="koboSpan" id="kobo.13.4" xmlns="http://www.w3.org/1999/xhtml">It is a simple but powerful pattern. </span><span class="koboSpan" id="kobo.13.5" xmlns="http://www.w3.org/1999/xhtml">In this section, we explore how to implement this pattern in the traditional way and how to leverage an open-source tool named </span><strong><span class="koboSpan" id="kobo.14.1" xmlns="http://www.w3.org/1999/xhtml">Scrutor</span></strong><span class="koboSpan" id="kobo.15.1" xmlns="http://www.w3.org/1999/xhtml"> to help us create powerful dependency injection-ready decorators.</span></p>
<section class="level3" data-number="12.2.1" id="goal-7">
<h3 data-number="12.2.1"><span class="koboSpan" id="kobo.16.1" xmlns="http://www.w3.org/1999/xhtml">Goal</span></h3>
<p><span class="koboSpan" id="kobo.17.1" xmlns="http://www.w3.org/1999/xhtml">The decorator aims to extend an existing object at runtime without changing its code. </span><span class="koboSpan" id="kobo.17.2" xmlns="http://www.w3.org/1999/xhtml">Moreover, the decorated object should remain unaware of the decoration process, making this approach an excellent fit for complex or long-lasting systems that necessitate evolution. </span><span class="koboSpan" id="kobo.17.3" xmlns="http://www.w3.org/1999/xhtml">This pattern fits systems of all sizes.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.18.1" xmlns="http://www.w3.org/1999/xhtml">I often use this pattern to add flexibility and create adaptability to a program for next to no cost. </span><span class="koboSpan" id="kobo.18.2" xmlns="http://www.w3.org/1999/xhtml">In addition, small classes are easier to test, so the Decorator pattern adds ease of testability into the mix, making it worth mastering.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.19.1" xmlns="http://www.w3.org/1999/xhtml">The Decorator pattern makes it easier to encapsulate responsibilities into multiple classes, instead of packing multiple responsibilities inside a single class. </span><span class="koboSpan" id="kobo.19.2" xmlns="http://www.w3.org/1999/xhtml">Having multiple classes with a single responsibility makes the system easier to manage.</span></p>
</section>
<section class="level3" data-number="12.2.2" id="design-7">
<h3 data-number="12.2.2"><span class="koboSpan" id="kobo.20.1" xmlns="http://www.w3.org/1999/xhtml">Design</span></h3>
<p><span class="koboSpan" id="kobo.21.1" xmlns="http://www.w3.org/1999/xhtml">A </span><strong><span class="koboSpan" id="kobo.22.1" xmlns="http://www.w3.org/1999/xhtml">decorator</span></strong><span class="koboSpan" id="kobo.23.1" xmlns="http://www.w3.org/1999/xhtml"> class must implement and use the interface the </span><strong><span class="koboSpan" id="kobo.24.1" xmlns="http://www.w3.org/1999/xhtml">decorated</span></strong><span class="koboSpan" id="kobo.25.1" xmlns="http://www.w3.org/1999/xhtml"> class implements. </span><span class="koboSpan" id="kobo.25.2" xmlns="http://www.w3.org/1999/xhtml">Let’s see this step by step, starting with a non-decorated class design:</span></p>
<figure>
<span class="koboSpan" id="kobo.26.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 11.1: A class diagram representing the ComponentA class implementing the IComponent interface" src="../media/file48.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.27.1" xmlns="http://www.w3.org/1999/xhtml">Figure 11.1: A class diagram representing the ComponentA class implementing the IComponent interface</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.28.1" xmlns="http://www.w3.org/1999/xhtml">In the preceding diagram, we have the following components:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.29.1" xmlns="http://www.w3.org/1999/xhtml">A client that calls the </span><code><span class="koboSpan" id="kobo.30.1" xmlns="http://www.w3.org/1999/xhtml">Operation()</span></code><span class="koboSpan" id="kobo.31.1" xmlns="http://www.w3.org/1999/xhtml"> method of the </span><code><span class="koboSpan" id="kobo.32.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.33.1" xmlns="http://www.w3.org/1999/xhtml"> interface.</span></li>
<li><code><span class="koboSpan" id="kobo.34.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.35.1" xmlns="http://www.w3.org/1999/xhtml">, which implements the </span><code><span class="koboSpan" id="kobo.36.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.37.1" xmlns="http://www.w3.org/1999/xhtml"> interface.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.38.1" xmlns="http://www.w3.org/1999/xhtml">This translates into the following sequence diagram:</span></p>
<figure>
<span class="koboSpan" id="kobo.39.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 11.2: A sequence diagram showing a consumer calling the Operation method of the ComponentA class" src="../media/file49.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.40.1" xmlns="http://www.w3.org/1999/xhtml">Figure 11.2: A sequence diagram showing a consumer calling the Operation method of the ComponentA class</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.41.1" xmlns="http://www.w3.org/1999/xhtml">Now, say that we want to add a behavior to </span><code><span class="koboSpan" id="kobo.42.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.43.1" xmlns="http://www.w3.org/1999/xhtml">, but only in some cases. </span><span class="koboSpan" id="kobo.43.2" xmlns="http://www.w3.org/1999/xhtml">In other cases, we want to keep the initial behavior. </span><span class="koboSpan" id="kobo.43.3" xmlns="http://www.w3.org/1999/xhtml">To do so, we could choose the Decorator pattern and implement it as follows:</span></p>
<figure>
<span class="koboSpan" id="kobo.44.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 11.3: Decorator class diagram" src="../media/file50.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.45.1" xmlns="http://www.w3.org/1999/xhtml">Figure 11.3: Decorator class diagram</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.46.1" xmlns="http://www.w3.org/1999/xhtml">Instead of modifying the </span><code><span class="koboSpan" id="kobo.47.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.48.1" xmlns="http://www.w3.org/1999/xhtml"> class, we created </span><code><span class="koboSpan" id="kobo.49.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorA</span></code><span class="koboSpan" id="kobo.50.1" xmlns="http://www.w3.org/1999/xhtml">, which also implements the </span><code><span class="koboSpan" id="kobo.51.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.52.1" xmlns="http://www.w3.org/1999/xhtml"> interface. </span><span class="koboSpan" id="kobo.52.2" xmlns="http://www.w3.org/1999/xhtml">This way, the </span><code><span class="koboSpan" id="kobo.53.1" xmlns="http://www.w3.org/1999/xhtml">Client</span></code><span class="koboSpan" id="kobo.54.1" xmlns="http://www.w3.org/1999/xhtml"> object can use an instance of </span><code><span class="koboSpan" id="kobo.55.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorA</span></code><span class="koboSpan" id="kobo.56.1" xmlns="http://www.w3.org/1999/xhtml"> instead of </span><code><span class="koboSpan" id="kobo.57.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.58.1" xmlns="http://www.w3.org/1999/xhtml"> and leverage the new behavior without impacting the other consumers of </span><code><span class="koboSpan" id="kobo.59.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.60.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.60.2" xmlns="http://www.w3.org/1999/xhtml">Then, to avoid rewriting the whole component, an implementation of the </span><code><span class="koboSpan" id="kobo.61.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.62.1" xmlns="http://www.w3.org/1999/xhtml"> interface (say </span><code><span class="koboSpan" id="kobo.63.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.64.1" xmlns="http://www.w3.org/1999/xhtml">) is injected when creating a new </span><code><span class="koboSpan" id="kobo.65.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorA</span></code><span class="koboSpan" id="kobo.66.1" xmlns="http://www.w3.org/1999/xhtml"> instance (constructor injection). </span><span class="koboSpan" id="kobo.66.2" xmlns="http://www.w3.org/1999/xhtml">This new instance is stored in the </span><code><span class="koboSpan" id="kobo.67.1" xmlns="http://www.w3.org/1999/xhtml">component</span></code><span class="koboSpan" id="kobo.68.1" xmlns="http://www.w3.org/1999/xhtml"> field and used by the </span><code><span class="koboSpan" id="kobo.69.1" xmlns="http://www.w3.org/1999/xhtml">Operation()</span></code><span class="koboSpan" id="kobo.70.1" xmlns="http://www.w3.org/1999/xhtml"> method (implicitly using the </span><strong><span class="koboSpan" id="kobo.71.1" xmlns="http://www.w3.org/1999/xhtml">Strategy</span></strong><span class="koboSpan" id="kobo.72.1" xmlns="http://www.w3.org/1999/xhtml"> pattern).We can translate the updated sequence like so:</span></p>
<figure>
<span class="koboSpan" id="kobo.73.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 11.4: Decorator sequence diagram" src="../media/file51.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.74.1" xmlns="http://www.w3.org/1999/xhtml">Figure 11.4: Decorator sequence diagram</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.75.1" xmlns="http://www.w3.org/1999/xhtml">In the preceding diagram, instead of calling </span><code><span class="koboSpan" id="kobo.76.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.77.1" xmlns="http://www.w3.org/1999/xhtml"> directly, </span><code><span class="koboSpan" id="kobo.78.1" xmlns="http://www.w3.org/1999/xhtml">Client</span></code><span class="koboSpan" id="kobo.79.1" xmlns="http://www.w3.org/1999/xhtml"> calls </span><code><span class="koboSpan" id="kobo.80.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorA</span></code><span class="koboSpan" id="kobo.81.1" xmlns="http://www.w3.org/1999/xhtml">, which in turn calls </span><code><span class="koboSpan" id="kobo.82.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.83.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.83.2" xmlns="http://www.w3.org/1999/xhtml">Finally, </span><code><span class="koboSpan" id="kobo.84.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorA</span></code><span class="koboSpan" id="kobo.85.1" xmlns="http://www.w3.org/1999/xhtml"> does some postprocessing by calling its private method, </span><code><span class="koboSpan" id="kobo.86.1" xmlns="http://www.w3.org/1999/xhtml">AddBehaviorA()</span></code><span class="koboSpan" id="kobo.87.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.88.1" xmlns="http://www.w3.org/1999/xhtml">Nothing from the Decorator pattern limits us from doing preprocessing, postprocessing, wrapping the decorated class’s call (the </span><code><span class="koboSpan" id="kobo.89.1" xmlns="http://www.w3.org/1999/xhtml">Operation</span></code><span class="koboSpan" id="kobo.90.1" xmlns="http://www.w3.org/1999/xhtml"> method in this example) with some logic (like an </span><code><span class="koboSpan" id="kobo.91.1" xmlns="http://www.w3.org/1999/xhtml">if</span></code><span class="koboSpan" id="kobo.92.1" xmlns="http://www.w3.org/1999/xhtml"> statement or a </span><code><span class="koboSpan" id="kobo.93.1" xmlns="http://www.w3.org/1999/xhtml">try</span></code><span class="koboSpan" id="kobo.94.1" xmlns="http://www.w3.org/1999/xhtml">-</span><code><span class="koboSpan" id="kobo.95.1" xmlns="http://www.w3.org/1999/xhtml">catch</span></code><span class="koboSpan" id="kobo.96.1" xmlns="http://www.w3.org/1999/xhtml">), or all of that combined. </span><span class="koboSpan" id="kobo.96.2" xmlns="http://www.w3.org/1999/xhtml">The use of adding a postprocessing behavior is only an example.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.97.1" xmlns="http://www.w3.org/1999/xhtml">To show you how powerful the Decorator pattern is before we jump into the code, know this: we can chain decorators! </span><span class="koboSpan" id="kobo.97.2" xmlns="http://www.w3.org/1999/xhtml">Since our decorator depends on the interface (not the implementation), we could inject another decorator, let’s call it </span><code><span class="koboSpan" id="kobo.98.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorB</span></code><span class="koboSpan" id="kobo.99.1" xmlns="http://www.w3.org/1999/xhtml">, inside </span><code><span class="koboSpan" id="kobo.100.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorA</span></code><span class="koboSpan" id="kobo.101.1" xmlns="http://www.w3.org/1999/xhtml"> (or vice versa). </span><span class="koboSpan" id="kobo.101.2" xmlns="http://www.w3.org/1999/xhtml">We could then create a long chain of rules that decorate one another, leading to a very powerful yet simple design.Let’s take a look at the following class diagram, which represents our chaining example:</span></p>
<figure>
<span class="koboSpan" id="kobo.102.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 11.5: Decorator class diagram, including two decorators" src="../media/file52.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.103.1" xmlns="http://www.w3.org/1999/xhtml">Figure 11.5: Decorator class diagram, including two decorators</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.104.1" xmlns="http://www.w3.org/1999/xhtml">Here, we created the </span><code><span class="koboSpan" id="kobo.105.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorB</span></code><span class="koboSpan" id="kobo.106.1" xmlns="http://www.w3.org/1999/xhtml"> class, which looks very similar to </span><code><span class="koboSpan" id="kobo.107.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorA</span></code><span class="koboSpan" id="kobo.108.1" xmlns="http://www.w3.org/1999/xhtml"> but has a private </span><code><span class="koboSpan" id="kobo.109.1" xmlns="http://www.w3.org/1999/xhtml">AddBehaviorB()</span></code><span class="koboSpan" id="kobo.110.1" xmlns="http://www.w3.org/1999/xhtml"> method instead of </span><code><span class="koboSpan" id="kobo.111.1" xmlns="http://www.w3.org/1999/xhtml">AddBehaviorA()</span></code><span class="koboSpan" id="kobo.112.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.113.1" xmlns="http://www.w3.org/1999/xhtml">How we implement the decorator logic is irrelevant to the pattern, so I excluded the </span><code><span class="koboSpan" id="kobo.114.1" xmlns="http://www.w3.org/1999/xhtml">AddBehaviorA()</span></code><span class="koboSpan" id="kobo.115.1" xmlns="http://www.w3.org/1999/xhtml"> method from </span><em><span class="koboSpan" id="kobo.116.1" xmlns="http://www.w3.org/1999/xhtml">Figure 9.3</span></em><span class="koboSpan" id="kobo.117.1" xmlns="http://www.w3.org/1999/xhtml"> to show you only the pattern. </span><span class="koboSpan" id="kobo.117.2" xmlns="http://www.w3.org/1999/xhtml">However, I added it to </span><em><span class="koboSpan" id="kobo.118.1" xmlns="http://www.w3.org/1999/xhtml">Figure 9.5</span></em><span class="koboSpan" id="kobo.119.1" xmlns="http://www.w3.org/1999/xhtml"> to clarify the idea behind having a second decorator.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.120.1" xmlns="http://www.w3.org/1999/xhtml">Let’s take a look at the sequence diagram for this:</span></p>
<figure>
<span class="koboSpan" id="kobo.121.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 11.6: Sequence diagram of two nested decorators" src="../media/file53.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.122.1" xmlns="http://www.w3.org/1999/xhtml">Figure 11.6: Sequence diagram of two nested decorators</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.123.1" xmlns="http://www.w3.org/1999/xhtml">With this, we are beginning to see the power of decorators. </span><span class="koboSpan" id="kobo.123.2" xmlns="http://www.w3.org/1999/xhtml">In the preceding diagram, we can assess that the behaviors of </span><code><span class="koboSpan" id="kobo.124.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.125.1" xmlns="http://www.w3.org/1999/xhtml"> have been changed twice without </span><code><span class="koboSpan" id="kobo.126.1" xmlns="http://www.w3.org/1999/xhtml">Client</span></code><span class="koboSpan" id="kobo.127.1" xmlns="http://www.w3.org/1999/xhtml"> knowing about it. </span><span class="koboSpan" id="kobo.127.2" xmlns="http://www.w3.org/1999/xhtml">All those classes are unaware of the next </span><code><span class="koboSpan" id="kobo.128.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.129.1" xmlns="http://www.w3.org/1999/xhtml"> in the chain. </span><span class="koboSpan" id="kobo.129.2" xmlns="http://www.w3.org/1999/xhtml">They don’t even know that they are being decorated. </span><span class="koboSpan" id="kobo.129.3" xmlns="http://www.w3.org/1999/xhtml">They only play their role in the plan—that’s all.It is also important to note that the decorator’s power resides in its dependency on the interface, not on an implementation, making it reusable. </span><span class="koboSpan" id="kobo.129.4" xmlns="http://www.w3.org/1999/xhtml">Based on that fact, we could swap </span><code><span class="koboSpan" id="kobo.130.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorA</span></code><span class="koboSpan" id="kobo.131.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.132.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorB</span></code><span class="koboSpan" id="kobo.133.1" xmlns="http://www.w3.org/1999/xhtml"> to invert the order the new behaviors are applied without touching the code itself. </span><span class="koboSpan" id="kobo.133.2" xmlns="http://www.w3.org/1999/xhtml">We could also apply the same decorator (say </span><code><span class="koboSpan" id="kobo.134.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorC</span></code><span class="koboSpan" id="kobo.135.1" xmlns="http://www.w3.org/1999/xhtml">) to multiple </span><code><span class="koboSpan" id="kobo.136.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.137.1" xmlns="http://www.w3.org/1999/xhtml"> implementations, like decorating both </span><code><span class="koboSpan" id="kobo.138.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorA</span></code><span class="koboSpan" id="kobo.139.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.140.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorB</span></code><span class="koboSpan" id="kobo.141.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.141.2" xmlns="http://www.w3.org/1999/xhtml">A decorator could even decorate itself.Let’s now dig into some code.</span></p>
</section>
<section class="level3" data-number="12.2.3" id="project-adding-behaviors">
<h3 data-number="12.2.3"><span class="koboSpan" id="kobo.142.1" xmlns="http://www.w3.org/1999/xhtml">Project – Adding behaviors</span></h3>
<p><span class="koboSpan" id="kobo.143.1" xmlns="http://www.w3.org/1999/xhtml">Let's implement the previous example to help visualize the Decorator pattern, which adds some arbitrary behaviors. </span><span class="koboSpan" id="kobo.143.2" xmlns="http://www.w3.org/1999/xhtml">Each </span><code><span class="koboSpan" id="kobo.144.1" xmlns="http://www.w3.org/1999/xhtml">Operation()</span></code><span class="koboSpan" id="kobo.145.1" xmlns="http://www.w3.org/1999/xhtml"> method returns a string that is then outputted to the response stream. </span><span class="koboSpan" id="kobo.145.2" xmlns="http://www.w3.org/1999/xhtml">It is not fancy but visually shows how the pattern works.First, let’s look at the </span><code><span class="koboSpan" id="kobo.146.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.147.1" xmlns="http://www.w3.org/1999/xhtml"> interface:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.148.1" xmlns="http://www.w3.org/1999/xhtml">public interface IComponent
{
    string Operation();
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.149.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.150.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.151.1" xmlns="http://www.w3.org/1999/xhtml"> interface only states that an implementation should have an </span><code><span class="koboSpan" id="kobo.152.1" xmlns="http://www.w3.org/1999/xhtml">Operation()</span></code><span class="koboSpan" id="kobo.153.1" xmlns="http://www.w3.org/1999/xhtml"> method that returns a </span><code><span class="koboSpan" id="kobo.154.1" xmlns="http://www.w3.org/1999/xhtml">string</span></code><span class="koboSpan" id="kobo.155.1" xmlns="http://www.w3.org/1999/xhtml">.Next, let’s look at the </span><code><span class="koboSpan" id="kobo.156.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.157.1" xmlns="http://www.w3.org/1999/xhtml"> class:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.158.1" xmlns="http://www.w3.org/1999/xhtml">public class ComponentA : IComponent
{
    public string Operation()
    {
        return "Hello from ComponentA";
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.159.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.160.1" xmlns="http://www.w3.org/1999/xhtml">Operation()</span></code><span class="koboSpan" id="kobo.161.1" xmlns="http://www.w3.org/1999/xhtml"> method of the </span><code><span class="koboSpan" id="kobo.162.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.163.1" xmlns="http://www.w3.org/1999/xhtml"> class returns a literal string.Now that we described the first pieces, let’s look at the consumer:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.164.1" xmlns="http://www.w3.org/1999/xhtml">var builder = WebApplication.CreateBuilder(args);
builder.Services.AddSingleton&lt;IComponent, ComponentA&gt;();
var app = builder.Build();
app.MapGet("/", (IComponent component) =&gt; component.Operation());
app.Run();</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.165.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code><span class="koboSpan" id="kobo.166.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.167.1" xmlns="http://www.w3.org/1999/xhtml"> file above, we register </span><code><span class="koboSpan" id="kobo.168.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.169.1" xmlns="http://www.w3.org/1999/xhtml"> as the implementation of </span><code><span class="koboSpan" id="kobo.170.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.171.1" xmlns="http://www.w3.org/1999/xhtml">, with a singleton lifetime. </span><span class="koboSpan" id="kobo.171.2" xmlns="http://www.w3.org/1999/xhtml">We then inject an </span><code><span class="koboSpan" id="kobo.172.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.173.1" xmlns="http://www.w3.org/1999/xhtml"> implementation when an HTTP request hits the </span><code><span class="koboSpan" id="kobo.174.1" xmlns="http://www.w3.org/1999/xhtml">/</span></code><span class="koboSpan" id="kobo.175.1" xmlns="http://www.w3.org/1999/xhtml"> endpoint. </span><span class="koboSpan" id="kobo.175.2" xmlns="http://www.w3.org/1999/xhtml">The delegate then calls the </span><code><span class="koboSpan" id="kobo.176.1" xmlns="http://www.w3.org/1999/xhtml">Operation()</span></code><span class="koboSpan" id="kobo.177.1" xmlns="http://www.w3.org/1999/xhtml"> method and outputs the result to the response.At this point, running the application results in the following response:</span></p>
<div class="C0-SHConPACKT">
<pre><code><span class="koboSpan" id="kobo.178.1" xmlns="http://www.w3.org/1999/xhtml">Hello from ComponentA</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.179.1" xmlns="http://www.w3.org/1999/xhtml">So far, it's pretty simple; the client calls the endpoint, the container injects an instance of the </span><code><span class="koboSpan" id="kobo.180.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.181.1" xmlns="http://www.w3.org/1999/xhtml"> class into the endpoint delegate, then the endpoint returns the results of </span><code><span class="koboSpan" id="kobo.182.1" xmlns="http://www.w3.org/1999/xhtml">Operation</span></code><span class="koboSpan" id="kobo.183.1" xmlns="http://www.w3.org/1999/xhtml"> method to the client.Next, we add the first decorator.</span></p>
<section class="level4" data-number="12.2.3.1" id="decoratora">
<h4 data-number="12.2.3.1"><span class="koboSpan" id="kobo.184.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorA</span></h4>
<p><span class="koboSpan" id="kobo.185.1" xmlns="http://www.w3.org/1999/xhtml">Here, we want to modify the response without touching the code of the </span><code><span class="koboSpan" id="kobo.186.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.187.1" xmlns="http://www.w3.org/1999/xhtml"> class. </span><span class="koboSpan" id="kobo.187.2" xmlns="http://www.w3.org/1999/xhtml">To do so, we chose to create a decorator named </span><code><span class="koboSpan" id="kobo.188.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorA</span></code><span class="koboSpan" id="kobo.189.1" xmlns="http://www.w3.org/1999/xhtml"> that wraps the </span><code><span class="koboSpan" id="kobo.190.1" xmlns="http://www.w3.org/1999/xhtml">Operation()</span></code><span class="koboSpan" id="kobo.191.1" xmlns="http://www.w3.org/1999/xhtml"> result into a </span><code><span class="koboSpan" id="kobo.192.1" xmlns="http://www.w3.org/1999/xhtml">&lt;DecoratorA&gt;</span></code><span class="koboSpan" id="kobo.193.1" xmlns="http://www.w3.org/1999/xhtml"> tag:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.194.1" xmlns="http://www.w3.org/1999/xhtml">public class DecoratorA : IComponent
{
    private readonly IComponent _component;
    public DecoratorA(IComponent component)
    {
        _component = component ?? </span><span class="koboSpan" id="kobo.194.2" xmlns="http://www.w3.org/1999/xhtml">throw new ArgumentNullException(nameof(component));
    }
    public string Operation()
    {
        var result = _component.Operation();
        return $"&lt;DecoratorA&gt;{result}&lt;/DecoratorA&gt;";
    }
}</span></code></pre>
</div>
<p><code><span class="koboSpan" id="kobo.195.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorA</span></code><span class="koboSpan" id="kobo.196.1" xmlns="http://www.w3.org/1999/xhtml"> implements and depends on the </span><code><span class="koboSpan" id="kobo.197.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.198.1" xmlns="http://www.w3.org/1999/xhtml"> interface. </span><span class="koboSpan" id="kobo.198.2" xmlns="http://www.w3.org/1999/xhtml">It uses the injected </span><code><span class="koboSpan" id="kobo.199.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.200.1" xmlns="http://www.w3.org/1999/xhtml"> implementation in its </span><code><span class="koboSpan" id="kobo.201.1" xmlns="http://www.w3.org/1999/xhtml">Operation()</span></code><span class="koboSpan" id="kobo.202.1" xmlns="http://www.w3.org/1999/xhtml"> method and wraps its result in an HTML-like (XML) tag.Now that we have a decorator, we need to tell the IoC container to send an instance of </span><code><span class="koboSpan" id="kobo.203.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorA</span></code><span class="koboSpan" id="kobo.204.1" xmlns="http://www.w3.org/1999/xhtml"> instead of </span><code><span class="koboSpan" id="kobo.205.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.206.1" xmlns="http://www.w3.org/1999/xhtml"> when injecting an </span><code><span class="koboSpan" id="kobo.207.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.208.1" xmlns="http://www.w3.org/1999/xhtml"> interface.</span><code><span class="koboSpan" id="kobo.209.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorA</span></code><span class="koboSpan" id="kobo.210.1" xmlns="http://www.w3.org/1999/xhtml"> should decorate </span><code><span class="koboSpan" id="kobo.211.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.212.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.212.2" xmlns="http://www.w3.org/1999/xhtml">More precisely, the container should inject an instance of the </span><code><span class="koboSpan" id="kobo.213.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.214.1" xmlns="http://www.w3.org/1999/xhtml"> class into the </span><code><span class="koboSpan" id="kobo.215.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorA</span></code><span class="koboSpan" id="kobo.216.1" xmlns="http://www.w3.org/1999/xhtml"> class.To achieve this, we could register it as follows:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.217.1" xmlns="http://www.w3.org/1999/xhtml">builder.Services.AddSingleton&lt;IComponent&gt;(serviceProvider =&gt; new DecoratorA(new ComponentA()));</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.218.1" xmlns="http://www.w3.org/1999/xhtml">Here, we are telling ASP.NET Core to inject an instance of </span><code><span class="koboSpan" id="kobo.219.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorA</span></code><span class="koboSpan" id="kobo.220.1" xmlns="http://www.w3.org/1999/xhtml"> that decorates an instance of </span><code><span class="koboSpan" id="kobo.221.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.222.1" xmlns="http://www.w3.org/1999/xhtml"> when injecting an </span><code><span class="koboSpan" id="kobo.223.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.224.1" xmlns="http://www.w3.org/1999/xhtml"> interface. </span><span class="koboSpan" id="kobo.224.2" xmlns="http://www.w3.org/1999/xhtml">When we run the application, we should see the following result in the browser:</span></p>
<div class="C0-SHConPACKT">
<pre><code><span class="koboSpan" id="kobo.225.1" xmlns="http://www.w3.org/1999/xhtml">&lt;DecoratorA&gt;Hello from ComponentA&lt;/DecoratorA&gt;</span></code></pre>
</div>
<blockquote>
<p><span class="koboSpan" id="kobo.226.1" xmlns="http://www.w3.org/1999/xhtml">You may have noticed a few </span><code><span class="koboSpan" id="kobo.227.1" xmlns="http://www.w3.org/1999/xhtml">new</span></code><span class="koboSpan" id="kobo.228.1" xmlns="http://www.w3.org/1999/xhtml"> keywords there, but even though it is not very elegant, we can manually create new instances in the composition root without jeopardizing our application’s health. </span><span class="koboSpan" id="kobo.228.2" xmlns="http://www.w3.org/1999/xhtml">We learn how to get rid of some of them later with the introduction of Scrutor.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.229.1" xmlns="http://www.w3.org/1999/xhtml">Next, let’s create the second decorator.</span></p>
</section>
<section class="level4" data-number="12.2.3.2" id="decoratorb">
<h4 data-number="12.2.3.2"><span class="koboSpan" id="kobo.230.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorB</span></h4>
<p><span class="koboSpan" id="kobo.231.1" xmlns="http://www.w3.org/1999/xhtml">Now that we have a decorator, it is time to create a second decorator to demonstrate the power of chaining decorators.</span><strong><span class="koboSpan" id="kobo.232.1" xmlns="http://www.w3.org/1999/xhtml">Context</span></strong><span class="koboSpan" id="kobo.233.1" xmlns="http://www.w3.org/1999/xhtml">: we need another content wrapper but don’t want to modify existing classes. </span><span class="koboSpan" id="kobo.233.2" xmlns="http://www.w3.org/1999/xhtml">To achieve this, we concluded that creating a second decorator would be perfect, so we created the following </span><code><span class="koboSpan" id="kobo.234.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorB</span></code><span class="koboSpan" id="kobo.235.1" xmlns="http://www.w3.org/1999/xhtml"> class:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.236.1" xmlns="http://www.w3.org/1999/xhtml">public class DecoratorB : IComponent
{
    private readonly IComponent _component;
    public DecoratorB(IComponent component)
    {
        _component = component ?? </span><span class="koboSpan" id="kobo.236.2" xmlns="http://www.w3.org/1999/xhtml">throw new ArgumentNullException(nameof(component));
    }
    public string Operation()
    {
        var result = _component.Operation();
        return $"&lt;DecoratorB&gt;{result}&lt;/DecoratorB&gt;";
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.237.1" xmlns="http://www.w3.org/1999/xhtml">The preceding code is similar to </span><code><span class="koboSpan" id="kobo.238.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorA</span></code><span class="koboSpan" id="kobo.239.1" xmlns="http://www.w3.org/1999/xhtml">, but the XML tag is </span><code><span class="koboSpan" id="kobo.240.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorB</span></code><span class="koboSpan" id="kobo.241.1" xmlns="http://www.w3.org/1999/xhtml"> instead. </span><span class="koboSpan" id="kobo.241.2" xmlns="http://www.w3.org/1999/xhtml">The important part is that the decorator depends on and implements the </span><code><span class="koboSpan" id="kobo.242.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.243.1" xmlns="http://www.w3.org/1999/xhtml"> interface and doesn’t depend on a concrete class. </span><span class="koboSpan" id="kobo.243.2" xmlns="http://www.w3.org/1999/xhtml">This is what gives us the flexibility of decorating any </span><code><span class="koboSpan" id="kobo.244.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.245.1" xmlns="http://www.w3.org/1999/xhtml">, and this is what enables us to chain decorators.To complete this example, we need to update our composition root like this:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.246.1" xmlns="http://www.w3.org/1999/xhtml">builder.Services.AddSingleton&lt;IComponent&gt;(serviceProvider =&gt; new DecoratorB(new DecoratorA(new ComponentA())));</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.247.1" xmlns="http://www.w3.org/1999/xhtml">Now, </span><code><span class="koboSpan" id="kobo.248.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorB</span></code><span class="koboSpan" id="kobo.249.1" xmlns="http://www.w3.org/1999/xhtml"> decorates </span><code><span class="koboSpan" id="kobo.250.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorA</span></code><span class="koboSpan" id="kobo.251.1" xmlns="http://www.w3.org/1999/xhtml">, which decorates </span><code><span class="koboSpan" id="kobo.252.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.253.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.253.2" xmlns="http://www.w3.org/1999/xhtml">When running the application, you see the following output:</span></p>
<div class="C0-SHConPACKT">
<pre><code><span class="koboSpan" id="kobo.254.1" xmlns="http://www.w3.org/1999/xhtml">&lt;DecoratorB&gt;&lt;DecoratorA&gt;Hello from ComponentA&lt;/DecoratorA&gt;&lt;/DecoratorB&gt;</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.255.1" xmlns="http://www.w3.org/1999/xhtml">And voilà! </span><span class="koboSpan" id="kobo.255.2" xmlns="http://www.w3.org/1999/xhtml">These decorators allowed us to modify the behavior of </span><code><span class="koboSpan" id="kobo.256.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.257.1" xmlns="http://www.w3.org/1999/xhtml"> without impacting the code. </span><span class="koboSpan" id="kobo.257.2" xmlns="http://www.w3.org/1999/xhtml">However, our composition root is beginning to get messy as we instantiate multiple dependencies inside each other, making our application harder to maintain. </span><span class="koboSpan" id="kobo.257.3" xmlns="http://www.w3.org/1999/xhtml">Moreover, the code is becoming harder to read. </span><span class="koboSpan" id="kobo.257.4" xmlns="http://www.w3.org/1999/xhtml">Furthermore, the code would be even harder to read if the decorators were also depending on other classes.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.258.1" xmlns="http://www.w3.org/1999/xhtml">We can use decorators to change the behavior or state of an object. </span><span class="koboSpan" id="kobo.258.2" xmlns="http://www.w3.org/1999/xhtml">We can be very creative with decorators; for example, you could create a class that queries remote resources over HTTP and then decorate that class with a small component that manages a memory cache of the results, limiting the round trip to the remote server. </span><span class="koboSpan" id="kobo.258.3" xmlns="http://www.w3.org/1999/xhtml">You could create another decorator that monitors the time needed to query those resources and then log that to Application Insights—so many possibilities.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.259.1" xmlns="http://www.w3.org/1999/xhtml">Next, we eliminate the </span><code><span class="koboSpan" id="kobo.260.1" xmlns="http://www.w3.org/1999/xhtml">new</span></code><span class="koboSpan" id="kobo.261.1" xmlns="http://www.w3.org/1999/xhtml"> keywords and clean up our composition root.</span></p>
</section>
</section>
<section class="level3" data-number="12.2.4" id="project-decorator-using-scrutor">
<h3 data-number="12.2.4"><span class="koboSpan" id="kobo.262.1" xmlns="http://www.w3.org/1999/xhtml">Project – Decorator using Scrutor</span></h3>
<p><span class="koboSpan" id="kobo.263.1" xmlns="http://www.w3.org/1999/xhtml">This update aims to simplify the composition of the system we just created. </span><span class="koboSpan" id="kobo.263.2" xmlns="http://www.w3.org/1999/xhtml">To achieve this, we use </span><strong><span class="koboSpan" id="kobo.264.1" xmlns="http://www.w3.org/1999/xhtml">Scrutor</span></strong><span class="koboSpan" id="kobo.265.1" xmlns="http://www.w3.org/1999/xhtml">, an open-source library that allows us to do just that, among other things.We first need to install the Scrutor NuGet package using Visual Studio or the CLI. </span><span class="koboSpan" id="kobo.265.2" xmlns="http://www.w3.org/1999/xhtml">When using the CLI, run the following command:</span></p>
<div class="C0-SHConPACKT">
<pre><code><span class="koboSpan" id="kobo.266.1" xmlns="http://www.w3.org/1999/xhtml">dotnet add package Scrutor</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.267.1" xmlns="http://www.w3.org/1999/xhtml">Once Scrutor is installed, we can use the </span><code><span class="koboSpan" id="kobo.268.1" xmlns="http://www.w3.org/1999/xhtml">Decorate</span></code><span class="koboSpan" id="kobo.269.1" xmlns="http://www.w3.org/1999/xhtml"> extension method on the </span><code><span class="koboSpan" id="kobo.270.1" xmlns="http://www.w3.org/1999/xhtml">IServiceCollection</span></code><span class="koboSpan" id="kobo.271.1" xmlns="http://www.w3.org/1999/xhtml"> to add decorators.By using Scrutor, we can update the following messy line:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.272.1" xmlns="http://www.w3.org/1999/xhtml">builder.Services.AddSingleton&lt;IComponent&gt;(serviceProvider =&gt; new DecoratorB(new DecoratorA(new ComponentA())))</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.273.1" xmlns="http://www.w3.org/1999/xhtml">And convert it into these three more elegant lines:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.274.1" xmlns="http://www.w3.org/1999/xhtml">builder.Services
    .AddSingleton&lt;IComponent, ComponentA&gt;()
    .Decorate&lt;IComponent, DecoratorA&gt;()
    .Decorate&lt;IComponent, DecoratorB&gt;()
;</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.275.1" xmlns="http://www.w3.org/1999/xhtml">In the preceding code, we registered </span><code><span class="koboSpan" id="kobo.276.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.277.1" xmlns="http://www.w3.org/1999/xhtml"> as the implementation of </span><code><span class="koboSpan" id="kobo.278.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.279.1" xmlns="http://www.w3.org/1999/xhtml">, with a singleton lifetime, just like the first time.Then, by using Scrutor, we told the IoC container to override that first binding and to decorate the already registered </span><code><span class="koboSpan" id="kobo.280.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.281.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><code><span class="koboSpan" id="kobo.282.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.283.1" xmlns="http://www.w3.org/1999/xhtml">) with an instance of </span><code><span class="koboSpan" id="kobo.284.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorA</span></code><span class="koboSpan" id="kobo.285.1" xmlns="http://www.w3.org/1999/xhtml"> instead. </span><span class="koboSpan" id="kobo.285.2" xmlns="http://www.w3.org/1999/xhtml">Then, we overrode the second binding by telling the IoC container to return an instance of </span><code><span class="koboSpan" id="kobo.286.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorB</span></code><span class="koboSpan" id="kobo.287.1" xmlns="http://www.w3.org/1999/xhtml"> that decorates the last known binding of </span><code><span class="koboSpan" id="kobo.288.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.289.1" xmlns="http://www.w3.org/1999/xhtml"> instead (</span><code><span class="koboSpan" id="kobo.290.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorA</span></code><span class="koboSpan" id="kobo.291.1" xmlns="http://www.w3.org/1999/xhtml">).The result is the same as we did previously, but the code is now more elegant. </span><span class="koboSpan" id="kobo.291.2" xmlns="http://www.w3.org/1999/xhtml">On top of that improved readability, this lets the container create the instances instead of us using the </span><code><span class="koboSpan" id="kobo.292.1" xmlns="http://www.w3.org/1999/xhtml">new</span></code><span class="koboSpan" id="kobo.293.1" xmlns="http://www.w3.org/1999/xhtml"> keyword, adding more flexibility and stability to our system.As a reminder, the IoC container serves the equivalent of the following </span><code><span class="koboSpan" id="kobo.294.1" xmlns="http://www.w3.org/1999/xhtml">instance</span></code><span class="koboSpan" id="kobo.295.1" xmlns="http://www.w3.org/1999/xhtml"> when an </span><code><span class="koboSpan" id="kobo.296.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.297.1" xmlns="http://www.w3.org/1999/xhtml"> interface is requested:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.298.1" xmlns="http://www.w3.org/1999/xhtml">var instance = new DecoratorB(new DecoratorA(new ComponentA()));</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.299.1" xmlns="http://www.w3.org/1999/xhtml">Why am I talking about elegance and flexibility? </span><span class="koboSpan" id="kobo.299.2" xmlns="http://www.w3.org/1999/xhtml">This code is a simple example, but if we add other dependencies to those classes, it could quickly become a complex code block that could become a maintenance nightmare, very hard to read, and have manually managed lifetimes. </span><span class="koboSpan" id="kobo.299.3" xmlns="http://www.w3.org/1999/xhtml">Of course, if the system is simple, you can always instantiate the decorators manually without loading an external library.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.300.1" xmlns="http://www.w3.org/1999/xhtml">Whenever possible, keep your code simple. </span><span class="koboSpan" id="kobo.300.2" xmlns="http://www.w3.org/1999/xhtml">Using Scrutor is one way to achieve this. </span><span class="koboSpan" id="kobo.300.3" xmlns="http://www.w3.org/1999/xhtml">Code simplicity helps in the long run as it is easier to read and follow, even for someone else reading it. </span><span class="koboSpan" id="kobo.300.4" xmlns="http://www.w3.org/1999/xhtml">Consider that someone will most likely read your code one day.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.301.1" xmlns="http://www.w3.org/1999/xhtml">Moreover, adding any external dependency to a project should be considered carefully. </span><span class="koboSpan" id="kobo.301.2" xmlns="http://www.w3.org/1999/xhtml">Remember that you must keep the dependency up to date, so having too many can take maintenance time. </span><span class="koboSpan" id="kobo.301.3" xmlns="http://www.w3.org/1999/xhtml">The library's author can also stop maintaining it, and the library will become outdated. </span><span class="koboSpan" id="kobo.301.4" xmlns="http://www.w3.org/1999/xhtml">The library may introduce breaking changes forcing you to update your code. </span><span class="koboSpan" id="kobo.301.5" xmlns="http://www.w3.org/1999/xhtml">And so on.</span></p>
</blockquote>
<blockquote>
<p><span class="koboSpan" id="kobo.302.1" xmlns="http://www.w3.org/1999/xhtml">Furthermore, there is the security aspect to consider. </span><span class="koboSpan" id="kobo.302.2" xmlns="http://www.w3.org/1999/xhtml">Supply chain attacks are not uncommon. </span><span class="koboSpan" id="kobo.302.3" xmlns="http://www.w3.org/1999/xhtml">If you work in a regulated place, you may have to go through a cybersecurity vetting process, etc.</span></p>
</blockquote>
<blockquote>
<p><span class="koboSpan" id="kobo.303.1" xmlns="http://www.w3.org/1999/xhtml">Besides those general tips, I’ve been using Scrutor for many years; I find it very stable and don’t remember any breaking changes that caused me issues.</span></p>
</blockquote>
</blockquote>
<p><span class="koboSpan" id="kobo.304.1" xmlns="http://www.w3.org/1999/xhtml">To ensure both programs behave the same, with or without Scrutor, let’s explore the following integration test that runs for both projects, ensuring their correctness:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.305.1" xmlns="http://www.w3.org/1999/xhtml">namespace Decorator.IntegrationTests;
//...
</span><span class="koboSpan" id="kobo.305.2" xmlns="http://www.w3.org/1999/xhtml">[Fact]
public async Task Should_return_a_double_decorated_string()
{
    // Arrange
    var client = _webApplicationFactory.CreateClient();
    // Act
    var response = await client.GetAsync("/");
    // Assert
    response.EnsureSuccessStatusCode();
    var body = await response.Content.ReadAsStringAsync();
    Assert.Equal(
        "Operation: &lt;DecoratorB&gt;&lt;DecoratorA&gt;Hello from ComponentA&lt;/DecoratorA&gt;&lt;/DecoratorB&gt;",
        body
    );
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.306.1" xmlns="http://www.w3.org/1999/xhtml">The preceding test sends an HTTP request to one of the applications running in memory and compares the server response to the expected value. </span><span class="koboSpan" id="kobo.306.2" xmlns="http://www.w3.org/1999/xhtml">Since both projects should have the same output, we reuse this test in both the </span><code><span class="koboSpan" id="kobo.307.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorPlainStartupTest</span></code><span class="koboSpan" id="kobo.308.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.309.1" xmlns="http://www.w3.org/1999/xhtml">DecoratorScrutorStartupTest</span></code><span class="koboSpan" id="kobo.310.1" xmlns="http://www.w3.org/1999/xhtml"> classes. </span><span class="koboSpan" id="kobo.310.2" xmlns="http://www.w3.org/1999/xhtml">They are empty and only routes the test to the correct program. </span><span class="koboSpan" id="kobo.310.3" xmlns="http://www.w3.org/1999/xhtml">Here’s an example of the Visual Studio Test Explorer:</span></p>
<figure>
<span class="koboSpan" id="kobo.311.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 11.7: A Visual Studio Explorer screenshot displaying the Decorator integration tests." src="../media/file54.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.312.1" xmlns="http://www.w3.org/1999/xhtml">Figure 11.7: A Visual Studio Explorer screenshot displaying the Decorator integration tests.</span></figcaption>
</figure>
<blockquote>
<p><span class="koboSpan" id="kobo.313.1" xmlns="http://www.w3.org/1999/xhtml">You can also do assembly scanning using Scrutor (</span><a href="https://adpg.link/xvfS"><span class="koboSpan" id="kobo.314.1" xmlns="http://www.w3.org/1999/xhtml">https://adpg.link/xvfS</span></a><span class="koboSpan" id="kobo.315.1" xmlns="http://www.w3.org/1999/xhtml">), which allows you to perform automatic dependency registration. </span><span class="koboSpan" id="kobo.315.2" xmlns="http://www.w3.org/1999/xhtml">This is outside the scope of this chapter, but it is worth looking into. </span><span class="koboSpan" id="kobo.315.3" xmlns="http://www.w3.org/1999/xhtml">Scrutor allows you to use the built-in IoC container for more complex scenarios, postponing the need to replace it with a third-party one.</span></p>
</blockquote>
</section>
<section class="level3" data-number="12.2.5" id="conclusion-15">
<h3 data-number="12.2.5"><span class="koboSpan" id="kobo.316.1" xmlns="http://www.w3.org/1999/xhtml">Conclusion</span></h3>
<p><span class="koboSpan" id="kobo.317.1" xmlns="http://www.w3.org/1999/xhtml">The Decorator pattern is one of our toolbox's simplest yet most powerful design patterns. </span><span class="koboSpan" id="kobo.317.2" xmlns="http://www.w3.org/1999/xhtml">It augments existing classes without modifying them. </span><span class="koboSpan" id="kobo.317.3" xmlns="http://www.w3.org/1999/xhtml">A decorator is an independent block of logic that we can use to create complex and granular object trees that fit our needs.We also explored the Scrutor open-source library to assist us in registering our decorator with the container.The Decorator pattern helps us stay in line with the </span><strong><span class="koboSpan" id="kobo.318.1" xmlns="http://www.w3.org/1999/xhtml">SOLID</span></strong><span class="koboSpan" id="kobo.319.1" xmlns="http://www.w3.org/1999/xhtml"> principles (and vice versa), as follows:</span></p>
<ul>
<li><strong><span class="koboSpan" id="kobo.320.1" xmlns="http://www.w3.org/1999/xhtml">S</span></strong><span class="koboSpan" id="kobo.321.1" xmlns="http://www.w3.org/1999/xhtml">: The Decorator pattern suggests creating small classes to add behaviors to other classes, segregating responsibilities, and fostering reuse.</span></li>
<li><strong><span class="koboSpan" id="kobo.322.1" xmlns="http://www.w3.org/1999/xhtml">O</span></strong><span class="koboSpan" id="kobo.323.1" xmlns="http://www.w3.org/1999/xhtml">: Decorators add behaviors to other classes without modifying them, which is literally the definition of the OCP.</span></li>
<li><strong><span class="koboSpan" id="kobo.324.1" xmlns="http://www.w3.org/1999/xhtml">L</span></strong><span class="koboSpan" id="kobo.325.1" xmlns="http://www.w3.org/1999/xhtml">: N/A</span></li>
<li><strong><span class="koboSpan" id="kobo.326.1" xmlns="http://www.w3.org/1999/xhtml">I</span></strong><span class="koboSpan" id="kobo.327.1" xmlns="http://www.w3.org/1999/xhtml">: By following the ISP, creating decorators for your specific needs should be easy. </span><span class="koboSpan" id="kobo.327.2" xmlns="http://www.w3.org/1999/xhtml">However, implementing the Decorator pattern may become difficult if your interfaces are too complex. </span><span class="koboSpan" id="kobo.327.3" xmlns="http://www.w3.org/1999/xhtml">Having a hard time creating a decorator is a good indicator that something is wrong with the design—a code smell. </span><span class="koboSpan" id="kobo.327.4" xmlns="http://www.w3.org/1999/xhtml">A well-segregated interface should be easy to decorate.</span></li>
<li><strong><span class="koboSpan" id="kobo.328.1" xmlns="http://www.w3.org/1999/xhtml">D</span></strong><span class="koboSpan" id="kobo.329.1" xmlns="http://www.w3.org/1999/xhtml">: Depending on abstractions is the key to the Decorator’s power.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.330.1" xmlns="http://www.w3.org/1999/xhtml">Next, we explore the Composite pattern, which helps us manage complex objects’ structures differently than the decorator does.</span></p>
</section>
</section>
<section class="level2" data-number="12.3" id="implementing-the-composite-design-pattern">
<h2 data-number="12.3"><span class="koboSpan" id="kobo.331.1" xmlns="http://www.w3.org/1999/xhtml">Implementing the Composite design pattern</span></h2>
<p><span class="koboSpan" id="kobo.332.1" xmlns="http://www.w3.org/1999/xhtml">The Composite design pattern is another structural GoF pattern that helps us manage complex object structures.</span></p>
<section class="level3" data-number="12.3.1" id="goal-8">
<h3 data-number="12.3.1"><span class="koboSpan" id="kobo.333.1" xmlns="http://www.w3.org/1999/xhtml">Goal</span></h3>
<p><span class="koboSpan" id="kobo.334.1" xmlns="http://www.w3.org/1999/xhtml">The goal behind the Composite pattern is to create a hierarchical data structure where you don’t need to differentiate groups from single components, making the traversal and manipulation of the hierarchy easy for its consumers.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.335.1" xmlns="http://www.w3.org/1999/xhtml">You could think of the Composite pattern as a way of building a graph or a tree with self-managing nodes.</span></p>
</blockquote>
</section>
<section class="level3" data-number="12.3.2" id="design-8">
<h3 data-number="12.3.2"><span class="koboSpan" id="kobo.336.1" xmlns="http://www.w3.org/1999/xhtml">Design</span></h3>
<p><span class="koboSpan" id="kobo.337.1" xmlns="http://www.w3.org/1999/xhtml">The design is straightforward; we have </span><em><span class="koboSpan" id="kobo.338.1" xmlns="http://www.w3.org/1999/xhtml">components</span></em><span class="koboSpan" id="kobo.339.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><em><span class="koboSpan" id="kobo.340.1" xmlns="http://www.w3.org/1999/xhtml">composites</span></em><span class="koboSpan" id="kobo.341.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.341.2" xmlns="http://www.w3.org/1999/xhtml">Both implement a common interface that defines the shared operations. </span><span class="koboSpan" id="kobo.341.3" xmlns="http://www.w3.org/1999/xhtml">The </span><em><span class="koboSpan" id="kobo.342.1" xmlns="http://www.w3.org/1999/xhtml">components</span></em><span class="koboSpan" id="kobo.343.1" xmlns="http://www.w3.org/1999/xhtml"> are single nodes, while the </span><em><span class="koboSpan" id="kobo.344.1" xmlns="http://www.w3.org/1999/xhtml">composites</span></em><span class="koboSpan" id="kobo.345.1" xmlns="http://www.w3.org/1999/xhtml"> are collections of </span><em><span class="koboSpan" id="kobo.346.1" xmlns="http://www.w3.org/1999/xhtml">components</span></em><span class="koboSpan" id="kobo.347.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.347.2" xmlns="http://www.w3.org/1999/xhtml">Let’s take a look at a diagram:</span></p>
<figure>
<span class="koboSpan" id="kobo.348.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 11.7: Composite class diagram" src="../media/file55.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.349.1" xmlns="http://www.w3.org/1999/xhtml">Figure 11.7: Composite class diagram</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.350.1" xmlns="http://www.w3.org/1999/xhtml">In the preceding diagram, </span><code><span class="koboSpan" id="kobo.351.1" xmlns="http://www.w3.org/1999/xhtml">Client</span></code><span class="koboSpan" id="kobo.352.1" xmlns="http://www.w3.org/1999/xhtml"> depends on an </span><code><span class="koboSpan" id="kobo.353.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.354.1" xmlns="http://www.w3.org/1999/xhtml"> interface and is unaware of the underlying implementation—it could be an instance of a </span><code><span class="koboSpan" id="kobo.355.1" xmlns="http://www.w3.org/1999/xhtml">Component</span></code><span class="koboSpan" id="kobo.356.1" xmlns="http://www.w3.org/1999/xhtml"> or a </span><code><span class="koboSpan" id="kobo.357.1" xmlns="http://www.w3.org/1999/xhtml">Composite</span></code><span class="koboSpan" id="kobo.358.1" xmlns="http://www.w3.org/1999/xhtml">; it does not matter. </span><span class="koboSpan" id="kobo.358.2" xmlns="http://www.w3.org/1999/xhtml">Then, we have two implementations:</span></p>
<ul>
<li><code><span class="koboSpan" id="kobo.359.1" xmlns="http://www.w3.org/1999/xhtml">Component</span></code><span class="koboSpan" id="kobo.360.1" xmlns="http://www.w3.org/1999/xhtml"> represents a single element; a leaf.</span></li>
<li><code><span class="koboSpan" id="kobo.361.1" xmlns="http://www.w3.org/1999/xhtml">Composite</span></code><span class="koboSpan" id="kobo.362.1" xmlns="http://www.w3.org/1999/xhtml"> represents a collection of </span><code><span class="koboSpan" id="kobo.363.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.364.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.364.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.365.1" xmlns="http://www.w3.org/1999/xhtml">Composite</span></code><span class="koboSpan" id="kobo.366.1" xmlns="http://www.w3.org/1999/xhtml"> object uses its children to manage the hierarchy’s complexity by delegating part of the process to them.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.367.1" xmlns="http://www.w3.org/1999/xhtml">Those three pieces put together create the Composite design pattern. </span><span class="koboSpan" id="kobo.367.2" xmlns="http://www.w3.org/1999/xhtml">Considering that it is possible to add instances of the </span><code><span class="koboSpan" id="kobo.368.1" xmlns="http://www.w3.org/1999/xhtml">Composite</span></code><span class="koboSpan" id="kobo.369.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.370.1" xmlns="http://www.w3.org/1999/xhtml">Component</span></code><span class="koboSpan" id="kobo.371.1" xmlns="http://www.w3.org/1999/xhtml"> classes as children of other </span><code><span class="koboSpan" id="kobo.372.1" xmlns="http://www.w3.org/1999/xhtml">Composite</span></code><span class="koboSpan" id="kobo.373.1" xmlns="http://www.w3.org/1999/xhtml"> objects, it is possible to create complex, non-linear, and self-managed data structures with next to no effort.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.374.1" xmlns="http://www.w3.org/1999/xhtml">You are not limited to one type of component and one type of composite; you can create as many implementations of the </span><code><span class="koboSpan" id="kobo.375.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.376.1" xmlns="http://www.w3.org/1999/xhtml"> interface as you need. </span><span class="koboSpan" id="kobo.376.2" xmlns="http://www.w3.org/1999/xhtml">Then, you can even mix and match them to create a non-linear tree.</span></p>
</blockquote>
</section>
<section class="level3" data-number="12.3.3" id="project-bookstore">
<h3 data-number="12.3.3"><span class="koboSpan" id="kobo.377.1" xmlns="http://www.w3.org/1999/xhtml">Project – BookStore</span></h3>
<p><strong><span class="koboSpan" id="kobo.378.1" xmlns="http://www.w3.org/1999/xhtml">Context</span></strong><span class="koboSpan" id="kobo.379.1" xmlns="http://www.w3.org/1999/xhtml">: We built a program in the past to support a bookstore. </span><span class="koboSpan" id="kobo.379.2" xmlns="http://www.w3.org/1999/xhtml">However, the store is going so well that our little program is not enough anymore. </span><span class="koboSpan" id="kobo.379.3" xmlns="http://www.w3.org/1999/xhtml">Our fictional company now owns multiple stores. </span><span class="koboSpan" id="kobo.379.4" xmlns="http://www.w3.org/1999/xhtml">They want to divide those stores into sections and manage book sets and single books. </span><span class="koboSpan" id="kobo.379.5" xmlns="http://www.w3.org/1999/xhtml">After a few minutes of gathering information and asking them questions, we realize they can have sets of sets, subsections, and think of creating sub-stores, so we need a flexible design.We have decided to use the Composite pattern to solve this problem. </span><span class="koboSpan" id="kobo.379.6" xmlns="http://www.w3.org/1999/xhtml">Here’s our class hierarchy:</span></p>
<figure>
<span class="koboSpan" id="kobo.380.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 11.8: the BookStore project composite class hierarchy" src="../media/file56.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.381.1" xmlns="http://www.w3.org/1999/xhtml">Figure 11.8: the BookStore project composite class hierarchy</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.382.1" xmlns="http://www.w3.org/1999/xhtml">Due to the complexity of our class hierarchy and the uncertainty of a project in an early stage, we decided that a factory would be adequate to create our class hierarchy, showcase our design, and validate it with the customer. </span><span class="koboSpan" id="kobo.382.2" xmlns="http://www.w3.org/1999/xhtml">Here’s the high-level design:</span></p>
<figure>
<span class="koboSpan" id="kobo.383.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 11.9: high-level design of the BookStore project" src="../media/file57.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.384.1" xmlns="http://www.w3.org/1999/xhtml">Figure 11.9: high-level design of the BookStore project</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.385.1" xmlns="http://www.w3.org/1999/xhtml">We decided to aim for the smallest possible interface to get the ball rolling. </span><span class="koboSpan" id="kobo.385.2" xmlns="http://www.w3.org/1999/xhtml">Since we want to know how many items are available in any part of the store and what type of component we are interacting with, we created the following interface:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.386.1" xmlns="http://www.w3.org/1999/xhtml">namespace Composite.Models;
public interface IComponent
{
    int Count { get; }
    string Type { get; }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.387.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.388.1" xmlns="http://www.w3.org/1999/xhtml">Count</span></code><span class="koboSpan" id="kobo.389.1" xmlns="http://www.w3.org/1999/xhtml"> property allows us to calculate how many items are available under the corporation, a store, a section, a set, or any other composite component we create in the future. </span><span class="koboSpan" id="kobo.389.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.390.1" xmlns="http://www.w3.org/1999/xhtml">Type</span></code><span class="koboSpan" id="kobo.391.1" xmlns="http://www.w3.org/1999/xhtml"> property forces each component to display its type linearly.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.392.1" xmlns="http://www.w3.org/1999/xhtml">We can create such a minimal interface because we are not executing any operations on the data structure but counting the elements, then serializing it to JSON. </span><span class="koboSpan" id="kobo.392.2" xmlns="http://www.w3.org/1999/xhtml">The serializer will take care of navigating the class hierarchy for us. </span><span class="koboSpan" id="kobo.392.3" xmlns="http://www.w3.org/1999/xhtml">In another context, the minimal subset of properties might be more than this. </span><span class="koboSpan" id="kobo.392.4" xmlns="http://www.w3.org/1999/xhtml">For example, in this case, we could have added a </span><code><span class="koboSpan" id="kobo.393.1" xmlns="http://www.w3.org/1999/xhtml">Name</span></code><span class="koboSpan" id="kobo.394.1" xmlns="http://www.w3.org/1999/xhtml"> property to the interface, but the book's name is its title, so I decided not to include it.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.395.1" xmlns="http://www.w3.org/1999/xhtml">Next, let’s create our composite structure, starting with the </span><code><span class="koboSpan" id="kobo.396.1" xmlns="http://www.w3.org/1999/xhtml">Book</span></code><span class="koboSpan" id="kobo.397.1" xmlns="http://www.w3.org/1999/xhtml"> class (the </span><em><span class="koboSpan" id="kobo.398.1" xmlns="http://www.w3.org/1999/xhtml">Component</span></em><span class="koboSpan" id="kobo.399.1" xmlns="http://www.w3.org/1999/xhtml">):</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.400.1" xmlns="http://www.w3.org/1999/xhtml">namespace Composite.Models;
public class Book : IComponent
{
    public Book(string title)
    {
        Title = title ?? </span><span class="koboSpan" id="kobo.400.2" xmlns="http://www.w3.org/1999/xhtml">throw new ArgumentNullException(nameof(title));
    }
    public string Title { get; }
    public string Type =&gt; "Book";
    public int Count { get; } = 1;
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.401.1" xmlns="http://www.w3.org/1999/xhtml">The preceding </span><code><span class="koboSpan" id="kobo.402.1" xmlns="http://www.w3.org/1999/xhtml">Book</span></code><span class="koboSpan" id="kobo.403.1" xmlns="http://www.w3.org/1999/xhtml"> class implements the interface by always returning a count of 1 because it is a single book, a leaf in the tree. </span><span class="koboSpan" id="kobo.403.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.404.1" xmlns="http://www.w3.org/1999/xhtml">Type</span></code><span class="koboSpan" id="kobo.405.1" xmlns="http://www.w3.org/1999/xhtml"> property is also hard-coded. </span><span class="koboSpan" id="kobo.405.2" xmlns="http://www.w3.org/1999/xhtml">As a book, the class requires a title upon construction that it stores in the </span><code><span class="koboSpan" id="kobo.406.1" xmlns="http://www.w3.org/1999/xhtml">Title</span></code><span class="koboSpan" id="kobo.407.1" xmlns="http://www.w3.org/1999/xhtml"> property (not inherited and only available to </span><code><span class="koboSpan" id="kobo.408.1" xmlns="http://www.w3.org/1999/xhtml">Book</span></code><span class="koboSpan" id="kobo.409.1" xmlns="http://www.w3.org/1999/xhtml"> instances).</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.410.1" xmlns="http://www.w3.org/1999/xhtml">In a real scenario, we’d have more properties, like the ISBN and author, but doing so here would just clutter the example. </span><span class="koboSpan" id="kobo.410.2" xmlns="http://www.w3.org/1999/xhtml">We are not designing a real bookstore but learning about the Composite pattern.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.411.1" xmlns="http://www.w3.org/1999/xhtml">Next, let’s create our composite component, the </span><code><span class="koboSpan" id="kobo.412.1" xmlns="http://www.w3.org/1999/xhtml">BookComposite</span></code><span class="koboSpan" id="kobo.413.1" xmlns="http://www.w3.org/1999/xhtml"> class:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.414.1" xmlns="http://www.w3.org/1999/xhtml">using System.Collections;
using System.Collections.ObjectModel;
namespace Composite.Models;
public abstract class BookComposite : IComponent
{
    protected readonly List&lt;IComponent&gt; children = new();
    public BookComposite(string name)
    {
        Name = name ?? </span><span class="koboSpan" id="kobo.414.2" xmlns="http://www.w3.org/1999/xhtml">throw new ArgumentNullException(nameof(name));
    }
    public string Name { get; }
    public virtual string Type =&gt; GetType().Name;
    public virtual int Count 
        =&gt; children.Sum(child =&gt; child.Count);
    public virtual IEnumerable Children 
        =&gt; new ReadOnlyCollection&lt;IComponent&gt;(children);
    public virtual void Add(IComponent bookComponent)
    {
        children.Add(bookComponent);
    }
    public virtual void Remove(IComponent bookComponent)
    {
        children.Remove(bookComponent);
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.415.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.416.1" xmlns="http://www.w3.org/1999/xhtml">BookComposite</span></code><span class="koboSpan" id="kobo.417.1" xmlns="http://www.w3.org/1999/xhtml"> class implements the following shared features:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.418.1" xmlns="http://www.w3.org/1999/xhtml">Children management (highlighted in the code).</span></li>
<li><span class="koboSpan" id="kobo.419.1" xmlns="http://www.w3.org/1999/xhtml">Setting the </span><code><span class="koboSpan" id="kobo.420.1" xmlns="http://www.w3.org/1999/xhtml">Name</span></code><span class="koboSpan" id="kobo.421.1" xmlns="http://www.w3.org/1999/xhtml"> property of the composite object and forcing the classes inheriting it to set a name upon construction.</span></li>
<li><span class="koboSpan" id="kobo.422.1" xmlns="http://www.w3.org/1999/xhtml">Automatically finds and sets the </span><code><span class="koboSpan" id="kobo.423.1" xmlns="http://www.w3.org/1999/xhtml">Type</span></code><span class="koboSpan" id="kobo.424.1" xmlns="http://www.w3.org/1999/xhtml"> name of its derived class.</span></li>
<li><span class="koboSpan" id="kobo.425.1" xmlns="http://www.w3.org/1999/xhtml">Counting the number of children (and, implicitly, the children’s children).</span></li>
<li><span class="koboSpan" id="kobo.426.1" xmlns="http://www.w3.org/1999/xhtml">Exposing the children through the </span><code><span class="koboSpan" id="kobo.427.1" xmlns="http://www.w3.org/1999/xhtml">Children</span></code><span class="koboSpan" id="kobo.428.1" xmlns="http://www.w3.org/1999/xhtml"> property and ensuring consumers can’t modify the collection from the outside by returning a </span><code><span class="koboSpan" id="kobo.429.1" xmlns="http://www.w3.org/1999/xhtml">ReadOnlyCollection</span></code><span class="koboSpan" id="kobo.430.1" xmlns="http://www.w3.org/1999/xhtml"> object.</span></li>
</ul>
<blockquote>
<p><span class="koboSpan" id="kobo.431.1" xmlns="http://www.w3.org/1999/xhtml">Using the LINQ </span><code><span class="koboSpan" id="kobo.432.1" xmlns="http://www.w3.org/1999/xhtml">Sum()</span></code><span class="koboSpan" id="kobo.433.1" xmlns="http://www.w3.org/1999/xhtml"> extension method in the </span><code><span class="koboSpan" id="kobo.434.1" xmlns="http://www.w3.org/1999/xhtml">children.Sum(child =&gt;</span></code> <code><span class="koboSpan" id="kobo.435.1" xmlns="http://www.w3.org/1999/xhtml">child.Count());</span></code><span class="koboSpan" id="kobo.436.1" xmlns="http://www.w3.org/1999/xhtml"> expression allowed us to replace a more complex </span><code><span class="koboSpan" id="kobo.437.1" xmlns="http://www.w3.org/1999/xhtml">for</span></code><span class="koboSpan" id="kobo.438.1" xmlns="http://www.w3.org/1999/xhtml"> loop and an accumulator variable.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.439.1" xmlns="http://www.w3.org/1999/xhtml">Adding the </span><code><span class="koboSpan" id="kobo.440.1" xmlns="http://www.w3.org/1999/xhtml">virtual</span></code><span class="koboSpan" id="kobo.441.1" xmlns="http://www.w3.org/1999/xhtml"> modifier to the </span><code><span class="koboSpan" id="kobo.442.1" xmlns="http://www.w3.org/1999/xhtml">Type</span></code><span class="koboSpan" id="kobo.443.1" xmlns="http://www.w3.org/1999/xhtml"> property allows sub-types to override the property in case their type’s name does not reflect the type that should be displayed in the program.</span></p>
</blockquote>
</blockquote>
<p><span class="koboSpan" id="kobo.444.1" xmlns="http://www.w3.org/1999/xhtml">Now, we can start implementing the other classes of our complex composite hierarchy and assign a responsibility to each class, showing how flexible the Composite pattern is.The following classes inherit from the </span><code><span class="koboSpan" id="kobo.445.1" xmlns="http://www.w3.org/1999/xhtml">BookComposite</span></code><span class="koboSpan" id="kobo.446.1" xmlns="http://www.w3.org/1999/xhtml"> class:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.447.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.448.1" xmlns="http://www.w3.org/1999/xhtml">Corporation</span></code><span class="koboSpan" id="kobo.449.1" xmlns="http://www.w3.org/1999/xhtml"> class represents the corporation that owns multiple stores. </span><span class="koboSpan" id="kobo.449.2" xmlns="http://www.w3.org/1999/xhtml">However, it is not limited to owning stores; a corporation could own other corporations, stores, or any other </span><code><span class="koboSpan" id="kobo.450.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.451.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li><span class="koboSpan" id="kobo.452.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.453.1" xmlns="http://www.w3.org/1999/xhtml">Store</span></code><span class="koboSpan" id="kobo.454.1" xmlns="http://www.w3.org/1999/xhtml"> class represents a bookstore.</span></li>
<li><span class="koboSpan" id="kobo.455.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.456.1" xmlns="http://www.w3.org/1999/xhtml">Section</span></code><span class="koboSpan" id="kobo.457.1" xmlns="http://www.w3.org/1999/xhtml"> class represents a section of a bookstore, an aisle, or a category of books.</span></li>
<li><span class="koboSpan" id="kobo.458.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.459.1" xmlns="http://www.w3.org/1999/xhtml">Set</span></code><span class="koboSpan" id="kobo.460.1" xmlns="http://www.w3.org/1999/xhtml"> class represents a book set, such as a trilogy.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.461.1" xmlns="http://www.w3.org/1999/xhtml">These can be composed of any </span><code><span class="koboSpan" id="kobo.462.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.463.1" xmlns="http://www.w3.org/1999/xhtml">, making this an ultra-flexible data structure. </span><span class="koboSpan" id="kobo.463.2" xmlns="http://www.w3.org/1999/xhtml">Let’s look at the code for these </span><code><span class="koboSpan" id="kobo.464.1" xmlns="http://www.w3.org/1999/xhtml">BookComposite</span></code><span class="koboSpan" id="kobo.465.1" xmlns="http://www.w3.org/1999/xhtml"> sub-types, starting with the </span><code><span class="koboSpan" id="kobo.466.1" xmlns="http://www.w3.org/1999/xhtml">Corporation</span></code><span class="koboSpan" id="kobo.467.1" xmlns="http://www.w3.org/1999/xhtml"> class:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.468.1" xmlns="http://www.w3.org/1999/xhtml">namespace Composite.Models;
public class Corporation : BookComposite
{
    public Corporation(string name, string ceo)
        : base(name)
    {
        CEO = ceo;
    }
    public string CEO { get; }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.469.1" xmlns="http://www.w3.org/1999/xhtml">The corporation contributes a CEO to the model because someone has to manage the place.Next, we look at the </span><code><span class="koboSpan" id="kobo.470.1" xmlns="http://www.w3.org/1999/xhtml">Store</span></code><span class="koboSpan" id="kobo.471.1" xmlns="http://www.w3.org/1999/xhtml"> class:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.472.1" xmlns="http://www.w3.org/1999/xhtml">namespace Composite.Models;
public class Store : BookComposite
{
    public string Location { get; }
    public string Manager { get; }
    public Store(string name, string location, string manager)
        : base(name)
    {
        Location = location;
        Manager = manager;
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.473.1" xmlns="http://www.w3.org/1999/xhtml">On top of the </span><code><span class="koboSpan" id="kobo.474.1" xmlns="http://www.w3.org/1999/xhtml">BookComposite</span></code><span class="koboSpan" id="kobo.475.1" xmlns="http://www.w3.org/1999/xhtml"> members, a store has a manager and a location.Now, the </span><code><span class="koboSpan" id="kobo.476.1" xmlns="http://www.w3.org/1999/xhtml">Section</span></code><span class="koboSpan" id="kobo.477.1" xmlns="http://www.w3.org/1999/xhtml"> class does not add anything, but we can use it as a flexible organizer:namespace Composite.Models;</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.478.1" xmlns="http://www.w3.org/1999/xhtml">public class Section : BookComposite
{
    public Section(string name) : base(name) { }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.479.1" xmlns="http://www.w3.org/1999/xhtml">Finally, the </span><code><span class="koboSpan" id="kobo.480.1" xmlns="http://www.w3.org/1999/xhtml">Set</span></code><span class="koboSpan" id="kobo.481.1" xmlns="http://www.w3.org/1999/xhtml"> class allows creating the book set upon construction through the books parameter:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.482.1" xmlns="http://www.w3.org/1999/xhtml">namespace Composite.Models;
public class Set : BookComposite
{
    public Set(string name, params IComponent[] books)
        : base(name)
    {
        foreach (var book in books)
        {
            Add(book);
        }
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.483.1" xmlns="http://www.w3.org/1999/xhtml">Composing a set of books upon creation of the instance will be convenient later when we assemble the tree.Next, let’s explore the last part of the program that helps encapsulate the data structure’s creation: the factory.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.484.1" xmlns="http://www.w3.org/1999/xhtml">The factory is not part of the Composite pattern, but now that we know what a factory is, we can use one to encapsulate the creation logic of our data structure and talk about it.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.485.1" xmlns="http://www.w3.org/1999/xhtml">The factory interface looks like the following:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.486.1" xmlns="http://www.w3.org/1999/xhtml">public interface ICorporationFactory
{
    Corporation Create();
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.487.1" xmlns="http://www.w3.org/1999/xhtml">The default concrete implementation of the </span><code><span class="koboSpan" id="kobo.488.1" xmlns="http://www.w3.org/1999/xhtml">ICorporationFactory</span></code><span class="koboSpan" id="kobo.489.1" xmlns="http://www.w3.org/1999/xhtml"> interface is the </span><code><span class="koboSpan" id="kobo.490.1" xmlns="http://www.w3.org/1999/xhtml">DefaultCorporationFactory</span></code><span class="koboSpan" id="kobo.491.1" xmlns="http://www.w3.org/1999/xhtml"> class. </span><span class="koboSpan" id="kobo.491.2" xmlns="http://www.w3.org/1999/xhtml">It creates a large non-linear data structure with sections, subsections, sets, and subsets. </span><span class="koboSpan" id="kobo.491.3" xmlns="http://www.w3.org/1999/xhtml">This whole structure is defined using our composite model in the </span><code><span class="koboSpan" id="kobo.492.1" xmlns="http://www.w3.org/1999/xhtml">DefaultCorporationFactory</span></code><span class="koboSpan" id="kobo.493.1" xmlns="http://www.w3.org/1999/xhtml"> class. </span><span class="koboSpan" id="kobo.493.2" xmlns="http://www.w3.org/1999/xhtml">Due to its large size, let’s start with the class’s skeleton and its </span><code><span class="koboSpan" id="kobo.494.1" xmlns="http://www.w3.org/1999/xhtml">Create</span></code><span class="koboSpan" id="kobo.495.1" xmlns="http://www.w3.org/1999/xhtml"> method:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.496.1" xmlns="http://www.w3.org/1999/xhtml">using Composite.Models;
namespace Composite.Services;
public class DefaultCorporationFactory : ICorporationFactory
{
    public Corporation Create()
    {
        var corporation = new Corporation(
            "Boundless Shelves Corporation",
            "Bosmang Kapawu"
        );
        corporation.Add(CreateTaleTowersStore());
        corporation.Add(CreateEpicNexusStore());
        return corporation;
    }
    // ...
</span><span class="koboSpan" id="kobo.496.2" xmlns="http://www.w3.org/1999/xhtml">}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.497.1" xmlns="http://www.w3.org/1999/xhtml">In the preceding </span><code><span class="koboSpan" id="kobo.498.1" xmlns="http://www.w3.org/1999/xhtml">Create</span></code><span class="koboSpan" id="kobo.499.1" xmlns="http://www.w3.org/1999/xhtml"> method, we create the corporation, add two stores, then return the result.The </span><code><span class="koboSpan" id="kobo.500.1" xmlns="http://www.w3.org/1999/xhtml">CreateTaleTowersStore</span></code><span class="koboSpan" id="kobo.501.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.502.1" xmlns="http://www.w3.org/1999/xhtml">CreateEpicNexusStore</span></code><span class="koboSpan" id="kobo.503.1" xmlns="http://www.w3.org/1999/xhtml"> methods create a store, set their name, address, and manager, and create three sections each:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.504.1" xmlns="http://www.w3.org/1999/xhtml">private IComponent CreateTaleTowersStore()
{
    var store = new Store(
        "Tale Towers",
        "125 Enchantment Street, Storyville, SV 72845",
        "Malcolm Reynolds"
    );
    store.Add(CreateFantasySection());
    store.Add(CreateAdventureSection());
    store.Add(CreateDramaSection());
    return store;
}
private IComponent CreateEpicNexusStore()
{
    var store = new Store(
        "Epic Nexus",
        "369 Parchment Plaza, Novelty, NV 68123",
        "Ellen Ripley"
    );
    store.Add(CreateFictionSection());
    store.Add(CreateFantasySection());
    store.Add(CreateAdventureSection());
    return store;
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.505.1" xmlns="http://www.w3.org/1999/xhtml">Both stores share two sections (have the same books; highlighted code), each with a unique section. </span><span class="koboSpan" id="kobo.505.2" xmlns="http://www.w3.org/1999/xhtml">If we look at the </span><code><span class="koboSpan" id="kobo.506.1" xmlns="http://www.w3.org/1999/xhtml">CreateFictionSection</span></code><span class="koboSpan" id="kobo.507.1" xmlns="http://www.w3.org/1999/xhtml"> method, it adds an imaginary book and a subsection:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.508.1" xmlns="http://www.w3.org/1999/xhtml">private IComponent CreateFictionSection()
{
    var section = new Section("Fiction");
    section.Add(new Book("Some alien cowboy"));
    section.Add(CreateScienceFictionSection());
    return section;
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.509.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.510.1" xmlns="http://www.w3.org/1999/xhtml">CreateScienceFictionSection</span></code><span class="koboSpan" id="kobo.511.1" xmlns="http://www.w3.org/1999/xhtml"> method adds an invented book and the Star Wars book set composed of three trilogies (a set of sets):</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.512.1" xmlns="http://www.w3.org/1999/xhtml">private IComponent CreateScienceFictionSection()
{
    var section = new Section("Science Fiction");
    section.Add(new Book("Some weird adventure in space"));
    section.Add(new Set(
        "Star Wars",
        new Set(
            "Prequel trilogy",
            new Book("Episode I: The Phantom Menace"),
            new Book("Episode II: Attack of the Clones"),
            new Book("Episode III: Revenge of the Sith")
        ),
        new Set(
            "Original trilogy",
            new Book("Episode IV: A New Hope"),
            new Book("Episode V: The Empire Strikes Back"),
            new Book("Episode VI: Return of the Jedi")
        ),
        new Set(
            "Sequel trilogy",
            new Book("Episode VII: The Force Awakens"),
            new Book("Episode VIII: The Last Jedi"),
            new Book("Episode IX: The Rise of Skywalker")
        )
    ));
    return section;
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.513.1" xmlns="http://www.w3.org/1999/xhtml">Now, if we look at this part of the data structure, we have the following:</span></p>
<figure>
<span class="koboSpan" id="kobo.514.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 11.10: The Fiction section of the Epic Nexus store data" src="../media/file58.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.515.1" xmlns="http://www.w3.org/1999/xhtml">Figure 11.10: The Fiction section of the Epic Nexus store data</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.516.1" xmlns="http://www.w3.org/1999/xhtml">In the big scheme of things, the whole organizational structure, down to the section level (without the books and sets), looks like this:</span></p>
<figure>
<span class="koboSpan" id="kobo.517.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 11.11: the composite hierarchy without the books and sets" src="../media/file59.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.518.1" xmlns="http://www.w3.org/1999/xhtml">Figure 11.11: the composite hierarchy without the books and sets</span></figcaption>
</figure>
<blockquote>
<p><span class="koboSpan" id="kobo.519.1" xmlns="http://www.w3.org/1999/xhtml">I omitted to publish the whole data structure, including the books, as an image because it is too large and would be hard to read. </span><span class="koboSpan" id="kobo.519.2" xmlns="http://www.w3.org/1999/xhtml">Rest assured, the content itself is unimportant, and the section we are studying is enough to understand the flexibility the composite pattern brings to the design.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.520.1" xmlns="http://www.w3.org/1999/xhtml">As we explore this, we can see how flexible the design is. </span><span class="koboSpan" id="kobo.520.2" xmlns="http://www.w3.org/1999/xhtml">We can create almost any organizational structure we want.Now, let’s look at the </span><code><span class="koboSpan" id="kobo.521.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.522.1" xmlns="http://www.w3.org/1999/xhtml"> file and register our dependencies and an endpoint to query the data structure:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.523.1" xmlns="http://www.w3.org/1999/xhtml">using Composite.Services;
var builder = WebApplication.CreateBuilder(args);
builder.Services.AddSingleton&lt;ICorporationFactory, DefaultCorporationFactory&gt;();
var app = builder.Build();
app.MapGet(
    "/",
    (ICorporationFactory corporationFactory)
        =&gt; corporationFactory.Create()
);
app.Run();</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.524.1" xmlns="http://www.w3.org/1999/xhtml">The preceding code registers the factory that creates the corporation data structure with the container and an endpoint to serve it.When we execute the code, we get the full data structure or the corporation. </span><span class="koboSpan" id="kobo.524.2" xmlns="http://www.w3.org/1999/xhtml">For brevity reasons, the following JSON represents the fiction section, excluding the books:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.525.1" xmlns="http://www.w3.org/1999/xhtml">{
  "ceo": "Bosmang Kapawu",
  "name": "Boundless Shelves Corporation",
  "type": "Corporation",
  "count": 43,
  "children": [
    {
      "location": "369 Parchment Plaza, Novelty, NV 68123",
      "manager": "Ellen Ripley",
      "name": "Epic Nexus",
      "type": "Store",
      "count": 25,
      "children": [
        {
          "name": "Fiction",
          "type": "Section",
          "count": 11,
          "children": [
            {
              "name": "Science Fiction",
              "type": "Section",
              "count": 10,
              "children": [
                {
                  "name": "Star Wars",
                  "type": "Set",
                  "count": 9,
                  "children": [
                    {
                      "name": "Prequel trilogy",
                      "type": "Set",
                      "count": 3,
                      "children": []
                    },
                    {
                      "name": "Original trilogy",
                      "type": "Set",
                      "count": 3,
                      "children": []
                    },
                    {
                      "name": "Sequel trilogy",
                      "type": "Set",
                      "count": 3,
                      "children": []
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}</span></code></pre>
</div>
<blockquote>
<p><span class="koboSpan" id="kobo.526.1" xmlns="http://www.w3.org/1999/xhtml">The value of the </span><code><span class="koboSpan" id="kobo.527.1" xmlns="http://www.w3.org/1999/xhtml">count</span></code><span class="koboSpan" id="kobo.528.1" xmlns="http://www.w3.org/1999/xhtml"> fields reflect the total count. </span><span class="koboSpan" id="kobo.528.2" xmlns="http://www.w3.org/1999/xhtml">In this case, there is no book so the count should be 0. </span><span class="koboSpan" id="kobo.528.3" xmlns="http://www.w3.org/1999/xhtml">If you run the program and play with the preprocessor symbols define in the </span><code><span class="koboSpan" id="kobo.529.1" xmlns="http://www.w3.org/1999/xhtml">DefaultCorporationFactory.cs</span></code><span class="koboSpan" id="kobo.530.1" xmlns="http://www.w3.org/1999/xhtml"> file (</span><code><span class="koboSpan" id="kobo.531.1" xmlns="http://www.w3.org/1999/xhtml">ADD_BOOKS</span></code><span class="koboSpan" id="kobo.532.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.533.1" xmlns="http://www.w3.org/1999/xhtml">ADD_SETS</span></code><span class="koboSpan" id="kobo.534.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code><span class="koboSpan" id="kobo.535.1" xmlns="http://www.w3.org/1999/xhtml">ONLY_FICTION</span></code><span class="koboSpan" id="kobo.536.1" xmlns="http://www.w3.org/1999/xhtml">), you will end up with different number.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.537.1" xmlns="http://www.w3.org/1999/xhtml">The Composite pattern allowed us to render a complex data structure in a small method call. </span><span class="koboSpan" id="kobo.537.2" xmlns="http://www.w3.org/1999/xhtml">Since each component autonomously handles itself, the Composite pattern removes the burden of managing this complexity from the consumer.I encourage you to play around with the existing data structure so that you understand the pattern. </span><span class="koboSpan" id="kobo.537.3" xmlns="http://www.w3.org/1999/xhtml">You could also try adding a </span><code><span class="koboSpan" id="kobo.538.1" xmlns="http://www.w3.org/1999/xhtml">Movie</span></code><span class="koboSpan" id="kobo.539.1" xmlns="http://www.w3.org/1999/xhtml"> class to manage movies; a bookstore must diversify its activities. </span><span class="koboSpan" id="kobo.539.2" xmlns="http://www.w3.org/1999/xhtml">You could also differentiate movies from books so that customers are not confused. </span><span class="koboSpan" id="kobo.539.3" xmlns="http://www.w3.org/1999/xhtml">The bookstores could have physical and digital books as well.If you are still looking for more, try building a new application from scratch and use the Composite pattern to create, manage, and display a multi-level menu structure or a file system API.</span></p>
</section>
<section class="level3" data-number="12.3.4" id="conclusion-16">
<h3 data-number="12.3.4"><span class="koboSpan" id="kobo.540.1" xmlns="http://www.w3.org/1999/xhtml">Conclusion</span></h3>
<p><span class="koboSpan" id="kobo.541.1" xmlns="http://www.w3.org/1999/xhtml">The Composite pattern effectively builds, manages, and maintains complex non-linear data structures. </span><span class="koboSpan" id="kobo.541.2" xmlns="http://www.w3.org/1999/xhtml">Its power is primarily in its self-management capabilities. </span><span class="koboSpan" id="kobo.541.3" xmlns="http://www.w3.org/1999/xhtml">Each node, component, or composite is responsible for its own logic, leaving little to no work for the composite’s consumers. </span><span class="koboSpan" id="kobo.541.4" xmlns="http://www.w3.org/1999/xhtml">Of course, a more complex scenario would have led to a more complex interface.Using the Composite pattern helps us follow the </span><strong><span class="koboSpan" id="kobo.542.1" xmlns="http://www.w3.org/1999/xhtml">SOLID</span></strong><span class="koboSpan" id="kobo.543.1" xmlns="http://www.w3.org/1999/xhtml"> principles in the following ways:</span></p>
<ul>
<li><strong><span class="koboSpan" id="kobo.544.1" xmlns="http://www.w3.org/1999/xhtml">S</span></strong><span class="koboSpan" id="kobo.545.1" xmlns="http://www.w3.org/1999/xhtml">: It helps divide multiple elements of a complex data structure into small classes to split responsibilities.</span></li>
<li><strong><span class="koboSpan" id="kobo.546.1" xmlns="http://www.w3.org/1999/xhtml">O</span></strong><span class="koboSpan" id="kobo.547.1" xmlns="http://www.w3.org/1999/xhtml">: By allowing us to “mix and match” different implementations of </span><code><span class="koboSpan" id="kobo.548.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.549.1" xmlns="http://www.w3.org/1999/xhtml"> interface, the Composite pattern allows us to extend the data structure without impacting the other existing classes. </span><span class="koboSpan" id="kobo.549.2" xmlns="http://www.w3.org/1999/xhtml">For example, you could create a new class that implements </span><code><span class="koboSpan" id="kobo.550.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.551.1" xmlns="http://www.w3.org/1999/xhtml"> and start using it immediately without modifying any other component classes.</span></li>
<li><strong><span class="koboSpan" id="kobo.552.1" xmlns="http://www.w3.org/1999/xhtml">L</span></strong><span class="koboSpan" id="kobo.553.1" xmlns="http://www.w3.org/1999/xhtml">: N/A</span></li>
<li><strong><span class="koboSpan" id="kobo.554.1" xmlns="http://www.w3.org/1999/xhtml">I</span></strong><span class="koboSpan" id="kobo.555.1" xmlns="http://www.w3.org/1999/xhtml">: The Composite pattern may violate the ISP when single items implement operations that only impact the collections, like the </span><code><span class="koboSpan" id="kobo.556.1" xmlns="http://www.w3.org/1999/xhtml">Add</span></code><span class="koboSpan" id="kobo.557.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.558.1" xmlns="http://www.w3.org/1999/xhtml">Remove</span></code><span class="koboSpan" id="kobo.559.1" xmlns="http://www.w3.org/1999/xhtml"> methods, but we have not done this here.</span></li>
<li><strong><span class="koboSpan" id="kobo.560.1" xmlns="http://www.w3.org/1999/xhtml">D</span></strong><span class="koboSpan" id="kobo.561.1" xmlns="http://www.w3.org/1999/xhtml">: The Composite pattern actors depend solely on </span><code><span class="koboSpan" id="kobo.562.1" xmlns="http://www.w3.org/1999/xhtml">IComponent</span></code><span class="koboSpan" id="kobo.563.1" xmlns="http://www.w3.org/1999/xhtml"> which invert the dependency flow.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.564.1" xmlns="http://www.w3.org/1999/xhtml">Next, we move to a different type of structural pattern that adapts one interface to another.</span></p>
</section>
</section>
<section class="level2" data-number="12.4" id="implementing-the-adapter-design-pattern">
<h2 data-number="12.4"><span class="koboSpan" id="kobo.565.1" xmlns="http://www.w3.org/1999/xhtml">Implementing the Adapter design pattern</span></h2>
<p><span class="koboSpan" id="kobo.566.1" xmlns="http://www.w3.org/1999/xhtml">The Adapter pattern is another structural design pattern that allows two incompatible interfaces to work together without modifying their existing code. </span><span class="koboSpan" id="kobo.566.2" xmlns="http://www.w3.org/1999/xhtml">This pattern introduces a wrapper class called the </span><em><span class="koboSpan" id="kobo.567.1" xmlns="http://www.w3.org/1999/xhtml">Adapter</span></em><span class="koboSpan" id="kobo.568.1" xmlns="http://www.w3.org/1999/xhtml">, which bridges the gap between the interfaces.</span></p>
<section class="level3" data-number="12.4.1" id="goal-9">
<h3 data-number="12.4.1"><span class="koboSpan" id="kobo.569.1" xmlns="http://www.w3.org/1999/xhtml">Goal</span></h3>
<p><span class="koboSpan" id="kobo.570.1" xmlns="http://www.w3.org/1999/xhtml">The Adapter design pattern is applicable when we want to use an existing class, but its interface is incompatible with what we want to use it for. </span><span class="koboSpan" id="kobo.570.2" xmlns="http://www.w3.org/1999/xhtml">Instead of refactoring the class, which could introduce bugs or errors in the existing codebase or even cascade changes to other parts of the system, we can use an </span><em><span class="koboSpan" id="kobo.571.1" xmlns="http://www.w3.org/1999/xhtml">Adapter</span></em><span class="koboSpan" id="kobo.572.1" xmlns="http://www.w3.org/1999/xhtml"> class to make the class's interface compatible with the </span><em><span class="koboSpan" id="kobo.573.1" xmlns="http://www.w3.org/1999/xhtml">Target</span></em><span class="koboSpan" id="kobo.574.1" xmlns="http://www.w3.org/1999/xhtml"> interface. </span><span class="koboSpan" id="kobo.574.2" xmlns="http://www.w3.org/1999/xhtml">The Adapter pattern is handy when we cannot change the </span><em><span class="koboSpan" id="kobo.575.1" xmlns="http://www.w3.org/1999/xhtml">Adaptee’s</span></em><span class="koboSpan" id="kobo.576.1" xmlns="http://www.w3.org/1999/xhtml"> code or do not want to change it.</span></p>
</section>
<section class="level3" data-number="12.4.2" id="design-9">
<h3 data-number="12.4.2"><span class="koboSpan" id="kobo.577.1" xmlns="http://www.w3.org/1999/xhtml">Design</span></h3>
<p><span class="koboSpan" id="kobo.578.1" xmlns="http://www.w3.org/1999/xhtml">You can think of the adapter as a power outlet’s universal adapter; you can connect a North American device to a European outlet by connecting it to the adapter and then to the power outlet. </span><span class="koboSpan" id="kobo.578.2" xmlns="http://www.w3.org/1999/xhtml">The Adapter design pattern does precisely that but for APIs.Let’s start by looking at the following diagram:</span></p>
<figure>
<span class="koboSpan" id="kobo.579.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 11.12: Adapter class diagram" src="../media/file60.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.580.1" xmlns="http://www.w3.org/1999/xhtml">Figure 11.12: Adapter class diagram</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.581.1" xmlns="http://www.w3.org/1999/xhtml">In the preceding diagram, we have the following actors:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.582.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.583.1" xmlns="http://www.w3.org/1999/xhtml">ITarget</span></code><span class="koboSpan" id="kobo.584.1" xmlns="http://www.w3.org/1999/xhtml"> interface holds the contract we want (or have) to use.</span></li>
<li><span class="koboSpan" id="kobo.585.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.586.1" xmlns="http://www.w3.org/1999/xhtml">Adaptee</span></code><span class="koboSpan" id="kobo.587.1" xmlns="http://www.w3.org/1999/xhtml"> class represents the concrete component we want to use that does not conform to </span><code><span class="koboSpan" id="kobo.588.1" xmlns="http://www.w3.org/1999/xhtml">ITarget.</span></code></li>
<li><span class="koboSpan" id="kobo.589.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.590.1" xmlns="http://www.w3.org/1999/xhtml">Adapter</span></code><span class="koboSpan" id="kobo.591.1" xmlns="http://www.w3.org/1999/xhtml"> class adapts the </span><code><span class="koboSpan" id="kobo.592.1" xmlns="http://www.w3.org/1999/xhtml">Adaptee</span></code><span class="koboSpan" id="kobo.593.1" xmlns="http://www.w3.org/1999/xhtml"> class to the </span><code><span class="koboSpan" id="kobo.594.1" xmlns="http://www.w3.org/1999/xhtml">ITarget</span></code><span class="koboSpan" id="kobo.595.1" xmlns="http://www.w3.org/1999/xhtml"> interface.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.596.1" xmlns="http://www.w3.org/1999/xhtml">There is a second way of implementing the Adapter pattern that implies inheritance. </span><span class="koboSpan" id="kobo.596.2" xmlns="http://www.w3.org/1999/xhtml">If you can go for composition, go for it, but if you need access to </span><code><span class="koboSpan" id="kobo.597.1" xmlns="http://www.w3.org/1999/xhtml">protected</span></code><span class="koboSpan" id="kobo.598.1" xmlns="http://www.w3.org/1999/xhtml"> methods or other internal states of </span><code><span class="koboSpan" id="kobo.599.1" xmlns="http://www.w3.org/1999/xhtml">Adaptee</span></code><span class="koboSpan" id="kobo.600.1" xmlns="http://www.w3.org/1999/xhtml">, you can go for inheritance instead, like this:</span></p>
<figure>
<span class="koboSpan" id="kobo.601.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 11.13: Adapter class diagram inheriting the Adaptee" src="../media/file61.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.602.1" xmlns="http://www.w3.org/1999/xhtml">Figure 11.13: Adapter class diagram inheriting the Adaptee</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.603.1" xmlns="http://www.w3.org/1999/xhtml">The actors are the same, but instead of composing the </span><code><span class="koboSpan" id="kobo.604.1" xmlns="http://www.w3.org/1999/xhtml">Adapter</span></code><span class="koboSpan" id="kobo.605.1" xmlns="http://www.w3.org/1999/xhtml"> class with the </span><code><span class="koboSpan" id="kobo.606.1" xmlns="http://www.w3.org/1999/xhtml">Adaptee</span></code><span class="koboSpan" id="kobo.607.1" xmlns="http://www.w3.org/1999/xhtml"> class, the </span><code><span class="koboSpan" id="kobo.608.1" xmlns="http://www.w3.org/1999/xhtml">Adapter</span></code><span class="koboSpan" id="kobo.609.1" xmlns="http://www.w3.org/1999/xhtml"> class inherits from the </span><code><span class="koboSpan" id="kobo.610.1" xmlns="http://www.w3.org/1999/xhtml">Adaptee</span></code><span class="koboSpan" id="kobo.611.1" xmlns="http://www.w3.org/1999/xhtml"> class. </span><span class="koboSpan" id="kobo.611.2" xmlns="http://www.w3.org/1999/xhtml">This design makes the </span><code><span class="koboSpan" id="kobo.612.1" xmlns="http://www.w3.org/1999/xhtml">Adapter</span></code><span class="koboSpan" id="kobo.613.1" xmlns="http://www.w3.org/1999/xhtml"> class become both an </span><code><span class="koboSpan" id="kobo.614.1" xmlns="http://www.w3.org/1999/xhtml">Adaptee</span></code><span class="koboSpan" id="kobo.615.1" xmlns="http://www.w3.org/1999/xhtml"> and an </span><code><span class="koboSpan" id="kobo.616.1" xmlns="http://www.w3.org/1999/xhtml">ITarget</span></code><span class="koboSpan" id="kobo.617.1" xmlns="http://www.w3.org/1999/xhtml">.Let’s explore how this looks in code.</span></p>
</section>
<section class="level3" data-number="12.4.3" id="project-greeter">
<h3 data-number="12.4.3"><span class="koboSpan" id="kobo.618.1" xmlns="http://www.w3.org/1999/xhtml">Project – Greeter</span></h3>
<p><strong><span class="koboSpan" id="kobo.619.1" xmlns="http://www.w3.org/1999/xhtml">Context</span></strong><span class="koboSpan" id="kobo.620.1" xmlns="http://www.w3.org/1999/xhtml">: We’ve programmed a highly sophisticated greeting system that we want to reuse in a new program. </span><span class="koboSpan" id="kobo.620.2" xmlns="http://www.w3.org/1999/xhtml">However, its interface does not match the new design, and we cannot modify it because other systems use that greeting system.To fix this problem, we decided to apply the Adapter pattern. </span><span class="koboSpan" id="kobo.620.3" xmlns="http://www.w3.org/1999/xhtml">Here is the code of the external greeter (</span><code><span class="koboSpan" id="kobo.621.1" xmlns="http://www.w3.org/1999/xhtml">ExternalGreeter</span></code><span class="koboSpan" id="kobo.622.1" xmlns="http://www.w3.org/1999/xhtml">) and the new interface (</span><code><span class="koboSpan" id="kobo.623.1" xmlns="http://www.w3.org/1999/xhtml">IGreeter</span></code><span class="koboSpan" id="kobo.624.1" xmlns="http://www.w3.org/1999/xhtml">) used in the new system. </span><span class="koboSpan" id="kobo.624.2" xmlns="http://www.w3.org/1999/xhtml">This code must not directly modify the </span><code><span class="koboSpan" id="kobo.625.1" xmlns="http://www.w3.org/1999/xhtml">ExternalGreeter</span></code><span class="koboSpan" id="kobo.626.1" xmlns="http://www.w3.org/1999/xhtml"> class to prevent any breaking changes from occurring in other systems:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.627.1" xmlns="http://www.w3.org/1999/xhtml">public interface IGreeter
{
    string Greeting();
}
public class ExternalGreeter
{
    public string GreetByName(string name)
    {
        return $"Adaptee says: hi {name}!";
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.628.1" xmlns="http://www.w3.org/1999/xhtml">Next is how the external greeter is adapted to meet the latest requirements:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.629.1" xmlns="http://www.w3.org/1999/xhtml">public class ExternalGreeterAdapter : IGreeter
{
    private readonly ExternalGreeter _adaptee;
    public ExternalGreeterAdapter(ExternalGreeter adaptee)
    {
        _adaptee = adaptee ?? </span><span class="koboSpan" id="kobo.629.2" xmlns="http://www.w3.org/1999/xhtml">throw new ArgumentNullException(nameof(adaptee));
    }
    public string Greeting()
    {
        return _adaptee.GreetByName("ExternalGreeterAdapter");
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.630.1" xmlns="http://www.w3.org/1999/xhtml">In the preceding code, the actors are as follows:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.631.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.632.1" xmlns="http://www.w3.org/1999/xhtml">IGreeter</span></code><span class="koboSpan" id="kobo.633.1" xmlns="http://www.w3.org/1999/xhtml"> interface represents the </span><em><span class="koboSpan" id="kobo.634.1" xmlns="http://www.w3.org/1999/xhtml">Target</span></em><span class="koboSpan" id="kobo.635.1" xmlns="http://www.w3.org/1999/xhtml"> and is the interface that we must use.</span></li>
<li><span class="koboSpan" id="kobo.636.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.637.1" xmlns="http://www.w3.org/1999/xhtml">ExternalGreeter</span></code><span class="koboSpan" id="kobo.638.1" xmlns="http://www.w3.org/1999/xhtml"> class represents the </span><em><span class="koboSpan" id="kobo.639.1" xmlns="http://www.w3.org/1999/xhtml">Adaptee</span></em><span class="koboSpan" id="kobo.640.1" xmlns="http://www.w3.org/1999/xhtml"> and is the external component that already contains all the logic that someone programmed and tested. </span><span class="koboSpan" id="kobo.640.2" xmlns="http://www.w3.org/1999/xhtml">That code could be in an external assembly or installed from a NuGet package.</span></li>
<li><span class="koboSpan" id="kobo.641.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.642.1" xmlns="http://www.w3.org/1999/xhtml">ExternalGreeterAdapter</span></code><span class="koboSpan" id="kobo.643.1" xmlns="http://www.w3.org/1999/xhtml"> class represents the </span><em><span class="koboSpan" id="kobo.644.1" xmlns="http://www.w3.org/1999/xhtml">Adapter</span></em><span class="koboSpan" id="kobo.645.1" xmlns="http://www.w3.org/1999/xhtml"> and is where the adapter does its job. </span><span class="koboSpan" id="kobo.645.2" xmlns="http://www.w3.org/1999/xhtml">In this case, the </span><code><span class="koboSpan" id="kobo.646.1" xmlns="http://www.w3.org/1999/xhtml">Greeting</span></code><span class="koboSpan" id="kobo.647.1" xmlns="http://www.w3.org/1999/xhtml"> method calls the </span><code><span class="koboSpan" id="kobo.648.1" xmlns="http://www.w3.org/1999/xhtml">GreetByName</span></code><span class="koboSpan" id="kobo.649.1" xmlns="http://www.w3.org/1999/xhtml"> method of the </span><code><span class="koboSpan" id="kobo.650.1" xmlns="http://www.w3.org/1999/xhtml">ExternalGreeter</span></code><span class="koboSpan" id="kobo.651.1" xmlns="http://www.w3.org/1999/xhtml"> class, which implements the greeting logic.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.652.1" xmlns="http://www.w3.org/1999/xhtml">Now, we can call the </span><code><span class="koboSpan" id="kobo.653.1" xmlns="http://www.w3.org/1999/xhtml">Greeting</span></code><span class="koboSpan" id="kobo.654.1" xmlns="http://www.w3.org/1999/xhtml"> method and get the result of the </span><code><span class="koboSpan" id="kobo.655.1" xmlns="http://www.w3.org/1999/xhtml">GreetByName</span></code><span class="koboSpan" id="kobo.656.1" xmlns="http://www.w3.org/1999/xhtml"> call. </span><span class="koboSpan" id="kobo.656.2" xmlns="http://www.w3.org/1999/xhtml">With this in place, we can reuse the existing logic through the </span><code><span class="koboSpan" id="kobo.657.1" xmlns="http://www.w3.org/1999/xhtml">ExternalGreeterAdapter</span></code><span class="koboSpan" id="kobo.658.1" xmlns="http://www.w3.org/1999/xhtml"> class.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.659.1" xmlns="http://www.w3.org/1999/xhtml">We can also test </span><code><span class="koboSpan" id="kobo.660.1" xmlns="http://www.w3.org/1999/xhtml">IGreeter</span></code><span class="koboSpan" id="kobo.661.1" xmlns="http://www.w3.org/1999/xhtml"> consumers by mocking the </span><code><span class="koboSpan" id="kobo.662.1" xmlns="http://www.w3.org/1999/xhtml">IGreeter</span></code><span class="koboSpan" id="kobo.663.1" xmlns="http://www.w3.org/1999/xhtml"> interface without dealing with the </span><code><span class="koboSpan" id="kobo.664.1" xmlns="http://www.w3.org/1999/xhtml">ExternalGreeterAdapter</span></code><span class="koboSpan" id="kobo.665.1" xmlns="http://www.w3.org/1999/xhtml"> class.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.666.1" xmlns="http://www.w3.org/1999/xhtml">In this case, the “complex logic” is pretty simple, but we are here for the Adapter pattern, not for imaginary business logic. </span><span class="koboSpan" id="kobo.666.2" xmlns="http://www.w3.org/1999/xhtml">Now, let’s take a look at the consumer:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.667.1" xmlns="http://www.w3.org/1999/xhtml">var builder = WebApplication.CreateBuilder(args);
builder.Services.AddSingleton&lt;ExternalGreeter&gt;();
builder.Services.AddSingleton&lt;IGreeter, ExternalGreeterAdapter&gt;();
var app = builder.Build();
app.MapGet("/", (IGreeter greeter) =&gt; greeter.Greeting());
app.Run();</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.668.1" xmlns="http://www.w3.org/1999/xhtml">In the preceding code, we composed our application by registering the </span><code><span class="koboSpan" id="kobo.669.1" xmlns="http://www.w3.org/1999/xhtml">ExternalGreeterAdapter</span></code><span class="koboSpan" id="kobo.670.1" xmlns="http://www.w3.org/1999/xhtml"> class as a singleton bound to the </span><code><span class="koboSpan" id="kobo.671.1" xmlns="http://www.w3.org/1999/xhtml">IGreeter</span></code><span class="koboSpan" id="kobo.672.1" xmlns="http://www.w3.org/1999/xhtml"> interface. </span><span class="koboSpan" id="kobo.672.2" xmlns="http://www.w3.org/1999/xhtml">We also informed the container to provide a single instance of </span><code><span class="koboSpan" id="kobo.673.1" xmlns="http://www.w3.org/1999/xhtml">ExternalGreeter</span></code><span class="koboSpan" id="kobo.674.1" xmlns="http://www.w3.org/1999/xhtml"> class whenever requested (in this case, we inject it into the </span><code><span class="koboSpan" id="kobo.675.1" xmlns="http://www.w3.org/1999/xhtml">ExternalGreeterAdapter</span></code><span class="koboSpan" id="kobo.676.1" xmlns="http://www.w3.org/1999/xhtml"> class).Then, the consumer (</span><em><span class="koboSpan" id="kobo.677.1" xmlns="http://www.w3.org/1999/xhtml">Client</span></em><span class="koboSpan" id="kobo.678.1" xmlns="http://www.w3.org/1999/xhtml"> in the class diagrams) is the highlighted endpoint where the </span><code><span class="koboSpan" id="kobo.679.1" xmlns="http://www.w3.org/1999/xhtml">IGreeter</span></code><span class="koboSpan" id="kobo.680.1" xmlns="http://www.w3.org/1999/xhtml"> interface is injected as a parameter. </span><span class="koboSpan" id="kobo.680.2" xmlns="http://www.w3.org/1999/xhtml">Then, the delegate calls the </span><code><span class="koboSpan" id="kobo.681.1" xmlns="http://www.w3.org/1999/xhtml">Greeting</span></code><span class="koboSpan" id="kobo.682.1" xmlns="http://www.w3.org/1999/xhtml"> method on that injected instance and outputs the greeting message to the response.The following diagram represents what’s happening in this system:</span></p>
<figure>
<span class="koboSpan" id="kobo.683.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 11.14: Greeter system sequence diagram" src="../media/file62.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.684.1" xmlns="http://www.w3.org/1999/xhtml">Figure 11.14: Greeter system sequence diagram</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.685.1" xmlns="http://www.w3.org/1999/xhtml">And voilà! </span><span class="koboSpan" id="kobo.685.2" xmlns="http://www.w3.org/1999/xhtml">We’ve adapted the </span><code><span class="koboSpan" id="kobo.686.1" xmlns="http://www.w3.org/1999/xhtml">ExternalGreeterAdapter</span></code><span class="koboSpan" id="kobo.687.1" xmlns="http://www.w3.org/1999/xhtml"> class to the </span><code><span class="koboSpan" id="kobo.688.1" xmlns="http://www.w3.org/1999/xhtml">IGreeter</span></code><span class="koboSpan" id="kobo.689.1" xmlns="http://www.w3.org/1999/xhtml"> interface with little effort.</span></p>
</section>
<section class="level3" data-number="12.4.4" id="conclusion-17">
<h3 data-number="12.4.4"><span class="koboSpan" id="kobo.690.1" xmlns="http://www.w3.org/1999/xhtml">Conclusion</span></h3>
<p><span class="koboSpan" id="kobo.691.1" xmlns="http://www.w3.org/1999/xhtml">The Adapter pattern is another simple pattern that offers flexibility. </span><span class="koboSpan" id="kobo.691.2" xmlns="http://www.w3.org/1999/xhtml">With it, we can use older or non-conforming components without rewriting them. </span><span class="koboSpan" id="kobo.691.3" xmlns="http://www.w3.org/1999/xhtml">Of course, depending on the </span><em><span class="koboSpan" id="kobo.692.1" xmlns="http://www.w3.org/1999/xhtml">Target</span></em><span class="koboSpan" id="kobo.693.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><em><span class="koboSpan" id="kobo.694.1" xmlns="http://www.w3.org/1999/xhtml">Adaptee</span></em><span class="koboSpan" id="kobo.695.1" xmlns="http://www.w3.org/1999/xhtml"> interfaces, you may need to put more or less effort into writing the code of the </span><em><span class="koboSpan" id="kobo.696.1" xmlns="http://www.w3.org/1999/xhtml">Adapter</span></em><span class="koboSpan" id="kobo.697.1" xmlns="http://www.w3.org/1999/xhtml"> class.Now, let’s learn how the Adapter pattern can help us follow the </span><strong><span class="koboSpan" id="kobo.698.1" xmlns="http://www.w3.org/1999/xhtml">SOLID</span></strong><span class="koboSpan" id="kobo.699.1" xmlns="http://www.w3.org/1999/xhtml"> principles:</span></p>
<ul>
<li><strong><span class="koboSpan" id="kobo.700.1" xmlns="http://www.w3.org/1999/xhtml">S</span></strong><span class="koboSpan" id="kobo.701.1" xmlns="http://www.w3.org/1999/xhtml">: The Adapter pattern has only one responsibility: make an interface work with another interface.</span></li>
<li><strong><span class="koboSpan" id="kobo.702.1" xmlns="http://www.w3.org/1999/xhtml">O</span></strong><span class="koboSpan" id="kobo.703.1" xmlns="http://www.w3.org/1999/xhtml">: The Adapter pattern allows us to modify the </span><em><span class="koboSpan" id="kobo.704.1" xmlns="http://www.w3.org/1999/xhtml">Adaptee’s</span></em><span class="koboSpan" id="kobo.705.1" xmlns="http://www.w3.org/1999/xhtml"> interface without the need to modify its code.</span></li>
<li><strong><span class="koboSpan" id="kobo.706.1" xmlns="http://www.w3.org/1999/xhtml">L</span></strong><span class="koboSpan" id="kobo.707.1" xmlns="http://www.w3.org/1999/xhtml">: Inheritance is not much of a concern regarding the Adapter pattern, so this principle does not apply once again. </span><span class="koboSpan" id="kobo.707.2" xmlns="http://www.w3.org/1999/xhtml">If </span><em><span class="koboSpan" id="kobo.708.1" xmlns="http://www.w3.org/1999/xhtml">Adapter</span></em><span class="koboSpan" id="kobo.709.1" xmlns="http://www.w3.org/1999/xhtml"> inherits from </span><em><span class="koboSpan" id="kobo.710.1" xmlns="http://www.w3.org/1999/xhtml">Adaptee</span></em><span class="koboSpan" id="kobo.711.1" xmlns="http://www.w3.org/1999/xhtml">, the goal is to change its interface, not its behavior, which should conform to the LSP.</span></li>
<li><strong><span class="koboSpan" id="kobo.712.1" xmlns="http://www.w3.org/1999/xhtml">I</span></strong><span class="koboSpan" id="kobo.713.1" xmlns="http://www.w3.org/1999/xhtml">: We can view the </span><em><span class="koboSpan" id="kobo.714.1" xmlns="http://www.w3.org/1999/xhtml">Adapter</span></em><span class="koboSpan" id="kobo.715.1" xmlns="http://www.w3.org/1999/xhtml"> class as a facilitator to the ISP, with the </span><em><span class="koboSpan" id="kobo.716.1" xmlns="http://www.w3.org/1999/xhtml">Target</span></em><span class="koboSpan" id="kobo.717.1" xmlns="http://www.w3.org/1999/xhtml"> interface as the ultimate destination. </span><span class="koboSpan" id="kobo.717.2" xmlns="http://www.w3.org/1999/xhtml">The Adapter pattern relies on the design of the </span><em><span class="koboSpan" id="kobo.718.1" xmlns="http://www.w3.org/1999/xhtml">Target</span></em><span class="koboSpan" id="kobo.719.1" xmlns="http://www.w3.org/1999/xhtml"> interface but doesn't directly influence it. </span><span class="koboSpan" id="kobo.719.2" xmlns="http://www.w3.org/1999/xhtml">Per this principle, our primary focus should be to design the </span><em><span class="koboSpan" id="kobo.720.1" xmlns="http://www.w3.org/1999/xhtml">Target</span></em><span class="koboSpan" id="kobo.721.1" xmlns="http://www.w3.org/1999/xhtml"> interface in a manner that abides by the ISP.</span></li>
<li><strong><span class="koboSpan" id="kobo.722.1" xmlns="http://www.w3.org/1999/xhtml">D</span></strong><span class="koboSpan" id="kobo.723.1" xmlns="http://www.w3.org/1999/xhtml">: The Adapter pattern introduces only an implementation of the </span><em><span class="koboSpan" id="kobo.724.1" xmlns="http://www.w3.org/1999/xhtml">Target</span></em><span class="koboSpan" id="kobo.725.1" xmlns="http://www.w3.org/1999/xhtml"> interface. </span><span class="koboSpan" id="kobo.725.2" xmlns="http://www.w3.org/1999/xhtml">Even if the </span><em><span class="koboSpan" id="kobo.726.1" xmlns="http://www.w3.org/1999/xhtml">Adapter</span></em><span class="koboSpan" id="kobo.727.1" xmlns="http://www.w3.org/1999/xhtml"> depends on a concrete class, it breaks the direct dependency on that external component by adapting it to the </span><em><span class="koboSpan" id="kobo.728.1" xmlns="http://www.w3.org/1999/xhtml">Target</span></em><span class="koboSpan" id="kobo.729.1" xmlns="http://www.w3.org/1999/xhtml"> interface.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.730.1" xmlns="http://www.w3.org/1999/xhtml">Next, we explore the last structural pattern of the chapter that teaches foundational concepts.</span></p>
</section>
</section>
<section class="level2" data-number="12.5" id="implementing-the-façade-design-pattern">
<h2 data-number="12.5"><span class="koboSpan" id="kobo.731.1" xmlns="http://www.w3.org/1999/xhtml">Implementing the Façade design pattern</span></h2>
<p><span class="koboSpan" id="kobo.732.1" xmlns="http://www.w3.org/1999/xhtml">The Façade pattern is a structural pattern that simplifies the access to a complex system. </span><span class="koboSpan" id="kobo.732.2" xmlns="http://www.w3.org/1999/xhtml">It is very similar to the Adapter pattern, but it creates a wall (a façade) between one or more subsystems. </span><span class="koboSpan" id="kobo.732.3" xmlns="http://www.w3.org/1999/xhtml">The big difference between the adapter and the façade is that instead of adapting an interface to another, the façade simplifies the use of a subsystem, typically by using multiple classes of that subsystem.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.733.1" xmlns="http://www.w3.org/1999/xhtml">We can apply the same idea to shielding one or more programs, but in this case, we call the façade a gateway—more on that in </span><em><span class="koboSpan" id="kobo.734.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 19</span></em><span class="koboSpan" id="kobo.735.1" xmlns="http://www.w3.org/1999/xhtml">, </span><em><span class="koboSpan" id="kobo.736.1" xmlns="http://www.w3.org/1999/xhtml">Introduction to Microservices Architecture</span></em><span class="koboSpan" id="kobo.737.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.738.1" xmlns="http://www.w3.org/1999/xhtml">The Façade pattern is extremely useful and can be adapted to multiple situations.</span></p>
<section class="level3" data-number="12.5.1" id="goal-10">
<h3 data-number="12.5.1"><span class="koboSpan" id="kobo.739.1" xmlns="http://www.w3.org/1999/xhtml">Goal</span></h3>
<p><span class="koboSpan" id="kobo.740.1" xmlns="http://www.w3.org/1999/xhtml">The Façade pattern aims to simplify the use of one or more subsystems by providing an interface that is easier to use than the subsystems themselves, shielding the consumers from that complexity.</span></p>
</section>
<section class="level3" data-number="12.5.2" id="design-10">
<h3 data-number="12.5.2"><span class="koboSpan" id="kobo.741.1" xmlns="http://www.w3.org/1999/xhtml">Design</span></h3>
<p><span class="koboSpan" id="kobo.742.1" xmlns="http://www.w3.org/1999/xhtml">Imagine a system with a multitude of complex classes. </span><span class="koboSpan" id="kobo.742.2" xmlns="http://www.w3.org/1999/xhtml">Direct interaction between the consuming code and these classes can become problematic due to coupling, complexity, and low code readability and maintainability. </span><span class="koboSpan" id="kobo.742.3" xmlns="http://www.w3.org/1999/xhtml">The Facade design pattern offers a solution by providing a unified interface to a set of APIs in a subsystem, making it easier to use.The Facade class contains references to the objects of the complex subsystem and delegates client requests to the appropriate subsystem object. </span><span class="koboSpan" id="kobo.742.4" xmlns="http://www.w3.org/1999/xhtml">From a client's perspective, it only interacts with a single, simplified interface represented by the Facade. </span><span class="koboSpan" id="kobo.742.5" xmlns="http://www.w3.org/1999/xhtml">Behind the scenes, the Facade coordinates with the subsystem's components to fulfill the client's request.We could create multiple diagrams representing a multitude of subsystems, but let’s keep things simple. </span><span class="koboSpan" id="kobo.742.6" xmlns="http://www.w3.org/1999/xhtml">Remember that you can replace the single subsystem shown in the following diagram with as many subsystems as you need to adapt:</span></p>
<figure>
<span class="koboSpan" id="kobo.743.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 11.15: A class diagram representing a Façade object that hides a complex subsystem" src="../media/file63.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.744.1" xmlns="http://www.w3.org/1999/xhtml">Figure 11.15: A class diagram representing a Façade object that hides a complex subsystem</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.745.1" xmlns="http://www.w3.org/1999/xhtml">The </span><em><span class="koboSpan" id="kobo.746.1" xmlns="http://www.w3.org/1999/xhtml">Façade</span></em><span class="koboSpan" id="kobo.747.1" xmlns="http://www.w3.org/1999/xhtml"> plays the intermediary between the </span><em><span class="koboSpan" id="kobo.748.1" xmlns="http://www.w3.org/1999/xhtml">Client</span></em><span class="koboSpan" id="kobo.749.1" xmlns="http://www.w3.org/1999/xhtml"> and the subsystem, simplifying its usage. </span><span class="koboSpan" id="kobo.749.2" xmlns="http://www.w3.org/1999/xhtml">Let’s see this in action as a sequence diagram:</span></p>
<figure>
<span class="koboSpan" id="kobo.750.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 11.16: A sequence diagram representing a Façade object that interacts with a complex subsystem" src="../media/file64.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.751.1" xmlns="http://www.w3.org/1999/xhtml">Figure 11.16: A sequence diagram representing a Façade object that interacts with a complex subsystem</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.752.1" xmlns="http://www.w3.org/1999/xhtml">In the preceding diagram, the </span><em><span class="koboSpan" id="kobo.753.1" xmlns="http://www.w3.org/1999/xhtml">Client</span></em><span class="koboSpan" id="kobo.754.1" xmlns="http://www.w3.org/1999/xhtml"> calls the </span><em><span class="koboSpan" id="kobo.755.1" xmlns="http://www.w3.org/1999/xhtml">Façade</span></em><span class="koboSpan" id="kobo.756.1" xmlns="http://www.w3.org/1999/xhtml"> once, while the </span><em><span class="koboSpan" id="kobo.757.1" xmlns="http://www.w3.org/1999/xhtml">Façade</span></em><span class="koboSpan" id="kobo.758.1" xmlns="http://www.w3.org/1999/xhtml"> places multiple calls against different classes.There are multiple ways of implementing a façade:</span></p>
<ul>
<li><strong><span class="koboSpan" id="kobo.759.1" xmlns="http://www.w3.org/1999/xhtml">Opaque façades</span></strong><span class="koboSpan" id="kobo.760.1" xmlns="http://www.w3.org/1999/xhtml">: In this form, the </span><code><span class="koboSpan" id="kobo.761.1" xmlns="http://www.w3.org/1999/xhtml">Façade</span></code><span class="koboSpan" id="kobo.762.1" xmlns="http://www.w3.org/1999/xhtml"> class is inside the subsystem. </span><span class="koboSpan" id="kobo.762.2" xmlns="http://www.w3.org/1999/xhtml">All other classes of the subsystem have an </span><code><span class="koboSpan" id="kobo.763.1" xmlns="http://www.w3.org/1999/xhtml">internal</span></code><span class="koboSpan" id="kobo.764.1" xmlns="http://www.w3.org/1999/xhtml"> visibility modifier. </span><span class="koboSpan" id="kobo.764.2" xmlns="http://www.w3.org/1999/xhtml">This way, only the classes inside the subsystem can interact with the other internal classes, forcing the consumers to use the </span><code><span class="koboSpan" id="kobo.765.1" xmlns="http://www.w3.org/1999/xhtml">Façade</span></code><span class="koboSpan" id="kobo.766.1" xmlns="http://www.w3.org/1999/xhtml"> class.</span></li>
<li><strong><span class="koboSpan" id="kobo.767.1" xmlns="http://www.w3.org/1999/xhtml">Transparent façades</span></strong><span class="koboSpan" id="kobo.768.1" xmlns="http://www.w3.org/1999/xhtml">: In this form, the classes can have a </span><code><span class="koboSpan" id="kobo.769.1" xmlns="http://www.w3.org/1999/xhtml">public</span></code><span class="koboSpan" id="kobo.770.1" xmlns="http://www.w3.org/1999/xhtml"> modifier, allowing the consumers to use them directly or to use the </span><code><span class="koboSpan" id="kobo.771.1" xmlns="http://www.w3.org/1999/xhtml">Façade</span></code><span class="koboSpan" id="kobo.772.1" xmlns="http://www.w3.org/1999/xhtml"> class. </span><span class="koboSpan" id="kobo.772.2" xmlns="http://www.w3.org/1999/xhtml">This way, we can create the </span><code><span class="koboSpan" id="kobo.773.1" xmlns="http://www.w3.org/1999/xhtml">Façade</span></code><span class="koboSpan" id="kobo.774.1" xmlns="http://www.w3.org/1999/xhtml"> class inside or outside the subsystem.</span></li>
<li><strong><span class="koboSpan" id="kobo.775.1" xmlns="http://www.w3.org/1999/xhtml">Static façades</span></strong><span class="koboSpan" id="kobo.776.1" xmlns="http://www.w3.org/1999/xhtml">: In this form, the </span><code><span class="koboSpan" id="kobo.777.1" xmlns="http://www.w3.org/1999/xhtml">Façade</span></code><span class="koboSpan" id="kobo.778.1" xmlns="http://www.w3.org/1999/xhtml"> class is </span><code><span class="koboSpan" id="kobo.779.1" xmlns="http://www.w3.org/1999/xhtml">static</span></code><span class="koboSpan" id="kobo.780.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.780.2" xmlns="http://www.w3.org/1999/xhtml">We can implement a static façade as opaque or transparent.</span></li>
</ul>
<blockquote>
<p><span class="koboSpan" id="kobo.781.1" xmlns="http://www.w3.org/1999/xhtml">I recommend using static façades as a last resort because </span><code><span class="koboSpan" id="kobo.782.1" xmlns="http://www.w3.org/1999/xhtml">static</span></code><span class="koboSpan" id="kobo.783.1" xmlns="http://www.w3.org/1999/xhtml"> elements limit flexibility and testability.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.784.1" xmlns="http://www.w3.org/1999/xhtml">We look at some code next.</span></p>
</section>
<section class="level3" data-number="12.5.3" id="project-the-façades">
<h3 data-number="12.5.3"><span class="koboSpan" id="kobo.785.1" xmlns="http://www.w3.org/1999/xhtml">Project – The façades</span></h3>
<p><span class="koboSpan" id="kobo.786.1" xmlns="http://www.w3.org/1999/xhtml">In this example, we play with the following C# projects:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.787.1" xmlns="http://www.w3.org/1999/xhtml">The </span><em><span class="koboSpan" id="kobo.788.1" xmlns="http://www.w3.org/1999/xhtml">OpaqueFacadeSubSystem</span></em><span class="koboSpan" id="kobo.789.1" xmlns="http://www.w3.org/1999/xhtml"> class library showcases an </span><strong><span class="koboSpan" id="kobo.790.1" xmlns="http://www.w3.org/1999/xhtml">opaque façade</span></strong><span class="koboSpan" id="kobo.791.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li><span class="koboSpan" id="kobo.792.1" xmlns="http://www.w3.org/1999/xhtml">The </span><em><span class="koboSpan" id="kobo.793.1" xmlns="http://www.w3.org/1999/xhtml">TransparentFacadeSubSystem</span></em><span class="koboSpan" id="kobo.794.1" xmlns="http://www.w3.org/1999/xhtml"> class library showcases a </span><strong><span class="koboSpan" id="kobo.795.1" xmlns="http://www.w3.org/1999/xhtml">transparent façade</span></strong><span class="koboSpan" id="kobo.796.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li><span class="koboSpan" id="kobo.797.1" xmlns="http://www.w3.org/1999/xhtml">The </span><em><span class="koboSpan" id="kobo.798.1" xmlns="http://www.w3.org/1999/xhtml">Facade</span></em><span class="koboSpan" id="kobo.799.1" xmlns="http://www.w3.org/1999/xhtml"> project is a REST API that consumes the façades. </span><span class="koboSpan" id="kobo.799.2" xmlns="http://www.w3.org/1999/xhtml">It exposes two endpoints to access the </span><em><span class="koboSpan" id="kobo.800.1" xmlns="http://www.w3.org/1999/xhtml">OpaqueFacadeSubSystem</span></em><span class="koboSpan" id="kobo.801.1" xmlns="http://www.w3.org/1999/xhtml"> project, and two others that target the </span><em><span class="koboSpan" id="kobo.802.1" xmlns="http://www.w3.org/1999/xhtml">TransparentFacadeSubSystem</span></em><span class="koboSpan" id="kobo.803.1" xmlns="http://www.w3.org/1999/xhtml"> project.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.804.1" xmlns="http://www.w3.org/1999/xhtml">Let’s start with the class libraries.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.805.1" xmlns="http://www.w3.org/1999/xhtml">To follow the SOLID principles, adding some interfaces representing the elements of the subsystem seemed appropriate. </span><span class="koboSpan" id="kobo.805.2" xmlns="http://www.w3.org/1999/xhtml">In subsequent chapters, we explore how to organize our abstractions to be more reusable, but for now, both abstractions and implementations are in the same assembly.</span></p>
</blockquote>
<section class="level4" data-number="12.5.3.1" id="opaque-façade">
<h4 data-number="12.5.3.1"><span class="koboSpan" id="kobo.806.1" xmlns="http://www.w3.org/1999/xhtml">Opaque façade</span></h4>
<p><span class="koboSpan" id="kobo.807.1" xmlns="http://www.w3.org/1999/xhtml">In this assembly, only the façade is public; all the other classes are internal, which means they are hidden from the external world. </span><span class="koboSpan" id="kobo.807.2" xmlns="http://www.w3.org/1999/xhtml">In most cases, this is not ideal; hiding everything makes the subsystem less flexible and harder to extend.However, you may want to control access to your internal APIs in some scenarios. </span><span class="koboSpan" id="kobo.807.3" xmlns="http://www.w3.org/1999/xhtml">This may be because they are not mature enough and you don’t want any third party to depend on them, or for any other reasons you deem appropriate for your specific use case.Let’s start by taking a look at the following subsystem code:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.808.1" xmlns="http://www.w3.org/1999/xhtml">// An added interface for flexibility
public interface IOpaqueFacade
{
    string ExecuteOperationA();
    string ExecuteOperationB();
}
// A hidden component
internal class ComponentA
{
    public string OperationA() =&gt; "Component A, Operation A";
    public string OperationB() =&gt; "Component A, Operation B";
}
// A hidden component
internal class ComponentB
{
    public string OperationC() =&gt; "Component B, Operation C";
    public string OperationD() =&gt; "Component B, Operation D";
}
// A hidden component
internal class ComponentC
{
    public string OperationE() =&gt; "Component C, Operation E";
    public string OperationF() =&gt; "Component C, Operation F";
}
// The opaque façade using the other hidden components
public class OpaqueFacade : IOpaqueFacade
{
    private readonly ComponentA _componentA;
    private readonly ComponentB _componentB;
    private readonly ComponentC _componentC;
    // Using constructor injection
    internal OpaqueFacade(ComponentA componentA, ComponentB componentB, ComponentC componentC)
    {
        _componentA = componentA ?? </span><span class="koboSpan" id="kobo.808.2" xmlns="http://www.w3.org/1999/xhtml">throw new ArgumentNullException(nameof(componentA));
        _componentB = componentB ?? </span><span class="koboSpan" id="kobo.808.3" xmlns="http://www.w3.org/1999/xhtml">throw new ArgumentNullException(nameof(componentB));
        _componentC = componentC ?? </span><span class="koboSpan" id="kobo.808.4" xmlns="http://www.w3.org/1999/xhtml">throw new ArgumentNullException(nameof(componentC));
    }
    public string ExecuteOperationA()
    {
        return new StringBuilder()
            .AppendLine(_componentA.OperationA())
            .AppendLine(_componentA.OperationB())
            .AppendLine(_componentB.OperationD())
            .AppendLine(_componentC.OperationE())
            .ToString();
    }
    public string ExecuteOperationB()
    {
        return new StringBuilder()
            .AppendLine(_componentB.OperationC())
            .AppendLine(_componentB.OperationD())
            .AppendLine(_componentC.OperationF())
            .ToString();
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.809.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.810.1" xmlns="http://www.w3.org/1999/xhtml">OpaqueFacade</span></code><span class="koboSpan" id="kobo.811.1" xmlns="http://www.w3.org/1999/xhtml"> class is coupled with </span><code><span class="koboSpan" id="kobo.812.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.813.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.814.1" xmlns="http://www.w3.org/1999/xhtml">ComponentB</span></code><span class="koboSpan" id="kobo.815.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code><span class="koboSpan" id="kobo.816.1" xmlns="http://www.w3.org/1999/xhtml">ComponentC</span></code><span class="koboSpan" id="kobo.817.1" xmlns="http://www.w3.org/1999/xhtml"> directly. </span><span class="koboSpan" id="kobo.817.2" xmlns="http://www.w3.org/1999/xhtml">There was no point in extracting any </span><code><span class="koboSpan" id="kobo.818.1" xmlns="http://www.w3.org/1999/xhtml">internal</span></code><span class="koboSpan" id="kobo.819.1" xmlns="http://www.w3.org/1999/xhtml"> interfaces since the subsystem is not extensible anyway. </span><span class="koboSpan" id="kobo.819.2" xmlns="http://www.w3.org/1999/xhtml">We could have done this to offer some kind of internal flexibility, but in this case, there was no advantage.Besides this coupling, </span><code><span class="koboSpan" id="kobo.820.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.821.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.822.1" xmlns="http://www.w3.org/1999/xhtml">ComponentB</span></code><span class="koboSpan" id="kobo.823.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code><span class="koboSpan" id="kobo.824.1" xmlns="http://www.w3.org/1999/xhtml">ComponentC</span></code><span class="koboSpan" id="kobo.825.1" xmlns="http://www.w3.org/1999/xhtml"> define two methods each, which return a string describing their source. </span><span class="koboSpan" id="kobo.825.2" xmlns="http://www.w3.org/1999/xhtml">With that code in place, we can observe what is happening and how the final result was composed.</span><code><span class="koboSpan" id="kobo.826.1" xmlns="http://www.w3.org/1999/xhtml">OpaqueFacade</span></code><span class="koboSpan" id="kobo.827.1" xmlns="http://www.w3.org/1999/xhtml"> also exposes two methods, each composing a different message using the underlying subsystem’s components. </span><span class="koboSpan" id="kobo.827.2" xmlns="http://www.w3.org/1999/xhtml">This is a classic use of a façade; the façade queries other objects more or less complicatedly and then does something with the results, taking away the caller’s burden of knowing the subsystem.Since the members use the </span><code><span class="koboSpan" id="kobo.828.1" xmlns="http://www.w3.org/1999/xhtml">internal</span></code><span class="koboSpan" id="kobo.829.1" xmlns="http://www.w3.org/1999/xhtml"> visibility modifier, we can’t directly register the dependencies with the IoC container from the program. </span><span class="koboSpan" id="kobo.829.2" xmlns="http://www.w3.org/1999/xhtml">To solve this problem, the subsystem can register its dependencies by adding an extension method. </span><span class="koboSpan" id="kobo.829.3" xmlns="http://www.w3.org/1999/xhtml">The following extension method is accessible by the consuming application:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.830.1" xmlns="http://www.w3.org/1999/xhtml">public static class StartupExtensions
{
    public static IServiceCollection AddOpaqueFacadeSubSystem(this IServiceCollection services)
    {
        services.AddSingleton&lt;IOpaqueFacade&gt;(serviceProvider
            =&gt; new OpaqueFacade(new ComponentA(), new ComponentB(), new ComponentC()));
        return services;
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.831.1" xmlns="http://www.w3.org/1999/xhtml">The preceding code manually creates the dependencies and adds a binding to the </span><code><span class="koboSpan" id="kobo.832.1" xmlns="http://www.w3.org/1999/xhtml">IOpaqueFacade</span></code><span class="koboSpan" id="kobo.833.1" xmlns="http://www.w3.org/1999/xhtml"> interface so the system can use it. </span><span class="koboSpan" id="kobo.833.2" xmlns="http://www.w3.org/1999/xhtml">This hides everything but the interface from the consumer.Before exploring the REST API, we look at the transparent façade implementation.</span></p>
</section>
<section class="level4" data-number="12.5.3.2" id="transparent-façade">
<h4 data-number="12.5.3.2"><span class="koboSpan" id="kobo.834.1" xmlns="http://www.w3.org/1999/xhtml">Transparent façade</span></h4>
<p><span class="koboSpan" id="kobo.835.1" xmlns="http://www.w3.org/1999/xhtml">The transparent façade is the most flexible type of façade and is exceptionally suitable for a system that leverages dependency injection. </span><span class="koboSpan" id="kobo.835.2" xmlns="http://www.w3.org/1999/xhtml">The implementation is similar to the opaque façade, but the </span><code><span class="koboSpan" id="kobo.836.1" xmlns="http://www.w3.org/1999/xhtml">public</span></code><span class="koboSpan" id="kobo.837.1" xmlns="http://www.w3.org/1999/xhtml"> visibility modifier changes how consumers can access the class library elements. </span><span class="koboSpan" id="kobo.837.2" xmlns="http://www.w3.org/1999/xhtml">For this system, it was worth adding interfaces to allow the consumers of the subsystem to extend it when needed.First, let’s take a look at the abstractions:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.838.1" xmlns="http://www.w3.org/1999/xhtml">namespace TransparentFacadeSubSystem.Abstractions
{
    public interface ITransparentFacade
    {
        string ExecuteOperationA();
        string ExecuteOperationB();
    }
    public interface IComponentA
    {
        string OperationA();
        string OperationB();
    }
    public interface IComponentB
    {
        string OperationC();
        string OperationD();
    }
    public interface IComponentC
    {
        string OperationE();
        string OperationF();
    
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.839.1" xmlns="http://www.w3.org/1999/xhtml">The API of this subsystem is the same as the opaque façade. </span><span class="koboSpan" id="kobo.839.2" xmlns="http://www.w3.org/1999/xhtml">The only difference is how we can use and extend the subsystem (from a consumer standpoint). </span><span class="koboSpan" id="kobo.839.3" xmlns="http://www.w3.org/1999/xhtml">The implementations are mostly the same as well, but the classes implement the interfaces and are </span><code><span class="koboSpan" id="kobo.840.1" xmlns="http://www.w3.org/1999/xhtml">public</span></code><span class="koboSpan" id="kobo.841.1" xmlns="http://www.w3.org/1999/xhtml">; the highlighted elements represent those changes:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.842.1" xmlns="http://www.w3.org/1999/xhtml">namespace TransparentFacadeSubSystem
{
    public class ComponentA : IComponentA
    {
        public string OperationA() =&gt; "Component A, Operation A";
        public string OperationB() =&gt; "Component A, Operation B";
}
    public class ComponentB : IComponentB
    {
        public string OperationC() =&gt; "Component B, Operation C";
        public string OperationD() =&gt; "Component B, Operation D";
    }
    public class ComponentC : IComponentC
    {
        public string OperationE() =&gt; "Component C, Operation E";
        public string OperationF() =&gt; "Component C, Operation F";
    }
    public class TransparentFacade : ITransparentFacade
    {
        private readonly IComponentA _componentA;
        private readonly IComponentB _componentB;
        private readonly IComponentC _componentC;
    public TransparentFacade(IComponentA componentA, IComponentB
componentB, IComponentC componentC)
    {
        _componentA = componentA ?? </span><span class="koboSpan" id="kobo.842.2" xmlns="http://www.w3.org/1999/xhtml">throw new ArgumentNullException(nameof(componentA));
        _componentB = componentB ?? </span><span class="koboSpan" id="kobo.842.3" xmlns="http://www.w3.org/1999/xhtml">throw new ArgumentNullException(nameof(componentB));
        _componentC = componentC ?? </span><span class="koboSpan" id="kobo.842.4" xmlns="http://www.w3.org/1999/xhtml">throw new ArgumentNullException(nameof(componentC));
    }
        public string ExecuteOperationA()
        {
            return new StringBuilder()
                .AppendLine(_componentA.OperationA())
                .AppendLine(_componentA.OperationB())
                .AppendLine(_componentB.OperationD())
                .AppendLine(_componentC.OperationE())
                .ToString();
            }
        public string ExecuteOperationB()
        {
            return new StringBuilder()
                .AppendLine(_componentB.OperationC())
                .AppendLine(_componentB.OperationD())
                .AppendLine(_componentC.OperationF())
                .ToString();
        }
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.843.1" xmlns="http://www.w3.org/1999/xhtml">To simplify the use of the subsystem, we create the following extension method as a good practice that makes consuming the subsystem easier. </span><span class="koboSpan" id="kobo.843.2" xmlns="http://www.w3.org/1999/xhtml">Everything that we define in that method can be overridden from the composition root (which is not the case for the opaque façade):</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.844.1" xmlns="http://www.w3.org/1999/xhtml">public static class StartupExtensions
{
    public static IServiceCollection AddTransparentFacadeSubSystem(this IServiceCollection services)
    {
        services.AddSingleton&lt;ITransparentFacade, TransparentFacade&gt;();
        services.AddSingleton&lt;IComponentA, ComponentA&gt;();
        services.AddSingleton&lt;IComponentB, ComponentB&gt;();
        services.AddSingleton&lt;IComponentC, ComponentC&gt;();
        return services;
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.845.1" xmlns="http://www.w3.org/1999/xhtml">All the </span><code><span class="koboSpan" id="kobo.846.1" xmlns="http://www.w3.org/1999/xhtml">new</span></code><span class="koboSpan" id="kobo.847.1" xmlns="http://www.w3.org/1999/xhtml"> elements are gone and have been replaced by simple dependency registration (singleton lifetimes, in this case). </span><span class="koboSpan" id="kobo.847.2" xmlns="http://www.w3.org/1999/xhtml">These little differences give us the tools to reimplement any part of the subsystem if we want to, as we cover soon.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.848.1" xmlns="http://www.w3.org/1999/xhtml">We can register bindings in the transparent façade extension method because classes and interfaces are </span><code><span class="koboSpan" id="kobo.849.1" xmlns="http://www.w3.org/1999/xhtml">public</span></code><span class="koboSpan" id="kobo.850.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.850.2" xmlns="http://www.w3.org/1999/xhtml">The container needs a public constructor to do its work.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.851.1" xmlns="http://www.w3.org/1999/xhtml">In the opaque façade, we had to define the constructor of the </span><code><span class="koboSpan" id="kobo.852.1" xmlns="http://www.w3.org/1999/xhtml">OpaqueFacade</span></code><span class="koboSpan" id="kobo.853.1" xmlns="http://www.w3.org/1999/xhtml"> class as </span><code><span class="koboSpan" id="kobo.854.1" xmlns="http://www.w3.org/1999/xhtml">internal</span></code><span class="koboSpan" id="kobo.855.1" xmlns="http://www.w3.org/1999/xhtml"> because the type of its parameters (</span><code><span class="koboSpan" id="kobo.856.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.857.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.858.1" xmlns="http://www.w3.org/1999/xhtml">ComponentB</span></code><span class="koboSpan" id="kobo.859.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code><span class="koboSpan" id="kobo.860.1" xmlns="http://www.w3.org/1999/xhtml">ComponentC</span></code><span class="koboSpan" id="kobo.861.1" xmlns="http://www.w3.org/1999/xhtml">) are internal, making it impossible to leverage the container. </span><span class="koboSpan" id="kobo.861.2" xmlns="http://www.w3.org/1999/xhtml">Changing the visibility modifier of the opaque façade constructor from </span><code><span class="koboSpan" id="kobo.862.1" xmlns="http://www.w3.org/1999/xhtml">internal</span></code><span class="koboSpan" id="kobo.863.1" xmlns="http://www.w3.org/1999/xhtml"> to </span><code><span class="koboSpan" id="kobo.864.1" xmlns="http://www.w3.org/1999/xhtml">public</span></code><span class="koboSpan" id="kobo.865.1" xmlns="http://www.w3.org/1999/xhtml"> would have yielded a </span><em><span class="koboSpan" id="kobo.866.1" xmlns="http://www.w3.org/1999/xhtml">CS0051 Inconsistent accessibility</span></em><span class="koboSpan" id="kobo.867.1" xmlns="http://www.w3.org/1999/xhtml"> error.</span></p>
</blockquote>
</blockquote>
<p><span class="koboSpan" id="kobo.868.1" xmlns="http://www.w3.org/1999/xhtml">Besides those differences, the transparent façade plays the same role as the opaque façade, outputting the same result.We consume those two façades next.</span></p>
</section>
<section class="level4" data-number="12.5.3.3" id="the-program">
<h4 data-number="12.5.3.3"><span class="koboSpan" id="kobo.869.1" xmlns="http://www.w3.org/1999/xhtml">The program</span></h4>
<p><span class="koboSpan" id="kobo.870.1" xmlns="http://www.w3.org/1999/xhtml">Now, let’s analyze the consumer, an ASP.NET Core application that forwards HTTP requests to the façades and return the result as their response.The first step is to register the dependencies like this:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.871.1" xmlns="http://www.w3.org/1999/xhtml">var builder = WebApplication.CreateBuilder(args);
builder.Services
    .AddOpaqueFacadeSubSystem()
    .AddTransparentFacadeSubSystem()
;</span></code></pre>
</div>
<blockquote>
<p><span class="koboSpan" id="kobo.872.1" xmlns="http://www.w3.org/1999/xhtml">With these extension methods, the application root is so clean that it is hard to know that we registered two subsystems against the IoC container. </span><span class="koboSpan" id="kobo.872.2" xmlns="http://www.w3.org/1999/xhtml">This is a good way of keeping your code organized and clean, especially when you’re building class libraries.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.873.1" xmlns="http://www.w3.org/1999/xhtml">Now that everything has been registered, the second thing we need to do is route those HTTP requests to the façades. </span><span class="koboSpan" id="kobo.873.2" xmlns="http://www.w3.org/1999/xhtml">Let’s take a look at the code first:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.874.1" xmlns="http://www.w3.org/1999/xhtml">var app = builder.Build();
app.MapGet(
    "/opaque/a",
    (IOpaqueFacade opaqueFacade)
        =&gt; opaqueFacade.ExecuteOperationA()
); 
app.MapGet(
    "/opaque/b",
    (IOpaqueFacade opaqueFacade)
        =&gt; opaqueFacade.ExecuteOperationB()
);
app.MapGet(
    "/transparent/a",
    (ITransparentFacade transparentFacade)
        =&gt; transparentFacade.ExecuteOperationA()
);
app.MapGet(
    "/transparent/b",
    (ITransparentFacade transparentFacade)
        =&gt; transparentFacade.ExecuteOperationB()
);
app.Run();</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.875.1" xmlns="http://www.w3.org/1999/xhtml">In the preceding block, we define four routes. </span><span class="koboSpan" id="kobo.875.2" xmlns="http://www.w3.org/1999/xhtml">Each route dispatches the request to one of the façade’s methods (highlighted code) using the façade that is injected in its delegate.If you run the program and navigate to the </span><code><span class="koboSpan" id="kobo.876.1" xmlns="http://www.w3.org/1999/xhtml">/transparent/a</span></code><span class="koboSpan" id="kobo.877.1" xmlns="http://www.w3.org/1999/xhtml"> endpoint, the page should display the following:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.878.1" xmlns="http://www.w3.org/1999/xhtml">Component A, Operation A
Component A, Operation B
Component B, Operation D
Component C, Operation E</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.879.1" xmlns="http://www.w3.org/1999/xhtml">What happened is located inside the delegates. </span><span class="koboSpan" id="kobo.879.2" xmlns="http://www.w3.org/1999/xhtml">It uses the injected </span><code><span class="koboSpan" id="kobo.880.1" xmlns="http://www.w3.org/1999/xhtml">ITransparentFacade</span></code><span class="koboSpan" id="kobo.881.1" xmlns="http://www.w3.org/1999/xhtml"> service and calls its </span><code><span class="koboSpan" id="kobo.882.1" xmlns="http://www.w3.org/1999/xhtml">ExecuteOperationA()</span></code><span class="koboSpan" id="kobo.883.1" xmlns="http://www.w3.org/1999/xhtml"> method, and then outputs the </span><code><span class="koboSpan" id="kobo.884.1" xmlns="http://www.w3.org/1999/xhtml">result</span></code><span class="koboSpan" id="kobo.885.1" xmlns="http://www.w3.org/1999/xhtml"> variable to the response stream.Now, let’s define how </span><code><span class="koboSpan" id="kobo.886.1" xmlns="http://www.w3.org/1999/xhtml">ITransparentFacade</span></code><span class="koboSpan" id="kobo.887.1" xmlns="http://www.w3.org/1999/xhtml"> is composed:</span></p>
<ul>
<li><code><span class="koboSpan" id="kobo.888.1" xmlns="http://www.w3.org/1999/xhtml">ITransparentFacade</span></code><span class="koboSpan" id="kobo.889.1" xmlns="http://www.w3.org/1999/xhtml"> is an instance of </span><code><span class="koboSpan" id="kobo.890.1" xmlns="http://www.w3.org/1999/xhtml">TransparentFacade</span></code><span class="koboSpan" id="kobo.891.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li><span class="koboSpan" id="kobo.892.1" xmlns="http://www.w3.org/1999/xhtml">We inject </span><code><span class="koboSpan" id="kobo.893.1" xmlns="http://www.w3.org/1999/xhtml">IComponentA</span></code><span class="koboSpan" id="kobo.894.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.895.1" xmlns="http://www.w3.org/1999/xhtml">IComponentB</span></code><span class="koboSpan" id="kobo.896.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code><span class="koboSpan" id="kobo.897.1" xmlns="http://www.w3.org/1999/xhtml">IComponentC</span></code><span class="koboSpan" id="kobo.898.1" xmlns="http://www.w3.org/1999/xhtml"> in the </span><code><span class="koboSpan" id="kobo.899.1" xmlns="http://www.w3.org/1999/xhtml">TransparentFacade</span></code><span class="koboSpan" id="kobo.900.1" xmlns="http://www.w3.org/1999/xhtml"> class.</span></li>
<li><span class="koboSpan" id="kobo.901.1" xmlns="http://www.w3.org/1999/xhtml">These dependencies are instances of </span><code><span class="koboSpan" id="kobo.902.1" xmlns="http://www.w3.org/1999/xhtml">ComponentA</span></code><span class="koboSpan" id="kobo.903.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.904.1" xmlns="http://www.w3.org/1999/xhtml">ComponentB</span></code><span class="koboSpan" id="kobo.905.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code><span class="koboSpan" id="kobo.906.1" xmlns="http://www.w3.org/1999/xhtml">ComponentC</span></code><span class="koboSpan" id="kobo.907.1" xmlns="http://www.w3.org/1999/xhtml">, respectively.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.908.1" xmlns="http://www.w3.org/1999/xhtml">Visually, the following flow happens:</span></p>
<figure>
<span class="koboSpan" id="kobo.909.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 11.17: A representation of the call hierarchy that occurs when the consumer executes the ExecuteOperationA method" src="../media/file65.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.910.1" xmlns="http://www.w3.org/1999/xhtml">Figure 11.17: A representation of the call hierarchy that occurs when the consumer executes the ExecuteOperationA method</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.911.1" xmlns="http://www.w3.org/1999/xhtml">In the preceding diagram, we can see the shielding that’s done by the façade and how it has made the consumer’s life easier: one call instead of four.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.912.1" xmlns="http://www.w3.org/1999/xhtml">One of the hardest parts of using dependency injection is its abstractness. </span><span class="koboSpan" id="kobo.912.2" xmlns="http://www.w3.org/1999/xhtml">If you are not sure how all those parts are assembled, add a breakpoint into Visual Studio (let’s say, on the </span><code><span class="koboSpan" id="kobo.913.1" xmlns="http://www.w3.org/1999/xhtml">var result = transparentFacade.ExecuteOperationA()</span></code><span class="koboSpan" id="kobo.914.1" xmlns="http://www.w3.org/1999/xhtml"> line) and run the application in debug mode. </span><span class="koboSpan" id="kobo.914.2" xmlns="http://www.w3.org/1999/xhtml">From there, </span><strong><span class="koboSpan" id="kobo.915.1" xmlns="http://www.w3.org/1999/xhtml">Step Into</span></strong><span class="koboSpan" id="kobo.916.1" xmlns="http://www.w3.org/1999/xhtml"> each method call. </span><span class="koboSpan" id="kobo.916.2" xmlns="http://www.w3.org/1999/xhtml">That should help you figure out what is happening. </span><span class="koboSpan" id="kobo.916.3" xmlns="http://www.w3.org/1999/xhtml">Using the debugger to find the concrete types and their states can help find details about a system or diagnose bugs.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.917.1" xmlns="http://www.w3.org/1999/xhtml">To use </span><strong><span class="koboSpan" id="kobo.918.1" xmlns="http://www.w3.org/1999/xhtml">Step Into</span></strong><span class="koboSpan" id="kobo.919.1" xmlns="http://www.w3.org/1999/xhtml">, you can use the following button or hit </span><strong><span class="koboSpan" id="kobo.920.1" xmlns="http://www.w3.org/1999/xhtml">F11</span></strong><span class="koboSpan" id="kobo.921.1" xmlns="http://www.w3.org/1999/xhtml">:</span></p>
</blockquote>
</blockquote>
<figure>
<span class="koboSpan" id="kobo.922.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 11.18: The Visual Studio Step Into (F11) button" src="../media/file66.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.923.1" xmlns="http://www.w3.org/1999/xhtml">Figure 11.18: The Visual Studio Step Into (F11) button</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.924.1" xmlns="http://www.w3.org/1999/xhtml">Calling the other endpoints lead to similar results. </span><span class="koboSpan" id="kobo.924.2" xmlns="http://www.w3.org/1999/xhtml">As a reference, here’s the result from the other endpoints.Here’s the result for the </span><code><span class="koboSpan" id="kobo.925.1" xmlns="http://www.w3.org/1999/xhtml">/transparent/b</span></code><span class="koboSpan" id="kobo.926.1" xmlns="http://www.w3.org/1999/xhtml"> endpoint:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.927.1" xmlns="http://www.w3.org/1999/xhtml">Component B, Operation C
Component B, Operation D
Component C, Operation F</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.928.1" xmlns="http://www.w3.org/1999/xhtml">Here’s the results for the </span><code><span class="koboSpan" id="kobo.929.1" xmlns="http://www.w3.org/1999/xhtml">/opaque/a</span></code><span class="koboSpan" id="kobo.930.1" xmlns="http://www.w3.org/1999/xhtml"> endpoint:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.931.1" xmlns="http://www.w3.org/1999/xhtml">Component A, Operation A
Component A, Operation B
Component B, Operation D
Component C, Operation E</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.932.1" xmlns="http://www.w3.org/1999/xhtml">Here’s the result for the </span><code><span class="koboSpan" id="kobo.933.1" xmlns="http://www.w3.org/1999/xhtml">/opaque/b</span></code><span class="koboSpan" id="kobo.934.1" xmlns="http://www.w3.org/1999/xhtml"> endpoint:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.935.1" xmlns="http://www.w3.org/1999/xhtml">Component B, Operation C
Component B, Operation D
Component C, Operation F</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.936.1" xmlns="http://www.w3.org/1999/xhtml">Next, let’s update some results without changing the component’s code.</span></p>
</section>
<section class="level4" data-number="12.5.3.4" id="flexibility-in-action">
<h4 data-number="12.5.3.4"><span class="koboSpan" id="kobo.937.1" xmlns="http://www.w3.org/1999/xhtml">Flexibility in action</span></h4>
<p><span class="koboSpan" id="kobo.938.1" xmlns="http://www.w3.org/1999/xhtml">As discussed, the transparent façade adds more flexibility. </span><span class="koboSpan" id="kobo.938.2" xmlns="http://www.w3.org/1999/xhtml">Here, we explore this flexibility in action.</span><strong><span class="koboSpan" id="kobo.939.1" xmlns="http://www.w3.org/1999/xhtml">Context</span></strong><span class="koboSpan" id="kobo.940.1" xmlns="http://www.w3.org/1999/xhtml">: We want to change the behavior of the </span><code><span class="koboSpan" id="kobo.941.1" xmlns="http://www.w3.org/1999/xhtml">TransparentFacade</span></code><span class="koboSpan" id="kobo.942.1" xmlns="http://www.w3.org/1999/xhtml"> class. </span><span class="koboSpan" id="kobo.942.2" xmlns="http://www.w3.org/1999/xhtml">At the moment, the result of the </span><code><span class="koboSpan" id="kobo.943.1" xmlns="http://www.w3.org/1999/xhtml">transparent/b</span></code><span class="koboSpan" id="kobo.944.1" xmlns="http://www.w3.org/1999/xhtml"> endpoint looks like this:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.945.1" xmlns="http://www.w3.org/1999/xhtml">Component B, Operation C
Component B, Operation D
Component C, Operation F</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.946.1" xmlns="http://www.w3.org/1999/xhtml">To demonstrate we can extend and change the subsystem without altering the it, let’s change the output to the following:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.947.1" xmlns="http://www.w3.org/1999/xhtml">Flexibility
Design Pattern
Component C, Operation F</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.948.1" xmlns="http://www.w3.org/1999/xhtml">Because the </span><code><span class="koboSpan" id="kobo.949.1" xmlns="http://www.w3.org/1999/xhtml">ComponentB</span></code><span class="koboSpan" id="kobo.950.1" xmlns="http://www.w3.org/1999/xhtml"> class provides the first two lines, we must replace it with a new implementation of the </span><code><span class="koboSpan" id="kobo.951.1" xmlns="http://www.w3.org/1999/xhtml">IComponentB</span></code><span class="koboSpan" id="kobo.952.1" xmlns="http://www.w3.org/1999/xhtml"> interface. </span><span class="koboSpan" id="kobo.952.2" xmlns="http://www.w3.org/1999/xhtml">Let’s call this class </span><code><span class="koboSpan" id="kobo.953.1" xmlns="http://www.w3.org/1999/xhtml">UpdatedComponentB</span></code><span class="koboSpan" id="kobo.954.1" xmlns="http://www.w3.org/1999/xhtml">:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.955.1" xmlns="http://www.w3.org/1999/xhtml">using TransparentFacadeSubSystem.Abstractions;
namespace Facade;
public class UpdatedComponentB : IComponentB
{
    public string OperationC() =&gt; "Flexibility";
    public string OperationD() =&gt; "Design Pattern";
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.956.1" xmlns="http://www.w3.org/1999/xhtml">The preceding code does exactly what we want. </span><span class="koboSpan" id="kobo.956.2" xmlns="http://www.w3.org/1999/xhtml">However, we have to tell the IoC container about it, like this:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.957.1" xmlns="http://www.w3.org/1999/xhtml">builder.Services
    .AddOpaqueFacadeSubSystem()
    .AddTransparentFacadeSubSystem()
    .AddSingleton&lt;IComponentB, UpdatedComponentB&gt;()
;</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.958.1" xmlns="http://www.w3.org/1999/xhtml">If you run the program, you should see the desired result!</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.959.1" xmlns="http://www.w3.org/1999/xhtml">Adding a dependency for a second time makes the container resolves that dependency, thus overriding the first one. </span><span class="koboSpan" id="kobo.959.2" xmlns="http://www.w3.org/1999/xhtml">However, both registrations remain in the services collection; for example, calling </span><code><span class="koboSpan" id="kobo.960.1" xmlns="http://www.w3.org/1999/xhtml">GetServices&lt;IComponentB&gt;()</span></code><span class="koboSpan" id="kobo.961.1" xmlns="http://www.w3.org/1999/xhtml"> on </span><code><span class="koboSpan" id="kobo.962.1" xmlns="http://www.w3.org/1999/xhtml">IServiceProvider</span></code><span class="koboSpan" id="kobo.963.1" xmlns="http://www.w3.org/1999/xhtml"> would return two dependencies. </span><span class="koboSpan" id="kobo.963.2" xmlns="http://www.w3.org/1999/xhtml">Do not confuse the </span><code><span class="koboSpan" id="kobo.964.1" xmlns="http://www.w3.org/1999/xhtml">GetServices()</span></code><span class="koboSpan" id="kobo.965.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.966.1" xmlns="http://www.w3.org/1999/xhtml">GetService()</span></code><span class="koboSpan" id="kobo.967.1" xmlns="http://www.w3.org/1999/xhtml"> methods (plural versus singular); one returns a collection while the other returns a single instance. </span><span class="koboSpan" id="kobo.967.2" xmlns="http://www.w3.org/1999/xhtml">That single instance is always the last that has been registered.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.968.1" xmlns="http://www.w3.org/1999/xhtml">That’s it! </span><span class="koboSpan" id="kobo.968.2" xmlns="http://www.w3.org/1999/xhtml">We updated the system without modifying it. </span><span class="koboSpan" id="kobo.968.3" xmlns="http://www.w3.org/1999/xhtml">This is what dependency injection can do for you when designing a program around it.</span></p>
</section>
<section class="level4" data-number="12.5.3.5" id="alternative-façade-patterns">
<h4 data-number="12.5.3.5"><span class="koboSpan" id="kobo.969.1" xmlns="http://www.w3.org/1999/xhtml">Alternative façade patterns</span></h4>
<p><span class="koboSpan" id="kobo.970.1" xmlns="http://www.w3.org/1999/xhtml">One alternative would be to create a </span><em><span class="koboSpan" id="kobo.971.1" xmlns="http://www.w3.org/1999/xhtml">hybrid between a transparent façade and an opaque façade</span></em><span class="koboSpan" id="kobo.972.1" xmlns="http://www.w3.org/1999/xhtml"> by exposing the abstractions using the </span><code><span class="koboSpan" id="kobo.973.1" xmlns="http://www.w3.org/1999/xhtml">public</span></code><span class="koboSpan" id="kobo.974.1" xmlns="http://www.w3.org/1999/xhtml"> visibility modifier (all of the interfaces) while keeping the implementations hidden under an </span><code><span class="koboSpan" id="kobo.975.1" xmlns="http://www.w3.org/1999/xhtml">internal</span></code><span class="koboSpan" id="kobo.976.1" xmlns="http://www.w3.org/1999/xhtml"> visibility modifier. </span><span class="koboSpan" id="kobo.976.2" xmlns="http://www.w3.org/1999/xhtml">This hybrid design offers the right balance between </span><strong><span class="koboSpan" id="kobo.977.1" xmlns="http://www.w3.org/1999/xhtml">control and flexibility</span></strong><span class="koboSpan" id="kobo.978.1" xmlns="http://www.w3.org/1999/xhtml">.Another alternative would be to create </span><em><span class="koboSpan" id="kobo.979.1" xmlns="http://www.w3.org/1999/xhtml">a façade outside of the subsystem</span></em><span class="koboSpan" id="kobo.980.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.980.2" xmlns="http://www.w3.org/1999/xhtml">In the previous examples, we created the façades inside the class libraries, but this is not mandatory; the façade is just a class that creates an accessible wall between your system and one or more subsystems. </span><span class="koboSpan" id="kobo.980.3" xmlns="http://www.w3.org/1999/xhtml">It should be located wherever you see fit. </span><span class="koboSpan" id="kobo.980.4" xmlns="http://www.w3.org/1999/xhtml">Creating external façades like this would be especially useful when you do not control the source code of the subsystem(s), such as if you only have access to the binaries. </span><span class="koboSpan" id="kobo.980.5" xmlns="http://www.w3.org/1999/xhtml">This could also be used to create project-specific façades over the same subsystem, giving you extra flexibility without cluttering your subsystems with multiple façades, shifting the maintenance cost from the subsystems to the client applications that use them.This one is more of a note than an alternative: you do not need to create an assembly per subsystem. </span><span class="koboSpan" id="kobo.980.6" xmlns="http://www.w3.org/1999/xhtml">I did it because it helped me explain different concepts in the examples, but you could create multiple subsystems in the same assembly. </span><span class="koboSpan" id="kobo.980.7" xmlns="http://www.w3.org/1999/xhtml">You could even create a single assembly that includes all your subsystems, façades, and the client code (all in a single project).</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.981.1" xmlns="http://www.w3.org/1999/xhtml">Whether talking about subsystems or REST APIs, layering APIs is an excellent way to create low-level functionalities that are atomic but harder to use while providing a higher-level API to access them through the façade, leading to a better consumer experience.</span></p>
</blockquote>
</section>
</section>
<section class="level3" data-number="12.5.4" id="conclusion-18">
<h3 data-number="12.5.4"><span class="koboSpan" id="kobo.982.1" xmlns="http://www.w3.org/1999/xhtml">Conclusion</span></h3>
<p><span class="koboSpan" id="kobo.983.1" xmlns="http://www.w3.org/1999/xhtml">The Façade pattern is handy for simplifying consumers’ lives, allowing us to hide subsystems’ implementation details behind a wall. </span><span class="koboSpan" id="kobo.983.2" xmlns="http://www.w3.org/1999/xhtml">There are multiple flavors to it; the two most prominent ones are:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.984.1" xmlns="http://www.w3.org/1999/xhtml">The </span><strong><span class="koboSpan" id="kobo.985.1" xmlns="http://www.w3.org/1999/xhtml">transparent façade</span></strong><span class="koboSpan" id="kobo.986.1" xmlns="http://www.w3.org/1999/xhtml">, which increases flexibility by exposing at least part of the subsystem(s)</span></li>
<li><span class="koboSpan" id="kobo.987.1" xmlns="http://www.w3.org/1999/xhtml">The </span><strong><span class="koboSpan" id="kobo.988.1" xmlns="http://www.w3.org/1999/xhtml">opaque façade</span></strong><span class="koboSpan" id="kobo.989.1" xmlns="http://www.w3.org/1999/xhtml">, which controls access by hiding most of the subsystem(s)</span></li>
</ul>
<p><span class="koboSpan" id="kobo.990.1" xmlns="http://www.w3.org/1999/xhtml">Now, let’s see how the </span><strong><span class="koboSpan" id="kobo.991.1" xmlns="http://www.w3.org/1999/xhtml">transparent façade</span></strong><span class="koboSpan" id="kobo.992.1" xmlns="http://www.w3.org/1999/xhtml"> pattern can help us follow the </span><strong><span class="koboSpan" id="kobo.993.1" xmlns="http://www.w3.org/1999/xhtml">SOLID</span></strong><span class="koboSpan" id="kobo.994.1" xmlns="http://www.w3.org/1999/xhtml"> principles:</span></p>
<ul>
<li><strong><span class="koboSpan" id="kobo.995.1" xmlns="http://www.w3.org/1999/xhtml">S</span></strong><span class="koboSpan" id="kobo.996.1" xmlns="http://www.w3.org/1999/xhtml">: A well-designed </span><strong><span class="koboSpan" id="kobo.997.1" xmlns="http://www.w3.org/1999/xhtml">transparent façade</span></strong><span class="koboSpan" id="kobo.998.1" xmlns="http://www.w3.org/1999/xhtml"> serves this exact purpose by providing a cohesive set of functionalities to its consumers by hiding overly complex subsystems or internal implementation details.</span></li>
<li><strong><span class="koboSpan" id="kobo.999.1" xmlns="http://www.w3.org/1999/xhtml">O</span></strong><span class="koboSpan" id="kobo.1000.1" xmlns="http://www.w3.org/1999/xhtml">: A well-designed </span><strong><span class="koboSpan" id="kobo.1001.1" xmlns="http://www.w3.org/1999/xhtml">transparent façade</span></strong><span class="koboSpan" id="kobo.1002.1" xmlns="http://www.w3.org/1999/xhtml"> and its underlying subsystem’s components can be extended without direct modification, as we saw in the </span><em><span class="koboSpan" id="kobo.1003.1" xmlns="http://www.w3.org/1999/xhtml">Flexibility in action</span></em><span class="koboSpan" id="kobo.1004.1" xmlns="http://www.w3.org/1999/xhtml"> section.</span></li>
<li><strong><span class="koboSpan" id="kobo.1005.1" xmlns="http://www.w3.org/1999/xhtml">L</span></strong><span class="koboSpan" id="kobo.1006.1" xmlns="http://www.w3.org/1999/xhtml">: N/A</span></li>
<li><strong><span class="koboSpan" id="kobo.1007.1" xmlns="http://www.w3.org/1999/xhtml">I</span></strong><span class="koboSpan" id="kobo.1008.1" xmlns="http://www.w3.org/1999/xhtml">: By exposing a façade that uses different smaller objects implementing small interfaces, we could say that the segregation is done at both the façade and the component levels.</span></li>
<li><strong><span class="koboSpan" id="kobo.1009.1" xmlns="http://www.w3.org/1999/xhtml">D</span></strong><span class="koboSpan" id="kobo.1010.1" xmlns="http://www.w3.org/1999/xhtml">: The Façade pattern does not specify anything about interfaces, so it is up to the developers to enforce this principle by using other patterns, principles, and best practices.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.1011.1" xmlns="http://www.w3.org/1999/xhtml">Finally, let’s see how the </span><strong><span class="koboSpan" id="kobo.1012.1" xmlns="http://www.w3.org/1999/xhtml">opaque façade</span></strong><span class="koboSpan" id="kobo.1013.1" xmlns="http://www.w3.org/1999/xhtml"> pattern can help us follow the </span><strong><span class="koboSpan" id="kobo.1014.1" xmlns="http://www.w3.org/1999/xhtml">SOLID</span></strong><span class="koboSpan" id="kobo.1015.1" xmlns="http://www.w3.org/1999/xhtml"> principles:</span></p>
<ul>
<li><strong><span class="koboSpan" id="kobo.1016.1" xmlns="http://www.w3.org/1999/xhtml">S</span></strong><span class="koboSpan" id="kobo.1017.1" xmlns="http://www.w3.org/1999/xhtml">: A well-designed </span><strong><span class="koboSpan" id="kobo.1018.1" xmlns="http://www.w3.org/1999/xhtml">opaque façade</span></strong><span class="koboSpan" id="kobo.1019.1" xmlns="http://www.w3.org/1999/xhtml"> serves this exact purpose by providing a cohesive set of functionalities to its clients by hiding overly complex subsystems or internal implementation details.</span></li>
<li><strong><span class="koboSpan" id="kobo.1020.1" xmlns="http://www.w3.org/1999/xhtml">O</span></strong><span class="koboSpan" id="kobo.1021.1" xmlns="http://www.w3.org/1999/xhtml">: By hiding the subsystem, the </span><strong><span class="koboSpan" id="kobo.1022.1" xmlns="http://www.w3.org/1999/xhtml">opaque façade</span></strong><span class="koboSpan" id="kobo.1023.1" xmlns="http://www.w3.org/1999/xhtml"> limits our ability to extend it. </span><span class="koboSpan" id="kobo.1023.2" xmlns="http://www.w3.org/1999/xhtml">However, we could implement a </span><strong><span class="koboSpan" id="kobo.1024.1" xmlns="http://www.w3.org/1999/xhtml">hybrid façade</span></strong><span class="koboSpan" id="kobo.1025.1" xmlns="http://www.w3.org/1999/xhtml"> to help with that.</span></li>
<li><strong><span class="koboSpan" id="kobo.1026.1" xmlns="http://www.w3.org/1999/xhtml">L</span></strong><span class="koboSpan" id="kobo.1027.1" xmlns="http://www.w3.org/1999/xhtml">: N/A</span></li>
<li><strong><span class="koboSpan" id="kobo.1028.1" xmlns="http://www.w3.org/1999/xhtml">I</span></strong><span class="koboSpan" id="kobo.1029.1" xmlns="http://www.w3.org/1999/xhtml">: The </span><strong><span class="koboSpan" id="kobo.1030.1" xmlns="http://www.w3.org/1999/xhtml">opaque façade</span></strong><span class="koboSpan" id="kobo.1031.1" xmlns="http://www.w3.org/1999/xhtml"> does not help nor diminish our ability to apply the ISP.</span></li>
<li><strong><span class="koboSpan" id="kobo.1032.1" xmlns="http://www.w3.org/1999/xhtml">D</span></strong><span class="koboSpan" id="kobo.1033.1" xmlns="http://www.w3.org/1999/xhtml">: The Façade pattern does not specify anything about interfaces, so it is up to the developers to enforce this principle by using other patterns, principles, and best practices.</span></li>
</ul>
</section>
</section>
<section class="level2" data-number="12.6" id="summary-10">
<h2 data-number="12.6"><span class="koboSpan" id="kobo.1034.1" xmlns="http://www.w3.org/1999/xhtml">Summary</span></h2>
<p><span class="koboSpan" id="kobo.1035.1" xmlns="http://www.w3.org/1999/xhtml">In this chapter, we covered multiple fundamental GoF structural design patterns. </span><span class="koboSpan" id="kobo.1035.2" xmlns="http://www.w3.org/1999/xhtml">They help us extend our systems from the outside without modifying the actual classes, leading to a higher degree of cohesion by composing our object graph dynamically.We started with the Decorator pattern, a powerful tool that allows us to dynamically add new functionality to an object without altering its original code. </span><span class="koboSpan" id="kobo.1035.3" xmlns="http://www.w3.org/1999/xhtml">Decorators can also be chained, allowing even greater flexibility (decorating other decorators). </span><span class="koboSpan" id="kobo.1035.4" xmlns="http://www.w3.org/1999/xhtml">We learned that this pattern adheres to the Open-Closed principle and promotes the separation of responsibilities into smaller, manageable pieces.We also used an open-source tool named Scrutor that simplifies the decorator pattern usage by extending the built-in ASP.NET Core dependency injection system. </span><span class="koboSpan" id="kobo.1035.5" xmlns="http://www.w3.org/1999/xhtml">Then, we covered the Composite pattern, which allows us to create complex, non-linear, and self-managed data structures with minimal effort. </span><span class="koboSpan" id="kobo.1035.6" xmlns="http://www.w3.org/1999/xhtml">That hierarchical data structure where groups and single components are indistinguishable makes the hierarchy's traversal and manipulation easier. </span><span class="koboSpan" id="kobo.1035.7" xmlns="http://www.w3.org/1999/xhtml">We use this pattern to build graphs or trees with self-managing nodes.After that, we covered the Adapter pattern, which allows two incompatible interfaces to work together without modifying their code. </span><span class="koboSpan" id="kobo.1035.8" xmlns="http://www.w3.org/1999/xhtml">This pattern is very helpful when we need to adapt the components of external systems that we have no control over, do not want to change, or can’t change.Finally, we dug into the Façade pattern, similar to the Adapter pattern, but at the subsystem level. </span><span class="koboSpan" id="kobo.1035.9" xmlns="http://www.w3.org/1999/xhtml">It allows us to create a wall in front of one or more subsystems, simplifying its usage. </span><span class="koboSpan" id="kobo.1035.10" xmlns="http://www.w3.org/1999/xhtml">It could also be used to hide the implementation details of a subsystem from its consumers.The next chapter explores two GoF behavioral design patterns: the Template method and the Chain of Responsibility design pattern.</span></p>
</section>
<section class="level2" data-number="12.7" id="questions-10">
<h2 data-number="12.7"><span class="koboSpan" id="kobo.1036.1" xmlns="http://www.w3.org/1999/xhtml">Questions</span></h2>
<p><span class="koboSpan" id="kobo.1037.1" xmlns="http://www.w3.org/1999/xhtml">Here are a few revision questions:</span></p>
<ol>
<li><span class="koboSpan" id="kobo.1038.1" xmlns="http://www.w3.org/1999/xhtml">What is the main advantage of the Decorator pattern?</span></li>
<li><span class="koboSpan" id="kobo.1039.1" xmlns="http://www.w3.org/1999/xhtml">Can we decorate a decorator with another decorator?</span></li>
<li><span class="koboSpan" id="kobo.1040.1" xmlns="http://www.w3.org/1999/xhtml">What is the primary goal of the Composite design pattern?</span></li>
<li><span class="koboSpan" id="kobo.1041.1" xmlns="http://www.w3.org/1999/xhtml">Can we use the Adapter pattern to migrate an old API to a new system in order to adapt its APIs before rewriting it?</span></li>
<li><span class="koboSpan" id="kobo.1042.1" xmlns="http://www.w3.org/1999/xhtml">What is the primary responsibility of the Adapter pattern?</span></li>
<li><span class="koboSpan" id="kobo.1043.1" xmlns="http://www.w3.org/1999/xhtml">What is the difference between the Adapter and the Façade patterns?</span></li>
<li><span class="koboSpan" id="kobo.1044.1" xmlns="http://www.w3.org/1999/xhtml">What is the main difference between an Opaque façade and a Transparent façade?</span></li>
</ol>
</section>
<section class="level2" data-number="12.8" id="further-reading-9">
<h2 data-number="12.8"><span class="koboSpan" id="kobo.1045.1" xmlns="http://www.w3.org/1999/xhtml">Further reading</span></h2>
<ul>
<li><span class="koboSpan" id="kobo.1046.1" xmlns="http://www.w3.org/1999/xhtml">To learn more about Scrutor, please visit </span><a href="https://adpg.link/xvfS"><span class="koboSpan" id="kobo.1047.1" xmlns="http://www.w3.org/1999/xhtml">https://adpg.link/xvfS</span></a></li>
</ul>
</section>
<section class="level2" data-number="12.9" id="answers-7">
<h2 data-number="12.9"><span class="koboSpan" id="kobo.1048.1" xmlns="http://www.w3.org/1999/xhtml">Answers</span></h2>
<ol>
<li><span class="koboSpan" id="kobo.1049.1" xmlns="http://www.w3.org/1999/xhtml">The Decorator pattern allows us to dynamically add new functionality to an object at runtime without modifying its original code, promoting flexibility, testability, and manageability.</span></li>
<li><span class="koboSpan" id="kobo.1050.1" xmlns="http://www.w3.org/1999/xhtml">Yes, we can decorate decorators by depending only on interfaces because they are just another implementation of the interface, nothing more.</span></li>
<li><span class="koboSpan" id="kobo.1051.1" xmlns="http://www.w3.org/1999/xhtml">The Composite design pattern aims to simplify handling complex structures by treating individual and group elements indistinguishably.</span></li>
<li><span class="koboSpan" id="kobo.1052.1" xmlns="http://www.w3.org/1999/xhtml">Yes, we could use an adapter for this.</span></li>
<li><span class="koboSpan" id="kobo.1053.1" xmlns="http://www.w3.org/1999/xhtml">The Adapter pattern's primary responsibility is to adapt one interface to work with another interface that is incompatible to use directly.</span></li>
<li><span class="koboSpan" id="kobo.1054.1" xmlns="http://www.w3.org/1999/xhtml">The Adapter and Façade design patterns are almost the same but are applied to different scenarios. </span><span class="koboSpan" id="kobo.1054.2" xmlns="http://www.w3.org/1999/xhtml">The Adapter pattern adapts an API to another API, while the Façade pattern exposes a unified or simplified API, hiding one or more complex subsystems.</span></li>
<li><span class="koboSpan" id="kobo.1055.1" xmlns="http://www.w3.org/1999/xhtml">An Opaque façade hides most of the subsystem (</span><code><span class="koboSpan" id="kobo.1056.1" xmlns="http://www.w3.org/1999/xhtml">internal</span></code><span class="koboSpan" id="kobo.1057.1" xmlns="http://www.w3.org/1999/xhtml"> visibility), controlling access to it, while a Transparent façade exposes at least part of the subsystem (</span><code><span class="koboSpan" id="kobo.1058.1" xmlns="http://www.w3.org/1999/xhtml">public</span></code><span class="koboSpan" id="kobo.1059.1" xmlns="http://www.w3.org/1999/xhtml"> visibility), increasing flexibility.</span></li>
</ol>
</section>
</section>
</body>
</html>
