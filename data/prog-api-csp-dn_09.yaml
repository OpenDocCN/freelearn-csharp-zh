- en: '9'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '9'
- en: Authentication and Authorization
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 认证和授权
- en: In the previous chapter, we reviewed a number of advanced API topics. In this
    chapter, you will learn how to add authentication (which answers questions such
    as “is this user who they say they are?”) and authorization (“is this user allowed
    to take this action?”). We will use the Azure function from [*Chapter 6*](B21998_06.xhtml#_idTextAnchor077)
    .
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们回顾了多个高级API主题。在本章中，你将学习如何添加认证（这回答了诸如“这个用户是他们所说的那个人吗？”的问题）和授权（“这个用户是否有权执行这个操作？”）。我们将使用[*第6章*](B21998_06.xhtml#_idTextAnchor077)中的Azure功能。
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: Differences between authentication and authorization
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 认证和授权之间的区别
- en: Definitions of authentication and authorization
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 认证和授权的定义
- en: A walkthrough of authentication – proving who you are
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 认证流程的概述——证明你是谁
- en: A walkthrough of authorization – testing if you can take a specific action
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 授权流程的概述——测试你是否可以执行特定操作
- en: Technical requirements
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'For this chapter, you will need the following:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 对于本章，你需要以下内容：
- en: Visual Studio
  id: totrans-10
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Visual Studio
- en: An Azure Account (you can get a free starter account at [https://azure.mcrosoft.com](https://azure.mcrosoft.com)
    )
  id: totrans-11
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure账户（你可以在[https://azure.mcrosoft.com](https://azure.mcrosoft.com)获取免费入门账户）
- en: 'Note that much of this chapter relies on the code and action from [*Chapter
    6*](B21998_06.xhtml#_idTextAnchor077) . If you don’t have the code, you can download
    it from the repository: [https://github.com/PacktPublishing/Programming-APIs-with-C-Sharp-and-.NET/tree/main/Chapter06](https://github.com/PacktPublishing/Programming-APIs-with-C-Sharp-and-.NET/tree/main/Chapter06)'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，本章的大部分内容依赖于[*第6章*](B21998_06.xhtml#_idTextAnchor077)中的代码和操作。如果您没有代码，可以从仓库下载：[https://github.com/PacktPublishing/Programming-APIs-with-C-Sharp-and-.NET/tree/main/Chapter06](https://github.com/PacktPublishing/Programming-APIs-with-C-Sharp-and-.NET/tree/main/Chapter06)
- en: The code for this chapter is available at [https://github.com/PacktPublishing/Programming-APIs-with-C-Sharp-and-.NET/tree/main/Chapter09](https://github.com/PacktPublishing/Programming-APIs-with-C-Sharp-and-.NET/tree/main/Chapter09)
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的代码可在[https://github.com/PacktPublishing/Programming-APIs-with-C-Sharp-and-.NET/tree/main/Chapter09](https://github.com/PacktPublishing/Programming-APIs-with-C-Sharp-and-.NET/tree/main/Chapter09)找到
- en: Introduction to authentication and authorization
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 认证和授权简介
- en: The vast majority of applications will need some form of **authentication and
    authorization** ( **A&A** ). Authentication is the process of proving who you
    are, while authorization is the process of determining whether you have permission
    to do what you are trying to do. Typically, you authenticate first, perhaps once
    per session, and then authorization is checked for each action you attempt.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数应用程序都需要某种形式的**认证和授权**（**A&A**）。认证是证明你是谁的过程，而授权是确定你是否有权执行你试图执行的操作的过程。通常，你首先进行认证，可能每次会话一次，然后对每个尝试的操作进行授权检查。
- en: There are many different types of A&A, but since we’re focusing mostly on Azure,
    we’ll use their built-in feature set colloquially known as **Easy Auth** .
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 有许多不同的A&A类型，但由于我们主要关注Azure，我们将使用他们俗称的**Easy Auth**内置功能集。
- en: Overview of A&A
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: A&A概述
- en: Though there are many kinds of A&A, including many nuances such as the authentication
    of services, users, and so on, we’ll focus on A&A for a single user in an Azure
    Tenant. That will usually be an employee during debugging (you!). This will then
    allow you to extend these concepts so that other services you create can be authorized
    in the same way.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然有各种各样的认证和授权（A&A），包括许多细微差别，如服务、用户等的认证，但我们将专注于Azure租户中的单个用户的A&A。这通常是在调试期间（也就是你！）的员工。这将允许你扩展这些概念，以便你创建的其他服务可以以相同的方式进行授权。
- en: Tenant
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 租户
- en: A tenant in Azure is a Guid that specifies all the content of a single organization.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 租户在Azure中是一个Guid，它指定了单个组织所有内容的全部内容。
- en: Enabling authentication on existing functions
  id: totrans-21
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在现有功能上启用认证
- en: 'Let’s begin by adding authentication to an existing Azure function. To do so,
    follow these steps:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从向现有的Azure功能添加认证开始。为此，请按照以下步骤操作：
- en: Open your Azure Function resource from [*Chapter 6*](B21998_06.xhtml#_idTextAnchor077)
    and navigate to the **Authentication** section, as shown in *Figure 9* *.1* .
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从[*第6章*](B21998_06.xhtml#_idTextAnchor077)打开你的Azure功能资源，并导航到**认证**部分，如图*图9*.*1*所示。
- en: '![Figure 9.1 – Selecting Authentication](img/B21998_09_1.jpg)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![图9.1 – 选择认证](img/B21998_09_1.jpg)'
- en: Figure 9.1 – Selecting Authentication
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.1 – 选择认证
- en: 'Click **Add Identity Provider** , and then select **Microsoft** . Use the following
    configuration options (they are almost all default):'
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击**添加身份提供者**，然后选择**微软**。使用以下配置选项（它们几乎都是默认的）：
- en: '**Choose** **a tenant**'
  id: totrans-27
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**选择** **一个租户**'
- en: '**Workforce** **configuration** (default)'
  id: totrans-28
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**工作力量配置**（默认）'
- en: '**App registration**'
  id: totrans-29
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**应用注册**'
- en: '**App registration type** : **Create new app** **registration** (default)'
  id: totrans-30
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**应用注册类型**：**创建新的应用注册**（默认）'
- en: '**Name** : The default is likely the name of your existing Function App resource;
    in this case, it is **Functions** .'
  id: totrans-31
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**名称**：默认情况下可能是您现有的函数应用资源名称；在这种情况下，它是**函数**。'
- en: '**Client secret expiration** : **Recommended: 180** **days** (default)'
  id: totrans-32
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**客户端密钥过期**：**建议：180** **天**（默认）'
- en: '**Supported account types** : **Current tenant – Single** **tenant** (default)'
  id: totrans-33
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**支持的账户类型**：**当前租户 – 单一租户**（默认）'
- en: '**Additional** **checks** (default)'
  id: totrans-34
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**附加** **检查**（默认）'
- en: '**Client application requirement** : **Allow requests only from this application**
    **itself** (default)'
  id: totrans-35
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**客户端应用程序要求**：**仅允许来自此应用程序本身的请求**（默认）'
- en: '**Identity requirement** : **Allow requests from any** **identity** (default)'
  id: totrans-36
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**身份要求**：**允许来自任何身份的请求**（默认）'
- en: '**Tenant requirement** : **Allow requests only from the issuer tenant** (your
    tenant GUID goes here)'
  id: totrans-37
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**租户要求**：**仅允许来自发行者租户的请求**（您的租户GUID将在这里）'
- en: '**App Service authentication** **settings** (default)'
  id: totrans-38
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**应用服务身份验证设置**（默认）'
- en: '**Restrict access** : **Require** **authentication** (default)'
  id: totrans-39
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**限制访问**：**要求** **身份验证**（默认）'
- en: '**Unauthenticated requests** : **HTTP 401 Unauthorized: recommended for** **APIs**
    (default)'
  id: totrans-40
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**未认证请求**：**HTTP 401 未授权：建议用于** **API**（默认）'
- en: '**Token** **Store** : **Checked**'
  id: totrans-41
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**令牌存储**：**已勾选**'
- en: To put this all together, see *Figure 9* *.2* .
  id: totrans-42
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: 要将这些内容组合起来，请参阅*图9* *.2* 。
- en: '![Figure 9.2 – Adding an identity provider](img/B21998_09_2.jpg)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
  zh: '![图9.2 – 添加身份提供者](img/B21998_09_2.jpg)'
- en: Figure 9.2 – Adding an identity provider
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.2 – 添加身份提供者
- en: We can skip **Permissions** for now, so click **Add** .
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以先跳过**权限**，然后单击**添加**。
- en: You will be returned to your **Authentication** blade, showing your new Microsoft
    Identity provider.
  id: totrans-46
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您将被返回到您的**身份验证**选项卡，显示您的新微软身份提供者。
- en: Click on the name of your Identity provider or navigate back to the main Azure
    portal. Click on **Microsoft Entra ID** , select **App registrations** , then
    your app.
  id: totrans-47
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击您的身份提供者名称或导航回主Azure门户。点击**Microsoft Entra ID**，选择**应用注册**，然后选择您的应用。
- en: This is your configuration area to manage various things about the app’s authentication.
    We’ll be editing this in a bit but try to run or navigate to your existing Function
    app’s HTTP trigger like you did in [*Chapter 6*](B21998_06.xhtml#_idTextAnchor077)
    . You should see that it now shows **401** **error (Unauthorized)** .
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 这是您管理应用程序身份验证的各种内容的配置区域。我们将在稍后编辑它，但尝试运行或导航到您现有的函数应用的HTTP触发器，就像您在[*第6章*](B21998_06.xhtml#_idTextAnchor077)中所做的那样。您应该会看到现在显示**401**
    **错误（未授权）**。
- en: Next, we’ll authenticate to the new Identity Provider in two ways to give you
    an idea of different use cases.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将以两种方式对新身份提供者进行身份验证，以便您了解不同的用例。
- en: Programmatically accessing your API
  id: totrans-50
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 以编程方式访问您的API
- en: Open your Function in Visual Studio from [*Chapter 6*](B21998_06.xhtml#_idTextAnchor077)
    . Right-click on the solution in **Solution Explorer** and click on **Add New
    Project... Add a .NET Console app** . Add the **Azure.Identity** NuGet package,
    and then create a **DefaultAzureCredential** instance.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 在Visual Studio中打开您的函数[*第6章*](B21998_06.xhtml#_idTextAnchor077) 。在**解决方案资源管理器**中右键单击解决方案，然后单击**添加新项目...
    添加.NET控制台应用**。添加**Azure.Identity** NuGet包，然后创建一个**DefaultAzureCredential**实例。
- en: 'There are many different credential classes that inherit from a **TokenCredential**
    base class implementing different use cases, but the **DefaultAzureCredential**
    tries a number of different credentials in order so that it can easily be used
    in several different scenarios. Use the following boilerplate code to securely
    call your Function:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 有许多不同的凭证类继承自实现不同用例的**TokenCredential**基类，但**DefaultAzureCredential**尝试了多种不同的凭证，以便它可以在多个不同的场景中轻松使用。使用以下样板代码安全地调用您的函数：
- en: '[PRE0]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Try to run it now, and it should throw an error on **resp.EnsureSuccessStatusCode();**
    . This is because we have not told our API that you as a user (via Visual Studio’s
    helper authentication client) are allowed to make calls to your API.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 现在尝试运行它，它应该在**resp.EnsureSuccessStatusCode();**处抛出错误。这是因为我们还没有告诉我们的API，您作为用户（通过Visual
    Studio的辅助身份验证客户端）被允许调用您的API。
- en: 'In a development environment, we can authorize the well-known client ID to
    the API. To do so, in the Azure Portal, navigate to your Function resource again:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 在开发环境中，我们可以将已知的客户端ID授权给API。为此，在Azure门户中再次导航到你的函数资源：
- en: In the **Authentication** blade, click the pencil icon under the **Edit** heading.
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**身份验证**选项卡下，点击**编辑**标题下的铅笔图标。
- en: Select **Allow Requests From Specific Client Applications** if it isn’t already
    selected, and then add **04f0c124-f2bc-4f59-8241-bf6df9866bbd** . Click **OK**
    and then **Save** .
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果尚未选择，请选择**允许来自特定客户端应用程序的请求**，然后添加**04f0c124-f2bc-4f59-8241-bf6df9866bbd**。点击**确定**然后**保存**。
- en: We’ll be doing this again later in this chapter.
  id: totrans-58
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们将在本章的后面再次进行此操作。
- en: Go back to Visual Studio and run the console application again.
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回到Visual Studio并再次运行控制台应用程序。
- en: The call to your API should now succeed and will print out the data you configured
    in your API’s Environment variables blade in [*Chapter 6*](B21998_06.xhtml#_idTextAnchor077)
    .
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 现在调用你的API应该成功，并将打印出你在[*第6章*](B21998_06.xhtml#_idTextAnchor077)中API的环境变量选项卡中配置的数据。
- en: 'Next, we’ll try to use **ClientSecretCredential** . To do so, follow these
    instructions:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将尝试使用**ClientSecretCredential**。为此，请按照以下说明操作：
- en: Navigate to the **Certificates & Secrets** blade in the app registration and
    click **New** **Client Secret** .
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在应用程序注册中导航到**证书和密钥**选项卡，并点击**新建****客户端密钥**。
- en: Enter a description and expiration time, and click **Add** .
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入描述和过期时间，然后点击**添加**。
- en: 'Copy the value somewhere (e.g., Notepad), as you will not be able to access
    it again. Modify the code by adding a new **ClientSecretCredential** instance
    instead of the existing credentials you might already have. You’ll need the Tenant
    ID and Client ID available in the **Overview** blade:'
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将值复制到某个地方（例如，记事本），因为你将无法再次访问它。通过添加一个新的**ClientSecretCredential**实例来修改代码，而不是现有的可能已经有的凭证。你需要在**概览**选项卡中提供租户ID和客户端ID：
- en: '[PRE1]'
  id: totrans-65
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The existing call to **GetTokenAsync** should work without changes. The rest
    of the code including the HTTP call itself should run successfully as is, and
    you should again see your configured API string.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 现有的对**GetTokenAsync**的调用应该无需更改即可工作。包括HTTP调用本身的其余代码应该按原样成功运行，你应该再次看到你配置的API字符串。
- en: Note
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 备注
- en: All of the preceding strings are available in the code from [*Chapter 6*](B21998_06.xhtml#_idTextAnchor077)
    .
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 所有上述字符串都在代码中的[*第6章*](B21998_06.xhtml#_idTextAnchor077)中可用。
- en: Authorizing additional Azure Resources
  id: totrans-69
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 授权额外的Azure资源
- en: 'You’ll almost certainly need additional Azure services to complement your cloud
    solution, so let’s try to authorize one to call your API. To do so, follow these
    instructions:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 你几乎肯定需要额外的Azure服务来补充你的云解决方案，所以让我们尝试授权一个调用你的API。为此，请按照以下说明操作：
- en: Go to the Azure portal, and then your existing Resource group. Create a new
    Logic app, and select **Consumption** for hosting.
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 前往Azure门户，然后你的现有资源组。创建一个新的逻辑应用，并选择**消费**作为托管。
- en: Give it a name and select the same **Region** that your other Resources are
    in.
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 给它一个名称，并选择与你的其他资源相同的**区域**。
- en: When it completes deployment, select the **Identity blade** , change the **Status**
    to **On** , and click **Save** and then **Yes** .
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当部署完成后，选择**身份**选项卡，将**状态**更改为**开启**，然后点击**保存**和**是**。
- en: Select the Logic app designer blade. Add a new HTTP trigger, enter your deployed
    Function URI (likely https://<my **resource name>.azurewebsites.net/api/Function1**
    ), and the **GET** method.
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择逻辑应用设计器选项卡。添加一个新的HTTP触发器，输入你的已部署函数URI（可能是https://<my **resource name**>.azurewebsites.net/api/Function1**），以及**GET**方法。
- en: Click **Show All** for **Advanced parameters** and select **Managed Identity**
    under **Authentication Type** . It should resemble *Figure 9* *.3* .
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**显示所有**以查看**高级参数**，并在**身份验证类型**下选择**托管身份**。它应该类似于*图9* *.3* 。
- en: '![Figure 9.3 – Advanced Parameters](img/B21998_09_3.jpg)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![图9.3 – 高级参数](img/B21998_09_3.jpg)'
- en: Figure 9.3 – Advanced Parameters
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.3 – 高级参数
- en: Click **Save** . Go back to the **Overview** blade and click **Run** .
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**保存**。返回到**概览**选项卡并点击**运行**。
- en: Click on the **Trigger history** tab and notice that it is red, indicating a
    failure.
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**触发历史**选项卡，注意它呈红色，表示失败。
- en: Click on the failed trigger, and then click the **Outputs** link. It should
    show **403 error (Forbidden)** , indicating that the service authenticated you
    correctly, but you were not authorized.
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击失败的触发器，然后点击**输出**链接。它应该显示**403错误（禁止访问）**，表示服务正确地认证了你，但你没有被授权。
- en: To authorize this Logic app to call your Function API, we need to add its client
    ID to the list of authorized clients that can call your API.
  id: totrans-81
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 为了授权此逻辑应用调用您的函数 API，我们需要将其客户端 ID 添加到可以调用您的 API 的授权客户端列表中。
- en: Go back to **Azure Portal Home** and click on **Microsoft Entra ID** . Search
    for your Logic app’s name in the **Search Your Tenant** text box. It should have
    an entry under the **Enterprise** **Applications** section.
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回到 **Azure 门户主页** 并点击 **Microsoft Entra ID**。在 **搜索您的租户** 文本框中搜索您的逻辑应用名称。它应该在
    **企业** **应用程序** 部分下有一个条目。
- en: Next, click on that and then copy the GUID under **Application ID** .
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，点击它，然后复制 **应用程序 ID** 下的 GUID。
- en: '![Figure 9.4 – Authorization](img/B21998_09_4.jpg)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.4 – 授权](img/B21998_09_4.jpg)'
- en: Figure 9.4 – Authorization
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.4 – 授权
- en: Note
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: Some of the fields in *Figure 9* *.4* have been obscured as a security measure.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 为了安全起见，*图 9* *.4* 中的某些字段已被遮挡。
- en: Navigate back to your Function app. Find the **Authentication** blade, and then
    click on the pencil as we did before. Next, click the other pencil icon next to
    **Allowed client applications** , and add a new entry with the GUID you just copied,
    as shown in *Figure 9* *.5* .
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回到你的函数应用。找到 **身份验证** 选项卡，然后点击我们之前所做的铅笔图标。接下来，点击 **允许的客户端应用程序** 旁边的另一个铅笔图标，并添加一个带有你刚刚复制的
    GUID 的新条目，如图 *图 9* *.5* 所示。
- en: '![Figure 9.5 – Adding allowed client applications](img/B21998_09_5.jpg)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.5 – 添加允许的客户端应用程序](img/B21998_09_5.jpg)'
- en: Figure 9.5 – Adding allowed client applications
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.5 – 添加允许的客户端应用程序
- en: Click **OK** and then **Save** .
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **确定** 然后点击 **保存**。
- en: Navigate back to the Logic app, and then click on **Run** | **Run** . This should
    immediately start another run of your Logic app calling your API.
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回到逻辑应用，然后点击 **运行** | **运行**。这应该立即启动您的逻辑应用调用您的 API 的另一个运行。
- en: Click on the **Trigger history** tab on the **Overview** blade. You should see
    that the latest one has a green status, indicating success, as shown in *Figure
    9* *.6* .
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **概述** 选项卡上的 **触发历史记录** 选项卡。你应该看到最新的一个状态为绿色，表示成功，如图 *图 9* *.6* 所示。
- en: '![Figure 9.6 – Success!](img/B21998_09_6.jpg)'
  id: totrans-94
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.6 – 成功！](img/B21998_09_6.jpg)'
- en: Figure 9.6 – Success!
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.6 – 成功！
- en: If the start time does not match up to what you are expecting, you may have
    to click **Refresh** at the top of the blade. Click the green success indicator
    and click on **Outputs** again. The **statusCode** should now be **200 (OK)**
    , and you should once again see the text you configured in the **Function Environment**
    variables blade.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 如果开始时间与您预期的不符，您可能需要点击选项卡顶部的 **刷新**。点击绿色的成功指示器，然后再次点击 **输出**。现在 **statusCode**
    应该是 **200 (OK)**，你应该再次看到在 **函数环境** 变量选项卡中配置的文本。
- en: Summary
  id: totrans-97
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, you learned the difference between A&A. You then saw how to
    use the Azure controls to establish authentication and authorization for a specific
    Azure resource. In the next chapter, we will learn about **Continuous Integration
    and Continuous Deployment** ( **CI/CD** ) on Azure.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你学习了 A&A 之间的区别。然后你看到了如何使用 Azure 控件为特定的 Azure 资源建立身份验证和授权。在下一章中，我们将学习 Azure
    上的 **持续集成和持续部署** ( **CI/CD** )。
- en: You try it
  id: totrans-99
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 你试试看
- en: Using the deployed function from [*Chapter 6*](B21998_06.xhtml#_idTextAnchor077)
    , authenticate yourself and give yourself authorization. Ensure this succeeds
    by creating a console app. Then create a Logic app and then authorize it to call
    your API.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 使用从 [*第 6 章*](B21998_06.xhtml#_idTextAnchor077) 部署的函数，进行身份验证并授权给自己。通过创建控制台应用程序来确保此操作成功。然后创建一个逻辑应用，并授权其调用您的
    API。
