<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" epub:prefix="z3998: http://www.daisy.org/z3998/2012/vocab/structure/#" lang="en" xml:lang="en">
<head>
    <title>To the Cloud</title>
    <link href="css/style.css" rel="stylesheet" type="text/css"/>
    <link href="68851547a55f.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">To the Cloud</h1>
                </header>
            
            <article>
                
<p class="mce-root">So far we have learned and explored the fundamentals of ASP.NET Core 2.0 by developing applications that ran locally in our machines. The real value of these apps can be realized only when these apps are deployed and available on the internet, so that they can be accessed from virtually anywhere and everywhere on the planet. To do so, we need to learn to deploy our ASP.NET Core 2.0 apps in the cloud, Microsoft Azure. An obvious question that comes to mind is <em>Why should I care about the cloud?</em>&#160;In this chapter, we will answer this question and<span>&#160;get introduced to Microsoft Azure</span>, our cloud platform, and learn its basics. So far, we deliberately developed applications that did not do any data persistence and hence did not use a relational database. We will also learn to develop an end-to-end application that uses a relational database for data persistence and learn about Entity Framework Core in the process. We will grasp these concepts by developing a simple movie booking web app and then deploy this web app on Azure. Finally, we will integrate the Chatbot that we developed earlier in the book with our movie booking site. We have a lot of ground to cover, so let's get into the cloud!</p>
<p>We will cover the following&#160; topics in this chapter:</p>
<ul>
<li>Introduction to the cloud</li>
<li>Types of cloud</li>
<li>Getting started with Azure</li>
</ul>


            </article>

            
        </section>
    </div>


    <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Introduction to the cloud</h1>
                </header>
            
            <article>
                
<div class="mce-root packt_quote"><span>For the cloud, we're all in.</span></div>
<div class="packt_quote CDPAlignRight CDPAlign"><span>–</span> <span>Steve Ballmer</span></div>
<div class="packt_quote"><span>At our core, Microsoft is the productivity and platform company for the mobile-first and cloud-first world.</span></div>
<div class="packt_quote CDPAlignRight CDPAlign">–&#160;Satya Nadella</div>
<p>These two quotes from the former and current Microsoft CEO highlight the importance of the cloud. The cloud has been one of the hottest buzzwords over the last few years but you shouldn't be surprised to know that we have been using the cloud for a decade, maybe more, without realizing it. Gmail, Facebook, Skype, Dropbox, OneDrive, and so on are all examples of cloud solutions that we use almost everyday.</p>
<p>Cloud computing is an <strong>information technology</strong> (<strong>IT</strong>) paradigm that enables ubiquitous access to shared pools of configurable system resources and higher-level services that can be rapidly provisioned with minimal management effort, often over the internet. Cloud computing relies on the sharing of resources to achieve coherence and economy of scale, similar to a utility. Clouds enable organizations to focus on their core businesses instead of expending resources on computer infrastructure and maintenance. Cloud computing allows enterprises to get their applications up and running faster, with improved manageability and less maintenance, and it enables IT teams to more rapidly adjust resources to meet fluctuating and unpredictable business demand.</p>
<p>The fundamental idea behind the cloud is that we can access all the information over the internet without worrying about detailed information about the infrastructure needed to enable it.</p>
<p>The cloud provides businesses and organizations with:</p>
<ul>
<li><strong>Flexibility</strong>: Based on the business requirements, such as enhancing a basic plan to a premium plan, we can scale the number of servers up or down. Imagine a cake business web app. During the Christmas holiday season, the demand for cakes and thus traffic to the website increases manyfold. So to serve this increased load, the number of servers can be increased during the holiday season, and during a lean phase, it can be decreased. This flexibility is key in today's economy where businesses have to save and excel in every little margin.almost instantly by the consumer as and when needed without any human</li>
<li><strong>On-demand self-service</strong>: The services can be provisioned or decommissioned almost instantly by the consumer as and when needed without any human intervention.&#160;</li>
<li><strong>Security</strong>: Security is paramount. Rest assured that your data is more secure in the cloud than in the desktop located at your desk or the laptop that you carry. A lost/stolen laptop is a frequently encountered issue. More than financial cost, loss of sensitive data is <span>exorbitantly costly,</span> not just financially but also regarding reputation and trust. The cloud gives you better security when this happens. As the data is stored in the cloud, you can access it no matter what happens to your machine. You can even remotely wipe out data from your machine, if it falls into the wrong hands.</li>
<li><strong>Cost</strong>: <span>Using the cloud saves on maintenance costs and the high cost of hardware. No more servers, software, and update fees. You simply <em>pay as you go</em>&#160;and enjoy a subscription. You also save on the cost of people to procure the hardware, maintain it, and update it.</span></li>
<li><strong>Disaster recovery</strong>:<strong>&#160;</strong><span>A robust disaster recovery plan in needed for any large or small enterprise as one disaster can put you out of business. The cloud lets you do it easier than ever.</span></li>
<li><strong>Automatic updates</strong>:<span>&#160;Since all the servers are off-premise on the cloud,&#160;you don’t have to worry about wasting time maintaining the system yourself. The cloud provider takes care of maintenance for you and rolls out regular software updates. This keeps you free to focus on the things that matter, such as growing your business.</span></li>
<li><strong>Collaboration</strong>:<span>When your teams can access, edit, and share documents anytime from anywhere, they're able to do more things better collaboratively. Cloud-based workflow and file sharing apps help them make updates in real time and give them full visibility of their collaborations.</span></li>
<li><strong>Work from home</strong>: Why just home? Work from anywhere you have the internet. Yes, that's a reality with the cloud.</li>
</ul>
<p>This and many more benefits make the cloud indispensable for any modern day IT professional. I would go one step ahead and say that:&#160;</p>
<div class="packt_quote"><q><em>If you are not in cloud, you are out of IT.</em></q></div>
<p>Next, let's have a look at different types of cloud.</p>


            </article>

            
        </section>
    </div>


    <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Types of cloud</h1>
                </header>
            
            <article>
                
<p>Broadly speaking, the cloud deployment model can be classified into:</p>
<ul>
<li><strong>Public cloud:</strong> This is the most commonly used cloud deployment model. A public cloud is one in which the service provider makes resources such as services, applications, or storage available to the general public over the internet. Public cloud services may be <em>free</em> or offered on a <em>pay as you go</em> model. Some examples of public cloud services are Microsoft Azure, <span>Amazon <strong>Elastic Compute&#160;</strong></span><strong>Cloud</strong><span>&#160;(<strong>EC2</strong>), IBM's Blue&#160;</span>Cloud<span>,</span> <span>Google App Engine, and so on.</span></li>
<li><strong>Private cloud:</strong>&#160;A private cloud offers similar advantages to a public cloud, but through a proprietary architecture. Unlike a public cloud, a private cloud is dedicated to a single organization. Since there is a lot of cost involved, only a large organization can invest in private clouds. <span>Organizations with a lot of software&#160;developers are use cases for private clouds, as developers have frequent requests&#160;for new virtual machines. For e</span>xample, the <strong>State Bank of India</strong> (<strong>SBI</strong>) has built a private cloud named <strong>Meghdoot</strong>&#160;which powers multiple business services.</li>
<li><strong>Hybrid cloud:</strong> This <span>is a combination of public cloud services and private clouds. It is not&#160;necessary to have a private cloud in order to use a hybrid cloud. A hybrid cloud can also be a combination of virtualized, on-premise data centers&#160;and public cloud services. A hybrid cloud can also&#160;be seen as a bridge between the public and private clouds, which enables moving&#160;workloads between the earlier two deployments based on policy, costs, and so on.&#160; Most companies today operate using this deployment model. For example, Marriot and Dominos Pizza make use of hybrid clouds.<br/></span></li>
</ul>
<p>Cloud computing services can be categorized into three service delivery models:</p>
<ul>
<li><strong>Infrastructure as a Service</strong> (<strong>IaaS</strong>)</li>
<li><strong>Platform as a Service</strong> (<strong>PaaS</strong>)</li>
<li><strong>Software as a Service</strong> (<strong>SaaS</strong>)</li>
</ul>
<p>The following diagram should illustrates these service delivery models:&#160;</p>
<div class="CDPAlignCenter CDPAlign"><img height="446" width="595" src="assets/4b5afee2-7074-4350-8fa2-a55229b15636.png"/></div>
<p>We can see that:</p>
<ul>
<li><span>In <strong>On-Premises</strong> deployment, the customer has to manage each and every thing from hardware to software; for example, any software deployed in the server hosted on company premises.</span></li>
<li>In<em>&#160;</em><strong>IaaS</strong>, all the required infrastructure is managed by the vendor. The customer just manages the operating system, software, runtime, and the application and its data; for example, Amazon EC2, Microsoft Azure, and Google Compute Engine.</li>
<li>In&#160;<strong>PaaS</strong>, the infrastructure as well as the operating system and runtime is managed by the vendor. The customer just manages the applications and its data; for example, Google App Engine, Heroku, and Microsoft Azure.</li>
<li>In<em>&#160;</em><strong>SaaS</strong>, the entire infrastructure and software is managed by the vendor. The customer just consumes the software as a service; for example, Microsoft Office 365, Gmail, and OneDrive.</li>
</ul>
<p>Now we are aware of the basics of the cloud, it's time to get started with the cloud platform that is the future and we all need to embrace, Microsoft Azure.</p>


            </article>

            
        </section>
    </div>


    <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Getting started with Azure</h1>
                </header>
            
            <article>
                
<p>Microsoft Azure (formerly called Windows Azure) is the cloud service created by Microsoft for building, testing, deploying, and managing web applications and services&#160;<span>through a global network of Microsoft-managed&#160;</span>data centers<span>. It provides</span> SaaS<span>,</span> PaaS, <span>and</span> <span>IaaS, and supports many different&#160;</span>programming languages<span>, tools, and frameworks, including both Microsoft-specific and third-party software and systems. All the examples in this book are developed in a <strong>virtual machine</strong> (<strong>VM</strong>) hosted in Azure. Since we also needed a Linux VM to demonstrate ASP.NET Core 2.0 cross-platform support, the Linux VM is also created and hosted in Azure. This is the best example to demonstrate how flexible and easy it is for developers to embrace and use Azure.</span></p>
<p>An obvious question that may come to your mind is: why use Azure and not Amazon's AWS or Google Cloud? Fair enough, I am completely biased on this one and I strongly believe Microsoft Azure is way ahead of its competitors in numerous parameters. Some them are highlighted in the following list:</p>
<ul>
<li><span><strong>Security compliance and trust</strong>: Azure has more comprehensive</span> compliance <span>coverage with more than 70 compliance offerings and is the first major cloud provider to contractually commit to the requirements of the&#160;</span><strong>General Data Protection Regulation</strong> (<strong>GDPR</strong>)<span>. To protect your organization, Azure embeds security, privacy, and compliance into its&#160;</span>development methodology<span>&#160;and has been recognized as the most trusted cloud for&#160;</span>US government institutions.</li>
<li><strong>Global presence with most regions</strong>: Azure has the largest number of regions in the world covered, with 42 announced Azure regions—more than any other cloud provider. You can choose the data center and region which is right for you and your customers, with the performance and support you need, where you need it.</li>
<li><strong>Support for multiple development tools and language</strong>: When Satya Nadella said <q><em>"Microsoft ♥ Linux"</em></q>, it gave a strong message to the world that Microsoft is actively listening to its customers and embracing open source at its core. The same strategy shows in the Microsoft cloud as well, which supports numerous tools, frameworks, and languages. Microsoft is the leading open source contributor on GitHub and actively supports multiple open source community projects.</li>
<li><strong>Real hybrid cloud approach</strong>: Azure offers hybrid consistency everywhere from application development, security, identity management, and data platforms. This helps reduce the risk and cost of the hybrid cloud environment.</li>
<li><strong>Unmatched artificial intelligence</strong>: It's never been easier to develop intelligent solutions that scale using Microsoft Cognitive services, bots, machine learning, and <strong>Blockchain as a Service</strong> (<strong>BaaS</strong>) capabilities that can be found only with Azure.&#160;</li>
<li><strong>Big data with advanced analytics</strong>: Azure Cosmos DB enables you to scale your application limitlessly with big data support. Then the advanced business analytic services provided by Azure make you go way higher than your competitors.</li>
<li><strong>Manage and optimize cloud cost</strong>: With free Azure cost management, it is easy to optimize cloud resources and budget them within your allocated funds.&#160;</li>
<li><strong>IoT ready</strong>: You can quickly develop the most common IoT scenarios, such as remote monitoring, using the pre-configured solutions in the Azure IoT suite.</li>
<li><strong>Unmatched developer productivity</strong>: Azure is developer-friendly, and as we will see in a short while, we can develop, deploy, and test our app in Azure from within Visual Studio or PowerShell.</li>
</ul>
<div class="packt_infobox"><span>A data center is a facility composed of networked computers and storage that businesses or other organizations use to organize, process, store, and disseminate large amounts of data. A business typically relies heavily upon the applications, services, and data contained within a data center, making it a focal point and critical asset for everyday operations.</span></div>
<p><span>Azure is an expanding network of data centers around the world. These data centers form <strong>regions</strong>.</span>&#160;This provides us with the flexibility to use the&#160;region of our choice to deploy the resources/applications for the best performance. The following screenshot showing the Microsoft Azure website (<a href="https://azure.microsoft.com/en-us/">https://azure.microsoft.com/en-us/</a>) illustrates these different regions on the world map.&#160;We can see multiple regions in the United States, UK, Europe, India, and Japan. When we deploy an application, we need to select a region for the deployment. I might select a specific region to keep the application geographically close to me or my customers. I live in India, so I might use the West or Central or South India region for my development purposes. I can also deploy to multiple regions if I wanted some redundancy. The takeaway from this diagram is that Microsoft Azure is running millions of computer servers, physical machines that are spread around these regions around the world, and Microsoft ensures that these machines are up and running, healthy, and physically secure. We just need to leverage a portion of this enormous computing power to do our work:</p>
<div class="CDPAlignCenter CDPAlign"><img height="369" width="576" src="assets/b19ad482-faaf-42fe-a5c5-6fd90cd8bcbe.png"/></div>
<p>Now that we have the fundamental concepts of the cloud (and Microsoft Azure) in place, let's get started using the Azure platform.</p>
<p>First of all, you will need to register your account with Azure. To do so, go to <a href="https://portal.azure.com/">https://portal.azure.com/</a> and register with any of your Microsoft accounts, such as Hotmail, MSN, Outlook, or Live. At the time of writing this chapter, Azure offered the following great and free benefits when creating an account. These may vary by the time you read the book:</p>
<ul>
<li>12 months' free access to popular products. You also get 25 always free products.</li>
<li>A $200 credit to use on any Azure products for 30 days.</li>
<li>Azure uses credit card information only for identity verification and you are not charged until you change your subscription to a <em>pay as you go</em>&#160;subscription. If you work in a large enterprise or a Microsoft partner, or a BizSpark program or MSDN subscriber, you already get a subscription to Azure cloud resources.</li>
</ul>
<p>Once you are registered, you will see a nice dashboard. This is the Azure management portal. The dashboard user interface keeps getting better and is updated from time to time, so by the time you read this chapter, the user interface may be different from what it is right now. The important thing to notice is that there is a left panel which lists all of the Azure services that you can use. First-time users should take the guided tour of Azure to get themselves familiar with the user interface as it is very rich in features. Let's have a quick look at the user interface. The following screenshot illustrates the Azure dashboard after you log in. We have marked the user interface with numbers so that we can see each of these items in reasonable depth:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/04230ebf-6964-4c60-9e74-af6da1b72bbc.png"/></div>
<p>Let's have a look at the different components:</p>
<ol>
<li><strong>Hamburger button</strong>: Shows the hamburger menu on the left panel. This has the standard hamburger button behavior. When expanded, it shows the icon as well as a description of the various services that Azure provides. On collapse, it increases the real estate for the right column (where the&#160;<span class="packt_screen">Dashboard</span> is showing up) as only icons are displayed in the collapsed left panel.</li>
<li><span class="packt_screen">New</span>: Creates a new resource. On clicking, displays the resource that needs to be created from the Marketplace. You can also use this to view the wide variety of services in Azure Marketplace.</li>
</ol>
<ol start="3">
<li><strong>Left panel hub displaying favorite Azure services</strong>: All your favorite or commonly used services/resources that Azure offers are displayed in this area that we call a hub. This is the place to go when you want to create or manage the resources that you own in Azure. Don't get confused with the word resource; just like a software developer is referred to as a resource when managers talk, everything that we can create from virtual machines to web apps, Redis Cache, and so on, are generally called resource. Well, there are so many Azure resources that not all of them can fit in the hub, so what can be shown are shown and the rest are shown under the item <span class="packt_screen">More Services</span>.</li>
<li><strong>Dashboard on right panel</strong>: In the screenshot, this is displaying the Azure <span class="packt_screen">Dashboard</span> from all the subscriptions. We can have two types of dashboard: private and shared. Shared dashboards can be shared with other users, while private is as the name suggests. The intent of the dashboard is to have quick access to the resources you use, so that you can view and manage them quickly.</li>
<li><span class="packt_screen">New dashboard</span>: This presents an option to create a new dashboard where you can customize the tiles for resources to be shown in the way you want them to show up. You can pin, move, or resize the resource tiles the way you want.</li>
<li><span class="packt_screen">Edit dashboard</span>: Enables you to edit the dashboard. You can remove a tile from the dashboard, or add a new one, or maybe just drag and change its position. You can make a tile smaller or larger as per your preference.&#160;</li>
<li><span class="packt_screen">Share</span>: Enables you to share the dashboard with other users. You can share the dashboard by publishing it as an Azure resource. Azure <strong>Role-Based Access Control</strong> (<strong>RBAC</strong>) will determine who has access to the dashboard. Access to individual tiles can differ from access to the dashboard itself.</li>
</ol>
<ol start="8">
<li><span class="packt_screen">Fullscreen</span>: Displays the portal full-screen.</li>
<li><span class="packt_screen">Clone</span>: Clones the dashboard.</li>
<li><span class="packt_screen">Delete</span>: Deletes the dashboard.</li>
<li><strong><span>Search</span></strong>: To search the resource/services you are looking for.</li>
<li><strong>Notifications</strong>: Clicking on this bell-like icon displays notifications and status updates, such as billing updates, resource start/stop/error notifications, and other information.</li>
<li><strong>Cloud Shell</strong>: Using this command prompt-like icon, you can select bash or PowerShell. You can change shells any time through the environment selector in the Cloud Shell toolbar. The most recently used environment will be the default for your next session.</li>
<li><strong>Settings</strong>: The gear icon represent settings in the current portal. It allows you to customize the portal settings, themes, language, and so on.</li>
<li><strong>Feedback</strong>: To share the feedback from the Azure portal with the Microsoft Azure product team.</li>
<li><strong>Help</strong>: To get help and support. You can create or track a support ticket and monitor the health of your Azure services and resources. You can also check the keyboard shortcuts, with a guided tour here.</li>
<li><strong>Account information</strong>: Switch directories, change your password, view permissions, submit an idea, or view your bill.&#160;</li>
<li><span class="packt_screen">Service Health</span>:&#160;<span>Personalized guidance and support when issues in Azure services affect you.</span></li>
<li><span class="packt_screen">Marketplace</span>:&#160;<span>Discover, purchase, and manage add-ons and services from Microsoft partners.</span></li>
<li><span class="packt_screen">What's new</span>: Keeps you updated with the latest and greatest information on Azure.</li>
<li><span class="packt_screen">Feedback</span>: Same as <em>Step 15</em>.</li>
<li><span class="packt_screen">Azure classic portal</span>: To view the old classic Azure portal, for old users of Azure who are comfortable with the old portal.</li>
<li><span class="packt_screen">Help + support</span>: Same as <em>Step 16</em>.</li>
<li><span class="packt_screen">All resources</span>: Displays all resources and services from the subscription that you are using.&#160;</li>
</ol>
<p>Though we have discussed and defined tiles here, please note that since the dashboard is customizable, you can choose to have a tile or remove it altogether. So, a few of the tiles may show / not show in your dashboard. The intent here is to make you aware of the portal. Also there are tiles numbered <span class="packt_screen">25</span>, <span class="packt_screen">26</span>, and <span class="packt_screen">27</span> in the screenshot, which I have pinned after creating these resources (actually, Azure pins resource to the <span class="packt_screen">Dashboard</span> as soon as you create it based on a setting). These tiles display the resources/services that I am using and their status. In the screenshot, <span class="packt_screen">25</span> is a tile named <span class="packt_screen">DotNetCore2</span>. It is a virtual machine and it has stopped. <span class="packt_screen">26</span> shows a web app named <span class="packt_screen">testdecompression</span> which is stopped as well. <span class="packt_screen">27</span> is a web app named <span class="packt_screen">packtletschat</span>, which is up and running. Hopefully, this discussion has got you started with the Azure management portal. Next we will create a virtual machine and web app in Azure and then see how we can deploy our ASP.NET Core 2.0 apps published in Azure.&#160;</p>


            </article>

            
        </section>
    </div>


    <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating a VM in Azure</h1>
                </header>
            
            <article>
                
<p>In this section, we will learn to create a VM in Azure. Developers need VMs all the time. If you are wondering what I mean, just imagine that you wanted to try out out some new version of a tool or software that is not yet production-ready and you do not wish to try it out on your own laptop due to probable instability issues this new untested software may cause. I always do so, whenever I am trying out nightly builds of products or getting hands-on with any new product. Azure provides you with great flexibility and choice. There are numerous choices and configurations available to select the operating system that you want and the size that you require. We, being passionate .NET developers, may want a VM which has the great Visual Studio 2017 installed, so that we can start developing as soon as we provision the VM. To this end, we will learn to create a VM in Azure. To do so, let's perform the following steps:</p>
<ol>
<li>On the left panel (hub) of the Azure management portal, click on <span class="packt_screen">Virtual machines</span>. Ensure you click on <span class="packt_screen">Virtual machines</span> and not <span class="packt_screen">Virtual machines (classic)</span>. We will discuss the difference between classic and the resource manager later in this section.
<div class="CDPAlignCenter CDPAlign"><img height="361" width="195" src="assets/01e58050-df5e-4f70-9e6b-dcc631fcff22.png"/></div>
You will see a <span class="packt_screen">Virtual machines</span> screen, which lists all the virtual machines that you have as well as providing the user interface to <span class="packt_screen">Add</span> a virtual machine, <span class="packt_screen">Start</span>, <span class="packt_screen">Stop</span>, <span class="packt_screen">Delete</span>, and <span class="packt_screen">Restart</span> a virtual machine, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/7059ce1e-90d6-472f-932e-a7f28273bd04.png"/></div>
<ol start="2">
<li>Click on the <span class="packt_screen">Add</span> button. This will open a new fly-out on the right side, displaying a number of virtual machine images to choose from. This fly-out is what we call a blade. You can have Red Hat Linux, Windows Server, Ubuntu, or anything else based on your requirements. Since we need a Windows 10 machine with Visual Studio 2017 Community Edition installed, let's search for <kbd>Visual Studio 2017</kbd>. This shows the following list of results:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="426" width="539" src="assets/47fc6595-1fcc-4d8f-9428-a5e26d5f7c88.png"/></div>
<ol start="3">
<li>Select the image that best suits your needs. On doing so, a new blade will appear displaying the details of the virtual machine image, its publisher, useful links, last updated date, its desktop screenshot, deployment model, and so on. Always select the deployment model as <span class="packt_screen">Resource Manager</span> as it gives you the ability to automate with PowerShell, unlike <span class="packt_screen">Classic</span>. This blade can be seen in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="635" width="405" src="assets/118b9cb6-b7c2-4696-9ddd-146d2d1bb716.png"/></div>
<ol start="4">
<li>On clicking the&#160;<span class="packt_screen">Create</span> button, the following screen will display, which has four basic steps to create a virtual machine:
<ol>
<li><span class="packt_screen">Basics</span></li>
<li><span class="packt_screen">Size</span></li>
<li><span class="packt_screen">Settings</span></li>
<li><span class="packt_screen">Summary</span></li>
</ol>
</li>
</ol>
<p style="padding-left: 60px">The <span class="packt_screen">Basics</span> section gathers fundamental information about the virtual machine to be created, such as:</p>
<ul>
<li style="list-style-type: none">
<ul>
<li><span class="packt_screen">Name</span>: The name of the virtual machine,&#160;which has to be unique.</li>
<li><span class="packt_screen">VM disk type</span>:&#160;This can be <strong>solid-state drive</strong> (<strong>SSD</strong>), which offers consistent, low-latency performance and is ideal for production use or standard disks (HDD) that are backed by magnetic drives and are preferred for applications where data is accessed infrequently.&#160;</li>
<li><span class="packt_screen">User name</span>: The username to log in to the virtual machine.</li>
<li><span class="packt_screen">Password</span>,<strong>&#160;</strong><span class="packt_screen">Confirm password</span>: These should be the same as the user name and this password will be used with the username to log in to the virtual machine.</li>
<li><span class="packt_screen">Subscription</span><strong>:</strong> This&#160;is auto-populated. If you have numerous subscriptions, you can choose the one with which you wish to create the virtual machine.</li>
<li><span class="packt_screen">Resource group</span>: A resource group is a collection of resources that share the same life cycle, permissions, and policies. For better management, you can choose to <span class="packt_screen">Create new</span> or reuse an existing resource group.</li>
<li><span class="packt_screen">Location</span>: The Azure data center that you wish to use for creating the virtual machine. Based on your location or your customer's location, you may want to choose the closest location for performance and low latency. Click <span class="packt_screen">OK</span><span>:</span></li>
</ul>
</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img height="629" width="432" src="assets/27e7650d-cbcf-4e26-a217-0f2388817fff.png"/></div>
<ol start="5">
<li>&#160;In the <span class="packt_screen">Size</span> section, choose the size that suits your needs. Azure lists recommended sizes in the blade, but if it doesn't fit your requirements, click on <span class="packt_screen">View&#160;all</span> and you will see a lot more configurations to choose from. You can also customize the supported hard disk type, minimum CPU, and memory by moving the slider bars against these parameters. Azure lists CPUs, memory, number of data disks, disk size, and other included features with an important parameter for the cost in local currency that you would need to shell out per month to use it, so use this wisely. Once you nail down on size, click <span class="packt_screen">Select</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/c22daa02-636c-4517-a094-5f5170b3b2b5.png"/></div>
<ol start="6">
<li>The <span class="packt_screen">Settings</span> section includes important yet auto-populated settings for the VM. Some important ones are discussed here:
<ul>
<li><span class="packt_screen">Availability set</span>: Azure has an availability SLA of 99.95%. For high availability of the virtual machine, it is recommended to have redundancy and group two or more VMs in an availability set. The advantage is that in the event of planned or unplanned maintenance, at least one virtual machine will be available, meeting the Azure availability SLA of 99.95%. This setting cannot be changed after the virtual machine is created. In our case, we do not need this, so we will go with the default value of <span class="packt_screen">None</span>.</li>
<li><span class="packt_screen">Use managed disk</span>: This feature may not be available in all the regions. When this is set to <span class="packt_screen">Yes</span>, Azure automatically manages the availability of the disks to provide data redundancy and fault tolerance.&#160;</li>
<li><span class="packt_screen">Auto-shutdown</span>: This feature is very important, at least financially. While your virtual machine is running, every minute, so keep it switched on only when you need it to keep your bills affordable. If you enable auto-shutdown, you can configure the VM to shut down daily at a specified time. For example, if the VM is being used only during office hours, it makes perfect sense to shut it down out of office hours and save on money. The <span class="packt_screen">Settings</span> blade is shown in the&#160;<span>following screenshot</span>:</li>
</ul>
</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="667" width="146" src="assets/e682a864-3ea1-492d-813c-18a4ad70fd16.png"/></div>
<ol start="7">
<li>Click <span class="packt_screen">OK</span>. A <span class="packt_screen">Summary</span> page with all the settings will be displayed in the <span class="packt_screen">Summary</span> blade along with terms of use. If you agree to it, click <span class="packt_screen">Create</span> and your virtual machine will start to be created. You will be taken to your <span class="packt_screen">Dashboard</span> page, which will now has a new tile added with the name of your virtual machine and it will show the status of this resource. Within a matter of a few minutes your virtual machine will be provisioned. Once it is provisioned, you will get a notification stating that the virtual machine is successfully deployed and the dashboard tile of the virtual machine will display the state as <span class="packt_screen">Running</span>.&#160;</li>
<li>Click on the tile of the virtual machine that we have created. It will take us to the <span class="packt_screen">Overview</span> blade of the virtual machine, as shown in the <span>following screenshot</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/1b9bc28c-7c77-4598-bdfe-a5af9dd0a248.png"/></div>
<p style="padding-left: 60px">You will see the following options:</p>
<ul>
<li style="list-style-type: none">
<ul>
<li><span class="packt_screen">Connect</span>: On clicking <span class="packt_screen">Connect</span>, the <strong>Remote Desktop Protocol</strong> (RDP<span>)&#160;</span>file will be downloaded. Clicking on this downloaded RDP will enable remote desktop connection to the virtual machine, after providing the username and password that you used while creating the virtual machine.</li>
<li><span class="packt_screen">Start</span>: Starts the virtual machine, if it's not started. The button will be enabled only if virtual machine is not running.&#160;</li>
<li><span class="packt_screen">Restart</span>: Restarts the virtual machine.&#160;</li>
<li><span class="packt_screen">Stop</span>: Stops the virtual machine and deallocates it.</li>
<li><span class="packt_screen">Capture</span>: This can be used to create a virtual machine image. We generally use it if we need a base image with additional configuration.&#160;</li>
<li><span class="packt_screen">Move</span>: To move the virtual machine to another resource group or subscription.</li>
<li><span class="packt_screen">Delete</span>: To delete the virtual machine.</li>
<li><span class="packt_screen">Refresh</span>: To refresh the status of the virtual machine.</li>
</ul>
</li>
</ul>
<div class="packt_tip">Azure has great documentation and cool training videos. They also have getting started guides and architecture recommendations to create and use Azure resources. You can find the documentation, the SDK, on the Azure site at <a href="https://docs.microsoft.com/en-us/azure/">https://docs.microsoft.com/en-us/azure/</a>. Training, webinars, events, code samples, videos, whitepapers, and case studies can be found at&#160;<a href="https://azure.microsoft.com/en-us/resources/">https://azure.microsoft.com/en-us/resources/</a>.</div>
<p>With this, we have created our very first virtual machine on the cloud (Azure) and we can use it as well by clicking the remote desktop file that we downloaded. On clicking the <kbd>.rdp</kbd> file, it will prompt for the username and password in the standard way as any other remote desktop connection does. It's just that this virtual machine is hosted in the cloud, in Azure. Once you are logged in, you can use it the way you want. Remember, once the virtual machine is started, irrespective of whether you use it or not, it starts costing you. So, if you wish to be cost-efficient, ensure you turn it off when you are not using it and start it when you do. This concludes our discussion on virtual machines. Next, we will see how we can use PowerShell to automate resource creation and management in Azure.</p>


            </article>

            
        </section>
    </div>


    <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Automating using PowerShell</h1>
                </header>
            
            <article>
                
<p><span>In this section, we will learn to automate&#160;resource creation and management in Azure using PowerShell. The user interface route to creating resources in Azure is very effective and easy.</span> You may be wondering: Do you have to log in to the Azure portal to do every single thing? No. Everything that you can set and do in the Azure portal can also be automated by writing a program, or by writing a script. <span>Also, b</span><span>eing a developer, I prefer my code to do the work rather than going to the portal and doing operations manually. The code can also help us do the automation, so preventing the need for human intervention.&#160;</span>There are SDKs available for many languages, from C#, to JavaScript, to Ruby, and so on. We will look at how to start and stop the virtual machine that we just created using PowerShell by performing the following steps:</p>
<ol>
<li>Go to the URL at&#160;<a href="https://azure.microsoft.com/en-us/downloads/">https://azure.microsoft.com/en-us/downloads/</a>. This is the central place where you can get SDKs and command-line tools. On this page, we can see there are SDKs for .NET developers, Java developers, Node.js, and so on. If we scroll down a little, we can see <span class="packt_screen">command-line tools</span>. Click on the <span class="packt_screen">Windows install</span> link under <span class="packt_screen">PowerShell</span>. It will download the installer executable:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/5a732706-62be-47ef-8a01-9a062c16a56c.png"/></div>
<ol start="2">
<li><span>Run the executable once the download is complete, following the installation instructions. N</span>ow open PowerShell ISE.&#160; It should be installed already. If not, you can also use PowerShell by searching for Windows Powershell on your Windows 10 machine. The first thing that we need to do is associate our PowerShell session with the Azure account. We can do that with the&#160;<kbd>Login-AzureRmAccount</kbd>&#160;command. PowerShell has tab completion, so after typing a few chars in your tab, it will try to complete the command. When you press <span class="packt_screen">Enter</span>, you'll be given an interface where you need to log in with your Microsoft account, as shown in the <span>following screenshot</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="263" width="298" src="assets/d712d0ec-d6cb-46e8-a63c-d0088effa737.png"/></div>
<ol start="3">
<li>Enter your username and password. If you have two-factor authentication enabled, you may need to enter code as well. Type the&#160;<kbd>Get-AzureRmSubscription</kbd>&#160;command. This will show the list of all the subscriptions displaying the subscription name, subscription ID, tenant ID, and state; that is, whether it is enabled or inactive. The&#160;PowerShell cmdlet has&#160;<kbd>AzureRm</kbd> in the name, <kbd>Rm</kbd> being resource manager:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="116" width="386" src="assets/7a6704a6-4af5-487e-a3bd-6178be363237.png"/></div>
<ol start="4">
<li>Next, we check <kbd>Get-AzureRmContext</kbd>.This cmdlet gives the current context, as shown in the <span>following screenshot</span>:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img height="125" width="472" src="assets/969135fa-2140-4eb9-a6af-d632669e87d0.png"/></div>
<ol start="5">
<li>Now, let us get a list of all the virtual machines that are in the subscription. We can get that with <kbd>Get-AzureRmVM</kbd>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/2451c792-fcf8-4463-8d90-7b872d43e2f6.png"/></div>
<ol start="6">
<li>To start the virtual machine, we will use the cmdlet <kbd>Start-AzureRmVM</kbd>, passing <kbd>Name</kbd> and <kbd>ResourceGroupName</kbd> as parameters, as shown in the <span>following screenshot</span>. The command will take a while to start the virtual machine, as can be seen from the <kbd>StartTime</kbd> and <kbd>EndTime</kbd> values:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/b3256711-a226-4a30-8d33-3158a1422b1f.png"/></div>
<ol start="7">
<li>To stop the virtual machine, we can use the cmdlet <kbd>Stop-AzureRmVM</kbd>,&#160;<span>passing&#160;</span><kbd>Name</kbd><span>&#160;and&#160;&#160;</span><kbd>ResourceGroupName</kbd><span>&#160;as parameters with the&#160;<kbd>Force</kbd> flag&#160;</span>. The <kbd>Force</kbd> parameter is used just to make it non-interactive; otherwise, there will be a prompt for confirmation. Like the&#160;<kbd>Start-AzureRmVM</kbd> command, this command also takes a while, as shown in the <span>following screenshot</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/f9b180f1-72cc-41eb-9b98-9f62ec482fd7.png"/></div>
<p>We saw how easy it is to manage a virtual machine from PowerShell. Managing it from the portal is easier, as it is just a click of a button, but the intent here is to demonstrate the flexibility provided by Azure. We can also execute these PowerShell commands in the Cloud Shell that we saw earlier in this chapter; that is, we execute the commands directly in the shell opened in a browser on the Azure portal. This needs additional storage and hence cost. This is a very basic getting-started discussion on Azure automation using PowerShell. There is an ocean of information to be learned and grasped. An enthusiastic learner should go through the documentation to enhance their knowledge and get a handle on the subject from the official Microsoft Azure documentation at <a href="https://docs.microsoft.com/en-us/powershell/azure/overview?view=azurermps-5.1.1">https://docs.microsoft.com/en-us/powershell/azure/overview?view=azurermps-5.1.1</a>. There are books and sample modules as well, built by the Microsoft and the Azure community for a variety of scenarios, that the reader can leverage to learn, understand, and experiment. These can be seen at&#160;<a href="https://docs.microsoft.com/en-us/azure/automation/automation-runbook-gallery">https://docs.microsoft.com/en-us/azure/automation/automation-runbook-gallery</a><span>.</span></p>
<p><span>Next, we will learn to publish a web app in Azure, which is the most commonly used operation.</span></p>


            </article>

            
        </section>
    </div>


    <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Publishing a web app in Azure</h1>
                </header>
            
            <article>
                
<p><span>In this section, we will learn to publish a web app in Azure. As discussed in the previous two sections, we can create a resource from the Azure portal or we can write code on top of the SDK of our preferred language; for example, C#, PowerShell, and so on. As a developer working on Microsoft technologies, most of my productive work time is spent on Microsoft Visual Studio, so I would like to publish the web app&#160; on Azure. This is the most common scenario that we perform as, after developing&#160;the web app, it should be hosted in the cloud&#160;for it to be available for a larger audience and more users. If we look at the Azure portal, we will see a service called <span class="packt_screen">App Services</span> in the left panel or hub. Let's discuss App Services first.&#160;</span></p>


            </article>

            
        </section>
    </div>


    <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Azure App Services</h1>
                </header>
            
            <article>
                
<p>Azure App Services is the solution if we want to build an application or an API that runs on a platform in the cloud. App Services supports a wide variety of technologies and application types from traditional web applications, such as a blog, or an e-commerce site, or a <strong>content management system</strong> (<strong>CMS</strong>). We can write the application in ASP.NET, Node.js or PHP, for that matter, many other frameworks and languages. If we just want to build a service/API and serve data, modern-day <strong>Single-Page Applications</strong> (<strong>SPA</strong>), or a logic app, App Services supports all of these. The process that we used to create the virtual machines in the last section on the Azure portal can be used to create an App Service as well. With virtual machines, we selected the operating system that we wanted. With App Services, we can go with a pre-configured App Service. For example, if we wanted to set up a WordPress blog, we could select the <span class="packt_screen">WordPress entry</span> and click <span class="packt_screen">Create</span>, and, with a little more configuration, we would have a WordPress site up and running. The name of the App Service that we want to create should be unique on <a href="https://azure.microsoft.com/en-us/">azurewebsites.net</a>, where the app will eventually be hosted. Next, we have to select a resource group. We can use an existing resource group or create a new resource group. Since it's a logical container for the resources, I prefer having separate resource groups, so once I am done with that resource, I can get rid of the entire resource in one go. The next thing we are asked by the Azure portal is to choose an App Service Plan. If we have to draw an analogy, think of it as something very similar to size when we created a virtual machine. The concept of the App Service Plan is very important.&#160;Every <strong>web application</strong> we will create will be placed into a <strong>single App Service</strong> dedicated to that application. And then every <strong>App Service</strong> maps to a single <strong>App Service Plan</strong>. A plan describes the performance characteristics of the machine that will host the App Service. Behind the scenes, the App Service Plan uses a virtual machine, but the virtual machine is abstracted away by Azure. We don't need to worry about managing the virtual machine as Azure takes care of it and abstracts this away from the end user. We can simply use the App Service Plan to describe how many CPUs&#160; and how much memory we need; Azure takes care of the rest. One important point to note about the App Service Plan is that we can deploy multiple App Services into Azure and have them all mapped to the same App Service Plan. Select an existing App Service Plan or a new App Service Plan, based on your web app needs. If you need to serve a lot of users, if there are going to be a lot of users using your web app, then we can select a bigger service plan from the portal which can serve a higher number of requests, we can reuse an existing service plan (if we have one already), or we can use a free or less costly plan. After completing all the configurations, we are good to click on <span class="packt_screen">Create</span>. Since all this is very similar to virtual machine creation, we are not delving much into the details. Within a few minutes, the App Service should be up and running. Now that we have our App Service created, we can publish our web app to this created App Service.&#160;</p>


            </article>

            
        </section>
    </div>


    <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Publishing the web app</h1>
                </header>
            
            <article>
                
<p><span>Let's publish an ASP.NET Core 2.0 web app in Azure using Visual Studio:</span></p>
<ol>
<li>Create a new ASP.NET Core 2.0 project in Visual Studio or use one of the existing applications that we have created thus far in the book. We will use one of the web apps that we developed in the book thus far for illustration purposes.</li>
<li>Right-click the project. On the context menu, click <span class="packt_screen">Publish</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="331" width="423" src="assets/cbc6894f-cb69-466a-af1f-c41809f882a8.png"/></div>
<ol start="3">
<li>This will display a nice-looking user interface, presenting us with three options. We can publish on:
<ul>
<li><span class="packt_screen">Microsoft Azure App Service</span>: The container for the web app.</li>
<li><span class="packt_screen">IIS, FTP</span>: For deploying on IIS or FTP on a virtual machine.</li>
<li><span class="packt_screen">Folder</span>: To publish the app in the local filesystem.&#160;</li>
<li><span class="packt_screen">Import profile</span><strong>:</strong> To import a publish profile from the Azure portal and publish the app. We will see this later in the chapter.</li>
<li><span class="packt_screen">Microsoft Azure Virtual Machines</span><strong>:</strong> To publish the app in a virtual machine hosted in Azure.&#160;</li>
</ul>
</li>
</ol>
<p style="padding-left: 90px">We will select the <span class="packt_screen">Microsoft Azure App Service</span>. That gives us two options: either to select an existing App Service or create a new one. We can use either of the options. This is to illustrate that we can create a brand new App Service directly from within Visual Studio or use an existing App Service that you created.&#160;Click on the <span class="packt_screen">Publish</span> button and we will get a series of dialogs. If you are not logged in with your Azure subscription credentials, you will need to do so.</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/89a3b336-e3c4-42bf-a4d8-e1f57e494378.png"/></div>
<ol start="4">
<li>You will notice that on the top right, it shows my Microsoft account with which I am logged in. I need to enter an <span class="packt_screen">App Name</span> that is unique.&#160;<span class="packt_screen">Subscription</span>&#160;will be auto-populated. But, if you have multiple subscriptions, you must choose the subscription that you wish to use. Both <span class="packt_screen">Resource Group</span> and <span class="packt_screen">App Service Plan</span> can be either created brand new or chosen from an existing one. Here, in the screenshot, I have chosen an already existing one. Click<span>&#160;</span><span class="packt_screen">Create</span>. It will show a&#160;<span class="packt_screen">Summary</span> screen:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/0cd05a32-a119-4db3-aaa8-4f549f168cf8.png"/></div>
<ol start="5">
<li><span>Click on <span class="packt_screen">Publish</span> and the app will be published on Azure. Visual Studio saves the publish settings file for the project. This can take a while the first time we publish because Visual Studio has to push up all the assemblies and artifacts that are needed for the App Service. But once it's published into Azure, and we just make a change to something like a Razor view file or script file and publish the next time, all Visual Studio needs to do is upload just the few changed files.</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/d3b4eca5-3a3e-4308-a9ce-c194d57a149e.png"/></div>
<ol start="6">
<li><span>After some time, upon successful publishing, the deployed application will open in the browser, as shown in the following screenshot:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/45ad37c1-0956-4103-be45-f2d6b76a3d78.png"/></div>
<p class="mce-root CDPAlignLeft CDPAlign"><span>Behind the scenes a publishing profile is created by Visual Studio, so let's have a quick look at it.&#160;</span></p>


            </article>

            
        </section>
    </div>


    <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Publishing profiles</h1>
                </header>
            
            <article>
                
<p class="mce-root">Upon publishing, Visual Studio will create a publishing profile. It's basically a folder containing files created in the project, and can be seen in the <span class="packt_screen">Properties</span> node of the project, as shown in the <span>following screenshot</span>:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/3fbf3c05-d031-4edb-84dc-ad36e152cb8c.png"/></div>
<p class="mce-root">We can have multiple profiles and these profiles will be stored in the <kbd>PublishProfiles</kbd> folder with the file extension <kbd>.pubxml</kbd>, as these are XML files.&#160;<kbd>.pubxml</kbd> files contain information such as the type of build ; for example, the release/debug build. It has URLs and a username that are part of the deployment credentials, as shown in the following code:</p>
<pre>&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;!--<br/>This file is used by the publish/package process of your Web project. You can customize the behavior of this process<br/>by editing this MSBuild file. In order to learn more about this please visit https://go.microsoft.com/fwlink/?LinkID=208121. <br/>--&gt;<br/>&lt;Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003"&gt;<br/>  &lt;PropertyGroup&gt;<br/>    &lt;WebPublishMethod&gt;MSDeploy&lt;/WebPublishMethod&gt;<br/>    &lt;ResourceId&gt;/subscriptions/9b9dd9d2-6058-4257-933c-<br/>    a5ef7740573f/resourcegroups/TestDecompression<br/>    /providers/Microsoft.Web/sites/<br/>    packtdotnetcore2GettingStarted&lt;/ResourceId&gt;<br/>    &lt;ResourceGroup&gt;TestDecompression&lt;/ResourceGroup&gt;<br/>    &lt;PublishProvider&gt;AzureWebSite&lt;/PublishProvider&gt;<br/>    &lt;LastUsedBuildConfiguration&gt;Release&lt;/LastUsedBuildConfiguration&gt;<br/>    &lt;LastUsedPlatform&gt;Any CPU&lt;/LastUsedPlatform&gt;<br/>    &lt;SiteUrlToLaunchAfterPublish&gt;http://packtdotnetcore2gettingstarted<br/>    .azurewebsites.net&lt;/SiteUrlToLaunchAfterPublish&gt;<br/>    &lt;LaunchSiteAfterPublish&gt;True&lt;/LaunchSiteAfterPublish&gt;<br/>    &lt;ExcludeApp_Data&gt;False&lt;/ExcludeApp_Data&gt;<br/>    &lt;ProjectGuid&gt;a1a01377-c3df-4586-9838-10c733becf91&lt;/ProjectGuid&gt;<br/>    &lt;MSDeployServiceURL&gt;packtdotnetcore2gettingstarted<br/>    .scm.azurewebsites.net:443&lt;/MSDeployServiceURL&gt;<br/>    &lt;DeployIisAppPath&gt;packtdotnetcore2GettingStarted&lt;/DeployIisAppPath&gt;<br/>    &lt;RemoteSitePhysicalPath /&gt;<br/>    &lt;SkipExtraFilesOnServer&gt;True&lt;/SkipExtraFilesOnServer&gt;<br/>    &lt;MSDeployPublishMethod&gt;WMSVC&lt;/MSDeployPublishMethod&gt;<br/>    &lt;EnableMSDeployBackup&gt;True&lt;/EnableMSDeployBackup&gt;<br/>    &lt;UserName&gt;$packtdotnetcore2GettingStarted&lt;/UserName&gt;<br/>    &lt;_SavePWD&gt;True&lt;/_SavePWD&gt;<br/>    &lt;_DestinationType&gt;AzureWebSite&lt;/_DestinationType&gt;<br/>  &lt;/PropertyGroup&gt;<br/>&lt;/Project&gt;</pre>
<p class="mce-root">The file doesn't contain a password. So it can be checked in the source control without worrying about compromising security. The deployment password by default is placed into a different file that is not part of the project but is in the same folder:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/7e448369-e9db-4a00-8762-452090dde00c.png"/></div>
<p class="mce-root">It is the&#160;<kbd>pubxml.user</kbd> file. The file does not contain the password in plain text. It's encrypted with a logged-in user-specific key, so if the file is copied and pasted and used by another user, the password will not decrypt correctly (as the key is user-specific, it will not match), hence the password will not work for them. So&#160;the obvious question that comes to mind is: What if I miss the password or delete the <kbd>pubxml.user</kbd> file and want to publish the app? We can do so by performing the following steps:</p>
<ol>
<li class="mce-root">Go to the Azure portal, and the <span class="packt_screen">Overview</span> blade of the App Service that we wish to publish to. Click on <span class="packt_screen">Get publish profile</span> to download the publish profile, as shown in the <span>following screenshot</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/85ec1a17-e4e9-433c-b9a6-b90f68139586.png"/></div>
<ol start="2">
<li>In Visual Studio, right-click on the project and click <span class="packt_screen">Publish</span>;&#160;select&#160;<span class="packt_screen">Import profile</span> and click&#160;<span class="packt_screen">OK</span><span>:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/9a11f743-c0bb-45ab-98ba-b16a43911ce2.png"/></div>
<ol start="3">
<li>Click <span class="packt_screen">Publish</span> and the web app will be published.</li>
</ol>
<p>Next, let's have a look at a few of the commonly used features of Azure that every .NET developer must be conversant with.</p>


            </article>

            
        </section>
    </div>


    <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">App Service features&#160;</h1>
                </header>
            
            <article>
                
<p>If we look at the App Service items&#160;that we created, we will notice a plethora of things. To describe them in detail would need a chapter of its own, so we will quickly look at few of the most common and important ones from a .NET developer perspective:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/1622f3d5-d39d-4d90-9b3a-dff0eebae4f5.png"/></div>
<p>As we can see, there are subsections for <span class="packt_screen">DEPLOYMENT</span>, <span class="packt_screen">SETTINGS</span>, <span class="packt_screen">APP SERVICE PLAN</span>, <span class="packt_screen">DEVELOPMENT TOOLS</span>, <span class="packt_screen">MOBILE</span>,&#160;<span class="packt_screen">API</span>,&#160;<span class="packt_screen">MONITORING</span>, <span class="packt_screen">SUPPORT + TROUBLESHOOTING</span>. Let us discuss each of these sections so that we know everything Azure has to offer and we can then leverage it as and when needed. The most basic and most frequently used ones are:</p>
<ul>
<li><span class="packt_screen">Overview</span>: Gives a complete overall picture of the App Service. We can browse the service, and start/stop/restart/delete the service from here. We can also download the publish profile of the service and reset the publish profile to invalidate previously downloaded publish profiles. The charts display the statistics of the App Service, such as the number of HTTP 5xx or server errors with the timeline, data in and out, number of requests, and average response time to serve a request.&#160;</li>
<li><span class="packt_screen">Diagnose and solve problems</span>:&#160;This provides an easy way to diagnose and solve problems with web apps. There are pre-defined categories of problem available which you can select and get a diagnosis using the Azure Health Checkup web app, which gives an in-depth overview of the app health based on requests, CPU usage, and memory usage.</li>
</ul>


            </article>

            
        </section>
    </div>


    <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">DEPLOYMENT</h1>
                </header>
            
            <article>
                
<p>In this category, the options are:</p>
<ul>
<li><span class="packt_screen">Quickstart</span>: Provides guidance to get you up and running with app deployment. Quickstart has handy guidance for ASP.NET, Java, Node.js, PHP, and Python.</li>
<li><span class="packt_screen">Deployment slots</span>:&#160;<span>Deployment slots let us deploy different versions of web apps to different URLs. We can test a certain version and then swap the content and configuration between slots.&#160;</span>Deployment slots enable us to validate that the app is working properly in Azure, before we promote the app into production. This also eliminates downtime, and gives the new deployment a chance to warm up before customers use it.&#160;&#160;We can have more than one slot with the right App Service Plan. For example, we might want one slot for testing, one for staging, and one for production. And once it has been validated that the deployment into staging is working, we can swap the slots; that is, we can take what is tested in the staging slot, and with a click of a button (or a PowerShell script), we can make the staging deployment into the new production. In the worst case, if something goes wrong it's very easy to swap these back and take the last working production deployment and put it into production again.&#160;</li>
<li><span class="packt_screen">Deployment options</span>: To configure the source control of your choice for deployment. <strong>Visual Studio Team Services</strong> (<strong>VSTS</strong>), OneDrive, Git, Bitbucket, and Dropbox are supported.</li>
<li><span class="packt_screen">Continuous Delivery</span>: This is currently in preview at the time of writing this chapter.&#160;<span>Continuous delivery in Visual Studio Team Services simplifies setting up a robust deployment pipeline. The pipeline builds, runs load tests, and deploys to the staging slot and then to production.</span></li>
</ul>


            </article>

            
        </section>
    </div>


    <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">SETTINGS</h1>
                </header>
            
            <article>
                
<p>Here the options are as follows:</p>
<ul>
<li><span class="packt_screen">Application settings</span>: The place where we can define and overwrite&#160;application settings and connection strings. We will see this in action in the next chapter, when we build our movie booking web app. This is also the place where we will enable WebSockets for our SignalR-based applications and convert the application to always-on; otherwise, the web application gets unloaded if it remains idle. Remote debugging is also enabled and disabled from this blade.&#160;</li>
<li><strong><span class="packt_screen">Authentication / Authorization</span></strong>: To enable/disable&#160;authentication.</li>
<li><strong><span class="packt_screen">Backups</span></strong>:&#160;<span>Configures backups to create restorable archive copies of web app content, configurations, and databases.</span></li>
<li><strong><span class="packt_screen">Custom domains</span></strong>: This is the place to configure and manage custom hostnames assigned to the web app. For example, my blog site is <kbd>rishabhverma.net</kbd>. If I want to link this domain with the web app, this is where I need to make the configuration. I can also enable an HTTPS-only flag here, so that all the traffic for HTTP is redirected to HTTPS, making my app more secure.</li>
<li><strong><span class="packt_screen">Scale up</span></strong>: To serve the increased/decreased load or demands of the web app, we need a higher/lower configuration of the App Service Plan and this is the blade to use for this purpose.</li>
<li><span class="packt_screen">Scale out</span>: In this blade, we can enable autoscaling, which will automatically scale the app, if the load increases based on the configured rule. We can also choose the instance count of the machines hosting the App Service in this blade.&#160;</li>
<li><span class="packt_screen">Automation script</span>: In this blade, we can a<span>utomate deploying resources with Azure Resource Manager templates in a single, coordinated operation. We can also define resources and configurable input parameters and deploy with script or code.</span></li>
</ul>
<p><span>We have discussed the&#160;</span>App Service Plan in some length, so as an exercise readers are expected to understand and learn the details of the App Service Plan, as that is directly linked to the performance and cost of the web app that you host in Azure.</p>


            </article>

            
        </section>
    </div>


    <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">DEVELOPMENT TOOLS</h1>
                </header>
            
            <article>
                
<p>Let's have a look at the options:</p>
<ul>
<li><span class="packt_screen">Advanced Tools</span>:&#160;Advanced Tools (Kudu) provides a collection of developer-oriented tools and extensibility points for the App Service. This will be one of the&#160; most frequently used blades, once we deploy our app in Azure. I would highly encourage readers to read the Kudu wiki at&#160;<a href="https://github.com/projectkudu/kudu/wiki">https://github.com/projectkudu/kudu/wiki</a>&#160;as it gives detailed information about Kudu.</li>
<li><strong><span class="packt_screen">Performance test</span></strong>: In this blade, we can perform the load testing of our App Service by simulating the virtual load of any number of users and the duration that we want to test against by specifying the number of users and test duration. We can specify either an API endpoint URL or a Visual Studio Web Test to run for performance testing.</li>
<li><span class="packt_screen">Extensions</span>:&#160;&#160;<span>Extensions add functionality to the App Service, such as the image optimizer for an image upload application, and so on.</span></li>
</ul>


            </article>

            
        </section>
    </div>


    <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">API</h1>
                </header>
            
            <article>
                
<p>Here are the options:</p>
<ul>
<li><strong><span class="packt_screen">API definition</span></strong>:&#160;<span>API definition lets us configure the location of the Swagger 2.0 metadata describing the API exposed through the App Service. This makes it easy for others to discover and consume the API.</span></li>
<li><strong><span class="packt_screen">CORS</span></strong>:&#160;<span><strong>Cross-Origin Resource Sharing</strong> (<strong>CORS</strong>) allows JavaScript code running in a browser on an external host to interact with the App Service backend. We can specify the origins that should be allowed to make cross-origin calls.</span></li>
</ul>


            </article>

            
        </section>
    </div>


    <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">MONITORING</h1>
                </header>
            
            <article>
                
<p>Let's have a look at the available options:</p>
<ul>
<li><strong><span class="packt_screen">Application Insights</span>:&#160;</strong>It helps us detect and diagnose quality issues in web apps and web services, and helps us understand what users are actually using in the App Service. This is of tremendous importance to analyze the performance and error characteristics of the App Service. We will make use of application insights while building our movie booking app in the next chapter.</li>
<li><strong><span class="packt_screen">Alerts</span></strong>: This is one of the superb features of Azure. If we want to know when our web app is performing poorly or there is a high CPU or memory usage due to load, we can configure rule-based email alerts in this blade and we will be notified by email if the rule criteria are met. Then with the help of other diagnostics we can figure out and fix the issue.&#160;</li>
<li><strong><span class="packt_screen">Diagnostic logs</span></strong>: In this blade, we can enable/disable application logging in a filesystem or blob. We can also enable/disable detailed error messages and failed request tracing. One thing to notice here is that filesystem logging is automatically disabled after 12 hours to keep the logs from bloating the filesystem, whereas blob logging will keep on going indefinitely.</li>
<li><strong><span class="packt_screen">Process explorer</span></strong>: To monitor/kill the processes running the App Service and monitor their memory and CPU usages.</li>
</ul>


            </article>

            
        </section>
    </div>


    <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">SUPPORT + TROUBLESHOOTING</h1>
                </header>
            
            <article>
                
<p>The options are:</p>
<ul>
<li><strong><span class="packt_screen">Resource health</span>:&#160;</strong>Resource health watches&#160;resource and tells us if they're running as expected and if not, what actions can be taken.&#160;</li>
<li><strong><span class="packt_screen">App Service Advisor</span>:&#160;</strong>App Service Advisor provides insights for improving the app experience on the App Service platform.&#160;</li>
</ul>
<div class="packt_tip">Visual Studio provides very rich extensibility support. There are numerous extensions for Azure as well. One great extension for Azure is Cloud Explorer, which should already be available with Visual Studio 2017. If not, I highly recommend you try it out. To search, download, and install any available Visual Studio extensions, click <strong><span class="packt_screen">Tools</span></strong> | <strong><span class="packt_screen">Extensions and Updates</span></strong>. Then search <kbd>Cloud Explorer</kbd> after clicking <strong><span class="packt_screen">Online</span></strong> on the left panel of the window. Cloud explorer can be opened by clicking on <span class="packt_screen">View</span> | <span class="packt_screen">Cloud Explorer</span><strong>.</strong> Cloud Explorer can be thought of as a minified version of the Azure management portal, which can be used from within Visual Studio IDE. We can start/stop a VM or App Service, profile the App Service,&#160; download the publish profile and logs, attach the debugger to Azure, and much more from this extension. The following screenshot displays the Cloud Explorer extension:
<div class="CDPAlignCenter CDPAlign"><img height="368" width="341" src="assets/f0a9515d-5d0f-4d1c-9907-b9cf33fba0fa.png"/></div>
</div>
<p>And this concludes our discussion of Azure. Next we will discuss cloud storage and Azure functions that provide cheap serverless computing.</p>


            </article>

            
        </section>
    </div>


    <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Cloud storage</h1>
                </header>
            
            <article>
                
<p>We are all aware of SQL Server (if not, do not worry). Azure SQL is just SQL Server deployed on Azure. We will not be discussing Azure SQL in this section as we will be using Azure SQL in the next chapter and hence will be discussing it at length then. We will check out the<span>&#160;storage accounts.&#160;</span><span>Storage accounts can store hundreds of terabytes (roughly speaking 1 Terabyte = 1,000 Gigabytes) of data.&#160;</span><span>We will discuss how to use Azure storage&#160;</span><span>as a place to keep uploaded files for our web application a</span><span>nd how we can enable users to download files from storage&#160;</span><span>by creating and handing out what's known as&#160;</span><span>a <strong>shared access signature</strong> (<strong>SAS</strong>). So, lets get started.</span></p>
<p>In the Azure portal, click on <span class="packt_screen">New</span> and select <span class="packt_screen">Storage</span> and then click&#160;<span class="packt_screen">Storage account - blob, file, table, queue</span>, as shown in the <span>following screenshot</span>:</p>
<div class="CDPAlignCenter CDPAlign">&#160;<img height="417" width="298" src="assets/ceca2877-708d-4b32-b183-0966f3bdfa87.png"/></div>
<p><span>There is also a link to a <span class="packt_screen">Quickstart tutorial</span>, which I would highly recommend as it has great getting-started videos and tutorials from the leading tech evangelists to get you up and running with Azure storage. On clicking <span class="packt_screen">Storage account - blob, file, table, queue</span>, a new blade named <span class="packt_screen">Create storage account</span> will display, as shown in the following screenshot:&#160;</span></p>
<div class="mce-root CDPAlignCenter CDPAlign"><img height="587" width="202" src="assets/7e1926e2-eb9c-4ae4-9010-5378d1bbff13.png"/></div>
<p>In the blade, enter the required fields:</p>
<ul>
<li><span class="packt_screen">Name</span><strong>:</strong> This should comprise 3-24 characters in lowercase or numeric text that should be unique across all Azure storage, as it is exposed on <span class="packt_screen">.core.windows.net</span>.</li>
<li><span class="packt_screen">Deployment model</span>:&#160;This should be kept as <span class="packt_screen">Resource manager</span>.</li>
<li><span class="packt_screen">Account kind</span>:&#160;This can be a general storage V1 or V2 or dedicated blob storage. We will keep it as general storage.</li>
<li><span class="packt_screen">Performance</span>: This can be chosen as <span class="packt_screen">Premium</span> or <span class="packt_screen">Standard</span> as required.</li>
<li><span class="packt_screen">Secure transfer required</span>:&#160;This should be <span class="packt_screen">Enabled</span> for any serious web app.</li>
<li><span class="packt_screen">Resource group</span>:&#160;This can be created new or reused.</li>
<li><span class="packt_screen">Location</span>: Select the location which is nearest to your business requirement.</li>
</ul>
<p><span>You can choose to pin the storage account to the dashboard by checking the</span> <span class="packt_screen">Pin to dashboard</span><span>&#160;checkbox.&#160;</span>Click <span class="packt_screen">Create</span>. After a while, the storage account will be created. Once the storage account is created, click on the pinned tile on the dashboard and it will take you to the storage account overview blade, which summarizes the storage account details. The important thing to note is in the middle of the blade and lists the different types of storage, as shown in the <span>following screenshot</span>:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/97edaf95-ccb0-4cab-a4e8-481962c158c9.png"/></div>
<p>So we can use four types of storage with the storage account. Let's briefly discuss these:</p>
<ul>
<li><strong>Blob storage</strong>: Blob is an abbreviation of&#160;<strong>Binary large object</strong>. We can store any type of file in blob storage.&#160;</li>
<li>&#160;<strong>Table storage</strong>:&#160;Table storage is a no-SQL database and is similar to a document DB but instead of storing documents, table storage is optimized for storing key value pairs. Table storage is really cheap and it's a good place to store large volumes of data.&#160;</li>
<li><strong>File storage</strong>:&#160;<span>File storage allows us to set up <strong>Server Message Block</strong>&#160;(SMB 3.0 protocol) file shares in the cloud. This storage is preferred generally when&#160;we have an existing application that needs to be migrated to Azure and the application already uses file shares.</span></li>
<li><strong>Queue storage</strong>:&#160;<span>Queues allow us to store and retrieve messages. And they are an important technology to have if we want to build reliable high-scale websites because they allow us to put a buffer between an application and the backend services that it uses.&#160;</span></li>
</ul>
<p>Blobs and queues are more frequently used and we shall be using blob storage in our next chapter when we develop our movie booking site, so we will conclude our brief discussion of storage. How to upload and download data from storage using an SAS token is something we will see in the next chapter in detail. This brings us to the end of this discussion and chapter on cloud introduction. We should now be ready to develop and deploy in Azure, which we will do in the next chapter.</p>


            </article>

            
        </section>
    </div>


    <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we learned what the cloud is and why the modern-day developer should be conversant with cloud technologies. We also got started with Azure, and made ourselves aware of the Azure management portal. We learned to create a virtual machine from the portal and saw that this could be automated using PowerShell or other languages by using the SDK. We then managed a virtual machine using PowerShell and saw how to start and stop it. We also learned how to create a web app in Azure from Visual Studio 2017 itself and learned about publish profiles. We took an overview of App Services, and a quick look at Azure storage. Now that we have a grasp of the fundamentals, we will develop a movie booking application and deploy it in Azure in the next chapter.</p>
<p class="mce-root"></p>


            </article>

            
        </section>
    </div>
</body>
</html>