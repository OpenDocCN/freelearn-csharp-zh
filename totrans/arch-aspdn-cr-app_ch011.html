<html xml:lang="en-US" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
<meta charset="utf-8"/>
<meta content="packt" name="generator"/>
<title>10 Logging patterns</title>
<link href="../styles/stylesheet1.css" rel="stylesheet" type="text/css"/>
<link href="../styles/stylesheet2.css" rel="stylesheet" type="text/css"/>
<!-- kobo-style -->
<style id="koboSpanStyle" type="text/css" xmlns="http://www.w3.org/1999/xhtml">.koboSpan { -webkit-text-combine: inherit; }</style>
</head>
<body>
<section class="level1 pkt" data-number="11" id="logging-patterns">
<h1 data-number="11"><span class="koboSpan" id="kobo.1.1" xmlns="http://www.w3.org/1999/xhtml">10 Logging patterns</span></h1>
<section class="level2" data-number="11.1" id="before-you-begin-join-our-book-community-on-discord-9">
<h2 data-number="11.1"><span class="koboSpan" id="kobo.2.1" xmlns="http://www.w3.org/1999/xhtml">Before you begin: Join our book community on Discord</span></h2>
<p><span class="koboSpan" id="kobo.3.1" xmlns="http://www.w3.org/1999/xhtml">Give your feedback straight to the author himself and chat to other early readers on our Discord server (find the "architecting-aspnet-core-apps-3e" channel under EARLY ACCESS SUBSCRIPTION).</span></p>
<p><a href="https://packt.link/EarlyAccess"><span class="koboSpan" id="kobo.4.1" xmlns="http://www.w3.org/1999/xhtml">https://packt.link/EarlyAccess</span></a></p>
<p><span class="koboSpan" id="kobo.5.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Qr code Description automatically generated" src="../media/file46.png" style="width:10em"/></span></p>
<p><span class="koboSpan" id="kobo.6.1" xmlns="http://www.w3.org/1999/xhtml">This chapter covers a .NET-specific feature and closes the </span><em><span class="koboSpan" id="kobo.7.1" xmlns="http://www.w3.org/1999/xhtml">Designing for ASP.NET Core</span></em><span class="koboSpan" id="kobo.8.1" xmlns="http://www.w3.org/1999/xhtml"> section. </span><span class="koboSpan" id="kobo.8.2" xmlns="http://www.w3.org/1999/xhtml">The logging feature that comes with a few patterns is another building block that most applications need: built-in ASP.NET Core. </span><span class="koboSpan" id="kobo.8.3" xmlns="http://www.w3.org/1999/xhtml">We explore the system hands-on while not trying to master every aspect.Logging is a crucial aspect of application development and serves various purposes, such as debugging errors, tracing operations, analyzing usage, and more.The logging abstractions we explore here are another improvement of .NET Core over .NET Framework. </span><span class="koboSpan" id="kobo.8.4" xmlns="http://www.w3.org/1999/xhtml">Instead of relying on third-party libraries, the new, uniform system offers clean interfaces backed by a flexible and robust mechanism that helps implement logging into our applications.At the end of this chapter, you will understand what logging is and how to write application logs.In this chapter, we cover the following topics:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.9.1" xmlns="http://www.w3.org/1999/xhtml">About logging</span></li>
<li><span class="koboSpan" id="kobo.10.1" xmlns="http://www.w3.org/1999/xhtml">Writing logs</span></li>
<li><span class="koboSpan" id="kobo.11.1" xmlns="http://www.w3.org/1999/xhtml">Log levels</span></li>
<li><span class="koboSpan" id="kobo.12.1" xmlns="http://www.w3.org/1999/xhtml">Logging providers</span></li>
<li><span class="koboSpan" id="kobo.13.1" xmlns="http://www.w3.org/1999/xhtml">Configuring logging</span></li>
<li><span class="koboSpan" id="kobo.14.1" xmlns="http://www.w3.org/1999/xhtml">Structured logging</span></li>
</ul>
<p><span class="koboSpan" id="kobo.15.1" xmlns="http://www.w3.org/1999/xhtml">Let’s start by exploring what logging is.</span></p>
</section>
<section class="level2" data-number="11.2" id="about-logging">
<h2 data-number="11.2"><span class="koboSpan" id="kobo.16.1" xmlns="http://www.w3.org/1999/xhtml">About logging</span></h2>
<p><span class="koboSpan" id="kobo.17.1" xmlns="http://www.w3.org/1999/xhtml">Logging is the practice of writing messages into a log and cataloging information for later use. </span><span class="koboSpan" id="kobo.17.2" xmlns="http://www.w3.org/1999/xhtml">That information can be used to debug errors, trace operations, analyze usage, or any other reason we can come up with. </span><span class="koboSpan" id="kobo.17.3" xmlns="http://www.w3.org/1999/xhtml">Logging is a cross-cutting concern, meaning it applies to every piece of your application. </span><span class="koboSpan" id="kobo.17.4" xmlns="http://www.w3.org/1999/xhtml">We talk about layers in </span><em><span class="koboSpan" id="kobo.18.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 14</span></em><span class="koboSpan" id="kobo.19.1" xmlns="http://www.w3.org/1999/xhtml">, </span><em><span class="koboSpan" id="kobo.20.1" xmlns="http://www.w3.org/1999/xhtml">Layering and Clean Architecture</span></em><span class="koboSpan" id="kobo.21.1" xmlns="http://www.w3.org/1999/xhtml">, but until then, let’s just say that a cross-cutting concern affects all layers and cannot be centralized in just one; it affects a bit of everything.A log is made up of log entries. </span><span class="koboSpan" id="kobo.21.2" xmlns="http://www.w3.org/1999/xhtml">We can view each log entry as an event that happened during the program’s execution. </span><span class="koboSpan" id="kobo.21.3" xmlns="http://www.w3.org/1999/xhtml">Those events are then written to the log. </span><span class="koboSpan" id="kobo.21.4" xmlns="http://www.w3.org/1999/xhtml">This log can be a file, a remote system, </span><code><span class="koboSpan" id="kobo.22.1" xmlns="http://www.w3.org/1999/xhtml">stdout</span></code><span class="koboSpan" id="kobo.23.1" xmlns="http://www.w3.org/1999/xhtml">, or a combination of multiple destinations.When creating a log entry, we must also think about the severity of that log entry. </span><span class="koboSpan" id="kobo.23.2" xmlns="http://www.w3.org/1999/xhtml">In a way, this severity level represents the type of message or the level of importance that we want to log. </span><span class="koboSpan" id="kobo.23.3" xmlns="http://www.w3.org/1999/xhtml">We can also use it to filter those logs. </span><code><span class="koboSpan" id="kobo.24.1" xmlns="http://www.w3.org/1999/xhtml">Trace</span></code><span class="koboSpan" id="kobo.25.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.26.1" xmlns="http://www.w3.org/1999/xhtml">Error</span></code><span class="koboSpan" id="kobo.27.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code><span class="koboSpan" id="kobo.28.1" xmlns="http://www.w3.org/1999/xhtml">Debug</span></code><span class="koboSpan" id="kobo.29.1" xmlns="http://www.w3.org/1999/xhtml"> are examples of log entry levels. </span><span class="koboSpan" id="kobo.29.2" xmlns="http://www.w3.org/1999/xhtml">Those levels are defined in the </span><code><span class="koboSpan" id="kobo.30.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft.Extensions.Logging.LogLevel</span></code><span class="koboSpan" id="kobo.31.1" xmlns="http://www.w3.org/1999/xhtml"> enum.Another important aspect of a log entry is how it is structured. </span><span class="koboSpan" id="kobo.31.2" xmlns="http://www.w3.org/1999/xhtml">You can log a single string. </span><span class="koboSpan" id="kobo.31.3" xmlns="http://www.w3.org/1999/xhtml">Everyone on your team could log single strings in their own way. </span><span class="koboSpan" id="kobo.31.4" xmlns="http://www.w3.org/1999/xhtml">But what happens when someone searches for information? </span><span class="koboSpan" id="kobo.31.5" xmlns="http://www.w3.org/1999/xhtml">Chaos ensues! </span><span class="koboSpan" id="kobo.31.6" xmlns="http://www.w3.org/1999/xhtml">There’s the stress of not finding what that person is looking for and the displeasure of the log’s structure, as experienced by that same person. </span><span class="koboSpan" id="kobo.31.7" xmlns="http://www.w3.org/1999/xhtml">One way to fix this is by using structured logging. </span><span class="koboSpan" id="kobo.31.8" xmlns="http://www.w3.org/1999/xhtml">It is simple yet complex; you must create a structure the program follows for all log entries. </span><span class="koboSpan" id="kobo.31.9" xmlns="http://www.w3.org/1999/xhtml">That structure could be more or less complex or be serialized into JSON. </span><span class="koboSpan" id="kobo.31.10" xmlns="http://www.w3.org/1999/xhtml">The important part is that the log entries are structured. </span><span class="koboSpan" id="kobo.31.11" xmlns="http://www.w3.org/1999/xhtml">We won’t get into this subject here, but if you must decide on a logging strategy, I recommend digging into structured logging first. </span><span class="koboSpan" id="kobo.31.12" xmlns="http://www.w3.org/1999/xhtml">If you are part of a team, then chances are someone else already did. </span><span class="koboSpan" id="kobo.31.13" xmlns="http://www.w3.org/1999/xhtml">If that’s not the case, you can always bring it up. </span><span class="koboSpan" id="kobo.31.14" xmlns="http://www.w3.org/1999/xhtml">Continuous improvement is a key aspect of life.We could write a whole book on logging, best logging practices, structured logging, and distributed tracing, but this chapter aims to teach you how to use .NET logging abstractions.</span></p>
</section>
<section class="level2" data-number="11.3" id="writing-logs">
<h2 data-number="11.3"><span class="koboSpan" id="kobo.32.1" xmlns="http://www.w3.org/1999/xhtml">Writing logs</span></h2>
<p><span class="koboSpan" id="kobo.33.1" xmlns="http://www.w3.org/1999/xhtml">First, the logging system is provider-based, meaning we must register one or more </span><code><span class="koboSpan" id="kobo.34.1" xmlns="http://www.w3.org/1999/xhtml">ILoggerProvider</span></code><span class="koboSpan" id="kobo.35.1" xmlns="http://www.w3.org/1999/xhtml"> instances if we want our log entries to go somewhere. </span><span class="koboSpan" id="kobo.35.2" xmlns="http://www.w3.org/1999/xhtml">By default, when calling </span><code><span class="koboSpan" id="kobo.36.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication.CreateBuilder(args)</span></code><span class="koboSpan" id="kobo.37.1" xmlns="http://www.w3.org/1999/xhtml">, it registers the Console, Debug, EventSource, and EventLog (Windows only) providers, but we can modify this list. </span><span class="koboSpan" id="kobo.37.2" xmlns="http://www.w3.org/1999/xhtml">You can add and remove providers if you need to. </span><span class="koboSpan" id="kobo.37.3" xmlns="http://www.w3.org/1999/xhtml">The required dependencies for using the logging system are also registered as part of this process.Before we look at the code, let’s learn how to create log entries, which is the objective behind logging. </span><span class="koboSpan" id="kobo.37.4" xmlns="http://www.w3.org/1999/xhtml">To create an entry, we can use one of the following interfaces: </span><code><span class="koboSpan" id="kobo.38.1" xmlns="http://www.w3.org/1999/xhtml">ILogger</span></code><span class="koboSpan" id="kobo.39.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.40.1" xmlns="http://www.w3.org/1999/xhtml">ILogger&lt;T&gt;</span></code><span class="koboSpan" id="kobo.41.1" xmlns="http://www.w3.org/1999/xhtml">, or </span><code><span class="koboSpan" id="kobo.42.1" xmlns="http://www.w3.org/1999/xhtml">ILoggerFactory</span></code><span class="koboSpan" id="kobo.43.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.43.2" xmlns="http://www.w3.org/1999/xhtml">Let’s take a look at them in more detail:</span></p>
<table>
<tbody>
<tr class="odd">
<td><strong><span class="koboSpan" id="kobo.44.1" xmlns="http://www.w3.org/1999/xhtml">Interface</span></strong></td>
<td><strong><span class="koboSpan" id="kobo.45.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></strong></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.46.1" xmlns="http://www.w3.org/1999/xhtml">ILogger</span></code></td>
<td><span class="koboSpan" id="kobo.47.1" xmlns="http://www.w3.org/1999/xhtml">Base type that allows us to perform logging operations.</span></td>
</tr>
<tr class="odd">
<td><code><span class="koboSpan" id="kobo.48.1" xmlns="http://www.w3.org/1999/xhtml">ILogger&lt;T&gt;</span></code></td>
<td><span class="koboSpan" id="kobo.49.1" xmlns="http://www.w3.org/1999/xhtml">Base type that allows us to perform logging operations. </span><span class="koboSpan" id="kobo.49.2" xmlns="http://www.w3.org/1999/xhtml">Inherit from the ILogger interface. </span><span class="koboSpan" id="kobo.49.3" xmlns="http://www.w3.org/1999/xhtml">The system uses the generic parameter </span><code><span class="koboSpan" id="kobo.50.1" xmlns="http://www.w3.org/1999/xhtml">T</span></code><span class="koboSpan" id="kobo.51.1" xmlns="http://www.w3.org/1999/xhtml"> as the log entry’s </span><em><span class="koboSpan" id="kobo.52.1" xmlns="http://www.w3.org/1999/xhtml">category</span></em><span class="koboSpan" id="kobo.53.1" xmlns="http://www.w3.org/1999/xhtml"> .</span></td>
</tr>
<tr class="even">
<td><code><span class="koboSpan" id="kobo.54.1" xmlns="http://www.w3.org/1999/xhtml">ILoggerFactory</span></code></td>
<td><span class="koboSpan" id="kobo.55.1" xmlns="http://www.w3.org/1999/xhtml">A factory interface that allows creating </span><code><span class="koboSpan" id="kobo.56.1" xmlns="http://www.w3.org/1999/xhtml">ILogger</span></code><span class="koboSpan" id="kobo.57.1" xmlns="http://www.w3.org/1999/xhtml"> objects and specifying the category name manually as a string.</span></td>
</tr>
</tbody>
</table><span class="koboSpan" id="kobo.58.1" xmlns="http://www.w3.org/1999/xhtml">
Table 10.1: the logging interfaces.
</span><p><span class="koboSpan" id="kobo.59.1" xmlns="http://www.w3.org/1999/xhtml">The following code represents the most commonly used pattern, which consists of injecting an </span><code><span class="koboSpan" id="kobo.60.1" xmlns="http://www.w3.org/1999/xhtml">ILogger&lt;T&gt;</span></code><span class="koboSpan" id="kobo.61.1" xmlns="http://www.w3.org/1999/xhtml"> interface and storing it in an </span><code><span class="koboSpan" id="kobo.62.1" xmlns="http://www.w3.org/1999/xhtml">ILogger</span></code><span class="koboSpan" id="kobo.63.1" xmlns="http://www.w3.org/1999/xhtml"> field before using it, like this:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.64.1" xmlns="http://www.w3.org/1999/xhtml">public class Service : IService
{
    private readonly ILogger _logger;
    public Service(ILogger&lt;Service&gt; logger)
    {
        _logger = logger;
    }
    public void Execute()
    {
        _logger.LogInformation("Service.Execute()");
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.65.1" xmlns="http://www.w3.org/1999/xhtml">The preceding </span><code><span class="koboSpan" id="kobo.66.1" xmlns="http://www.w3.org/1999/xhtml">Service</span></code><span class="koboSpan" id="kobo.67.1" xmlns="http://www.w3.org/1999/xhtml"> class has a private </span><code><span class="koboSpan" id="kobo.68.1" xmlns="http://www.w3.org/1999/xhtml">_logger</span></code><span class="koboSpan" id="kobo.69.1" xmlns="http://www.w3.org/1999/xhtml"> field. </span><span class="koboSpan" id="kobo.69.2" xmlns="http://www.w3.org/1999/xhtml">It takes an </span><code><span class="koboSpan" id="kobo.70.1" xmlns="http://www.w3.org/1999/xhtml">ILogger&lt;Service&gt; </span></code><span class="koboSpan" id="kobo.71.1" xmlns="http://www.w3.org/1999/xhtml">logger as a parameter and stores it in that field. </span><span class="koboSpan" id="kobo.71.2" xmlns="http://www.w3.org/1999/xhtml">It uses that field in the </span><code><span class="koboSpan" id="kobo.72.1" xmlns="http://www.w3.org/1999/xhtml">Execute</span></code><span class="koboSpan" id="kobo.73.1" xmlns="http://www.w3.org/1999/xhtml"> method to write an information-level message to the log.The </span><code><span class="koboSpan" id="kobo.74.1" xmlns="http://www.w3.org/1999/xhtml">IService</span></code><span class="koboSpan" id="kobo.75.1" xmlns="http://www.w3.org/1999/xhtml"> interface is very simple and only exposes a single </span><code><span class="koboSpan" id="kobo.76.1" xmlns="http://www.w3.org/1999/xhtml">Execute</span></code><span class="koboSpan" id="kobo.77.1" xmlns="http://www.w3.org/1999/xhtml"> method for testing purposes:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.78.1" xmlns="http://www.w3.org/1999/xhtml">public interface IService
{
    void Execute();
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.79.1" xmlns="http://www.w3.org/1999/xhtml">I loaded a small library I created to test this out, providing additional logging providers for testing purposes. </span><span class="koboSpan" id="kobo.79.2" xmlns="http://www.w3.org/1999/xhtml">With that, we are creating a generic host (</span><code><span class="koboSpan" id="kobo.80.1" xmlns="http://www.w3.org/1999/xhtml">IHost</span></code><span class="koboSpan" id="kobo.81.1" xmlns="http://www.w3.org/1999/xhtml">) since we don’t need a </span><code><span class="koboSpan" id="kobo.82.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication</span></code><span class="koboSpan" id="kobo.83.1" xmlns="http://www.w3.org/1999/xhtml"> in our tests, then we configure it:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.84.1" xmlns="http://www.w3.org/1999/xhtml">namespace Logging;
public class BaseAbstractions
{
    [Fact]
    public void Should_log_the_Service_Execute_line()
    {
        // Arrange
        var lines = new List&lt;string&gt;();
        var host = Host.CreateDefaultBuilder()
            .ConfigureLogging(loggingBuilder =&gt;
            {
                loggingBuilder.ClearProviders();
                loggingBuilder.AddAssertableLogger(lines);
            })
            .ConfigureServices(services =&gt;
            {
                services.AddSingleton&lt;Service&gt;();
            })
            .Build();
        var service = host.Services.GetRequiredService&lt;Service&gt;(); 
        // Act
        service.Execute();
        // Assert
        Assert.Collection(lines,
            line =&gt; Assert.Equal("Service.Execute()", line)
        );
    }
    // Omitted other members
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.85.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code><span class="koboSpan" id="kobo.86.1" xmlns="http://www.w3.org/1999/xhtml">Arrange</span></code><span class="koboSpan" id="kobo.87.1" xmlns="http://www.w3.org/1999/xhtml"> phase of the test, we create some variables, configure </span><code><span class="koboSpan" id="kobo.88.1" xmlns="http://www.w3.org/1999/xhtml">IHost</span></code><span class="koboSpan" id="kobo.89.1" xmlns="http://www.w3.org/1999/xhtml">, and get an instance of the </span><code><span class="koboSpan" id="kobo.90.1" xmlns="http://www.w3.org/1999/xhtml">Service</span></code><span class="koboSpan" id="kobo.91.1" xmlns="http://www.w3.org/1999/xhtml"> class that we want to use to test the logging capabilities that we programmed.The highlighted code removes all providers using the </span><code><span class="koboSpan" id="kobo.92.1" xmlns="http://www.w3.org/1999/xhtml">ClearProviders</span></code><span class="koboSpan" id="kobo.93.1" xmlns="http://www.w3.org/1999/xhtml"> method. </span><span class="koboSpan" id="kobo.93.2" xmlns="http://www.w3.org/1999/xhtml">Then it uses the </span><code><span class="koboSpan" id="kobo.94.1" xmlns="http://www.w3.org/1999/xhtml">AddAssertableLogger</span></code><span class="koboSpan" id="kobo.95.1" xmlns="http://www.w3.org/1999/xhtml"> extension to add a new provider. </span><span class="koboSpan" id="kobo.95.2" xmlns="http://www.w3.org/1999/xhtml">The extension method comes from the library that we loaded. </span><span class="koboSpan" id="kobo.95.3" xmlns="http://www.w3.org/1999/xhtml">We could have added a new provider if we wanted, but I wanted to show you how to remove existing providers so we can start from a clean slate. </span><span class="koboSpan" id="kobo.95.4" xmlns="http://www.w3.org/1999/xhtml">That’s something you might need someday.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.96.1" xmlns="http://www.w3.org/1999/xhtml">The library that I loaded is available on NuGet and is named </span><code><span class="koboSpan" id="kobo.97.1" xmlns="http://www.w3.org/1999/xhtml">ForEvolve.Testing.Logging</span></code><span class="koboSpan" id="kobo.98.1" xmlns="http://www.w3.org/1999/xhtml">, but you do not need to understand any of this to understand logging abstractions and examples.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.99.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code><span class="koboSpan" id="kobo.100.1" xmlns="http://www.w3.org/1999/xhtml">Act</span></code><span class="koboSpan" id="kobo.101.1" xmlns="http://www.w3.org/1999/xhtml"> phase, we call the </span><code><span class="koboSpan" id="kobo.102.1" xmlns="http://www.w3.org/1999/xhtml">Execute</span></code><span class="koboSpan" id="kobo.103.1" xmlns="http://www.w3.org/1999/xhtml"> method of our service. </span><span class="koboSpan" id="kobo.103.2" xmlns="http://www.w3.org/1999/xhtml">This method logs a line to the </span><code><span class="koboSpan" id="kobo.104.1" xmlns="http://www.w3.org/1999/xhtml">ILogger</span></code><span class="koboSpan" id="kobo.105.1" xmlns="http://www.w3.org/1999/xhtml"> implementation that is injected upon instantiation. </span><span class="koboSpan" id="kobo.105.2" xmlns="http://www.w3.org/1999/xhtml">Then, we assert that the line was written in the </span><code><span class="koboSpan" id="kobo.106.1" xmlns="http://www.w3.org/1999/xhtml">lines</span></code><span class="koboSpan" id="kobo.107.1" xmlns="http://www.w3.org/1999/xhtml"> list (that’s what </span><code><span class="koboSpan" id="kobo.108.1" xmlns="http://www.w3.org/1999/xhtml">AssertableLogger</span></code><span class="koboSpan" id="kobo.109.1" xmlns="http://www.w3.org/1999/xhtml"> does; it writes to a </span><code><span class="koboSpan" id="kobo.110.1" xmlns="http://www.w3.org/1999/xhtml">List&lt;string&gt;</span></code><span class="koboSpan" id="kobo.111.1" xmlns="http://www.w3.org/1999/xhtml">). </span><span class="koboSpan" id="kobo.111.2" xmlns="http://www.w3.org/1999/xhtml">In an ASP.NET Core application, all that logging goes to the console by default. </span><span class="koboSpan" id="kobo.111.3" xmlns="http://www.w3.org/1999/xhtml">Logging is a great way to know what is happening in the background when running the application.The </span><code><span class="koboSpan" id="kobo.112.1" xmlns="http://www.w3.org/1999/xhtml">Service</span></code><span class="koboSpan" id="kobo.113.1" xmlns="http://www.w3.org/1999/xhtml"> class is a simple consumer of an </span><code><span class="koboSpan" id="kobo.114.1" xmlns="http://www.w3.org/1999/xhtml">ILogger&lt;Service&gt;</span></code><span class="koboSpan" id="kobo.115.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.115.2" xmlns="http://www.w3.org/1999/xhtml">You can do the same for any class you want to add logging support to. </span><span class="koboSpan" id="kobo.115.3" xmlns="http://www.w3.org/1999/xhtml">Change </span><code><span class="koboSpan" id="kobo.116.1" xmlns="http://www.w3.org/1999/xhtml">Service</span></code><span class="koboSpan" id="kobo.117.1" xmlns="http://www.w3.org/1999/xhtml"> by that class name to have a logger configured for your class. </span><span class="koboSpan" id="kobo.117.2" xmlns="http://www.w3.org/1999/xhtml">That generic argument becomes the logger's category name when writing log entries.Since ASP.NET Core uses a </span><code><span class="koboSpan" id="kobo.118.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication</span></code><span class="koboSpan" id="kobo.119.1" xmlns="http://www.w3.org/1999/xhtml"> instead of a generic </span><code><span class="koboSpan" id="kobo.120.1" xmlns="http://www.w3.org/1999/xhtml">IHost</span></code><span class="koboSpan" id="kobo.121.1" xmlns="http://www.w3.org/1999/xhtml">, here is the same test code using that construct:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.122.1" xmlns="http://www.w3.org/1999/xhtml">[Fact]
public void Should_log_the_Service_Execute_line_using_WebApplication()
{
    // Arrange
    var lines = new List&lt;string&gt;();
    var builder = WebApplication.CreateBuilder();
    builder.Logging.ClearProviders()
        .AddAssertableLogger(lines);
    builder.Services.AddSingleton&lt;IService, Service&gt;();
    var app = builder.Build();
    var service = app.Services.GetRequiredService&lt;IService&gt;();
    // Act
    service.Execute();
    // Assert
    Assert.Collection(lines,
        line =&gt; Assert.Equal("Service.Execute()", line)
    );
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.123.1" xmlns="http://www.w3.org/1999/xhtml">I highlighted the changes in the preceding code. </span><span class="koboSpan" id="kobo.123.2" xmlns="http://www.w3.org/1999/xhtml">In a nutshell, the extension methods used on the generic host have been replaced by </span><code><span class="koboSpan" id="kobo.124.1" xmlns="http://www.w3.org/1999/xhtml">WebApplicationBuilder</span></code><span class="koboSpan" id="kobo.125.1" xmlns="http://www.w3.org/1999/xhtml"> properties like </span><code><span class="koboSpan" id="kobo.126.1" xmlns="http://www.w3.org/1999/xhtml">Logging</span></code><span class="koboSpan" id="kobo.127.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.128.1" xmlns="http://www.w3.org/1999/xhtml">Services</span></code><span class="koboSpan" id="kobo.129.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.129.2" xmlns="http://www.w3.org/1999/xhtml">Finally, the </span><code><span class="koboSpan" id="kobo.130.1" xmlns="http://www.w3.org/1999/xhtml">Create</span></code><span class="koboSpan" id="kobo.131.1" xmlns="http://www.w3.org/1999/xhtml"> method creates a </span><code><span class="koboSpan" id="kobo.132.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication</span></code><span class="koboSpan" id="kobo.133.1" xmlns="http://www.w3.org/1999/xhtml"> instead of an </span><code><span class="koboSpan" id="kobo.134.1" xmlns="http://www.w3.org/1999/xhtml">IHost</span></code><span class="koboSpan" id="kobo.135.1" xmlns="http://www.w3.org/1999/xhtml">, exactly like in the </span><code><span class="koboSpan" id="kobo.136.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.137.1" xmlns="http://www.w3.org/1999/xhtml"> file.To wrap this up, these test cases allowed us to implement the most commonly used logging pattern in ASP.NET Core and add a custom provider to ensure we logged the correct information. </span><span class="koboSpan" id="kobo.137.2" xmlns="http://www.w3.org/1999/xhtml">Logging is essential and adds visibility to production systems. </span><span class="koboSpan" id="kobo.137.3" xmlns="http://www.w3.org/1999/xhtml">Without logs, you don’t know what is happening in your system unless you are the only one using it, which is very unlikely. </span><span class="koboSpan" id="kobo.137.4" xmlns="http://www.w3.org/1999/xhtml">You can also log what is happening in your infrastructure and run real-time security analysis on those log streams to quickly identify security breaches, intrusion attempts, or system failures. </span><span class="koboSpan" id="kobo.137.5" xmlns="http://www.w3.org/1999/xhtml">These subjects are out of the scope of this book, but having strong logging capabilities at the application level can only help your overall logging strategy.Before moving on to the next subject, let’s explore an example that leverages the </span><code><span class="koboSpan" id="kobo.138.1" xmlns="http://www.w3.org/1999/xhtml">ILoggerFactory</span></code><span class="koboSpan" id="kobo.139.1" xmlns="http://www.w3.org/1999/xhtml"> interface. </span><span class="koboSpan" id="kobo.139.2" xmlns="http://www.w3.org/1999/xhtml">The code sets a custom category name and uses the created </span><code><span class="koboSpan" id="kobo.140.1" xmlns="http://www.w3.org/1999/xhtml">ILogger</span></code><span class="koboSpan" id="kobo.141.1" xmlns="http://www.w3.org/1999/xhtml"> instance to log a message. </span><span class="koboSpan" id="kobo.141.2" xmlns="http://www.w3.org/1999/xhtml">This is very similar to the previous example. </span><span class="koboSpan" id="kobo.141.3" xmlns="http://www.w3.org/1999/xhtml">Here’s the whole code:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.142.1" xmlns="http://www.w3.org/1999/xhtml">namespace Logging;
public class LoggerFactoryExploration
{
    private readonly ITestOutputHelper _output;
    public LoggerFactoryExploration(ITestOutputHelper output)
    {
        _output = output ?? </span><span class="koboSpan" id="kobo.142.2" xmlns="http://www.w3.org/1999/xhtml">throw new ArgumentNullException(nameof(output));
    }
    [Fact]
    public void Create_a_ILoggerFactory()
    {
        // Arrange
        var lines = new List&lt;string&gt;();
        var host = Host.CreateDefaultBuilder()
            .ConfigureLogging(loggingBuilder =&gt; loggingBuilder
                .AddAssertableLogger(lines)
                .AddxUnitTestOutput(_output))
            .ConfigureServices(services =&gt; services.AddSingleton&lt;Service&gt;())
            .Build()
        ;
        var service = host.Services.GetRequiredService&lt;Service&gt;();
        // Act
        service.Execute();
        // Assert
        Assert.Collection(lines,
            line =&gt; Assert.Equal("LogInformation like any ILogger&lt;T&gt;.", line)
        );
    }
    public class Service
    {
        private readonly ILogger _logger;
        public Service(ILoggerFactory loggerFactory)
        {
            ArgumentNullException.ThrowIfNull(loggerFactory);
            _logger = loggerFactory.CreateLogger("My Service");
        }
        public void Execute()
        {
            _logger.LogInformation("LogInformation like any ILogger&lt;T&gt;.");
        }
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.143.1" xmlns="http://www.w3.org/1999/xhtml">The preceding code should look very familiar. </span><span class="koboSpan" id="kobo.143.2" xmlns="http://www.w3.org/1999/xhtml">Let’s focus on the highlighted lines, which relate to the current pattern:</span></p>
<ol>
<li><span class="koboSpan" id="kobo.144.1" xmlns="http://www.w3.org/1999/xhtml">We inject the </span><code><span class="koboSpan" id="kobo.145.1" xmlns="http://www.w3.org/1999/xhtml">ILoggerFactory</span></code><span class="koboSpan" id="kobo.146.1" xmlns="http://www.w3.org/1999/xhtml"> interface into the </span><code><span class="koboSpan" id="kobo.147.1" xmlns="http://www.w3.org/1999/xhtml">Service</span></code><span class="koboSpan" id="kobo.148.1" xmlns="http://www.w3.org/1999/xhtml"> class constructor (instead of an </span><code><span class="koboSpan" id="kobo.149.1" xmlns="http://www.w3.org/1999/xhtml">ILogger&lt;Service&gt;</span></code><span class="koboSpan" id="kobo.150.1" xmlns="http://www.w3.org/1999/xhtml">).</span></li>
<li><span class="koboSpan" id="kobo.151.1" xmlns="http://www.w3.org/1999/xhtml">We create an </span><code><span class="koboSpan" id="kobo.152.1" xmlns="http://www.w3.org/1999/xhtml">ILogger</span></code><span class="koboSpan" id="kobo.153.1" xmlns="http://www.w3.org/1999/xhtml"> instance with the </span><code><span class="koboSpan" id="kobo.154.1" xmlns="http://www.w3.org/1999/xhtml">"</span></code> <code><span class="koboSpan" id="kobo.155.1" xmlns="http://www.w3.org/1999/xhtml">My Service"</span></code><span class="koboSpan" id="kobo.156.1" xmlns="http://www.w3.org/1999/xhtml"> category name.</span></li>
<li><span class="koboSpan" id="kobo.157.1" xmlns="http://www.w3.org/1999/xhtml">We assign the logger to the </span><code><span class="koboSpan" id="kobo.158.1" xmlns="http://www.w3.org/1999/xhtml">_logger</span></code><span class="koboSpan" id="kobo.159.1" xmlns="http://www.w3.org/1999/xhtml"> field.</span></li>
<li><span class="koboSpan" id="kobo.160.1" xmlns="http://www.w3.org/1999/xhtml">We then use that </span><code><span class="koboSpan" id="kobo.161.1" xmlns="http://www.w3.org/1999/xhtml">ILogger</span></code><span class="koboSpan" id="kobo.162.1" xmlns="http://www.w3.org/1999/xhtml"> from the </span><code><span class="koboSpan" id="kobo.163.1" xmlns="http://www.w3.org/1999/xhtml">Execute</span></code><span class="koboSpan" id="kobo.164.1" xmlns="http://www.w3.org/1999/xhtml"> method.</span></li>
</ol>
<p><span class="koboSpan" id="kobo.165.1" xmlns="http://www.w3.org/1999/xhtml">As a rule of thumb, I recommend using the </span><code><span class="koboSpan" id="kobo.166.1" xmlns="http://www.w3.org/1999/xhtml">ILogger&lt;T&gt;</span></code><span class="koboSpan" id="kobo.167.1" xmlns="http://www.w3.org/1999/xhtml"> interface by default. </span><span class="koboSpan" id="kobo.167.2" xmlns="http://www.w3.org/1999/xhtml">If impossible, or if you need a more dynamic way of setting the category name for your log entries, leverage the </span><code><span class="koboSpan" id="kobo.168.1" xmlns="http://www.w3.org/1999/xhtml">ILoggerFactory</span></code><span class="koboSpan" id="kobo.169.1" xmlns="http://www.w3.org/1999/xhtml"> instead. </span><span class="koboSpan" id="kobo.169.2" xmlns="http://www.w3.org/1999/xhtml">By default, when using </span><code><span class="koboSpan" id="kobo.170.1" xmlns="http://www.w3.org/1999/xhtml">ILogger&lt;T&gt;</span></code><span class="koboSpan" id="kobo.171.1" xmlns="http://www.w3.org/1999/xhtml">, the category name is the T parameter, which should be the name of the class creating log entries. </span><span class="koboSpan" id="kobo.171.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.172.1" xmlns="http://www.w3.org/1999/xhtml">ILoggerFactory</span></code><span class="koboSpan" id="kobo.173.1" xmlns="http://www.w3.org/1999/xhtml"> interface is more of an internal piece than something made for us to consume; nonetheless, it exists and satisfies some use cases.</span></p>
<blockquote>
<p><strong><span class="koboSpan" id="kobo.174.1" xmlns="http://www.w3.org/1999/xhtml">Note</span></strong></p>
<blockquote>
<p><span class="koboSpan" id="kobo.175.1" xmlns="http://www.w3.org/1999/xhtml">In the preceding example, the </span><code><span class="koboSpan" id="kobo.176.1" xmlns="http://www.w3.org/1999/xhtml">ITestOutputHelper</span></code><span class="koboSpan" id="kobo.177.1" xmlns="http://www.w3.org/1999/xhtml"> interface is part of the </span><code><span class="koboSpan" id="kobo.178.1" xmlns="http://www.w3.org/1999/xhtml">Xunit.Abstractions</span></code><span class="koboSpan" id="kobo.179.1" xmlns="http://www.w3.org/1999/xhtml"> assembly. </span><span class="koboSpan" id="kobo.179.2" xmlns="http://www.w3.org/1999/xhtml">It allows us to write lines as </span><em><span class="koboSpan" id="kobo.180.1" xmlns="http://www.w3.org/1999/xhtml">standard output</span></em><span class="koboSpan" id="kobo.181.1" xmlns="http://www.w3.org/1999/xhtml"> to the test log. </span><span class="koboSpan" id="kobo.181.2" xmlns="http://www.w3.org/1999/xhtml">That output is available in the Visual Studio Test Explorer.</span></p>
</blockquote>
</blockquote>
<p><span class="koboSpan" id="kobo.182.1" xmlns="http://www.w3.org/1999/xhtml">Now that we have covered how to write log entries, it's time to learn how to manage their severity.</span></p>
</section>
<section class="level2" data-number="11.4" id="log-levels">
<h2 data-number="11.4"><span class="koboSpan" id="kobo.183.1" xmlns="http://www.w3.org/1999/xhtml">Log levels</span></h2>
<p><span class="koboSpan" id="kobo.184.1" xmlns="http://www.w3.org/1999/xhtml">In the previous examples, we used the </span><code><span class="koboSpan" id="kobo.185.1" xmlns="http://www.w3.org/1999/xhtml">LogInformation</span></code><span class="koboSpan" id="kobo.186.1" xmlns="http://www.w3.org/1999/xhtml"> method to log information messages, but there are other levels as well, shown in the following table:</span></p>
<table>
<tbody>
<tr class="odd">
<td><strong><span class="koboSpan" id="kobo.187.1" xmlns="http://www.w3.org/1999/xhtml">Level</span></strong></td>
<td><strong><span class="koboSpan" id="kobo.188.1" xmlns="http://www.w3.org/1999/xhtml">Method</span></strong></td>
<td><strong><span class="koboSpan" id="kobo.189.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></strong></td>
<td><strong><span class="koboSpan" id="kobo.190.1" xmlns="http://www.w3.org/1999/xhtml">Production</span></strong></td>
</tr>
<tr class="even">
<td><span class="koboSpan" id="kobo.191.1" xmlns="http://www.w3.org/1999/xhtml">Trace</span></td>
<td><code><span class="koboSpan" id="kobo.192.1" xmlns="http://www.w3.org/1999/xhtml">LogTrace</span></code></td>
<td><span class="koboSpan" id="kobo.193.1" xmlns="http://www.w3.org/1999/xhtml">This is used to capture detailed information about the program, instrument execution speed, and debugging. </span><span class="koboSpan" id="kobo.193.2" xmlns="http://www.w3.org/1999/xhtml">You can also log sensitive information when using traces.</span></td>
<td><span class="koboSpan" id="kobo.194.1" xmlns="http://www.w3.org/1999/xhtml">Disabled.</span></td>
</tr>
<tr class="odd">
<td><span class="koboSpan" id="kobo.195.1" xmlns="http://www.w3.org/1999/xhtml">Debug</span></td>
<td><code><span class="koboSpan" id="kobo.196.1" xmlns="http://www.w3.org/1999/xhtml">LogDebug</span></code></td>
<td><span class="koboSpan" id="kobo.197.1" xmlns="http://www.w3.org/1999/xhtml">This is used to log debugging and development information.</span></td>
<td><span class="koboSpan" id="kobo.198.1" xmlns="http://www.w3.org/1999/xhtml">Disabled unless troubleshooting.</span></td>
</tr>
<tr class="even">
<td><span class="koboSpan" id="kobo.199.1" xmlns="http://www.w3.org/1999/xhtml">Information</span></td>
<td><code><span class="koboSpan" id="kobo.200.1" xmlns="http://www.w3.org/1999/xhtml">LogInformation</span></code></td>
<td><span class="koboSpan" id="kobo.201.1" xmlns="http://www.w3.org/1999/xhtml">This is used to track the flow of the application. </span><span class="koboSpan" id="kobo.201.2" xmlns="http://www.w3.org/1999/xhtml">Normal events that occur in the system are often information-level events, such as the system started, the system stopped, and a user has signed in.</span></td>
<td><span class="koboSpan" id="kobo.202.1" xmlns="http://www.w3.org/1999/xhtml">Enabled.</span></td>
</tr>
<tr class="odd">
<td><span class="koboSpan" id="kobo.203.1" xmlns="http://www.w3.org/1999/xhtml">Warning</span></td>
<td><code><span class="koboSpan" id="kobo.204.1" xmlns="http://www.w3.org/1999/xhtml">LogWarning</span></code></td>
<td><span class="koboSpan" id="kobo.205.1" xmlns="http://www.w3.org/1999/xhtml">This is used to log abnormal behavior in the application flow that does not cause the program to stop, but that may need to be investigated; for example, handled exceptions, failed network calls, and accessing resources that do not exist.</span></td>
<td><span class="koboSpan" id="kobo.206.1" xmlns="http://www.w3.org/1999/xhtml">Enabled.</span></td>
</tr>
<tr class="even">
<td><span class="koboSpan" id="kobo.207.1" xmlns="http://www.w3.org/1999/xhtml">Error</span></td>
<td><code><span class="koboSpan" id="kobo.208.1" xmlns="http://www.w3.org/1999/xhtml">LogError</span></code></td>
<td><span class="koboSpan" id="kobo.209.1" xmlns="http://www.w3.org/1999/xhtml">This is used to log errors in the application flow that do not cause the application to stop. </span><span class="koboSpan" id="kobo.209.2" xmlns="http://www.w3.org/1999/xhtml">Errors must usually be investigated. </span><span class="koboSpan" id="kobo.209.3" xmlns="http://www.w3.org/1999/xhtml">Examples include the failure of the current operation and an exception that cannot be handled.</span></td>
<td><span class="koboSpan" id="kobo.210.1" xmlns="http://www.w3.org/1999/xhtml">Enabled.</span></td>
</tr>
<tr class="odd">
<td><span class="koboSpan" id="kobo.211.1" xmlns="http://www.w3.org/1999/xhtml">Critical</span></td>
<td><code><span class="koboSpan" id="kobo.212.1" xmlns="http://www.w3.org/1999/xhtml">LogCritical</span></code></td>
<td><span class="koboSpan" id="kobo.213.1" xmlns="http://www.w3.org/1999/xhtml">This is used to log errors that require immediate attention and represent a catastrophic state. </span><span class="koboSpan" id="kobo.213.2" xmlns="http://www.w3.org/1999/xhtml">The program is most likely about to stop, and the integrity of the application might be compromised; for example, a hard drive is full, the server is out of memory, or the database is in a deadlocked state.</span></td>
<td><span class="koboSpan" id="kobo.214.1" xmlns="http://www.w3.org/1999/xhtml">Enabled with some alerts that could be configured to trigger automatically.</span></td>
</tr>
</tbody>
</table><span class="koboSpan" id="kobo.215.1" xmlns="http://www.w3.org/1999/xhtml">
Table 10.2: log entry levels
</span><p><span class="koboSpan" id="kobo.216.1" xmlns="http://www.w3.org/1999/xhtml">As described in the preceding table, each log level serves one or more purposes. </span><span class="koboSpan" id="kobo.216.2" xmlns="http://www.w3.org/1999/xhtml">Those log levels tell the logger what severity a log entry is. </span><span class="koboSpan" id="kobo.216.3" xmlns="http://www.w3.org/1999/xhtml">Then, we can configure the system to log only entries of at least a certain level so we don’t fill out production logs with traces and debug entries, for example. </span><span class="koboSpan" id="kobo.216.4" xmlns="http://www.w3.org/1999/xhtml">In a project I led, we benchmarked multiple ways to log simple and complex messages using ASP.NET Core to build clear and optimized guidelines around that. </span><span class="koboSpan" id="kobo.216.5" xmlns="http://www.w3.org/1999/xhtml">We could not reach a fair conclusion when the messages were logged due to a large time variance between benchmark runs. </span><span class="koboSpan" id="kobo.216.6" xmlns="http://www.w3.org/1999/xhtml">However, we observed a constant trend when messages were not logged (</span><em><span class="koboSpan" id="kobo.217.1" xmlns="http://www.w3.org/1999/xhtml">trace</span></em><span class="koboSpan" id="kobo.218.1" xmlns="http://www.w3.org/1999/xhtml"> logs with the minimum logging level configured to </span><em><span class="koboSpan" id="kobo.219.1" xmlns="http://www.w3.org/1999/xhtml">debug</span></em><span class="koboSpan" id="kobo.220.1" xmlns="http://www.w3.org/1999/xhtml">, for example).Based on that conclusion, I recommend logging the </span><code><span class="koboSpan" id="kobo.221.1" xmlns="http://www.w3.org/1999/xhtml">Trace</span></code><span class="koboSpan" id="kobo.222.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.223.1" xmlns="http://www.w3.org/1999/xhtml">Debug</span></code><span class="koboSpan" id="kobo.224.1" xmlns="http://www.w3.org/1999/xhtml"> messages using the following construct instead of interpolation, </span><code><span class="koboSpan" id="kobo.225.1" xmlns="http://www.w3.org/1999/xhtml">string.Format</span></code><span class="koboSpan" id="kobo.226.1" xmlns="http://www.w3.org/1999/xhtml">, or other means. </span><span class="koboSpan" id="kobo.226.2" xmlns="http://www.w3.org/1999/xhtml">That may sound strange to optimize for </span><em><span class="koboSpan" id="kobo.227.1" xmlns="http://www.w3.org/1999/xhtml">not logging something</span></em><span class="koboSpan" id="kobo.228.1" xmlns="http://www.w3.org/1999/xhtml">, but if you think about it, those log entries will be skipped in production, so optimizing them will save your production app a few milliseconds of computing time here and there. </span><span class="koboSpan" id="kobo.228.2" xmlns="http://www.w3.org/1999/xhtml">Moreover, it's not harder or longer to do, so it's just a good habit.Let’s look at the fastest way to </span><em><span class="koboSpan" id="kobo.229.1" xmlns="http://www.w3.org/1999/xhtml">not write log entries</span></em><span class="koboSpan" id="kobo.230.1" xmlns="http://www.w3.org/1999/xhtml">:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.231.1" xmlns="http://www.w3.org/1999/xhtml">_logger.LogTrace("Some: {variable}", variable);
// Or
_logger.LogTrace("Some: {0}", variable);</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.232.1" xmlns="http://www.w3.org/1999/xhtml">When the log level is disabled, such as in production, you only pay the price of a method call because no processing is done on your log entries. </span><span class="koboSpan" id="kobo.232.2" xmlns="http://www.w3.org/1999/xhtml">On the other hand, if we use interpolation, the processing is done, so that one argument is passed to the </span><code><span class="koboSpan" id="kobo.233.1" xmlns="http://www.w3.org/1999/xhtml">Log[Level]</span></code><span class="koboSpan" id="kobo.234.1" xmlns="http://www.w3.org/1999/xhtml"> method, leading to a higher cost in processing power for each log entry.Here’s an example of interpolation (a.k.a. </span><span class="koboSpan" id="kobo.234.2" xmlns="http://www.w3.org/1999/xhtml">what not to do):</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.235.1" xmlns="http://www.w3.org/1999/xhtml">_logger.LogTrace($"Some: {variable}");</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.236.1" xmlns="http://www.w3.org/1999/xhtml">For warning and higher levels, you can keep the good habit and use the same technique or other methods because we know those lines will be logged anyway. </span><span class="koboSpan" id="kobo.236.2" xmlns="http://www.w3.org/1999/xhtml">Therefore, using interpolation in the code or letting the logger do it later should yield a similar result.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.237.1" xmlns="http://www.w3.org/1999/xhtml">One last note. </span><span class="koboSpan" id="kobo.237.2" xmlns="http://www.w3.org/1999/xhtml">I suggest you don’t try to over-optimize your code before there is a need for that. </span><span class="koboSpan" id="kobo.237.3" xmlns="http://www.w3.org/1999/xhtml">The action of investing a lot of effort in optimizing something that does not need optimizing is known as </span><strong><span class="koboSpan" id="kobo.238.1" xmlns="http://www.w3.org/1999/xhtml">premature optimization</span></strong><span class="koboSpan" id="kobo.239.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.239.2" xmlns="http://www.w3.org/1999/xhtml">The idea is to optimize just enough upfront and fix the performance when you find real issues.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.240.1" xmlns="http://www.w3.org/1999/xhtml">Now that we know the log levels that .NET offers us, let’s look at the logging providers.</span></p>
</section>
<section class="level2" data-number="11.5" id="logging-providers">
<h2 data-number="11.5"><span class="koboSpan" id="kobo.241.1" xmlns="http://www.w3.org/1999/xhtml">Logging providers</span></h2>
<p><span class="koboSpan" id="kobo.242.1" xmlns="http://www.w3.org/1999/xhtml">To give you an idea of the possible built-in logging providers, here is a list from the official documentation (see the </span><em><span class="koboSpan" id="kobo.243.1" xmlns="http://www.w3.org/1999/xhtml">Further reading</span></em><span class="koboSpan" id="kobo.244.1" xmlns="http://www.w3.org/1999/xhtml"> section at the end of this chapter):</span></p>
<ul>
<li><span class="koboSpan" id="kobo.245.1" xmlns="http://www.w3.org/1999/xhtml">Console</span></li>
<li><span class="koboSpan" id="kobo.246.1" xmlns="http://www.w3.org/1999/xhtml">Debug</span></li>
<li><span class="koboSpan" id="kobo.247.1" xmlns="http://www.w3.org/1999/xhtml">EventSource</span></li>
<li><span class="koboSpan" id="kobo.248.1" xmlns="http://www.w3.org/1999/xhtml">EventLog (Windows only)</span></li>
<li><span class="koboSpan" id="kobo.249.1" xmlns="http://www.w3.org/1999/xhtml">ApplicationInsights</span></li>
</ul>
<p><span class="koboSpan" id="kobo.250.1" xmlns="http://www.w3.org/1999/xhtml">The following is a list of third-party logging providers, also from the official documentation:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.251.1" xmlns="http://www.w3.org/1999/xhtml">elmah.io</span></li>
<li><span class="koboSpan" id="kobo.252.1" xmlns="http://www.w3.org/1999/xhtml">Gelf</span></li>
<li><span class="koboSpan" id="kobo.253.1" xmlns="http://www.w3.org/1999/xhtml">JSNLog</span></li>
<li><span class="koboSpan" id="kobo.254.1" xmlns="http://www.w3.org/1999/xhtml">KissLog.net</span></li>
<li><span class="koboSpan" id="kobo.255.1" xmlns="http://www.w3.org/1999/xhtml">Log4Net</span></li>
<li><span class="koboSpan" id="kobo.256.1" xmlns="http://www.w3.org/1999/xhtml">NLog</span></li>
<li><span class="koboSpan" id="kobo.257.1" xmlns="http://www.w3.org/1999/xhtml">PLogger</span></li>
<li><span class="koboSpan" id="kobo.258.1" xmlns="http://www.w3.org/1999/xhtml">Sentry</span></li>
<li><span class="koboSpan" id="kobo.259.1" xmlns="http://www.w3.org/1999/xhtml">Serilog</span></li>
<li><span class="koboSpan" id="kobo.260.1" xmlns="http://www.w3.org/1999/xhtml">Stackdriver</span></li>
</ul>
<p><span class="koboSpan" id="kobo.261.1" xmlns="http://www.w3.org/1999/xhtml">Now, if you need any of those or your favorite logging library is part of the preceding list, you know you can use it. </span><span class="koboSpan" id="kobo.261.2" xmlns="http://www.w3.org/1999/xhtml">If it is not, maybe it supports ASP.NET Core but was not part of the documentation when I consulted it.Next, let’s learn how to configure the logging system.</span></p>
</section>
<section class="level2" data-number="11.6" id="configuring-logging">
<h2 data-number="11.6"><span class="koboSpan" id="kobo.262.1" xmlns="http://www.w3.org/1999/xhtml">Configuring logging</span></h2>
<p><span class="koboSpan" id="kobo.263.1" xmlns="http://www.w3.org/1999/xhtml">As with most features of ASP.NET Core, we can configure logging. </span><span class="koboSpan" id="kobo.263.2" xmlns="http://www.w3.org/1999/xhtml">The default </span><code><span class="koboSpan" id="kobo.264.1" xmlns="http://www.w3.org/1999/xhtml">WebApplicationBuilder</span></code><span class="koboSpan" id="kobo.265.1" xmlns="http://www.w3.org/1999/xhtml"> that do a lot for us, but in case we want to tweak the defaults, we can. </span><span class="koboSpan" id="kobo.265.2" xmlns="http://www.w3.org/1999/xhtml">On top of that, the system loads the </span><code><span class="koboSpan" id="kobo.266.1" xmlns="http://www.w3.org/1999/xhtml">Logging</span></code><span class="koboSpan" id="kobo.267.1" xmlns="http://www.w3.org/1999/xhtml"> section of the configuration. </span><span class="koboSpan" id="kobo.267.2" xmlns="http://www.w3.org/1999/xhtml">That section is present, by default, in the </span><code><span class="koboSpan" id="kobo.268.1" xmlns="http://www.w3.org/1999/xhtml">appsettings.json</span></code><span class="koboSpan" id="kobo.269.1" xmlns="http://www.w3.org/1999/xhtml"> file. </span><span class="koboSpan" id="kobo.269.2" xmlns="http://www.w3.org/1999/xhtml">Like all configurations, it is cumulative, so we can redefine part of it in another file or configuration provider.We won’t dig too deep into customization, but it is good to know that we can customize the minimum level of what we are logging. </span><span class="koboSpan" id="kobo.269.3" xmlns="http://www.w3.org/1999/xhtml">We can also use transformation files (such as </span><code><span class="koboSpan" id="kobo.270.1" xmlns="http://www.w3.org/1999/xhtml">appsettings.Development.json</span></code><span class="koboSpan" id="kobo.271.1" xmlns="http://www.w3.org/1999/xhtml">) to customize those levels per environment.For example, we can define our defaults in </span><code><span class="koboSpan" id="kobo.272.1" xmlns="http://www.w3.org/1999/xhtml">appsettings.json</span></code><span class="koboSpan" id="kobo.273.1" xmlns="http://www.w3.org/1999/xhtml">, then update a few for development purposes in </span><code><span class="koboSpan" id="kobo.274.1" xmlns="http://www.w3.org/1999/xhtml">appsettings.Development.json</span></code><span class="koboSpan" id="kobo.275.1" xmlns="http://www.w3.org/1999/xhtml">, change production settings in </span><code><span class="koboSpan" id="kobo.276.1" xmlns="http://www.w3.org/1999/xhtml">appsettings.Production.json</span></code><span class="koboSpan" id="kobo.277.1" xmlns="http://www.w3.org/1999/xhtml">, then change the staging settings in </span><code><span class="koboSpan" id="kobo.278.1" xmlns="http://www.w3.org/1999/xhtml">appsettings.Staging.json</span></code><span class="koboSpan" id="kobo.279.1" xmlns="http://www.w3.org/1999/xhtml">, and add some testing settings in </span><code><span class="koboSpan" id="kobo.280.1" xmlns="http://www.w3.org/1999/xhtml">appsettings.Testing.json</span></code><span class="koboSpan" id="kobo.281.1" xmlns="http://www.w3.org/1999/xhtml">.Before we move on, let’s take a peek at the default settings:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.282.1" xmlns="http://www.w3.org/1999/xhtml">{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft": "Warning"
    }
  }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.283.1" xmlns="http://www.w3.org/1999/xhtml">We can define default levels (using </span><code><span class="koboSpan" id="kobo.284.1" xmlns="http://www.w3.org/1999/xhtml">Logging:LogLevel:Default</span></code><span class="koboSpan" id="kobo.285.1" xmlns="http://www.w3.org/1999/xhtml">) and a custom level for each category (such as </span><code><span class="koboSpan" id="kobo.286.1" xmlns="http://www.w3.org/1999/xhtml">Logging:LogLevel:Microsoft</span></code><span class="koboSpan" id="kobo.287.1" xmlns="http://www.w3.org/1999/xhtml">) representing base namespaces. </span><span class="koboSpan" id="kobo.287.2" xmlns="http://www.w3.org/1999/xhtml">For example, from that configuration file, the minimum level is </span><code><span class="koboSpan" id="kobo.288.1" xmlns="http://www.w3.org/1999/xhtml">Information</span></code><span class="koboSpan" id="kobo.289.1" xmlns="http://www.w3.org/1999/xhtml">, while every item part of the </span><code><span class="koboSpan" id="kobo.290.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft</span></code><span class="koboSpan" id="kobo.291.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code><span class="koboSpan" id="kobo.292.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft.*</span></code><span class="koboSpan" id="kobo.293.1" xmlns="http://www.w3.org/1999/xhtml"> namespaces have a minimum level of </span><code><span class="koboSpan" id="kobo.294.1" xmlns="http://www.w3.org/1999/xhtml">Warning</span></code><span class="koboSpan" id="kobo.295.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.295.2" xmlns="http://www.w3.org/1999/xhtml">That allows for removing noise when running the application. </span><span class="koboSpan" id="kobo.295.3" xmlns="http://www.w3.org/1999/xhtml">We can also leverage these configurations to debug certain parts of the application by lowering the log level to </span><code><span class="koboSpan" id="kobo.296.1" xmlns="http://www.w3.org/1999/xhtml">Debug</span></code><span class="koboSpan" id="kobo.297.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code><span class="koboSpan" id="kobo.298.1" xmlns="http://www.w3.org/1999/xhtml">Trace</span></code><span class="koboSpan" id="kobo.299.1" xmlns="http://www.w3.org/1999/xhtml"> for only a subset of items (items from one or more namespaces, for example).We can also filter what we want to log on a provider basis, using configuration or code. </span><span class="koboSpan" id="kobo.299.2" xmlns="http://www.w3.org/1999/xhtml">In the configuration file, we can change the default level of the console provider to </span><code><span class="koboSpan" id="kobo.300.1" xmlns="http://www.w3.org/1999/xhtml">Trace</span></code><span class="koboSpan" id="kobo.301.1" xmlns="http://www.w3.org/1999/xhtml">, like this:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.302.1" xmlns="http://www.w3.org/1999/xhtml">{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft": "Warning"
    },
    "Console": {
      "LogLevel": {
        "Default": "Trace"
      }
    }
  }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.303.1" xmlns="http://www.w3.org/1999/xhtml">We kept the same default values but added the </span><code><span class="koboSpan" id="kobo.304.1" xmlns="http://www.w3.org/1999/xhtml">Logging:Console</span></code><span class="koboSpan" id="kobo.305.1" xmlns="http://www.w3.org/1999/xhtml"> section (see highlighted code) with a default </span><code><span class="koboSpan" id="kobo.306.1" xmlns="http://www.w3.org/1999/xhtml">LogLevel</span></code><span class="koboSpan" id="kobo.307.1" xmlns="http://www.w3.org/1999/xhtml"> set to </span><code><span class="koboSpan" id="kobo.308.1" xmlns="http://www.w3.org/1999/xhtml">Trace</span></code><span class="koboSpan" id="kobo.309.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.309.2" xmlns="http://www.w3.org/1999/xhtml">We can define as many settings as we need.Instead of configurations, we can use the </span><code><span class="koboSpan" id="kobo.310.1" xmlns="http://www.w3.org/1999/xhtml">AddFilter</span></code><span class="koboSpan" id="kobo.311.1" xmlns="http://www.w3.org/1999/xhtml"> extension methods, as shown in the following experimental test code, or in conjunction with configurations.Here is the consumer class that logs data:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.312.1" xmlns="http://www.w3.org/1999/xhtml">public class Service
{
    private readonly ILogger _logger;
    public Service(ILogger&lt;Service&gt; logger)
    {
        _logger = logger;
    }
    public void Execute()
    {
        _logger.LogInformation("[info] Service.Execute()");
        _logger.LogWarning("[warning] Service.Execute()");
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.313.1" xmlns="http://www.w3.org/1999/xhtml">The preceding class is like other classes we used during the chapter but logs messages using two different levels: </span><code><span class="koboSpan" id="kobo.314.1" xmlns="http://www.w3.org/1999/xhtml">Information</span></code><span class="koboSpan" id="kobo.315.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.316.1" xmlns="http://www.w3.org/1999/xhtml">Warning</span></code><span class="koboSpan" id="kobo.317.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.317.2" xmlns="http://www.w3.org/1999/xhtml">Here is a test case in which we leverage the </span><code><span class="koboSpan" id="kobo.318.1" xmlns="http://www.w3.org/1999/xhtml">AddFilter</span></code><span class="koboSpan" id="kobo.319.1" xmlns="http://www.w3.org/1999/xhtml"> method:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.320.1" xmlns="http://www.w3.org/1999/xhtml">[Fact]
public void Should_filter_logs_by_provider()
{
    // Arrange
    var lines = new List&lt;string&gt;();
    var host = Host.CreateDefaultBuilder()
        .ConfigureLogging(loggingBuilder =&gt;
        {
            loggingBuilder.ClearProviders();
            loggingBuilder.AddConsole();
            loggingBuilder.AddAssertableLogger(lines);
            loggingBuilder.AddxUnitTestOutput(_output);
            loggingBuilder
                .AddFilter&lt;XunitTestOutputLoggerProvider&gt;(
                    level =&gt; level &gt;= LogLevel.Warning
                );
        })
        .ConfigureServices(services =&gt;
        {
            services.AddSingleton&lt;Service&gt;();
        })
        .Build();
    var service = host.Services.GetRequiredService&lt;Service&gt;();
    // Act
    service.Execute();
    // Assert
    Assert.Collection(lines,
        line =&gt; Assert.Equal("[info] Service.Execute()", line),
        line =&gt; Assert.Equal("[warning] Service.Execute()", line)
    );
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.321.1" xmlns="http://www.w3.org/1999/xhtml">We created a generic host in the preceding test code and added three providers: the console and two test providers—one that logs to a list and another to the xUnit output. </span><span class="koboSpan" id="kobo.321.2" xmlns="http://www.w3.org/1999/xhtml">Then, we told the system to filter out everything that is not at least a </span><code><span class="koboSpan" id="kobo.322.1" xmlns="http://www.w3.org/1999/xhtml">Warning</span></code><span class="koboSpan" id="kobo.323.1" xmlns="http://www.w3.org/1999/xhtml"> from </span><code><span class="koboSpan" id="kobo.324.1" xmlns="http://www.w3.org/1999/xhtml">XunitTestOutputLoggerProvider</span></code><span class="koboSpan" id="kobo.325.1" xmlns="http://www.w3.org/1999/xhtml"> (see highlighted code); other providers are unaffected by that code.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.326.1" xmlns="http://www.w3.org/1999/xhtml">In the code, the </span><code><span class="koboSpan" id="kobo.327.1" xmlns="http://www.w3.org/1999/xhtml">_output</span></code><span class="koboSpan" id="kobo.328.1" xmlns="http://www.w3.org/1999/xhtml"> member is a field of type </span><code><span class="koboSpan" id="kobo.329.1" xmlns="http://www.w3.org/1999/xhtml">ITestOutputHelper</span></code><span class="koboSpan" id="kobo.330.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.331.1" xmlns="http://www.w3.org/1999/xhtml">We now know of two options to set the minimum logging levels:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.332.1" xmlns="http://www.w3.org/1999/xhtml">Code</span></li>
<li><span class="koboSpan" id="kobo.333.1" xmlns="http://www.w3.org/1999/xhtml">Configuration</span></li>
</ul>
<p><span class="koboSpan" id="kobo.334.1" xmlns="http://www.w3.org/1999/xhtml">We can tweak the way we configure our logging policies as needed. </span><span class="koboSpan" id="kobo.334.2" xmlns="http://www.w3.org/1999/xhtml">Code can be more testable, while configurations can be updated at runtime without redeploying. </span><span class="koboSpan" id="kobo.334.3" xmlns="http://www.w3.org/1999/xhtml">Moreover, with the cascading model, which allows us to override configuration, we can cover most use cases using configurations. </span><span class="koboSpan" id="kobo.334.4" xmlns="http://www.w3.org/1999/xhtml">The biggest downside of configuration is that writing strings in a JSON file is more error-prone than writing code (assuming you are not reverting to using strings there either).I usually stick with configurations to set those values, as they do not change often. </span><span class="koboSpan" id="kobo.334.5" xmlns="http://www.w3.org/1999/xhtml">If you prefer code, I’m unaware of any drawbacks, and it’s just a matter of preference; the configuration becomes code at some point.Next, let’s look at a brief example of structured logging.</span></p>
</section>
<section class="level2" data-number="11.7" id="structured-logging">
<h2 data-number="11.7"><span class="koboSpan" id="kobo.335.1" xmlns="http://www.w3.org/1999/xhtml">Structured logging</span></h2>
<p><span class="koboSpan" id="kobo.336.1" xmlns="http://www.w3.org/1999/xhtml">As stated at the beginning, structured logging can become very important and open opportunities. </span><span class="koboSpan" id="kobo.336.2" xmlns="http://www.w3.org/1999/xhtml">Querying a data structure is always more versatile than querying a single line of text. </span><span class="koboSpan" id="kobo.336.3" xmlns="http://www.w3.org/1999/xhtml">That is even more true if there is no clear guideline around logging, whether a line of text or a JSON-formatted data structure.To keep it simple, we leverage a built-in formatter (highlighted line below) that serializes our log entries into JSON. </span><span class="koboSpan" id="kobo.336.4" xmlns="http://www.w3.org/1999/xhtml">Here is the </span><code><span class="koboSpan" id="kobo.337.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.338.1" xmlns="http://www.w3.org/1999/xhtml"> file:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.339.1" xmlns="http://www.w3.org/1999/xhtml">var builder = WebApplication.CreateBuilder(args);
builder.Logging.AddJsonConsole();
var app = builder.Build();
app.MapGet("/", (ILoggerFactory loggerFactory) =&gt;
{
    const string category = "root";
    var logger = loggerFactory.CreateLogger(category);
    logger.LogInformation("You hit the {category} URL!", category);
    return "Hello World!";
});
app.Run();</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.340.1" xmlns="http://www.w3.org/1999/xhtml">That transforms the console to logging JSON. </span><span class="koboSpan" id="kobo.340.2" xmlns="http://www.w3.org/1999/xhtml">For example, every time we hit the </span><code><span class="koboSpan" id="kobo.341.1" xmlns="http://www.w3.org/1999/xhtml">/</span></code><span class="koboSpan" id="kobo.342.1" xmlns="http://www.w3.org/1999/xhtml"> endpoint, the console displays the following JSON:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.343.1" xmlns="http://www.w3.org/1999/xhtml">{
  "EventId": 0,
  "LogLevel": "Information",
  "Category": "root",
  "Message": "You hit the root URL!",
  "State": {
    "Message": "You hit the root URL!",
    "category": "root",
    "{OriginalFormat}": "You hit the {category} URL!"
  </span><span class="koboSpan" id="kobo.343.2" xmlns="http://www.w3.org/1999/xhtml">}
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.344.1" xmlns="http://www.w3.org/1999/xhtml">Without that formatter, the usual output would have been:</span></p>
<div class="C0-SHConPACKT">
<pre><code><span class="koboSpan" id="kobo.345.1" xmlns="http://www.w3.org/1999/xhtml">info: root[0]
      You hit the root URL!</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.346.1" xmlns="http://www.w3.org/1999/xhtml">Based on that comparison, it is more versatile to query the JSON logs programmatically than the </span><code><span class="koboSpan" id="kobo.347.1" xmlns="http://www.w3.org/1999/xhtml">stdout</span></code><span class="koboSpan" id="kobo.348.1" xmlns="http://www.w3.org/1999/xhtml"> line.The biggest benefit of structured logging is improved searchability. </span><span class="koboSpan" id="kobo.348.2" xmlns="http://www.w3.org/1999/xhtml">You can run more precise queries at scale with a predefined data structure.Of course, if you are setting up a production system, you would probably want more information attached to such log items like the correlation ID of the request, optionally some information about the current user, the server’s name on which the code is running, and possibly more details depending on the application.You may need more than the out-of-the-box features to utilize structured logging fully. </span><span class="koboSpan" id="kobo.348.3" xmlns="http://www.w3.org/1999/xhtml">Some third-party libraries like Serilog offer those additional capabilities. </span><span class="koboSpan" id="kobo.348.4" xmlns="http://www.w3.org/1999/xhtml">However, defining the way to send plain text to the logger could be a start.Each project should dictate the needs and depth of each feature, including logging. </span><span class="koboSpan" id="kobo.348.5" xmlns="http://www.w3.org/1999/xhtml">Moreover, structured logging is a broader subject that merits studying independently. </span><span class="koboSpan" id="kobo.348.6" xmlns="http://www.w3.org/1999/xhtml">Nonetheless, I wanted to touch on this subject a bit, and hopefully, you learned enough about logging to get started.</span></p>
</section>
<section class="level2" data-number="11.8" id="summary-9">
<h2 data-number="11.8"><span class="koboSpan" id="kobo.349.1" xmlns="http://www.w3.org/1999/xhtml">Summary</span></h2>
<p><span class="koboSpan" id="kobo.350.1" xmlns="http://www.w3.org/1999/xhtml">In this chapter, we delved into the concept of logging. </span><span class="koboSpan" id="kobo.350.2" xmlns="http://www.w3.org/1999/xhtml">We learned that logging is the practice of recording messages into a log for later use, such as debugging errors, tracing operations, and analyzing usage. </span><span class="koboSpan" id="kobo.350.3" xmlns="http://www.w3.org/1999/xhtml">Logging is essential, and ASP.NET Core offers us various ways to log information independently of third-party libraries while allowing us to use our favorite logging framework. </span><span class="koboSpan" id="kobo.350.4" xmlns="http://www.w3.org/1999/xhtml">We can customize the way the logs are written and categorized. </span><span class="koboSpan" id="kobo.350.5" xmlns="http://www.w3.org/1999/xhtml">We can use zero or more logging providers. </span><span class="koboSpan" id="kobo.350.6" xmlns="http://www.w3.org/1999/xhtml">We can also create custom logging providers. </span><span class="koboSpan" id="kobo.350.7" xmlns="http://www.w3.org/1999/xhtml">Finally, we can use configurations or code to filter logs and much more.Here is the default logging pattern to remember:</span></p>
<ol>
<li><span class="koboSpan" id="kobo.351.1" xmlns="http://www.w3.org/1999/xhtml">Inject an </span><code><span class="koboSpan" id="kobo.352.1" xmlns="http://www.w3.org/1999/xhtml">ILogger&lt;T&gt;</span></code><span class="koboSpan" id="kobo.353.1" xmlns="http://www.w3.org/1999/xhtml">, where </span><code><span class="koboSpan" id="kobo.354.1" xmlns="http://www.w3.org/1999/xhtml">T</span></code><span class="koboSpan" id="kobo.355.1" xmlns="http://www.w3.org/1999/xhtml"> is the type of the class into which the logger is injected. </span><code><span class="koboSpan" id="kobo.356.1" xmlns="http://www.w3.org/1999/xhtml">T</span></code><span class="koboSpan" id="kobo.357.1" xmlns="http://www.w3.org/1999/xhtml"> becomes the category.</span></li>
<li><span class="koboSpan" id="kobo.358.1" xmlns="http://www.w3.org/1999/xhtml">Save a reference of that logger into a </span><code><span class="koboSpan" id="kobo.359.1" xmlns="http://www.w3.org/1999/xhtml">private readonly ILogger</span></code><span class="koboSpan" id="kobo.360.1" xmlns="http://www.w3.org/1999/xhtml"> field.</span></li>
<li><span class="koboSpan" id="kobo.361.1" xmlns="http://www.w3.org/1999/xhtml">Use that logger in your methods to log messages using the appropriate log level.</span></li>
</ol>
<p><span class="koboSpan" id="kobo.362.1" xmlns="http://www.w3.org/1999/xhtml">The logging system is a great addition to .NET Core compared to .NET Framework. </span><span class="koboSpan" id="kobo.362.2" xmlns="http://www.w3.org/1999/xhtml">It allows us to standardize the logging mechanism, making our systems easier to maintain in the long run. </span><span class="koboSpan" id="kobo.362.3" xmlns="http://www.w3.org/1999/xhtml">For example, suppose you want to use a new third-party library or even a custom-made one. </span><span class="koboSpan" id="kobo.362.4" xmlns="http://www.w3.org/1999/xhtml">In that case, you can load the provider into your </span><code><span class="koboSpan" id="kobo.363.1" xmlns="http://www.w3.org/1999/xhtml">Program</span></code><span class="koboSpan" id="kobo.364.1" xmlns="http://www.w3.org/1999/xhtml">, and the entire system will adapt and start using it without any further changes as long as you depend only on the logging abstractions. </span><span class="koboSpan" id="kobo.364.2" xmlns="http://www.w3.org/1999/xhtml">This is a good example of what well-designed abstractions can bring to a system.</span><strong><span class="koboSpan" id="kobo.365.1" xmlns="http://www.w3.org/1999/xhtml">Here are a few key takeaways</span></strong><span class="koboSpan" id="kobo.366.1" xmlns="http://www.w3.org/1999/xhtml">:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.367.1" xmlns="http://www.w3.org/1999/xhtml">Logging is a cross-cutting concern, affecting all layers of an application.</span></li>
<li><span class="koboSpan" id="kobo.368.1" xmlns="http://www.w3.org/1999/xhtml">A log comprises many log entries representing an event that occurred at runtime during the program's execution.</span></li>
<li><span class="koboSpan" id="kobo.369.1" xmlns="http://www.w3.org/1999/xhtml">The severity of a log entry is important for filtering and prioritization.</span></li>
<li><span class="koboSpan" id="kobo.370.1" xmlns="http://www.w3.org/1999/xhtml">The severity levels are Trace, Debug, Information, Warning, Error, and Critical.</span></li>
<li><span class="koboSpan" id="kobo.371.1" xmlns="http://www.w3.org/1999/xhtml">We can configure the logging system to log only certain messages based on the severity level of each entry.</span></li>
<li><span class="koboSpan" id="kobo.372.1" xmlns="http://www.w3.org/1999/xhtml">Structured logging can help maintain consistency and ease of searching within logs.</span></li>
<li><span class="koboSpan" id="kobo.373.1" xmlns="http://www.w3.org/1999/xhtml">The logging system in .NET is provider-based, allowing us to customize the default providers.</span></li>
<li><span class="koboSpan" id="kobo.374.1" xmlns="http://www.w3.org/1999/xhtml">We can use interfaces like ILogger, ILogger&lt;T&gt;, or ILoggerFactory to create log entries.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.375.1" xmlns="http://www.w3.org/1999/xhtml">This chapter closes the second section of this book with ASP.NET Core at its center. </span><span class="koboSpan" id="kobo.375.2" xmlns="http://www.w3.org/1999/xhtml">We explore design patterns to create flexible and robust components in the next few chapters.</span></p>
</section>
<section class="level2" data-number="11.9" id="questions-9">
<h2 data-number="11.9"><span class="koboSpan" id="kobo.376.1" xmlns="http://www.w3.org/1999/xhtml">Questions</span></h2>
<p><span class="koboSpan" id="kobo.377.1" xmlns="http://www.w3.org/1999/xhtml">Let’s take a look at a few practice questions:</span></p>
<ol>
<li><span class="koboSpan" id="kobo.378.1" xmlns="http://www.w3.org/1999/xhtml">Can we write log entries to the console and a file at the same time?</span></li>
<li><span class="koboSpan" id="kobo.379.1" xmlns="http://www.w3.org/1999/xhtml">Is it true that we should log the trace- and debug-level log entries in a production environment?</span></li>
<li><span class="koboSpan" id="kobo.380.1" xmlns="http://www.w3.org/1999/xhtml">What is the purpose of structured logging?</span></li>
<li><span class="koboSpan" id="kobo.381.1" xmlns="http://www.w3.org/1999/xhtml">How can we create a log entry in .NET?</span></li>
</ol>
</section>
<section class="level2" data-number="11.10" id="further-reading-8">
<h2 data-number="11.10"><span class="koboSpan" id="kobo.382.1" xmlns="http://www.w3.org/1999/xhtml">Further reading</span></h2>
<p><span class="koboSpan" id="kobo.383.1" xmlns="http://www.w3.org/1999/xhtml">Here is a link to build upon what we learned in the chapter:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.384.1" xmlns="http://www.w3.org/1999/xhtml">[Official docs] </span><em><span class="koboSpan" id="kobo.385.1" xmlns="http://www.w3.org/1999/xhtml">Logging in .NET Core and ASP.NET Core</span></em><span class="koboSpan" id="kobo.386.1" xmlns="http://www.w3.org/1999/xhtml">: </span><a href="https://adpg.link/MUVG"><span class="koboSpan" id="kobo.387.1" xmlns="http://www.w3.org/1999/xhtml">https://adpg.link/MUVG</span></a></li>
</ul>
</section>
<section class="level2" data-number="11.11" id="answers-6">
<h2 data-number="11.11"><span class="koboSpan" id="kobo.388.1" xmlns="http://www.w3.org/1999/xhtml">Answers</span></h2>
<ol>
<li><span class="koboSpan" id="kobo.389.1" xmlns="http://www.w3.org/1999/xhtml">Yes, you can configure as many providers as you want. </span><span class="koboSpan" id="kobo.389.2" xmlns="http://www.w3.org/1999/xhtml">One could be for the console, and another could append entries to a file.</span></li>
<li><span class="koboSpan" id="kobo.390.1" xmlns="http://www.w3.org/1999/xhtml">No, you should not log trace-level entries in production. </span><span class="koboSpan" id="kobo.390.2" xmlns="http://www.w3.org/1999/xhtml">You should only log debug-level entries when debugging an issue.</span></li>
<li><span class="koboSpan" id="kobo.391.1" xmlns="http://www.w3.org/1999/xhtml">Structured logging maintains a consistent structure across all log entries, making searching and analyzing logs easier.</span></li>
<li><span class="koboSpan" id="kobo.392.1" xmlns="http://www.w3.org/1999/xhtml">We can create a log entry using interfaces like </span><code><span class="koboSpan" id="kobo.393.1" xmlns="http://www.w3.org/1999/xhtml">ILogger</span></code><span class="koboSpan" id="kobo.394.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.395.1" xmlns="http://www.w3.org/1999/xhtml">ILogger&lt;T&gt;</span></code><span class="koboSpan" id="kobo.396.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code><span class="koboSpan" id="kobo.397.1" xmlns="http://www.w3.org/1999/xhtml">ILoggerFactory</span></code><span class="koboSpan" id="kobo.398.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
</ol>
</section>
</section>
</body>
</html>
