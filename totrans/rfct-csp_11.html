<html><head></head><body>
<div><h1 class="chapter-number" id="_idParaDest-237"><a id="_idTextAnchor236"/>11</h1>
<h1 id="_idParaDest-238"><a id="_idTextAnchor237"/>AI-Assisted Refactoring with GitHub Copilot</h1>
<p>Change is a constant in technology, and that’s certainly true in the .NET ecosystem. Every year, Microsoft releases a new version of .NET and C# packed with new features to keep the language exciting, useful, and relevant as technology changes. But perhaps the most significant changes to .NET development in the last two years have come not from the major language releases, but in the field of artificial intelligence through AI agents such as GitHub Copilot and ChatGPT.</p>
<p>In this chapter, we’ll explore how GitHub Copilot integrates into Visual Studio and brings ChatGPT-like conversational AI into your editor. We’ll also explore some of the interesting possibilities this opens and some of the things we must keep in mind when considering whether this new technology has a place in our toolset.</p>
<p>We’ll cover the following topics in this chapter:</p>
<ul>
<li>Introducing GitHub Copilot</li>
<li>Getting started with GitHub Copilot in Visual Studio</li>
<li>Refactoring with GitHub Copilot Chat</li>
<li>Drafting documentation with GitHub Copilot Chat</li>
<li>Generating test ideas with GitHub Copilot Chat</li>
<li>Understanding the limits of GitHub Copilot</li>
</ul>
<h1 id="_idParaDest-239"><a id="_idTextAnchor238"/>Technical requirements</h1>
<p>The starting code for this chapter is available from GitHub at <a href="https://github.com/PacktPublishing/Refactoring-with-CSharp">https://github.com/PacktPublishing/Refactoring-with-CSharp</a> in the <code>Chapter11/Ch11BeginningCode</code> folder.</p>
<h1 id="_idParaDest-240"><a id="_idTextAnchor239"/>Introducing GitHub Copilot</h1>
<p>In 2021, GitHub announced a new artificial intelligence tool called <strong class="bold">GitHub Copilot</strong>. GitHub Copilot is an editor <a id="_idIndexMarker659"/>extension that integrates into different editors including JetBrains Rider, VS Code, and all editions of Visual Studio 2022.</p>
<p>What GitHub Copilot does is it looks at the code you just typed and generates predictions for the code it thinks you’re about to type. If it has a prediction and you are not currently typing, GitHub Copilot displays the prediction in grey text in front of your cursor for you to evaluate and possibly add to your code, as shown in <em class="italic">Figure 11</em><em class="italic">.1</em>:</p>
<div><div><img alt="Figure 11.1 – GitHub Copilot suggesting code to add as the developer types" src="img/B21324_11_1.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.1 – GitHub Copilot suggesting code to add as the developer types</p>
<p>Copilot does this by using a predictive machine learning model that has been trained on various pieces of code in many different programming languages, including C#, F#, JavaScript, and SQL.</p>
<h2 id="_idParaDest-241"><a id="_idTextAnchor240"/>Understanding GitHub’s predictive model</h2>
<p>If this sounds familiar, it’s because <a id="_idIndexMarker660"/>GitHub Copilot’s model is a specialized machine learning model built around a promising new model training<a id="_idIndexMarker661"/> technique called <strong class="bold">transformers</strong>.</p>
<p>Transformers, introduced in 2017 in a paper called <em class="italic">Attention is All You Need </em>(<a href="https://research.google/pubs/pub46201/">https://research.google/pubs/pub46201/</a>), allow machine learning models to be trained on larger bodies of text while still retaining the context of how different pieces of text related to each other.</p>
<p>This innovation has led to technologies such as Google BERT (which powered Google search predictions), MidJourney, and DALL-E (which can generate art from textual prompts), and the extremely popular ChatGPT by OpenAI that can mimic conversations with humans.</p>
<p>Transformer-based models <a id="_idIndexMarker662"/>are now commonly referred to as <strong class="bold">large language models </strong>(<strong class="bold">LLMs</strong>). Their superpower is their ability to memorize patterns in text and generate new text that mimics patterns<a id="_idIndexMarker663"/> it has internalized in its model.</p>
<p class="callout-heading">Ever wondered what GPT stood for?</p>
<p class="callout">The GPT acronym (found in ChatGPT, GPT-4, and similar) stands for <strong class="bold">generative pre-trained transformer</strong>. In other words, this is a<a id="_idIndexMarker664"/> transformer-based model used to generate new content, and the model has been trained on a large volume of data.</p>
<p>These LLMs take in a textual prompt and generate some form of output. With chat LLMs, the prompt might be a question such as “What is .NET?” and the output might be a short description of .NET, as pictured in this interaction with Bing Chat (<a href="https://www.bing.com/">https://www.bing.com/</a>) in <em class="italic">Figure 11</em><em class="italic">.2</em>:</p>
<div><div><img alt="Figure 11.2 – Bing Chat describing .NET in response to a short prompt" src="img/B21324_11_2.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.2 – Bing Chat describing .NET in response to a short prompt</p>
<p>There is no intelligent understanding built into an LLM. These models do not think or have thoughts of their own, but rather use mathematics to identify similarities between the text they receive and the large volumes of text the model was trained on.</p>
<p>While LLM systems may seem eerily intelligent at times, this is because they are emulating the intelligence of the authors of the various books, blog posts, tweets, and other materials they’ve been trained on.</p>
<p>GitHub Copilot uses an LLM called <strong class="bold">Codex</strong>. The Codex <a id="_idIndexMarker665"/>model is produced by OpenAI and was trained not on blog posts or tweets but on open-source software repositories.</p>
<p>This means that when <a id="_idIndexMarker666"/>you type something into your editor, the text you type can be used as a prompt to predict the next line of code you might type. This is very similar to how Google search predicts the next few words in a search term or how ChatGPT generates textual replies.</p>
<p>We’ll talk more about the use of open-source code in GitHub Copilot and whether it is appropriate to use GitHub Copilot in a workplace project near the end of this chapter. For now, let’s move on to some of the newer aspects of GitHub Copilot.</p>
<h2 id="_idParaDest-242"><a id="_idTextAnchor241"/>Starting the conversation with GitHub Copilot Chat</h2>
<p>GitHub extended Copilot’s code generation capabilities by introducing <strong class="bold">GitHub Copilot Chat</strong>. GitHub Copilot Chat gives you<a id="_idIndexMarker667"/> the ability to interact with a conversational AI agent like ChatGPT directly in your editor.</p>
<p>This means that you can chat with an LLM in Visual Studio and do things such as the following:</p>
<ul>
<li>Ask it to explain a block of code</li>
<li>Generate new code using textual prompts</li>
<li>Ask Copilot for ways to improve the quality of your code</li>
<li>Have Copilot draft unit tests or documentation for methods</li>
</ul>
<p>I’ve even used Copilot to generate intentionally messy code just to practice refactoring.</p>
<p>A typical interaction with GitHub Copilot Chat involves the user selecting some code and then pressing <em class="italic">Alt</em> + <em class="italic">/</em> to start a conversation. For example, <em class="italic">Figure 11</em><em class="italic">.3</em> shows the user typing a text prompt to GitHub Copilot Chat with a small block of code selected:</p>
<div><div><img alt="Figure 11.3 – Asking GitHub Copilot Chat a question" src="img/B21324_11_3.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.3 – Asking GitHub Copilot Chat a question</p>
<p>From there, GitHub Copilot<a id="_idIndexMarker668"/> Chat generates a textual response that is shown to the user, as seen in <em class="italic">Figure 11</em><em class="italic">.4</em>:</p>
<div><div><img alt="Figure 11.4 – GitHub Copilot generating an explanation of the block of code" src="img/B21324_11_4.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.4 – GitHub Copilot generating an explanation of the block of code</p>
<p>If you feel you’re too experienced with C# to fully benefit from this feature, I want to assure you that it has value beyond basic programming. Sometimes when maintaining code, you’ll encounter strange method calls that don’t make sense and you don’t have any documentation to tell you what the developer was trying to do. When this happens, having Chat’s opinion can be very valuable in understanding the intent of the developer who wrote the code.</p>
<p>Of course, Chat can be used to generate code, as we’ll see in the next section.</p>
<p>The bottom line for me is that programming with GitHub Copilot Chat is something that not only amplifies my capabilities as a developer but also helps keep me focused since I have fewer reasons to go check the documentation or leave my editor. Between the automation capabilities<a id="_idIndexMarker669"/> built into the Chat LLM and this added extra focus, GitHub Copilot Chat is a significant boost to my productivity and capabilities.</p>
<p>I suspect you’ll like GitHub Copilot Chat too, so let’s see how to get started.</p>
<h1 id="_idParaDest-243"><a id="_idTextAnchor242"/>Getting started with GitHub Copilot in Visual Studio</h1>
<p>In order to work with GitHub <a id="_idIndexMarker670"/>Copilot, you’ll need to have a GitHub account. If you don’t <a id="_idIndexMarker671"/>have one, you can sign up for a free GitHub account at <a href="https://github.com/signup">https://github.com/signup</a>.</p>
<p>GitHub Copilot also requires that you work with Visual Studio 2022 version 17.4.4 or later. If you haven’t installed Visual Studio, you can download a copy at <a href="https://visualstudio.microsoft.com/downloads/">https://visualstudio.microsoft.com/downloads/</a>.</p>
<p>If you need to update or check your Visual Studio version, a quick way of doing either task is to launch the <strong class="bold">Visual Studio Installer</strong> from the Windows menu. This will let you see your current version and optionally update your edition of Visual Studio, as shown in <em class="italic">Figure 11</em><em class="italic">.5</em>:</p>
<div><div><img alt="Figure 11.5 – Updating Visual Studio from the Visual Studio Installer" src="img/B21324_11_5.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.5 – Updating Visual Studio from the Visual Studio Installer</p>
<p>Once you have a <a id="_idIndexMarker672"/>GitHub account and an up-to-date edition of Visual<a id="_idIndexMarker673"/> Studio, you can install the GitHub Copilot extension.</p>
<h2 id="_idParaDest-244"><a id="_idTextAnchor243"/>Installing and activating GitHub Copilot</h2>
<p>To install GitHub Copilot, launch <a id="_idIndexMarker674"/>Visual Studio, choose the <strong class="bold">Extensions</strong> menu, and<a id="_idIndexMarker675"/> then select <strong class="bold">Manage Extensions</strong>. Next, search for <strong class="bold">GitHub Copilot</strong> and download and install the extension, as shown in <em class="italic">Figure 11</em><em class="italic">.6</em>:</p>
<div><div><img alt="Figure 11.6 – Installing GitHub Copilot in Visual Studio" src="img/B21324_11_6.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.6 – Installing GitHub Copilot in Visual Studio</p>
<p>Next, you will need to log in to<a id="_idIndexMarker676"/> GitHub within Visual Studio to link the extension to <a id="_idIndexMarker677"/>your GitHub account. Follow the instructions at <a href="https://docs.github.com/en/copilot/getting-started-with-github-copilot?tool=visualstudio">https://docs.github.com/en/copilot/getting-started-with-github-copilot?tool=visualstudio</a> for the most up-to-date instructions on how to do this.</p>
<p>GitHub Copilot Chat is currently a separate extension from GitHub Copilot. If you want to try Chat, I recommend you install Copilot on its own and ensure it works first. Once you’ve done this, repeat the installation process for the Chat extension.</p>
<p>Some GitHub Copilot features, such as Chat, may need to be enabled or require additional configuration. You can do so by going to the <strong class="bold">Tools</strong> menu and then selecting <strong class="bold">Options…</strong> and finding the <strong class="bold">GitHub</strong> node in the list.</p>
<h2 id="_idParaDest-245"><a id="_idTextAnchor244"/>Getting access to GitHub Copilot</h2>
<p>While GitHub itself is free, GitHub Copilot is a <a id="_idIndexMarker678"/>premium feature that requires you to have a GitHub Premium license or be part of GitHub Copilot for Business account. We’ll talk more about the benefits of Copilot for Business near the end of this chapter.</p>
<p>At the time of this writing, GitHub charges $10 USD/month for individuals or $19/month per user for a Copilot for Business account. As with any emerging technology, pricing and availability may change over time.</p>
<p>Now that we’ve covered <a id="_idIndexMarker679"/>how to install and get access to Copilot, let’s see it in action.</p>
<h2 id="_idParaDest-246"><a id="_idTextAnchor245"/>Generating suggestions with GitHub Copilot</h2>
<p>In your <code>Program.cs</code> file for this<a id="_idIndexMarker680"/> chapter’s code, type a comment such as <code>// Populate a list of random numbers</code>, then move down to the next line.</p>
<p>Next, type the letters <code>Ra</code> and wait a moment before continuing. If everything is configured right, you should hopefully see a suggestion similar to the one I encountered in <em class="italic">Figure 11</em><em class="italic">.7</em>:</p>
<div><div><img alt="Figure 11.7 – GitHub Copilot helping at Random" src="img/B21324_11_7.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.7 – GitHub Copilot helping at Random</p>
<p>Here, GitHub Copilot has suggested some code based on the context it has observed in the area. In my case, its suggestion was <code>Random rand = new Random();</code>, which is a valid C# code.</p>
<p>In your case, it may suggest something different, including something that potentially doesn’t even make sense or compile.</p>
<p>Keep in mind that LLMs such as GitHub Copilot are not intelligent, but they memorize patterns and trends in their training data. Sometimes those trends work, while other times they look plausible but reference properties or capabilities that simply don’t exist.</p>
<p>Because GitHub Copilot and systems like it are trained on older code, you’ll sometimes notice Copilot generating out-of-date code or code using obsolete APIs. It’s also entirely possible that Copilot generates code with bugs, security vulnerabilities, performance issues, or other bad things. It’s your responsibility as a programmer to identify good and bad code.</p>
<p>Now that we’ve covered the basics of working with Copilot, let’s see what this has to do with refactoring by working <a id="_idIndexMarker681"/>with GitHub Copilot Chat.</p>
<h2 id="_idParaDest-247"><a id="_idTextAnchor246"/>Interacting with GitHub Copilot Chat</h2>
<p>With GitHub Copilot Chat installed <a id="_idIndexMarker682"/>and configured, let’s try our experiment again with a list of random numbers.</p>
<p>Remove any code you added after the comment on populating a list of random numbers. Next, move your typing cursor to the line below the comment as if you were about to start typing a line of code there.</p>
<p>From here, let’s show the GitHub Copilot Chat window by selecting <strong class="bold">View</strong> and then choosing <strong class="bold">GitHub Copilot Chat</strong>. You should see the <strong class="bold">GitHub Copilot Chat</strong> pane, shown in <em class="italic">Figure 11</em><em class="italic">.8</em>:</p>
<div><div><img alt="Figure 11.8 – The GitHub Copilot Chat pane" src="img/B21324_11_8.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.8 – The GitHub Copilot Chat pane</p>
<p>In the text box, type in <code>Generate a list of 10 random numbers</code> and press <em class="italic">Enter</em>. With any luck, you should see something like <em class="italic">Figure 11</em><em class="italic">.9</em>:</p>
<div><div><img alt="Figure 11.9 – A code suggestion from GitHub Copilot Chat" src="img/B21324_11_9.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.9 – A code suggestion from GitHub Copilot Chat</p>
<p>If you’ve ever interacted with ChatGPT or similar conversational AI agents, this should look very similar to that <a id="_idIndexMarker683"/>experience. In this case, Copilot Chat generated some code that we can accept either by clicking on the first button to copy the code or the <strong class="bold">Insert</strong> button to add it to the editor directly.</p>
<p>After clicking <code>Main</code> method. Click <strong class="bold">Accept</strong> and the code will be inserted.</p>
<p class="callout-heading">Tip</p>
<p class="callout">If you don’t like working with the GitHub Copilot Chat pane, you can bring up GitHub Copilot Chat suggestions at any time with the <em class="italic">Alt</em> + <em class="italic">/</em> keyboard shortcut.</p>
<p>If GitHub Copilot Chat doesn’t seem like it’s working, open the <strong class="bold">Output</strong> view and choose <strong class="bold">Show output from: GitHub Copilot Chat</strong>, as shown in <em class="italic">Figure 11</em><em class="italic">.10</em>:</p>
<div><div><img alt="Figure 11.10 – Diagnostic information from GitHub Copilot Chat" src="img/B21324_11_10.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.10 – Diagnostic information from GitHub Copilot Chat</p>
<p>This diagnostic information has helped me track down a few issues, but equally often the solution is simply to re-open Visual Studio. Thankfully, this diagnostic information is rarely ever needed, but it’s <a id="_idIndexMarker684"/>nice to know where to find it if you need it.</p>
<p>Now that we’ve seen Copilot at work, let’s use it to refactor some code.</p>
<h1 id="_idParaDest-248"><a id="_idTextAnchor247"/>Refactoring with GitHub Copilot Chat</h1>
<p>Because GitHub Copilot Chat was trained <a id="_idIndexMarker685"/>on open-source repositories, it has had a lot of exposure to people writing about code. Because of this, its likelihood of being able to provide helpful insight is high.</p>
<p>To see this, we’ll refactor the aptly-named <code>RefactorMe.cs</code> file, which looks like this:</p>
<pre class="source-code">
namespace Packt.CloudySkiesAir.Chapter11;
public class RefactorMe {
  public void DisplayRandomNumbers() {
    List&lt;int&gt; numbers = new List&lt;int&gt;();
    for (int i = 1; i &lt;= 10; i++) {
      Random rand = new Random();
      int n = rand.Next(1, 101);
      numbers.Add(n);
    }
    String output = string.Join(", ", numbers.ToArray());
    Console.WriteLine(output);
  }
}</pre>
<p>This code has some deliberate inefficiencies, and there’s even a potentially dangerous bug I sometimes see with <code>Random</code>. I’ll give you a few paragraphs to see if you can spot the issue, but let’s see if GitHub Copilot Chat can spot it.</p>
<p>Select the <code>DisplayRandomNumbers</code> method and then press <em class="italic">Alt</em> + <em class="italic">/</em> to open the chat prompt. Next, ask <a id="_idIndexMarker686"/>Copilot <code>How would you improve </code><code>this code?</code></p>
<p>When I asked Copilot, I got several suggestions, as shown in <em class="italic">Figure 11</em><em class="italic">.11</em>:</p>
<div><div><img alt="Figure 11.11 – GitHub Copilot Chat acting as a code reviewer" src="img/B21324_11_11.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.11 – GitHub Copilot Chat acting as a code reviewer</p>
<p>Looking over the suggestions I encountered (which might be different from the ones you see following this same experiment), I can summarize them into a few bullet points:</p>
<ul>
<li>Declare the <code>Random</code> outside of the loop for performance reasons</li>
<li>Since you know the size of the list, declare it as <code>new List&lt;int&gt;(10)</code></li>
<li>Use a <code>foreach</code> and an <code>Enumerable.Range</code> instead of a <code>for</code> loop</li>
</ul>
<p>Not only did GitHub Copilot Chat generate ideas for improvement, but it even suggested the following code to fulfill its suggestions:</p>
<pre class="source-code">
public void DisplayRandomNumbers() {
  List&lt;int&gt; numbers = <strong class="bold">new List&lt;int&gt;(10);</strong>
  <strong class="bold">Random rand = new Random();</strong>
  foreach (int i in <strong class="bold">Enumerable.Range(0, 10)</strong>) {
    int n = rand.Next(1, 101);
    numbers.Add(n);
  }
  string output = string.Join(", ", numbers);
  Console.WriteLine(output);
}</pre>
<p>Here, Copilot suggested some improvements I was considering, such as moving Random outside of the loop, and a few I wasn’t, such as using <code>Enumerable.Range</code>.</p>
<p class="callout-heading">What was the bug?</p>
<p class="callout">If you’re curious about the potential bug I mentioned, it had to do with <code>Random</code> being instantiated in the loop. Every time you run <code>new Random()</code>, it uses the current system time as a random seed to generate new numbers. If you do this in a fast loop, the clock stays the same, resulting in the same sequence of “random” numbers every iteration.</p>
<p>Looking at the<a id="_idIndexMarker687"/> recommended code, I notice a few opportunities for improvement, such as renaming the <code>n</code> variable to something more meaningful, using target-typed <code>new</code> to instantiate the objects, and discarding the unused <code>i</code> variable with the <code>_</code> operator.</p>
<p>Between GitHub and myself, our final code for this method is as follows:</p>
<pre class="source-code">
  public void DisplayRandomNumbers() {
    List&lt;int&gt; numbers = <strong class="bold">new(10);</strong>
    Random rand = <strong class="bold">new();</strong>
    foreach (int <strong class="bold">_</strong> in Enumerable.Range(0, 10)) {
      int <strong class="bold">number</strong> = rand.Next(1, 101);
      numbers.Add(<strong class="bold">number</strong>);
    }
    string output = string.Join(", ", numbers);
    Console.WriteLine(output);
  }</pre>
<p>The resulting code is more concise, slightly more performant in its list allocation, and ultimately represents a slightly better result for a small piece of code.</p>
<p>The purpose of this section wasn’t to show you how to generate random numbers, but instead for you to see the potential value chat offers as a “brainless” programming buddy who can review your code and generate suggestions. These suggestions won’t always make sense or<a id="_idIndexMarker688"/> even compile, but they can give you a quick external perspective when your coworkers are unavailable.</p>
<h2 id="_idParaDest-249"><a id="_idTextAnchor248"/>GitHub Copilot Chat as a code reviewer</h2>
<p>GitHub Copilot Chat’s value for refactoring isn’t just limited to code generation. You can also ask GitHub Copilot Chat questions<a id="_idIndexMarker689"/> such as the following:</p>
<ul>
<li>Can you review this code as if you were a senior engineer in a code review?</li>
<li>What performance optimizations can be made to this method?</li>
<li>How can I make this method more readable?</li>
<li>Where would this method encounter errors?</li>
<li>Are there any ways of reducing or combining lines that don’t hurt the overall readability?</li>
</ul>
<p>Of course, it’s important to remember that you’re effectively getting advice from an LLM that is essentially a glorified autocompletion/sentence prediction engine and not a being with intelligent or original thought.</p>
<p>Amusingly, I’ve noticed that asking GitHub Copilot Chat for its opinion on methods several times can yield different results. These results can even reverse the opinion of the original recommendations that Copilot provided! Still, this can be valuable in getting a variety of perspectives.</p>
<p>Before we move on, let’s look at another example of refactoring code.</p>
<h2 id="_idParaDest-250"><a id="_idTextAnchor249"/>Targeted refactoring with GitHub Copilot Chat</h2>
<p>This refactoring example focuses on the <code>BaggageCalculator.cs</code> file. This file holds the final version of the <code>BaggageCalculator</code> class from the end of <a href="B21324_02.xhtml#_idTextAnchor026"><em class="italic">Chapter 2</em></a>.</p>
<p>As a quick reminder, this class has a <code>CalculatePrice</code> method that calculates and displays the baggage fee for a <a id="_idIndexMarker690"/>customer based on the number of checked-in and carry-on bags and whether they’re traveling on a holiday.</p>
<p>Supporting the public <code>CalculatePrice</code> method is a private static <code>ApplyCheckedBagFee</code> method that calculates the fee of a checked bag.</p>
<p>We’ll focus largely on the <code>CalculatePrice</code> method, which looks a little repetitive:</p>
<pre class="source-code">
public decimal CalculatePrice(int bags, int carryOn,
  int passengers, bool isHoliday) {
  decimal total = 0;
  if (carryOn &gt; 0) {
    decimal fee = carryOn * CarryOnFee;
    Console.WriteLine($"Carry-on: {fee}");
    total += fee;
  }
  if (bags &gt; 0) {
    decimal bagFee = ApplyCheckedBagFee(bags, passengers);
    Console.WriteLine($"Checked: {bagFee}");
    total += bagFee;
  }
  if (isHoliday) {
    decimal holidayFee = total * HolidayFeePercent;
    Console.WriteLine("Holiday Fee: " + holidayFee);
    total += holidayFee;
  }
  return total;
}</pre>
<p>Looking at this code, we see three similar blocks that check a condition, calculate a fee, display that fee, and then add it to <code>total</code>.</p>
<p>This repetitive nature of the code strikes me as a code smell that could potentially be improved. One solution would be to extract a method for each of these three blocks, but these methods would still be <a id="_idIndexMarker691"/>very similar to each other.</p>
<p>Instead, I naturally wonder if there’s a solution that might involve an <code>Action</code> or a <code>Func</code>, but I’m not immediately certain of what such a solution might look like.</p>
<p>Thankfully, we can ask Copilot about this by selecting the entire method and telling GitHub Copilot Chat <code>Refactor this method to use an Action that writes the fee out and adds it to total so the three blocks are </code><code>less repetitive</code>.</p>
<p>For me, this resulted in the following method:</p>
<pre class="source-code">
public decimal CalculatePrice(int bags, int carryOn,
  int passengers, bool isHoliday) {
  decimal total = 0;
<strong class="bold">  Action&lt;decimal&gt; addFeeToTotal = fee =&gt; {</strong>
<strong class="bold">    </strong><strong class="bold">Console.WriteLine($"Fee: {fee}");</strong>
<strong class="bold">    total += fee;</strong>
<strong class="bold">  };</strong>
  if (carryOn &gt; 0) {
    decimal fee = carryOn * CarryOnFee;
<strong class="bold">    addFeeToTotal(fee);</strong>
  }
  if (bags &gt; 0) {
    decimal bagFee = ApplyCheckedBagFee(bags, passengers);
    <strong class="bold">addFeeToTotal(bagFee);</strong>
  }
  if (isHoliday) {
    decimal holidayFee = total * HolidayFeePercent;
    Console.WriteLine("Holiday Fee: " + holidayFee);
    <strong class="bold">addFeeToTotal(holidayFee);</strong>
  }
  return total;
}</pre>
<p>Here, Copilot introduced a local <code>addFeeToTotal</code> variable storing an <code>Action</code> that writes the <code>fee</code> to the console and increments <code>total</code>. It then calls this <code>Action</code> from each of the three branches.</p>
<p>However, this refactoring was<a id="_idIndexMarker692"/> incorrect in a few regards. First, the messages being displayed now start with <code>Fee</code> instead of the appropriate fee name. Second, the refactoring didn’t remove the <code>WriteLine</code> for the holiday fee, so that <code>fee</code> would be displayed twice.</p>
<p>Still, the refactoring does give us an idea of how the code could be improved. With a little clean-up, you end up with a more correct method:</p>
<pre class="source-code">
public decimal CalculatePrice(int bags, int carryOn,
  int passengers, bool isHoliday) {
  decimal total = 0;
  Action&lt;string, decimal&gt; addFeeToTotal = (name, fee) =&gt; {
    Console.WriteLine($"{name}: {fee}");
    total += fee;
  };
  if (carryOn &gt; 0) {
    decimal fee = carryOn * CarryOnFee;
    addFeeToTotal("Carry-on", fee);
  }
  if (bags &gt; 0) {
    decimal bagFee = ApplyCheckedBagFee(bags, passengers);
    addFeeToTotal("Checked", bagFee);
  }
  if (isHoliday) {
    decimal holidayFee = total * HolidayFeePercent;
    addFeeToTotal("Holiday Fee", holidayFee);
  }
  return total;
}</pre>
<p>This code now works <a id="_idIndexMarker693"/>properly and reduces duplication. In this particular case, Copilot was able to suggest a path forward, but accurately implementing it without introducing bugs was beyond its current abilities.</p>
<p>This limit underscores both the need for tests and the role of Copilot as the <em class="italic">partner</em> of the human programmer and not a <em class="italic">replacement</em> for the human.</p>
<p class="callout-heading">Reminder</p>
<p class="callout">Remember that GitHub Copilot Chat, ChatGPT, and other generative AI systems based on large language models are just prediction machines that generate text that follows patterns from their training data. There is nothing guaranteeing that these generated values are correct, optimal, or free of bugs.</p>
<p>Now that we’ve covered a few refactoring scenarios, let’s see what else we can do with GitHub Copilot Chat.</p>
<h1 id="_idParaDest-251"><a id="_idTextAnchor250"/>Drafting documentation with GitHub Copilot Chat</h1>
<p>Over the years, I’ve learned that <a id="_idIndexMarker694"/>developers don’t always like to document their code. While some code truly is self-documenting as developers claim, other areas require proper documentation.</p>
<p>In C#, we document public methods with XML documentation, such as the sample comment for the <code>DisplayRandomNumbers</code> method:</p>
<pre class="source-code">
<strong class="bold">/// &lt;summary&gt;</strong>
<strong class="bold">/// Displays a sequence of 10 random numbers.</strong>
<strong class="bold">/// &lt;/summary&gt;</strong>
public void DisplayRandomNumbers() {</pre>
<p>This specially formatted comment is interpreted by Visual Studio to display additional help in the editor. This extra information appears in the editor when you are trying to invoke your method, as shown in <em class="italic">Figure 11</em><em class="italic">.12</em>:</p>
<div><div><img alt="Figure 11.12 – Visual Studio showing a tooltip containing the method comment" src="img/B21324_11_12.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.12 – Visual Studio showing a tooltip containing the method comment</p>
<p>Although the sample documentation we saw a moment ago was relatively straightforward, documentation gets a bit more complex when you have return values and parameters.</p>
<p>Let’s use GitHub Copilot Chat to document a method. We’ll start with the <code>AddEvenNumbers</code> method in <code>DocumentMe.cs</code>:</p>
<pre class="source-code">
public int AddEvenNumbers(int[]? numbers, int total = 0) {
  if (numbers == null || numbers.Length == 0) {
    string message = "There must be at least 1 element";
    throw new ArgumentException(message, nameof(numbers));
  }
  return total + numbers.Where(n =&gt; n % 2 == 0).Sum();
}</pre>
<p>This method takes in an array of numbers and, optionally, a number to add to the resulting sum. If at least one number was provided, the method returns the sum of all even numbers in that array added to the optional <code>total</code> parameter. If no elements were provided, an <code>ArgumentException</code> will be thrown instead.</p>
<p>Now that you’ve read <em class="italic">my</em> description of this, let’s <a id="_idIndexMarker695"/>see how GitHub Copilot describes it. Press <em class="italic">Alt</em> + <em class="italic">/</em> to open the chat interface and then tell Copilot to <code>Document AddEvenNumbers</code>. Copilot should suggest documentation changes such as the ones shown in the preview in <em class="italic">Figure 11</em><em class="italic">.12</em>:</p>
<div><div><img alt="Figure 11.13 – GitHub Copilot suggesting documentation" src="img/B21324_11_13.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.13 – GitHub Copilot suggesting documentation</p>
<p>Click <strong class="bold">Accept</strong> and the comments will be added to your method.</p>
<p>For me, the documentation generated was reasonably good:</p>
<pre class="source-code">
/// &lt;summary&gt;
/// Adds up even numbers in an array. Throws an
/// ArgumentException if the array is null or empty.
/// &lt;/summary&gt;
/// &lt;param name="numbers"&gt;
/// The array of numbers to add.
/// &lt;/param&gt;
/// &lt;param name="total"&gt;
/// The starting total to add to. Defaults to 0.
/// &lt;/param&gt;
/// &lt;returns&gt;
/// The total of all even numbers in the array.
/// &lt;/returns&gt;</pre>
<p>This is a very accurate <a id="_idIndexMarker696"/>piece of documentation. The one change I would make is to add the following line of XML documenting the potential exception:</p>
<pre class="source-code">
/// &lt;exception cref="ArgumentException"&gt;Thrown when the array is null or empty.&lt;/exception&gt;</pre>
<p>This adds the exception to the list shown in the method tooltip, as seen in <em class="italic">Figure 11</em><em class="italic">.13</em>:</p>
<div><div><img alt="Figure 11.14 – Exception documentation in Visual Studio" src="img/B21324_11_14.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.14 – Exception documentation in Visual Studio</p>
<p>Communicating exceptions allows other code to catch them in an appropriate manner.</p>
<p>Human-generated documentation will usually be better than AI documentation, but when humans and AI can work together, it can be a huge productivity boost.</p>
<p>In the next section, we’ll see how these productivity boosts apply to testing as well.</p>
<h1 id="_idParaDest-252"><a id="_idTextAnchor251"/>Generating test stubs with GitHub Copilot Chat</h1>
<p>For our final technical section of this chapter, let’s look at a method that finds the largest number in a sequence of <a id="_idIndexMarker697"/>numbers, provided that the number doesn’t have a “7” in it somewhere, such as a 71 or 17. This method is<a id="_idIndexMarker698"/> located inside of <code>TestMe.cs</code>:</p>
<pre class="source-code">
public static class TestMe {
  <strong class="bold">public static int CalculateLargestNumberWithoutASeven(</strong>
<strong class="bold">    INumberProvider provider)</strong> {
    IEnumerable&lt;int&gt; numbers = provider.GenerateNumbers();
    return numbers.Where(x =&gt; !x.ToString().Contains("7"))
                  .Max();
  }
}</pre>
<p>This <code>CalculateLargestNumberWithoutASeven</code> method takes in an <code>INumberProvider</code> that allows us to call <code>GenerateNumbers</code> and get a sequence of integers.</p>
<p>Next, the method looks at the resulting sequence, finds the numbers that don’t have a seven somewhere in their string representation, and then returns the largest number.</p>
<p class="callout-heading">Dependency injection</p>
<p class="callout">As a brief refresher, our method is effectively getting its dependency on an <code>INumberProvider</code> injected into it as an external parameter. This means the code works with anything that implements that interface without having to know the details.</p>
<p>While this method seems utterly useless as something you might write in the real world, think for a moment about how you would test this method. Specifically, how would you call this method? What would you give it as an <code>INumberProvider</code>? What value would you expect it to return?</p>
<p>While you’re thinking that over, let’s see how GitHub Copilot would handle this by opening the GitHub Copilot Chat pane and typing in <code>Generate tests </code><code>for CalculateLargestNumberWithoutASeven.</code></p>
<p class="callout-heading">Note</p>
<p class="callout">While I usually prefer to use the <em class="italic">Alt</em> + <em class="italic">/</em> method of interacting with Copilot, if you want Copilot to generate a new file you should use the GitHub Copilot Chat pane for best results.</p>
<p>For me, Copilot generated a C# code for a new test class. I’ll share that code shortly, but what’s most interesting<a id="_idIndexMarker699"/> to me about the code generation are<a id="_idIndexMarker700"/> the three buttons at the bottom of the recommendation, shown in <em class="italic">Figure 11</em><em class="italic">.14</em>:</p>
<div><div><img alt="Figure 11.15 – GitHub Copilot offering to create a new file" src="img/B21324_11_15.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.15 – GitHub Copilot offering to create a new file</p>
<p>These three buttons allow you to copy the new code to your clipboard, create a new file, and insert the code in the current editor, respectively.</p>
<p>Since we want the tests to live in the test project, click <strong class="bold">Create </strong><strong class="bold">new file</strong>.</p>
<p>This will create a new file in your test project with any test(s) generated by Copilot. For me, it generated two tests, as shown at a high level in <em class="italic">Figure 11</em><em class="italic">.16</em>:</p>
<div><div><img alt="Figure 11.16 – A pair of XUnit tests generated by GitHub Copilot Chat" src="img/B21324_11_16.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.16 – A pair of XUnit tests generated by GitHub Copilot Chat</p>
<p>The tests aren’t the most important thing here, so I don’t want to focus on the code other than to make a few <a id="_idIndexMarker701"/>observations on Copilot’s strategy <a id="_idIndexMarker702"/>when I asked it for tests:</p>
<ul>
<li>Copilot generated a pair of tests using xUnit and Moq, which were both installed in the test project already. These tests compile and pass.</li>
<li>The first test ensured the method threw an exception when given a null input.</li>
<li>The second test provided a series of numbers at random and asserted that the method returned the largest number without a seven.</li>
<li>Both tests used Moq to create a fake <code>INumberProvider</code> that is programmed to generate the desired sequence of numbers.</li>
</ul>
<p>So, have we discovered the silver bullet that allows us to forget about writing tests going forward? Probably not.</p>
<p>While both tests verify something legitimate, their readability could be better. Additionally, the tests don’t consider all the paths that should be tested. For example, it didn’t test with an empty sequence of elements, with only a single number, with a single number with a seven in it, with only negative numbers, or with the largest number having a seven in it. These are all legitimate cases that a human tester would likely consider.</p>
<p>So, GitHub Copilot won’t absolve<a id="_idIndexMarker703"/> you of your responsibility to test your code (and think about your tests), but it’s not completely worthless either.</p>
<p>GitHub Copilot has a lot of value for identifying test cases and considering new ways of testing particularly hard-to-test classes. I’ve come to view it as a catalyst – or copilot –that helps get your <a id="_idIndexMarker704"/>momentum going when writing tests of your own.</p>
<p>Now that we’ve seen the value GitHub Copilot provides, let’s talk about its limits.</p>
<h1 id="_idParaDest-253"><a id="_idTextAnchor252"/>Understanding the limits of GitHub Copilot</h1>
<p>By this point in the chapter, many <a id="_idIndexMarker705"/>readers are probably thinking “This is great, but can I actually use this in my job?” That’s a valid question, so let’s talk about the two common objections: privacy of source code and license concerns with public code.</p>
<h2 id="_idParaDest-254"><a id="_idTextAnchor253"/>Data privacy and GitHub Copilot</h2>
<p>Many organizations considering GitHub<a id="_idIndexMarker706"/> Copilot are concerned that integrating an AI tool into their code editor means exposing their code to GitHub. Some also raise the potential that GitHub might even use the organization’s private code to generate new large language models in the future where these new models might generate code based on the organization’s proprietary logic.</p>
<p>These are valid concerns, and depending on which edition of GitHub Copilot you are using, there may be some basis for them.</p>
<p>With <strong class="bold">GitHub Copilot for Individuals</strong>, the prompts you send to GitHub Copilot, including surrounding code and Copilot’s suggested code, may be retained for analysis unless you have disabled the code snippet collection in your settings.</p>
<p>This setting can be disabled at <a href="https://github.com/settings/copilot">https://github.com/settings/copilot</a> by unchecking the <strong class="bold">Allow GitHub to use my code snippets for product improvements</strong> checkbox, as shown in <em class="italic">Figure 11</em><em class="italic">.17</em>:</p>
<div><div><img alt="Figure 11.17 – GitHub Copilot settings" src="img/B21324_11_17.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.17 – GitHub Copilot settings</p>
<p>While GitHub Copilot for Individuals has some data privacy concerns by default, these can be easily opted out if you are working with sensitive code.</p>
<p>It should also be noted that <a id="_idIndexMarker707"/>GitHub Copilot for Individuals also collects telemetry on GitHub Copilot usage to detect how frequently the service is used and detect and resolve errors.</p>
<p>On the other <a id="_idIndexMarker708"/>hand, <strong class="bold">GitHub Copilot for Business</strong> is private by default and also offers additional organization-wide policy settings that businesses can configure to globally enable or disable Copilot. These features can also be used to prevent Copilot from generating code matching known public code for everyone in your organization.</p>
<p>According to<a id="_idIndexMarker709"/> the <strong class="bold">GitHub Copilot Trust Center</strong>, <em class="italic">“GitHub Copilot [for business] does not use Prompts or Suggestions to train AI models. These inputs are not retained or utilized in the training process of AI models for GitHub Copilot”.</em> This means that the code you send to GitHub Copilot and the suggestions it generates for you are private from human consumption and will not be used to give others insight into your codebase.</p>
<p class="callout-heading">Disclaimer</p>
<p class="callout">This book is intended to help you understand the basics of GitHub Copilot and was written with the best understanding available of an early technology. As with any technology, GitHub Copilot continues to evolve and grow. As it does so, the privacy policy, data retention policy, and pricing model will likely change over time. Readers are encouraged to verify the information in this chapter against current information provided by GitHub before making any usage decisions.</p>
<p>Glory Francke, head of privacy at GitHub, states “We only process your code to provide the service. It is not retained, human eyes don’t see it, and it is not being used for any AI model improvements” (GitHub Copilot Trust Center – <a href="https://resources.github.com/copilot-trust-center/">https://resources.github.com/copilot-trust-center/</a>).</p>
<p>In general, I find the GitHub Copilot Trust Center to be a very useful tool in addressing enterprise concerns around the security, privacy, and accessibility of the tool. You can read more about the<a id="_idIndexMarker710"/> trust center in the <em class="italic">Further reading</em> section of this chapter, but for now, let’s talk more about GitHub Copilot and public code.</p>
<h2 id="_idParaDest-255"><a id="_idTextAnchor254"/>Concerns around GitHub Copilot and public code</h2>
<p>Most open-source code is <a id="_idIndexMarker711"/>accompanied by a license dictating the terms developers must follow when using the source code. There are several common licenses that developers choose, such as the MIT License, Apache License, GNU General Public License, and so on.</p>
<p>While many of these licenses are very permissive, some include clauses requiring additional actions such as attributing the source code, making your organization’s code open source, or not being able to use the code in commercial software projects.</p>
<p>Because of restrictions like this, and because GitHub Copilot was trained on open-source software code, there’s a small chance that GitHub Copilot might accidentally generate code identical to code from a public repository.</p>
<p>Because of this concern, GitHub Copilot now allows individuals and businesses to block the generation of code that is identical to known public code. Additionally, GitHub is currently rolling out a new feature called GitHub Copilot code referencing, which allows you to detect whether Copilot has suggested public code. This feature lets you unleash Copilot’s full creativity while allowing you to see what repositories the code was found and the licenses for those repositories.</p>
<p>At the time of writing this chapter, this feature was not yet available for GitHub Copilot for Visual Studio, but it’s likely that this capability will make it to Visual Studio sometime after the publication of this book.</p>
<p>Let’s close the chapter with <a id="_idIndexMarker712"/>a case study on GitHub Copilot Chat at our fictitious airline.</p>
<h1 id="_idParaDest-256"><a id="_idTextAnchor255"/>Case study: Cloudy Skies Airline</h1>
<p>The use of AI at Cloudy Skies Airlines<a id="_idIndexMarker713"/> started first with individual developers, as often happens with productivity tools and new technologies. James, an eager young developer on the team, shared with his coworkers how he’s been trying GitHub Copilot, feeling more capable and empowered, and even learning new things. His coworkers were excited, but his manager, Mya, had a few concerns.</p>
<p>Looping in the chief technology officer (CTO), Mya and James demonstrated the capabilities of the tool and talked about how it worked. The CTO was worried about legal compliance and the safety of the company’s intellectual property. As a result, the use of Copilot and other AI tools was temporarily suspended while the team investigated the implications of the technology.</p>
<p>After some research, and with the help of the GitHub Copilot Trust Center, the Cloudy Skies Airlines team agreed to a multi-stage plan:</p>
<ol>
<li><strong class="bold">Pilot the program</strong>: A small group of developers, including James, will try GitHub Copilot with code snippet collection disabled for two weeks</li>
<li><strong class="bold">Review</strong>: The team will evaluate any impacts on productivity, code quality, and general developer feedback from the pilot program and decide whether the tool should be adopted</li>
<li><strong class="bold">Rollout</strong>: If GitHub Copilot is found to be beneficial, it will either be allowed for individuals organizational-wide with guidelines or be managed through a GitHub Copilot for Business account, depending on the results of the technology review</li>
</ol>
<p>The developers in the pilot program reported having an easier time focusing on code, employing helpful practices for speeding up “boring” aspects of coding, and learning some new practices and concepts from the code that Copilot generated.</p>
<p>As a result, Cloudy Skies Airlines embraced GitHub Copilot and adopted a GitHub Copilot for Business account to ensure snippet collection was disabled and that appropriate policies on things such as <a id="_idIndexMarker714"/>public code sources were set at an organizational level.</p>
<h1 id="_idParaDest-257"><a id="_idTextAnchor256"/>Summary</h1>
<p>In this chapter, we saw how GitHub Copilot and GitHub Copilot Chat can help developers understand, refactor, document, and even test their code.</p>
<p>We talked about how GitHub Copilot is not an intelligent AI overlord, but instead a predictive model built around patterns in text found in open-source repositories. As a result, the code it generates may not even compile and may contain security vulnerabilities, bugs, performance issues, or other undesirable effects.</p>
<p>We closed this chapter with a discussion of privacy and open-source licensing that organizations must care about for security and compliance purposes and how GitHub Copilot helps organizations meet those needs.</p>
<p>In the next chapter, we’ll explore code analysis in Visual Studio and see how code analysis can help you detect potential issues and targets for refactoring in your code.</p>
<h1 id="_idParaDest-258"><a id="_idTextAnchor257"/>Questions</h1>
<ol>
<li>How do GitHub Copilot and GitHub Copilot Chat work?</li>
<li>How can you address data privacy and compliance concerns with Copilot?</li>
</ol>
<h1 id="_idParaDest-259"><a id="_idTextAnchor258"/>Further reading</h1>
<p>You can find more information about GitHub Copilot at these URLs:</p>
<ul>
<li>About the GitHub Copilot extension for Visual Studio: <a href="https://learn.microsoft.com/en-us/visualstudio/ide/visual-studio-github-copilot-extension">https://learn.microsoft.com/en-us/visualstudio/ide/visual-studio-github-copilot-extension</a></li>
<li>GitHub Copilot Trust Center: <a href="https://resources.github.com/copilot-trust-center/">https://resources.github.com/copilot-trust-center/</a></li>
<li><em class="italic">GitHub Copilot </em><em class="italic">Chat</em>: <a href="https://docs.github.com/en/copilot/github-copilot-chat/about-github-copilot-chat">https://docs.github.com/en/copilot/github-copilot-chat/about-github-copilot-chat</a></li>
</ul>
</div>
</body></html>