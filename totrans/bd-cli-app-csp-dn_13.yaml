- en: '13'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '13'
- en: Security Considerations for CLI Applications
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: CLIåº”ç”¨ç¨‹åºçš„å®‰å…¨è€ƒè™‘å› ç´ 
- en: Security is one of the most critical concerns in any application development
    project. Itâ€™s interesting to see that, in many projects, development teams tend
    to think that because they implemented measures to prevent their applicationâ€™s
    code from being subject to SQL injection, XSS attacks, or similar, their application
    is secure.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: å®‰å…¨æ€§æ˜¯ä»»ä½•åº”ç”¨ç¨‹åºå¼€å‘é¡¹ç›®ä¸­æœ€é‡è¦çš„å…³æ³¨ç‚¹ä¹‹ä¸€ã€‚æœ‰è¶£çš„æ˜¯ï¼Œåœ¨è®¸å¤šé¡¹ç›®ä¸­ï¼Œå¼€å‘å›¢é˜Ÿå¾€å¾€è®¤ä¸ºï¼Œç”±äºä»–ä»¬å®æ–½äº†é˜²æ­¢åº”ç”¨ç¨‹åºä»£ç å—åˆ°SQLæ³¨å…¥ã€XSSæ”»å‡»æˆ–ç±»ä¼¼æ”»å‡»çš„æªæ–½ï¼Œä»–ä»¬çš„åº”ç”¨ç¨‹åºå°±æ˜¯å®‰å…¨çš„ã€‚
- en: However, it is important to keep in mind that security takes different forms
    and spans different areas, which means that it does not only concern the security
    of the applicationâ€™s code or its usage but also extends to the security of the
    whole development lifecycle.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶è€Œï¼Œé‡è¦çš„æ˜¯è¦è®°ä½ï¼Œå®‰å…¨æ€§å…·æœ‰ä¸åŒçš„å½¢å¼ï¼Œè¦†ç›–ä¸åŒçš„é¢†åŸŸï¼Œè¿™æ„å‘³ç€å®ƒä¸ä»…å…³ä¹åº”ç”¨ç¨‹åºä»£ç çš„å®‰å…¨æ€§æˆ–å…¶ä½¿ç”¨ï¼Œè¿˜æ‰©å±•åˆ°æ•´ä¸ªå¼€å‘ç”Ÿå‘½å‘¨æœŸçš„å®‰å…¨æ€§ã€‚
- en: 'In this chapter, we will discuss these different areas and how they are related
    to securing CLI applications, and we will cover the key areas that you need to
    consider in order to enhance the security of your CLI application and the security
    of your development lifecycle. More specifically, we will do the following:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºè¿™äº›ä¸åŒé¢†åŸŸä»¥åŠå®ƒä»¬å¦‚ä½•ä¸ç¡®ä¿CLIåº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ç›¸å…³ï¼Œå¹¶æ¶µç›–æ‚¨éœ€è¦è€ƒè™‘çš„å…³é”®é¢†åŸŸï¼Œä»¥å¢å¼ºæ‚¨çš„CLIåº”ç”¨ç¨‹åºå’Œå¼€å‘ç”Ÿå‘½å‘¨æœŸçš„å®‰å…¨æ€§ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œæˆ‘ä»¬å°†åšä»¥ä¸‹å‡ ä»¶äº‹ï¼š
- en: Discuss the different areas in which security should be considered
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: è®¨è®ºåº”è¯¥è€ƒè™‘å®‰å…¨æ€§çš„ä¸åŒé¢†åŸŸ
- en: Learn how to assess the security posture of a CLI application
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å­¦ä¹ å¦‚ä½•è¯„ä¼°CLIåº”ç”¨ç¨‹åºçš„å®‰å…¨çŠ¶å†µ
- en: Learn how to implement authentication in order to secure access to user data
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å­¦ä¹ å¦‚ä½•å®ç°èº«ä»½éªŒè¯ä»¥ç¡®ä¿ç”¨æˆ·æ•°æ®çš„è®¿é—®å®‰å…¨
- en: Technical requirements
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: æŠ€æœ¯è¦æ±‚
- en: The code for this chapter can be found in the GitHub repository accompanying
    this book, [https://github.com/PacktPublishing/Building-CLI-Applications-with-C-Sharp-and-.NET/tree/main/Chapter13](https://github.com/PacktPublishing/Building-CLI-Applications-with-C-Sharp-and-.NET/tree/main/Chapter13)
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: æœ¬ç« çš„ä»£ç å¯ä»¥åœ¨æœ¬ä¹¦é…å¥—çš„GitHubä»“åº“ä¸­æ‰¾åˆ°ï¼Œ[https://github.com/PacktPublishing/Building-CLI-Applications-with-C-Sharp-and-.NET/tree/main/Chapter13](https://github.com/PacktPublishing/Building-CLI-Applications-with-C-Sharp-and-.NET/tree/main/Chapter13)
- en: Security areas
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å®‰å…¨æ€§é¢†åŸŸ
- en: As mentioned earlier, security is not only limited to the applicationâ€™s code,
    nor can it only be achieved by implementing authentication, although these areas
    are very important.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚å‰æ‰€è¿°ï¼Œå®‰å…¨æ€§ä¸ä»…é™äºåº”ç”¨ç¨‹åºä»£ç ï¼Œä¹Ÿä¸èƒ½ä»…é€šè¿‡å®ç°èº«ä»½éªŒè¯æ¥å®ç°ï¼Œå°½ç®¡è¿™äº›é¢†åŸŸéå¸¸é‡è¦ã€‚
- en: Letâ€™s first start by highlighting the key areas involved in securing an application
    throughout its lifecycle. It is important for me to make this point (or reminder)
    here as I still meet with customers who introduce security too late in the lifecycle
    of an application (typically after the application has been developed and released
    to production), expecting security professionals to do miracles and secure the
    application with minimal or no modification to the application, which is, obviously,
    unrealistic.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬å…ˆå¼ºè°ƒä¸€ä¸‹åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ç¡®ä¿åº”ç”¨ç¨‹åºå®‰å…¨æ€§çš„å…³é”®é¢†åŸŸã€‚æˆ‘å¿…é¡»åœ¨è¿™é‡Œå¼ºè°ƒï¼ˆæˆ–æé†’ï¼‰è¿™ä¸€ç‚¹ï¼Œå› ä¸ºæˆ‘ä»ç„¶é‡åˆ°ä¸€äº›å®¢æˆ·ï¼Œä»–ä»¬åœ¨åº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸä¸­å¼•å…¥å®‰å…¨æ€§å¤ªæ™šï¼ˆé€šå¸¸æ˜¯åœ¨åº”ç”¨ç¨‹åºå¼€å‘å¹¶å‘å¸ƒåˆ°ç”Ÿäº§ä¹‹åï¼‰ï¼ŒæœŸæœ›å®‰å…¨ä¸“å®¶èƒ½å¤Ÿåˆ›é€ å¥‡è¿¹ï¼Œä»¥æœ€å°çš„æˆ–æ²¡æœ‰ä¿®æ”¹åº”ç”¨ç¨‹åºçš„æ–¹å¼ç¡®ä¿åº”ç”¨ç¨‹åºçš„å®‰å…¨ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸ç°å®çš„ã€‚
- en: 'Always keep in mind that security should span the entire lifecycle of the application.
    In concrete terms, security should be a concern from the early stages of designing
    the application:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: æ€»æ˜¯è¦ç‰¢è®°ï¼Œå®‰å…¨æ€§åº”è¯¥è´¯ç©¿åº”ç”¨ç¨‹åºçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚å…·ä½“æ¥è¯´ï¼Œå®‰å…¨æ€§åº”è¯¥ä»è®¾è®¡åº”ç”¨ç¨‹åºçš„æ—©æœŸé˜¶æ®µå°±æˆä¸ºä¸€ä¸ªå…³æ³¨ç‚¹ï¼š
- en: '**In the design phase**: It is important to define security requirements and
    objectives and to conduct threat modeling using methodologies such as STRIDE to
    identify potential security risks so we can incorporate the appropriate security
    controls into the initial design. STRIDE helps categorize threats into six groups:
    Spoofing, Tampering, Repudiation, Information disclosure, Denial of service, and
    Elevation of privilege. After identifying threats, we can use the DREAD model
    to quantitatively assess and prioritize them based on their Damage potential,
    Reproducibility, Exploitability, Affected users, and Discoverability. During this
    phase, we should also consider privacy and data protection measures, such as encryption,
    authentication, and authorization.'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**åœ¨è®¾è®¡é˜¶æ®µ**ï¼šå®šä¹‰å®‰å…¨éœ€æ±‚å’Œç›®æ ‡ï¼Œå¹¶ä½¿ç”¨STRIDEç­‰æ–¹æ³•è¿›è¡Œå¨èƒå»ºæ¨¡ï¼Œä»¥è¯†åˆ«æ½œåœ¨çš„å®‰å…¨é£é™©ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥å°†é€‚å½“çš„å®‰å…¨æ§åˆ¶æªæ–½çº³å…¥åˆå§‹è®¾è®¡ï¼Œè¿™æ˜¯éå¸¸é‡è¦çš„ã€‚STRIDEå¸®åŠ©å°†å¨èƒåˆ†ç±»ä¸ºå…­ä¸ªç»„ï¼šæ¬ºéª—ã€ç¯¡æ”¹ã€å¦è®¤ã€ä¿¡æ¯æ³„éœ²ã€æ‹’ç»æœåŠ¡å’Œæƒé™æå‡ã€‚åœ¨è¯†åˆ«å¨èƒåï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨DREADæ¨¡å‹æ ¹æ®å…¶æŸå®³æ½œåŠ›ã€å¯é‡å¤æ€§ã€å¯åˆ©ç”¨æ€§ã€å—å½±å“ç”¨æˆ·å’Œå¯å‘ç°æ€§è¿›è¡Œå®šé‡è¯„ä¼°å’Œä¼˜å…ˆæ’åºã€‚åœ¨æ­¤é˜¶æ®µï¼Œæˆ‘ä»¬è¿˜åº”è€ƒè™‘éšç§å’Œæ•°æ®ä¿æŠ¤æªæ–½ï¼Œå¦‚åŠ å¯†ã€èº«ä»½éªŒè¯å’Œæˆæƒã€‚'
- en: '**In the architecture phase**: We are not only talking about the software architecture
    here but also about the infrastructure and networking architecture. Of course,
    we need to design a secure architecture that includes defense-in-depth strategies
    and integrates security mechanisms such as authentication and authorization. But
    we also need to plan for secure communication channels and data storage, using
    techniques such as encryption at rest and in transit along with network segmentation
    to ensure only appropriate routes of communication, through the appropriate network
    addresses, ports, and domains, and using appropriate protocols are allowed.'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**åœ¨æ¶æ„é˜¶æ®µ**ï¼šæˆ‘ä»¬åœ¨è¿™é‡Œè®¨è®ºçš„ä¸ä»…ä»…æ˜¯è½¯ä»¶æ¶æ„ï¼Œè¿˜åŒ…æ‹¬åŸºç¡€è®¾æ–½å’Œç½‘ç»œæ¶æ„ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ä¸ªåŒ…å«æ·±åº¦é˜²å¾¡ç­–ç•¥å¹¶é›†æˆå®‰å…¨æœºåˆ¶ï¼ˆå¦‚èº«ä»½éªŒè¯å’Œæˆæƒï¼‰çš„å®‰å…¨æ¶æ„ã€‚ä½†æˆ‘ä»¬è¿˜éœ€è¦è®¡åˆ’å®‰å…¨çš„é€šä¿¡é€šé“å’Œæ•°æ®å­˜å‚¨ï¼Œä½¿ç”¨è¯¸å¦‚é™æ€å’Œä¼ è¾“ä¸­çš„åŠ å¯†ä»¥åŠç½‘ç»œåˆ†æ®µç­‰æŠ€æœ¯ï¼Œä»¥ç¡®ä¿åªæœ‰é€‚å½“çš„é€šä¿¡è·¯å¾„ã€é€šè¿‡é€‚å½“çš„ç½‘ç»œåœ°å€ã€ç«¯å£å’ŒåŸŸåï¼Œå¹¶ä½¿ç”¨é€‚å½“çš„åè®®è¢«å…è®¸ã€‚'
- en: '**In the development phase**: It is important to apply secure coding practices
    by relying on coding standards, such as implementing input validation and sanitization,
    and to ensure that our application is not vulnerable to common OWASP Top 10 security
    risks. It is equally important to ensure that secure coding practices are applied
    during code reviews. But this is not enough! You should use secure libraries and
    frameworks. In other words, ensure that your frameworks and libraries are still
    supported and receive security updates. Since we are using .NET 8 here, we know
    that it is still supported (and will receive security updates) until November
    10, 2026 (Iâ€™m writing this in November 2024). As a framework or a library becomes
    unsupported, it is important to plan to migrate to a newer version (not necessarily
    the latest, by the way ğŸ˜‰).'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**åœ¨å¼€å‘é˜¶æ®µ**ï¼šé€šè¿‡ä¾èµ–ç¼–ç æ ‡å‡†ï¼Œå¦‚å®ç°è¾“å…¥éªŒè¯å’Œæ¸…ç†ï¼Œå¹¶ç¡®ä¿æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸å—å¸¸è§çš„OWASP Top 10å®‰å…¨é£é™©çš„å½±å“ï¼Œåº”ç”¨å®‰å…¨ç¼–ç å®è·µéå¸¸é‡è¦ã€‚åŒæ ·é‡è¦çš„æ˜¯ï¼Œåœ¨ä»£ç å®¡æŸ¥æœŸé—´ä¹Ÿè¦åº”ç”¨å®‰å…¨ç¼–ç å®è·µã€‚ä½†è¿™è¿˜ä¸å¤Ÿï¼æ‚¨åº”è¯¥ä½¿ç”¨å®‰å…¨çš„åº“å’Œæ¡†æ¶ã€‚æ¢å¥è¯è¯´ï¼Œç¡®ä¿æ‚¨çš„æ¡†æ¶å’Œåº“ä»ç„¶å—åˆ°æ”¯æŒå¹¶æ¥æ”¶å®‰å…¨æ›´æ–°ã€‚ç”±äºæˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨.NET
    8ï¼Œæˆ‘ä»¬çŸ¥é“å®ƒä»ç„¶å—åˆ°æ”¯æŒï¼ˆå¹¶ä¸”å°†æ¥æ”¶å®‰å…¨æ›´æ–°ï¼‰ç›´åˆ°2026å¹´11æœˆ10æ—¥ï¼ˆæˆ‘åœ¨2024å¹´11æœˆå†™ä¸‹è¿™äº›ï¼‰ã€‚éšç€æ¡†æ¶æˆ–åº“å˜å¾—ä¸å†å—æ”¯æŒï¼Œé‡è¦çš„æ˜¯è¦è®¡åˆ’è¿ç§»åˆ°è¾ƒæ–°ç‰ˆæœ¬ï¼ˆé¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œä¸ä¸€å®šæ˜¯æœ€æ–°çš„ç‰ˆæœ¬
    ğŸ˜‰ï¼‰ã€‚'
- en: Suppose our application communicates with external dependencies, such as web
    services. In that case, we have to ensure that these communications happen in
    a secure manner (by leveraging authentication and authorization) and using the
    appropriate protocols (such as HTTPS).
  id: totrans-17
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: å‡è®¾æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸å¤–éƒ¨ä¾èµ–é¡¹è¿›è¡Œé€šä¿¡ï¼Œä¾‹å¦‚WebæœåŠ¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿è¿™äº›é€šä¿¡ä»¥å®‰å…¨çš„æ–¹å¼è¿›è¡Œï¼ˆé€šè¿‡åˆ©ç”¨èº«ä»½éªŒè¯å’Œæˆæƒï¼‰å¹¶ä½¿ç”¨é€‚å½“çš„åè®®ï¼ˆä¾‹å¦‚HTTPSï¼‰ã€‚
- en: '**In the infrastructure configuration phase**: All efforts to enhance the applicationâ€™s
    security could be in vain if the infrastructure on which it is running is unsecured.
    In the case of CLI applications, which run on the userâ€™s computer, this responsibility
    is delegated to them or their organizationâ€™s IT department, which usually controls
    employeesâ€™ workstations.'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**åœ¨åŸºç¡€è®¾æ–½é…ç½®é˜¶æ®µ**ï¼šå¦‚æœåº”ç”¨ç¨‹åºè¿è¡Œçš„åŸºç¡€è®¾æ–½ä¸å®‰å…¨ï¼Œé‚£ä¹ˆæ‰€æœ‰æé«˜åº”ç”¨ç¨‹åºå®‰å…¨æ€§çš„åŠªåŠ›éƒ½å¯èƒ½å¾’åŠ³ã€‚åœ¨CLIåº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹ï¼Œè¿™äº›åº”ç”¨ç¨‹åºåœ¨ç”¨æˆ·çš„è®¡ç®—æœºä¸Šè¿è¡Œï¼Œè´£ä»»é€šå¸¸å§”æ‰˜ç»™ç”¨æˆ·æˆ–å…¶ç»„ç»‡çš„ITéƒ¨é—¨ï¼Œè¯¥éƒ¨é—¨é€šå¸¸æ§åˆ¶å‘˜å·¥çš„å·¥ä½œç«™ã€‚'
- en: '**In the testing phase**: Security-specific testing, including penetration
    testing and vulnerability assessments, should be performed during the testing
    phase to ensure user data cannot leak, user accounts cannot be compromised, and
    the application cannot be diverted from its intended usage toward malicious activities.
    Performing security testing allows us to validate that security requirements are
    met. Mature DevSecOps teams perform such testing on a regular basis. However,
    security tests should at least be performed before releasing an application to
    production.'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**åœ¨æµ‹è¯•é˜¶æ®µ**ï¼šåœ¨æµ‹è¯•é˜¶æ®µåº”è¿›è¡Œç‰¹å®šäºå®‰å…¨çš„æµ‹è¯•ï¼ŒåŒ…æ‹¬æ¸—é€æµ‹è¯•å’Œæ¼æ´è¯„ä¼°ï¼Œä»¥ç¡®ä¿ç”¨æˆ·æ•°æ®ä¸ä¼šæ³„éœ²ï¼Œç”¨æˆ·è´¦æˆ·ä¸ä¼šè¢«ç ´åï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºä¸ä¼šè¢«ç”¨äºæ¶æ„æ´»åŠ¨ã€‚æ‰§è¡Œå®‰å…¨æµ‹è¯•å¯ä»¥è®©æˆ‘ä»¬éªŒè¯æ˜¯å¦æ»¡è¶³å®‰å…¨è¦æ±‚ã€‚æˆç†Ÿçš„å®‰å…¨å¼€å‘è¿è¥ï¼ˆDevSecOpsï¼‰å›¢é˜Ÿä¼šå®šæœŸè¿›è¡Œæ­¤ç±»æµ‹è¯•ã€‚ç„¶è€Œï¼Œå®‰å…¨æµ‹è¯•è‡³å°‘åº”åœ¨å°†åº”ç”¨ç¨‹åºå‘å¸ƒåˆ°ç”Ÿäº§ä¹‹å‰è¿›è¡Œã€‚'
- en: '**In the deployment phase**: Every DevSecOps engineer knows that your CI/CD
    pipelines can be a security threat if not properly secured. Secrets (such as passwords,
    API keys, service connections, connection strings, and so on) should be keptâ€¦
    well, secret. Every CI/CD tool has its own secret management mechanism, which
    usually takes the form of a key vault, but we can also rely on external tools
    that are designed for such purposes, such as Azure Key Vault or HashiCorp Vault.
    Access to these secrets is usually restricted using roles and permissions.'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**åœ¨éƒ¨ç½²é˜¶æ®µ**ï¼šæ¯ä¸ª DevSecOps å·¥ç¨‹å¸ˆéƒ½çŸ¥é“ï¼Œå¦‚æœä½ çš„ CI/CD ç®¡é“æ²¡æœ‰å¾—åˆ°é€‚å½“çš„å®‰å…¨ä¿æŠ¤ï¼Œå®ƒå¯èƒ½æˆä¸ºå®‰å…¨å¨èƒã€‚ç§˜å¯†ï¼ˆå¦‚å¯†ç ã€API
    å¯†é’¥ã€æœåŠ¡è¿æ¥ã€è¿æ¥å­—ç¬¦ä¸²ç­‰ï¼‰åº”è¯¥ä¿å¯†ã€‚æ¯ä¸ª CI/CD å·¥å…·éƒ½æœ‰è‡ªå·±çš„ç§˜å¯†ç®¡ç†æœºåˆ¶ï¼Œè¿™é€šå¸¸ä»¥å¯†é’¥åº“çš„å½¢å¼å‡ºç°ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¾èµ–ä¸ºè¿™äº›ç›®çš„è®¾è®¡çš„å·¥å…·ï¼Œå¦‚ Azure
    Key Vault æˆ– HashiCorp Vaultã€‚å¯¹è¿™äº›ç§˜å¯†çš„è®¿é—®é€šå¸¸é€šè¿‡è§’è‰²å’Œæƒé™è¿›è¡Œé™åˆ¶ã€‚'
- en: '**While the application is being used**: It is a common mistake for immature
    teams and organizations to believe that once the application has been released
    to production, the job of security is done. Wrong! This is where it all starts.
    You may argue that we put a lot of effort into securing the application before
    releasing it to our users, and you would be right. However, by releasing our application
    into the wild, it will experience a wide range of usage patterns and user environments,
    way beyond what we could have expected, thought of, and planned for. We will hence
    have to monitor for security incidents and anomalies, by implementing logging
    and auditing mechanisms and by regularly updating and patching the application
    and its dependencies.'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**åœ¨åº”ç”¨ç¨‹åºä½¿ç”¨æœŸé—´**ï¼šå¯¹äºä¸æˆç†Ÿçš„å°ç»„å’Œç»„ç»‡æ¥è¯´ï¼Œè®¤ä¸ºä¸€æ—¦åº”ç”¨ç¨‹åºå‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒï¼Œå®‰å…¨å·¥ä½œå°±å®Œæˆäº†ï¼Œè¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„é”™è¯¯ã€‚é”™è¯¯ï¼è¿™æ­£æ˜¯ä¸€åˆ‡å¼€å§‹çš„åœ°æ–¹ã€‚ä½ å¯èƒ½è®¤ä¸ºæˆ‘ä»¬åœ¨å‘å¸ƒç»™ç”¨æˆ·ä¹‹å‰æŠ•å…¥äº†å¤§é‡ç²¾åŠ›æ¥ç¡®ä¿åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ï¼Œä½ æ˜¯å¯¹çš„ã€‚ç„¶è€Œï¼Œé€šè¿‡å°†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå‘å¸ƒåˆ°é‡å¤–ï¼Œå®ƒå°†ç»å†å„ç§ä½¿ç”¨æ¨¡å¼å’Œç”¨æˆ·ç¯å¢ƒï¼Œè¿œè¿œè¶…å‡ºæˆ‘ä»¬æ‰€èƒ½é¢„æœŸçš„ã€è€ƒè™‘çš„å’Œè®¡åˆ’çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡å®æ–½æ—¥å¿—è®°å½•å’Œå®¡è®¡æœºåˆ¶ï¼Œå¹¶å®šæœŸæ›´æ–°å’Œä¿®è¡¥åº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–é¡¹ï¼Œæ¥ç›‘æ§å®‰å…¨äº‹ä»¶å’Œå¼‚å¸¸ã€‚'
- en: '`Destructure.ByMaskingProperties` method and pass a list of properties to be
    ignored when logging.'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Destructure.ByMaskingProperties` æ–¹æ³•ç”¨äºåœ¨è®°å½•æ—¥å¿—æ—¶å¿½ç•¥ä¸€ç³»åˆ—å±æ€§ã€‚'
- en: '**As new versions or bug fixes are released**: Either when introducing new
    functionalities or fixing bugs, it is important to conduct a security impact analysis
    for the introduced changes. This can be done by performing regression testing
    to ensure existing security controls are still met and no vulnerability has been
    introduced.'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**éšç€æ–°ç‰ˆæœ¬æˆ–é”™è¯¯ä¿®å¤çš„å‘å¸ƒ**ï¼šæ— è®ºæ˜¯å¼•å…¥æ–°åŠŸèƒ½è¿˜æ˜¯ä¿®å¤é”™è¯¯ï¼Œå¯¹å¼•å…¥çš„æ›´æ”¹è¿›è¡Œå®‰å…¨å½±å“åˆ†æéƒ½æ˜¯éå¸¸é‡è¦çš„ã€‚è¿™å¯ä»¥é€šè¿‡æ‰§è¡Œå›å½’æµ‹è¯•æ¥å®Œæˆï¼Œä»¥ç¡®ä¿ç°æœ‰çš„å®‰å…¨æ§åˆ¶ä»ç„¶æ»¡è¶³è¦æ±‚ï¼Œå¹¶ä¸”æ²¡æœ‰å¼•å…¥ä»»ä½•æ¼æ´ã€‚'
- en: Fortunately, there is a variety of tools to help at every stage. If your team
    or organization has adopted a DevSecOps culture, you will already be aware of
    many of these tools.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: å¹¸è¿çš„æ˜¯ï¼Œæœ‰å„ç§å„æ ·çš„å·¥å…·å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆæ¯ä¸ªé˜¶æ®µã€‚å¦‚æœä½ çš„å›¢é˜Ÿæˆ–ç»„ç»‡å·²ç»é‡‡ç”¨äº† DevSecOps æ–‡åŒ–ï¼Œä½ å°†å·²ç»äº†è§£å…¶ä¸­è®¸å¤šå·¥å…·ã€‚
- en: DevSecOps being way beyond the scope of this book, we will not be discussing
    the broad spectrum of tools you may use at every step. However, I do want to cover
    tools that will help us assess and enhance the security posture of a CLI application.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: ç”±äº DevSecOps è¶…å‡ºäº†æœ¬ä¹¦çš„èŒƒå›´ï¼Œæˆ‘ä»¬ä¸ä¼šè®¨è®ºä½ å¯èƒ½åœ¨æ¯ä¸€æ­¥ä½¿ç”¨çš„å·¥å…·çš„å¹¿æ³›èŒƒå›´ã€‚ç„¶è€Œï¼Œæˆ‘æƒ³ä»‹ç»ä¸€äº›å¯ä»¥å¸®åŠ©æˆ‘ä»¬è¯„ä¼°å’Œå¢å¼º CLI åº”ç”¨ç¨‹åºå®‰å…¨çŠ¶æ€çš„å·¥å…·ã€‚
- en: Assessing the security posture of a CLI application
  id: totrans-26
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: è¯„ä¼° CLI åº”ç”¨ç¨‹åºçš„å®‰å…¨çŠ¶æ€
- en: 'There are multiple tools that help assess the security posture of an application
    (including a CLI application). Among the most widely used ones, we find the following:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: æœ‰å¤šç§å·¥å…·å¯ä»¥å¸®åŠ©è¯„ä¼°åº”ç”¨ç¨‹åºçš„å®‰å…¨çŠ¶æ€ï¼ˆåŒ…æ‹¬ CLI åº”ç”¨ç¨‹åºï¼‰ã€‚åœ¨å¹¿æ³›ä½¿ç”¨çš„å·¥å…·ä¸­ï¼Œæˆ‘ä»¬å‘ç°ä»¥ä¸‹å·¥å…·ï¼š
- en: '`.csproj` files to detect vulnerabilities in third-party libraries.'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä½¿ç”¨ `.csproj` æ–‡ä»¶æ¥æ£€æµ‹ç¬¬ä¸‰æ–¹åº“ä¸­çš„æ¼æ´ã€‚
- en: '**Snyk**: This popular tool offers vulnerability reporting and scanning for
    .NET projects. It can be integrated into local development environments as well
    as into CI/CD pipelines for continuous monitoring.'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Snyk**ï¼šè¿™ä¸ªæµè¡Œçš„å·¥å…·ä¸º .NET é¡¹ç›®æä¾›æ¼æ´æŠ¥å‘Šå’Œæ‰«æã€‚å®ƒå¯ä»¥é›†æˆåˆ°æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­ï¼Œä¹Ÿå¯ä»¥é›†æˆåˆ° CI/CD ç®¡é“ä¸­è¿›è¡ŒæŒç»­ç›‘æ§ã€‚'
- en: '**Mend Bolt**: Previously known as **WhiteSource Bolt**, this security scanning
    tool integrates with **Azure DevOps** or **GitHub** pipelines, scanning .NET projects
    for open source vulnerabilities and generating detailed reports.'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Mend Bolt**ï¼šä¹‹å‰è¢«ç§°ä¸º **WhiteSource Bolt**ï¼Œè¿™æ˜¯ä¸€æ¬¾å®‰å…¨æ‰«æå·¥å…·ï¼Œå¯ä»¥ä¸ **Azure DevOps** æˆ–
    **GitHub** ç®¡é“é›†æˆï¼Œæ‰«æ .NET é¡¹ç›®ä¸­çš„å¼€æºæ¼æ´å¹¶ç”Ÿæˆè¯¦ç»†æŠ¥å‘Šã€‚'
- en: '**OWASP Dependency-Check**: This tool is effective for scanning third-party
    libraries and dependencies, which is crucial for .NET applications that often
    rely on external packages.'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**OWASP Dependency-Check**ï¼šè¿™ä¸ªå·¥å…·å¯¹äºæ‰«æç¬¬ä¸‰æ–¹åº“å’Œä¾èµ–é¡¹éå¸¸æœ‰æ•ˆï¼Œè¿™å¯¹äºç»å¸¸ä¾èµ–å¤–éƒ¨åŒ…çš„ .NET åº”ç”¨ç¨‹åºè‡³å…³é‡è¦ã€‚'
- en: '**GitHub Advanced Security**: This tool integrates security features directly
    into GitHub or Azure DevOps workflows, performs code scanning (it uses static
    analysis to detect potential security vulnerabilities and coding errors) and secret
    scanning (it recognizes patterns for passwords, API keys, and other secrets and
    detects whether they are stored in clear text in the repository), and performs
    dependency reviews and highlights vulnerable ones.'
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**GitHub Advanced Security**ï¼šè¿™ä¸ªå·¥å…·å°†å®‰å…¨åŠŸèƒ½ç›´æ¥é›†æˆåˆ° GitHub æˆ– Azure DevOps å·¥ä½œæµç¨‹ä¸­ï¼Œæ‰§è¡Œä»£ç æ‰«æï¼ˆå®ƒä½¿ç”¨é™æ€åˆ†ææ¥æ£€æµ‹æ½œåœ¨çš„å®‰å…¨æ¼æ´å’Œç¼–ç é”™è¯¯ï¼‰å’Œç§˜å¯†æ‰«æï¼ˆå®ƒè¯†åˆ«å¯†ç ã€API
    å¯†é’¥å’Œå…¶ä»–ç§˜å¯†çš„æ¨¡å¼ï¼Œå¹¶æ£€æµ‹å®ƒä»¬æ˜¯å¦ä»¥æ˜æ–‡å½¢å¼å­˜å‚¨åœ¨å­˜å‚¨åº“ä¸­ï¼‰ï¼Œå¹¶æ‰§è¡Œä¾èµ–é¡¹å®¡æŸ¥å¹¶çªå‡ºæ˜¾ç¤ºæ˜“å—æ”»å‡»çš„é¡¹ã€‚'
- en: These tools have in common that they inform us about the vulnerable library,
    and give us detailed information about the vulnerability itself and the recommended
    fix for it.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™äº›å·¥å…·çš„å…±åŒç‚¹æ˜¯å®ƒä»¬ä¼šå‘Šè¯‰æˆ‘ä»¬æ˜“å—æ”»å‡»çš„åº“ï¼Œå¹¶ä¸ºæˆ‘ä»¬æä¾›å…³äºæ¼æ´æœ¬èº«åŠå…¶æ¨èä¿®å¤çš„è¯¦ç»†ä¿¡æ¯ã€‚
- en: These tools are either free (such as Mend Bolt and OWASP Dependency-Check) or
    offer a free plan but with limited functionality (such as SonarQube, Snyk, and
    GitHub Advanced Security).
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™äº›å·¥å…·è¦ä¹ˆæ˜¯å…è´¹çš„ï¼ˆä¾‹å¦‚ Mend Bolt å’Œ OWASP Dependency-Checkï¼‰ï¼Œè¦ä¹ˆæä¾›å…è´¹è®¡åˆ’ä½†åŠŸèƒ½æœ‰é™ï¼ˆä¾‹å¦‚ SonarQubeã€Snyk
    å’Œ GitHub Advanced Securityï¼‰ã€‚
- en: They also vary in the level of complexity and effort required to set up and
    configure them. Hence, you will find SonarQube to be the most complex to set up,
    Snyk to be moderately easy to set up, and Mend Bolt, OWASP Dependency-Checker,
    and GitHub Advanced Security to be the easiest ones to set up.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: å®ƒä»¬åœ¨è®¾ç½®å’Œé…ç½®çš„å¤æ‚æ€§å’Œæ‰€éœ€åŠªåŠ›æ–¹é¢ä¹Ÿæœ‰æ‰€ä¸åŒã€‚å› æ­¤ï¼Œä½ ä¼šå‘ç° SonarQube è®¾ç½®æœ€å¤æ‚ï¼ŒSnyk è®¾ç½®ä¸­ç­‰å®¹æ˜“ï¼Œè€Œ Mend Boltã€OWASP
    Dependency-Checker å’Œ GitHub Advanced Security åˆ™æ˜¯æœ€å®¹æ˜“è®¾ç½®çš„ã€‚
- en: I would recommend Mend Bolt as a good starting point since it comes as an Azure
    DevOps or GitHub free extension that can be obtained from their respective marketplaces.
    For these reasons, these tools are usually intended for organizations or larger
    teams.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘å»ºè®®ä» Mend Bolt å¼€å§‹ï¼Œå› ä¸ºå®ƒä½œä¸º Azure DevOps æˆ– GitHub çš„å…è´¹æ‰©å±•æä¾›ï¼Œå¯ä»¥ä»å®ƒä»¬å„è‡ªçš„å¸‚åœºä¸­è·å¾—ã€‚å› æ­¤ï¼Œè¿™äº›å·¥å…·é€šå¸¸æ˜¯ä¸ºç»„ç»‡æˆ–å¤§å‹å›¢é˜Ÿè®¾è®¡çš„ã€‚
- en: However, the good news is that .NET already provides us with an out-of-the-box
    tool to serve this very purpose of assessing and enhancing the security posture
    of our application.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶è€Œï¼Œå¥½æ¶ˆæ¯æ˜¯ .NET å·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç°æˆçš„å·¥å…·æ¥è¯„ä¼°å’Œå¢å¼ºæˆ‘ä»¬åº”ç”¨ç¨‹åºçš„å®‰å…¨çŠ¶æ€ã€‚
- en: This tool, commonly known as dotnet-audit, focuses on detecting vulnerabilities
    in .NET project dependencies (namely, `NuGet` packages) by relying on the `GitHub
    Advisory Database`. For .NET-only projects, such as **Bookmarkr**, this tool is
    the perfect starting point!
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ªå·¥å…·é€šå¸¸è¢«ç§°ä¸º dotnet-auditï¼Œå®ƒé€šè¿‡ä¾èµ– `GitHub Advisory Database` æ¥æ£€æµ‹ .NET é¡¹ç›®ä¾èµ–é¡¹ï¼ˆç‰¹åˆ«æ˜¯ `NuGet`
    åŒ…ï¼‰ä¸­çš„æ¼æ´ã€‚å¯¹äºä»…ä½¿ç”¨ .NET çš„é¡¹ç›®ï¼Œä¾‹å¦‚ **Bookmarkr**ï¼Œè¿™ä¸ªå·¥å…·æ˜¯å®Œç¾çš„èµ·ç‚¹ï¼
- en: 'To execute this tool, we simply need to type the following command:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: è¦æ‰§è¡Œæ­¤å·¥å…·ï¼Œæˆ‘ä»¬åªéœ€è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š
- en: '[PRE0]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The results will be shown in the terminal window, and will look like this:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: ç»“æœå°†åœ¨ç»ˆç«¯çª—å£ä¸­æ˜¾ç¤ºï¼Œçœ‹èµ·æ¥åƒè¿™æ ·ï¼š
- en: '![Figure 13.1 â€“ Listing vulnerable packages](img/B22400_13_01.jpg)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![å›¾ 13.1 â€“ åˆ—å‡ºæ˜“å—æ”»å‡»çš„åŒ…](img/B22400_13_01.jpg)'
- en: Figure 13.1 â€“ Listing vulnerable packages
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ 13.1 â€“ åˆ—å‡ºæ˜“å—æ”»å‡»çš„åŒ…
- en: As you may have noticed in this figure, the command has not been executed on
    Bookmarkrâ€™s code but rather for another application. As it turns out, we are glad
    that no vulnerability has been detected for Bookmarkr (yeah!), but this might
    change over time as vulnerabilities in referenced libraries are detected.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æ‚¨åœ¨æ­¤å›¾ä¸­å¯èƒ½å·²ç»æ³¨æ„åˆ°çš„ï¼Œè¯¥å‘½ä»¤å¹¶æœªåœ¨Bookmarkrçš„ä»£ç ä¸Šæ‰§è¡Œï¼Œè€Œæ˜¯é’ˆå¯¹å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚ç»“æœè¯æ˜ï¼Œæˆ‘ä»¬å¯¹æ²¡æœ‰åœ¨Bookmarkrä¸­æ£€æµ‹åˆ°æ¼æ´æ„Ÿåˆ°é«˜å…´ï¼ˆæ˜¯çš„ï¼ï¼‰ï¼Œä½†éšç€æ—¶é—´çš„æ¨ç§»ï¼Œéšç€å¼•ç”¨åº“ä¸­æ¼æ´çš„å‘ç°ï¼Œè¿™å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚
- en: '![Figure 13.2 â€“ No vulnerable packages for Bookmarkr](img/B22400_13_02.jpg)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![å›¾13.2 â€“ Bookmarkræ²¡æœ‰æ˜“å—æ”»å‡»çš„åŒ…](img/B22400_13_02.jpg)'
- en: Figure 13.2 â€“ No vulnerable packages for Bookmarkr
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾13.2 â€“ Bookmarkræ²¡æœ‰æ˜“å—æ”»å‡»çš„åŒ…
- en: Keep in mind that this command may ask you to run `dotnet restore` before you
    can execute it. This is especially true if this is the first time you have cloned
    the Git repository.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·è®°ä½ï¼Œæ­¤å‘½ä»¤å¯èƒ½è¦æ±‚æ‚¨åœ¨æ‰§è¡Œä¹‹å‰è¿è¡Œ`dotnet restore`ã€‚å¦‚æœè¿™æ˜¯æ‚¨ç¬¬ä¸€æ¬¡å…‹éš†Gitä»“åº“ï¼Œè¿™å°¤å…¶æ­£ç¡®ã€‚
- en: There is another command that does not directly scan for vulnerabilities, but
    which I recommend. This command lists outdated packages. While these packages
    might not have known vulnerabilities, being outdated means that they will no longer
    receive security updates. My recommendation is that you consider upgrading these
    packages to newer supported versions (once again, not necessarily the latest version
    if this introduces breaking changes).
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: å¦æœ‰ä¸€ä¸ªå‘½ä»¤ä¸ä¼šç›´æ¥æ‰«ææ¼æ´ï¼Œä½†æˆ‘æ¨èä½¿ç”¨ã€‚æ­¤å‘½ä»¤åˆ—å‡ºè¿‡æ—¶çš„åŒ…ã€‚è™½ç„¶è¿™äº›åŒ…å¯èƒ½æ²¡æœ‰å·²çŸ¥çš„æ¼æ´ï¼Œä½†è¿‡æ—¶æ„å‘³ç€å®ƒä»¬å°†ä¸å†æ¥æ”¶å®‰å…¨æ›´æ–°ã€‚æˆ‘çš„å»ºè®®æ˜¯æ‚¨è€ƒè™‘å°†è¿™äº›åŒ…å‡çº§åˆ°è¾ƒæ–°çš„å—æ”¯æŒç‰ˆæœ¬ï¼ˆå†æ¬¡å¼ºè°ƒï¼Œå¦‚æœè¿™å¼•å…¥äº†ç ´åæ€§æ›´æ”¹ï¼Œåˆ™ä¸ä¸€å®šæ˜¯æœ€æ–°ç‰ˆæœ¬ï¼‰ã€‚
- en: 'To run this command, simply type the following:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: è¦è¿è¡Œæ­¤å‘½ä»¤ï¼Œåªéœ€é”®å…¥ä»¥ä¸‹å†…å®¹ï¼š
- en: '[PRE1]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'As you can see from the result of executing this command, although no vulnerability
    has been detected in Bookmarkrâ€™s dependencies, some of them are outdated:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æ‚¨ä»æ‰§è¡Œæ­¤å‘½ä»¤çš„ç»“æœä¸­å¯ä»¥çœ‹åˆ°ï¼Œå°½ç®¡åœ¨Bookmarkrçš„ä¾èµ–é¡¹ä¸­æ²¡æœ‰æ£€æµ‹åˆ°æ¼æ´ï¼Œä½†å…¶ä¸­ä¸€äº›å·²ç»è¿‡æ—¶ï¼š
- en: '![Figure 13.3 â€“ Listing outdated packages](img/B22400_13_03.jpg)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![å›¾13.3 â€“ åˆ—å‡ºè¿‡æ—¶çš„åŒ…](img/B22400_13_03.jpg)'
- en: Figure 13.3 â€“ Listing outdated packages
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾13.3 â€“ åˆ—å‡ºè¿‡æ—¶çš„åŒ…
- en: The appropriate way to upgrade these packages is to create a new branch, update
    the packages, test the application (both using manual and automated testing, as
    described in [*Chapter 10*](B22400_10.xhtml#_idTextAnchor155)) to ensure that
    the application still works as expected and that we did not introduce regressions,
    and finally, issue a pull request to merge the modifications into the `main` branch.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: å‡çº§è¿™äº›åŒ…çš„é€‚å½“æ–¹å¼æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼Œæ›´æ–°åŒ…ï¼Œæµ‹è¯•åº”ç”¨ç¨‹åºï¼ˆå¦‚[*ç¬¬10ç« *](B22400_10.xhtml#_idTextAnchor155)ä¸­æ‰€è¿°ï¼Œä½¿ç”¨æ‰‹åŠ¨å’Œè‡ªåŠ¨æµ‹è¯•ï¼‰ï¼Œä»¥ç¡®ä¿åº”ç”¨ç¨‹åºä»ç„¶æŒ‰é¢„æœŸå·¥ä½œï¼Œå¹¶ä¸”æˆ‘ä»¬æ²¡æœ‰å¼•å…¥å›å½’ï¼Œæœ€åï¼Œæäº¤ä¸€ä¸ªæ‹‰å–è¯·æ±‚ä»¥å°†ä¿®æ”¹åˆå¹¶åˆ°`main`åˆ†æ”¯ã€‚
- en: We now have the necessary knowledge and tools to assess, and ultimately enhance,
    the security posture of our CLI application. Letâ€™s focus our attention on securing
    communication between our CLI application and the external services it interacts
    with, to protect against unauthorized access and ensure proper user management.
    This can be achieved through authentication.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬ç°åœ¨æ‹¥æœ‰å¿…è¦çš„çŸ¥è¯†å’Œå·¥å…·æ¥è¯„ä¼°ï¼Œå¹¶æœ€ç»ˆå¢å¼ºæˆ‘ä»¬CLIåº”ç”¨ç¨‹åºçš„å®‰å…¨æ€åŠ¿ã€‚è®©æˆ‘ä»¬å°†æ³¨æ„åŠ›é›†ä¸­åœ¨ä¿æŠ¤æˆ‘ä»¬çš„CLIåº”ç”¨ç¨‹åºä¸å¤–éƒ¨æœåŠ¡ä¹‹é—´çš„é€šä¿¡ä¸Šï¼Œä»¥é˜²æ­¢æœªç»æˆæƒçš„è®¿é—®å¹¶ç¡®ä¿é€‚å½“çš„ç®¡ç†ç”¨æˆ·ã€‚è¿™å¯ä»¥é€šè¿‡èº«ä»½éªŒè¯æ¥å®ç°ã€‚
- en: Securing remote communications using authentication
  id: totrans-56
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä½¿ç”¨èº«ä»½éªŒè¯æ¥ä¿æŠ¤è¿œç¨‹é€šä¿¡
- en: In [*Chapter 9*](B22400_09.xhtml#_idTextAnchor136), we introduced the `sync`
    command, which allows Bookmarkr to back up local bookmarks to a remote location
    and retrieve them when needed. When doing so, the command also synchronizes local
    and remote bookmarks.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨[*ç¬¬9ç« *](B22400_09.xhtml#_idTextAnchor136)ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†`sync`å‘½ä»¤ï¼Œå®ƒå…è®¸Bookmarkrå°†æœ¬åœ°ä¹¦ç­¾å¤‡ä»½åˆ°è¿œç¨‹ä½ç½®ï¼Œå¹¶åœ¨éœ€è¦æ—¶æ£€ç´¢å®ƒä»¬ã€‚åœ¨æ‰§è¡Œæ­¤æ“ä½œæ—¶ï¼Œè¯¥å‘½ä»¤è¿˜ä¼šåŒæ­¥æœ¬åœ°å’Œè¿œç¨‹ä¹¦ç­¾ã€‚
- en: Until now, the communication between the local CLI application and the remote
    external service has happened in an insecure manner. This means that anyone who
    invokes the `sync` command may retrieve your personal bookmarks, which you clearly
    donâ€™t want, do you?
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæœ¬åœ°CLIåº”ç”¨ç¨‹åºä¸è¿œç¨‹å¤–éƒ¨æœåŠ¡ä¹‹é—´çš„é€šä¿¡ä¸€ç›´æ˜¯ä»¥ä¸å®‰å…¨çš„æ–¹å¼è¿›è¡Œã€‚è¿™æ„å‘³ç€ä»»ä½•è°ƒç”¨`sync`å‘½ä»¤çš„äººéƒ½å¯ä»¥æ£€ç´¢æ‚¨çš„ä¸ªäººä¹¦ç­¾ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯æ‚¨æƒ³è¦çš„ï¼Œå¯¹å§ï¼Ÿ
- en: To address this issue, we need to implement authentication.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å®ç°èº«ä»½éªŒè¯ã€‚
- en: Why is authentication important?
  id: totrans-60
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä¸ºä»€ä¹ˆèº«ä»½éªŒè¯å¾ˆé‡è¦ï¼Ÿ
- en: You may be wondering why authentication should be required in the context of
    CLI applications. After all, a CLI application runs on the userâ€™s computer, which
    already requires that user to authenticate to their session.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆåœ¨CLIåº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¸­éœ€è¦è®¤è¯ã€‚æ¯•ç«Ÿï¼ŒCLIåº”ç”¨ç¨‹åºæ˜¯åœ¨ç”¨æˆ·çš„è®¡ç®—æœºä¸Šè¿è¡Œçš„ï¼Œè¿™å·²ç»è¦æ±‚ç”¨æˆ·è®¤è¯åˆ°ä»–ä»¬çš„ä¼šè¯ã€‚
- en: In the context of CLI applications, authentication is usually required when
    communicating with external services (i.e., sending data to and retrieving data
    from these services). This ensures that users have access to their data at the
    remote location by proving who they are.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨CLIåº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œè®¤è¯é€šå¸¸åœ¨ä¸å¤–éƒ¨æœåŠ¡é€šä¿¡æ—¶ï¼ˆå³å‘è¿™äº›æœåŠ¡å‘é€æ•°æ®å¹¶ä»è¿™äº›æœåŠ¡æ£€ç´¢æ•°æ®ï¼‰æ˜¯å¿…éœ€çš„ã€‚è¿™ç¡®ä¿äº†ç”¨æˆ·é€šè¿‡è¯æ˜è‡ªå·±çš„èº«ä»½ï¼Œå¯ä»¥è®¿é—®è¿œç¨‹ä½ç½®çš„æ•°æ®ã€‚
- en: How to perform authentication
  id: totrans-63
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å¦‚ä½•è¿›è¡Œè®¤è¯
- en: Authentication can be achieved in many ways. One of the most common ones is
    for the external service provider to provide you with a **Personal Access Token**
    (**PAT**). You can usually get or generate such tokens by visiting the service
    providerâ€™s website and logging in to your account. From there, on your accountâ€™s
    settings page, you should be able to get that token or to generate a new one.
    Such tokens are usually valid for a given period of time and expire after that.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: è®¤è¯å¯ä»¥é€šè¿‡è®¸å¤šæ–¹å¼å®ç°ã€‚æœ€å¸¸è§çš„ä¸€ç§æ˜¯å¤–éƒ¨æœåŠ¡æä¾›å•†ä¸ºä½ æä¾›ä¸€ä¸ª**ä¸ªäººè®¿é—®ä»¤ç‰Œ**ï¼ˆ**PAT**ï¼‰ã€‚é€šå¸¸ï¼Œä½ å¯ä»¥é€šè¿‡è®¿é—®æœåŠ¡æä¾›å•†çš„ç½‘ç«™å¹¶ç™»å½•åˆ°ä½ çš„è´¦æˆ·æ¥è·å–æˆ–ç”Ÿæˆè¿™æ ·çš„ä»¤ç‰Œã€‚ä»é‚£é‡Œï¼Œåœ¨ä½ çš„è´¦æˆ·è®¾ç½®é¡µé¢ï¼Œä½ åº”è¯¥èƒ½å¤Ÿè·å–è¯¥ä»¤ç‰Œæˆ–ç”Ÿæˆä¸€ä¸ªæ–°çš„ä»¤ç‰Œã€‚è¿™æ ·çš„ä»¤ç‰Œé€šå¸¸åœ¨ç»™å®šçš„æ—¶é—´å†…æœ‰æ•ˆï¼Œå¹¶åœ¨ä¹‹åè¿‡æœŸã€‚
- en: 'Once you have this token, you can pass it as a parameter to a command that
    performs the call to the external service. An example of this would be the `sync`
    command, which could be invoked as follows:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€æ—¦ä½ æœ‰äº†è¿™ä¸ªä»¤ç‰Œï¼Œä½ å°±å¯ä»¥å°†å…¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ‰§è¡Œå¯¹å¤–éƒ¨æœåŠ¡è°ƒç”¨çš„å‘½ä»¤ã€‚ä¸€ä¸ªä¾‹å­å°±æ˜¯`sync`å‘½ä»¤ï¼Œå®ƒå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ–¹å¼è°ƒç”¨ï¼š
- en: '[PRE2]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Here, `YOUR_PAT` is most commonly a GUID value.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™é‡Œï¼Œ`YOUR_PAT`æœ€å¸¸è§çš„æ˜¯ä¸€ä¸ªGUIDå€¼ã€‚
- en: This call would then authenticate the user using the received PAT value before
    performing the sync operation.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ªè°ƒç”¨å°†ä½¿ç”¨æ¥æ”¶åˆ°çš„PATå€¼å¯¹ç”¨æˆ·è¿›è¡Œè®¤è¯ï¼Œç„¶åå†æ‰§è¡ŒåŒæ­¥æ“ä½œã€‚
- en: As you may have noticed, this approach could quickly become tedious as it is
    not easy to remember the value of a PAT. For this reason, CLI applications usually
    store such values either in a local configuration file, in an environment variable,
    or in the operating systemâ€™s key vault. This allows the user to invoke the command
    without always having to pass the PAT as a parameter. The command will be smart
    enough to look for it in the local configuration file or in the environment variable
    and use it if it is present. If it is not present, the command should display
    an error message asking the user to provide it. If the PAT is invalid or expired,
    the command should also be able to inform the user about that.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: æ­£å¦‚ä½ å¯èƒ½æ³¨æ„åˆ°çš„ï¼Œè¿™ç§æ–¹æ³•å¯èƒ½ä¼šå¾ˆå¿«å˜å¾—ç¹çï¼Œå› ä¸ºè®°ä½PATçš„å€¼å¹¶ä¸å®¹æ˜“ã€‚å› æ­¤ï¼ŒCLIåº”ç”¨ç¨‹åºé€šå¸¸ä¼šå°†è¿™æ ·çš„å€¼å­˜å‚¨åœ¨æœ¬åœ°é…ç½®æ–‡ä»¶ä¸­ã€ç¯å¢ƒå˜é‡ä¸­ï¼Œæˆ–è€…æ“ä½œç³»ç»Ÿçš„å¯†é’¥åº“ä¸­ã€‚è¿™ä½¿ç”¨æˆ·å¯ä»¥åœ¨ä¸æ€»æ˜¯éœ€è¦ä¼ é€’PATä½œä¸ºå‚æ•°çš„æƒ…å†µä¸‹è°ƒç”¨å‘½ä»¤ã€‚å‘½ä»¤å°†è¶³å¤Ÿæ™ºèƒ½ï¼Œèƒ½å¤Ÿåœ¨æœ¬åœ°é…ç½®æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡ä¸­æŸ¥æ‰¾å®ƒï¼Œå¹¶åœ¨å­˜åœ¨æ—¶ä½¿ç”¨å®ƒã€‚å¦‚æœä¸å­˜åœ¨ï¼Œå‘½ä»¤åº”æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ï¼Œæç¤ºç”¨æˆ·æä¾›å®ƒã€‚å¦‚æœPATæ— æ•ˆæˆ–å·²è¿‡æœŸï¼Œå‘½ä»¤è¿˜åº”èƒ½å¤Ÿé€šçŸ¥ç”¨æˆ·è¿™ä¸€ç‚¹ã€‚
- en: 'This is the approach adopted by GitHub â€“ for example: you create a PAT within
    your GitHub account, which you can use to authenticate and access GitHub resources
    from external services or applications. In our use case, the external service
    is the one that provides and manages the tokens, whereas the CLI application is
    only responsible for sending these tokens to the external service.'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ˜¯GitHubé‡‡ç”¨çš„æ–¹æ³•â€”â€”ä¾‹å¦‚ï¼šä½ å¯ä»¥åœ¨GitHubè´¦æˆ·å†…åˆ›å»ºä¸€ä¸ªä¸ªäººè®¿é—®ä»¤ç‰Œï¼ˆPATï¼‰ï¼Œç„¶åä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥ä»å¤–éƒ¨æœåŠ¡æˆ–åº”ç”¨ç¨‹åºä¸­è®¤è¯å’Œè®¿é—®GitHubèµ„æºã€‚åœ¨æˆ‘ä»¬çš„ç”¨ä¾‹ä¸­ï¼Œå¤–éƒ¨æœåŠ¡æ˜¯æä¾›å’Œç®¡ç†ä»¤ç‰Œçš„é‚£ä¸ªï¼Œè€ŒCLIåº”ç”¨ç¨‹åºåªè´Ÿè´£å°†è¿™äº›ä»¤ç‰Œå‘é€åˆ°å¤–éƒ¨æœåŠ¡ã€‚
- en: Another commonly used approach is to authenticate the user against an `auth`).
    Invoking this command usually triggers the default web browser and redirects the
    user to the application providerâ€™s login page. After successful authentication,
    the IdP provides access and an ID token that the CLI can use for subsequent requests
    to the external service. These tokens are, as for the PAT, usually included in
    the HTTP headers when performing the requests to the external service. This approach
    leverages the `OAuth 2.0` and the `OpenID` `Connect` protocols.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: å¦ä¸€ç§å¸¸ç”¨çš„æ–¹æ³•æ˜¯ä½¿ç”¨ `auth` å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚è°ƒç”¨æ­¤å‘½ä»¤é€šå¸¸ä¼šè§¦å‘é»˜è®¤ç½‘ç»œæµè§ˆå™¨å¹¶å°†ç”¨æˆ·é‡å®šå‘åˆ°åº”ç”¨ç¨‹åºæä¾›è€…çš„ç™»å½•é¡µé¢ã€‚èº«ä»½éªŒè¯æˆåŠŸåï¼Œèº«ä»½æä¾›è€…æä¾›è®¿é—®æƒé™å’Œä¸€ä¸ª
    ID ä»¤ç‰Œï¼ŒCLI å¯ä»¥ä½¿ç”¨è¯¥ä»¤ç‰Œè¿›è¡Œåç»­å¯¹å¤–éƒ¨æœåŠ¡çš„è¯·æ±‚ã€‚è¿™äº›ä»¤ç‰Œï¼Œå°±åƒ PAT ä¸€æ ·ï¼Œé€šå¸¸åœ¨å¯¹å¤–éƒ¨æœåŠ¡è¿›è¡Œè¯·æ±‚æ—¶åŒ…å«åœ¨ HTTP å¤´éƒ¨ä¸­ã€‚è¿™ç§æ–¹æ³•åˆ©ç”¨äº†
    `OAuth 2.0` å’Œ `OpenID Connect` åè®®ã€‚
- en: In the remainder of this chapter, we will explore how to implement authentication
    for Bookmarkr to secure communications with the **BookmarkrSyncr** external service.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬ç« çš„å‰©ä½™éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†æ¢è®¨å¦‚ä½•ä¸º Bookmarkr å®ç°èº«ä»½éªŒè¯ä»¥ä¿æŠ¤ä¸ **BookmarkrSyncr** å¤–éƒ¨æœåŠ¡çš„é€šä¿¡ã€‚
- en: Implementing authentication
  id: totrans-73
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å®ç°èº«ä»½éªŒè¯
- en: Here, we will leverage the PAT approach as it is more convenient and can work
    even in environments where no web browser can be launched, such as CI/CD pipelines.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†åˆ©ç”¨ PAT æ–¹æ³•ï¼Œå› ä¸ºå®ƒæ›´æ–¹ä¾¿ï¼Œç”šè‡³å¯ä»¥åœ¨æ— æ³•å¯åŠ¨ç½‘ç»œæµè§ˆå™¨çš„ç¯å¢ƒä¸­å·¥ä½œï¼Œä¾‹å¦‚ CI/CD ç®¡é“ã€‚
- en: 'To illustrate how this could be achieved, we will need to implement functionalities
    at two levels:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†è¯´æ˜å¦‚ä½•å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸¤ä¸ªçº§åˆ«ä¸Šå®ç°åŠŸèƒ½ï¼š
- en: '**BookmarkrSyncr**: The external service will receive the PAT, validate it,
    and authenticate the user if it is valid'
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**BookmarkrSyncr**ï¼šå¤–éƒ¨æœåŠ¡å°†æ¥æ”¶ PATï¼ŒéªŒè¯å®ƒï¼Œå¦‚æœæœ‰æ•ˆåˆ™å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯'
- en: '**Bookmarkr**: The responsibility of the CLI application is to pass the token
    to the external service and act according to the response it gets from the sent
    request'
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Bookmarkr**ï¼šCLI åº”ç”¨ç¨‹åºçš„è´£ä»»æ˜¯å°†ä»¤ç‰Œä¼ é€’ç»™å¤–éƒ¨æœåŠ¡å¹¶æ ¹æ®å‘é€çš„è¯·æ±‚çš„å“åº”é‡‡å–è¡ŒåŠ¨'
- en: Letâ€™s start by adding the required functionality into BookmarkrSyncr.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬ä»å°†æ‰€éœ€åŠŸèƒ½æ·»åŠ åˆ° BookmarkrSyncr å¼€å§‹ã€‚
- en: Authenticating external services using a PAT
  id: totrans-79
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä½¿ç”¨ PAT éªŒè¯å¤–éƒ¨æœåŠ¡
- en: 'To make things simple, we will assume that BookmarkrSyncr (the code for which
    can be found in the `AppendixB` folder) holds two PAT tokens: a valid one and
    an expired one. All other values that the user passes will be considered invalid
    and will be rejected for this reason.'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†ç®€åŒ–é—®é¢˜ï¼Œæˆ‘ä»¬å‡è®¾ BookmarkrSyncrï¼ˆå…¶ä»£ç å¯åœ¨ `AppendixB` æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°ï¼‰æŒæœ‰ä¸¤ä¸ª PAT ä»¤ç‰Œï¼šä¸€ä¸ªæœ‰æ•ˆçš„å’Œä¸€ä¸ªå·²è¿‡æœŸçš„ã€‚ç”¨æˆ·ä¼ é€’çš„æ‰€æœ‰å…¶ä»–å€¼éƒ½å°†è¢«è§†ä¸ºæ— æ•ˆï¼Œå¹¶å°†å› æ­¤è¢«æ‹’ç»ã€‚
- en: The token validation service will also be a very basic one.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: ä»¤ç‰ŒéªŒè¯æœåŠ¡ä¹Ÿå°†æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€çš„ã€‚
- en: 'While most of the code remains as it was, we had to make the following changes
    to the parameters we pass to the `MapPost` method:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: å°½ç®¡å¤§éƒ¨åˆ†ä»£ç ä¿æŒä¸å˜ï¼Œä½†æˆ‘ä»¬ä¸å¾—ä¸å¯¹ä¼ é€’ç»™ `MapPost` æ–¹æ³•çš„å‚æ•°è¿›è¡Œä»¥ä¸‹æ›´æ”¹ï¼š
- en: '[PRE3]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Letâ€™s explain these changes:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬æ¥è§£é‡Šè¿™äº›æ›´æ”¹ï¼š
- en: We indicate that the value of the PAT token comes from an HTTP header named
    `X-PAT` and that this value will be stored in the input parameter named `pat`.
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬æŒ‡å‡º PAT ä»¤ç‰Œçš„å€¼æ¥è‡ªåä¸º `X-PAT` çš„ HTTP å¤´éƒ¨ï¼Œå¹¶ä¸”è¯¥å€¼å°†å­˜å‚¨åœ¨åä¸º `pat` çš„è¾“å…¥å‚æ•°ä¸­ã€‚
- en: We pass a parameter of type `ITokenValidator`, which is a service we have created
    to retrieve and validate PAT tokens.
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬ä¼ é€’ä¸€ä¸ªç±»å‹ä¸º `ITokenValidator` çš„å‚æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªæˆ‘ä»¬åˆ›å»ºçš„æœåŠ¡ï¼Œç”¨äºæ£€ç´¢å’ŒéªŒè¯ PAT ä»¤ç‰Œã€‚
- en: We pass the current HTTP context that we will need to set HTTP headers for the
    HTTP response, especially to notify the client that the received PAT token is
    either invalid or expired. We use a different response header to ensure that the
    client knows exactly why the request was unauthorized, as this is good programming
    practice.
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬ä¼ é€’å½“å‰çš„ HTTP ä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬å°†éœ€è¦ä¸º HTTP å“åº”è®¾ç½® HTTP å¤´éƒ¨ï¼Œç‰¹åˆ«æ˜¯é€šçŸ¥å®¢æˆ·ç«¯æ”¶åˆ°çš„ PAT ä»¤ç‰Œæ˜¯æ— æ•ˆæˆ–å·²è¿‡æœŸçš„ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸åŒçš„å“åº”å¤´éƒ¨ä»¥ç¡®ä¿å®¢æˆ·ç«¯ç¡®åˆ‡åœ°çŸ¥é“è¯·æ±‚ä¸ºä½•æœªç»æˆæƒï¼Œå› ä¸ºè¿™æ˜¯ä¸€ç§è‰¯å¥½çš„ç¼–ç¨‹å®è·µã€‚
- en: 'We then invoke methods of the `TokenValidator` service to check whether the
    PAT token is invalid or expired, and if so, we set the appropriate HTTP header
    in the response object. The code looks like this:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨ `TokenValidator` æœåŠ¡çš„ç›¸å…³æ–¹æ³•æ¥æ£€æŸ¥ PAT ä»¤ç‰Œæ˜¯å¦æ— æ•ˆæˆ–å·²è¿‡æœŸï¼Œå¦‚æœæ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬åœ¨å“åº”å¯¹è±¡ä¸­è®¾ç½®é€‚å½“çš„ HTTP
    å¤´éƒ¨ã€‚ä»£ç å¦‚ä¸‹ï¼š
- en: '[PRE4]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Notice how we set the HTTP header. We use the indexer syntax. This will set
    the header. If the header already exists, it will replace the existing value with
    the new one.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨æ„æˆ‘ä»¬æ˜¯å¦‚ä½•è®¾ç½® HTTP å¤´éƒ¨çš„ã€‚æˆ‘ä»¬ä½¿ç”¨ç´¢å¼•å™¨è¯­æ³•ã€‚è¿™å°†è®¾ç½®å¤´éƒ¨ã€‚å¦‚æœå¤´éƒ¨å·²ç»å­˜åœ¨ï¼Œå®ƒå°†ç”¨æ–°å€¼æ›¿æ¢ç°æœ‰å€¼ã€‚
- en: 'The last thing we need to do is to register the `TokenValidator` service. This
    can be done for any service, using this widely known syntax:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬æœ€åéœ€è¦åšçš„æ˜¯æ³¨å†Œ `TokenValidator` æœåŠ¡ã€‚è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨è¿™ä¸ªå¹¿ä¸ºäººçŸ¥çš„è¯­æ³•ä¸ºä»»ä½•æœåŠ¡å®Œæˆï¼š
- en: '[PRE5]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'The `TokenValidator` service is very basic and its code looks as follows:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: '`TokenValidator` æœåŠ¡éå¸¸åŸºç¡€ï¼Œå…¶ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š'
- en: '[PRE6]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The only thing worth mentioning here is that we are simulating a token store
    (in the classâ€™s constructor). In a real-world scenario, we would have a persistent
    token store (such as a database). But for the purposes of this demonstration,
    storing these PAT tokens in memory makes the code easier to understand. I also
    want you to notice that, for the purpose of the demonstration, we have two tokens:
    one is a valid token, and the other represents an expired token. Any other value
    will be considered invalid since it cannot be found in the token store (which
    is realistic, by the way ğŸ˜‰). The client (the CLI application) will hence behave
    differently depending on the validity of the token.'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œæ¨¡æ‹Ÿäº†ä¸€ä¸ªä»¤ç‰Œå­˜å‚¨ï¼ˆåœ¨ç±»çš„æ„é€ å‡½æ•°ä¸­ï¼‰ã€‚åœ¨ç°å®ä¸–ç•Œçš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸€ä¸ªæŒä¹…çš„ä»¤ç‰Œå­˜å‚¨ï¼ˆä¾‹å¦‚æ•°æ®åº“ï¼‰ã€‚ä½†ä¸ºäº†æ¼”ç¤ºçš„ç›®çš„ï¼Œå°†è¿™äº›
    PAT ä»¤ç‰Œå­˜å‚¨åœ¨å†…å­˜ä¸­ä½¿å¾—ä»£ç æ›´å®¹æ˜“ç†è§£ã€‚æˆ‘è¿˜æƒ³è®©ä½ æ³¨æ„åˆ°ï¼Œä¸ºäº†æ¼”ç¤ºçš„ç›®çš„ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªä»¤ç‰Œï¼šä¸€ä¸ªæ˜¯æœ‰æ•ˆçš„ä»¤ç‰Œï¼Œå¦ä¸€ä¸ªä»£è¡¨å·²è¿‡æœŸçš„ä»¤ç‰Œã€‚ä»»ä½•å…¶ä»–å€¼éƒ½å°†è¢«è§†ä¸ºæ— æ•ˆï¼Œå› ä¸ºå®ƒæ— æ³•åœ¨ä»¤ç‰Œå­˜å‚¨ä¸­æ‰¾åˆ°ï¼ˆé¡ºä¾¿è¯´ä¸€å¥ï¼Œè¿™æ˜¯ç°å®çš„ï¼‰ã€‚å› æ­¤ï¼Œå®¢æˆ·ç«¯ï¼ˆCLI
    åº”ç”¨ç¨‹åºï¼‰å°†æ ¹æ®ä»¤ç‰Œçš„æœ‰æ•ˆæ€§è¡¨ç°å‡ºä¸åŒçš„è¡Œä¸ºã€‚
- en: Excellent! Now that we have our external service ready, itâ€™s time to update
    the client so that it can pass the PAT.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: å¤ªæ£’äº†ï¼ç°åœ¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†å¤–éƒ¨æœåŠ¡ï¼Œæ˜¯æ—¶å€™æ›´æ–°å®¢æˆ·ç«¯ï¼Œä½¿å…¶èƒ½å¤Ÿä¼ é€’ PATã€‚
- en: Passing the PAT from the CLI application to the external service
  id: totrans-97
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å°† PAT ä» CLI åº”ç”¨ç¨‹åºä¼ é€’åˆ°å¤–éƒ¨æœåŠ¡
- en: For this to happen, we will need to modify the code of both the `sync` command
    and the service agent.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ `sync` å‘½ä»¤å’ŒæœåŠ¡ä»£ç†çš„ä»£ç ã€‚
- en: 'More specifically, we will need to do the following:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: æ›´å…·ä½“åœ°è¯´ï¼Œæˆ‘ä»¬éœ€è¦åšä»¥ä¸‹äº‹æƒ…ï¼š
- en: Add a `--pat` parameter to the `sync` command.
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åœ¨ `sync` å‘½ä»¤ä¸­æ·»åŠ ä¸€ä¸ª `--pat` å‚æ•°ã€‚
- en: Modify the request that the HTTP client makes to the external service so that
    it sends the PAT token.
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ä¿®æ”¹ HTTP å®¢æˆ·ç«¯å¯¹å¤–éƒ¨æœåŠ¡å‘å‡ºçš„è¯·æ±‚ï¼Œä»¥ä¾¿å‘é€ PAT ä»¤ç‰Œã€‚
- en: Modify the code to store the PAT token in an environment variable and retrieve
    it from there if the `--pat` parameter is not specified when invoking the `sync`
    command.
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ä¿®æ”¹ä»£ç ä»¥å°† PAT ä»¤ç‰Œå­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­ï¼Œå¹¶åœ¨è°ƒç”¨ `sync` å‘½ä»¤æ—¶æœªæŒ‡å®š `--pat` å‚æ•°æ—¶ä»é‚£é‡Œæ£€ç´¢å®ƒã€‚
- en: Letâ€™s start with the first step.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬ä»ç¬¬ä¸€æ­¥å¼€å§‹ã€‚
- en: 'Letâ€™s go to the `SyncCommand.cs` file and, in the `Options` region, letâ€™s add
    an `Option` for the PAT as follows:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬è½¬åˆ° `SyncCommand.cs` æ–‡ä»¶ï¼Œåœ¨ `Options` åŒºåŸŸä¸­ï¼Œè®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªç”¨äº PAT çš„ `Option`ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE7]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: This `Option` is optional, as we mentioned earlier.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ï¼Œè¿™ä¸ª `Option` æ˜¯å¯é€‰çš„ã€‚
- en: 'Next, we need to make the command use this `Option`. For that matter, we need
    to add this instruction to the classâ€™s constructor:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦è®©å‘½ä»¤ä½¿ç”¨è¿™ä¸ª `Option`ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†æ­¤æŒ‡ä»¤æ·»åŠ åˆ°ç±»çš„æ„é€ å‡½æ•°ä¸­ï¼š
- en: '[PRE8]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Now, letâ€™s modify the commandâ€™s handler method so that the HTTP client can
    send the PAT to the BookmarkrSyncr service. For that matter, we need to modify
    the handler methodâ€™s signature to pass the PAT as a parameter, as follows:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä¿®æ”¹å‘½ä»¤çš„å¤„ç†æ–¹æ³•ï¼Œä»¥ä¾¿ HTTP å®¢æˆ·ç«¯å¯ä»¥å‘ BookmarkrSyncr æœåŠ¡å‘é€ PATã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹å¤„ç†æ–¹æ³•ç­¾åï¼Œå°† PAT
    ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE9]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Back to the classâ€™s constructor again, we need to modify the call to the `SetHandler`
    method to pass the PAT Option as a parameter. The modified method call looks like
    this:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: å†æ¬¡å›åˆ°ç±»çš„æ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹å¯¹ `SetHandler` æ–¹æ³•çš„è°ƒç”¨ï¼Œä»¥ä¾¿ä¼ é€’ PAT Option ä½œä¸ºå‚æ•°ã€‚ä¿®æ”¹åçš„æ–¹æ³•è°ƒç”¨å¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE10]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Next, we need to pass this token to the service agent. For that matter, we
    first need to modify the call to the service agent in the handler method, as follows:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å°†æ­¤ä»¤ç‰Œä¼ é€’ç»™æœåŠ¡ä»£ç†ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ä¿®æ”¹å¤„ç†æ–¹æ³•ä¸­å¯¹æœåŠ¡ä»£ç†çš„è°ƒç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE11]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Then, we need to update the code of the `BookmarkrSyncrServiceAgent` class to
    ensure the presence of the token before calling the external service.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–° `BookmarkrSyncrServiceAgent` ç±»çš„ä»£ç ï¼Œä»¥ç¡®ä¿åœ¨è°ƒç”¨å¤–éƒ¨æœåŠ¡ä¹‹å‰ä»¤ç‰Œçš„å­˜åœ¨ã€‚
- en: 'The first thing we need to do is, obviously, pass the PAT value as a parameter
    to its `Sync` method, as follows:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬é¦–å…ˆéœ€è¦åšçš„æ˜¯ï¼Œæ˜¾ç„¶åœ°ï¼Œå°† PAT å€¼ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ `Sync` æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE12]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'After that, the first thing the method should do is to ensure the presence
    of the PAT (i.e., ensure that we are not sending a null or an empty value to the
    external service). We do this by adding the following code at the beginning of
    the method:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: ä¹‹åï¼Œæ–¹æ³•åº”è¯¥åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ç¡®ä¿ PAT çš„å­˜åœ¨ï¼ˆå³ç¡®ä¿æˆ‘ä»¬æ²¡æœ‰å‘å¤–éƒ¨æœåŠ¡å‘é€ç©ºæˆ–ç©ºå€¼ï¼‰ã€‚æˆ‘ä»¬é€šè¿‡åœ¨æ–¹æ³•å¼€å¤´æ·»åŠ ä»¥ä¸‹ä»£ç æ¥å®ç°è¿™ä¸€ç‚¹ï¼š
- en: '[PRE13]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'A few things to note here:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™é‡Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š
- en: We do not validate the token, nor do we check whether it is expired. This is
    the role of the BookmarkrSyncr external service.
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬æ—¢ä¸éªŒè¯ä»¤ç‰Œï¼Œä¹Ÿä¸æ£€æŸ¥å®ƒæ˜¯å¦å·²è¿‡æœŸã€‚è¿™æ˜¯ BookmarkrSyncr å¤–éƒ¨æœåŠ¡çš„è§’è‰²ã€‚
- en: The environment variable that is used to hold the PAT token is named `BOOKMARKR_PAT`.
    This name ensures that this variable does not conflict with any other variable
    set on the userâ€™s computer.
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ç”¨äºå­˜å‚¨ PAT ä»¤ç‰Œçš„ç¯å¢ƒå˜é‡åä¸º `BOOKMARKR_PAT`ã€‚è¿™ä¸ªåå­—ç¡®ä¿è¿™ä¸ªå˜é‡ä¸ä¼šä¸ç”¨æˆ·è®¡ç®—æœºä¸Šè®¾ç½®çš„ä»»ä½•å…¶ä»–å˜é‡å†²çªã€‚
- en: We have created a custom exception class, `PatNotFoundException`, to inform
    the client in case the PAT token has not been found.
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰å¼‚å¸¸ç±» `PatNotFoundException`ï¼Œä»¥ä¾¿åœ¨æ‰¾ä¸åˆ° PAT ä»¤ç‰Œæ—¶é€šçŸ¥å®¢æˆ·ç«¯ã€‚
- en: 'Now, since the PAT token is retrieved, we need to send it to the external service.
    We hence need to modify the HTTP client to pass the token in the HTTP headers
    of the request, as follows:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œç”±äºå·²ç»æ£€ç´¢åˆ° PAT ä»¤ç‰Œï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶å‘é€åˆ°å¤–éƒ¨æœåŠ¡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ HTTP å®¢æˆ·ç«¯ï¼Œä»¥ä¾¿åœ¨è¯·æ±‚çš„ HTTP æ ‡å¤´ä¸­ä¼ é€’ä»¤ç‰Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE14]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'If the request to the external service is successful, we know that the PAT
    token is valid. We will then save it to the environment variable if it is not
    already present there. The updated code is therefore as follows:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœå¯¹å¤–éƒ¨æœåŠ¡çš„è¯·æ±‚æˆåŠŸï¼Œæˆ‘ä»¬çŸ¥é“ PAT ä»¤ç‰Œæ˜¯æœ‰æ•ˆçš„ã€‚å¦‚æœå®ƒå°šæœªå­˜åœ¨äºé‚£é‡Œï¼Œæˆ‘ä»¬å°†å°†å…¶ä¿å­˜åˆ°ç¯å¢ƒå˜é‡ä¸­ã€‚å› æ­¤ï¼Œæ›´æ–°çš„ä»£ç å¦‚ä¸‹ï¼š
- en: '[PRE15]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'However, if the PAT token is invalid or expired, we need to inform the client
    so that the proper error message is displayed to the user. We therefore need to
    modify the code block that handles the `Unauthorized` status code, as follows:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶è€Œï¼Œå¦‚æœ PAT ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸï¼Œæˆ‘ä»¬éœ€è¦é€šçŸ¥å®¢æˆ·ç«¯ï¼Œä»¥ä¾¿å‘ç”¨æˆ·æ˜¾ç¤ºé€‚å½“çš„é”™è¯¯æ¶ˆæ¯ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹å¤„ç† `Unauthorized` çŠ¶æ€ç çš„ä»£ç å—ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE16]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: This code is straightforward and easy to understand. One thing worth mentioning
    though is that here, again, we created custom exception classes, namely `PatInvalidException`
    and `PatExpiredException`, to clearly express the intent of an error when raising
    them. These exception classes can be found in the `Exceptions.cs` file located
    in the `BookmarkrSyncrServiceAgent` folder.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ®µä»£ç ç®€å•æ˜“æ‡‚ã€‚ä¸è¿‡ï¼Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œåˆåˆ›å»ºäº†è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼Œå³ `PatInvalidException` å’Œ `PatExpiredException`ï¼Œä»¥ä¾¿åœ¨æŠ›å‡ºå®ƒä»¬æ—¶æ¸…æ¥šåœ°è¡¨è¾¾é”™è¯¯æ„å›¾ã€‚è¿™äº›å¼‚å¸¸ç±»å¯ä»¥åœ¨
    `BookmarkrSyncrServiceAgent` æ–‡ä»¶å¤¹ä¸­çš„ `Exceptions.cs` æ–‡ä»¶ä¸­æ‰¾åˆ°ã€‚
- en: 'The last step is to go back to the `SyncCommand` class, handle the responses
    from the service agent, and display the appropriate error messages to the user.
    For that matter, we need to modify the code of the `OnSyncCommand` handler method
    to catch the custom exceptions described previoulsy. The `catch` blocks are as
    follows:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€åä¸€æ­¥æ˜¯å›åˆ° `SyncCommand` ç±»ï¼Œå¤„ç†æœåŠ¡ä»£ç†çš„å“åº”ï¼Œå¹¶å‘ç”¨æˆ·æ˜¾ç¤ºé€‚å½“çš„é”™è¯¯æ¶ˆæ¯ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ `OnSyncCommand` å¤„ç†æ–¹æ³•ä¸­çš„ä»£ç ï¼Œä»¥æ•è·ä¹‹å‰æè¿°çš„è‡ªå®šä¹‰å¼‚å¸¸ã€‚`catch`
    å—å¦‚ä¸‹ï¼š
- en: '[PRE17]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: And thatâ€™s it â€“ we have completed all the required code modifications for Bookmarkr
    to ensure secure communication with the external service, BookmarkrSyncr, by using
    a PAT (it was about time, right? ğŸ˜‰).
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: å°±è¿™æ · â€“ æˆ‘ä»¬å·²ç»å®Œæˆäº† Bookmarkr ä¸ºç¡®ä¿é€šè¿‡ PATï¼ˆit was about time, right? ğŸ˜‰ï¼‰ä¸å¤–éƒ¨æœåŠ¡ BookmarkrSyncr
    å®‰å…¨é€šä¿¡æ‰€éœ€çš„æ‰€æœ‰ä»£ç ä¿®æ”¹ã€‚
- en: Letâ€™s see if this works!
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬çœ‹çœ‹è¿™è¡Œä¸è¡Œï¼
- en: 'The first test is to invoke the `sync` command without passing a PAT token.
    Knowing that it will not be found in the `BOOKMARKR_PAT` environment variable,
    the following error is expected:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: ç¬¬ä¸€ä¸ªæµ‹è¯•æ˜¯ä¸ä¼ é€’ PAT ä»¤ç‰Œè°ƒç”¨ `sync` å‘½ä»¤ã€‚é‰´äºå®ƒä¸ä¼šåœ¨ `BOOKMARKR_PAT` ç¯å¢ƒå˜é‡ä¸­æ‰¾åˆ°ï¼Œæˆ‘ä»¬é¢„æœŸä¼šçœ‹åˆ°ä»¥ä¸‹é”™è¯¯ï¼š
- en: '![Figure 13.4 â€“ The PAT token was not found](img/B22400_13_04.jpg)'
  id: totrans-136
  prefs: []
  type: TYPE_IMG
  zh: '![å›¾ 13.4 â€“ æœªæ‰¾åˆ° PAT ä»¤ç‰Œ](img/B22400_13_04.jpg)'
- en: Figure 13.4 â€“ The PAT token was not found
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ 13.4 â€“ æœªæ‰¾åˆ° PAT ä»¤ç‰Œ
- en: 'The second test is to invoke the `sync` command with an invalid PAT token.
    Here too, an error message is expected:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: ç¬¬äºŒä¸ªæµ‹è¯•æ˜¯ä½¿ç”¨æ— æ•ˆçš„ PAT ä»¤ç‰Œè°ƒç”¨ `sync` å‘½ä»¤ã€‚è¿™é‡Œä¹Ÿé¢„æœŸä¼šçœ‹åˆ°ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯ï¼š
- en: '![Figure 13.5 â€“ The PAT token is invalid](img/B22400_13_05.jpg)'
  id: totrans-139
  prefs: []
  type: TYPE_IMG
  zh: '![å›¾ 13.5 â€“ PAT ä»¤ç‰Œæ— æ•ˆ](img/B22400_13_05.jpg)'
- en: Figure 13.5 â€“ The PAT token is invalid
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ 13.5 â€“ PAT ä»¤ç‰Œæ— æ•ˆ
- en: 'The next test is to invoke the `sync` command with an expired PAT token. Here
    too, an error message is expected:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸‹ä¸€ä¸ªæµ‹è¯•æ˜¯ä½¿ç”¨è¿‡æœŸçš„ PAT ä»¤ç‰Œè°ƒç”¨ `sync` å‘½ä»¤ã€‚è¿™é‡Œä¹Ÿé¢„æœŸä¼šçœ‹åˆ°ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯ï¼š
- en: '![Figure 13.6 â€“ The PAT token is expired](img/B22400_13_06.jpg)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![å›¾ 13.6 â€“ PAT ä»¤ç‰Œå·²è¿‡æœŸ](img/B22400_13_06.jpg)'
- en: Figure 13.6 â€“ The PAT token is expired
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ 13.6 â€“ PAT ä»¤ç‰Œå·²è¿‡æœŸ
- en: 'The final test is to invoke the `sync` command with a valid PAT token. We can
    see that the bookmarks have been synchronized and that the PAT token has been
    saved to the `BOOKMARKR_PAT` environment variable:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€åçš„æµ‹è¯•æ˜¯ä½¿ç”¨æœ‰æ•ˆçš„ PAT ä»¤ç‰Œè°ƒç”¨ `sync` å‘½ä»¤ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¹¦ç­¾å·²ç»åŒæ­¥ï¼Œå¹¶ä¸” PAT ä»¤ç‰Œå·²ä¿å­˜åˆ° `BOOKMARKR_PAT` ç¯å¢ƒå˜é‡ä¸­ï¼š
- en: '![Figure 13.7 â€“ The PAT token is valid](img/B22400_13_07.jpg)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![å›¾ 13.7 â€“ PAT ä»¤ç‰Œæœ‰æ•ˆ](img/B22400_13_07.jpg)'
- en: Figure 13.7 â€“ The PAT token is valid
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ 13.7 â€“ PAT ä»¤ç‰Œæœ‰æ•ˆ
- en: Wonderful! We now know all we need to know to assess and enhance the security
    of our CLI applications.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: å¤ªæ£’äº†ï¼æˆ‘ä»¬ç°åœ¨å·²ç»çŸ¥é“æ‰€æœ‰éœ€è¦äº†è§£çš„çŸ¥è¯†å’ŒæŠ€èƒ½æ¥è¯„ä¼°å’Œå¢å¼ºæˆ‘ä»¬çš„ CLI åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚
- en: Summary
  id: totrans-148
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: æ‘˜è¦
- en: In this chapter, we explored the various forms security can take, and we learned
    that it is not limited to the security of the applicationâ€™s code but rather covers
    a broad spectrum of areas that span its entire lifecycle. We learned what tools
    and techniques we can use to assess and enhance the security posture of our CLI
    application. We also learned how to secure access to user data, especially when
    dealing with external services, by implementing authentication and authorization.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬æ¢è®¨äº†å®‰å…¨å¯ä»¥é‡‡å–çš„å„ç§å½¢å¼ï¼Œå¹¶äº†è§£åˆ°å®ƒä¸ä»…é™äºåº”ç”¨ç¨‹åºä»£ç çš„å®‰å…¨æ€§ï¼Œè€Œæ˜¯æ¶µç›–äº†æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­çš„å¹¿æ³›é¢†åŸŸã€‚æˆ‘ä»¬å­¦ä¹ äº†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å“ªäº›å·¥å…·å’ŒæŠ€æœ¯æ¥è¯„ä¼°å’Œå¢å¼ºæˆ‘ä»¬çš„
    CLI åº”ç”¨ç¨‹åºçš„å®‰å…¨çŠ¶å†µã€‚æˆ‘ä»¬è¿˜å­¦ä¹ äº†å¦‚ä½•é€šè¿‡å®ç°èº«ä»½éªŒè¯å’Œæˆæƒæ¥ä¿æŠ¤ç”¨æˆ·æ•°æ®çš„è®¿é—®ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤–éƒ¨æœåŠ¡æ—¶ã€‚
- en: Congratulations! You have now all the necessary knowledge and skills to build,
    secure, test, package, and release your very own CLI applications to the world.
    Look at you â€“ what a milestone you have achieved. Take a moment to be proud of
    yourself and to celebrate!
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: æ­å–œï¼æ‚¨ç°åœ¨æ‹¥æœ‰äº†æ„å»ºã€å®‰å…¨ã€æµ‹è¯•ã€æ‰“åŒ…å’Œå‘å¸ƒæ‚¨è‡ªå·±çš„ CLI åº”ç”¨ç¨‹åºåˆ°ä¸–ç•Œä¸Šçš„æ‰€æœ‰å¿…è¦çŸ¥è¯†å’ŒæŠ€èƒ½ã€‚çœ‹çœ‹ä½ â€”â€”ä½ å–å¾—äº†å¤šä¹ˆå¤§çš„æˆå°±ã€‚èŠ±ç‚¹æ—¶é—´ä¸ºè‡ªå·±æ„Ÿåˆ°è‡ªè±ªï¼Œå¹¶åº†ç¥ä¸€ä¸‹ï¼
- en: My journey with you, throughout the pages of this book, is almost over. But
    before you turn the last page and gently close the cover of this book, there is
    one last thing I wanted to share with you, one final chapter whose purpose is
    to provide you with additional learning material to help you continue your journey
    as well as pointing you to some useful tools and libraries.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™æœ¬ä¹¦çš„æ¯ä¸€é¡µä¸Šï¼Œä¸æ‚¨çš„æ—…ç¨‹ä¸€èµ·ï¼Œæˆ‘çš„æ—…ç¨‹å‡ ä¹ç»“æŸäº†ã€‚ä½†åœ¨æ‚¨ç¿»åˆ°æœ€åä¸€é¡µå¹¶è½»è½»åˆä¸Šè¿™æœ¬ä¹¦çš„å°é¢ä¹‹å‰ï¼Œæˆ‘è¿˜æœ‰æœ€åä¸€ä»¶äº‹æƒ³ä¸æ‚¨åˆ†äº«ï¼Œé‚£å°±æ˜¯ä¸€ä¸ªæœ€åçš„ç« èŠ‚ï¼Œå…¶ç›®çš„æ˜¯ä¸ºæ‚¨æä¾›é¢å¤–çš„å­¦ä¹ ææ–™ï¼Œå¸®åŠ©æ‚¨ç»§ç»­æ‚¨çš„æ—…ç¨‹ï¼Œå¹¶æŒ‡å‘ä¸€äº›æœ‰ç”¨çš„å·¥å…·å’Œåº“ã€‚
- en: Your turn!
  id: totrans-152
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: è½®åˆ°ä½ äº†ï¼
- en: Following along with the provided code is a great way to learn through practice.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: æŒ‰ç…§æä¾›çš„ä»£ç è¿›è¡Œå®è·µæ˜¯å­¦ä¹ çš„å¥½æ–¹æ³•ã€‚
- en: A better way is by challenging yourself to achieve tasks. Hence, I challenge
    you to improve the Bookmarkr application by adding the following features.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: æ›´å¥½çš„æ–¹æ³•æ˜¯æŒ‘æˆ˜è‡ªå·±å®Œæˆä»»åŠ¡ã€‚å› æ­¤ï¼Œæˆ‘æŒ‘æˆ˜æ‚¨é€šè¿‡æ·»åŠ ä»¥ä¸‹åŠŸèƒ½æ¥æ”¹è¿› Bookmarkr åº”ç”¨ç¨‹åºã€‚
- en: 'Task #1 â€“ Update dependency versions'
  id: totrans-155
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 'ä»»åŠ¡ #1 â€“ æ›´æ–°ä¾èµ–é¡¹ç‰ˆæœ¬'
- en: We have seen how to list outdated packages that have reached their end of support
    and talked about the importance of updating these. However, I havenâ€™t updated
    these.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•åˆ—å‡ºå·²è¾¾åˆ°å…¶æ”¯æŒç»“æŸçš„è¿‡æ—¶åŒ…ï¼Œå¹¶è®¨è®ºäº†æ›´æ–°è¿™äº›åŒ…çš„é‡è¦æ€§ã€‚ç„¶è€Œï¼Œæˆ‘è¿˜æ²¡æœ‰æ›´æ–°è¿™äº›ã€‚
- en: Your task is to clone the code into your GitHub or Azure DevOps account and
    to update it.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨çš„ä»»åŠ¡æ˜¯å°†ä»£ç å…‹éš†åˆ°æ‚¨çš„ GitHub æˆ– Azure DevOps è´¦æˆ·ä¸­ï¼Œå¹¶æ›´æ–°å®ƒã€‚
- en: Once the dependencies have been updated, you will need to validate that the
    behavior of the application was not impacted, in other words, you need to ensure
    that the application still behaves as expected. This can be done by running the
    tests you developed earlier.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€æ—¦ä¾èµ–é¡¹å·²æ›´æ–°ï¼Œæ‚¨éœ€è¦éªŒè¯åº”ç”¨ç¨‹åºçš„è¡Œä¸ºæ˜¯å¦å—åˆ°å½±å“ï¼Œæ¢å¥è¯è¯´ï¼Œæ‚¨éœ€è¦ç¡®ä¿åº”ç”¨ç¨‹åºä»ç„¶æŒ‰é¢„æœŸè¿è¡Œã€‚è¿™å¯ä»¥é€šè¿‡è¿è¡Œæ‚¨ä¹‹å‰å¼€å‘çš„æµ‹è¯•æ¥å®Œæˆã€‚
- en: 'Task #2 â€“ Use Mend Bolt to scan the code for vulnerabilities'
  id: totrans-159
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 'ä»»åŠ¡ #2 â€“ ä½¿ç”¨ Mend Bolt æ‰«æä»£ç ä¸­çš„æ¼æ´'
- en: Your task is to clone the code into your GitHub or Azure DevOps account, enable
    Mend Bolt, and run a security scan. If any vulnerability is to be found, fix it!
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨çš„ä»»åŠ¡æ˜¯å°†ä»£ç å…‹éš†åˆ°æ‚¨çš„ GitHub æˆ– Azure DevOps è´¦æˆ·ä¸­ï¼Œå¯ç”¨ Mend Boltï¼Œå¹¶è¿è¡Œå®‰å…¨æ‰«æã€‚å¦‚æœå‘ç°ä»»ä½•æ¼æ´ï¼Œè¯·ä¿®å¤å®ƒï¼
- en: 'Task #3 â€“ Allow BookmarkrSyncr to manage multiple users'
  id: totrans-161
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 'ä»»åŠ¡ #3 â€“ å…è®¸ BookmarkrSyncr ç®¡ç†å¤šä¸ªç”¨æˆ·'
- en: Although we updated BookmarkrSyncr to receive and validate a PAT, it does not
    use this token to retrieve and update the appropriate userâ€™s data.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: å°½ç®¡æˆ‘ä»¬æ›´æ–°äº† BookmarkrSyncr ä»¥æ¥æ”¶å’ŒéªŒè¯ PATï¼Œä½†å®ƒå¹¶æ²¡æœ‰ä½¿ç”¨æ­¤ä»¤ç‰Œæ¥æ£€ç´¢å’Œæ›´æ–°é€‚å½“ç”¨æˆ·çš„æ•°æ®ã€‚
- en: You are tasked to update the code to make this happen. The easiest way to achieve
    this is to have a separate JSON file for every user whose name matches the value
    of the PAT. Hence, the bookmarks for every user can be stored and retrieved from
    there.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨çš„ä»»åŠ¡æ˜¯æ›´æ–°ä»£ç ä»¥å®ç°è¿™ä¸€ç‚¹ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä¸ºæ¯ä¸ªä¸ PAT å€¼åŒ¹é…åç§°çš„ç”¨æˆ·åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ JSON æ–‡ä»¶ã€‚å› æ­¤ï¼Œæ¯ä¸ªç”¨æˆ·çš„ä¹¦ç­¾éƒ½å¯ä»¥å­˜å‚¨å’Œæ£€ç´¢äºæ­¤ã€‚
