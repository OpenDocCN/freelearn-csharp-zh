<html><head></head><body><div><div><h1 id="_idParaDest-93"><em class="italic"><a id="_idTextAnchor092"/>Chapter 6</em>: Adding and Working with the ink-Unity Integration Plugin</h1>
			<p>This chapter begins with discussing how to add the <code>.ink</code>, and their compiled forms, <code>.json</code>, within a Unity project and its Project window. Then, we will review how to associate Inky with ink source files and use it to edit files directly from Unity. Finally, we will conclude by examining how to adjust the plugin's settings for a project.</p>
			<p>In this chapter, we are going to cover the following main topics:</p>
			<ul>
				<li>Adding the ink-Unity Integration plugin</li>
				<li>Working with ink files</li>
				<li>Adjusting plugin settings</li>
			</ul>
			<p>In this chapter, we will find, import, and work with the ink-Unity Integration plugin. This will allow us to work with ink files and adjust the plugin settings. We cannot work with ink files without the plugin, and the steps outlined in this chapter will help developers set up the package for later chapters focused on working with ink files and the Story API available after installing the plugin.</p>
			<p class="callout-heading">Note on Unity versions</p>
			<p class="callout">This chapter has been tested with <strong class="bold">Unity 2020.3 (LTS)</strong> and <strong class="bold">Unity 2021.1 (current)</strong>. This chapter also covers <em class="italic">version 1.0.2</em> of the <strong class="bold">ink-Unity Integration</strong> plugin. Inkle reports that <em class="italic">version 1.0.2</em> of the ink-Unity Integration plugin is compatible with <em class="italic">2018.4</em> and later versions of Unity, but only <em class="italic">2020.3 (LTS)</em> and <em class="italic">2021.1 (current)</em> are recommended.</p>
			<h1 id="_idParaDest-94"><a id="_idTextAnchor093"/>Technical requirements</h1>
			<p>The examples used in this chapter, in <code>*.ink</code> files, can be found online on GitHub: <a href="https://github.com/PacktPublishing/Dynamic-Story-Scripting-with-the-ink-Scripting-Language/tree/main/Chapter6">https://github.com/PacktPublishing/Dynamic-Story-Scripting-with-the-ink-Scripting-Language/tree/main/Chapter6</a>.</p>
			<h1 id="_idParaDest-95"><a id="_idTextAnchor094"/>Adding the ink-Unity Integration plugin</h1>
			<p>We cannot work with Ink<a id="_idIndexMarker208"/> files in Unity without a special package called the <strong class="bold">ink-Unity Integration</strong> plugin. Like other packages for Unity, it can only be added to an existing project and must be re-imported for any new project wanting to use its code and available API. In this topic, we will work through the steps required to find, import, and verify the plugin is ready for use in a project. Each section in this topic should be used with the same project<a id="_idIndexMarker209"/> as the first section, <em class="italic">Finding and importing the plugin</em>, beginning with instructions to create a new Unity project based on the 2D template.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The official name of the package is ink-Unity Integration. However, Inkle, the creators of ink, call this package a <em class="italic">plugin</em> in its own documentation. This book follows the same naming convention to avoid confusion.</p>
			<h2 id="_idParaDest-96"><a id="_idTextAnchor095"/>Finding and importing the plugin</h2>
			<p>The process for finding<a id="_idIndexMarker210"/> and importing the ink-Unity Integration plugin requires<a id="_idIndexMarker211"/> the following steps:</p>
			<ol>
				<li>Create a new Unity project using the built-in 2D template.<p class="callout-heading">Warning</p><p class="callout"><strong class="bold">Inkle</strong> does not recommend using the Unity Asset Store version of the ink-Unity Integration plugin because of the delays between updates. This book will use the installation method recommended by the developers of the plugin to get the most up-to-date version.</p></li>
				<li>Navigate to the <strong class="bold">OpenUPM</strong> page for the<a id="_idIndexMarker212"/> ink-Unity Integration plugin: <a href="https://openupm.com/packages/com.inklestudios.ink-unity-integration/">https://openupm.com/packages/com.inklestudios.ink-unity-integration/</a>.</li>
				<li>Click on the <strong class="bold">Get installer.unitypackage</strong> link on the right-hand side:<div><img src="img/Figure_6.1_B17597.jpg" alt="Figure 6.1 – OpenUPM page for the ink-Unity Integration plugin&#13;&#10;" width="495" height="317"/></div><p class="figure-caption">Figure 6.1 – OpenUPM page for the ink-Unity Integration plugin</p></li>
				<li>Clicking on the <strong class="bold">Get installer.unitypackage</strong> link will prompt a file download. Once the download<a id="_idIndexMarker213"/> finishes, find the local file and run<a id="_idIndexMarker214"/> the installer.</li>
				<li>Open the downloaded installer file while Unity is open. This will open the <strong class="bold">Import Unity Package</strong> window in Unity and load the contents of the installer file.<div><img src="img/Figure_6.2_B17597.jpg" alt="Figure 6.2 – Import Unity Package window showing ink-Unity Integration&#13;&#10;" width="362" height="385"/></div><p class="figure-caption">Figure 6.2 – Import Unity Package window showing ink-Unity Integration</p></li>
				<li>In the <strong class="bold">Import Unity Package</strong> window, click on <strong class="bold">All</strong> and then <strong class="bold">Import</strong>. This will guarantee all files<a id="_idIndexMarker215"/> are selected and imported. Once the importing<a id="_idIndexMarker216"/> is done, Unity will give a message that a new scoped registry has been added to the project.<div><img src="img/Figure_6.3_B17597.jpg" alt="Figure 6.3 – Importing a scoped registry window in Unity" width="574" height="185"/></div><p class="figure-caption">Figure 6.3 – Importing a scoped registry window in Unity</p></li>
				<li>Click the <strong class="bold">Close</strong> button to close the <strong class="bold">Importing a scoped registry</strong> window. Unity also opened the <strong class="bold">Project Settings</strong> window. This can be closed as well.</li>
			</ol>
			<p>As one final step, we will test that the package is installed and ready for use. In the next section, we will work with the <strong class="bold">Package Manager</strong> window.</p>
			<h2 id="_idParaDest-97"><a id="_idTextAnchor096"/>Verifying the package is installed</h2>
			<p>Depending on the version of Unity, other packages in use, or developer settings, it can sometimes be unclear whether the ink-Unity Integration<a id="_idIndexMarker217"/> package has been installed and is ready for use.</p>
			<p>To verify the plugin is enabled and ready, follow these steps:  </p>
			<ol>
				<li value="1">Open the <strong class="bold">Package Manager</strong> window by clicking on <strong class="bold">Window</strong> from the <strong class="bold">File</strong> menu and then click on <strong class="bold">Package Manager</strong>:<div><img src="img/Figure_6.4_B17597.jpg" alt="Figure 6.4 – Window menu with Package Manager selected in Unity&#13;&#10;" width="215" height="384"/></div><p class="figure-caption">Figure 6.4 – Window menu with Package Manager selected in Unity</p></li>
				<li>In the <strong class="bold">Package Manager</strong> window, click on the <strong class="bold">Packages</strong> drop-down menu and make sure <strong class="bold">In Project</strong> is selected:<div><img src="img/Figure_6.5_B17597.jpg" alt="Figure 6.5 – Package Manager with the In Project option selected&#13;&#10;" width="278" height="244"/></div><p class="figure-caption">Figure 6.5 – Package Manager with the In Project option selected</p></li>
				<li>The ink-Unity Integration plugin is ready for usage if it is included in a listing of packages currently in use with the project and has a green checkmark next to its name indicating it is installed in the current project.<div><img src="img/Figure_6.6_B17597.jpg" alt="Figure 6.6 – Package manager showing the ink Unity Integration package installed&#13;&#10;" width="549" height="139"/></div><p class="figure-caption">Figure 6.6 – Package manager showing the ink Unity Integration package installed</p></li>
				<li>After verifying that the ink Unity Integration package is installed, the <strong class="bold">Package Manager</strong> window can be closed.</li>
			</ol>
			<p>In the next section, we will<a id="_idIndexMarker218"/> move on to working with ink files. After installing the ink-Unity Integration Plugin, we will learn how to create ink files, edit them, and use the auto-compilation process built into the plugin.</p>
			<h1 id="_idParaDest-98"><a id="_idTextAnchor097"/>Working with ink files</h1>
			<p>Unity is only aware of files<a id="_idIndexMarker219"/> inside of the folders it watches. To work with other files, they must be added as new assets to an existing project. With the ink-Unity Integration plugin installed, Unity will watch all new files with the <code>.ink</code> file type and will automatically compile them for usage in Unity projects based on its <strong class="bold">Project Settings</strong>. However, the first step is to add these Ink source files to an existing Unity project using the plugin.</p>
			<h2 id="_idParaDest-99"><a id="_idTextAnchor098"/>Adding ink source files</h2>
			<p>Files created with Inky<a id="_idIndexMarker220"/> are saved with the <code>.ink</code> file type. These are <em class="italic">source</em> files for projects. They are the code form of Ink stories. To work with ink in Unity, the first step is to create a new <code>.ink</code> file.</p>
			<p>To create a new ink source file in Unity, open an existing project and make sure the <strong class="bold">Project</strong> window is open. (If not open, it can be re-opened using the <strong class="bold">Window</strong> menu by clicking on <strong class="bold">General</strong> and then <strong class="bold">Project</strong>.)</p>
			<p>There are often multiple ways of doing<a id="_idIndexMarker221"/> the same thing in Unity. This applies to creating new files in the <strong class="bold">Project</strong> window as well. One way to create new ink files is use the <strong class="bold">Project</strong> window's toolbar and the <strong class="bold">Create</strong> menu and then the <strong class="bold">Ink</strong> option. They can also be created by right-clicking in the <strong class="bold">Project</strong> window and going to the <strong class="bold">Create</strong> menu and then down to <strong class="bold">Ink</strong>:</p>
			<div><div><img src="img/Figure_6.7_B17597.jpg" alt="Figure 6.7 – Create menu in the Project window" width="278" height="460"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.7 – Create menu in the Project window</p>
			<p>The created Ink source file can either be renamed or the default name of <code>New</code> <code>Ink</code> can be accepted by clicking outside of its filename area. Moments after being created, the ink-Unity Integration plugin will generate a new file matching the name of the created one.</p>
			<div><div><img src="img/Figure_6.8_B17597.jpg" alt="Figure 6.8 – ink-Unity Integration plugin generated file in Unity Project view&#13;&#10;" width="240" height="177"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.8 – ink-Unity Integration plugin generated file in Unity Project view</p>
			<p class="callout-heading">Auto-compilation setting</p>
			<p class="callout">If Unity does<a id="_idIndexMarker222"/> not automatically generate a <code>.json</code> file based on the ink source file, the auto-compilation setting may be turned off. Consult the <em class="italic">Updating automatic re-compilation</em> section of the <em class="italic">Adjusting plugin settings</em> topic later in this chapter for how to change this setting.</p>
			<p>Clicking on the generated file will reveal it is a <code>.json</code> file. When ink runs a story, it runs what it calls a <code>.ink</code> file into a compiled <code>.json</code> file. </p>
			<p>With the ink-Unity Integration plugin<a id="_idIndexMarker224"/> installed, a new <code>.json</code> file will automatically be created for every existing <code>.ink</code> file. The plugin will also track changes and re-compile the project every time it detects new changes.</p>
			<h2 id="_idParaDest-100"><a id="_idTextAnchor099"/>Editing source files with Inky</h2>
			<p>ink source files are best edited using Inky. However, new ink source files are often added to a Unity project<a id="_idIndexMarker225"/> using its <code>.ink</code> files can be associated with Inky for editing when open within Unity.</p>
			<p>Depending on the operating system, the instructions are different. The next two sections contain the steps for <em class="italic">Windows (10 and later)</em> and <em class="italic">macOS (11.1 and later)</em>.</p>
			<h3>Windows: Associating Inky with ink source files</h3>
			<p>To start to associate<a id="_idIndexMarker227"/> Inky with all <code>.ink</code> files in Windows<a id="_idIndexMarker228"/> 10 and later, follow these steps: </p>
			<ol>
				<li value="1">Click on a created file in the <strong class="bold">Project</strong> window of Unity. This will open it in the <strong class="bold">Inspector</strong> view:<div><img src="img/Figure_6.9_B17597.jpg" alt="Figure 6.9 – Inspector view of an ink source file" width="572" height="299"/></div><p class="figure-caption">Figure 6.9 – Inspector view of an ink source file</p></li>
				<li>Click on <code>.ink</code> files.<div><img src="img/Figure_6.10_B17597.jpg" alt="Figure 6.10 – File association prompt in Windows 10" width="545" height="370"/></div><p class="figure-caption">Figure 6.10 – File association prompt in Windows 10</p></li>
				<li>Click on <strong class="bold">More apps</strong> and scroll<a id="_idIndexMarker229"/> to the bottom of<a id="_idIndexMarker230"/> the listing:<div><img src="img/Figure_6.11_B17597.jpg" alt="Figure 6.11 – Program listings in Windows 10&#13;&#10;" width="794" height="1041"/></div><p class="figure-caption">Figure 6.11 – Program listings in Windows 10</p></li>
				<li>Click on <code>Inky.exe</code> file is found and select it:<div><img src="img/Figure_6.12_B17597.jpg" alt="Figure 6.12 – Application chooser in Windows 10" width="1213" height="562"/></div><p class="figure-caption">Figure 6.12 – Application chooser in Windows 10</p></li>
				<li>Click <code>.ink</code> files. After a few moments, Windows will then<a id="_idIndexMarker231"/> open the <code>.ink</code> file found in the <strong class="bold">Project</strong> window<a id="_idIndexMarker232"/> of Unity in Inky. </li>
			</ol>
			<p>Moving forward, assuming the <code>Inky.exe</code> file is not deleted, Unity will redirect all file opening actions for <code>.ink</code> files to Inky.</p>
			<h3>macOS: Associating Inky with ink source files</h3>
			<p>To start to associate<a id="_idIndexMarker233"/> Inky with all <code>.ink</code> files in macOS (11.1 and later), follow<a id="_idIndexMarker234"/> these steps: </p>
			<ol>
				<li value="1">Right-click on a created file in the <strong class="bold">Project</strong> window of Unity. Click on <strong class="bold">Reveal in Finder</strong>:<div><img src="img/Figure_6.13_B17597.jpg" alt="Figure 6.13 – File context menu for Unity in macOS" width="278" height="449"/></div><p class="figure-caption">Figure 6.13 – File context menu for Unity in macOS</p></li>
				<li>After Finder<a id="_idIndexMarker235"/> opens, right-click on the file and navigate<a id="_idIndexMarker236"/> to <strong class="bold">Open With</strong>:<div><img src="img/Figure_6.14_B17597.jpg" alt="Figure 6.14 – Open With file context menu in macOS&#13;&#10;" width="511" height="198"/></div><p class="figure-caption">Figure 6.14 – Open With file context menu in macOS</p></li>
				<li>If <code>Inky.app</code> does not appear, click on <strong class="bold">Other…</strong>:<div><img src="img/Figure_6.15_B17597.jpg" alt="Figure 6.15 – Application chooser in macOS&#13;&#10;" width="1357" height="982"/></div><p class="figure-caption">Figure 6.15 – Application chooser in macOS</p></li>
				<li>Search for <code>Inky</code> in the <code>Inky.app</code> from the listing. Click on <strong class="bold">Open</strong>.</li>
			</ol>
			<p>Moving forward, assuming<a id="_idIndexMarker237"/> the <code>Inky.app</code> file is not deleted, Unity<a id="_idIndexMarker238"/> will redirect all file opening actions for <code>.ink</code> files to Inky.</p>
			<h2 id="_idParaDest-101"><a id="_idTextAnchor100"/>Updating ink source files</h2>
			<p>Once Inky has been<a id="_idIndexMarker239"/> associated with ink source files, editing the files becomes much easier. Double-clicking on the files in the <code>.json</code> files, this means both the source and compiled files will always be up to date.</p>
			<ol>
				<li value="1">To see this process in action, double-click on the created ink file from the <code>Adding Ink source files</code> section to open it in Inky.</li>
				<li>Change its contents to the following <code>Example 1</code>:<pre>Hello! This is an Ink source file!</pre></li>
				<li>Save the file in Inky by clicking on <code>.json</code> file. The <strong class="bold">Console</strong> window will also show when this process started and was completed.</p></li>
			</ol>
			<div><div><img src="img/Figure_6.16_B17597.jpg" alt="Figure 6.16 – Console window showing ink compilation messages&#13;&#10;" width="437" height="158"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.16 – Console window showing ink compilation messages</p>
			<p>With Inky associated with <code>.ink</code> files and the ink-Unity Integration plugin installed in a Unity project, new Ink source files<a id="_idIndexMarker240"/> can be added to a Unity project and then edited with Inky. Every time they are saved, the ink-Unity Integration plugin will re-compile them based on its <strong class="bold">Project Settings</strong>. Updating ink source files becomes as easy as adding them to a Unity project and then editing them in Inky.</p>
			<p>With the ink-Unity Integration plugin ready, we move ahead in the next section to examining its settings and how to update the auto-compilation functionality.</p>
			<h1 id="_idParaDest-102"><a id="_idTextAnchor101"/>Adjusting plugin settings</h1>
			<p>The ink-Unity Integration plugin<a id="_idIndexMarker241"/> comes with multiple settings that can be changed depending on the needs of the Unity project. This topic will review how to find the <strong class="bold">Project Settings</strong> window and update a common option – automatic re-compilation. </p>
			<h2 id="_idParaDest-103"><a id="_idTextAnchor102"/>Finding ink-Unity Integration settings</h2>
			<p>The Ink-Unity Integration<a id="_idIndexMarker242"/> plugin comes with default settings. These can be changed by editing them as part of <strong class="bold">Project Settings</strong>:</p>
			<ol>
				<li value="1">Click on Edit and then <strong class="bold">Project Settings</strong>:<div><img src="img/Figure_6.17_B17597.jpg" alt="Figure 6.17 – Edit menu with Project Settings… selected" width="558" height="1366"/></div><p class="figure-caption">Figure 6.17 – Edit menu with Project Settings… selected</p></li>
				<li>Click on <strong class="bold">Ink</strong> from the sidebar options to see the related settings for the project.</li>
			</ol>
			<div><div><img src="img/Figure_6.18_B17597.jpg" alt="Figure 6.18 – Ink Project Settings in Unity&#13;&#10;" width="1327" height="744"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.18 – Ink Project Settings in Unity</p>
			<p>In the next section, we will<a id="_idIndexMarker243"/> use the <strong class="bold">Project Settings</strong> window to update a common setting, the automatic re-compilation of ink source files.</p>
			<h2 id="_idParaDest-104"><a id="_idTextAnchor103"/>Updating automatic re-compilation</h2>
			<p>If a project has a large ink source file<a id="_idIndexMarker244"/> or many different smaller files each using the <code>INCLUDE</code> keyword in ink, the compilation process might take more than a few seconds each time files are changed. In these contexts, turning off the re-compilation of ink source files might prevent the ink-Unity Integration plugin from wasting time re-compiling the ink source files.</p>
			<ol>
				<li value="1">In the <strong class="bold">Project Settings</strong> window, click on <strong class="bold">Ink</strong>:<div><img src="img/Figure_6.19_B17597.jpg" alt="Figure 6.19 – Ink Project Settings in Unity&#13;&#10;" width="1462" height="759"/></div><p class="figure-caption">Figure 6.19 – Ink Project Settings in Unity</p></li>
				<li>Click on the checkbox next to <strong class="bold">Compile All Ink Automatically</strong> to disable the automatic compilation process. (This can be re-enabled by clicking on the checkbox again later.)</li>
			</ol>
			<p>In this topic, we examined the Ink <strong class="bold">Project Settings</strong> window and updated the auto-compilation option. Depending<a id="_idIndexMarker245"/> on the size of the ink source and other factors, the compilation process can sometimes take too long between changes. Updating the automatic compilation of ink sources files can often be a very useful setting to be aware of and update, depending on the project. </p>
			<h1 id="_idParaDest-105"><a id="_idTextAnchor104"/>Summary</h1>
			<p>In this chapter, we learned how to find the ink-Unity Integration plugin online as part of the first topic. We reviewed how to import the package and then verify it was installed. This is an important step for all projects using the plugin, as it must be re-imported for any new project.</p>
			<p>In the second topic, <em class="italic">Working with ink files</em>, we looked at how to create new ink files in Unity. We examined how to associate Inky with ink source files in both Windows 10 and macOS. We then learned how to edit ink files and how the ink-Unity Integration plugin will detect any changes and recreate the compiled JSON file if the option is enabled in the <strong class="bold">Project Settings</strong>.</p>
			<p>Finally, in the <em class="italic">Adjusting plugin settings</em> topic, we looked at the settings when using the ink-Unity Integration plugin. We first reviewed how to find the <strong class="bold">Project Settings</strong> for the plugin by selecting <strong class="bold">Ink</strong> from the available options. Next, we examined how to adjust the automatic re-compilation of ink files.</p>
			<p>In the next chapter, we'll move ahead to use the Ink API to work with a running story. The ink-Unity Integration plugin helps to generate the JSON files based on the ink source files. We will use the JSON files in the next chapter, and we will learn how to load parts of a story as part of a larger Unity project.</p>
			<h1 id="_idParaDest-106"><a id="_idTextAnchor105"/>Questions</h1>
			<ol>
				<li value="1">Does Inkle recommend using the Unity Asset Store?</li>
				<li>What is at least one way to create an ink file using the ink-Unity Integration plugin in Unity?</li>
				<li>What program is a good choice for editing ink files?</li>
				<li>Can the auto-compilation process of the ink-Unity Integration plugin be changed?</li>
			</ol>
		</div>
	</div></body></html>