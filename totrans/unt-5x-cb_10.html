<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch10"/>Chapter 10. Working with External Resource Files and Devices</h1></div></div></div><p>In this chapter, we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Loading external resource files – using Unity Default Resources</li><li class="listitem" style="list-style-type: disc">Loading external resource files – by downloading files from the Internet</li><li class="listitem" style="list-style-type: disc">Loading external resource files – by manually storing files in the Unity Resources folder</li><li class="listitem" style="list-style-type: disc">Saving and loading player data – using static properties</li><li class="listitem" style="list-style-type: disc">Saving and loading player data – using PlayerPrefs</li><li class="listitem" style="list-style-type: disc">Saving screenshots from the game</li><li class="listitem" style="list-style-type: disc">Setting up a leaderboard using PHP/MySQL</li><li class="listitem" style="list-style-type: disc">Loading game data from a text file map</li><li class="listitem" style="list-style-type: disc">Managing Unity project code using Git version control and GitHub hosting</li><li class="listitem" style="list-style-type: disc">Publishing for multiple devices via Unity Cloud</li></ul></div><div><div><div><div><h1 class="title"><a id="ch10lvl1sec96"/>Introduction</h1></div></div></div><p>For some projects, it works fine to <a class="indexterm" id="id1016"/>use the <strong>Inspector</strong> window to manually assign imported assets to the component slots, and then build and play the game with no further changes. However, there are also many times when external data of some kind can add flexibility and features to a game. For example, it might add updateable or user-editable content; it can allow memory of user preferences and achievements between scenes, and even game-playing sessions. Using code to read local or Internet file contents at runtime can help file organization and separation of tasks between game programmers and the content designers. Having an arsenal of different assets and long-term game memory techniques means providing a wide range of opportunities to deliver a rich experience to players and developers alike.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec285"/>The big picture</h2></div></div></div><p>Before getting on with the recipes, let's step back and have a quick review of the role of the asset files and the Unity game building and running process. The most straightforward way to work with assets is to import them into a Unity project, use the <strong>Inspector</strong> window to<a class="indexterm" id="id1017"/> assign the assets to the components in the <strong>Inspector</strong>, and then build and play the game.</p><div><img alt="The big picture" src="img/1362OT_10_01.jpg"/></div><p>Standalone executables offer another possible workflow, which is the adding of files into the <code class="literal">Resources</code> folder of the game after it has been built. This will support game media asset developers being able to provide the final version of assets after development and building has been completed.</p><p>However, another option is to use<a class="indexterm" id="id1018"/> the <code class="literal">WWW</code> class to dynamically read assets from the web at runtime; or perhaps, for communication with a high score or multiplayer server, and sending and receiving information and files.</p><div><img alt="The big picture" src="img/1362OT_10_02.jpg"/></div><p>When loading/saving<a class="indexterm" id="id1019"/> data either locally or via the web interface, it is important to keep in mind the data types that can be used. When writing C# code, our variables can be of any type permitted by the language, but when communicated by the web interface, or to a local <a class="indexterm" id="id1020"/>storage using Unity's <code class="literal">PlayerPrefs</code> class, we are restricted in the types of data that we can work with. Unity's <code class="literal">WWW</code> class permits three file types (text files, binary audio clips, and binary image textures), but, for example, for 2D UIs we sometimes need Sprite images and not Textures, so that we have provided in this chapter a C# method to create a Sprite from a Texture. When using the <code class="literal">PlayerPrefs</code> class, we are limited to saving and loading integers, floats, and strings. Similarly, when communicating with a web server using the URL encoded data, we are restricted to whatever we can place into strings (we include a PHP web-based high score recipe, where the user scores can be loaded and saved via such a method).</p><p>Finally, managing Unity project <a class="indexterm" id="id1021"/>source code with an online <strong>Distributed Version Control System</strong> (<strong>DVCS</strong>) like Git and GitHub opens up new workflows for the continuous integration of code updates to the working builds. Unity Cloud will <em>pull</em> the updated source code projects from your online repository, and then build the game for designated versions of Unity and the deployment devices. Developers will get e-mails to confirm the build success, or to list the reasons for any build failure. The final two recipes in this chapter show you how to manage your code with Git and GitHub, and<a class="indexterm" id="id1022"/> use Unity Cloud to build projects for <a class="indexterm" id="id1023"/>multiple <a class="indexterm" id="id1024"/>devices.</p><div><div><h3 class="title"><a id="note44"/>Note</h3><p>
<strong>Acknowledgement</strong>: Thanks<a class="indexterm" id="id1025"/> to the following<a class="indexterm" id="id1026"/> for <a class="indexterm" id="id1027"/>publishing <em>Creative Commons (BY 3.0)</em> licensed icons: <strong>Elegant Themes</strong>, <strong>Picol</strong>, <strong>Freepik</strong>, <strong>Yannick</strong>, <strong>Google</strong>, <a class="ulink" href="http://www.flaticon.com">www.flaticon.com</a>.</p></div></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec97"/>Loading external resource files – using Unity Default Resources</h1></div></div></div><p>In this recipe, we <a class="indexterm" id="id1028"/>will load an external image<a class="indexterm" id="id1029"/> file, and display it on the screen, using the <strong>Unity Default Resources</strong> file (a library created at the time the game was compiled).</p><div><div><h3 class="title"><a id="note45"/>Note</h3><p>This method is perhaps the simplest way to store and read the external resource files. However, it is only appropriate when the contents of the resource files will not change after compilation, since the contents of these files are combined and compiled into the <code class="literal">resources.assets</code> file.</p><p>The <code class="literal">resources.assets</code> file can be found in the <code class="literal">Data</code> folder for a compiled game.</p></div></div><div><img alt="Loading external resource files – using Unity Default Resources" src="img/1362OT_10_03.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec286"/>Getting ready</h2></div></div></div><p>In the <code class="literal">1362_10_01</code> folder, we have provided an image file, a text file, and an audio file in the <code class="literal">.ogg</code> format for this recipe:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">externalTexture.jpg</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">cities.txt</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">soundtrack.ogg</code></li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec287"/>How to do it...</h2></div></div></div><p>To load the<a class="indexterm" id="id1030"/> external resources by Unity Default Resources, do the following:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new <a class="indexterm" id="id1031"/>3D Unity project.</li><li class="listitem">In the <strong>Project</strong> window, create a new folder and rename it <code class="literal">Resources</code>.</li><li class="listitem">Import the <code class="literal">externalTexture.jpg</code> file and place it in the <code class="literal">Resources</code> folder.</li><li class="listitem">Create a 3D cube.</li><li class="listitem">Add the following C# Script to your cube:<div><pre class="programlisting">using UnityEngine;
using System.Collections;

public class ReadDefaultResources : MonoBehaviour {
  public string fileName = "externalTexture";
  private Texture2D externalImage;

  void Start () {
    externalImage = (Texture2D)Resources.Load(fileName);
    Renderer myRenderer = GetComponent&lt;Renderer&gt;();
    myRenderer.material.SetTexture("_MainTex", externalImage);
  }
}</pre></div></li><li class="listitem">Play the scene. The texture will be loaded and displayed on the screen.</li><li class="listitem">If you have another image file, put a copy into the <code class="literal">Resources</code> folder. Then, in the <strong>Inspector</strong> window, change the public file name to the name of your image file and play the scene again. The new image will now be displayed.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec288"/>How it works...</h2></div></div></div><p>The <code class="literal">Resources.Load(fileName)</code> statement makes Unity look inside its compiled project data file called <code class="literal">resources.assets</code> for the contents of a file named <code class="literal">externalTexture</code>. The contents are returned as a texture image, which is stored into the <code class="literal">externalImage</code> variable. The last statement in the <code class="literal">Start() </code>method sets the texture of the GameObject the script has been attached to our <code class="literal">externalImage</code> variable.</p><div><div><h3 class="title"><a id="note46"/>Note</h3><p>Note: The filename string passed to <code class="literal">Resources.Load()</code> does <em>not</em> include the file extension (such as <code class="literal">.jpg</code> or <code class="literal">.txt</code>).</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec289"/>There's more...</h2></div></div></div><p>There are some<a class="indexterm" id="id1032"/> details that you <a class="indexterm" id="id1033"/>don't want to miss.</p><div><div><div><div><h3 class="title"><a id="ch10lvl3sec74"/>Loading text files with this method</h3></div></div></div><p>You can load the <a class="indexterm" id="id1034"/>external text files using the same approach. The private variable needs to be a string (to store the text file contents). The <code class="literal">Start()</code> method uses a temporary <code class="literal">TextAsset</code> object to receive the text file contents, and the text property of this object contains the string contents that are to be stored in the private variable <code class="literal">textFileContents</code>:</p><div><pre class="programlisting">public class ReadDefaultResourcesText : MonoBehaviour {
  public string fileName = "textFileName";
  private string textFileContents;

  void Start () {
    TextAsset textAsset = (TextAsset)Resources.Load(fileName);
    textFileContents = textAsset.text;
    Debug.Log(textFileContents);
  }
}</pre></div><p>Finally, this string is displayed on the console.</p><div><img alt="Loading text files with this method" src="img/1362OT_10_04.jpg"/></div></div><div><div><div><div><h3 class="title"><a id="ch10lvl3sec75"/>Loading and playing audio files with this method</h3></div></div></div><p>You can load external <a class="indexterm" id="id1035"/>audio files using the<a class="indexterm" id="id1036"/> same approach. The private variable needs to be an <code class="literal">AudioClip</code>:</p><div><pre class="programlisting">using UnityEngine;
using System.Collections;

[RequireComponent (typeof (AudioSource))]
public class ReadDefaultResourcesAudio : MonoBehaviour {
  public string fileName = "soundtrack";
  private AudioClip audioFile;

  void  Start (){
    AudioSource audioSource = GetComponent&lt;AudioSource&gt;();
    audioSource.clip = (AudioClip)Resources.Load(fileName);
    if(!audioSource.isPlaying &amp;&amp; audioSource.clip.isReadyToPlay)
      audioSource.Play();
  }
}</pre></div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec290"/>See also</h2></div></div></div><p>Refer to the following recipes in this chapter for more information:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Loading external resource files – by manually storing files in Unity Resources folder</em></li><li class="listitem" style="list-style-type: disc"><em>Loading external resource files – by downloading files from the Internet</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec98"/>Loading external resource files – by downloading files from the Internet</h1></div></div></div><p>One way to store and read a text file data is to store the text files on the Web. In this recipe, the<a class="indexterm" id="id1037"/> contents of a text file for a given URL are downloaded, read, and then displayed.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec291"/>Getting ready</h2></div></div></div><p>For this recipe, you need to have access to the files on a web server. If you run a local web server such as <a class="indexterm" id="id1038"/><strong>Apache</strong>, or have your own web hosting, then you can use the files in the <code class="literal">1362_10_01</code> folder and the corresponding URL.</p><p>Otherwise, you may find the following URLs useful; since they are the web locations of an image file (a Packt Publishing logo) and a text file (an ASCII-art badger picture):</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://www.packtpub.com/sites/default/files/packt_logo.png">www.packtpub.com/sites/default/files/packt_logo.png</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://www.ascii-art.de/ascii/ab/badger.txt">www.ascii-art.de/ascii/ab/badger.txt</a></li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec292"/>How to do it...</h2></div></div></div><p>To load external resources by downloading them from the Internet, do the following:</p><div><ol class="orderedlist arabic"><li class="listitem">In a 2D project, create a new <code class="literal">RawImage</code> UI GameObject.</li><li class="listitem">Add the following C# script class as a component of your image object:<div><pre class="programlisting">using UnityEngine;
using UnityEngine.UI;
using System.Collections;

public class ReadImageFromWeb : MonoBehaviour {
  public string url = "http://www.packtpub.com/sites/default/files/packt_logo.png";

  IEnumerator Start() {
    WWW www = new WWW(url);
    yield return www;
    Texture2D texture = www.texture;
    GetComponent&lt;RawImage&gt;().texture = texture;
  }
}</pre></div></li><li class="listitem">Play the scene. Once downloaded, the contents of the image file will be displayed:<div><img alt="How to do it..." src="img/1362OT_10_05.jpg"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec293"/>How it works...</h2></div></div></div><p>Note the need to use the <code class="literal">UnityEngine.UI</code> package for this recipe.</p><p>When the game starts, our <code class="literal">Start()</code> method starts the <a class="indexterm" id="id1039"/><strong>coroutine</strong> method called <code class="literal">LoadWWW()</code>. A coroutine is a method that can keep on running in the background without halting or slowing down the other parts of the game and the frame rate. The <code class="literal">yield</code> statement indicates that once a value can be returned for <code class="literal">imageFile</code>, the remainder of the method can be executed—that is, until the file has finished downloading, no attempt should be made to extract the texture property of the <code class="literal">WWW</code> object variable.</p><p>Once the image data has been loaded, execution will progress past the <code class="literal">yield</code> statement. Finally, the <code class="literal">texture</code> property of the <code class="literal">RawImage</code> GameObject, to which the script is attached, is<a class="indexterm" id="id1040"/> changed to the image data that is downloaded from the Web (inside the <code class="literal">texture</code> variable of the <code class="literal">www</code> object).</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec294"/>There's more...</h2></div></div></div><p>There are some details that you don't want to miss.</p><div><div><div><div><h3 class="title"><a id="ch10lvl3sec76"/>Converting from Texture to Sprite</h3></div></div></div><p>While in the recipe we used a UI <strong>RawImage</strong>, and so could use the downloaded <strong>Texture</strong> directly, there<a class="indexterm" id="id1041"/> may be times when we wish to work with a <strong>Sprite</strong> rather than a <strong>Texture</strong>. Use this method to create a <strong>Sprite</strong> object from a <strong>Texture</strong>:</p><div><pre class="programlisting">  private Sprite TextureToSprite(Texture2D texture){
    Rect rect = new Rect(0, 0, texture.width, texture.height);
    Vector2 pivot = new Vector2(0.5f, 0.5f);
    Sprite sprite = Sprite.Create(texture, rect, pivot);
    return sprite;
  }</pre></div></div><div><div><div><div><h3 class="title"><a id="ch10lvl3sec77"/>Downloading a text file from the Web</h3></div></div></div><p>Use this technique<a class="indexterm" id="id1042"/> to download a text file:</p><div><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI;

public class ReadTextFromWeb : MonoBehaviour {
  public string url = "http://www.ascii-art.de/ascii/ab/badger.txt";

  IEnumerator Start(){
    Text textUI = GetComponent&lt;Text&gt;();
    textUI.text = "(loading file ...)";

    WWW www = new WWW(url);
    yield return www;
    string textFileContents = www.text;
    Debug.Log(textFileContents);

    textUI.text = textFileContents;
  }
}</pre></div></div><div><div><div><div><h3 class="title"><a id="ch10lvl3sec78"/>The WWW class and the resource contents</h3></div></div></div><p>The <code class="literal">WWW</code> class<a class="indexterm" id="id1043"/> defines several different properties and methods to allow the downloaded media resource file data to be extracted into appropriate variables<a class="indexterm" id="id1044"/> for use in the game. The most useful of these include:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">.text</code>: A read-only property, returning the web data as string</li><li class="listitem" style="list-style-type: disc"><code class="literal">.texture</code>: A read-only property, returning the web data as a Texture2D image</li><li class="listitem" style="list-style-type: disc"><code class="literal">.GetAudioClip()</code>: A method that returns the web data as an AudioClip</li></ul></div><div><div><h3 class="title"><a id="note47"/>Note</h3><p>For more information about the Unity <a class="indexterm" id="id1045"/>
<code class="literal">WWW</code> class visit <a class="ulink" href="http://docs.unity3d.com/ScriptReference/WWW.html">http://docs.unity3d.com/ScriptReference/WWW.html</a>.</p></div></div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec295"/>See also</h2></div></div></div><p>Refer to the following recipes in this chapter for more information:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Loading external resource files – by Unity Default Resources</em></li><li class="listitem" style="list-style-type: disc"><em>Loading external resource files – by manually storing files in the Unity Resources folder</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec99"/>Loading external resource files – by manually storing files in the Unity Resources folder</h1></div></div></div><p>At times, the contents of the external resource files may need to be changed after the game compilation. Hosting the resource files on the web may not be an option. There is a method of manually storing and reading files from the <code class="literal">Resources</code> folder of the compiled game, which<a class="indexterm" id="id1046"/> allows for those files to be changed after the game compilation.</p><div><div><h3 class="title"><a id="note48"/>Note</h3><p>This technique only works when you compile to a Windows or Mac stand alone executable—it will not work for Web Player builds, for example.</p></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec296"/>Getting ready</h2></div></div></div><p>The <code class="literal">1362_10_01</code> folder provides the texture image that you can use for this recipe:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">externalTexture.jpg</code></li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec297"/>How to do it...</h2></div></div></div><p>To load external resources by manually storing the files in the <code class="literal">Resources</code> folder, do the following:</p><div><ol class="orderedlist arabic"><li class="listitem">In a 2D project, create a new Image UI GameObject.</li><li class="listitem">Add the following C# script class as a component of your Image object:<div><pre class="programlisting">using UnityEngine;
using System.Collections;

using UnityEngine.UI;
using System.IO;

public class ReadManualResourceImageFile : MonoBehaviour {
  private string fileName = "externalTexture.jpg";
  private string url;
  private Texture2D externalImage;

  IEnumerator Start () {
    url = "file:" + Application.dataPath;
    url = Path.Combine(url, "Resources");
    url = Path.Combine(url, fileName);

    WWW www = new WWW (url);
    yield return www;

    Texture2D texture = www.texture;
    GetComponent&lt;Image&gt;().sprite = TextureToSprite(texture);
  }

  private Sprite TextureToSprite(Texture2D texture){
    Rect rect = new Rect(0, 0, texture.width, texture.height);
    Vector2 pivot = new Vector2(0.5f, 0.5f);
    Sprite sprite = Sprite.Create(texture, rect, pivot);
    return sprite;
  }
}</pre></div></li><li class="listitem">Build your (Windows or Mac) standalone executable.</li><li class="listitem">Copy the <code class="literal">externalTexture.jpg</code> image to your standalone's <code class="literal">Resources</code> folder.<div><div><h3 class="title"><a id="note49"/>Note</h3><p>You will need<a class="indexterm" id="id1047"/> to place the files in the <code class="literal">Resources</code> folder manually after every compilation.</p><p>When you create a Windows or Linux standalone executable, there is also a _<code class="literal">Data</code> folder, created with the executable application file. The <code class="literal">Resources</code> folder can be found inside this <code class="literal">Data</code> folder.</p><p>A Mac standalone application executable looks like a single file, but it is actually a MacOS <code class="literal">package</code> folder. Right-click on the executable file and select <strong>Show Package Contents</strong>. You will then find the standalone's <code class="literal">Resources</code> folder inside the <code class="literal">Contents</code> folder.</p></div></div></li><li class="listitem">Run your standalone game application and the image will be displayed:<div><img alt="How to do it..." src="img/1362OT_10_06.jpg"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec298"/>How it works...</h2></div></div></div><p>Note the need to use the <code class="literal">System.IO</code> and <code class="literal">UnityEngine.UI</code> packages for this recipe.</p><p>When the executable runs, the <code class="literal">WWW</code> object spots that the URL starts with the word file, and so Unity <a class="indexterm" id="id1048"/>attempts to find the external resource file in its <code class="literal">Resources</code> folder, and then load its contents.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec299"/>There's more...</h2></div></div></div><p>There are some details that you don't want to miss.</p><div><div><div><div><h3 class="title"><a id="ch10lvl3sec79"/>Avoiding cross-platform problems with Path.Combine() rather than "/" or "\"</h3></div></div></div><p>The filepath folder separator character<a class="indexterm" id="id1049"/> is different for Windows and Mac file systems (backslash (<code class="literal">\</code>) for Windows, forward slash (<code class="literal">/</code>) for the Mac). However, Unity knows which kind of standalone you are compiling your project into, therefore the <code class="literal">Path.Combine()</code> method will insert the appropriate separator slash character form the file URL that is required.</p></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec300"/>See also</h2></div></div></div><p>Refer to the following recipes in this chapter for more information:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Loading external resource files – by Unity Default Resources</em></li><li class="listitem" style="list-style-type: disc"><em>Loading external resource files – by downloading files from the Internet</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec100"/>Saving and loading player data – using static properties</h1></div></div></div><p>Keeping<a class="indexterm" id="id1050"/> track <a class="indexterm" id="id1051"/>of the player's progress and user<a class="indexterm" id="id1052"/> settings during a <a class="indexterm" id="id1053"/>game is vital to give your game a greater feel of depth and content. In this recipe, we will learn how to make our game remember the player's score between the different levels (scenes).</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec301"/>Getting ready</h2></div></div></div><p>We have included a complete <a class="indexterm" id="id1054"/>project in a Unity package named <code class="literal">game_HigherOrLower</code> in the <code class="literal">1362_10_04</code> folder. In order to follow this recipe, we will import this package as the starting point.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec302"/>How to do it...</h2></div></div></div><p>To save and <a class="indexterm" id="id1055"/>load player data, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a<a class="indexterm" id="id1056"/> new 2D project and import the <code class="literal">game_HigherOrLower</code> package.</li><li class="listitem">Add each of the scenes to the build in the sequence (<code class="literal">scene0_mainMenu</code>, then <code class="literal">scene1_gamePlaying</code>, and so on).</li><li class="listitem">Make yourself familiar with the game by playing it a few times and examining the contents of the scenes. The game starts on the <code class="literal">scene0_mainMenu</code> scene, inside the <code class="literal">Scenes</code> folder.</li><li class="listitem">Let's create a <a class="indexterm" id="id1057"/>class to store the number of correct and incorrect guesses made by the user. Create a new C# script called <code class="literal">Player</code> with the following code:<div><pre class="programlisting">using UnityEngine;

public class Player : MonoBehaviour {
  public static int scoreCorrect = 0;
  public static int scoreIncorrect = 0;
}</pre></div></li><li class="listitem">In the lower-left corner of the <code class="literal">scene0_mainMenu</code> scene, create a UI Text GameObject named <strong>Text – score</strong>, containing the placeholder text <strong>Score: 99 / 99</strong>.<div><img alt="How to do it..." src="img/1362OT_10_07.jpg"/></div></li><li class="listitem">Next, attach<a class="indexterm" id="id1058"/> the following C# script to UI GameObject <strong>Text – score</strong>:<div><pre class="programlisting">using UnityEngine;
using System.Collections;

using UnityEngine.UI;

public class UpdateScoreText : MonoBehaviour {
  void Start(){
    Text scoreText = GetComponent&lt;Text&gt;();
    int totalAttempts = Player.scoreCorrect + Player.scoreIncorrect;
    string scoreMessage = "Score = ";
    scoreMessage += Player.scoreCorrect + " / " + totalAttempts;

    scoreText.text = scoreMessage;
  }
}</pre></div></li><li class="listitem">In the<a class="indexterm" id="id1059"/> <code class="literal">scene2_gameWon</code> scene, attach<a class="indexterm" id="id1060"/> the following C# script to the<a class="indexterm" id="id1061"/> Main Camera:<div><pre class="programlisting">using UnityEngine;

public class IncrementCorrectScore : MonoBehaviour {
  void Start () {
    Player.scoreCorrect++;	
  }
}</pre></div></li><li class="listitem">In the <code class="literal">scene3_gameLost</code> scene, attach the following C# script to the Main Camera:<div><pre class="programlisting">using UnityEngine;

public class IncrementIncorrectScore : MonoBehaviour {
  void Start () {
    Player.scoreIncorrect++;	
  }
}</pre></div></li><li class="listitem">Save your scripts and play the game. As you progress from level (scene) to level, you will find that the score and player's name are remembered, until you quit the application.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec303"/>How it works...</h2></div></div></div><p>The <code class="literal">Player</code> class<a class="indexterm" id="id1062"/> uses static (class) properties <code class="literal">scoreCorrect</code> and <code class="literal">scoreIncorrect</code> to store the current total number of correct and incorrect guesses. Since these are public static properties, any <a class="indexterm" id="id1063"/>object from any scene can access (set or get) these values, since the static properties are remembered from scene to scene. This class also provides the public <a class="indexterm" id="id1064"/>static method called <code class="literal">ZeroTotals()</code> that resets both the values to zero.</p><p>When the <a class="indexterm" id="id1065"/>
<code class="literal">scene0_mainMenu</code> scene is loaded, all the GameObjects with scripts will have their <code class="literal">Start()</code> methods executed. The UI Text GameObject called <strong>Text – score</strong> has an instance of the <a class="indexterm" id="id1066"/>
<code class="literal">UpdateScoreText</code> class as s script component, so that the scripts <code class="literal">Start()</code> method will be executed, which retrieves the correct and incorrect totals from the <code class="literal">Player</code> class, creates the <code class="literal">scoreMessage</code> string about the current score, and updates the text property so that the user sees the current score.</p><p>When the game is running and the user guesses correctly (higher), then the <code class="literal">scene2_gameWon</code> scene is loaded. So the <code class="literal">Start()</code> method, of the <code class="literal">IncrementCorrectScore</code> script component, of the Main Camera in this scene is executed, which adds <code class="literal">1</code> to the <code class="literal">scoreCorrect</code> variable of the <code class="literal">Player</code> class.</p><p>When the game is running and the user guesses wrongly (lower), then scene <code class="literal">scene3_gameLost</code> is loaded. So the <code class="literal">Start()</code> method, of the <code class="literal">IncrementIncorrectScore</code> script component, of the Main Camera in this scene is executed, which adds <code class="literal">1</code> to the <code class="literal">scoreIncorrect</code> variable of the <code class="literal">Player</code> class.</p><p>The next time the user visits the main menu scene, the new values of the correct and incorrect totals will be read from the <code class="literal">Player</code> class, and the UI Text on the screen will inform the user of their updated total score for the game.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec304"/>There's more...</h2></div></div></div><p>There are some details that you don't want to miss.</p><div><div><div><div><h3 class="title"><a id="ch10lvl3sec80"/>Hiding the score before the first attempt completed</h3></div></div></div><p>Showing a score<a class="indexterm" id="id1067"/> of zero out of zero isn't very professional. Let's add some logic so that the score is only displayed (a non-empty string) if the total number of attempts is greater than zero:</p><div><pre class="programlisting">void Start(){
  Text scoreText = GetComponent&lt;Text&gt;();
  int totalAttempts = Player.scoreCorrect + Player.scoreIncorrect;

  // default is empty string
  string scoreMessage = "";
  if( totalAttempts &gt; 0){
    scoreMessage = "Score = ";
    scoreMessage += Player.scoreCorrect + " / " + totalAttempts;
  }

  scoreText.text = scoreMessage;
}</pre></div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec305"/>See also</h2></div></div></div><p>Refer to the following recipe<a class="indexterm" id="id1068"/> in this chapter for more information:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Saving and loading player data – using PlayerPrefs</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec101"/>Saving and loading player data – using PlayerPrefs</h1></div></div></div><p>While the previous<a class="indexterm" id="id1069"/> recipe illustrates how the static<a class="indexterm" id="id1070"/> properties allow a game to remember values between different scenes, these values are forgotten once the game application has quit. Unity<a class="indexterm" id="id1071"/> provides the <code class="literal">PlayerPrefs</code> feature to<a class="indexterm" id="id1072"/> allow a game to store and retrieve data, between the different game playing sessions.</p><div><img alt="Saving and loading player data – using PlayerPrefs" src="img/1362OT_10_08.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec306"/>Getting ready</h2></div></div></div><p>This recipe builds<a class="indexterm" id="id1073"/> upon the previous recipe. In case you haven't completed the previous recipe, we have included a <code class="literal">Unity</code> package named <code class="literal">game_scoreStaticVariables</code> in the the <code class="literal">1362_10_05</code> folder. In order to follow this recipe using this package, you must do the following:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new 2D project and import the <code class="literal">game_HigherOrLower</code> package.</li><li class="listitem">Add each of<a class="indexterm" id="id1074"/> the scenes to the build in the sequence (<code class="literal">scene0_mainMenu</code>, then <code class="literal">scene1_gamePlaying</code>, and so on).</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec307"/>How to do it...</h2></div></div></div><p>To save and load<a class="indexterm" id="id1075"/> the player data using <code class="literal">PlayerPrefs</code>, follow<a class="indexterm" id="id1076"/> these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Delete the C# script called <code class="literal">Player</code>.</li><li class="listitem">Edit the C# script called <code class="literal">UpdateScoreText</code> by replacing the <code class="literal">Start()</code> method with the following:<div><pre class="programlisting">void Start(){
  Text scoreText = GetComponent&lt;Text&gt;();

  int scoreCorrect = PlayerPrefs.GetInt("scoreCorrect");
  int scoreIncorrect = PlayerPrefs.GetInt("scoreIncorrect");

  int totalAttempts = scoreCorrect + scoreIncorrect;
  string scoreMessage = "Score = ";
  scoreMessage += scoreCorrect + " / " + totalAttempts;

  scoreText.text = scoreMessage;
}</pre></div></li><li class="listitem">Now, edit the C# script called <code class="literal">IncrementCorrectScore</code> by replacing the <code class="literal">Start()</code> method <a class="indexterm" id="id1077"/>with the following code:<div><pre class="programlisting">void Start () {
  int newScoreCorrect = 1 + PlayerPrefs.GetInt("scoreCorrect");
  PlayerPrefs.SetInt("scoreCorrect", newScoreCorrect);
}</pre></div></li><li class="listitem">Now, edit the C# script called <code class="literal">IncrementIncorrectScore</code> by replacing the <code class="literal">Start()</code> method with the following code:<div><pre class="programlisting">void Start () {
  int newScoreIncorrect = 1 + PlayerPrefs.GetInt("scoreIncorrect");
  PlayerPrefs.SetInt("scoreIncorrect", newScoreIncorrect);
}</pre></div></li><li class="listitem">Save your <a class="indexterm" id="id1078"/>scripts and play the game. Quit from<a class="indexterm" id="id1079"/> Unity and then restart the application. You will find that the player's name, level, and score are now kept between the game sessions.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec308"/>How it works...</h2></div></div></div><p>We had no need for the<a class="indexterm" id="id1080"/> <code class="literal">Player</code> class, since this recipe uses the built-in runtime class called <code class="literal">PlayerPrefs</code>, provided by Unity.</p><p>Unity's <code class="literal">PlayerPrefs</code> runtime class is capable of storing and accessing information (the string, int, and float variables) in the user's machine. Values are stored in a <code class="literal">plist</code> file (Mac) or the registry (Windows), in a similar way to web browser cookies, and therefore, remembered between game application sessions.</p><p>Values for the total correct and incorrect scores are stored by the <code class="literal">Start()</code> methods in the <code class="literal">IncrementCorrectScore</code> and <code class="literal">IncrementIncorrectScore</code> classes. These methods use the <code class="literal">PlayerPrefs.GetInt("&lt;variableName&gt;")</code> method to retrieve the old total, add <code class="literal">1</code> to it, and then store the incremented total using the <code class="literal">PlayerPrefs.SetInt("&lt;variableName&gt;")</code> method.</p><p>These correct and incorrect totals are then read each time the <code class="literal">scene0_mainMenu</code> scene is loaded, and the score<a class="indexterm" id="id1081"/> totals displayed via the UI Text object<a class="indexterm" id="id1082"/> on the screen.</p><div><div><h3 class="title"><a id="note50"/>Note</h3><p>For more information on<a class="indexterm" id="id1083"/> <code class="literal">PlayerPrefs</code>, see Unity's online documentation at</p><p>
<a class="ulink" href="http://docs.unity3d.com/ScriptReference/PlayerPrefs.html">http://docs.unity3d.com/ScriptReference/PlayerPrefs.html</a>.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec309"/>See also</h2></div></div></div><p>Refer to the following<a class="indexterm" id="id1084"/> recipe in this chapter for <a class="indexterm" id="id1085"/>more information:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Saving and loading player data – using static properties</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec102"/>Saving screenshots from the game</h1></div></div></div><p>In this recipe, we <a class="indexterm" id="id1086"/>will learn how to take in-game snapshots, and save them in an external file. Better yet, we will make it possible to choose between three different methods.</p><div><div><h3 class="title"><a id="note51"/>Note</h3><p>This technique only works when you compile to a Windows or Mac standalone executable—it will not work for Web Player builds, for example.</p></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec310"/>Getting ready</h2></div></div></div><p>In order to follow this recipe, please import the <code class="literal">screenshots</code> package, which is available in the <code class="literal">1362_10_06</code> folder, to your project. The package includes a basic terrain, and a camera that can be rotated via mouse.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec311"/>How to do it...</h2></div></div></div><p>To save the screenshots from your game, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Import the <code class="literal">screenshots</code> package and open the <code class="literal">screenshotLevel</code> scene.</li><li class="listitem">Add the following C# Script to the Main Camera:<div><pre class="programlisting">using UnityEngine;
using System.Collections;
using System;
using System.IO;

public class TakeScreenshot : MonoBehaviour {
  public string prefix = "Screenshot";
  public enum method{captureScreenshotPng, ReadPixelsPng, ReadPixelsJpg};
  public method captMethod = method.captureScreenshotPng;
  public int captureScreenshotScale = 1;
  [Range(0, 100)]
  public int jpgQuality = 75;
  private Texture2D texture;
  private int sw;
  private int sh;
  private Rect sRect;
  string date;

  void Start(){
    sw = Screen.width;
    sh = Screen.height;
    sRect = new Rect(0,0,sw,sh);
  }

  void  Update (){
    if (Input.GetKeyDown (KeyCode.P)){
      TakeShot();
    }
  }

  private void TakeShot(){
    date = System.DateTime.Now.ToString("_d-MMM-yyyy-HH-mm-ss-f");

    if (captMethod == method.captureScreenshotPng){
      Application.CaptureScreenshot(prefix + date + ".png", captureScreenshotScale);
    } else {
      StartCoroutine(ReadPixels());
    }
  }

  IEnumerator  ReadPixels (){
    yield return new WaitForEndOfFrame();

    byte[] bytes;
    texture = new Texture2D (sw,sh,TextureFormat.RGB24,false);
    texture.ReadPixels(sRect,0,0);
    texture.Apply();

    if (captMethod == method.ReadPixelsJpg){
      bytes = texture.EncodeToJPG(jpgQuality);
      WriteBytesToFile(bytes, ".jpg");
    } else if (captMethod == method.ReadPixelsPng){
      bytes = texture.EncodeToPNG();
      WriteBytesToFile(bytes, ".png");
    }
  }

  private void WriteBytesToFile(byte[] bytes, string format){
    Destroy (texture);
    File.WriteAllBytes(Application.dataPath + "/../"+prefix + date + format, bytes);
  }
}</pre></div></li><li class="listitem">Save your script and attach it to the Main Camera GameObject, by dragging it from the <strong>Project</strong> view to the Main Camera GameObject, in the <strong>Hierarchy</strong> view.</li><li class="listitem">Access the <strong>Take Screenshot</strong> component. Set <strong>Capt Method</strong> as <strong>Capture Screenshot Png</strong>. Change <strong>Capture Screenshot Scale</strong> to <strong>2</strong>.<div><div><h3 class="title"><a id="note52"/>Note</h3><p>If you want <a class="indexterm" id="id1087"/>your image file's name to start with something different than <code class="literal">Screenshot</code>, then change it in the <strong>Prefix</strong> field.</p></div></div><div><img alt="How to do it..." src="img/1362OT_10_09.jpg"/></div></li><li class="listitem">Play the scene. A new screenshot with twice the original size will be saved in your project folder every time you press <em>P</em>.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec312"/>How it works...</h2></div></div></div><p>The <code class="literal">Start()</code> method creates a Rect object with the screen width and height. Each frame the <code class="literal">Update()</code> methods tests whether the <em>P</em> key has been pressed.</p><p>Once the script has detected that the <em>P</em> key was pressed, the screen is captured and stored as an image file into the same folder where the executable is. In case the <strong>Capture Screenshot Png</strong> option is selected, the script will call a built-in Unity function called <code class="literal">CaptureScreenshot()</code>, which is capable of scaling up the original screen size (in our case, based on the <code class="literal">Scale</code> variable of our script). If not, the image will be captured by the <code class="literal">ReadPixels</code> function, encoded to PNG or JPG and finally, written via the <code class="literal">WriteAllBytes</code> function.</p><p>In all cases the file created will have the appropriate "<code class="literal">.png</code>" or "<code class="literal">.jpg</code>" file extension, to match its image file format.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec313"/>There's more...</h2></div></div></div><p>We have included the options using the<a class="indexterm" id="id1088"/> <code class="literal">ReadPixel</code> function as a demonstration of how to save your images to a disk without using Unity's <code class="literal">CaptureScreenshot()</code> function. One <a class="indexterm" id="id1089"/>advantage of this method is that it can be adapted to capture and save only a portion of the screen. The <code class="literal">captureScreenshotScale</code> variable from our script will not affect screenshots created with the ReadPixel function though.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec103"/>Setting up a leaderboard using PHP/MySQL</h1></div></div></div><p>Games are more fun when there is a leaderboard of high scores that the players have achieved. Even <a class="indexterm" id="id1090"/>single player games can communicate<a class="indexterm" id="id1091"/> to a shared web-based leaderboard. This recipe includes both, the client side (Unity) code, as well as the web-server side (PHP) scripts to set and get the player scores from a MySQL database.</p><div><img alt="Setting up a leaderboard using PHP/MySQL" src="img/1362OT_10_10.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec314"/>Getting ready</h2></div></div></div><p>This recipe assumes that you either have your own web hosting, or are running a local web server and a database server, such as XAMPP or MAMP. Your web server needs to support PHP, and you also need to be able to create the MySQL databases.</p><p>All the SQL, PHP, and C# scripts for this recipe can be found in the <code class="literal">1362_10_07</code> folder.</p><p>Since the scene contains several UI elements and the code of the recipe is the communication with the PHP scripts and SQL database, in <code class="literal">1362_10_07</code> folder, we have provided a <code class="literal">Unity</code> package called <code class="literal">PHPMySQLeaderboard</code>, containing a scene with everything set up for the Unity project.</p><div><div><h3 class="title"><a id="note53"/>Note</h3><p>If you are hosting your leaderboard on a public website, you will change the names of the database, database user and password for reasons of security. You should also implement some form of secret game code, as described in the <em>There's more…</em> section.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec315"/>How to do it...</h2></div></div></div><p>To set up a<a class="indexterm" id="id1092"/> leaderboard using PHP and MySQL, do<a class="indexterm" id="id1093"/> the following:</p><div><ol class="orderedlist arabic"><li class="listitem">On your server, create a new MySQL database named <code class="literal">cookbook_highscores</code>.</li><li class="listitem">On your server, create a new database user (username=<code class="literal">cookbook</code>, password=<code class="literal">cookbook</code>) with full rights to the database that you just created.</li><li class="listitem">On your server, execute the following SQL to create the database table called <code class="literal">score_list</code>:<div><pre class="programlisting">CREATE TABLE `score_list` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `player` varchar(25) NOT NULL,
  `score` int(11) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=1;</pre></div></li><li class="listitem">Copy the provided PHP script files to your web server:<div><ol class="orderedlist arabic"><li class="listitem"><code class="literal">index.php</code></li><li class="listitem"><code class="literal">scoreFunctions.php</code></li><li class="listitem"><code class="literal">htmlMenu.php</code></li></ol></div></li><li class="listitem">Create a new 2D Unity project and extract the Unity package called <code class="literal">PHPMySQLeaderboard</code>.</li><li class="listitem">Run the provided scene, and click on the buttons to make Unity communicate with the PHP scripts that have access to the high score database.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec316"/>How it works...</h2></div></div></div><p>The player's scores are stored in a MySQL database. Access to the database is facilitated through the PHP scripts provided. In our example, all the PHP scripts were placed in the web server root folder for a local Apache webserver. So, the scripts are accessed via <code class="literal">http://localhost:8888/</code>. However, since URL is a public string variable, this can be set before running to the location of your server and site code.</p><p>All the access is through the PHP file called <code class="literal">index.php</code>. There are five actions implemented, and each is indicated by adding the action name at the end of the URL (this is the <code class="literal">GET HTTP</code> method, which is sometimes used for web forms. Take a look at the address bar of your browser next time you search Google for example). The actions and their parameters (if any) are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">action = html</code>: This action asks for HTML text listing all player scores to be returned. This action<a class="indexterm" id="id1094"/> takes no parameters. It returns: HTML text.</li><li class="listitem" style="list-style-type: disc"><code class="literal">action = xml</code>: This <a class="indexterm" id="id1095"/>action asks for XML text listing all player scores to be returned. This action takes no parameters. It returns: XML text.</li><li class="listitem" style="list-style-type: disc"><code class="literal">action = reset</code>: This action<a class="indexterm" id="id1096"/> asks for a set of default player name and score values to replace the current contents of the database table. This action takes no argument. It returns: the string <code class="literal">reset</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">action = get</code>: This action asks for the integer score of the named player that is to be found. It takes parameters in the form <code class="literal">player = matt</code>. It returns: the score integer.</li><li class="listitem" style="list-style-type: disc"><code class="literal">action = set</code>: This action asks for the provide score of the named player to be stored in the database (but only if this new score is greater than the currently stored score). It takes parameters in the form <code class="literal">player = matt, score = 101</code>. It returns: the score integer (if the database update was successful), otherwise a negative value (to indicate that no update took place).</li></ul></div><p>There are five buttons in the Unity scene (corresponding to the five actions) which set up the corresponding action and the parameters to be added to the URL, for the next call to the web server, via the <code class="literal">LoadWWW()</code> method. The <code class="literal">OnClick</code> actions have been set up for each button to call the corresponding methods of the <code class="literal">WebLeaderBoard</code> C# script of the Main Camera.</p><p>There are also three UI Text objects. The first displays the most recent URL string sent to the server. The second displays the integer value that was extracted from the response message that was received from the server (or a message as "not an integer" if some other data was received). The third UI Text object is inside a panel, and has been made large enough to display a full, multi-line, text string, received from the server (which is stored inside the <code class="literal">textFileContents</code> variable).</p><p>The three UI Text objects have been assigned to the public variables of the <code class="literal">WebLeaderBoard</code> C# script for the Main Camera. When the scene first starts, the <code class="literal">Start()</code> method calls the <code class="literal">UpdateUI()</code> method to update the three text UI elements. When any of the buttons are clicked, the corresponding method of the <code class="literal">WebLeaderBoard</code> method is called, which builds the URL string with parameters, and then calls the <code class="literal">LoadWWW()</code> method. This method sends the request to the URL, and waits (by virtue of being a coroutine) until a response is received. It then stores the content, received in the <code class="literal">textFileContents</code> variable, and calls the <code class="literal">UpdateUI()</code> method.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec317"/>There's more...</h2></div></div></div><p>The following sections will fine-tune and customize this recipe for you:</p><div><div><div><div><h3 class="title"><a id="ch10lvl3sec81"/>Extracting the full leaderboard data as XML for display within Unity</h3></div></div></div><p>The XML text that <a class="indexterm" id="id1097"/>can be retrieved from the PHP web server provides a useful method for allowing a Unity game to retrieve the full set of the leaderboard data from the database. Then, the leaderboard can be displayed to the user in the Unity game (perhaps, in some nice 3D fashion, or through a game-consistent GUI). </p></div><div><div><div><div><h3 class="title"><a id="ch10lvl3sec82"/>Using the secret game codes to secure your leaderboard scripts</h3></div></div></div><p>The Unity<a class="indexterm" id="id1098"/> and PHP code that is presented illustrates a simple, unsecured web-based leaderboard. To prevent players hacking into the board with false scores, it is usual to encode some form of secret game code (or key) into the communications. Only update requests that include the correct code will actually cause a change to the database.</p><p>The Unity code will combine the secret key (in this example, the string called <code class="literal">harrypotter</code>) with something related to the communication—for example, the same MySQL/PHP leader board may have different database records for different games that are identified with a game ID:</p><div><pre class="programlisting">// Unity Csharp code
string key = "harrypotter"
string gameId = 21;
string gameCode = Utility.Md5Sum(key + gameId);</pre></div><p>The server-side PHP code will receive both the encrypted game code, and also the piece of game data that is used to create that encrypted code (in this example, the game ID and MD5 hashing function, which is available in both, Unity and in PHP). The secret key (<code class="literal">harrypotter</code>) is used with the game ID to create an encrypted code that can be compared with the code received from the Unity game (or whatever user agent or browser is attempting to communicate with the leaderboard server scripts). The database actions will only be executed if the game code created on the server matches that send along with the request for a database action.</p><div><pre class="programlisting">// PHP – security code
$key = "harrypotter"
$game_id =  $_GET['game_id'];
$provided_game_code =  $_GET['game_code'];
$server_game_code = md5($key.$game_id);

if( $server_game_code == $provided_game_code ) {
  // codes match - do processing here
}</pre></div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec318"/>See also</h2></div></div></div><p>Refer to the<a class="indexterm" id="id1099"/> following recipe for more Information:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Preventing your game from running on unknown servers</em> in <a class="link" href="ch11.html" title="Chapter 11. Improving Games with Extra Features and Optimization">Chapter 11</a>, <em>Improving Games With Extra Features and Optimization</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec104"/>Loading game data from a text file map</h1></div></div></div><p>Rather than, for <a class="indexterm" id="id1100"/>every level of a game, having to create and place every GameObject on the screen by hand, a better approach can be to create the text files of rows, and columns of characters, where each character corresponds to the type of GameObject that is to be created in the corresponding location. In this recipe, we'll use a text file and set of prefab sprites to display a graphical version of a text-data file for a screen from the classic game called <a class="indexterm" id="id1101"/><strong>NetHack</strong>.</p><div><img alt="Loading game data from a text file map" src="img/1362OT_10_11.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec319"/>Getting ready</h2></div></div></div><p>In the <code class="literal">1362_10_08</code> folder, we have provided the following two files for this recipe:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">level1.txt</code> (a text file, representing a level)</li><li class="listitem" style="list-style-type: disc"><code class="literal">absurd128.png</code> (a 128 x 128 sprite sheet for Nethack).</li></ul></div><p>The level data came from the <a class="indexterm" id="id1102"/>Nethack Wikipedia page, and the sprite sheet came from SourceForge:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://en.wikipedia.org/wiki/NetHack">http://en.wikipedia.org/wiki/NetHack</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://sourceforge.net/projects/noegnud/files/tilesets_nethack-3.4.1/absurd%20128x128/">http://sourceforge.net/projects/noegnud/files/tilesets_nethack-3.4.1/absurd%20128x128/</a></li></ul></div><p>Note that we <a class="indexterm" id="id1103"/>also included a Unity package with all the prefabs set up, since this can be a laborious task.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec320"/>How to do it...</h2></div></div></div><p>To load game data from a text file map, do the following:</p><div><ol class="orderedlist arabic"><li class="listitem">Import the text file called <code class="literal">level1.txt</code>, and the image file called <code class="literal">absurd128.png</code>.</li><li class="listitem">Select <code class="literal">absurd128.png</code> in the Inspector, and set <strong>Texture Type</strong> to <strong>Sprite (2D/uGUI)</strong>, and <strong>Sprite Mode</strong> to <strong>Multiple</strong>.</li><li class="listitem">Edit this sprite in the <strong>Sprite Editor</strong>, choosing <strong>Type</strong> as <strong>Grid</strong> and <strong>Pixel Size</strong> as <code class="literal">128</code> x <code class="literal">128</code>, and apply these settings.<div><img alt="How to do it..." src="img/1362OT_10_12.jpg"/></div></li><li class="listitem">In the <strong>Project</strong> panel, click on the right-facing white triangle to <em>explode</em> the icon, to show all the sprites in this sprite sheet individually.<div><img alt="How to do it..." src="img/1362OT_10_13.jpg"/></div></li><li class="listitem">Drag the Sprite called <code class="literal">absurd128_175</code> onto the scene.</li><li class="listitem">Create a<a class="indexterm" id="id1104"/> new <strong>Prefab</strong> named <code class="literal">corpse_175</code> in the <strong>Project</strong> panel, and drag onto this blank prefab Sprite <code class="literal">absurd128_175</code> from the scene. Now, delete the sprite instance from the scene. You have now created a prefab containing the Sprite <code class="literal">175</code>.</li><li class="listitem">Repeat this process for the following sprites (that is, create prefabs for each one):<div><ol class="orderedlist arabic"><li class="listitem"><code class="literal">floor_848</code></li><li class="listitem"><code class="literal">corridor_849</code></li><li class="listitem"><code class="literal">horiz_1034</code></li><li class="listitem"><code class="literal">vert_1025</code></li><li class="listitem"><code class="literal">door_844</code></li><li class="listitem"><code class="literal">potion_675</code></li></ol></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">chest_586</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">alter_583</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">stairs_up_994</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">stairs_down_993</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">wizard_287</code></li></ul></div></li><li class="listitem">Select the <strong>Main Camera</strong> in the Inspector, and ensure that it is set to an <strong>Orthographic</strong> camera, sized <strong>20</strong>, with <strong>Clear Flags</strong> as <strong>Solid Color</strong> and <strong>Background</strong> as <strong>Black</strong>.</li><li class="listitem">Attach the following C# code to the Main Camera as the script class called <code class="literal">LoadMapFromTextfile</code>:<div><pre class="programlisting">using UnityEngine;
using System.Collections;

using System.Collections.Generic;

public class LoadMapFromTextfile : MonoBehaviour
{
  public TextAsset levelDataTextFile;

  public GameObject floor_848;
  public GameObject corridor_849;
  public GameObject horiz_1034;
  public GameObject vert_1025;
  public GameObject corpse_175;
  public GameObject door_844;
  public GameObject potion_675;
  public GameObject chest_586;
  public GameObject alter_583;
  public GameObject stairs_up_994;
  public GameObject stairs_down_993;
  public GameObject wizard_287;	

  public Dictionary&lt;char, GameObject&gt; dictionary = new Dictionary&lt;char, GameObject&gt;();

  void Awake(){
    char newlineChar = '\n';

    dictionary['.'] = floor_848;
    dictionary['#'] = corridor_849;
    dictionary['('] = chest_586;
    dictionary['!'] = potion_675;
    dictionary['_'] = alter_583;
    dictionary['&gt;'] = stairs_down_993;
    dictionary['&lt;'] = stairs_up_994;
    dictionary['-'] = horiz_1034;
    dictionary['|'] = vert_1025;
    dictionary['+'] = door_844;
    dictionary['%'] = corpse_175;
    dictionary['@'] = wizard_287;

    string[] stringArray = levelDataTextFile.text.Split(newlineChar);
    BuildMaze( stringArray );
  }

  private void BuildMaze(string[] stringArray){
    int numRows = stringArray.Length;

    float yOffset = (numRows / 2);

    for(int row=0; row &lt; numRows; row++){
      string currentRowString = stringArray[row];
      float y = -1 * (row - yOffset);
      CreateRow(currentRowString, y);
    }
  }

  private void CreateRow(string currentRowString, float y) {
    int numChars = currentRowString.Length;
    float xOffset = (numChars/2);

    for(int charPos = 0; charPos &lt; numChars; charPos++){
      float x = (charPos - xOffset);
      char prefabCharacter = currentRowString[charPos];

      if (dictionary.ContainsKey(prefabCharacter)){
        CreatePrefabInstance( dictionary[prefabCharacter], x, y);
      }
    }
  }

  private void CreatePrefabInstance(GameObject objectPrefab, float x, float y){
    float z = 0;
    Vector3 position = new Vector3(x, y, z);
    Quaternion noRotation = Quaternion.identity;
    Instantiate (objectPrefab, position, noRotation);
  }
}</pre></div></li><li class="listitem">With the<a class="indexterm" id="id1105"/> <strong>Main Camera</strong> selected, drag the appropriate prefabs onto the prefabs slots in the <strong>Inspector</strong>, for the <code class="literal">LoadMapFromTextfile</code> Script component.<div><img alt="How to do it..." src="img/1362OT_10_14.jpg"/></div></li><li class="listitem">When you run the scene, you will see that a sprite-based Nethack map will appear, using your prefabs.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec321"/>How it works...</h2></div></div></div><p>The Sprite sheet was automatically sliced up into hundreds of 128 x 128 pixel Sprite squares. We <a class="indexterm" id="id1106"/>created the prefab objects from some of these sprites, so that the copies can be created at runtime when needed.</p><p>The text file called <code class="literal">level1.txt</code> contains the lines of text characters. Each non-space character represents where a sprite prefab should be instantiated (<code class="literal">column = X</code>, <code class="literal">row = Y</code>). A C# dictionary variable named <code class="literal">dictionary</code> is declared and initialized in the <code class="literal">Start()</code> method to associate specific prefab GameObjects with some particular characters in the text file.</p><p>The <code class="literal">Awake()</code> method splits<a class="indexterm" id="id1107"/> the string into an array using the newline character as a separator. So now, we have <code class="literal">stringArray</code> with an entry for each row of the text data. The <code class="literal">BuildMase(…)</code> method is called with the <code class="literal">stringArray</code>.</p><p>The <code class="literal">BuildMaze(…)</code> method interrogates<a class="indexterm" id="id1108"/> the array to find its length (the number of rows of data for this level), and sets <code class="literal">yOffSet</code> to half this value. This is done to allow the placing of the prefabs half above <code class="literal">Y = 0</code> and half below, so <code class="literal">(0,0,0)</code> is the center of the level map. A <code class="literal">for</code>-loop is used to read each row's string from the array. It passes it to the <a class="indexterm" id="id1109"/>
<code class="literal">CreateRow(…)</code> method along with the Y-value corresponding to the current row.</p><p>The <code class="literal">CreateRow(…)</code> method extracts the length of the string, and sets <code class="literal">xOffSet</code> to half this value. This is done to allow the placing of the prefabs half to the left of <code class="literal">X = 0</code> and half to the right, so <code class="literal">(0,0,0)</code> is the center of the level map. A <code class="literal">for</code>-loop is used to read each character from the current row's string, and (if there is an entry in our dictionary for that character) then the<a class="indexterm" id="id1110"/> <code class="literal">CreatePrefabIInstance (…)</code> method is called, passing the prefab reference<a class="indexterm" id="id1111"/> in the dictionary for that character, and the <em>x</em> and <em>y</em> value.</p><p>The <code class="literal">CreatePrefabInstance(…)</code> method instantiates the given prefab at a position of (<em>x</em>, <em>y</em>, <em>z</em>) where <em>z</em> is always zero, and there is no rotation (<code class="literal">Quarternion.identity</code>).</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec105"/>Managing Unity project code using Git version control and GitHub hosting</h1></div></div></div><p>
<strong>Distributed Version Control Systems</strong> (<strong>DVCS</strong>) are becoming a bread-and-butter everyday tool for software developers. An issue with<a class="indexterm" id="id1112"/> Unity projects can be the many<a class="indexterm" id="id1113"/> binary files in each project. There are also many files in a local system's Unity project directory that are not<a class="indexterm" id="id1114"/> needed for archiving/sharing, such as OS specific thumbnail files, trash files, and so on. Finally, some Unity project folders themselves do not<a class="indexterm" id="id1115"/> need to be archived, such as Temp and Library.</p><p>While Unity provides its own "Asset Server", many small game developers chose not to pay for this extra feature. Also, Git and Mercurial (the most common DVCSs) are free, and work with any set of documents that are to be maintained (programs in any programming language, text-files, and so on). So, it makes sense to learn how to work with a third-party, industry standard DVCS for the Unity projects. In fact, the documents for this very book were all archived and version-controlled using a private GitHub repository!</p><p>In this recipe, we will set up a Unity project for GIT DVCS through a combination of Unity Application settings and use of the GitHub GUI-client application.</p><div><div><h3 class="title"><a id="note54"/>Note</h3><p>We created a real project this way—a pacman-style game, which you can explore and download/pull from the public <a class="indexterm" id="id1116"/>GitHub's URL, available at <a class="ulink" href="https://github.com/dr-matt-smith/matt-mac-man">https://github.com/dr-matt-smith/matt-mac-man</a>.</p></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec322"/>Getting ready</h2></div></div></div><p>This recipe can be used with any Unity project. In the <code class="literal">1362_10_09</code> folder, we have provided a Unity package of our <code class="literal">matt-mac-man</code> game, if you wish to use that one - in which case create<a class="indexterm" id="id1117"/> a new 2D project in Unity, and import this package.</p><p>Since this recipe illustrates hosting code on GitHub, you'll need to create a (free) GitHub account at <a class="ulink" href="http://github.com">github.com</a> if you do not already have one.</p><p>Before starting this<a class="indexterm" id="id1118"/> recipe you need to have installed Git and the GitHub client application.</p><p>Learn how, and download the<a class="indexterm" id="id1119"/> client from the following links:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://git-scm.com/book/en/Getting-Started-Installing-Git">http://git-scm.com/book/en/Getting-Started-Installing-Git</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://git-scm.com/downloads/guis">http://git-scm.com/downloads/guis</a></li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec323"/>How to do it...</h2></div></div></div><p>To load the external<a class="indexterm" id="id1120"/> resources by Unity Default Resources, do the following:</p><div><ol class="orderedlist arabic"><li class="listitem">In the root<a class="indexterm" id="id1121"/> directory of your Unity project, add the following code into a file named <code class="literal">.gitignore</code> (ensure that the filename starts with the <em>dot</em>):<div><pre class="programlisting"># =============== #
# Unity generated #
# =============== #
Temp/
Library/

# ===================================== #
# Visual Studio / MonoDevelop generated #
# ===================================== #
ExportedObj/
obj/
*.svd
*.userprefs
/*.csproj
*.pidb
*.suo
/*.sln
*.user
*.unityproj
*.booproj

# ============ #
# OS generated #
# ============ #
.DS_Store
.DS_Store?
._*
.Spotlight-V100
.Trashes
ehthumbs.db
Thumbs.db</pre></div><div><div><h3 class="title"><a id="tip12"/>Tip</h3><p>This special file (<code class="literal">.gitignore</code>) tells the version control system which files do <em>not</em> need to be archived. For example, we don't need to record the Windows or Mac image thumbnail files (<code class="literal">DS_STORE</code> or <code class="literal">Thumbs.db</code>).</p></div></div></li><li class="listitem">Open<a class="indexterm" id="id1122"/> <strong>Editor Settings</strong> in the<a class="indexterm" id="id1123"/> <strong>Inspector</strong> by navigating to <strong>Edit</strong> | <strong>Project Settings</strong> | <strong>Editor</strong>.</li><li class="listitem">In the <strong>Editor Settings</strong>, set<a class="indexterm" id="id1124"/> the <strong>Version Control Mode</strong> to <strong>Visible Meta Files</strong>.</li><li class="listitem">In the <strong>Editor Settings</strong>, set<a class="indexterm" id="id1125"/> the <strong>Asset Serialization Mode</strong> to <strong>Force Text</strong>.<div><img alt="How to do it..." src="img/1362OT_10_15.jpg"/></div></li><li class="listitem">Save your project so that these new settings are stored. Then, close the Unity application.</li><li class="listitem">Log on to your GitHub account.</li><li class="listitem">On your <a class="indexterm" id="id1126"/>GitHub home page, click on the green <strong>New</strong> button to start creating a new repository.<div><img alt="How to do it..." src="img/1362OT_10_16.jpg"/></div></li><li class="listitem">Give your<a class="indexterm" id="id1127"/> new repository<a class="indexterm" id="id1128"/> a name (we chose <strong>matt-mac-man</strong>) and check the <strong>Initialize this repository with a README</strong> option.<div><img alt="How to do it..." src="img/1362OT_10_17.jpg"/></div></li><li class="listitem">Startup your<a class="indexterm" id="id1129"/> GitHub client application on your computer, and get a list of the repositories to clone to the<a class="indexterm" id="id1130"/> local computer by navigating to <strong>File</strong> | <strong>Clone Repository ..</strong>. From the list provided, select <a class="indexterm" id="id1131"/>your new repository (for us, it was matt-mac-man) and click on the <strong>Clone</strong> button to this repository.<div><img alt="How to do it..." src="img/1362OT_10_18.jpg"/></div></li><li class="listitem">You'll be <a class="indexterm" id="id1132"/>asked where to store this repository on your local computer (we simply chose our <strong>Desktop</strong>). You will<a class="indexterm" id="id1133"/> now see a folder with the repository name on your computer's disk, containing<a class="indexterm" id="id1134"/> a hidden <code class="literal">.git</code> folder, and a single file named <code class="literal">README.md</code>.<div><img alt="How to do it..." src="img/1362OT_10_19.jpg"/></div></li><li class="listitem">Now, copy to this<a class="indexterm" id="id1135"/> local repository folder the following files and folders from your Unity project:<div><ol class="orderedlist arabic"><li class="listitem"><code class="literal">.gitignore</code></li><li class="listitem"><code class="literal">/Assets</code></li><li class="listitem"><code class="literal">/Library</code></li><li class="listitem"><code class="literal">/ProjectSettings</code></li></ol></div><div><img alt="How to do it..." src="img/1362OT_10_20.jpg"/></div></li><li class="listitem">In your GitHub client application, you will now see lots of <strong>Uncommitted Changes</strong>. Type<a class="indexterm" id="id1136"/> in a short comment <a class="indexterm" id="id1137"/>for your first commit (we typed our standard—<code class="literal">v0.1 – first commit</code>), and click on the<a class="indexterm" id="id1138"/> <strong>Commit &amp; Sync</strong> to push the contents of this Unity project folder up to your GitHub account repository.<div><img alt="How to do it..." src="img/1362OT_10_21.jpg"/></div></li><li class="listitem">Now, if you<a class="indexterm" id="id1139"/> visit your GitHub project page, you will see that all these Unity project files are available for<a class="indexterm" id="id1140"/> download for people's computers either as a ZIP archive, or to be cloned using a Git client.<div><img alt="How to do it..." src="img/1362OT_10_22.jpg"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec324"/>How it works...</h2></div></div></div><p>The special<a class="indexterm" id="id1141"/> file called <code class="literal">.gitngnore</code> lists all the files and directories that are <em>not</em> to be archived.</p><p>Changing the Unity <strong>Editor Settings</strong> for <strong>Version Control Mode</strong> to <strong>Meta Files</strong> ensures that Unity stores the required housekeeping data for each asset in its associated meta file. Selecting <strong>Visible</strong> rather<a class="indexterm" id="id1142"/> than <strong>Hidden</strong> simply avoids any confusion as to whether GIT will record the meta files or not—GIT will record them whether visible or not. So, by making them visible, it is obvious to the developers working with the files that they will be included.</p><p>Changing the Unity<a class="indexterm" id="id1143"/> <strong>Editor Settings</strong> for <strong>Asset Serialization Mode</strong> to <strong>Force Text</strong> attempts to solve some of the difficulties of managing changes with the large binary files. Unity projects tend to have quite a few binary files, such as the <code class="literal">.unity</code> scene files, prefabs, and so on. There seems to be some debate about the best setting that should be used; we have found that <strong>Force Text</strong> works fine and so, we will use this at present. You'll see two commits on GitHub, since the very first was<a class="indexterm" id="id1144"/> when we created the new repository, and the second was our first commit of the<a class="indexterm" id="id1145"/> repository using the GitHub client, when we added all of our code into the local repository and pushed (committed) it to the remote server.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec325"/>There's more...</h2></div></div></div><p>There are<a class="indexterm" id="id1146"/> some details that you don't want to<a class="indexterm" id="id1147"/> miss.</p><div><div><div><div><h3 class="title"><a id="ch10lvl3sec83"/>Learn more about Distributed Version Control Systems (DVCS)</h3></div></div></div><p>The following video<a class="indexterm" id="id1148"/> link is a short introduction<a class="indexterm" id="id1149"/> to DVCS:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://youtu.be/1BbK9o5fQD4">http://youtu.be/1BbK9o5fQD4</a></li></ul></div><p>Note that the Fogcreek Kiln "harmony" feature now allows seamless work between GIT and Mercurial with the same Kiln repository:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://blog.fogcreek.com/kiln-harmony-internals-the-basics/">http://blog.fogcreek.com/kiln-harmony-internals-the-basics/</a></li></ul></div></div><div><div><div><div><h3 class="title"><a id="ch10lvl3sec84"/>Using Bitbucket and SourceTree</h3></div></div></div><p>If you prefer to<a class="indexterm" id="id1150"/> use Bitbucket and SourceTree with your Unity projects, you can find a good tutorial <a class="indexterm" id="id1151"/>at the following URL:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://yeticrabgames.blogspot.ie/2014/02/using-git-with-unity-without-using.html">http://yeticrabgames.blogspot.ie/2014/02/using-git-with-unity-without-using.html</a></li></ul></div></div><div><div><div><div><h3 class="title"><a id="ch10lvl3sec85"/>Using the command line rather than Git-client application</h3></div></div></div><p>While for many, using a GUI client, such as the GitHub application, is a gentler introduction to using DVCS, at some point, you'll want to learn more and get to grips with working in the command line.</p><p>Since both Git and <a class="indexterm" id="id1152"/>Mercurial are open source, there are lots of great, free online resources available. The following are some good sources to get started on:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Learn all about Git, download free GUI clients, and even get free online access to The Pro Git book (by Scott Chacon), available through Creative Commons license at<a class="indexterm" id="id1153"/> the following URL:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://git-scm.com/book">http://git-scm.com/book</a></li></ul></div></li><li class="listitem" style="list-style-type: disc">You will find an online interactive Git command line to practice in:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="https://try.github.io/levels/1/challenges/1">https://try.github.io/levels/1/challenges/1</a></li></ul></div></li><li class="listitem" style="list-style-type: disc">The main Mercurial website, including free online access to the <em>Mercurial: The Definitive Guide</em> (by Bryan O'Sullivan) book is available through the Open Publication <a class="indexterm" id="id1154"/>License at:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://mercurial.selenic.com/">http://mercurial.selenic.com/</a></li></ul></div></li><li class="listitem" style="list-style-type: disc">SourceTree is a free Mercurial and Git GUI client, available at:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://www.sourcetreeapp.com/">http://www.sourcetreeapp.com/</a></li></ul></div></li></ul></div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec326"/>See also</h2></div></div></div><p>Refer to the following recipe for more information:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Publishing for multiple devices via Unity Cloud</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec106"/>Publishing for multiple devices via Unity Cloud</h1></div></div></div><p>One reason<a class="indexterm" id="id1155"/> for the Git recipe in this chapter is to allow you to prepare your projects for one of the most exciting new services offered to Unity developers in recent years—Unity Cloud! Unity Cloud takes all the work out of building different versions of your project for different devices—you PUSH your updated Unity project to your online DVCS (such as GitHub). Then, Unity Cloud will see the update and PULL your new code, and build your game for the range of devices/deployment platforms that you have set up.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec327"/>Getting ready</h2></div></div></div><p>First, log on to the Unity Cloud<a class="indexterm" id="id1156"/> Build website and create an account at:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://unity3d.com/unity/cloud-build">http://unity3d.com/unity/cloud-build</a></li></ul></div><p>For this recipe, you need access to a project's source code. If you don't have your own (for example, you haven't completed the Git recipe in this chapter), then feel free to use the matt-mac-man project available at the<a class="indexterm" id="id1157"/> public GitHub URL at:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="https://github.com/dr-matt-smith/matt-mac-man">https://github.com/dr-matt-smith/matt-mac-man</a></li></ul></div><div><div><h3 class="title"><a id="note55"/>Note</h3><p>A common reason for a test project that was first built to fail is forgetting to add at least one scene to the build settings for the project.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec328"/>How to do it...</h2></div></div></div><p>To load external resources by Unity Default Resources, do the following:</p><div><ol class="orderedlist arabic"><li class="listitem">Log on to your Unity Cloud Build account.</li><li class="listitem">On the <strong>Projects</strong> page, click on the <strong>Add a New Project</strong> button.<div><img alt="How to do it..." src="img/1362OT_10_23.jpg"/></div></li><li class="listitem">Next, you'll need to add<a class="indexterm" id="id1158"/> the URL for your source code, and the <strong>Source Control Method</strong> (<strong>SCM</strong>). For our project, we entered our <em>matt-mac-man</em> URL, and <strong>GIT</strong> for the SCM.<div><img alt="How to do it..." src="img/1362OT_10_24.jpg"/></div></li><li class="listitem">Next, you need to enter some settings. Unity Cloud Build will choose your source code project name as the default application name (most times, this is fine). You need to enter a <strong>Bundle ID</strong>—commonly, the reverse of your website URL is used here to ensure that the <strong>App Name</strong> plus <strong>Bundle ID</strong> is unique. So, we entered <code class="literal">com.mattsmithdev</code>. Unless testing branches of the code, the default master branch is fine, and likewise, unless testing subfolders, the default (no subfolder) is fine. Unless you are using the latest "beta" versions, the <strong>Unity Version</strong> option should be left to the default <strong>Always Use Latest Version</strong>. Finally, check the build options that you wish to have created. Note that you'll need to have set up the Apple codes if building for iOS; but you will be able to build for Unity Web Player and Android immediately.<div><img alt="How to do it..." src="img/1362OT_10_25.jpg"/></div></li><li class="listitem">Next are the app "credentials". Unless you have Android credentials, you can choose the default "development" credentials. But this means that users will be warned when installing the application.</li><li class="listitem">Unity Cloud will then start to build your application—this will take a few minutes (depending on the load on their server).</li><li class="listitem">When built, you'll get <a class="indexterm" id="id1159"/>an e-mail (for each deployment target—so, we got one for Web Player, and one for Android). If the build fails, you'll still get an e-mail, and you can look up the logs for the reasons why the build failed.<div><img alt="How to do it..." src="img/1362OT_10_26.jpg"/></div></li><li class="listitem">You can then play web player version immediately:<div><img alt="How to do it..." src="img/1362OT_10_27.jpg"/></div></li><li class="listitem">To test with <a class="indexterm" id="id1160"/>Android or iOS, you download it onto the device (from the Unity Cloud web server) and play the game:<div><img alt="How to do it..." src="img/1362OT_10_28.jpg"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec329"/>How it works...</h2></div></div></div><p>Unity Cloud pulls your project source code from the DVCS system (such as GitHub). It then compiles your code using the settings chosen for Unity version and deployment platforms (we chose Web <a class="indexterm" id="id1161"/>Player and Android in this recipe). If the build is successful, Unity Cloud makes the build applications available to download and run.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec330"/>There's more...</h2></div></div></div><p>There are some details that you don't want to miss.</p><div><div><div><div><h3 class="title"><a id="ch10lvl3sec86"/>Learn more about Unity Cloud</h3></div></div></div><p>Learn more in<a class="indexterm" id="id1162"/> the Support section of the Unity Cloud website (after logging-in), and the Unity main website Cloud Build information page at:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="https://build.cloud.unity3d.com/support/">https://build.cloud.unity3d.com/support/</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://unity3d.com/unity/cloud-build">http://unity3d.com/unity/cloud-build</a></li></ul></div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec331"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For more information refer the <em>Managing Unity project code using Git version control and GitHub hosting</em> recipe</li></ul></div></div></div></body></html>