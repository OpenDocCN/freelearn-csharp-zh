<html><head></head><body>
<div><div><h1 class="chapter-number" id="_idParaDest-15"><a id="_idTextAnchor014"/>1</h1>
<h1 id="_idParaDest-16"><a id="_idTextAnchor015"/>Introduction to Minimal APIs</h1>
<p>In this chapter of the book, we will introduce some basic themes related to minimal APIs in .NET 6.0, showing how to set up a development environment for .NET 6 and more specifically for developing minimal APIs with ASP.NET Core. </p>
<p>We will first begin with a brief history of minimal APIs. Then, we will create a new minimal API project with Visual Studio 2022 and Visual Code Studio. At the end, we will take a look at the structure of our project.</p>
<p>By the end of this chapter, you will be able to create a new minimal API project and start to work with this new template for a REST API.</p>
<p>In this chapter, we will be covering the following topics:</p>
<ul>
<li>A brief history of the Microsoft Web API</li>
<li>Creating a new minimal API project</li>
<li>Looking at the structure of the project</li>
</ul>
<h1 id="_idParaDest-17"><a id="_idTextAnchor016"/>Technical requirements</h1>
<p>To work with the ASP.NET Core 6 minimal APIs you need to install, first of all, .NET 6 on your development environment.</p>
<p>If you have not already installed it, let’s do that now:</p>
<ol>
<li>Navigate to the following link: <a href="https://dotnet.microsoft.com">https://dotnet.microsoft.com</a>.</li>
<li>Click on the <strong class="bold">Download</strong> button.</li>
<li>By default, the browser chooses the right operating system for you, but if not, select your operating system at the top of the page.</li>
<li>Download the LTS version of the .NET 6.0 SDK.</li>
<li>Start the installer.</li>
<li>Reboot the machine (this is not mandatory).</li>
</ol>
<p>You can see which SDKs are installed on your development machine using the following command in a terminal:</p>
<pre>dotnet –list-sdks</pre>
<p>Before you start coding, you will need a code editor or an <strong class="bold">Integrated Development Environment</strong> (<strong class="bold">IDE</strong>). You can choose your favorite from the following list:</p>
<ul>
<li>Visual Studio Code for Windows, Mac, or Linux</li>
<li>Visual Studio 2022</li>
<li>Visual Studio 2022 for Mac</li>
</ul>
<p>In the last few years, Visual Studio Code has become very popular not only in the developer community but also in the Microsoft community. Even if you use Visual Studio 2022 for your day-to-day work, we recommend downloading and installing Visual Studio Code and giving it a try.</p>
<p>Let’s download and install Visual Studio Code and some extensions:</p>
<ol>
<li value="1">Navigate to <a href="https://code.visualstudio.com">https://code.visualstudio.com</a>.</li>
<li>Download the <strong class="bold">Stable</strong> or the <strong class="bold">Insiders</strong> edition.</li>
<li>Start the installer.</li>
<li>Launch Visual Studio Code.</li>
<li>Click on the <strong class="bold">Extensions</strong> icon.</li>
</ol>
<p>You will see the C# extension at the top of the list.</p>
<ol>
<li value="6">Click on the <strong class="bold">Install</strong> button and wait.</li>
</ol>
<p>You can install other recommended extensions for developing with C# and ASP.NET Core. If you want to install them, you see our recommendations in the following table:</p>
<div><div><img alt="" height="308" src="img/Table_1.01_B17902.jpg" width="1549"/>
</div>
</div>
<p>Additionally, if you want to proceed with the IDE that’s most widely used by .NET developers, you can download and install Visual Studio 2022.</p>
<p>If you don’t have a license, check if you can use the Community Edition. There are a few restrictions on getting a license, but you can use it if you are a student, have open source projects, or want to use it as an individual. Here’s how to download and install Visual Studio 2022:</p>
<ol>
<li value="1">Navigate to <a href="https://visualstudio.microsoft.com/downloads/">https://visualstudio.microsoft.com/downloads/</a>.</li>
<li>Select Visual Studio 2022 version 17.0 or later and download it.</li>
<li>Start the installer.</li>
<li>On the <strong class="bold">Workloads</strong> tab, select the following:<ul><li><strong class="bold">ASP.NET and web development</strong></li><li><strong class="bold">Azure Development</strong></li></ul></li>
<li>On the <strong class="bold">Individual Components</strong> tab, select the following:<ul><li><strong class="bold">Git for Windows</strong></li></ul></li>
</ol>
<p>All the code samples in this chapter can be found in the GitHub repository for this book at <a href="https://github.com/PacktPublishing/Minimal-APIs-in-ASP.NET-Core-6/tree/main/Chapter01">https://github.com/PacktPublishing/Minimal-APIs-in-ASP.NET-Core-6/tree/main/Chapter01</a>.</p>
<p>Now, you have an environment in which you can follow and try the code used in this book.</p>
<h1 id="_idParaDest-18"><a id="_idTextAnchor017"/>A brief history of the Microsoft Web API</h1>
<p>A few <a id="_idIndexMarker000"/>years ago in 2007, .NET web applications went through an evolution with the introduction of ASP.NET MVC. Since then, .NET has provided native support for the Model-View-Controller pattern that was common in other languages.</p>
<p>Five years later, in 2012, RESTful APIs were the new trend on the internet and .NET responded to this with a new approach for developing APIs, called ASP.NET Web API. It was a significant improvement over <strong class="bold">Windows Communication Foundation</strong> (<strong class="bold">WCF</strong>) because it<a id="_idIndexMarker001"/> was easier to develop services for the web. Later, in ASP.NET Core these frameworks were unified under the name ASP.NET Core MVC: one single framework with which to develop web applications and APIs.</p>
<p>In ASP.NET Core MVC applications, the controller is responsible for accepting inputs, orchestrating operations, and at the end, returning a response. A developer can extend the entire pipeline <a id="_idIndexMarker002"/>with filters, binding, validation, and much more. It’s a fully featured framework for building modern web applications.</p>
<p>But in the real world, there are also scenarios and use cases where you don’t need all the features of the MVC framework or you have to factor in a constraint on performance. ASP.NET Core implements a lot of middleware that you can remove from or add to your applications at will, but there are a lot of common features that you would need to implement by yourself in this scenario.</p>
<p>At last, ASP.NET Core 6.0 has filled these gaps with minimal APIs.</p>
<p>Now that we have covered a brief history of minimal APIs, we will start creating a new minimal API project in the next section.</p>
<h1 id="_idParaDest-19"><a id="_idTextAnchor018"/>Creating a new minimal API project</h1>
<p>Let’s start <a id="_idIndexMarker003"/>with our first project and try to analyze the new template for the minimal API approach when writing a RESTful API. </p>
<p>In this section, we will create our first minimal API project. We will start by using Visual Studio 2022 and then we will show how you can also create the project with Visual Studio Code and the .NET CLI.</p>
<h2 id="_idParaDest-20"><a id="_idTextAnchor019"/>Creating the project with Visual Studio 2022</h2>
<p>Follow these<a id="_idIndexMarker004"/> steps to create a <a id="_idIndexMarker005"/>new project in Visual Studio 2022:</p>
<ol>
<li value="1">Open Visual Studio 2022 and on the main screen, click on <strong class="bold">Create a new project</strong>:</li>
</ol>
<div><div><img alt="Figure 1.1 – Visual Studio 2022 splash screen " height="622" src="img/Figure_1.01_B17902.jpg" width="1061"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.1 – Visual Studio 2022 splash screen</p>
<ol>
<li value="2">On the next screen, write <code>API</code> in the textbox at the top of the window and select the template called <strong class="bold">ASP.NET Core Web API</strong>:</li>
</ol>
<div><div><img alt="Figure 1.2 – Create a new project screen " height="801" src="img/Figure_1.02_B17902.jpg" width="1203"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.2 – Create a new project screen</p>
<ol>
<li value="3">Next, on <a id="_idIndexMarker006"/>the <strong class="bold">Configure your new project</strong> screen, insert <a id="_idIndexMarker007"/>a name for the new project and select the root folder for your new solution:<div><img alt="Figure 1.3 – Configure your new project screen " height="616" src="img/Figure_1.03_B17902.jpg" width="1016"/></div></li>
</ol>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"> </p>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.3 – Configure your new project screen</p>
<p>For this <a id="_idIndexMarker008"/>example we will use <a id="_idIndexMarker009"/>the name <code>Chapter01</code>, but you can choose any name that appeals to you.</p>
<ol>
<li value="4">On the following <strong class="bold">Additional information</strong> screen, make sure to select <strong class="bold">.NET 6.0 (Long-term-support)</strong> from the <strong class="bold">Framework</strong> dropdown. And most important of all, uncheck the <strong class="bold">Use controllers (uncheck to use minimal APIs)</strong> option.</li>
</ol>
<div><div><img alt="Figure 1.4 – Additional information screen " height="660" src="img/Figure_1.04_B17902.jpg" width="935"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.4 – Additional information screen</p>
<ol>
<li value="5">Click <strong class="bold">Create</strong> and,<a id="_idIndexMarker010"/> after a few <a id="_idIndexMarker011"/>seconds, you will see the code of your new minimal API project.</li>
</ol>
<p>Now we are going to show how to create the same project using Visual Studio Code and the .NET CLI.</p>
<h2 id="_idParaDest-21"><a id="_idTextAnchor020"/>Creating the project with Visual Studio Code</h2>
<p>Creating a <a id="_idIndexMarker012"/>project with Visual Studio Code <a id="_idIndexMarker013"/>is easier and faster than with Visual Studio 2022 because you don’t have to use a UI or wizard, rather just a terminal and the .NET CLI.</p>
<p>You don’t need to install anything new for this because the .NET CLI is included with the .NET 6 installation (as in the previous versions of the .NET SDKs). Follow these steps to create a <a id="_idIndexMarker014"/>project using Visual Studio Code:</p>
<ol>
<li value="1">Open your<a id="_idIndexMarker015"/> console, shell, or Bash terminal, and switch to your working directory.</li>
<li>Use the following command to create a new Web API application:<pre><strong class="bold">dotnet new webapi -minimal -o Chapter01</strong></pre></li>
</ol>
<p>As you can see, we have inserted the <code>-minimal</code> parameter in the preceding command to use the minimal API project template instead of the ASP.NET Core template with the controllers.</p>
<ol>
<li value="3">Now open the new project with Visual Studio Code using the following commands:<pre><strong class="bold">cd Chapter01</strong>
<strong class="bold">code.</strong></pre></li>
</ol>
<p>Now that we know how to create a new minimal API project, we are going to have a quick look at the structure of this new template.</p>
<h1 id="_idParaDest-22"><a id="_idTextAnchor021"/>Looking at the structure of the project</h1>
<p>Whether<a id="_idIndexMarker016"/> you are using Visual Studio or Visual Studio Code, you should see the following code in the <code>Program.cs</code> file:</p>
<pre class="source-code">
var builder = WebApplication.CreateBuilder(args);
// Add services to the container.
// Learn more about configuring Swagger/OpenAPI at https://aka.ms/aspnetcore/swashbuckle
builder.Services.AddEndpointsApiExplorer();
builder.Services.AddSwaggerGen();
var app = builder.Build();
// Configure the HTTP request pipeline.
if (app.Environment.IsDevelopment())
{
    app.UseSwagger();
    app.UseSwaggerUI();
}
app.UseHttpsRedirection();
var summaries = new[]
{
    "Freezing", "Bracing", "Chilly", "Cool", "Mild", "Warm", 
    "Balmy", "Hot", "Sweltering", "Scorching"
};
app.MapGet("/weatherforecast", () =&gt;
{
  var forecast = Enumerable.Range(1, 5).Select(index =&gt;
      new WeatherForecast
      (
          DateTime.Now.AddDays(index),
          Random.Shared.Next(-20, 55),
          summaries[Random.Shared.Next(summaries.Length)]
      ))
      .ToArray();
      return forecast;
})
.WithName("GetWeatherForecast");
app.Run();
internal record WeatherForecast(DateTime Date, int TemperatureC, string? Summary)
{
    public int TemperatureF =&gt; 32 + (int)(TemperatureC / 
    0.5556);
}</pre>
<p>First of all, with the <a id="_idIndexMarker017"/>minimal API approach, all of your code will be inside the <code>Program.cs</code> file. If you are a seasoned .NET developer, it’s easy to understand the preceding code, and you’ll find it similar to some of the things you’ve always used with the controller approach.</p>
<p>At the end of the day, it’s another way to write an API, but it’s based on ASP.NET Core.</p>
<p>However, if you are new to ASP.NET, this single file approach is easy to understand. It’s easy to understand how to extend the code in the template and add more features to this API.</p>
<p>Don’t forget that minimal means that it contains the minimum set of components needed to build an HTTP API but it doesn’t mean that the application you are going to build will be simple. It will require a good design like any other .NET application.</p>
<p>As a final point, the minimal API approach is not a replacement for the MVC approach. It’s just another way to write the same thing.</p>
<p>Let’s go back to the code.</p>
<p>Even the template of the minimal API uses the new approach of .NET 6 web applications: a top-level statement.</p>
<p>It means that <a id="_idIndexMarker018"/>the project has a <code>Program.cs</code> file only instead of using two files to configure an application.</p>
<p>If you don’t like this style of coding, you can convert your application to the old template for ASP.NET Core 3.x/5. This approach still continues to work in .NET as well.</p>
<p class="callout-heading">Important note</p>
<p class="callout">We can find more information about the <code>.NET 6 top-level statements</code> template at <a href="https://docs.microsoft.com/dotnet/core/tutorials/top-level-templates">https://docs.microsoft.com/dotnet/core/tutorials/top-level-templates</a>.</p>
<p>By default, the new template includes support for the OpenAPI Specification and more specifically, Swagger.</p>
<p>Let’s say that we have our documentation and playground for the endpoints working out of the box without any additional configuration needed. </p>
<p>You can see the default configuration for Swagger in the following two lines of codes:</p>
<pre class="source-code">
builder.Services.AddEndpointsApiExplorer();
builder.Services.AddSwaggerGen();</pre>
<p>Very often, you don’t want to expose Swagger and all the endpoints to the production or staging environments. The default template enables Swagger out of the box only in the development environment with the following lines of code:</p>
<pre class="source-code">
if (app.Environment.IsDevelopment())
{
         app.UseSwagger();
         app.UseSwaggerUI();
}</pre>
<p>If the application is running on the dev elopment environment, you must also include the Swagger documentation, but otherwise not.</p>
<p class="callout-heading">Note</p>
<p class="callout">We’ll talk in detail about Swagger in <a href="B17902_03.xhtml#_idTextAnchor038"><em class="italic">Chapter 3</em></a>, <em class="italic">Working with Minimal APIs</em>.</p>
<p>In these last few lines of code in the template, we are introducing another generic concept for .NET 6 web applications: environments.</p>
<p>Typically, when<a id="_idIndexMarker019"/> we develop a professional application, there are a lot of phases through which an application is developed, tested, and finally published to the end users.</p>
<p>By convention, these phases are regulated and called development, staging, and production. As developers, we might like to change the behavior of the application based on the current environment.</p>
<p>There are several ways to access this information but the typical way to retrieve the actual environment in modern .NET 6 applications is to use environment variables. You can access the environment variables directly from the <code>app</code> variable in the <code>Program.cs</code> file.</p>
<p>The following code block shows how to retrieve all the information about the environments directly from the startup point of the application:</p>
<pre class="source-code">
if (app.Environment.IsDevelopment())
{
           // your code here
}
if (app.Environment.IsStaging())
{
           // your code here
}
if (app.Environment.IsProduction())
{
           // your code here
}</pre>
<p>In many cases, you can define additional environments, and you can check your custom environment with the following code:</p>
<pre class="source-code">
if (app.Environment.IsEnvironment("TestEnvironment"))
{
           // your code here
}</pre>
<p>To define <a id="_idIndexMarker020"/>routes and handlers in minimal APIs, we use the <code>MapGet</code>, <code>MapPost</code>, <code>MapPut</code>, and <code>MapDelete</code> methods. If you are used to using HTTP verbs, you will have noticed that the verb <code>Patch</code> is not present, but you can define any set of verbs using <code>MapMethods</code>.</p>
<p>For instance, if you want to create a new endpoint to post some data to the API, you can write the following code:</p>
<pre class="source-code">
app.MapPost("/weatherforecast", async (WeatherForecast 
    model, IWeatherService repo) =&gt;
{
         // ...
});</pre>
<p>As you can see in the short preceding code, it’s very easy to add a new endpoint with the new minimal API template.</p>
<p>It was more difficult previously, especially for a new developer, to code a new endpoint with binding parameters and use dependency injection.</p>
<p class="callout-heading">Important note</p>
<p class="callout">We’ll talk in detail about routing in <a href="B17902_02.xhtml#_idTextAnchor023"><em class="italic">Chapter 2</em></a>, <em class="italic">Exploring Minimal APIs and Their Advantages</em>, and about dependency injection in <a href="B17902_04.xhtml#_idTextAnchor061"><em class="italic">Chapter 4</em></a>, <em class="italic">Dependency Injection in a Minimal API Project</em>.</p>
<h1 id="_idParaDest-23"><a id="_idTextAnchor022"/>Summary</h1>
<p>In this chapter, we first started with a brief history of minimal APIs. Next, we saw how to create a project with Visual Studio 2022 as well as Visual Studio Code and the .NET CLI. After that, we examined the structure of the new template, how to access different environments, and how to start interacting with REST endpoints.</p>
<p>In the next chapter, we will see how to bind parameters, the new routing configuration, and how to customize a response.</p>
</div>
</div></body></html>