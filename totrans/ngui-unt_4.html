<html><head></head><body><div class="chapter" title="Chapter&#xA0;4.&#xA0;C# with NGUI"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. C# with NGUI</h1></div></div></div><p>In this chapter, we will talk<a id="id167" class="indexterm"/> about C# scripting<a id="id168" class="indexterm"/> with NGUI. We will learn how to handle events and interact with them. We'll use them to:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Play animations and Tweens</li><li class="listitem" style="list-style-type: disc">Change labels using localized text through code</li><li class="listitem" style="list-style-type: disc">Add keyboard keys for our UI</li><li class="listitem" style="list-style-type: disc">Create notifications and tool tips</li></ul></div><p>We will also see some of the NGUI's code-oriented components, such as event forwarding and message sending.</p><div class="section" title="Events methods"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec29"/>Events methods</h1></div></div></div><p>When<a id="id169" class="indexterm"/> using C# with NGUI, there are some methods that you<a id="id170" class="indexterm"/> will regularly use when you need to know if your object is currently hovered upon, pressed, or clicked.</p><p>If you attach a script to any object with a collider on it (for example, a button or a 3D object), you can add the following useful methods in the script to catch events:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">OnHover(bool state)</code>: This <a id="id171" class="indexterm"/>method is called <a id="id172" class="indexterm"/>when the object is hovered or unhovered. The <code class="literal">state</code> bool gives the hover state; if <code class="literal">state</code> is <code class="literal">true</code>, the cursor just entered the object's collider. If <code class="literal">state</code> is <code class="literal">false</code>, the cursor has just left the collider's bounds.</li><li class="listitem" style="list-style-type: disc"><code class="literal">OnPress(bool state)</code>: This<a id="id173" class="indexterm"/> method works<a id="id174" class="indexterm"/> in the exact same way as the previous <code class="literal">OnHover()</code> method, except it is called when the object is pressed. It works with a touch or click. If you need to know which mouse button was used to press the object, use the <code class="literal">UICamera.currentTouchID</code> variable; if this int is equal to -1, it's a left-click. If it's equal to -2, it's a right-click. Finally, if it's equal to -3, it's a middle-click.</li><li class="listitem" style="list-style-type: disc"><code class="literal">OnClick()</code>: This<a id="id175" class="indexterm"/> method is similar to <code class="literal">OnPress()</code>, except<a id="id176" class="indexterm"/> that this method is exclusively called when the click is validated, meaning when an <code class="literal">OnPress(true)</code> event occurs followed by an <code class="literal">OnPress(false)</code> event. It works with mouse click and touch.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note13"/>Note</h3><p>You can also use the <code class="literal">OnDoubleClick()</code> method, which works in the same way.</p></div></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">OnDrag(Vector2 delta)</code>: This <a id="id177" class="indexterm"/>method is <a id="id178" class="indexterm"/>called at each frame when the mouse or touch moves between the <code class="literal">OnPress(true)</code> and <code class="literal">OnPress(false)</code> events. The <code class="literal">Vector2</code> <code class="literal">delta</code> argument gives you the object's movement since the last frame.</li><li class="listitem" style="list-style-type: disc"><code class="literal">OnDrop(GameObject droppedObj)</code>: This<a id="id179" class="indexterm"/> method is called when an object is <a id="id180" class="indexterm"/>dropped on the GameObject on which this script is attached. The dropped GameObject is passed as the <code class="literal">droppedObj</code> parameter.</li><li class="listitem" style="list-style-type: disc"><code class="literal">OnSelect()</code>: This method<a id="id181" class="indexterm"/> is called when the <a id="id182" class="indexterm"/>user clicks on the object. It will not be called again until another object is clicked on or the object is deselected (click on nothing).</li><li class="listitem" style="list-style-type: disc"><code class="literal">OnInput(string text)</code>: This <a id="id183" class="indexterm"/>method<a id="id184" class="indexterm"/> is called when the user types in text while an object is selected. The <code class="literal">text</code> parameter gives the entered text.</li><li class="listitem" style="list-style-type: disc"><code class="literal">OnTooltip(bool state)</code>: This<a id="id185" class="indexterm"/> method is called<a id="id186" class="indexterm"/> when the cursor is over the object for more than the duration defined by the <span class="strong"><strong>Tooltip Delay</strong></span> inspector parameter of <span class="strong"><strong>UICamera</strong></span>. If the <span class="strong"><strong>Sticky Tooltip</strong></span> Boolean of <span class="strong"><strong>UICamera</strong></span> is checked, the tool tip will remain visible until the cursor moves outside the Collider's Bounds, otherwise the tool tip disappears as soon as the cursor moves.</li><li class="listitem" style="list-style-type: disc"><code class="literal">OnScroll(float delta)</code>: This<a id="id187" class="indexterm"/> method is<a id="id188" class="indexterm"/> called when the mouse's scroll wheel is moved while the object is hovered—the delta parameter gives you the amount and direction of the scroll.</li><li class="listitem" style="list-style-type: disc"><code class="literal">OnKey(KeyCode key)</code>: This <a id="id189" class="indexterm"/>method<a id="id190" class="indexterm"/> is called when the user clicks on a key while the object is selected. The pressed key is stored in the <code class="literal">key</code> parameter.</li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note14"/>Note</h3><p>If you attach your script on a 3D object to catch these events, make sure it is on a layer included in <code class="literal">Event</code> <code class="literal">Mask</code> of <code class="literal">UICamera</code>.</p></div></div><div class="section" title="Creating a tool tip"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec48"/>Creating a tool tip</h2></div></div></div><p>Let's <a id="id191" class="indexterm"/>now<a id="id192" class="indexterm"/> use the <code class="literal">OnTooltip()</code> event<a id="id193" class="indexterm"/> to show a tool tip for our powers, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/8667OT_04_01.jpg" alt="Creating a tool tip"/></div><p>We will also make sure it is localized using methods integrated with NGUI.</p><div class="section" title="The tool tip reference"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec17"/>The tool tip reference</h3></div></div></div><p>First, we will create our tool tip that will be shown when needed. These are the steps to do so:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select and duplicate our <span class="strong"><strong>Help</strong></span> GameObject with <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>D</em></span>. Then perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Rename this new duplicate as <code class="literal">Tooltip</code>.</li><li class="listitem">Set <span class="strong"><strong>Depth</strong></span> in <span class="strong"><strong>UIPanel</strong></span> to <code class="literal">4</code>.</li><li class="listitem">Set <span class="strong"><strong>Clipping</strong></span> in <span class="strong"><strong>UIPanel</strong></span> to <span class="strong"><strong>None</strong></span>.</li><li class="listitem">Remove its <span class="strong"><strong>Box Collider</strong></span> component.</li><li class="listitem">Remove its <span class="strong"><strong>UIDrag</strong></span><code class="literal"> Object</code> component.</li><li class="listitem">Remove its <span class="strong"><strong>UIAnchor</strong></span> component.</li><li class="listitem">Reset its <span class="strong"><strong>Transform</strong></span> position to {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>}.</li></ol></div></li><li class="listitem">Select <a id="id194" class="indexterm"/>our new <span class="strong"><strong>Background</strong></span>, which is a child GameObject of <span class="strong"><strong>Tooltip</strong></span>. Then perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Set its <span class="strong"><strong>Depth</strong></span> value to <code class="literal">0</code>.</li><li class="listitem">Set its <span class="strong"><strong>Pivot</strong></span> parameter to <span class="strong"><strong>Top Left</strong></span> (left arrow + up arrow).</li><li class="listitem">Reset its <span class="strong"><strong>Transform</strong></span> position to {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>}.</li><li class="listitem">Set its <span class="strong"><strong>Dimensions</strong></span> to <code class="literal">200</code> x <code class="literal">50</code>.</li></ol></div></li><li class="listitem">Select <span class="strong"><strong>Label</strong></span>, which is a child GameObject of <span class="strong"><strong>Tooltip</strong></span>. Then perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Set its <span class="strong"><strong>Depth</strong></span><code class="literal"> </code>to <code class="literal">1</code>.</li><li class="listitem">Change its text to <code class="literal">This is a Tooltip</code>.</li><li class="listitem">Change its <span class="strong"><strong>Overflow</strong></span> parameter to <span class="strong"><strong>Resize Height</strong></span>.</li><li class="listitem">Remove its <span class="strong"><strong>Tween Position</strong></span> component.</li><li class="listitem">Remove its <span class="strong"><strong>UILocalize</strong></span> component.</li><li class="listitem">Set its <span class="strong"><strong>Pivot</strong></span> parameter to <span class="strong"><strong>Top Left</strong></span> (left arrow + up arrow).</li><li class="listitem">Set its <span class="strong"><strong>Transform</strong></span> position to {<code class="literal">15</code>, <code class="literal">-15</code>, <code class="literal">0</code>}.</li><li class="listitem">Set its <span class="strong"><strong>Dimensions</strong></span> parameter to <code class="literal">200</code> x <code class="literal">20</code>.</li></ol></div></li><li class="listitem">Select our <span class="strong"><strong>Tooltip</strong></span> GameObject.</li><li class="listitem">Attach a <span class="strong"><strong>Tooltip</strong></span> to the selected object by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>UI</strong></span> and perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Drag our <span class="strong"><strong>Label</strong></span> GameObject from <span class="strong"><strong>Tooltip</strong></span> to its <span class="strong"><strong>Text</strong></span> field.</li><li class="listitem">Drag our <span class="strong"><strong>Window</strong></span> GameObject from <span class="strong"><strong>Tooltip</strong></span> to its <span class="strong"><strong>Background</strong></span> field.</li></ol></div></li></ol></div><p>Ok. Our tool tip is ready to be displayed. The fact that we have set the <span class="strong"><strong>Pivot</strong></span> parameter of <span class="strong"><strong>Label</strong></span> under <span class="strong"><strong>Tooltip</strong></span> to <span class="strong"><strong>Top left</strong></span>, with a position of {<code class="literal">15</code>, <code class="literal">-15</code>, <code class="literal">0</code>}, will force a margin between the text and the background sprite.</p><p>The <span class="strong"><strong>Overflow</strong></span> parameter will let the text be resized in height only, which will make our tool tip coherent even if we have a long tool tip—the <span class="strong"><strong>Background</strong></span> sprite will automatically resize to fit the <span class="strong"><strong>Label</strong></span> GameObject.</p></div><div class="section" title="Showing the tool tip"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec18"/>Showing the tool tip</h3></div></div></div><p>We must<a id="id195" class="indexterm"/> now show the tool tip when needed. In order to do that, we just need to use the <code class="literal">OnTooltip()</code> event, in which we will create a new tool tip with localized text.</p><p>In the <span class="strong"><strong>Project</strong></span> view, select both our <span class="strong"><strong>Time</strong></span> and <span class="strong"><strong>Bomb</strong></span> prefabs and create and add a new <code class="literal">TooltipManager.cs</code> C# script to it.</p><p>You can<a id="id196" class="indexterm"/> now open this new <code class="literal">TooltipManager.cs</code> script and declare the following enum, which will define which type of tool tip it must display:</p><div class="informalexample"><pre class="programlisting">//Enum to define which type of tooltip must be shown
public enum Type
{
  Bomb,
  Time
}

//Declare the Type enum variable
public Type type;</pre></div><p>Ok, now add the following <code class="literal">OnTooltip()</code> method that will create a tool tip with localized text depending on its current type:</p><div class="informalexample"><pre class="programlisting">//When a Tooltip event is triggered on this object
void OnTooltip(bool state)
{
  //If state is true, create a new Tooltip depending on the type
  if(state)
    UITooltip.ShowText(Localization.instance.Get(type.ToString() + "Tooltip"));
  //If state is false, hide tooltip by setting an empty string
  else
  UITooltip.ShowText("");
}</pre></div><p>Save the script. As you can see, we use a useful <code class="literal">Localization.instance.Get(string key)</code> method that returns localized text of the corresponding <code class="literal">key</code> parameter that is passed. You can now change a label to localized text through code anytime!</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note15"/>Note</h3><p>To use <code class="literal">Localization.instance.Get(string key)</code>, your label must not have a <span class="strong"><strong>UILocalize</strong></span> component attached to it; otherwise, the value of <span class="strong"><strong>UILocalize</strong></span> will overwrite anything you assign to the label.</p></div></div><p>Ok, we have added the code to show our tool tip with localized text. Now we have to add these localized strings to the <code class="literal">English.txt</code> file using the following code:</p><div class="informalexample"><pre class="programlisting">BombTooltip = Explodes all\nenemies at once
TimeTooltip = Slows Time\nfor 10 seconds</pre></div><p>Similarly, add the following lines in the <code class="literal">French.txt</code> file:</p><div class="informalexample"><pre class="programlisting">BombTooltip = Détruit tous les ennemis d'un coup
TimeTooltip = Ralentit le temps pour 10 secondes</pre></div><p>Save these<a id="id197" class="indexterm"/> files and go back to Unity to assign the <span class="strong"><strong>TooltipManager</strong></span> type's variables by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the <span class="strong"><strong>Project</strong></span> view, select our <span class="strong"><strong>Bomb</strong></span> prefab and set its <span class="strong"><strong>Type</strong></span> field in <span class="strong"><strong>TooltipManager</strong></span> to <code class="literal">Bomb</code>.</li><li class="listitem">In the <span class="strong"><strong>Project</strong></span> view, select our <span class="strong"><strong>Time</strong></span> prefab and set its <span class="strong"><strong>Type</strong></span> field in <span class="strong"><strong>TooltipManager</strong></span> to <span class="strong"><strong>Time</strong></span>.<p>Click on the play button. When you leave your cursor on the <span class="strong"><strong>Bomb</strong></span> or <span class="strong"><strong>Time</strong></span> power in the <span class="strong"><strong>Available powers</strong></span> slot, our localized tool tip appears! I actually have the feeling that the delay is too long. Let's correct this.</p></li><li class="listitem">Select our <span class="strong"><strong>Camera</strong></span> GameObject from <span class="strong"><strong>UI Root (2D)</strong></span> and set its <span class="strong"><strong>Tooltip Delay</strong></span> value in <span class="strong"><strong>UICamera</strong></span> to <code class="literal">0.3</code>.</li></ol></div><p>That's better—our localized tool tip appears within 0.3 seconds of hovering.</p></div></div></div></div>
<div class="section" title="Tween methods"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec30"/>Tween methods</h1></div></div></div><p>You can<a id="id198" class="indexterm"/> see <a id="id199" class="indexterm"/>all available Tweens by simply typing in <code class="literal">Tween</code> inside any method in your favorite IDE. You will see a list of <code class="literal">Tween</code> classes thanks to autocompletion, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/8667OT_04_02.jpg" alt="Tween methods"/></div><p>The strong point of these classes is that they work in one line and don't have to be executed for each frame; you just have to call their <code class="literal">Begin()</code> method!</p><p>Here, we will apply Tweens on widgets since we only have that in the scene. But keep in mind that it works in the exact same way with other GameObjects since NGUI widgets are GameObjects.</p><div class="section" title="Main menu apparition"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec49"/>Main menu apparition</h2></div></div></div><p>Let's use<a id="id200" class="indexterm"/> the <code class="literal">TweenPosition</code> class to make our main menu appear from the top of the screen on start. We will first use a simple Tween in only one line and then we will add an easing effect with a delay to make it nicer.</p><div class="section" title="Simple Tween"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec19"/>Simple Tween</h3></div></div></div><p>We can<a id="id201" class="indexterm"/> add a <a id="id202" class="indexterm"/>
<span class="strong"><strong>Tween Position</strong></span> component<a id="id203" class="indexterm"/> to our <span class="strong"><strong>Container</strong></span> GameObject in <span class="strong"><strong>MainMenu</strong></span>, but we need to see how we create a <span class="strong"><strong>Tween</strong></span> in code. The following is how we do so:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select our <span class="strong"><strong>Container</strong></span> GameObject from <span class="strong"><strong>MainMenu</strong></span> and create and add a new <code class="literal">AppearFromAbove.cs</code> C# script to it.</li><li class="listitem">Now open this new <code class="literal">AppearFromAbove.cs</code> script and edit the <code class="literal">Start()</code> method so that it first sets the <code class="literal">position</code> value in <code class="literal">Container</code> to a higher value than the screen's height. Then Tween it back to {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>} in 1 second as follows:<div class="informalexample"><pre class="programlisting">void Start () 
{
  //First, set the Menu's Y position to be out of screen:
  this.transform.localPosition = new Vector3(0,1080,0);
  //Start a TweenPosition of 1 second towards {0,0,0}:
  TweenPosition.Begin(this.gameObject, 1, Vector3.zero);
}</pre></div></li></ol></div><p>Click on the play button. We now have our main menu coming down from the top of the screen with only two lines of code!</p></div><div class="section" title="Smooth Tween"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec20"/>Smooth Tween</h3></div></div></div><p>We <a id="id204" class="indexterm"/>created<a id="id205" class="indexterm"/> a simple Tween, but you can also configure your Tween to add a smoothing method and a delay, for example.</p><p>Let's try it now by replacing our <code class="literal">Start()</code> method's code with the following one:</p><div class="informalexample"><pre class="programlisting">void Start () 
{
  //First, set the Menu's Y position to be out of screen
  this.transform.localPosition = new Vector3(0, 1080, 0);
  //Start a TweenPosition of 1.5 second towards {0,0,0}
  TweenPosition tween = TweenPosition.Begin(this.gameObject, 1.5f, Vector3.zero);
  //Add a delay to our Tween
  tween.delay = 1f;
  //Add an easing in and out method to our Tween
  tween.method = UITweener.Method.EaseInOut;
}</pre></div><p>Click<a id="id206" class="indexterm"/> on<a id="id207" class="indexterm"/> the play button. We have added a nice <code class="literal">EaseInOut</code> method to our Tween. The menu's vertical movement is now smoother, and all of this has been added through code. The following is a list of the different Tween methods<a id="id208" class="indexterm"/> that can add effects to Tweens:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">Linear</code>: This will create a simple linear tween—no smoothing</li><li class="listitem" style="list-style-type: disc"><code class="literal">EaseIn</code>: This will make the tween smooth during the beginning</li><li class="listitem" style="list-style-type: disc"><code class="literal">EaseOut</code>: This will make the tween smooth during the end</li><li class="listitem" style="list-style-type: disc"><code class="literal">EaseInOut</code>: This will make the tween smooth both at the beginning and at the end</li><li class="listitem" style="list-style-type: disc"><code class="literal">BounceIn</code>: This will give the tween bounce effect at the beginning</li><li class="listitem" style="list-style-type: disc"><code class="literal">BounceOut</code>: This will give the tween bounce effect at the end</li></ul></div><p>Now that you know how to use the <code class="literal">TweenPosition</code> class<a id="id209" class="indexterm"/>, you are capable of using other Tweens such as TweenScale, TweenRotation, TweenColor or any other available Tween, because they work the same way!</p></div></div></div>
<div class="section" title="Using keys for navigation"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec31"/>Using keys for navigation</h1></div></div></div><p>The UI we have created works with the mouse. We can easily add key navigation for keyboard and controllers. A <span class="strong"><strong>UIButton Keys</strong></span> component<a id="id210" class="indexterm"/> exists <a id="id211" class="indexterm"/>for that purpose. You have to add it to any UI element you want to be accessible with keys (the default <span class="strong"><strong>Inspector</strong></span> window is as follows):</p><div class="mediaobject"><img src="graphics/8667OT_04_03.jpg" alt="Using keys for navigation"/></div><p>Let's try it <a id="id212" class="indexterm"/>now with our <span class="strong"><strong>Play</strong></span>, <span class="strong"><strong>Exit</strong></span>, and <span class="strong"><strong>Options</strong></span> buttons:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select our <span class="strong"><strong>Exit</strong></span>, <span class="strong"><strong>Options</strong></span>, and <span class="strong"><strong>Play</strong></span> GameObjects.</li><li class="listitem">Attach a <span class="strong"><strong>Button Keys</strong></span> component to them by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Interaction</strong></span>.</li><li class="listitem">A pop up will appear, as shown in the following screenshot, asking you if you want to replace or add a collider:<div class="mediaobject"><img src="graphics/8667OT_04_04.jpg" alt="Using keys for navigation"/></div></li><li class="listitem">That's because they already have a <span class="strong"><strong>Box Collider</strong></span> component. Click on <span class="strong"><strong>Replace</strong></span>.</li><li class="listitem">Select the <span class="strong"><strong>Play</strong></span> button and perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Check its <span class="strong"><strong>Starts Selected</strong></span> Boolean.</li><li class="listitem">Drag our <span class="strong"><strong>Exit</strong></span> button into the <span class="strong"><strong>Selected On Left</strong></span> field.</li><li class="listitem">Drag our <span class="strong"><strong>Exit</strong></span> button into the <span class="strong"><strong>Selected On Right</strong></span> field.</li><li class="listitem">Drag our <span class="strong"><strong>Options</strong></span> button into the <span class="strong"><strong>Selected On Down</strong></span> field.</li></ol></div></li><li class="listitem">Select the <span class="strong"><strong>Exit</strong></span> button and perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Drag our <span class="strong"><strong>Play</strong></span> button into the <span class="strong"><strong>Selected On Left</strong></span> field.</li><li class="listitem">Drag our <span class="strong"><strong>Play</strong></span> button into the <span class="strong"><strong>Selected On Right</strong></span> field.</li><li class="listitem">Drag our <span class="strong"><strong>Options</strong></span> button into the <span class="strong"><strong>Selected On Down</strong></span> field.</li></ol></div></li><li class="listitem">Select the <span class="strong"><strong>Options</strong></span> button and perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Drag our <span class="strong"><strong>Exit</strong></span> button into the <span class="strong"><strong>Selected On Left</strong></span> field.</li><li class="listitem">Drag our <span class="strong"><strong>Play</strong></span> button into the <span class="strong"><strong>Selected On Right</strong></span> field.</li><li class="listitem">Drag our <span class="strong"><strong>Play</strong></span> button into the <span class="strong"><strong>Selected On Up</strong></span> field.</li></ol></div></li></ol></div><p>Click on play.<a id="id213" class="indexterm"/> Our <span class="strong"><strong>Play</strong></span> button is selected by default, and if you use your keyboard arrows, you will be able to navigate through those three buttons and validate with <span class="emphasis"><em>Return</em></span>.</p></div>
<div class="section" title="Error notification"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec32"/>Error notification</h1></div></div></div><p>We <a id="id214" class="indexterm"/>want the user to enter a nickname in the input field and select a power before he or she can launch the game.</p><p>Right now, <a id="id215" class="indexterm"/>the user can launch the game regardless of the input and selected power value. Let's correct this by preventing the game's launch and notifying the user, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/8667OT_04_05.jpg" alt="Error notification"/></div><p>We will use a TweenScale through code that will gradually scale up the notification from {0, 0, 0} to {1, 1, 1} by following these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select our <span class="strong"><strong>Tooltip</strong></span> GameObject in the <span class="strong"><strong>Hierarchy</strong></span> window.</li><li class="listitem">Duplicate it with <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>D</em></span>.</li><li class="listitem">Rename this new duplicate as <code class="literal">Notification</code> and perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Set its <span class="strong"><strong>Depth</strong></span> parameter in <span class="strong"><strong>UIPanel</strong></span> to 5.</li><li class="listitem">Remove its <span class="strong"><strong>UITooltip</strong></span> component.</li><li class="listitem">Set its <span class="strong"><strong>Transform</strong></span> position to {<code class="literal">0</code>, <code class="literal">-355</code>, <code class="literal">0</code>}.</li></ol></div></li><li class="listitem">Select our <span class="strong"><strong>Label</strong></span> GameObject in <code class="literal">Notification</code> and perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Change its text to <code class="literal">This is a Notification</code>.</li><li class="listitem">Set the <span class="strong"><strong>Overflow</strong></span> parameter to <span class="strong"><strong>Shrink Content</strong></span>.</li><li class="listitem">Set its <span class="strong"><strong>Pivot</strong></span> parameter to <span class="strong"><strong>Center</strong></span> (middle button + middle button).</li><li class="listitem">Set its <span class="strong"><strong>Dimensions</strong></span> to <code class="literal">550</code> x <code class="literal">80</code>.</li><li class="listitem">Reset its <span class="strong"><strong>Transform</strong></span> position to {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>}.</li></ol></div></li><li class="listitem">Attach <a id="id216" class="indexterm"/>a <span class="strong"><strong>Localize</strong></span> component to it by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>UI</strong></span>.</li><li class="listitem">Select our <span class="strong"><strong>Background</strong></span> GameObject in <code class="literal">Notification</code> and perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Set its <span class="strong"><strong>Pivot</strong></span> parameter to <span class="strong"><strong>Center</strong></span> (middle button + middle button).</li><li class="listitem">Reset its <span class="strong"><strong>Transform</strong></span> position to {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>}.</li><li class="listitem">Set its <span class="strong"><strong>Dimensions</strong></span> parameters to <code class="literal">600</code> x <code class="literal">100</code>.</li></ol></div></li><li class="listitem">Select our <span class="strong"><strong>Notification</strong></span> GameObject and set its <span class="strong"><strong>Transform</strong></span> scale to {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">1</code>}.</li><li class="listitem">Create and attach a new <code class="literal">NotificationManager.cs</code> C# script to it and open this new <code class="literal">NotificationManager.cs</code> script.</li></ol></div><p>Ok. We have our <span class="strong"><strong>Notification</strong></span> GameObject ready with a scale of {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">1</code>}. Let's use the new <code class="literal">NotificationManager.cs</code> script to launch a TweenScale through code when the <span class="strong"><strong>Notification</strong></span> GameObject is activated.</p><p>We will use an enum to define which notification type will be displayed. This time, we will use the <span class="strong"><strong>UILocalize</strong></span> component for localized text and change the <code class="literal">key</code> parameter through code instead of using the <code class="literal">Localization.instance.Get()</code> method.</p><p>First, declare these variables in the <code class="literal">NotificationManager.cs</code> script as shown in the following code snippet:</p><div class="informalexample"><pre class="programlisting">//Create an enum to define Notification Type
public enum Type
{
  Nickname,
  Power
}
//Declare necessary variables
public UILocalize loc;
public Type type;
//Store the Notification to access it in static methods
public static NotificationManager instance;</pre></div><p>Save the script. We will stock the instance of <code class="literal">NotificationManager</code> on the scene in the script to be able to access it from any other script easily.</p><p>First, let's assign our <code class="literal">Loc</code> variable using the <span class="strong"><strong>Inspector</strong></span> window.</p><p>Select our <span class="strong"><strong>Notification</strong></span> GameObject and drag our <span class="strong"><strong>Label</strong></span> GameObject in <span class="strong"><strong>Notification</strong></span> in to the <span class="strong"><strong>Loc</strong></span> field.</p><p>Ok, now<a id="id217" class="indexterm"/> return to our <code class="literal">NotificationManager.cs</code> script. We will first create an <code class="literal">Awake()</code> method with our static instance variable's initialization and disable our <span class="strong"><strong>Notification</strong></span> GameObject to make it invisible when the game starts:</p><div class="informalexample"><pre class="programlisting">void Awake()
{
  //Set the static instance to this NotificationManager
  instance = this;
  //Deactivate Notification GameObject on awake
  gameObject.SetActive(false);
}</pre></div><p>Now that our <code class="literal">Awake()</code> method<a id="id218" class="indexterm"/> is written, let's create an <code class="literal">OnEnable()</code> method<a id="id219" class="indexterm"/> that will declare the <code class="literal">TweenScale</code> object and set the corresponding <code class="literal">key</code> parameter for the <code class="literal">UILocalize</code> component as follows:</p><div class="informalexample"><pre class="programlisting">void OnEnable () 
{
  //Start a TweenScale of 0.5 second towards {1, 1, 1}
  TweenScale tween = TweenScale.Begin(this.gameObject, 0.5f, new Vector3(1,1,1));
  //Add an easing in and out method to our Tween
  tween.method = UITweener.Method.EaseInOut;
  //Set the Localize key to TypeName + "Notification"
  loc.key = type.ToString() + "Notification"; 
  //Force Update the UILocalize with new key
  loc.Localize();
}</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note16"/>Note</h3><p>Don't forget that if you change a <code class="literal">key</code> parameter when the <span class="strong"><strong>UILocalize</strong></span> component is already active, you must call its <code class="literal">Localize()</code> method to update it.</p></div></div><p>Good. Click on the play button. Activate our <span class="strong"><strong>Notification</strong></span> GameObject while Unity is running the play mode.</p><p>You can see that our <span class="strong"><strong>Notification</strong></span> GameObject appears smoothly. Let's add a <code class="literal">Show()</code> method to display it through code as follows:</p><div class="informalexample"><pre class="programlisting">public void Show(Type notificationType, float duration)
{
  //If there is no current Notification
  if(!gameObject.activeInHierarchy)
  {
    //Set the asked Notification type
    type = notificationType;
    //Enable our Notification on scene
    gameObject.SetActive(true);
    //Start Couroutine to remove in asked duration
    StartCoroutine(Remove(duration));
  }
}</pre></div><p>The previous <a id="id220" class="indexterm"/>method shows our notification by activating its corresponding GameObject. The <code class="literal">OnEnable()</code> method will perform the tween and localization.</p><p>On its last line, the <code class="literal">Show()</code> method starts the <code class="literal">Remove()</code> coroutine. Let's add the following <code class="literal">Remove()</code> coroutine that will make the notification disappear after a given duration:</p><div class="informalexample"><pre class="programlisting">public IEnumerator Remove(float duration)
{
  //Wait for the Notification display duration 
  yield return new WaitForSeconds(duration);
  //Start the TweenScale to disappear
  TweenScale.Begin(gameObject, 0.5f, new Vector3(0,0,1));
  //Wait for 0.5s, the duration of the TweenScale
  yield return new WaitForSeconds(0.5f);
  //Deactivate the Notification GameObject
  gameObject.SetActive(false);
}</pre></div><p>Great. Now we can add the right localization strings in <code class="literal">English.txt</code> as follows:</p><div class="informalexample"><pre class="programlisting">NicknameNotification = [AAFFFF]Please Enter a [00FFAA]Nickname[AAFFFF] before you continue!
PowerNotification = [AAFFFF]Please Select a [00FFAA]Power[AAFFFF] before you continue!</pre></div><p>We can also add the correct strings in <code class="literal">French.txt</code> as follows:</p><div class="informalexample"><pre class="programlisting">NicknameNotification = [AAFFFF]Merci d'entrer un [00FFAA]Pseudo[AAFFFF] avant de continuer !
PowerNotification = [AAFFFF]Merci de sélectionner un [00FFAA]Power-Up[AAFFFF] avant de continuer !</pre></div><p>We can now call our <code class="literal">Show()</code> method if the player presses the play button with no nickname entered, or if he or she does not select a power.</p><p>In order to do this, we will remove the current <span class="strong"><strong>Load Level On Click</strong></span> component from our <span class="strong"><strong>Play</strong></span> button and attach a new <code class="literal">LaunchValidator.cs</code> script to it:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select our <code class="literal">Play</code> button GameObject and remove its <span class="strong"><strong>Load Level On Click</strong></span> component.</li><li class="listitem">Create and attach a new <code class="literal">LaunchValidator.cs</code> C# script to it and open this new <code class="literal">LaunchValidator.cs</code> script.</li></ol></div><p>In this <a id="id221" class="indexterm"/>new script, we will need our nickname's <span class="strong"><strong>UIInput</strong></span> component. Let's declare it as follows:</p><div class="informalexample"><pre class="programlisting">public UIInput nicknameInput;</pre></div><p>Save the script. Let's assign this variable right now in the <span class="strong"><strong>Inspector</strong></span> window. Then select our <span class="strong"><strong>Play</strong></span> GameObject and drag our <span class="strong"><strong>Input</strong></span> GameObject from <span class="strong"><strong>Nickname</strong></span> in the <span class="strong"><strong>Nickname Input</strong></span> field in its <span class="strong"><strong>Launch Validator</strong></span>.</p><p>Go back to our <code class="literal">LaunchValidator.cs</code> script. We will now add an <code class="literal">OnClick()</code> method to add a nickname and power validation before we actually load the game, as shown in the following code snippet:</p><div class="informalexample"><pre class="programlisting">void OnClick() 
{
  //If the nickname input is empty...
  if(string.IsNullOrEmpty(nicknameInput.value))
  {
    //...Show a Nickname error notification for 2.5 sec
    NotificationManager.instance.Show(NotificationManager.Type.Nickname, 2.5f);
  }
  //If there's a nickname but no Power is selected...
  else if(GameManager.SelectedPower == Power.Type.None)
  {
    //...Show a Power error notification for 2.5 sec...
    NotificationManager.instance.Show(NotificationManager.Type.Power, 2.5f);
  }
  //If there is a nickname AND a Power selected...
  else
  {
    //... Load Game Scene
    Application.LoadLevel("Game");
  }
}</pre></div><p>Click on the play button. Perfect, we now have notifications that prevent the game from launching if the user has no nickname entered or has no power selected!</p></div>
<div class="section" title="Saving the nickname"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec33"/>Saving the nickname</h1></div></div></div><p>In <a class="link" href="ch02.html" title="Chapter 2. Creating Widgets">Chapter 2</a>, <span class="emphasis"><em>Creating Widgets</em></span>, we entered <code class="literal">Nickname</code> in the <span class="strong"><strong>Auto-save Key</strong></span> parameter of the nickname's <span class="strong"><strong>UIInput</strong></span> component. It<a id="id222" class="indexterm"/> works like this: if the user enters a nickname and presses <span class="emphasis"><em>Return</em></span>, the input's label <code class="literal">string</code> value is saved in the <code class="literal">PlayerPrefs()</code> method<a id="id223" class="indexterm"/> in the <code class="literal">Nickname</code> key.</p><p>Here's the issue: the nickname is saved if, and only if, the user presses <span class="emphasis"><em>Return</em></span>. That's a problem—most of the users will enter a name and select their power directly without pressing <span class="emphasis"><em>Return</em></span>—I'm sure you've done it yourself too.</p><p>We need to save the string in the <code class="literal">PlayerPrefs()</code> method even when the user clicks on the <span class="strong"><strong>Play</strong></span> button without pressing <span class="emphasis"><em>Return</em></span>.</p><p>We must add a line at the end of the <code class="literal">OnClick()</code> method of our <code class="literal">LaunchValidator.cs</code> script, which will save the nickname's input <code class="literal">value</code> before the game scene is loaded. Just before the <code class="literal">Application.LoadLevel("Game")</code> line, add the following:</p><div class="informalexample"><pre class="programlisting">//Save the Nickname to PlayerPrefs before launch
PlayerPrefs.SetString("Nickname", nicknameInput.value);</pre></div><p>Now the user's nickname is saved before launching the game, no matter what!</p></div>
<div class="section" title="Sending messages"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec34"/>Sending messages</h1></div></div></div><p>The <code class="literal">Notify</code> parameter in the <span class="strong"><strong>Inspector</strong></span> window we used in previous chapters to call methods on a precise event is usually enough for sending messages. However, you may need to send a message to another GameObject and maybe to its children too.</p><p>That's where the <span class="strong"><strong>UIButton Message</strong></span> component<a id="id224" class="indexterm"/> comes in handy. We will use this to make our <span class="strong"><strong>MainMenu</strong></span> GameObject scale down before the game actually quits:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select our <span class="strong"><strong>Exit</strong></span> GameObject and perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Attach a <span class="strong"><strong>Button Message</strong></span> component to it by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Interaction</strong></span>.</li><li class="listitem">Drag our <span class="strong"><strong>Container</strong></span> GameObject from <code class="literal">MainMenu</code> into its <span class="strong"><strong>Target</strong></span> field.</li><li class="listitem">Type in <code class="literal">CloseMenu</code> in the <span class="strong"><strong>Function Name</strong></span> parameter.</li></ol></div></li><li class="listitem">Select our <span class="strong"><strong>Container</strong></span> GameObject in <span class="strong"><strong>MainMenu</strong></span> and open its attached <code class="literal">AppearFromAbove.cs</code> script.</li></ol></div><p>In this script,<a id="id225" class="indexterm"/> add a simple <code class="literal">CloseMenu()</code> method containing the following lines:</p><div class="informalexample"><pre class="programlisting">void CloseMenu()
{
  //Tween the menu's scale to zero
  TweenScale.Begin(this.gameObject, 0.5f, Vector3.zero);
}</pre></div><p>Now we need to delay the execution of the <code class="literal">Application.Quit()</code> method<a id="id226" class="indexterm"/>, otherwise we won't see our <span class="strong"><strong>Tween</strong></span>. We do this using the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select our <span class="strong"><strong>GameManager</strong></span> GameObject and perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open its attached <code class="literal">GameManager.cs</code> script.</li><li class="listitem">Replace the line in the <code class="literal">ExitPressed()</code> method<a id="id227" class="indexterm"/> with the following line:<div class="informalexample"><pre class="programlisting">//Call the exit function in 0.5s
Invoke("QuitNow", 0.5f);</pre></div></li></ol></div></li><li class="listitem">Add a new <code class="literal">QuitNow()</code> method to actually exit the application as follows:<div class="informalexample"><pre class="programlisting">void QuitNow()
{
  Application.Quit();
}</pre></div><p>Save the script and click on the play button. When you exit the application, our <span class="strong"><strong>Menu</strong></span> will automatically disappear. That's because the <code class="literal">Invoke()</code> method enables us to call a function with <code class="literal">delay</code> as the second parameter.</p></li></ol></div><p>Let's add this nice scaling effect also when the player launches the game by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select our <span class="strong"><strong>Play</strong></span> button GameObject and open its attached <code class="literal">LaunchValidator.cs</code> script.</li><li class="listitem">We will need our <span class="strong"><strong>Container</strong></span> GameObject from <span class="strong"><strong>MainMenu</strong></span>. Declare it as follows:<div class="informalexample"><pre class="programlisting">public GameObject menuContainer;</pre></div></li><li class="listitem">Go back to Unity and assign this new <span class="strong"><strong>menuContainer</strong></span> variable as follows:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select our <span class="strong"><strong>Play</strong></span> button GameObject and drag our <span class="strong"><strong>Container</strong></span> GameObject from <span class="strong"><strong>MainMenu</strong></span> to its <span class="strong"><strong>MenuContainer</strong></span> field.</li><li class="listitem">Go back to our <code class="literal">LaunchValidator.cs</code> script. We simply have to replace the <code class="literal">Application.LoadLevel("Game")</code> line with the following lines:<div class="informalexample"><pre class="programlisting">menuContainer.SendMessage("CloseMenu");
Invoke("LaunchNow", 0.5f);</pre></div></li></ol></div></li><li class="listitem">Ok, <a id="id228" class="indexterm"/>now we can add a new <code class="literal">LaunchNow()</code> method to actually launch the game scene as follows:<div class="informalexample"><pre class="programlisting">void LaunchNow()
{
  Application.LoadLevel(levelName);
}</pre></div></li></ol></div><p>Great, on exit or game launch, the menu scales out, which makes a nicer transition. We have also learned how to use a <span class="strong"><strong>UIButton Message</strong></span> component.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note17"/>Note</h3><p>We didn't need the <span class="strong"><strong>Include Children</strong></span> Boolean checked. But it's interesting to note that you can send a message to the target and all its children at once.</p></div></div></div>
<div class="section" title="Forwarding an event"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec35"/>Forwarding an event</h1></div></div></div><p>Another component may be useful in some cases: <span class="strong"><strong>UIForward Events</strong></span>. This <a id="id229" class="indexterm"/>component gives you the ability to send the events of the GameObject it's attached to to another GameObject in the scene. It can be useful, for example, to create a multiple selection. Let's try it to make it more clear. Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select our <span class="strong"><strong>Bomb</strong></span> GameObject in <span class="strong"><strong>Grid</strong></span>.</li><li class="listitem">Attach a <span class="strong"><strong>Forward Events</strong></span> component to it by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Interaction</strong></span> and then perform the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Drag our <span class="strong"><strong>Time</strong></span> GameObject from <span class="strong"><strong>Grid</strong></span> to the <code class="literal">Target</code> field.</li><li class="listitem">Check the <span class="strong"><strong>OnHover</strong></span> Boolean.</li><li class="listitem">Check the <span class="strong"><strong>OnPress</strong></span> Boolean.</li><li class="listitem">Check the <span class="strong"><strong>OnDrag</strong></span> Boolean.</li></ol></div></li></ol></div><p>Click on the play button. If you hover, press, and drag the <span class="strong"><strong>Bomb</strong></span> power, the <span class="strong"><strong>Time</strong></span> power will also react the same way! That is what event forwarding does.</p><p>Now that you see how it works, you can remove the <span class="strong"><strong>UIForward Events</strong></span> component from our <span class="strong"><strong>Bomb</strong></span> GameObject.</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec36"/>Summary</h1></div></div></div><p>In this chapter, we used C# with NGUI to create localized tool tips and error notifications. We learned how to use Tween classes to make our main menu appear and disappear smoothly with methods that ease Tweens.</p><p>We also know how to use keys for navigation in our UI, and our nickname is now saved when the game launches. You now know how to send messages and forward events using NGUI components, which may be useful to you in the future.</p><p>It's time to create a new <code class="literal">Game.unity</code> scene and build a complete scrollable viewport, which is the subject of <a class="link" href="ch05.html" title="Chapter 5. Building a Scrollable Viewport">Chapter 5</a>, <span class="emphasis"><em>Building a Scrollable Viewport</em></span>.</p></div></body></html>