<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;New Features in C# 6.0"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. New Features in C# 6.0</h1></div></div></div><p>In this chapter, we will cover the following recipes with regard to the new features of C# 6.0:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating your Visual Studio project</li><li class="listitem" style="list-style-type: disc">String interpolation</li><li class="listitem" style="list-style-type: disc">Null-conditional operator</li><li class="listitem" style="list-style-type: disc">Initializers for auto-implemented properties and getter-only auto properties</li><li class="listitem" style="list-style-type: disc">Index initializers</li><li class="listitem" style="list-style-type: disc">The <code class="literal">nameof</code> expressions</li><li class="listitem" style="list-style-type: disc">Expression-bodied functions and properties</li><li class="listitem" style="list-style-type: disc">Using <code class="literal">static</code></li><li class="listitem" style="list-style-type: disc">Exception filters</li><li class="listitem" style="list-style-type: disc">Using <code class="literal">await</code> operator in <code class="literal">catch</code> and <code class="literal">finally</code> blocks</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Introduction</h1></div></div></div><p>C# as a programming language first appeared in 2000. Its development team is led by the prominent Danish software engineer Anders Hejlsberg. He is the lead architect of C# and core developer of TypeScript. The C# programming language is simple to use, and this book will deal with C# 6.0, which was released on 20 July, 2015.</p><p>Knowing what new language features are available in C# 6.0 will not only make you a more effective developer, but <a class="indexterm" id="id0"/>will also allow you to implement the latest and best practices in the software that you create. A little-known fact is that C# was actually called <span class="strong"><strong>C-like Object Oriented Language</strong></span> (<span class="strong"><strong>Cool</strong></span>) before its release at Microsoft's <span class="emphasis"><em>Professional Developers Conference</em></span> in July 2000, but was changed to C# at the time of its release.</p><p>The name might have changed, but C# remains a very cool language to learn and use. This chapter will take you through the new features of C# 6.0 and illustrate how to effectively use these features in you daily programming tasks.</p></div></div>
<div class="section" title="Creating your Visual Studio project"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Creating your Visual Studio project</h1></div></div></div><p>The Visual Studio project that <a class="indexterm" id="id1"/>you will create will be used to add the classes that contain the code samples in each recipe of this book. The project will be a simple console application that will call into static classes that do the work of illustrating the recipe code and outputting the results (if any) to the console window.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec12"/>Getting ready</h2></div></div></div><p>To step through the<a class="indexterm" id="id2"/> recipes in this book, you will need a copy of Visual Studio 2015. If you do<a class="indexterm" id="id3"/> not have a copy of Visual Studio 2015, you can download a free copy of Visual Studio 2015 Community from <a class="ulink" href="https://www.visualstudio.com/en-us/products/visual-studio-community-vs.aspx">https://www.visualstudio.com/en-us/products/visual-studio-community-vs.aspx</a>.</p><p>You can also compare editions of <a class="indexterm" id="id4"/>Visual Studio 2015 by navigating to <a class="ulink" href="https://www.visualstudio.com/en-us/products/compare-visual-studio-2015-products-vs.aspx">https://www.visualstudio.com/en-us/products/compare-visual-studio-2015-products-vs.aspx</a>.</p><p>After you have downloaded and installed Visual Studio 2015, create a new console application that will contain the recipes illustrated in this book.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec13"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Start Visual Studio 2015 and click on the <span class="strong"><strong>File</strong></span> menu. Then, click on <span class="strong"><strong>New</strong></span> and then select <span class="strong"><strong>Project</strong></span>. You can also use the <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>N</em></span> keyboard shortcut:<div class="mediaobject"><img alt="How to do it…" src="graphics/B05391_01_01.jpg"/></div></li><li class="listitem">From the <span class="strong"><strong>New </strong></span><a class="indexterm" id="id5"/><span class="strong"><strong>Project</strong></span> dialog screen, select <span class="strong"><strong>Console Application</strong></span>, which can be found by going to <span class="strong"><strong>Installed</strong></span> | <span class="strong"><strong>Templates</strong></span> | <span class="strong"><strong>Visual C#</strong></span> | <span class="strong"><strong>Windows</strong></span> | <span class="strong"><strong>Classic Desktop</strong></span> in the tree view to the left. You can call your console application <code class="literal">CodeSamples</code>:<div class="mediaobject"><img alt="How to do it…" src="graphics/B05391_01_02.jpg"/></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>You will notice that the<a class="indexterm" id="id6"/> selected framework is <span class="strong"><strong>.NET Framework 4.6.1</strong></span>, which is selected by default. Leave this framework selected when creating your project.</p></div></div></li><li class="listitem">Visual Studio now creates your console application, which we will use to create all the code samples needed for this book.</li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec14"/>How it works…</h2></div></div></div><p>This console application will form the base of the recipes in this book. Each recipe can be individually added to this console application. A recipe, therefore, can function on its own without the need to create a previous recipe. You can also easily separate any custom code you might want to add and experiment with. It is also recommended that you play around with the code by adding classes of your own.</p></div></div>
<div class="section" title="String interpolation"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/>String interpolation</h1></div></div></div><p>String interpolation is a very<a class="indexterm" id="id7"/> easy and precise way to inject variable values into a string. An interpolated string expression looks at contained expressions. It then replaces those expressions with the <code class="literal">ToString</code> representations of the expressions' results.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec15"/>Getting ready</h2></div></div></div><p>Create a new class to test your code. We will use the example of reading the current exchange rate for a specific currency to illustrate how string interpolation can be used to output strings to the user interface.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec16"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new class by right-clicking on your solution, selecting <span class="strong"><strong>Add,</strong></span> and then selecting <span class="strong"><strong>New Project</strong></span> from the context menu:<div class="mediaobject"><img alt="How to do it…" src="graphics/B05391_01_03.jpg"/></div></li><li class="listitem">From the<a class="indexterm" id="id8"/> <span class="strong"><strong>Add New Project</strong></span> dialog screen, select <span class="strong"><strong>Class Library</strong></span> from the installed templates and call your class <code class="literal">Chapter1</code>:<div class="mediaobject"><img alt="How to do it…" src="graphics/B05391_01_04.jpg"/></div></li><li class="listitem">Your new class<a class="indexterm" id="id9"/> library will be added to your solution with a default name of <code class="literal">Class1.cs</code>, which I renamed to <code class="literal">Recipes.cs</code> in order to distinguish the code properly. You can, however, rename your class to whatever you like if that makes more sense to you.</li><li class="listitem">To rename your class, simply click on the class name in <span class="strong"><strong>Solution Explorer</strong></span> and select <span class="strong"><strong>Rename</strong></span> from the context menu:<div class="mediaobject"><img alt="How to do it…" src="graphics/B05391_01_05.jpg"/></div></li><li class="listitem">Visual Studio will ask<a class="indexterm" id="id10"/> you to confirm a rename of all references to the <span class="strong"><strong>Class1</strong></span> code element in the project. Just click on <span class="strong"><strong>Yes</strong></span>:<div class="mediaobject"><img alt="How to do it…" src="graphics/B05391_01_06.jpg"/></div></li><li class="listitem">The class that is<a class="indexterm" id="id11"/> created now needs to be made static using the <code class="literal">static</code> keyword. Also, rename the class name in code to <code class="literal">Recipe1StringInterpolation</code>:<div class="informalexample"><pre class="programlisting">namespace Chapter1
{
    public static class Recipe1StringInterpolation
    {

    }
}</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>Note that static classes, therefore, do not need to be instantiated and will be sealed classes by default. This means that they cannot be inherited further. In practice, you would normally define helper or utility classes as static. These are classes that will be used often by your application to, for example, parse dates or perform calculations. The use of the <code class="literal">static</code> keyword here is simply to illustrate the specific new features of C# 6.0 within a class that can easily and quickly be called from the console application. The static class in reality would most likely not be a good fit for all the examples illustrated.</p></div></div></li><li class="listitem">Inside your class, add a property to contain the base currency:<div class="informalexample"><pre class="programlisting">public static string BaseCurrency { get; private set; }</pre></div></li><li class="listitem">Next, include a dummy method to return the exchange rate:<div class="informalexample"><pre class="programlisting">private static decimal PreformConversion(string toCurrency)
{
    decimal rate = 0.0m;

    if (BaseCurrency.Equals("ZAR"))
    {
        switch (toCurrency)
        {
            case "USD":
                rate = 16.3040m;
                break;
            default:
                rate = 1.0m;
                break;
        }
    }
            
    return rate;
}</pre></div></li><li class="listitem">The last method to <a class="indexterm" id="id12"/>add is the method that will return the interpolated string expression:<div class="informalexample"><pre class="programlisting">public static string ReadExchangeRate(string fromCurrencyCode, string toCurrencyCode)
{
    BaseCurrency = fromCurrencyCode;
    decimal conversion = PreformConversion(toCurrencyCode);
    return $"1 {toCurrencyCode} = {conversion} {fromCurrencyCode} ";
}</pre></div></li><li class="listitem">You now need to hook up the class you created to your console application. You therefore need to add a reference to the class from the console application. Right-click on <span class="strong"><strong>References</strong></span> in your <code class="literal">CodeSamples</code> project and select <span class="strong"><strong>Add Reference…</strong></span>:<div class="mediaobject"><img alt="How to do it…" src="graphics/B05391_01_07.jpg"/></div></li><li class="listitem">From the <span class="strong"><strong>Reference </strong></span><a class="indexterm" id="id13"/><span class="strong"><strong>Manager</strong></span> dialog that pops up, select the <code class="literal">Chapter1</code> solution to add it as a reference. Then, click on the <span class="strong"><strong>OK</strong></span> button:<div class="mediaobject"><img alt="How to do it…" src="graphics/B05391_01_08.jpg"/></div></li><li class="listitem">In your <code class="literal">CodeSamples</code> project, double-click on the <code class="literal">Program.cs</code> file and add the following code to<a class="indexterm" id="id14"/> the <code class="literal">Main</code> method:<div class="informalexample"><pre class="programlisting">string RandDollarExchangeRate = Chapter1.Recipe1StringInterpolation.ReadExchangeRate("ZAR", "USD");
Console.WriteLine("The current Rand / Dollar exchange rate is:");
Console.WriteLine(RandDollarExchangeRate);
Console.Read();</pre></div></li><li class="listitem">To see the result, run your application and see the output in the console application:<div class="mediaobject"><img alt="How to do it…" src="graphics/B05391_01_09.jpg"/></div></li><li class="listitem">The interpolated<a class="indexterm" id="id15"/> string expression is output as <code class="literal">1 USD = 16,3040 ZAR</code>.</li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec17"/>How it works…</h2></div></div></div><p>The console<a class="indexterm" id="id16"/> application passes the currency codes for South African Rand and US Dollar to the static class by calling the following line of code: <code class="literal">Chapter1.Recipe1StringInterpolation.ReadExchangeRate("ZAR", "USD");</code>
</p><p>This class is static and, as mentioned previously, does not need to be instantiated. The <code class="literal">ReadExchangeRate</code> method then reads the exchange rate and formats it into a suitable string using string interpolation. You will notice that the interpolated string expression is written as <code class="literal">$"1 {toCurrencyCode} = {conversion} {fromCurrencyCode} ";</code>.</p><p>The <code class="literal">toCurrencyCode</code>, <code class="literal">conversion</code>, and <code class="literal">fromCurrencyCode</code> variables are expressed directly inside the string expression. This is a much easier way of formatting strings because you can do away with <code class="literal">String.Format</code>, used in the previous versions of C#. Previously, the same expression would have been written as <code class="literal">String.Format("1 {0} = {1} {2} ", toCurrencyCode, conversion, fromCurrencyCode);</code>.</p><p>As you can see, the interpolated string expression is much easier to read and write. In reality though, string interpolation is merely syntactical sugar because the compiler treats the expression like <code class="literal">String.Format</code> anyway. You might be wondering how you would express a curly bracket when using string interpolation. To do this, you can simply use a double curly bracket in your expression. If you need to express the exchange rate as <code class="literal">{16,3040}</code>, you would need to express it as <code class="literal">$"{{{conversion}}}";</code>.</p><p>You can also format your<a class="indexterm" id="id17"/> string right there inside the interpolated string expression. If you returned the <code class="literal">$"The date is {DateTime.Now}";</code> expression, the output would be <code class="literal">The date is 2016/01/10 3:04:48 PM</code>. You can go ahead and modify the expression to format the date using a colon, followed by the format to use. Change the code to <code class="literal">$"The date is {DateTime.Now : MMMM dd, yyyy}";</code>. The output will be formatted and result in <code class="literal">The date is January 5, 2016</code>.</p><p>Another great tip is that you can express a condition in the string expression. Consider the following line of code that determines whether a year is a leap year or not:</p><div class="informalexample"><pre class="programlisting">$"The year {DateTime.Now.Year} {(DateTime.IsLeapYear(DateTime.Now.Year) ? " is " : " is not ")} a leap year.";</pre></div><p>We can use the ternary <code class="literal">?</code> operator one step further. Consider the following line of code:</p><div class="informalexample"><pre class="programlisting">$"There {(StudentCount &gt; 1 ? "are " : "is ")}{StudentCount} student{(StudentCount &gt; 1 ? "s" : "")} in the list."</pre></div><p>As the colon is used to denote formatting, we have to wrap the conditional part of the expression in parenthesis. String interpolation is a very nice way to express strings in code that is easy to read and understand.</p></div></div>
<div class="section" title="Null-conditional operator"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Null-conditional operator</h1></div></div></div><p>The worst thing that a<a class="indexterm" id="id18"/> developer can do is not check for null in code. This means that there is no reference to an object, in other words, there is a null. Reference-type variables have a default value of null. Value types, on the other hand, cannot be null. In C# 2, developers were introduced to the nullable type. To effectively make sure that objects are not null, developers usually write sometimes elaborate <code class="literal">if</code> statements to check whether objects are null or not. C# 6.0 made this process very easy with the introduction of the null-conditional operator.</p><p>It is expressed by writing <code class="literal">?.</code> and is called the<a class="indexterm" id="id19"/> question-dot operator. The question is written after the instance, right before calling the property via the dot. An easy way to think of the null-conditional operator is to remember that if the left-hand side of the operator is null, the whole expression is null. If the left-hand side is not null, the property is invoked and becomes the result of the operation. To really see the power of the null-conditional operator is to see it in action.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec18"/>Getting ready</h2></div></div></div><p>We will create another class that will illustrate the use of the null-conditional operator. The method will call a <code class="literal">Student</code> class to<a class="indexterm" id="id20"/> return a count of students in the resulting list. We will check to see whether the <code class="literal">Student</code> class is valid before returning the student count.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec19"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create another class called <code class="literal">Recipe2NullConditionalOperator</code> beneath the last class you<a class="indexterm" id="id21"/> wrote in the <span class="emphasis"><em>Creating your Visual Studio project</em></span> recipe:<div class="informalexample"><pre class="programlisting">public static class Recipe2NullConditionalOperator
{

}</pre></div></li><li class="listitem">Add a method called <code class="literal">GetStudents</code> to the class and add the following code to it:<div class="informalexample"><pre class="programlisting">public static int GetStudents()
{
    List&lt;Student&gt; students = new List&lt;Student&gt;(); 
    Student st = new Student();

    st.FirstName = "Dirk";
    st.LastName = "Strauss";
    st.JobTitle = "";
    st.Age = 19;
    st.StudentNumber = "20323742";
    students.Add(st);

    st.FirstName = "Bob";
    st.LastName = "Healey";
    st.JobTitle = "Lab Assistant";
    st.Age = 21;
    st.StudentNumber = "21457896";
    students.Add(st);

    return students?.Count() ?? 0;            
}</pre></div></li><li class="listitem">Next, add a third class to your code called <code class="literal">Student</code> with the following properties:<div class="informalexample"><pre class="programlisting">public class Student
{
    public string StudentNumber { get; set; }
    public string FirstName { get; set; }
    public string LastName { get; set; }
    public int Age { get; set; }
    public string JobTitle { get; set; }
}</pre></div></li><li class="listitem">Our <code class="literal">Student</code> class will be<a class="indexterm" id="id22"/> the object we will call from our <code class="literal">GetStudents</code> method. In the <code class="literal">Program.cs</code> file, add the following code:<div class="informalexample"><pre class="programlisting">int StudentCount = Chapter1.Recipe2NullConditionalOperator.GetStudents();
            if (StudentCount &gt;= 1)
                Console.WriteLine($"There {(StudentCount &gt; 1 ? "are " : "is ")}{StudentCount} student{(StudentCount &gt; 1 ? "s" : "")} in the list.");
            else
                Console.WriteLine($"There were {StudentCount} students contained in the list.");
            Console.Read();</pre></div></li><li class="listitem">Running the console application<a class="indexterm" id="id23"/> will result in the application telling us that there are two students contained in the list. This is expected, because we added two <code class="literal">Student</code> objects to our <code class="literal">List&lt;Student&gt;</code> class:<div class="mediaobject"><img alt="How to do it…" src="graphics/B05391_01_10.jpg"/></div></li><li class="listitem">To see the null-conditional operator in action, modify the code in your <code class="literal">GetStudents</code> method to<a class="indexterm" id="id24"/> set the <code class="literal">students</code> variable to null. Your code should look like this:<div class="informalexample"><pre class="programlisting">public static int GetStudents()
{
    List&lt;Student&gt; students = new List&lt;Student&gt;(); 
    Student st = new Student();

    st.FirstName = "Dirk";
    st.LastName = "Strauss";
    st.JobTitle = "";
    st.Age = 19;
    st.StudentNumber = "20323742";
    students.Add(st);

    st.FirstName = "Bob";
    st.LastName = "Healey";
    st.JobTitle = "Lab Assistant";
    st.Age = 21;
    st.StudentNumber = "21457896";
    students.Add(st);

    students = null;
    return students?.Count() ?? 0;            
}</pre></div></li><li class="listitem">Run the console application again, and see how the output has changed:<div class="mediaobject"><img alt="How to do it…" src="graphics/B05391_01_11.jpg"/></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec20"/>How it works…</h2></div></div></div><p>Consider the code we used in the <code class="literal">return</code> statement:</p><div class="informalexample"><pre class="programlisting">return students?.Count() ?? 0;</pre></div><p>We told the compiler to check whether the <code class="literal">List&lt;Student&gt;</code> class' variable <code class="literal">students</code> is null. We did this by adding <code class="literal">?</code> after the <code class="literal">students</code> object. If the <code class="literal">students</code> object is not null, we use the dot operator, and the <code class="literal">Count()</code> property becomes the result of the statement.</p><p>If the <code class="literal">students</code> object however is null, then we return zero. This way of checking for null makes all that <code class="literal">if(students != null)</code> code unnecessary. The null check sort of fades into the background and<a class="indexterm" id="id25"/> makes it much easier to express and read null checks (not to mention less code).</p><p>If we had to change the <code class="literal">return</code> statement to a regular <code class="literal">Count()</code> method without the null-conditional operator, we would see an <code class="literal">ArgumentNullException was unhandled</code> error:</p><div class="informalexample"><pre class="programlisting">return students.Count();</pre></div><p>Calling <code class="literal">Count()</code> on the <code class="literal">students</code> object without using the null-conditional operator breaks the code. The null-conditional operator is an exciting addition to the C# language because it makes writing code to check for null a lot easier. Less code is better code.</p></div></div>
<div class="section" title="Initializers for auto-implemented properties and getter-only auto properties"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Initializers for auto-implemented properties and getter-only auto properties</h1></div></div></div><p>The release of C# 6.0 saw two enhancements made to auto-implemented properties. You can now initialize auto-implemented <a class="indexterm" id="id26"/>properties inline, and you can also define<a class="indexterm" id="id27"/> them without a setter.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec21"/>Getting ready</h2></div></div></div><p>To illustrate how to implement these two new enhancements to auto-implemented properties, we will create another class that calculates the sales price after discount for a given barcode and discount type.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec22"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Start off by creating a static class called <code class="literal">Recipe3AutoImplementedProperties</code> and add the <code class="literal">DiscountType</code> enumerator to the class, along with the auto-implemented properties. You will then initialize those auto-implemented properties with default values:<div class="informalexample"><pre class="programlisting">public static class Recipe3AutoImplementedProperties
{
    public enum DiscountType { Sale, Clearout, None }
    private static int SaleDiscountPercent { get; } = 20;
    private static int ClearoutDiscountPercent { get; } = 35;
    public static decimal ShelfPrice { get; set; } = 100;
    public static decimal SalePrice { get; set; } = 100;
}</pre></div></li><li class="listitem">The next step is to add the method to calculate the sales price of an item linked to the barcode supplied to the method:<div class="informalexample"><pre class="programlisting">public static void CalculateSalePrice(string barCode, DiscountType discount)
{
  decimal shelfPrice = GetPriceFromBarcode(barCode);

  if (discount == DiscountType.Sale)
    SalePrice = (shelfPrice == 0 ? ShelfPrice.CalculateSalePrice(SaleDiscountPercent) : shelfPrice.CalculateSalePrice(SaleDiscountPercent));

  if (discount == DiscountType.Clearout)
   SalePrice = (shelfPrice == 0 ? ShelfPrice.CalculateSalePrice(ClearoutDiscountPercent): shelfPrice.CalculateSalePrice(ClearoutDiscountPercent));

  if (discount == DiscountType.None)
    SalePrice = (shelfPrice == 0 ? ShelfPrice :shelfPrice);
}</pre></div></li><li class="listitem">In order to simulate a database lookup to find the selling price of a barcode, create another method to return a price for a given barcode:<div class="informalexample"><pre class="programlisting">private static decimal GetPriceFromBarcode(string barCode)
{            
    switch (barCode)
    {
        case "123450":
            return 19.95m;                    
        case "123451":
            return 7.55m;
        case "123452":
            return 59.99m;
        case "123453":
            return 93.99m;
        default:
            return 0;
    }
}</pre></div></li><li class="listitem">Finally, we will <a class="indexterm" id="id28"/>create an extension method class to<a class="indexterm" id="id29"/> calculate the sale price after the discount has been applied:<div class="informalexample"><pre class="programlisting">public static class ExtensionMethods
{
    public static decimal CalculateSalePrice(this decimal shelfPrice, int discountPercent)
    {
        decimal discountValue = (shelfPrice / 100) * discountPercent;
        return shelfPrice - discountValue;
    }
}</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>Extension methods are static methods by default and allow you to extend your code's functionality (extend existing types) without having to modify the original type. You can now have an extension methods class in your solution where you add helpful code. A nice example of using an extension method is to calculate the financial year for a given date. Extension methods are differentiated from other static methods using the <code class="literal">this</code> keyword in the method signature. In the preceding example, the compiler knows that this is an extension method for the decimal class by looking at the type it extends.</p></div></div></li><li class="listitem">Replace the code of <a class="indexterm" id="id30"/>your <code class="literal">Progam.cs</code> file and run the program:<div class="informalexample"><pre class="programlisting">string BarCode = String.Empty;

BarCode = "123450";
Chapter1.Recipe3AutoImplementedProperties.CalculateSalePric e(BarCode, Chapter1.Recipe3AutoImplementedProperties.DiscountType.Sale );
Console.WriteLine(Chapter1.Recipe3AutoImplementedProperties .SalePrice);</pre></div></li><li class="listitem">The sales price is <a class="indexterm" id="id31"/>calculated after applying the sale discount and returned to the console application:<div class="mediaobject"><img alt="How to do it…" src="graphics/B05391_01_12.jpg"/></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec23"/>How it works…</h2></div></div></div><p>If you look at the auto-implemented properties again, you would notice that we have two getter-only auto-implemented properties. All four auto-implemented properties have been initialized with default values. The <code class="literal">SaleDiscountPercent</code> and <code class="literal">ClearoutDiscountPercent</code> properties are read-only. This ensures that the discount values can't be modified in any way.</p><p>You will also notice that if the shelf price returned from the <code class="literal">GetPriceFromBarcode</code> method is zero, then the<a class="indexterm" id="id32"/> default <code class="literal">ShelfPrice</code> property value is used in determining the discount price. If no discount is applied, the <code class="literal">CalculateSalePrice</code> method simply returns the barcode price. If no price is determined from the barcode, the default <code class="literal">ShelfPrice</code> property value is returned.</p><p>Auto-implemented property initializers and getter-only auto-implemented properties are great to cut down on<a class="indexterm" id="id33"/> unnecessary <code class="literal">if</code> <code class="literal">else</code> statements. It also makes the code implementing the properties more readable because the intent can be contained in the property itself by initializing it.</p><p>Look at what happens if we try to set the <code class="literal">SaleDiscountPercent</code> or <code class="literal">ClearoutDiscountPercent</code> property to a different value:</p><div class="mediaobject"><img alt="How it works…" src="graphics/B05391_01_13.jpg"/></div><p>Visual Studio will emit an error for the getter-only properties because using the <code class="literal">get</code> keyword, we can only read from this property, not assign a value to it.</p></div></div>
<div class="section" title="Index initializers"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec14"/>Index initializers</h1></div></div></div><p>You need to remember that C# 6.0 does not introduce big new concepts, but small features designed to make your code cleaner and easier to read and understand. With index initializers, this is not an <a class="indexterm" id="id34"/>exception. You can now initialize the indices of newly created objects. This means you do not have to use separate statements to initialize the indexes.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec24"/>Getting ready</h2></div></div></div><p>The change here is subtle. We will create a method to return the day of the week based on an integer. We will also create a method to return the start of the financial year and salary increase month, and then set the <a class="indexterm" id="id35"/>salary increase month to a different value than the default. Finally we will use properties to return a specific type of species to the console window.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec25"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Start off by creating a new class called <code class="literal">Recipe4IndexInitializers</code> and add a second class called <code class="literal">Month</code> to your code. The <code class="literal">Month</code> class simply contains two auto-implemented properties that have been initialized. <code class="literal">StartFinancialYearMonth</code> has been set to month two (February), and <code class="literal">SalaryIncreaseMonth</code> has been set to month three (March):<div class="informalexample"><pre class="programlisting">public static class Recipe4IndexInitializers
{

}
    
public class Month
{
    public int StartFinancialYearMonth { get; set; } = 2;
    public int SalaryIncreaseMonth { get; set; } = 3;
}</pre></div></li><li class="listitem">Go ahead and add a method called <code class="literal">ReturnWeekDay</code> that takes an integer for the day number as a parameter, to the <code class="literal">Recipe4IndexInitializers</code> class:<div class="informalexample"><pre class="programlisting">public static string ReturnWeekDay(int dayNumber)
{
    Dictionary&lt;int, string&gt; day = new Dictionary&lt;int, string&gt;
    {
        [1] = "Monday",
        [2] = "Tuesday",
        [3] = "Wednesday",
        [4] = "Thursday",
        [5] = "Friday",
        [6] = "Saturday",
        [7] = "Sunday"
    };

    return day[dayNumber];
}</pre></div></li><li class="listitem">For the second example, add a method called <code class="literal">ReturnFinancialAndBonusMonth</code> to the <code class="literal">Recipe4IndexInitializers</code> class:<div class="informalexample"><pre class="programlisting">public static List&lt;int&gt; ReturnFinancialAndBonusMonth()
{
    Month currentMonth = new Month();
    int[] array = new[] { currentMonth.StartFinancialYearMonth, currentMonth.SalaryIncreaseMonth };
    return new List&lt;int&gt;(array) { [1] = 2 };  
}</pre></div></li><li class="listitem">Finally, add <a class="indexterm" id="id36"/>several auto-implemented properties to the class to contain species and a method called <code class="literal">DetermineSpecies</code> to the <code class="literal">Recipe4IndexInitializers</code> class. Your code should look like this:<div class="informalexample"><pre class="programlisting">public static string Human { get; set; } = "Homo sapiens";
public static string Sloth { get; set; } = "Choloepus hoffmanni";
public static string Rabbit { get; set; } = "Oryctolagus cuniculus";
public static string Mouse { get; set; } = "Mus musculus";
public static string Hedgehog { get; set; } = "Erinaceus europaeus";
public static string Dolphin { get; set; } = "Tursiops truncatus";
public static string Dog { get; set; } = "Canis lupus familiaris";

public static void DetermineSpecies()
{
    Dictionary&lt;string, string&gt; Species =  new Dictionary&lt;string, string&gt;
    {
        [Human] = Human + " : Additional species information",
        [Rabbit] = Rabbit + " : Additional species information",
        [Sloth] = Sloth + " : Additional species information",
        [Mouse] = Mouse + " : Additional species information",
        [Hedgehog] = Hedgehog + " : Additional species information",
        [Dolphin] = Dolphin + " : Additional species information",
        [Dog] = Dog + " : Additional species information"
    };

    Console.WriteLine(Species[Human]);            
}</pre></div></li><li class="listitem">In your console application, add the following code to call the code in the <code class="literal">Recipe4IndexInitializers</code> class:<div class="informalexample"><pre class="programlisting">int DayNumber = 3;
string DayOfWeek = Chapter1.Recipe4IndexInitializers.ReturnWeekDay(DayNumber);
Console.WriteLine($"Day {DayNumber} is {DayOfWeek}");
                        
List&lt;int&gt; FinancialAndBonusMonth = Chapter1.Recipe4IndexInitializers.ReturnFinancialAndBonusMo nth();
Console.WriteLine("Financial Year Start month and Salary Increase Months are:");
for (int i = 0; i &lt; FinancialAndBonusMonth.Count(); i++)
{
    Console.Write(i == 0 ? FinancialAndBonusMonth[i].ToString() + " and " : FinancialAndBonusMonth[i].ToString());
}

Console.WriteLine();
Chapter1.Recipe4IndexInitializers.DetermineSpecies();
Console.Read();</pre></div></li><li class="listitem">Once you have added all <a class="indexterm" id="id37"/>your code, run your application. The output will look like this:<div class="mediaobject"><img alt="How to do it…" src="graphics/B05391_01_14.jpg"/></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec26"/>How it works…</h2></div></div></div><p>The first method <code class="literal">ReturnWeekDay</code> created a <code class="literal">Dictionary&lt;int, string&gt;</code> object. You can see how the indices are initialized with the day names. If we now pass the day integer to the method, we can return<a class="indexterm" id="id38"/> the day name by referencing the index.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>The reason for not using a zero-based index in <code class="literal">ReturnWeekDay</code> is because the first day of the week is associated to the numerical value 1.</p></div></div><p>In the second example, we called a method called <code class="literal">ReturnFinancialAndBonusMonth</code> that creates an array to hold the financial year start month and the salary increase month. Both properties of the <code class="literal">Month</code> class are initialized to <code class="literal">2</code> and <code class="literal">3</code>, respectively. You can see that we are overriding the value of the <code class="literal">SalaryIncreaseMonth</code> property and setting it to <code class="literal">2</code>. It is done in the following line of code:</p><div class="informalexample"><pre class="programlisting">return new List&lt;int&gt;(array) { [1] = 2 };</pre></div><p>The last example uses the <code class="literal">Human</code>, <code class="literal">Rabbit</code>, <code class="literal">Sloth</code>, <code class="literal">Mouse</code>, <code class="literal">Hedgehog</code>, <code class="literal">Dolphin</code>, and <code class="literal">Dog</code> properties to return the correct index value of the <code class="literal">Species</code> object.</p></div></div>
<div class="section" title="The nameof expressions"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec15"/>The nameof expressions</h1></div></div></div><p>The <code class="literal">nameof</code> expressions are particularly nice. You can now provide a string that names an object in code. This is especially handy if you are throwing exceptions. You can now see which variable caused the exception. In the past, developers had to rely on messy string literals in their code. This was particularly error prone and vulnerable to spelling errors. Another problem was<a class="indexterm" id="id39"/> that any code refactoring might miss a string literal, and then that code becomes obsolete and broken.</p><p>The <code class="literal">nameof</code> expressions have come to save the day. The compiler will see that you are referencing the name of a specific variable and correctly convert it to a string. <code class="literal">nameof</code> expressions, therefore, also stay in sync with any refactoring you may do.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec27"/>Getting ready</h2></div></div></div><p>We will use the same code example that we wrote in the <span class="emphasis"><em>String interpolation</em></span> recipe from this chapter, with a few small<a class="indexterm" id="id40"/> changes. We will create a <code class="literal">Student</code> object and add students to it. We will then return that object to the console and output the student count.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec28"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a class called <code class="literal">Recipe5NameofExpression</code>. Add an auto-implemented property to this class called <code class="literal">StudentCount</code>:<div class="informalexample"><pre class="programlisting">public static class Recipe5NameofExpression
{
    public static int StudentCount { get; set; } = 0;
}</pre></div></li><li class="listitem">Next, we need to add the <code class="literal">GetStudents</code> method, which returns a <code class="literal">List&lt;Student&gt;</code> object. The method contains a <code class="literal">try</code>/<code class="literal">catch</code> statement and will throw <code class="literal">ArgumentNullException()</code>:<div class="informalexample"><pre class="programlisting">public static List&lt;Student&gt; GetStudents()
{
    List&lt;Student&gt; students = new List&lt;Student&gt;();
    try
    {                
        Student st = new Student();

        st.FirstName = "Dirk";
        st.LastName = "Strauss";
        st.JobTitle = "";
        st.Age = 19;
        st.StudentNumber = "20323742";
        students.Add(st);

        st.FirstName = "Bob";
        st.LastName = "Healey";
        st.JobTitle = "Lab Assistant";
        st.Age = 21;
        st.StudentNumber = "21457896";
        students.Add(st);

        //students = null;

        StudentCount = students.Count();

        return students;
    }
    catch (Exception ex)
    {
        throw new ArgumentNullException(nameof(students));
    }
}</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>In reality, we would not simply return <code class="literal">ArgumentNullException</code> off the bat like that. This is simply being used to illustrate the concept of the <code class="literal">nameof</code> expression as used in <code class="literal">ArgumentNullException</code>.</p></div></div></li><li class="listitem">In the console<a class="indexterm" id="id41"/> application, we will add code that returns the <code class="literal">List&lt;Student&gt;</code> object and reports how many students were contained in the list by outputting the <code class="literal">StudentCount</code> property value to the console window:<div class="informalexample"><pre class="programlisting">try
{
    List&lt;Chapter1.Student&gt; StudentList = Chapter1.Recipe5NameofExpression.GetStudents();
    Console.WriteLine($"There are {Chapter1.Recipe5NameofExpression.StudentCount} students");                
}
catch (Exception ex)
{
    Console.WriteLine(ex.Message);
}
finally
{
    Console.Read();
}</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec29"/>How it works…</h2></div></div></div><p>Running the console application<a class="indexterm" id="id42"/> with the code as is will call the <code class="literal">GetStudents()</code> method. This will then create the <code class="literal">List&lt;Student&gt;</code> object and add two <code class="literal">Student</code> objects to it. The <code class="literal">StudentCount</code> property is set equal to the count of the <code class="literal">List&lt;Student&gt;</code> object. The <code class="literal">GetStudents()</code> method then returns the result to the console application, which then reads the <code class="literal">StudentCount</code> property and displays it in the console output:</p><div class="mediaobject"><img alt="How it works…" src="graphics/B05391_01_15.jpg"/></div><p>If we now went ahead and modified the code in the <code class="literal">GetStudents()</code> method to set the <code class="literal">students</code> variable to <code class="literal">null</code> right before we called <code class="literal">students.Count()</code>, an exception would be thrown. The exception is caught in <code class="literal">catch</code>, and this is where we use the <code class="literal">nameof</code> expression to display a string literal of the <code class="literal">students</code> variable:</p><div class="mediaobject"><img alt="How it works…" src="graphics/B05391_01_16.jpg"/></div><p>Using the <code class="literal">nameof</code> expression, we<a class="indexterm" id="id43"/> can ensure that the expression stays in sync with refactoring actions such as renaming the <code class="literal">students</code> variable:</p><div class="mediaobject"><img alt="How it works…" src="graphics/B05391_01_17.jpg"/></div><p>If we had written the code<a class="indexterm" id="id44"/> in the <code class="literal">catch</code> statement using a string literal, we would not have had the code updated automatically when we renamed the <code class="literal">students</code> variable. The <code class="literal">nameof</code> expression effectively allowed developers to stop writing <code class="literal">throw new ArgumentNullException("students");</code>, which will not be affected by refactoring actions.</p><p>Another benefit of using a <code class="literal">nameof</code> expression in your code is that it involves no runtime cost, because the code containing the string literal is generated at compile time.</p><p>Modify the code in the console application slightly to make it look like this:</p><div class="informalexample"><pre class="programlisting">List&lt;Chapter1.Student&gt; StudentList = Chapter1.Recipe5NameofExpression.GetStudents();
                
int iStudentCount = Chapter1.Recipe5NameofExpression.StudentCount;
Console.WriteLine($"The value of the { nameof(Chapter1.Recipe5NameofExpression.StudentCount)} property is {iStudentCount}");</pre></div><p>When you run your <a class="indexterm" id="id45"/>console application now, you can see that the <code class="literal">nameof</code> expression has been used to create the string literal of the <code class="literal">StudentCount</code> property:</p><div class="mediaobject"><img alt="How it works…" src="graphics/B05391_01_18.jpg"/></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note07"/>Note</h3><p>Ensure that you have commented out the <code class="literal">students = null</code>; line of code in the <code class="literal">GetStudents()</code> method; otherwise, you will still receive the null exception.</p></div></div><p>You can also use the <code class="literal">nameof</code> expression with enumerators. Add the following code to your class. We are basically <a class="indexterm" id="id46"/>creating an enumerator called <code class="literal">Course</code>. In the <code class="literal">SetCourse()</code> method, we set a course based on a course ID:</p><div class="informalexample"><pre class="programlisting">public enum Course { InformationTechnology = 1, Statistics = 2, AppliedSciences = 3 }
public static string SelectedCourse { get; set; }
public static void SetCourse(int iCourseID)
{
    Course course = (Course)iCourseID;
    switch (course)
    {
        case Course.InformationTechnology:
            SelectedCourse = nameof(Course.InformationTechnology);
            break;
        case Course.Statistics:
            SelectedCourse = nameof(Course.InformationTechnology);
            break;
        case Course.AppliedSciences:
            SelectedCourse = nameof(Course.InformationTechnology);
            break;
        default:
            SelectedCourse = "InvalidCourse";
           break;
   }            
}</pre></div><p>We then use a <code class="literal">switch</code> statement to select the course defined by the course ID parameter and set the <code class="literal">SelectedCourse</code> property equal to the <code class="literal">nameof</code> expression of the enumerator. Add the following code to your console application:</p><div class="informalexample"><pre class="programlisting">Chapter1.Recipe5NameofExpression.SetCourse(1);
Console.WriteLine($"The selected course is { Chapter1.Recipe5NameofExpression.SelectedCourse}");</pre></div><p>Running the console application will result in the string representation of the selected enumerator value:</p><div class="mediaobject"><img alt="How it works…" src="graphics/B05391_01_19.jpg"/></div><p>The <code class="literal">nameof</code> expression is <a class="indexterm" id="id47"/>a very good way of keeping your code in sync when dealing with the string literals of objects in C# 6.0.</p></div></div>
<div class="section" title="Expression-bodied functions and properties"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec16"/>Expression-bodied functions and properties</h1></div></div></div><p>As the name suggests, expression-bodied functions and properties allow methods and properties to have a body that is an <a class="indexterm" id="id48"/>expression instead of a statement. You will notice that expression-bodied members look a lot like lambda expressions, because they are inspired by lambda expressions.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec30"/>Getting ready</h2></div></div></div><p>To truly appreciate expression-bodied functions and properties, we need to look at the way code had to be written previously. We will create a class to calculate the sale price of an item, and the class will contain two public methods. One will set a shelf price, and the other will return a message displaying the calculated sale price.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec31"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a class called <code class="literal">Recipe6ExpressionBodiedFunctionMembers</code> and add two private auto-implemented properties to hold the sale discount percent and the shelf price:<div class="informalexample"><pre class="programlisting">public static class Recipe6ExpressionBodiedFunctionMembers
{
    private static int SaleDiscountPercent { get; } = 20;
    private static decimal ShelfPrice { get; set; } = 100;
}</pre></div></li><li class="listitem">If you haven't done <a class="indexterm" id="id49"/>so in an earlier recipe, add the extension method class to calculate the sale price of an item:<div class="informalexample"><pre class="programlisting">public static class ExtensionMethods
{
    public static decimal CalculateSalePrice(this decimal shelfPrice, int discountPercent)
    {
        decimal discountValue = (shelfPrice / 100) * discountPercent;
        return shelfPrice - discountValue;
    }
}</pre></div></li><li class="listitem">We will now add a calculated property to the class. This calculated property uses the extension method on the <code class="literal">ShelfPrice</code> property to get the sale price:<div class="informalexample"><pre class="programlisting">private static decimal GetCalculatedSalePrice
{
    get { return Math.Round(ShelfPrice.CalculateSalePrice(SaleDiscountPercen t) ,2); } 
}</pre></div></li><li class="listitem">Finally, add two methods to your class to set the shelf price and another to return a message with the sale price:<div class="informalexample"><pre class="programlisting">public static void SetShelfPrice(decimal shelfPrice)
{
    ShelfPrice = shelfPrice;
}                

public static string ReturnMessage(string barCode)
{
    return $"The sale price for barcode {barCode} is {GetCalculatedSalePrice}";
}</pre></div></li><li class="listitem">To see the result of the <a class="indexterm" id="id50"/>code, add the following code to your console application:<div class="informalexample"><pre class="programlisting">string BarCode = "12345113";
decimal ShelfPrice = 56.99m;
Chapter1.Recipe6ExpressionBodiedFunctionMembers.SetShelfPri ce(ShelfPrice);            Console.WriteLine(Chapter1.Recipe6ExpressionBodiedFunctionM embers.ReturnMessage(BarCode));
Console.Read();</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec32"/>How it works…</h2></div></div></div><p>Running your application produces<a class="indexterm" id="id51"/> the message displaying the calculated sale price:</p><div class="mediaobject"><img alt="How it works…" src="graphics/B05391_01_20.jpg"/></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>Here, we are just supplying the bar code in the output message. However, in a live system, the shelf price would be looked up from a data store for the specific bar code.</p></div></div><p>Looking back at our class, we can see that it is somewhat bulky. We have a calculated property that returns a sale price and two methods with a single <code class="literal">return</code> statement. One sets the shelf price, while the other gets a message containing the sale price. This is where expression-bodied function members come into play. Modify your code in the <code class="literal">Recipe6ExpressionBodiedFunctionMembers</code> class to make it look like this:</p><div class="informalexample"><pre class="programlisting">public static class Recipe6ExpressionBodiedFunctionMembers
{
    private static int SaleDiscountPercent { get; } = 20;
    private static decimal ShelfPrice { get; set; } = 100;

    private static decimal GetCalculatedSalePrice =&gt; Math.Round(ShelfPrice.CalculateSalePrice(SaleDiscountPercent));

    public static void SetShelfPrice(decimal shelfPrice) =&gt; ShelfPrice = shelfPrice;

    public static string ReturnMessage(string barCode) =&gt; $"The sale price for barcode {barCode} is {GetCalculatedSalePrice}";        
}</pre></div><p>What we are left with is<a class="indexterm" id="id52"/> a terse class that does exactly the same as the code we wrote before. There is less code, it is easier to read, and it looks much cleaner. You will notice the use of the lambda <code class="literal">=&gt;</code> operator. For the <code class="literal">GetCalculatedSalePrice</code> computed property, the <code class="literal">get</code> keyword is missing. This became implied when we changed the computed property body to an expression.</p><p>One point to remember though is that expression-bodied function members do not work with constructors.</p></div></div>
<div class="section" title="Using static"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec17"/>Using static</h1></div></div></div><p>C# 6.0 introduces a new kind of <code class="literal">using</code> statement that now refers to types instead of namespaces. This means<a class="indexterm" id="id53"/> that the static members of the type are then directly put into scope. What this means for your code is evident in the condensed result of this recipe.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec33"/>Getting ready</h2></div></div></div><p>We will create a class called <code class="literal">Recipe7UsingStatic</code> that will determine the sale price of an item depending on the day of the week. If it is Friday, we want to apply the sale discount to the item. On any other day, we will sell the item at the shelf price.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec34"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Start by creating a <code class="literal">Recipe7UsingStatic</code> class that contains two auto-implemented<a class="indexterm" id="id54"/> properties and an enumerator for the day of the week:<div class="informalexample"><pre class="programlisting">public static class Recipe7UsingStatic
{
    public enum TheDayOfWeek
    {
        Monday, Tuesday, Wednesday, Thursday, Friday, Saturday, Sunday
    }

    private static int SaleDiscountPercent { get; } = 20;
    private static decimal ShelfPrice { get; set; } = 100;        
}</pre></div></li><li class="listitem">We will now add a computed property and two methods to our <code class="literal">Recipe7UsingStatic</code> class. One method will set the shelf price and the other will get the sale price:<div class="informalexample"><pre class="programlisting">private static decimal GetCalculatedSalePrice
{
    get { return Math.Round(ShelfPrice.CalculateSalePrice (SaleDiscountPercen t), 2); }
}        

public static void SetShelfPrice(decimal shelfPrice)
{
    ShelfPrice = shelfPrice;
}

public static decimal GetSalePrice(TheDayOfWeek dayOfWeek)
{
    return dayOfWeek == TheDayOfWeek.Friday ? GetCalculatedSalePrice : ShelfPrice;
}</pre></div></li><li class="listitem">In the console application, we will add the code to define the day of the week, set the shelf price, and then get the sale price. The sale price is then written out to the console application:<div class="informalexample"><pre class="programlisting">decimal ShelfPrice = 56.99m;

Chapter1.Recipe7UsingStatic.TheDayOfWeek weekday = Chapter1.Recipe7UsingStatic.TheDayOfWeek.Friday;
Chapter1.Recipe7UsingStatic.SetShelfPrice(ShelfPrice);
Console.WriteLine(Chapter1.Recipe7UsingStatic.GetSalePrice( weekday));
Console.Read();</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec35"/>How it works…</h2></div></div></div><p>Run your console<a class="indexterm" id="id55"/> application and see that the sale price is calculated correctly and output to the console application:</p><div class="mediaobject"><img alt="How it works…" src="graphics/B05391_01_21.jpg"/></div><p>Now, let's have a closer look at the code. In particular, look at the <code class="literal">GetCalculatedSalePrice</code> computed property. It uses the <code class="literal">Math.Round</code> function to round the sale price to two decimals:</p><div class="informalexample"><pre class="programlisting">private static decimal GetCalculatedSalePrice
{
    get { return Math.Round(ShelfPrice.CalculateSalePrice (SaleDiscountPercent), 2); }
}</pre></div><p>The <code class="literal">Math</code> class is in reality a static class that contains a collection of functions that you can use throughout your code to perform different mathematical calculations. So, go ahead and add the following <code class="literal">using</code> statement at the top of your <code class="literal">Recipes.cs</code> file:</p><div class="informalexample"><pre class="programlisting">using static System.Math;</pre></div><p>We can now change our computed <code class="literal">GetCalculatedSalePrice</code> property to omit the <code class="literal">Math</code> class name:</p><div class="informalexample"><pre class="programlisting">private static decimal GetCalculatedSalePrice
{
    get { return Round(ShelfPrice.CalculateSalePrice(SaleDiscountPercent), 2); }
}</pre></div><p>This is really a fantastic enhancement. Look at the following lines of code:</p><div class="informalexample"><pre class="programlisting">Math.Sqrt(64);
Math.Tan(64);
Math.Pow(8, 2);</pre></div><p>Because of this enhancement, the preceding lines of code can simply be written as follows:</p><div class="informalexample"><pre class="programlisting">Sqrt(64);
Tan(64);
Pow(8, 2);</pre></div><p>There is, however, more to <a class="indexterm" id="id56"/>using the <code class="literal">static</code> keyword's functionality. We are using static classes for all the recipes in this chapter. We can, therefore, also implement the <code class="literal">using static</code> statement for our own custom static classes. Add the following <code class="literal">using</code> statements to the top of the console application's <code class="literal">Program</code> class:</p><div class="informalexample"><pre class="programlisting">using static Chapter1.Recipe7UsingStatic;
using static Chapter1.Recipe7UsingStatic.TheDayOfWeek;
using static System.Console;</pre></div><p>You will notice that we have included the enumerator in the <code class="literal">using static</code> statements. This is equally fantastic, because Friday is clearly a day of the week, and the enumerator doesn't need to be called fully, as in the old console application code. By adding the <code class="literal">using static</code> statements, the code in our console application can be changed as follows:</p><div class="informalexample"><pre class="programlisting">TheDayOfWeek weekday = Friday;
SetShelfPrice(ShelfPrice);
WriteLine(GetSalePrice(weekday));
Read();</pre></div><p>This is where the real benefit of the <code class="literal">using static</code> statements become evident. It means less code and makes your code more readable. To recap the idea behind C# 6.0, it didn't introduce big new concepts but many small features to make your code cleaner and your intent easier to understand. The <code class="literal">using static</code> feature does exactly this.</p></div></div>
<div class="section" title="Exception filters"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec18"/>Exception filters</h1></div></div></div><p>Exception filters have been around for<a class="indexterm" id="id57"/> some time. <span class="strong"><strong>Visual Basic.NET</strong></span> (<span class="strong"><strong>VB.NET</strong></span>) and F# devs have had this functionality for a while. Luckily for us, it has now been introduced in C# 6.0. Exception filters do more than what meets the eye. At first glance, it looks as if exception filters <a class="indexterm" id="id58"/>merely specify a condition when an exception needs to be caught. This is, after all, what the name "exception filter" implies. Upon closer inspection, however, we see that exception filters act as more than just syntactical sugar.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec36"/>Getting ready</h2></div></div></div><p>We will create a new class called <code class="literal">Recipe8ExceptionFilters</code> and call a method that reads an XML file. The file read logic is determined by a Boolean flag being set to <code class="literal">true</code>. Imagine here that there is some other database flag that when set, also sets our Boolean flag to <code class="literal">true</code>, and thus, our application knows to read the given XML file.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec37"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a class called <code class="literal">Recipe8ExceptionFilters</code> that contains two methods. One method reads the XML file, and the second method logs any exception errors:<div class="informalexample"><pre class="programlisting">public static class Recipe8ExceptionFilters
{
    public static void ReadXMLFile(string fileName)
    {
        try
        {
            bool blnReadFileFlag = true;
            if (blnReadFileFlag)
            {
                File.ReadAllLines(fileName);
            }
        }
        catch (Exception ex)
        {
            Log(ex);
            throw;
        }
    }

    private static void Log(Exception e)
    {
        /* Log the error */            
    }
}</pre></div></li><li class="listitem">In the console application, add the following code to call the <code class="literal">ReadXMLFile</code> method, passing it the<a class="indexterm" id="id59"/> file name to read:<div class="informalexample"><pre class="programlisting">string File = @"c:\temp\XmlFile.xml";
Chapter1.Recipe8ExceptionFilters.ReadXMLFile(File);</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec38"/>How it works…</h2></div></div></div><p>If we had to run our<a class="indexterm" id="id60"/> application now, we would obviously receive an error (this is assuming that you actually don't have a file called <code class="literal">XMLFile.xml</code> in your <code class="literal">temp</code> folder). Visual Studio will break on the <code class="literal">throw</code> statement:</p><div class="mediaobject"><img alt="How it works…" src="graphics/B05391_01_22.jpg"/></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note09"/>Note</h3><p>You need to add the correct namespace using <code class="literal">System.IO</code> at the top of your code file.</p></div></div><p>The <code class="literal">Log(ex)</code> method has logged the exception, but have a look at the <span class="strong"><strong>Watch1</strong></span> window. We have no idea what the value of <code class="literal">blnReadFileFlag</code> is. When an exception is caught, the stack is unwound (adding overhead to your code) to whatever the actual catch block is. Therefore, the state of the stack before the exception happened is lost. Modify your <code class="literal">ReadXMLFile</code> and <code class="literal">Log</code> methods as follows to include an exception filter:</p><div class="informalexample"><pre class="programlisting">public static void ReadXMLFile(string fileName)
{
    try
    {
        bool blnReadFileFlag = true;
        if (blnReadFileFlag)
        {
            File.ReadAllLines(fileName);
        }
    }
    catch (Exception ex) when (Log(ex))
    {

    }
}

private static bool Log(Exception e)
{
    /* Log the error */
    return false;
}</pre></div><p>When you run your<a class="indexterm" id="id61"/> console application again, Visual Studio will break on the actual line of code that caused the exception:</p><div class="mediaobject"><img alt="How it works…" src="graphics/B05391_01_23.jpg"/></div><p>More importantly, the value of <code class="literal">blnReadFileFlag</code> is still in scope. This is because exception filters can see the state of the stack at the point where the exception occurred instead of where the <a class="indexterm" id="id62"/>exception was handled. Looking at the <span class="strong"><strong>Locals</strong></span> window in Visual Studio, you will see that the variables are still in scope at the point where the exception occurred:</p><div class="mediaobject"><img alt="How it works…" src="graphics/B05391_01_24.jpg"/></div><p>Imagine being able to view the exception information in a log file with all the local variable values available. Another interesting point to note is the <code class="literal">return false</code> statement in the <code class="literal">Log(ex)</code> method. Using this method to log the error and return <code class="literal">false</code> will allow the application to continue and have the exception handled elsewhere. As you know, catching <code class="literal">Exception ex</code> will catch everything. By returning <code class="literal">false</code>, the exception filter doesn't run into the <code class="literal">catch</code> statement, and more specific <code class="literal">catch</code> exceptions (for example, <code class="literal">catch (FileNotFoundException ex)</code> after our <code class="literal">catch (Exception ex)</code> statement) can be used to<a class="indexterm" id="id63"/> handle specific errors. Normally, when catching exceptions, <code class="literal">FileNotFoundException</code> will never be caught in the following code example:</p><div class="informalexample"><pre class="programlisting">catch (Exception ex) 
{

}
catch (FileNotFoundException ex)
{

}</pre></div><p>This is because the order of the exceptions being caught is wrong. Traditionally, developers must catch exceptions in their order of specificity, which means that <code class="literal">FileNotFoundException</code> is more specific than <code class="literal">Exception</code> and must therefore be placed before <code class="literal">catch (Exception ex)</code>. With exception filters that call a false returning method, we can inspect and log an exception accurately:</p><div class="informalexample"><pre class="programlisting">catch (Exception ex) when (Log(ex))
{

}
catch (FileNotFoundException ex)
{

}</pre></div><p>The preceding code will catch all exceptions, and in doing so log the exception accurately but not step into the exception handler because the <code class="literal">Log(ex)</code> method returns <code class="literal">false</code>.</p><p>Another implementation of exception filters is that they can allow developers to retry code in the event of a failure. You might not specifically want to catch the first exception, but implement a type of timeout element to your method. When the error counter has reached the maximum iterations, you can catch and handle the exception. You can see an example of catching an exception based on a <code class="literal">try</code> clauses' count here:</p><div class="informalexample"><pre class="programlisting">public static void TryReadXMLFile(string fileName)
{
    bool blnFileRead = false;
    do
    {
        int iTryCount = 0;
        try
        {
            bool blnReadFileFlag = true;
            if (blnReadFileFlag)                    
                File.ReadAllLines(fileName);                    
        }
        catch (Exception ex) when (RetryRead(ex, iTryCount++) == true)
        {
                    
        }                
    } while (!blnFileRead);
}

private static bool RetryRead(Exception e, int tryCount)
{
    bool blnThrowEx = tryCount &lt;= 10 ? blnThrowEx = false : blnThrowEx = true;
    /* Log the error if blnThrowEx = false */
    return blnThrowEx;
}</pre></div><p>Exception filtering is a <a class="indexterm" id="id64"/>very useful and extremely powerful way to handle exceptions in your code. The behind-the-scenes workings of exception filters are not as immediately obvious as one might imagine, but here lies the actual power of exception filters.</p></div></div>
<div class="section" title="Using await operator in catch and finally blocks"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec19"/>Using await operator in catch and finally blocks</h1></div></div></div><p>Finally, in C# 6.0, you can now use the <code class="literal">await</code> keyword in the <code class="literal">catch</code> and <code class="literal">finally</code> blocks. Previously, developers <a class="indexterm" id="id65"/>had to resort to all sorts of strange<a class="indexterm" id="id66"/> workarounds to achieve what is now easily achievable in C# 6.0. There really is not much more to it than the following.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec39"/>Getting ready</h2></div></div></div><p>We will create another class that will simulate the deletion of a file. An exception is thrown, and the <code class="literal">catch</code> block is then executed along with the <code class="literal">finally</code> statement. In both the <code class="literal">catch</code> and <code class="literal">finally</code> clauses, we will delay and await a task for 3 seconds. Then, we will output this delay to the console application window.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec40"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a class called <code class="literal">Recipe9AwaitInCatchFinally</code> and add a method called <code class="literal">FileRunAsync()</code> to the class with the following code. Make sure that the file does not exist in the path given to the <code class="literal">filePath</code> variable:<div class="informalexample"><pre class="programlisting">public static class Recipe9AwaitInCatchFinally
{
    public static void FileRunAsync()
    {
        string filePath = @"c:\temp\XmlFile.xml";
        RemoveFileAcync(filePath);
        ReadLine();
    }
}</pre></div></li><li class="listitem">Then, add another method called <code class="literal">RemoveFileAcync()</code> to the class that takes a file path as a <a class="indexterm" id="id67"/>parameter. Include <code class="literal">try</code> <code class="literal">catch</code> in this <a class="indexterm" id="id68"/>method and add the code that will attempt to read the file at the path supplied:<div class="informalexample"><pre class="programlisting">public static async void RemoveFileAcync(string filepath)
{
    try
    {
        WriteLine("Read file");
        File.ReadAllLines(filepath);
    }
    catch (Exception ex)
    {
        
    }
    finally
    {        

    }
}</pre></div></li><li class="listitem">In the <code class="literal">catch</code> clause, add the following code to simulate a process that takes a few seconds to complete:<div class="informalexample"><pre class="programlisting">WriteLine($"Exception - wait 3 seconds {DateTime.Now.ToString("hh:MM:ss tt")}");
await Task.Delay(3000);
WriteLine($"Exception - Print {DateTime.Now.ToString("hh:MM:ss tt")}");
WriteLine(ex.Message);</pre></div></li><li class="listitem">In the <code class="literal">finally</code> clause, add another delay that simulates a task which also takes a few seconds to complete:<div class="informalexample"><pre class="programlisting">WriteLine($"Finally - wait 3 seconds {DateTime.Now.ToString("hh:MM:ss tt")}");
await Task.Delay(3000);
WriteLine($"Finally - completed {DateTime.Now.ToString("hh:MM:ss tt")}");</pre></div></li><li class="listitem">In the console<a class="indexterm" id="id69"/> application, simply add a call to the <code class="literal">FileRunAsync()</code> method in the <code class="literal">Recipe9AwaitInCatchFinally</code> class:<div class="informalexample"><pre class="programlisting">Chapter1.Recipe9AwaitInCatchFinally.FileRunAsync();</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec41"/>How it works…</h2></div></div></div><p>After adding the code, run the<a class="indexterm" id="id70"/> console application and have a look at the output:</p><div class="mediaobject"><img alt="How it works…" src="graphics/B05391_01_25.jpg"/></div><p>You will notice that the exception thrown was a "file not found" exception. In <code class="literal">catch</code>, the code stopped for 3 seconds while the task was delayed. The same is evident for the code in the <code class="literal">finally</code> clause. It too was delayed for 3 seconds while the task was delayed.</p><p>This means that now, in your C# 6.0 applications, you can, for example, await in the <code class="literal">catch</code> clause while an exception log message is written to the log. You can do the same thing in the <code class="literal">finally</code> clause <a class="indexterm" id="id71"/>while closing database connections to dispose of other objects.</p><p>The process of how the compiler <a class="indexterm" id="id72"/>does this is rather complicated. You, however, don't need to worry about how this functionality is achieved. All you need to do is know that the <code class="literal">await</code> keyword is now available to you as a developer for use in the <code class="literal">catch</code> and <code class="literal">finally</code> blocks.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip04"/>Tip</h3><p>Detailed steps to download the code bundle are mentioned in the Preface of this book. Please have a look. The code bundle for the book is also hosted on GitHub at <a class="ulink" href="https://github.com/PacktPublishing/CSharp-Programming-Cookbook">https://github.com/PacktPublishing/CSharp-Programming-Cookbook</a>. We also have other code bundles from our rich catalog of books and videos available at <a class="ulink" href="https://github.com/PacktPublishing/">https://github.com/PacktPublishing/</a>. Check them out!</p></div></div></div></div></body></html>