<html><head></head><body>
		<div id="_idContainer121">
			<h1 id="_idParaDest-207" class="chapter-number"><a id="_idTextAnchor216"/>11</h1>
			<h1 id="_idParaDest-208"><a id="_idTextAnchor217"/>Exploring Advanced Topics</h1>
			<p>You now have the knowledge and skills of an intermediate .NET MAUI programmer. You’ve seen how to lay out controls and manage and manipulate those controls. You then learned about the MVVM design pattern. These are <span class="No-Break">the fundamentals.</span></p>
			<p>After that, you advanced to Shell navigation, using SQLite for data persistence and the all-important skill of writing unit tests <span class="No-Break">with mocks.</span></p>
			<p>This final chapter will take you beyond that level into the realm of expert .NET MAUI knowledge. In this chapter, we will cover the <span class="No-Break">following topics:</span></p>
			<ul>
				<li>Selecting data templates <span class="No-Break">at runtime</span></li>
				<li>Managing <span class="No-Break">visual state</span></li>
				<li>Utilizing Community <span class="No-Break">Toolkit behaviors</span></li>
				<li>Taking action <span class="No-Break">with triggers</span></li>
				<li><span class="No-Break">Validating forms</span></li>
			</ul>
			<h1 id="_idParaDest-209"><a id="_idTextAnchor218"/>Technical requirements</h1>
			<p>The source code for this chapter can be found at <a href="https://github.com/PacktPublishing/.NET-MAUI-for-C-Sharp-Developers/tree/AdvancedTopics">https://github.com/PacktPublishing/.NET-MAUI-for-C-Sharp-Developers/tree/AdvancedTopics</a>. If you wish to follow along, be sure to use the code from the <span class="No-Break">previous chapter.</span></p>
			<h1 id="_idParaDest-210"><a id="_idTextAnchor219"/>Selecting data templates at runtime</h1>
			<p>You saw <a id="_idIndexMarker485"/>data templates in use with collection views in <a href="B19723_05.xhtml#_idTextAnchor092"><span class="No-Break"><em class="italic">Chapter 5</em></span></a>. Let’s revisit that code and expand upon it to allow us to modify the display of each object at runtime, based on the data in the <span class="No-Break">object itself.</span></p>
			<p>To recap, we <a id="_idIndexMarker486"/>started with <strong class="source-inline">PreferenceService</strong>, where we mocked getting a list of <strong class="source-inline">Preference</strong> objects. Now, we can get that from the API, with just a little work. Modify <strong class="source-inline">IPreferenceService</strong> to <span class="No-Break">remove </span><span class="No-Break"><strong class="source-inline">GetPreferencesMock</strong></span><span class="No-Break">.</span></p>
			<p>Next, we need to significantly rework <strong class="source-inline">PreferenceService</strong> to interact with the client. Delete what you have and use <span class="No-Break">the following:</span></p>
			<pre class="source-code">
using ForgetMeNot.ApiClient;
using ForgetMeNotDemo.Model;
namespace ForgetMeNotDemo.Services;
public class PreferenceService : IPreferenceService
{
  readonly Client apiClient;
  public PreferenceService(Client apiClient)
  {
    this.apiClient = apiClient;
  }
  public async Task&lt;List&lt;Preference&gt;&gt; GetPreferences()
  {
    try
    {
      var response = await apiClient.GetProfile();
      return response?.Preferences.Select(p =&gt; new
         Preference
      {
        PreferencePrompt = p.PreferencePrompt,
        PreferenceValue = p.PreferenceValue
      }).ToList();
    }
    catch (Exception e)
    {
      await Application.Current.MainPage.DisplayAlert
        ("Preferences error",
        "We were unable to get your preferences", "Ok");
      Console.WriteLine(e);
    }
    return null;
  }
}</pre>
			<p>There’s nothing <a id="_idIndexMarker487"/>new here; it is directly parallel to what we saw in <a href="B19723_10.xhtml#_idTextAnchor187"><span class="No-Break"><em class="italic">Chapter 10</em></span></a> when obtaining the <em class="italic">Buddies</em>. Now that we have a collection of <strong class="source-inline">Preference</strong> objects, we can display them in a <strong class="source-inline">CollectionView</strong>, just as we did in <a href="B19723_05.xhtml#_idTextAnchor092"><span class="No-Break"><em class="italic">Chapter 5</em></span></a> (as shown here in <strong class="source-inline">PreferencesPage</strong>, as seen in the <span class="No-Break">previous chapter):</span></p>
			<pre class="source-code">
&lt;CollectionView
    ItemsSource="{Binding PreferenceList}"
    Margin="20,20,10,10"
    SelectionMode="None"&gt;
    &lt;CollectionView.ItemTemplate&gt;
        &lt;DataTemplate&gt;
            &lt;Grid ColumnDefinitions="*,2*"&gt;
                &lt;Entry
                    FontSize="10"
                    Grid.Column="0"
                    HorizontalOptions="Start"
                    HorizontalTextAlignment="Start"
                    Text="{Binding PreferencePrompt,
                        Mode=TwoWay}"
                    TextColor="{OnPlatform Black,
                                           iOS=White}" /&gt;
                &lt;Entry
                    FontSize="10"
                    Grid.Column="1"
                    HeightRequest="32"
                    HorizontalOptions="Start"
                    HorizontalTextAlignment="Start"
                    Text="{Binding PreferenceValue,
                      Mode=TwoWay}"
                    TextColor="{OnPlatform Black,
                                           iOS=White}"
                    WidthRequest="350" /&gt;
            &lt;/Grid&gt;
        &lt;/DataTemplate&gt;
    &lt;/CollectionView.ItemTemplate&gt;
&lt;/CollectionView&gt;</pre>
			<p>Notice that the <a id="_idIndexMarker488"/>CollectionView’s <strong class="source-inline">ItemTemplate</strong> is declared <em class="italic">inline</em>, in the declaration of <strong class="source-inline">CollectionView</strong> itself. That is not the only way to declare an <strong class="source-inline">ItemTemplate</strong>, however. Let’s see how to do it <span class="No-Break">another way.</span></p>
			<h2 id="_idParaDest-211"><a id="_idTextAnchor220"/>Declaring ItemTemplates as resources</h2>
			<p>You can<a id="_idIndexMarker489"/> take <strong class="source-inline">ItemTemplate</strong> out of the definition of <strong class="source-inline">CollectionView</strong> and move it up into <span class="No-Break">a </span><span class="No-Break"><strong class="source-inline">ResourceDictionary</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
    &lt;ContentPage.Resources&gt;  [1]
        &lt;ResourceDictionary&gt;
            &lt;DataTemplate x:Key="PreferenceTemplate"&gt; [2]
                &lt;Grid ColumnDefinitions="*,2*"&gt; [3]
                    &lt;Entry
                        FontSize="10"
                        Grid.Column="0"
                        HorizontalOptions="Start"
                        HorizontalTextAlignment="Start"
                        Text="{Binding PreferencePrompt,
                          Mode=TwoWay}"
                        TextColor="{OnPlatform Black,
                                iOS=White}" /&gt;
                    &lt;Entry
                        FontSize="10"
                        Grid.Column="1"
                        HeightRequest="32"
                        HorizontalOptions="Start"
                        HorizontalTextAlignment="Start"
                        Text="{Binding PreferenceValue,
                           Mode=TwoWay}"
                        TextColor="{OnPlatform Black,
                                         iOS=White}"
                        WidthRequest="350" /&gt;
                &lt;/Grid&gt;
            &lt;/DataTemplate&gt;
        &lt;/ResourceDictionary&gt;
    &lt;/ContentPage.Resources&gt;</pre>
			<p>Let’s look at <a id="_idIndexMarker490"/>what we’ve <span class="No-Break">done here:</span></p>
			<ul>
				<li><strong class="source-inline">[1]</strong>: At the top of the file, we declared a <strong class="source-inline">Resources</strong> section with <span class="No-Break">a </span><span class="No-Break"><strong class="source-inline">ResourceDictionary</strong></span></li>
				<li><strong class="source-inline">[2]</strong>: We created <strong class="source-inline">DataTemplate</strong> and gave it a key so that we can refer to <span class="No-Break">it later</span></li>
				<li><strong class="source-inline">[3]</strong>: The rest of <strong class="source-inline">DataTemplate</strong> is just as it was <span class="No-Break">inside </span><span class="No-Break"><strong class="source-inline">CollectionView</strong></span></li>
			</ul>
			<p><strong class="source-inline">CollectionView</strong> is now much simpler – it simply declares its <strong class="source-inline">ItemTemplate</strong> property to be our <span class="No-Break">created </span><span class="No-Break"><strong class="source-inline">StaticResource</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
&lt;CollectionView
    ItemsSource="{Binding PreferenceList}"
    ItemTemplate="{StaticResource PreferenceTemplate}"
    Margin="20,20,10,10"
    SelectionMode="None"&gt;
&lt;/CollectionView&gt;</pre>
			<p>This is <a id="_idIndexMarker491"/>valuable but is hardly all that exciting except that it opens up a <span class="No-Break">new possibility.</span></p>
			<p class="callout-heading">Where to put the DataTemplate</p>
			<p class="callout">Here, we show <strong class="source-inline">DataTemplate</strong> in the resources section, but you can put it in a different file <span class="No-Break">as well.</span></p>
			<h2 id="_idParaDest-212"><a id="_idTextAnchor221"/>The DataTemplate selection</h2>
			<p>You can <a id="_idIndexMarker492"/>create two or more additional DataTemplates in the same <strong class="source-inline">ResourceDictionary</strong>. This allows you to have .NET MAUI examine each <em class="italic">item</em> as it is about to display it and choose among the available DataTemplates based on <span class="No-Break">a condition.</span></p>
			<p>We know that when we get the preferences, some will have values and some will not. Let’s say we want to tell the user to enter a value by turning the prompt red when the value is empty. We can create <span class="No-Break">two DataTemplates:</span></p>
			<pre class="source-code">
    &lt;ContentPage.Resources&gt;
        &lt;ResourceDictionary&gt;
            &lt;DataTemplate x:Key="PreferenceTemplate"&gt;  [1]
                &lt;Grid ColumnDefinitions="*,2*"&gt;
                    &lt;Entry
                        FontSize="10"
                        Grid.Column="0"
                        HorizontalOptions="Start"
                        HorizontalTextAlignment="Start"
                        Text="{Binding PreferencePrompt,
                           Mode=TwoWay}"
                        TextColor="{OnPlatform Black,  [2]
                                       iOS=White}" /&gt;
                    &lt;Entry
                        FontSize="10"
                        Grid.Column="1"
                        HeightRequest="32"
                        HorizontalOptions="Start"
                        HorizontalTextAlignment="Start"
                        Text="{Binding PreferenceValue,
                           Mode=TwoWay}"
                        TextColor="{OnPlatform Black,
                                               iOS=White}"
                        WidthRequest="350" /&gt;
                &lt;/Grid&gt;
            &lt;/DataTemplate&gt;
            &lt;DataTemplate x:Key=
              "PreferenceTemplateEmpty"&gt;
              [3]
                &lt;Grid ColumnDefinitions="*,2*"&gt;
                    &lt;Entry
                        FontSize="10"
                        Grid.Column="0"
                        HorizontalOptions="Start"
                        HorizontalTextAlignment="Start"
                        Text="{Binding PreferencePrompt,
                          Mode=TwoWay}"
                        TextColor="{OnPlatform Red,
                                   iOS=Yellow}" /&gt;    [4]
                    &lt;Entry
                        FontSize="10"
                        Grid.Column="1"
                        HeightRequest="32"
                        HorizontalOptions="Start"
                        HorizontalTextAlignment="Start"
                        Text="{Binding PreferenceValue,
                            Mode=TwoWay}"
                        TextColor="{OnPlatform Black,
                                               iOS=White}"
                        WidthRequest="350" /&gt;
                &lt;/Grid&gt;
            &lt;/DataTemplate&gt;
         &lt;/ResourceDictionary&gt;
    &lt;/ContentPage.Resources&gt;</pre>
			<p>Let’s take a<a id="_idIndexMarker493"/> look <span class="No-Break">at this:</span></p>
			<ul>
				<li><strong class="source-inline">[1]</strong>: The first <span class="No-Break">data template</span></li>
				<li><strong class="source-inline">[2]</strong>: The normal <span class="No-Break">text colors</span></li>
				<li><strong class="source-inline">[3]</strong>: The second data template (with its <span class="No-Break">own key)</span></li>
				<li><strong class="source-inline">[4]</strong>: The <em class="italic">empty</em> <span class="No-Break">text colors</span></li>
			</ul>
			<p>Now, the obvious question is, how does .NET MAUI know which to display? For that, we need <span class="No-Break">a </span><span class="No-Break"><strong class="source-inline">DataTemplateSelector</strong></span><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-213"><a id="_idTextAnchor222"/>The DataTemplateSelector class</h2>
			<p>The first thing you <a id="_idIndexMarker494"/>must do is create a class that will contain the logic as to which template to display. I’ve named that class <strong class="source-inline">PreferenceDataTemplateSelector</strong>. Since I only intend to have one, I put it in the <span class="No-Break"><strong class="source-inline">Services</strong></span><span class="No-Break"> folder:</span></p>
			<pre class="source-code">
using ForgetMeNotDemo.Model;
namespace ForgetMeNotDemo.Services;
public class PreferenceDataTemplateSelector :
  DataTemplateSelector  [1]
{
  public DataTemplate PreferenceTemplate { get; set; }
    [2]
  public DataTemplate PreferenceTemplateEmpty { get; set; }
  protected override DataTemplate OnSelectTemplate(object
    item,  [3] BindableObject container)
  {
    if (((Preference)item)?.PreferenceValue == null)
      return PreferenceTemplateEmpty;
    return ((Preference) item).PreferenceValue.Length &gt; 0 ?
      PreferenceTemplate : PreferenceTemplateEmpty;    [4]
  }
}</pre>
			<p>You must do <span class="No-Break">the following:</span></p>
			<p><strong class="source-inline">[1]</strong>: Your class must derive <span class="No-Break">from </span><span class="No-Break"><strong class="source-inline">DataTemplateSelector</strong></span><span class="No-Break">.</span></p>
			<p><strong class="source-inline">[2]</strong>: You need a public property for each of <span class="No-Break">your DataTemplates.</span></p>
			<p><strong class="source-inline">[3]</strong>: Override the <strong class="source-inline">OnSelectTemplate</strong> <span class="No-Break">virtual method.</span></p>
			<p><strong class="source-inline">[4]</strong>: Add the logic as to which template <span class="No-Break">to display.</span></p>
			<p>With the class in<a id="_idIndexMarker495"/> place, we need to have a <span class="No-Break">corresponding resource.</span></p>
			<h2 id="_idParaDest-214"><a id="_idTextAnchor223"/>Adding the template selector to the page’s resources</h2>
			<p>Return <a id="_idIndexMarker496"/>to <strong class="source-inline">PreferencesPage.xaml</strong>. In the page declaration, add <strong class="source-inline">Xmlns:services="clr-namespace:ForgetMeNotDemo.Services"</strong>. Then, in <strong class="source-inline">ResourceDictionary</strong>, add <span class="No-Break">the following:</span></p>
			<pre class="source-code">
&lt;services:PreferenceDataTemplateSelector
                PreferenceTemplate="{StaticResource
                    PreferenceTemplate}"
                PreferenceTemplateEmpty="{StaticResource
                    PreferenceTemplateEmpty}"
                x:Key="PreferenceDataTemplateSelector" /&gt;</pre>
			<p>This provides the link to the names in the class we just created. We now have the logic, but how do we hook it up <span class="No-Break">to </span><span class="No-Break"><strong class="source-inline">CollectionView</strong></span><span class="No-Break">?</span></p>
			<h2 id="_idParaDest-215"><a id="_idTextAnchor224"/>Adding DataTemplateSelector to CollectionView</h2>
			<p>Hooking <a id="_idIndexMarker497"/>all this into <strong class="source-inline">CollectionView</strong> is <a id="_idIndexMarker498"/>as simple as setting <span class="No-Break">an </span><span class="No-Break"><strong class="source-inline">ItemTemplate</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
&lt;CollectionView
    ItemTemplate="{StaticResource PreferenceDataTemplate
       Selector}"
    ItemsSource="{Binding PreferenceList}"
    Margin="20,20,10,10"
    SelectionMode="None" /&gt;</pre>
			<p>And it all comes together. <strong class="source-inline">CollectionView</strong> looks to <strong class="source-inline">PreferenceDataTemplateSelector</strong> in the resources, which is tied to the class we created<a id="_idIndexMarker499"/> that <a id="_idIndexMarker500"/>holds the logic as to which <strong class="source-inline">DataTemplate</strong> to show. The result is shown in <span class="No-Break"><em class="italic">Figure 11</em></span><span class="No-Break"><em class="italic">.1</em></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer115" class="IMG---Figure">
					<img src="image/Figure_11.1_B19723.jpg" alt="Figure 11.1 – DataTemplate selection&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.1 – DataTemplate selection</p>
			<p><strong class="source-inline">DataTemplateSelector</strong> is a very powerful way to control what is displayed at runtime. A similar mechanism is encapsulated in the concept of <span class="No-Break">Visual State.</span></p>
			<h1 id="_idParaDest-216"><a id="_idTextAnchor225"/>Managing Visual State</h1>
			<p>Every <strong class="source-inline">VisualElement</strong> has a <em class="italic">Visual State</em> at any given moment (for example, does <strong class="source-inline">VisualElement</strong> have <em class="italic">focus</em>? Is it <em class="italic">selected</em>?). You can imagine responding to that state programmatically in C#, but <a id="_idIndexMarker501"/>there are advantages to responding to changes in visual state declaratively, in the XAML. Doing so puts more of the UI management in one place – your view (for <span class="No-Break">example, </span><span class="No-Break"><strong class="source-inline">MainPage.xaml</strong></span><span class="No-Break">).</span></p>
			<p class="callout-heading">VisualElement</p>
			<p class="callout"><strong class="source-inline">VisualElement</strong> is the base class of all controls (<span class="No-Break">and pages).</span></p>
			<p>The object that sets visual properties on <strong class="source-inline">VisualElement</strong> based on its state is the <strong class="bold">Visual State Manager</strong>. The Visual State Manager<a id="_idIndexMarker502"/> selects from among a set of <strong class="source-inline">VisualStates</strong> and displays a <strong class="source-inline">VisualElement</strong> according to the properties set in <span class="No-Break">the XAML.</span></p>
			<p>This forces the question: what are <span class="No-Break">visual states?</span></p>
			<h2 id="_idParaDest-217"><a id="_idTextAnchor226"/>Defining the common visual states</h2>
			<p>.NET MAUI defines a <a id="_idIndexMarker503"/>set of common <span class="No-Break">visual states:</span></p>
			<ul>
				<li><span class="No-Break"><strong class="source-inline">Normal</strong></span></li>
				<li><span class="No-Break"><strong class="source-inline">Disabled</strong></span></li>
				<li><span class="No-Break"><strong class="source-inline">Has focus</strong></span></li>
				<li><span class="No-Break"><strong class="source-inline">Is selected</strong></span></li>
				<li><strong class="source-inline">Mouse over</strong> (for Windows <span class="No-Break">and macOS)</span></li>
			</ul>
			<p>.NET MAUI also allows you to define your own visual states, though that is <span class="No-Break">less common.</span></p>
			<p>You use these visual states to set properties on <strong class="source-inline">VisualElement</strong>. For example, you might change the appearance of a button based on its <strong class="source-inline">VisualState</strong>. An example will make this <span class="No-Break">much clearer.</span></p>
			<h2 id="_idParaDest-218"><a id="_idTextAnchor227"/>A button VisualState example</h2>
			<p>When you first<a id="_idIndexMarker504"/> go to the <strong class="bold">Login</strong> page, you will see that the <strong class="bold">Submit</strong> button is disabled. We’d like it to be gray. Once you fill in the <strong class="bold">Your Email</strong> and <strong class="bold">Password</strong> fields, the button should turn light green. If you tab to the button, it should signify that it has the focus by turning fully green. You can do all this declaratively by creating visual states, as shown in <span class="No-Break"><em class="italic">Figure 11</em></span><span class="No-Break"><em class="italic">.2</em></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer116" class="IMG---Figure">
					<img src="image/1.jpg" alt=""/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.2 – Visual states of buttons</p>
			<p>You can set the visual state on an individual button, or, as we will do here, you can put the visual state’s XAML into a style and apply it to all the buttons. Here is the complete <strong class="source-inline">Style</strong> <span class="No-Break">for buttons:</span></p>
			<pre class="source-code">
&lt;Style x:Key="LoginButton" TargetType="Button"&gt; [1]
    &lt;Setter Property="Margin" Value="0,20,0,0" /&gt;
    &lt;Setter Property="TextColor" Value="Black" /&gt;
    &lt;Setter Property="WidthRequest" Value="125" /&gt;
    &lt;Setter Property="VisualStateManager
      .VisualStateGroups"&gt; [2]
        &lt;VisualStateGroupList&gt;
            &lt;VisualStateGroup x:Name="CommonStates"&gt; [3]
                &lt;VisualState x:Name="Normal"&gt; [4]
                    &lt;VisualState.Setters&gt; [5]
                        &lt;Setter Property="BackgroundColor"
                           Value="LightGreen" /&gt; [6]
                    &lt;/VisualState.Setters&gt;
                &lt;/VisualState&gt;
                &lt;VisualState x:Name="Focused"&gt;
                    &lt;VisualState.Setters&gt;
                        &lt;Setter Property="BackgroundColor"
                           Value="Green" /&gt;
                    &lt;/VisualState.Setters&gt;
                &lt;/VisualState&gt;
                &lt;VisualState x:Name="Disabled"&gt;
                    &lt;VisualState.Setters&gt;
                        &lt;Setter Property="BackgroundColor"
                          Value="Gray" /&gt;
                    &lt;/VisualState.Setters&gt;
                &lt;/VisualState&gt;
            &lt;/VisualStateGroup&gt;
        &lt;/VisualStateGroupList&gt;
    &lt;/Setter&gt;
&lt;/Style&gt;</pre>
			<p>Here, we have <a id="_idIndexMarker505"/><span class="No-Break">the following:</span></p>
			<ul>
				<li><strong class="source-inline">[1]</strong>: We start by declaring a normal <strong class="source-inline">Style</strong> – in this case, it’s implicit for <span class="No-Break">every button</span></li>
				<li><strong class="source-inline">[2]</strong>: You may have one or more groups of visual states (we <span class="No-Break">have one)</span></li>
				<li><strong class="source-inline">[3]</strong>: The first group (and in this case, the only one) <span class="No-Break">is </span><span class="No-Break"><strong class="source-inline">CommonStates</strong></span></li>
				<li><strong class="source-inline">[4]</strong>: We declare each <strong class="source-inline">VisualState</strong> in turn (here, we’re starting <span class="No-Break">with </span><span class="No-Break"><strong class="source-inline">Normal</strong></span><span class="No-Break">)</span></li>
				<li><strong class="source-inline">[5]</strong>: For each state, we can declare a set <span class="No-Break">of Setters</span></li>
				<li><strong class="source-inline">[6]</strong>: Our first (and in this case, only) <strong class="source-inline">Setter</strong> sets the <span class="No-Break"><strong class="source-inline">BackgroundColor</strong></span><span class="No-Break"> property</span></li>
			</ul>
			<p>We then go on to set the <a id="_idIndexMarker506"/>Setters for all the other states. Notice that we did not set a <strong class="source-inline">Setter</strong> for <strong class="source-inline">PointerOver</strong>, which means that, on Windows and macOS, if you hover the mouse over the button, there will be <span class="No-Break">no change.</span></p>
			<p>.NET MAUI defines specialized visual states for controls. For example, <strong class="source-inline">Button</strong> adds the <em class="italic">Pressed</em> state, while <strong class="source-inline">CheckBox</strong> adds the <em class="italic">IsChecked</em> state and <strong class="source-inline">CollectionViews</strong> <span class="No-Break">adds </span><span class="No-Break"><em class="italic">Selected</em></span><span class="No-Break">.</span></p>
			<p>The .NET MAUI Community Toolkit provides further help for managing the appearance and behavior of your app with a large collection <span class="No-Break">of behaviors.</span></p>
			<h1 id="_idParaDest-219"><a id="_idTextAnchor228"/>Utilizing Community Toolkit behaviors</h1>
			<p>We’ve <a id="_idIndexMarker507"/>already seen one <em class="italic">behavior</em> from the <em class="italic">Community Toolkit</em> that turns an event into a command (<strong class="source-inline">EventToCommandBehavior</strong>), allowing us to respond to these events in <span class="No-Break">our </span><span class="No-Break"><strong class="source-inline">ViewModel</strong></span><span class="No-Break">.</span></p>
			<p class="callout-heading">The Community Toolkit is open source</p>
			<p class="callout">The Community Toolkit is not officially part of .NET MAUI and consists of code supplied by (surprise!) the community – that is, developers independent of Microsoft. That said, the Microsoft documentation includes and increasingly integrates the <span class="No-Break">Community Toolkit.</span></p>
			<p><strong class="source-inline">CommunityToolkit</strong> provides a suite of behaviors to handle many other common programming needs. Many of these behaviors assist with validating input. For example, the <strong class="source-inline">CommunityToolkit</strong> includes <span class="No-Break">the following:</span></p>
			<ul>
				<li><span class="No-Break">Character validation</span></li>
				<li><span class="No-Break">Numeric validation</span></li>
				<li>Required <span class="No-Break">string validation</span></li>
				<li><span class="No-Break">Text validation</span></li>
				<li><span class="No-Break">URI validation</span></li>
			</ul>
			<p>You attach<a id="_idIndexMarker508"/> behaviors to controls. For example, let’s add a rule to the <strong class="bold">Login</strong> page stating that the username must be a valid email address. First, in the header, add the <span class="No-Break">needed namespace:</span></p>
			<pre class="source-code">
Xmlns:behaviors=http://schemas.microsoft.com/dotnet/2022/maui/toolkit</pre>
			<p>You are then ready to test for a valid email using the Community <span class="No-Break">Toolkit behavior:</span></p>
			<pre class="source-code">
&lt;Entry
    Grid.Column="1"
    Grid.ColumnSpan="2"
    Grid.Row="0"
    Placeholder="Please enter your email address"
    Text="{Binding LoginName}"
    WidthRequest="150"&gt;
    &lt;Entry.Behaviors&gt;   [1]
        &lt;behaviors:EmailValidationBehavior  [2]
            InvalidStyle="{StaticResource InvalidUserName}"
              [3]
            ValidStyle="{StaticResource ValidUserName}" [4]
            Flags="ValidateOnValueChanged" /&gt; [5]
    &lt;/Entry.Behaviors&gt;
&lt;/Entry&gt;</pre>
			<p>Do <span class="No-Break">the</span><span class="No-Break"><a id="_idIndexMarker509"/></span><span class="No-Break"> following:</span></p>
			<p><strong class="source-inline">[1]</strong>: Begin the <strong class="source-inline">Behaviors</strong> section of the <span class="No-Break"><strong class="source-inline">Entry</strong></span><span class="No-Break"> tag.</span></p>
			<p><strong class="source-inline">[2]</strong>: Choose which behavior you want (in this case, <span class="No-Break">email validation).</span></p>
			<p><strong class="source-inline">[3]</strong>: Identify the style for an invalid <span class="No-Break">email address.</span></p>
			<p><strong class="source-inline">[4]</strong>: Identify the style for a valid <span class="No-Break">email address.</span></p>
			<p><strong class="source-inline">[5]</strong>: Add validation behaviors. They have flags to indicate when to do the validation (in this case, when the value changes), as shown in the <span class="No-Break">following figure:</span></p>
			<div>
				<div id="_idContainer117" class="IMG---Figure">
					<img src="image/Figure_11.3_B19723.jpg" alt="Figure 11.3 – Validation flags&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.3 – Validation flags</p>
			<p>There are several other non-validating behaviors as well. These include behaviors to assist with animating views, progress bar animation, a behavior to assist with customizing the color and style of your device’s status bar, and a behavior to trigger an action when the user <span class="No-Break">stops typing.</span></p>
			<p>The last of these can be very helpful when allowing the user to search a large set of data. Rather than having the search be incremental as the user types, or forcing the user to tap a <strong class="bold">Search</strong> button, you can have the search begin when the user stops typing for a <span class="No-Break">specified period:</span></p>
			<pre class="source-code">
Place the following code at the top of PreferencesPage.xaml
&lt;Entry Placeholder="Search" x:Name="SearchEntry"&gt;
    &lt;Entry.Behaviors&gt;
        &lt;behaviors:UserStoppedTypingBehavior
            Command="{Binding PreferencesSearchCommand}"
              [1]
            CommandParameter="{Binding Source={x:Reference
               SearchEntry}, Path=Text}"    [2]
            MinimumLengthThreshold="4"  [3]
            ShouldDismissKeyboardAutomatically="True" [4]
            StoppedTypingTimeThreshold="500" /&gt; [5]
    &lt;/Entry.Behaviors&gt;
&lt;/Entry&gt;</pre>
			<p>Let’s look at <a id="_idIndexMarker510"/>what this <span class="No-Break">code does:</span></p>
			<ul>
				<li><strong class="source-inline">[1]</strong>: When the user stops typing, call this command in <span class="No-Break">your </span><span class="No-Break"><strong class="source-inline">ViewModel</strong></span></li>
				<li><strong class="source-inline">[2]</strong>: Pass this parameter (the text of <strong class="source-inline">Entry</strong>) to <span class="No-Break">the command</span></li>
				<li><strong class="source-inline">[3]</strong>: Don’t execute the command unless at least this many characters have <span class="No-Break">been entered</span></li>
				<li><strong class="source-inline">[4]</strong>: When you execute the command, put away <span class="No-Break">the keyboard</span></li>
				<li><strong class="source-inline">[5]</strong>: Wait this long (half a second) to indicate the user has <span class="No-Break">stopped typing</span></li>
			</ul>
			<p>When you add this to your XAML, and the user enters <strong class="source-inline">Shoe</strong> in the entry, the command is fired and the parameter is sent. <span class="No-Break"><em class="italic">Figure 11</em></span><em class="italic">.4</em> shows the parameter being passed into the command handler <span class="No-Break">in </span><span class="No-Break"><strong class="source-inline">PreferencesPageViewModel</strong></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer118" class="IMG---Figure">
					<img src="image/Figure_11.4_B19723.jpg" alt="Figure 11.4 – Passing in the search string&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.4 – Passing in the search string</p>
			<p>Behaviors <a id="_idIndexMarker511"/>are a way to declare how the system should perform in XAML. Another powerful mechanism for moving responsive actions into the <span class="No-Break">XAML triggers.</span></p>
			<h1 id="_idParaDest-220"><a id="_idTextAnchor229"/>Taking action with triggers</h1>
			<p><em class="italic">Triggers</em> allow<a id="_idIndexMarker512"/> you to declare how a control should appear in your XAML based on data changes. You can also use <em class="italic">state triggers</em> to change a control’s <em class="italic">Visual State</em>, as <span class="No-Break">shown earlier.</span></p>
			<p>For example, we may want <a id="_idIndexMarker513"/>to enforce that the <strong class="bold">Create Account</strong> button <a id="_idIndexMarker514"/>should be disabled if the user has left the <strong class="bold">Password</strong> field blank. You can do this in code, but you can also do it declaratively in XAML using <span class="No-Break">a </span><span class="No-Break"><strong class="source-inline">DataTrigger</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
&lt;Button
    Command="{Binding DoCreateAccountCommand}"
    Grid.Column="1"
    Grid.Row="2"
    Style="{StaticResource LoginButton}"
    Text="Create Account"&gt;
    &lt;Button.Triggers&gt;  [1]
        &lt;DataTrigger
            Binding="{Binding Source={x:Reference
               passwordEntry}, Path=Text.Length}"
            TargetType="Button"
            Value="0"&gt; [2]
            &lt;Setter Property="IsEnabled" Value="False" /&gt;
              [3]
        &lt;/DataTrigger&gt;
    &lt;/Button.Triggers&gt;
&lt;/Button&gt;</pre>
			<p>Let’s look at <a id="_idIndexMarker515"/>what this<a id="_idIndexMarker516"/> <span class="No-Break">code does:</span></p>
			<ul>
				<li><strong class="source-inline">[1]</strong>: This starts the <strong class="source-inline">Triggers</strong> collection <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">Button</strong></span><span class="No-Break">.</span></li>
				<li><strong class="source-inline">[2]</strong>: This creates a <strong class="source-inline">DataTrigger</strong> and sets it to bind to the length of the text in the entry control whose name is <strong class="source-inline">passwordEntry</strong>. Set <strong class="source-inline">TargetType</strong> to <strong class="source-inline">Button</strong> (required) and the value for it to trigger on (that is, if the length of the password entry text is <strong class="source-inline">0</strong>, then fire <span class="No-Break">the trigger).</span></li>
				<li><strong class="source-inline">[3]</strong>: This code uses a setter to declare what happens when the <span class="No-Break">trigger fires.</span></li>
			</ul>
			<p>In short, when the <strong class="bold">Password</strong> field is empty, the <strong class="bold">Create</strong> button should be disabled and as soon as it is not empty, the button should <span class="No-Break">be enabled.</span></p>
			<p class="callout-heading">Unexpected behavior</p>
			<p class="callout">The field you are checking (<strong class="source-inline">Password</strong>) must have its text initialized to <strong class="source-inline">""</strong> for this to work. Otherwise, it will be null and the trigger may not act as expected. To solve this, initialize the property <span class="No-Break">in </span><span class="No-Break"><strong class="source-inline">ViewModel</strong></span><span class="No-Break">:</span></p>
			<p class="callout"><strong class="source-inline">[</strong><span class="No-Break"><strong class="source-inline">observableproperty]</strong></span></p>
			<p class="callout"><strong class="source-inline">public string password = </strong><span class="No-Break"><strong class="source-inline">string.Empty;</strong></span></p>
			<p>The <a id="_idIndexMarker517"/>result of this<a id="_idIndexMarker518"/> trigger is shown in <span class="No-Break"><em class="italic">Figure 11</em></span><em class="italic">.5</em> and <span class="No-Break"><em class="italic">Figure 11</em></span><span class="No-Break"><em class="italic">.6</em></span><span class="No-Break">.</span></p>
			<div>
				<div id="_idContainer119" class="IMG---Figure">
					<img src="image/2.jpg" alt=""/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.5 – Trigger when the Password field is empty</p>
			<p>In <span class="No-Break"><em class="italic">Figure 11</em></span><em class="italic">.5</em>, the <strong class="bold">Password</strong> field is empty, while in <span class="No-Break"><em class="italic">Figure 11</em></span><em class="italic">.6</em>, a character has been typed into the <span class="No-Break"><strong class="bold">Password</strong></span><span class="No-Break"> field:</span></p>
			<div>
				<div id="_idContainer120" class="IMG---Figure">
					<img src="image/3.jpg" alt=""/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.6 – Trigger when the Password field is not empty</p>
			<p>For fun, change <strong class="source-inline">Property</strong> from <strong class="source-inline">IsEnabled</strong> to <strong class="source-inline">IsVisible</strong>. Now, the button is not there when you<a id="_idIndexMarker519"/> enter the page, but will appear when you put a<a id="_idIndexMarker520"/> character into the <span class="No-Break"><strong class="bold">Password</strong></span><span class="No-Break"> field.</span></p>
			<h1 id="_idParaDest-221"><a id="_idTextAnchor230"/>Summary</h1>
			<p>In this chapter, we reviewed four key advanced topics that allow you to manage the behavior of your <span class="No-Break">app declaratively:</span></p>
			<ul>
				<li>Selecting data templates allows you to change the display of your data based on the specific content of each element in <span class="No-Break">a collection</span></li>
				<li>Managing the view state allows you to modify the appearance of a control based on the <em class="italic">state</em> of that control (for example, does it <span class="No-Break">have focus?)</span></li>
				<li>Behaviors allow, among other things, data validation and otherwise assist in providing actions that <span class="No-Break">you declare</span></li>
				<li>Triggers change the appearance of controls based on data values in other controls or based on the state of <span class="No-Break">other controls</span></li>
			</ul>
			<p>This brings us to the end of <strong class="source-inline">.Net MAUI for C# Developers</strong>. You are now fully equipped to create real-world professional .NET <span class="No-Break">MAUI applications.</span></p>
			<p>The key to success with .NET MAUI, as with so many programming skills, is hands-on experience. If you are not currently working on a .NET MAUI project, you will want to assign one to yourself while this information is front and center in <span class="No-Break">your mind.</span></p>
			<p>Here’s an application idea I’ve had for years, which you are free to write (and sell if you want). I’ll give it to you <span class="No-Break">without restriction:</span></p>
			<p>Create a nice-looking application that gathers all the books on an online bookstore (using their public API) that you rated with five stars. Next, gather all the people who have also rated a large percentage of those books five stars. Exclude anyone who gave any of those books less than five stars. Now, take those people who seem to agree with you, and find any books they rated as five stars that you’ve not read yet. Those are books you’ll want <span class="No-Break">to read.</span></p>
			<p>Enjoy the project! I hope you have enjoyed <span class="No-Break">this book.</span></p>
			<h1 id="_idParaDest-222"><a id="_idTextAnchor231"/>Quiz</h1>
			<p>Answer the following questions to test your knowledge of <span class="No-Break">this chapter:</span></p>
			<ol>
				<li>Why would you use the Visual <span class="No-Break">State Manager?</span></li>
				<li>How does .NET MAUI decide which data template <span class="No-Break">to use?</span></li>
				<li>Name a behavior that is not used <span class="No-Break">for validation.</span></li>
				<li>When a trigger fires, how does it know what <span class="No-Break">to do?</span></li>
			</ol>
			<h1 id="_idParaDest-223"><a id="_idTextAnchor232"/>You try it</h1>
			<p>Modify the <strong class="bold">Login</strong> page so that it does <span class="No-Break">the following:</span></p>
			<ul>
				<li>Disables the <strong class="bold">Login</strong> button unless the username is a valid email address and the password has at least <span class="No-Break">one character.</span></li>
				<li>Modifies the <strong class="bold">Forgot Password</strong> button to double in size and turn pink when you tab onto it (giving it the focus), and returns to its normal size and color when it <span class="No-Break">loses focus</span></li>
			</ul>
		</div>
		<div>
			<div id="_idContainer122" class="IMG---Figure">
			</div>
		</div>
	

		<div id="_idContainer123">
			<h1 id="_idParaDest-224"><a id="_idTextAnchor233"/>Assessments</h1>
			<p>This section contains answers to questions from <span class="No-Break">all chapters.</span></p>
			<h1 id="_idParaDest-225"><a id="_idTextAnchor234"/>Chapter 1, Assembling Your Tools and Creating Your  First App</h1>
			<ol>
				<li>You can create a new project from the launch dialog by choosing <strong class="bold">Create a new project</strong>. If you’ve been brought directly into Visual Studio, by clicking on <strong class="bold">File</strong> | <span class="No-Break"><strong class="bold">New Project</strong></span><span class="No-Break">.</span></li>
				<li>Use <strong class="bold">View</strong> | <span class="No-Break"><strong class="bold">Solution Explorer</strong></span><span class="No-Break">.</span></li>
				<li>The <strong class="source-inline">.xaml</strong> extension indicates that the file contains <span class="No-Break">XAML markup.</span></li>
				<li>The <span class="No-Break">code-behind file.</span></li>
				<li><span class="No-Break"><strong class="source-inline">MauiProgram.cs</strong></span><span class="No-Break">.</span></li>
			</ol>
			<h1 id="_idParaDest-226"><a id="_idTextAnchor235"/>Chapter 3, XAML and Fluent C#</h1>
			<ol>
				<li value="1">XAML is a markup language based <span class="No-Break">on XML.</span></li>
				<li>XAML is used in .NET MAUI for declaring layouts <span class="No-Break">and controls.</span></li>
				<li>Rather than writing in XAML, you can create your layouts and controls <span class="No-Break">in C#.</span></li>
				<li>We nest a layout or a control inside a layout by using the <span class="No-Break"><strong class="source-inline">Children</strong></span><span class="No-Break"> property.</span></li>
				<li>An event handler is a method that is registered to an event in <span class="No-Break">the UI.</span></li>
				<li>The event handler is in <span class="No-Break">the code-behind.</span></li>
			</ol>
			<h1 id="_idParaDest-227"><a id="_idTextAnchor236"/>Chapter 4, MVVM and Controls</h1>
			<ol>
				<li value="1">MVVM has two main advantages. First, it is nearly impossible to unit test a .NET MAUI application if your logic is in the code-behind file – putting the logic in <strong class="source-inline">ViewModel</strong> is essential, as we’ll see in the upcoming chapter on unit testing. Second, MVVM nicely decouples the UI from your logic, allowing you to change one without breaking <span class="No-Break">the other.</span></li>
				<li>The all-important <strong class="source-inline">BindingContext</strong>. You typically assign <strong class="source-inline">ViewModel</strong> as the binding context <span class="No-Break">for </span><span class="No-Break"><strong class="source-inline">View</strong></span><span class="No-Break">.</span></li>
				<li>The <strong class="source-inline">Entry</strong> control and the <span class="No-Break"><strong class="source-inline">Editor</strong></span><span class="No-Break"> control.</span></li>
				<li>The <span class="No-Break"><strong class="source-inline">Label</strong></span><span class="No-Break"> control.</span></li>
				<li><strong class="source-inline">SnackBar</strong> is a highly configurable <strong class="source-inline">Toast</strong> – a popup that comes up from the bottom of the page and then can disappear either by its timer running out or by a user clicking <span class="No-Break">on it.</span></li>
			</ol>
			<h1 id="_idParaDest-228"><a id="_idTextAnchor237"/>Chapter 5, Advanced Controls</h1>
			<ol>
				<li value="1"><strong class="source-inline">ActivityIndicator</strong> shows that <em class="italic">something</em> is happening, while <strong class="source-inline">ProgressBar</strong> tells the user what fraction of the task <span class="No-Break">is complete.</span></li>
				<li>The essential difference as far as we are concerned is that events are typically handled in the code-behind, while commands are handled in <strong class="source-inline">ViewModel</strong>. Handling commands in <strong class="source-inline">ViewModel</strong> is preferable because it makes creating unit tests easier <span class="No-Break">or possible.</span></li>
				<li><strong class="source-inline">WeakReferenceManager</strong> is the primary object used in messaging, allowing <strong class="source-inline">ViewModel</strong> to send notifications to <strong class="source-inline">View</strong> or another <strong class="source-inline">ViewModel</strong> without a reference to that object, thus supporting <span class="No-Break">loose coupling.</span></li>
				<li>Styles allow you to create a uniform appearance across instances of controls, centralizing the properties and providing all the advantages of <span class="No-Break">well-factored code.</span></li>
				<li>One way to refactor styles is to create a base style and then use <strong class="source-inline">BasedOn</strong> to create derived types, adding or overriding properties <span class="No-Break">as needed.</span></li>
			</ol>
			<h1 id="_idParaDest-229"><a id="_idTextAnchor238"/>Chapter 6, Layout</h1>
			<ol>
				<li value="1">Stars, <strong class="source-inline">auto</strong>, and the value <span class="No-Break">in dpi</span></li>
				<li>Allocate 100 dpi to the last column, the needed size for the second column, and then divide the first and third columns proportionally <span class="No-Break">as 2:1</span></li>
				<li>The row and column offsets are defined by <span class="No-Break">enumerated constants</span></li>
				<li><strong class="source-inline">Grid</strong> allows for more precise alignment and placement <span class="No-Break">of controls</span></li>
				<li><strong class="source-inline">BindableLayout</strong> does not allow you to <span class="No-Break">make selections</span></li>
			</ol>
			<h1 id="_idParaDest-230"><a id="_idTextAnchor239"/>Chapter 7, Understanding Navigation</h1>
			<ol>
				<li value="1"><span class="No-Break"><strong class="source-inline">AppShell.xaml</strong></span></li>
				<li><strong class="source-inline">Title</strong>, <strong class="source-inline">ContentTemplate</strong>, <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">Icon</strong></span></li>
				<li><span class="No-Break"><strong class="source-inline">AppShell.xaml.cs</strong></span></li>
				<li><span class="No-Break"><strong class="source-inline">Shell.Current.GoToAsync</strong></span></li>
				<li>URL syntax or using <span class="No-Break">a dictionary</span></li>
			</ol>
			<h1 id="_idParaDest-231"><a id="_idTextAnchor240"/>Chapter 8, Storing and Retrieving Data</h1>
			<ol>
				<li value="1"><strong class="source-inline">Preferences</strong> (not to be confused <span class="No-Break">with </span><span class="No-Break"><strong class="source-inline">UserPreferences</strong></span><span class="No-Break">).</span></li>
				<li>The key and a <span class="No-Break">default value.</span></li>
				<li><strong class="bold">SQLite-net-pcl</strong> and possibly <strong class="bold">SQLitePCLRaw.bundle_green</strong>, if not included <span class="No-Break">with </span><span class="No-Break"><strong class="bold">SQLite-net-pcl</strong></span><span class="No-Break">.</span></li>
				<li><span class="No-Break"><strong class="source-inline">SQLiteAsyncConnection</strong></span></li>
			</ol>
			<h1 id="_idParaDest-232"><a id="_idTextAnchor241"/>Chapter 9, Unit Testing</h1>
			<ol>
				<li value="1">Unit tests are critical for ensuring the quality of your code and allow you to add to and change your code with the confidence of knowing that if you break something, you’ll find out about it <span class="No-Break">right away.</span></li>
				<li>Most of the testable code in a .NET MAUI application will be in the ViewModel or, possibly, <span class="No-Break">the services.</span></li>
				<li>When you need a slower service to test a method in your code, a mock can stand in for that service and give you <span class="No-Break">immediate responses.</span></li>
				<li>In order to provide a mock to your test, you must be able to inject it into the code in lieu of the <span class="No-Break">runtime object.</span></li>
			</ol>
			<h1 id="_idParaDest-233"><a id="_idTextAnchor242"/>Chapter 10, Consuming REST Services</h1>
			<ol>
				<li value="1">A DTO is responsible for holding data that will be sent to and/or from <span class="No-Break">the API.</span></li>
				<li>The database is now in the cloud and managed through the API. As the client, we don’t know, nor need to know, what kind of database is <span class="No-Break">in use.</span></li>
				<li>It wraps all the API calls so that a client can interact with the API as if it were a <strong class="bold">Plain Old CLR </strong><span class="No-Break"><strong class="bold">Object</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">POCO</strong></span><span class="No-Break">).</span></li>
				<li>Account creation is accomplished in the cloud via <span class="No-Break">the API.</span></li>
				<li>Authentication is accomplished in the cloud via <span class="No-Break">the API.</span></li>
			</ol>
			<h1 id="_idParaDest-234"><a id="_idTextAnchor243"/>Chapter 11, Exploring Advanced Topics</h1>
			<ol>
				<li value="1">To modify the appearance of a control based on its <em class="italic">state</em>, such as whether or not it has <span class="No-Break">the focus.</span></li>
				<li>In the XAML, add a <strong class="source-inline">DataTemplateSelector</strong> to indicate the potential templates and then add a class that derives from <strong class="source-inline">DataTemplateSelector</strong> that overrides <strong class="source-inline">OnSelectTemplate</strong> and returns <strong class="source-inline">DataTemplate</strong> to <span class="No-Break">be displayed.</span></li>
				<li>We have seen the <strong class="source-inline">EventToCommand</strong> behavior, which allows you to add commands to controls that only have events, allowing you to handle the event/command <span class="No-Break">in </span><span class="No-Break"><strong class="source-inline">ViewModel</strong></span><span class="No-Break">.</span></li>
				<li>You add setters with the property to change and the value to set <span class="No-Break">it to.</span></li>
			</ol>
		</div>
	</body></html>