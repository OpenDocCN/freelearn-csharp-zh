<html><head></head><body>
<div><h1 class="chapterNumber">9</h1>
<h1 class="chapterTitle" id="_idParaDest-171">Sharing Code and Resources</h1>
<p class="normal">Throughout the book, we have been building a project that can run in many different hosting models. This is a great way to build our projects if we want to switch technologies further down the road or, as we do at work, share components between the customer portal and our internal <strong class="keyWord">customer relationship management</strong> (<strong class="keyWord">CRM</strong>) system.</p>
<p class="normal">Always think about if there might be a sharable part of the component we are building; that way, we can reuse it, and if we add something to the component, we get that benefit for all our components.</p>
<p class="normal">But it’s not only about sharing components inside our own projects. What if we want to create a library that can be shared with other departments, or even an open-source project sharing components with the world?</p>
<p class="normal">In this chapter, we will look at some of the things we already use when sharing components, and also at sharing CSS and other static files.</p>
<p class="normal">In this chapter, we will cover the following topics:</p>
<ul>
<li class="bulletList">Adding static files</li>
<li class="bulletList">CSS isolation</li>
</ul>
<h1 class="heading-1" id="_idParaDest-172">Technical requirements</h1>
<p class="normal">Make sure you have followed the previous chapters or use the <code class="inlineCode">Chapter08</code> folder as a starting point.</p>
<p class="normal">You can find the source code for this chapter’s result at <a href="https://github.com/PacktPublishing/Web-Development-with-Blazor-Third-Edition/tree/main/Chapter09">https://github.com/PacktPublishing/Web-Development-with-Blazor-Third-Edition/tree/main/Chapter09</a>.</p>
<p class="normal">If you are jumping into this chapter using the code from GitHub, make sure you have added <code class="inlineCode">Auth0</code> account information in the settings files. You can find the instructions in <em class="chapterRef">Chapter 8</em>, <em class="italic">Authentication and Authorization</em>.</p>
<h1 class="heading-1" id="_idParaDest-173">Adding static files</h1>
<p class="normal">Blazor can use <a id="_idIndexMarker398"/>static files, such as images, CSS, and JavaScript. If we put our files in the <code class="inlineCode">wwwroot</code> folder, they will automatically be exposed to the internet and be accessible from the root of our site. The nice thing about Blazor is that we can do the same with a library; it is super easy to distribute static files within a library.</p>
<p class="normal">At work, we share components between all of our Blazor projects, and the shared library can also depend on other libraries. By sharing components and building our own components (sometimes on top of other libraries), we ensure we have the same look and feel throughout a site. We also share static content like images and CSS, and this makes it simple and fast if we need to change something and we want all of our sites to be affected.</p>
<p class="normal">To link to a resource in another library/assembly, we can use the <code class="inlineCode">_content</code> folder.</p>
<p class="normal">Take a look at this example:</p>
<pre class="programlisting code"><code class="hljs-code">&lt;link rel="stylesheet" href="_content/SharedComponents/MyBlogStyle.min.css" /&gt;
</code></pre>
<p class="normal">The HTML <code class="inlineCode">link</code> tag, <code class="inlineCode">rel</code>, and <code class="inlineCode">href</code> are ordinary HTML tags and attributes, but adding the URL that starts with <code class="inlineCode">_content</code> tells us that the content we want to access is in another library. The name of the library (assembly name), in our case, <code class="inlineCode">SharedComponents</code>, is followed by the file we want to access, which is stored in the <code class="inlineCode">wwwroot</code> folder in our library.</p>
<p class="normal">Blazor is, in the end, just HTML, and HTML can be styled using CSS. As mentioned, the Blazor templates are using Bootstrap by default, and we will continue to use that as well.</p>
<p class="normal">There is an excellent site with easy-to-use Bootstrap themes ready to be downloaded, which can be found at <a href="https://bootswatch.com/">https://bootswatch.com/</a>.</p>
<p class="normal">I like the Darkly theme, so that’s the one we’ll use, but feel free to experiment with this later on.</p>
<h2 class="heading-2" id="_idParaDest-174">Choosing between frameworks</h2>
<p class="normal">I often get <a id="_idIndexMarker399"/>asked about how to style Blazor apps, and the truth is you can use all the things you are used to. In the end, Blazor will output HTML. There are many languages and frameworks we can use to write our CSS.</p>
<p class="normal">We can<a id="_idIndexMarker400"/> use CSS, <strong class="keyWord">Syntactically Awesome Stylesheets</strong> (<strong class="keyWord">SASS</strong>), and <strong class="keyWord">Leaner CSS</strong> (<strong class="keyWord">LESS</strong>). As <a id="_idIndexMarker401"/>long as the output is CSS, we can use it.</p>
<p class="normal">In this chapter, we will stick with Bootstrap and continue using CSS. SASS and LESS are beyond the scope of this book.</p>
<p class="normal">Tailwind is a<a id="_idIndexMarker402"/> popular framework for Blazor, and it is absolutely possible to use it together with Blazor. Tailwind is very component focused and needs a bit of configuration to start, but if it is something you have worked with and like, you can use it together with Blazor.</p>
<h2 class="heading-2" id="_idParaDest-175">Adding a new style</h2>
<p class="normal">Many <a id="_idIndexMarker403"/>templates use Bootstrap as a base, so if you are looking for a design for your website, using a Bootstrap-based template will be an easy implementation.</p>
<p class="normal">The problem with Bootstrap (and why some people don’t like it) is that many sites use Bootstrap and “all sites look the same.” This can be good if we are building a <strong class="keyWord">line of business</strong> (<strong class="keyWord">LOB</strong>), but it<a id="_idIndexMarker404"/> can be bad if we are trying to be innovative. Bootstrap is also quite large when it comes to downloading, so that is also an argument against it.</p>
<p class="normal">This chapter is about making our blog look a bit nicer, so we will stick with Bootstrap, but we should know that if we use something else to handle our CSS, it will work with Blazor.</p>
<p class="normal">One of these template sites is <code class="inlineCode">Bootswatch</code>, which gives us some nice variations from the traditional Bootstrap themes:</p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1">Navigate to <a href="https://bootswatch.com/darkly/">https://bootswatch.com/darkly/</a>.</li>
<li class="numberedList">In the top menu called <code class="inlineCode">Darkly</code>, there are some links. Download <code class="inlineCode">bootstrap.min.css</code>.</li>
<li class="numberedList">In the <code class="inlineCode">SharedComponents</code> project, in the <code class="inlineCode">wwwroot</code> folder, add the <code class="inlineCode">bootstrap.min.css</code> file.</li>
</ol>
<p class="normal">We have all the<a id="_idIndexMarker405"/> prerequisites and CSS that we can add to our site.</p>
<h2 class="heading-2" id="_idParaDest-176">Adding CSS </h2>
<p class="normal">Now, it’s time <a id="_idIndexMarker406"/>to add a new style to our site:</p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1">In the <code class="inlineCode">BlazorWebApp</code> project, open <code class="inlineCode">Components/App.razor</code>.</li>
<li class="numberedList">Locate this row:
        <pre class="programlisting code"><code class="hljs-code">&lt;link rel="stylesheet" href="bootstrap/bootstrap.min.css" /&gt;
</code></pre>
<p class="normal">Replace the preceding row with the following:</p>
<pre class="programlisting code"><code class="hljs-code">&lt;link rel="stylesheet" href="_content/SharedComponents/bootstrap.min.css" /&gt;
</code></pre>
</li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3">Run the project by pressing <em class="keystroke">Ctrl</em> + <em class="keystroke">F5</em>.</li>
</ol>
<p class="normal">Great! Our Blazor project is now updated to use the new style. The main color should now be dark, but there is still some work to do.</p>
<h2 class="heading-2" id="_idParaDest-177">Making the admin interface more usable</h2>
<p class="normal">Let’s now clean it <a id="_idIndexMarker407"/>up some more. We have only started with the admin functionality, so let’s make it more accessible. The menu on the left is no longer required, so let’s change it so that it is only visible if you are an administrator:</p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1">Open <code class="inlineCode">Components/Layout/MainLayout.razor</code> and put <code class="inlineCode">AuthorizeView</code> around the <code class="inlineCode">sidebar</code> <code class="inlineCode">div</code> like this:
        <pre class="programlisting code"><code class="hljs-code">&lt;AuthorizeView Roles="Administrator"&gt;
    &lt;div class="sidebar"&gt;
        &lt;NavMenu /&gt;
    &lt;/div&gt;
&lt;/AuthorizeView&gt;
</code></pre>
</li>
</ol>
<p class="normal">In this case, we are not specifying <code class="inlineCode">Authorized</code> or <code class="inlineCode">NotAuthorized</code>. The default behavior is <code class="inlineCode">Authorized</code>, so if we are only looking for an authorized state, we don’t need to specify it by name.</p>
<p class="normal">Start the <a id="_idIndexMarker408"/>project to see it in action. The menu should not be shown if we are not logged in.</p>
<p class="normal">Now, we need to make the menu look better. Even though the counter is really fun to click on, it doesn’t make much sense regarding our blog.</p>
<h2 class="heading-2" id="_idParaDest-178">Making the menu more useful</h2>
<p class="normal">We should replace<a id="_idIndexMarker409"/> the links with links to our admin pages instead:</p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1">In the <code class="inlineCode">BlazorWebApp</code> project, open the <code class="inlineCode">Components/Layout/Navmenu.razor</code> file.
    <p class="normal">Edit the code so that it looks like this:</p>
<pre class="programlisting code"><code class="hljs-code">&lt;div class="top-row ps-3 navbar navbar-dark"&gt;
    &lt;div class="container-fluid"&gt;
        &lt;a class="navbar-brand" href=""&gt;MyBlog Admin&lt;/a&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;input type="checkbox" title="Navigation menu" class="navbar-toggler" /&gt;
&lt;div class="nav-scrollable" onclick="document.querySelector('.navbar-toggler').click()"&gt;
    &lt;nav class="flex-column"&gt;
        &lt;div class="nav-item px-3"&gt;
            &lt;NavLink class="nav-link" href="" Match="NavLinkMatch.All"&gt;
                &lt;span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"&gt;&lt;/span&gt; Home
            &lt;/NavLink&gt;
        &lt;/div&gt;
        &lt;div class="nav-item px-3"&gt;
            &lt;NavLink class="nav-link" href="Admin/Blogposts"&gt;
                &lt;span class="bi bi-plus-square-fill-nav-menu" aria-hidden="true"&gt;&lt;/span&gt; Blog posts
            &lt;/NavLink&gt;
        &lt;/div&gt;
        &lt;div class="nav-item px-3"&gt;
            &lt;NavLink class="nav-link" href="Admin/Tags"&gt;
                &lt;span class="bi bi-plus-square-fill-nav-menu" aria-hidden="true"&gt;&lt;/span&gt; Tags
            &lt;/NavLink&gt;
        &lt;/div&gt;
        &lt;div class="nav-item px-3"&gt;
            &lt;NavLink class="nav-link" href="Admin/Categories"&gt;
                &lt;span class="bi bi-plus-square-fill-nav-menu" aria-hidden="true"&gt;&lt;/span&gt; Categories
            &lt;/NavLink&gt;
        &lt;/div&gt;
    &lt;/nav&gt;
&lt;/div&gt;
</code></pre></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="2">If we<a id="_idIndexMarker410"/> start the project and resize the screen, we will notice that the menu shows up on large screens but is hidden on smaller ones. One thing worth noticing is that <code class="inlineCode">NavMenu</code> doesn’t contain code, so the menu hiding and showing up depending on screen size is all done using CSS.</li>
</ol>
<p class="normal">Great! Our blog is looking more like a blog, but we can do more!</p>
<h2 class="heading-2" id="_idParaDest-179">Making the blog look like a blog</h2>
<p class="normal">The admin interface is done (at least, for now), and we should focus on the front page of our blog. The<a id="_idIndexMarker411"/> front page should have the title of the blog post and some descriptions:</p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1">In the <code class="inlineCode">SharedComponents</code> project, open the <code class="inlineCode">Pages/Home.razor</code> file.</li>
<li class="numberedList">Add a <code class="inlineCode">using</code> statement for <code class="inlineCode">Markdig</code> at the top of the file:
        <pre class="programlisting code"><code class="hljs-code">@using Markdig;
</code></pre>
</li>
<li class="numberedList">Add an <code class="inlineCode">OnInitializedAsync</code> method to handle the instantiation of the <code class="inlineCode">Markdig</code> pipeline (this is the same code we have in the <code class="inlineCode">Post.razor</code> file):
        <pre class="programlisting code"><code class="hljs-code">MarkdownPipeline pipeline;
protected override Task OnInitializedAsync()
{
    pipeline = new MarkdownPipelineBuilder()
                .UseEmojiAndSmiley()
                .Build();
    return base.OnInitializedAsync();
}
</code></pre>
</li>
<li class="numberedList">Inside<a id="_idIndexMarker412"/> the <code class="inlineCode">Virtualize</code> component, change the content (<code class="inlineCode">RenderFragment</code>) to the following:
        <pre class="programlisting code"><code class="hljs-code">    &lt;article&gt;
        &lt;h2&gt;@p.Title&lt;/h2&gt;
        @((MarkupString)Markdig.Markdown.ToHtml(new string(p.Text.Take(100).ToArray()), pipeline))
        &lt;a href="/Post/@p.Id"&gt;Read more&lt;/a&gt;
    &lt;/article&gt;
</code></pre>
</li>
<li class="numberedList">Also, remove the <code class="inlineCode">&lt;ul&gt;</code> tags.</li>
</ol>
<p class="normal">Now, run the project using <em class="keystroke">Ctrl</em> + <em class="keystroke">F5</em> and look at our new front page. Our blog is starting to take form, but we still have work to do.</p>
<h1 class="heading-1" id="_idParaDest-180">CSS isolation</h1>
<p class="normal">In .NET 5, Microsoft<a id="_idIndexMarker413"/> added something called isolated CSS. This is something that many other frameworks have as well. The idea is to write CSS specifically for one component. The upside, of course, is that the CSS that we create won’t impact any of the other components.</p>
<p class="normal">The template for Blazor uses isolated CSS for <code class="inlineCode">Components/Layout/MainLayout.razor</code> and <code class="inlineCode">NavMenu.Razor</code>. If we expand <code class="inlineCode">MainLayout.razor</code>, we’ll see a file called <code class="inlineCode">MainLayout.razor.css</code>. The tree is made possible thanks to using the same naming.</p>
<p class="normal">We can also use SASS here by adding a file called <code class="inlineCode">MainLayout.razor.scss</code>. The important thing is that the file we add should generate a file called <code class="inlineCode">MainLayout.razor.css</code> for the compiler to pick up.</p>
<p class="normal">This naming convention will make sure to rewrite CSS and the HTML output.</p>
<p class="normal">CSS has the following naming convention:</p>
<pre class="programlisting code"><code class="hljs-code">main {
    flex: 1;
}
</code></pre>
<p class="normal">It will be rewritten as follows:</p>
<pre class="programlisting code"><code class="hljs-code">main[b-bfl5h5967n] {
    flex: 1;
}
</code></pre>
<p class="normal">This means <a id="_idIndexMarker414"/>the elements need to have an attribute called <code class="inlineCode">b-bfl5h5967n</code> (in this case) for the style to be applied. This is a randomly generated string for this component.</p>
<p class="normal">The <code class="inlineCode">div</code> tag that has the <code class="inlineCode">CSS</code> tag within the <code class="inlineCode">MainLayout</code> component will be outputted like this:</p>
<pre class="programlisting code"><code class="hljs-code">&lt;main b-bfl5h5967n&gt;
</code></pre>
<p class="normal">For all of this to happen, we also need to have a link to the CSS (which is provided by the template), and it looks like this:</p>
<pre class="programlisting code"><code class="hljs-code">&lt;link href="{Assemblyname}.styles.css" rel="stylesheet"&gt;
</code></pre>
<p class="normal">This becomes useful for component libraries. We have components that have isolated CSS in our shared library (<code class="inlineCode">NavMenu</code> and <code class="inlineCode">MainLayout</code>), and the CSS for the <code class="inlineCode">NavMenu</code> component is included in the <code class="inlineCode">{Assemblyname}.styles.css</code> file.</p>
<p class="normal">We don’t have to do anything extra to include our shared CSS. If we are creating a library for anyone, we should consider using the isolated CSS approach if our components need some CSS to work correctly.</p>
<p class="normal">If we are starting our Blazor project from an empty template, we need to add a link to the isolated CSS.</p>
<p class="normal">This way, our users won’t have to add a reference to our CSS, and there is no risk of our CSS breaking something in the user’s app (since it’s isolated). The important thing is that we use the right approach when it makes sense.</p>
<p class="normal">Suppose we are creating a component that has very specific styles, which only that component will use. In that case, isolated CSS is a great way to go, it is easier to find (right by the component), and we can use CSS variables for colors and such.</p>
<p class="normal">We should be careful when styling similar things inside of the isolated CSS, so we don’t end up having a bunch of different CSS files styling a button, for example.</p>
<p class="normal">As mentioned, the isolated CSS only affects the HTML tags inside the component, but what if <a id="_idIndexMarker415"/>we have a component inside our component?</p>
<p class="normal">If we open <code class="inlineCode">Component/Layout/NavMenu.razor.css</code>, we can see that for the <code class="inlineCode">.nav-item</code> styles, some of them are using the <code class="inlineCode">::deep</code> keyword;<strong class="keyWord"> </strong>this is to say that even child components should also be affected by this style.</p>
<p class="normal">Take a look at this code:</p>
<pre class="programlisting code"><code class="hljs-code">.nav-item ::deep a {…}
</code></pre>
<p class="normal">It is targeting the <code class="inlineCode">&lt;a&gt;</code> tag, but the Razor code looks like this:</p>
<pre class="programlisting code"><code class="hljs-code">&lt;li class="nav-item px-3"&gt;
     &lt;NavLink class="nav-link" href="Admin/Blogposts"&gt;
         &lt;span class="oi oi-signpost" aria-hidden="true"&gt;&lt;/span&gt; Blog posts
     &lt;/NavLink&gt;
&lt;/li&gt;
</code></pre>
<p class="normal">It is the <code class="inlineCode">NavLink</code> component that renders the <code class="inlineCode">&lt;a&gt;</code> <code class="inlineCode">t</code>ag; by adding <code class="inlineCode">::deep</code>, we are saying we want to apply this style to all elements with the <code class="inlineCode">.nav-item</code> class and all the <code class="inlineCode">&lt;a&gt;</code> <code class="inlineCode">t</code>ags inside that element.</p>
<p class="normal">There is one more thing we need to know about – <code class="inlineCode">::deep</code>; it makes sure to share the ID of the attribute (<code class="inlineCode">b-bfl5h5967n</code>, for example), and it needs an HTML tag to do so. So, if we have a component that consists of other components (not adding any HTML tags at all), we need to add an HTML tag around the content to make <code class="inlineCode">::deep</code> work.</p>
<p class="normal">Before we summarize this chapter, let us do one more thing.</p>
<p class="normal">Let’s fix the background color of the menu:</p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1">Open <code class="inlineCode">Components/Layout/MainLayout.razor.css</code>.</li>
<li class="numberedList">Look for the <code class="inlineCode">.sidebar</code> style and replace it with the following code:
        <pre class="programlisting code"><code class="hljs-code">.sidebar {
    background-image: linear-gradient(180deg, var(--bs-body-bg) 0%,var(--bs-gray-800) 70%);
} 
</code></pre>
</li>
<li class="numberedList">Replace the <code class="inlineCode">.top-row</code> style with the following code:
        <pre class="programlisting code"><code class="hljs-code">.top-row {
    background-color: var(--bs-primary);
    justify-content: flex-end;
    height: 3.5rem;
    display: flex;
    align-items: center;
}
</code></pre>
<p class="normal">We replaced the background color and removed a border.</p>
</li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="4">In the <code class="inlineCode">.top-row ::deep a, .top-row ::deep .btn-link</code> style, add the following:
        <pre class="programlisting code"><code class="hljs-code">color:white;
</code></pre>
</li>
</ol>
<p class="normal">Now, we<a id="_idIndexMarker416"/> are able to see the login/logout link a bit better.</p>
<p class="normal">We now have a working admin interface and a good-looking site.</p>
<h1 class="heading-1" id="_idParaDest-181">Summary</h1>
<p class="normal">In this chapter, we have added shared CSS.</p>
<p class="normal">We saw how to create shared libraries (for others to use). This is also a great way to structure our in-house projects (so that it is easy to change from Blazor Server to Blazor WebAssembly, or the other way around). </p>
<p class="normal">If you have a site already, you can build your Blazor components in a shared library, which we have done throughout the book.</p>
<p class="normal">Using components as part of your site (using Blazor Server), you can get started with Blazor bit by bit until you have converted the whole thing. When that is done, you can decide whether or not to keep using Blazor Server (as I mentioned, we use Blazor Server at my workplace) or move to Blazor WebAssembly, or use both as our project does.</p>
<p class="normal">We talked about how we can use SASS and CSS in our site, both <em class="italic">regular</em> CSS and <em class="italic">isolated</em> CSS.</p>
<p class="normal">In the next chapter, we will learn about the one thing we are trying to avoid (at least, I am) as Blazor developers – JavaScript.</p>
</div>
</body></html>