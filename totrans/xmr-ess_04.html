<html><head></head><body><div class="chapter" title="Chapter&#xA0;4.&#xA0;Developing Your First iOS App with Xamarin.iOS"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Developing Your First iOS App with Xamarin.iOS</h1></div></div></div><p>In this chapter, we finally get to jump in and start writing some code. We will develop a sample app that demonstrates the basics of developing Xamarin.iOS apps and will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Overview of the sample app</li><li class="listitem" style="list-style-type: disc">Creating a Xamarin.iOS app</li><li class="listitem" style="list-style-type: disc">Running and debugging apps with Xamarin Studio</li><li class="listitem" style="list-style-type: disc">Using Xamarin iOS Designer</li><li class="listitem" style="list-style-type: disc">Extending the sample app</li><li class="listitem" style="list-style-type: disc">MonoTouch.Dialog</li></ul></div><div class="section" title="The sample national parks app"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec33"/>The sample national parks app</h1></div></div></div><p>In <a class="indexterm" id="id208"/>this chapter, we will create a sample app that we will continue to work with through <a class="link" href="ch08.html" title="Chapter 8. Sharing with Xamarin.Forms">Chapter 8</a>, <span class="emphasis"><em>Sharing with Xamarin.Forms</em></span>. The app will allow you to view, create, edit, and delete information about national parks, and will have a similar user interface and flow as the iOS 7 Contacts app. The following screen mock-ups depict how the user interface will be organized:</p><div class="mediaobject"><img alt="The sample national parks app" src="graphics/0838OT_04_18.jpg"/></div><p>The following are the different views of national park apps:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>List view</strong></span>: This <a class="indexterm" id="id209"/>view displays a list of national parks that allows a park to be viewed and also a new park to be created</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Detail view</strong></span>: This <a class="indexterm" id="id210"/>view displays all the properties of a national park in read-only mode, and allows navigation to see photos of a park or see directions to a park</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Edit view</strong></span>: This <a class="indexterm" id="id211"/>view allows you to edit new or existing parks as well as delete parks</li></ul></div></div></div>
<div class="section" title="Creating the sample app"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec34"/>Creating the sample app</h1></div></div></div><p>A Xamarin.iOS template will be used to create the sample app, giving us much of the required <a class="indexterm" id="id212"/>functionality that is already in place.</p><p>Throughout the chapter, we will present sample code from the downloaded solutions. Feel free to deviate in any manner to take the app in any direction you see fit.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip12"/>Tip</h3><p>
<span class="strong"><strong>Downloading the example code</strong></span>
</p><p>You can download the example code files from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a> for all the Packt Publishing books you have purchased. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div><p>To create the national parks sample app, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Launch Xamarin Studio.</li><li class="listitem">From the <span class="strong"><strong>File</strong></span> menu, navigate to <span class="strong"><strong>New</strong></span> | <span class="strong"><strong>Solution</strong></span>. The <span class="strong"><strong>New Solution</strong></span> dialog box will be presented, as shown in the following screenshot:<div class="mediaobject"><img alt="Creating the sample app" src="graphics/0838OT_04_01.jpg"/></div></li><li class="listitem">Navigate to <span class="strong"><strong>C#</strong></span> | <span class="strong"><strong>iOS</strong></span> | <span class="strong"><strong>iPhone Storyboard</strong></span> on the left-hand side of the dialog box and <span class="strong"><strong>Master-Detail Application</strong></span> in the middle section.</li><li class="listitem">Enter <code class="literal">NationalParks.iOS</code> in the <span class="strong"><strong>Name</strong></span> field, select the location where you would like to place your code by clicking on the <span class="strong"><strong>Browse</strong></span> button, change the <span class="strong"><strong>Solution name</strong></span> to <code class="literal">NationalParks</code>, leave <span class="strong"><strong>Create directory for solution</strong></span> checked, and click on <span class="strong"><strong>OK</strong></span>.</li><li class="listitem">One reason for naming the project <code class="literal">NationalParks.iOS</code> is that in future chapters, we will add a new project named <code class="literal">NationalParks.Droid</code> to the same solution. This project will clearly identify which platform is supported by each project.</li><li class="listitem">Xamarin <a class="indexterm" id="id213"/>Studio will create both the solution and project folders, generate a number of files for solution and project, and then open the new solution and project. The following screenshot depicts Xamarin Studio with the newly created project open:<div class="mediaobject"><img alt="Creating the sample app" src="graphics/0838OT_04_02.jpg"/></div></li></ol></div><p>By selecting the Master-Detail template, Xamarin Studio has generated a functioning application with a master view (list) and a detail view along with everything that is needed to navigate between the two.</p><p>Let's take a brief look at what was automatically created:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">MainStoryboard.storyboard</code>: A storyboard file containing the user interface definitions was created and named <code class="literal">MainStoryboard.storyboard</code>. Double-click on this file to open it in Xcode. You will notice that the storyboard contains two view controllers: <code class="literal">MasterViewController</code> and <code class="literal">DetailViewController</code> with a single segue between them.</li><li class="listitem" style="list-style-type: disc"><code class="literal">MasterViewController</code>: The <code class="literal">MasterViewController.cs</code> and the corresponding <code class="literal">MasterViewController.designer.cs</code> files were created as a result of <code class="literal">MasterViewController</code> defined in the storyboard. <code class="literal">MasterViewController.cs</code> is the file where we will add code, while we override <a class="indexterm" id="id214"/>methods and add logic.</li><li class="listitem" style="list-style-type: disc"><code class="literal">DataSource</code>: <code class="literal">MasterViewController</code> contains an inner class named <code class="literal">DataSource</code>, which is a specialization of <code class="literal">UITableViewSource</code>. The <code class="literal">DataSource</code> class is responsible for providing populated <code class="literal">UICellViews</code> to the table view on <code class="literal">MasterViewController</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">DetailViewController</code>: The <code class="literal">DetailViewController.cs</code> and its corresponding <code class="literal">DetailViewController.designer.cs</code> files were created as a result of <code class="literal">DetailViewController</code> defined in the storyboard. This is used to display <a class="indexterm" id="id215"/>properties of a specific item from the table view on <code class="literal">MasterViewController</code>.</li></ul></div><div class="section" title="The Project Options view"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec38"/>The Project Options view</h2></div></div></div><p>There are <a class="indexterm" id="id216"/>numerous options that can be set that affect how an iOS app is built and executed. These options can be viewed and <a class="indexterm" id="id217"/>adjusted from the <span class="strong"><strong>Project Options</strong></span> view. The following sections are of the most interest for iOS apps:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>iOS Application</strong></span>: This <a class="indexterm" id="id218"/>includes settings that describe the application, including the devices supported, iOS target version, orientations supported, icons, and more</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>iOS IPA Options</strong></span>: This <a class="indexterm" id="id219"/>includes settings related to creating an IPA package for ad hoc distribution</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>iOS Bundle Signing</strong></span>: This <a class="indexterm" id="id220"/>includes settings that control how the bundle is signed during the build process</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>iOS Build</strong></span>: This <a class="indexterm" id="id221"/>includes settings used by the compile and link process to optimize the resulting executable</li></ul></div><p>Prior to running the app, we need to choose a setting for our target version of iOS. To adjust this setting, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select the sample app project under the sample app solution in the <span class="strong"><strong>Solution</strong></span> pad.</li><li class="listitem">Right-click and select <span class="strong"><strong>Options</strong></span>.</li><li class="listitem">Select the <span class="strong"><strong>iOS Application</strong></span> section and set the <span class="strong"><strong>Deployment Target</strong></span> option to <span class="strong"><strong>7.0</strong></span> and click on <span class="strong"><strong>OK</strong></span>.<div class="mediaobject"><img alt="The Project Options view" src="graphics/0838OT_04_19.jpg"/></div></li></ol></div></div></div>
<div class="section" title="Running and debugging within Xamarin Studio"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec35"/>Running and debugging within Xamarin Studio</h1></div></div></div><p>Now <a class="indexterm" id="id222"/>that we have a good understanding of what was created for us, let's take a few minutes to look at the capabilities Xamarin Studio provides to run and debug apps. The way in which a tool supports <a class="indexterm" id="id223"/>running and debugging apps has a big impact on developer productivity. Xamarin Studio provides a <a class="indexterm" id="id224"/>robust set of debugging capabilities comparable to the most modern development environments that can be used with either the iOS Simulator or a physical device. As with an iOS development, using a physical device provides the most accurate results.</p><p>The two <a class="indexterm" id="id225"/>dropdowns on the upper-left hand corner of Xamarin Studio control the type of build (<span class="strong"><strong>Release</strong></span> or <span class="strong"><strong>Debug</strong></span>) that will be produced and, when <span class="strong"><strong>Debug</strong></span> is selected, which of the iOS Simulators should be used. Build types include <span class="strong"><strong>Ad-Hoc</strong></span>, <span class="strong"><strong>AppStore</strong></span>, <span class="strong"><strong>Debug</strong></span>, and <span class="strong"><strong>Release</strong></span>. All of these build types except <span class="strong"><strong>Debug</strong></span> will be discussed in <a class="link" href="ch09.html" title="Chapter 9. Preparing Xamarin.iOS Apps for Distribution">Chapter 9</a>, <span class="emphasis"><em>Preparing Xamarin.iOS Apps for Distribution</em></span>. The <span class="strong"><strong>Debug</strong></span> build type is shown in the following screenshot:</p><div class="mediaobject"><img alt="Running and debugging within Xamarin Studio" src="graphics/0838OT_04_03.jpg"/></div><p>Note that <span class="strong"><strong>Debug</strong></span> is selected for the type of build and the various options available for the iOS Simulator. Selecting <span class="strong"><strong>iOS Device</strong></span> allows you to debug the app on an attached device.</p><p>To debug an app, follow the given steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select <span class="strong"><strong>Debug</strong></span> for the build type, and select <span class="strong"><strong>iOS 7.1 </strong></span>from <span class="strong"><strong>iPhone Retina (4-inch 64-bit)</strong></span> for the <span class="strong"><strong>iOS Simulator</strong></span> option.</li><li class="listitem">Start the debugging session by clicking on the <span class="strong"><strong>Start</strong></span> button from the taskbar on the left-hand side. You can also initiate the debugging session by navigating <a class="indexterm" id="id226"/>to <span class="strong"><strong>Run</strong></span> | <span class="strong"><strong>Start Debugging</strong></span> from the main menu bar.</li><li class="listitem">Xamarin <a class="indexterm" id="id227"/>Studio will compile the app, launch the iOS Simulator, install the app on the simulator and finally launch the app. Xamarin Studio keeps you informed of what is <a class="indexterm" id="id228"/>going in the status window in the middle of the taskbar. The following screenshot <a class="indexterm" id="id229"/>shows the status window during the build process:<div class="mediaobject"><img alt="Running and debugging within Xamarin Studio" src="graphics/0838OT_04_04.jpg"/></div></li><li class="listitem">An empty list is initially presented. Click the <span class="strong"><strong>+</strong></span> (add) button a few times and you will see the date/time fields being added to the list. Select an entry and the <span class="strong"><strong>Detail</strong></span> view is displayed, as shown in the following screenshot:<div class="mediaobject"><img alt="Running and debugging within Xamarin Studio" src="graphics/0838OT_04_09.jpg"/></div></li><li class="listitem">Open <code class="literal">MasterViewController.cs</code> by double-clicking the <span class="strong"><strong>Solution</strong></span> pad on the <a class="indexterm" id="id230"/>left-hand side. Set <a class="indexterm" id="id231"/>a breakpoint on the first line in the <code class="literal">AddNewItem()</code> method.</li><li class="listitem">Click <a class="indexterm" id="id232"/>on the <span class="strong"><strong>+</strong></span> (add) <a class="indexterm" id="id233"/>button in the app. You will notice the app has stopped on the breakpoint, as follows:<div class="mediaobject"><img alt="Running and debugging within Xamarin Studio" src="graphics/0838OT_04_05.jpg"/></div></li><li class="listitem">You will find the basic flow controls in the taskbar. These allow you to continue execution, step over current line, step into current function, and step out of the current function. The taskbar will appear:<div class="mediaobject"><img alt="Running and debugging within Xamarin Studio" src="graphics/0838OT_04_06.jpg"/></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip13"/>Tip</h3><p>A complete set of flow control and debugging options can be found under the <span class="strong"><strong>Run</strong></span> main menu.</p></div></div></li><li class="listitem">From <a class="indexterm" id="id234"/>the first line in <code class="literal">AddNewItem()</code>, select <code class="literal">DateTime.Now</code>, right-click, and select <span class="strong"><strong>Expression Evaluator</strong></span>. This dialog box allows you to quickly view the <a class="indexterm" id="id235"/>status of objects <a class="indexterm" id="id236"/>during <a class="indexterm" id="id237"/>your app's execution, as follows:<div class="mediaobject"><img alt="Running and debugging within Xamarin Studio" src="graphics/0838OT_04_07.jpg"/></div></li><li class="listitem">You will also notice a set of panels at the bottom of Xamarin Studio, which contain tabs for <span class="strong"><strong>Watch</strong></span>, <span class="strong"><strong>Locals</strong></span>, <span class="strong"><strong>Breakpoints</strong></span>, <span class="strong"><strong>Threads</strong></span>, <span class="strong"><strong>Application Output</strong></span>, and <span class="strong"><strong>Call Stack</strong></span>.<div class="mediaobject"><img alt="Running and debugging within Xamarin Studio" src="graphics/0838OT_04_08.jpg"/></div></li><li class="listitem">Click the continue icon to allow the app to continue running.</li></ol></div><p>As <a class="indexterm" id="id238"/>you can see from the previous <a class="indexterm" id="id239"/>exercise, Xamarin <a class="indexterm" id="id240"/>Studio <a class="indexterm" id="id241"/>and the iOS Simulator provide a robust set of features to run and debug applications.</p></div>
<div class="section" title="Extending the sample app"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec36"/>Extending the sample app</h1></div></div></div><p>Now, it's <a class="indexterm" id="id242"/>time to extend the app. We have two primary tasks before us:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Create a way for national parks to be loaded and saved from a file</li><li class="listitem" style="list-style-type: disc">Enhance the user interface to show all of the appropriate attributes and allow to view and edit data</li></ul></div><div class="section" title="Storing and loading national parks"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec39"/>Storing and loading national parks</h2></div></div></div><p>We will <a class="indexterm" id="id243"/>use a simple JSON-formatted text file to store information. .NET provides libraries to accomplish this, but the library I have had the most <a class="indexterm" id="id244"/>success with is Json.NET. Json.NET is an open source library created by James Newton-King, and this is definitely worth considering. Json.NET is also available in the Xamarin component store, so we can add it to our project directly from there.</p><div class="section" title="Adding Json.NET"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec11"/>Adding Json.NET</h3></div></div></div><p>To add Json.NET to the <a class="indexterm" id="id245"/>sample app, perform <a class="indexterm" id="id246"/>the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Expand the <code class="literal">NationalParks.iOS</code> project, select the <code class="literal">Components</code> folder, and choose <span class="strong"><strong>Edit Components</strong></span>.</li><li class="listitem">In the upper-right corner, click on <span class="strong"><strong>Get More Components</strong></span> and enter <code class="literal">Json.NET</code> in the search field.</li><li class="listitem">Select <span class="strong"><strong>Json.NET</strong></span> <a class="indexterm" id="id247"/>from the list and choose <span class="strong"><strong>Add to App</strong></span>.</li></ol></div></div><div class="section" title="Creating an entity class"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec12"/>Creating an entity class</h3></div></div></div><p>We now <a class="indexterm" id="id248"/>need an entity class that represents <a class="indexterm" id="id249"/>our subject: national parks. This will be a simple .NET class with a handful of properties.</p><p>To create an entity class, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Right-click on <code class="literal">NationalParks.iOS</code> project and select the <span class="strong"><strong>New File</strong></span> option.</li><li class="listitem">In the <span class="strong"><strong>New File</strong></span> dialog box, select the <span class="strong"><strong>General</strong></span> section, select <span class="strong"><strong>Empty Class</strong></span>, enter <code class="literal">NationalPark</code> in the <span class="strong"><strong>Name</strong></span> field, and click on <span class="strong"><strong>New</strong></span>.</li></ol></div><p>The following code demonstrates what is needed for the entity class:</p><div class="informalexample"><pre class="programlisting">public class NationalPark
{
  public NationalPark ()
  {
    Id = Guid.NewGuid ().ToString();
    Name = "New Park";
  }

  public string Id { get; set; }
  public string Name { get; set; }
  public string Description { get; set; }
  public string State { get; set; }
  public string Country { get; set; }
  public double? Latitude { get; set; }
  public double? Longitude { get; set; }

  public override string ToString ()
  {
    return Name;
  }
}</pre></div></div></div><div class="section" title="Adding a JSON-formatted file"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec3700"/>Adding a JSON-formatted file</h2></div></div></div><p>Now, we need a file filled with JSON-formatted national parks. You can find such a file in the <a class="indexterm" id="id250"/>assets folder of the downloaded solutions. The name of the file is <code class="literal">NationalParks.json</code>.</p><p>To add <a class="indexterm" id="id251"/>the data file to the project, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Copy the <code class="literal">NationalParks.json</code> file to the <code class="literal">NationalParks.iOS</code> project folder.</li><li class="listitem">Right-click on the <code class="literal">NationalParks.iOS</code> project and choose <span class="strong"><strong>Add Files</strong></span>, select <code class="literal">NationalParks.json</code> and click on <span class="strong"><strong>Open</strong></span>.</li><li class="listitem">Double-click on the <code class="literal">NationalParks.json</code> file to open it and view the content.</li></ol></div><p>There are several file properties that must be set that determine how the file is handled during the compilation and deployment process. We want the file to be treated as content and placed in the same folder as the app during deployment. The following screenshot shows the settings required to accomplish this. The panels to adjust these settings are in the <span class="strong"><strong>Properties</strong></span> tab on the right-hand side of Xamarin Studio.</p><div class="mediaobject"><img alt="Adding a JSON-formatted file" src="graphics/0838OT_04_10.jpg"/></div><p>This is not an ideal location for apps to store their data for a production distribution, but will work for our purpose in this chapter. In <a class="link" href="ch05.html" title="Chapter 5. Developing Your First Android App with Xamarin.Android">Chapter 5</a>, <span class="emphasis"><em>Developing Your First Android App with Xamarin.Android</em></span>, we will <a class="indexterm" id="id252"/>build a more robust <a class="indexterm" id="id253"/>storage mechanism when we discuss sharing code between iOS and Android apps.</p><div class="section" title="Loading objects from a JSON-formatted file"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec13"/>Loading objects from a JSON-formatted file</h3></div></div></div><p>Now, we need to add the logic to load data from the file to a list.</p><p>To <a class="indexterm" id="id254"/>load objects <a class="indexterm" id="id255"/>from a file, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">As you recall, when our app was generated, the <code class="literal">UITableViewSource</code> file placed in <code class="literal">MasterViewController.cs</code> used a <code class="literal">List&lt;object&gt;</code> object to populate the list. We need to convert this to <code class="literal">List&lt;NationalPark&gt;</code> <code class="literal">Parks</code>, as follows:<div class="informalexample"><pre class="programlisting">readonly List&lt;NationalPark&gt; parks;</pre></div><p>Note that we do not instantiate the <code class="literal">Parks</code> list; Json.NET will do this for us when we deserialize the JSON string.</p></li><li class="listitem">We also need to convert the <code class="literal">Objects</code> property defined on <code class="literal">DataSource</code> to the following:<div class="informalexample"><pre class="programlisting">public IList&lt;NationalPark&gt; Parks {get {return parks;}}</pre></div></li><li class="listitem">Add the <code class="literal">using</code> clauses for <code class="literal">System.IO</code> and <code class="literal">Newtonsoft.Json</code> in preparation to add the load and deserialize steps:<div class="informalexample"><pre class="programlisting">using System.IO;
. . .
using Newtonsoft.Json;</pre></div></li><li class="listitem">The JSON file will be placed in the <code class="literal">app</code> folder; the <code class="literal">Environment.CurrentDirectory</code> property gives us the path to this location. Loading objects from this file requires two basic steps. The first step is <a class="indexterm" id="id256"/>to read the text into a string with <code class="literal">File.ReadAllText()</code>. The second step is to deserialize the objects into a list using <code class="literal">JsonConvert.DeserializeObject&lt;&gt;()</code>. The following code sample demonstrates <a class="indexterm" id="id257"/>what needs to be placed in the constructor of the <code class="literal">DataSource</code> class:<div class="informalexample"><pre class="programlisting">string dataFolder = Environment.CurrentDirectory;
string serializedParks =
    File.ReadAllText (Path.Combine(dataFolder,
        "NationalParks.json"));
parks =
    JsonConvert.DeserializeObject&lt;List&lt;NationalPark&gt;&gt;
        (serializedParks);</pre></div></li></ol></div></div><div class="section" title="Saving objects to a JSON-formatted file"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec14"/>Saving objects to a JSON-formatted file</h3></div></div></div><p>Saving <a class="indexterm" id="id258"/>objects to a <a class="indexterm" id="id259"/>JSON-formatted file is just as simple as loading them. Simply call <code class="literal">JsonConvert.SerializeObject()</code> to create a JSON representation of the object(s) in a string and write the resulting string to a text file using <code class="literal">File.WriteAllText()</code>. The following code demonstrates what is needed:</p><div class="informalexample"><pre class="programlisting">string dataFolder = Environment.CurrentDirectory;
string serializedParks =
     JsonConvert.SerializeObject (dataSource.Parks);
File.WriteAllText(Path.Combine(dataFolder,
     "NationalParks.json"), serializedParks);</pre></div><p>We will use this logic in the upcoming section titled <span class="emphasis"><em>Implementing the Done Clicked event handler</em></span>.</p></div><div class="section" title="Running the app"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec15"/>Running the app</h3></div></div></div><p>We are <a class="indexterm" id="id260"/>now ready to take a look at some of our work. Run the app and notice the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">MasterViewController</code> is populated with information from <code class="literal">NationalParks.json</code></li><li class="listitem" style="list-style-type: disc">Selecting a park displays <code class="literal">DetailViewController</code> populated with the name of the park</li><li class="listitem" style="list-style-type: disc">Clicking on the <span class="strong"><strong>Add</strong></span> button from <code class="literal">MasterViewController</code> adds a new park with the name <span class="strong"><strong>New Park</strong></span></li></ul></div></div></div><div class="section" title="Enhancing the UI"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec41"/>Enhancing the UI</h2></div></div></div><p>We <a class="indexterm" id="id261"/>will now turn our attention to create a <a class="indexterm" id="id262"/>more robust UI that will support listing items, view item details, and edit new and existing items. This is a common pattern for mobile apps and we already have about 75 percent of what we need. We need to make the following additions:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add a new view controller named <code class="literal">EditViewController</code> that can be used to edit new or existing national parks.</li><li class="listitem">Change the <span class="strong"><strong>Add</strong></span> button on <code class="literal">MasterViewController</code> to open a new national park entry in <code class="literal">EditViewController</code>.</li><li class="listitem">Add fields to <code class="literal">DetailViewController</code> that will display all the properties of a national park and an <span class="strong"><strong>Edit</strong></span> button that will navigate to <code class="literal">EditViewController</code> to edit the current item.</li></ol></div><p>As we discussed in <a class="link" href="ch02.html" title="Chapter 2. Demystifying Xamarin.iOS">Chapter 2</a>, <span class="emphasis"><em>Demystifying Xamarin.iOS</em></span>, we have two options to edit storyboards: Xcode Interface Builder and the Xamarin.iOS Designer. Either of these tools can be used based on preference. Within Xamarin Studio, you can choose which tool to launch by selecting a storyboard file, right-click on it and select <span class="strong"><strong>Open With</strong></span>. The following screenshot <a class="indexterm" id="id263"/>shows the storyboard context menu:</p><div class="mediaobject"><img alt="Enhancing the UI" src="graphics/0838OT_04_15.jpg"/></div><p>The rest of this chapter will be based on using the Xamarin.iOS Designer. If you choose to work with Xcode Interface Builder, you need to be aware that when changes are made in Xcode, there is a synchronization process that takes place when the Xamarin Studio becomes active again. This process synchronizes changes made in Xcode with C# designer class files and creates appropriate outlets and actions. The following screenshot shows Xamarin <a class="indexterm" id="id264"/>Studio's status bar during synchronization:</p><div class="mediaobject"><img alt="Enhancing the UI" src="graphics/0838OT_04_24.jpg"/></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note09"/>Note</h3><p>If you would like more guidance with Xamarin.iOS Designer or need a kick start or refresher course on using Xcode Interface Builder, the following links provide tutorials:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Xamarin <a class="indexterm" id="id265"/>Tutorial for using Xamarin.iOS Designer available at <a class="ulink" href="http://developer.xamarin.com/guides/ios/user_interface/designer/">http://developer.xamarin.com/guides/ios/user_interface/designer/</a></li><li class="listitem" style="list-style-type: disc">Apple <a class="indexterm" id="id266"/>Tutorial for Xcode Interface Builder available at <a class="ulink" href="https://developer.apple.com/library/ios/documentation/ToolsLanguages/Conceptual/Xcode_Overview/chapters/edit_user_interface.html">https://developer.apple.com/library/ios/documentation/ToolsLanguages/Conceptual/Xcode_Overview/chapters/edit_user_interface.html</a></li><li class="listitem" style="list-style-type: disc">Xamarin <a class="indexterm" id="id267"/>Tutorial for using Xcode Interface Builder available at <a class="ulink" href="http://docs.xamarin.com/guides/ios/user_interface/tables/part_5_-_using_xcode,_interface_builder,_and_storyboards/">http://docs.xamarin.com/guides/ios/user_interface/tables/part_5_-_using_xcode,_interface_builder,_and_storyboards/</a></li></ul></div></div></div><div class="section" title="Touring the Xamarin.iOS Designer"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec16"/>Touring the Xamarin.iOS Designer</h3></div></div></div><p>Xamarin.iOS Designer provides a full set of tools to create and edit storyboard files. As this <a class="indexterm" id="id268"/>might be your first <a class="indexterm" id="id269"/>time using the tool, we will devote a few minutes to get familiar with it. To do so, follow the given <a class="indexterm" id="id270"/>steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Double-click on <code class="literal">MainStoryboard.storyboard</code> to open the storyboard in Xamarin.iOS Designer. You will see <code class="literal">NavigationController</code>, <code class="literal">MasterViewController</code>, <code class="literal">DetailViewController</code>, and segues that connect everything, as shown in following screenshot:<div class="mediaobject"><img alt="Touring the Xamarin.iOS Designer" src="graphics/0838OT_04_21.jpg"/></div></li><li class="listitem">Note the <span class="strong"><strong>Toolbox</strong></span> pad in the lower right-hand corner of Xamarin Studio. It contains all the items that can be used within a storyboard. You can search for <a class="indexterm" id="id271"/>items <a class="indexterm" id="id272"/>using the search field. The <span class="strong"><strong>Toolbox</strong></span> pad is shown in the following screenshot:<div class="mediaobject"><img alt="Touring the Xamarin.iOS Designer" src="graphics/0838OT_04_16.jpg"/></div></li><li class="listitem">Note the <span class="strong"><strong>Document Outline</strong></span> pad in the upper-right hand corner of Xamarin Studio. This view depicts the content of the storyboard in a hierarchical form that <a class="indexterm" id="id273"/>you can use to drill down to view increasing levels of detail. The <span class="strong"><strong>Document Outline</strong></span> <a class="indexterm" id="id274"/>pad is very helpful to view and select specific elements in a storyboard, as <a class="indexterm" id="id275"/>shown in the following screenshot:<div class="mediaobject"><img alt="Touring the Xamarin.iOS Designer" src="graphics/0838OT_04_17.jpg"/></div></li><li class="listitem">Note the <span class="strong"><strong>Properties</strong></span> pad in the upper-right hand corner of Xamarin Studio; you can access it by clicking on the tab labeled <span class="strong"><strong>Properties</strong></span>. The <span class="strong"><strong>Properties</strong></span> pad allows you to edit properties for the currently selected item. Entering a name for a control in the <span class="strong"><strong>Widget</strong></span> section will automatically create an outlet and entering names in the <span class="strong"><strong>Events</strong></span> section will automatically create an action. The <span class="strong"><strong>Properties</strong></span> pad is shown in the following screenshot:<div class="mediaobject"><img alt="Touring the Xamarin.iOS Designer" src="graphics/0838OT_04_22.jpg"/></div></li><li class="listitem">Note <a class="indexterm" id="id276"/>the top of the designer that contains a number of controls to adjust options, such as <a class="indexterm" id="id277"/>iOS version, device size, device orientation, and level of zoom. There are also <a class="indexterm" id="id278"/>controls to establish constraints, as shown in the following screenshot:<div class="mediaobject"><img alt="Touring the Xamarin.iOS Designer" src="graphics/0838OT_04_23.jpg"/></div></li><li class="listitem">Selecting items in the designer can be a little tricky, particularly when selecting a view controller. If you click in the middle of the view controller, the view will be <a class="indexterm" id="id279"/>selected and not the view controller. There are three different ways to select a view controller:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Right-click in the middle of the view controller and navigate to <span class="strong"><strong>View Controller</strong></span> | <span class="strong"><strong>Select</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img alt="Touring the Xamarin.iOS Designer" src="graphics/0838OT_04_25.jpg"/></div></li><li class="listitem" style="list-style-type: disc">Click <a class="indexterm" id="id280"/>on the bar at the bottom of the view controller, as shown in the following screenshot:<div class="mediaobject"><img alt="Touring the Xamarin.iOS Designer" src="graphics/0838OT_04_26.jpg"/></div></li><li class="listitem" style="list-style-type: disc">Select <a class="indexterm" id="id281"/>the view controller in the <span class="strong"><strong>Document Outline</strong></span> pad</li></ul></div></li></ol></div></div><div class="section" title="Adding EditViewController and segues"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec17"/>Adding EditViewController and segues</h3></div></div></div><p>With a <a class="indexterm" id="id282"/>basic understanding <a class="indexterm" id="id283"/>of Xamarin.iOS Designer, we <a class="indexterm" id="id284"/>are now ready <a class="indexterm" id="id285"/>to add a new view controller and segues.</p><p>To <a class="indexterm" id="id286"/>add <code class="literal">EditViewController</code> and segues, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Double-click on <code class="literal">MainStoryboard.storyboard</code> to open the storyboard in Xamarin.iOS Designer. You will see <code class="literal">MasterViewController</code> and <code class="literal">DetailViewController</code> in the file with a segue between them.</li><li class="listitem">Create <a class="indexterm" id="id287"/>a new <code class="literal">UIViewController</code> by selecting the <span class="strong"><strong>View Controller</strong></span> item from the <span class="strong"><strong>Toolbox</strong></span> pad and drag-and-drop it on the designer view.</li><li class="listitem">Name the new view controller <code class="literal">EditViewController</code> by clicking on the bar at the bottom to select it, switch to the <span class="strong"><strong>Properties</strong></span> pad, and enter <code class="literal">EditViewController</code> for the <span class="strong"><strong>Class</strong></span> field. The following screenshot depicts the <span class="strong"><strong>Properties</strong></span> pad:<div class="mediaobject"><img alt="Adding EditViewController and segues" src="graphics/0838OT_04_20.jpg"/></div></li><li class="listitem">Add a Bar Button Item to the right-hand side of the Navigation Item on <code class="literal">DetailViewController</code> and set the <span class="strong"><strong>Identifier</strong></span> button to <span class="strong"><strong>Edit</strong></span> on the <span class="strong"><strong>Widget</strong></span> section of the <span class="strong"><strong>Properties</strong></span> pad.</li><li class="listitem">Add a push segue from the <span class="strong"><strong>Edit</strong></span> button on <code class="literal">DetailViewController</code> to the new <a class="indexterm" id="id288"/>controller, <code class="literal">EditViewController</code>. Press and hold the <span class="emphasis"><em>Ctrl</em></span> key, click and hold <a class="indexterm" id="id289"/>the <span class="strong"><strong>Edit</strong></span> button, drag it to the bar at the bottom of <code class="literal">EditViewController</code>, let go of the mouse, choose <span class="strong"><strong>Push</strong></span> and enter <code class="literal">editFromDetail</code> for the <span class="strong"><strong>Identifier</strong></span> option <a class="indexterm" id="id290"/>on the <span class="strong"><strong>Widget</strong></span> section of the <span class="strong"><strong>Properties</strong></span> pad.</li><li class="listitem">Add a <a class="indexterm" id="id291"/>Bar Button Item to the right-hand side of the Navigation Item on <code class="literal">MasterViewController</code> and set the <span class="strong"><strong>Identifier</strong></span> button to <span class="strong"><strong>Add</strong></span>.</li><li class="listitem">Add a <a class="indexterm" id="id292"/>push segue from the <span class="strong"><strong>Add</strong></span> button on <code class="literal">MasterViewController</code> to the new controller, <code class="literal">EditViewController</code>. Press and hold the <span class="emphasis"><em>Ctrl</em></span> key, click and hold <a class="indexterm" id="id293"/>the <span class="strong"><strong>Add</strong></span> button, drag it to the bar at the bottom of <code class="literal">EditViewController</code>, let go of the mouse, choose <span class="strong"><strong>Push</strong></span>, and enter <code class="literal">editFromMaster</code> for the <span class="strong"><strong>Identifier</strong></span> option on the <span class="strong"><strong>Widget</strong></span> section of the <span class="strong"><strong>Properties</strong></span> pad.</li><li class="listitem">Add a Bar Button Item to the right-hand side of the Navigation Item on <code class="literal">EditViewController</code> and set the <span class="strong"><strong>Identifier</strong></span> option to <span class="strong"><strong>Done</strong></span>. Name the button <code class="literal">DoneButton</code>. Naming the button will create an outlet that can later be used as a reference to assign a traditional .NET event handler.</li><li class="listitem">Add a label, <code class="literal">UILabel</code>, to the center of <code class="literal">EditViewController</code>. This will be used temporarily to display the name of an item, while we test and debug the navigation of the app. Name this <code class="literal">UILabel</code> instance as <code class="literal">editDescriptionLabel</code>.</li><li class="listitem">Add <a class="indexterm" id="id294"/>a <code class="literal">UIButton</code> instance to <code class="literal">EditViewController</code> and set the <span class="strong"><strong>Title</strong></span> option to <span class="strong"><strong>Delete</strong></span>. Add an action named <code class="literal">DeleteClicked</code> to the <span class="strong"><strong>Touch Down</strong></span> event in the <span class="strong"><strong>Events</strong></span> section <a class="indexterm" id="id295"/>of the <span class="strong"><strong>Properties</strong></span> pad. Creating an action will generate a partial method that we can later complete with logic to implement the <code class="literal">DeleteClicked</code> event handler.</li><li class="listitem">Save all of the changes made.</li><li class="listitem">Now, we need to write some code to tie everything together. Let's start by looking at some of the code that was generated as a result of our work in Xamarin.iOS Designer. You will find two files that have been added for <code class="literal">EditViewController</code>, a designer file named <code class="literal">EditViewController.designer.cs</code> nested under a nondesigner file named <code class="literal">EditViewController.cs</code>. Double-click on the designer class to view <a class="indexterm" id="id296"/>the contents, as shown <a class="indexterm" id="id297"/>in the following <a class="indexterm" id="id298"/>code snippet:</li></ol></div><div class="informalexample"><pre class="programlisting">[Outlet]
MonoTouch.UIKit.UIBarButtonItem DoneButton { get; set; }
[Outlet]

MonoTouch.UIKit.UILabel editContent { get; set; }
[Action ("DeleteClicked:")]
Partial void DeleteClicked (
    MonoTouch.Foundation.NSObject sender);</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note10"/>Note</h3><p>Note <a class="indexterm" id="id299"/>that <code class="literal">EditViewController</code> is a partial class; the two outlets and the actions were generated based on the specifications we made.</p></div></div></div><div class="section" title="Implementing the DoneClicked event handler"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec18"/>Implementing the DoneClicked event handler</h3></div></div></div><p>For the <a class="indexterm" id="id300"/><span class="strong"><strong>Done</strong></span> button, we created an outlet so we will have a reference to the object that can be used <a class="indexterm" id="id301"/>to assign a .NET event handler at runtime. When <span class="strong"><strong>Done</strong></span> is clicked on, we need to do a few things. First, check whether we are dealing with a new object and add it to the <code class="literal">_parks</code> collection. If so, then we need to save the <code class="literal">_parks</code> collection to <code class="literal">NationalParks.json</code>.</p><p>To <a class="indexterm" id="id302"/>implement the <span class="strong"><strong>Done</strong></span> button, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a method to save changes to <code class="literal">NationalParks.json</code>, as follows:<div class="informalexample"><pre class="programlisting">private void SaveParks()
{
   string dataFolder = Environment.CurrentDirectory;
   string serializedParks = JsonConvert.SerializeObject (_parks);
      File.WriteAllText(Path.Combine(dataFolder,
        "NationalParks.json"), serializedParks);
}</pre></div></li><li class="listitem">Create <a class="indexterm" id="id303"/>a .NET event handler named <code class="literal">DoneClicked</code> and add logic to add <code class="literal">_park</code> to the <code class="literal">_parks</code> collection. If it's a new park, call the <code class="literal">SaveParks()</code> method <a class="indexterm" id="id304"/>to save updates to <code class="literal">NationalParks.json</code>, and to return to the previous view controller, use the following code snippet:<div class="informalexample"><pre class="programlisting">private void DoneClicked (object sender, EventArgs e)
{

  if (!_parks.Contains (_park))
      _parks.Add (_park);

  SaveParks ();
  NavigationController.PopViewControllerAnimated (true);
}

Assign the DoneClicked event handler to the Clicked event on the DoneButton outlet in ViewDidLoad().

public override void ViewDidLoad (){
  . . .   DoneButton.Clicked += DoneClicked;}</pre></div></li></ol></div></div><div class="section" title="Implementing the DeleteClicked action"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec19"/>Implementing the DeleteClicked action</h3></div></div></div><p>We <a class="indexterm" id="id305"/>created an action <a class="indexterm" id="id306"/>for the <span class="strong"><strong>Delete</strong></span> button, which caused a partial method to be created in the designer class. We now need to <a class="indexterm" id="id307"/>create an implementation for the partial method.</p><p>To implement the <span class="strong"><strong>Delete</strong></span> action all you need to do is add a <code class="literal">partial</code> method implementation for <code class="literal">DeleteClicked</code> that removes <code class="literal">_park</code> from the <code class="literal">parks</code> collection and saves the change to the <code class="literal">NationalParks.json</code> file, which will then return to the <code class="literal">MasterViewController</code>. This can be done by:</p><div class="informalexample"><pre class="programlisting">partial void DeleteClicked (UIButton sender)
{
    if (_parks.Contains(_park))
       _parks.Remove(_park);

   SaveParks();
    
    NavigationController.PopToRootViewController(true);
    }</pre></div><p>The two approaches demonstrated to implement event handlers accomplish essentially the same thing without having a clear advantage over the other. As we don't have the event handler assignment in <code class="literal">ViewDidLoad()</code> for the action, it's slightly less coded. It really <a class="indexterm" id="id308"/>comes down to which method you prefer and become most comfortable with.</p></div><div class="section" title="Passing data"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec20"/>Passing data</h3></div></div></div><p>All iOS <a class="indexterm" id="id309"/>apps have a need to navigate between views and pass data. As we are using storyboards and segues for the UI, most of the <a class="indexterm" id="id310"/>work related to navigation is done for us. However, we need to pass data between the views. There are two parts to accomplish <a class="indexterm" id="id311"/>this: define a way that a view controller will accept data and use this mechanism from the initiating view controller. As far as accepting data is concerned, this can be accomplished with the use of simple properties on the view controller, or by defining a method that accepts the data and saves it to private variables. We will go with defining a method to accept navigation data, which is also the approach the code that was generated for us uses.</p><p>To complete the logic to accept navigation data, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">DetailViewController</code> and locate the <code class="literal">SetDetailItem</code> method.</li><li class="listitem">Let's start by changing the name to be a little more meaningful. Select the <code class="literal">SetDetailItem</code> text in the editor, right-click and navigate to <span class="strong"><strong>Refactor</strong></span> | <span class="strong"><strong>Rename</strong></span>. Enter <code class="literal">SetNavData</code> and click on <span class="strong"><strong>OK</strong></span>.</li><li class="listitem">Let's also rename <code class="literal">ConfigureView ()</code> to <code class="literal">ToUI()</code> using the same method.</li><li class="listitem">Change the <code class="literal">SetNavData()</code> method so that it accepts a list of <code class="literal">NationalPark</code> items as well as the single park that should be displayed and saves these parameters to a set of private variables. Also, remove the call to <code class="literal">ToUI()</code>; we will move <a class="indexterm" id="id312"/>this to a more appropriate place in the next step, as shown in the following code:<div class="informalexample"><pre class="programlisting">IList&lt;NationalPark&gt; _parks;
NationalPark _park;
. . .
public void SetNavData(
    IList&lt;NationalPark&gt; parks, NationalPark park)
{
    _parks = parks;
    _park = park;
}</pre></div></li><li class="listitem">Override <code class="literal">ViewWillAppear()</code> to call <code class="literal">ToUI()</code>, as follows:<div class="informalexample"><pre class="programlisting">public override void ViewWillAppear (bool animated)
{
    ToUI ();
}</pre></div></li><li class="listitem">Update <a class="indexterm" id="id313"/><code class="literal">ToUI()</code> so that it populates <code class="literal">UILabel</code> using the private <code class="literal">_park</code> variable, as follows:<div class="informalexample"><pre class="programlisting">void ToUI()
{
    // Update the user interface for the detail item
    if (_park != null)
       detailDescriptionLabel.Text = _park.ToString ();
}</pre></div></li><li class="listitem">Now, add <code class="literal">SetNavData()</code> and <code class="literal">ToUI()</code> methods to <code class="literal">EditViewController</code> that has the same function as <code class="literal">DetailViewController</code>.</li></ol></div><p>Now that we have taken care of receiving navigation data, we turn our attention to passing data. When using segues, iOS view controller has the <code class="literal">PrepareForSegue()</code> method that <a class="indexterm" id="id314"/>can be overridden to prepare the target view controller for display. We need to override <code class="literal">PrepareForSegue()</code> in both <code class="literal">MasterViewController</code> and <code class="literal">DetailViewController</code>.</p><p>To complete <a class="indexterm" id="id315"/>the logic to pass navigation data, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">MasterViewController</code> and locate the existing <code class="literal">PrepareForSegue()</code> method.</li><li class="listitem"><code class="literal">MasterViewController</code> actually has two segues: the original segue that navigates to <code class="literal">DetailViewController</code> and the new one we added that navigates to <code class="literal">EditViewController</code>. The <code class="literal">PrepareForSegue()</code> method provides a segue parameter that has an <code class="literal">Identifier</code> property that can be used to determine which navigation path is being taken. Change the code in <code class="literal">PrepareForSegue()</code> so that it calls <code class="literal">SetNavData()</code> on the appropriate view controller based on the segue identifier, as follows:<div class="informalexample"><pre class="programlisting">public override void PrepareForSegue (
    UIStoryboardSegue segue, NSObject sender)
{
  if (segue.Identifier == "showDetail") {
    var indexPath = TableView.IndexPathForSelectedRow;
    var item = dataSource.Parks [indexPath.Row];
    ((DetailViewController)segue.
        DestinationViewController).SetNavData
           (dataSource.Parks, item);
  }
  else if (segue.Identifier == "editFromMaster") {
    ((EditViewController)segue.
        DestinationViewController).SetNavData
          (dataSource.Parks, new NationalPark());
  }
}</pre></div></li><li class="listitem">Now, open <code class="literal">DetailViewController</code> and create an override for <code class="literal">PrepareForSegue()</code> that <a class="indexterm" id="id316"/>passes <a class="indexterm" id="id317"/>navigation data to <code class="literal">EditViewController</code>, as follows:<div class="informalexample"><pre class="programlisting">public override void PrepareForSegue (
    UIStoryboardSegue segue, NSObject sender)
{
  if (segue.Identifier == "editFromDetail") {
   ((EditViewController)segue.
     DestinationViewController).SetNavData
       (_parks, _park);
  }
}</pre></div></li></ol></div></div><div class="section" title="Running the app"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec21"/>Running the app</h3></div></div></div><p>We have <a class="indexterm" id="id318"/>made a lot of changes and are now ready to <a class="indexterm" id="id319"/>run the app to test the basic navigation. Start the app and test navigation to the various views; observe the following:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">When you click the <span class="strong"><strong>+</strong></span> (add) button on <code class="literal">MasterViewController</code>, a new national park is displayed in <code class="literal">EditViewController</code>.</li><li class="listitem">When you click the <span class="strong"><strong>Edit</strong></span> button on <code class="literal">DetailViewController</code>, the app navigates to <code class="literal">EditViewController</code> that shows the current park.</li><li class="listitem">When you click on <span class="strong"><strong>Done</strong></span> on <code class="literal">EditViewController</code>, it will take you to the previous view controller, either <code class="literal">MasterViewController</code> or <code class="literal">DetailViewController</code>.</li><li class="listitem">When you click on <span class="strong"><strong>Delete</strong></span> on <code class="literal">EditViewController</code>, it will take you to <code class="literal">MasterViewController</code>.</li></ol></div><p>The following <a class="indexterm" id="id320"/>screenshots depict what you should see:</p><div class="mediaobject"><img alt="Running the app" src="graphics/0838OT_04_11.jpg"/></div></div></div></div>
<div class="section" title="Finishing the sample app"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec38"/>Finishing the sample app</h1></div></div></div><p>The view <a class="indexterm" id="id321"/>controllers and navigation are now in place. All we need now is to add some addition controls to view and edit information and a little logic.</p><div class="section" title="Finishing DetailViewController"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec42"/>Finishing DetailViewController</h2></div></div></div><p>To <a class="indexterm" id="id322"/>finish <code class="literal">DetailViewController</code>, we need a set of <code class="literal">UILabel</code> controls that can be used to display the <a class="indexterm" id="id323"/>properties of a park, and add buttons that can initiate actions to view photos or receive directions.</p><p>To finish <code class="literal">DetailViewController</code>, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add a <code class="literal">UIScrollView</code> onto the View for <code class="literal">DetailViewController</code>.</li><li class="listitem">Add <code class="literal">UILabel</code> controls for each property defined on <code class="literal">NationalPark</code> except for the <code class="literal">Id</code> property. Also add <code class="literal">UILabel</code> controls that can be used as labels for the properties. Use the screen mockups from the <span class="emphasis"><em>The sample national parks app</em></span> section as a guide to lay out the controls.</li><li class="listitem">Enter a name for each <code class="literal">UILabel</code> control that will be used to display park properties so that outlets can be created.</li><li class="listitem">Update the <code class="literal">ToUI()</code> method so that the <code class="literal">UILabel</code> controls are populated with data from the park, as follows:<div class="informalexample"><pre class="programlisting">void ToUI()
{
  // Update the user interface for the detail item
  if (IsViewLoaded &amp;&amp; _park != null) {
      nameLabel.Text = _park.Name;
      descriptionLabel.Text = _park.Description;
      stateLabel.Text = _park.State;
      countryLabel.Text = _park.Country;
      latitudeLabel.Text = _park.Latitude.ToString ();
      longitudeLabel.Text = _park.Longitude.ToString ();
  }
}</pre></div></li><li class="listitem">Add a <code class="literal">UIButton</code> instance with a title of photos with an action named <code class="literal">PhotoClicked</code> in the <code class="literal">Touch Down</code> event.</li><li class="listitem">Add <a class="indexterm" id="id324"/>an implementation for the <code class="literal">PhotoClicked</code> action, which opens a URL to view photos on <a class="ulink" href="http://www.bing.com">www.bing.com</a> that uses the park's name as the search parameter:<div class="informalexample"><pre class="programlisting">partial void PhotosClicked (UIButton sender)
{
    string encodedUriString =
       Uri.EscapeUriString(String.Format(
          "http://www.bing.com/images/search?q={0}", _park.Name));
   NSUrl url = new NSUrl(encodedUriString);
   UIApplication.SharedApplication.OpenUrl (url);
}</pre></div></li><li class="listitem">Add a <code class="literal">UIButton</code> instance with a title of directions with an action named <code class="literal">DirectionsClicked</code> in the <code class="literal">Touch Down</code> event.</li><li class="listitem">Add an implementation for the <code class="literal">DirectionsClicked</code> action, which opens a URL to <a class="indexterm" id="id325"/>receive directions to a park that uses the park's latitude and longitude coordinates<a class="indexterm" id="id326"/>:<div class="informalexample"><pre class="programlisting">partial void DirectionsClicked (UIButton sender)
{
    if ((_park.Latitude.HasValue) &amp;&amp; (_park.Longitude.HasValue))
    {
        NSUrl url = new NSUrl (
               String.Format(
                   "http://maps.apple.com/maps?daddr={0},{1}",
                    _park.Latitude, _park.Longitude));

       UIApplication.SharedApplication.OpenUrl (url);
   }
}</pre></div></li><li class="listitem">Add appropriate constraints to <code class="literal">UIScrollView</code> and and <code class="literal">UILables</code> so that scrolling and layout works as desired in the landscape and portrait modes. Take a look at the example for more clarity.</li></ol></div></div><div class="section" title="Finishing EditViewController"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec43"/>Finishing EditViewController</h2></div></div></div><p>To <a class="indexterm" id="id327"/>finish <code class="literal">EditViewController</code>, we need to add labels and edit controls in order to edit the park data. We <a class="indexterm" id="id328"/>also need to do some data conversion and save the updates.</p><p>To finish <code class="literal">EditViewController</code>, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add a <code class="literal">UIScrollView</code> instance on the View for <code class="literal">EditViewController</code>.</li><li class="listitem">Add controls to the <code class="literal">EditViewController</code> class along with the corresponding outlets to allow editing of each property on the <code class="literal">NationalPark</code> entity. The <code class="literal">UITextField</code> controls can be used for everything except the description property, which is better suited to a <code class="literal">UITextView</code> control. Also add <code class="literal">UITextLabel</code> controls to label properties of the park. You can again use the screen mockups from the <span class="emphasis"><em>The sample national parks app</em></span> section as a guide.</li><li class="listitem">Update the <code class="literal">ToUI()</code> method to account for the new fields:<div class="informalexample"><pre class="programlisting">private void ToUI ()
{
   // Update the user interface for the detail item
   if (IsViewLoaded &amp;&amp; _park != null) {
     nameTextField.Text = _park.Name;
     descriptionTextView.Text = _park.Description;
     stateTextField.Text = _park.State;
     countryTextField.Text = _park.State;
     latitudeTextField.Text = _park.Latitude.ToString();
     longitudeTextField.Text =
             _park.Longitude.ToString(); 
   }
}</pre></div></li><li class="listitem">Create <a class="indexterm" id="id329"/>a new <a class="indexterm" id="id330"/>method that moves data from the UI controls to the entity class prior to saving it, as follows:<div class="informalexample"><pre class="programlisting">void ToPark()
{
  _park.Name = nameTextField.Text;
  _park.Description = descriptionTextView.Text;
  _park.State = stateTextField.Text;
  _park.Country = countryTextField.Text;

  if (String.IsNullOrEmpty (latitudeTextField.Text))
    _park.Latitude =
        Double.Parse (latitudeTextField.Text);
  else
        _park.Latitude = null;

  if (String.IsNullOrEmpty (longitudeTextField.Text))
    _park.Longitude =
        Double.Parse (longitudeTextField.Text);
  else
    _park.Longitude = null;
}</pre></div></li><li class="listitem">Update the <code class="literal">DoneClicked()</code> action to call <code class="literal">ToPark()</code> in order to move values to the <a class="indexterm" id="id331"/>park object prior to saving changes to <code class="literal">NationalParks.json</code>:<div class="informalexample"><pre class="programlisting">partial void DoneClicked (NSObject sender)
   {
    ToPark ();

    . . .
}</pre></div></li><li class="listitem">Add appropriate constraints to <code class="literal">UIScrollView</code> and <code class="literal">UITextFields</code> so that scrolling and layout works as desired in landscape and portrait modes. Take a look at the reference solution for more clarity.</li><li class="listitem">Add logic to scroll the active <code class="literal">UITextField</code> into view when the keyboard is displayed. There are several methods of accomplishing this. Refer to the example for reference solution.</li></ol></div></div><div class="section" title="Running the app"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec44"/>Running the app</h2></div></div></div><p>Okay, we <a class="indexterm" id="id332"/>now have a fairly functional app. Run the app in the simulator and test each screen and navigation path. The following screenshots show the final result of the three view controllers:</p><div class="mediaobject"><img alt="Running the app" src="graphics/0838OT_04_12.jpg"/></div></div></div>
<div class="section" title="MonoTouch.Dialog"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec39"/>MonoTouch.Dialog</h1></div></div></div><p>
<span class="strong"><strong>MonoTouch.Dialog</strong></span> (<span class="strong"><strong>MT.D</strong></span>) is a framework for Xamarin.iOS that provides a declarative approach to <a class="indexterm" id="id333"/>develop the user interface <a class="indexterm" id="id334"/>and eliminates writing a lot of the tedious code. MT.D is based on using <code class="literal">UITableView</code> controls to provide navigation and allow users to interact with data.</p><p>More information <a class="indexterm" id="id335"/>about MT.D can be found at <a class="ulink" href="http://docs.xamarin.com/guides/ios/user_interface/monotouch.dialog/">http://docs.xamarin.com/guides/ios/user_interface/monotouch.dialog/</a>.</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec40"/>Summary</h1></div></div></div><p>In this chapter, we created a sample Xamarin.iOS app and demonstrated the concepts that need to be understood to work with the Xamarin.iOS platform. While we did not demonstrate all of the features that we can use in an iOS app, you should now feel comfortable with how to access these features.</p><p>In the next chapter, we will build the same sample app for Android.</p></div></body></html>