<html><head></head><body><div id="book-content"><div id="sbo-rt-content"><div id="_idContainer275" class="Basic-Text-Frame">
    <h1 class="chapterNumber">4</h1>
    <h1 id="_idParaDest-248" class="chapterTitle">Writing, Debugging, and Testing Functions</h1>
    <p class="normal">This chapter is about writing functions to reuse code, debugging logic errors during development, unit testing your code to remove bugs, and improving stability and reliability.</p>
    <p class="normal">In an optional online-only section, you will learn about logging exceptions during runtime. You can find information on this at the end of the chapter.</p>
    <p class="normal">This chapter covers the following topics:</p>
    <ul>
      <li class="bulletList">Writing functions</li>
      <li class="bulletList">Debugging during development</li>
      <li class="bulletList">Hot reloading during development</li>
      <li class="bulletList">Unit testing</li>
      <li class="bulletList">Throwing and catching exceptions in functions</li>
    </ul>
    <h1 id="_idParaDest-249" class="heading-1">Writing functions</h1>
    <p class="normal">A fundamental principle of <a id="_idIndexMarker467"/>programming is <strong class="keyWord">don’t repeat yourself</strong> (<strong class="keyWord">DRY</strong>).</p>
    <p class="normal">While programming, if you find yourself writing the same statements over and over again, then turn those statements into a <strong class="keyWord">function</strong>. Functions<a id="_idIndexMarker468"/> are like tiny programs that complete one small task. For example, you might write a function to calculate sales tax and then reuse that function in many places in a financial application.</p>
    <p class="normal">Like programs, functions <a id="_idIndexMarker469"/>usually have inputs and outputs. They are sometimes described as black boxes, where you feed in some raw materials at one end and a manufactured item emerges at the other. Once created and thoroughly debugged and tested, you don’t need to think about how they work.</p>
    <h2 id="_idParaDest-250" class="heading-2">Exploring top-level programs, functions, and namespaces</h2>
    <p class="normal">In <em class="chapterRef">Chapter 1</em>, <em class="italic">Hello, C#! Welcome, .NET!</em>, we learned that since C# 10 and .NET 6, the default project template for console apps uses the top-level program feature introduced with C# 9.</p>
    <p class="normal">Once you start writing functions, it is important to understand how they work with the automatically generated <code class="inlineCode">Program</code> class and its <code class="inlineCode">&lt;Main&gt;$</code> method.</p>
    <p class="normal">Let’s explore how<a id="_idIndexMarker470"/> the top-level program feature works when you define functions:</p>
    <ol>
      <li class="numberedList" value="1">Use your preferred code editor to create a new solution and project, as defined in the following list:<ul>
          <li class="bulletList level-2"><strong class="keyWord">Project template</strong>: <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code></li>
          <li class="bulletList level-2"><strong class="keyWord">Project file and folder</strong>: <code class="inlineCode">TopLevelFunctions</code></li>
          <li class="bulletList level-2"><strong class="keyWord">Solution file and folder</strong>: <code class="inlineCode">Chapter04</code></li>
          <li class="bulletList level-2"><strong class="keyWord">Do not use top-level statements</strong>: Cleared</li>
          <li class="bulletList level-2"><strong class="keyWord">Enable native AOT </strong>(<strong class="keyWord">ahead-of-time</strong>)<strong class="keyWord"> publish</strong>: Cleared</li>
        </ul>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete the existing statements, define a local function at the bottom of the file, and call it, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">using</span> <span class="hljs-keyword">static</span> System.Console;
WriteLine(<span class="hljs-string">"* Top-level functions example"</span>);
WhatsMyNamespace(); <span class="hljs-comment">// Call the function.</span>
<span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">WhatsMyNamespace</span><span class="hljs-function">() </span><span class="hljs-comment">// Define a local function.</span>
{
  WriteLine(<span class="hljs-string">"Namespace of Program class: {0}"</span>,
    arg0: <span class="hljs-keyword">typeof</span>(Program).Namespace ?? <span class="hljs-string">"null"</span>);
}
</code></pre>
        <div class="packt_tip-one">
          <p class="normal"><strong class="keyWord">Good Practice</strong>: Functions do not need to be at the bottom of the file, but it is good practice rather than mixing them up with other top-level statements. Types, like classes, <em class="italic">must</em> be declared at the bottom of the <code class="inlineCode">Program.cs</code> file rather than in the middle of the file or you will see the compiler error <code class="inlineCode">CS8803</code>, as shown at the following link: <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/compiler-messages/cs8803"><span class="url">https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/compiler-messages/cs8803</span></a>. It would be better to define types like classes in a separate file.</p>
        </div>
      </li>
    </ol>
    <ol>
      <li class="numberedList" value="3">Run the<a id="_idIndexMarker471"/> console app and note that the namespace for the <code class="inlineCode">Program</code> class is <code class="inlineCode">null</code>, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">* Top-level functions example
Namespace of Program class: null
</code></pre>
      </li>
    </ol>
    <h3 id="_idParaDest-251" class="heading-3">What is automatically generated for a local function?</h3>
    <p class="normal">The compiler automatically generates a <code class="inlineCode">Program</code> class<a id="_idIndexMarker472"/> with a <code class="inlineCode">&lt;Main&gt;$</code> function, then moves your statements and function inside the <code class="inlineCode">&lt;Main&gt;$</code> method, which makes the function local, and renames the function, as shown highlighted in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc">using</strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">static</strong><strong class="hljs-slc"> System.Console;</strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc">partial</strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">class</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">Program</strong></span>
<span class="code-highlight"><strong class="hljs-slc">{</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  </strong><strong class="hljs-keyword-slc">static</strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">void</strong><strong class="hljs-slc"> &lt;Main&gt;$(String[] args)</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  {</strong></span>
    WriteLine(<span class="hljs-string">"* Top-level functions example"</span>);
<span class="code-highlight"><strong class="hljs-slc">    &lt;&lt;Main&gt;$&gt;g__WhatsMyNamespace|</strong><strong class="hljs-number-slc">0</strong><strong class="hljs-slc">_0(); </strong><strong class="hljs-comment-slc">// Call the function.</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    </strong><strong class="hljs-keyword-slc">void</strong><strong class="hljs-slc"> &lt;&lt;Main&gt;$&gt;g__WhatsMyNamespace|</strong><strong class="hljs-number-slc">0</strong><strong class="hljs-slc">_0() </strong><strong class="hljs-comment-slc">// Define a local function.</strong></span>
    {
      WriteLine(<span class="hljs-string">"Namespace of Program class: {0}"</span>,
        arg0: <span class="hljs-keyword">typeof</span>(Program).Namespace ?? <span class="hljs-string">"null"</span>);
    }
<span class="code-highlight"><strong class="hljs-slc">  }</strong></span>
<span class="code-highlight"><strong class="hljs-slc">}</strong></span>
</code></pre>
    <p class="normal">For the compiler to know what statements need to go where, you must follow some rules:</p>
    <ul>
      <li class="bulletList">Import statements (<code class="inlineCode">using</code>) must go at the top of the <code class="inlineCode">Program.cs</code> file.</li>
      <li class="bulletList">Statements that will go in the <code class="inlineCode">&lt;Main&gt;$</code> function can be mixed with functions in the <a id="_idIndexMarker473"/>middle of the <code class="inlineCode">Program.cs</code> file. Any functions will become <strong class="keyWord">local functions</strong> in the <code class="inlineCode">&lt;Main&gt;$</code> method.</li>
    </ul>
    <p class="normal">The last point is important because local functions have limitations, such as they cannot have XML comments to document them.</p>
    <div class="note">
      <p class="normal">If the contents of the file which is code were the .NET SDK or some other tool that generated this code, then the code would need to be in a source code file that the compiler would then find in the filesystem and compile it. Because this code is generated by the compiler itself, there is no need for a source code file. The only way to discover what the compiler does is to use a decompiler on the assembly and reverse engineer the original code. You can also throw exceptions in the functions and methods to see some of the information, as I showed in <em class="chapterRef">Chapter 1</em>,<em class="chapterRef"> Hello, C#! Welcome, .NET!</em>.</p>
    </div>
    <p class="normal">You are about to see some C# keywords like <code class="inlineCode">static</code> and <code class="inlineCode">partial</code>, which will be formally introduced in <em class="chapterRef">Chapter 5</em>, <em class="chapterRef">Building Your Own Types with Object-Oriented Programming</em>.</p>
    <h2 id="_idParaDest-252" class="heading-2">Defining a partial Program class with a static function</h2>
    <p class="normal">A better<a id="_idIndexMarker474"/> approach is to write any functions in a <a id="_idIndexMarker475"/>separate file and define them as <code class="inlineCode">static</code> members of the <code class="inlineCode">Program</code> class:</p>
    <ol>
      <li class="numberedList" value="1">Add a new class file named <code class="inlineCode">Program.Functions.cs</code>. The name of this file does not actually matter but using this naming convention is sensible. You could name the file <code class="inlineCode">Gibberish.cs</code> and it would have the same behavior.</li>
      <li class="numberedList">In <code class="inlineCode">Program.Functions.cs</code>, delete any existing statements and then add statements to define a <code class="inlineCode">partial Program</code> class. Cut and paste the <code class="inlineCode">WhatsMyNamespace</code> function to move it from <code class="inlineCode">Program.cs</code> into <code class="inlineCode">Program.Functions.cs</code>, and then add the <code class="inlineCode">static</code> keyword to the function, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc">using</strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">static</strong><strong class="hljs-slc"> System.Console;</strong></span>
<span class="code-highlight"><strong class="hljs-comment-slc">// Do not define a namespace so this class goes in the default empty</strong></span>
<span class="code-highlight"><strong class="hljs-comment-slc">// namespace just like the auto-generated partial Program class.</strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc">partial</strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">class</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">Program</strong></span>
<span class="code-highlight"><strong class="hljs-slc">{</strong></span>
  <span class="code-highlight"><strong class="hljs-keyword-slc">static</strong></span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">WhatsMyNamespace</span><span class="hljs-function">() </span><span class="hljs-comment">// Define a </span><span class="code-highlight"><strong class="hljs-comment-slc">static</strong></span><span class="hljs-comment"> function.</span>
  {
    WriteLine(<span class="hljs-string">"Namespace of Program class: {0}"</span>,
      arg0: <span class="hljs-keyword">typeof</span>(Program).Namespace ?? <span class="hljs-string">"null"</span>);
  }
<span class="code-highlight"><strong class="hljs-slc">}</strong></span>
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, confirm that its entire content is now just three statements, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">using</span> <span class="hljs-keyword">static</span> System.Console;
WriteLine(<span class="hljs-string">"* Top-level functions example"</span>);
WhatsMyNamespace(); <span class="hljs-comment">// Call the function.</span>
</code></pre>
      </li>
      <li class="numberedList">Run the <a id="_idIndexMarker476"/>console app and<a id="_idIndexMarker477"/> note that it has the same behavior as before.</li>
    </ol>
    <h3 id="_idParaDest-253" class="heading-3">What is automatically generated for a static function?</h3>
    <p class="normal">When you use a separate file to define a <code class="inlineCode">partial Program</code> class with <code class="inlineCode">static</code> functions, the compiler defines a <code class="inlineCode">Program</code> class with a <code class="inlineCode">&lt;Main&gt;$</code> function and merges your function as a member of the <code class="inlineCode">Program</code> class, as shown in the following highlighted code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">using</span> <span class="hljs-keyword">static</span> System.Console;
<span class="code-highlight"><strong class="hljs-keyword-slc">partial</strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">class</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">Program</strong></span>
<span class="code-highlight"><strong class="hljs-slc">{</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  </strong><strong class="hljs-keyword-slc">static</strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">void</strong><strong class="hljs-slc"> &lt;Main&gt;$(String[] args)</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  {</strong></span>
    WriteLine(<span class="hljs-string">"* Top-level functions example"</span>);
    WhatsMyNamespace(); <span class="hljs-comment">// Call the function.</span>
<span class="code-highlight"><strong class="hljs-slc">  }</strong></span>
  <span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">WhatsMyNamespace</span><span class="hljs-function">() </span><span class="hljs-comment">// Define a static function.</span>
  {
    WriteLine(<span class="hljs-string">"Namespace of Program class: {0}"</span>,
      arg0: <span class="hljs-keyword">typeof</span>(Program).Namespace ?? <span class="hljs-string">"null"</span>);
  }
<span class="code-highlight"><strong class="hljs-slc">}</strong></span>
</code></pre>
    <p class="normal"><strong class="screenText">Solution Explorer</strong> shows that your <code class="inlineCode">Program.Functions.cs</code> class file merges its <code class="inlineCode">partial Program</code> with the auto-generated <code class="inlineCode">partial Program</code> class, as shown in <em class="italic">Figure 4.1</em>:</p>
    <figure class="mediaobject"><img src="../Images/B22322_04_01.png" alt="" width="877" height="283"/></figure>
    <p class="packt_figref">Figure 4.1: Solution Explorer showing the merged partial Program class</p>
    <div class="packt_tip">
      <p class="normal"><strong class="keyWord">Good Practice</strong>: Create any functions that you will call in <code class="inlineCode">Program.cs</code> in a separate file and manually define them inside a <code class="inlineCode">partial Program</code> class. This will merge them into the automatically generated <code class="inlineCode">Program</code> class <em class="italic">at the same level</em> as the <code class="inlineCode">&lt;Main&gt;$</code> method, instead of as local functions <em class="italic">inside</em> the <code class="inlineCode">&lt;Main&gt;$</code> method.</p>
    </div>
    <p class="normal">It is important to note the lack of namespace declarations. Both the automatically generated <code class="inlineCode">Program</code> class and the explicitly defined <code class="inlineCode">Program</code> class are in the default <code class="inlineCode">null</code> namespace.</p>
    <div class="packt_tip">
      <p class="normal"><strong class="keyWord">Warning!</strong> Do not define a namespace for your <code class="inlineCode">partial Program</code> class. If you do, it will be in a different namespace and therefore will not merge with the auto-generated <code class="inlineCode">partial Program</code> class.</p>
    </div>
    <p class="normal">Optionally, all the <code class="inlineCode">static</code> methods in the <code class="inlineCode">Program</code> class could be explicitly declared as <code class="inlineCode">private</code> but this is the default anyway. Since all the functions will be called within the <code class="inlineCode">Program</code> class itself, the access modifier is not important.</p>
    <h2 id="_idParaDest-254" class="heading-2">Times table example</h2>
    <p class="normal">Let’s say that <a id="_idIndexMarker478"/>you want to help your child learn their times tables, so you want to make it easy to generate a times table for a number, such as the 7 times table:</p>
    <pre class="programlisting con"><code class="hljs-con">1 x 7 = 7
2 x 7 = 14
3 x 7 = 21
...
10 x 7 = 70
11 x 7 = 77
12 x 7 = 84
</code></pre>
    <p class="normal">Most times tables have 10, 12, or 20 rows, depending on how advanced the child is.</p>
    <p class="normal">You learned about the <code class="inlineCode">for</code> statement earlier in this book, so you know that it can be used to generate repeated lines of output when there is a regular pattern, such as a 7 times table with 12 rows, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> row = <span class="hljs-number">1</span>; row &lt;= <span class="hljs-number">12</span>; row++)
{
  Console.WriteLine(<span class="hljs-string">$"</span><span class="hljs-subst">{row}</span><span class="hljs-string"> x 7 = </span><span class="hljs-subst">{row * </span><span class="hljs-number">7</span><span class="hljs-subst">}</span><span class="hljs-string">"</span>);
}
</code></pre>
    <p class="normal">However, instead of always outputting the 7 times table with 12 rows, we want to make this more flexible so it can output times tables of any size for any number. We can do this by creating a function.</p>
    <p class="normal">Let’s explore functions by creating one to output any times table for numbers 0 to 255 of any size up to 255 rows (but it defaults to 12 rows):</p>
    <ol>
      <li class="numberedList" value="1">Use your preferred code editor to create a new project, as defined in the following list:<ul>
          <li class="bulletList level-2">Project template: <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code></li>
          <li class="bulletList level-2">Project file and folder: <code class="inlineCode">WritingFunctions</code></li>
          <li class="bulletList level-2">Solution file and folder: <code class="inlineCode">Chapter04</code></li>
          <li class="bulletList level-2">In Visual Studio, set the startup project for the solution to the current selection.</li>
        </ul>
      </li>
      <li class="numberedList">In <code class="inlineCode">WritingFunctions.csproj</code>, after the <code class="inlineCode">&lt;PropertyGroup&gt;</code> section, add a new <code class="inlineCode">&lt;ItemGroup&gt;</code> section to statically import <code class="inlineCode">System.Console</code> for all C# files using the implicit usings .NET SDK feature, as shown in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;Using Include=<span class="hljs-string">"System.Console"</span> Static=<span class="hljs-string">"true"</span> /&gt;
&lt;/ItemGroup&gt;
</code></pre>
      </li>
      <li class="numberedList">Add a new class file to the project named <code class="inlineCode">Program.Functions.cs</code>.</li>
      <li class="numberedList">In <code class="inlineCode">Program.Functions.cs</code>, replace any existing code with new statements to define a function named <code class="inlineCode">TimesTable</code> in the <code class="inlineCode">partial</code> <code class="inlineCode">Program</code> class, as <a id="_idIndexMarker479"/>shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
  <span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">TimesTable</span><span class="hljs-function">(</span><span class="hljs-built_in">byte</span><span class="hljs-params"> number, </span><span class="hljs-built_in">byte</span><span class="hljs-params"> size = </span><span class="hljs-number">12</span><span class="hljs-function">)</span>
  {
    WriteLine(<span class="hljs-string">$"This is the </span><span class="hljs-subst">{number}</span><span class="hljs-string"> times table with </span><span class="hljs-subst">{size}</span><span class="hljs-string"> rows:"</span>);
    WriteLine();
    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> row = <span class="hljs-number">1</span>; row &lt;= size; row++)
    {
      WriteLine(<span class="hljs-string">$"</span><span class="hljs-subst">{row}</span><span class="hljs-string"> x </span><span class="hljs-subst">{number}</span><span class="hljs-string"> = </span><span class="hljs-subst">{row * number}</span><span class="hljs-string">"</span>);
    }
    WriteLine();
  }
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">In the preceding code, note the following:</p>
    <ul>
      <li class="bulletList level-2"><code class="inlineCode">TimesTable</code> must have a <code class="inlineCode">byte</code> value passed to it as a parameter named <code class="inlineCode">number</code>.</li>
      <li class="bulletList level-2"><code class="inlineCode">TimesTable</code> can optionally have a <code class="inlineCode">byte</code> value passed to it as a parameter named <code class="inlineCode">size</code>. If a value is not passed, it defaults to <code class="inlineCode">12</code>.</li>
      <li class="bulletList level-2"><code class="inlineCode">TimesTable</code> is a <code class="inlineCode">static</code> method because it will be called by the <code class="inlineCode">static</code> method <code class="inlineCode">&lt;Main&gt;$</code>.</li>
      <li class="bulletList level-2"><code class="inlineCode">TimesTable</code> does not return a value to the caller, so it is declared with the <code class="inlineCode">void</code> keyword before its name.</li>
      <li class="bulletList level-2"><code class="inlineCode">TimesTable</code> uses a <code class="inlineCode">for</code> statement to output the times table for the <code class="inlineCode">number</code> passed to it with its number of rows equal to <code class="inlineCode">size</code>.</li>
    </ul>
    <ol>
      <li class="numberedList" value="5">In <code class="inlineCode">Program.cs</code>, delete the existing statements, and then call the function. Pass in a <code class="inlineCode">byte</code> value for the <code class="inlineCode">number</code> parameter, for example, <code class="inlineCode">7</code>, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">TimesTable(<span class="hljs-number">7</span>);
</code></pre>
      </li>
      <li class="numberedList">Run the code and <a id="_idIndexMarker480"/>then view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">This is the 7 times table with 12 rows:
1 x 7 = 7
2 x 7 = 14
3 x 7 = 21
4 x 7 = 28
5 x 7 = 35
6 x 7 = 42
7 x 7 = 49
8 x 7 = 56
9 x 7 = 63
10 x 7 = 70
11 x 7 = 77
12 x 7 = 84
</code></pre>
      </li>
      <li class="numberedList">Set the <code class="inlineCode">size</code> parameter to <code class="inlineCode">20</code>, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">TimesTable(<span class="hljs-number">7</span>, <span class="hljs-number">20</span>);
</code></pre>
      </li>
      <li class="numberedList">Run the console app and confirm that the times table now has 20 rows.</li>
    </ol>
    <div class="packt_tip-one">
      <p class="normal"><strong class="keyWord">Good Practice</strong>: If a function has one or more parameters where just passing the values may not provide enough meaning, then you can optionally specify the name of the parameter as well as its value, as shown in the following code: <code class="inlineCode">TimesTable(number: 7, size: 10)</code>.</p>
    </div>
    <ol>
      <li class="numberedList" value="9">Change the number passed into the <code class="inlineCode">TimesTable</code> function to other <code class="inlineCode">byte</code> values between <code class="inlineCode">0</code> and <code class="inlineCode">255</code> and confirm that the output times tables are correct.</li>
      <li class="numberedList">Note that if <a id="_idIndexMarker481"/>you try to pass a non-<code class="inlineCode">byte</code> number, for example, an <code class="inlineCode">int</code>, <code class="inlineCode">double</code>, or <code class="inlineCode">string</code>, an error is returned, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Error: (1,12): error CS1503: Argument 1: cannot convert from 'int' to 'byte'
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-255" class="heading-2">A brief aside about arguments and parameters</h2>
    <p class="normal">In daily usage, most developers will use the <a id="_idIndexMarker482"/>terms <strong class="keyWord">argument</strong> and <strong class="keyWord">parameter</strong> interchangeably. Strictly speaking, the two terms have specific and subtly different meanings. But just like a person can be both a parent and a doctor, the two terms often apply to the same thing.</p>
    <p class="normal">A <em class="italic">parameter</em> is a<a id="_idIndexMarker483"/> variable in a function definition. For example, <code class="inlineCode">startDate</code> is a parameter of the <code class="inlineCode">Hire</code> function, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Hire</span><span class="hljs-function">(</span><span class="hljs-params">DateTime startDate</span><span class="hljs-function">)</span>
{
  <span class="hljs-comment">// Function implementation.</span>
}
</code></pre>
    <p class="normal">When a method is called, an <em class="italic">argument</em> is the <a id="_idIndexMarker484"/>data you pass into the method’s parameters. For example, <code class="inlineCode">when</code> is a variable passed as an argument to the <code class="inlineCode">Hire</code> function, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">DateTime <span class="hljs-keyword">when</span> = <span class="hljs-keyword">new</span>(year: <span class="hljs-number">2024</span>, month: <span class="hljs-number">11</span>, day: <span class="hljs-number">5</span>);
Hire(<span class="hljs-keyword">when</span>);
</code></pre>
    <p class="normal">You might prefer to specify the<a id="_idIndexMarker485"/> parameter name when passing the argument, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">DateTime <span class="hljs-keyword">when</span> = <span class="hljs-keyword">new</span>(year: <span class="hljs-number">2024</span>, month: <span class="hljs-number">11</span>, day: <span class="hljs-number">5</span>);
Hire(startDate: <span class="hljs-keyword">when</span>);
</code></pre>
    <p class="normal">When talking about the call to the <code class="inlineCode">Hire</code> function, <code class="inlineCode">startDate</code> is the parameter, and <code class="inlineCode">when</code> is the argument.</p>
    <div class="note">
      <p class="normal">If you read the official Microsoft documentation, they use the phrases <strong class="screenText">named and optional arguments</strong> and <strong class="screenText">named and optional parameters</strong> interchangeably, as shown at the following link: <a href="https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/named-and-optional-arguments"><span class="url">https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/named-and-optional-arguments</span></a>.</p>
    </div>
    <p class="normal">It gets complicated because a single object can act as both a parameter and an argument, depending on the context. For example, within the <code class="inlineCode">Hire</code> function implementation, the <code class="inlineCode">startDate</code> parameter could be passed as an argument to another function like <code class="inlineCode">SaveToDatabase</code>, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Hire</span><span class="hljs-function">(</span><span class="hljs-params">DateTime startDate</span><span class="hljs-function">)</span>
{
  ...
  SaveToDatabase(startDate, employeeRecord);
  ...
}
</code></pre>
    <p class="normal">Naming things is one of the hardest parts of computing. A classic example is the parameter to the most important function in C#, <code class="inlineCode">Main</code>. It defines a parameter named <code class="inlineCode">args</code>, short for arguments, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Main</span><span class="hljs-function">(</span><span class="hljs-params">String[] args</span><span class="hljs-function">)</span>
{
  ...
}
</code></pre>
    <p class="normal">To summarize, parameters <a id="_idIndexMarker486"/>define inputs to a function; arguments are passed to a function <a id="_idIndexMarker487"/>when calling the function.</p>
    <div class="packt_tip">
      <p class="normal"><strong class="keyWord">Good Practice</strong>: Try to use the correct term depending on the context, but do not get pedantic with other developers if they “misuse” a term. I must have used the terms <strong class="keyWord">parameter</strong> and <strong class="keyWord">argument</strong> thousands of times in this book. I’m sure some of those times I’ve been imprecise. Please do not @ me about it.</p>
    </div>
    <h2 id="_idParaDest-256" class="heading-2">Writing a function that returns a value</h2>
    <p class="normal">The previous <a id="_idIndexMarker488"/>function performed actions (looping and writing to the console), but it did not return a <a id="_idIndexMarker489"/>value. Let’s say that you need to calculate sales or <strong class="keyWord">value-added tax</strong> (<strong class="keyWord">VAT</strong>). In Europe, VAT rates can range from 8% in Switzerland to 27% in Hungary. In the <strong class="keyWord">United States</strong> (<strong class="keyWord">US</strong>), state sales taxes can range from 0% in Oregon to 8.25% in California.</p>
    <div class="note">
      <p class="normal">Tax rates change all the time, and they vary based on many factors. The values used in this example do not need to be accurate.</p>
    </div>
    <p class="normal">Let’s implement a function to calculate taxes in various regions around the world:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.Functions.cs</code>, in the <code class="inlineCode">Program</code> class, write a function named <code class="inlineCode">CalculateTax</code>, as<a id="_idIndexMarker490"/> shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-built_in">decimal</span><span class="hljs-function"> </span><span class="hljs-title">CalculateTax</span><span class="hljs-function">(</span>
<span class="hljs-params">  </span><span class="hljs-built_in">decimal</span><span class="hljs-params"> amount, </span><span class="hljs-built_in">string</span><span class="hljs-params"> twoLetterRegionCode</span><span class="hljs-function">)</span>
{
  <span class="hljs-built_in">decimal</span> rate = twoLetterRegionCode <span class="hljs-keyword">switch</span>
  {
    <span class="hljs-string">"CH"</span> =&gt; <span class="hljs-number">0.08</span>M, <span class="hljs-comment">// Switzerland</span>
    <span class="hljs-string">"DK"</span> <span class="hljs-keyword">or</span> <span class="hljs-string">"NO"</span> =&gt; <span class="hljs-number">0.25</span>M, <span class="hljs-comment">// Denmark, Norway</span>
    <span class="hljs-string">"</span><span class="hljs-string">GB"</span> <span class="hljs-keyword">or</span> <span class="hljs-string">"FR"</span> =&gt; <span class="hljs-number">0.2</span>M, <span class="hljs-comment">// UK, France</span>
    <span class="hljs-string">"HU"</span> =&gt; <span class="hljs-number">0.27</span>M, <span class="hljs-comment">// Hungary</span>
    <span class="hljs-string">"OR"</span> <span class="hljs-keyword">or</span> <span class="hljs-string">"</span><span class="hljs-string">AK"</span> <span class="hljs-keyword">or</span> <span class="hljs-string">"MT"</span> =&gt; <span class="hljs-number">0.0</span>M, <span class="hljs-comment">// Oregon, Alaska, Montana</span>
    <span class="hljs-string">"ND"</span> <span class="hljs-keyword">or</span> <span class="hljs-string">"WI"</span> <span class="hljs-keyword">or</span> <span class="hljs-string">"ME"</span> <span class="hljs-keyword">or</span> <span class="hljs-string">"VA"</span> =&gt; <span class="hljs-number">0.05</span>M,
    <span class="hljs-string">"CA"</span> =&gt; <span class="hljs-number">0.0825</span>M, <span class="hljs-comment">// California</span>
    _ =&gt; <span class="hljs-number">0.06</span>M <span class="hljs-comment">// Most other states.</span>
  };
  <span class="hljs-keyword">return</span> amount * rate;
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">In the preceding code, note the following:</p>
    <ul>
      <li class="bulletList level-2"><code class="inlineCode">CalculateTax</code> has two inputs: a parameter named <code class="inlineCode">amount</code>, which will be the amount of money spent, and a parameter named <code class="inlineCode">twoLetterRegionCode</code>, which will be the region where the amount is spent.</li>
      <li class="bulletList level-2"><code class="inlineCode">CalculateTax</code> will perform a calculation using a <code class="inlineCode">switch</code> expression and then return the sales tax or VAT owed on the amount as a <code class="inlineCode">decimal</code> value; so, before the name of the function, we have declared the data type of the return value to be <code class="inlineCode">decimal</code>.</li>
    </ul>
    <ol>
      <li class="numberedList" value="2">At the top of <code class="inlineCode">Program.Functions.cs</code>, import the namespace to work with cultures, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">using</span> System.Globalization; <span class="hljs-comment">// To use CultureInfo.</span>
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.Functions.cs</code>, in the <code class="inlineCode">Program</code> class, write a function named <code class="inlineCode">ConfigureConsole</code>, as <a id="_idIndexMarker491"/>shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">ConfigureConsole</span><span class="hljs-function">(</span><span class="hljs-built_in">string</span><span class="hljs-params"> culture = </span><span class="hljs-string">"en-US"</span><span class="hljs-params">,</span>
<span class="hljs-params">  </span><span class="hljs-built_in">bool</span><span class="hljs-params"> useComputerCulture = </span><span class="hljs-literal">false</span><span class="hljs-function">)</span>
{
  <span class="hljs-comment">// To enable Unicode characters like Euro symbol in the console.</span>
  OutputEncoding = System.Text.Encoding.UTF8;
  <span class="hljs-keyword">if</span> (!useComputerCulture)
  {
    CultureInfo.CurrentCulture = CultureInfo.GetCultureInfo(culture);
  }
  WriteLine(<span class="hljs-string">$"CurrentCulture: </span><span class="hljs-subst">{CultureInfo.CurrentCulture.DisplayName}</span><span class="hljs-string">"</span>);
}
</code></pre>
      </li>
    </ol>
    <div class="note-one">
      <p class="normal">This function enables UTF-8 encoding for the console output. This is necessary to output some special symbols like the Euro currency symbol. This function also controls the current culture used to format dates, times, and currency values.</p>
    </div>
    <ol>
      <li class="numberedList" value="4">In <code class="inlineCode">Program.cs</code>, comment out any <code class="inlineCode">TimesTable</code> method calls, and then call the <code class="inlineCode">ConfigureConsole</code> method and the <code class="inlineCode">CalculateTax</code> method, passing values for the amount, such as <code class="inlineCode">149</code>, and a valid region code, such as <code class="inlineCode">FR</code>, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// TimesTable(number: 7, size: 10);</span>
ConfigureConsole();
<span class="hljs-built_in">decimal</span> taxToPay = CalculateTax(amount: <span class="hljs-number">149</span>, twoLetterRegionCode: <span class="hljs-string">"FR"</span>);
WriteLine(<span class="hljs-string">$"You must pay </span><span class="hljs-subst">{taxToPay:C}</span><span class="hljs-string"> in tax."</span>);
<span class="hljs-comment">// Alternatively, call the function in the interpolated string.</span>
<span class="hljs-comment">// WriteLine($"You must pay {CalculateTax(amount: 149,</span>
<span class="hljs-comment">//   twoLetterRegionCode: "FR"):C} in tax.");</span>
</code></pre>
      </li>
      <li class="numberedList">Run the code, view the result, and note that it uses the US English culture, meaning US dollars for the currency, as shown in the following <a id="_idIndexMarker492"/>output:
        <pre class="programlisting con-one"><code class="hljs-con">CurrentCulture: English (United States)
You must pay $29.80 in tax.
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, change the <code class="inlineCode">ConfigureConsole</code> method to use your local computer culture, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">ConfigureConsole(useComputerCulture: <span class="hljs-literal">true</span>);
</code></pre>
      </li>
      <li class="numberedList">Run the code, view the result, and note that the currency should now show your local currency. For example, for me in the UK, I would see <code class="inlineCode">£29.80</code>, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">CurrentCulture: English (United Kingdom)
You must pay £29.80 in tax.
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, change the <code class="inlineCode">ConfigureConsole</code> method to use the French culture, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">ConfigureConsole(culture: <span class="hljs-string">"fr-FR"</span>);
</code></pre>
      </li>
      <li class="numberedList">Run the code, view the result, and note that the currency should now show<a id="_idIndexMarker493"/> Euros, as used in France, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">CurrentCulture: French (France)
You must pay 29,80 € in tax.
</code></pre>
      </li>
    </ol>
    <p class="normal">Can you think of any problems with the <code class="inlineCode">CalculateTax</code> function as written? What would happen if the user entered a code such as <code class="inlineCode">fr</code> or <code class="inlineCode">UK</code>? How could you rewrite the function to improve it? Would using a <code class="inlineCode">switch</code> <em class="italic">statement</em> instead of a <code class="inlineCode">switch</code> <em class="italic">expression</em> be clearer?</p>
    <h2 id="_idParaDest-257" class="heading-2">Converting numbers from cardinal to ordinal</h2>
    <p class="normal">Numbers that are used to <a id="_idIndexMarker494"/>count are called <strong class="keyWord">cardinal</strong> numbers, for example, 1, 2, and 3, whereas numbers used to order <a id="_idIndexMarker495"/>are <strong class="keyWord">ordinal</strong> numbers, for example, 1st, 2nd, and 3rd. Let’s create a function to convert cardinals to ordinals:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.Functions.cs</code>, write<a id="_idIndexMarker496"/> a function named <code class="inlineCode">CardinalToOrdinal</code> that converts a cardinal <code class="inlineCode">uint</code> value into an <a id="_idIndexMarker497"/>ordinal <code class="inlineCode">string</code> value; for example, it converts the <code class="inlineCode">uint</code> value of <code class="inlineCode">1</code> into the <code class="inlineCode">string</code> value <code class="inlineCode">"1st"</code>, the <code class="inlineCode">uint</code> value of <code class="inlineCode">2</code> into the <code class="inlineCode">string</code> value of <code class="inlineCode">"2nd"</code>, and so on, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-built_in">string</span><span class="hljs-function"> </span><span class="hljs-title">CardinalToOrdinal</span><span class="hljs-function">(</span><span class="hljs-built_in">uint</span><span class="hljs-params"> number</span><span class="hljs-function">)</span>
{
  <span class="hljs-built_in">uint</span> lastTwoDigits = number % <span class="hljs-number">100</span>;
  <span class="hljs-keyword">switch</span> (lastTwoDigits)
  {
    <span class="hljs-keyword">case</span> <span class="hljs-number">11</span>: <span class="hljs-comment">// Special cases for 11th to 13th.</span>
    <span class="hljs-keyword">case</span> <span class="hljs-number">12</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-number">13</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-string">$"</span><span class="hljs-subst">{number:N0}</span><span class="hljs-string">th"</span>;
    <span class="hljs-literal">default</span>:
      <span class="hljs-built_in">uint</span> lastDigit = number % <span class="hljs-number">10</span>;
      <span class="hljs-built_in">string</span> suffix = lastDigit <span class="hljs-keyword">switch</span>
      {
        <span class="hljs-number">1</span> =&gt; <span class="hljs-string">"st"</span>,
        <span class="hljs-number">2</span> =&gt; <span class="hljs-string">"nd"</span>,
        <span class="hljs-number">3</span> =&gt; <span class="hljs-string">"rd"</span>,
        _ =&gt; <span class="hljs-string">"th"</span>
      };
      <span class="hljs-keyword">return</span> <span class="hljs-string">$"</span><span class="hljs-subst">{number:N0}{suffix}</span><span class="hljs-string">"</span>;
  }
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">From the preceding code, note the following:</p>
    <ul>
      <li class="bulletList level-2"><code class="inlineCode">CardinalToOrdinal</code> has one input, a parameter of the <code class="inlineCode">uint</code> type named <code class="inlineCode">number</code>, because we do not want to allow negative numbers, and one output: a return value of the <code class="inlineCode">string</code> type.</li>
      <li class="bulletList level-2">A <code class="inlineCode">switch</code> <em class="italic">statement</em> is used to handle the special cases of <code class="inlineCode">11</code>, <code class="inlineCode">12</code>, and <code class="inlineCode">13</code>.</li>
      <li class="bulletList level-2">A <code class="inlineCode">switch</code> <em class="italic">expression</em> then handles all other cases: if the last digit is <code class="inlineCode">1</code>, then use <code class="inlineCode">st</code> as the suffix; if the last digit is <code class="inlineCode">2</code>, then use <code class="inlineCode">nd</code> as the suffix; if the last digit is <code class="inlineCode">3</code>, then use <code class="inlineCode">rd</code> as the suffix; and if the last digit is anything else, then use <code class="inlineCode">th</code> as the suffix.</li>
    </ul>
    <ol>
      <li class="numberedList" value="2">In <code class="inlineCode">Program.Functions.cs</code>, write a<a id="_idIndexMarker498"/> function named <code class="inlineCode">RunCardinalToOrdinal</code> that uses a <code class="inlineCode">for</code> statement to loop from 1 to 150, calling the <code class="inlineCode">CardinalToOrdinal</code> function for each number <a id="_idIndexMarker499"/>and writing the returned <code class="inlineCode">string</code> to the console, separated by a space character, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">RunCardinalToOrdinal</span><span class="hljs-function">()</span>
{
  <span class="hljs-keyword">for</span> (<span class="hljs-built_in">uint</span> number = <span class="hljs-number">1</span>; number &lt;= <span class="hljs-number">150</span>; number++)
  {
    Write(<span class="hljs-string">$"</span><span class="hljs-subst">{CardinalToOrdinal(number)}</span><span class="hljs-string"> "</span>);
  }
  WriteLine();
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, comment out the <code class="inlineCode">CalculateTax</code> statements and call the <code class="inlineCode">RunCardinalToOrdinal</code> method, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-built_in">RunCardinalToOrdinal</span>();
</code></pre>
      </li>
      <li class="numberedList">Run the console app and view the results, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">1st 2nd 3rd 4th 5th 6th 7th 8th 9th 10th 11th 12th 13th 14th 15th 16th 17th 18th 19th 20th 21st 22nd 23rd 24th 25th 26th ... 139th 140th 141st 142nd 143rd 144th 145th 146th 147th 148th 149th 150th
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">RunCardinalToOrdinal</code> function, change the maximum number to <code class="inlineCode">1500</code>.</li>
      <li class="numberedList">Run the<a id="_idIndexMarker500"/> console app and <a id="_idIndexMarker501"/>view the results, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">... 1,480th 1,481st 1,482nd 1,483rd 1,484th 1,485th 1,486th 1,487th 1,488th 1,489th 1,490th 1,491st 1,492nd 1,493rd 1,494th 1,495th 1,496th 1,497th 1,498th 1,499th 1,500th
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-258" class="heading-2">Calculating factorials with recursion</h2>
    <p class="normal">The<a id="_idIndexMarker502"/> factorial of 5 is 120 because factorials are <a id="_idIndexMarker503"/>calculated by multiplying the starting number by one less than itself, and then by one less again, and so on until the number is reduced to 1. An example can be seen here: 5 x 4 x 3 x 2 x 1 = 120.</p>
    <p class="normal">The factorial function is defined for non-negative integers only, i.e., for 0, 1, 2, 3, and so on, and it is defined as:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-number">0</span>! = <span class="hljs-number">1</span>
n! = n × (n − <span class="hljs-number">1</span>)!, <span class="hljs-keyword">for</span> n  { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, ... }
</code></pre>
    <p class="normal">We could leave it to the compiler to reject negative numbers by declaring the input parameter as <code class="inlineCode">uint</code> as we did for the <code class="inlineCode">CardinalToOrdinal</code> function, but this time, let’s see an alternative way to handle that: throwing an argument exception.</p>
    <p class="normal">Factorials are written like this: <code class="inlineCode">5!</code>, where the exclamation mark is read as “bang,” so <code class="inlineCode">5!</code> = 120, or <em class="italic">five bang equals one hundred and twenty</em>. Bang is a good term to use in the context of factorials because they increase in size very rapidly, just like an explosion.</p>
    <p class="normal">We will write a <a id="_idIndexMarker504"/>function named <code class="inlineCode">Factorial</code>; this will<a id="_idIndexMarker505"/> calculate the factorial for an <code class="inlineCode">int</code> passed to it as a parameter. We will use a clever technique called <strong class="keyWord">recursion</strong>, which refers to a function that calls itself within its implementation, either directly or indirectly:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.Functions.cs</code>, write a function named <code class="inlineCode">Factorial</code>, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-built_in">int</span><span class="hljs-function"> </span><span class="hljs-title">Factorial</span><span class="hljs-function">(</span><span class="hljs-built_in">int</span><span class="hljs-params"> number</span><span class="hljs-function">)</span>
{
  <span class="hljs-keyword">if</span> (number &lt; <span class="hljs-number">0</span>)
  {
     <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentOutOfRangeException(message:
       <span class="hljs-string">$"The factorial function is defined for non-negative integers only. Input: </span><span class="hljs-subst">{number}</span><span class="hljs-string">"</span>,
       paramName: <span class="hljs-keyword">nameof</span>(number));
  }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (number == <span class="hljs-number">0</span>)
  {
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
  }
  <span class="hljs-keyword">else</span>
  {
    <span class="hljs-keyword">return</span> number * Factorial(number - <span class="hljs-number">1</span>);
  }
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">As before, there are several noteworthy elements in the preceding code, including the following:</p>
    <ul>
      <li class="bulletList level-2">If the input parameter <code class="inlineCode">number</code> is negative, <code class="inlineCode">Factorial</code> throws an exception.</li>
      <li class="bulletList level-2">If the input parameter <code class="inlineCode">number</code> is <code class="inlineCode">0</code>, <code class="inlineCode">Factorial</code> returns <code class="inlineCode">1</code>.</li>
      <li class="bulletList level-2">If the input parameter <code class="inlineCode">number</code> is more than <code class="inlineCode">0</code> (which it will be in all other cases), <code class="inlineCode">Factorial</code> multiplies the number by the result of calling itself and passing one less than <code class="inlineCode">number</code>. This makes the function recursive.</li>
    </ul>
    <div class="note-one">
      <p class="normal"><strong class="keyWord">More Information</strong>: Recursion is clever but it can lead to problems, such as a stack overflow due to too many function calls because memory is used to store data on every function call, and it eventually uses too much. Iteration is a more practical, if less succinct, solution in languages such as C#. You can read more about this at the following link: <a href="https://en.wikipedia.org/wiki/Recursion_(computer_science)#Recursion_versus_iteration"><span class="url">https://en.wikipedia.org/wiki/Recursion_(computer_science)#Recursion_versus_iteration</span></a>.</p>
    </div>
    <ol>
      <li class="numberedList" value="2">In <code class="inlineCode">Program.Functions.cs</code>, write a function named <code class="inlineCode">RunFactorial</code> that uses a <code class="inlineCode">for</code> statement to output the factorials of numbers from 1 to 15, calls the <code class="inlineCode">Factorial</code> function inside its loop, and then outputs the result, formatted using the code <code class="inlineCode">N0</code>, which refers to a number format using<a id="_idIndexMarker506"/> thousand separators with zero <a id="_idIndexMarker507"/>decimal places, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">RunFactorial</span><span class="hljs-function">()</span>
{
  <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">15</span>; i++)
  {
    WriteLine(<span class="hljs-string">$"</span><span class="hljs-subst">{i}</span><span class="hljs-string">! = </span><span class="hljs-subst">{Factorial(i):N0}</span><span class="hljs-string">"</span>);
  }
}
</code></pre>
      </li>
      <li class="numberedList">Comment out the <code class="inlineCode">RunCardinalToOrdinal</code> method call and call the <code class="inlineCode">RunFactorial</code> method.</li>
      <li class="numberedList">Run the project and view the results, as shown in the following partial output:
        <pre class="programlisting con-one"><code class="hljs-con">1! = 1
2! = 2
3! = 6
4! = 24
...
12! = 479,001,600
13! = 1,932,053,504
14! = 1,278,945,280
15! = 2,004,310,016
</code></pre>
      </li>
    </ol>
    <p class="normal">It is not immediately obvious in the previous output, but factorials of 13 and higher overflow the <code class="inlineCode">int</code> type because they are so big. <code class="inlineCode">12!</code> is 479,001,600, which is about half a billion. The maximum positive value that can be stored in an <code class="inlineCode">int</code> variable is about two billion. <code class="inlineCode">13!</code> is 6,227,020,800, which is about six billion, and when stored in a 32-bit integer, it overflows silently without showing any problems.</p>
    <p class="normal">What should<a id="_idIndexMarker508"/> you do to get notified when an overflow<a id="_idIndexMarker509"/> happens? Of course, we could solve the problem for <code class="inlineCode">13!</code> and <code class="inlineCode">14!</code> by using a <code class="inlineCode">long</code> (64-bit integer) instead of an <code class="inlineCode">int</code> (32-bit integer), but we will quickly hit the overflow limit again.</p>
    <p class="normal">The point of this section is to understand and show you that numbers can overflow, and not specifically how to calculate factorials higher than <code class="inlineCode">12!</code>. Let’s take a look:</p>
    <ol>
      <li class="numberedList" value="1">Modify the <code class="inlineCode">Factorial</code> function to check for overflows in the statement that calls itself, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-slc">checked </strong><strong class="hljs-comment-slc">// for overflow</strong></span>
<span class="code-highlight"><strong class="hljs-slc">{</strong></span>
  <span class="hljs-keyword">return</span> number * Factorial(number - <span class="hljs-number">1</span>);
<span class="code-highlight"><strong class="hljs-slc">}</strong></span>
</code></pre>
      </li>
      <li class="numberedList">Modify the <code class="inlineCode">RunFactorial</code> function to change the starting number to <code class="inlineCode">-2</code> and to handle overflow and other exceptions when calling the <code class="inlineCode">Factorial</code> function, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">RunFactorial</span><span class="hljs-function">()</span>
{
  <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="code-highlight"><strong class="hljs-number-slc">-2</strong></span>; i &lt;= <span class="hljs-number">15</span>; i++)
  {
<span class="code-highlight"><strong class="hljs-slc">    </strong><strong class="hljs-keyword-slc">try</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    {</strong></span>
      WriteLine(<span class="hljs-string">$"</span><span class="hljs-subst">{i}</span><span class="hljs-string">! = </span><span class="hljs-subst">{Factorial(i):N0}</span><span class="hljs-string">"</span>);
<span class="code-highlight"><strong class="hljs-slc">    }</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    </strong><strong class="hljs-keyword-slc">catch</strong><strong class="hljs-slc"> (OverflowException)</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    {</strong></span>
<span class="code-highlight"><strong class="hljs-slc">      WriteLine(</strong><strong class="hljs-string-slc">$"</strong><strong class="hljs-subst-slc">{i}</strong><strong class="hljs-string-slc">! is too big for a 32-bit integer."</strong><strong class="hljs-slc">);</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    }</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    </strong><strong class="hljs-keyword-slc">catch</strong><strong class="hljs-slc"> (Exception ex)</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    {</strong></span>
<span class="code-highlight"><strong class="hljs-slc">      WriteLine(</strong><strong class="hljs-string-slc">$"</strong><strong class="hljs-subst-slc">{i}</strong><strong class="hljs-string-slc">! throws </strong><strong class="hljs-subst-slc">{ex.GetType()}</strong><strong class="hljs-string-slc">: </strong><strong class="hljs-subst-slc">{ex.Message}</strong><strong class="hljs-string-slc">"</strong><strong class="hljs-slc">);</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    }</strong></span>
  }
}
</code></pre>
      </li>
      <li class="numberedList">Run the<a id="_idIndexMarker510"/> code and view the results, as <a id="_idIndexMarker511"/>shown in the following partial output:
        <pre class="programlisting con-one"><code class="hljs-con">-2! throws System.ArgumentOutOfRangeException: The factorial function is defined for non-negative integers only. Input: -2 (Parameter 'number')
-1! throws System.ArgumentOutOfRangeException: The factorial function is defined for non-negative integers only. Input: -1 (Parameter 'number')
0! = 1
1! = 1
2! = 2
...
12! = 479,001,600
13! is too big for a 32-bit integer.
14! is too big for a 32-bit integer.
15! is too big for a 32-bit integer.
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-259" class="heading-2">Documenting functions with XML comments</h2>
    <p class="normal">By <a id="_idIndexMarker512"/>default, when calling a function<a id="_idIndexMarker513"/> such as <code class="inlineCode">CardinalToOrdinal</code>, code editors will show a tooltip with basic information.</p>
    <p class="normal">Let’s improve the tooltip by adding extra information:</p>
    <ol>
      <li class="numberedList" value="1">If you are using VS Code with the <strong class="keyWord">C#</strong> extension, you should navigate to <strong class="screenText">View</strong> | <strong class="screenText">Command Palette</strong> | <strong class="screenText">Preferences: Open Settings (UI)</strong>, and then search for <code class="inlineCode">formatOnType</code> and make sure that it is enabled. C# XML documentation comments are a built-in feature of Visual Studio and Rider, so you do not need to do anything to use them.</li>
      <li class="numberedList">On the line above the <code class="inlineCode">CardinalToOrdinal</code> function, type three forward slashes, <code class="inlineCode">///</code>, and note that they are expanded into an XML comment that recognizes that the function has a single parameter named <code class="inlineCode">number</code>, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">/// <span class="hljs-tag">&lt;</span><span class="hljs-name">summary</span><span class="hljs-tag">&gt;</span>
///
/// <span class="hljs-tag">&lt;/</span><span class="hljs-name">summary</span><span class="hljs-tag">&gt;</span>
/// <span class="hljs-tag">&lt;</span><span class="hljs-name">param</span><span class="hljs-tag"> </span><span class="hljs-attr">name</span><span class="hljs-tag">=</span><span class="hljs-string">"number"</span><span class="hljs-tag">&gt;&lt;/</span><span class="hljs-name">param</span><span class="hljs-tag">&gt;</span>
/// <span class="hljs-tag">&lt;</span><span class="hljs-name">returns</span><span class="hljs-tag">&gt;&lt;/</span><span class="hljs-name">returns</span><span class="hljs-tag">&gt;</span>
</code></pre>
      </li>
      <li class="numberedList">Enter suitable information for the XML documentation comment for the <code class="inlineCode">CardinalToOrdinal</code> function. Add a summary and describe the input parameter and the return value, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">/// <span class="hljs-tag">&lt;</span><span class="hljs-name">summary</span><span class="hljs-tag">&gt;</span>
/// P<span class="code-highlight"><strong class="hljs-slc">ass a 32-bit unsigned integer and it will be converted into its</strong></span>
<span class="code-highlight"><strong class="hljs-slc">ordinal equivalent.</strong></span>
/// <span class="hljs-tag">&lt;/</span><span class="hljs-name">summary</span><span class="hljs-tag">&gt;</span>
/// <span class="hljs-tag">&lt;</span><span class="hljs-name">param</span><span class="hljs-tag"> </span><span class="hljs-attr">name</span><span class="hljs-tag">=</span><span class="hljs-string">"number"</span><span class="hljs-tag">&gt;</span>N<span class="code-highlight"><strong class="hljs-slc">umber as a cardinal value e.g. 1, 2, 3, and so</strong></span>
<span class="code-highlight"><strong class="hljs-slc">on.</strong></span><span class="hljs-tag">&lt;/</span><span class="hljs-name">param</span><span class="hljs-tag">&gt;</span>
/// <span class="hljs-tag">&lt;</span><span class="hljs-name">returns</span><span class="hljs-tag">&gt;</span>N<span class="code-highlight"><strong class="hljs-slc">umber as an ordinal value e.g. 1st, 2nd, 3rd, and so on.</strong></span>&lt;/
returns&gt;
</code></pre>
      </li>
      <li class="numberedList">Now, when<a id="_idIndexMarker514"/> calling the<a id="_idIndexMarker515"/> function, you will see more details, as shown in <em class="italic">Figure 4.2</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_04_02.png" alt="" width="812" height="241"/></figure>
    <p class="packt_figref">Figure 4.2: A tooltip showing the more detailed method signature</p>
    <p class="normal">It is worth emphasizing that this feature is primarily designed to be used with a tool that converts the comments into documentation, like Sandcastle, which you can read more about at the following link: <a href="https://github.com/EWSoftware/SHFB"><span class="url">https://github.com/EWSoftware/SHFB</span></a>. The tooltips that appear while entering code or hovering over the function name are a secondary feature.</p>
    <p class="normal">Local functions do not support XML comments because local functions cannot be used outside the member in which they are declared, so it makes no sense to generate documentation from them. Sadly, this also means no tooltip, which would still be useful, but neither Visual Studio nor VS Code recognizes that.</p>
    <div class="packt_tip">
      <p class="normal"><strong class="keyWord">Good Practice</strong>: Add XML documentation comments to all your functions except your local functions.</p>
    </div>
    <h2 id="_idParaDest-260" class="heading-2">Using lambdas in function implementations</h2>
    <p class="normal"><strong class="keyWord">F#</strong> is <a id="_idIndexMarker516"/>Microsoft’s strongly typed functional-first programming language that, like C#, compiles to <strong class="keyWord">Intermediate Language</strong> (<strong class="keyWord">IL</strong>) to be executed by .NET. Functional languages evolved from lambda calculus, a computational system based only on functions. The code looks more like mathematical functions than steps in a recipe.</p>
    <p class="normal">Some of the important attributes of functional languages are defined in the following list:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Modularity</strong>: The same benefit of defining functions in C# applies to functional<a id="_idIndexMarker517"/> languages. This breaks up a large, complex code base into smaller pieces.</li>
      <li class="bulletList"><strong class="keyWord">Immutability</strong>: Variables in<a id="_idIndexMarker518"/> the C# sense do not exist. Any data value inside a function cannot change. Instead, a new data value can be created from an existing one. This reduces bugs.</li>
      <li class="bulletList"><strong class="keyWord">Maintainability</strong>: Functional <a id="_idIndexMarker519"/>code is cleaner and clearer (for mathematically inclined programmers).</li>
    </ul>
    <p class="normal">Since C# 6, Microsoft has worked to add <a id="_idIndexMarker520"/>features to the language to support<a id="_idIndexMarker521"/> a more functional approach, for example, adding <strong class="keyWord">tuples</strong> and <strong class="keyWord">pattern matching</strong> in C# 7, <strong class="keyWord">non-null reference types</strong> in C# 8, and improving <a id="_idIndexMarker522"/>pattern matching and adding records, that<a id="_idIndexMarker523"/> is, potentially <strong class="keyWord">immutable objects</strong>, in C# 9.</p>
    <p class="normal">In C# 6, Microsoft added support<a id="_idIndexMarker524"/> for <strong class="keyWord">expression-bodied function members</strong>. We will look at an example of this now. In C#, lambdas are the use of the <code class="inlineCode">=&gt;</code> character to indicate a return value from a function.</p>
    <p class="normal">The <strong class="keyWord">Fibonacci sequence</strong> of numbers<a id="_idIndexMarker525"/> always starts with 0 and 1. Then, the rest of the sequence is generated using the rule of adding together the previous two numbers, as shown in the following sequence of numbers:</p>
    <pre class="programlisting con"><code class="hljs-con">0 1 1 2 3 5 8 13 21 34 55 ...
</code></pre>
    <p class="normal">The next term in the sequence would be 34 + 55, which is 89.</p>
    <p class="normal">We will use the Fibonacci sequence to illustrate the difference between an imperative and <a id="_idIndexMarker526"/>declarative function implementation:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.Functions.cs</code>, write a function named <code class="inlineCode">FibImperative</code>, which will be written in an imperative style, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-built_in">int</span><span class="hljs-function"> </span><span class="hljs-title">FibImperative</span><span class="hljs-function">(</span><span class="hljs-built_in">uint</span><span class="hljs-params"> term</span><span class="hljs-function">)</span>
{
  <span class="hljs-keyword">if</span> (term == <span class="hljs-number">0</span>)
  {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentOutOfRangeException();
  }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (term == <span class="hljs-number">1</span>)
  {
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (term == <span class="hljs-number">2</span>)
  {
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
  }
  <span class="hljs-keyword">else</span>
  {
    <span class="hljs-keyword">return</span> FibImperative(term - <span class="hljs-number">1</span>) + FibImperative(term - <span class="hljs-number">2</span>);
  }
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.Functions.cs</code>, write a function named <code class="inlineCode">RunFibImperative</code> that calls <code class="inlineCode">FibImperative</code> inside a <code class="inlineCode">for</code> statement that loops from 1 to 30, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">RunFibImperative</span><span class="hljs-function">()</span>
{
  <span class="hljs-keyword">for</span> (<span class="hljs-built_in">uint</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">30</span>; i++)
  {
    WriteLine(<span class="hljs-string">"The {0} term of the Fibonacci sequence is {1:N0}."</span>,
      arg0: CardinalToOrdinal(i),
      arg1: FibImperative(term: i));
  }
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, comment out the other method calls and call the <code class="inlineCode">RunFibImperative</code> method.</li>
      <li class="numberedList">Run the <a id="_idIndexMarker527"/>console app and view the results, as shown in the following partial output:
        <pre class="programlisting con-one"><code class="hljs-con">The 1st term of the Fibonacci sequence is 0.
The 2nd term of the Fibonacci sequence is 1.
The 3rd term of the Fibonacci sequence is 1.
The 4th term of the Fibonacci sequence is 2.
The 5th term of the Fibonacci sequence is 3.
...
The 29th term of the Fibonacci sequence is 317,811.
The 30th term of the Fibonacci sequence is 514,229.
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.Functions.cs</code>, write a function named <code class="inlineCode">FibFunctional</code> written in a declarative style, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-built_in">int</span><span class="hljs-function"> </span><span class="hljs-title">FibFunctional</span><span class="hljs-function">(</span><span class="hljs-built_in">uint</span><span class="hljs-params"> term</span><span class="hljs-function">)</span> =&gt; term <span class="hljs-keyword">switch</span>
  {
    <span class="hljs-number">0</span> =&gt; <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentOutOfRangeException(),
    <span class="hljs-number">1</span> =&gt; <span class="hljs-number">0</span>,
    <span class="hljs-number">2</span> =&gt; <span class="hljs-number">1</span>,
    _ =&gt; FibFunctional(term - <span class="hljs-number">1</span>) + FibFunctional(term - <span class="hljs-number">2</span>)
  };
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.Functions.cs</code>, write a function to call it inside a <code class="inlineCode">for</code> statement that loops from 1 to 30, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">RunFibFunctional</span><span class="hljs-function">()</span>
{
  <span class="hljs-keyword">for</span> (<span class="hljs-built_in">uint</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">30</span>; i++)
  {
    WriteLine(<span class="hljs-string">"The {0} term of the Fibonacci sequence is {1:N0}."</span>,
      arg0: CardinalToOrdinal(i),
      arg1: FibFunctional(term: i));
  }
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, comment out the <code class="inlineCode">RunFibImperative</code> method call and call the <code class="inlineCode">RunFibFunctional</code> method.</li>
      <li class="numberedList">Run <a id="_idIndexMarker528"/>the code and view the results (which will be the same as before).</li>
    </ol>
    <p class="normal">Now that you have seen some examples of functions, let’s see how you can fix them when they have bugs.</p>
    <h1 id="_idParaDest-261" class="heading-1">Debugging during development</h1>
    <p class="normal">In this section, you will learn how to debug problems at development time. You must use a code editor that has debugging<a id="_idIndexMarker529"/> tools, such as Visual Studio or VS Code.</p>
    <h2 id="_idParaDest-262" class="heading-2">Creating code with a deliberate bug</h2>
    <p class="normal">Let’s explore<a id="_idIndexMarker530"/> debugging by creating a console app with a deliberate bug, which we will then use the debugger tools in your code editor to track down and fix:</p>
    <ol>
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code> project named <code class="inlineCode">Debugging</code> to the <code class="inlineCode">Chapter04</code> solution.</li>
      <li class="numberedList">Modify <code class="inlineCode">Debugging.csproj</code> to statically import <code class="inlineCode">System.Console</code> for all code files.</li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete any existing statements, and then, at the bottom of the file, add a function with a deliberate bug, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-built_in">double</span><span class="hljs-function"> </span><span class="hljs-title">Add</span><span class="hljs-function">(</span><span class="hljs-built_in">double</span><span class="hljs-params"> a, </span><span class="hljs-built_in">double</span><span class="hljs-params"> b</span><span class="hljs-function">)</span>
{
  <span class="hljs-keyword">return</span> a * b; <span class="hljs-comment">// Deliberate bug!</span>
}
</code></pre>
      </li>
      <li class="numberedList">Above the <code class="inlineCode">Add</code> function, write statements to declare and set some variables and then add them together using the buggy function, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-built_in">double</span> a = <span class="hljs-number">4.5</span>;
<span class="hljs-built_in">double</span> b = <span class="hljs-number">2.5</span>;
<span class="hljs-built_in">double</span> answer = Add(a, b);
WriteLine(<span class="hljs-string">$"</span><span class="hljs-subst">{a}</span><span class="hljs-string"> + </span><span class="hljs-subst">{b}</span><span class="hljs-string"> = </span><span class="hljs-subst">{answer}</span><span class="hljs-string">"</span>);
WriteLine(<span class="hljs-string">"Press Enter to end the app."</span>);
ReadLine(); <span class="hljs-comment">// Wait for user to press Enter.</span>
</code></pre>
      </li>
      <li class="numberedList">Run the <a id="_idIndexMarker531"/>console application and view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">4.5 + 2.5 = 11.25
Press Enter to end the app.
</code></pre>
      </li>
    </ol>
    <p class="normal-one">But wait, there’s a bug! 4.5 added to 2.5 should be 7, not 11.25!</p>
    <p class="normal">We will use the debugging tools to hunt for and squish the bug.</p>
    <h2 id="_idParaDest-263" class="heading-2">Setting a breakpoint and starting debugging</h2>
    <p class="normal">Breakpoints <a id="_idIndexMarker532"/>allow us to mark a line of code that we want to pause at to inspect the program state and find bugs.</p>
    <h3 id="_idParaDest-264" class="heading-3">Using Visual Studio</h3>
    <p class="normal">Let’s set a<a id="_idIndexMarker533"/> breakpoint and then start debugging using <a id="_idIndexMarker534"/>Visual Studio:</p>
    <ol>
      <li class="numberedList" value="1">Click in line 1, which is the statement that declares the variable named <code class="inlineCode">a</code>.</li>
      <li class="numberedList">Navigate to <strong class="screenText">Debug</strong> | <strong class="screenText">Toggle Breakpoint</strong> or press <em class="keystroke">F9</em>. A red circle will appear in the margin bar on the left-hand side and the statement will be highlighted in red to indicate that a breakpoint has been set, as shown in <em class="italic">Figure 4.3</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_04_03.png" alt="" width="812" height="324"/></figure>
    <p class="packt_figref">Figure 4.3: Toggling breakpoints using Visual Studio</p>
    <div class="note-one">
      <p class="normal">Breakpoints can be toggled off with the same action. You can also left-click in the margin to toggle a breakpoint on and off or right-click a breakpoint to see more options, such as delete, disable, or edit conditions, or actions for an existing breakpoint.</p>
    </div>
    <ol>
      <li class="numberedList" value="3">Navigate to <strong class="screenText">Debug</strong> | <strong class="screenText">Start Debugging</strong> or press <em class="keystroke">F5</em>. Visual Studio starts the console application and then pauses when it hits the breakpoint. This is known as <em class="italic">break mode</em>. Extra windows titled <strong class="screenText">Locals</strong> (showing the current values of local variables), <strong class="screenText">Watch 1</strong> (showing any watch expressions you have defined), <strong class="screenText">Call Stack</strong>, <strong class="screenText">Exception Settings</strong>, and <strong class="screenText">Immediate Window</strong> may appear. The <strong class="screenText">Debugging</strong> toolbar appears. The line<a id="_idIndexMarker535"/> that will be executed<a id="_idIndexMarker536"/> next is highlighted in yellow, and a yellow arrow points at the line from the margin bar, as shown in <em class="italic">Figure 4.4</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_04_04.png" alt="" width="812" height="324"/></figure>
    <p class="packt_figref">Figure 4.4: Break mode in Visual Studio</p>
    <p class="normal">If you do not want to see how to use VS Code to start debugging, then you can skip the <em class="italic">Using VS Code</em> section and continue to the section titled <em class="italic">Navigating with the debugging toolbar</em>.</p>
    <h3 id="_idParaDest-265" class="heading-3">Using VS Code</h3>
    <p class="normal">Let’s set a<a id="_idIndexMarker537"/> breakpoint and then start debugging using<a id="_idIndexMarker538"/> VS Code:</p>
    <ol>
      <li class="numberedList" value="1">Click in line 1, which is the statement that declares the variable named <code class="inlineCode">a</code>.</li>
      <li class="numberedList">Navigate to <strong class="screenText">Run</strong> | <strong class="screenText">Toggle Breakpoint</strong> or press <em class="keystroke">F9</em>. A red circle will appear in the margin bar on the left-hand side to indicate that a breakpoint has been set.</li>
    </ol>
    <div class="note-one">
      <p class="normal">Breakpoints can be toggled off with the same action. You can also left-click in the margin to toggle a breakpoint on and off; right-click to see more options, such as remove, edit, or disable an existing breakpoint; or add a breakpoint, conditional breakpoint, or Logpoint when a breakpoint does not yet exist. <strong class="keyWord">Logpoints</strong>, also known as <strong class="keyWord">Tracepoints</strong>, indicate<a id="_idIndexMarker539"/> that you want to record some information <a id="_idIndexMarker540"/>without having to stop executing the code at that point.</p>
    </div>
    <ol>
      <li class="numberedList" value="3">Navigate to <strong class="screenText">View</strong> | <strong class="screenText">Run</strong>, or in the left navigation bar, you can click the <strong class="screenText">Run and Debug</strong> icon (the triangle “play” button and “bug”) or press <em class="keystroke">Ctrl</em> + <em class="keystroke">Shift</em> + <em class="keystroke">D</em> (on Windows).</li>
      <li class="numberedList">At the top of the <strong class="screenText">RUN AND DEBUG</strong> window, click the <strong class="screenText">Run and Debug</strong> button, and then<a id="_idIndexMarker541"/> select the <strong class="screenText">Debugging</strong> project, as <a id="_idIndexMarker542"/>shown in <em class="italic">Figure 4.5</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_04_05.png" alt="" width="812" height="272"/></figure>
    <p class="packt_figref">Figure 4.5: Selecting the project to debug using VS Code</p>
    <div class="note-one">
      <p class="normal">If you are first prompted to choose a debugger, select <strong class="screenText">C#</strong>, not .NET 5+ or .NET Core.</p>
    </div>
    <ol>
      <li class="numberedList" value="5">VS Code starts the console app and then pauses when it hits the breakpoint. This is known as <strong class="keyWord">break mode</strong>. The line that will be executed next is highlighted<a id="_idIndexMarker543"/> in yellow, and a yellow block points at the line from the margin bar, as shown in <em class="italic">Figure 4.6</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_04_06.png" alt="" width="812" height="307"/></figure>
    <p class="packt_figref">Figure 4.6: Break mode in VS Code</p>
    <h2 id="_idParaDest-266" class="heading-2">Navigating with the debugging toolbar</h2>
    <p class="normal">Visual Studio has two<a id="_idIndexMarker544"/> debug-related buttons in its <strong class="keyWord">Standard</strong> toolbar<a id="_idIndexMarker545"/> to start or continue debugging and to hot reload changes to the running code, and a separate <strong class="keyWord">Debug</strong> toolbar<a id="_idIndexMarker546"/> for the rest of the tools.</p>
    <p class="normal">VS Code shows a floating toolbar with buttons to make it easy to access debugging features.</p>
    <p class="normal">Both are shown in <em class="italic">Figure 4.7</em>:</p>
    <figure class="mediaobject"><img src="../Images/B22322_04_07.png" alt="" width="825" height="333"/></figure>
    <p class="packt_figref">Figure 4.7: Debugging toolbars in Visual Studio and VS Code</p>
    <p class="normal">The <a id="_idIndexMarker547"/>following list describes the most common buttons in the toolbars:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Start</strong>/<strong class="keyWord">Continue</strong>/<em class="keystroke">F5</em>: This button is context-sensitive. It will either start running a project or continue running the project from the current position until it ends or hits a breakpoint.</li>
      <li class="bulletList"><strong class="keyWord">Hot Reload</strong>: This button will reload compiled code changes without needing to restart the app.</li>
      <li class="bulletList"><strong class="keyWord">Break All</strong>: This button will break into the next available line of code in a running app.</li>
      <li class="bulletList"><strong class="keyWord">Stop Debugging</strong>/<strong class="keyWord">Stop</strong>/<em class="keystroke">Shift</em> + <em class="keystroke">F5</em> (red square): This button will stop the debugging session.</li>
      <li class="bulletList"><strong class="keyWord">Restart</strong>/<em class="keystroke">Ctrl</em> or <em class="keystroke">Cmd</em> + <em class="keystroke">Shift</em> + <em class="keystroke">F5</em> (circular arrow): This button will stop and then immediately restart the program with the debugger attached again.</li>
      <li class="bulletList"><strong class="keyWord">Show Next Statement</strong>: This button will move the current cursor to the next statement that will execute.</li>
      <li class="bulletList"><strong class="keyWord">Step Into</strong>/<em class="keystroke">F11</em>, <strong class="keyWord">Step Over</strong>/<em class="keystroke">F10</em>, and <strong class="keyWord">Step Out</strong>/<em class="keystroke">Shift</em> + <em class="keystroke">F11</em> (blue arrows over dots): These buttons step through the code statements in various ways, as you will see in a moment.</li>
      <li class="bulletList"><strong class="keyWord">Show Threads in Source</strong>: This button allows you to examine and work with threads in the application that you’re debugging.</li>
    </ul>
    <h2 id="_idParaDest-267" class="heading-2">Debugging windows</h2>
    <p class="normal">While debugging, both Visual Studio and <a id="_idIndexMarker548"/>VS Code show extra windows that allow you to monitor useful information, such as variables, while you step through your code.</p>
    <p class="normal">The most useful windows are described in the following list:</p>
    <ul>
      <li class="bulletList"><strong class="screenText">VARIABLES</strong>, including <strong class="screenText">Locals</strong>, which shows the name, value, and type of any local variables automatically. Keep an eye on this window while you step through your code.</li>
      <li class="bulletList"><strong class="screenText">WATCH</strong>, or <strong class="screenText">Watch 1</strong>, which shows the value of variables and expressions that you manually enter.</li>
      <li class="bulletList"><strong class="screenText">CALL STACK</strong>, which shows the stack of function calls.</li>
      <li class="bulletList"><strong class="screenText">BREAKPOINTS</strong>, which shows all your breakpoints and allows finer control over them.</li>
    </ul>
    <p class="normal">When in break mode, there is also a useful window at the bottom of the edit area:</p>
    <ul>
      <li class="bulletList"><strong class="screenText">DEBUG CONSOLE</strong>, or <strong class="screenText">Immediate Window</strong>, enables live interaction with your code. You can interrogate the program state, for example, by entering the name of a <a id="_idIndexMarker549"/>variable. For example, you can ask a question such as “What is 1+2?” by typing <code class="inlineCode">1+2</code> and pressing <em class="keystroke">Enter</em>.</li>
    </ul>
    <h2 id="_idParaDest-268" class="heading-2">Stepping through code</h2>
    <p class="normal">Let’s explore some ways to <a id="_idIndexMarker550"/>step through the code using either Visual Studio or <a id="_idIndexMarker551"/>VS Code:</p>
    <div class="note">
      <p class="normal">The menu commands for debugging are on the <strong class="screenText">Debug</strong> menu in Visual Studio or the <strong class="screenText">Run</strong> menu in VS Code and Rider.</p>
    </div>
    <ol>
      <li class="numberedList" value="1">Navigate to <strong class="screenText">Run</strong> or <strong class="screenText">Debug</strong> | <strong class="screenText">Step Into</strong>, click on the <strong class="screenText">Step Into</strong> button in the toolbar, or press <em class="keystroke">F11</em>. The yellow highlight steps forward one line.</li>
      <li class="numberedList">Navigate to <strong class="screenText">Run</strong> or <strong class="screenText">Debug</strong> | <strong class="screenText">Step Over</strong>, click on the <strong class="screenText">Step Over</strong> button in the toolbar, or press <em class="keystroke">F10</em>. The yellow highlight steps forward one line. At the moment, you can see that there is no difference between using <strong class="screenText">Step Into</strong> or <strong class="screenText">Step Over</strong> because we are executing single statements.</li>
      <li class="numberedList">You should now be on the line that calls the <code class="inlineCode">Add</code> method.</li>
    </ol>
    <div class="note-one">
      <p class="normal">The difference between <strong class="screenText">Step Into</strong> and <strong class="screenText">Step Over</strong> can be seen when you are about to execute a method call.</p>
      <p class="normal">If you click on <strong class="screenText">Step Into</strong>, the debugger steps <em class="italic">into</em> the method so that you can step through every line in that method.</p>
      <p class="normal">If you click on <strong class="screenText">Step Over</strong>, the whole method is executed in one go; it does not skip over the method without executing it.</p>
    </div>
    <ol>
      <li class="numberedList" value="4">Click on <strong class="screenText">Step Into</strong> to step inside the <code class="inlineCode">Add</code> method.</li>
      <li class="numberedList">Hover your mouse pointer over the <code class="inlineCode">a</code> or <code class="inlineCode">b</code> parameters in the code editing window and note that a tooltip appears showing their current value.</li>
      <li class="numberedList">Select the expression <code class="inlineCode">a * b</code>, right-click the expression, and select <strong class="screenText">Add to Watch</strong> or <strong class="screenText">Add Watch</strong>. The expression is added to the <strong class="screenText">WATCH</strong> or <strong class="screenText">Watch 1</strong> window, showing that this operator is multiplying <code class="inlineCode">a</code> by <code class="inlineCode">b</code> to give the result <code class="inlineCode">11.25</code>.</li>
      <li class="numberedList">In the <strong class="screenText">WATCH</strong> or <strong class="screenText">Watch 1</strong> window, right-click the expression and choose <strong class="screenText">Remove Expression</strong> or <strong class="screenText">Delete Watch</strong>.</li>
      <li class="numberedList">Fix the bug by changing <code class="inlineCode">*</code> to <code class="inlineCode">+</code> in the <code class="inlineCode">Add</code> function.</li>
      <li class="numberedList">Restart debugging by clicking the circular arrow <strong class="screenText">Restart</strong> button or pressing <em class="keystroke">Ctrl</em> or <em class="keystroke">Cmd</em> + <em class="keystroke">Shift</em> + <em class="keystroke">F5</em>.</li>
      <li class="numberedList">Step over <a id="_idIndexMarker552"/>the function, take a minute to <a id="_idIndexMarker553"/>note how it now calculates correctly, and click the <strong class="screenText">Continue</strong> button or press <em class="keystroke">F5</em>.</li>
      <li class="numberedList">With VS Code, note that when writing to the console during debugging, the output appears in the <strong class="screenText">DEBUG CONSOLE</strong> window instead of the <strong class="screenText">TERMINAL</strong> window, as shown in <em class="italic">Figure 4.8</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_04_08.png" alt="" width="812" height="307"/></figure>
    <p class="packt_figref">Figure 4.8: Writing to the DEBUG CONSOLE during debugging</p>
    <h2 id="_idParaDest-269" class="heading-2">Using the VS Code integrated terminal during debugging</h2>
    <p class="normal">By default, the <a id="_idIndexMarker554"/>console is set to use the internal <strong class="keyWord">DEBUG CONSOLE</strong> during debugging, which does not allow interactions like entering text from the <code class="inlineCode">ReadLine</code> method.</p>
    <p class="normal">To improve the experience, we can change the setting to use the integrated terminal instead. First, let’s modify the code to require interaction with the user:</p>
    <ol>
      <li class="numberedList" value="1">At the top of <code class="inlineCode">Program.cs</code>, add statements to prompt the user to enter a number and parse that as a <code class="inlineCode">double</code> into the variable <code class="inlineCode">a</code>, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-slc">Write(</strong><strong class="hljs-string-slc">"Enter a number: "</strong><strong class="hljs-slc">);</strong></span>
<span class="code-highlight"><strong class="hljs-built_in-slc">string</strong><strong class="hljs-slc"> number = ReadLine()!;</strong></span>
<span class="hljs-built_in">double</span> a = <span class="code-highlight"><strong class="hljs-built_in-slc">double</strong><strong class="hljs-slc">.Parse(number)</strong></span>;
</code></pre>
      </li>
      <li class="numberedList">Set a breakpoint on line 1 that writes the prompt <code class="inlineCode">Enter a number</code>.</li>
      <li class="numberedList">At the top of the <strong class="screenText">RUN AND DEBUG</strong> window, click the <strong class="screenText">Run and Debug</strong> button, and then select the <strong class="screenText">Debugging</strong> project.</li>
      <li class="numberedList">Note that the <code class="inlineCode">Enter a number</code> prompt is not written to either <strong class="screenText">TERMINAL</strong> or <strong class="screenText">DEBUG CONSOLE</strong> and neither window is waiting for the user to enter a number and press <em class="keystroke">Enter</em>.</li>
      <li class="numberedList">Stop debugging.</li>
      <li class="numberedList">At the top of the <strong class="screenText">RUN AND DEBUG</strong> window, click the <strong class="screenText">create a launch.json file</strong> link, and then, when prompted for the debugger, select <strong class="screenText">C#</strong>, as shown in <em class="italic">Figure 4.9</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_04_09.png" alt="" width="812" height="254"/></figure>
    <p class="packt_figref">Figure 4.9: Selecting a debugger for the launch.json file</p>
    <ol>
      <li class="numberedList" value="7">In the <code class="inlineCode">launch.json</code> file editor, click the <strong class="screenText">Add Configuration...</strong> button, and then <a id="_idIndexMarker555"/>select <strong class="screenText">.NET: Launch .NET Core Console App</strong>, as shown in <em class="italic">Figure 4.10</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_04_10.png" alt="" width="812" height="254"/></figure>
    <p class="packt_figref">Figure 4.10: Adding a launch configuration for a .NET console app</p>
    <ol>
      <li class="numberedList" value="8">In <code class="inlineCode">launch.json</code>, make the following additions and changes, as shown highlighted in the following configuration:<ul>
          <li class="bulletList level-2">Comment out the <code class="inlineCode">preLaunchTask</code> setting.</li>
          <li class="bulletList level-2">In the <code class="inlineCode">program</code> path, add the <code class="inlineCode">Debugging</code> project folder after the <code class="inlineCode">workspaceFolder</code> variable.</li>
          <li class="bulletList level-2">In the <code class="inlineCode">program</code> path, change <code class="inlineCode">&lt;target-framework&gt;</code> to <code class="inlineCode">net9.0</code>.</li>
          <li class="bulletList level-2">In the <code class="inlineCode">program</code> path, change <code class="inlineCode">&lt;project-name.dll&gt;</code> to <code class="inlineCode">Debugging.dll</code>.</li>
          <li class="bulletList level-2">Change<a id="_idIndexMarker556"/> the <code class="inlineCode">console</code> setting from <code class="inlineCode">internalConsole</code> to <code class="inlineCode">integratedTerminal</code>:</li>
        </ul>
        <pre class="programlisting code-one"><code class="hljs-code">{
  <span class="hljs-comment">// Use IntelliSense to learn about possible attributes.</span>
  <span class="hljs-comment">// Hover to view descriptions of existing attributes.</span>
  <span class="hljs-comment">// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387</span>
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"0.2.0"</span>,
  <span class="hljs-string">"configurations"</span>: [
    {
      <span class="hljs-string">"name"</span>: <span class="hljs-string">".NET Core Launch (console)"</span>,
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"coreclr"</span>,
      <span class="hljs-string">"request"</span>: <span class="hljs-string">"launch"</span>,
      <span class="code-highlight"><strong class="hljs-comment-slc">//</strong></span><span class="hljs-comment">"preLaunchTask": "build",</span>
      <span class="hljs-string">"program"</span>: <span class="hljs-string">"${workspaceFolder}/</span><span class="code-highlight"><strong class="hljs-string-slc">Debugging/</strong></span><span class="hljs-string">bin/Debug/</span><span class="code-highlight"><strong class="hljs-string-slc">net9.0</strong></span><span class="hljs-string">/</span><span class="code-highlight"><strong class="hljs-string-slc">Debugging.dll</strong></span><span class="hljs-string">"</span>,
      <span class="hljs-string">"args"</span>: [],
      <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"${workspaceFolder}"</span>,
      <span class="hljs-string">"stopAtEntry"</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-string">"console"</span>: <span class="hljs-string">"</span><span class="code-highlight"><strong class="hljs-string-slc">integratedTerminal</strong></span><span class="hljs-string">"</span>
    }
  ]
}
</code></pre>
      </li>
    </ol>
    <div class="note-one">
      <p class="normal">Remember that with VS Code, we open the <code class="inlineCode">Chapter04</code> folder to process the solution file, so the workspace folder is <code class="inlineCode">Chapter04</code>, not the <code class="inlineCode">Debugging</code> project.</p>
    </div>
    <ol>
      <li class="numberedList" value="9">At the top of the <strong class="screenText">RUN AND DEBUG</strong> window, note the drop-down list of launch configurations, and click the <strong class="screenText">Start Debugging</strong> button (green triangle), as shown in <em class="italic">Figure 4.11</em>.</li>
      <li class="numberedList">Navigate to <strong class="screenText">View</strong> | <strong class="screenText">Terminal</strong> and note the <strong class="screenText">TERMINAL</strong> window is attached to <code class="inlineCode">Debugging.dll</code>, as shown in <em class="italic">Figure 4.11</em>.</li>
      <li class="numberedList">Step over the statement that writes <code class="inlineCode">Enter a number:</code> to the console.</li>
      <li class="numberedList">Step over the statement that calls <code class="inlineCode">ReadLine</code>.</li>
      <li class="numberedList">Type <code class="inlineCode">5.5</code> and press <em class="keystroke">Enter</em>.</li>
      <li class="numberedList">Continue<a id="_idIndexMarker557"/> stepping through the statements or press <em class="keystroke">F5</em> or click <strong class="screenText">Continue</strong>, and note the output written to the integrated terminal, as shown in <em class="italic">Figure 4.11</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_04_11.png" alt="" width="812" height="328"/></figure>
    <p class="packt_figref">Figure 4.11: A launch configuration set to use the integrated terminal for user interaction</p>
    <h2 id="_idParaDest-270" class="heading-2">Customizing breakpoints</h2>
    <p class="normal">It is easy <a id="_idIndexMarker558"/>to make more complex breakpoints:</p>
    <ol>
      <li class="numberedList" value="1">If you are still debugging, click the <strong class="screenText">Stop</strong> button in the debugging toolbar, navigate to <strong class="screenText">Run</strong> or <strong class="screenText">Debug</strong> | <strong class="screenText">Stop Debugging</strong>, or press <em class="keystroke">Shift</em> + <em class="keystroke">F5</em>.</li>
      <li class="numberedList">Navigate to <strong class="screenText">Run</strong> | <strong class="screenText">Remove All Breakpoints</strong> or <strong class="screenText">Debug</strong> | <strong class="screenText">Delete All Breakpoints</strong>.</li>
      <li class="numberedList">Click on the <code class="inlineCode">WriteLine</code> statement that outputs the answer.</li>
      <li class="numberedList">Set a breakpoint by pressing <em class="keystroke">F9</em> or navigating to <strong class="screenText">Run</strong> or <strong class="screenText">Debug</strong> | <strong class="screenText">Toggle Breakpoint</strong>.</li>
      <li class="numberedList">Right-click the breakpoint and choose the appropriate menu for your code editor:<ul>
          <li class="bulletList level-2">In VS Code, choose <strong class="screenText">Edit Breakpoint...</strong>.</li>
          <li class="bulletList level-2">In Visual Studio, choose <strong class="screenText">Conditions...</strong>.</li>
        </ul>
      </li>
      <li class="numberedList">Type an <a id="_idIndexMarker559"/>expression, such as the <code class="inlineCode">answer</code> variable must be greater than <code class="inlineCode">9</code>, and then press <em class="keystroke">Enter</em> to accept it, and note the expression must evaluate to <code class="inlineCode">true</code> for the breakpoint to activate, as shown in <em class="italic">Figure 4.12</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_04_12.png" alt="" width="812" height="203"/></figure>
    <p class="packt_figref">Figure 4.12: Customizing a breakpoint with an expression using VS Code</p>
    <ol>
      <li class="numberedList" value="7">Start debugging and note the breakpoint is not hit.</li>
      <li class="numberedList">Stop debugging.</li>
      <li class="numberedList">Edit the breakpoint or its conditions and change its expression to less than <code class="inlineCode">9</code>.</li>
      <li class="numberedList">Start debugging and note the breakpoint is hit.</li>
      <li class="numberedList">Stop debugging.</li>
      <li class="numberedList">Edit the breakpoint or its conditions (in Visual Studio, click <strong class="screenText">Add condition</strong>), select <strong class="screenText">Hit Count</strong>, then enter a number such as <code class="inlineCode">3</code>, meaning that you would have to hit the breakpoint three times before it activates, as shown in <em class="italic">Figure 4.13</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_04_13.png" alt="" width="812" height="352"/></figure>
    <p class="packt_figref">Figure 4.13: Customizing a breakpoint with an expression and hit count using Visual Studio</p>
    <ol>
      <li class="numberedList" value="13">Hover your <a id="_idIndexMarker560"/>mouse over the breakpoint’s red circle to see a summary, as shown in <em class="italic">Figure 4.14</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_04_14.png" alt="" width="812" height="203"/></figure>
    <p class="packt_figref">Figure 4.14: A summary of a customized breakpoint in VS Code</p>
    <p class="normal">You have now fixed a bug using some debugging tools and seen some advanced possibilities for setting breakpoints.</p>
    <h1 id="_idParaDest-271" class="heading-1">Hot reloading during development</h1>
    <p class="normal"><strong class="keyWord">Hot Reload</strong> is a <a id="_idIndexMarker561"/>feature that allows a developer to apply changes to code while the app is running and immediately see the effect. This is great for fixing bugs quickly. Hot Reload is also known as <strong class="keyWord">Edit and Continue</strong>. A list of the types of changes you can make that <a id="_idIndexMarker562"/>support Hot Reload is found at the following link: <a href="https://aka.ms/dotnet/hot-reload"><span class="url">https://aka.ms/dotnet/hot-reload</span></a>.</p>
    <p class="normal">Just before the<a id="_idIndexMarker563"/> release of .NET 6, a high-level Microsoft employee caused controversy by attempting to make the feature exclusive to Visual Studio. Luckily the open-source contingent within Microsoft successfully had the decision overturned. Hot Reload remains available using the command-line tool as well.</p>
    <p class="normal">Let’s see it in action:</p>
    <ol>
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code> project named <code class="inlineCode">HotReloading</code> to the <code class="inlineCode">Chapter04</code> solution.</li>
      <li class="numberedList">Modify <code class="inlineCode">HotReloading.csproj</code> to statically import <code class="inlineCode">System.Console</code> for all code files.</li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete the existing statements, and then write a message to the console every two seconds, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">/* Visual Studio: run the app, change the message, click Hot Reload.</span>
<span class="hljs-comment"> * VS Code: run the app using dotnet watch, change the message. */</span>
<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)
{
  WriteLine(<span class="hljs-string">"Hello, Hot Reload!"</span>);
  <span class="hljs-keyword">await</span> Task.Delay(<span class="hljs-number">2000</span>);
}
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-272" class="heading-2">Hot reloading using Visual Studio</h2>
    <p class="normal">If you are<a id="_idIndexMarker564"/> using Visual Studio, Hot Reload<a id="_idIndexMarker565"/> is built into the user interface:</p>
    <ol>
      <li class="numberedList" value="1">In Visual Studio, start the project and note that the message is output every two seconds.</li>
      <li class="numberedList">Leave the project running.</li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, change <code class="inlineCode">Hello</code> to <code class="inlineCode">Goodbye</code>.</li>
      <li class="numberedList">Navigate to <strong class="screenText">Debug</strong> | <strong class="screenText">Apply Code Changes</strong> or click the <strong class="screenText">Hot Reload</strong> button in the toolbar, as shown in <em class="italic">Figure 4.15</em>, and note the change is applied without needing to restart the console app.</li>
      <li class="numberedList">Drop down the <strong class="screenText">Hot Reload</strong> button menu and select <strong class="screenText">Hot Reload on File Save</strong>, as shown in <em class="italic">Figure 4.15</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_04_15.png" alt="" width="812" height="238"/></figure>
    <p class="packt_figref">Figure 4.15: Changing Hot Reload options</p>
    <ol>
      <li class="numberedList" value="6">Change<a id="_idIndexMarker566"/> the message again, save the file, and <a id="_idIndexMarker567"/>note the console app updates automatically.</li>
    </ol>
    <h2 id="_idParaDest-273" class="heading-2">Hot reloading using VS Code and dotnet watch</h2>
    <p class="normal">If you are <a id="_idIndexMarker568"/>using VS Code, you must issue a special<a id="_idIndexMarker569"/> command when starting the console app to <a id="_idIndexMarker570"/>activate <a id="_idIndexMarker571"/>Hot Reload:</p>
    <ol>
      <li class="numberedList" value="1">In VS Code, in <strong class="screenText">TERMINAL</strong>, start the console app using <code class="inlineCode">dotnet watch</code>, and note the output that shows that Hot Reload is active, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">dotnet watch  Hot reload enabled. For a list of supported edits, see https://aka.ms/dotnet/hot-reload.
   Press "Ctrl + R" to restart.
dotnet watch  Building...
  Determining projects to restore...
  All projects are up-to-date for restore.
  HotReloading -&gt; C:\cs13net9\Chapter04\HotReloading\bin\Debug\net9.0\HotReloading.dll
dotnet watch  Started
Hello, Hot Reload!
Hello, Hot Reload!
Hello, Hot Reload!
</code></pre>
      </li>
      <li class="numberedList">In VS Code, change <code class="inlineCode">Hello</code> to <code class="inlineCode">Goodbye</code>, and note that, after a couple of seconds, the change is applied without needing to restart the console app, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Hello, Hot Reload!
dotnet watch  File changed: .\Program.cs.
Hello, Hot Reload!
Hello, Hot Reload!
dotnet watch  Hot reload of changes succeeded.
Goodbye, Hot Reload!
Goodbye, Hot Reload!
</code></pre>
      </li>
      <li class="numberedList">Press <em class="keystroke">Ctrl</em> + <em class="keystroke">C</em> to <a id="_idIndexMarker572"/>stop<a id="_idIndexMarker573"/> it <a id="_idIndexMarker574"/>running, as shown in <a id="_idIndexMarker575"/>the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Goodbye, Hot Reload!
dotnet watch  Shutdown requested. Press Ctrl+C again to force exit.
</code></pre>
      </li>
    </ol>
    <p class="normal">Now that you’ve seen tools for finding and removing bugs during development, let’s see how you can track down less obvious problems that might happen during development and production by writing tests.</p>
    <h1 id="_idParaDest-274" class="heading-1">Unit testing</h1>
    <p class="normal">Fixing bugs in code is expensive. The earlier that a bug is discovered in the development process, the less expensive it will be to fix.</p>
    <p class="normal">Unit testing<a id="_idIndexMarker576"/> is a good way to find bugs early in the development process because they test a small unit before they are integrated together or seen by user acceptance testers. Some developers even follow the principle that programmers should create unit tests before they write code, and this is <a id="_idIndexMarker577"/>called <strong class="keyWord">test-driven development</strong> (<strong class="keyWord">TDD</strong>).</p>
    <p class="normal">Microsoft has a proprietary unit testing framework known<a id="_idIndexMarker578"/> as <strong class="keyWord">MSTest</strong>. There is also a framework<a id="_idIndexMarker579"/> named <strong class="keyWord">NUnit</strong>. However, we will use the free and open-source third-party <a id="_idIndexMarker580"/>framework <strong class="keyWord">xUnit.net</strong>. All three do basically the same thing. xUnit was created by the same team that built NUnit, but they fixed the mistakes they felt they made previously. xUnit<a id="_idIndexMarker581"/> is more extensible and has better community support.</p>
    <div class="note">
      <p class="normal">If you are curious about the pros and cons of the various testing systems, then there are hundreds of articles written by proponents of each. Just google them: <a href="https://www.google.com/search?q=xunit+vs+nunit"><span class="url">https://www.google.com/search?q=xunit+vs+nunit</span></a>.</p>
    </div>
    <h2 id="_idParaDest-275" class="heading-2">Understanding types of testing</h2>
    <p class="normal">Unit testing is just one of many types of testing, as described in <em class="italic">Table 4.1</em>:</p>
    <table id="table001-3" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Type</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Unit</p>
          </td>
          <td class="table-cell">
            <p class="normal">Tests the<a id="_idIndexMarker582"/> smallest unit of code, typically a method or function. Unit<a id="_idIndexMarker583"/> testing is performed on a unit of code isolated from its dependencies by mocking them if needed. Each unit should have multiple tests: some with typical inputs and expected outputs, some with extreme input values to test boundaries, and some with deliberately wrong inputs to test exception handling.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Integration</p>
          </td>
          <td class="table-cell">
            <p class="normal">Tests if the <a id="_idIndexMarker584"/>smaller units and larger components work<a id="_idIndexMarker585"/> together as a single piece of software. Sometimes involves integrating with external components for which you do not have source code.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">System</p>
          </td>
          <td class="table-cell">
            <p class="normal">Tests<a id="_idIndexMarker586"/> the whole system environment in which your<a id="_idIndexMarker587"/> software will run.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Performance</p>
          </td>
          <td class="table-cell">
            <p class="normal">Tests the performance<a id="_idIndexMarker588"/> of your software; for example, your code must <a id="_idIndexMarker589"/>return a web page full of data to a visitor in under 20 milliseconds.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Load</p>
          </td>
          <td class="table-cell">
            <p class="normal">Tests how many <a id="_idIndexMarker590"/>requests your software can handle simultaneously <a id="_idIndexMarker591"/>while maintaining required performance, for example, 10,000 concurrent visitors to a website.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">User Acceptance</p>
          </td>
          <td class="table-cell">
            <p class="normal">Tests <a id="_idIndexMarker592"/>if users can happily complete their work using <a id="_idIndexMarker593"/>your software.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 4.1: Types of testing</p>
    <h2 id="_idParaDest-276" class="heading-2">Creating a class library that needs testing</h2>
    <p class="normal">First, we will create a function that needs testing. We will create it in a class library project separate from a console app project. A class library<a id="_idIndexMarker594"/> is a package of code that can be distributed and referenced by other .NET applications:</p>
    <ol>
      <li class="numberedList" value="1">Use your preferred<a id="_idIndexMarker595"/> code editor to add a new <strong class="screenText">Class Library</strong> / <code class="inlineCode">classlib</code> project named <code class="inlineCode">CalculatorLib</code> to the <code class="inlineCode">Chapter04</code> solution.</li>
    </ol>
    <div class="note-one">
      <p class="normal">At this point, you will have created about a dozen new console app projects and added them to a solution. The only difference when adding a <strong class="screenText">Class Library</strong> / <code class="inlineCode">classlib</code> project is selecting a different project template. The rest of the steps are the same as adding a <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code> project.</p>
    </div>
    <p class="normal-one">If you are using <a id="_idIndexMarker596"/>Visual Studio:</p>
    <ol class="alphabeticList level-2" style="list-style-type: lower-alpha;">
      <li class="alphabeticList level-2" value="1">Navigate to <strong class="screenText">File</strong> | <strong class="screenText">Add</strong> | <strong class="screenText">New Project</strong>.</li>
      <li class="alphabeticList level-2">In the <strong class="screenText">Add a new project</strong> dialog, search for and select <strong class="screenText">Class Library [C#]</strong> and then click <strong class="screenText">Next</strong>.</li>
      <li class="alphabeticList level-2">In the <strong class="screenText">Configure your new project</strong> dialog, for the <strong class="screenText">Project name</strong>, enter <code class="inlineCode">CalculatorLib</code>, leave the location as <code class="inlineCode">C:\cs13net9\Chapter04</code>, and then click <strong class="screenText">Next</strong>.</li>
      <li class="alphabeticList level-2">In the <strong class="screenText">Additional information</strong> dialog, select<strong class="screenText"> .NET 9.0 (Standard Term Support)</strong>, and then click <strong class="screenText">Create</strong>.</li>
    </ol>
    <p class="normal-one">If you are using VS Code:</p>
    <ol class="alphabeticList level-2" style="list-style-type: lower-alpha;">
      <li class="alphabeticList level-2" value="1">In <strong class="screenText">TERMINAL</strong>, switch to a terminal in the <code class="inlineCode">Chapter04</code> folder.</li>
      <li class="alphabeticList level-2">Use the <code class="inlineCode">dotnet</code> CLI to create a new class library project named <code class="inlineCode">CalculatorLib</code>, as shown in the following command: <code class="inlineCode">dotnet new classlib -o CalculatorLib</code>.</li>
      <li class="alphabeticList level-2">Use the <code class="inlineCode">dotnet</code> CLI to add the new project folder to the solution, as shown in the following command: <code class="inlineCode">dotnet sln add CalculatorLib</code>.</li>
      <li class="alphabeticList level-2">Note the results, as shown in the following output: <code class="inlineCode">Project `CalculatorLib\CalculatorLib.csproj` added to the solution</code>.</li>
    </ol>
    <ol>
      <li class="numberedList" value="2">For all code editors, in the <code class="inlineCode">CalculatorLib</code> project, rename the file named <code class="inlineCode">Class1.cs</code> to <code class="inlineCode">Calculator.cs</code>.</li>
      <li class="numberedList">In <code class="inlineCode">Calculator.cs</code>, modify the file to define a <code class="inlineCode">Calculator</code> class (with a deliberate bug), as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">namespace</span> <span class="hljs-title">CalculatorLib</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Calculator</span>
{
  <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-built_in">double</span><span class="hljs-function"> </span><span class="hljs-title">Add</span><span class="hljs-function">(</span><span class="hljs-built_in">double</span><span class="hljs-params"> a, </span><span class="hljs-built_in">double</span><span class="hljs-params"> b</span><span class="hljs-function">)</span>
  {
    <span class="hljs-keyword">return</span> a * b;
  }
}
</code></pre>
      </li>
      <li class="numberedList">Compile <a id="_idIndexMarker597"/>your class library project:<ul>
          <li class="bulletList level-2">In Visual Studio, navigate to <strong class="screenText">Build</strong> | <strong class="screenText">Build CalculatorLib</strong>.</li>
          <li class="bulletList level-2">In VS Code, in a <strong class="screenText">TERMINAL</strong> window for the <code class="inlineCode">CalculatorLib</code> folder, enter the command <code class="inlineCode">dotnet build</code>. (You could also run this command in the <code class="inlineCode">Chapter04</code> folder but that would build the whole solution, which is unnecessary in this scenario.)</li>
        </ul>
      </li>
      <li class="numberedList">Use your preferred code editor to add a new <strong class="screenText">xUnit Test Project [C#]</strong> / <code class="inlineCode">xunit</code> project named <code class="inlineCode">CalculatorLibUnitTests</code> to the <code class="inlineCode">Chapter04</code> solution. For example, at the command prompt or terminal in the <code class="inlineCode">Chapter04</code> folder, enter the following commands:
        <pre class="programlisting con-one"><code class="hljs-con">dotnet new xunit -o CalculatorLibUnitTests
dotnet sln add CalculatorLibUnitTests
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">CalculatorLibUnitTests</code> project, add a project reference to the <code class="inlineCode">CalculatorLib</code> project:<ul>
          <li class="bulletList level-2">If you are using Visual Studio, in <strong class="screenText">Solution Explorer</strong>, select the <code class="inlineCode">CalculatorLibUnitTests</code> project, navigate to <strong class="screenText">Project</strong> | <strong class="screenText">Add Project Reference…</strong>, check the box to select the <code class="inlineCode">CalculatorLib</code> project, and then click <strong class="screenText">OK</strong>.</li>
          <li class="bulletList level-2">If you are using VS Code, use the <code class="inlineCode">dotnet add reference</code> command, or in the file named <code class="inlineCode">CalculatorLibUnitTests.csproj</code>, modify the configuration to add an item group with a project reference to the <code class="inlineCode">CalculatorLib</code> project, as shown highlighted in the following markup:
            <pre class="programlisting code"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;ProjectReference
    Include=<span class="hljs-string">"..\CalculatorLib\CalculatorLib.csproj"</span> /&gt;
&lt;/ItemGroup&gt;
</code></pre>
          </li>
        </ul>
      </li>
    </ol>
    <div class="note-one">
      <p class="normal">The path for a project reference can use either forward <code class="inlineCode">(/)</code> or back slashes <code class="inlineCode">(\)</code> because the paths are processed by the .NET SDK and changed if necessary for the current operating system.</p>
    </div>
    <ol>
      <li class="numberedList" value="7">Build <a id="_idIndexMarker598"/>the <code class="inlineCode">CalculatorLibUnitTests</code> project.</li>
    </ol>
    <h2 id="_idParaDest-277" class="heading-2">Writing unit tests</h2>
    <p class="normal">A well-written unit test<a id="_idIndexMarker599"/> will have<a id="_idIndexMarker600"/> three parts:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Arrange</strong>: This part will declare and instantiate variables for input and output.</li>
      <li class="bulletList"><strong class="keyWord">Act</strong>: This part will execute the unit that you are testing. In our case, that means calling the method that we want to test.</li>
      <li class="bulletList"><strong class="keyWord">Assert</strong>: This part will make one or more assertions about the output. An assertion is a belief that, if not true, indicates a failed test. For example, when adding 2 and 2, we would expect the result to be 4.</li>
    </ul>
    <p class="normal">Now, we will write some unit tests for the <code class="inlineCode">Calculator</code> class:</p>
    <ol>
      <li class="numberedList" value="1">Rename the file <code class="inlineCode">UnitTest1.cs</code> to <code class="inlineCode">CalculatorUnitTests.cs</code> and then open it.</li>
      <li class="numberedList">In VS Code, rename the class to <code class="inlineCode">CalculatorUnitTests</code>. (Visual Studio prompts you to rename the class when you rename the file.)</li>
      <li class="numberedList">In <code class="inlineCode">CalculatorUnitTests</code>, import the <code class="inlineCode">CalculatorLib</code> namespace, and then modify the <code class="inlineCode">CalculatorUnitTests</code> class to have two test methods, one for adding 2 and 2, and another for adding 2 and 3, as shown in the <a id="_idIndexMarker601"/>following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">using</span> CalculatorLib; <span class="hljs-comment">// To use Calculator.</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">CalculatorLibUnitTests</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CalculatorUnitTests</span>
{
  [<span class="hljs-meta">Fact</span>]
  <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">TestAdding2And2</span><span class="hljs-function">()</span>
  {
    <span class="hljs-comment">// Arrange: Set up the inputs and the unit under test.</span>
    <span class="hljs-built_in">double</span> a = <span class="hljs-number">2</span>;
    <span class="hljs-built_in">double</span> b = <span class="hljs-number">2</span>;
    <span class="hljs-built_in">double</span> expected = <span class="hljs-number">4</span>;
    Calculator calc = <span class="hljs-keyword">new</span>();
    <span class="hljs-comment">// Act: Execute the function to test.</span>
    <span class="hljs-built_in">double</span> actual = calc.Add(a, b);
    <span class="hljs-comment">// Assert: Make assertions to compare expected to actual results.</span>
    Assert.Equal(expected, actual);
  }
  [<span class="hljs-meta">Fact</span>]
  <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">TestAdding2And3</span><span class="hljs-function">()</span>
  {
    <span class="hljs-built_in">double</span> a = <span class="hljs-number">2</span>;
    <span class="hljs-built_in">double</span> b = <span class="hljs-number">3</span>;
    <span class="hljs-built_in">double</span> expected = <span class="hljs-number">5</span>;
    Calculator calc = <span class="hljs-keyword">new</span>();
    <span class="hljs-built_in">double</span> actual = calc.Add(a, b);
    Assert.Equal(expected, actual);
  }
}
</code></pre>
      </li>
    </ol>
    <div class="note-one">
      <p class="normal">Visual Studio still uses an older project item template that uses a nested namespace. The preceding code shows the modern project item template used by <code class="inlineCode">dotnet new</code> and Rider that uses a file-scoped namespace.</p>
    </div>
    <ol>
      <li class="numberedList" value="4">Build<a id="_idIndexMarker602"/> the <code class="inlineCode">CalculatorLibUnitTests</code> project.</li>
    </ol>
    <h3 id="_idParaDest-278" class="heading-3">Running unit tests using Visual Studio</h3>
    <p class="normal">Now <a id="_idIndexMarker603"/>we are ready<a id="_idIndexMarker604"/> to run the unit tests and see the results:</p>
    <ol>
      <li class="numberedList" value="1">In Visual Studio, navigate to <strong class="screenText">Test</strong> | <strong class="screenText">Run All Tests</strong>.</li>
      <li class="numberedList">In <strong class="screenText">Test Explorer</strong>, note that the results indicate that two tests ran, one test passed, and one test failed, as shown in <em class="italic">Figure 4.16</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_04_16.png" alt="" width="812" height="304"/></figure>
    <p class="packt_figref">Figure 4.16: The unit test results in Visual Studio’s Test Explorer</p>
    <h3 id="_idParaDest-279" class="heading-3">Running unit tests using VS Code</h3>
    <p class="normal">Now we are<a id="_idIndexMarker605"/> ready to<a id="_idIndexMarker606"/> run the unit tests and see the results:</p>
    <ol>
      <li class="numberedList" value="1">If you have not recently built the test project, then build the <code class="inlineCode">CalculatorLibUnitTests</code> project to make sure that the new testing feature in the C# Dev Kit extension recognizes the unit tests that you have written.</li>
      <li class="numberedList">In VS Code, navigate to <strong class="screenText">View</strong> | <strong class="screenText">Testing</strong>, and note the <strong class="screenText">TESTING</strong> window has a mini toolbar with buttons to <strong class="screenText">Refresh Tests</strong>, <strong class="screenText">Run Tests</strong>, <strong class="screenText">Debug Tests</strong>, and so on.</li>
      <li class="numberedList">In the <strong class="screenText">TESTING</strong> window, expand the <strong class="screenText">CalculatorLibUnitTests</strong> project to show the two tests.</li>
      <li class="numberedList">Hover your mouse pointer over <strong class="screenText">CalculatorUnitTests</strong> and then click the <strong class="screenText">Run Tests</strong> button (black triangle icon) defined in that class.</li>
      <li class="numberedList">Click<a id="_idIndexMarker607"/> the <strong class="screenText">TEST RESULTS</strong> tab and note that <a id="_idIndexMarker608"/>the results indicate that two tests ran, one test passed, and one test failed, as shown in <em class="italic">Figure 4.17</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_04_17.png" alt="" width="812" height="387"/></figure>
    <p class="packt_figref">Figure 4.17: The unit test results in VS Code’s TEST RESULTS</p>
    <h3 id="_idParaDest-280" class="heading-3">Fixing the bug</h3>
    <p class="normal">Now you can fix the bug:</p>
    <ol>
      <li class="numberedList" value="1">Fix the <a id="_idIndexMarker609"/>bug in the <code class="inlineCode">Add</code> method.</li>
      <li class="numberedList">Run the unit tests again to see that the bug has now been fixed and both tests have passed.</li>
    </ol>
    <p class="normal">Now that we’ve written, debugged, logged, and unit-tested functions, let’s finish this chapter by looking at how to throw and catch exceptions in functions.</p>
    <h2 id="_idParaDest-281" class="heading-2">Specifying multiple parameter values</h2>
    <p class="normal">We created two<a id="_idIndexMarker610"/> unit test methods: the first to test adding 2 and 2, and the second to test adding 2 and 3. Instead of writing two separate methods decorated with <code class="inlineCode">[Fact]</code>, we could have written one method decorated with <code class="inlineCode">[Theory]</code> and passed different parameter values using <code class="inlineCode">[InlineData]</code>, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">using</span> CalculatorLib; <span class="hljs-comment">// To use Calculator.</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">CalculatorLibUnitTests</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CalculatorUnitTests</span>
{
  [<span class="hljs-meta">Theory</span>]
  [<span class="hljs-meta">InlineData</span>(2, 2, 4)]
  [<span class="hljs-meta">InlineData</span>(2, 3, 5)]
  <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">TestAdding</span><span class="hljs-function">(</span><span class="hljs-built_in">double</span> a, <span class="hljs-built_in">double</span> b, <span class="hljs-built_in">double</span> expected<span class="hljs-function">)</span>
  {
    <span class="hljs-comment">// Arrange: Set up the unit under test.</span>
    Calculator calc = <span class="hljs-keyword">new</span>();
    <span class="hljs-comment">// Act: Execute the function to test.</span>
    <span class="hljs-built_in">double</span> actual = calc.Add(a, b);
    <span class="hljs-comment">// Assert: Make assertions to compare expected to actual results.</span>
    Assert.Equal(expected, actual);
  }
}
</code></pre>
    <p class="normal">The order of parameters passed in the <code class="inlineCode">[InlineData]</code> attribute must match the order of parameters in the test method.</p>
    <p class="normal">Now let’s see how to throw and catch exceptions when something goes wrong.</p>
    <h1 id="_idParaDest-282" class="heading-1">Throwing and catching exceptions in functions</h1>
    <p class="normal">In <em class="chapterRef">Chapter 3</em>,<em class="chapterRef"> </em><em class="italic">Controlling Flow, Converting Types, and Handling Exceptions</em>, you were introduced to exceptions<a id="_idIndexMarker611"/> and how to use a <code class="inlineCode">try-catch</code> statement to handle them. But you should only catch and handle an exception if you have enough information to mitigate the issue. If you do not, then you should allow the exception to pass up through the call stack to a higher level.</p>
    <h2 id="_idParaDest-283" class="heading-2">Understanding usage errors and execution errors</h2>
    <p class="normal"><strong class="keyWord">Usage errors</strong> are<a id="_idIndexMarker612"/> when a programmer misuses a function, typically by passing invalid values as parameters. They could be avoided by that programmer changing their code to pass valid values. When some programmers first learn C# and .NET, they sometimes think exceptions can always be avoided because they assume all errors are usage errors. Usage errors should all be fixed before production runtime.</p>
    <p class="normal"><strong class="keyWord">Execution errors</strong> are when <a id="_idIndexMarker613"/>something happens at runtime that cannot be fixed by writing “better” code. Execution errors can be split into <strong class="keyWord">program errors</strong> and <strong class="keyWord">system errors</strong>. If you attempt to access a network resource but the<a id="_idIndexMarker614"/> network is down, you need to be able to handle that system error by logging an<a id="_idIndexMarker615"/> exception, and possibly backing off for a time and trying again. However, some system errors, such as running out of memory, simply cannot be handled. If you attempt to open a file that does not exist, you might be able to catch that error and handle it programmatically by creating a new file. Program errors can be programmatically fixed by writing smart code. System errors often cannot be fixed programmatically.</p>
    <h2 id="_idParaDest-284" class="heading-2">Commonly thrown exceptions in functions</h2>
    <p class="normal">Very rarely <a id="_idIndexMarker616"/>should you define new types of exceptions to <a id="_idIndexMarker617"/>indicate usage errors. .NET already defines many that you should use.</p>
    <p class="normal">When defining your own functions with parameters, your code should check the parameter values and throw exceptions if they have values that will prevent your function from properly functioning.</p>
    <p class="normal">For example, if a parameter to a function should not be <code class="inlineCode">null</code>, throw <code class="inlineCode">ArgumentNullException</code>. For other problems, throw <code class="inlineCode">ArgumentException</code>, <code class="inlineCode">NotSupportedException</code>, or <code class="inlineCode">InvalidOperationException</code>.</p>
    <p class="normal">For any exception, include a message that describes the problem for whoever will have to read it (typically a developer audience for class libraries and functions, or end users if it is at the highest level of a GUI app), as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Withdraw</span><span class="hljs-function">(</span><span class="hljs-built_in">string</span><span class="hljs-params"> accountName, </span><span class="hljs-built_in">decimal</span><span class="hljs-params"> amount</span><span class="hljs-function">)</span>
{
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(accountName))
  {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(paramName: <span class="hljs-keyword">nameof</span>(accountName));
  }
  <span class="hljs-keyword">if</span> (amount &lt;= <span class="hljs-number">0</span>)
  {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentOutOfRangeException(paramName: <span class="hljs-keyword">nameof</span>(amount),
      message: <span class="hljs-string">$"</span><span class="hljs-subst">{</span><span class="hljs-keyword">nameof</span><span class="hljs-subst">(amount)}</span><span class="hljs-string"> cannot be negative or zero."</span>);
  }
  <span class="hljs-comment">// process parameters</span>
}
</code></pre>
    <div class="packt_tip">
      <p class="normal"><strong class="keyWord">Good Practice</strong>: If a function cannot successfully perform its operation, you should consider it a function failure and report it by throwing an exception.</p>
    </div>
    <h2 id="_idParaDest-285" class="heading-2">Throwing exceptions using guard clauses</h2>
    <p class="normal">Instead of instantiating an exception using <code class="inlineCode">new</code>, you can use static methods on the exception itself. When used in a function implementation to check argument values, they are known <a id="_idIndexMarker618"/>as <strong class="keyWord">guard clauses</strong>. Some were introduced with .NET 6, and more were added in .NET 8.</p>
    <p class="normal">Common guard clauses are shown in <em class="italic">Table 4.2</em>:</p>
    <table id="table002-3" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Exception</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Guard clause methods</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">ArgumentException</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">ThrowIfNullOrEmpty</code>, <code class="inlineCode">ThrowIfNullOrWhiteSpace</code></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">ArgumentNullException</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">ThrowIfNull</code></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">ArgumentOutOfRangeException</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">ThrowIfEqual</code>, <code class="inlineCode">ThrowIfGreaterThan</code>, <code class="inlineCode">ThrowIfGreaterThanOrEqual</code>, <code class="inlineCode">ThrowIfLessThan</code>, <code class="inlineCode">ThrowIfLessThanOrEqual</code>, <code class="inlineCode">ThrowIfNegative</code>, <code class="inlineCode">ThrowIfNegativeOrZero</code>, <code class="inlineCode">ThrowIfNotEqual</code>, <code class="inlineCode">ThrowIfZero</code></p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 4.2: Common guard clauses</p>
    <p class="normal">Instead of <a id="_idIndexMarker619"/>writing an <code class="inlineCode">if</code> statement and<a id="_idIndexMarker620"/> then throwing a <code class="inlineCode">new</code> exception, we can simplify the previous example, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Withdraw</span><span class="hljs-function">(</span><span class="hljs-built_in">string</span><span class="hljs-params"> accountName, </span><span class="hljs-built_in">decimal</span><span class="hljs-params"> amount</span><span class="hljs-function">)</span>
{
  ArgumentException.ThrowIfNullOrWhiteSpace(accountName,
    paramName: <span class="hljs-keyword">nameof</span>(accountName));
  ArgumentOutOfRangeException.ThrowIfNegativeOrZero(amount,
    paramName: <span class="hljs-keyword">nameof</span>(amount));
  <span class="hljs-comment">// process parameters</span>
}
</code></pre>
    <div class="note">
      <p class="normal"><strong class="keyWord">More Information</strong>: To get a sense of how often Microsoft source code uses its own guard clauses, you can read the following section of an online blog article: <a href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-8/#exceptions"><span class="url">https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-8/#exceptions</span></a>. For example, <code class="inlineCode">ThrowIfNull</code> is called 4,795 times from within the <code class="inlineCode">src</code> for the core libraries in <code class="inlineCode">dotnet/runtime</code>.</p>
    </div>
    <h2 id="_idParaDest-286" class="heading-2">Understanding the call stack</h2>
    <p class="normal">The entry point for a .NET<a id="_idIndexMarker621"/> console application is the <code class="inlineCode">Main</code> method (if you have explicitly defined this class) or <code class="inlineCode">&lt;Main&gt;$</code> (if it was created for you by the top-level program feature) in the <code class="inlineCode">Program</code> class.</p>
    <p class="normal">The <code class="inlineCode">Main</code> method will call other methods, which call other methods, and so on; these methods could be in the current project or referenced projects and NuGet packages, as shown in <em class="italic">Figure 4.18</em>:</p>
    <figure class="mediaobject"><img src="../Images/B22322_04_18.png" alt="" width="825" height="144"/></figure>
    <p class="packt_figref">Figure 4.18: A chain of method calls that create a call stack</p>
    <p class="normal">Let’s create a similar chain of methods to explore where we could catch and handle exceptions:</p>
    <ol>
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Class Library</strong> / <code class="inlineCode">classlib</code> project named <code class="inlineCode">CallStackExceptionHandlingLib</code> to the <code class="inlineCode">Chapter04</code> solution.</li>
      <li class="numberedList">Rename the <code class="inlineCode">Class1.cs</code> file to <code class="inlineCode">Processor.cs</code>.</li>
      <li class="numberedList">In <code class="inlineCode">Processor.cs</code>, modify its contents, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">using</span> <span class="hljs-keyword">static</span> System.Console;
<span class="hljs-keyword">namespace</span> <span class="hljs-title">CallStackExceptionHandlingLib</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Processor</span>
{
  <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Gamma</span><span class="hljs-function">() </span><span class="hljs-comment">// public so it can be called from outside.</span>
  {
    WriteLine(<span class="hljs-string">"In Gamma"</span>);
    Delta();
  }
  <span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Delta</span><span class="hljs-function">() </span><span class="hljs-comment">// private so it can only be called internally.</span>
  {
    WriteLine(<span class="hljs-string">"In Delta"</span>);
    File.OpenText(<span class="hljs-string">"bad file path"</span>);
  }
}
</code></pre>
      </li>
      <li class="numberedList">Use your preferred code editor to add a new <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code> project named <code class="inlineCode">CallStackExceptionHandling</code> to the <code class="inlineCode">Chapter04</code> solution.</li>
      <li class="numberedList">In the <code class="inlineCode">CallStackExceptionHandling</code> console app project, add a reference to the <code class="inlineCode">CallStackExceptionHandlingLib</code> class library project, as shown in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;ProjectReference Include=<span class="hljs-string">"..\CallStackExceptionHandlingLib\</span>
<span class="hljs-string">CallStackExceptionHandlingLib.csproj"</span> /&gt;
&lt;/ItemGroup&gt;
</code></pre>
      </li>
      <li class="numberedList">Build the <code class="inlineCode">CallStackExceptionHandling</code> console app project to make sure dependent<a id="_idIndexMarker622"/> projects are compiled and copied to the local <code class="inlineCode">bin</code> folder.</li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete the existing statements, add statements to define two methods, and chain calls to them and the methods in the class library, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">using</span> CallStackExceptionHandlingLib; <span class="hljs-comment">// To use Processor.</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">static</span> System.Console;
WriteLine(<span class="hljs-string">"In Main"</span>);
Alpha();
<span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Alpha</span><span class="hljs-function">()</span>
{
  WriteLine(<span class="hljs-string">"In Alpha"</span>);
  Beta();
}
<span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Beta</span><span class="hljs-function">()</span>
{
  WriteLine(<span class="hljs-string">"In Beta"</span>);
  Processor.Gamma();
}
</code></pre>
      </li>
      <li class="numberedList">Run the<a id="_idIndexMarker623"/> console app <em class="italic">without</em> the debugger attached, and note the results, as shown in the following partial output:
        <pre class="programlisting con-one"><code class="hljs-con">In Main
In Alpha
In Beta
In Gamma
In Delta
Unhandled exception. System.IO.FileNotFoundException: Could not find file 'C:\cs13net9\Chapter04\CallStackExceptionHandling\bin\Debug\net9.0\bad file path'.
File name: 'C:\cs13net9\Chapter04\CallStackExceptionHandling\bin\Debug\net9.0\bad file path'
   at Microsoft.Win32.SafeHandles.SafeFileHandle.CreateFile(String fullPath, FileMode mode, FileAccess access, FileShare share, FileOptions options)
   at Microsoft.Win32.SafeHandles.SafeFileHandle.Open(String fullPath, FileMode mode, FileAccess access, FileShare share, FileOptions options, Int64 preallocationSize)
   at System.IO.Strategies.OSFileStreamStrategy..ctor(String path, FileMode mode, FileAccess access, FileShare share, FileOptions options, Int64 preallocationSize)
   at System.IO.Strategies.FileStreamHelpers.ChooseStrategyCore(String path, FileMode mode, FileAccess access, FileShare share, FileOptions options, Int64 preallocationSize)
   at System.IO.StreamReader.ValidateArgsAndOpenPath(String path, Encoding encoding, Int32 bufferSize)
   at System.IO.File.OpenText(String path)
   at CallStackExceptionHandlingLib.Calculator.Delta() in C:\cs13net9\Chapter04\CallStackExceptionHandlingLib\Processor.cs:line 16
   at CallStackExceptionHandlingLib.Calculator.Gamma() in C:\cs13net9\Chapter04\CallStackExceptionHandlingLib\Processor.cs:line 10
   at Program.&lt;&lt;Main&gt;$&gt;g__Beta|0_1() in C:\cs13net9\Chapter04\CallStackExceptionHandling\Program.cs:line 16
   at Program.&lt;&lt;Main&gt;$&gt;g__Alpha|0_0() in C:\cs13net9\Chapter04\CallStackExceptionHandling\Program.cs:line 10
   at Program.&lt;Main&gt;$(String[] args) in C:\cs13net9\Chapter04\CallStackExceptionHandling\Program.cs:line 5
</code></pre>
      </li>
    </ol>
    <p class="normal">Note that the<a id="_idIndexMarker624"/> call stack is upside down. Starting from the bottom, you see:</p>
    <ul>
      <li class="bulletList level-2">The first call is to the <code class="inlineCode">&lt;Main&gt;$</code> entry point function in the auto-generated <code class="inlineCode">Program</code> class. This is where arguments are passed in as a <code class="inlineCode">String</code> array.</li>
      <li class="bulletList level-2">The second call is to the <code class="inlineCode">&lt;&lt;Main&gt;$&gt;g__Alpha|0_0</code> function. (The C# compiler renames it from <code class="inlineCode">Alpha</code> when it adds it as a local function.)</li>
      <li class="bulletList level-2">The third call is to the <code class="inlineCode">Beta</code> function.</li>
      <li class="bulletList level-2">The fourth call is to the <code class="inlineCode">Gamma</code> function.</li>
      <li class="bulletList level-2">The fifth call is to the <code class="inlineCode">Delta</code> function. This function attempts to open a file by passing a bad file path. This causes an exception to be thrown. Any function with a <code class="inlineCode">try-catch</code> statement could catch this exception. If it does not, the exception is automatically passed up the call stack until it reaches the top, where .NET outputs the exception (and the details of this call stack).</li>
    </ul>
    <div class="packt_tip">
      <p class="normal"><strong class="keyWord">Good Practice</strong>: Unless you need to step through your code to debug it, you should always run your code without the debugger attached. In this case, it is especially important not to attach the debugger because, if you do, it will catch the exception and show it in a GUI dialog box instead of outputting it as shown in the book.</p>
    </div>
    <h2 id="_idParaDest-287" class="heading-2">Where to catch exceptions</h2>
    <p class="normal">Programmers can<a id="_idIndexMarker625"/> decide if they want to catch an exception near the failure point or centralized higher up the call stack. This allows your code to be simplified and standardized. You might know that calling a function could throw one or more types of exception but you do not need to handle any of them at the current point in the call stack.</p>
    <h2 id="_idParaDest-288" class="heading-2">Rethrowing exceptions</h2>
    <p class="normal">Sometimes, you want to <a id="_idIndexMarker626"/>catch an exception, log it, and then rethrow it. For example, if you are writing a low-level class library that will be called from an application, your code may not have enough information to programmatically fix the error in a smart way, but the calling application might have more information and be able to. Your code should log the error in case the calling application does not, and then rethrow it up the call stack in case the calling application chooses to handle it better.</p>
    <p class="normal">There are three ways to rethrow an exception inside a <code class="inlineCode">catch</code> block, as shown in the following list:</p>
    <ul>
      <li class="bulletList">To throw the caught exception with its original call stack, call <code class="inlineCode">throw</code>.</li>
      <li class="bulletList">To throw the caught exception as if it was thrown at the current level in the call stack, call <code class="inlineCode">throw</code> with the caught exception, for example, <code class="inlineCode">throw ex</code>. This is usually poor practice because you have lost some potentially useful information for debugging but it can be useful when you want to deliberately remove that information when it contains sensitive data.</li>
      <li class="bulletList">To wrap the caught exception in another exception that can include more information in a message that might help the caller understand the problem, throw a new exception, and pass the caught exception as the <code class="inlineCode">innerException</code> parameter.</li>
    </ul>
    <p class="normal">If an error occurs when<a id="_idIndexMarker627"/> we call the <code class="inlineCode">Gamma</code> function, then we could catch the exception and perform one of the three techniques of rethrowing an exception, as shown in the following code:</p>
    <div class="note">
      <p class="normal">This code is just illustrative. You would never use all three techniques in the same <code class="inlineCode">catch</code> block!</p>
    </div>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">try</span>
{
  Gamma();
}
<span class="hljs-keyword">catch</span> (IOException ex)
{
  LogException(ex);
  <span class="hljs-comment">// Throw the caught exception as if it happened here</span>
  <span class="hljs-comment">// this will lose the original call stack.</span>
  <span class="hljs-keyword">throw</span> ex;
  <span class="hljs-comment">// Rethrow the caught exception and retain its original call stack.</span>
  <span class="hljs-keyword">throw</span>;
  <span class="hljs-comment">// Throw a new exception with the caught exception nested within it.</span>
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(
    message: <span class="hljs-string">"Calculation had invalid values. See inner exception for why."</span>,
    innerException: ex);
}
</code></pre>
    <p class="normal">Let’s see this in action with<a id="_idIndexMarker628"/> our call stack example:</p>
    <ol>
      <li class="numberedList" value="1">In the <code class="inlineCode">CallStackExceptionHandling</code> project in <code class="inlineCode">Program.cs</code>, in the <code class="inlineCode">Beta</code> function, add a <code class="inlineCode">try-catch</code> statement around the call to the <code class="inlineCode">Gamma</code> function, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Beta</span><span class="hljs-function">()</span>
{
  WriteLine(<span class="hljs-string">"In Beta"</span>);
  <span class="code-highlight"><strong class="hljs-keyword-slc">try</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  {</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    Processor.Gamma();</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  }</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  </strong><strong class="hljs-keyword-slc">catch</strong><strong class="hljs-slc"> (Exception ex)</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  {</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    WriteLine(</strong><strong class="hljs-string-slc">$"Caught this: </strong><strong class="hljs-subst-slc">{ex.Message}</strong><strong class="hljs-string-slc">"</strong><strong class="hljs-slc">);</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    </strong><strong class="hljs-keyword-slc">throw</strong><strong class="hljs-slc"> ex;</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  }</strong></span>
}
</code></pre>
      </li>
    </ol>
    <div class="note-one">
      <p class="normal">Note your code editor will show a squiggle under the <code class="inlineCode">throw ex</code> to warn you that you will lose call stack information, as described in the code analyzer message <code class="inlineCode">Re-throwing caught exception changes stack information</code>; more details can be found at the following link: <a href="https://learn.microsoft.com/en-us/dotnet/fundamentals/code-analysis/quality-rules/ca2200"><span class="url">https://learn.microsoft.com/en-us/dotnet/fundamentals/code-analysis/quality-rules/ca2200</span></a>.</p>
    </div>
    <ol>
      <li class="numberedList" value="2">Run the console app and note that the output excludes some details of the call stack, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Caught this: Could not find file 'C:\cs13net9\Chapter04\CallStackExceptionHandling\bin\Debug\net9.0\bad file path'.
Unhandled exception. System.IO.FileNotFoundException: Could not find file 'C:\cs13net9\Chapter04\CallStackExceptionHandling\bin\Debug\net9.0\bad file path'.
File name: 'C:\cs13net9\Chapter04\CallStackExceptionHandling\bin\Debug\net9.0\bad file path'
   at Program.&lt;&lt;Main&gt;$&gt;g__Beta|0_1() in C:\cs13net9\Chapter04\CallStackExceptionHandling\Program.cs:line 23
   at Program.&lt;&lt;Main&gt;$&gt;g__Alpha|0_0() in C:\cs13net9\Chapter04\CallStackExceptionHandling\Program.cs:line 10
   at Program.&lt;Main&gt;$(String[] args) in C:\cs13net9\Chapter04\CallStackExceptionHandling\Program.cs:line 5
</code></pre>
      </li>
      <li class="numberedList">Remove the <code class="inlineCode">ex</code> by replacing the statement <code class="inlineCode">throw ex;</code> with <code class="inlineCode">throw;</code>.</li>
      <li class="numberedList">Run the <a id="_idIndexMarker629"/>console app and note that the output includes all the details of the call stack.</li>
    </ol>
    <h2 id="_idParaDest-289" class="heading-2">Implementing the tester-doer and try patterns</h2>
    <p class="normal">The <strong class="keyWord">tester-doer pattern</strong> can avoid<a id="_idIndexMarker630"/> some thrown exceptions (but not eliminate them completely). This pattern uses pairs of functions: one to perform a test and the other to perform an action that would fail if the test was not passed.</p>
    <p class="normal">.NET implements this pattern itself. For example, before adding an item to a collection by calling the <code class="inlineCode">Add</code> method, you can test to see if it is read-only, which would cause <code class="inlineCode">Add</code> to fail and, therefore, throw an exception.</p>
    <p class="normal">For example, before withdrawing money from a bank account, you might test that the account is not overdrawn, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">if</span> (!bankAccount.IsOverdrawn())
{
  bankAccount.Withdraw(amount);
}
</code></pre>
    <p class="normal">The tester-doer pattern can <a id="_idIndexMarker631"/>add performance overhead, so you can also <a id="_idIndexMarker632"/>implement the <strong class="keyWord">try pattern</strong>, which, in effect, combines the test and do parts into a single function, as we saw with <code class="inlineCode">TryParse</code>.</p>
    <p class="normal">Another problem with the tester-doer pattern occurs when you are using multiple threads. In this scenario, one thread calls the test function, and it returns a value that indicates that it is okay to proceed. But then another thread executes, which changes the state. Then the original thread continues executing, assuming that everything is fine, but it is not fine. This is called a <em class="italic">race condition</em>. This topic is too advanced to cover how to handle it in this book.</p>
    <div class="packt_tip">
      <p class="normal"><strong class="keyWord">Good Practice</strong>: Use the try pattern in preference to the tester-doer pattern.</p>
    </div>
    <p class="normal">If you implement your own try pattern function and it fails, remember to set the <code class="inlineCode">out</code> parameter to the default value of its type and then return <code class="inlineCode">false</code>, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-built_in">bool</span><span class="hljs-function"> </span><span class="hljs-title">TryParse</span><span class="hljs-function">(</span><span class="hljs-built_in">string</span><span class="hljs-params">? input, </span><span class="hljs-keyword">out</span><span class="hljs-params"> Person </span><span class="hljs-keyword">value</span><span class="hljs-function">)</span>
{
  <span class="hljs-keyword">if</span> (someFailure)
  {
    <span class="hljs-keyword">value</span> = <span class="hljs-literal">default</span>(Person);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
  <span class="hljs-comment">// Successfully parsed the string into a Person.</span>
  <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Person() { ... };
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
    <div class="note">
      <p class="normal"><strong class="keyWord">More Information</strong>: Now that you’ve been introduced to the basics of exceptions, you can learn more about the details by reading the official documentation at the following<a id="_idIndexMarker633"/> link: <a href="https://learn.microsoft.com/en-us/dotnet/standard/exceptions/"><span class="url">https://learn.microsoft.com/en-us/dotnet/standard/exceptions/</span></a>.</p>
    </div>
    <h1 id="_idParaDest-290" class="heading-1">Practicing and exploring</h1>
    <p class="normal">Test your knowledge and understanding by answering some questions, getting some hands-on practice, and exploring, with deeper research, the topics covered in this chapter.</p>
    <h2 id="_idParaDest-291" class="heading-2">Exercise 4.1 – online material</h2>
    <p class="normal">Online material can be extra content written by me for this book, or it can be references to content created by Microsoft or third parties.</p>
    <h3 id="_idParaDest-292" class="heading-3">Logging during development and runtime</h3>
    <p class="normal">You should add code throughout your application to log what is happening, especially when exceptions occur, so that you can review the logs and use them to trace the issue and fix the problem. In an online-only section, you will learn how to implement basic logging; this is found at the following link:</p>
    <p class="normal"><a href="https://github.com/markjprice/cs13net9/blob/main/docs/ch04-logging.md"><span class="url">https://github.com/markjprice/cs13net9/blob/main/docs/ch04-logging.md</span></a></p>
    <h2 id="_idParaDest-293" class="heading-2">Exercise 4.2 – practice exercises</h2>
    <p class="normal">Practice exercises go deeper into the topics for this chapter.</p>
    <h3 id="_idParaDest-294" class="heading-3">Writing functions with debugging and unit testing</h3>
    <p class="normal">Prime factors are a combination of the smallest prime numbers that, when multiplied together, will produce the original number. Consider the following examples:</p>
    <ul>
      <li class="bulletList">Prime factors of 4 are 2 x 2</li>
      <li class="bulletList">Prime factor of 7 is 7</li>
      <li class="bulletList">Prime factors of 30 are 5 x 3 x 2</li>
      <li class="bulletList">Prime factors of 40 are 5 x 2 x 2 x 2</li>
      <li class="bulletList">Prime factors of 50 are 5 x 5 x 2</li>
    </ul>
    <p class="normal">Create three projects:</p>
    <ul>
      <li class="bulletList">A class library named <code class="inlineCode">Exercise_PrimeFactorsLib</code> with a static class and static method named <code class="inlineCode">PrimeFactors</code>, which, when passed an <code class="inlineCode">int</code> variable as a parameter, returns a <code class="inlineCode">string</code> showing its prime factors</li>
      <li class="bulletList">A unit test project named <code class="inlineCode">Exercise_PrimeFactorsTests</code> with a few suitable unit tests</li>
      <li class="bulletList">A console application to use it, named <code class="inlineCode">Exercise_PrimeFactorsApp</code></li>
    </ul>
    <p class="normal">To keep it simple, you can assume that the largest number entered will be 1,000.</p>
    <p class="normal">Use the debugging tools and write unit tests to ensure that your function works correctly with multiple inputs and returns the correct output.</p>
    <h2 id="_idParaDest-295" class="heading-2">Exercise 4.3 – test your knowledge</h2>
    <p class="normal">Answer the following questions. If you get stuck, try googling the answers, if necessary, while remembering that if you get totally stuck, the answers are in the <em class="italic">Appendix</em>:</p>
    <ol>
      <li class="numberedList" value="1">What does the C# keyword <code class="inlineCode">void</code> mean?</li>
      <li class="numberedList">What are some differences between imperative and functional programming styles?</li>
      <li class="numberedList">In VS Code or Visual Studio, what is the difference between pressing <em class="keystroke">F5</em>, <em class="keystroke">Ctrl </em>or <em class="keystroke">Cmd</em> + <em class="keystroke">F5</em>, <em class="keystroke">Shift</em> + <em class="keystroke">F5</em>, and <em class="keystroke">Ctrl</em> or <em class="keystroke">Cmd</em> + <em class="keystroke">Shift</em> + <em class="keystroke">F5</em>?</li>
      <li class="numberedList">Where does the <code class="inlineCode">Trace.WriteLine</code> method write its output to?</li>
      <li class="numberedList">What are the five trace levels?</li>
      <li class="numberedList">What is the difference between the <code class="inlineCode">Debug</code> and <code class="inlineCode">Trace</code> classes?</li>
      <li class="numberedList">When writing a unit test, what are the three “A”s?</li>
      <li class="numberedList">When writing a unit test using xUnit, which attribute must you decorate the test methods with?</li>
      <li class="numberedList">What <code class="inlineCode">dotnet</code> command executes xUnit tests?</li>
      <li class="numberedList">What statement should you use to rethrow a caught exception named <code class="inlineCode">ex</code> without losing the stack trace?</li>
    </ol>
    <h2 id="_idParaDest-296" class="heading-2">Exercise 4.4 – explore topics</h2>
    <p class="normal">Use the links on the following page to learn more about the topics covered in this chapter:</p>
    <p class="normal"><a href="https://github.com/markjprice/cs13net9/blob/main/docs/book-links.md#chapter-4---writing-debugging-and-testing-functions"><span class="url">https://github.com/markjprice/cs13net9/blob/main/docs/book-links.md#chapter-4---writing-debugging-and-testing-functions</span></a></p>
    <h1 id="_idParaDest-297" class="heading-1">Summary</h1>
    <p class="normal">In this chapter, you learned:</p>
    <ul>
      <li class="bulletList">How to write reusable functions with input parameters and return values, in both an imperative and functional style</li>
      <li class="bulletList">How to use the Visual Studio and VS Code debugging and diagnostic features like logging and unit tests to identify and fix any bugs in them</li>
      <li class="bulletList">How to throw and catch exceptions in functions and understand the call stack</li>
    </ul>
    <p class="normal">In the next chapter, you will learn how to build your own types using object-oriented programming techniques.</p>
  </div>
  <div id="_idContainer278" class="Basic-Text-Frame">
    <h1 class="heading-1">Learn more on Discord</h1>
    <p class="normal">To join the Discord community for this book – where you can share feedback, ask questions to the author, and learn about new releases – follow the QR code below:</p>
    <p class="normal"><a href="https://packt.link/csharp13dotnet9"><span class="url">https://packt.link/csharp13dotnet9</span></a></p>
    <p class="normal"><img src="../Images/QR_Code281224304227278796.png" alt="" width="177" height="177"/></p>
    <h1 class="heading-1">Leave a Review!</h1>
    <p class="normal">Thank you for purchasing this book from Packt Publishing—we hope you enjoy it! Your feedback is invaluable and helps us improve and grow. Once you’ve completed reading it, please take a moment to leave an Amazon review; it will only take a minute, but it makes a big difference for readers like you.</p>
    <p class="normal">Scan the QR or visit the link to receive a free ebook of your choice.</p>
    <p class="normal"><a href="https://packt.link/NzOWQ"><span class="url">https://packt.link/NzOWQ</span></a></p>
    <p class="normal"><img src="../Images/review1.png" alt="A qr code with black squares  Description automatically generated" width="150" height="150"/></p>
  </div>
</div></div></body></html>