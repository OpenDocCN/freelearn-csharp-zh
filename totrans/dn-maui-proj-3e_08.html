<html><head></head><body>
<div id="_idContainer146">
<h1 class="chapter-number" id="_idParaDest-133"><a id="_idTextAnchor708"/><span class="koboSpan" id="kobo.1.1">8</span></h1>
<h1 id="_idParaDest-134"><a id="_idTextAnchor709"/><span class="koboSpan" id="kobo.2.1">Building a Weather App for Multiple Form Factors</span></h1>
<p><span class="koboSpan" id="kobo.3.1">.NET MAUI isn’t just for creating apps for phones; it can also be used to create apps for tablets and desktop computers. </span><span class="koboSpan" id="kobo.3.2">In this chapter, we will build an app that will work on all of these platforms and optimize the user interface for each form factor. </span><span class="koboSpan" id="kobo.3.3">As well as using three different form factors, we are also going to be working on four different operating systems: iOS, macOS, Android, </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">and Windows.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">The following topics will be covered in </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">this chapter:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.7.1">Using </span><strong class="source-inline"><span class="koboSpan" id="kobo.8.1">FlexLayout</span></strong><span class="koboSpan" id="kobo.9.1"> in .</span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">NET MAUI</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.11.1">Using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.12.1">VisualStateManager</span></strong></span></li>
<li><span class="koboSpan" id="kobo.13.1">Using different views for different </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">form factors</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.15.1">Using behaviors</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.16.1">Let’s </span><span class="No-Break"><span class="koboSpan" id="kobo.17.1">get started!</span></span></p>
<h1 id="_idParaDest-135"><a id="_idTextAnchor710"/><span class="koboSpan" id="kobo.18.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.19.1">To work on this project, we need to have Visual Studio for Mac or PC installed, as well as the necessary .NET MAUI components. </span><span class="koboSpan" id="kobo.19.2">See </span><a id="_idTextAnchor711"/><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.20.1">Chapter 1</span></em></span><span class="koboSpan" id="kobo.21.1">, </span><em class="italic"><span class="koboSpan" id="kobo.22.1">Introduction to .NET MAUI</span></em><span class="koboSpan" id="kobo.23.1">, for more details on how to set up your environment. </span><span class="koboSpan" id="kobo.23.2">To build an iOS app using Visual Studio for PC, you need to have a Mac connected. </span><span class="koboSpan" id="kobo.23.3">If you don’t have access to a Mac at all, you can choose to just work on the Windows and Android parts of this project. </span><span class="koboSpan" id="kobo.23.4">Similarly, if you only have a Mac, you can choose to work on only the iOS and Android parts of </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1">this project.</span></span></p>
<p><span class="koboSpan" id="kobo.25.1">You can find the full source for the code in this chapter </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">at </span><a id="_idTextAnchor712"/></span><a href="https://github.com/PacktPubliching/MAUI-Projects-3rd-Edition"><span class="No-Break"><span class="koboSpan" id="kobo.27.1">https://github.com/PacktPubliching/MAUI-Projects-3rd-Edition</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.28.1">.</span></span></p>
<h1 id="_idParaDest-136"><a id="_idTextAnchor713"/><a id="_idTextAnchor714"/><span class="koboSpan" id="kobo.29.1">Project overview</span></h1>
<p><span class="koboSpan" id="kobo.30.1">Applications for iOS and Android can run on both phones and tablets. </span><span class="koboSpan" id="kobo.30.2">Often, apps are just optimized </span><a id="_idIndexMarker786"/><span class="koboSpan" id="kobo.31.1">for phones. </span><span class="koboSpan" id="kobo.31.2">In this chapter, we will build an app that will work on different form factors, but we aren’t going to stick to just phones and tablets – we are going to target desktop computers as well. </span><span class="koboSpan" id="kobo.31.3">The desktop version will be for </span><strong class="bold"><span class="koboSpan" id="kobo.32.1">Window UI Library</span></strong><span class="koboSpan" id="kobo.33.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.34.1">WinUI</span></strong><span class="koboSpan" id="kobo.35.1">) and macOS via </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">Mac Catalyst.</span></span></p>
<p><span class="koboSpan" id="kobo.37.1">The app that we are going to build is a weather app that displays the weather forecast</span><a id="_idTextAnchor715"/><span class="koboSpan" id="kobo.38.1"> based on the location of the user. </span><span class="koboSpan" id="kobo.38.2">For this chapter, we will be referencing Visual Studio for Mac in the instructions. </span><span class="koboSpan" id="kobo.38.3">If you are using Visual Studio for Windows, you should be able to follow along. </span><span class="koboSpan" id="kobo.38.4">Use one of the other chapters for reference if you </span><span class="No-Break"><span class="koboSpan" id="kobo.39.1">need help.</span></span><a id="_idTextAnchor716"/></p>
<h1 id="_idParaDest-137"><a id="_idTextAnchor717"/><span class="koboSpan" id="kobo.40.1">Building the weather app</span></h1>
<p><span class="koboSpan" id="kobo.41.1">It’s time to </span><a id="_idIndexMarker787"/><span class="koboSpan" id="kobo.42.1">start building the app. </span><span class="koboSpan" id="kobo.42.2">Create a new blank .NET MAUI ap</span><a id="_idTextAnchor718"/><span class="koboSpan" id="kobo.43.1">p using the following steps for Visual Studio </span><span class="No-Break"><span class="koboSpan" id="kobo.44.1">for Mac</span><a id="_idTextAnchor719"/><span class="koboSpan" id="kobo.45.1">:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.46.1">Open Visual Studio for Mac and click </span><span class="No-Break"><span class="koboSpan" id="kobo.47.1">on </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.48.1">New</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.49.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer135">
<span class="koboSpan" id="kobo.50.1"><img alt="Figure 8.1 – Visual Studio 2022 for Mac start screen" src="image/B19214_08_1.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.51.1">Figure 8.1 – Visual Studio 2022 for Mac start screen</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.52.1">In the </span><strong class="bold"><span class="koboSpan" id="kobo.53.1">Choose </span></strong><strong class="bold"><a id="_idIndexMarker788"/></strong><strong class="bold"><span class="koboSpan" id="kobo.54.1">a template for your new project</span></strong><span class="koboSpan" id="kobo.55.1"> dialog, use the</span><strong class="bold"><span class="koboSpan" id="kobo.56.1"> .NET MAUI App</span></strong><span class="koboSpan" id="kobo.57.1"> template, which is under</span><strong class="bold"><span class="koboSpan" id="kobo.58.1"> Multiplatform | App</span></strong><span class="koboSpan" id="kobo.59.1">, then </span><span class="No-Break"><span class="koboSpan" id="kobo.60.1">click </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.61.1">Continue</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.62.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer136">
<span class="koboSpan" id="kobo.63.1"><img alt="Figure 8.2 – New project " src="image/B19214_08_2.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.64.1">Figure 8.2 – New project </span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.65.1">In the </span><strong class="bold"><span class="koboSpan" id="kobo.66.1">Configure </span></strong><strong class="bold"><a id="_idIndexMarker789"/></strong><strong class="bold"><span class="koboSpan" id="kobo.67.1">your new .NET MAUI App</span></strong><span class="koboSpan" id="kobo.68.1"> dialog, ensure the </span><strong class="bold"><span class="koboSpan" id="kobo.69.1">.NET 7.0</span></strong><span class="koboSpan" id="kobo.70.1"> target framework is selected, then </span><span class="No-Break"><span class="koboSpan" id="kobo.71.1">click </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.72.1">Continue</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.73.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer137">
<span class="koboSpan" id="kobo.74.1"><img alt="Figure 8.3 – Choosing the target framework" src="image/B19214_08_3.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.75.1">Figure 8.3 – Choosing the target framework</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.76.1">In the </span><strong class="bold"><span class="koboSpan" id="kobo.77.1">Configure </span></strong><strong class="bold"><a id="_idIndexMarker790"/></strong><strong class="bold"><span class="koboSpan" id="kobo.78.1">your new .NET MAUI App</span></strong><span class="koboSpan" id="kobo.79.1"> dialog, name the project </span><strong class="source-inline"><span class="koboSpan" id="kobo.80.1">Weather</span></strong><span class="koboSpan" id="kobo.81.1">, then </span><span class="No-Break"><span class="koboSpan" id="kobo.82.1">click </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.83.1">Create</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.84.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer138">
<span class="koboSpan" id="kobo.85.1"><img alt="Figure 8.4 – Naming the new app" src="image/B19214_08_4.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.86.1">Figure 8.4 – Naming the new app</span></p>
<p><span class="koboSpan" id="kobo.87.1">If you run </span><a id="_idIndexMarker791"/><span class="koboSpan" id="kobo.88.1">the app now, you should see something like </span><span class="No-Break"><span class="koboSpan" id="kobo.89.1">the following:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer139">
<span class="koboSpan" id="kobo.90.1"><img alt="Figure 8.5 – Weather app on macOS" src="image/B19214_08_5.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.91.1">Figure 8.5 – Weather app on macOS</span></p>
<p><span class="koboSpan" id="kobo.92.1">Now that we </span><a id="_idIndexMarker792"/><span class="koboSpan" id="kobo.93.1">have created the project from a template, it’s time to </span><span class="No-Break"><span class="koboSpan" id="kobo.94.1">start coding</span><a id="_idTextAnchor720"/><span class="koboSpan" id="kobo.95.1">!</span></span></p>
<h2 id="_idParaDest-138"><a id="_idTextAnchor721"/><span class="koboSpan" id="kobo.96.1">Creating models for the weather data</span></h2>
<p><span class="koboSpan" id="kobo.97.1">Before we write the code to fetch data from the external weather service, we will create models to </span><a id="_idIndexMarker793"/><span class="koboSpan" id="kobo.98.1">deserialize the results from the service. </span><span class="koboSpan" id="kobo.98.2">We will do this so that we have a common model that we can use to return data from </span><span class="No-Break"><span class="koboSpan" id="kobo.99.1">the service.</span></span></p>
<p><span class="koboSpan" id="kobo.100.1">As the data source for this app, we will use an external Weather API. </span><span class="koboSpan" id="kobo.100.2">This project will use </span><strong class="bold"><span class="koboSpan" id="kobo.101.1">OpenWeatherMap</span></strong><span class="koboSpan" id="kobo.102.1">, a service </span><a id="_idIndexMarker794"/><span class="koboSpan" id="kobo.103.1">that offers a couple of free APIs. </span><span class="koboSpan" id="kobo.103.2">You can find this service at </span><a href="https://openweathermap.org/api"><span class="koboSpan" id="kobo.104.1">https://openweathermap.org/api</span></a><span class="koboSpan" id="kobo.105.1">. </span><span class="koboSpan" id="kobo.105.2">We will use the </span><strong class="bold"><span class="koboSpan" id="kobo.106.1">5 day / 3 hour forecast</span></strong><span class="koboSpan" id="kobo.107.1"> service in this project, which provides a 5-day forecast in 3-hour intervals. </span><span class="koboSpan" id="kobo.107.2">To use the OpenWeatherMap API, we have to create an account to get an API key. </span><span class="koboSpan" id="kobo.107.3">If you don’t want</span><a id="_idTextAnchor722"/><span class="koboSpan" id="kobo.108.1"> to create an API key, you can mock the </span><span class="No-Break"><span class="koboSpan" id="kobo.109.1">data instead.</span></span></p>
<p><span class="koboSpan" id="kobo.110.1">Follow the instructions at </span><a href="https://home.openweathermap.org/users/sign_up"><span class="koboSpan" id="kobo.111.1">https://home.openweathermap.org/users/sign_up</span></a><span class="koboSpan" id="kobo.112.1"> to create your account and get your API key, which you will need to call </span><span class="No-Break"><span class="koboSpan" id="kobo.113.1">the API.</span></span></p>
<p><span class="koboSpan" id="kobo.114.1">The easiest </span><a id="_idIndexMarker795"/><span class="koboSpan" id="kobo.115.1">way to generate models to use when we are deserializing results from the service is to make a call to the service either in the browser or with </span><a id="_idIndexMarker796"/><span class="koboSpan" id="kobo.116.1">a tool (such as </span><strong class="bold"><span class="koboSpan" id="kobo.117.1">Postman</span></strong><span class="koboSpan" id="kobo.118.1">) to see the structure of the JSON. </span><span class="koboSpan" id="kobo.118.2">For OpenWeather’s 5-day/3-hour forecast, you can use </span><strong class="source-inline"><span class="koboSpan" id="kobo.119.1">https://api.openweathermap.org/data/2.5/forecast?lat=44.34&amp;lon=10.99&amp;appid={API key}</span></strong><span class="koboSpan" id="kobo.120.1"> in your browser, replacing </span><strong class="source-inline"><span class="koboSpan" id="kobo.121.1">{API KEY}</span></strong><span class="koboSpan" id="kobo.122.1"> with your </span><span class="No-Break"><span class="koboSpan" id="kobo.123.1">API key.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.124.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.125.1">If you got a 401 error, please wait a couple of hours before you can use your API, as mentioned </span><span class="No-Break"><span class="koboSpan" id="kobo.126.1">at </span></span><a href="https://openweathermap.org/faq#error401"><span class="No-Break"><span class="koboSpan" id="kobo.127.1">https://openweathermap.org/faq#error401</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.128.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.129.1">We can create classes manually or use a tool that can generate C# classes from the JSON. </span><span class="koboSpan" id="kobo.129.2">One tool that </span><a id="_idIndexMarker797"/><span class="koboSpan" id="kobo.130.1">can be used is </span><strong class="bold"><span class="koboSpan" id="kobo.131.1">quicktype</span></strong><span class="koboSpan" id="kobo.132.1">, which can be found at </span><a href="https://quicktype.io/"><span class="koboSpan" id="kobo.133.1">https://quicktype.io/</span></a><span class="koboSpan" id="kobo.134.1">. </span><span class="koboSpan" id="kobo.134.2">Just paste the output from the API call into quicktype to generate your </span><span class="No-Break"><span class="koboSpan" id="kobo.135.1">C# models.</span></span></p>
<p><span class="koboSpan" id="kobo.136.1">If you generate them using a tool, make sure you set the namespace </span><span class="No-Break"><span class="koboSpan" id="kobo.137.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.138.1">Weather.Models</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.139.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.140.1">As mentioned previously, you can also create these models manually. </span><span class="koboSpan" id="kobo.140.2">We will describe how to do this in the </span><span class="No-Break"><span class="koboSpan" id="kobo.141.1">next se</span><a id="_idTextAnchor723"/><a id="_idTextAnchor724"/><a id="_idTextAnchor725"/><a id="_idTextAnchor726"/><span class="koboSpan" id="kobo.142.1">ction.</span></span></p>
<h3><span class="koboSpan" id="kobo.143.1">Adding the Weather API models manually</span></h3>
<p><span class="koboSpan" id="kobo.144.1">If you wish to add the models manually, then go through the following instructions. </span><span class="koboSpan" id="kobo.144.2">We will be </span><a id="_idIndexMarker798"/><span class="koboSpan" id="kobo.145.1">adding a single code file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.146.1">WeatherData.cs</span></strong><span class="koboSpan" id="kobo.147.1">, which will contain </span><span class="No-Break"><span class="koboSpan" id="kobo.148.1">multiple classes:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.149.1">Create a folder </span><span class="No-Break"><span class="koboSpan" id="kobo.150.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.151.1">Models</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.152.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.153.1">Add a file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.154.1">WeatherData.cs</span></strong><span class="koboSpan" id="kobo.155.1"> to the newly </span><span class="No-Break"><span class="koboSpan" id="kobo.156.1">created folder.</span></span></li>
<li><span class="koboSpan" id="kobo.157.1">Add the </span><a id="_idIndexMarker799"/><span class="koboSpan" id="kobo.158.1">following code to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.159.1">WeatherData.</span><a id="_idTextAnchor727"/><span class="koboSpan" id="kobo.160.1">cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.161.1"> file:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.162.1">
using System.Collections.Generic;
namespace Weather.Models
{
    public class Main
    {
        public double temp { get; set; }
        public double temp_min { get; set; }
        public double temp_max { get; set; }
        public double pressure { get; set; }
        public double sea_level { get; set; }
        public double grnd_level { get; set; }
        public int humidity { get; set; }
        public double temp_kf { get; set; }
    }
    public class Weather
    {
        public int id { get; set; }
        public string main { get; set; }
        public string description { get; set; }
        public string icon { get; set; }
    }
    public class Clouds
    {
        public int all { get; set; }
    }
    public class Wind
    {
        public double speed { get; set; }
        public double deg { get; set; }
    }
    public class Rain
    {
    }
    public class Sys
    {
        public string pod { get; set; }
    }
    public class List
    {
        public long dt { get; set; }
        public Main main { get; set; }
        public List&lt;Weather&gt; weather { get; set; }
        public Clouds clouds { get; set; }
        public Wind wind { get; set; }
        public Rain rain { get; set; }
        public Sys sys { get; set; }
        public string dt_txt { get; set; }
    }
    public class Coord
    {
        public double lat { get; set; }
        public double lon { get; set; }
    }
    public class City
    {
        public int id { get; set; }
        public string name { get; set; }
        public Coord coord { get; set; }
        public string country { get; set; }
    }
    public class WeatherData
    {
        public string cod { get; set; }
        public double message { get; set; }
        public int cnt { get; set; }
        public List&lt;List&gt; list { get; set; }
        public City city { get; set; }
    }
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.163.1">As you </span><a id="_idIndexMarker800"/><span class="koboSpan" id="kobo.164.1">can see, there are quite a lot of classes. </span><span class="koboSpan" id="kobo.164.2">These classes map directly to the respon</span><a id="_idTextAnchor728"/><span class="koboSpan" id="kobo.165.1">se we get from the service. </span><span class="koboSpan" id="kobo.165.2">In most cases, you only want to use these classes when communicating with the service. </span><span class="koboSpan" id="kobo.165.3">To represent the data in your app, you will need to use a second set of classes that exposes only the information you need in </span><a id="_idTextAnchor729"/><a id="_idTextAnchor730"/><a id="_idTextAnchor731"/><span class="No-Break"><span class="koboSpan" id="kobo.166.1">your app.</span></span></p>
<h3><span class="koboSpan" id="kobo.167.1">Adding the app-specific models</span></h3>
<p><span class="koboSpan" id="kobo.168.1">In this section, we will create the models that our app will translate the Weather API models </span><a id="_idIndexMarker801"/><span class="koboSpan" id="kobo.169.1">into. </span><span class="koboSpan" id="kobo.169.2">Let’s start by adding the </span><strong class="source-inline"><span class="koboSpan" id="kobo.170.1">WeatherData</span></strong><span class="koboSpan" id="kobo.171.1"> class (unless you created this manually in the </span><span class="No-Break"><span class="koboSpan" id="kobo.172.1">preceding section):</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.173.1">Create a new folder called </span><strong class="source-inline"><span class="koboSpan" id="kobo.174.1">Models</span></strong><span class="koboSpan" id="kobo.175.1"> in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.176.1">Weather</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.177.1"> project.</span></span></li>
<li><span class="koboSpan" id="kobo.178.1">Add a new file </span><span class="No-Break"><span class="koboSpan" id="kobo.179.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.180.1">WeatherData.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.181.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.182.1">Paste the generated code from quicktype or write the code for the classes based on the JSON. </span><span class="koboSpan" id="kobo.182.2">If code other than the properties is generated, ignore it and just use </span><span class="No-Break"><span class="koboSpan" id="kobo.183.1">the properties.</span></span></li>
<li><span class="koboSpan" id="kobo.184.1">Rename </span><strong class="source-inline"><span class="koboSpan" id="kobo.185.1">MainClass</span></strong><span class="koboSpan" id="kobo.186.1"> (this is what </span><strong class="bold"><span class="koboSpan" id="kobo.187.1">quicktype</span></strong><span class="koboSpan" id="kobo.188.1"> names the root </span><span class="No-Break"><span class="koboSpan" id="kobo.189.1">object) </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.190.1">WeatherData</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.191.1">.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.192.1">Now, we will create models based on the data we are interested in. </span><span class="koboSpan" id="kobo.192.2">This will mak</span><a id="_idTextAnchor732"/><span class="koboSpan" id="kobo.193.1">e the rest of the code more loosely coupled to the </span><span class="No-Break"><span class="koboSpan" id="kobo.194.1">da</span><a id="_idTextAnchor733"/><a id="_idTextAnchor734"/><span class="koboSpan" id="kobo.195.1">ta source.</span></span></p>
<h3><span class="koboSpan" id="kobo.196.1">Adding the ForecastItem model</span></h3>
<p><span class="koboSpan" id="kobo.197.1">The first </span><a id="_idIndexMarker802"/><span class="koboSpan" id="kobo.198.1">model we are going to add is </span><strong class="source-inline"><span class="koboSpan" id="kobo.199.1">ForecastItem</span></strong><span class="koboSpan" id="kobo.200.1">, which represents a specific forecast for a point in time. </span><span class="koboSpan" id="kobo.200.2">We can do this </span><span class="No-Break"><span class="koboSpan" id="kobo.201.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.202.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.203.1">Weather</span></strong><span class="koboSpan" id="kobo.204.1"> project and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.205.1">Models</span></strong><span class="koboSpan" id="kobo.206.1"> folder, create a new class </span><span class="No-Break"><span class="koboSpan" id="kobo.207.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.208.1">ForecastItem</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.209.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.210.1">Add the </span><span class="No-Break"><span class="koboSpan" id="kobo.211.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.212.1">
using System;
using System.Collections.Generic;
namespace Weather.Models
{
    public class ForecastItem
    {
        public DateTime DateTime { get; set; }
        public string TimeAsString =&gt; DateTime.ToShortTimeString();
        public double Temperature { get; set; }
        public double WindSpeed { get; set; }
        public string Description { get; set; }
        public string Icon { get; set; }
    }
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.213.1">Now that </span><a id="_idIndexMarker803"/><span class="koboSpan" id="kobo.214.1">we have a model for each forecast, we need a container model that will group </span><strong class="source-inline"><span class="koboSpan" id="kobo.215.1">ForecastIt</span><a id="_idTextAnchor735"/><a id="_idTextAnchor736"/><span class="koboSpan" id="kobo.216.1">ems</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.217.1">by </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.218.1">City</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.219.1">.</span></span></p>
<h3><span class="koboSpan" id="kobo.220.1">Adding the Forecast model</span></h3>
<p><span class="koboSpan" id="kobo.221.1">In this section, we’ll create a model called </span><strong class="source-inline"><span class="koboSpan" id="kobo.222.1">Forecast</span></strong><span class="koboSpan" id="kobo.223.1"> that will keep track of a single forecast </span><a id="_idIndexMarker804"/><span class="koboSpan" id="kobo.224.1">for a city. </span><span class="koboSpan" id="kobo.224.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.225.1">Forecast</span></strong><span class="koboSpan" id="kobo.226.1"> model keeps a list of multiple </span><strong class="source-inline"><span class="koboSpan" id="kobo.227.1">ForeCastItem</span></strong><span class="koboSpan" id="kobo.228.1"> objects, each representing a forecast for a specific point in time. </span><span class="koboSpan" id="kobo.228.2">Let’s set </span><span class="No-Break"><span class="koboSpan" id="kobo.229.1">this up:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.230.1">Create a new class called </span><strong class="source-inline"><span class="koboSpan" id="kobo.231.1">Forecast</span></strong><span class="koboSpan" id="kobo.232.1"> in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.233.1">Models</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.234.1"> folder.</span></span></li>
<li><span class="koboSpan" id="kobo.235.1">Add the </span><span class="No-Break"><span class="koboSpan" id="kobo.236.1">fo</span><a id="_idTextAnchor737"/><span class="koboSpan" id="kobo.237.1">llowing code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.238.1">
using System;
using System.Collections.Generic;
namespace Weather.Models;
public class Forecast
{
    public string City { get; set; }
    public List&lt;ForecastItem&gt; Items { get; set; }
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.239.1">Now that </span><a id="_idIndexMarker805"/><span class="koboSpan" id="kobo.240.1">we have our models for both the Weather API and the app, we need</span><a id="_idTextAnchor738"/><span class="koboSpan" id="kobo.241.1"> to fetch data from th</span><a id="_idTextAnchor739"/><a id="_idTextAnchor740"/><span class="koboSpan" id="kobo.242.1">e </span><span class="No-Break"><span class="koboSpan" id="kobo.243.1">Weather API.</span></span></p>
<h2 id="_idParaDest-139"><a id="_idTextAnchor741"/><span class="koboSpan" id="kobo.244.1">Creating a service to fetch the weather data</span></h2>
<p><span class="koboSpan" id="kobo.245.1">To make </span><a id="_idIndexMarker806"/><span class="koboSpan" id="kobo.246.1">it easier to change the external weather service and to make the code more testable, we will create an interface for the service. </span><span class="koboSpan" id="kobo.246.2">Here’s how we can go </span><span class="No-Break"><span class="koboSpan" id="kobo.247.1">about it:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.248.1">Create a new folder </span><span class="No-Break"><span class="koboSpan" id="kobo.249.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.250.1">Services</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.251.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.252.1">Create a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.253.1">public interface</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.254.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.255.1">IWeatherService</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.256.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.257.1">Add a method for fetching data based on the location of the user, as shown in the following code. </span><span class="koboSpan" id="kobo.257.2">Name the </span><span class="No-Break"><span class="koboSpan" id="kobo.258.1">method </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.259.1">Ge</span><a id="_idTextAnchor742"/><span class="koboSpan" id="kobo.260.1">tForecastAsync</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.261.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.262.1">
using System.Threading.Tasks;
using Weather.Models;
namespace Weather.Services;
public interface IWeatherService
{
    Task&lt;Forecast&gt; GetForecastAsync(double latitude, double longitude);
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.263.1">Now that we have an interface, we can create an implementation for it, </span><span class="No-Break"><span class="koboSpan" id="kobo.264.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.265.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.266.1">Services</span></strong><span class="koboSpan" id="kobo.267.1"> folder, create a new class </span><span class="No-Break"><span class="koboSpan" id="kobo.268.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.269.1">OpenWeatherMapWeatherService</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.270.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.271.1">Implement </span><a id="_idIndexMarker807"/><span class="koboSpan" id="kobo.272.1">the interface and add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.273.1">async</span></strong><span class="koboSpan" id="kobo.274.1"> keyword to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.275.1">GetForecastAsync</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.276.1"> method:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.277.1">
using System;
using System.Globalization;
using Weather.Models;
using System.Text.Json;
namespace Weather.Services;
public class OpenWeatherMapWeatherService : IWeatherService
{
    public async Task&lt;Forecast&gt; GetForecastAsync(double latitude, double longitude)
    {
    }
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.278.1">Before we call the OpenWeatherMap API, we need to build a URI for the call to the Weather API. </span><span class="koboSpan" id="kobo.278.2">This will be a GET call, and the latitude and longitude of the position will be added as query parameters. </span><span class="koboSpan" id="kobo.278.3">We will also add the API key and the language that we would like the response to be in. </span><span class="koboSpan" id="kobo.278.4">Let’s set </span><span class="No-Break"><span class="koboSpan" id="kobo.279.1">this up:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.280.1">Open the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.281.1">OpenWeatherMapWeatherService</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.282.1"> class.</span></span></li>
<li><span class="koboSpan" id="kobo.283.1">Add the highlighted code in the following code snippet to </span><span class="No-Break"><span class="koboSpan" id="kobo.284.1">the </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.285.1">OpenWeatherMap</span></strong></span><strong class="source-inline">
</strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.286.1">WeatherService</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.287.1"> class:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.288.1">
public async Task&lt;Forecast&gt; GetForecastAsync(double latitude, double longitude)
{
</span><strong class="bold"><span class="koboSpan" id="kobo.289.1">    var language = CultureInfo.CurrentUICulture.TwoLetterISOLanguageName;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.290.1">    var apiKey = “{A</span><a id="_idTextAnchor743"/><span class="koboSpan" id="kobo.291.1">ddYourApiKeyHere}”;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.292.1">    var uri = $”https://api.openweathermap.org/data/2.5/forecast?lat={latitude}&amp;lon={longitude}&amp;units=metric&amp;lang={language}&amp;appid={apiKey}”;</span></strong><span class="koboSpan" id="kobo.293.1">
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.294.1">Replace the {</span><strong class="source-inline"><span class="koboSpan" id="kobo.295.1">AddYourApiKeyHere</span></strong><span class="koboSpan" id="kobo.296.1">} with the key you obtained from the </span><em class="italic"><span class="koboSpan" id="kobo.297.1">Creating models for the weather </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.298.1">data</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.299.1"> section</span></span></p>
<p><span class="koboSpan" id="kobo.300.1">To deserialize </span><a id="_idIndexMarker808"/><span class="koboSpan" id="kobo.301.1">the JSON that we will get from the external service, we will </span><span class="No-Break"><span class="koboSpan" id="kobo.302.1">use </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.303.1">System.Text.JSON</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.304.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.305.1">To make a call to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.306.1">Weather</span></strong><span class="koboSpan" id="kobo.307.1"> service, we will use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.308.1">HttpClient</span></strong><span class="koboSpan" id="kobo.309.1"> class and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.310.1">GetStringAsync</span></strong><span class="koboSpan" id="kobo.311.1"> method, </span><span class="No-Break"><span class="koboSpan" id="kobo.312.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.313.1">Create a new instance of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.314.1">HttpClient</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.315.1"> class.</span></span></li>
<li><span class="koboSpan" id="kobo.316.1">Call </span><strong class="source-inline"><span class="koboSpan" id="kobo.317.1">GetStringAsync</span></strong><span class="koboSpan" id="kobo.318.1"> and pass the URL as </span><span class="No-Break"><span class="koboSpan" id="kobo.319.1">the argument.</span></span></li>
<li><span class="koboSpan" id="kobo.320.1">Use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.321.1">JsonSerializer</span></strong><span class="koboSpan" id="kobo.322.1"> class and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.323.1">DeserializeObject</span></strong><span class="koboSpan" id="kobo.324.1"> method from </span><strong class="source-inline"><span class="koboSpan" id="kobo.325.1">System.Text.Json</span></strong><span class="koboSpan" id="kobo.326.1"> to convert the JSON string into </span><span class="No-Break"><span class="koboSpan" id="kobo.327.1">an object.</span></span></li>
<li><span class="koboSpan" id="kobo.328.1">Map the </span><strong class="source-inline"><span class="koboSpan" id="kobo.329.1">WeatherData</span></strong><span class="koboSpan" id="kobo.330.1"> object to a </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.331.1">Forecast</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.332.1"> object.</span></span></li>
<li><span class="koboSpan" id="kobo.333.1">The code for this should look like the highlighted code shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.334.1">following snippet:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.335.1">
public async Task&lt;Forecast&gt; GetForecastAsync(double latitude, double longitude)
{
    var language = CultureInfo.CurrentUICulture.
</span><span class="koboSpan" id="kobo.335.2">TwoLetterISOLanguageName;
    var apiKey = “{AddYourApiKeyHere}”;
    var uri = $”https://api.openweathermap.org/data/2.5/forecast?lat={latitude}&amp;lon={longitude}&amp;units=metric&amp;lang={language}&amp;appid={apiKey}”;
</span><strong class="bold"><span class="koboSpan" id="kobo.336.1">    var httpClient = new HttpClient();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.337.1">    var result = await httpClient.GetStringAsync(uri);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.338.1">    var data = JsonSerializer.Deserialize&lt;WeatherData&gt;(result);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.339.1">    var forecast = new Forecast()</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.340.1">    {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.341.1">        City = data.city.name,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.342.1">        Items = data.list.Select(x =&gt; new ForecastItem()</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.343.1">        {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.344.1">            DateTime = ToDateTime(x.dt),</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.345.1">            Temperature = x.main.temp,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.346.1">            WindSpeed = x.wind.speed,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.347.1">            Description = x.weather.First().description,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.348.1">            Icon = $”http://openweathermap.org/img/w/{x.weather.First().icon}.png”</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.349.1">        }).ToList()</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.350.1">    };</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.351.1">    return forecast;</span></strong><span class="koboSpan" id="kobo.352.1">
}</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.353.1">Performance tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.354.1">To optimize the performance of the app, we can use </span><strong class="source-inline"><span class="koboSpan" id="kobo.355.1">HttpClient</span></strong><span class="koboSpan" id="kobo.356.1"> as a singleton and reuse it for all network calls in the application. </span><span class="koboSpan" id="kobo.356.2">The following information is from Microsoft’s documentation: “</span><em class="italic"><span class="koboSpan" id="kobo.357.1">HttpClient is intended to be instantiated once and reused throughout the life of an application. </span><span class="koboSpan" id="kobo.357.2">Instantiating an HttpClient class for every request will exhaust the number of sockets available under heavy loads. </span><span class="koboSpan" id="kobo.357.3">This will result in SocketException errors</span></em><span class="koboSpan" id="kobo.358.1">.” </span><span class="koboSpan" id="kobo.358.2">This can be found </span><span class="No-Break"><span class="koboSpan" id="kobo.359.1">at </span></span><a href="https://learn.microsoft.com/en-gb/dotnet/api/system.net.http.httpclient?view=netstandard-2.0"><span class="No-Break"><span class="koboSpan" id="kobo.360.1">https://learn.microsoft.com/en-gb/dotnet/api/system.net.http.httpclient?view=netstandard-2.0</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.361.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.362.1">In the </span><a id="_idIndexMarker809"/><span class="koboSpan" id="kobo.363.1">preceding code, we have a call to a </span><strong class="source-inline"><span class="koboSpan" id="kobo.364.1">ToDateTime</span></strong><span class="koboSpan" id="kobo.365.1"> method, which is a method that we will need to create. </span><span class="koboSpan" id="kobo.365.2">This method converts the date from a Unix timestamp into a </span><strong class="source-inline"><span class="koboSpan" id="kobo.366.1">DateTime</span></strong><span class="koboSpan" id="kobo.367.1"> object, as shown in t</span><a id="_idTextAnchor744"/><span class="koboSpan" id="kobo.368.1">he </span><span class="No-Break"><span class="koboSpan" id="kobo.369.1">following code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.370.1">
private DateTime ToDateTime(double unixTimeStamp)
{
    DateTime dateTime = new DateTime(1970, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc);
    dateTime = dateTime.AddSeconds(unixTimeStamp).ToLocalTime();
    return dateTime;
}</span></pre> <p class="callout-heading"><span class="koboSpan" id="kobo.371.1">Performance tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.372.1">By default, </span><strong class="source-inline"><span class="koboSpan" id="kobo.373.1">HttpClient</span></strong><span class="koboSpan" id="kobo.374.1"> uses the Mono implementation of </span><strong class="source-inline"><span class="koboSpan" id="kobo.375.1">HttpClient</span></strong><span class="koboSpan" id="kobo.376.1"> (iOS and Android). </span><span class="koboSpan" id="kobo.376.2">To increase performance, we can use a platform-specific implementation instead. </span><span class="koboSpan" id="kobo.376.3">For iOS, use </span><strong class="source-inline"><span class="koboSpan" id="kobo.377.1">NSUrlSession</span></strong><span class="koboSpan" id="kobo.378.1">. </span><span class="koboSpan" id="kobo.378.2">This can be set in the project settings of the iOS project under the </span><strong class="bold"><span class="koboSpan" id="kobo.379.1">iOS Build</span></strong><span class="koboSpan" id="kobo.380.1"> tab. </span><span class="koboSpan" id="kobo.380.2">For Android, use </span><strong class="bold"><span class="koboSpan" id="kobo.381.1">Android</span></strong><span class="koboSpan" id="kobo.382.1">. </span><span class="koboSpan" id="kobo.382.2">This can be set in the project settings of the Android project under </span><strong class="bold"><span class="koboSpan" id="kobo.383.1">Android O</span><a id="_idTextAnchor745"/><a id="_idTextAnchor746"/><a id="_idTextAnchor747"/><span class="koboSpan" id="kobo.384.1">ptions</span></strong><span class="koboSpan" id="kobo.385.1"> | </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.386.1">Advanced</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.387.1">.</span></span></p>
<h2 id="_idParaDest-140"><a id="_idTextAnchor748"/><span class="koboSpan" id="kobo.388.1">Configuring the application platforms so that they use location services</span></h2>
<p><span class="koboSpan" id="kobo.389.1">To be </span><a id="_idIndexMarker810"/><span class="koboSpan" id="kobo.390.1">able to use location services, we need to carry out some configuration on </span><span class="No-Break"><span class="koboSpan" id="kobo.391.1">each platform.</span></span></p>
<h3><span class="koboSpan" id="kobo.392.1">Configuring the iOS platform so that it uses location services</span></h3>
<p><span class="koboSpan" id="kobo.393.1">To use location services in an iOS app, we need to add a description to indicate why we want to </span><a id="_idIndexMarker811"/><span class="koboSpan" id="kobo.394.1">use the location in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.395.1">info.plist</span></strong><span class="koboSpan" id="kobo.396.1"> file. </span><span class="koboSpan" id="kobo.396.2">In this app, we only need to get the location when we are using the app, so we only need to add a description for this. </span><span class="koboSpan" id="kobo.396.3">Let’s set </span><span class="No-Break"><span class="koboSpan" id="kobo.397.1">this up:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.398.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.399.1">info.plist</span></strong><span class="koboSpan" id="kobo.400.1"> in </span><strong class="source-inline"><span class="koboSpan" id="kobo.401.1">Platforms/iOS</span></strong><span class="koboSpan" id="kobo.402.1"> with </span><strong class="bold"><span class="koboSpan" id="kobo.403.1">XML (</span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.404.1">Text) Editor</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.406.1">Add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.407.1">NSLocationWhenInUseUsageDescription</span></strong><span class="koboSpan" id="kobo.408.1"> key using</span><a id="_idTextAnchor749"/><span class="koboSpan" id="kobo.409.1"> the </span><span class="No-Break"><span class="koboSpan" id="kobo.410.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.411.1">
&lt;key&gt;NSLocationWhenInUseUsageDescription&lt;/key&gt;
&lt;string&gt;We are using your location to find a forec</span><a id="_idTextAnchor750"/><a id="_idTextAnchor751"/><span class="koboSpan" id="kobo.412.1">ast for you&lt;/string&gt;</span></pre></li> </ol>
<h3><span class="koboSpan" id="kobo.413.1">Configuring the Android platform so that it uses location services</span></h3>
<p><span class="koboSpan" id="kobo.414.1">For Android, we </span><a id="_idIndexMarker812"/><span class="koboSpan" id="kobo.415.1">need to set up the app so that it requires the following </span><span class="No-Break"><span class="koboSpan" id="kobo.416.1">two permissions:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.417.1">ACCESS_COARSE_LOCATION </span></strong></li>
<li><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.418.1">ACCESS_FINE_LOCATION</span></strong></span></li>
</ul>
<p><span class="koboSpan" id="kobo.419.1">We can set this in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.420.1">AndroidManifest.xml</span></strong><span class="koboSpan" id="kobo.421.1"> file, which can be found in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.422.1">Platforms\Android\</span></strong><span class="koboSpan" id="kobo.423.1"> folder. </span><span class="koboSpan" id="kobo.423.2">However, we can also set this in the project properties on the </span><strong class="bold"><span class="koboSpan" id="kobo.424.1">Android Manifest</span></strong><span class="koboSpan" id="kobo.425.1"> tab, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.426.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer140">
<span class="koboSpan" id="kobo.427.1"><img alt="Figure 8.6 – Selecting ﻿﻿﻿﻿location permissions" src="image/B19214_08_6.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.428.1">Figure 8.6 – Selecting </span><a id="_idTextAnchor752"/><a id="_idTextAnchor753"/><a id="_idTextAnchor754"/><a id="_idTextAnchor755"/><span class="koboSpan" id="kobo.429.1">location permissions</span></p>
<h3><span class="koboSpan" id="kobo.430.1">Configuring the WinUI platform so that it uses location services</span></h3>
<p><span class="koboSpan" id="kobo.431.1">Since we </span><a id="_idIndexMarker813"/><span class="koboSpan" id="kobo.432.1">will be using location services in the WinUI platform, we need to add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.433.1">Location</span></strong><span class="koboSpan" id="kobo.434.1"> capability under </span><strong class="bold"><span class="koboSpan" id="kobo.435.1">Capabilities</span></strong><span class="koboSpan" id="kobo.436.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.437.1">Package.appxmanifest</span></strong><span class="koboSpan" id="kobo.438.1"> file of the project, which is located in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.439.1">Platforms/Windows</span></strong><span class="koboSpan" id="kobo.440.1"> folder, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.441.1">fo</span><a id="_idTextAnchor756"/><a id="_idTextAnchor757"/><span class="koboSpan" id="kobo.442.1">llowing screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer141">
<span class="koboSpan" id="kobo.443.1"><img alt="Figure 8.7 – Adding a location to the WinUI app" src="image/B19214_08_7.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.444.1">Figure 8.7 – Adding a location to the WinUI app</span></p>
<h2 id="_idParaDest-141"><a id="_idTextAnchor758"/><span class="koboSpan" id="kobo.445.1">Creating the ViewModel class</span></h2>
<p><span class="koboSpan" id="kobo.446.1">Now that we have a service that’s responsible for fetching weather data from the external </span><a id="_idIndexMarker814"/><span class="koboSpan" id="kobo.447.1">weather source, it’s time to create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.448.1">ViewModel</span></strong><span class="koboSpan" id="kobo.449.1">. </span><span class="koboSpan" id="kobo.449.2">First, however, we will create a base view model where we can put the code </span><a id="_idIndexMarker815"/><span class="koboSpan" id="kobo.450.1">that can be shared between all the </span><strong class="source-inline"><span class="koboSpan" id="kobo.451.1">ViewModels</span></strong><span class="koboSpan" id="kobo.452.1"> of the app. </span><span class="koboSpan" id="kobo.452.2">Let’s set </span><span class="No-Break"><span class="koboSpan" id="kobo.453.1">this up:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.454.1">Create a new folder </span><span class="No-Break"><span class="koboSpan" id="kobo.455.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.456.1">ViewModels</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.457.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.458.1">Create a new c</span><a id="_idTextAnchor759"/><span class="koboSpan" id="kobo.459.1">lass </span><span class="No-Break"><span class="koboSpan" id="kobo.460.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.461.1">ViewModel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.462.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.463.1">Make the new clas</span><a id="_idTextAnchor760"/><span class="koboSpan" id="kobo.464.1">s </span><strong class="source-inline"><span class="koboSpan" id="kobo.465.1">public</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.466.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.467.1">abstract</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.468.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.469.1">Add a package reference </span><span class="No-Break"><span class="koboSpan" id="kobo.470.1">to CommunityToolkit.MVVM:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.471.1">
public abstract partial class ViewModel : ObservableObject
{
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.472.1">We now have </span><a id="_idIndexMarker816"/><span class="koboSpan" id="kobo.473.1">a base view model. </span><span class="koboSpan" id="kobo.473.2">We can use this for </span><a id="_idIndexMarker817"/><span class="koboSpan" id="kobo.474.1">the view model that we’re about </span><span class="No-Break"><span class="koboSpan" id="kobo.475.1">to create.</span></span></p>
<p><span class="koboSpan" id="kobo.476.1">Now, it’s time to create </span><strong class="source-inline"><span class="koboSpan" id="kobo.477.1">MainViewModel</span></strong><span class="koboSpan" id="kobo.478.1">, which will be the ViewModel for our </span><strong class="source-inline"><span class="koboSpan" id="kobo.479.1">MainView</span></strong><span class="koboSpan" id="kobo.480.1"> in the app. </span><span class="koboSpan" id="kobo.480.2">Perform the following steps to </span><span class="No-Break"><span class="koboSpan" id="kobo.481.1">do so:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.482.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.483.1">ViewModels</span></strong><span class="koboSpan" id="kobo.484.1"> folder, create a new class </span><span class="No-Break"><span class="koboSpan" id="kobo.485.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.486.1">MainViewModel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.487.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.488.1">Add the abstract </span><strong class="source-inline"><span class="koboSpan" id="kobo.489.1">ViewModel</span></strong><span class="koboSpan" id="kobo.490.1"> class as a </span><span class="No-Break"><span class="koboSpan" id="kobo.491.1">base class.</span></span></li>
<li><span class="koboSpan" id="kobo.492.1">Because we are going to use constructor injection, we will add a constructor with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.493.1">IWeatherService</span></strong><span class="koboSpan" id="kobo.494.1"> i</span><a id="_idTextAnchor761"/><span class="koboSpan" id="kobo.495.1">nterface as </span><span class="No-Break"><span class="koboSpan" id="kobo.496.1">a parameter.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.497.1">Create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.498.1">read-only private</span></strong><span class="koboSpan" id="kobo.499.1"> field. </span><span class="koboSpan" id="kobo.499.2">We will use this to store the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.500.1">I</span><a id="_idTextAnchor762"/><span class="koboSpan" id="kobo.501.1">weatherService</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.502.1"> instance:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.503.1">
public class MainViewModel : ViewModel
{
    private readonly IWeatherService weatherService;
    public MainViewModel(IWeatherService weatherService)
    {
        this.weatherService = weatherService;
    }
}</span></pre></li> </ol>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.504.1">MainViewModel</span></strong><span class="koboSpan" id="kobo.505.1"> takes any object that implements </span><strong class="source-inline"><span class="koboSpan" id="kobo.506.1">IWeatherService</span></strong><span class="koboSpan" id="kobo.507.1"> and stores a reference to that service in a field. </span><span class="koboSpan" id="kobo.507.2">We will be adding functionality</span><a id="_idTextAnchor763"/><span class="koboSpan" id="kobo.508.1"> that will fetch weather d</span><a id="_idTextAnchor764"/><span class="koboSpan" id="kobo.509.1">ata in the </span><span class="No-Break"><span class="koboSpan" id="kobo.510.1">next section.</span></span></p>
<h3><span class="koboSpan" id="kobo.511.1">Getting the weather data</span></h3>
<p><span class="koboSpan" id="kobo.512.1">Now, we will create a new method for loading the data. </span><span class="koboSpan" id="kobo.512.2">This will be a three-step process. </span><span class="koboSpan" id="kobo.512.3">First, we will </span><a id="_idIndexMarker818"/><span class="koboSpan" id="kobo.513.1">get the location of the user. </span><span class="koboSpan" id="kobo.513.2">Once we have this, we can fetch data related to that location. </span><span class="koboSpan" id="kobo.513.3">The final step is to prepare the data that the views can consume to create a user interface for </span><span class="No-Break"><span class="koboSpan" id="kobo.514.1">the user.</span></span></p>
<p><span class="koboSpan" id="kobo.515.1">To get the location of the user, we will use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.516.1">Geolocation</span></strong><span class="koboSpan" id="kobo.517.1"> class, which exposes methods that can fetch the location of the user. </span><span class="koboSpan" id="kobo.517.2">Perform the </span><span class="No-Break"><span class="koboSpan" id="kobo.518.1">following steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.519.1">Create a new method called </span><strong class="source-inline"><span class="koboSpan" id="kobo.520.1">LoadDataAsync</span></strong><span class="koboSpan" id="kobo.521.1">. </span><span class="koboSpan" id="kobo.521.2">Make it an asynchronous method that </span><span class="No-Break"><span class="koboSpan" id="kobo.522.1">returns </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.523.1">Task</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.524.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.525.1">Use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.526.1">GetLocationAsync</span></strong><span class="koboSpan" id="kobo.527.1"> method on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.528.1">Geolocation</span></strong><span class="koboSpan" id="kobo.529.1"> class to get the location of </span><span class="No-Break"><span class="koboSpan" id="kobo.530.1">the user.</span></span></li>
<li><span class="koboSpan" id="kobo.531.1">Pass the latitude and longitude from the result of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.532.1">GetLocationAsync</span></strong><span class="koboSpan" id="kobo.533.1"> call and pass it to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.534.1">GetForecast</span></strong><span class="koboSpan" id="kobo.535.1"> method on the object that implements </span><strong class="source-inline"><span class="koboSpan" id="kobo.536.1">IWeatherService</span></strong><span class="koboSpan" id="kobo.537.1"> using the </span><span class="No-Break"><span class="koboSpan" id="kobo.538.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.539.1">
public async Task LoadDataAsync()
{
    var location = await Geolocation.GetLocationAsync();
    var forecast = await weatherService.GetForecastAsync(location.Latitude, location.Longitude);
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.540.1">Now that we can get data from the service, we need to structure it for our user interface by grouping t</span><a id="_idTextAnchor765"/><a id="_idTextAnchor766"/><a id="_idTextAnchor767"/><span class="koboSpan" id="kobo.541.1">he individual </span><span class="No-Break"><span class="koboSpan" id="kobo.542.1">data items.</span></span></p>
<h3><span class="koboSpan" id="kobo.543.1">Grouping the weather data</span></h3>
<p><span class="koboSpan" id="kobo.544.1">When we </span><a id="_idIndexMarker819"/><span class="koboSpan" id="kobo.545.1">present the weather data, we will group it by day so that all of the forecasts for one day will be under the same header. </span><span class="koboSpan" id="kobo.545.2">To do this, we will create a new model called </span><strong class="source-inline"><span class="koboSpan" id="kobo.546.1">ForecastGroup</span></strong><span class="koboSpan" id="kobo.547.1">. </span><span class="koboSpan" id="kobo.547.2">To make it possible to use this model with the .NET MAUI </span><strong class="source-inline"><span class="koboSpan" id="kobo.548.1">CollectionView</span></strong><span class="koboSpan" id="kobo.549.1">, it has to have an </span><strong class="source-inline"><span class="koboSpan" id="kobo.550.1">IEnumerable</span></strong><span class="koboSpan" id="kobo.551.1"> type as the base class. </span><span class="koboSpan" id="kobo.551.2">Let’s set </span><span class="No-Break"><span class="koboSpan" id="kobo.552.1">this up:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.553.1">Create a new class called </span><strong class="source-inline"><span class="koboSpan" id="kobo.554.1">ForecastGroup</span></strong><span class="koboSpan" id="kobo.555.1"> in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.556.1">Models</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.557.1"> folder.</span></span></li>
<li><span class="koboSpan" id="kobo.558.1">Add </span><strong class="source-inline"><span class="koboSpan" id="kobo.559.1">List&lt;ForecastItem&gt;</span></strong><span class="koboSpan" id="kobo.560.1"> as the base class for the </span><span class="No-Break"><span class="koboSpan" id="kobo.561.1">new model.</span></span></li>
<li><span class="koboSpan" id="kobo.562.1">Add an empty constructor and a constructor that has a list of </span><strong class="source-inline"><span class="koboSpan" id="kobo.563.1">ForecastItem</span></strong><span class="koboSpan" id="kobo.564.1"> instances as </span><span class="No-Break"><span class="koboSpan" id="kobo.565.1">a parameter.</span></span></li>
<li><span class="koboSpan" id="kobo.566.1">Add a </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.567.1">Date</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.568.1"> property.</span></span></li>
<li><span class="koboSpan" id="kobo.569.1">Add a </span><a id="_idIndexMarker820"/><span class="koboSpan" id="kobo.570.1">property, </span><strong class="source-inline"><span class="koboSpan" id="kobo.571.1">DateAsString</span></strong><span class="koboSpan" id="kobo.572.1">, that returns the </span><strong class="source-inline"><span class="koboSpan" id="kobo.573.1">Date</span></strong><span class="koboSpan" id="kobo.574.1"> property as a short </span><span class="No-Break"><span class="koboSpan" id="kobo.575.1">date string.</span></span></li>
<li><span class="koboSpan" id="kobo.576.1">Add a property, </span><strong class="source-inline"><span class="koboSpan" id="kobo.577.1">Items</span></strong><span class="koboSpan" id="kobo.578.1">, that returns the list of </span><strong class="source-inline"><span class="koboSpan" id="kobo.579.1">ForecastItem</span></strong><span class="koboSpan" id="kobo.580.1"> instances, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.581.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.582.1">
using System;
namespace Weather.Models;
public class ForecastGroup : List&lt;ForecastItem&gt;
{
    public ForecastGroup() { }
    public ForecastGroup(IEnumerable&lt;ForecastItem&gt; items)
    {
        AddRange(items);
    }
    public DateTime Date { get; set; }
    public string DateAsString =&gt; Date.ToShortDateString();
    public List&lt;ForecastItem&gt; Items =&gt; this;
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.583.1">When we </span><a id="_idIndexMarker821"/><span class="koboSpan" id="kobo.584.1">have done this, we can update </span><strong class="source-inline"><span class="koboSpan" id="kobo.585.1">MainViewModel</span></strong><span class="koboSpan" id="kobo.586.1"> with two new properties, </span><span class="No-Break"><span class="koboSpan" id="kobo.587.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.588.1">Create a privat</span><a id="_idTextAnchor768"/><span class="koboSpan" id="kobo.589.1">e field called </span><strong class="source-inline"><span class="koboSpan" id="kobo.590.1">city</span></strong><span class="koboSpan" id="kobo.591.1"> with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.592.1">ObservableProperty</span></strong><span class="koboSpan" id="kobo.593.1"> attribute for the name of the city we are fetching the </span><span class="No-Break"><span class="koboSpan" id="kobo.594.1">weather data.</span></span></li>
<li><span class="koboSpan" id="kobo.595.1">Create a private field called </span><strong class="source-inline"><span class="koboSpan" id="kobo.596.1">days</span></strong><span class="koboSpan" id="kobo.597.1"> with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.598.1">ObservableProperty</span></strong><span class="koboSpan" id="kobo.599.1"> attribute that will conta</span><a id="_idTextAnchor769"/><span class="koboSpan" id="kobo.600.1">in the grouped </span><span class="No-Break"><span class="koboSpan" id="kobo.601.1">weather data.</span></span></li>
<li><span class="koboSpan" id="kobo.602.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.603.1">MainViewModel</span></strong><span class="koboSpan" id="kobo.604.1"> class should look like the highlighted code shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.605.1">following snippet:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.606.1">
public partial class MainViewModel : ViewModel
{
    </span><strong class="bold"><span class="koboSpan" id="kobo.607.1">[ObservableProperty]</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.608.1">    private string city;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.609.1">[ObservableProperty]</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.610.1">    private ObservableCollection&lt;ForecastGroup&gt; days;</span></strong><span class="koboSpan" id="kobo.611.1">
    // Rest of the class is omitted for brevity
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.612.1">Now, we are ready to group the data. </span><span class="koboSpan" id="kobo.612.2">We will do this in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.613.1">LoadDataAsync</span></strong><span class="koboSpan" id="kobo.614.1"> method. </span><span class="koboSpan" id="kobo.614.2">We will loop through the data from the service and add items to various groups, </span><span class="No-Break"><span class="koboSpan" id="kobo.615.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.616.1">Create an </span><strong class="source-inline"><span class="koboSpan" id="kobo.617.1">itemGroups</span></strong><span class="koboSpan" id="kobo.618.1"> variable of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.619.1">List&lt;ForecastGroup&gt;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.620.1"> type.</span></span></li>
<li><span class="koboSpan" id="kobo.621.1">Create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.622.1">foreach</span></strong><span class="koboSpan" id="kobo.623.1"> loop that loops through all the items in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.624.1">forecast</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.625.1"> variable.</span></span></li>
<li><span class="koboSpan" id="kobo.626.1">Add an </span><strong class="source-inline"><span class="koboSpan" id="kobo.627.1">if</span></strong><span class="koboSpan" id="kobo.628.1"> statement that checks whether the </span><strong class="source-inline"><span class="koboSpan" id="kobo.629.1">itemGroups</span></strong><span class="koboSpan" id="kobo.630.1"> property is empty. </span><span class="koboSpan" id="kobo.630.2">If it is empty, add a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.631.1">ForecastGroup</span></strong><span class="koboSpan" id="kobo.632.1"> to the variable and continue to the next item in the </span><span class="No-Break"><span class="koboSpan" id="kobo.633.1">item list.</span></span></li>
<li><span class="koboSpan" id="kobo.634.1">Use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.635.1">SingleOrDefault</span></strong><span class="koboSpan" id="kobo.636.1"> method (this is an extension method from </span><strong class="source-inline"><span class="koboSpan" id="kobo.637.1">System.Linq</span></strong><span class="koboSpan" id="kobo.638.1">) on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.639.1">itemGroups</span></strong><span class="koboSpan" id="kobo.640.1"> variable to get a group based on the date of the current </span><strong class="source-inline"><span class="koboSpan" id="kobo.641.1">ForecastItem</span></strong><span class="koboSpan" id="kobo.642.1">. </span><span class="koboSpan" id="kobo.642.2">Add the result to a new </span><span class="No-Break"><span class="koboSpan" id="kobo.643.1">variable, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.644.1">group</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.645.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.646.1">If the </span><strong class="source-inline"><span class="koboSpan" id="kobo.647.1">group</span></strong><span class="koboSpan" id="kobo.648.1"> property is </span><strong class="source-inline"><span class="koboSpan" id="kobo.649.1">null</span></strong><span class="koboSpan" id="kobo.650.1">, then there is no group with the current day in the list of groups. </span><span class="koboSpan" id="kobo.650.2">If this is the case, a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.651.1">ForecastGroup</span></strong><span class="koboSpan" id="kobo.652.1"> should be added to the list </span><a id="_idIndexMarker822"/><span class="koboSpan" id="kobo.653.1">in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.654.1">itemGroups</span></strong><span class="koboSpan" id="kobo.655.1"> variable. </span><span class="koboSpan" id="kobo.655.2">The code will continue executing until it gets to the next </span><strong class="source-inline"><span class="koboSpan" id="kobo.656.1">forecast</span></strong><span class="koboSpan" id="kobo.657.1"> item in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.658.1">forecast.Items</span></strong><span class="koboSpan" id="kobo.659.1"> list. </span><span class="koboSpan" id="kobo.659.2">If a group is found, it should be added to the list in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.660.1">itemGroups</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.661.1"> variable.</span></span></li>
<li><span class="koboSpan" id="kobo.662.1">After the </span><strong class="source-inline"><span class="koboSpan" id="kobo.663.1">foreach</span></strong><span class="koboSpan" id="kobo.664.1"> loop, set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.665.1">Days</span></strong><span class="koboSpan" id="kobo.666.1"> property with a </span><span class="No-Break"><span class="koboSpan" id="kobo.667.1">new </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.668.1">ObservableCollection</span></strong></span><strong class="source-inline"><span class="koboSpan" id="kobo.669.1">
&lt;ForecastGroup&gt;</span></strong><span class="koboSpan" id="kobo.670.1"> and use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.671.1">itemGroups</span></strong><span class="koboSpan" id="kobo.672.1"> variable as an argument in </span><span class="No-Break"><span class="koboSpan" id="kobo.673.1">the constructor.</span></span></li>
<li><span class="koboSpan" id="kobo.674.1">Set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.675.1">City</span></strong><span class="koboSpan" id="kobo.676.1"> property to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.677.1">City</span></strong><span class="koboSpan" id="kobo.678.1"> prope</span><a id="_idTextAnchor770"/><span class="koboSpan" id="kobo.679.1">rty of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.680.1">forecast</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.681.1"> variable.</span></span></li>
<li><span class="koboSpan" id="kobo.682.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.683.1">LoadDataAsync</span></strong><span class="koboSpan" id="kobo.684.1"> method should now look </span><span class="No-Break"><span class="koboSpan" id="kobo.685.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.686.1">
public async Task LoadDataAsync()
{
    var location = await Geolocation.GetLocationAsync();
    var forecast = await weatherService.GetForecastAsync(location.Latitude, location.Longitude);
    var itemGroups = new List&lt;ForecastGroup&gt;();
    foreach (var item in forecast.Items)
    {
        if (!itemGroups.Any())
        {
            itemGroups.Add(new ForecastGroup(new List&lt;ForecastItem&gt;() { item })
            {
                Date = item.DateTime.Date
            });
            continue;
        }
        var group = itemGroups.SingleOrDefault(x =&gt; x.Date == item.DateTime.Date);
        if (group == null)
        {
            itemGroups.Add(new ForecastGroup(new List&lt;ForecastItem&gt;() { item })
            {
                Date = item.DateTime.Date
            });
            continue;
        }
        group.Items.Add(item);
    }
    Days = new ObservableCollection&lt;ForecastGroup&gt;(itemGroups);
    City = forecast.City;
}</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.687.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.688.1">Don’t use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.689.1">Add</span></strong><span class="koboSpan" id="kobo.690.1"> method on </span><strong class="source-inline"><span class="koboSpan" id="kobo.691.1">ObservableCollection</span></strong><span class="koboSpan" id="kobo.692.1"> when you want to add more than </span><a id="_idIndexMarker823"/><span class="koboSpan" id="kobo.693.1">a couple of items. </span><span class="koboSpan" id="kobo.693.2">It is better to create a new instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.694.1">ObservableCollection</span></strong><span class="koboSpan" id="kobo.695.1"> and pass a collection to the constructor. </span><span class="koboSpan" id="kobo.695.2">The reason for this is that every time you use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.696.1">Add</span></strong><span class="koboSpan" id="kobo.697.1"> method, you will have a binding to it from the view, which will cause the view to be rendered. </span><span class="koboSpan" id="kobo.697.2">We will get better performance if </span><a id="_idTextAnchor771"/><a id="_idTextAnchor772"/><a id="_idTextAnchor773"/><a id="_idTextAnchor774"/><span class="koboSpan" id="kobo.698.1">we avoid using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.699.1">Add</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.700.1"> method.</span></span></p>
<h2 id="_idParaDest-142"><a id="_idTextAnchor775"/><span class="koboSpan" id="kobo.701.1">Creating the view for tablets and desktop computers</span></h2>
<p><span class="koboSpan" id="kobo.702.1">The next </span><a id="_idIndexMarker824"/><span class="koboSpan" id="kobo.703.1">step is to create the view </span><a id="_idIndexMarker825"/><span class="koboSpan" id="kobo.704.1">that we will use when the app is running on a tablet or a desktop computer. </span><span class="koboSpan" id="kobo.704.2">Let’s set </span><span class="No-Break"><span class="koboSpan" id="kobo.705.1">this up:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.706.1">Create a new folder in t</span><a id="_idTextAnchor776"/><span class="koboSpan" id="kobo.707.1">he </span><strong class="source-inline"><span class="koboSpan" id="kobo.708.1">Weather</span></strong><span class="koboSpan" id="kobo.709.1"> project </span><span class="No-Break"><span class="koboSpan" id="kobo.710.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.711.1">Views</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.712.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.713.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.714.1">Views</span></strong><span class="koboSpan" id="kobo.715.1"> folder, create a new folder </span><span class="No-Break"><span class="koboSpan" id="kobo.716.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.717.1">Desktop</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.718.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.719.1">Create a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.720.1">.NET MAUI ContentPage (XAML)</span></strong><span class="koboSpan" id="kobo.721.1"> file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.722.1">MainView</span></strong><span class="koboSpan" id="kobo.723.1"> in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.724.1">Views\Desktop</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.725.1"> folder:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer142">
<span class="koboSpan" id="kobo.726.1"><img alt="Figure 8.8 – Addi﻿ng a .NET MAUI XAML ContentPage" src="image/B19214_08_8.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.727.1">Figure 8.8 – Addi</span><a id="_idTextAnchor777"/><span class="koboSpan" id="kobo.728.1">ng a .NET MAUI XAML ContentPage</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.729.1">Pass </span><a id="_idIndexMarker826"/><span class="koboSpan" id="kobo.730.1">an instance </span><a id="_idIndexMarker827"/><span class="koboSpan" id="kobo.731.1">of </span><strong class="source-inline"><span class="koboSpan" id="kobo.732.1">MainViewModel</span></strong><span class="koboSpan" id="kobo.733.1"> in the constructor of the view to set </span><strong class="source-inline"><span class="koboSpan" id="kobo.734.1">BindingContext</span></strong><span class="koboSpan" id="kobo.735.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.736.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.737.1">
public MainView (</span><strong class="bold"><span class="koboSpan" id="kobo.738.1">MainViewModel mainViewModel</span></strong><span class="koboSpan" id="kobo.739.1">)
{
    InitializeComponent ();
    </span><strong class="bold"><span class="koboSpan" id="kobo.740.1">BindingContext = mainViewModel;</span></strong><span class="koboSpan" id="kobo.741.1">
}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.742.1">Later, in the </span><em class="italic"><span class="koboSpan" id="kobo.743.1">Adding services and ViewModels to dependency injection</span></em><span class="koboSpan" id="kobo.744.1"> section, we will configure dependency injection</span><a id="_idTextAnchor778"/><span class="koboSpan" id="kobo.745.1"> to provide the instances </span><span class="No-Break"><span class="koboSpan" id="kobo.746.1">for us.</span></span></p></li> </ol>
<p><span class="koboSpan" id="kobo.747.1">To trigger the </span><strong class="source-inline"><span class="koboSpan" id="kobo.748.1">LoadDataAsync</span></strong><span class="koboSpan" id="kobo.749.1"> method in </span><strong class="source-inline"><span class="koboSpan" id="kobo.750.1">MainViewModel</span></strong><span class="koboSpan" id="kobo.751.1">, call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.752.1">LoadDataAsync</span></strong><span class="koboSpan" id="kobo.753.1"> method by overriding the </span><strong class="source-inline"><span class="koboSpan" id="kobo.754.1">OnNavigatedTo</span></strong><span class="koboSpan" id="kobo.755.1"> method on the main thread. </span><span class="koboSpan" id="kobo.755.2">We need </span><a id="_idIndexMarker828"/><span class="koboSpan" id="kobo.756.1">to make sure </span><a id="_idIndexMarker829"/><span class="koboSpan" id="kobo.757.1">that the call is executed on the UI thread since it will interact with the </span><span class="No-Break"><span class="koboSpan" id="kobo.758.1">user interface.</span></span></p>
<p><span class="koboSpan" id="kobo.759.1">To do this, perform the </span><span class="No-Break"><span class="koboSpan" id="kobo.760.1">following steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.761.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.762.1">MainView.xaml.cs</span></strong><span class="koboSpan" id="kobo.763.1"> file in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.764.1">Views\Desktop</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.765.1"> folder.</span></span></li>
<li><span class="koboSpan" id="kobo.766.1">Create an ov</span><a id="_idTextAnchor779"/><span class="koboSpan" id="kobo.767.1">erride of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.768.1">OnNavigatedTo</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.769.1"> method.</span></span></li>
<li><span class="koboSpan" id="kobo.770.1">Add the highlighted code shown in the following snippet to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.771.1">OnNavigateTo</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.772.1"> method:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.773.1">
    protected override void OnNavigatedTo(NavigatedToEventArgs args)
    {
        base.OnNavigatedTo(args);
</span><strong class="bold"><span class="koboSpan" id="kobo.774.1">        if (BindingContext is MainViewModel viewModel)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.775.1">        {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.776.1">            MainThread.BeginInvokeOnMainThread(async () =&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.777.1">            {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.778.1">                await viewModel.LoadDataAsync();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.779.1">            });</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.780.1">        }</span></strong><span class="koboSpan" id="kobo.781.1">
    }</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.782.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.783.1">MainView</span></strong><span class="koboSpan" id="kobo.784.1"> XAML file, add a binding for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.785.1">Title</span></strong><span class="koboSpan" id="kobo.786.1"> property of </span><strong class="source-inline"><span class="koboSpan" id="kobo.787.1">ContentPage</span></strong><span class="koboSpan" id="kobo.788.1"> to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.789.1">City</span></strong><span class="koboSpan" id="kobo.790.1"> property in </span><strong class="source-inline"><span class="koboSpan" id="kobo.791.1">ViewModel</span></strong><span class="koboSpan" id="kobo.792.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.793.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.794.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.795.1">MainView.xaml</span></strong><span class="koboSpan" id="kobo.796.1"> file in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.797.1">Views\Desktop</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.798.1"> folder.</span></span></li>
<li><span class="koboSpan" id="kobo.799.1">Add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.800.1">Title</span></strong><span class="koboSpan" id="kobo.801.1"> binding to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.802.1">ContentPage</span></strong><span class="koboSpan" id="kobo.803.1"> element, as highlighted in the following </span><span class="No-Break"><span class="koboSpan" id="kobo.804.1">code snippet:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.805.1">
&lt;ContentPage
    xmlns=”http://schemas.microsoft.com/dotnet/2021/maui”
    xmlns:x=”http://schemas.microsoft.com/winfx/2009/xaml”
    x:Class=”Weather.Views.Desktop.MainView”
    </span><strong class="bold"><span class="koboSpan" id="kobo.806.1">Title=”{Binding City}”</span></strong><span class="koboSpan" id="kobo.807.1">&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.808.1">In this </span><a id="_idIndexMarker830"/><span class="koboSpan" id="kobo.809.1">next section, we will use </span><strong class="source-inline"><span class="koboSpan" id="kobo.810.1">FlexLayout</span></strong><span class="koboSpan" id="kobo.811.1"> to render </span><a id="_idIndexMarker831"/><span class="koboSpan" id="kobo.812.1">the dat</span><a id="_idTextAnchor780"/><a id="_idTextAnchor781"/><span class="koboSpan" id="kobo.813.1">a from the ViewModel onto </span><span class="No-Break"><span class="koboSpan" id="kobo.814.1">the screen.</span></span></p>
<h3><span class="koboSpan" id="kobo.815.1">Using FlexLayout</span></h3>
<p><span class="koboSpan" id="kobo.816.1">In .NET MAUI, we can use </span><strong class="source-inline"><span class="koboSpan" id="kobo.817.1">CollectionView</span></strong><span class="koboSpan" id="kobo.818.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.819.1">ListView</span></strong><span class="koboSpan" id="kobo.820.1"> if we want to show a collection of data. </span><span class="koboSpan" id="kobo.820.2">Using both </span><strong class="source-inline"><span class="koboSpan" id="kobo.821.1">CollectionView</span></strong><span class="koboSpan" id="kobo.822.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.823.1">ListView</span></strong><span class="koboSpan" id="kobo.824.1"> works great in most cases, and we will use </span><strong class="source-inline"><span class="koboSpan" id="kobo.825.1">CollectionView</span></strong><span class="koboSpan" id="kobo.826.1"> later in this chapter, but </span><strong class="source-inline"><span class="koboSpan" id="kobo.827.1">ListView</span></strong><span class="koboSpan" id="kobo.828.1"> can only show </span><a id="_idIndexMarker832"/><span class="koboSpan" id="kobo.829.1">data vertically. </span><span class="koboSpan" id="kobo.829.2">In this app, we want to show data in both directions. </span><span class="koboSpan" id="kobo.829.3">In the vertical direction, we will have the days (we group forecasts based on days), while in the horizontal direction, we will have the forecasts within a particular day. </span><span class="koboSpan" id="kobo.829.4">We also want the forecasts within a day to wrap if there </span><a id="_idIndexMarker833"/><span class="koboSpan" id="kobo.830.1">is not enough space for all of them in one row. </span><strong class="source-inline"><span class="koboSpan" id="kobo.831.1">CollectionView</span></strong><span class="koboSpan" id="kobo.832.1"> can show data in a horizontal direction, but it will not wrap. </span><span class="koboSpan" id="kobo.832.2">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.833.1">FlexLayout</span></strong><span class="koboSpan" id="kobo.834.1">, we can add items in both directions and we can use </span><strong class="source-inline"><span class="koboSpan" id="kobo.835.1">BindableLayout</span></strong><span class="koboSpan" id="kobo.836.1"> to bind items to it. </span><span class="koboSpan" id="kobo.836.2">When we use </span><strong class="source-inline"><span class="koboSpan" id="kobo.837.1">BindableLayout</span></strong><span class="koboSpan" id="kobo.838.1">, we will use </span><strong class="source-inline"><span class="koboSpan" id="kobo.839.1">ItemSource</span></strong><span class="koboSpan" id="kobo.840.1"> an</span><a id="_idTextAnchor782"/><span class="koboSpan" id="kobo.841.1">d </span><strong class="source-inline"><span class="koboSpan" id="kobo.842.1">ItemsTemplate</span></strong><span class="koboSpan" id="kobo.843.1"> as </span><span class="No-Break"><span class="koboSpan" id="kobo.844.1">attached properties.</span></span></p>
<p><span class="koboSpan" id="kobo.845.1">Perform the following steps to build </span><span class="No-Break"><span class="koboSpan" id="kobo.846.1">the view:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.847.1">Add </span><strong class="source-inline"><span class="koboSpan" id="kobo.848.1">Grid</span></strong><span class="koboSpan" id="kobo.849.1"> as the root view of </span><span class="No-Break"><span class="koboSpan" id="kobo.850.1">the page.</span></span></li>
<li><span class="koboSpan" id="kobo.851.1">Add </span><strong class="source-inline"><span class="koboSpan" id="kobo.852.1">ScrollView</span></strong><span class="koboSpan" id="kobo.853.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.854.1">Grid</span></strong><span class="koboSpan" id="kobo.855.1">. </span><span class="koboSpan" id="kobo.855.2">We need this to be able to scroll if the content is higher than the height of </span><span class="No-Break"><span class="koboSpan" id="kobo.856.1">the page.</span></span></li>
<li><span class="koboSpan" id="kobo.857.1">Add </span><strong class="source-inline"><span class="koboSpan" id="kobo.858.1">FlexLayout</span></strong><span class="koboSpan" id="kobo.859.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.860.1">ScrollView</span></strong><span class="koboSpan" id="kobo.861.1"> and set the direction to </span><strong class="source-inline"><span class="koboSpan" id="kobo.862.1">Column</span></strong><span class="koboSpan" id="kobo.863.1"> so that the content will be in a </span><span class="No-Break"><span class="koboSpan" id="kobo.864.1">vertical direction.</span></span></li>
<li><span class="koboSpan" id="kobo.865.1">Add a </span><a id="_idIndexMarker834"/><span class="koboSpan" id="kobo.866.1">binding to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.867.1">Days</span></strong><span class="koboSpan" id="kobo.868.1"> property in </span><strong class="source-inline"><span class="koboSpan" id="kobo.869.1">MainViewModel</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.870.1">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.871.1">BindableLayout.ItemsSource</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.872.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.873.1">Set </span><strong class="source-inline"><span class="koboSpan" id="kobo.874.1">DataTemplate</span></strong><span class="koboSpan" id="kobo.875.1"> to the </span><a id="_idIndexMarker835"/><span class="koboSpan" id="kobo.876.1">content of </span><strong class="source-inline"><span class="koboSpan" id="kobo.877.1">Items</span><a id="_idTextAnchor783"/><span class="koboSpan" id="kobo.878.1">Template</span></strong><span class="koboSpan" id="kobo.879.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.880.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.881.1">
&lt;Grid&gt;
  &lt;ScrollView BackgroundColor=”Transparent”&gt;
    &lt;FlexLayout BindableLayout.ItemsSource=”{Binding Days}” Direction=”Column”&gt;
      &lt;BindableLayout.ItemTemplate&gt;
        &lt;DataTemplate&gt;
          &lt;!--Content will be added here --&gt;
        &lt;/DataTemplate&gt;
      &lt;/BindableLayout.ItemTemplate&gt;
    &lt;/FlexLayout&gt;
  &lt;/ScrollView&gt;
&lt;/Grid&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.882.1">The content for each item will be a header with the date and a horizontal </span><strong class="source-inline"><span class="koboSpan" id="kobo.883.1">FlexLayout</span></strong><span class="koboSpan" id="kobo.884.1"> with the forecasts for the day. </span><span class="koboSpan" id="kobo.884.2">Let’s set </span><span class="No-Break"><span class="koboSpan" id="kobo.885.1">this up:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.886.1">Open the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.887.1">MainView.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.888.1"> file.</span></span></li>
<li><span class="koboSpan" id="kobo.889.1">Add </span><strong class="source-inline"><span class="koboSpan" id="kobo.890.1">StackLayout</span></strong><span class="koboSpan" id="kobo.891.1"> so that the children we add to it will be placed in a </span><span class="No-Break"><span class="koboSpan" id="kobo.892.1">vertical direction.</span></span></li>
<li><span class="koboSpan" id="kobo.893.1">Add </span><strong class="source-inline"><span class="koboSpan" id="kobo.894.1">ContentView</span></strong><span class="koboSpan" id="kobo.895.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.896.1">StackLayout</span></strong><span class="koboSpan" id="kobo.897.1"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.898.1">Padding</span></strong><span class="koboSpan" id="kobo.899.1"> set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.900.1">10</span></strong><span class="koboSpan" id="kobo.901.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.902.1">BackgroundColor</span></strong><span class="koboSpan" id="kobo.903.1"> set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.904.1">#9F5010</span></strong><span class="koboSpan" id="kobo.905.1">. </span><span class="koboSpan" id="kobo.905.2">This will be the header. </span><span class="koboSpan" id="kobo.905.3">The reason we need </span><strong class="source-inline"><span class="koboSpan" id="kobo.906.1">ContentView</span></strong><span class="koboSpan" id="kobo.907.1"> is that we want to have padding around </span><span class="No-Break"><span class="koboSpan" id="kobo.908.1">the text.</span></span></li>
<li><span class="koboSpan" id="kobo.909.1">Add </span><strong class="source-inline"><span class="koboSpan" id="kobo.910.1">Label</span></strong><span class="koboSpan" id="kobo.911.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.912.1">ContentView</span></strong><span class="koboSpan" id="kobo.913.1"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.914.1">TextColor</span></strong><span class="koboSpan" id="kobo.915.1"> set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.916.1">White</span></strong><span class="koboSpan" id="kobo.917.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.918.1">FontAttributes</span></strong><span class="koboSpan" id="kobo.919.1"> set </span><span class="No-Break"><span class="koboSpan" id="kobo.920.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.921.1">Bold</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.922.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.923.1">Add a binding to </span><strong class="source-inline"><span class="koboSpan" id="kobo.924.1">DateAsString</span></strong><span class="koboSpan" id="kobo.925.1"> for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.926.1">Text</span></strong><span class="koboSpan" id="kobo.927.1"> property </span><span class="No-Break"><span class="koboSpan" id="kobo.928.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.929.1">Label</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.930.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.931.1">The code </span><a id="_idIndexMarker836"/><span class="koboSpan" id="kobo.932.1">should be placed </span><a id="_idIndexMarker837"/><span class="koboSpan" id="kobo.933.1">at the </span><strong class="source-inline"><span class="koboSpan" id="kobo.934.1">&lt;!-- Content will be added h</span><a id="_idTextAnchor784"/><span class="koboSpan" id="kobo.935.1">ere --&gt;</span></strong><span class="koboSpan" id="kobo.936.1"> comment and should look </span><span class="No-Break"><span class="koboSpan" id="kobo.937.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.938.1">
&lt;StackLayout&gt;
  &lt;Content</span><a id="_idTextAnchor785"/><span class="koboSpan" id="kobo.939.1">View Padding=”10” BackgroundColor=”#9F5010”&gt;
    &lt;Label Text=”{Binding DateAsString}” TextColor=”White” FontAttributes=”Bold” /&gt;
  &lt;/ContentView&gt;
&lt;/StackLayout&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.940.1">Now that we have the date in the user interface, we need to add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.941.1">FlexLayout</span></strong><span class="koboSpan" id="kobo.942.1"> property, which will repeat through any items in </span><strong class="source-inline"><span class="koboSpan" id="kobo.943.1">MainViewModel</span></strong><span class="koboSpan" id="kobo.944.1">. </span><span class="koboSpan" id="kobo.944.2">Perform the following steps to </span><span class="No-Break"><span class="koboSpan" id="kobo.945.1">do so:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.946.1">Add </span><strong class="source-inline"><span class="koboSpan" id="kobo.947.1">FlexLayout</span></strong><span class="koboSpan" id="kobo.948.1"> after the </span><strong class="source-inline"><span class="koboSpan" id="kobo.949.1">&lt;/ContentView&gt;</span></strong><span class="koboSpan" id="kobo.950.1"> tag but before the </span><strong class="source-inline"><span class="koboSpan" id="kobo.951.1">&lt;/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.952.1">StackLayout&gt;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.953.1"> tag.</span></span></li>
<li><span class="koboSpan" id="kobo.954.1">Set </span><strong class="source-inline"><span class="koboSpan" id="kobo.955.1">JustifyContent</span></strong><span class="koboSpan" id="kobo.956.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.957.1">Start</span></strong><span class="koboSpan" id="kobo.958.1"> to set the items so that they’re added from the left-hand side, without distributing them over the </span><span class="No-Break"><span class="koboSpan" id="kobo.959.1">available space.</span></span></li>
<li><span class="koboSpan" id="kobo.960.1">Set </span><strong class="source-inline"><span class="koboSpan" id="kobo.961.1">AlignItems</span></strong><span class="koboSpan" id="kobo.962.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.963.1">Start</span></strong><span class="koboSpan" id="kobo.964.1"> to set the content to the left of each item in </span><a id="_idTextAnchor786"/><strong class="source-inline"><span class="koboSpan" id="kobo.965.1">FlexLayout</span></strong><span class="koboSpan" id="kobo.966.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.967.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.968.1">
&lt;FlexLayout BindableLayout.ItemsSource=”{Binding Items}” Wrap=”Wrap” JustifyContent=”Start” AlignItems=”Start”&gt;
&lt;/FlexLayout&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.969.1">After defining </span><strong class="source-inline"><span class="koboSpan" id="kobo.970.1">FlexLayout</span></strong><span class="koboSpan" id="kobo.971.1">, we need to provide an </span><strong class="source-inline"><span class="koboSpan" id="kobo.972.1">ItemsTemplate</span></strong><span class="koboSpan" id="kobo.973.1"> property, which defines </span><a id="_idIndexMarker838"/><span class="koboSpan" id="kobo.974.1">how each item in the list should be rendered. </span><span class="koboSpan" id="kobo.974.2">Continue </span><a id="_idIndexMarker839"/><span class="koboSpan" id="kobo.975.1">adding the XAML directly under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.976.1">&lt;FlexLayout&gt;</span></strong><span class="koboSpan" id="kobo.977.1"> tag you just added, </span><span class="No-Break"><span class="koboSpan" id="kobo.978.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.979.1">Set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.980.1">ItemsTemplate</span></strong><span class="koboSpan" id="kobo.981.1"> property </span><span class="No-Break"><span class="koboSpan" id="kobo.982.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.983.1">DataTemplate</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.984.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.985.1">FillDataTemplate</span></strong><span class="koboSpan" id="kobo.986.1"> with elements, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.987.1">following code:</span></span></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.988.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.989.1">If we want to add formatting to a binding, we can use </span><strong class="source-inline"><span class="koboSpan" id="kobo.990.1">StringFormat</span></strong><span class="koboSpan" id="kobo.991.1">. </span><span class="koboSpan" id="kobo.991.2">In this case, we want to add the degree symbol after the temperature. </span><span class="koboSpan" id="kobo.991.3">We can do this by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.992.1">{Binding Temperature, StringFormat=’{0}° C’}</span></strong><span class="koboSpan" id="kobo.993.1"> phrase. </span><span class="koboSpan" id="kobo.993.2">With the </span><strong class="source-inline"><span class="koboSpan" id="kobo.994.1">StringFormat</span></strong><span class="koboSpan" id="kobo.995.1"> property of the binding, we can format data with the same arguments that we would use if we were to do this in C#. </span><span class="koboSpan" id="kobo.995.2">This is the same as </span><strong class="source-inline"><span class="koboSpan" id="kobo.996.1">string.Format(“{0}° C”, Temperature)</span></strong><span class="koboSpan" id="kobo.997.1"> in C#. </span><span class="koboSpan" id="kobo.997.2">We can also use it to format a date; for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.998.1">{Binding Date, StringFormat=’yyyy’}</span></strong><span class="koboSpan" id="kobo.999.1">. </span><span class="koboSpan" id="kobo.999.2">In C#</span><a id="_idTextAnchor787"/><span class="koboSpan" id="kobo.1000.1">, this would look </span><span class="No-Break"><span class="koboSpan" id="kobo.1001.1">like </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1002.1">Date.ToString(“yyyy”)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1003.1">.</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1004.1">
&lt;BindableLayout.ItemTemplate&gt;
  &lt;DataTemplate&gt;
    &lt;StackLayout Margin=”10” Padding=”20” WidthRequest=”150” BackgroundColor=”#99FFFFFF”&gt;
      &lt;Label FontSize=”16” FontAttributes=”Bold” Text=”{Binding TimeAsString}” HorizontalOptions=”Center” /&gt;
     </span><a id="_idTextAnchor788"/><span class="koboSpan" id="kobo.1005.1"> &lt;Image WidthRequest=”100” HeightRequest=”100” Aspect=”AspectFit” Horizont</span><a id="_idTextAnchor789"/><span class="koboSpan" id="kobo.1006.1">alOptions=”Center” Source=”{Binding Icon}” /&gt;
      &lt;Label FontSize=”14” FontAttributes=”Bold” Text=”{Binding Temperature, StringFormat=’{0}° C’}” HorizontalOptions=”Center” /&gt;
      &lt;Label FontSize=”14” FontAttributes=”Bold” Text=”{Binding Description}” HorizontalOptions=”Center” /&gt;
    &lt;/StackLayout&gt;
  &lt;/DataTemplate&gt;
&lt;/BindableLayout.ItemTemplate&gt;</span></pre> <p class="callout-heading"><span class="koboSpan" id="kobo.1007.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1008.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1009.1">AspectFill</span></strong><span class="koboSpan" id="kobo.1010.1"> phrase, as a value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1011.1">Aspect</span></strong><span class="koboSpan" id="kobo.1012.1"> property for </span><strong class="source-inline"><span class="koboSpan" id="kobo.1013.1">Image</span></strong><span class="koboSpan" id="kobo.1014.1">, means that the whole image will always be visible and that the aspects will not be changed. </span><span class="koboSpan" id="kobo.1014.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1015.1">AspectFit</span></strong><span class="koboSpan" id="kobo.1016.1"> phrase will also keep the aspect of an image, but the image can be zoomed into and out of and cropped so that it fills the whole </span><strong class="source-inline"><span class="koboSpan" id="kobo.1017.1">Image</span></strong><span class="koboSpan" id="kobo.1018.1"> element. </span><span class="koboSpan" id="kobo.1018.2">The last value that </span><strong class="source-inline"><span class="koboSpan" id="kobo.1019.1">Aspect</span></strong><span class="koboSpan" id="kobo.1020.1"> can be set to, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1021.1">Fill</span></strong><span class="koboSpan" id="kobo.1022.1">, means that the image can be stretched or compressed to match the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1023.1">Image</span></strong> <a id="_idTextAnchor790"/><a id="_idTextAnchor791"/><a id="_idTextAnchor792"/><span class="koboSpan" id="kobo.1024.1">view to ensure that the aspect ratio </span><span class="No-Break"><span class="koboSpan" id="kobo.1025.1">is kept.</span></span></p>
<h3><span class="koboSpan" id="kobo.1026.1">Adding a toolbar item to refresh the weather data</span></h3>
<p><span class="koboSpan" id="kobo.1027.1">To be able to refresh the data without restarting the app, we will add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1028.1">Refresh</span></strong><span class="koboSpan" id="kobo.1029.1"> button </span><a id="_idIndexMarker840"/><span class="koboSpan" id="kobo.1030.1">to the toolbar. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1031.1">MainViewModel</span></strong><span class="koboSpan" id="kobo.1032.1"> is responsible for handling any logic that we want to perform, and we </span><a id="_idIndexMarker841"/><span class="koboSpan" id="kobo.1033.1">must expose any action as an </span><strong class="source-inline"><span class="koboSpan" id="kobo.1034.1">ICommand</span></strong><span class="koboSpan" id="kobo.1035.1"> bindable that we can </span><span class="No-Break"><span class="koboSpan" id="kobo.1036.1">bind to.</span></span></p>
<p><span class="koboSpan" id="kobo.1037.1">Let’s start by creating the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1038.1">Refresh</span></strong><span class="koboSpan" id="kobo.1039.1"> command method </span><span class="No-Break"><span class="koboSpan" id="kobo.1040.1">on </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1041.1">MainViewModel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1042.1">:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1043.1">Open the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1044.1">MainViewModel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1045.1"> class.</span></span></li>
<li><span class="koboSpan" id="kobo.1046.1">Add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1047.1">using</span></strong><span class="koboSpan" id="kobo.1048.1"> declaration </span><span class="No-Break"><span class="koboSpan" id="kobo.1049.1">for </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1050.1">CommunityToolkit.Mvvm.Input</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1051.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1052.1">
using System.Collections.ObjectModel;
using CommunityToolkit.Mvvm.ComponentModel;
</span><strong class="bold"><span class="koboSpan" id="kobo.1053.1">using CommunityToolkit.Mvvm.Input;</span></strong><span class="koboSpan" id="kobo.1054.1">
using Weather.Models;
using Weather.Services;</span></pre></li> <li><span class="koboSpan" id="kobo.1055.1">Add a method called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1056.1">RefreshAsync</span></strong><span class="koboSpan" id="kobo.1057.1"> that calls the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1058.1">LoadDataAsync</span></strong><span class="koboSpan" id="kobo.1059.1"> method, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1060.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1061.1">
    public async Task RefreshAsync()
    {
        await LoadDataAsync();
    }</span></pre></li> <li><span class="koboSpan" id="kobo.1062.1">Since </span><a id="_idIndexMarker842"/><span class="koboSpan" id="kobo.1063.1">these methods </span><a id="_idIndexMarker843"/><span class="koboSpan" id="kobo.1064.1">are asynchronous, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1065.1">Refresh</span></strong><span class="koboSpan" id="kobo.1066.1"> will return </span><strong class="source-inline"><span class="koboSpan" id="kobo.1067.1">Task</span></strong><span class="koboSpan" id="kobo.1068.1">, and we can use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1069.1">async</span></strong><span class="koboSpan" id="kobo.1070.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1071.1">await</span></strong><span class="koboSpan" id="kobo.1072.1"> to call </span><strong class="source-inline"><span class="koboSpan" id="kobo.1073.1">LoadDataAsync</span></strong><span class="koboSpan" id="kobo.1074.1"> without blocking the </span><span class="No-Break"><span class="koboSpan" id="kobo.1075.1">UI thread.</span></span></li>
<li><span class="koboSpan" id="kobo.1076.1">Add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1077.1">RelayCommand</span></strong><span class="koboSpan" id="kobo.1078.1"> attribute to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1079.1">RefreshAsync</span></strong><span class="koboSpan" id="kobo.1080.1"> method to auto-generate the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1081.1">ICommand</span></strong><span class="koboSpan" id="kobo.1082.1"> bindable property to </span><span class="No-Break"><span class="koboSpan" id="kobo.1083.1">the method:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1084.1">[RelayCommand]</span></strong><span class="koboSpan" id="kobo.1085.1">
    public async Task RefreshA</span><a id="_idTextAnchor793"/><span class="koboSpan" id="kobo.1086.1">sync()
    {
        await LoadDataAsync();
    }</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1087.1">Now that we have defined the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1088.1">Refresh</span></strong><span class="koboSpan" id="kobo.1089.1"> command, we need to bind it to the user interface so that when the user clicks the toolbar button, the action will </span><span class="No-Break"><span class="koboSpan" id="kobo.1090.1">be executed.</span></span></p>
<p><span class="koboSpan" id="kobo.1091.1">To do this, perform the </span><span class="No-Break"><span class="koboSpan" id="kobo.1092.1">following steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1093.1">Open the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1094.1">MainView.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1095.1"> file.</span></span></li>
<li><span class="koboSpan" id="kobo.1096.1">Download the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1097.1">refresh.png</span></strong><span class="koboSpan" id="kobo.1098.1"> file from </span><a href="https://raw.githubusercontent.com/PacktPublishing/MAUI-Projects-3rd-Edition/main/Chapter08/Weather/Resources/Images/refresh.png"><span class="koboSpan" id="kobo.1099.1">https://raw.githubusercontent.com/PacktPublishing/MAUI-Projects-3rd-Edition/main/Chapter08/Weather/Resources/Images/refresh.png</span></a><span class="koboSpan" id="kobo.1100.1"> and save it to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1101.1">Resources/Images</span></strong><span class="koboSpan" id="kobo.1102.1"> folder of </span><span class="No-Break"><span class="koboSpan" id="kobo.1103.1">the project.</span></span></li>
<li><span class="koboSpan" id="kobo.1104.1">Add a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.1105.1">ToolbarItem</span></strong><span class="koboSpan" id="kobo.1106.1"> with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1107.1">Text</span></strong><span class="koboSpan" id="kobo.1108.1"> property set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1109.1">Refresh</span></strong><span class="koboSpan" id="kobo.1110.1"> to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1111.1">ToolbarItems</span></strong><span class="koboSpan" id="kobo.1112.1"> property of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1113.1">ContentPage</span></strong><span class="koboSpan" id="kobo.1114.1"> and set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1115.1">IconImageSource</span></strong><span class="koboSpan" id="kobo.1116.1"> property to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1117.1">refresh.png</span></strong><span class="koboSpan" id="kobo.1118.1"> (alternatively, you can set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1119.1">IconImageSource</span></strong><span class="koboSpan" id="kobo.1120.1"> property to the URL of the image and .NET MAUI will download </span><span class="No-Break"><span class="koboSpan" id="kobo.1121.1">the image).</span></span></li>
<li><span class="koboSpan" id="kobo.1122.1">Bind the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1123.1">Command</span></strong><span class="koboSpan" id="kobo.1124.1"> property to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1125.1">Refresh</span></strong><span class="koboSpan" id="kobo.1126.1"> property </span><a id="_idTextAnchor794"/><span class="koboSpan" id="kobo.1127.1">in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1128.1">MainViewModel</span></strong><span class="koboSpan" id="kobo.1129.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1130.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1131.1">
&lt;ContentPage.ToolbarItems&gt;
  &lt;ToolbarItem IconImageSource=”refresh.png” Text=”Refresh” Command=”{Binding RefreshCommand}” /&gt;
&lt;/ContentPage.ToolbarItems&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1132.1">That’s </span><a id="_idIndexMarker844"/><span class="koboSpan" id="kobo.1133.1">all for refreshing </span><a id="_idIndexMarker845"/><span class="koboSpan" id="kobo.1134.1">the data. </span><span class="koboSpan" id="kobo.1134.2">N</span><a id="_idTextAnchor795"/><span class="koboSpan" id="kobo.1135.1">ow, we ne</span><a id="_idTextAnchor796"/><a id="_idTextAnchor797"/><span class="koboSpan" id="kobo.1136.1">ed some kind of indicator that the data </span><span class="No-Break"><span class="koboSpan" id="kobo.1137.1">is loading.</span></span></p>
<h4><span class="koboSpan" id="kobo.1138.1">Adding a loading indicator</span></h4>
<p><span class="koboSpan" id="kobo.1139.1">When we </span><a id="_idIndexMarker846"/><span class="koboSpan" id="kobo.1140.1">refresh the data, we want to show a loading indicator so that the user knows that something is happening. </span><span class="koboSpan" id="kobo.1140.2">To do this, we will add </span><strong class="source-inline"><span class="koboSpan" id="kobo.1141.1">ActivityIndicator</span></strong><span class="koboSpan" id="kobo.1142.1">, which is what this control is called in .NET MAUI. </span><span class="koboSpan" id="kobo.1142.2">Let’s set </span><span class="No-Break"><span class="koboSpan" id="kobo.1143.1">this up:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1144.1">Open the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1145.1">MainViewModel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1146.1"> class.</span></span></li>
<li><span class="koboSpan" id="kobo.1147.1">Add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1148.1">Boolean</span></strong><span class="koboSpan" id="kobo.1149.1"> field called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1150.1">isRefreshing</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1151.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1152.1">MainViewModel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1153.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1154.1">Add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1155.1">ObservableProperty</span></strong><span class="koboSpan" id="kobo.1156.1"> attribute to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1157.1">isRefreshingField</span></strong><span class="koboSpan" id="kobo.1158.1"> to generate the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1159.1">IPropertyChanged</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1160.1"> implementation.</span></span></li>
<li><span class="koboSpan" id="kobo.1161.1">Set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1162.1">IsRefreshing</span></strong><span class="koboSpan" id="kobo.1163.1"> property to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1164.1">true</span></strong><span class="koboSpan" id="kobo.1165.1"> at the beginning of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1166.1">LoadDataAsync</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1167.1"> method.</span></span></li>
<li><span class="koboSpan" id="kobo.1168.1">At the end of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1169.1">LoadDataAsync</span></strong><span class="koboSpan" id="kobo.1170.1"> method, set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1171.1">IsRefreshing</span></strong><span class="koboSpan" id="kobo.1172.1"> property to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1173.1">false</span></strong><span class="koboSpan" id="kobo.1174.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1175.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1176.1">
    [ObservableProperty]
    private bool isRefreshing;
....// The rest of the code</span><a id="_idTextAnchor798"/><span class="koboSpan" id="kobo.1177.1"> is omitted for brevity
pub</span><a id="_idTextAnchor799"/><span class="koboSpan" id="kobo.1178.1">lic async Task LoadData()
{
    IsRefreshing = true;
....// The rest of the code is omitted for brevity
    IsRefreshing = false;
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1179.1">Now that we </span><a id="_idIndexMarker847"/><span class="koboSpan" id="kobo.1180.1">have added some code to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1181.1">MainViewModel</span></strong><span class="koboSpan" id="kobo.1182.1">, we need to bind the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1183.1">IsRefreshing</span></strong><span class="koboSpan" id="kobo.1184.1"> property to a user interface element that will be displayed when the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1185.1">IsRefreshing</span></strong><span class="koboSpan" id="kobo.1186.1"> property is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1187.1">true</span></strong><span class="koboSpan" id="kobo.1188.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1189.1">following steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1190.1">In </span><strong class="source-inline"><span class="koboSpan" id="kobo.1191.1">MainView.xaml</span></strong><span class="koboSpan" id="kobo.1192.1">, add </span><strong class="source-inline"><span class="koboSpan" id="kobo.1193.1">Frame</span></strong><span class="koboSpan" id="kobo.1194.1"> after </span><strong class="source-inline"><span class="koboSpan" id="kobo.1195.1">ScrollView</span></strong><span class="koboSpan" id="kobo.1196.1"> as the last element </span><span class="No-Break"><span class="koboSpan" id="kobo.1197.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1198.1">Grid</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1199.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1200.1">Bind the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1201.1">IsVisible</span></strong><span class="koboSpan" id="kobo.1202.1"> property to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1203.1">IsRefreshing</span></strong><span class="koboSpan" id="kobo.1204.1"> method that we created </span><span class="No-Break"><span class="koboSpan" id="kobo.1205.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1206.1">MainViewModel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1207.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1208.1">Set </span><strong class="source-inline"><span class="koboSpan" id="kobo.1209.1">HeightRequest</span></strong><span class="koboSpan" id="kobo.1210.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1211.1">WidthRequest</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1212.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1213.1">100</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1214.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1215.1">Set </span><strong class="source-inline"><span class="koboSpan" id="kobo.1216.1">VerticalOptions</span></strong><span class="koboSpan" id="kobo.1217.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1218.1">HorizontalOptions</span></strong><span class="koboSpan" id="kobo.1219.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1220.1">Center</span></strong><span class="koboSpan" id="kobo.1221.1"> so that </span><strong class="source-inline"><span class="koboSpan" id="kobo.1222.1">Frame</span></strong><span class="koboSpan" id="kobo.1223.1"> will be in the middle of </span><span class="No-Break"><span class="koboSpan" id="kobo.1224.1">the view.</span></span></li>
<li><span class="koboSpan" id="kobo.1225.1">Set </span><strong class="source-inline"><span class="koboSpan" id="kobo.1226.1">BackgroundColor</span></strong><span class="koboSpan" id="kobo.1227.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1228.1">#99000000</span></strong><span class="koboSpan" id="kobo.1229.1"> to set the background to white with a little bit </span><span class="No-Break"><span class="koboSpan" id="kobo.1230.1">of transparency.</span></span></li>
<li><span class="koboSpan" id="kobo.1231.1">Add </span><strong class="source-inline"><span class="koboSpan" id="kobo.1232.1">ActivityIndicator</span></strong><span class="koboSpan" id="kobo.1233.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1234.1">Frame</span></strong><span class="koboSpan" id="kobo.1235.1"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1236.1">Color</span></strong><span class="koboSpan" id="kobo.1237.1"> set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1238.1">Black</span></strong><span class="koboSpan" id="kobo.1239.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1240.1">I</span><a id="_idTextAnchor800"/><span class="koboSpan" id="kobo.1241.1">sRunning</span></strong><span class="koboSpan" id="kobo.1242.1"> set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1243.1">True</span></strong><span class="koboSpan" id="kobo.1244.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1245.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1246.1">
&lt;Frame IsVisible=”{Binding IsRefreshing}” BackgroundColor=”#99FFFFFF” WidthRequest=”100” HeightRequest=”100” VerticalOptions=”Center” HorizontalOptions=”Center”&gt;
  &lt;ActivityIndicator Color=”Black” IsRunning=”True” /&gt;
&lt;/Frame&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1247.1">This will </span><a id="_idIndexMarker848"/><span class="koboSpan" id="kobo.1248.1">create a spinner that will be visible while data is loading, which is a really good practice when creating any user in</span><a id="_idTextAnchor801"/><span class="koboSpan" id="kobo.1249.1">terface. </span><span class="koboSpan" id="kobo.1249.2">Now, we’ll ad</span><a id="_idTextAnchor802"/><span class="koboSpan" id="kobo.1250.1">d a background image to make the app look a </span><span class="No-Break"><span class="koboSpan" id="kobo.1251.1">bit nicer.</span></span></p>
<h3><span class="koboSpan" id="kobo.1252.1">Setting a background image</span></h3>
<p><span class="koboSpan" id="kobo.1253.1">The last thing we will do to this view, for the moment, is add a background image. </span><span class="koboSpan" id="kobo.1253.2">The image we </span><a id="_idIndexMarker849"/><span class="koboSpan" id="kobo.1254.1">will be using in this example is a result of a Google search for images that are free to use. </span><span class="koboSpan" id="kobo.1254.2">Let’s set </span><span class="No-Break"><span class="koboSpan" id="kobo.1255.1">this up:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1256.1">Open the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1257.1">MainView.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1258.1"> file.</span></span></li>
<li><span class="koboSpan" id="kobo.1259.1">Se</span><a id="_idTextAnchor803"/><span class="koboSpan" id="kobo.1260.1">t the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1261.1">Background</span></strong><span class="koboSpan" id="kobo.1262.1"> property of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1263.1">ScrollView</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1264.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1265.1">Transparent</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1266.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1267.1">Add an </span><strong class="source-inline"><span class="koboSpan" id="kobo.1268.1">Image</span></strong><span class="koboSpan" id="kobo.1269.1"> element in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1270.1">Grid</span></strong><span class="koboSpan" id="kobo.1271.1"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1272.1">UriImageSource</span></strong><span class="koboSpan" id="kobo.1273.1"> as the value of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1274.1">Source</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1275.1"> property.</span></span></li>
<li><span class="koboSpan" id="kobo.1276.1">Set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1277.1">CachingEnabled</span></strong><span class="koboSpan" id="kobo.1278.1"> property to true and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1279.1">CacheValidity</span></strong><span class="koboSpan" id="kobo.1280.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1281.1">5</span></strong><span class="koboSpan" id="kobo.1282.1">. </span><span class="koboSpan" id="kobo.1282.2">This means that the image will be cached for </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1283.1">5</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1284.1"> days.</span></span></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1285.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1286.1">You could also set these properties if you used a URL for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1287.1">Refresh</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.1288.1">IconImageSource</span></strong><span class="koboSpan" id="kobo.1289.1"> property to avoid downloading the image on every run of </span><span class="No-Break"><span class="koboSpan" id="kobo.1290.1">the app.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.1291.1">The XAML should now look </span><span class="No-Break"><span class="koboSpan" id="kobo.1292.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1293.1">
&lt;ContentPage xmlns=”http://schemas.microsoft.com/dotnet/2021/maui”
             xmlns:x=”http://schemas.microsoft.com/winfx/2009/xaml”
    x:Class=”Weather.Views.Desktop.MainView”
    Title=”{Binding City}”&gt;
  &lt;ContentPage.ToolbarItems&gt;
    &lt;ToolbarItem Icon=”refresh.png” Text=”Refresh” Command=”{Binding Ref</span><a id="_idTextAnchor804"/><a id="_idTextAnchor805"/><span class="koboSpan" id="kobo.1294.1">reshCommand}” /&gt;
  &lt;/ContentPage.ToolbarItems&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.1295.1">  &lt;Grid&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1296.1">    &lt;Image Aspect=”AspectFill”&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1297.1">      &lt;Image.Source&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1298.1">        &lt;UriImageSource Uri=”https://upload.wikimedia.org/wikipedia/commons/7/79/Solnedg%C3%A5ng_%C3%B6ver_Laholmsbukten_augusti_2011.jpg” CachingEnabled=”true” CacheValidity=”5” /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1299.1">      &lt;/Image.Source&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1300.1">    &lt;/Image&gt;</span></strong><span class="koboSpan" id="kobo.1301.1">
    &lt;ScrollView </span><strong class="bold"><span class="koboSpan" id="kobo.1302.1">BackgroundColor=”Transparent”</span></strong><span class="koboSpan" id="kobo.1303.1">&gt;
&lt;!-- The rest of the code is omitted for brevity --&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1304.1">We can </span><a id="_idIndexMarker850"/><span class="koboSpan" id="kobo.1305.1">also set the URL directly in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1306.1">Source</span></strong><span class="koboSpan" id="kobo.1307.1"> property by using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1308.1">&lt;Image Source=”https://ourgrea</span><a id="_idTextAnchor806"/><span class="koboSpan" id="kobo.1309.1">timage.url” /&gt;</span></strong><span class="koboSpan" id="kobo.1310.1">. </span><span class="koboSpan" id="kobo.1310.2">However, if we do this, we can’t specify caching for </span><span class="No-Break"><span class="koboSpan" id="kobo.1311.1">the image.</span></span></p>
<p><span class="koboSpan" id="kobo.1312.1">With the desktop view complete, we need to consider how this page wil</span><a id="_idTextAnchor807"/><span class="koboSpan" id="kobo.1313.1">l look when we are running the app on a phone </span><span class="No-Break"><span class="koboSpan" id="kobo.1314.1">or tablet.</span></span></p>
<h2 id="_idParaDest-143"><a id="_idTextAnchor808"/><span class="koboSpan" id="kobo.1315.1">Creating the view for phones</span></h2>
<p><span class="koboSpan" id="kobo.1316.1">Structuring content on a tablet and a desktop computer is very similar in many ways. </span><span class="koboSpan" id="kobo.1316.2">On phones, however, we are much more limited in what we can do. </span><span class="koboSpan" id="kobo.1316.3">Therefore, in this section, we will </span><a id="_idIndexMarker851"/><span class="koboSpan" id="kobo.1317.1">create a specific view for this app when it’s </span><a id="_idIndexMarker852"/><span class="koboSpan" id="kobo.1318.1">used on phones. </span><span class="koboSpan" id="kobo.1318.2">To do so, perform the </span><span class="No-Break"><span class="koboSpan" id="kobo.1319.1">following steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1320.1">Create a new XAML-based </span><strong class="bold"><span class="koboSpan" id="kobo.1321.1">ContentPage</span></strong><span class="koboSpan" id="kobo.1322.1"> in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1323.1">Views</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1324.1"> folder.</span></span></li>
<li><span class="koboSpan" id="kobo.1325.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1326.1">Views</span></strong><span class="koboSpan" id="kobo.1327.1"> folder, create a new folder </span><span class="No-Break"><span class="koboSpan" id="kobo.1328.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1329.1">Mobile</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1330.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1331.1">Create a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.1332.1">.NET MAUI ContentPage (XAML)</span></strong><span class="koboSpan" id="kobo.1333.1"> file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1334.1">MainView</span></strong><span class="koboSpan" id="kobo.1335.1"> in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1336.1">Views\Mobile</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1337.1"> folder:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer143">
<span class="koboSpan" id="kobo.1338.1"><img alt="Figure 8.9 – Adding a .NET MAUI XAML ContentPage" src="image/B19214_08_9..jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1339.1">Figure 8.9 – Adding a .NET MAUI XAML ContentPage</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.1340.1">Pass an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1341.1">MainViewModel</span></strong><span class="koboSpan" id="kobo.1342.1"> in the constructor of the view to set </span><strong class="source-inline"><span class="koboSpan" id="kobo.1343.1">BindingContext</span></strong><span class="koboSpan" id="kobo.1344.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1345.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1346.1">
public MainView (</span><strong class="bold"><span class="koboSpan" id="kobo.1347.1">MainViewModel mainViewModel</span></strong><span class="koboSpan" id="kobo.1348.1">)
{
    InitializeComponent();
    </span><strong class="bold"><span class="koboSpan" id="kobo.1349.1">BindingContext = mainViewModel;</span></strong><span class="koboSpan" id="kobo.1350.1">
}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1351.1">Later, in the </span><em class="italic"><span class="koboSpan" id="kobo.1352.1">Adding services and ViewModels to dependency injection</span></em><span class="koboSpan" id="kobo.1353.1"> section, we will config</span><a id="_idTextAnchor809"/><a id="_idTextAnchor810"/><a id="_idTextAnchor811"/><a id="_idTextAnchor812"/><a id="_idTextAnchor813"/><span class="koboSpan" id="kobo.1354.1">ure dependency injection to provide the instances </span><span class="No-Break"><span class="koboSpan" id="kobo.1355.1">for us.</span></span></p></li> </ol>
<p><span class="koboSpan" id="kobo.1356.1">To trigger the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1357.1">LoadDataAsync</span></strong><span class="koboSpan" id="kobo.1358.1"> method in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1359.1">MainViewModel</span></strong><span class="koboSpan" id="kobo.1360.1">, call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1361.1">LoadDataAsync</span></strong><span class="koboSpan" id="kobo.1362.1"> method by overriding the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1363.1">OnNavigatedTo</span></strong><span class="koboSpan" id="kobo.1364.1"> method on the main thread. </span><span class="koboSpan" id="kobo.1364.2">We need </span><a id="_idIndexMarker853"/><span class="koboSpan" id="kobo.1365.1">to make sure that the call is executed on </span><a id="_idIndexMarker854"/><span class="koboSpan" id="kobo.1366.1">the UI thread since it will interact with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1367.1">user interface.</span></span></p>
<p><span class="koboSpan" id="kobo.1368.1">To do this, perform the </span><span class="No-Break"><span class="koboSpan" id="kobo.1369.1">following steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1370.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1371.1">MainView.xaml.cs</span></strong><span class="koboSpan" id="kobo.1372.1"> file in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1373.1">Views\Mobile</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1374.1"> folder.</span></span></li>
<li><span class="koboSpan" id="kobo.1375.1">Create an override of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1376.1">OnNavigatedTo</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1377.1"> method.</span></span></li>
<li><span class="koboSpan" id="kobo.1378.1">Add the highlighted code in the following snippet to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1379.1">OnNavigateTo</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1380.1"> method:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1381.1">
    protected override void OnNavigatedTo(NavigatedToEventArgs args)
    {
        base.OnNavigatedTo(args);
</span><strong class="bold"><span class="koboSpan" id="kobo.1382.1">        if (BindingContext is MainViewModel viewModel)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1383.1">        {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1384.1">            MainThread.BeginInvokeOnMainThread(async () =&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1385.1">            {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1386.1">                await viewModel.LoadDataAsync();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1387.1">            });</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1388.1">        }</span></strong><span class="koboSpan" id="kobo.1389.1">
    }</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1390.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1391.1">MainView</span></strong><span class="koboSpan" id="kobo.1392.1"> XAML file, add a binding for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1393.1">Title</span></strong><span class="koboSpan" id="kobo.1394.1"> property of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1395.1">ContentPage</span></strong><span class="koboSpan" id="kobo.1396.1"> to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1397.1">City</span></strong><span class="koboSpan" id="kobo.1398.1"> property in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1399.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1400.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.1401.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1402.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1403.1">MainView.xaml</span></strong><span class="koboSpan" id="kobo.1404.1"> file in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1405.1">Views\Mobile</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1406.1"> folder.</span></span></li>
<li><span class="koboSpan" id="kobo.1407.1">Add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1408.1">Title</span></strong><span class="koboSpan" id="kobo.1409.1"> binding to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1410.1">ContentPage</span></strong><span class="koboSpan" id="kobo.1411.1"> element, as highlighted in the following </span><span class="No-Break"><span class="koboSpan" id="kobo.1412.1">code snippet:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1413.1">
&lt;ContentPage xmlns=”http://schemas.microsoft.com/dotnet/2021/maui”
             xmlns:x=”http://schemas.microsoft.com/winfx/2009/xaml”
    x:Class=”Weather.Views.Desktop.MainView”
    </span><strong class="bold"><span class="koboSpan" id="kobo.1414.1">Title=”{Binding City}”</span></strong><span class="koboSpan" id="kobo.1415.1">&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1416.1">In the </span><a id="_idIndexMarker855"/><span class="koboSpan" id="kobo.1417.1">next section, we will use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1418.1">CollectionView</span></strong><span class="koboSpan" id="kobo.1419.1"> to display </span><a id="_idIndexMarker856"/><span class="koboSpan" id="kobo.1420.1">the weather data instead of using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1421.1">FlexView</span></strong><span class="koboSpan" id="kobo.1422.1">, as we did for the </span><span class="No-Break"><span class="koboSpan" id="kobo.1423.1">desktop view.</span></span></p>
<h3><span class="koboSpan" id="kobo.1424.1">Using a grouped CollectionView</span></h3>
<p><span class="koboSpan" id="kobo.1425.1">We could use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1426.1">FlexLayout</span></strong><span class="koboSpan" id="kobo.1427.1"> for the phone’s view, but because we want our user experience </span><a id="_idIndexMarker857"/><span class="koboSpan" id="kobo.1428.1">to be as good as possible, we will use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1429.1">CollectionView</span></strong><span class="koboSpan" id="kobo.1430.1"> instead. </span><span class="koboSpan" id="kobo.1430.2">To get the headers for each day, we will use grouping for </span><strong class="source-inline"><span class="koboSpan" id="kobo.1431.1">CollectionView</span></strong><span class="koboSpan" id="kobo.1432.1">. </span><span class="koboSpan" id="kobo.1432.2">For </span><strong class="source-inline"><span class="koboSpan" id="kobo.1433.1">FlexLayout</span></strong><span class="koboSpan" id="kobo.1434.1">, we had </span><strong class="source-inline"><span class="koboSpan" id="kobo.1435.1">ScrollView</span></strong><span class="koboSpan" id="kobo.1436.1">, but for </span><strong class="source-inline"><span class="koboSpan" id="kobo.1437.1">CollectionView</span></strong><span class="koboSpan" id="kobo.1438.1">, we don’t need this because </span><strong class="source-inline"><span class="koboSpan" id="kobo.1439.1">CollectionView</span></strong><span class="koboSpan" id="kobo.1440.1"> can handle scrolling </span><span class="No-Break"><span class="koboSpan" id="kobo.1441.1">by default.</span></span></p>
<p><span class="koboSpan" id="kobo.1442.1">Let’s continue creating the user interface for the </span><span class="No-Break"><span class="koboSpan" id="kobo.1443.1">phone’s view:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1444.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1445.1">MainView.xaml</span></strong><span class="koboSpan" id="kobo.1446.1"> file in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1447.1">Views\Mobile</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1448.1"> folder.</span></span></li>
<li><span class="koboSpan" id="kobo.1449.1">Add </span><strong class="source-inline"><span class="koboSpan" id="kobo.1450.1">CollectionView</span></strong><span class="koboSpan" id="kobo.1451.1"> to the root of </span><span class="No-Break"><span class="koboSpan" id="kobo.1452.1">the page.</span></span></li>
<li><span class="koboSpan" id="kobo.1453.1">Set a binding to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1454.1">Days</span></strong><span class="koboSpan" id="kobo.1455.1"> property in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1456.1">MainViewModel</span></strong><span class="koboSpan" id="kobo.1457.1"> for the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1458.1">ItemSource</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1459.1"> property.</span></span></li>
<li><span class="koboSpan" id="kobo.1460.1">Set </span><strong class="source-inline"><span class="koboSpan" id="kobo.1461.1">IsGrouped</span></strong><span class="koboSpan" id="kobo.1462.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1463.1">True</span></strong><span class="koboSpan" id="kobo.1464.1"> to enable grouping </span><span class="No-Break"><span class="koboSpan" id="kobo.1465.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1466.1">CollectionView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1467.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1468.1">Set </span><strong class="source-inline"><span class="koboSpan" id="kobo.1469.1">B</span><a id="_idTextAnchor814"/><span class="koboSpan" id="kobo.1470.1">ackgroundColor</span></strong><span class="koboSpan" id="kobo.1471.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1472.1">Transparent</span></strong><span class="koboSpan" id="kobo.1473.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1474.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1475.1">
&lt;CollectionView ItemsSource=”{Binding Days}” IsGrouped=”True” BackgroundColor=”Transparent”&gt;
&lt;/CollectionView&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1476.1">To format </span><a id="_idIndexMarker858"/><span class="koboSpan" id="kobo.1477.1">how each header will look, we will create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1478.1">DataTemplate</span></strong><span class="koboSpan" id="kobo.1479.1"> property, </span><span class="No-Break"><span class="koboSpan" id="kobo.1480.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1481.1">Add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1482.1">DataTemplate</span></strong><span class="koboSpan" id="kobo.1483.1"> property to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1484.1">GroupHeaderTemplate</span></strong><span class="koboSpan" id="kobo.1485.1"> property </span><span class="No-Break"><span class="koboSpan" id="kobo.1486.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1487.1">CollectionView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1488.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1489.1">Add the content for the row to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1490.1">DataTemplate</span></strong><span class="koboSpan" id="kobo.1491.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1492.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1493.1">
&lt;CollectionView ItemsSource=</span><a id="_idTextAnchor815"/><span class="koboSpan" id="kobo.1494.1">”{Binding Days}” IsGrouped=”True” BackgroundColor=”Transparent”&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.1495.1">  &lt;CollectionView.GroupHeaderTemplate&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1496.1">    &lt;DataTemplate&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1497.1">      &lt;ContentView Padding=”15,5” BackgroundColor=”#9F5010”&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1498.1">        &lt;Label FontAttributes=”Bold” TextColor=”White” Text=”{Binding DateAsString}” VerticalOptions=”Center”/&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1499.1">      &lt;/ContentView&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1500.1">    &lt;/DataTemp</span><a id="_idTextAnchor816"/><span class="koboSpan" id="kobo.1501.1">late&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1502.1">  &lt;/CollectionView.GroupHeaderTemplate&gt;</span></strong><span class="koboSpan" id="kobo.1503.1">
&lt;/CollectionView&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1504.1">To format how each forecast will look, we will create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1505.1">DataTemplate</span></strong><span class="koboSpan" id="kobo.1506.1"> property, as we did with the group header. </span><span class="koboSpan" id="kobo.1506.2">Let’s set </span><span class="No-Break"><span class="koboSpan" id="kobo.1507.1">this up:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1508.1">Add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1509.1">DataTemplate</span></strong><span class="koboSpan" id="kobo.1510.1"> property to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1511.1">ItemTemplate</span></strong><span class="koboSpan" id="kobo.1512.1"> property </span><span class="No-Break"><span class="koboSpan" id="kobo.1513.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1514.1">CollectionView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1515.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1516.1">In </span><strong class="source-inline"><span class="koboSpan" id="kobo.1517.1">DataTemplate</span></strong><span class="koboSpan" id="kobo.1518.1">, add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1519.1">Grid</span></strong><span class="koboSpan" id="kobo.1520.1"> property that contains four columns. </span><span class="koboSpan" id="kobo.1520.2">Use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1521.1">ColumnDefinition</span></strong><span class="koboSpan" id="kobo.1522.1"> property to specify the width of the columns. </span><span class="koboSpan" id="kobo.1522.2">The second column should be </span><strong class="source-inline"><span class="koboSpan" id="kobo.1523.1">50</span></strong><span class="koboSpan" id="kobo.1524.1">; the other three will share the rest of the space. </span><span class="koboSpan" id="kobo.1524.2">We will </span><a id="_idIndexMarker859"/><span class="koboSpan" id="kobo.1525.1">d</span><a id="_idTextAnchor817"/><span class="koboSpan" id="kobo.1526.1">o this by setting </span><strong class="source-inline"><span class="koboSpan" id="kobo.1527.1">Width</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1528.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1529.1">*</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1530.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1531.1">Add the following content </span><span class="No-Break"><span class="koboSpan" id="kobo.1532.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1533.1">Grid</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1534.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1535.1">
&lt;CollectionView.ItemTemplate&gt;
  &lt;DataTemplate&gt;
    &lt;Grid Padding=”15,10” ColumnSpacing=”10” </span><a id="_idTextAnchor818"/><span class="koboSpan" id="kobo.1536.1">BackgroundColor=”#99FFFFFF”&gt;
      &lt;Grid.ColumnDefinitions&gt;
        &lt;ColumnDefinition Width=”*” /&gt;
        &lt;ColumnDefinition Width=”50” /&gt;
        &lt;ColumnDefinition Width=”*” /&gt;
        &lt;ColumnDefinition Width=”*” /&gt;
      &lt;/Grid.ColumnDefinitions&gt;
      &lt;Label FontAttributes=”Bold” Text=”{Binding TimeAsString}” VerticalOptions=”Center” /&gt;
      &lt;Image Grid.Column=”1” HeightRequest=”50” WidthRequest=”50” Source=”{Binding Icon}” Aspect=”AspectFit” VerticalOptions=”Center” /&gt;
      &lt;Label Grid.Column=”2” Text=”{Binding Temperature, StringFormat=’{0}° C’}”
VerticalOptions=”Center” /&gt;
      &lt;Label Grid.Column=”3” Text=”{Binding Description}” VerticalOptions=”Center” </span><a id="_idTextAnchor819"/><a id="_idTextAnchor820"/><span class="koboSpan" id="kobo.1537.1">/&gt;
    &lt;/Grid&gt;
  &lt;/DataTemplate&gt;
&lt;/CollectionView.ItemTemplate&gt;</span></pre></li> </ol>
<h3><span class="koboSpan" id="kobo.1538.1">Adding pull-to-refresh functionality</span></h3>
<p><span class="koboSpan" id="kobo.1539.1">For the tablet and desktop versions of the view, we added a button to the toolbar to refresh </span><a id="_idIndexMarker860"/><span class="koboSpan" id="kobo.1540.1">the weather forecast. </span><span class="koboSpan" id="kobo.1540.2">In the phone version of the view, however, we will add pull-to-refresh functionality, which is a common way to refresh content in a list of data. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1541.1">CollectionView</span></strong><span class="koboSpan" id="kobo.1542.1"> in .NET </span><a id="_idTextAnchor821"/><span class="koboSpan" id="kobo.1543.1">MAUI has no built-in support for pull-to-refresh as </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1544.1">ListView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1545.1"> has.</span></span></p>
<p><span class="koboSpan" id="kobo.1546.1">Instead, we can use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1547.1">RefreshView</span></strong><span class="koboSpan" id="kobo.1548.1">. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1549.1">RefreshView</span></strong><span class="koboSpan" id="kobo.1550.1"> can be used to add pull-to-refresh behavior to any control. </span><span class="koboSpan" id="kobo.1550.2">Let’s set </span><span class="No-Break"><span class="koboSpan" id="kobo.1551.1">this up:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1552.1">Go </span><span class="No-Break"><span class="koboSpan" id="kobo.1553.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1554.1">Views\Mobile\MainView.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1555.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1556.1">Wrap </span><strong class="source-inline"><span class="koboSpan" id="kobo.1557.1">CollectionView</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1558.1">inside </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1559.1">RefreshView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1560.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1561.1">Bind the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1562.1">RefreshCommand</span></strong><span class="koboSpan" id="kobo.1563.1"> property in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1564.1">MainViewModel</span></strong><span class="koboSpan" id="kobo.1565.1"> to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1566.1">Command</span></strong><span class="koboSpan" id="kobo.1567.1"> property of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1568.1">RefreshView</span></strong><span class="koboSpan" id="kobo.1569.1"> to trigger a refresh when the user performs a </span><span class="No-Break"><span class="koboSpan" id="kobo.1570.1">pull-to-refresh gesture.</span></span></li>
<li><span class="koboSpan" id="kobo.1571.1">To show a loading icon when the refresh is in progress, bind the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1572.1">IsRefreshing</span></strong><span class="koboSpan" id="kobo.1573.1"> property in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1574.1">MainViewModel</span></strong><span class="koboSpan" id="kobo.1575.1"> to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1576.1">IsRefreshing</span></strong><span class="koboSpan" id="kobo.1577.1"> property of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1578.1">RefreshView</span></strong><span class="koboSpan" id="kobo.1579.1">. </span><span class="koboSpan" id="kobo.1579.2">When we are setting this up, we will also get a loading indicator </span><a id="_idTextAnchor822"/><span class="koboSpan" id="kobo.1580.1">when the initial load is running, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1581.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1582.1">
&lt;RefreshView Command=”{Binding Refresh}” IsRefreshing=”{Binding IsRefreshing}”&gt;
  &lt;CollectionView ItemsSource=”{Binding Days}” IsGrouped=”True” Backg</span><a id="_idTextAnchor823"/><a id="_idTextAnchor824"/><a id="_idTextAnchor825"/><span class="koboSpan" id="kobo.1583.1">roundColor=”Transparent”&gt;
....
  </span><span class="koboSpan" id="kobo.1583.2">&lt;/CollectionView&gt;
&lt;/RefreshView&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1584.1">That </span><a id="_idIndexMarker861"/><span class="koboSpan" id="kobo.1585.1">concludes the views for the moment. </span><span class="koboSpan" id="kobo.1585.2">Now, let’s wire them up into dependency injection so that we can see </span><span class="No-Break"><span class="koboSpan" id="kobo.1586.1">our work.</span></span></p>
<h2 id="_idParaDest-144"><a id="_idTextAnchor826"/><span class="koboSpan" id="kobo.1587.1">Adding services and ViewModels to dependency injection</span></h2>
<p><span class="koboSpan" id="kobo.1588.1">For </span><a id="_idIndexMarker862"/><span class="koboSpan" id="kobo.1589.1">our views to get an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1590.1">MainViewModel</span></strong><span class="koboSpan" id="kobo.1591.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1592.1">MainViewModel</span></strong><span class="koboSpan" id="kobo.1593.1"> to get an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1594.1">OpenWeatherMapWeatherService</span></strong><span class="koboSpan" id="kobo.1595.1">, we need to add them to dependency injection. </span><span class="koboSpan" id="kobo.1595.2">Let’s set </span><span class="No-Break"><span class="koboSpan" id="kobo.1596.1">this up:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1597.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1598.1">MauiProgram.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1599.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1600.1">Add the following </span><span class="No-Break"><span class="koboSpan" id="kobo.1601.1">highlighted code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1602.1">
#if DEBUG
    builder.Logging.AddDebug();
#endif
</span><strong class="bold"><span class="koboSpan" id="kobo.1603.1">    builder.Services.AddSingleton&lt;IWeatherService, OpenWeatherMapWeatherService&gt;();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1604.1">    builder.Services.AddTransient&lt;MainViewModel, MainViewModel&gt;();</span></strong><span class="koboSpan" id="kobo.1605.1">
    return builder.Build();</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1606.1">In the next section, we will add the navigation to the views based on the device’s </span><span class="No-Break"><span class="koboSpan" id="kobo.1607.1">form factor.</span></span></p>
<h2 id="_idParaDest-145"><a id="_idTextAnchor827"/><span class="koboSpan" id="kobo.1608.1">Navigating to different views based on the form factor</span></h2>
<p><span class="koboSpan" id="kobo.1609.1">We now have two different views that should be loaded in the same place in the app. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1610.1">Weather.Views.Desktop.MainView</span></strong><span class="koboSpan" id="kobo.1611.1"> should be loaded if the app is running on a tablet or </span><a id="_idIndexMarker863"/><span class="koboSpan" id="kobo.1612.1">a desktop, while </span><strong class="source-inline"><span class="koboSpan" id="kobo.1613.1">Weather.Views.Mobile.MainView</span></strong><span class="koboSpan" id="kobo.1614.1"> should be loaded if the app is running on </span><span class="No-Break"><span class="koboSpan" id="kobo.1615.1">a phone.</span></span></p>
<p><span class="koboSpan" id="kobo.1616.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1617.1">Device</span></strong><span class="koboSpan" id="kobo.1618.1"> class in .NET MAUI has a static </span><strong class="source-inline"><span class="koboSpan" id="kobo.1619.1">Idiom</span></strong><span class="koboSpan" id="kobo.1620.1"> property that we can use to check which form factor the app is running on. </span><span class="koboSpan" id="kobo.1620.2">The value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1621.1">Idiom</span></strong><span class="koboSpan" id="kobo.1622.1"> can be </span><strong class="source-inline"><span class="koboSpan" id="kobo.1623.1">Phone</span></strong><span class="koboSpan" id="kobo.1624.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1625.1">Tablet</span></strong><span class="koboSpan" id="kobo.1626.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1627.1">Desktop</span></strong><span class="koboSpan" id="kobo.1628.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1629.1">Watch</span></strong><span class="koboSpan" id="kobo.1630.1">, or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1631.1">TV</span></strong><span class="koboSpan" id="kobo.1632.1">. </span><span class="koboSpan" id="kobo.1632.2">Because we only have one view in this app, we could have used an </span><strong class="source-inline"><span class="koboSpan" id="kobo.1633.1">if</span></strong><span class="koboSpan" id="kobo.1634.1"> statement when we were setting </span><strong class="source-inline"><span class="koboSpan" id="kobo.1635.1">MainPage</span></strong><span class="koboSpan" id="kobo.1636.1"> in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1637.1">App.xaml.cs</span></strong><span class="koboSpan" id="kobo.1638.1"> and checked what the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1639.1">Idiom</span></strong><span class="koboSpan" id="kobo.1640.1"> value was. </span></p>
<p><span class="koboSpan" id="kobo.1641.1">Since we are only ever going to need one view, we can register just the view that we need in dependency injection – all we need is a common type to register the views with. </span><span class="koboSpan" id="kobo.1641.2">Let’s create a new interface that our views </span><span class="No-Break"><span class="koboSpan" id="kobo.1642.1">will implement:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1643.1">Create a new interface in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1644.1">Views</span></strong><span class="koboSpan" id="kobo.1645.1"> folder </span><span class="No-Break"><span class="koboSpan" id="kobo.1646.1">named </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1647.1">IMainView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1648.1">.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.1649.1">We won’t add any additional pro</span><a id="_idTextAnchor828"/><span class="koboSpan" id="kobo.1650.1">perties or methods to the interface – we’ll just use it as </span><span class="No-Break"><span class="koboSpan" id="kobo.1651.1">a marker.</span></span></p></li>
<li><span class="koboSpan" id="kobo.1652.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.1653.1">Views\Desktop\MainView.xaml.cs</span></strong><span class="koboSpan" id="kobo.1654.1"> and add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1655.1">IMainView</span></strong><span class="koboSpan" id="kobo.1656.1"> interface to </span><span class="No-Break"><span class="koboSpan" id="kobo.1657.1">the class:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1658.1">
public partial class MainView : ContentPage</span><strong class="bold"><span class="koboSpan" id="kobo.1659.1">, IMainView</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1660.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.1661.1">Views\Mobile\MainView.xaml.cs</span></strong><span class="koboSpan" id="kobo.1662.1"> and add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1663.1">IMainView</span></strong><span class="koboSpan" id="kobo.1664.1"> interface to </span><span class="No-Break"><span class="koboSpan" id="kobo.1665.1">the class:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1666.1">
public partial class MainView : ContentPage</span><strong class="bold"><span class="koboSpan" id="kobo.1667.1">, IMainView</span></strong></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1668.1">Now that we have a co</span><a id="_idTextAnchor829"/><span class="koboSpan" id="kobo.1669.1">mmon interface, we can register the views with </span><span class="No-Break"><span class="koboSpan" id="kobo.1670.1">dependency injection:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1671.1">Open the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1672.1">MauiProgram.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1673.1"> file.</span></span></li>
<li><span class="koboSpan" id="kobo.1674.1">Add the </span><span class="No-Break"><span class="koboSpan" id="kobo.1675.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1676.1">
#if DEBUG
    builder.Logging.AddDebug();
#endif
    builder.Services.AddSingleton&lt;IWeatherService, OpenWeatherMapWeatherService&gt;();
    builder.Services.AddTransient&lt;MainViewModel, MainViewModel&gt;();
</span><strong class="bold"><span class="koboSpan" id="kobo.1677.1">    if (DeviceInfo.Idiom == DeviceIdiom.Phone)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1678.1">    {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1679.1">        builder.Services.AddTransient&lt;IMainView, Views.Mobile.MainView&gt;();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1680.1">    }</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1681.1">    else</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1682.1">    {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1683.1">        builder.Services.AddTransient&lt;IMainView, Views.Desktop.MainView&gt;();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1684.1">    }</span></strong><span class="koboSpan" id="kobo.1685.1">
    return builder.Build();</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1686.1">With these </span><a id="_idIndexMarker864"/><span class="koboSpan" id="kobo.1687.1">changes, we can now test our applicatio</span><a id="_idTextAnchor830"/><span class="koboSpan" id="kobo.1688.1">n. </span><span class="koboSpan" id="kobo.1688.2">If you run your app, you should see something like </span><span class="No-Break"><span class="koboSpan" id="kobo.1689.1">the following:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer144">
<span class="koboSpan" id="kobo.1690.1"><img alt="Figure 8.10 – App running on macOS and iOS" src="image/B19214_08_10..jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1691.1">Figure 8.10 – App running on macOS and iOS</span></p>
<p><span class="koboSpan" id="kobo.1692.1">Next, let’s </span><a id="_idIndexMarker865"/><span class="koboSpan" id="kobo.1693.1">update the de</span><a id="_idTextAnchor831"/><a id="_idTextAnchor832"/><a id="_idTextAnchor833"/><span class="koboSpan" id="kobo.1694.1">sktop views to handle resizing properl</span><a id="_idTextAnchor834"/><span class="koboSpan" id="kobo.1695.1">y by </span><span class="No-Break"><span class="koboSpan" id="kobo.1696.1">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1697.1">VisualStateManager</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1698.1">.</span></span></p>
<h2 id="_idParaDest-146"><a id="_idTextAnchor835"/><span class="koboSpan" id="kobo.1699.1">Handling states with VisualStateManager</span></h2>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1700.1">VisualStateManager</span></strong><span class="koboSpan" id="kobo.1701.1"> is a way to make changes in the UI from the code. </span><span class="koboSpan" id="kobo.1701.2">We can define </span><a id="_idIndexMarker866"/><span class="koboSpan" id="kobo.1702.1">states and set values for selected properties to apply to a specific state. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1703.1">VisualStateManager</span></strong><span class="koboSpan" id="kobo.1704.1"> can be useful in </span><a id="_idIndexMarker867"/><span class="koboSpan" id="kobo.1705.1">cases where we want to use the same view for devices with different screen resolutions. </span><span class="koboSpan" id="kobo.1705.2">It was first introduced in </span><strong class="bold"><span class="koboSpan" id="kobo.1706.1">UWP</span></strong><span class="koboSpan" id="kobo.1707.1"> to make it easier to create Windows 10 applications for multiple platforms. </span><span class="koboSpan" id="kobo.1707.2">This was because Windows 10 could run on Windows Phone, as well as on desktops and tablets (the operating system was called Windows 10 Mobile). </span><span class="koboSpan" id="kobo.1707.3">However, Windows Phone has now been deprecated. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1708.1">VisualStateManager</span></strong><span class="koboSpan" id="kobo.1709.1"> is interesting for us as .NET MAUI developers, especially when both iOS and Android can run on both phones </span><span class="No-Break"><span class="koboSpan" id="kobo.1710.1">and tablets.</span></span></p>
<p><span class="koboSpan" id="kobo.1711.1">In this project, we will use it to make a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1712.1">forecast</span></strong><span class="koboSpan" id="kobo.1713.1"> item bigger when the app is running in landscape mode on a tablet or a desktop. </span><span class="koboSpan" id="kobo.1713.2">We will also make the weather icon bigger. </span><span class="koboSpan" id="kobo.1713.3">Let’s set </span><span class="No-Break"><span class="koboSpan" id="kobo.1714.1">this up:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1715.1">Open the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1716.1">Views\Desktop\MainView.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1717.1"> file.</span></span></li>
<li><span class="koboSpan" id="kobo.1718.1">In the first </span><strong class="source-inline"><span class="koboSpan" id="kobo.1719.1">FlexLayout</span></strong><span class="koboSpan" id="kobo.1720.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1721.1">DataTemplate</span></strong><span class="koboSpan" id="kobo.1722.1">, insert a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1723.1">VisualStateManager.VisualStateGroups</span></strong><span class="koboSpan" id="kobo.1724.1"> element into the </span><span class="No-Break"><span class="koboSpan" id="kobo.1725.1">first </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1726.1">StackLayout</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1727.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1728.1">
&lt;StackLayout M</span><a id="_idTextAnchor836"/><span class="koboSpan" id="kobo.1729.1">argin=”10” Padding=”20” WidthRequest=”150” BackgroundColor=”#99FFFFFF”&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.1730.1">  &lt;VisualStateMan</span><a id="_idTextAnchor837"/><span class="koboSpan" id="kobo.1731.1">ager.VisualStateGroups&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1732.1">    &lt;VisualStateGroup&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1733.1">    &lt;/VisualStateGroup&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1734.1">  &lt;/VisualStateManager.VisualStateGroups&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1735.1">......</span></strong><span class="koboSpan" id="kobo.1736.1">
&lt;/StackLayout&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1737.1">Regarding </span><strong class="source-inline"><span class="koboSpan" id="kobo.1738.1">VisualStateGroup</span></strong><span class="koboSpan" id="kobo.1739.1">, we should add two states, </span><span class="No-Break"><span class="koboSpan" id="kobo.1740.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1741.1">Add a </span><a id="_idIndexMarker868"/><span class="koboSpan" id="kobo.1742.1">new </span><strong class="source-inline"><span class="koboSpan" id="kobo.1743.1">VisualState</span></strong><span class="koboSpan" id="kobo.1744.1"> called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1745.1">Portrait</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1746.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1747.1">VisualStateGroup</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1748.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1749.1">Create </span><a id="_idIndexMarker869"/><span class="koboSpan" id="kobo.1750.1">a setter in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1751.1">VisualState</span></strong><span class="koboSpan" id="kobo.1752.1"> and set </span><strong class="source-inline"><span class="koboSpan" id="kobo.1753.1">WidthRequest</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1754.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1755.1">150</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1756.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1757.1">Add another </span><strong class="source-inline"><span class="koboSpan" id="kobo.1758.1">VisualState</span></strong><span class="koboSpan" id="kobo.1759.1"> called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1760.1">Landscape</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1761.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1762.1">VisualStateGroup</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1763.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1764.1">Create a setter in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1765.1">VisualState</span></strong><span class="koboSpan" id="kobo.1766.1"> and se</span><a id="_idTextAnchor838"/><span class="koboSpan" id="kobo.1767.1">t </span><strong class="source-inline"><span class="koboSpan" id="kobo.1768.1">WidthRequest</span></strong><span class="koboSpan" id="kobo.1769.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1770.1">200</span></strong><span class="koboSpan" id="kobo.1771.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1772.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1773.1">
&lt;VisualStateGroup&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.1774.1">  &lt;VisualState Name=”Portrait”&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1775.1">    &lt;VisualState.Setters&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1776.1">      &lt;Setter Property=”Wid</span><a id="_idTextAnchor839"/><span class="koboSpan" id="kobo.1777.1">thRequest” Value=”150” /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1778.1">      &lt;/VisualState.Setters&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1779.1">    &lt;/VisualState&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1780.1">  &lt;VisualState Name=”Landscape”&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1781.1">    &lt;VisualState.Setters&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1782.1">      &lt;Setter Property=”WidthRequest” Value=”200” /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1783.1">    &lt;/VisualState.Setters&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1784.1">  &lt;/VisualState&gt;</span></strong><span class="koboSpan" id="kobo.1785.1">
&lt;/VisualStateGroup&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1786.1">We also </span><a id="_idIndexMarker870"/><span class="koboSpan" id="kobo.1787.1">want the icons in a forecast </span><a id="_idIndexMarker871"/><span class="koboSpan" id="kobo.1788.1">item to be bigger when the item itself is bigger. </span><span class="koboSpan" id="kobo.1788.2">To do this, we will use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1789.1">VisualStateManager</span></strong><span class="koboSpan" id="kobo.1790.1"> again. </span><span class="koboSpan" id="kobo.1790.2">Let’s set </span><span class="No-Break"><span class="koboSpan" id="kobo.1791.1">this up:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1792.1">Insert a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1793.1">VisualStateManager.VisualStateGroups</span></strong><span class="koboSpan" id="kobo.1794.1"> element into the second </span><strong class="source-inline"><span class="koboSpan" id="kobo.1795.1">FlexLayout</span></strong><span class="koboSpan" id="kobo.1796.1"> and in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1797.1">Image</span></strong><span class="koboSpan" id="kobo.1798.1"> element </span><span class="No-Break"><span class="koboSpan" id="kobo.1799.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1800.1">DataTemplate</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1801.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1802.1">Add </span><strong class="source-inline"><span class="koboSpan" id="kobo.1803.1">VisualState</span></strong><span class="koboSpan" id="kobo.1804.1"> for both </span><strong class="source-inline"><span class="koboSpan" id="kobo.1805.1">Portrait</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1806.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1807.1">Landscape</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1808.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1809.1">Add setters to the states to set </span><strong class="source-inline"><span class="koboSpan" id="kobo.1810.1">WidthRequest</span></strong><span class="koboSpan" id="kobo.1811.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1812.1">HeightRequest</span></strong><span class="koboSpan" id="kobo.1813.1">. </span><span class="koboSpan" id="kobo.1813.2">The value should be </span><strong class="source-inline"><span class="koboSpan" id="kobo.1814.1">100</span></strong><span class="koboSpan" id="kobo.1815.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1816.1">Portrait</span></strong><span class="koboSpan" id="kobo.1817.1"> state and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1818.1">150</span></strong><span class="koboSpan" id="kobo.1819.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1820.1">Landscape</span></strong><span class="koboSpan" id="kobo.1821.1"> state, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1822.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1823.1">
&lt;Image WidthRequest=”100” HeightRequest=”</span><a id="_idTextAnchor840"/><span class="koboSpan" id="kobo.1824.1">100” Aspect=”AspectFit” HorizontalOptions=”Center” Source=”{Binding Icon}”&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.1825.1">  &lt;VisualStateManager.VisualStateGroups&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1826.1">    &lt;VisualStateGroup&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1827.1">      &lt;VisualState Name=”Portrait”&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1828.1">        &lt;VisualState.Setters&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1829.1">          &lt;Setter Property=”WidthRequest” Value=”100” /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1830.1">          &lt;Setter Property=”HeightRequest” Value=”100” /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1831.1">        &lt;/VisualState.Setters&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1832.1">      &lt;/VisualState&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1833.1">      &lt;VisualState Name=”Landscape”&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1834.1">        &lt;VisualState.Setters&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1835.1">          &lt;Setter Property=”WidthRequest” Value=”150” /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1836.1">          &lt;Setter Property=”HeightRequest” Value=”150” /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1837.1">        &lt;/VisualState.Setters&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1838.1">      &lt;/VisualState&gt;</span></strong>
<strong class="bold"><a id="_idTextAnchor841"/><a id="_idTextAnchor842"/><a id="_idTextAnchor843"/><span class="koboSpan" id="kobo.1839.1">    &lt;/VisualStateGroup&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1840.1">  &lt;/VisualStateManager.VisualStateGroups&gt;</span></strong><span class="koboSpan" id="kobo.1841.1">
&lt;/Image&gt;</span></pre></li> </ol>
<h3><span class="koboSpan" id="kobo.1842.1">Creating a behavior to set state changes</span></h3>
<p><span class="koboSpan" id="kobo.1843.1">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1844.1">Behavior</span></strong><span class="koboSpan" id="kobo.1845.1">, we can add functionality to controls without having to subclass them. </span><span class="koboSpan" id="kobo.1845.2">With behaviors, we can also create more reusable code than we could if we subclassed a control. </span><span class="koboSpan" id="kobo.1845.3">The </span><a id="_idIndexMarker872"/><span class="koboSpan" id="kobo.1846.1">more specific </span><strong class="source-inline"><span class="koboSpan" id="kobo.1847.1">Behavior</span></strong><span class="koboSpan" id="kobo.1848.1"> we create, the more reusable it will be. </span><span class="koboSpan" id="kobo.1848.2">For example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1849.1">Behavior</span></strong><span class="koboSpan" id="kobo.1850.1"> that inherits from </span><strong class="source-inline"><span class="koboSpan" id="kobo.1851.1">Behavior&lt;View&gt;</span></strong><span class="koboSpan" id="kobo.1852.1"> could be used on all controls, but </span><strong class="source-inline"><span class="koboSpan" id="kobo.1853.1">Behavior</span></strong><span class="koboSpan" id="kobo.1854.1"> that inherits from </span><strong class="source-inline"><span class="koboSpan" id="kobo.1855.1">Button</span></strong><span class="koboSpan" id="kobo.1856.1"> can only be used for buttons. </span><span class="koboSpan" id="kobo.1856.2">Because of this, we always want to create behaviors with a less specific </span><span class="No-Break"><span class="koboSpan" id="kobo.1857.1">base class.</span></span></p>
<p><span class="koboSpan" id="kobo.1858.1">When we create </span><strong class="source-inline"><span class="koboSpan" id="kobo.1859.1">Behavior</span></strong><span class="koboSpan" id="kobo.1860.1">, we need to override two methods: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1861.1">OnAttached</span></strong><span class="koboSpan" id="kobo.1862.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1863.1">OnDetachingFrom</span></strong><span class="koboSpan" id="kobo.1864.1">. </span><span class="koboSpan" id="kobo.1864.2">It is really important to remove event listeners in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1865.1">OnDeattached</span></strong><span class="koboSpan" id="kobo.1866.1"> method if we have added them to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1867.1">OnAttached</span></strong><span class="koboSpan" id="kobo.1868.1"> method. </span><span class="koboSpan" id="kobo.1868.2">This will make the app use less memory. </span><span class="koboSpan" id="kobo.1868.3">It is also important to set values back to the values that they had before the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1869.1">OnAppearing</span></strong><span class="koboSpan" id="kobo.1870.1"> method ran; otherwise, we might see some strange behavior, especially if the behavior is in a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1871.1">CollectionView</span></strong><span class="koboSpan" id="kobo.1872.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1873.1">ListView</span></strong><span class="koboSpan" id="kobo.1874.1"> view that is </span><span class="No-Break"><span class="koboSpan" id="kobo.1875.1">reusing cells.</span></span></p>
<p><span class="koboSpan" id="kobo.1876.1">In this app, we will create a behavior for </span><strong class="source-inline"><span class="koboSpan" id="kobo.1877.1">FlexLayout</span></strong><span class="koboSpan" id="kobo.1878.1">. </span><span class="koboSpan" id="kobo.1878.2">This is because we can’t set the state of an item in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1879.1">FlexLayout</span></strong><span class="koboSpan" id="kobo.1880.1"> from the code-behind. </span><span class="koboSpan" id="kobo.1880.2">We could have added some code to check whether the app runs in portrait or landscape in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1881.1">FlexLayout</span></strong><span class="koboSpan" id="kobo.1882.1">, but if we use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1883.1">Behavior</span></strong><span class="koboSpan" id="kobo.1884.1"> instead, we can separate that code from </span><strong class="source-inline"><span class="koboSpan" id="kobo.1885.1">FlexLayout</span></strong><span class="koboSpan" id="kobo.1886.1"> so that it will be more reusable. </span><span class="koboSpan" id="kobo.1886.2">Perform the following steps to </span><span class="No-Break"><span class="koboSpan" id="kobo.1887.1">do so:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1888.1">Create a new folder </span><span class="No-Break"><span class="koboSpan" id="kobo.1889.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1890.1">Behaviors</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1891.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1892.1">Create a new class </span><span class="No-Break"><span class="koboSpan" id="kobo.1893.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1894.1">FlexLayoutBehavior</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1895.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1896.1">Add </span><strong class="source-inline"><span class="koboSpan" id="kobo.1897.1">Behavior&lt;FlexLayoutView&gt;</span></strong><span class="koboSpan" id="kobo.1898.1"> as a </span><span class="No-Break"><span class="koboSpan" id="kobo.1899.1">base class.</span></span></li>
<li><span class="koboSpan" id="kobo.1900.1">Create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1901.1">private</span><a id="_idTextAnchor844"/></strong><span class="koboSpan" id="kobo.1902.1"> field of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1903.1">FlexLayout</span></strong><span class="koboSpan" id="kobo.1904.1"> type </span><span class="No-Break"><span class="koboSpan" id="kobo.1905.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1906.1">view</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1907.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1908.1">The code should look </span><span class="No-Break"><span class="koboSpan" id="kobo.1909.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1910.1">
using System;
namespace Weather.Behaviors;
public class FlexLayoutBehavior : Behavior&lt;FlexLayout&gt;
{
    private FlexLayout view;
}</span></pre></li> </ol>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1911.1">FlexLayout</span></strong><span class="koboSpan" id="kobo.1912.1"> is a class that inherits from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1913.1">Behavior&lt;FlexLayout&gt;</span></strong><span class="koboSpan" id="kobo.1914.1"> base class. </span><span class="koboSpan" id="kobo.1914.2">This will give </span><a id="_idIndexMarker873"/><span class="koboSpan" id="kobo.1915.1">us the ability to override some virtual methods that will be called when we attach and detach the behavior from a </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1916.1">FlexLayout</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1917.1"> class.</span></span></p>
<p><span class="koboSpan" id="kobo.1918.1">But first, we need to create a method that will handle the change in state. </span><span class="koboSpan" id="kobo.1918.2">Perform the following steps to </span><span class="No-Break"><span class="koboSpan" id="kobo.1919.1">do so:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1920.1">Open the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1921.1">FlexlayoutBehavior.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1922.1"> file.</span></span></li>
<li><span class="koboSpan" id="kobo.1923.1">Create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1924.1">private</span></strong><span class="koboSpan" id="kobo.1925.1"> method called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1926.1">SetState</span></strong><span class="koboSpan" id="kobo.1927.1">. </span><span class="koboSpan" id="kobo.1927.2">This method will have a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1928.1">VisualElement</span></strong><span class="koboSpan" id="kobo.1929.1"> value and a </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1930.1">string</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1931.1"> argument.</span></span></li>
<li><span class="koboSpan" id="kobo.1932.1">Call </span><strong class="source-inline"><span class="koboSpan" id="kobo.1933.1">VisualStateManager.GoToState</span></strong><span class="koboSpan" id="kobo.1934.1"> and pass the parameters </span><span class="No-Break"><span class="koboSpan" id="kobo.1935.1">to it.</span></span></li>
<li><span class="koboSpan" id="kobo.1936.1">If the view is of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1937.1">Layout</span></strong><span class="koboSpan" id="kobo.1938.1"> type, there might be child elements that also need to get the new state. </span><span class="koboSpan" id="kobo.1938.2">To do that, we will loop through all the children of the layout. </span><span class="koboSpan" id="kobo.1938.3">Instead of just setting the state directly to the children, we will call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1939.1">SetState</span></strong><span class="koboSpan" id="kobo.1940.1"> method, which is the method that we are already inside. </span><span class="koboSpan" id="kobo.1940.2">T</span><a id="_idTextAnchor845"/><span class="koboSpan" id="kobo.1941.1">he reason for this is that some of the children may have their </span><span class="No-Break"><span class="koboSpan" id="kobo.1942.1">own children:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1943.1">
private void SetState(VisualElement view, string state)
{
    VisualStateManager.GoToState(view, state);
    if (view is Layout layout)
    {
        foreach (VisualElement child in layout.Children)
        {
            SetState(child, state);
        }
    }
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1944.1">Now that </span><a id="_idIndexMarker874"/><span class="koboSpan" id="kobo.1945.1">we have created the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1946.1">SetState</span></strong><span class="koboSpan" id="kobo.1947.1"> method, we need to write a method that uses it and determines what state to set. </span><span class="koboSpan" id="kobo.1947.2">Perform the following steps to </span><span class="No-Break"><span class="koboSpan" id="kobo.1948.1">do so:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1949.1">Create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1950.1">private</span></strong><span class="koboSpan" id="kobo.1951.1"> method </span><span class="No-Break"><span class="koboSpan" id="kobo.1952.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1953.1">UpdateState</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1954.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1955.1">Run the code on </span><strong class="source-inline"><span class="koboSpan" id="kobo.1956.1">MainThread</span></strong><span class="koboSpan" id="kobo.1957.1"> to check whether the app is running in portrait or </span><span class="No-Break"><span class="koboSpan" id="kobo.1958.1">landscape mode.</span></span></li>
<li><span class="koboSpan" id="kobo.1959.1">Cre</span><a id="_idTextAnchor846"/><span class="koboSpan" id="kobo.1960.1">ate a variable called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1961.1">page</span></strong><span class="koboSpan" id="kobo.1962.1"> and set its value </span><span class="No-Break"><span class="koboSpan" id="kobo.1963.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1964.1">Application.Current.MainPage</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1965.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1966.1">Check whether </span><strong class="source-inline"><span class="koboSpan" id="kobo.1967.1">Width</span></strong><span class="koboSpan" id="kobo.1968.1"> is larger than </span><strong class="source-inline"><span class="koboSpan" id="kobo.1969.1">Height</span></strong><span class="koboSpan" id="kobo.1970.1">. </span><span class="koboSpan" id="kobo.1970.2">If this is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1971.1">true</span></strong><span class="koboSpan" id="kobo.1972.1">, set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1973.1">VisualState</span></strong><span class="koboSpan" id="kobo.1974.1"> property on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1975.1">view</span></strong><span class="koboSpan" id="kobo.1976.1"> variable to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1977.1">Landscape</span></strong><span class="koboSpan" id="kobo.1978.1">. </span><span class="koboSpan" id="kobo.1978.2">If this is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1979.1">false</span></strong><span class="koboSpan" id="kobo.1980.1">, set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1981.1">VisualSta</span><a id="_idTextAnchor847"/><span class="koboSpan" id="kobo.1982.1">te</span></strong><span class="koboSpan" id="kobo.1983.1"> property on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1984.1">view</span></strong><span class="koboSpan" id="kobo.1985.1"> variable to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1986.1">Portrait</span></strong><span class="koboSpan" id="kobo.1987.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1988.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1989.1">
private void UpdateState()
{
    MainThread.BeginInvokeOnMainThread(() =&gt;
    {
        var page = Application.Current.MainPage;
        if (page.Width &gt; page.Height)
        {
            SetState(view, “Landscape”);
            return;
        }
        SetState(view, “Portrait”);
    });
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1990.1">With </span><a id="_idIndexMarker875"/><span class="koboSpan" id="kobo.1991.1">that, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1992.1">UpdateState</span></strong><span class="koboSpan" id="kobo.1993.1"> method has been added. </span><span class="koboSpan" id="kobo.1993.2">Now, we need to override the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1994.1">OnAttachedTo</span></strong><span class="koboSpan" id="kobo.1995.1"> method, which will be called when the behavior is added to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1996.1">FlexLayout</span></strong><span class="koboSpan" id="kobo.1997.1">. </span><span class="koboSpan" id="kobo.1997.2">When it is, we want to update the state by calling this method and hook it up to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1998.1">SizeChanged</span></strong><span class="koboSpan" id="kobo.1999.1"> event of </span><strong class="source-inline"><span class="koboSpan" id="kobo.2000.1">MainPage</span></strong><span class="koboSpan" id="kobo.2001.1"> so that when the size changes, we will update the </span><span class="No-Break"><span class="koboSpan" id="kobo.2002.1">state again.</span></span></p>
<p><span class="koboSpan" id="kobo.2003.1">Let’s set </span><span class="No-Break"><span class="koboSpan" id="kobo.2004.1">this up:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.2005.1">Open the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2006.1">FlexLayoutBehavior</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2007.1"> file.</span></span></li>
<li><span class="koboSpan" id="kobo.2008.1">Override the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2009.1">OnAttachedTo</span></strong><span class="koboSpan" id="kobo.2010.1"> method from the </span><span class="No-Break"><span class="koboSpan" id="kobo.2011.1">base class.</span></span></li>
<li><span class="koboSpan" id="kobo.2012.1">Set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2013.1">view</span></strong><span class="koboSpan" id="kobo.2014.1"> property to the parameter from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2015.1">OnAttachedTo</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2016.1"> method.</span></span></li>
<li><span class="koboSpan" id="kobo.2017.1">Add an event listener to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2018.1">Application.Current.MainPage.SizeChanged</span></strong><span class="koboSpan" id="kobo.2019.1">. </span><span class="koboSpan" id="kobo.2019.2">In the event l</span><a id="_idTextAnchor848"/><span class="koboSpan" id="kobo.2020.1">istener, add a call to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2021.1">UpdateState</span></strong><span class="koboSpan" id="kobo.2022.1"> method, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.2023.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2024.1">
protected override void OnAttachedTo(FlexLayout view)
{
    this.view = view;
    base.OnAttachedTo(view);
    UpdateState();
    Application.Current.MainPage.SizeChanged += MainPage_SizeChanged;
}
void MainPage_SizeChanged(object sender, EventArgs e)
{
    UpdateState();
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.2025.1">When we </span><a id="_idIndexMarker876"/><span class="koboSpan" id="kobo.2026.1">remove behaviors from a control, it’s very important to also remove any event handlers from it to avoid memory leaks, and in the worst case, the app crashing. </span><span class="koboSpan" id="kobo.2026.2">Let’s </span><span class="No-Break"><span class="koboSpan" id="kobo.2027.1">do this:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.2028.1">Open the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2029.1">FlexLayoutBehavior.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2030.1"> file.</span></span></li>
<li><span class="koboSpan" id="kobo.2031.1">Override </span><strong class="source-inline"><span class="koboSpan" id="kobo.2032.1">OnDetachingFrom</span></strong><span class="koboSpan" id="kobo.2033.1"> from the </span><span class="No-Break"><span class="koboSpan" id="kobo.2034.1">base class.</span></span></li>
<li><span class="koboSpan" id="kobo.2035.1">Remove the event listener </span><span class="No-Break"><span class="koboSpan" id="kobo.2036.1">from </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2037.1">Application.Current.MainPage.SizeChanged</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2038.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.2039.1">Set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2040.1">view</span></strong><span class="koboSpan" id="kobo.2041.1"> field to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2042.1">null</span></strong><span class="koboSpan" id="kobo.2043.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.2044.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2045.1">
protected override void OnDetachingFrom(FlexLayout view)
{
    base.OnDetachingFrom(view);
    Application.Current.MainPage.SizeChanged -= MainPage_SizeChanged;
    this.view = null;
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.2046.1">Perform </span><a id="_idIndexMarker877"/><span class="koboSpan" id="kobo.2047.1">the following steps to add </span><strong class="source-inline"><span class="koboSpan" id="kobo.2048.1">behavior</span></strong><span class="koboSpan" id="kobo.2049.1"> to </span><span class="No-Break"><span class="koboSpan" id="kobo.2050.1">the view:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.2051.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2052.1">MainView.xaml</span></strong><span class="koboSpan" id="kobo.2053.1"> file inside the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2054.1">Views/Desktop</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2055.1"> folder.</span></span></li>
<li><span class="koboSpan" id="kobo.2056.1">Import the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2057.1">Weather.Behaviors</span></strong><span class="koboSpan" id="kobo.2058.1"> namespace, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.2059.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2060.1">
&lt;ContentPage xmlns=”http://schemas.microsoft.com/dotnet/2021/maui”
             xmlns:x=”http://schemas.microsoft.com/winfx/2009/xaml”
</span><strong class="bold"><span class="koboSpan" id="kobo.2061.1">    xmlns:behaviors=”clr-namespace:Weather.Beha</span><a id="_idTextAnchor849"/><span class="koboSpan" id="kobo.2062.1">viors”</span></strong><span class="koboSpan" id="kobo.2063.1"> 
    x:Class=”Weather.Views.Desktop.MainView”
    Title=”{Binding City}”&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.2064.1">The last thing we will do is add </span><strong class="source-inline"><span class="koboSpan" id="kobo.2065.1">FlexLayoutBehavior</span></strong><span class="koboSpan" id="kobo.2066.1"> to the second </span><strong class="source-inline"><span class="koboSpan" id="kobo.2067.1">FlexLayout</span></strong><span class="koboSpan" id="kobo.2068.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.2069.1">following code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.2070.1">
&lt;FlexLayout Ite</span><a id="_idTextAnchor850"/><span class="koboSpan" id="kobo.2071.1">msSource=”{Binding Items}” Wrap=”Wrap” JustifyContent=”Start” AlignItems=”Start”&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.2072.1">  &lt;FlexLayout.Behaviors&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2073.1">    &lt;behaviors:FlexLayoutBehavior /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2074.1">  &lt;/FlexLayout.Behaviors&gt;</span></strong><span class="koboSpan" id="kobo.2075.1">
&lt;FlexLayout.ItemsTemplate&gt;</span></pre> <p><span class="koboSpan" id="kobo.2076.1">Congratulations – that </span><a id="_idIndexMarker878"/><span class="koboSpan" id="kobo.2077.1">is a wrap on </span><a id="_idTextAnchor851"/><span class="koboSpan" id="kobo.2078.1">the </span><span class="No-Break"><span class="koboSpan" id="kobo.2079.1">weather app!</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer145">
<span class="koboSpan" id="kobo.2080.1"><img alt="Figure 8.11 – Completed app on tablet, phone, and desktop" src="image/B19214_08_11..jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.2081.1">Figure 8.11 – Completed app on tablet, phone, and desktop</span></p>
<h1 id="_idParaDest-147"><a id="_idTextAnchor852"/><span class="koboSpan" id="kobo.2082.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.2083.1">In this chapter, we successfully created an app for four different operating systems – iOS, macOS, Android, and Windows – and three different form factors – phones, tablets, and desktop computers. </span><span class="koboSpan" id="kobo.2083.2">To create a good user experience on all platforms and form factors, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.2084.1">FlexLayout</span></strong><span class="koboSpan" id="kobo.2085.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.2086.1">VisualStateManager</span></strong><span class="koboSpan" id="kobo.2087.1">. </span><span class="koboSpan" id="kobo.2087.2">We also learned how to handle different views for different form factors, as well as how to </span><span class="No-Break"><span class="koboSpan" id="kobo.2088.1">use </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2089.1">Behaviors</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2090.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.2091.1">The next app we will build will be a game with real-time communication. </span><span class="koboSpan" id="kobo.2091.2">In the next chapter, we will take a look at how we can use the </span><strong class="bold"><span class="koboSpan" id="kobo.2092.1">SignalR</span></strong><span class="koboSpan" id="kobo.2093.1"> service in </span><strong class="bold"><span class="koboSpan" id="kobo.2094.1">Azure</span></strong><span class="koboSpan" id="kobo.2095.1"> as the backend </span><span class="No-Break"><span class="koboSpan" id="kobo.2096.1">game service.</span></span></p>
</div>


<div class="Content" id="_idContainer147">
<h1 id="_idParaDest-148" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor853"/><span class="koboSpan" id="kobo.1.1">Part 3: Advanced Projects</span></h1>
<p><span class="koboSpan" id="kobo.2.1">In this part, you will work with more advanced topics and complicated projects. </span><span class="koboSpan" id="kobo.2.2">You will learn how to create and deploy a service in Azure. </span><span class="koboSpan" id="kobo.2.3">Additionally, you will work with Azure Storage and SignalR services. </span><span class="koboSpan" id="kobo.2.4">You will learn how to call your service from a .NET MAUI application, properly handle error conditions, and integrate the camera into your app. </span><span class="koboSpan" id="kobo.2.5">You will explore a project using Blazor embedded into a .NET MAUI app, and learn how to integrate artificial intelligence services into a .NET </span><span class="No-Break"><span class="koboSpan" id="kobo.3.1">MAUI app.</span></span></p>
<p><span class="koboSpan" id="kobo.4.1">This part has the </span><span class="No-Break"><span class="koboSpan" id="kobo.5.1">following chapters:</span></span></p>
<ul>
<li><a href="B19214_09.xhtml#_idTextAnchor854"><em class="italic"><span class="koboSpan" id="kobo.6.1">Chapter 9</span></em></a><span class="koboSpan" id="kobo.7.1">, </span><em class="italic"><span class="koboSpan" id="kobo.8.1">Setting Up a Backend for a Game Using Azure Services</span></em></li>
<li><a href="B19214_10.xhtml#_idTextAnchor867"><em class="italic"><span class="koboSpan" id="kobo.9.1">Chapter 10</span></em></a><span class="koboSpan" id="kobo.10.1">, </span><em class="italic"><span class="koboSpan" id="kobo.11.1">Building a Real-Time Game</span></em></li>
<li><a href="B19214_11.xhtml#_idTextAnchor895"><em class="italic"><span class="koboSpan" id="kobo.12.1">Chapter 11</span></em></a><span class="koboSpan" id="kobo.13.1">, </span><em class="italic"><span class="koboSpan" id="kobo.14.1">Building a Calculator Using .NET MAUI Blazor</span></em></li>
<li><a href="B19214_12.xhtml#_idTextAnchor919"><em class="italic"><span class="koboSpan" id="kobo.15.1">Chapter 12</span></em></a><span class="koboSpan" id="kobo.16.1">, </span><em class="italic"><span class="koboSpan" id="kobo.17.1">Hot Dog or Not Hot Dog Using Machine Learning</span></em></li>
</ul>
</div>
<div>
<div class="Basic-Graphics-Frame" id="_idContainer148">
</div>
</div>
</body></html>