- en: '8'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '8'
- en: Building Modular and Extensible CLI Applications
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: æ„å»ºæ¨¡å—åŒ–å’Œå¯æ‰©å±•çš„ CLI åº”ç”¨ç¨‹åº
- en: Throughout the pages of this book, we have added more and more functionalities
    to **Bookmarkr**, our beloved CLI application.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™æœ¬ä¹¦çš„æ¯ä¸€é¡µï¼Œæˆ‘ä»¬éƒ½ä¸ºæˆ‘ä»¬çš„å¿ƒçˆ±å‘½ä»¤è¡Œåº”ç”¨ç¨‹åº **Bookmarkr** æ·»åŠ äº†æ›´å¤šåŠŸèƒ½ã€‚
- en: The problem is that we have also added more and more lines of code to the `Program.cs`
    file. The length of this file has grown from 191 lines of code by the end of [*Chapter
    3*](B22400_03.xhtml#_idTextAnchor035) to 479 lines of code by the end of [*Chapter
    7*](B22400_07.xhtml#_idTextAnchor105).
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: é—®é¢˜æ˜¯æˆ‘ä»¬è¿˜å‘ `Program.cs` æ–‡ä»¶ä¸­æ·»åŠ äº†è¶Šæ¥è¶Šå¤šçš„ä»£ç è¡Œã€‚è¯¥æ–‡ä»¶çš„é•¿åº¦ä»ç¬¬ 3 ç« æœ«çš„ 191 è¡Œä»£ç å¢é•¿åˆ°ç¬¬ 7 ç« æœ«çš„ 479 è¡Œä»£ç ã€‚
- en: In this chapter, we will take a step back and refactor our code to make it more
    modular. This will make it easier to extend, test, and maintain.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†é€€åä¸€æ­¥ï¼Œé‡æ„æˆ‘ä»¬çš„ä»£ç ï¼Œä½¿å…¶æ›´åŠ æ¨¡å—åŒ–ã€‚è¿™å°†ä½¿å…¶æ›´å®¹æ˜“æ‰©å±•ã€æµ‹è¯•å’Œç»´æŠ¤ã€‚
- en: Refactoring is an essential part of the development life cycle. It should happen
    periodically in order to ensure that the quality of code is up to the standards.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: é‡æ„æ˜¯å¼€å‘ç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªåŸºæœ¬éƒ¨åˆ†ã€‚å®ƒåº”è¯¥å®šæœŸå‘ç”Ÿï¼Œä»¥ç¡®ä¿ä»£ç è´¨é‡ç¬¦åˆæ ‡å‡†ã€‚
- en: By taking this necessary step, we will greatly simplify adding more features,
    enhance the readability and stability of our application, and even introduce testability
    into it.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: é€šè¿‡é‡‡å–è¿™ä¸€å¿…è¦çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å°†æå¤§åœ°ç®€åŒ–æ·»åŠ æ›´å¤šåŠŸèƒ½ï¼Œæé«˜æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„å¯è¯»æ€§å’Œç¨³å®šæ€§ï¼Œç”šè‡³å°†å…¶å¼•å…¥å¯æµ‹è¯•æ€§ã€‚
- en: 'More specifically, in this chapter, weâ€™ll cover the following topics:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: æ›´å…·ä½“åœ°è¯´ï¼Œåœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ¶µç›–ä»¥ä¸‹ä¸»é¢˜ï¼š
- en: Building the code map of the current application
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ„å»ºå½“å‰åº”ç”¨ç¨‹åºçš„ä»£ç å›¾
- en: Deciding where to start refactoring
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å†³å®šä»å“ªé‡Œå¼€å§‹é‡æ„
- en: Designing the project structure to support refactoring
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: è®¾è®¡é¡¹ç›®ç»“æ„ä»¥æ”¯æŒé‡æ„
- en: Refactoring a command
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: é‡æ„ä¸€ä¸ªå‘½ä»¤
- en: Applying the dependency inversion principle
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: åº”ç”¨ä¾èµ–å€’ç½®åŸåˆ™
- en: Refactoring the `Program` class
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: é‡æ„ `Program` ç±»
- en: Running the program to validate that the refactoring didnâ€™t break anything
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: è¿è¡Œç¨‹åºä»¥éªŒè¯é‡æ„æ²¡æœ‰ç ´åä»»ä½•ä¸œè¥¿
- en: Pushing our refactoring to new boundaries
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å°†æˆ‘ä»¬çš„é‡æ„æ¨å‘æ–°çš„è¾¹ç•Œ
- en: Technical requirements
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: æŠ€æœ¯è¦æ±‚
- en: The code for this chapter can be found in the GitHub repository accompanying
    this book, [https://github.com/PacktPublishing/Building-CLI-Applications-with-C-Sharp-and-.NET/tree/main/Chapter08](https://github.com/PacktPublishing/Building-CLI-Applications-with-C-Sharp-and-.NET/tree/main/Chapter08).
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: æœ¬ç« çš„ä»£ç å¯ä»¥åœ¨æœ¬ä¹¦é…å¥—çš„ GitHub ä»“åº“ä¸­æ‰¾åˆ°ï¼Œ[https://github.com/PacktPublishing/Building-CLI-Applications-with-C-Sharp-and-.NET/tree/main/Chapter08](https://github.com/PacktPublishing/Building-CLI-Applications-with-C-Sharp-and-.NET/tree/main/Chapter08)ã€‚
- en: Step 1 â€“ building a code map of the application
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç¬¬ 1 æ­¥ â€“ æ„å»ºåº”ç”¨ç¨‹åºçš„ä»£ç å›¾
- en: The first thing when you refactor an application is to get to know what you
    are about to refactor. This means having a high-level view of the application
    and its dependencies. This helps you visualize all the moving parts involved and
    better plan your refactoring activities by identifying where to start.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ä½ é‡æ„ä¸€ä¸ªåº”ç”¨ç¨‹åºæ—¶ï¼Œé¦–å…ˆè¦äº†è§£ä½ å³å°†é‡æ„çš„å†…å®¹ã€‚è¿™æ„å‘³ç€è¦æœ‰ä¸€ä¸ªå¯¹åº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–å…³ç³»çš„é«˜çº§è§†å›¾ã€‚è¿™æœ‰åŠ©äºä½ å¯è§†åŒ–æ‰€æœ‰æ¶‰åŠçš„ç§»åŠ¨éƒ¨åˆ†ï¼Œå¹¶é€šè¿‡ç¡®å®šä»å“ªé‡Œå¼€å§‹æ¥æ›´å¥½åœ°è§„åˆ’ä½ çš„é‡æ„æ´»åŠ¨ã€‚
- en: If you have Visual Studio Enterprise edition, you can use its great architecture
    capabilities (such as code maps and dependency graphs) to visualize your code
    and its dependencies. However, since we are using Visual Studio Code (or if you
    donâ€™t have the Enterprise edition of Visual Studio), we can do something elseâ€¦
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ æ‹¥æœ‰ Visual Studio Enterprise ç‰ˆæœ¬ï¼Œä½ å¯ä»¥ä½¿ç”¨å…¶å‡ºè‰²çš„æ¶æ„åŠŸèƒ½ï¼ˆä¾‹å¦‚ä»£ç å›¾å’Œä¾èµ–å…³ç³»å›¾ï¼‰æ¥å¯è§†åŒ–ä½ çš„ä»£ç åŠå…¶ä¾èµ–å…³ç³»ã€‚ç„¶è€Œï¼Œç”±äºæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨
    Visual Studio Codeï¼ˆæˆ–è€…å¦‚æœä½ æ²¡æœ‰ Visual Studio çš„ä¼ä¸šç‰ˆï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åšäº›å…¶ä»–çš„äº‹æƒ…â€¦
- en: Sure, we can run through the code and identify every moving part of it, but
    since this is a CLI application, letâ€™s do something smarter. ğŸ˜‰
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œä»£ç å¹¶è¯†åˆ«å…¶æ¯ä¸€ä¸ªç§»åŠ¨éƒ¨åˆ†ï¼Œä½†æ—¢ç„¶è¿™æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œåº”ç”¨ç¨‹åºï¼Œè®©æˆ‘ä»¬æ¥åšç‚¹æ›´èªæ˜çš„äº‹æƒ…ã€‚ğŸ˜‰
- en: Using the Help menu to build the code map
  id: totrans-22
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä½¿ç”¨å¸®åŠ©èœå•æ„å»ºä»£ç å›¾
- en: The `System.CommandLine` is certainly great for learning how to use the application,
    but it is also great for figuring out the code map of the application.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '`System.CommandLine` ç¡®å®éå¸¸é€‚åˆå­¦ä¹ å¦‚ä½•ä½¿ç”¨åº”ç”¨ç¨‹åºï¼Œä½†å®ƒä¹Ÿéå¸¸é€‚åˆç¡®å®šåº”ç”¨ç¨‹åºçš„ä»£ç å›¾ã€‚'
- en: 'Letâ€™s start by displaying the help menu at the root command by typing this
    command:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬ä»åœ¨æ ¹å‘½ä»¤ä¸­é€šè¿‡è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥æ˜¾ç¤ºå¸®åŠ©èœå•å¼€å§‹ï¼š
- en: '[PRE0]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'We will get this result:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†å¾—åˆ°ä»¥ä¸‹ç»“æœï¼š
- en: '![Figure 8.1 â€“ The help menu of the root command](img/B22400_08_01.jpg)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![å›¾ 8.1 â€“ æ ¹å‘½ä»¤çš„å¸®åŠ©èœå•](img/B22400_08_01.jpg)'
- en: Figure 8.1 â€“ The help menu of the root command
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ 8.1 â€“ æ ¹å‘½ä»¤çš„å¸®åŠ©èœå•
- en: Next, we will repeat this operation (aka displaying the help menu) for each
    of the subcommands of the root command, then for each subcommand of every subcommand,
    then forâ€¦ Okay, you get the idea! ğŸ˜‰
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é‡å¤æ­¤æ“ä½œï¼ˆå³æ˜¾ç¤ºå¸®åŠ©èœå•ï¼‰é’ˆå¯¹æ ¹å‘½ä»¤çš„æ¯ä¸ªå­å‘½ä»¤ï¼Œç„¶åé’ˆå¯¹æ¯ä¸ªå­å‘½ä»¤çš„æ¯ä¸ªå­å‘½ä»¤ï¼Œç„¶åâ€¦â€¦å¥½å§ï¼Œä½ æ˜ç™½äº†ï¼ğŸ˜‰
- en: 'Here is an example of the `link` command:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™é‡Œæ˜¯`link`å‘½ä»¤çš„ä¸€ä¸ªç¤ºä¾‹ï¼š
- en: '![Figure 8.2 â€“ The help menu of the link command](img/B22400_08_02.jpg)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![å›¾8.2 â€“ é“¾æ¥å‘½ä»¤çš„å¸®åŠ©èœå•](img/B22400_08_02.jpg)'
- en: Figure 8.2 â€“ The help menu of the link command
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾8.2 â€“ é“¾æ¥å‘½ä»¤çš„å¸®åŠ©èœå•
- en: 'When should we stop? Well, when the current command has no more subcommands.
    Here is an example with the `link` `add` command:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™åœæ­¢ï¼Ÿå—¯ï¼Œå½“å½“å‰å‘½ä»¤æ²¡æœ‰æ›´å¤šå­å‘½ä»¤æ—¶ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…³äº`link` `add`å‘½ä»¤çš„ç¤ºä¾‹ï¼š
- en: '![Figure 8.3 â€“ The help menu of the link add command](img/B22400_08_03.jpg)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![å›¾8.3 â€“ é“¾æ¥æ·»åŠ å‘½ä»¤çš„å¸®åŠ©èœå•](img/B22400_08_03.jpg)'
- en: Figure 8.3 â€“ The help menu of the link add command
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾8.3 â€“ é“¾æ¥æ·»åŠ å‘½ä»¤çš„å¸®åŠ©èœå•
- en: 'After completing this exercise, we will get the following code map:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: å®Œæˆè¿™ä¸ªç»ƒä¹ åï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä»¥ä¸‹ä»£ç å›¾ï¼š
- en: '![Figure 8.4 â€“ The code map of the Bookmarkr application](img/B22400_08_04.jpg)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![å›¾8.4 â€“ Bookmarkråº”ç”¨ç¨‹åºçš„ä»£ç å›¾](img/B22400_08_04.jpg)'
- en: Figure 8.4 â€“ The code map of the Bookmarkr application
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾8.4 â€“ Bookmarkråº”ç”¨ç¨‹åºçš„ä»£ç å›¾
- en: Okay, now that we have a clearer view of the moving parts in our application,
    what should we do next?
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: å¥½å§ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»å¯¹æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­çš„è¿åŠ¨éƒ¨ä»¶æœ‰äº†æ›´æ¸…æ™°çš„äº†è§£ï¼Œä¸‹ä¸€æ­¥è¯¥åšä»€ä¹ˆå‘¢ï¼Ÿ
- en: Step 2 â€“ deciding where to start
  id: totrans-40
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç¬¬2æ­¥ â€“ å†³å®šä»å“ªé‡Œå¼€å§‹
- en: Itâ€™s now time to decide what to refactor first.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æ˜¯æ—¶å€™å†³å®šå…ˆé‡æ„ä»€ä¹ˆäº†ã€‚
- en: I would recommend not to start with the root command first, but rather with
    the subcommands of that root command.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘å»ºè®®ä¸è¦é¦–å…ˆä»æ ¹å‘½ä»¤å¼€å§‹ï¼Œè€Œæ˜¯ä»è¯¥æ ¹å‘½ä»¤çš„å­å‘½ä»¤å¼€å§‹ã€‚
- en: There is no right or wrong decision from there. You can pick up any subcommand
    you would like to start with. We will take the `export` command as an example
    in the remainder of this chapter.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: ä»é‚£é‡Œå¼€å§‹ï¼Œæ²¡æœ‰å¯¹æˆ–é”™çš„å†³ç­–ã€‚ä½ å¯ä»¥é€‰æ‹©ä½ æƒ³è¦çš„ä»»ä½•å­å‘½ä»¤å¼€å§‹ã€‚åœ¨æœ¬ç« çš„å‰©ä½™éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ä»¥`export`å‘½ä»¤ä¸ºä¾‹ã€‚
- en: 'Although the `export` command does not have a subcommand, it will still help
    us lay out the foundation of the refactored version of *Bookmarkr*. More specifically,
    it will help us do the following:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: è™½ç„¶`export`å‘½ä»¤æ²¡æœ‰å­å‘½ä»¤ï¼Œä½†å®ƒä»ç„¶æœ‰åŠ©äºæˆ‘ä»¬ä¸º*Bookmarkr*çš„é‡æ„ç‰ˆæœ¬å¥ å®šåŸºç¡€ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œå®ƒå°†å¸®åŠ©æˆ‘ä»¬å®Œæˆä»¥ä¸‹å·¥ä½œï¼š
- en: Define the project structure to support our refactoring
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å®šä¹‰é¡¹ç›®ç»“æ„ä»¥æ”¯æŒæˆ‘ä»¬çš„é‡æ„
- en: Refactor it and hide its â€œcomplexityâ€ (aka moving parts to the root command)
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: é‡æ„å®ƒå¹¶éšè—å…¶â€œå¤æ‚æ€§â€ï¼ˆå³ç§»åŠ¨éƒ¨ä»¶åˆ°æ ¹å‘½ä»¤ï¼‰
- en: Refactor the `Program` class and make it leaner, cleaner, and more concise
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: é‡æ„`Program`ç±»ï¼Œä½¿å…¶æ›´ç²¾ç®€ã€æ›´å¹²å‡€ã€æ›´ç®€æ´
- en: Set up dependency injection for interacting between commands and external services
    (such as `BookmarkService`)
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: è®¾ç½®ä¾èµ–æ³¨å…¥ä»¥åœ¨å‘½ä»¤å’Œå¤–éƒ¨æœåŠ¡ï¼ˆå¦‚`BookmarkService`ï¼‰ä¹‹é—´è¿›è¡Œäº¤äº’
- en: Letâ€™s start with designing the project structure that will support our refactoring
    activities.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬ä»è®¾è®¡æ”¯æŒæˆ‘ä»¬é‡æ„æ´»åŠ¨çš„é¡¹ç›®ç»“æ„å¼€å§‹ã€‚
- en: Step 3 â€“ designing the project structure
  id: totrans-50
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç¬¬3æ­¥ â€“ è®¾è®¡é¡¹ç›®ç»“æ„
- en: Although one can design their project structure according to their tastes, I
    design mine in a way that makes it easy for whoever looks at my project to understand
    what it does and where each moving part is located.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: è™½ç„¶ä¸€ä¸ªäººå¯ä»¥æ ¹æ®ä»–ä»¬çš„å–œå¥½è®¾è®¡ä»–ä»¬çš„é¡¹ç›®ç»“æ„ï¼Œä½†æˆ‘è®¾è®¡æˆ‘çš„é¡¹ç›®ç»“æ„æ˜¯ä¸ºäº†è®©ä»»ä½•æŸ¥çœ‹æˆ‘çš„é¡¹ç›®çš„äººéƒ½èƒ½ç†è§£å®ƒåšä»€ä¹ˆä»¥åŠæ¯ä¸ªè¿åŠ¨éƒ¨ä»¶åœ¨å“ªé‡Œã€‚
- en: Following this principle, all commands will be grouped in a folder named `Commands`.
    This folder will be created at the root of the project structure.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: æŒ‰ç…§è¿™ä¸ªåŸåˆ™ï¼Œæ‰€æœ‰å‘½ä»¤éƒ½å°†è¢«åˆ†ç»„åœ¨ä¸€ä¸ªåä¸º`Commands`çš„æ–‡ä»¶å¤¹ä¸­ã€‚è¿™ä¸ªæ–‡ä»¶å¤¹å°†ä½äºé¡¹ç›®ç»“æ„çš„æ ¹ç›®å½•ã€‚
- en: Since we will be refactoring the `export` command, letâ€™s create a subfolder
    named `Export` where all the code artifacts involved in the `export` command will
    be located.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: ç”±äºæˆ‘ä»¬å°†é‡æ„`export`å‘½ä»¤ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º`Export`çš„å­æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­å°†åŒ…å«æ‰€æœ‰æ¶‰åŠ`export`å‘½ä»¤çš„ä»£ç å·¥ä»¶ã€‚
- en: Once we start refactoring another command, we will create a specific folder
    for it.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€æ—¦æˆ‘ä»¬å¼€å§‹é‡æ„å¦ä¸€ä¸ªå‘½ä»¤ï¼Œæˆ‘ä»¬å°†ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªç‰¹å®šçš„æ–‡ä»¶å¤¹ã€‚
- en: What about subcommands of a command?
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: å‘½ä»¤çš„å­å‘½ä»¤æ€ä¹ˆåŠï¼Ÿ
- en: Following the principle of **encapsulation** in object-oriented programming,
    and since a subcommand can only be invoked through its parent command, I recommend
    locating subcommands in the same folder as their parent command.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: éµå¾ªé¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„**å°è£…**åŸåˆ™ï¼Œå¹¶ä¸”ç”±äºå­å‘½ä»¤åªèƒ½é€šè¿‡å…¶çˆ¶å‘½ä»¤è°ƒç”¨ï¼Œæˆ‘å»ºè®®å°†å­å‘½ä»¤æ”¾åœ¨ä¸å…¶çˆ¶å‘½ä»¤ç›¸åŒçš„æ–‡ä»¶å¤¹ä¸­ã€‚
- en: An example of that is the `link add` command. The `add` subcommand can only
    be called through its parent (`link`) command. Hence, their life cycles are closely
    related to each other.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: ä¾‹å¦‚ï¼Œ`link add`å‘½ä»¤ã€‚`add`å­å‘½ä»¤åªèƒ½é€šè¿‡å…¶çˆ¶å‘½ä»¤ï¼ˆ`link`ï¼‰æ¥è°ƒç”¨ã€‚å› æ­¤ï¼Œå®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸç´§å¯†ç›¸å…³ã€‚
- en: For that matter, the code artifact of the `add` command will be located close
    to the code artifact of its parent command (`link`), within the `Link` folder.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: å…³äºè¿™ä¸€ç‚¹ï¼Œ`add`å‘½ä»¤çš„ä»£ç å·¥ä»¶å°†ä½äºå…¶çˆ¶å‘½ä»¤ï¼ˆ`link`ï¼‰çš„ä»£ç å·¥ä»¶é™„è¿‘ï¼Œåœ¨`Link`æ–‡ä»¶å¤¹ä¸­ã€‚
- en: Step 4 â€“ refactoring the export command
  id: totrans-59
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç¬¬4æ­¥ â€“ é‡æ„å¯¼å‡ºå‘½ä»¤
- en: Within the `Export` folder, letâ€™s create a new C# file named `ExportCommand.cs`.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨`Export`æ–‡ä»¶å¤¹ä¸­ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º`ExportCommand.cs`çš„æ–°C#æ–‡ä»¶ã€‚
- en: Every command class (including `RootCommand`) derives from the `Command` base
    class. Furthermore, that base class provides an `AddCommand` method that takes
    a parameter of the `Command` type, which also means any class that derives from
    the `Command` class.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: æ¯ä¸ªå‘½ä»¤ç±»ï¼ˆåŒ…æ‹¬`RootCommand`ï¼‰éƒ½ç»§æ‰¿è‡ª`Command`åŸºç±»ã€‚æ­¤å¤–ï¼Œè¯¥åŸºç±»æä¾›äº†ä¸€ä¸ªæ¥å—`Command`ç±»å‹å‚æ•°çš„`AddCommand`æ–¹æ³•ï¼Œè¿™æ„å‘³ç€ä»»ä½•ç»§æ‰¿è‡ª`Command`ç±»çš„ç±»ã€‚
- en: Armed with this, we can start refactoring the `export` command by making the
    `ExportCommand` class derive from `Command`.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: å¸¦ç€è¿™ä¸ªè®¤è¯†ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹é‡æ„`export`å‘½ä»¤ï¼Œé€šè¿‡ä½¿`ExportCommand`ç±»ç»§æ‰¿è‡ª`Command`ç±»ã€‚
- en: 'After importing the required `using` statement, specifying the `namespace`
    name, and adding the required class constructor, the first iteration of our class
    looks like this:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨å¯¼å…¥æ‰€éœ€çš„`using`è¯­å¥ã€æŒ‡å®š`namespace`åç§°å’Œæ·»åŠ æ‰€éœ€çš„ç±»æ„é€ å‡½æ•°ä¹‹åï¼Œæˆ‘ä»¬ç±»çš„ç¬¬ä¸€æ¬¡è¿­ä»£çœ‹èµ·æ¥å¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE1]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The first things to move into this class are the options. The `export` command
    has only one option, `outputfileOption`.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: é¦–å…ˆè¦ç§»åŠ¨åˆ°è¿™ä¸ªç±»ä¸­çš„æ˜¯é€‰é¡¹ã€‚`export`å‘½ä»¤åªæœ‰ä¸€ä¸ªé€‰é¡¹ï¼Œå³`outputfileOption`ã€‚
- en: I like the fact that every component of my class is well-segmented. Thatâ€™s why
    I am a fan of regions. For that reason, letâ€™s add a region dedicated to options
    and move the code for the `outputfileOption` option within this region.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘å–œæ¬¢æˆ‘çš„ç±»ä¸­çš„æ¯ä¸ªç»„ä»¶éƒ½å¾ˆå¥½åœ°åˆ†å‰²å¼€ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘æ˜¯åŒºåŸŸï¼ˆregionsï¼‰çš„ç²‰ä¸ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªä¸“é—¨ç”¨äºé€‰é¡¹çš„åŒºåŸŸï¼Œå¹¶å°†`outputfileOption`é€‰é¡¹çš„ä»£ç ç§»åŠ¨åˆ°è¿™ä¸ªåŒºåŸŸä¸­ã€‚
- en: 'The code looks like this:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: ä»£ç çœ‹èµ·æ¥å¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE2]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'We then need to associate this option with the command. We will do this by
    calling the `AddOption` method from within the constructor body, as follows:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œæˆ‘ä»¬éœ€è¦å°†æ­¤é€‰é¡¹ä¸å‘½ä»¤å…³è”èµ·æ¥ã€‚æˆ‘ä»¬å°†åœ¨æ„é€ å‡½æ•°ä½“å†…éƒ¨è°ƒç”¨`AddOption`æ–¹æ³•æ¥å®Œæˆæ­¤æ“ä½œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE3]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The next thing to move is the call to the `SetHandler` method, which connects
    the command to its handler method. So, the updated version of the constructor
    looks like this:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸‹ä¸€æ­¥è¦ç§»åŠ¨çš„æ˜¯å¯¹`SetHandler`æ–¹æ³•çš„è°ƒç”¨ï¼Œå®ƒå°†å‘½ä»¤è¿æ¥åˆ°å…¶å¤„ç†æ–¹æ³•ã€‚å› æ­¤ï¼Œæ„é€ å‡½æ•°çš„æ›´æ–°ç‰ˆæœ¬å¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE4]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Finally, the last piece of code to move into the new class is the command handler
    method. Once again, we will create a new region for that and move that final piece
    of code. We will also change the `static` modifier to `private`. The reason is
    that the class is not static (hence the removal of the `static` keyword) and the
    command handler method is private to that class (hence the use of the `private`
    keyword):'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€åï¼Œè¦ç§»åŠ¨åˆ°æ–°ç±»ä¸­çš„æœ€åä¸€éƒ¨åˆ†ä»£ç æ˜¯å‘½ä»¤å¤„ç†æ–¹æ³•ã€‚æˆ‘ä»¬å†æ¬¡å°†åˆ›å»ºä¸€ä¸ªæ–°çš„åŒºåŸŸæ¥å­˜æ”¾è¿™éƒ¨åˆ†ä»£ç ï¼Œå¹¶å°†æœ€åçš„ä»£ç ç§»åŠ¨è¿‡å»ã€‚æˆ‘ä»¬è¿˜å°†`static`ä¿®é¥°ç¬¦æ›´æ”¹ä¸º`private`ã€‚åŸå› æ˜¯ç±»ä¸æ˜¯é™æ€çš„ï¼ˆå› æ­¤ç§»é™¤äº†`static`å…³é”®å­—ï¼‰ï¼Œå‘½ä»¤å¤„ç†æ–¹æ³•æ˜¯ç§æœ‰çš„ï¼ˆå› æ­¤ä½¿ç”¨äº†`private`å…³é”®å­—ï¼‰ï¼š
- en: '[PRE5]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: If you are typing (or copying and pasting ğŸ˜‰) the code along the way, you can
    see at this point that the code does not compile because of two errors.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ­£åœ¨é”®å…¥ï¼ˆæˆ–å¤åˆ¶ç²˜è´´ ğŸ˜‰ï¼‰ä»£ç ï¼Œä½ å¯ä»¥åœ¨è¿™ä¸€ç‚¹ä¸Šçœ‹åˆ°ä»£ç å› ä¸ºä¸¤ä¸ªé”™è¯¯è€Œæ— æ³•ç¼–è¯‘ã€‚
- en: 'The first one is straightforward to solve. It suffices to add the following
    statement at the top of the C# file:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: ç¬¬ä¸€ä¸ªé—®é¢˜å¾ˆå®¹æ˜“è§£å†³ã€‚åªéœ€åœ¨C#æ–‡ä»¶é¡¶éƒ¨æ·»åŠ ä»¥ä¸‹è¯­å¥å³å¯ï¼š
- en: '[PRE6]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: The second one is less obvious to solve. It indicates that the class canâ€™t find
    an instance of the `BookmarkService` class.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: ç¬¬äºŒä¸ªé—®é¢˜ä¸å¤ªæ˜æ˜¾ï¼Œå®ƒè¡¨æ˜ç±»æ‰¾ä¸åˆ°`BookmarkService`ç±»çš„å®ä¾‹ã€‚
- en: Of course, we could simply create an instance of that service within the current
    class. However, since `BookmarkService` is an external dependency to the `ExportCommand`
    class, doing so will break the principle of **dependency inversion** advocated
    by object-oriented programming.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å½“å‰ç±»ä¸­ç®€å•åœ°åˆ›å»ºè¯¥æœåŠ¡çš„å®ä¾‹ã€‚ç„¶è€Œï¼Œç”±äº`BookmarkService`æ˜¯`ExportCommand`ç±»çš„å¤–éƒ¨ä¾èµ–ï¼Œè¿™æ ·åšå°†è¿åé¢å‘å¯¹è±¡ç¼–ç¨‹æ‰€å€¡å¯¼çš„**ä¾èµ–å€’ç½®**åŸåˆ™ã€‚
- en: As a reminder, the principle of dependency inversion is one of the five SOLID
    principles of object-oriented programming and design. It states that high-level
    modules should not depend on low-level modules; both should depend on abstractions.
    Additionally, abstractions should not depend on details; details should depend
    on abstractions. This principle helps to decouple software modules, making the
    system more modular, flexible, and easier to maintain.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œä¸ºæé†’ï¼Œä¾èµ–å€’ç½®åŸåˆ™æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹å’Œè®¾è®¡çš„äº”ä¸ª SOLID åŸåˆ™ä¹‹ä¸€ã€‚å®ƒæŒ‡å‡ºï¼Œé«˜çº§æ¨¡å—ä¸åº”è¯¥ä¾èµ–äºä½çº§æ¨¡å—ï¼›ä¸¤è€…éƒ½åº”ä¾èµ–äºæŠ½è±¡ã€‚æ­¤å¤–ï¼ŒæŠ½è±¡ä¸åº”è¯¥ä¾èµ–äºç»†èŠ‚ï¼›ç»†èŠ‚åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚è¿™ä¸ªåŸåˆ™æœ‰åŠ©äºè§£è€¦è½¯ä»¶æ¨¡å—ï¼Œä½¿ç³»ç»Ÿæ›´åŠ æ¨¡å—åŒ–ã€çµæ´»ï¼Œå¹¶ä¸”æ›´å®¹æ˜“ç»´æŠ¤ã€‚
- en: What does that practically mean? It means that we should inject an instance
    of `BookmarkService` into the `ExportCommand` class.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å®é™…ä¸Šæ„å‘³ç€ä»€ä¹ˆï¼Ÿè¿™æ„å‘³ç€æˆ‘ä»¬åº”è¯¥å°† `BookmarkService` å®ä¾‹æ³¨å…¥åˆ° `ExportCommand` ç±»ä¸­ã€‚
- en: Letâ€™s do this!
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬å¼€å§‹åšå§ï¼
- en: Step 5 â€“ applying the dependency inversion principle
  id: totrans-83
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç¬¬5æ­¥ â€“ åº”ç”¨ä¾èµ–å€’ç½®åŸåˆ™
- en: If you are familiar with the dependency inversion principle, you will certainly
    have already noticed that the `BookmarkService` class does not implement any interface.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ ç†Ÿæ‚‰ä¾èµ–å€’ç½®åŸåˆ™ï¼Œä½ è‚¯å®šä¼šå·²ç»æ³¨æ„åˆ° `BookmarkService` ç±»æ²¡æœ‰å®ç°ä»»ä½•æ¥å£ã€‚
- en: Letâ€™s start by fixing this.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬å…ˆè§£å†³è¿™ä¸ªé—®é¢˜ã€‚
- en: I am not familiar with the dependency inversion principle!
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘å¯¹ä¾èµ–å€’ç½®åŸåˆ™ä¸å¤ªç†Ÿæ‚‰ï¼
- en: If you are not, there are plenty of great resources to explore this principle.
    It is not a complicated principle to understand, and quite frankly, after you
    learn about it, it will seem so obvious to you that you will be wondering why
    you did not know about it earlier.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ è¿˜æ²¡æœ‰è¿™æ ·åšï¼Œæœ‰å¾ˆå¤šä¼˜ç§€çš„èµ„æºå¯ä»¥æ¢ç´¢è¿™ä¸ªåŸåˆ™ã€‚è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªéš¾ä»¥ç†è§£çš„åŸåˆ™ï¼Œå¦ç™½è¯´ï¼Œåœ¨ä½ äº†è§£å®ƒä¹‹åï¼Œå®ƒå°†æ˜¾å¾—å¦‚æ­¤æ˜æ˜¾ï¼Œä»¥è‡³äºä½ ä¼š wonder ä¸ºä»€ä¹ˆä½ ä¹‹å‰ä¸çŸ¥é“å®ƒã€‚
- en: A great explanation of that principle can be found at [https://www.c-sharpcorner.com/article/dependency-inversion-principle-in-c-sharp/](https://www.c-sharpcorner.com/article/dependency-inversion-principle-in-c-sharp/).
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: å¯ä»¥åœ¨ [https://www.c-sharpcorner.com/article/dependency-inversion-principle-in-c-sharp/](https://www.c-sharpcorner.com/article/dependency-inversion-principle-in-c-sharp/)
    æ‰¾åˆ°è¯¥åŸåˆ™çš„å‡ºè‰²è§£é‡Šã€‚
- en: I highly encourage you to go and review the implementation of the `BookmarkService`
    service before and after applying the dependency inversion principle in order
    to have a clear understanding of the benefits.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘å¼ºçƒˆå»ºè®®ä½ åœ¨åº”ç”¨ä¾èµ–å€’ç½®åŸåˆ™ä¹‹å‰å’Œä¹‹åå®¡æŸ¥ `BookmarkService` æœåŠ¡çš„å®ç°ï¼Œä»¥ä¾¿å¯¹å®ƒçš„å¥½å¤„æœ‰æ¸…æ™°çš„ç†è§£ã€‚
- en: Back to our project structure discussion, we will start by creating a new folder
    called `Services` that will group all our services classes. Within that folder,
    letâ€™s create a specific folder for every service. In our case, we only have one
    service, so letâ€™s create the `BookmarkService` folder. This folder will contain
    both the interface and the concrete implementation of our service.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: å›åˆ°æˆ‘ä»¬å…³äºé¡¹ç›®ç»“æ„è®¨è®ºçš„è¯é¢˜ï¼Œæˆ‘ä»¬é¦–å…ˆå°†åˆ›å»ºä¸€ä¸ªåä¸º `Services` çš„æ–°æ–‡ä»¶å¤¹ï¼Œç”¨äºç»„ç»‡æˆ‘ä»¬æ‰€æœ‰çš„æœåŠ¡ç±»ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹å†…ï¼Œä¸ºæ¯ä¸ªæœåŠ¡åˆ›å»ºä¸€ä¸ªç‰¹å®šçš„æ–‡ä»¶å¤¹ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªæœåŠ¡ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬åˆ›å»º
    `BookmarkService` æ–‡ä»¶å¤¹ã€‚è¿™ä¸ªæ–‡ä»¶å¤¹å°†åŒ…å«æˆ‘ä»¬æœåŠ¡çš„æ¥å£å’Œå…·ä½“å®ç°ã€‚
- en: 'The folder structure for our service will then look like this:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬æœåŠ¡çš„æ–‡ä»¶å¤¹ç»“æ„å°†å¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '![Figure 8.5 â€“ The folder structure for the BookmarkService service](img/B22400_08_05.jpg)'
  id: totrans-92
  prefs: []
  type: TYPE_IMG
  zh: '![å›¾8.5 â€“ `BookmarkService` æœåŠ¡çš„æ–‡ä»¶å¤¹ç»“æ„](img/B22400_08_05.jpg)'
- en: Figure 8.5 â€“ The folder structure for the BookmarkService service
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾8.5 â€“ `BookmarkService` æœåŠ¡çš„æ–‡ä»¶å¤¹ç»“æ„
- en: 'Next, letâ€™s extract the `IBookmarkService` interface out of the `BookmarkService`
    class. The code for that interface looks like this:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å°† `IBookmarkService` æ¥å£ä» `BookmarkService` ç±»ä¸­æå–å‡ºæ¥ã€‚è¯¥æ¥å£çš„ä»£ç å¦‚ä¸‹ï¼š
- en: '[PRE7]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Now, letâ€™s make the `BookmarkService` class implement the `IBookmarkService`
    interface:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œè®©æˆ‘ä»¬è®© `BookmarkService` ç±»å®ç° `IBookmarkService` æ¥å£ï¼š
- en: '[PRE8]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Notice that we changed the namespace name for these artifacts in order to better
    convey their intention.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨æ„ï¼Œæˆ‘ä»¬ä¸ºäº†æ›´å¥½åœ°ä¼ è¾¾å®ƒä»¬çš„æ„å›¾ï¼Œå·²ç»æ›´æ”¹äº†è¿™äº›å®ä½“çš„å‘½åç©ºé—´åç§°ã€‚
- en: 'All that is left to do now is to inject that service into the `ExportCommand`
    class. This means two things:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨å‰©ä¸‹çš„å·¥ä½œå°±æ˜¯å°†è¯¥æœåŠ¡æ³¨å…¥åˆ° `ExportCommand` ç±»ä¸­ã€‚è¿™æ„å‘³ç€ä¸¤ä»¶äº‹ï¼š
- en: We will add a `private` property of the `IBookmarkService` type in the `ExportCommand`
    class that will allow us to invoke the methods of that service from within the
    command class (more specifically, from within the `OnExportCommand` method).
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†åœ¨ `ExportCommand` ç±»ä¸­æ·»åŠ ä¸€ä¸ª `private` ç±»å‹çš„ `IBookmarkService` å±æ€§ï¼Œè¿™å°†å…è®¸æˆ‘ä»¬åœ¨å‘½ä»¤ç±»å†…éƒ¨ï¼ˆæ›´å…·ä½“åœ°è¯´ï¼Œåœ¨
    `OnExportCommand` æ–¹æ³•å†…éƒ¨ï¼‰è°ƒç”¨è¯¥æœåŠ¡çš„æ–¹æ³•ã€‚
- en: We will inject an instance of that service through a constructor parameter.
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†é€šè¿‡æ„é€ å‡½æ•°å‚æ•°æ³¨å…¥è¯¥æœåŠ¡çš„å®ä¾‹ã€‚
- en: 'The updated code of the `ExportCommand` class looks like this now:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: '`ExportCommand`ç±»çš„æ›´æ–°ä»£ç ç°åœ¨çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š'
- en: '[PRE9]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: This code is very straightforward to understand and does not require any particular
    explanation.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ®µä»£ç éå¸¸å®¹æ˜“ç†è§£ï¼Œä¸éœ€è¦ä»»ä½•ç‰¹åˆ«çš„è§£é‡Šã€‚
- en: The dependency inversion principle may introduce complexity!
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: ä¾èµ–å€’ç½®åŸåˆ™å¯èƒ½ä¼šå¼•å…¥å¤æ‚æ€§ï¼
- en: Dependency injection can introduce some overhead in simple applications by requiring
    additional setup and configuration, such as adding extra interfaces, classes,
    and indirection, which can be unnecessary for straightforward projects with few
    dependencies.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: ä¾èµ–æ³¨å…¥å¯èƒ½ä¼šé€šè¿‡éœ€è¦é¢å¤–çš„è®¾ç½®å’Œé…ç½®ï¼ˆä¾‹å¦‚æ·»åŠ é¢å¤–çš„æ¥å£ã€ç±»å’Œé—´æ¥å¼•ç”¨ï¼‰åœ¨ç®€å•åº”ç”¨ä¸­å¼•å…¥ä¸€äº›å¼€é”€ï¼Œè¿™å¯¹äºä¾èµ–è¾ƒå°‘çš„ç®€å•é¡¹ç›®å¯èƒ½æ˜¯å¤šä½™çš„ã€‚
- en: Therefore, it is important to find a balance between applying this principle
    without adding too much complexity to the code base.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: å› æ­¤ï¼Œæ‰¾åˆ°åœ¨ä¸ç»™ä»£ç åº“å¢åŠ å¤ªå¤šå¤æ‚æ€§çš„æƒ…å†µä¸‹åº”ç”¨æ­¤åŸåˆ™çš„å¹³è¡¡æ˜¯å¾ˆé‡è¦çš„ã€‚
- en: That is wonderful. We have come a long way since we started our refactoring
    journey!
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™çœŸæ˜¯å¤ªå¥½äº†ã€‚è‡ªä»æˆ‘ä»¬å¼€å§‹é‡æ„ä¹‹æ—…ä»¥æ¥ï¼Œæˆ‘ä»¬å·²ç»èµ°äº†å¾ˆé•¿çš„è·¯ï¼
- en: 'There is one last piece of code we havenâ€™t refactored yet. It is the one for
    which we started this journey in the first place: the `Program` class.'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: è¿˜æœ‰æœ€åä¸€æ®µä»£ç æˆ‘ä»¬æ²¡æœ‰é‡æ„ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æœ€åˆå¼€å§‹è¿™æ®µæ—…ç¨‹çš„åŸå› ï¼š`Program`ç±»ã€‚
- en: Letâ€™s turn our attention to this class nowâ€¦
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬ç°åœ¨å°†æ³¨æ„åŠ›è½¬å‘è¿™ä¸ªç±»â€¦
- en: Step 6 â€“ refactoring the Program class
  id: totrans-111
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç¬¬6æ­¥ - é‡æ„`Program`ç±»
- en: By refactoring the commands into their dedicated classes, the code to create
    and handle these commands will be removed from the `Program` class.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: é€šè¿‡å°†å‘½ä»¤é‡æ„åˆ°å®ƒä»¬å„è‡ªçš„ç±»ä¸­ï¼Œåˆ›å»ºå’Œå¤„ç†è¿™äº›å‘½ä»¤çš„ä»£ç å°†ä»`Program`ç±»ä¸­ç§»é™¤ã€‚
- en: 'Hence, the `Program` class will now only be used to compose our application.
    More specifically, the `Program` class will do the following:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: å› æ­¤ï¼Œ`Program`ç±»ç°åœ¨å°†ä»…ç”¨äºç»„åˆæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚æ›´å…·ä½“åœ°è¯´ï¼Œ`Program`ç±»å°†æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
- en: Instantiate the root command and register its subcommands.
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å®ä¾‹åŒ–æ ¹å‘½ä»¤å¹¶æ³¨å†Œå…¶å­å‘½ä»¤ã€‚
- en: Instantiate and configure the `CommandLineBuilder` class and start the program.
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å®ä¾‹åŒ–å’Œé…ç½®`CommandLineBuilder`ç±»ï¼Œå¹¶å¯åŠ¨ç¨‹åºã€‚
- en: Configure logging.
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: é…ç½®æ—¥å¿—ã€‚
- en: Configure dependency injection of the `BookmarkService` service.
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: é…ç½®`BookmarkService`æœåŠ¡çš„ä¾èµ–æ³¨å…¥ã€‚
- en: 'Here is the refactored code for the `Program` class (note that some parts of
    the code, including `using` statements, are not listed here for brevity and clarity):'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™é‡Œæ˜¯`Program`ç±»çš„é‡æ„ä»£ç ï¼ˆè¯·æ³¨æ„ï¼Œä¸ºäº†ç®€æ´å’Œæ¸…æ™°ï¼Œè¿™é‡Œæ²¡æœ‰åˆ—å‡ºä»£ç çš„éƒ¨åˆ†ï¼ŒåŒ…æ‹¬`using`è¯­å¥ï¼‰ï¼š
- en: '[PRE10]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: This code is mostly straightforward to understand.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ®µä»£ç ä¸»è¦å¾ˆå®¹æ˜“ç†è§£ã€‚
- en: 'The only part that is worth an explanation is how we perform dependency injection
    of services (here, with `BookmarkService`):'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: å€¼å¾—è§£é‡Šçš„å”¯ä¸€éƒ¨åˆ†æ˜¯æˆ‘ä»¬å¦‚ä½•æ‰§è¡ŒæœåŠ¡çš„ä¾èµ–æ³¨å…¥ï¼ˆè¿™é‡Œä½¿ç”¨`BookmarkService`ï¼‰ï¼š
- en: We declare a variable of the `IBookmarkService` type that will be used to retrieve
    an instance of the injected service.
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ª`IBookmarkService`ç±»å‹çš„å˜é‡ï¼Œè¯¥å˜é‡å°†ç”¨äºæ£€ç´¢æ³¨å…¥çš„æœåŠ¡å®ä¾‹ã€‚
- en: We configure the dependency injection by leveraging the `HostBuilder` class
    provided by .NET and registering services to the `IServiceCollection` collection.
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬é€šè¿‡åˆ©ç”¨.NETæä¾›çš„`HostBuilder`ç±»å¹¶æ³¨å†ŒæœåŠ¡åˆ°`IServiceCollection`é›†åˆæ¥é…ç½®ä¾èµ–æ³¨å…¥ã€‚
- en: We retrieve the instance of the registered services by calling `GetRequiredService`
    on the `IServiceCollection` collection and store a reference to the retrieved
    service into the variable we declared earlier.
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬é€šè¿‡åœ¨`IServiceCollection`é›†åˆä¸Šè°ƒç”¨`GetRequiredService`æ¥æ£€ç´¢å·²æ³¨å†Œçš„æœåŠ¡å®ä¾‹ï¼Œå¹¶å°†æ£€ç´¢åˆ°çš„æœåŠ¡å¼•ç”¨å­˜å‚¨åˆ°æˆ‘ä»¬ä¹‹å‰å£°æ˜çš„å˜é‡ä¸­ã€‚
- en: When creating an instance of a new command, we pass that variable as a parameter
    to the commandâ€™s constructor so that the new command receives an instance of the
    service.
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å½“åˆ›å»ºæ–°å‘½ä»¤çš„å®ä¾‹æ—¶ï¼Œæˆ‘ä»¬å°†è¯¥å˜é‡ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‘½ä»¤çš„æ„é€ å‡½æ•°ï¼Œä»¥ä¾¿æ–°å‘½ä»¤æ¥æ”¶æœåŠ¡å®ä¾‹ã€‚
- en: And voila! The service is automatically instantiated and injected into the various
    commands that require it.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: å“‡ï¼æœåŠ¡è¢«è‡ªåŠ¨å®ä¾‹åŒ–å¹¶æ³¨å…¥åˆ°éœ€è¦å®ƒçš„å„ç§å‘½ä»¤ä¸­ã€‚
- en: Whatâ€™s great about this approach is that if we need to change the service implementation,
    all we need to do is modify the service registration to `IServiceCollection` and
    the rest will be magically taken care of.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ›´æ”¹æœåŠ¡å®ç°ï¼Œæˆ‘ä»¬åªéœ€ä¿®æ”¹æœåŠ¡æ³¨å†Œåˆ°`IServiceCollection`ï¼Œå…¶ä½™çš„å°†ç¥å¥‡åœ°å¾—åˆ°å¤„ç†ã€‚
- en: Note how the `Program.cs` file has shrunk from 479 lines of code to 115 lines
    of code!
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨æ„åˆ°`Program.cs`æ–‡ä»¶ä»479è¡Œä»£ç ç¼©å‡åˆ°äº†115è¡Œä»£ç ï¼
- en: 'And the best part? Registering a new command to the root command is a matter
    of one extra line of code (aka, calling `AddCommand` on the root command and passing
    an instance of the new command to be registered), while injecting a new service
    is a matter of two lines of code: one for adding the service into the services
    collection and the other for getting a reference to that service in order to pass
    it to classes that require it.'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€å¥½çš„éƒ¨åˆ†æ˜¯ï¼Ÿå°†æ–°å‘½ä»¤æ³¨å†Œåˆ°æ ¹å‘½ä»¤åªéœ€è¦ä¸€è¡Œé¢å¤–çš„ä»£ç ï¼ˆå³ï¼Œåœ¨æ ¹å‘½ä»¤ä¸Šè°ƒç”¨`AddCommand`å¹¶ä¼ é€’è¦æ³¨å†Œçš„æ–°å‘½ä»¤çš„å®ä¾‹ï¼‰ï¼Œè€Œæ³¨å…¥æ–°æœåŠ¡åªéœ€è¦ä¸¤è¡Œä»£ç ï¼šä¸€è¡Œç”¨äºå°†æœåŠ¡æ·»åŠ åˆ°æœåŠ¡é›†åˆä¸­ï¼Œå¦ä¸€è¡Œç”¨äºè·å–è¯¥æœåŠ¡çš„å¼•ç”¨ä»¥ä¾¿ä¼ é€’ç»™éœ€è¦å®ƒçš„ç±»ã€‚
- en: Beware of the pitfalls!
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: å°å¿ƒé™·é˜±ï¼
- en: Common pitfalls in dependency injection include circular dependencies, where
    classes depend on each other, and unintended singleton behavior, which can arise
    from improper service lifetimes. Over-injection of dependencies can violate the
    Single-Responsibility Principle, while excessive reliance on service locators
    complicates testing. To avoid these issues, itâ€™s crucial to manage service lifetimes
    carefully and follow best practices.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: ä¾èµ–æ³¨å…¥çš„å¸¸è§é™·é˜±åŒ…æ‹¬å¾ªç¯ä¾èµ–ï¼Œå…¶ä¸­ç±»ç›¸äº’ä¾èµ–ï¼Œä»¥åŠç”±äºæœåŠ¡ç”Ÿå‘½å‘¨æœŸä¸å½“è€Œå¯èƒ½å‡ºç°çš„æ„å¤–å•ä¾‹è¡Œä¸ºã€‚è¿‡åº¦æ³¨å…¥ä¾èµ–é¡¹å¯èƒ½ä¼šè¿åå•ä¸€èŒè´£åŸåˆ™ï¼Œè€Œè¿‡åº¦ä¾èµ–æœåŠ¡å®šä½å™¨ä¼šå¤æ‚åŒ–æµ‹è¯•ã€‚ä¸ºäº†é¿å…è¿™äº›é—®é¢˜ï¼Œä»”ç»†ç®¡ç†æœåŠ¡ç”Ÿå‘½å‘¨æœŸå¹¶éµå¾ªæœ€ä½³å®è·µè‡³å…³é‡è¦ã€‚
- en: I highly recommend that you check out the reading recommendations in [*Chapter
    14*](B22400_14.xhtml#_idTextAnchor236) in order to explore this topic more deeply
    when necessary.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘å¼ºçƒˆå»ºè®®æ‚¨æŸ¥çœ‹[ç¬¬ 14 ç« ](B22400_14.xhtml#_idTextAnchor236)ä¸­çš„é˜…è¯»æ¨èï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶æ›´æ·±å…¥åœ°æ¢ç´¢è¿™ä¸ªä¸»é¢˜ã€‚
- en: Step 7 â€“ running the program
  id: totrans-133
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç¬¬ 7 æ­¥ â€“ è¿è¡Œç¨‹åº
- en: Perfect! We have completed the refactoring of the `export` command. Letâ€™s run
    the code to ensure that it still works as expected.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: å®Œç¾ï¼æˆ‘ä»¬å·²ç»å®Œæˆäº†`export`å‘½ä»¤çš„é‡æ„ã€‚è®©æˆ‘ä»¬è¿è¡Œä»£ç ä»¥ç¡®ä¿å®ƒä»ç„¶æŒ‰é¢„æœŸå·¥ä½œã€‚
- en: 'The syntax to invoke the `export` command hasnâ€™t changed. So, letâ€™s invoke
    it the same way as before by typing the following:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: è°ƒç”¨`export`å‘½ä»¤çš„è¯­æ³•æ²¡æœ‰å˜åŒ–ã€‚æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬åƒä»¥å‰ä¸€æ ·é€šè¿‡è¾“å…¥ä»¥ä¸‹å†…å®¹æ¥è°ƒç”¨å®ƒï¼š
- en: '[PRE11]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'We will get the following results:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†å¾—åˆ°ä»¥ä¸‹ç»“æœï¼š
- en: '![Figure 8.6 â€“ Invoking the export command after refactoring](img/B22400_08_06.jpg)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
  zh: '![å›¾ 8.6 â€“ ä¿®æ”¹åè°ƒç”¨å¯¼å‡ºå‘½ä»¤](img/B22400_08_06.jpg)'
- en: Figure 8.6 â€“ Invoking the export command after refactoring
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ 8.6 â€“ ä¿®æ”¹åè°ƒç”¨å¯¼å‡ºå‘½ä»¤
- en: Wonderful! The application still works as expected.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: å¤ªæ£’äº†ï¼åº”ç”¨ç¨‹åºä»ç„¶æŒ‰é¢„æœŸå·¥ä½œã€‚
- en: We have done a lot of refactoring to our application so far. But is that all?
    Or can we take it to another level?
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å¯¹æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè¿›è¡Œäº†å¤§é‡çš„é‡æ„ã€‚ä½†è¿™å°±æ˜¯å…¨éƒ¨å—ï¼Ÿæˆ–è€…æˆ‘ä»¬å¯ä»¥å°†å…¶æå‡åˆ°å¦ä¸€ä¸ªå±‚æ¬¡ï¼Ÿ
- en: Taking refactoring to new heights
  id: totrans-142
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å°†é‡æ„æå‡åˆ°æ–°çš„é«˜åº¦
- en: You may have been wondering why we didnâ€™t extract options and handler methods
    into their own code artifacts (such as classes).
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘ä»¬æ²¡æœ‰å°†é€‰é¡¹å’Œå¤„ç†å™¨æ–¹æ³•æå–åˆ°å®ƒä»¬è‡ªå·±çš„ä»£ç å·¥ä»¶ï¼ˆå¦‚ç±»ï¼‰ä¸­ã€‚
- en: The reason is that options and handler methods (and also arguments) are usually
    unique to a specific command. For this reason, they are defined in the command
    class.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: åŸå› æ˜¯é€‰é¡¹å’Œå¤„ç†å™¨æ–¹æ³•ï¼ˆä»¥åŠå‚æ•°ï¼‰é€šå¸¸å¯¹ç‰¹å®šå‘½ä»¤æ˜¯å”¯ä¸€çš„ã€‚å› æ­¤ï¼Œå®ƒä»¬åœ¨å‘½ä»¤ç±»ä¸­å®šä¹‰ã€‚
- en: However, in situations where they would need to be used by more than one command,
    we would have extracted them into their own code artifact. This reasoning is important
    to keep in mind in order to avoid over-complexifying our design by over-abstracting
    it.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶è€Œï¼Œåœ¨å®ƒä»¬éœ€è¦è¢«å¤šä¸ªå‘½ä»¤ä½¿ç”¨çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šå°†å®ƒä»¬æå–åˆ°å®ƒä»¬è‡ªå·±çš„ä»£ç å·¥ä»¶ä¸­ã€‚è®°ä½è¿™ä¸ªæ¨ç†å¾ˆé‡è¦ï¼Œä»¥é¿å…é€šè¿‡è¿‡åº¦æŠ½è±¡è€Œä½¿æˆ‘ä»¬çš„è®¾è®¡è¿‡äºå¤æ‚åŒ–ã€‚
- en: 'In the case of an option, we would have created a dedicated class. Hereâ€™s an
    example of `outputfileOption` we used in our `ExportCommand` class:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨é€‰é¡¹çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ªä¸“ç”¨ç±»ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬`ExportCommand`ç±»ä¸­ä½¿ç”¨çš„`outputfileOption`çš„ç¤ºä¾‹ï¼š
- en: '[PRE12]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'We could then use this option in any command by creating an instance of it,
    as follows:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­¤é€‰é¡¹åœ¨ä»»ä½•å‘½ä»¤ä¸­ï¼Œé€šè¿‡åˆ›å»ºå…¶å®ä¾‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE13]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Here is how it would have looked for `ExportCommand`:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸‹é¢æ˜¯`ExportCommand`å¯èƒ½çœ‹èµ·æ¥åƒçš„æ ·å­ï¼š
- en: '[PRE14]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Pay special attention to how the `outputfileOption` property is declared (in
    the `Options` region) and how it is instantiated and initialized in the constructor.
    Its usage is no different from before.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·ç‰¹åˆ«æ³¨æ„`outputfileOption`å±æ€§æ˜¯å¦‚ä½•å£°æ˜çš„ï¼ˆåœ¨`Options`åŒºåŸŸï¼‰ä»¥åŠå®ƒå¦‚ä½•åœ¨æ„é€ å‡½æ•°ä¸­å®ä¾‹åŒ–å’Œåˆå§‹åŒ–ã€‚å®ƒçš„ä½¿ç”¨æ–¹å¼ä¸ä¹‹å‰æ²¡æœ‰ä¸åŒã€‚
- en: In the case of a handler method, we would have created a base class that derives
    from `Command` (letâ€™s call it `CommandWithBaseHandler`), add the handler method
    to it (allowing it to be overridden), and make our command classes derive from
    that `CommandWithBaseHandler` class rather than from the `Command` class.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨å¤„ç†æ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ªä»`Command`æ´¾ç”Ÿçš„åŸºç±»ï¼ˆè®©æˆ‘ä»¬ç§°å®ƒä¸º`CommandWithBaseHandler`ï¼‰ï¼Œå‘å…¶ä¸­æ·»åŠ å¤„ç†æ–¹æ³•ï¼ˆå…è®¸å®ƒè¢«è¦†ç›–ï¼‰ï¼Œå¹¶ä½¿æˆ‘ä»¬çš„å‘½ä»¤ç±»ä»é‚£ä¸ª`CommandWithBaseHandler`ç±»æ´¾ç”Ÿï¼Œè€Œä¸æ˜¯ä»`Command`ç±»æ´¾ç”Ÿã€‚
- en: 'The `CommandWithBaseHandler` class could have looked like this:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: '`CommandWithBaseHandler`ç±»å¯èƒ½çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š'
- en: '[PRE15]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Notice that the `OnExportCommand` method has been marked as `virtual`. This
    means that it provides a default implementation in the `CommandWithBaseHandler`
    class but allows that implementation to be overridden if needed.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨æ„åˆ°`OnExportCommand`æ–¹æ³•å·²è¢«æ ‡è®°ä¸º`virtual`ã€‚è¿™æ„å‘³ç€å®ƒæä¾›äº†`CommandWithBaseHandler`ç±»ä¸­çš„é»˜è®¤å®ç°ï¼Œä½†å¦‚æœéœ€è¦ï¼Œå…è®¸è¯¥å®ç°è¢«è¦†ç›–ã€‚
- en: 'We could then have modified the `ExportCommand` class as follows:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ–¹å¼ä¿®æ”¹`ExportCommand`ç±»ï¼š
- en: '[PRE16]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Perfect! But where would these new code artifacts fit into our project structure?
    Great question!
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: å®Œç¾ï¼ä½†è¿™äº›æ–°çš„ä»£ç ç»„ä»¶å°†å¦‚ä½•èå…¥æˆ‘ä»¬çš„é¡¹ç›®ç»“æ„ä¸­ï¼Ÿè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ï¼
- en: Letâ€™s update our project structure to accommodate these new artifacts.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬æ›´æ–°æˆ‘ä»¬çš„é¡¹ç›®ç»“æ„ä»¥é€‚åº”è¿™äº›æ–°çš„ç»„ä»¶ã€‚
- en: Updating the project structure
  id: totrans-161
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æ›´æ–°é¡¹ç›®ç»“æ„
- en: 'Following the same principle regarding project structure that we applied so
    far, I suggest the following:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: æŒ‰ç…§è¿„ä»Šä¸ºæ­¢åº”ç”¨çš„é¡¹ç›®ç»“æ„åŸåˆ™ï¼Œæˆ‘å»ºè®®ä»¥ä¸‹åšæ³•ï¼š
- en: '![Figure 8.7 â€“ The project structure for commands](img/B22400_08_07.jpg)'
  id: totrans-163
  prefs: []
  type: TYPE_IMG
  zh: '![å›¾8.7 â€“ å‘½ä»¤çš„é¡¹ç›®ç»“æ„](img/B22400_08_07.jpg)'
- en: Figure 8.7 â€“ The project structure for commands
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾8.7 â€“ å‘½ä»¤çš„é¡¹ç›®ç»“æ„
- en: Awesome! We now have an application that is more modular and easily extensible.
    Everything has its own place so itâ€™s easier to read and navigate the applicationâ€™s
    code.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: å¤ªæ£’äº†ï¼æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªæ›´åŠ æ¨¡å—åŒ–å’Œæ˜“äºæ‰©å±•çš„åº”ç”¨ç¨‹åºã€‚ä¸€åˆ‡éƒ½æœ‰å…¶åˆé€‚çš„ä½ç½®ï¼Œè¿™ä½¿å¾—é˜…è¯»å’Œå¯¼èˆªåº”ç”¨ç¨‹åºçš„ä»£ç å˜å¾—æ›´åŠ å®¹æ˜“ã€‚
- en: Wait, extensible?!
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: ç­‰ç­‰ï¼Œå¯æ‰©å±•ï¼Ÿï¼
- en: You may not have noticed, but the refactoring exercise we have done throughout
    this chapter not only enhanced our application from a modularity standpoint but
    also from an extensibility standpoint.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¯èƒ½æ²¡æœ‰æ³¨æ„åˆ°ï¼Œä½†æˆ‘ä»¬åœ¨è¿™ç« ä¸­è¿›è¡Œçš„é‡æ„ä¸ä»…ä»æ¨¡å—åŒ–çš„è§’åº¦å¢å¼ºäº†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œè¿˜ä»å¯æ‰©å±•æ€§çš„è§’åº¦è¿›è¡Œäº†å¢å¼ºã€‚
- en: 'Think about it: we can now easily involve other teammates in the development
    of our application, making delivering new features to our users even faster.'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: æƒ³æƒ³çœ‹ï¼šæˆ‘ä»¬ç°åœ¨å¯ä»¥è½»æ¾åœ°è®©å…¶ä»–å›¢é˜Ÿæˆå‘˜å‚ä¸åˆ°æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„å¼€å‘ä¸­ï¼Œä½¿å¾—å‘ç”¨æˆ·äº¤ä»˜æ–°ç‰¹æ€§å˜å¾—æ›´åŠ è¿…é€Ÿã€‚
- en: Every team member can focus on their very own command, impacting only a small
    subset of code artifacts and, in most cases, they wonâ€™t modify the same files,
    reducing the number of merge conflicts that may occur when pushing their code
    into the source control.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: æ¯ä¸ªå›¢é˜Ÿæˆå‘˜éƒ½å¯ä»¥ä¸“æ³¨äºä»–ä»¬è‡ªå·±çš„å‘½ä»¤ï¼Œè¿™åªä¼šå½±å“ä¸€å°éƒ¨åˆ†ä»£ç ç»„ä»¶ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä»–ä»¬ä¸ä¼šä¿®æ”¹ç›¸åŒçš„æ–‡ä»¶ï¼Œè¿™å‡å°‘äº†åœ¨å°†ä»£ç æ¨é€åˆ°æºä»£ç æ§åˆ¶æ—¶å¯èƒ½å‘ç”Ÿçš„åˆå¹¶å†²çªçš„æ•°é‡ã€‚
- en: This refactoring also allows to speed up the onboarding process of new team
    members. Since every code artifact has its proper place, the code is easier to
    understand and to own. If you are looking for contributors to your application,
    this is a very important point to keep in mind!
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ¬¡é‡æ„è¿˜å…è®¸åŠ å¿«æ–°å›¢é˜Ÿæˆå‘˜çš„å…¥èŒæµç¨‹ã€‚ç”±äºæ¯ä¸ªä»£ç ç»„ä»¶éƒ½æœ‰å…¶åˆé€‚çš„ä½ç½®ï¼Œä»£ç æ›´å®¹æ˜“ç†è§£å’ŒæŒæ¡ã€‚å¦‚æœä½ æ­£åœ¨å¯»æ‰¾ä¸ºä½ çš„åº”ç”¨ç¨‹åºè´¡çŒ®è€…ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ç‚¹éœ€è¦è®°ä½ï¼
- en: Summary
  id: totrans-171
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: æ‘˜è¦
- en: In this chapter, we refactored *Bookmarkr* to make it more modular. Each command
    is now described in its own code file.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬é‡æ„äº†*Bookmarkr*ä½¿å…¶æ›´åŠ æ¨¡å—åŒ–ã€‚ç°åœ¨æ¯ä¸ªå‘½ä»¤éƒ½æœ‰å…¶è‡ªå·±çš„ä»£ç æ–‡ä»¶è¿›è¡Œæè¿°ã€‚
- en: By taking the time to refactor our CLI application, we have greatly enhanced
    its readability, maintainability, testability, and extensibility. It is now easier
    to add new capabilities, such as new commands (of course) as well as new features
    to existing commands.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: é€šè¿‡èŠ±æ—¶é—´é‡æ„æˆ‘ä»¬çš„å‘½ä»¤è¡Œåº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬æå¤§åœ°æé«˜äº†å…¶å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§ã€å¯æµ‹è¯•æ€§å’Œå¯æ‰©å±•æ€§ã€‚ç°åœ¨æ·»åŠ æ–°åŠŸèƒ½ï¼Œä¾‹å¦‚æ–°çš„å‘½ä»¤ï¼ˆå½“ç„¶ï¼‰ä»¥åŠç°æœ‰å‘½ä»¤çš„æ–°ç‰¹æ€§ï¼Œéƒ½å˜å¾—æ›´åŠ å®¹æ˜“ã€‚
- en: Speaking about that, in the next chapter, we will see how to call external services
    and APIs to extend the capabilities of our application.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: è¯´åˆ°è¿™ä¸ªï¼Œåœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•è°ƒç”¨å¤–éƒ¨æœåŠ¡å’ŒAPIæ¥æ‰©å±•æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„åŠŸèƒ½ã€‚
- en: Your turn!
  id: totrans-175
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: è½®åˆ°ä½ äº†ï¼
- en: Following along with the provided code is a great way to learn through practice.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: é€šè¿‡è·Ÿéšæä¾›çš„ä»£ç è¿›è¡Œå®è·µæ˜¯ä¸€ç§å¾ˆå¥½çš„å­¦ä¹ æ–¹æ³•ã€‚
- en: A better way is by challenging yourself to achieve tasks. Hence, I challenge
    you to improve the *Bookmarkr* application by adding the following features.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•æ˜¯æŒ‘æˆ˜è‡ªå·±å®Œæˆä»»åŠ¡ã€‚å› æ­¤ï¼Œæˆ‘æŒ‘æˆ˜ä½ é€šè¿‡æ·»åŠ ä»¥ä¸‹ç‰¹æ€§æ¥æ”¹è¿›*Bookmarkr*åº”ç”¨ç¨‹åºã€‚
- en: 'Task #1 â€“ refactor the remaining commands'
  id: totrans-178
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä»»åŠ¡#1 â€“ é‡æ„å‰©ä½™çš„å‘½ä»¤
- en: Even though this chapter proposes only one challenge, it will require effort
    on your side!
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: å°½ç®¡æœ¬ç« åªæå‡ºäº†ä¸€ä¸ªæŒ‘æˆ˜ï¼Œä½†å®ƒå°†éœ€è¦ä½ ä»˜å‡ºåŠªåŠ›ï¼
- en: Throughout the pages of this chapter, we have refactored the `export` command.
    You are now tasked with refactoring the other commands of the *Bookmarkr* application.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬ç« çš„æ¯ä¸€é¡µä¸­ï¼Œæˆ‘ä»¬éƒ½é‡æ„äº†`export`å‘½ä»¤ã€‚ç°åœ¨ï¼Œä½ è¢«è¦æ±‚é‡æ„*Bookmarkr*åº”ç”¨ç¨‹åºçš„å…¶ä»–å‘½ä»¤ã€‚
- en: For that matter, you can follow the same strategy and steps we used in our previous
    refactoring activity. By practicing it again and again, you will gain mastery
    of this process.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: å…³äºè¿™ä¸€ç‚¹ï¼Œä½ å¯ä»¥éµå¾ªæˆ‘ä»¬åœ¨ä¹‹å‰çš„é‡æ„æ´»åŠ¨ä¸­ä½¿ç”¨çš„ç›¸åŒç­–ç•¥å’Œæ­¥éª¤ã€‚é€šè¿‡åå¤ç»ƒä¹ ï¼Œä½ å°†æŒæ¡è¿™ä¸€è¿‡ç¨‹ã€‚
- en: You will find the version of the code that hasnâ€™t been refactored in the `Program.Unrefactored.cs`
    file.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¯ä»¥åœ¨`Program.Unrefactored.cs`æ–‡ä»¶ä¸­æ‰¾åˆ°å°šæœªé‡æ„çš„ä»£ç ç‰ˆæœ¬ã€‚
- en: Letâ€™s do this!
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬å¼€å§‹å§ï¼
