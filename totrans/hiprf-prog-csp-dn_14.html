<html><head></head><body>
		<div id="_idContainer175">
			<h1 id="_idParaDest-210"><em class="italic"><a id="_idTextAnchor215"/>Chapter 12</em>: Responsive User Interfaces</h1>
			<p>In this chapter, you will learn to write responsive user interfaces. You will write responsive <strong class="bold">Windows Forms</strong> (<strong class="bold">WinForms</strong>), <strong class="bold">Windows Presentation Foundation</strong> (<strong class="bold">WPF</strong>), ASP.NET, .NET MAUI, and WinUI applications. Using background worker threads, you will see how you can update and work with the <strong class="bold">User Interface</strong> (<strong class="bold">UI</strong>) in real time by running long-running tasks in the background.</p>
			<p>In this chapter, we will be working through the following topics:</p>
			<ul>
				<li><strong class="bold">Building a responsive UI with WinForms</strong>: In this section, you will write a simple WinForms application that remains responsive to user interaction while performing multiple tasks.</li>
				<li><strong class="bold">Building a responsive UI with WPF</strong>: In this section, you will be writing a simple WPF application that remains responsive to user interaction while performing multiple tasks.</li>
				<li><strong class="bold">Building a responsive UI with ASP.NET</strong>: In this section, you will be writing a simple ASP.NET application that remains responsive to user interaction while performing multiple tasks.</li>
				<li><strong class="bold">Building a responsive UI with .NET MAUI</strong>: In this section, you will be writing a simple Xamarin.Forms application that remains responsive to user interaction while performing multiple tasks. You will then migrate the projects from Xamarin.Forms to .NET MAUI by updating the library references.</li>
				<li><strong class="bold">Building a responsive UI with WinUI</strong>: In this section, you will be writing a simple WinUI application that remains responsive to user interaction while performing multiple tasks.</li>
			</ul>
			<p>By working through this chapter, you will gain the skills to do the following:</p>
			<ul>
				<li>Use background worker threads to keep UIs responsive</li>
				<li>Use wait screens to provide updates when users are required to wait</li>
				<li>Use AJAX, WebSockets, SignalR, and gRPC/gRPC-Web to send and receive data and transfer assets</li>
				<li>Write responsive desktop, web, and mobile UIs<p class="callout-heading">Note</p><p class="callout">For clarification, when speaking about responsive UIs in this chapter, we are not talking about the layout of the UI adapting to the device size or screen real estate. Instead, we are focused on making busy UIs responsive to user input instead of blocking the user from working during task execution.</p></li>
			</ul>
			<h1 id="_idParaDest-211"><a id="_idTextAnchor216"/>Technical requirements</h1>
			<ul>
				<li>Visual Studio 2022 or later.</li>
				<li>This chapter source code is available at <a href="https://github.com/PacktPublishing/High-Performance-Programming-in-CSharp-and-.NET/tree/master/CH12">https://github.com/PacktPublishing/High-Performance-Programming-in-CSharp-and-.NET/tree/master/CH12</a>.</li>
			</ul>
			<h1 id="_idParaDest-212"><a id="_idTextAnchor217"/>Building a responsive UI with WinForms</h1>
			<p>In this section, we will be building<a id="_idIndexMarker1123"/> a very simple WinForms application that is <strong class="bold">Dots Per Inch</strong> (<strong class="bold">DPI</strong>)-aware and enables the user to continue<a id="_idIndexMarker1124"/> working during long-running<a id="_idIndexMarker1125"/> operations. The application has a splash screen with a progress bar and an updated label that provides visual feedback to the user that the application is busy loading. Once the loading progress has been completed, the splash screen closes, and the main window is displayed.</p>
			<p>On the main window, there is a label that gets updated every time you click on the increment count button, a paged table that you can navigate through using the buttons provided, and a progress indicator for a long-running task that also has a cancel button.</p>
			<p>While the long-running task is executing, you can move the window around, increment the label by clicking the increment<a id="_idIndexMarker1126"/> count button, and you can page through<a id="_idIndexMarker1127"/> the data. If you choose to, you can also cancel the long-running task.</p>
			<p>When the long-running task is completed, canceled, or encounters an error, the task progress panel is hidden.</p>
			<h2 id="_idParaDest-213"><a id="_idTextAnchor218"/>Enabling DPI awareness and long file path awareness</h2>
			<p>In this section, we will configure<a id="_idIndexMarker1128"/> a WinForms application so that it looks good<a id="_idIndexMarker1129"/> on high-DPI screens<a id="_idIndexMarker1130"/> and normal-DPI large<a id="_idIndexMarker1131"/> screens. We also configure it to be aware of long file paths. Follow these steps:</p>
			<ol>
				<li>Start a new .NET 6 WinForms application and call it <strong class="source-inline">CH12_ResponsiveWinForms</strong>.</li>
				<li>Add a new <em class="italic">application manifest</em> file.</li>
				<li>Open the <strong class="source-inline">app.manifest</strong> file and update the <strong class="source-inline">compatibility</strong> section as follows:<p class="source-code">&lt;compatibility xmlns=”urn:schemas-microsoft-</p><p class="source-code">    com:compatibility.v1”&gt;</p><p class="source-code">    &lt;application&gt;</p><p class="source-code">      &lt;supportedOS </p><p class="source-code">        Id=”{e2011457-1546-43c5-a5fe-008deee3d3f0}” /&gt;</p><p class="source-code">      &lt;supportedOS </p><p class="source-code">        Id=”{35138b9a-5d96-4fbd-8e2d-a2440225f93a}” /&gt;</p><p class="source-code">      &lt;supportedOS </p><p class="source-code">        Id=”{4a2f28e3-53b9-4441-ba9c-d69d4a4a6e38}” /&gt;</p><p class="source-code">      &lt;supportedOS </p><p class="source-code">        Id=”{1f676c76-80e1-4239-95bb-83d0f6d0da78}” /&gt;</p><p class="source-code">      &lt;supportedOS </p><p class="source-code">        Id=”{8e0f7a12-bfb3-4fe8-b9a5-48fd50a15a9a}” /&gt;</p><p class="source-code">    &lt;/application&gt;</p><p class="source-code">  &lt;/compatibility&gt;</p></li>
			</ol>
			<p>This XML code enables DPI awareness<a id="_idIndexMarker1132"/> in WinForms applications<a id="_idIndexMarker1133"/> from Windows Vista upward.</p>
			<ol>
				<li value="4">Uncomment<a id="_idIndexMarker1134"/> the following <strong class="source-inline">application</strong> section:<p class="source-code">&lt;application xmlns=”urn:schemas-microsoft-com:asm.v3”&gt;</p><p class="source-code">     &lt;windowsSettings&gt;</p><p class="source-code">          &lt;dpiAware xmlns=””&gt;</p><p class="source-code">             True</p><p class="source-code">         &lt;/dpiAware&gt;</p><p class="source-code">          &lt;longPathAware xmlns=””&gt;</p><p class="source-code">             True</p><p class="source-code">         &lt;/longPathAware&gt;</p><p class="source-code">        &lt;/windowsSettings&gt;</p><p class="source-code">&lt;/application&gt;</p></li>
			</ol>
			<p>This code informs<a id="_idIndexMarker1135"/> the compiler that the application is aware of long paths and DPI settings. With these settings in place, the application will now scale for different screen DPI settings and will be able to handle long paths that are 256 characters long.</p>
			<p>In the next section, we will add a splash screen with loading progress feedback.</p>
			<h2 id="_idParaDest-214"><a id="_idTextAnchor219"/>Adding a splash screen that updates with loading progress</h2>
			<p>Applications can load very quickly, or they<a id="_idIndexMarker1136"/> can load quite slowly. When they<a id="_idIndexMarker1137"/> are loading, the user is unaware of what the application is doing. You may choose<a id="_idIndexMarker1138"/> to display a splash screen as part of your application branding. If your application loads fast, then you may need to add a delay for a short period such as 3 seconds to enable the user to see the splash screen. Otherwise, all the user may see is a quick screen flicker.</p>
			<p>If the application has some heavy loading operations that take time to process, the user can think there is an issue and that the program has crashed. So, it is good practice to provide a splash screen that provides visual feedback to the user. This way, the user knows that the application is busy processing and has not crashed. When users see such feedback, they are more patient and will wait until the application has loaded.</p>
			<p>In this section, we add a splash screen with visual feedback. The main window simulates several loading operations with a delay to the UI. Then, the splash screen is closed and the main window is displayed. We will now start adding the necessary code:</p>
			<ol>
				<li value="1">Add a new form called <strong class="source-inline">SplashScreenForm</strong>, and change its <strong class="bold">FormBorderStyle</strong> property to <strong class="bold">None</strong> and its <strong class="bold">StartPosition</strong> property to <strong class="bold">CentreScreen</strong>. Change the <strong class="bold">BackColor</strong> property to <strong class="bold">ActiveCaptionText</strong>.</li>
				<li>Add a <strong class="bold">ProgressBar</strong> component called <strong class="source-inline">LoadingProgressBar</strong> to the form and dock it to the bottom of the form.</li>
				<li>Add a label to <strong class="bold">SplashScreenForm</strong> called <strong class="source-inline">LoadingProgressLabel</strong> and dock it to the bottom of the form so that it appears just above the progress bar. Set the <strong class="bold">Text</strong> property to <strong class="bold">Loading. Please wait…</strong> and <strong class="bold">Font</strong> | <strong class="bold">Size</strong> to <strong class="bold">12</strong>. Change the <strong class="bold">ForeColor</strong> property to <strong class="bold">HighlightWhite</strong>. Set <strong class="bold">Margin</strong> | <strong class="bold">All</strong> and <strong class="bold">Padding</strong> | <strong class="bold">All</strong> to <strong class="bold">8</strong>.</li>
				<li>Add another label to <strong class="bold">SplashScreenForm</strong> called <strong class="source-inline">TitleLabel</strong> with the <strong class="bold">Text</strong> property set to <strong class="bold">Responsive WinForms Example</strong>, <strong class="bold">ForeColor</strong> set to <strong class="bold">HighlightText</strong>, <strong class="bold">Font</strong> | <strong class="bold">Size</strong> set to <strong class="bold">32</strong>, and <strong class="bold">Location</strong> set to <strong class="bold">29, 126</strong>.</li>
				<li>Rename <strong class="bold">Form1</strong> <strong class="source-inline">MainForm</strong> and open the form. Double-click on WindowsForm. This will open the code window.</li>
				<li>Add the<a id="_idIndexMarker1139"/> following<a id="_idIndexMarker1140"/> <strong class="source-inline">using</strong> statements<a id="_idIndexMarker1141"/> to the <strong class="source-inline">MainForm</strong> class:<p class="source-code">using System;</p><p class="source-code">using System.Collections.Generic;</p><p class="source-code">using System.ComponentModel;</p><p class="source-code">using System.Threading;</p><p class="source-code">using System.Windows.Forms;</p></li>
			</ol>
			<p>These <strong class="source-inline">using</strong> statements provide all that we need for our splash screen’s code to function.</p>
			<ol>
				<li value="7">Add the following member variables to the <strong class="source-inline">MainForm</strong> class:<p class="source-code">private int _clickCounter;</p><p class="source-code">    private int _operationNumber;</p><p class="source-code">        private int _offset = 0;</p><p class="source-code">    private int _pageSize = 10;</p><p class="source-code">    private int _currentPage = 1;</p></li>
			</ol>
			<p>These member variables will be referenced by the various methods in our <strong class="source-inline">MainForm</strong> class to provide paging, in-memory data storage, and store the click count and operation number of the operation being processed.</p>
			<ol>
				<li value="8">Update the <strong class="source-inline">MainForm_Load</strong> method as follows:<p class="source-code">private void MainForm_Load(object sender, EventArgs e)</p><p class="source-code">{</p><p class="source-code">    SplashScreenForm splashScreen = new </p><p class="source-code">        SplashScreenForm();</p><p class="source-code">     splashScreen.Show(this);</p><p class="source-code">    for (int x = 1; x &lt;= 100; x++)</p><p class="source-code">    {</p><p class="source-code">         Thread.Sleep(500);</p><p class="source-code">        splashScreen.UpdateProgress(x, $”Progress </p><p class="source-code">           Update: Performing load operation {x}</p><p class="source-code">               of 100...”);</p><p class="source-code">         Application.DoEvents();</p><p class="source-code">     }</p><p class="source-code">    splashScreen.Close();</p><p class="source-code">}</p></li>
			</ol>
			<p>This code creates<a id="_idIndexMarker1142"/> our splash screen<a id="_idIndexMarker1143"/> and then iterates 100 times, simulating<a id="_idIndexMarker1144"/> many loading operations. Each iteration causes the UI thread to sleep for half a second, updates the splash screen progress, and releases the thread so that other threads can do their work by calling <strong class="source-inline">Application.DoEvents()</strong>.</p>
			<ol>
				<li value="9">Open <strong class="bold">SplashScreenForm</strong> and view its code. Add the following method:<p class="source-code">public void UpdateProgress(int value, string message)</p><p class="source-code">{</p><p class="source-code">        LoadingProgressBar.Value = value;</p><p class="source-code">        LoadingProgressLabel.Text = message;</p><p class="source-code">        Invalidate();</p><p class="source-code">}</p></li>
			</ol>
			<p>This code takes input from the <strong class="source-inline">MainForm</strong> class and updates the splash screen’s label and progress bar, providing feedback to the user that the application is loading and making progress.</p>
			<p>We have now completed<a id="_idIndexMarker1145"/> the progress bar. If you<a id="_idIndexMarker1146"/> run the code, you will see<a id="_idIndexMarker1147"/> the following splash screen:</p>
			<div>
				<div id="_idContainer164" class="IMG---Figure">
					<img src="image/Figure_12.01_B16617.jpg" alt="Figure 12.1 – The WinForms splash screen&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.1 – The WinForms splash screen</p>
			<p>Now that our splash screen is working, let’s add our label and button that displays an incremental count of button clicks.</p>
			<h2 id="_idParaDest-215"><a id="_idTextAnchor220"/>Adding the increment count button and label</h2>
			<p>To demonstrate non-blocking<a id="_idIndexMarker1148"/> of the UI when a long operation<a id="_idIndexMarker1149"/> is executing, we will have<a id="_idIndexMarker1150"/> a label that is updated <a id="_idIndexMarker1151"/>with text every time a user clicks a button. We will need to perform the following tasks in our code:</p>
			<ol>
				<li value="1">Add a label called <strong class="source-inline">ClickCounterLabel</strong> to <strong class="source-inline">MainForm</strong> and dock it to the top. Set its text to an empty string and its text properties to <strong class="bold">Segoe UI</strong> and <strong class="bold">36pt</strong>, with <strong class="bold">TextAlign</strong> set to <strong class="bold">MiddleCenter</strong>.</li>
				<li>Add a button<a id="_idIndexMarker1152"/> called <strong class="source-inline">IncrementCountButton</strong> to the form<a id="_idIndexMarker1153"/> and dock<a id="_idIndexMarker1154"/> it to the top<a id="_idIndexMarker1155"/> of the form. Set its text to <strong class="bold">&amp;Increment Text</strong>. </li>
				<li><em class="italic">Double-click</em> on the button to generate its click event. Update the code of the click event with the following code:<p class="source-code">private void IncrementCountButton_Click(object sender, </p><p class="source-code">    EventArgs e)</p><p class="source-code">    {</p><p class="source-code">        _clickCounter++;</p><p class="source-code">        ClickCounterLabel.Text = $”You have clicked </p><p class="source-code">            the button {_clickCounter} times.”;</p><p class="source-code">}</p></li>
			</ol>
			<p>Each time the user clicks the button, the _<strong class="source-inline">clickCounter</strong> variable is incremented by one. The <strong class="source-inline">ClickCounterLabel</strong> text is then updated, informing the user of how many times they have clicked the button.</p>
			<p>The next thing we will be doing is adding a table with paged navigation. We shall be doing that in the following section.</p>
			<h2 id="_idParaDest-216"><a id="_idTextAnchor221"/>Adding a table with paged data</h2>
			<p>In this section, we will be adding<a id="_idIndexMarker1156"/> a table with paged<a id="_idIndexMarker1157"/> navigation. This will demonstrate<a id="_idIndexMarker1158"/> that the user can still interact with the page through data in a WinForms application, even when long operations are running<a id="_idIndexMarker1159"/> in the background. Let’s begin:</p>
			<ol>
				<li value="1">Add <strong class="bold">DataGridView</strong> to the <strong class="bold">MainForm</strong> design window, call it <strong class="source-inline">DataTable</strong>, and set its <strong class="bold">Dock</strong> property to <strong class="bold">Fill</strong>.</li>
				<li>Add <strong class="bold">FlowLayoutPanel</strong> underneath <strong class="bold">DataGridView</strong> called <strong class="source-inline">DataPagingPanel</strong>, with its <strong class="bold">Dock</strong> property set to <strong class="bold">Bottom</strong>.</li>
				<li>Add a button to <strong class="bold">FlowLayoutPanel</strong> called <strong class="source-inline">FirstButton</strong>, with the text set to <strong class="bold">|&lt;&lt;</strong>. <em class="italic">Double-click</em> the button<a id="_idIndexMarker1160"/> to generate the click<a id="_idIndexMarker1161"/> event. Then, return to the design window.</li>
				<li>Add a button to <strong class="bold">FlowLayoutPanel</strong> called <strong class="source-inline">PreviousButton</strong> with the text set to <strong class="bold">&lt;&lt;</strong>. <em class="italic">Double-click</em> the button to generate the click event. Then, return to the design window.</li>
				<li>Add a textbox called <strong class="source-inline">PageTextBox</strong> to <strong class="bold">FlowLayoutPanel</strong>.</li>
				<li>Add a button called <strong class="source-inline">NextButton</strong> to <strong class="bold">FlowLayoutPanel</strong>, with the text set to <strong class="bold">&gt;&gt;</strong>. <em class="italic">Double-click</em> the button to generate its click event. Then, return to the design window.</li>
				<li>Add a button called <strong class="source-inline">LastButton</strong> to <strong class="bold">FlowLayoutPanel</strong>, with the text set to <strong class="bold">&gt;&gt;|</strong>. <em class="italic">Double-click</em> the button to generate its click event. This time, stay in the code view, as we have completed what we need to do on the UI for this section.</li>
				<li>Add the <strong class="source-inline">BuildCollection</strong> method:<p class="source-code">private void BuildCollection()</p><p class="source-code">{</p><p class="source-code">    _products = new();</p><p class="source-code">    for (int x = 1; x &lt;= 100; x++)</p><p class="source-code">    {</p><p class="source-code">        _products.Add(new Product { Id = x, Name = </p><p class="source-code">            $”Product {x}” });</p><p class="source-code">}</p><p class="source-code">}</p></li>
			</ol>
			<p>This method builds a collection of <strong class="source-inline">100</strong> products.</p>
			<ol>
				<li value="9">Add the call to the <strong class="source-inline">BuildCollection</strong> method to the <strong class="source-inline">MainForm_Load</strong> method before the <strong class="source-inline">SplashScreenForm</strong> instantiation line.</li>
				<li>After the line<a id="_idIndexMarker1162"/> that closes the splash screen, add the following<a id="_idIndexMarker1163"/> two lines of<a id="_idIndexMarker1164"/> code:<p class="source-code">DataTable.DataSource = PagedProducts();</p><p class="source-code">PageTextBox.Text = $”Page {_currentPage} of </p><p class="source-code">    {PageCount()}”;</p></li>
			</ol>
			<p>This code sets the data source for our <strong class="bold">DataGridView</strong> control to a page of the dataset via the call to the <strong class="source-inline">PagedProducts</strong> method.</p>
			<ol>
				<li value="11">Add the <strong class="source-inline">PagedProducts</strong> method:<p class="source-code">private List&lt;Product&gt; PagedProducts()</p><p class="source-code">    {</p><p class="source-code">        return _products.GetRange(_offset, _pageSize);</p><p class="source-code">}</p></li>
			</ol>
			<p>This method returns a range from the <strong class="source-inline">_products</strong> collection. The <strong class="source-inline">_offset</strong> variable stores the index value that forms the starting point of the returned collection, and the <strong class="source-inline">_pageSize</strong> variable stores the number of records to be returned for a page.</p>
			<ol>
				<li value="12">Add the <strong class="source-inline">PageCount</strong> method:<p class="source-code">private int PageCount()</p><p class="source-code">    {</p><p class="source-code">     return _products.Count / _pageSize;</p><p class="source-code">}</p></li>
			</ol>
			<p>This method obtains the number of products contained within the <strong class="source-inline">_products</strong> collection, divides that number by the <strong class="source-inline">_pageSize</strong> variable, and then returns the result. The result<a id="_idIndexMarker1165"/> is the number of data pages<a id="_idIndexMarker1166"/> that we can navigate<a id="_idIndexMarker1167"/> through.</p>
			<ol>
				<li value="13">Update the <strong class="source-inline">FirstButton_Click</strong> method as follows:<p class="source-code">private void FirstButton_Click(object sender, </p><p class="source-code">    EventArgs e)</p><p class="source-code">    {</p><p class="source-code">        if (_currentPage &gt; 1)</p><p class="source-code">        {</p><p class="source-code">            _offset = 0;</p><p class="source-code">            _currentPage = 1;</p><p class="source-code">            PageTextBox.Text = $”Page {_currentPage} </p><p class="source-code">                of {PageCount()}”;</p><p class="source-code">            DataTable.DataSource = PagedProducts();</p><p class="source-code">     }</p><p class="source-code">}</p></li>
			</ol>
			<p>This code moves to the first page in the dataset and updates the UI accordingly.</p>
			<ol>
				<li value="14">Update the <strong class="source-inline">PreviousButton_Click</strong> method with the following code:<p class="source-code">    private void PreviousButton_Click(object sender, </p><p class="source-code">        EventArgs e)</p><p class="source-code">    {</p><p class="source-code">        if (_currentPage &gt; 1)</p><p class="source-code">        {</p><p class="source-code">            _offset -= _pageSize;</p><p class="source-code">            _currentPage--;</p><p class="source-code">            PageTextBox.Text = $”Page {_currentPage} </p><p class="source-code">                 of {PageCount()}”;</p><p class="source-code">            DataTable.DataSource = PagedProducts();</p><p class="source-code">     }</p><p class="source-code">}</p></li>
			</ol>
			<p>This code<a id="_idIndexMarker1168"/> moves to the previous<a id="_idIndexMarker1169"/> page in the dataset and updates<a id="_idIndexMarker1170"/> the UI accordingly.</p>
			<ol>
				<li value="15">Add the <strong class="source-inline">NextButton_Click</strong> method code:<p class="source-code">private void NextButton_Click(object sender,</p><p class="source-code">    EventArgs e)</p><p class="source-code">    {</p><p class="source-code">        if (_currentPage &lt; PageCount())</p><p class="source-code">        {</p><p class="source-code">            _offset += _pageSize;</p><p class="source-code">            _currentPage++;</p><p class="source-code">            PageTextBox.Text = $”Page {_currentPage} </p><p class="source-code">                of {PageCount()}”;</p><p class="source-code">            DataTable.DataSource = PagedProducts();</p><p class="source-code">     }</p><p class="source-code">}</p></li>
			</ol>
			<p>This code moves to the next page of the dataset and updates the UI accordingly.</p>
			<ol>
				<li value="16">Add the <strong class="source-inline">LastButton_Click</strong> method code:<p class="source-code">private void LastButton_Click(object sender,</p><p class="source-code">    EventArgs e)</p><p class="source-code">    {</p><p class="source-code">        if (_currentPage &lt; PageCount())</p><p class="source-code">        {</p><p class="source-code">            _offset = _products.Count - _pageSize;</p><p class="source-code">            _currentPage = PageCount();</p><p class="source-code">            PageTextBox.Text = $”Page {_currentPage} </p><p class="source-code">                of {PageCount()}”;</p><p class="source-code">            DataTable.DataSource = PagedProducts();</p><p class="source-code">     }</p><p class="source-code">}</p></li>
			</ol>
			<p>This method<a id="_idIndexMarker1171"/> moves to the last page<a id="_idIndexMarker1172"/> of the dataset and updates the UI<a id="_idIndexMarker1173"/> accordingly.</p>
			<ol>
				<li value="17">Finally, add the <strong class="source-inline">Product</strong> class:<p class="source-code">internal class Product</p><p class="source-code">{</p><p class="source-code">    public int Id { get; set; }</p><p class="source-code">    public string Name { get; set; }</p><p class="source-code">    public string Description { get; set; } = “It is a </p><p class="source-code">      long established fact that a reader will be </p><p class="source-code">        distracted by the readable content of a page </p><p class="source-code">          when looking at its layout.”;</p><p class="source-code">    public float Price { get; set; } = 9.99F;</p><p class="source-code">    public int Units { get; set; } = 100;</p><p class="source-code">}</p></li>
			</ol>
			<p>This class is the <strong class="source-inline">Product</strong> class that our <strong class="source-inline">MainForm</strong> uses to build its list of products within its <strong class="source-inline">BuildCollection</strong> method.</p>
			<p>We have now built<a id="_idIndexMarker1174"/> our paged data table, and we have our increment button<a id="_idIndexMarker1175"/> and label in place. The final thing<a id="_idIndexMarker1176"/> to do with our form is to add our long-running task, to show that user interactions are still possible without being blocked by long-running tasks. This will be the topic of our next section. </p>
			<h2 id="_idParaDest-217"><a id="_idTextAnchor222"/>Running long-running tasks in the background</h2>
			<p>In this section, we are going<a id="_idIndexMarker1177"/> to upgrade our UI to show the progress<a id="_idIndexMarker1178"/> of a long-running task that is running in the background. The user will be able to cancel the long-running task at any time. When the task is completed, whatever state it is in, the long-running task update progress controls will be hidden from the user. Let’s start adding the code:</p>
			<ol>
				<li value="1">Add a <strong class="bold">CommandButton</strong> component called <strong class="source-inline">LongRunningOperationCancelButton</strong> and set its text to <strong class="source-inline">&amp;Cancel long running operation</strong>.</li>
				<li>Add a <strong class="bold">StatusStrip</strong> component and call it <strong class="source-inline">StatusBar</strong>.</li>
				<li>Add a <strong class="bold">ToolStripProgressBar</strong> component called <strong class="source-inline">TaskProgressBar</strong>.</li>
				<li>Add a <strong class="bold">ToolStripLabel</strong> component called <strong class="source-inline">StatusLabel</strong> and make sure its text property is empty.</li>
				<li>Add a <strong class="bold">BackgroundWorker</strong> component called <strong class="source-inline">CollectionBuilderBackgroundWorker</strong>.</li>
				<li>Add a <strong class="bold">BackgroundWorker</strong> component called <strong class="source-inline">LongRunningProcessBackgroundWorker</strong>.</li>
				<li>In the <strong class="source-inline">MainForm</strong> class, add the following three lines to the constructor:<p class="source-code">LongRunningProcessBackgroundWorker.DoWork += </p><p class="source-code">    LongRunningProcessBackgroundWorker_DoWork;</p><p class="source-code">LongRunningProcessBackgroundWorker.ProgressChanged += </p><p class="source-code">    LongRunningProcessBackgroundWorker_ProgressChanged;</p><p class="source-code">LongRunningProcessBackgroundWorker</p><p class="source-code">    .RunWorkerCompleted += LongRunning</p><p class="source-code">        ProcessBackgroundWorker_RunWorkerCompleted;</p></li>
			</ol>
			<p>This code adds<a id="_idIndexMarker1179"/> the handlers for our <strong class="source-inline">BackgroundWorker</strong>, which will be responsible for executing<a id="_idIndexMarker1180"/> the long-running task.</p>
			<ol>
				<li value="8">Add the following method call to the last line of the <strong class="source-inline">MainForm_Load</strong> method before the closing brace: <strong class="source-inline">LongRunningProcess();</strong>.</li>
				<li>Add the following <strong class="source-inline">LongRunningProcess</strong> method:<p class="source-code">private void LongRunningProcess()</p><p class="source-code">    {    </p><p class="source-code">        if (LongRunningProcessBackgroundWorker.IsBusy </p><p class="source-code">            != true)</p><p class="source-code">        {                </p><p class="source-code">         LongRunningProcessBackgroundWorker</p><p class="source-code">             .RunWorkerAsync();</p><p class="source-code">     }</p><p class="source-code">    }</p></li>
			</ol>
			<p>If <strong class="source-inline">LongRunningProcessBackgroundWorker</strong> is not busy, then the <strong class="source-inline">RunWorkerAsync</strong> method<a id="_idIndexMarker1181"/> called <strong class="source-inline">LongRunningProcessBackground Worker_DoWork</strong> is run.</p>
			<ol>
				<li value="10">Add <strong class="source-inline">LongRunningProcessBackgroundWorker_DoWork</strong> to the<a id="_idIndexMarker1182"/> <strong class="source-inline">MainForm</strong> class:<p class="source-code">private void LongRunningProcessBackgroundWorker_DoWork</p><p class="source-code">    (object sender, DoWorkEventArgs e)</p><p class="source-code">    {</p><p class="source-code">        BackgroundWorker worker = sender as </p><p class="source-code">            BackgroundWorker;</p><p class="source-code">    for (int i = 1; i &lt;= 100; i++)</p><p class="source-code">        {</p><p class="source-code">            if (worker.CancellationPending == true)</p><p class="source-code">            {</p><p class="source-code">                e.Cancel = true;</p><p class="source-code">                break;</p><p class="source-code">           }</p><p class="source-code">            else</p><p class="source-code">            {</p><p class="source-code">                _operationNumber = i;</p><p class="source-code">                System.Threading.Thread.Sleep(100);</p><p class="source-code">                worker.ReportProgress((i / 100)</p><p class="source-code">                    * 100);</p><p class="source-code">         }</p><p class="source-code">     }</p><p class="source-code">}</p></li>
			</ol>
			<p>We are casting<a id="_idIndexMarker1183"/> the sender as <strong class="source-inline">BackgroundWorker</strong> and assigning it to our local worker variable. Then, we iterate 100 times. Each time<a id="_idIndexMarker1184"/> we iterate, we set the <strong class="source-inline">_operationNumber</strong> variable to the loop count variable value, sleep for 100 milliseconds, and then call the <strong class="source-inline">ReportProgress</strong> method of the worker passing in the percentage of work done.</p>
			<ol>
				<li value="11">Add the <strong class="source-inline">LongRunningProcessBackgroundWorker_ProgressChanged</strong> method to the <strong class="source-inline">MainForm</strong> class:<p class="source-code">private void LongRunningProcessBackgroundWorker</p><p class="source-code">    _ProgressChanged(object sender, ProgressChanged</p><p class="source-code">        EventArgs e)</p><p class="source-code">    {</p><p class="source-code">        StatusLabel.Text </p><p class="source-code">        = ($”Progress: {_operationNumber}%”);</p><p class="source-code">    TaskProgressBar.Value = _operationNumber;</p><p class="source-code">        if (_operationNumber == 100)</p><p class="source-code">    {</p><p class="source-code">            Thread.Sleep(100);</p><p class="source-code">            LongRunningOperationCancelButton</p><p class="source-code">            .Visible = false;</p><p class="source-code">        StatusBar.Visible = false;</p><p class="source-code">    }</p><p class="source-code">}</p></li>
			</ol>
			<p>This code updates the UI<a id="_idIndexMarker1185"/> with the progress of the long-running task. If all the operations have been completed, the task cancel button and status bar are hidden from the user.</p>
			<ol>
				<li value="12">Add the <strong class="source-inline">LongRunningProcessBackgroundWorker_RunWorkerCompleted</strong> method <a id="_idIndexMarker1186"/>to the <strong class="source-inline">MainForm</strong> class:<p class="source-code">private void LongRunningProcessBackgroundWorker</p><p class="source-code">    _RunWorkerCompleted(object sender, </p><p class="source-code">        RunWorkerCompletedEventArgs e)</p><p class="source-code">    {</p><p class="source-code">        if (e.Cancelled == true)</p><p class="source-code">            StatusLabel.Text = “Canceled!”;</p><p class="source-code">     else if (e.Error != null)</p><p class="source-code">            StatusLabel.Text = “Error: “ + </p><p class="source-code">                e.Error.Message;</p><p class="source-code">     else</p><p class="source-code">            StatusLabel.Text = “Done!”;</p><p class="source-code">}</p></li>
			</ol>
			<p>When the long-running task is completed, this method executes <strong class="source-inline">StatusLabel.Text</strong> to the outcome of the method, with the outcomes being either <strong class="source-inline">Cancelled</strong>, <strong class="source-inline">Error</strong>, or <strong class="source-inline">Done</strong>.</p>
			<ol>
				<li value="13">Our final piece of code to write before we complete and run our WinForms application is to add code to the <strong class="source-inline">LongRunningOperationButton_Click</strong> method to <strong class="source-inline">MainClass</strong>, as follows:<p class="source-code">private void LongRunningOperationCancelButton</p><p class="source-code">    _Click(object sender, EventArgs e)</p><p class="source-code">{</p><p class="source-code">    if (LongRunningProcessBackgroundWorker</p><p class="source-code">        .WorkerSupportsCancellation == true)</p><p class="source-code">{</p><p class="source-code">        LongRunningProcessBackgroundWorker</p><p class="source-code">            .CancelAsync();</p><p class="source-code">        LongRunningOperationCancelButton.Visible = </p><p class="source-code">            false;</p><p class="source-code">        StatusBar.Visible = false;</p><p class="source-code">     }</p><p class="source-code">}</p></li>
			</ol>
			<p>This code checks<a id="_idIndexMarker1187"/> to see whether the task<a id="_idIndexMarker1188"/> supports cancellation. If it does, then the task is canceled, and the cancel button and status bar are hidden from the user.</p>
			<ol>
				<li value="14">Run the code. You should see the splash screen shown in <em class="italic">Figure 12.1</em>. Then, you should see the main window resembling what is shown in <em class="italic">Figure 12.2</em>. Move the window about and click on the increment count button. Also, click the paging buttons to move between data pages of the dataset, and cancel the task. You should see that the window is completely responsive to your input, as follows:</li>
			</ol>
			<div>
				<div id="_idContainer165" class="IMG---Figure">
					<img src="image/Figure_12.02_B16617.jpg" alt="Figure 12.2 – The Windows Forms main application window&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.2 – The Windows Forms main application window</p>
			<p>As you can see, we have written<a id="_idIndexMarker1189"/> a WinForms application that has<a id="_idIndexMarker1190"/> a lot going on. We have a splash screen that provides visual feedback to the user so that they do not think that the application has crashed in any way, and we have a UI that remains responsive to user input during a long-running task.</p>
			<p>Now that we have a working WinForms application, let’s turn our attention to WPF. In the next section, we will apply what we have learned with our WinForms application to a WPF application.</p>
			<h1 id="_idParaDest-218"><a id="_idTextAnchor223"/>Building a responsive UI with WPF</h1>
			<p>In this section, we are going to build<a id="_idIndexMarker1191"/> the same kind of interface as we did<a id="_idIndexMarker1192"/> for the WinForms application, but this time, it will be using WPF. We will now start writing our code:</p>
			<ol>
				<li value="1">Create a new WPF application called <strong class="source-inline">CH12_ResponsiveWPF</strong> and make sure to select <strong class="bold">.NET 6.0</strong> as the target framework.</li>
				<li>Add the <strong class="source-inline">Product</strong> class to the project. It is the same code that we used in our WinForms application.</li>
				<li>Add a new Window called <strong class="source-inline">SplashWindow</strong>.</li>
				<li>Modify the <strong class="bold">SplashWindow</strong> XAML as follows:<p class="source-code">&lt;Window x:Class=”CH12_ResponsiveWPF.SplashWindow”    </p><p class="source-code">       xmlns=””</p><p class="source-code">       xmlns:x=””</p><p class="source-code">       xmlns:d=””</p><p class="source-code">       xmlns:mc=””</p><p class="source-code">       xmlns:local=”clr-namespace:CH12_ResponsiveWPF”</p><p class="source-code">       mc:Ignorable=”d” </p><p class="source-code">       Background=”White”        </p><p class="source-code">       Foreground=”White” </p><p class="source-code">       WindowStyle=”None”</p><p class="source-code">       WindowStartupLocation=”CenterScreen”</p><p class="source-code">       Title=”SplashWindow” Height=”450” Width=”800”&gt;</p><p class="source-code">    &lt;StackPanel HorizontalAlignment=”Center” </p><p class="source-code">        VerticalAlignment=”Center”&gt;</p><p class="source-code">        &lt;Label TextBlock.FontSize=”32” </p><p class="source-code">            Content=”Responsive WPF Example” /&gt;</p><p class="source-code">        &lt;Label x:Name=”LoadingProgressLabel” </p><p class="source-code">            TextBlock.FontSize=”12” </p><p class="source-code">                Content=”Loading...” /&gt;</p><p class="source-code">        &lt;ProgressBar x:Name=”LoadingProgressBar” </p><p class="source-code">            Minimum=”0” Maximum=”100” /&gt;</p><p class="source-code">    &lt;/StackPanel&gt;</p><p class="source-code">&lt;/Window&gt;</p></li>
			</ol>
			<p>The XAML we have just updated<a id="_idIndexMarker1193"/> declares a stack panel with two labels<a id="_idIndexMarker1194"/> and a progress bar. The first label displays the title, and the second label displays loading progress along with the progress bar.</p>
			<ol>
				<li value="5">Add the following method to the <strong class="source-inline">SplashWindow</strong> class:<p class="source-code">public void UpdateProgress(int value, string message)</p><p class="source-code">{</p><p class="source-code">    LoadingProgressBar.Value = value;</p><p class="source-code">    LoadingProgressLabel.Content = message;</p><p class="source-code">    InvalidateVisual();</p><p class="source-code">}</p></li>
			</ol>
			<p>This code will be called by the <strong class="source-inline">MainWindow</strong> class and is responsible for updating the progress indicators on <strong class="bold">SplashWindow</strong>.</p>
			<ol>
				<li value="6">Open the <strong class="source-inline">MainWindow.xaml</strong> file and replace the existing XAML with the following:<p class="source-code">&lt;StackPanel HorizontalAlignment=”Stretch” </p><p class="source-code">    VerticalAlignment=”Stretch” Background=”Red”&gt;</p><p class="source-code">    &lt;Label x:Name=”CounterLabel” FontSize=”32” </p><p class="source-code">        Foreground=”Yellow” Margin=”8” Padding=”8” /&gt;</p><p class="source-code">        &lt;Button x:Name=”IncrementCounterButton” </p><p class="source-code">        Content=”Increment Counter” </p><p class="source-code">        Click=”IncrementCounterButton_Click” </p><p class="source-code">        HorizontalAlignment=”Center” Padding=”8” </p><p class="source-code">        Margin=”0, 0, 0 , 8” /&gt;</p><p class="source-code">        &lt;DataGrid x:Name=”DataTable” /&gt;</p><p class="source-code">        &lt;StackPanel Orientation=”Horizontal” </p><p class="source-code">            HorizontalAlignment=”Center” Margin=”0, 4, </p><p class="source-code">                0, 4”&gt;</p><p class="source-code">            &lt;Button x:Name=”FirstButton” </p><p class="source-code">            Content=”|&amp;lt;&amp;lt;” </p><p class="source-code">          Click=”FirstButton_Click” Margin=”4” </p><p class="source-code">          Padding=”8” /&gt;</p><p class="source-code">            &lt;Button x:Name=”PreviousButton” </p><p class="source-code">            Content=”&amp;lt;&amp;lt;” </p><p class="source-code">            Click=”PreviousButton_Click” Margin=”4” </p><p class="source-code">            Padding=”8” /&gt;</p><p class="source-code">            &lt;Label x:Name=”PageLabel” </p><p class="source-code">            Background=”White” Foreground=”Black” </p><p class="source-code">            Width=”110” Height=”32” </p><p class="source-code">            VerticalContentAlignment=”Center” /&gt;</p><p class="source-code">            &lt;Button x:Name=”NextButton” </p><p class="source-code">            Content=”&amp;gt;&amp;gt;” </p><p class="source-code">            Click=”NextButton_Click” Margin=”4” </p><p class="source-code">            Padding=”8” /&gt;</p><p class="source-code">            &lt;Button x:Name=”LastButton” </p><p class="source-code">            Content=”&amp;gt;&amp;gt;|” </p><p class="source-code">            Click=”LastButton_Click” Margin=”4” </p><p class="source-code">            Padding=”8” /&gt;</p><p class="source-code">        &lt;/StackPanel&gt;</p><p class="source-code">        &lt;StackPanel x:Name=”StatusPanel” </p><p class="source-code">        VerticalAlignment=”Bottom” </p><p class="source-code">        Orientation=”Horizontal” Background=”Yellow”&gt;</p><p class="source-code">            &lt;Label x:Name=”StatusLabel” </p><p class="source-code">            Content=”Progress Update: ...” /&gt;</p><p class="source-code">            &lt;ProgressBar x:Name=”TaskProgressBar” </p><p class="source-code">            Minimum=”0” Maximum=”100” Width=”500” /&gt;</p><p class="source-code">            &lt;Button x:Name=”CancelTaskButton” </p><p class="source-code">            Content=”Cancel Task” </p><p class="source-code">            Click=”CancelTaskButton_Click” /&gt;</p><p class="source-code">        &lt;/StackPanel&gt;</p><p class="source-code">    &lt;/StackPanel&gt;</p></li>
			</ol>
			<p>This XAML provides<a id="_idIndexMarker1195"/> a status panel that will show the progress<a id="_idIndexMarker1196"/> of any background tasks, an increment label and an increment button, a data grid, and a navigation panel for paging through different pages of data.</p>
			<ol>
				<li value="7">Add the following <strong class="source-inline">using</strong> statements to the <strong class="source-inline">MainWindow.xaml.cs</strong> file:<p class="source-code">using System;</p><p class="source-code">using System.Collections;</p><p class="source-code">using System.Collections.Generic;</p><p class="source-code">using System.ComponentModel;</p><p class="source-code">using System.Threading;</p><p class="source-code">using System.Windows;</p><p class="source-code">using System.Windows.Threading;</p></li>
			</ol>
			<p>These <strong class="source-inline">using</strong> statements are needed for our WPF window to function without error.</p>
			<ol>
				<li value="8">Add the following<a id="_idIndexMarker1197"/> member variables to<a id="_idIndexMarker1198"/> the <strong class="source-inline">MainWindow</strong> class:<p class="source-code">private int _clickCounter;</p><p class="source-code">private int _operationNumber;</p><p class="source-code">private List&lt;Product&gt; _products;</p><p class="source-code">private int _offset = 0;</p><p class="source-code">private int _pageSize = 10;</p><p class="source-code">private int _currentPage = 1;</p><p class="source-code">BackgroundWorker _worker;</p></li>
			</ol>
			<p>Here, we have the same variables that we had with our WinForms application, except we also declare a background worker.</p>
			<ol>
				<li value="9">Update the <strong class="source-inline">MainWindow</strong> constructor<a id="_idIndexMarker1199"/> with the following<a id="_idIndexMarker1200"/> code:<p class="source-code">public MainWindow()</p><p class="source-code">{</p><p class="source-code">    InitializeComponent();</p><p class="source-code">    BuildCollection();</p><p class="source-code">    SplashWindow splashWindow = new SplashWindow();</p><p class="source-code">    splashWindow.Show();</p><p class="source-code">    for (int x = 1; x &lt;= 100; x++)</p><p class="source-code">    {</p><p class="source-code">        Thread.Sleep(100);</p><p class="source-code">        splashWindow.UpdateProgress(x, $”Progress </p><p class="source-code">            Update: Performing load operation {x} of </p><p class="source-code">                100...”);</p><p class="source-code">        DoEvents();</p><p class="source-code">}</p><p class="source-code">    splashWindow.Close();</p><p class="source-code">    DataTable.ItemsSource = PagedData();</p><p class="source-code">    PageLabel.Content = $”Page {_currentPage} of </p><p class="source-code">        {PageCount()}”;</p><p class="source-code">     _worker = new BackgroundWorker();</p><p class="source-code">    _worker.WorkerReportsProgress = true;</p><p class="source-code">    _worker.WorkerSupportsCancellation = true;</p><p class="source-code">    _worker.DoWork += Worker_DoWork;</p><p class="source-code">    _worker.ProgressChanged += Worker_ProgressChanged;</p><p class="source-code">    _worker.RunWorkerCompleted +=</p><p class="source-code">         Worker_RunWorkerCompleted;</p><p class="source-code">    _worker.RunWorkerAsync();</p><p class="source-code">}</p></li>
			</ol>
			<p>This code is pretty<a id="_idIndexMarker1201"/> much the same as our WinForms load method. The only real difference<a id="_idIndexMarker1202"/> is that all our initialization code is in the constructor.</p>
			<ol>
				<li value="10">Add the <strong class="source-inline">Worker_DoWork</strong> method:<p class="source-code">private void Worker_DoWork(object sender, </p><p class="source-code">    DoWorkEventArgs e)</p><p class="source-code">{</p><p class="source-code">    BackgroundWorker worker = sender as </p><p class="source-code">        BackgroundWorker;</p><p class="source-code">for (int i = 1; i &lt;= 100; i++)</p><p class="source-code">    {</p><p class="source-code">        if (worker.CancellationPending == true)</p><p class="source-code">        {</p><p class="source-code">            e.Cancel = true;</p><p class="source-code">            break;</p><p class="source-code">     }</p><p class="source-code">        else</p><p class="source-code">        {</p><p class="source-code">            _operationNumber = i;</p><p class="source-code">            System.Threading.Thread.Sleep(100);</p><p class="source-code">             worker.ReportProgress((i / 100) * 100);</p><p class="source-code">        }</p><p class="source-code">     }</p><p class="source-code">}</p></li>
			</ol>
			<p>This code simulates<a id="_idIndexMarker1203"/> the work of 100 operations with a small delay<a id="_idIndexMarker1204"/> for each operation.</p>
			<ol>
				<li value="11">Add the <strong class="source-inline">Worker_ProgressChanged</strong> method code:<p class="source-code">private void Worker_ProgressChanged(object sender, </p><p class="source-code">    ProgressChangedEventArgs e)</p><p class="source-code">{</p><p class="source-code">    StatusLabel.Content = ($”Progress: </p><p class="source-code">        {_operationNumber}%”);</p><p class="source-code">    TaskProgressBar.Value = _operationNumber;</p><p class="source-code">}</p></li>
			</ol>
			<p>This code updates<a id="_idIndexMarker1205"/> the progress indicators<a id="_idIndexMarker1206"/> for the long-running task.</p>
			<ol>
				<li value="12">Add the <strong class="source-inline">Worker_RunWorkerCompleted</strong> method:<p class="source-code">private void Worker_RunWorkerCompleted(object sender, </p><p class="source-code">    RunWorkerCompletedEventArgs e)</p><p class="source-code">{</p><p class="source-code">    if (e.Cancelled == true)</p><p class="source-code">        StatusLabel.Content = “Cancelled!”;</p><p class="source-code">    else if (e.Error != null)</p><p class="source-code">        StatusLabel.Content = “Error: “ + e.Error.</p><p class="source-code">          Message;</p><p class="source-code">    else</p><p class="source-code">        StatusLabel.Content = “Done!”;</p><p class="source-code">Thread.Sleep(1500);</p><p class="source-code">    StatusPanel.Visibility = Visibility.Collapsed;</p><p class="source-code">}</p></li>
			</ol>
			<p>This method reports the result of the long-running task and then hides the status panel from the end user.</p>
			<ol>
				<li value="13">Add the <strong class="source-inline">PagedData</strong> method:<p class="source-code">private IEnumerable PagedData()</p><p class="source-code">{</p><p class="source-code">    return _products.GetRange(_offset, _pageSize);</p><p class="source-code">}</p></li>
			</ol>
			<p>This method returns<a id="_idIndexMarker1207"/> a page of data whose index starts at <strong class="source-inline">_offset</strong>, with the number<a id="_idIndexMarker1208"/> of returned rows defined by <strong class="source-inline">_pageSize</strong>.</p>
			<ol>
				<li value="14">Add the <strong class="source-inline">DoEvents</strong> method:<p class="source-code">public static void DoEvents()</p><p class="source-code">{</p><p class="source-code">    Application.Current.Dispatcher</p><p class="source-code">         .Invoke(DispatcherPriority.Render, </p><p class="source-code">             new Action(delegate { </p><p class="source-code">                // Your operation goes here.</p><p class="source-code">            }));</p><p class="source-code">}</p></li>
			</ol>
			<p>This code performs like the WinForms <strong class="source-inline">Application.DoEvents()</strong> code. You can place your non-UI blocking code here, and update the UI.</p>
			<ol>
				<li value="15">Add the <strong class="source-inline">BuildCollection</strong> method:<p class="source-code">private void BuildCollection()</p><p class="source-code">{</p><p class="source-code">    _products = new();</p><p class="source-code">    for (int x = 1; x &lt;= 100; x++)</p><p class="source-code">    {</p><p class="source-code">        _products.Add(new Product { Id = x, Name = </p><p class="source-code">            $”Product {x}” });</p><p class="source-code">     }</p><p class="source-code">}</p></li>
			</ol>
			<p>The <strong class="source-inline">BuildCollection</strong> method builds<a id="_idIndexMarker1209"/> our dataset<a id="_idIndexMarker1210"/> of 100 products.</p>
			<ol>
				<li value="16">Add the <strong class="source-inline">PageCount</strong> method:<p class="source-code">private int PageCount()</p><p class="source-code">{</p><p class="source-code">    return _products.Count / _pageSize;</p><p class="source-code">}</p></li>
			</ol>
			<p>The <strong class="source-inline">PageCount</strong> method works out how many pages of data there are based on the dataset size, divided by the page size, and then returns the result.</p>
			<ol>
				<li value="17">Add the <strong class="source-inline">FirstButton_Click</strong> method:<p class="source-code">private void FirstButton_Click(object sender, </p><p class="source-code">    RoutedEventArgs e)</p><p class="source-code">{</p><p class="source-code">    if (_currentPage &gt; 1)</p><p class="source-code">    {</p><p class="source-code">        _offset = 0;</p><p class="source-code">        _currentPage = 1;</p><p class="source-code">        PageLabel.Content = $”Page {_currentPage} of </p><p class="source-code">            {PageCount()}”;</p><p class="source-code">        DataTable.ItemsSource = PagedData();</p><p class="source-code">    }</p><p class="source-code">}</p></li>
			</ol>
			<p>When executed, this method navigates<a id="_idIndexMarker1211"/> to the first record in our dataset and upgrades the UI<a id="_idIndexMarker1212"/> accordingly.</p>
			<ol>
				<li value="18">Add the <strong class="source-inline">PreviousButton_Click</strong> method:<p class="source-code">private void PreviousButton_Click(object sender, </p><p class="source-code">    RoutedEventArgs e)</p><p class="source-code">{</p><p class="source-code">    if (_currentPage &gt; 1)</p><p class="source-code">    {</p><p class="source-code">        _offset -= _pageSize;</p><p class="source-code">        _currentPage--;</p><p class="source-code">        PageLabel.Content = $”Page {_currentPage} of </p><p class="source-code">            {PageCount()}”;</p><p class="source-code">        DataTable.ItemsSource = PagedData();</p><p class="source-code">}</p><p class="source-code">}</p></li>
			</ol>
			<p>This method will move to the previous page of the dataset and update the UI accordingly.</p>
			<ol>
				<li value="19">Add the <strong class="source-inline">NextButton_Click</strong> code:<p class="source-code">private void NextButton_Click(object sender, </p><p class="source-code">    RoutedEventArgs e)</p><p class="source-code">{</p><p class="source-code">    if (_currentPage &lt; PageCount())</p><p class="source-code">    {</p><p class="source-code">        _offset += _pageSize;</p><p class="source-code">        _currentPage++;</p><p class="source-code">        PageLabel.Content = $”Page {_currentPage} of </p><p class="source-code">            {PageCount()}”;</p><p class="source-code">        DataTable.ItemsSource = PagedData();</p><p class="source-code">     }</p><p class="source-code">}</p></li>
			</ol>
			<p>This method moves<a id="_idIndexMarker1213"/> to the next page of the dataset and updates<a id="_idIndexMarker1214"/> the UI accordingly.</p>
			<ol>
				<li value="20">Add the <strong class="source-inline">LastButton_Click</strong> method:<p class="source-code">private void LastButton_Click(object sender, </p><p class="source-code">    RoutedEventArgs e)</p><p class="source-code">{</p><p class="source-code">    if (_currentPage &lt; PageCount())</p><p class="source-code">    {</p><p class="source-code">        _offset = _products.Count - _pageSize;</p><p class="source-code">        _currentPage = PageCount();</p><p class="source-code">        PageLabel.Content = $”Page {_currentPage} of </p><p class="source-code">            {PageCount()}”;</p><p class="source-code">        DataTable.ItemsSource = PagedData();</p><p class="source-code">}</p><p class="source-code">}</p></li>
			</ol>
			<p>This method moves to the last dataset page and updates the UI accordingly.</p>
			<ol>
				<li value="21">Add the <strong class="source-inline">IncrementCounterButton_Click</strong> method:<p class="source-code">private void IncrementCounterButton_Click(object </p><p class="source-code">    sender, RoutedEventArgs e)</p><p class="source-code">{</p><p class="source-code">    _clickCounter++;</p><p class="source-code">    CounterLabel.Content = $”You have clicked the </p><p class="source-code">        button {_clickCounter} times.”;</p><p class="source-code">}</p></li>
			</ol>
			<p>Each time you click <strong class="source-inline">IncrementCounterButton</strong>, this method<a id="_idIndexMarker1215"/> will increment the <strong class="source-inline">_clickCounter</strong> variable<a id="_idIndexMarker1216"/> and report on the screen how many times you have clicked the button.</p>
			<ol>
				<li value="22">Add the final WPF method called <strong class="source-inline">CancelTaskButton_Click</strong>:<p class="source-code">private void CancelTaskButton_Click(object sender, </p><p class="source-code">    RoutedEventArgs e)</p><p class="source-code">{</p><p class="source-code">    if (_worker.WorkerSupportsCancellation == true)</p><p class="source-code">        _worker.CancelAsync();</p><p class="source-code">}</p></li>
			</ol>
			<p>This method cancels the long-running task if it supports cancellation.</p>
			<ol>
				<li value="23">Run the WPF application. You will find that you are presented with the splash screen showing the loading progress, as displayed here: </li>
			</ol>
			<div>
				<div id="_idContainer166" class="IMG---Figure">
					<img src="image/Figure_12.03_B16617.jpg" alt="Figure 12.3 – The WPF application’s splash screen&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.3 – The WPF application’s splash screen</p>
			<p>When the loading completes, the splash<a id="_idIndexMarker1217"/> screen closes and you are presented<a id="_idIndexMarker1218"/> with the main window. While a long-running task is in progress, you can move the window about, click on the increment counter button, navigate through the paged data, and cancel the long-running task.</p>
			<p>As you can see from the following screenshot, we have everything in place that provides visual feedback of progress to end users and a UI that remains responsive to user input during a long-running task:</p>
			<div>
				<div id="_idContainer167" class="IMG---Figure">
					<img src="image/Figure_12.04_B16617.jpg" alt="Figure 12.4 – The WPF application’s main window&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.4 – The WPF application’s main window</p>
			<p>In the next<a id="_idIndexMarker1219"/> section, we will<a id="_idIndexMarker1220"/> look at how to keep ASP.NET UI responsive to user input.</p>
			<h1 id="_idParaDest-219"><a id="_idTextAnchor224"/>Building a responsive UI with ASP.NET</h1>
			<p>In this section, we will be looking<a id="_idIndexMarker1221"/> at ways to assist ASP.NET applications<a id="_idIndexMarker1222"/> in being quick and responsive. We will start by looking at memory and distributed caching. Then, we will look at how you can update a section of a page using AJAX. Next, we will move on to write a real-time chat application with SignalR. We will then take a look at using WebSockets in our ASP.NET applications.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">We will not be covering gRPC-Web in this chapter, as we have already covered that topic with example code in <a href="B16617_09_Final_SB_Epub.xhtml#_idTextAnchor168"><em class="italic">Chapter 9</em></a>, <em class="italic">Enhancing the Performance of Networked Applications</em>, in which we looked at gRPC for non-web applications and gRPC-Web for web applications. In this chapter, we also implemented a simple Blazor web application using gRPC-Web, so you can refer to this chapter for gRPC/gRPC-Web.</p>
			<p>Let’s begin looking<a id="_idIndexMarker1223"/> at a responsive ASP.NET application by focusing on caching. There<a id="_idIndexMarker1224"/> are two kinds of caching we will be looking at. These are <strong class="bold">memory caching</strong> and <strong class="bold">distributed caching</strong>. In the next section, we will implement memory caching.</p>
			<h2 id="_idParaDest-220"><a id="_idTextAnchor225"/>Implementing memory caching</h2>
			<p>Web applications load resources<a id="_idIndexMarker1225"/> over the network we all know<a id="_idIndexMarker1226"/> as the internet. Accessing, downloading, and rendering resources from the internet takes varying degrees of time. Time can vary due to network traffic, the quality of the network, and computer system resources. Is there a way in which we can speed this process up? Well, yes. We can implement caching. But what exactly is caching?</p>
			<p><strong class="bold">Caching</strong> is the local storage of frequently accessed<a id="_idIndexMarker1227"/> resources for faster access and processing.</p>
			<p>In this section, you will see how we can easily implement in-memory caching in ASP.NET. To implement in-memory caching, follow these steps:</p>
			<ol>
				<li value="1">Start a new ASP.NET Core web app (<strong class="source-inline">Model-View-Controller</strong>) project and call it <strong class="source-inline">CH12_ResponsiveASPNET</strong>.</li>
				<li>Add the <strong class="source-inline">Microsoft.Extensions.Caching.Memory</strong> NuGet package. If Visual Studio cannot install it, run the following command in the Package Manager:<p class="source-code"><strong class="bold">Install-Package Microsoft.Extensions.Caching.Memory -</strong></p><p class="source-code"><strong class="bold">    Version 6.0.0-preview.7.21377.19 </strong></p></li>
				<li>In the <strong class="source-inline">HomeController</strong> class, add the statement <strong class="source-inline">using Microsoft.Extensions.Caching.Memory</strong>.</li>
				<li>Add the following member variables:<p class="source-code">private readonly ILogger&lt;HomeController&gt; _logger;</p><p class="source-code">private IMemoryCache _memoryCache;</p></li>
			</ol>
			<p>This code declares the variables that will store our logger and memory cache objects.</p>
			<ol>
				<li value="5">Update<a id="_idIndexMarker1228"/> the <strong class="source-inline">HomeController</strong> constructor, as shown<a id="_idIndexMarker1229"/> next:<p class="source-code">public HomeController(ILogger&lt;HomeController&gt; logger, </p><p class="source-code">    IMemoryCache memoryCache)</p><p class="source-code">{</p><p class="source-code">  _logger = logger;</p><p class="source-code">    _memoryCache = memoryCache;</p><p class="source-code">}</p></li>
			</ol>
			<p>In this code, the logger and memory cache objects that we will be using are injected into our class, and we pass in variables to set our member variables.</p>
			<ol>
				<li value="6">Add the <strong class="source-inline">GetMemoryCacheTime</strong> method:<p class="source-code">private DateTime GetMemoryCacheTime()</p><p class="source-code">{</p><p class="source-code">    DateTime currentTime;</p><p class="source-code">    bool alreadyExists = _memoryCache.TryGetValue</p><p class="source-code">        (“CachedTime”, out currentTime);</p><p class="source-code">    if (!alreadyExists)</p><p class="source-code">    {</p><p class="source-code">    currentTime = DateTime.UtcNow.ToLocalTime();</p><p class="source-code">    _memoryCache.Set(</p><p class="source-code">    “CachedTime”,</p><p class="source-code">    currentTime,  MemoryCacheEntryExtensions</p><p class="source-code">        .SetSlidingExpiration(</p><p class="source-code">         new MemoryCacheEntryOptions() {  </p><p class="source-code">             SlidingExpiration</p><p class="source-code">                 = TimeSpan.FromMinutes(5) },</p><p class="source-code">            TimeSpan.FromMinutes(5)</p><p class="source-code">     ));</p><p class="source-code">    }</p><p class="source-code">    return currentTime;</p><p class="source-code">}</p></li>
			</ol>
			<p>Here, we are checking<a id="_idIndexMarker1230"/> whether our <strong class="source-inline">CachedTime</strong> variable exists<a id="_idIndexMarker1231"/> in the memory cache. If it does exist, then the out variable called <strong class="source-inline">currentTime</strong> is set and the cached time is returned. Otherwise, we get the current time and store it in the memory cache with a sliding expiration value, and then we return the cached time.</p>
			<ol>
				<li value="7">Update the <strong class="source-inline">Index</strong> method with this code:<p class="source-code">[HttpGet]</p><p class="source-code">public string Index()</p><p class="source-code">{</p><p class="source-code">DateTime memoryCacheTime = GetMemoryCacheTime();</p><p class="source-code">return $”Current Time: {DateTime.UtcNow.ToLocalTime()}</p><p class="source-code">    \nMemory Cache Time: {memoryCacheTime}”;</p><p class="source-code">}</p></li>
			</ol>
			<p>The <strong class="source-inline">Index</strong> controller method returns a string. This string that is returned is the cached time.</p>
			<ol>
				<li value="8">Run the project <a id="_idIndexMarker1232"/>and navigate to <strong class="source-inline">https://localhost:5001/Home</strong>. You should see something<a id="_idIndexMarker1233"/> like the following output:</li>
			</ol>
			<p><strong class="bold">Current Time: 12/07/221 20:18:25</strong></p>
			<p><strong class="bold">Memory Cache Time: 12/07/2021 20:18:25</strong></p>
			<p>As you can see, the time did not exist in the cache, and so was added to the cache before it was returned.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The setting of port numbers is dependent on the availability of ports. Whatever port you choose, it will not work if it is in use by another program.</p>
			<ol>
				<li value="9">Now, refresh the page, and you should see different values for the current time and the memory cache time:</li>
			</ol>
			<p><strong class="bold">Current Time: 12/07/2021 20:21:21</strong></p>
			<p><strong class="bold">Memory Cache Time: 12/07/2021 20:18:25</strong></p>
			<p>You can clearly see that the memory cache time is older than the current time. This shows that we have stored the time in the in-memory cache and retrieved it successfully.</p>
			<p>Implementing in-memory caching is really easy in ASP.NET, and you can enhance the page load and render time by storing and retrieving data from the in-memory cache. Now that we have looked at the in-memory cache, we will turn our attention to distributed cache.</p>
			<h2 id="_idParaDest-221"><a id="_idTextAnchor226"/>Implementing distributed caching</h2>
			<p>In this section, we will be using the same ASP.NET web project<a id="_idIndexMarker1234"/> and controller to implement <a id="_idIndexMarker1235"/>distributed caching. What do we mean by distributed caching? Distributed caching<a id="_idIndexMarker1236"/> extends the concept of local caching to include caching over several computers. Such caching enables the scaling of transactional data. You would mainly use distributed caching to store application data that resides in a database, and data related to web sessions. In this section, we use Redis for our caching. Redis is an in-memory data structure store, used as a distributed, in-memory key-value database, cache, and message broker, with optional durability. To implement distributed caching, perform the following:</p>
			<ol>
				<li value="1">Add the <strong class="source-inline">Microsoft.Extensions.Caching.Redis</strong> NuGet package to the web package. You can use the following command:<p class="source-code"><strong class="bold">Install-Package Microsoft.Extensions.Caching.Redis -</strong></p><p class="source-code"><strong class="bold">    Version 2.2.0</strong></p></li>
				<li>In the <strong class="source-inline">HomeController</strong> class, add the <strong class="source-inline">using Microsoft.Extensions.Caching.Distributed</strong> statement.</li>
				<li>Add the following member variable:<p class="source-code">private IDistributedCache _distributedCache;</p></li>
			</ol>
			<p>This variable will hold our distributed cache object that gets injected via the constructor.</p>
			<ol>
				<li value="4">Now, update the constructor code:<p class="source-code">public HomeController(ILogger&lt;HomeController&gt; logger, </p><p class="source-code">    IMemoryCache memoryCache, IDistributedCache </p><p class="source-code">        distributedCache)</p><p class="source-code">{</p><p class="source-code">    _logger = logger;</p><p class="source-code">    _memoryCache = memoryCache;</p><p class="source-code">    _distributedCache = distributedCache;</p><p class="source-code">}</p></li>
			</ol>
			<p>We are injecting the distributed<a id="_idIndexMarker1237"/> cache object and setting<a id="_idIndexMarker1238"/> our member variable.</p>
			<ol>
				<li value="5">To use our distributed cache, we will need to encode and decode Base64 strings. Add the following two methods:<p class="source-code">private static string Base64Encode(string text)</p><p class="source-code">{</p><p class="source-code">    byte[] bytes = Encoding.UTF8.GetBytes(text);</p><p class="source-code">    return Convert.ToBase64String(bytes);</p><p class="source-code">}</p><p class="source-code">public static string Base64Decode(string text)</p><p class="source-code">{</p><p class="source-code">    byte[] bytes = Convert.FromBase64String(text);</p><p class="source-code">    return Encoding.UTF8.GetString(bytes);</p><p class="source-code">}</p></li>
			</ol>
			<p>In these two methods, we are encoding a string as a Base64 encoded string, and we are also decoding strings from Base64 to UTF8.</p>
			<ol>
				<li value="6">Add the <strong class="source-inline">GetDistriutedCacheString</strong> method:<p class="source-code">private string GetDistributedCacheString()</p><p class="source-code">{</p><p class="source-code">  string data = _distributedCache.GetString</p><p class="source-code">      (“StringValue”);</p><p class="source-code">  if (data == null)</p><p class="source-code">  {</p><p class="source-code">     data = Base64Encode($”Hello, World! </p><p class="source-code">          {DateTime.UtcNow.ToLocalTime()}”);</p><p class="source-code">     _distributedCache.Set(“StringValue”,</p><p class="source-code">     Convert.FromBase64String(data),</p><p class="source-code">    new DistributedCacheEntryOptions()</p><p class="source-code">    {</p><p class="source-code">             AbsoluteExpiration </p><p class="source-code">             = DateTime.UtcNow.AddMinutes(10),</p><p class="source-code">    });</p><p class="source-code">    data = Base64Decode(data);</p><p class="source-code">  }</p><p class="source-code">return data;</p><p class="source-code">}</p></li>
			</ol>
			<p>In this code, we obtain<a id="_idIndexMarker1239"/> string data from the cache. If it exists, then<a id="_idIndexMarker1240"/> we return it. If it does not exist, then we save the Base64 encoded version of the string to the cache with an absolute expiry being set and then return the Base64 decoded version of the string as a UTF encoded string.</p>
			<ol>
				<li value="7">Update the <strong class="source-inline">HomeController.Index</strong> method, as shown here:<p class="source-code">[HttpGet]</p><p class="source-code">public string Index()</p><p class="source-code">{</p><p class="source-code">DateTime memoryCacheTime = GetMemoryCacheTime();</p><p class="source-code">string data = GetDistributedCacheString();</p><p class="source-code">return $”Current Time: {DateTime.UtcNow.ToLocalTime()}</p><p class="source-code">    \nMemory Cache Time: {memoryCacheTime}</p><p class="source-code">        \nDistributed Cache String: {data}”;</p><p class="source-code">}</p></li>
			</ol>
			<p>This code obtains in-memory cache<a id="_idIndexMarker1241"/> and distributed cache stored data and outputs it to the user, showing<a id="_idIndexMarker1242"/> the current time, the in-memory cached time, and the data stored in the distributed cache.</p>
			<ol>
				<li value="8">Run the program and navigate to <strong class="source-inline">https://localhost:5001</strong>. You should see the following output:<p class="source-code"><strong class="bold">Current Time: 12/07/2021 21:05:59</strong></p><p class="source-code"><strong class="bold">Memory Cache Time: 12/07/2021 21:05:59</strong></p><p class="source-code"><strong class="bold">Distributed Cache String: Hello, World! 12/07/2021 </strong></p><p class="source-code"><strong class="bold">21:05:59</strong></p></li>
			</ol>
			<p>We can see that the memory cached time and distributed cache string have both just been added to the cache because they are the same as the current time. Now, refresh your browser. You should see that both cached values are older than the current time as shown:</p>
			<p class="source-code"><strong class="bold">Current Time: 12/07/2021 21:08:13</strong></p>
			<p class="source-code"><strong class="bold">Memory Cache Time: 12/07/2021 21:05:59</strong></p>
			<p class="source-code"><strong class="bold">Distributed Cache String: Hello, World! 12/07/2021 </strong></p>
			<p class="source-code"><strong class="bold">21:05:59</strong></p>
			<p class="source-code"><strong class="bold">It is plain to see that both cached values already </strong></p>
			<p class="source-code"><strong class="bold">existed in the cache, since they are older than the </strong></p>
			<p class="source-code"><strong class="bold">current time.</strong></p>
			<p>In this and the previous section, you have seen how easy it is to add in-memory and distributed caching to our application. Both forms of caching can be really useful in improving the<a id="_idIndexMarker1243"/> performance of your ASP.NET web<a id="_idIndexMarker1244"/> applications. In the next section, we will look at how to update a small section of the currently displayed page using AJAX.</p>
			<h2 id="_idParaDest-222"><a id="_idTextAnchor227"/>Using AJAX to update part of the currently displayed page</h2>
			<p>In this section, we will use AJAX to update a part of a page<a id="_idIndexMarker1245"/> that is currently being displayed. This saves us from having<a id="_idIndexMarker1246"/> to load the whole page. Let’s start writing our AJAX example:</p>
			<ol>
				<li value="1">Right-click on the <strong class="source-inline">Controllers</strong> folder. From the context menu, select <strong class="bold">Add</strong> | <strong class="bold">Controller…</strong>. Then, select <strong class="bold">MVC Controller – Empty</strong>.</li>
				<li>Call the new controller <strong class="source-inline">AjaxController</strong> and open the class.</li>
				<li>Update the controller by adding the following method:<p class="source-code">[Route(“Ajax/Demo”)]</p><p class="source-code">public IActionResult AjaxDemo()</p><p class="source-code">{</p><p class="source-code">    return new JsonResult(“Ajax Demo Result”);</p><p class="source-code">}</p></li>
			</ol>
			<p>This method when called will return a JSON result, which in our case is a simple string.</p>
			<ol>
				<li value="4"><em class="italic">Right-click</em> on the <strong class="source-inline">Index</strong> method and select <strong class="bold">Add View</strong>. This will create a view for the Ajax controller called <strong class="source-inline">index.cshtml</strong>.</li>
				<li>Update the <strong class="source-inline">Views/Ajax/index.cshtml</strong> file with the following HTML and JavaScript code:<p class="source-code">&lt;!DOCTYPE html&gt;</p><p class="source-code">&lt;html&gt;</p><p class="source-code">    &lt;head&gt;</p><p class="source-code">        &lt;meta name=”viewport” content=”width=device-</p><p class="source-code">            width” /&gt;</p><p class="source-code">        &lt;title&gt;Ajax Example&lt;/title&gt;</p><p class="source-code">    &lt;/head&gt;</p><p class="source-code">    &lt;body&gt;</p><p class="source-code">        &lt;fieldset&gt;</p><p class="source-code">            &lt;legend&gt;Ajax Demonstration&lt;/legend&gt;</p><p class="source-code">            &lt;<strong class="bold">form</strong>&gt;</p><p class="source-code">                &lt;input type=”button” value=”Ajax </p><p class="source-code">                Demonstration” id=”ajaxDemonstration</p><p class="source-code">                Button” /&gt;</p><p class="source-code">                &lt;br /&gt;</p><p class="source-code">                &lt;span id=”ajaxDemoResult”&gt;&lt;/span&gt;</p><p class="source-code">            &lt;/<strong class="bold">form</strong>&gt;</p><p class="source-code">        &lt;/fieldset&gt;</p><p class="source-code">        &lt;script</p><p class="source-code">             src=”https://code.jquery.com/jquery-</p><p class="source-code">                 3.6.0.slim.min.js”</p><p class="source-code">            integrity=”sha256-u7e5khyithlIdTpu22P</p><p class="source-code">                HhENmPcRdFiHRjhAuHcs05RI=”</p><p class="source-code">            crossorigin=”anonymous”</p><p class="source-code">        &gt;</p><p class="source-code">                </p><p class="source-code">        &lt;/script&gt;</p><p class="source-code">        &lt;script&gt;</p><p class="source-code">            $(document).ready(function( ) {</p><p class="source-code">                $(‘#ajaxDemonstrationButton’)</p><p class="source-code">                    .click(function() {</p><p class="source-code">                    $.ajax({</p><p class="source-code">                        type: ‘GET’,</p><p class="source-code">                        url: ‘/Ajax/Demo’,</p><p class="source-code">                        success: function (result) {</p><p class="source-code">                          $(‘#ajaxDemoResult’)</p><p class="source-code">                            .html(result);</p><p class="source-code">                        }</p><p class="source-code">                    });</p><p class="source-code">                });</p><p class="source-code">            });            </p><p class="source-code">        &lt;/script&gt;</p><p class="source-code">    &lt;/body&gt;</p><p class="source-code">&lt;/html&gt;</p></li>
			</ol>
			<p>We have an HTML form. That form<a id="_idIndexMarker1247"/> has a button that, when pressed, will execute JavaScript<a id="_idIndexMarker1248"/> that will retrieve AJAX data by executing our <strong class="source-inline">AjaxDemo</strong> action method. This will result in our JSON string being displayed on the page.</p>
			<ol>
				<li value="6">Run the project and navigate to <strong class="source-inline">http://localhost:5001/Ajax</strong>. You should see the following:</li>
			</ol>
			<div>
				<div id="_idContainer168" class="IMG---Figure">
					<img src="image/Figure_12.05_B16617.jpg" alt="Figure 12.5 – The AJAX demo before AJAX is retrieved&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.5 – The AJAX demo before AJAX is retrieved</p>
			<p>As you can see, our page<a id="_idIndexMarker1249"/> is loaded without our JSON<a id="_idIndexMarker1250"/> string. Now, click the <strong class="bold">Ajax Demonstration</strong> button. You now see the following:</p>
			<div>
				<div id="_idContainer169" class="IMG---Figure">
					<img src="image/Figure_12.06_B16617.jpg" alt="Figure 12.6 – The AJAX demo displaying the JSON string retrieved using AJAX&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.6 – The AJAX demo displaying the JSON string retrieved using AJAX</p>
			<p>After clicking the button, we can see that the AJAX action retrieved our JSON string and displayed it on the page without a complete page load.</p>
			<p>We have seen how to update<a id="_idIndexMarker1251"/> a portion of a page using AJAX, and before<a id="_idIndexMarker1252"/> that, we saw how to implement in-memory and distributed caching. In the next section, we will look at how to implement WebSockets.</p>
			<h2 id="_idParaDest-223"><a id="_idTextAnchor228"/>Implementing WebSockets</h2>
			<p>In this section, we will be implementing <strong class="bold">WebSockets</strong>. You may have heard of WebSockets, but<a id="_idIndexMarker1253"/> what are they? A WebSocket<a id="_idIndexMarker1254"/> is a full-duplex communication protocol for communication<a id="_idIndexMarker1255"/> over a single TCP connection. To find out more about the WebSocket specification, you can look up the IETF RFC 6455 from 2011 (<a href="https://www.rfc-editor.org/rfc/rfc6455.txt">https://www.rfc-editor.org/rfc/rfc6455.txt</a>).</p>
			<p>What do we use WebSockets for? Well, we can use them to open a single two-way interactive session between browsers and servers. That way, we can negate server polling, send messages to a server, and receive responses via events. Thus, making our applications event-driven.</p>
			<p>In our WebSockets demonstration, we will click<a id="_idIndexMarker1256"/> a button. It will open a WebSocket, send<a id="_idIndexMarker1257"/> a message, receive a response, and then close the connection. The communication between our browser and the server will be output to our web page. So, let’s get started with writing our WebSocket example:</p>
			<ol>
				<li value="1">Add a new controller called <strong class="source-inline">WebSocketsController</strong>.</li>
				<li>Right-click the <strong class="source-inline">Index</strong> method and select <strong class="bold">Add View</strong>.</li>
				<li>Update the <strong class="source-inline">Views/WebSockets/Index.cshtml</strong> file as follows:<p class="source-code">&lt;script type = “text/javascript”&gt; </p><p class="source-code">    function WebSocketExample (){</p><p class="source-code">        var socket = new WebSocket(“wss://</p><p class="source-code">            javascript.info/article/websocket/</p><p class="source-code">                demo/hello”);</p><p class="source-code">        var messages = document.getElementById</p><p class="source-code">            (‘messages’)</p><p class="source-code">        var innerHTML = messages.innerHTML;</p><p class="source-code">        socket.onopen = function(e) {</p><p class="source-code">            innerHTML += ‘&lt;p&gt;[open] Connection </p><p class="source-code">                established&lt;/p&gt;’;</p><p class="source-code">            messages.innerHTML += innerHTML;</p><p class="source-code">            innerHTML += ‘&lt;p&gt;Sending to server&lt;/p&gt;’;</p><p class="source-code">            messages.innerHTML += innerHTML;</p><p class="source-code">            socket.send(‘WebSocket message!’);</p><p class="source-code">        };</p><p class="source-code">        socket.onmessage = function(event) {</p><p class="source-code">            innerHTML += `&lt;p&gt;[message] Data received </p><p class="source-code">                from server: ${event.data}&lt;/p&gt;`;</p><p class="source-code">        };</p><p class="source-code">        socket.onclose = function(event) {  </p><p class="source-code">            if (event.wasClean) {</p><p class="source-code">                innerHTML += `&lt;p&gt;[close] Connection </p><p class="source-code">                closed cleanly, code=${event.code} </p><p class="source-code">                reason=${event.reason}&lt;/p&gt;`;</p><p class="source-code">            messages.innerHTML = innerHTML;</p><p class="source-code">            } else {</p><p class="source-code">         // e.g. server process killed or network down</p><p class="source-code">         // event.code is usually 1006 in this case</p><p class="source-code">        innerHTML += ‘&lt;p&gt;[close] Connection died&lt;/p&gt;’;</p><p class="source-code">                messages.innerHTML = innerHTML;</p><p class="source-code">            }</p><p class="source-code">        };</p><p class="source-code">        socket.onerror = function(error) {</p><p class="source-code">            innerHTML += `&lt;p&gt;[error] </p><p class="source-code">                ${error.message}&lt;/p&gt;`;</p><p class="source-code">            messages.innerHTML = innerHTML;</p><p class="source-code">        };</p><p class="source-code">    }</p><p class="source-code">&lt;/script&gt; </p><p class="source-code">&lt;p&gt;Click the following button to see the function in </p><p class="source-code">    action&lt;/p&gt;  </p><p class="source-code">&lt;input type = “button” onclick = “WebSocketExample()” </p><p class="source-code">    value = “Display”&gt;  </p><p class="source-code">&lt;p id=”messages” onload=”WebSocketExample()”&gt;&lt;/p&gt;</p></li>
			</ol>
			<p>When a WebSocket is opened via the button<a id="_idIndexMarker1258"/> click, the <strong class="source-inline">messages</strong> paragraph is updated with messages, and then a message<a id="_idIndexMarker1259"/> is sent to the server. When the server responds, the messages paragraph is then updated to inform the user that the server has responded. If an error occurs, then a message is displayed to the user. The WebSocket is then closed and a message is displayed on the page.</p>
			<ol>
				<li value="4">Run the code and navigate to <strong class="source-inline">http://localhost:5001/WebSockets</strong>. Click on the button, and you should end up with the following:</li>
			</ol>
			<div>
				<div id="_idContainer170" class="IMG---Figure">
					<img src="image/Figure_12.07_B16617.jpg" alt="Figure 12.7 – The end result of clicking on the button and executing our WebSocket example&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.7 – The end result of clicking on the button and executing our WebSocket example</p>
			<p>There is not that much code to WebSockets. In this<a id="_idIndexMarker1260"/> example, we have sent a simple message and received a response. All our <a id="_idIndexMarker1261"/>code to do this exists in the <strong class="source-inline">CSHTML</strong> file of our view. In the next section, we will look at writing a real-time chat program using SignalR.</p>
			<h2 id="_idParaDest-224"><a id="_idTextAnchor229"/>Implementing a real-time chat application using SignalR</h2>
			<p>In this section, we will learn<a id="_idIndexMarker1262"/> how to write real-time functionality<a id="_idIndexMarker1263"/> in an ASP.NET web application<a id="_idIndexMarker1264"/> using SignalR. We will demonstrate SignalR in action by writing a simple chat application. We will now begin writing the application:</p>
			<ol>
				<li value="1"><em class="italic">Right-click</em> the project and select <strong class="bold">Add</strong> | <strong class="bold">Client-Side Library</strong> from the context menu, and fill in the details as shown in <em class="italic">Figure 12.8</em>. Then, click the <strong class="bold">Install</strong> button:</li>
			</ol>
			<div>
				<div id="_idContainer171" class="IMG---Figure">
					<img src="image/Figure_12.08_B16617.jpg" alt="Figure 12.8 – The Add Client-Side Library configured to install SignalR&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.8 – The Add Client-Side Library configured to install SignalR</p>
			<ol>
				<li value="2">Copy the <strong class="source-inline">wwwroot/lib/microsoft/signalr</strong> library<a id="_idIndexMarker1265"/> and paste it into<a id="_idIndexMarker1266"/> the <strong class="source-inline">wwwroot/js</strong> folder.</li>
				<li>Add a new controller<a id="_idIndexMarker1267"/> called <strong class="source-inline">SignalRController</strong>.</li>
				<li>Add a folder called <strong class="source-inline">Hubs</strong> under the main project root.</li>
				<li>Add a class to the <strong class="source-inline">Hubs</strong> folder called <strong class="source-inline">ChatHub</strong>. Then, update the <strong class="source-inline">ChatHub</strong> class, as shown here:<p class="source-code">public class ChatHub : Hub</p><p class="source-code">{</p><p class="source-code">     public async Task SendMessage(</p><p class="source-code">         string user, string message</p><p class="source-code">     )</p><p class="source-code">     {</p><p class="source-code">             await Clients.All</p><p class="source-code">             .SendAsync(</p><p class="source-code">                 “ReceiveMessage”, user, message</p><p class="source-code">             );</p><p class="source-code">     }</p><p class="source-code">}</p></li>
			</ol>
			<p>We have<a id="_idIndexMarker1268"/> our SignalR hub class<a id="_idIndexMarker1269"/> in place, and our <strong class="source-inline">SendMessage</strong> method sends<a id="_idIndexMarker1270"/> a message to the specified user asynchronously.</p>
			<ol>
				<li value="6"><em class="italic">Right-click</em> on the <strong class="source-inline">Index</strong> method in the <strong class="source-inline">SignalRController</strong> class and select <strong class="bold">Add View</strong> from the context menu.</li>
				<li>In the <strong class="source-inline">Views/SignalR/Index.cshtml</strong> file, replace the existing contents with the following code:<p class="source-code">@page</p><p class="source-code">&lt;div class=”container”&gt;</p><p class="source-code">&lt;div class=”row”&gt;&amp;nbsp;&lt;/div&gt;</p><p class="source-code">     &lt;div class=”row”&gt;</p><p class="source-code">         &lt;div class=”col-2”&gt;User&lt;/div&gt;</p><p class="source-code">           &lt;div class=”col-4”&gt;</p><p class="source-code">             &lt;input type=”text” </p><p class="source-code">                 id=”userInput” /&gt;</p><p class="source-code">         &lt;/div&gt;</p><p class="source-code">     &lt;/div&gt;</p><p class="source-code">     &lt;div class=”row”&gt;</p><p class="source-code">         &lt;div class=”col-2”&gt;Message&lt;/div&gt;</p><p class="source-code">           &lt;div class=”col-4”&gt;</p><p class="source-code">             &lt;input type=”text” </p><p class="source-code">                 id=”messageInput” /&gt;</p><p class="source-code">         &lt;/div&gt;</p><p class="source-code">     &lt;/div&gt;</p><p class="source-code">     &lt;div class=”row”&gt;&amp;nbsp;&lt;/div&gt;</p><p class="source-code">     &lt;div class=”row”&gt;</p><p class="source-code">         &lt;div class=”col-6”&gt;</p><p class="source-code">              &lt;input type=”button” </p><p class="source-code">             id=”sendButton” value=”Send Message” /&gt;</p><p class="source-code">          &lt;/div&gt;</p><p class="source-code">     &lt;/div&gt;</p><p class="source-code">&lt;/div&gt;</p><p class="source-code">&lt;div class=”row”&gt;</p><p class="source-code">&lt;div class=”col-12”&gt;</p><p class="source-code">             &lt;hr /&gt;</p><p class="source-code">     &lt;/div&gt;</p><p class="source-code">&lt;/div&gt;</p><p class="source-code">&lt;div class=”row”&gt;</p><p class="source-code">&lt;div class=”col-6”&gt;</p><p class="source-code">             &lt;ul id=”messagesList”&gt;&lt;/ul&gt;</p><p class="source-code">     &lt;/div&gt;</p><p class="source-code">&lt;/div&gt;</p><p class="source-code">&lt;<strong class="bold">script</strong> src=”~/js/signalr/dist/browser/signalr.js”&gt;</p><p class="source-code">    &lt;/<strong class="bold">script</strong>&gt;</p><p class="source-code">&lt;<strong class="bold">script</strong> src=”~/js/chat.js”&gt;&lt;/<strong class="bold">script</strong>&gt;</p></li>
			</ol>
			<p>We have put together<a id="_idIndexMarker1271"/> a chat UI. The script <a id="_idIndexMarker1272"/>uses SignalR. All we need<a id="_idIndexMarker1273"/> to do now is add our JavaScript that makes our UI interactive.</p>
			<ol>
				<li value="8">In the <strong class="source-inline">wwwroot/js</strong> folder, add a file called <strong class="source-inline">chat.js</strong> with the following code:<p class="source-code">“use strict”;</p><p class="source-code">var connection = new signalR.HubConnectionBuilder()</p><p class="source-code">    .withUrl(“/chatHub”).build();</p><p class="source-code">document.getElementById(“sendButton”).disabled = true;</p><p class="source-code">connection.on(“ReceiveMessage”, function (user, </p><p class="source-code">    message) {</p><p class="source-code">        var li = document.createElement(“li”);</p><p class="source-code">     document.getElementById(“messagesList”)</p><p class="source-code">         .appendChild(li);</p><p class="source-code">     li.textContent = `${user} says ${message}`;</p><p class="source-code">});</p><p class="source-code">connection.start().then(function () {</p><p class="source-code">        document.getElementById(“sendButton”)</p><p class="source-code">         .disabled = false;</p><p class="source-code">}).catch(function (err) {</p><p class="source-code">    return console.error(err.toString());</p><p class="source-code">});</p><p class="source-code">document.getElementById(“sendButton”)</p><p class="source-code">     .addEventListener(“click”, function (event) {</p><p class="source-code">         var user = document</p><p class="source-code">             .getElementById(“userInput”).value;</p><p class="source-code">             var message = document</p><p class="source-code">             .getElementById(“messageInput”).value;</p><p class="source-code">         connection.invoke(</p><p class="source-code">             “SendMessage”, user, message</p><p class="source-code">         ).catch(function (err) {</p><p class="source-code">                 return console.error(err.toString());</p><p class="source-code">             });</p><p class="source-code">             event.preventDefault();</p><p class="source-code">     });</p></li>
			</ol>
			<p>We have added JavaScript<a id="_idIndexMarker1274"/> that makes our UI<a id="_idIndexMarker1275"/> interactive. This code<a id="_idIndexMarker1276"/> manages the sending of chat messages between users.</p>
			<ol>
				<li value="9">In the <strong class="source-inline">Program</strong> class, add the following services:<p class="source-code">services.AddRazorPages();</p><p class="source-code">services.AddSignalR();</p></li>
			</ol>
			<p>This code adds SignalR to our available services so that we can pass SignalR requests to SignalR.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">If using the new minimal template, the code is <strong class="source-inline">builder.Services.AddRazorPages(); builder.Services.AddSignalR();</strong>.</p>
			<ol>
				<li value="10">Update<a id="_idIndexMarker1277"/> the <strong class="source-inline">Program</strong> class<a id="_idIndexMarker1278"/> to include the mapped<a id="_idIndexMarker1279"/> route to our <strong class="source-inline">ChatHub</strong>:<p class="source-code">app.MapHub&lt;ChatHub&gt;(“/chatHub”);</p></li>
			</ol>
			<p>We have included the route to our <strong class="source-inline">ChatHub</strong> so that our chat application knows how to handle incoming requests.</p>
			<ol>
				<li value="11">Run the code and navigate to <strong class="source-inline">https://localhost:5001/SignalR</strong>. You will need two browser instances side by side. Enter usernames and messages in each browser and click on the <strong class="bold">Send Message</strong> button. Each time you enter text, it will appear on the receiver’s chat page, as you can see here:</li>
			</ol>
			<div>
				<div id="_idContainer172" class="IMG---Figure">
					<img src="image/Figure_12.09_B16617.jpg" alt="Figure 12.9 – Our SignalR application in action&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.9 – Our SignalR application in action</p>
			<p>It was fairly straightforward<a id="_idIndexMarker1280"/> setting up and running<a id="_idIndexMarker1281"/> our SignalR. As you<a id="_idIndexMarker1282"/> can see, SignalR is an excellent choice for real-time communication, and I am sure you will be able to take this knowledge<a id="_idIndexMarker1283"/> further in the web applications<a id="_idIndexMarker1284"/> you write. That concludes<a id="_idIndexMarker1285"/> our work on ASP.NET in this chapter. So, let’s now move on to look at .NET MAUI in the next section.</p>
			<h1 id="_idParaDest-225"><a id="_idTextAnchor230"/>Building responsive UIs with .NET MAUI</h1>
			<p>Microsoft .NET MAUI<a id="_idIndexMarker1286"/> is the new version of Xamarin.Forms. There have been some significant<a id="_idIndexMarker1287"/> changes between Xamarin.Forms version 5.0 and .NET MAUI (Xamarin.Forms version 6.0). The biggest change in MAUI has been to combine the Android, iOS, and macOS projects into a main project. While the code specific to Windows still resides in its own project, Microsoft is working to include the Windows code in the main project. This will lead to us having one single project for writing cross-platform applications using C# and XAML. Let’s have a look at some of the other improvements to building cross-platform applications using .NET MAUI.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">If you are using an early version of MAUI, to run the Windows project, you will need to set the Windows project as the startup project and deploy the project. Once the project is deployed, you can run the application from the Windows start menu.</p>
			<h2 id="_idParaDest-226"><a id="_idTextAnchor231"/>Layouts</h2>
			<p>Another significant<a id="_idIndexMarker1288"/> change made in .NET MAUI is that<a id="_idIndexMarker1289"/> the original layouts used by Xamarin.Forms projects have been moved to <strong class="source-inline">Microsoft.Maui.Controls.Compatibility</strong> namespace. By default, MAUI will use new layouts. These layouts are based on a new <strong class="source-inline">LayoutManager</strong> that has been written for performance, consistency, and maintainability. The new layouts are <strong class="source-inline">Grid</strong>, <strong class="source-inline">FlexLayout</strong>, and <strong class="source-inline">StackLayout</strong> (<strong class="source-inline">HorizontalStackLayout</strong> and <strong class="source-inline">VerticalStackLayout</strong>). Microsoft encourages you to select the stack layout that best suits your needs. You are also encouraged to replace legacy layouts with new layouts.</p>
			<p>The default spacing values for the new<a id="_idIndexMarker1290"/> layouts have been standardized to the value of 0. Having these values as 0 sets the expectation that you will set your own preferred values to meet your design requirements. It is best to set these values in your global styles as follows:</p>
			<pre class="source-code">&lt;ResourceDictionary&gt;</pre>
			<pre class="source-code">    &lt;Style TargetType=”StackLayout”&gt;</pre>
			<pre class="source-code">        &lt;Setter Property=”Spacing” Value=”8”/&gt;</pre>
			<pre class="source-code">    &lt;/Style&gt;</pre>
			<pre class="source-code">    &lt;Style TargetType=”Grid”&gt;</pre>
			<pre class="source-code">        &lt;Setter Property=”ColumnSpacing” Value=”8”/&gt;</pre>
			<pre class="source-code">        &lt;Setter Property=”RowSpacing” Value=”8”/&gt;</pre>
			<pre class="source-code">    &lt;/Style&gt;</pre>
			<pre class="source-code">&lt;/ResourceDictionary&gt;</pre>
			<p>Let’s move<a id="_idIndexMarker1291"/> on to look at accessibility improvements.</p>
			<h2 id="_idParaDest-227"><a id="_idTextAnchor232"/>Accessibility</h2>
			<p>Microsoft regularly meets with developers<a id="_idIndexMarker1292"/> who are heavily invested in making applications that meet the highest accessibility rating. This led Microsoft to remove the <strong class="source-inline">TabIndex</strong> and <strong class="source-inline">IsTabStop</strong> properties, as they ended up being confusing and not meeting accessibility needs. For better accessibility, you can improve a screen reader’s ability to know the order of reading a UI by implementing a thoughtful design. If you need to take control over the order of UI components, Microsoft recommends that you use the <strong class="source-inline">SemanticOrderView</strong> component.</p>
			<h3>SetSemanticFocus and Announce</h3>
			<p>Screen readers are an essential<a id="_idIndexMarker1293"/> part of an application that is accessible and friendly. To aid<a id="_idIndexMarker1294"/> these applications’ performance in being able to read the correct components, there is a new <strong class="source-inline">SemanticExtensions</strong> class. As part of this class, there is a new method called <strong class="source-inline">SetSematicFocus</strong>. This method enables the setting of a screen reader’s focus to a specific element. </p>
			<p class="callout-heading">Note</p>
			<p class="callout">At the time of writing, <strong class="source-inline">SetSemanticFocus</strong> and <strong class="source-inline">Announce</strong> are only available for iOS, Android, and Mac Catalyst.</p>
			<p>Here is a XAML example of setting semantic focus:</p>
			<pre class="source-code">&lt;VerticalStackLayout&gt;</pre>
			<pre class="source-code">    &lt;Label</pre>
			<pre class="source-code">        Text=”SemanticExtensions:”</pre>
			<pre class="source-code">        TextColor=”Black”</pre>
			<pre class="source-code">        FontAttributes=”Bold”</pre>
			<pre class="source-code">        FontSize=”14”</pre>
			<pre class="source-code">        Margin=”0,8”/&gt;</pre>
			<pre class="source-code">    &lt;Button</pre>
			<pre class="source-code">        Text=”Semantic focus is applied to the label that </pre>
			<pre class="source-code">            follows upon the button being pressed.”</pre>
			<pre class="source-code">        FontSize=”12”</pre>
			<pre class="source-code">        Clicked=”LabelFocusButton_Clicked”/&gt;</pre>
			<pre class="source-code">    &lt;Label</pre>
			<pre class="source-code">        x:Name=”SomeLabel”</pre>
			<pre class="source-code">        Text=”Hello, I am able to receive semantic focus!”</pre>
			<pre class="source-code">        FontSize=”12”/&gt;</pre>
			<pre class="source-code">&lt;/VerticalStackLayout&gt;</pre>
			<p>In this XAML, we have an instruction<a id="_idIndexMarker1295"/> label and a button for the user to press. When<a id="_idIndexMarker1296"/> the button is pressed, the click event will set the semantic focus to <strong class="source-inline">semanticFocusLabel</strong>. Here is the click event code:</p>
			<pre class="source-code">private void LabelFocusButton_Clicked(object sender, </pre>
			<pre class="source-code">    EventArgs e)</pre>
			<pre class="source-code">{</pre>
			<pre class="source-code">    SomeLabel.SetSemanticFocus();</pre>
			<pre class="source-code">}</pre>
			<p>The following code enables the screen reader to make an announcement:</p>
			<pre class="source-code">SemanticScreenReader.Announce(</pre>
			<pre class="source-code">    “Make your applications accessible to MAUI users!”</pre>
			<pre class="source-code">);</pre>
			<p>Another accessibility addition is automatic font scaling.</p>
			<h3>Font scaling</h3>
			<p>By default, all components<a id="_idIndexMarker1297"/> now have automatic font scaling, and it is enabled by default. That means that when your users change their text scaling on the various platforms, your application’s text will scale to their chosen settings automatically. You can turn automatic font scaling off for control with the following markup: <strong class="source-inline">FontAutoScalingEnabled=”False”</strong>. Changing the attribute to <strong class="source-inline">True</strong> or removing it will turn font auto-scaling back on. </p>
			<h2 id="_idParaDest-228"><a id="_idTextAnchor233"/>BlazorWebView</h2>
			<p>Using BlazorWebView, you can host Blazor websites<a id="_idIndexMarker1298"/> in your Microsoft MAUI applications. This enables<a id="_idIndexMarker1299"/> your Blazor website to make use of native platform functionality and various user controls. You can add <strong class="source-inline">BlazorWebView</strong> to a XAML page and point it to the root of your Blazor application:</p>
			<pre class="source-code">&lt;BlazorWebView HostPage=”wwwroot/index.html”</pre>
			<pre class="source-code">               Services=”{StaticResource Services}”&gt;</pre>
			<pre class="source-code">     &lt;BlazorWebView.RootComponent&gt;</pre>
			<pre class="source-code">         &lt;RootComponent Selector=”#app”</pre>
			<pre class="source-code">                ComponentType=”{x:Type local:Main}” /&gt;</pre>
			<pre class="source-code">     &lt;/BlazorWebView.RootComponent&gt;</pre>
			<pre class="source-code">&lt;/BlazorWebView&gt;</pre>
			<p>As you can see from the XAML, the root<a id="_idIndexMarker1300"/> of our Blazor application is <strong class="source-inline">wwwroot/index.html</strong>. In the next section, we will take<a id="_idIndexMarker1301"/> a look at WinUI 3.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">As of June 20, 2022, MAUI is generally available, but to develop MAUI applications, you will need to install a .NET 2022 preview.</p>
			<h1 id="_idParaDest-229"><a id="_idTextAnchor234"/>Building a responsive UI with MAUI</h1>
			<p>In this section, we will build<a id="_idIndexMarker1302"/> a simple responsive UI using MAUI. Until MAUI is included with<a id="_idIndexMarker1303"/> Visual Studio 2022, you will need to ensure you use Visual Studio 2022 Preview:</p>
			<ol>
				<li value="1">Start a new .NET MAUI app and call it <strong class="source-inline">CH12_ResponsiveMAUI</strong>.</li>
				<li>Add a new folder called <strong class="source-inline">Api</strong>.</li>
				<li>In the <strong class="source-inline">Api</strong> folder, add a class called <strong class="source-inline">PropertyChangedNotifier</strong> and replace its contents with the following code:<p class="source-code">namespace CH12_ResponsiveMAUI.Api</p><p class="source-code">{</p><p class="source-code">    using System.ComponentModel;</p><p class="source-code">    using System.Runtime.CompilerServices;</p><p class="source-code"> </p><p class="source-code">    public class PropertyChangeNotifier : </p><p class="source-code">        INotifyPropertyChanged</p><p class="source-code">    {</p><p class="source-code">        public event PropertyChangedEventHandler </p><p class="source-code">            PropertyChanged;</p><p class="source-code"> </p><p class="source-code">        protected void OnPropertyChanged</p><p class="source-code">            ([CallerMemberName] string propertyName = </p><p class="source-code">               null)</p><p class="source-code">        {</p><p class="source-code">            PropertyChanged?.Invoke(this, new </p><p class="source-code">                PropertyChangedEventArgs</p><p class="source-code">                   (propertyName));</p><p class="source-code">        }</p><p class="source-code">    }</p><p class="source-code">}</p></li>
			</ol>
			<p>This code is a base<a id="_idIndexMarker1304"/> class that implements<a id="_idIndexMarker1305"/> the <strong class="source-inline">INotifyPropertyChanged</strong> interface.</p>
			<ol>
				<li value="4">Add a new folder called <strong class="source-inline">Data</strong>.</li>
				<li>Add a new class to the <strong class="source-inline">Data</strong> folder called <strong class="source-inline">BaseEntity</strong> with the following properties:<p class="source-code">public int Id { get; set; }</p><p class="source-code">public DateTime CreatedDate { get; set; }</p><p class="source-code">public DateTime ModifiedDate { get; set; }</p></li>
			</ol>
			<p>These are base properties for our entities that will inherit this class.</p>
			<ol>
				<li value="6">Add a new interface to the <strong class="source-inline">Data</strong> folder called <strong class="source-inline">IRepository</strong> and replace the class with the following code:<p class="source-code">public interface IRepository&lt;T&gt; where T : BaseEntity</p><p class="source-code">{</p><p class="source-code">        T GetById(int id);</p><p class="source-code">        T FirstOrDefault(Func&lt;T, bool&gt; query);</p><p class="source-code">        void Add(T entity);</p><p class="source-code">        void Update(T entity);</p><p class="source-code">        void Remove(T entity);</p><p class="source-code">        List&lt;T&gt; GetAll();</p><p class="source-code">        List&lt;T&gt; Filter(Func&lt;T, bool&gt; query);</p><p class="source-code">        int Count();</p><p class="source-code">        int FilteredCount(Func&lt;T, bool&gt; query);</p><p class="source-code">}</p></li>
			</ol>
			<p>This interface will be implemented by all our repositories.</p>
			<ol>
				<li value="7">Add a class called <strong class="source-inline">BaseRepository</strong> to the <strong class="source-inline">Data</strong> folder<a id="_idIndexMarker1306"/> and update the class<a id="_idIndexMarker1307"/> with the following code:<p class="source-code">public class BaseRepository&lt;T&gt; : IRepository&lt;T&gt; where </p><p class="source-code">    T : BaseEntity</p><p class="source-code">{</p><p class="source-code">        protected ICollection&lt;T&gt; Context;</p><p class="source-code">        public BaseRepository(ICollection&lt;T&gt; context)</p><p class="source-code">        {</p><p class="source-code">            if (context == null)</p><p class="source-code">                throw new ArgumentNullException</p><p class="source-code">                    (“context”);</p><p class="source-code">            Context = context;</p><p class="source-code">        }</p><p class="source-code">}</p></li>
			</ol>
			<p>This class is a generic base repository<a id="_idIndexMarker1308"/> that implements the <strong class="source-inline">IRepository</strong> interface. The context<a id="_idIndexMarker1309"/> for storing data is of type <strong class="source-inline">ICollection</strong>, and we set <strong class="source-inline">Context</strong> to the collection passed in as a parameter.</p>
			<ol>
				<li value="8">Add the <strong class="source-inline">Add</strong> method:<p class="source-code">public void Add(T entity)</p><p class="source-code">{</p><p class="source-code">Context.Add(entity);</p><p class="source-code">}</p></li>
			</ol>
			<p>This code adds an entity to our collection.</p>
			<ol>
				<li value="9">Add the <strong class="source-inline">Count</strong> method:<p class="source-code">public int Count()</p><p class="source-code">{</p><p class="source-code">if (Context != null)</p><p class="source-code">     return Context.Count;</p><p class="source-code">return 0;</p><p class="source-code">}</p></li>
			</ol>
			<p>This code returns the count of all the entities in our collection.</p>
			<ol>
				<li value="10">Add the <strong class="source-inline">Filter</strong> method:<p class="source-code"> public List&lt;T&gt; Filter(Func&lt;T, bool&gt; query)</p><p class="source-code">{</p><p class="source-code">return Context.Where(query).ToList();</p><p class="source-code">}</p></li>
			</ol>
			<p>This code takes a query and returns a filtered list of items.</p>
			<ol>
				<li value="11">Add the <strong class="source-inline">FilteredCount</strong> method:<p class="source-code">public int FilteredCount(Func&lt;T, bool&gt; query)</p><p class="source-code">{</p><p class="source-code">    return Context.Where(query).Count();</p><p class="source-code">}</p></li>
			</ol>
			<p>This code<a id="_idIndexMarker1310"/> returns the items<a id="_idIndexMarker1311"/> in our filtered list.</p>
			<ol>
				<li value="12">Add the <strong class="source-inline">FirstOrDefault</strong> method:<p class="source-code">public T FirstOrDefault(Func&lt;T, bool&gt; query)</p><p class="source-code">{</p><p class="source-code">    return Context.Where(query).FirstOrDefault();</p><p class="source-code">}</p></li>
			</ol>
			<p>This method returns the first record to match our query. If there is no match, then the default value is returned instead.</p>
			<ol>
				<li value="13">Add the <strong class="source-inline">GetAll</strong> method:<p class="source-code">public List&lt;T&gt; GetAll()</p><p class="source-code">{</p><p class="source-code">return Context.ToList();</p><p class="source-code">}</p></li>
			</ol>
			<p>The method returns all the items in our list.</p>
			<ol>
				<li value="14">Add the <strong class="source-inline">GetById</strong> method:<p class="source-code">public T GetById(int id)</p><p class="source-code">{</p><p class="source-code">return Context.Where(t =&gt; t.Id == id)</p><p class="source-code">    .FirstOrDefault();</p><p class="source-code">}</p></li>
			</ol>
			<p>This method gets<a id="_idIndexMarker1312"/> an item from the list, as identified<a id="_idIndexMarker1313"/> by its ID number.</p>
			<ol>
				<li value="15">Add the <strong class="source-inline">Remove</strong> method:<p class="source-code">public void Remove(T entity)</p><p class="source-code">{</p><p class="source-code">Context.Remove(entity);</p><p class="source-code">}</p></li>
			</ol>
			<p>This method removes an entity from the collection.</p>
			<ol>
				<li value="16">Add the <strong class="source-inline">Update</strong> method:<p class="source-code">public void Update(T entity)</p><p class="source-code">{</p><p class="source-code">T item = Context.FirstOrDefault(t =&gt; t.Id == </p><p class="source-code">    entity.Id);</p><p class="source-code">int index = Context.ToList().IndexOf(item);</p><p class="source-code">if (index != -1)</p><p class="source-code">    Context.ToList()[index] = entity;</p><p class="source-code">}</p></li>
			</ol>
			<p>This method updates an entity in the collection.</p>
			<ol>
				<li value="17">Add a new class to the <strong class="source-inline">Data</strong> folder and call it <strong class="source-inline">PeopleRepository</strong>. Then, update the class definition as follows:<p class="source-code">internal class PeopleRepository : BaseRepository</p><p class="source-code">    &lt;Person&gt;</p><p class="source-code">{</p><p class="source-code">public PeopleRepository(ICollection&lt;Person&gt; context) : </p><p class="source-code">    base(context)</p><p class="source-code">{</p><p class="source-code">}</p><p class="source-code">}</p></li>
			</ol>
			<p>This class creates a new repository of type <strong class="source-inline">Person</strong>.</p>
			<ol>
				<li value="18">Add a new<a id="_idIndexMarker1314"/> folder with a class called <strong class="source-inline">Person</strong>. Then, update<a id="_idIndexMarker1315"/> the class as follows:<p class="source-code">public class Person : BaseEntity</p><p class="source-code">{</p><p class="source-code">     public string FirstName { get; set; }</p><p class="source-code">                 public string LastName { get; set; }</p><p class="source-code">        }</p></li>
			</ol>
			<p>This class inherits our <strong class="source-inline">BaseEntity</strong> class and adds the properties <strong class="source-inline">FirstName</strong> and <strong class="source-inline">LastName</strong>.</p>
			<ol>
				<li value="19">Add a new folder called <strong class="source-inline">ViewModels</strong> and a new class called <strong class="source-inline">ViewModelBase</strong>. Update the class definition as shown:<p class="source-code">public class ViewModelBase&lt;T&gt; : PropertyChangeNotifier</p><p class="source-code">{</p><p class="source-code">bool _isRefreshing;</p><p class="source-code">public ObservableCollection&lt;T&gt; Entities { get; private </p><p class="source-code">   set; } = new ObservableCollection&lt;T&gt;();</p><p class="source-code">public bool IsRefreshing</p><p class="source-code">{</p><p class="source-code">         get { return _isRefreshing; }</p><p class="source-code">         set</p><p class="source-code">                  {</p><p class="source-code">                        _isRefreshing = value;</p><p class="source-code">                        OnPropertyChanged();</p><p class="source-code">                    }</p><p class="source-code">            }</p><p class="source-code">}</p></li>
			</ol>
			<p>This class is the base<a id="_idIndexMarker1316"/> view model class for all our view<a id="_idIndexMarker1317"/> models. It can be cast to any type, and it implements <strong class="source-inline">PropertyChangeNotifer</strong>.</p>
			<ol>
				<li value="20">Add <strong class="source-inline">PeopleViewModel</strong>:<p class="source-code">    public class PeopleViewModel : </p><p class="source-code">        ViewModelBase&lt;Person&gt;</p><p class="source-code">    {</p><p class="source-code">        public PeopleViewModel()</p><p class="source-code">        {</p><p class="source-code">            SeedPeopleRepository();</p><p class="source-code">        }</p><p class="source-code"> </p><p class="source-code">        private void SeedPeopleRepository()</p><p class="source-code">        {</p><p class="source-code">            Entities.Add(new Person { Id = 1, </p><p class="source-code">            FirstName = “Person”, LastName = “One”, </p><p class="source-code">            CreatedDate = DateTime.Now, ModifiedDate = </p><p class="source-code">            DateTime.Now });</p><p class="source-code">            Entities.Add(new Person { Id = 2, </p><p class="source-code">            FirstName = “Person”, LastName = “Two”, </p><p class="source-code">            CreatedDate = DateTime.Now, ModifiedDate = </p><p class="source-code">            DateTime.Now });</p><p class="source-code">            Entities.Add(new Person { Id = 3, </p><p class="source-code">            FirstName = “Person”, LastName = “Three”, </p><p class="source-code">            CreatedDate = DateTime.Now, ModifiedDate = </p><p class="source-code">            DateTime.Now });</p><p class="source-code">            Entities.Add(new Person { Id = 4, </p><p class="source-code">            FirstName = “Person”, LastName = “Four”, </p><p class="source-code">            CreatedDate = DateTime.Now, ModifiedDate = </p><p class="source-code">            DateTime.Now });</p><p class="source-code">            Entities.Add(new Person { Id = 5, </p><p class="source-code">            FirstName = “Person”, LastName = “Five”, </p><p class="source-code">            CreatedDate = DateTime.Now, ModifiedDate = </p><p class="source-code">            DateTime.Now });</p><p class="source-code">            Entities.Add(new Person { Id = 6, </p><p class="source-code">            FirstName = “Person”, LastName = “Six”, </p><p class="source-code">            CreatedDate = DateTime.Now, ModifiedDate = </p><p class="source-code">            DateTime.Now });</p><p class="source-code">            Entities.Add(new Person { Id = 7, </p><p class="source-code">            FirstName = “Person”, LastName = “Seven”, </p><p class="source-code">            CreatedDate = DateTime.Now, ModifiedDate = </p><p class="source-code">            DateTime.Now });</p><p class="source-code">            Entities.Add(new Person { Id = 8, </p><p class="source-code">            FirstName = “Person”, LastName = “Eight”, </p><p class="source-code">            CreatedDate = DateTime.Now, ModifiedDate = </p><p class="source-code">            DateTime.Now });</p><p class="source-code">            Entities.Add(new Person { Id = 9, </p><p class="source-code">            FirstName = “Person”, LastName = “Nine”, </p><p class="source-code">            CreatedDate = DateTime.Now, ModifiedDate = </p><p class="source-code">            DateTime.Now });</p><p class="source-code">            Entities.Add(new Person { Id = 10, </p><p class="source-code">            FirstName = “Person”, LastName = “Ten”, </p><p class="source-code">            CreatedDate = DateTime.Now, ModifiedDate = </p><p class="source-code">            DateTime.Now });</p><p class="source-code">            Entities.Add(new Person { Id = 11, </p><p class="source-code">            FirstName = “Person”, LastName = “Eleven”, </p><p class="source-code">            CreatedDate = DateTime.Now, ModifiedDate = </p><p class="source-code">            DateTime.Now });</p><p class="source-code">            Entities.Add(new Person { Id = 12, </p><p class="source-code">            FirstName = “Person”, LastName = “Twelve”, </p><p class="source-code">            CreatedDate = DateTime.Now, ModifiedDate = </p><p class="source-code">            DateTime.Now });</p><p class="source-code">            Entities.Add(new Person { Id = 13, </p><p class="source-code">            FirstName = “Person”, LastName = </p><p class="source-code">            “Thirteen”, CreatedDate = DateTime.Now, </p><p class="source-code">            ModifiedDate = DateTime.Now });</p><p class="source-code">            Entities.Add(new Person { Id = 14, </p><p class="source-code">            FirstName = “Person”, LastName = </p><p class="source-code">            “Fourteen”, CreatedDate = DateTime.Now, </p><p class="source-code">            ModifiedDate = DateTime.Now });</p><p class="source-code">            Entities.Add(new Person { Id = 15, </p><p class="source-code">            FirstName = “Person”, LastName = </p><p class="source-code">            “Fifteen”, CreatedDate = DateTime.Now, </p><p class="source-code">            ModifiedDate = DateTime.Now });</p><p class="source-code">            Entities.Add(new Person { Id = 16, </p><p class="source-code">            FirstName = “Person”, LastName = </p><p class="source-code">            “Sixteen”, CreatedDate = DateTime.Now, </p><p class="source-code">            ModifiedDate = DateTime.Now });</p><p class="source-code">            Entities.Add(new Person { Id = 17, </p><p class="source-code">            FirstName = “Person”, LastName = </p><p class="source-code">            “Seventeen”, CreatedDate = DateTime.Now, </p><p class="source-code">            ModifiedDate = DateTime.Now });</p><p class="source-code">            Entities.Add(new Person { Id = 18, </p><p class="source-code">            FirstName = “Person”, LastName = </p><p class="source-code">            “Eighteen”, CreatedDate = DateTime.Now, </p><p class="source-code">            ModifiedDate = DateTime.Now });</p><p class="source-code">            Entities.Add(new Person { Id = 19, </p><p class="source-code">            FirstName = “Person”, LastName = </p><p class="source-code">            “Ninetenn”, CreatedDate = DateTime.Now, </p><p class="source-code">            ModifiedDate = DateTime.Now });</p><p class="source-code">            Entities.Add(new Person { Id = 20, </p><p class="source-code">            FirstName = “Person”, LastName = “Twenty”, </p><p class="source-code">            CreatedDate = DateTime.Now, ModifiedDate = </p><p class="source-code">            DateTime.Now });</p><p class="source-code">        }</p><p class="source-code">    }</p></li>
			</ol>
			<p>This code seeds our collection with people.</p>
			<ol>
				<li value="21">Add a new page<a id="_idIndexMarker1318"/> to the root of the<a id="_idIndexMarker1319"/> project called <strong class="source-inline">SplashPage</strong>:<p class="source-code">public partial class SplashPage : ContentPage, </p><p class="source-code">    INotifyPropertyChanged</p><p class="source-code">{</p><p class="source-code">    Timer _timer;</p><p class="source-code">    double _progress;</p><p class="source-code">    public event PropertyChangedEventHandler </p><p class="source-code">        PropertyChanged;</p><p class="source-code">    public SplashPage()</p><p class="source-code">    {</p><p class="source-code">        InitializeComponent();</p><p class="source-code">        _timer = new Timer(new TimerCallback((s) =&gt; </p><p class="source-code">            ReportProgress()), null, TimeSpan.Zero, </p><p class="source-code">                TimeSpan.FromSeconds(3));</p><p class="source-code">    }</p><p class="source-code">    ~SplashPage() =&gt; _timer.Dispose();</p><p class="source-code">}</p></li>
			</ol>
			<p>Our <strong class="source-inline">SplashPage</strong> is a loading page that will display progress to the user in the form of a progress<a id="_idIndexMarker1320"/> bar and label. The class<a id="_idIndexMarker1321"/> inherits from the <strong class="source-inline">Content</strong> page and implements the <strong class="source-inline">INotifyPropertyChanged</strong> event. We have a timer whose callback is a method for reporting loading progress.</p>
			<ol>
				<li value="22">Add the <strong class="source-inline">ReportProgress</strong> method:<p class="source-code">    private void ReportProgress()</p><p class="source-code">    {</p><p class="source-code">        _timer.Dispose();</p><p class="source-code"> </p><p class="source-code">        Task.Run(() =&gt;</p><p class="source-code">        {</p><p class="source-code">            // Run code here</p><p class="source-code"> </p><p class="source-code">            for (int i = 0; i &lt;= 100; i++)</p><p class="source-code">            {</p><p class="source-code">                Thread.Sleep(250);</p><p class="source-code">                _progress = (double)i / 100;</p><p class="source-code">                SafeInvokeInMainThread</p><p class="source-code">                    (UpdateProgress);</p><p class="source-code">            }</p><p class="source-code">            SafeInvokeInMainThread(LoadMainPage);</p><p class="source-code">        });</p><p class="source-code">    }</p></li>
			</ol>
			<p>This method stops the timer and runs the code to update the application loading progress status. It uses a safe<a id="_idIndexMarker1322"/> invoke method that will update<a id="_idIndexMarker1323"/> the splash screen.</p>
			<ol>
				<li value="23">Add the <strong class="source-inline">LoadMainPage</strong> method:<p class="source-code">private void LoadMainPage()</p><p class="source-code">{</p><p class="source-code">Application.Current.MainPage = new AppShell(new </p><p class="source-code">    BaseEntity() { Id = 1, CreatedDate = DateTime.Now, </p><p class="source-code">        ModifiedDate = DateTime.Now });</p><p class="source-code">Shell.Current.GoToAsync(“//main”);</p><p class="source-code">}</p></li>
			</ol>
			<p>This method sets the application’s <strong class="source-inline">MainPage</strong> to <strong class="source-inline">AppShell</strong> and passes in a parameter of type <strong class="source-inline">BaseEntity</strong>.</p>
			<ol>
				<li value="24">Add the <strong class="source-inline">SaveInvokeInMaInThread</strong> method:<p class="source-code">private void SafeInvokeInMainThread(Action action)</p><p class="source-code">{</p><p class="source-code">        if (DeviceInfo.Platform == </p><p class="source-code">            DevicePlatform.WinUI)</p><p class="source-code">        {</p><p class="source-code">            Application.Current.Dispatcher</p><p class="source-code">                .Dispatch(action);</p><p class="source-code">        }</p><p class="source-code">        else</p><p class="source-code">        {</p><p class="source-code">            MainThread.BeginInvokeOnMainThread</p><p class="source-code">                (action);</p><p class="source-code">        }</p><p class="source-code">}</p></li>
			</ol>
			<p>This code performs a safe invocation<a id="_idIndexMarker1324"/> on the main thread to update<a id="_idIndexMarker1325"/> the UI. The method checks the device the application is running on before calling the correct method for the device.</p>
			<ol>
				<li value="25">Add the <strong class="source-inline">UpdateProgress</strong> method:<p class="source-code">private void UpdateProgress()</p><p class="source-code">    {</p><p class="source-code">        LoadingProgressBar.ProgressTo(_progress, 500, </p><p class="source-code">            Easing.Linear);</p><p class="source-code">        LoadingProgressLabel.Text = $”Progress Update:</p><p class="source-code">             Performing load operation {(int)</p><p class="source-code">                 (_progress * 100)} of 100...”;</p><p class="source-code">}</p></li>
			</ol>
			<p>This method updates the progress bar and the label.</p>
			<ol>
				<li value="26">Update the <strong class="source-inline">SplashPage</strong> XAML, as shown here:<p class="source-code">&lt;?xml version=”1.0” encoding=”utf-8” ?&gt;</p><p class="source-code">&lt;ContentPage xmlns=”</p><p class="source-code">      http://schemas.microsoft.com/dotnet/2021/maui”</p><p class="source-code">      xmlns:x=”http://schemas.microsoft.com/winfx/</p><p class="source-code">          2009/xaml”</p><p class="source-code">      x:Class=”CH12_ResponsiveMAUI.SplashPage”</p><p class="source-code">      Title=”SplashPage”&gt;</p><p class="source-code">    &lt;VerticalStackLayout VerticalOptions=”Center”&gt;</p><p class="source-code">        &lt;StackLayout HorizontalOptions=”Center” </p><p class="source-code">            VerticalOptions=”Center”&gt;</p><p class="source-code">            &lt;Label FontSize=”32” Text=”Responsive </p><p class="source-code">                MAUI Example” /&gt;</p><p class="source-code">            &lt;Label x:Name=”LoadingProgressLabel” </p><p class="source-code">                FontSize=”12” Text=”Loading...” /&gt;</p><p class="source-code">            &lt;ProgressBar x:Name=”LoadingProgressBar” </p><p class="source-code">                Progress=”0” /&gt;</p><p class="source-code">        &lt;/StackLayout&gt;</p><p class="source-code">    &lt;/VerticalStackLayout&gt;</p><p class="source-code">&lt;/ContentPage&gt;</p></li>
			</ol>
			<p>This markup contains<a id="_idIndexMarker1326"/> our UI definition that will be updated<a id="_idIndexMarker1327"/> by the code when it runs.</p>
			<ol>
				<li value="27">Update <strong class="source-inline">MainPage</strong> by replacing the current XAML with the following XAML:<p class="source-code">&lt;?xml version=”1.0” encoding=”utf-8” ?&gt;</p><p class="source-code">&lt;ContentPage xmlns=</p><p class="source-code">    “http://schemas.microsoft.com/dotnet/2021/maui”</p><p class="source-code">    xmlns:x=”http://schemas.microsoft.com/winfx/</p><p class="source-code">        2009/xaml”</p><p class="source-code">    x:Class=”CH12_ResponsiveMAUI.MainPage”&gt;</p><p class="source-code"> </p><p class="source-code">  &lt;ScrollView&gt;</p><p class="source-code">      &lt;HorizontalStackLayout</p><p class="source-code">          Spacing=”25”</p><p class="source-code">          Padding=”30,0”</p><p class="source-code">          VerticalOptions=”Center”&gt;</p><p class="source-code"> </p><p class="source-code">          &lt;StackLayout Margin=”20” </p><p class="source-code">              HorizontalOptions=”Start”&gt;</p><p class="source-code">              &lt;CollectionView x:Name=</p><p class="source-code">              “collectionView” ItemsSource=”{Binding </p><p class="source-code">                Entities}”&gt;</p><p class="source-code">                  &lt;CollectionView.ItemTemplate&gt;</p><p class="source-code">                      &lt;DataTemplate&gt;</p><p class="source-code">                          &lt;Grid Padding=”10”&gt;</p><p class="source-code">                              &lt;Grid.RowDefinitions&gt;</p><p class="source-code">                                  &lt;RowDefinition </p><p class="source-code">                                  Height=”Auto” /&gt;</p><p class="source-code">                              &lt;/Grid.RowDefinitions&gt;</p><p class="source-code">                              &lt;Grid.ColumnDefinitions&gt;</p><p class="source-code">                                  &lt;ColumnDefinition </p><p class="source-code">                                   Width=”Auto” /&gt;</p><p class="source-code">                                    &lt;ColumnDefinition </p><p class="source-code">                                     Width=”Auto” /&gt;</p><p class="source-code">                                    &lt;ColumnDefinition </p><p class="source-code">                                     Width=”Auto” /&gt;</p><p class="source-code">                                    &lt;ColumnDefinition </p><p class="source-code">                                     Width=”Auto” /&gt;</p><p class="source-code">                                    &lt;ColumnDefinition </p><p class="source-code">                                     Width=”Auto” /&gt;</p><p class="source-code">                             &lt;/Grid.ColumnDefinitions&gt;</p><p class="source-code">                             &lt;Label Grid.Column=”1” </p><p class="source-code">                             Text=”{Binding Id}” </p><p class="source-code">                             FontAttributes=”Bold” /&gt;</p><p class="source-code">                             &lt;Label Grid.Column=”2” </p><p class="source-code">                             Text=”{Binding </p><p class="source-code">                             FirstName}” </p><p class="source-code">                             FontAttributes=”Bold” /&gt;</p><p class="source-code">                             &lt;Label Grid.Column=”3” </p><p class="source-code">                             Text=”{Binding LastName}” </p><p class="source-code">                             FontAttributes=”Bold” /&gt;</p><p class="source-code">                             &lt;Label Grid.Column=”4” </p><p class="source-code">                             Text=”{Binding </p><p class="source-code">                             CreatedDate}” </p><p class="source-code">                             FontAttributes=”Bold” /&gt;</p><p class="source-code">                             &lt;Label Grid.Column=”5” </p><p class="source-code">                             Text=”{Binding </p><p class="source-code">                             ModifiedDate}” </p><p class="source-code">                             FontAttributes=”Bold” /&gt;</p><p class="source-code">                            &lt;/Grid&gt;</p><p class="source-code">                        &lt;/DataTemplate&gt;</p><p class="source-code">                    &lt;/CollectionView.ItemTemplate&gt;</p><p class="source-code">                &lt;/CollectionView&gt;</p><p class="source-code">            &lt;/StackLayout&gt;</p><p class="source-code"> </p><p class="source-code">            &lt;StackLayout HorizontalOptions=”End”&gt;</p><p class="source-code">                &lt;Image</p><p class="source-code">                Source=”dotnet_bot.png”</p><p class="source-code">                SemanticProperties.Description=”Cute </p><p class="source-code">                    dot net bot waving hi to you!”</p><p class="source-code">                HeightRequest=”200”</p><p class="source-code">                HorizontalOptions=”Center” /&gt;</p><p class="source-code"> </p><p class="source-code">                &lt;Label</p><p class="source-code">                Text=”Hello, World!”</p><p class="source-code">                SemanticProperties.HeadingLevel=</p><p class="source-code">                    “Level1”</p><p class="source-code">                FontSize=”32”</p><p class="source-code">                HorizontalOptions=”Center” /&gt;</p><p class="source-code"> </p><p class="source-code">                &lt;Label</p><p class="source-code">                Text=”Welcome to .NET Multi-platform </p><p class="source-code">                    App UI”</p><p class="source-code">                SemanticProperties.HeadingLevel=</p><p class="source-code">                    “Level2”</p><p class="source-code">                SemanticProperties.Description=</p><p class="source-code">                   “Welcome to dot net Multi platform </p><p class="source-code">                       App U I”</p><p class="source-code">                FontSize=”18”</p><p class="source-code">                HorizontalOptions=”Center” /&gt;</p><p class="source-code"> </p><p class="source-code">                &lt;Button</p><p class="source-code">                x:Name=”CounterBtn”</p><p class="source-code">                Text=”Click me”</p><p class="source-code">                SemanticProperties.Hint=”Counts the </p><p class="source-code">                    number of times you click”</p><p class="source-code">                Clicked=”OnCounterClicked”</p><p class="source-code">                HorizontalOptions=”Center” /&gt;</p><p class="source-code">            &lt;/StackLayout&gt;</p><p class="source-code"> </p><p class="source-code">        &lt;/HorizontalStackLayout&gt;</p><p class="source-code">    &lt;/ScrollView&gt;</p><p class="source-code"> </p><p class="source-code">&lt;/ContentPage&gt;</p></li>
			</ol>
			<p>This code updates<a id="_idIndexMarker1328"/> the original source<a id="_idIndexMarker1329"/> by adding a table of people.</p>
			<ol>
				<li value="28">Add a <strong class="source-inline">PeopleRepository</strong> class variable and update the constructor of the <strong class="source-inline">MainPage</strong> class, as shown here:<p class="source-code">    PeopleRepository _peopleRepository;</p><p class="source-code"> </p><p class="source-code">    public MainPage()</p><p class="source-code">    {</p><p class="source-code">        InitializeComponent();</p><p class="source-code">        BindingContext = new PeopleViewModel();</p><p class="source-code">}</p></li>
			</ol>
			<p>This code modifies our <strong class="source-inline">MainPage</strong> by setting its <strong class="source-inline">BindingContext</strong> to <strong class="source-inline">PeopleViewModel</strong>.</p>
			<ol>
				<li value="29">Run the <a id="_idIndexMarker1330"/>code, and you should see the following<a id="_idIndexMarker1331"/> screen:</li>
			</ol>
			<div>
				<div id="_idContainer173" class="IMG---Figure">
					<img src="image/Figure_12.10_B16617.jpg" alt="Figure 12.10 – The splash page&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.10 – The splash page</p>
			<p>The following screen is what you’ll see next:</p>
			<div>
				<div id="_idContainer174" class="IMG---Figure">
					<img src="image/Figure_12.11_B16617.jpg" alt="Figure 12.11 – The main form with a table in a scroll view with a button that responds to clicks&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.11 – The main form with a table in a scroll view with a button that responds to clicks</p>
			<p>We have managed<a id="_idIndexMarker1332"/> to build a responsive splash screen that also populates<a id="_idIndexMarker1333"/> a table and responds to button clicks. That concludes our look at MAUI. We will now move on to WinUI 3.</p>
			<h1 id="_idParaDest-230"><a id="_idTextAnchor235"/>Building a responsive UI with WinUI 3</h1>
			<p>In this section, we will look<a id="_idIndexMarker1334"/> at how to provide user feedback<a id="_idIndexMarker1335"/> using the <strong class="source-inline">ProgressRing</strong> component while performing a long-running operation in WinUI 3 applications. When your users trigger a long-running operation that holds up the UI, it is a good idea to provide user feedback until the operation completes. Let’s write a simple application that simulates a long-running operation using the following steps:</p>
			<ol>
				<li value="1">Start a new WinUI3 application and call it <strong class="source-inline">CH12_ResponsiveWinUI3</strong>.</li>
				<li>Open <strong class="source-inline">MainWindow.xaml</strong> and replace the existing XAML between the Window tags with the following XAML:<p class="source-code">&lt;StackPanel VerticalAlignment=”Center” </p><p class="source-code">    HorizontalAlignment=”Center”&gt;</p><p class="source-code">    &lt;ProgressRing x:Name=”ProgressRingIndicator1” </p><p class="source-code">        IsActive=”{x:Bind IsWorking, Mode=OneWay}” </p><p class="source-code">          Visibility=”{x:Bind IsWorking, Mode=OneWay}” </p><p class="source-code">             /&gt;</p><p class="source-code">    &lt;Button x:Name=”DoWorkButton” Content=”Do Work” </p><p class="source-code">       Click=”DoWorkButton_Click” /&gt;</p><p class="source-code">    &lt;TextBlock x:Name=”MessageTextBlock” /&gt;</p><p class="source-code">&lt;/StackPanel&gt;</p></li>
			</ol>
			<p>We have used <strong class="source-inline">OneWay</strong> binding to bind our the <strong class="source-inline">ProgressRing</strong> class' <strong class="source-inline">IsActive</strong> and <strong class="source-inline">Visibility</strong> properties to the <strong class="source-inline">IsWorking</strong> property.</p>
			<ol>
				<li value="3">In the code<a id="_idIndexMarker1336"/> behind the class, implement<a id="_idIndexMarker1337"/> the <strong class="source-inline">INotifyPropertyChanged</strong> interface.</li>
				<li>Add the following members to the class:<p class="source-code">private DispatcherTimer _dispatcherTimer;</p><p class="source-code">public event PropertyChangedEventHandler </p><p class="source-code">    PropertyChanged;</p><p class="source-code">private bool _isWorking;</p></li>
			</ol>
			<p><strong class="source-inline">_dispatcherTimer</strong> will be used to simulate a long-running operation. The <strong class="source-inline">PropertyChanged</strong> event will be used to notify <strong class="source-inline">ProgressRing</strong> that the <strong class="source-inline">IsWorking</strong> property has changed, and the <strong class="source-inline">_isWorking</strong> variable will be updated to let <strong class="source-inline">ProgressRing</strong> know to either show or hide itself.</p>
			<ol>
				<li value="5">Add a method to raise the <strong class="source-inline">PropertyChanged</strong> event if it is not <strong class="source-inline">null</strong>:<p class="source-code">private void NotifyPropertyChanged(string property)</p><p class="source-code">{</p><p class="source-code">if (PropertyChanged != null)</p><p class="source-code">{</p><p class="source-code">PropertyChanged(this, </p><p class="source-code">    new PropertyChangedEventArgs(property));</p><p class="source-code">}</p><p class="source-code">}</p></li>
			</ol>
			<p>When we set the <strong class="source-inline">IsWorking</strong> property, we call this method so that the <strong class="source-inline">PropertyChanged</strong> event is raised.</p>
			<ol>
				<li value="6">Add the following three lines to the constructor:<p class="source-code">_dispatcherTimer = new DispatcherTimer();</p><p class="source-code">_dispatcherTimer.Interval = TimeSpan.FromSeconds(10);</p><p class="source-code">_dispatcherTimer.Tick += DispatcherTimer_Tick;</p></li>
			</ol>
			<p>These three lines<a id="_idIndexMarker1338"/> instantiate our <strong class="source-inline">DispatcherTimer</strong>, set its interval<a id="_idIndexMarker1339"/> to <strong class="source-inline">10</strong> seconds, and add the <strong class="source-inline">Tick</strong> event handler.</p>
			<ol>
				<li value="7">We will now add the <strong class="source-inline">DispatcherTimer_Tick</strong> event handler:<p class="source-code">private void DispatcherTimer_Tick(object sender, </p><p class="source-code">    object e)</p><p class="source-code">{</p><p class="source-code">_dispatcherTimer.Stop();</p><p class="source-code">_dispatcherTimer.Tick -= DispatcherTimer_Tick;</p><p class="source-code">IsWorking = false;</p><p class="source-code">MessageTextBlock.Text = “Work completed.”;</p><p class="source-code">}</p></li>
			</ol>
			<p>We stop the timer and remove the event handler to stop it from firing again and being held in memory. Then, we set the <strong class="source-inline">IsWorking</strong> property to <strong class="source-inline">false</strong>, which results in <strong class="source-inline">ProgressRing</strong> being hidden and made inactive. Then, we add a message to <strong class="source-inline">MessageTextBlock</strong>.</p>
			<ol>
				<li value="8">Now, add the <strong class="source-inline">IsWorking</strong> property:<p class="source-code">public bool IsWorking</p><p class="source-code">{</p><p class="source-code">get { return _isWorking; }</p><p class="source-code">set</p><p class="source-code">     {</p><p class="source-code">             _isWorking = value;</p><p class="source-code">           NotifyPropertyChanged(“IsWorking”);</p><p class="source-code">}</p><p class="source-code">}</p></li>
				<li>When setting<a id="_idIndexMarker1340"/> our property, we call the <strong class="source-inline">NotifyPropertyChanged</strong> method<a id="_idIndexMarker1341"/> that raises the <strong class="source-inline">PropertyChanged</strong> event to let <strong class="source-inline">ProgressRing</strong> know that the property has changed.</li>
				<li>Now, add the code for the button click:<p class="source-code">private void DoWorkButton_Click(object sender, </p><p class="source-code">    RoutedEventArgs e)</p><p class="source-code">{</p><p class="source-code">DoWorkButton.Visibility = Visibility.Collapsed;</p><p class="source-code">IsWorking = true;</p><p class="source-code">_dispatcherTimer.Start();</p><p class="source-code">}</p></li>
			</ol>
			<p>We collapse our button, as it is no longer needed. Set the <strong class="source-inline">IsWorking</strong> property to <strong class="source-inline">true</strong>, and start our <strong class="source-inline">DispatcherTimer</strong>.</p>
			<ol>
				<li value="11">Run the code. You should see a single button that says <strong class="bold">Do Work</strong>. Click on the button. The button should disappear and be replaced by <strong class="source-inline">ProgressRing</strong> for 10 seconds. Then, <strong class="source-inline">ProgressRing</strong> should disappear and be replaced with the text <strong class="bold">Work completed</strong>.</li>
			</ol>
			<p>Now that we have<a id="_idIndexMarker1342"/> concluded our look at responsive UIs, let’s summarize<a id="_idIndexMarker1343"/> what we have learned.</p>
			<h1 id="_idParaDest-231"><a id="_idTextAnchor236"/>Summary</h1>
			<p>In this chapter, you learned how to work with various UI frameworks to make UIs responsive. First, we looked at WinForms. With WinForms, we enabled DPI and long file path awareness. We also ensured that despite running long background tasks, we could page through data in a table and perform other UI operations, and we also added a splash screen that updates with the loading progress.</p>
			<p>With WPF, we managed to produce a window that has a long-running task that can be canceled with progress indication. It also has a paged data table and button that, when clicked, updates the click count label.</p>
			<p>Then, we looked at memory caching and distributed caching in ASP.NET. We also used AJAX to update part of the currently displayed page and looked at WebSockets and SignalR. We implemented a real-time ASP.NET chat application using SignalR.</p>
			<p>We then went on to look at MAUI. In particular, we looked at layouts, accessibility, and <strong class="source-inline">BlazorWebView</strong>. Finally, we looked at WinUI 3 and how to provide user feedback when a long-running process is taking place.</p>
			<p>In the next chapter, we will be looking at distributed systems. But first, try answering the questions in the next section, and then do some further reading to enhance your knowledge of responsive UIs.</p>
			<h1 id="_idParaDest-232"><a id="_idTextAnchor237"/>Questions</h1>
			<ol>
				<li value="1">How can you make a WinForms application scale properly on high-DPI screens or normal-DPI large screens?</li>
				<li>How do you cope with long file paths on Windows?</li>
				<li>How can you keep users engaged when your application takes a long time to start?</li>
				<li>How can you keep an application responsive to user input when you have a long-running process in operation?</li>
				<li>What caching methods can you use to speed up access to resources?</li>
				<li>How can you load only part of a web page?</li>
				<li>Name two frameworks for performing network data transfer and real-time networked communication?</li>
				<li>Name three accessibility methods available in MAUI.</li>
				<li>How do you include an existing Blazor web application in an MAUI project?</li>
				<li>When your application is already loaded, and a user kicks off a long-running operation, what controls can you use to provide user feedback so that users don’t think your WinUI 3 application has crashed?</li>
			</ol>
			<h1 id="_idParaDest-233"><a id="_idTextAnchor238"/>Further reading</h1>
			<ul>
				<li><em class="italic">Which is best? WebSockets or SignalR</em>: <a href="https://dotnetplaybook.com/which-is-best-websockets-or-signalr/ ">https://dotnetplaybook.com/which-is-best-websockets-or-signalr/</a></li>
				<li><em class="italic">Why is SignalR/messagepack 2 times faster than gRPC/protobuf?</em>: <a href="https://github.com/grpc/grpc-dotnet/issues/812 ">https://github.com/grpc/grpc-dotnet/issues/812</a></li>
				<li><em class="italic">Tutorial: Get started with ASP.NET Core SignalR</em>: <a href="https://docs.microsoft.com/aspnet/core/tutorials/signalr?view=aspnetcore-5.0&amp;tabs=visual-studio ">https://docs.microsoft.com/aspnet/core/tutorials/signalr?view=aspnetcore-5.0&amp;tabs=visual-studio</a></li>
				<li><em class="italic">WebSocket</em>: <a href="https://javascript.info/websocket">https://javascript.info/websocket</a></li>
				<li><em class="italic">Migrate your app from Xamarin.Forms</em>: https://docs.microsoft.com/dotnet/maui/get-started/migrate</li>
				<li><em class="italic">Xamarin.Forms Made Easy</em>: <a href="https://winstongubantes.blogspot.com/2018/09/backgrounding-with-xamarinforms-easy-way.html">https://winstongubantes.blogspot.com/2018/09/backgrounding-with-xamarinforms-easy-way.html</a></li>
				<li><em class="italic">Xamarin – Working with threads</em>: <a href="https://lukealderton.com/blog/posts/2016/october/xamarin-forms-working-with-threads/ ">https://lukealderton.com/blog/posts/2016/october/xamarin-forms-working-with-threads/</a></li>
				<li>Creating Android emulators on Windows: <a href="https://docs.microsoft.com/xamarin/android/get-started/installation/android-emulator/device-manager?tabs=windows&amp;pivots=windows">https://docs.microsoft.com/xamarin/android/get-started/installation/android-emulator/device-manager?tabs=windows&amp;pivots=windows</a></li>
				<li>Installing the Microsoft OpenJDK: <a href="https://docs.microsoft.com/xamarin/android/get-started/installation/openjdk ">https://docs.microsoft.com/xamarin/android/get-started/installation/openjdk</a></li>
				<li><em class="italic">Single-project MSIX Packaging Tools for VS 2022</em>: https://marketplace.visualstudio.com/items?itemName=ProjectReunion.MicrosoftSingleProjectMSIXPackagingToolsDev17</li>
				<li><em class="italic">Improving rendering performance with Blazor component virtualization</em>: <a href="https://www.daveabrock.com/2020/10/20/blazor-component-virtualization/#:~:text=Improve%20rendering%20performance%20with%20Blazor%20component%20virtualization%20Use,the%20entire%20HTML%20tree%20loads%20from%20the%20server">https://www.daveabrock.com/2020/10/20/blazor-component-virtualization/#:~:text=Improve%20rendering%20performance%20with%20Blazor%20component%20virtualization%20Use,the%20entire%20HTML%20tree%20loads%20from%20the%20server</a>.</li>
				<li><em class="italic">How to Reuse Xamarin.Forms Custom Renderers in .NET MAUI</em>: <a href="https://www.syncfusion.com/blogs/post/how-to-reuse-xamarin-forms-custom-renderers-in-net-maui.aspx">https://www.syncfusion.com/blogs/post/how-to-reuse-xamarin-forms-custom-renderers-in-net-maui.aspx</a></li>
				<li><em class="italic">Announcing .NET MAUI Preview 7</em>: <a href="https://devblogs.microsoft.com/dotnet/announcing-net-maui-preview-7/">https://devblogs.microsoft.com/dotnet/announcing-net-maui-preview-7/</a> </li>
				<li><em class="italic">.NET Multi-platform App UI</em>: <a href="https://dotnet.microsoft.com/en-us/apps/maui">https://dotnet.microsoft.com/en-us/apps/maui</a></li>
			</ul>
		</div>
	</body></html>