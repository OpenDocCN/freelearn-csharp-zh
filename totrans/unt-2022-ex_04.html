<html><head></head><body>
<div id="sbo-rt-content" class="calibre1"><div id="_idContainer036" class="calibre2">
<h1 class="chapter-number" id="_idParaDest-41"><a id="_idTextAnchor041" class="pcalibre1 pcalibre calibre6"/>2</h1>
<h1 id="_idParaDest-42" class="calibre5"><a id="_idTextAnchor042" class="pcalibre1 pcalibre calibre6"/>Creating a 2D Collection Game</h1>
<p class="calibre3">In <a href="B18347_01.xhtml#_idTextAnchor015" class="pcalibre1 pcalibre calibre6"><span><em class="italic">Chapter 1</em></span></a>, you were introduced to the Unity Editor and its common windows and toolbars. We also created our first player character – the ladybug! Sadly, the ladybug is currently sitting in a vast nothingness without any goals providing value for <span>its existence.</span></p>
<p class="calibre3">In this chapter, we’ll start putting the previous knowledge gained to good use by first adding more GameObjects to our Scene and creating a 2D, top-down environment for the <em class="italic">Outer World</em> collection game (our ladybugs will be <span>happy indeed).</span></p>
<p class="calibre3">Creating a 2D top-down environment and designing a level is a trivial task when using the <strong class="bold">Tilemap</strong> feature. It allows you to create a palette of <strong class="bold">Tiles</strong> and then simply draw the level right within the Unity <span>scene View.</span></p>
<p class="calibre3">There is only so much you can do with GameObjects and Unity’s built-in components alone, so you’ll be <a id="_idIndexMarker078" class="pcalibre1 pcalibre calibre6"/>introduced to the <strong class="bold">C#</strong> language. Writing your own scripts in C# allows you to create the functionality your games and <span>experiences require.</span></p>
<p class="calibre3">We’ll discuss how to create scripts and understand the best-practice approach to structuring code, principles, and patterns to follow that will keep your code easy to work with, maintain, and extend. These approaches to writing code will benefit you individually but also in a team environment, working with other professionals, since the structure and practices are widely adopted in <span>the industry.</span></p>
<p class="calibre3">The first C# script we’ll be <a id="_idIndexMarker079" class="pcalibre1 pcalibre calibre6"/>tackling is a <strong class="bold">controller</strong> to solve the problem of our ladybug character not having the ability to move. Throughout the book, we will use a <em class="italic">problem-solving</em> approach to define the process because it frames the coding requirements with an analytical mindset, breaking down a problem into smaller tasks while considering the overall solution. We’ll also be working with player input, so you’ll learn how to <a id="_idIndexMarker080" class="pcalibre1 pcalibre calibre6"/>set up and connect your code to Unity’s new event-based <span><strong class="bold">Input System</strong></span><span>.</span></p>
<p class="calibre3">In this chapter, we’re going to cover the following <span>main topics:</span></p>
<ul class="calibre17">
<li class="calibre15">Creating a 2D, top-down game environment <span>with </span><span><strong class="bold">Tilemap</strong></span></li>
<li class="calibre15">An introduction to creating scripts in C# – IDE, SOLID principles, and <span>design patterns</span></li>
<li class="calibre15">Coding a simple player controller with the new <span>Input System</span></li>
</ul>
<p class="calibre3">By the end of this chapter, you’ll be able to quickly create a 2D, top-down, tile-based game environment, design a level, and understand how to create and edit C# scripts while considering best practice principles and design patterns. Our ladybug character will also be able to explore a cool new environment by responding to <span>player input.</span></p>
<h1 id="_idParaDest-43" class="calibre5"><a id="_idTextAnchor043" class="pcalibre1 pcalibre calibre6"/>Technical requirements</h1>
<p class="calibre3">To follow along <a id="_idIndexMarker081" class="pcalibre1 pcalibre calibre6"/>in this chapter, you’ll need to have <strong class="bold">Visual Studio Community 2022</strong> installed; we will be using this version throughout the chapters and projects in the book. This should have been installed with the Unity Editor in <a href="B18347_01.xhtml#_idTextAnchor015" class="pcalibre1 pcalibre calibre6"><span><em class="italic">Chapter 1</em></span></a><span>.</span></p>
<p class="calibre3">You can download the complete project on GitHub <span>at </span><a href="https://github.com/PacktPublishing/Unity-2022-by-Example" class="pcalibre1 pcalibre calibre6"><span>https://github.com/PacktPublishing/Unity-2022-by-Example</span></a><span>.</span></p>
<h1 id="_idParaDest-44" class="calibre5"><a id="_idTextAnchor044" class="pcalibre1 pcalibre calibre6"/>Creating a 2D, top-down game environment with Tilemap</h1>
<p class="calibre3">The first <a id="_idIndexMarker082" class="pcalibre1 pcalibre calibre6"/>thing we will accomplish to create the collection game environment is some level design. The design of the <a id="_idIndexMarker083" class="pcalibre1 pcalibre calibre6"/>level will affect how the game plays – how fun and how challenging it is. This will not be a comprehensive dive into level design; after all, we’re making a very simple <span>collection game.</span></p>
<p class="calibre3">We’ll be focusing on just one principle of level design right now – guiding the player. Since this is a 2D, top-down view, the easiest way for us to guide the player is by using shapes in the level and introducing hazards. We can only do so much with such a simple game, but the principles can be applied to larger and more <span>complex games.</span></p>
<p class="calibre3">Visualizing design isn’t everyone’s strong suit – we all need creative help and inspiration sometimes. And <a id="_idIndexMarker084" class="pcalibre1 pcalibre calibre6"/>while a <strong class="bold">Game Design Document</strong> (<strong class="bold">GDD</strong>) is good at describing things, it can only convey so much in so many words. As <a id="_idIndexMarker085" class="pcalibre1 pcalibre calibre6"/>they say, a picture <a id="_idIndexMarker086" class="pcalibre1 pcalibre calibre6"/>is worth a thousand words, so have a look at my initial sketch of what I was planning for the collection game’s <span>level design:</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer020">
<img alt="Figure 2.1 – The collection game-level sketch" src="image/B18347_02_01.jpg" class="calibre26"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 2.1 – The collection game-level sketch</p>
<p class="calibre3">If you’re lacking inspiration or just prefer to follow along (no one here will judge you for it), then use my sketch for your own ends. I’ll probably sound like a broken record by the time you’re well into this book, but remember this – if you’re not having fun, you’re doing <span>something wrong.</span></p>
<p class="calibre3">Next, let’s explore some examples of guiding <span>the player.</span></p>
<h2 id="_idParaDest-45" class="calibre8"><a id="_idTextAnchor045" class="pcalibre1 pcalibre calibre6"/>Level design – Guiding the player</h2>
<p class="calibre3">By creating shapes <a id="_idIndexMarker087" class="pcalibre1 pcalibre calibre6"/>in the level (also known as <strong class="bold">leading lines</strong>), we encourage <a id="_idIndexMarker088" class="pcalibre1 pcalibre calibre6"/>the player to move in desirable directions. For example, from the position the player is spawned in, let’s start by giving <a id="_idIndexMarker089" class="pcalibre1 pcalibre calibre6"/>them an open area directly in front <span>of them.</span></p>
<p class="calibre3">The sides of this open area will begin to angle inward as it gets farther from the player in the direction they face. This will create the appearance of an arrow shape. This shape will invite the player subconsciously to move forward in the direction the “arrow” <span>is pointing.</span></p>
<p class="callout-heading">Spawn/respawn/despawn player</p>
<p class="callout"><strong class="bold">Spawning</strong> refers to <a id="_idIndexMarker090" class="pcalibre1 pcalibre calibre6"/>the creation of the player in the game. This typically occurs at the beginning of gameplay when starting the game or when starting <span>a level.</span></p>
<p class="callout">A <strong class="bold">respawn</strong> is when <a id="_idIndexMarker091" class="pcalibre1 pcalibre calibre6"/>the player is spawned after death or some game event that requires the player to restart at a <span>specific position.</span></p>
<p class="callout">When the <a id="_idIndexMarker092" class="pcalibre1 pcalibre calibre6"/>player is <strong class="bold">despawned</strong>, they are removed from the <span>game world.</span></p>
<p class="calibre3">Shapes <a id="_idIndexMarker093" class="pcalibre1 pcalibre calibre6"/>are one of the tools we have in level <a id="_idIndexMarker094" class="pcalibre1 pcalibre calibre6"/>design to guide the player through the environment, while another is hazards. Let’s have a look at using hazards in the <span>next section.</span></p>
<h3 class="calibre10">Hazards</h3>
<p class="calibre3">The level design <a id="_idIndexMarker095" class="pcalibre1 pcalibre calibre6"/>in a video game can influence the player’s movement through visual cues, and one of those cues is hazards. These elements can guide the player toward their next objective and progress gameplay forward while also changing the level’s difficulty by placing hazards in areas that the player must visit to complete the <span>game’s objectives.</span></p>
<p class="callout-heading">Additional reading | 2D level design</p>
<p class="callout">Level Design Patterns in 2D Games by <em class="italic">Ahmed </em><span><em class="italic">Khalifa</em></span><span>: </span><a href="https://www.gamedeveloper.com/design/level-design-patterns-in-2d-games" class="pcalibre1 pcalibre calibre6"><span>https://www.gamedeveloper.com/design/level-design-patterns-in-2d-games</span></a></p>
<p class="calibre3">In this section, you learned that shapes and hazards are simple concepts to guide the player, and they can be used with great effect if done well. It takes practice to make guidance subtle and blended/hidden into an <span>environment design.</span></p>
<p class="calibre3">Let’s start practicing by creating the level for the 2D collection game. In the next section, we’ll be using the <strong class="bold">Tilemap</strong> feature that is a part of Unity’s 2D toolset, and the first step in this workflow is to create a <span><strong class="bold">Tile Palette</strong></span><span>.</span></p>
<h2 id="_idParaDest-46" class="calibre8"><a id="_idTextAnchor046" class="pcalibre1 pcalibre calibre6"/>Creating Tile Palettes</h2>
<p class="calibre3">You may have closed Unity since the last time we worked on the player character in <a href="B18347_01.xhtml#_idTextAnchor015" class="pcalibre1 pcalibre calibre6"><span><em class="italic">Chapter 1</em></span></a>. To return where we left off in the project, open Unity Hub. The default view will list all of the projects you previously created. The list <a id="_idIndexMarker096" class="pcalibre1 pcalibre calibre6"/>also includes <a id="_idIndexMarker097" class="pcalibre1 pcalibre calibre6"/>some additional information about the project, such as the last time it was modified and the Editor version being used for it. You can see an example of this in the <span>following screenshot:</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer021">
<img alt="Figure 2.2 – The Unity Hub Projects list" src="image/B18347_02_02.jpg" class="calibre27"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 2.2 – The Unity Hub Projects list</p>
<p class="callout-heading">Adding and removing projects from Unity Hub</p>
<p class="callout">You can add and remove projects from Unity Hub to keep your project list relevant. Add a project from disk by using the <strong class="bold">Open</strong> button at the top right of the window. Use the horizontal ellipses on the right side of each entry in the list to remove the project. Please note that removing a project from Hub will not delete it from the disk and will have to be cleaned up manually outside <span>of Hub.</span></p>
<p class="calibre3">Open the project you previously created from the <strong class="bold">2D URP Core</strong> template (in the screenshot shown in <span><em class="italic">Figure 2</em></span><em class="italic">.2</em>, it is the <strong class="bold">My Project</strong> project). Do that by simply clicking on the project name in <span>the list.</span></p>
<p class="calibre3">Before actually creating our tilemap, we need sprite images to work with. The following section will address adding sprites to the project that will form the basis of our first tilemap, used to construct the <span>game’s level.</span></p>
<h3 class="calibre10">2D game assets</h3>
<p class="calibre3">To create <a id="_idIndexMarker098" class="pcalibre1 pcalibre calibre6"/>the environment for our level, we’ll be using some freely available game assets. We’ll use original art assets in the upcoming chapters with <a id="_idIndexMarker099" class="pcalibre1 pcalibre calibre6"/>different art pipelines and workflows, so you will gain a more rounded knowledge when dealing with 2D art <span>in Unity.</span></p>
<p class="callout-heading">Free game assets</p>
<p class="callout"><strong class="bold">Kenney</strong> provides readymade <a id="_idIndexMarker100" class="pcalibre1 pcalibre calibre6"/>game assets with no strings attached! Thousands of sprites are available – for many different themes and genres – for you to use in your own projects, with any kind of use allowed, even commercial. You can find all of the Kenney assets listed <span>here: </span><a href="https://kenney.nl/assets" class="pcalibre1 pcalibre calibre6"><span>https://kenney.nl/assets</span></a></p>
<p class="calibre3"><strong class="bold">Kenney</strong> is a <a id="_idIndexMarker101" class="pcalibre1 pcalibre calibre6"/>website that provides many pre-made sprite sheets and tilemap images. The main difference between these two graphics terms can be broken down <span>like this:</span></p>
<ul class="calibre17">
<li class="calibre15">A <strong class="bold">sprite sheet image</strong> is an <a id="_idIndexMarker102" class="pcalibre1 pcalibre calibre6"/>image made up of several smaller images (the left image in <span><em class="italic">Figure 2</em></span><span><em class="italic">.5</em></span><span>)</span></li>
<li class="calibre15">A <strong class="bold">tilemap image</strong> is an <a id="_idIndexMarker103" class="pcalibre1 pcalibre calibre6"/>image made up of several smaller images arranged in a two-dimensional grid (the right image in <span><em class="italic">Figure 2</em></span><span><em class="italic">.5</em></span><span>)</span></li>
</ul>
<p class="callout-heading">Important note</p>
<p class="callout">The terms <em class="italic">sprite sheet</em> and <em class="italic">tilemap</em> are often used interchangeably without much difference in meaning. I’ve attempted to clarify the terms practically and provide examples in the <span>following sections.</span></p>
<p class="calibre3">2D art is generally provided in sprite sheets since a single image is a more optimized way of working with images in a game engine instead of using individual images for each asset. Even if the 2D art is provided in single images, Unity has tooling that combines the individual sprite images into a single image for optimization (in this case, the combined or packed image <a id="_idIndexMarker104" class="pcalibre1 pcalibre calibre6"/>in Unity is referred to as a <strong class="bold">Sprite Atlas</strong>). As mentioned previously, Kenney provides game assets in both sprite sheets and <span>tilemap images.</span></p>
<p class="callout-heading">Optimization note</p>
<p class="callout">Sprite sheets are <em class="italic">more optimized</em> because they reduce the number of draw calls the renderer (graphics card) has to perform. All of the sprites included on the sheet can be drawn simultaneously, treating the entire sprite sheet as a single draw, whereas if they were individual sprites, they would need to be drawn separately. This reduction in draw calls can improve game performance (increasing the <span>frame rate).</span></p>
<p class="calibre3">Now that we <a id="_idIndexMarker105" class="pcalibre1 pcalibre calibre6"/>understand what 2D game asset images are, let’s <a id="_idIndexMarker106" class="pcalibre1 pcalibre calibre6"/>import some assets from Kenney in the next section to understand importing and working with the images <span>in practice.</span></p>
<h3 class="calibre10">Importing sprites</h3>
<p class="calibre3">Importing images into Unity is easy, but let’s first start with defining some organization in our <a id="_idIndexMarker107" class="pcalibre1 pcalibre calibre6"/>project by creating some folders. Perform the following steps to create the <strong class="source-inline">Sprites</strong>, <strong class="source-inline">Tile Palettes</strong>, and <strong class="source-inline">Tile </strong><span><strong class="source-inline">Palettes/Tiles</strong></span><span> folders:</span></p>
<ol class="calibre14">
<li class="calibre15">In the <strong class="bold">Project</strong> window, select the <span><strong class="source-inline">Assets</strong></span><span> folder.</span></li>
<li class="calibre15">Right-click within the <strong class="bold">Project</strong> window to bring up the <strong class="bold">Create</strong> menu (or click on the <strong class="bold">+</strong> button at the top just under the <strong class="bold">Project</strong> tab) and select <strong class="bold">Create</strong> | <span><strong class="bold">Folder</strong></span><span>.</span></li>
<li class="calibre15">Name the folder <strong class="source-inline">Sprites</strong> and <span>hit </span><span><em class="italic">Enter</em></span><span>.</span></li>
<li class="calibre15">Repeat <em class="italic">step 2</em> to create the <strong class="source-inline">Tile </strong><span><strong class="source-inline">Palettes</strong></span><span> folder.</span></li>
<li class="calibre15">Now, after selecting the <strong class="source-inline">Tile Palettes</strong> folder, repeat <em class="italic">step 2</em> to create the <strong class="source-inline">Tiles</strong> folder (this folder is a subfolder of the <strong class="source-inline">Tile </strong><span><strong class="source-inline">Palettes</strong></span><span> folder).</span></li>
</ol>
<p class="calibre3">We’ll be using <a id="_idIndexMarker108" class="pcalibre1 pcalibre calibre6"/>two sprite sheets from Kenney in the collection <a id="_idIndexMarker109" class="pcalibre1 pcalibre calibre6"/>game project to create the game environment – the <strong class="bold">Top-down Tanks Redux</strong> and <strong class="bold">Tower Defense</strong> (<strong class="bold">top-down</strong>) game assets. You can get the sprite sheets by downloading them directly from the <a href="https://kenney.nl/assets" class="pcalibre1 pcalibre calibre6">https://kenney.nl/assets</a> website, or they are also provided in the book’s project files available in the GitHub project (refer to the link in the <em class="italic">Technical </em><span><em class="italic">requirements</em></span><span> section).</span></p>
<p class="calibre3">Once the folders are created and the sprite sheets have downloaded, we are now ready to import <span>sprites. Yay!</span></p>
<p class="calibre3">You can import sprites into Unity by either dragging them from the File Manager (Windows)/Finder (Mac) and dropping them into the Unity <strong class="bold">Project</strong> window or by right-clicking within the <strong class="bold">Project</strong> window and selecting <strong class="bold">Import </strong><span><strong class="bold">New Asset…</strong></span><span>.</span></p>
<p class="calibre3">First, we will <a id="_idIndexMarker110" class="pcalibre1 pcalibre calibre6"/>be working with the <em class="italic">Tower Defense (top-down)</em> game asset’s <strong class="source-inline">towerDefense_tilesheet.png</strong> sprite sheet. Import the image into the <strong class="source-inline">Assets/Sprites</strong> folder, and once the asset has finished importing, selecting it in the <strong class="bold">Project</strong> window will display the sprite import settings in the <span><strong class="bold">Inspector</strong></span><span> window.</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer022">
<img alt="Figure 2.3 – Sprite import settings" src="image/B18347_02_03.jpg" class="calibre28"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 2.3 – Sprite import settings</p>
<p class="calibre3">Since the sprite sheet comprises many images, we first want to change <strong class="bold">Sprite Mode</strong> to <strong class="bold">Multiple</strong>. Any time you change the import settings, you’ll have to click the <strong class="bold">Apply</strong> button at the bottom of the list of fields. Once clicked, we’ll move on to slicing the sprite sheet to create the individually <span>selectable sprites.</span></p>
<p class="callout-heading">Power of two textures</p>
<p class="callout">It is best to size textures with dimensions that are powers of two on all sides. The sizes are 2, 4, 8, 16, 32, 64, 128, 256, 512, 1,024, or 2,048 pixels (px). Note that the textures do not have <a id="_idIndexMarker111" class="pcalibre1 pcalibre calibre6"/>to be square (for example, 256 x 1,024). Unity will use the non-power of two textures, although they will not be compressed (taking up more video memory) and not optimized (in some cases, slower to load and render). The <strong class="bold">Inspector</strong> window will display a warning when they cannot be compressed, as seen at the bottom of <span><em class="italic">Figure 2</em></span><span><em class="italic">.3</em></span><span>.</span></p>
<h4 class="calibre29">Slicing the sprite sheet</h4>
<p class="calibre3">With <strong class="bold">Sprite Mode</strong> set to <em class="italic">Multiple</em>, the imported image is now treated as a sprite sheet, with several <a id="_idIndexMarker112" class="pcalibre1 pcalibre calibre6"/>smaller images needing to be defined. If we skip this step, all of the smaller images within the sprite sheet image will not be accessible, and we won’t be <a id="_idIndexMarker113" class="pcalibre1 pcalibre calibre6"/>able to assign them to a <strong class="bold">Sprite Renderer</strong> or create tiles for use in the <strong class="bold">Tilemap</strong> <strong class="bold">Tile Palette</strong> for drawing or filling in <span>our level.</span></p>
<p class="calibre3">Open the Sprite Editor by clicking the <strong class="bold">Sprite Editor</strong> button just below the <strong class="bold">Sprite Mode</strong> section fields (refer to <span><em class="italic">Figure 2</em></span><em class="italic">.3</em>). You’ll see that the sprite sheet is actually a tilemap image because the sprites are already arranged in a two-dimensional grid for us. This makes <span>slicing easy-peasy!</span></p>
<p class="calibre3">Next, click the <strong class="bold">Slice</strong> button in the window’s top-left corner (as seen in <span><em class="italic">Figure 2</em></span><em class="italic">.4</em>). From the options presented in the dropdown, change <strong class="bold">Type</strong> to <strong class="bold">Grid by Cell Size</strong>, and then set the pixel size to <strong class="bold">X</strong>: <strong class="source-inline">64</strong> and <strong class="bold">Y</strong>: <strong class="source-inline">64</strong>. This Kenney tilemap’s sprite cells are 64 pixels square, but you may end up working with sprites of different sizes, so you will have to set this <span>value accordingly.</span></p>
<p class="calibre3">We can keep the default values for the remainder of the fields in the dialog, so proceed to slice the image into sprites by clicking the <strong class="bold">Slice</strong> button. The slicing results should appear like <span>the following:</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer023">
<img alt="Figure 2.4 – The Sprite Editor Tower Defense (top-down) tilemap" src="image/B18347_02_04.jpg" class="calibre30"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 2.4 – The Sprite Editor Tower Defense (top-down) tilemap</p>
<p class="callout-heading">Trimming sprites</p>
<p class="callout">For some sprites that don’t completely fill the grid cell, you may get some bleeding from neighboring sprites if some of the spacing was not adjusted just right. This is easy to fix by clicking on the offending sprite in the Sprite Editor and then clicking the <strong class="bold">Trim</strong> button (directly to the right of the <span><strong class="bold">Slice</strong></span><span> button).</span></p>
<p class="calibre3">Let’s proceed <a id="_idIndexMarker114" class="pcalibre1 pcalibre calibre6"/>to slice the other Kenney asset we’ll be using for the objects in the environment of the collection game now – the <em class="italic">Top-down Tanks Redux</em> game asset’s <strong class="source-inline">Assets/Sprites/topdowntanks_onlyObjects_default.png</strong> <span>sprite sheet.</span></p>
<p class="calibre3">Again, after importing, select the image in the <strong class="bold">Project</strong> window to display the import settings in the <strong class="bold">Inspector</strong> window, set <strong class="bold">Sprite Mode</strong> to <strong class="bold">Multiple</strong>, click the <strong class="bold">Apply</strong> button (at the bottom), and finally, click the <strong class="bold">Sprite </strong><span><strong class="bold">Editor</strong></span><span> button.</span></p>
<p class="calibre3">You’ll likely notice right away that something is different with this image – it’s not a tilemap. Kenney provides game assets as sprite sheets for more game engines than just Unity. While this sprite sheet may work well in some other game engines, it, unfortunately, does not <span>in Unity.</span></p>
<p class="calibre3">Suppose the smaller images had more padding (blank space represented by transparent pixels surrounding the image). In that case, Unity’s <strong class="bold">Automatic</strong> slice type setting may work as intended to slice into individual sprites – it does with sufficient padding – but in this case, it did not work and treated the whole sprite sheet image as a <span>single Sprite.</span></p>
<p class="calibre3">So, to use the images from a sprite sheet that does not have sufficient padding to work well with Unity’s automatic slicing, you’ll have to open your favorite image editing software (for example, Adobe Photoshop, Gimp, or Krita) and rearrange the images with padding, or arrange them in a grid for slicing by <span>cell size.</span></p>
<p class="calibre3">As you can <a id="_idIndexMarker115" class="pcalibre1 pcalibre calibre6"/>see in the following screenshot, I chose to copy the images from the original Kenney sprite sheet (the left side) and create a new tilemap image with a consistent cell size layout (the right side – this image is included in the book’s <span>project files).</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer024">
<img alt="Figure 2.5 – Sprite Editor – automatic versus grid slicing" src="image/B18347_02_05.jpg" class="calibre31"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 2.5 – Sprite Editor – automatic versus grid slicing</p>
<p class="callout-heading">Optimization note</p>
<p class="callout">To reduce draw calls using a rendering technique called batching, a Sprite Atlas can be added to the project. Assigning individual sprites, sprite sheet images, and even folders to the Sprite Atlas will pack them into a single sprite sheet image to render from. This atlas will be the only asset being drawn from instead of multiple sprite images, where each additional sprite image would add a draw call to <span>the renderer.</span></p>
<p class="callout">As a bonus activity, create a Sprite Atlas in the <strong class="bold">Project</strong> window from the <strong class="bold">Create</strong> menu by choosing <strong class="bold">Create</strong> | <strong class="bold">2D</strong> | <strong class="bold">Sprite Atlas</strong>. You can then assign both imported and sliced sprite sheets to the <strong class="bold">Objects for Packing</strong> list or the <strong class="source-inline1">Sprites</strong> folder itself. You may need to verify that the feature is enabled (default) in <strong class="bold">Project Settings</strong> | <strong class="bold">Editor</strong> | <strong class="bold">Sprite Packer</strong> | <strong class="bold">Mode = Sprite Atlas v2 – </strong><span><strong class="bold">Enabled</strong></span><span>.</span></p>
<p class="calibre3">Now that we have our tilemaps sliced into individual Sprites, we’re ready to create a Tile Palette. The Sprites <a id="_idIndexMarker116" class="pcalibre1 pcalibre calibre6"/>will be added to a Tile Palette to <a id="_idIndexMarker117" class="pcalibre1 pcalibre calibre6"/>create Tiles used to draw out the level. Let’s make our first Tile Palette in the <span>next section.</span></p>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><strong class="bold">Sprite </strong><span><strong class="bold">Editor</strong></span><span>: </span><a href="https://docs.unity3d.com/2022.3/Documentation/Manual/SpriteEditor.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/2022.3/Documentation/Manual/SpriteEditor.xhtml</span></a></p>
<h3 class="calibre10">Creating Tile Palettes</h3>
<p class="calibre3">To get <a id="_idIndexMarker118" class="pcalibre1 pcalibre calibre6"/>started creating Tile Palettes, perform the <span>following steps:</span></p>
<ol class="calibre14">
<li class="calibre15">First, open the <strong class="bold">Tile Palette</strong> window by going to <strong class="bold">Windows</strong> | <strong class="bold">2D</strong> | <span><strong class="bold">Tile Palette</strong></span><span>.</span></li>
<li class="calibre15">We’ll use the <em class="italic">Tower Defense (top-down)</em> game asset as our main environment map, so create a new <strong class="bold">Tile Palette</strong> by clicking the <strong class="bold">Create New Palette</strong> drop-down menu and selecting <em class="italic">New Palette</em>. This drop-down list is where we will be selecting the current Palette to use to draw the tilemap in the <span>scene View.</span></li>
<li class="calibre15">Name it <strong class="source-inline">Environment Main</strong>; keep the defaults since we’re using a <span>rectangle grid.</span></li>
<li class="calibre15">Click the <strong class="bold">Create</strong> button, as shown in <span><em class="italic">Figure 2</em></span><span><em class="italic">.6</em></span><span>.</span></li>
<li class="calibre15">A Tile Palette is an asset saved in the <strong class="source-inline">Project</strong> folders, so you will be prompted to save it. Select the folder we previously created – <span><strong class="source-inline">Assets/Tile Palettes</strong></span><span>.</span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer025">
<img alt="Figure 2.6 – Creating a Tile Palette and Tiles" src="image/B18347_02_06.jpg" class="calibre32"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 2.6 – Creating a Tile Palette and Tiles</p>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout">Creating a Tile <span>Palette: </span><a href="https://docs.unity3d.com/2022.3/Documentation/Manual/Tilemap-Palette.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/2022.3/Documentation/Manual/Tilemap-Palette.xhtml</span></a></p>
<p class="calibre3">With the <a id="_idIndexMarker119" class="pcalibre1 pcalibre calibre6"/>palette created, we can move on to the last step required before we can start drawing our level, and we’ll tackle that in the next section by adding Tiles to <span>the Palette.</span></p>
<h3 class="calibre10">Creating Tiles</h3>
<p class="calibre3">Tiles are <a id="_idIndexMarker120" class="pcalibre1 pcalibre calibre6"/>what the Tile Palette uses to draw sprites into the Scene. You may <a id="_idIndexMarker121" class="pcalibre1 pcalibre calibre6"/>be wondering why we need to create Tiles if we already have our sprites sliced and ready to use as individual images. That’s because Tiles can <a id="_idIndexMarker122" class="pcalibre1 pcalibre calibre6"/>provide additional functionality when drawing your tilemaps. Other types of Tiles <a id="_idIndexMarker123" class="pcalibre1 pcalibre calibre6"/>are the <strong class="bold">Rule Tile</strong> and <strong class="bold">Animated Tile</strong>, but we’ll start by using the default <span>Tile type.</span></p>
<p class="calibre3">Let’s start by dragging the <strong class="source-inline">towerDefense_tilesheet.png</strong> sprite sheet from the <strong class="bold">Project</strong> window’s <strong class="source-inline">Assets/Sprites</strong> folder into the <strong class="bold">Tile Palette</strong> window – where it says <strong class="bold">Drag Tile, Sprite, or Sprite Texture assets here</strong> – to create Tiles for all of the individual sprites in the sliced sprite sheet. You’ll be prompted to save the Tiles, so choose the <strong class="source-inline">Assets/Tile Palettes/Tiles</strong> folder we already prepared for them. The result <a id="_idIndexMarker124" class="pcalibre1 pcalibre calibre6"/>should look like the Tile Palette window in <span><em class="italic">Figure 2</em></span><span><em class="italic">.6</em></span><span>.</span></p>
<p class="calibre3">Before we start <a id="_idIndexMarker125" class="pcalibre1 pcalibre calibre6"/>drawing our level, let’s have a quick look at two very useful types <span>of Tiles.</span></p>
<h4 class="calibre29">Types of Tiles</h4>
<p class="calibre3">The common <a id="_idIndexMarker126" class="pcalibre1 pcalibre calibre6"/>types of <span>tiles include:</span></p>
<ul class="calibre17">
<li class="calibre15"><strong class="bold">Rule Tile</strong>: This allows <a id="_idIndexMarker127" class="pcalibre1 pcalibre calibre6"/>us to create rules where specified <a id="_idIndexMarker128" class="pcalibre1 pcalibre calibre6"/>adjacent tiles will be used to draw complex shapes more easily. It is essentially an automated drawing tool. This is a <span>huge time-saver!</span></li>
</ul>
<p class="calibre3">To create a new Rule Tile, change to the <strong class="source-inline">Tiles</strong> folder in the <strong class="bold">Project</strong> window and create a subfolder at <strong class="source-inline">Assets/Tile Palettes/Tiles</strong> named <strong class="source-inline">Rule Tiles</strong>. Right-click within the <strong class="bold">Project</strong> window to open the <strong class="bold">Create</strong> menu and go to <strong class="bold">Create</strong> | <strong class="bold">2D</strong> | <strong class="bold">Tiles</strong> | <strong class="bold">Rule Tile</strong> within the new folder. We’ll use this Tile to draw sections of the environment as dirt surrounded by grass sprites, so name it <strong class="source-inline">Environment Area 1</strong>, as shown in the <span><strong class="bold">Inspector</strong></span><span> window:</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer026">
<img alt="Figure 2.7 – Rule Tile setup" src="image/B18347_02_07.jpg" class="calibre33"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 2.7 – Rule Tile setup</p>
<p class="calibre3">We’ll add Tiling Rules to create a filled square with appropriate corner sprites, adjacent to <a id="_idIndexMarker129" class="pcalibre1 pcalibre calibre6"/>the horizontal and vertical side sprites. That makes nine sprites <a id="_idIndexMarker130" class="pcalibre1 pcalibre calibre6"/>in total – four on the sides, four in the corners, and one in <span>the center.</span></p>
<p class="calibre3">Set the <strong class="bold">Number of Tiling Rules</strong> setting to <strong class="source-inline">9</strong>, and proceed to assign all the sprites from the environment sprite sheet by using <span><em class="italic">Figure 2</em></span><em class="italic">.7</em> as a guide. Once the sprites are assigned, we can set the “3 x 3” boxes that visualize the behavior of the <a id="_idIndexMarker131" class="pcalibre1 pcalibre calibre6"/>Rule. Again, using <span><em class="italic">Figure 2</em></span><em class="italic">.7</em>, set the box <span>rules accordingly.</span></p>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><strong class="bold">Rule </strong><span><strong class="bold">Tile</strong></span><span>: </span><a href="https://docs.unity3d.com/Packages/com.unity.2d.tilemap.extras%403.0/manual/RuleTile.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/Packages/com.unity.2d.tilemap.extras%403.0/manual/RuleTile.xhtml</span></a></p>
<ul class="calibre17">
<li class="calibre15"><strong class="bold">Animated Tile</strong>: This <a id="_idIndexMarker132" class="pcalibre1 pcalibre calibre6"/>allows us to create a sprite <a id="_idIndexMarker133" class="pcalibre1 pcalibre calibre6"/>animation by assigning several sprites to replace each other at a <span>specified speed.</span></li>
</ul>
<p class="calibre3">To create a new Animated Tile, change to the <strong class="source-inline">Tiles</strong> folder in the <strong class="bold">Project</strong> window and create a subfolder at <strong class="source-inline">Assets/Tile Palettes/Tiles</strong>, named <strong class="source-inline">Animated Tiles</strong>. Right-click within the <strong class="bold">Project</strong> window to open the <strong class="bold">Create</strong> menu <a id="_idIndexMarker134" class="pcalibre1 pcalibre calibre6"/>and go to <strong class="bold">Create</strong> | <strong class="bold">2D</strong> | <strong class="bold">Tiles</strong> | <strong class="bold">Animated Tile</strong> within <a id="_idIndexMarker135" class="pcalibre1 pcalibre calibre6"/>the new folder. To use this tile, drag a sequence of sprites to the <strong class="bold">Drag a Sprite or Sprite Texture assets to start creating an Animated </strong><span><strong class="bold">Tile</strong></span><span> section.</span></p>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><strong class="bold">Animated </strong><span><strong class="bold">Tile</strong></span><span>: </span><a href="https://docs.unity3d.com/Packages/com.unity.2d.tilemap.extras%403.0/manual/AnimatedTile.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/Packages/com.unity.2d.tilemap.extras%403.0/manual/AnimatedTile.xhtml</span></a></p>
<p class="calibre3">For a quick <a id="_idIndexMarker136" class="pcalibre1 pcalibre calibre6"/>recap concerning all the folders we’ve created to organize and contain all of our art assets, our <strong class="bold">Project</strong> window should look similar to <span>the following:</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer027">
<img alt="Figure 2.8 – Project folder structure" src="image/B18347_02_08.jpg" class="calibre34"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 2.8 – Project folder structure</p>
<p class="calibre3">In this section, you learned how to create Tile Palettes, understood how to import and slice sprite sheets to create individual sprites, and explored the advantages of using Rule Tiles to make <span>drawing easier.</span></p>
<p class="calibre3">This is all the prerequisite setup we need to draw the environment for our collection game level, so let’s get started doing just that. In the next section, we’ll add several tilemaps for the different components that make up the <span>level design.</span></p>
<h2 id="_idParaDest-47" class="calibre8"><a id="_idTextAnchor047" class="pcalibre1 pcalibre calibre6"/>Building the collection game environment with Tilemap</h2>
<p class="calibre3">We’ll need a new scene for the game level, so go to <strong class="bold">File</strong> | <strong class="bold">New Scene</strong> (<em class="italic">Ctrl</em>/<em class="italic">Cmd</em> + <em class="italic">N</em>). This <a id="_idIndexMarker137" class="pcalibre1 pcalibre calibre6"/>will bring up the <strong class="bold">New Scene</strong> window, where <a id="_idIndexMarker138" class="pcalibre1 pcalibre calibre6"/>we’ll select the <strong class="bold">Lit 2D (URP)</strong> Scene Template and then click the <strong class="bold">Create</strong> button in the window’s lower-right corner, as shown in the <span>following screenshot:</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer028">
<img alt="Figure 2.9 – New Scene Templates" src="image/B18347_02_09.jpg" class="calibre35"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 2.9 – New Scene Templates</p>
<p class="callout-heading">Scene Templates – Unity documentation</p>
<p class="callout">Unity provides a <a id="_idIndexMarker139" class="pcalibre1 pcalibre calibre6"/>set of built-in Scene Templates, but you can add your own user-defined templates to create new scenes containing all of your starting content. For additional information on creating Scene Templates, refer to the Unity documentation <span>here: </span><a href="https://docs.unity3d.com/2022.3/Documentation/Manual/scene-templates.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/2022.3/Documentation/Manual/scene-templates.xhtml</span></a></p>
<p class="calibre3">A new <strong class="bold">Lit 2D (URP)</strong> scene will not prompt to save when created (some do prompt, depending on what the template contains), so go ahead and save the scene as your first step (<em class="italic">Ctrl</em>/<em class="italic">Cmd</em> + <em class="italic">S</em>) – get in the habit of saving frequently. A good name to start with here <a id="_idIndexMarker140" class="pcalibre1 pcalibre calibre6"/>could be <strong class="source-inline">Game</strong> or <strong class="source-inline">Level</strong>, since our game will consist entirely of just a single scene (that is, for a single <span>game level).</span></p>
<p class="calibre3">With our <a id="_idIndexMarker141" class="pcalibre1 pcalibre calibre6"/>new game scene saved, we’re <a id="_idIndexMarker142" class="pcalibre1 pcalibre calibre6"/>ready to start adding tilemaps in the <span>next section!</span></p>
<h3 class="calibre10">Adding tilemaps to a Scene</h3>
<p class="calibre3">A <strong class="bold">Tilemap</strong> is a <a id="_idIndexMarker143" class="pcalibre1 pcalibre calibre6"/>component added to a GameObject that adds functionality just like any other component we previously discussed. The <strong class="bold">Tilemap</strong> component stores and manages the <strong class="bold">Tile</strong> assets used for creating 2D environments and levels. It also depends on a <strong class="bold">Grid</strong> component that provides a visual guide and aligns the painted tiles. We will make multiple tilemaps to serve different visual and <span>functional purposes.</span></p>
<p class="calibre3">To create a tilemap in the scene, from the <strong class="bold">File</strong> menu, go to <strong class="bold">GameObject</strong> | <strong class="bold">2D Object</strong> | <strong class="bold">Tilemap</strong> | <strong class="bold">Rectangular</strong>, or right-click in the <strong class="bold">Hierarchy</strong> window and go to <strong class="bold">2D Object</strong> | <strong class="bold">Tilemap</strong> | <strong class="bold">Rectangular</strong> (the <strong class="bold">+</strong> button at the top of the <strong class="bold">Hierarchy</strong> window can also be used). Give the tilemap a descriptive name for the layer we’ll be drawing – the background. I’ve named it <strong class="source-inline">Tilemap – Background</strong>. Refer to <span><em class="italic">Figure 2</em></span><em class="italic">.11</em> for an example of this in the <span><strong class="bold">Hierarchy</strong></span><span> window.</span></p>
<p class="calibre3">In the next section, we will learn how to control the drawing order of <span>multiple tilemaps.</span></p>
<h4 class="calibre29">Sorting Layers</h4>
<p class="calibre3">Like we have <a id="_idIndexMarker144" class="pcalibre1 pcalibre calibre6"/>a Sorting Layer on individual Sprites, we have one on tilemaps. The <strong class="bold">Tilemap Sorting Layer</strong> will <a id="_idIndexMarker145" class="pcalibre1 pcalibre calibre6"/>allow us to draw sprites on different layers to control front-to-back layering (objects drawn on top of or behind others) and is applied to the whole tilemap (all the sprites that make up <span>the tilemap).</span></p>
<p class="calibre3">Let’s create a new <strong class="bold">Sorting Layer</strong> for the background tilemap by clicking on the <strong class="bold">Sorting Layer</strong> drop-down list, which currently has a <strong class="bold">Default</strong> value, and click <strong class="bold">Add Sorting Layer…</strong>. The <strong class="bold">Inspector</strong> window will change to the <strong class="bold">Tags &amp; Layers</strong> settings, where we’ll specify the following layers and their order: <em class="italic">Background</em>, <em class="italic">Collider</em>, <em class="italic">Objects</em>, <span>and </span><span><em class="italic">Foreground</em></span><span>.</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer029">
<img alt="Figure 2.10 – Sorting Layers" src="image/B18347_02_10.jpg" class="calibre36"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 2.10 – Sorting Layers</p>
<p class="calibre3">The renderer <a id="_idIndexMarker146" class="pcalibre1 pcalibre calibre6"/>will draw the layers in the order they appear here, with <strong class="bold">Layer 0</strong> (<strong class="bold">Background</strong>) at the back, <strong class="bold">Layer 4</strong> (<strong class="bold">Foreground</strong>) at the front, and the layers in between drawn in their <span>respective locations.</span></p>
<p class="calibre3">Clicking the <strong class="bold">+</strong> button will add a new layer to the list while clicking the <strong class="bold">-</strong> button with a layer selected will remove it. Dragging <strong class="bold">=</strong> to the left of the field (for example, <strong class="bold">Layer 0</strong>) up/down will reorder. Once we’ve finished adding and setting the layer orders, click on <strong class="bold">Tilemap - Background</strong> in the <strong class="bold">Hierarchy</strong> window again and select <em class="italic">Background</em> in the <strong class="bold">Tilemap Renderer Sorting</strong> Layer <span>drop-down field.</span></p>
<p class="calibre3">We still have the option of creating a second Tilemap background on the same Sorting Layer, and we can control which background draws above/below the other background by using the <strong class="bold">Order in Layer</strong> field – this is useful if you have two different style environments for your background and would like to manage <span>them separately.</span></p>
<p class="calibre3">We are finally ready to start drawing with our Tiles in the <span>next section!</span></p>
<h3 class="calibre10">Drawing the level in the scene view</h3>
<p class="calibre3">If you’ve <a id="_idIndexMarker147" class="pcalibre1 pcalibre calibre6"/>ever previously used a drawing program, then the painting tools in the Tile Palette’s toolbar will seem familiar, except that you will now be limited to painting on a grid. Paintbrush, flood fill, box fill, and eraser tools are all standard painting tools in <span>drawing programs.</span></p>
<p class="calibre3">We won’t cover all the painting tools in detail, but I encourage you to explore them on your own as you draw out your environment and level design – don’t be afraid to make mistakes! Like most things in Unity – and pretty much every program – you can quickly undo things by using <em class="italic">Ctrl</em>/<em class="italic">Cmd</em> + <span><em class="italic">Z</em></span><span>.</span></p>
<p class="calibre3">Remember <a id="_idIndexMarker148" class="pcalibre1 pcalibre calibre6"/>to save your progress as you go to keep what you like. Have fun with your drawing, and take the time to experiment because you never know where this type of creativity <span>will lead.</span></p>
<p class="callout-heading">Scene navigation</p>
<p class="callout">As a reminder for getting around in the scene View while drawing out your level, refer back to <em class="italic">Navigating the scene View</em> section in <a href="B18347_01.xhtml#_idTextAnchor015" class="pcalibre1 pcalibre calibre6"><span><em class="italic">Chapter 1</em></span></a><span>.</span></p>
<p class="calibre3">Follow these steps every time you want to draw in the scene View using the <span>painting tools:</span></p>
<ol class="calibre14">
<li class="calibre15">Start by selecting the tilemap you want to paint on, either in the <strong class="bold">Hierarchy</strong> window or within the <strong class="bold">Tile Palette</strong> window, using the <strong class="bold">Active Tilemap</strong> drop-down list (just below <span>the toolbar).</span></li>
<li class="calibre15">Select the <strong class="bold">Palette</strong> for the <strong class="bold">Tile</strong> you want to paint with using the <strong class="bold">Tile Palettes</strong> drop-down list located just below the <strong class="bold">Active Tilemap</strong> section on the left. For instance, we will choose the <strong class="bold">Environment Main</strong> palette that we <span>created earlier.</span></li>
<li class="calibre15">Choose the tile to paint with by clicking on it in the tiles section grid. Remember that we’re starting with the background of our level design, so pick a solid square tile that we can use to fill a <span>large area.</span></li>
<li class="calibre15">To paint individual tiles, by clicking on a grid cell in the scene View or painting continuous lines of sprites by clicking and dragging, select the <strong class="bold">Paintbrush</strong> tool (the <span>paintbrush icon).</span></li>
<li class="calibre15">To draw a rectangular shape filled with the selected tile, select the <strong class="bold">Box Fill</strong> tool (the <span>box icon).</span></li>
<li class="calibre15">You can <a id="_idIndexMarker149" class="pcalibre1 pcalibre calibre6"/>also fill a larger contiguous area of grid cells with the selected tile by using the <strong class="bold">Flood Fill</strong> tool (the <span>bucket icon).</span></li>
<li class="calibre15">The <strong class="bold">Eraser</strong> tool can erase tiles from the cell grid by clicking on them or clicking <span>and dragging.</span></li>
</ol>
<p class="calibre3">The following figure illustrates the background tilemap selected in the <strong class="bold">Hierarchy</strong> window (<em class="italic">A</em>), a view of its components in the <strong class="bold">Inspector</strong> window (<em class="italic">B</em>), the environment palette (<strong class="bold">Environment Main</strong>) that we’re using to draw the background with (<em class="italic">C</em>), and both the selected tile (<strong class="bold">grass</strong>) (<em class="italic">D</em>) and painting tool (<strong class="bold">Paintbrush</strong>) currently being <span>used (</span><span><em class="italic">E</em></span><span>).</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer030">
<img alt="Figure 2.11 – The Tilemap in the Hierarchy and Tile Palette windows" src="image/B18347_02_11.jpg" class="calibre37"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 2.11 – The Tilemap in the Hierarchy and Tile Palette windows</p>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><strong class="bold">Painting on </strong><span><strong class="bold">Tilemaps</strong></span><span>: </span><a href="https://docs.unity3d.com/2022.3/Documentation/Manual/Tilemap-Painting.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/2022.3/Documentation/Manual/Tilemap-Painting.xhtml</span></a></p>
<p class="calibre3">As a reminder <a id="_idIndexMarker150" class="pcalibre1 pcalibre calibre6"/>of what we’re drawing here, we’re creating the background for the level of our collection game – defining the general play area. To visualize the overall level design plan, it may help to start drawing some of your ideas out on paper first, then using those ideas to start drawing things out in the Editor (refer to my initial sketch as a guide, <span>if needed).</span></p>
<p class="callout-heading">Paper prototyping</p>
<p class="callout">Paper prototyping is <a id="_idIndexMarker151" class="pcalibre1 pcalibre calibre6"/>a widely used method in the game design process that helps you test out ideas before committing time to writing code or creating digital art assets. It’s also a quick way to validate your gameplay and discover potential problems <span>early on.</span></p>
<p class="calibre3">While experimenting with your level design, consider that we’ll want to guide the player to where we’ll be placing collectibles throughout the level in the following sections. Don’t be <a id="_idIndexMarker152" class="pcalibre1 pcalibre calibre6"/>afraid of making any mistakes; making changes in response to playtesting your games is something that you’ll have to do regularly – iterating changes to improve gameplay or balance <span>the difficulty.</span></p>
<p class="calibre3">Before tailoring additional elements of the environment and level design, let’s make sure our art assets are looking their best in the game view by adjusting the <span><strong class="bold">Camera</strong></span><span> settings.</span></p>
<h4 class="calibre29">Camera settings for crisp graphics</h4>
<p class="calibre3">The default settings Unity provides in new Scenes are not always ideal for the game assets <a id="_idIndexMarker153" class="pcalibre1 pcalibre calibre6"/>you’ll be working with. Because of this, we’ll want to make some adjustments to our sprite sheet image import settings and our scene camera to have them looking <span>their best!</span></p>
<p class="calibre3">The individual images in our tilemap image are 64 pixels square (note that these sizes could be different, depending on the desired size of the art for the game design dictates). The best way to work with tilemap images is to ensure that the individual sprite size equals the grid size. Since tilemap grid cells are sized to equal one square Unity unit, we’ll have to set our pixels per unit to equal one <span>Unity unit.</span></p>
<p class="calibre3">To set the pixels per unit for the sprites in our <em class="italic">Tower Defense (top-down)</em> asset, click on the <strong class="source-inline">towerDefense_tilesheet.png</strong> image in the <strong class="source-inline">Assets/Sprites</strong> folder to view the import settings in the <strong class="bold">Inspector</strong> window (refer to <span><em class="italic">Figure 2</em></span><em class="italic">.3</em>). Find the <strong class="bold">Pixels per Unit</strong> field in the <strong class="bold">Sprite Mode</strong> section, and ensure its value is set to <span><strong class="source-inline">64</strong></span><span> (pixels).</span></p>
<p class="calibre3">We’ll now have to address the camera setting so that 64-pixel sprite images are represented on screen at their native resolution. These are the <em class="italic">crisp graphics</em> we are referring to – the native size. This will require a bit of math and a decision on the preferred resolution for the target platform. Assuming that most players on desktop systems – our target platform for the collection game – have a screen resolution of 1,920 px wide x 1,080 px high, let’s <span>use that.</span></p>
<p class="calibre3">Select the <strong class="bold">Main Camera</strong> in the <strong class="bold">Scene Hierarchy</strong> window; then, in the <strong class="bold">Projection</strong> section, set the orthographic camera projection size (this is a vertical value) by taking the screen <a id="_idIndexMarker154" class="pcalibre1 pcalibre calibre6"/>resolution height divided by the pixels per unit and dividing the result by 2 – we are dividing by 2 because the size value is half the vertical viewing volume of the camera. Here is what the calculation looks like with the resulting value set in the <strong class="bold">Inspector</strong> window – <em class="italic">(1,080 ÷ 64) ÷ 2 = </em><span><em class="italic">8.4375</em></span><span>.</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer031">
<img alt="Figure 2.12 – The camera orthographic size" src="image/B18347_02_12.jpg" class="calibre38"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 2.12 – The camera orthographic size</p>
<p class="calibre3">The number of sprites extending the vertical extent is now optimal for crisp graphics! To visualize the result in the Editor, switch to the <strong class="bold">Game</strong> view (by clicking on its tab next to <strong class="bold">Scene</strong>, just under the main toolbar) and set the <strong class="bold">Aspect Ratio</strong> drop-down list value to <strong class="bold">Full HD (1920x1080)</strong> – by default; this is set to <span><strong class="bold">Free Aspect</strong></span><span>.</span></p>
<p class="calibre3">In this section, we learned how to draw tiles in the scene View to create the background environment and define the play area for the level. We also learned how to make our art assets <a id="_idIndexMarker155" class="pcalibre1 pcalibre calibre6"/>look their best! Next, we’ll add some 2D lights – leveraging the Universal Render Pipeline’s (Universal RP, or URP) 2D features – to enhance the <span>environment design.</span></p>
<h3 class="calibre10">Adding 2D lights</h3>
<p class="calibre3">The Universal RP 2D renderer allows us to enhance our environment by adding 2D lights! Let’s add <a id="_idIndexMarker156" class="pcalibre1 pcalibre calibre6"/>some 2D lights to the position <a id="_idIndexMarker157" class="pcalibre1 pcalibre calibre6"/>of some tiles, representing light sources in our environment design. Follow these steps to add some <span><em class="italic">light sources</em></span><span>:</span></p>
<ol class="calibre14">
<li class="calibre15">Start by creating a new tilemap for tiles that will draw above the background tilemap, and name it <strong class="source-inline">Tilemap - </strong><span><strong class="source-inline">Objects</strong></span><span>.</span></li>
<li class="calibre15">Set <strong class="bold">Sorting Layer</strong> <span>to </span><span><em class="italic">Objects</em></span><span>.</span></li>
<li class="calibre15">Create a new <strong class="bold">Tilemap Palette</strong> for the <strong class="bold">Top-down Tanks Redux</strong> sprite sheet and name it <span><strong class="source-inline">Environment Objects</strong></span><span>.</span></li>
<li class="calibre15">Add the sprites from the <strong class="source-inline">topdowntanks_onlyObjects_default</strong> sprite sheet to create the tiles used <span>for painting.</span></li>
<li class="calibre15">Select <em class="italic">Tilemap - Objects</em> as <strong class="bold">Active Tilemap</strong> in the <strong class="bold">Tile </strong><span><strong class="bold">Palette</strong></span><span> window.</span></li>
<li class="calibre15">Select the star-looking tile and paint a few in the Scene using the <span><strong class="bold">Paintbrush</strong></span><span> tool.</span></li>
</ol>
<p class="callout-heading">Important note</p>
<p class="callout">To focus work on a specific tilemap with the other GameObjects in the scene faded out, use the <strong class="bold">Tilemap Focus</strong> mode (the floating overlay in the <span>scene View).</span></p>
<p class="calibre3">Okay, we have some light sources in the environment; now, let’s add some 2D lights to them by following <span>these steps:</span></p>
<ol class="calibre14">
<li class="calibre15">Create a new empty GameObject in the root of the scene’s <strong class="bold">Hierarchy</strong> window and name <span>it </span><span><strong class="source-inline">Lights</strong></span><span>.</span></li>
<li class="calibre15">Right-click on the <strong class="bold">Lights</strong> GameObject – to open the <strong class="bold">Create</strong> menu – and select <strong class="bold">Light</strong> | <strong class="bold">Freeform Light 2D</strong> | <span><strong class="bold">Circle.</strong></span></li>
<li class="calibre15">Using the <strong class="bold">Move</strong> tool, position it over one of your <span><em class="italic">star</em></span><span> tiles.</span></li>
<li class="calibre15">You can experiment with what looks good to you. I changed the light’s <strong class="bold">Blending</strong> section’s <strong class="bold">Blend Style</strong> value to <strong class="bold">Additive</strong> (the default is <strong class="bold">Multiply</strong>) to better visualize the example screenshots. For a finished game, I would reduce the global <a id="_idIndexMarker158" class="pcalibre1 pcalibre calibre6"/>light source intensity <a id="_idIndexMarker159" class="pcalibre1 pcalibre calibre6"/>and use the <strong class="bold">Multiply</strong> blend style on many 2D lights added to the environment to set the right lighting <span>design tone.</span></li>
</ol>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><strong class="bold">Light Blend </strong><span><strong class="bold">Styles</strong></span><span>: </span><a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal%4015.0/manual/LightBlendStyles.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal%4015.0/manual/LightBlendStyles.xhtml</span></a></p>
<ol class="calibre14">
<li value="5" class="calibre15">Adjust <a id="_idIndexMarker160" class="pcalibre1 pcalibre calibre6"/>the <strong class="bold">Radius</strong>, <strong class="bold">Inner Spot Angle</strong>/<strong class="bold">Outer Spot Angle</strong>, <strong class="bold">Intensity</strong>, and <strong class="bold">Falloff Strength</strong> values to <span>your liking.</span></li>
<li class="calibre15">Repeat as necessary for all of the light sources in your <span>environment design!</span></li>
</ol>
<p class="calibre3">You will want to adjust the overall lighting in the scene to use 2D lights to their full effect. Do this by selecting the <strong class="bold">Global Light 2D</strong> GameObject in the <strong class="bold">Scene Hierarchy</strong> window and adjusting the Light 2D component’s <span><strong class="bold">Intensity</strong></span><span> value.</span></p>
<p class="calibre3">The results of adding 2D lights to the scene can be seen in <span><em class="italic">Figure 2</em></span><em class="italic">.13</em> – to the left and right sides of the player character (the ladybug). We’ll be using the different types of 2D lights in the <span>coming chapters.</span></p>
<p class="calibre3">In this section, you learned how to add 2D lights to your environment design to great effect. The following section will tackle a missing requirement to get our level playable by using the <span><strong class="bold">TilemapCollider2D</strong></span><span> component.</span></p>
<h2 id="_idParaDest-48" class="calibre8"><a id="_idTextAnchor048" class="pcalibre1 pcalibre calibre6"/>Making the level playable – Tilemap Collider 2D</h2>
<p class="calibre3">We’ll need to prepare our level design a bit more before we’re able to make it playable – we’ll be making the player character controllable in the next chapter by adding a custom script and <span>mapping inputs.</span></p>
<p class="calibre3">To keep the <a id="_idIndexMarker161" class="pcalibre1 pcalibre calibre6"/>player from crossing into specified areas in the level, we need to add a special kind of collider to a tilemap. Colliders are a part of Unity’s Physics system and provide a way for developers to work with GameObjects, similar to how objects work in the <span>real world.</span></p>
<p class="calibre3">Colliders <a id="_idIndexMarker162" class="pcalibre1 pcalibre calibre6"/>prevent things from entering each other, and collisions of objects can all be responded to in code as events – we’ll be exploring this more in the upcoming chapters when adding features to <span>our game.</span></p>
<p class="calibre3">Let’s add a new tilemap to our scene to define areas that the player is not allowed to enter. This will be similar to how we created the previous tilemaps, except for having to add a <span><strong class="bold">TilemapCollider2D</strong></span><span> component:</span></p>
<ol class="calibre14">
<li class="calibre15">Create a new tilemap for tiles that will draw above the background tilemap and contain areas the player cannot cross. Name it <strong class="source-inline">Tilemap - </strong><span><strong class="source-inline">Collider</strong></span><span>.</span></li>
<li class="calibre15"> Set <strong class="bold">Sorting Layer</strong> <span>to </span><span><em class="italic">Collider</em></span><span>.</span></li>
<li class="calibre15">Let’s use a <strong class="bold">Rule Tile</strong> to make drawing complete areas in the level easier. In the <strong class="bold">Tile Palette</strong> window, create a new palette and name it <span><strong class="source-inline">Rules Palette</strong></span><span>.</span></li>
<li class="calibre15">Drag in the <strong class="bold">Environment Area 1</strong> rule tile we previously created from the <strong class="source-inline">Assets/Tile Palettes/Rule </strong><span><strong class="source-inline">Tiles</strong></span><span> folder.</span></li>
<li class="calibre15">Select <em class="italic">Tilemap - Collider</em> as <strong class="bold">Active Tilemap</strong> in the <strong class="bold">Tile </strong><span><strong class="bold">Palette</strong></span><span> window.</span></li>
<li class="calibre15">Select the rule tile and paint out areas in the scene using the <strong class="bold">Filled </strong><span><strong class="bold">Box</strong></span><span> tool.</span></li>
</ol>
<p class="calibre3">Now, to make this tilemap interactive, with <strong class="bold">Tilemap - Collider</strong> selected in the <strong class="bold">Hierarchy</strong> window, go to the bottom of the <strong class="bold">Inspector</strong> window and click the <strong class="bold">Add Component</strong> button. In the search field at the top of the dialog that opens, type <em class="italic">Tilemap</em>, and then select the <strong class="bold">Tilemap Collider 2D</strong> item to add it – we can use the <span>default values.</span></p>
<p class="calibre3">Refer to the following figure to get an idea of what <span>we’re creating:</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer032">
<img alt="Figure 2.13 – A collider level design example in the scene View" src="image/B18347_02_13.jpg" class="calibre39"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 2.13 – A collider level design example in the scene View</p>
<p class="calibre3">Now that you <a id="_idIndexMarker163" class="pcalibre1 pcalibre calibre6"/>understand how to add tilemaps, paint tiles in the scene, and sort the tilemap layers to set the proper drawing order, spend some time filling in environmental details. This is your time to experiment with <a id="_idIndexMarker164" class="pcalibre1 pcalibre calibre6"/>detailing the environment’s design and think about how the player will be guided through the level to accomplish the game objective – <span>collecting items.</span></p>
<p class="calibre3">In this section, you learned some key elements of level design. You understood how to create and work with tilemaps by importing and slicing sprite sheet images. To draw out a game level, you used tiles to paint individual sprites and areas. You completed the design by adding lights and making the graphics crisp. Finally, we made interactable objects through the use <span>of colliders.</span></p>
<p class="calibre3">We’ll start bringing all of these concepts together in the following sections by adding C# scripts to move the player and <span>collect items.</span></p>
<h1 id="_idParaDest-49" class="calibre5"><a id="_idTextAnchor049" class="pcalibre1 pcalibre calibre6"/>Introduction to creating scripts in C# – IDE, SOLID principles, and design patterns</h1>
<p class="calibre3">When making games in Unity, you’ll need to create your own functionality specific to the requirements of your game. We’ll need to learn how Unity provides programming support for <a id="_idIndexMarker165" class="pcalibre1 pcalibre calibre6"/>writing scripts using the C# language to <span>accomplish this.</span></p>
<p class="calibre3">In this <a id="_idIndexMarker166" class="pcalibre1 pcalibre calibre6"/>section, you’ll be introduced to the default code editor, get into the specifics of the C# language, and learn the best-practice approach to writing manageable, maintainable, and <span>extensible code.</span></p>
<h2 id="_idParaDest-50" class="calibre8"><a id="_idTextAnchor050" class="pcalibre1 pcalibre calibre6"/>The IDE – Visual Studio Community 2022</h2>
<p class="calibre3">The default <strong class="bold">integrated development environment</strong> (<strong class="bold">IDE</strong>) that Unity provides as part of the <a id="_idIndexMarker167" class="pcalibre1 pcalibre calibre6"/>Unity Editor installation is <strong class="bold">Microsoft Visual Studio 2022 Community Edition</strong>. The Community Edition is free for students <a id="_idIndexMarker168" class="pcalibre1 pcalibre calibre6"/>and individuals and provides a powerful IDE, with comprehensive tools and features for every stage of development, including tools specific <span>to Unity.</span></p>
<p class="callout-heading">Additional reading | Unity Visual Scripting</p>
<p class="callout">We will use Visual Studio 2022 to write C# code in this book, but it’s worth noting that Unity also <a id="_idIndexMarker169" class="pcalibre1 pcalibre calibre6"/>offers a visual scripting option that uses a graph-based system instead of traditional <span>code: </span><a href="https://unity.com/features/unity-visual-scripting" class="pcalibre1 pcalibre calibre6"><span>https://unity.com/features/unity-visual-scripting</span></a></p>
<p class="calibre3">The Visual Studio 2022 interface, with its standard windows, features, and a script that is open for editing, can be seen <span>as follows:</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer033">
<img alt="Figure 2.14 – Visual Studio 2022 Community Edition" src="image/B18347_02_14.jpg" class="calibre39"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 2.14 – Visual Studio 2022 Community Edition</p>
<p class="calibre3">In addition <a id="_idIndexMarker170" class="pcalibre1 pcalibre calibre6"/>to an essential script editing capability, let’s have a quick look at some of the features that Visual Studio <span>2022 provides:</span></p>
<ul class="calibre17">
<li class="calibre15"><strong class="bold">IntelliSense</strong>: Aids <a id="_idIndexMarker171" class="pcalibre1 pcalibre calibre6"/>in code completion <a id="_idIndexMarker172" class="pcalibre1 pcalibre calibre6"/>by providing suggestions for naming, parameter info, and words – saving <span>you keystrokes!</span></li>
<li class="calibre15"><strong class="bold">IntelliCode</strong>: Enhances <a id="_idIndexMarker173" class="pcalibre1 pcalibre calibre6"/>your software <a id="_idIndexMarker174" class="pcalibre1 pcalibre calibre6"/>development with <strong class="bold">artificial intelligence </strong>(<strong class="bold">AI</strong>) that can <a id="_idIndexMarker175" class="pcalibre1 pcalibre calibre6"/>automatically complete code – even up to a <span>whole line!</span></li>
<li class="calibre15"><strong class="bold">CodeLens</strong>: Keeps <a id="_idIndexMarker176" class="pcalibre1 pcalibre calibre6"/>you focused on your <a id="_idIndexMarker177" class="pcalibre1 pcalibre calibre6"/>code’s structure without leaving the IDE, code references, and contextual information at <span>your fingertips!</span></li>
<li class="calibre15"><strong class="bold">Live Share</strong>: Provides <a id="_idIndexMarker178" class="pcalibre1 pcalibre calibre6"/>a real-time collaborative <a id="_idIndexMarker179" class="pcalibre1 pcalibre calibre6"/>coding session you can share with other members on your project – work together to produce <span>results faster!</span></li>
<li class="calibre15"><strong class="bold">Integrated debugging</strong>: Allows <a id="_idIndexMarker180" class="pcalibre1 pcalibre calibre6"/>the developer to control the execution, step through the code, and examine <a id="_idIndexMarker181" class="pcalibre1 pcalibre calibre6"/>its state interactively while it’s running – see what your code is doing while <span>it runs!</span></li>
</ul>
<p class="callout-heading">Additional reading | Visual Studio</p>
<p class="callout"><strong class="bold">What’s new in Visual Studio </strong><span><strong class="bold">2022</strong></span><span>: </span><a href="https://docs.microsoft.com/en-us/visualstudio/ide/whats-new-visual-studio-2022?view=vs-2022%0D" class="pcalibre1 pcalibre calibre6"><span>https://docs.microsoft.com/en-us/visualstudio/ide/whats-new-visual-studio-2022?view=vs-2022</span></a></p>
<p class="calibre3">Before opening <a id="_idIndexMarker182" class="pcalibre1 pcalibre calibre6"/>up the IDE to edit a script, we’ll first need to create one! Creating scripts can be performed in a couple of ways. It’s good practice to <a id="_idIndexMarker183" class="pcalibre1 pcalibre calibre6"/>keep your project files organized from the start, so let’s first create a new folder named <strong class="source-inline">Scripts</strong> at the root of our project – <span><strong class="source-inline">Assets/Scripts</strong></span><span>.</span></p>
<p class="calibre3">To create a new script in this folder, do <span>the following:</span></p>
<ol class="calibre14">
<li class="calibre15">Make sure the <strong class="source-inline">Scripts</strong> folder is the currently selected folder in the <span><strong class="bold">Project</strong></span><span> window.</span></li>
<li class="calibre15">Right-click within the <strong class="bold">Project</strong> window to open the <strong class="bold">Create</strong> menu (or use the <strong class="bold">+</strong> <span>button).</span></li>
<li class="calibre15">Select <span><strong class="bold">C# Script</strong></span><span>.</span></li>
<li class="calibre15">Rename the script from its default name of <strong class="bold">NewBehaviour</strong> to <strong class="source-inline">PlayerController</strong> (it’s currently highlighted to make naming it right <span>away easier).</span></li>
</ol>
<p class="callout-heading">Tip</p>
<p class="callout">Do not use any spaces in your script filenames or start the script’s name with a number. Both are naming rule violations for C# classes, so your script will not work. You can use the underscore character in place of spaces. However, this naming convention style is generally frowned upon in the developer community – unless it is the first character of the name for private member variables (which is a common convention in C# and used in <span>this book).</span></p>
<p class="callout">As a reference for a good naming convention standard to use – and stick to (because consistency and good naming improve code readability for everyone) – check out the following <span>guide: </span><span>https://</span><a href="https://www.c-sharpcorner.com/UploadFile/8a67c0/C-Sharp-coding-standards-and-naming-conventions/" class="pcalibre1 pcalibre calibre6"><span>https://www.c-sharpcorner.com/UploadFile/8a67c0/C-Sharp-coding-standards-and-naming-conventions/</span></a></p>
<p class="calibre3">You can <a id="_idIndexMarker184" class="pcalibre1 pcalibre calibre6"/>also add new scripts (that is, components) to GameObjects directly in the <strong class="bold">Inspector</strong> window through the <strong class="bold">Add Component</strong> button at the bottom of the window (and when you currently have a GameObject selected). Click the <strong class="bold">Add Component</strong> button, and then select <strong class="bold">New </strong><span><strong class="bold">Script &gt;</strong></span><span>.</span></p>
<p class="calibre3">You’ll be prompted to enter the script name, and then click <strong class="bold">Create and Add</strong>. You cannot choose the location to save the script with this method – it saves the script in the root of the <strong class="source-inline">Assets</strong> folder – so I prefer the methods previously mentioned to create in a <span>specific folder.</span></p>
<p class="calibre3">New scripts are generated from the default template Unity provides (you can modify the template to suit your personal needs; see the following <em class="italic">C# Script Templates</em> callout box). New scripts are also given the <strong class="source-inline">.cs</strong> file extension, denoting them as C# script files (file extensions are not visible in the Unity <span><strong class="bold">Project</strong></span><span> window).</span></p>
<p class="calibre3">We’ve named it <strong class="source-inline">PlayerController</strong> here, because the first C# code we’ll be writing in the next section is to give the ladybug player character we previously created the ability to move around from <span>player input.</span></p>
<p class="callout-heading">C# script templates – Unity documentation</p>
<p class="callout">Script templates <a id="_idIndexMarker185" class="pcalibre1 pcalibre calibre6"/>are what Unity uses to generate the default C# code when new scripts are created, providing commonly used code as a starting point for your scripts. You can modify the templates with your own changes, additions, notes, and <span>so on.</span></p>
<p class="callout">Additional <a id="_idIndexMarker186" class="pcalibre1 pcalibre calibre6"/>information can be found <span>here: </span><a href="https://support.unity.com/hc/en-us/articles/210223733-How-to-customize-Unity-script-templates%0D" class="pcalibre1 pcalibre calibre6"><span>https://support.unity.com/hc/en-us/articles/210223733-How-to-customize-Unity-script-templates</span></a></p>
<p class="calibre3">Unity has also named the class in the script <strong class="source-inline">PlayerController</strong> as part of the script generation process (a function provided by the script template). Note that the filename and the class name must match for scripts that will need to be added as Components to GameObjects (otherwise, you’ll get a <strong class="bold">Can’t add script component ‘ScriptName’ because the script class cannot be found.</strong> error if you try). Refer to <span><em class="italic">Figure 2</em></span><em class="italic">.14</em> for an example of a new <span>script’s contents.</span></p>
<p class="calibre3">VS2022 is <a id="_idIndexMarker187" class="pcalibre1 pcalibre calibre6"/>installed and configured as the default script editor for the C# scripts in your project when the Unity Editor is installed. You can verify this by going to <strong class="bold">Edit</strong> | <strong class="bold">Preferences…</strong> and selecting <strong class="bold">External Tools</strong> – the <strong class="bold">External Script Editor</strong> dropdown will be set to <strong class="bold">Microsoft Visual Studio </strong><span><strong class="bold">2022 [version]</strong></span><span>.</span></p>
<p class="calibre3">Now that we have a script created and confirmed our script editor is configured, editing the script is as simple as doing any of <span>the following:</span></p>
<ul class="calibre17">
<li class="calibre15">Double-clicking on scripts in the <span><strong class="bold">Project</strong></span><span> Window.</span></li>
<li class="calibre15">For components added to GameObjects in the Scene, right-clicking on the component in the <strong class="bold">Inspector</strong> window (or using the vertical ellipsis menu) and selecting <span><strong class="bold">Edit Script</strong></span><span>.</span></li>
<li class="calibre15">Opening from within VS using the <strong class="bold">Unity Project </strong><span><strong class="bold">Explorer</strong></span><span> window.</span></li>
</ul>
<p class="calibre3">We have learned how to create a new script and open it for editing in VS, but we still need to understand what the C# code we’re looking at means. In the next section, let’s dissect the generated C# code for the player <span>controller script.</span></p>
<h2 id="_idParaDest-51" class="calibre8"><a id="_idTextAnchor051" class="pcalibre1 pcalibre calibre6"/>The C# Language – Object-oriented programming (OOP)</h2>
<p class="calibre3">Unity provides <a id="_idIndexMarker188" class="pcalibre1 pcalibre calibre6"/>coding support through the open source .NET <strong class="bold">Common Language Runtime</strong> (<strong class="bold">CLR</strong>) and uses the C# language – these are <a id="_idIndexMarker189" class="pcalibre1 pcalibre calibre6"/>Microsoft technologies. C# is a managed language, which means that it provides a safe coding environment by – mostly – managing memory and the CLR safely executing the code (that is, not bytecode being executed by the operating <span>system directly).</span></p>
<p class="calibre3">Code can be <a id="_idIndexMarker190" class="pcalibre1 pcalibre calibre6"/>compiled to run <strong class="bold">just-in-time</strong> (<strong class="bold">JIT</strong>) or <strong class="bold">ahead-of-time</strong> (<strong class="bold">AOT</strong>), depending <a id="_idIndexMarker191" class="pcalibre1 pcalibre calibre6"/>on which of the two scripting backends that Unity provides is used – Mono or <strong class="bold">Intermediate Language to C++</strong> (<strong class="bold">IL2CPP</strong>). The <a id="_idIndexMarker192" class="pcalibre1 pcalibre calibre6"/>primary difference here is in compilation time, but some platform builds require one or <span>the other.</span></p>
<p class="callout-heading">Unity is a C++ game engine</p>
<p class="callout">The Unity game <a id="_idIndexMarker193" class="pcalibre1 pcalibre calibre6"/>engine is written in C++, but C# is used as a “more friendly” coding language. The Unity Object type in C# is linked to a native C++ <span>counterpart object.</span></p>
<p class="calibre3">Okay, the preceding paragraph was pretty boring. So, now comes the obligatory nerd warning… we’re going to talk about some programming concepts, principles, and design patterns in this and the next two sections. While these won’t teach you the basics of how to write a section of code that loops or even evaluates variables, I feel they are an important introduction at the onset of a <span>developer’s journey.</span></p>
<p class="calibre3">It’s essential <a id="_idIndexMarker194" class="pcalibre1 pcalibre calibre6"/>to not only learn the basics (such as how to write code that loops and evaluates variables) but also to understand the broader concepts of how code should be structured – for the sake of your future developer self (and possibly for the benefit of your future <span>developer teammates).</span></p>
<p class="calibre3">While I’ve attempted to make this section concise and provide relatable real-world analogies, these broader concepts on how code should be structured may be too early an introduction for some of you, so, in that case, don’t be afraid – still have a read and do your best to understand, but don’t worry if <span>it’s difficult.</span></p>
<p class="calibre3">We’ll be implementing all of this as we work through the projects in the book (maybe you’ll even recall some of what was stated here or will want to come back <span>and reread).</span></p>
<p class="calibre3">Okay, with that now out of the way, let’s dive into the concepts that will level up your coding skills on your journey as a <span>Unity developer!</span></p>
<h3 class="calibre10">The C# language</h3>
<p class="calibre3">C# (pronounced as <em class="italic">C sharp</em>) is a <a id="_idIndexMarker195" class="pcalibre1 pcalibre calibre6"/>modern, object-oriented, type-safe, managed <a id="_idIndexMarker196" class="pcalibre1 pcalibre calibre6"/>programming language. <strong class="bold">Object-oriented programming</strong> is a computer programming model that organizes software design around objects, which can contain data and code (classes) rather than functions <span>and logic.</span></p>
<p class="calibre3">C# primarily being a type-safe language means that specific types can only interact through their defined protocols, which ensures each type’s consistency. For instance, you cannot write <a id="_idIndexMarker197" class="pcalibre1 pcalibre calibre6"/>code to interact with a string type the same as if it were a <span>number type.</span></p>
<p class="calibre3">OOP has four basic concepts for working with objects. We’ll review them briefly now and apply these concepts in practice while writing the code for our game in the <span>upcoming chapters:</span></p>
<ul class="calibre17">
<li class="calibre15"><strong class="bold">Encapsulation</strong>: Hide the internal data and behavior of an object (class) from other objects <a id="_idIndexMarker198" class="pcalibre1 pcalibre calibre6"/>and only allow access through public methods; preventing objects from modifying other objects directly reduces the chance of making mistakes external to <span>the object.</span></li>
<li class="calibre15"><strong class="bold">Abstraction</strong>: An incomplete implementation that hides specific details and only provides <a id="_idIndexMarker199" class="pcalibre1 pcalibre calibre6"/>required information but is also not associated with any particular instance, since an abstract class is intended only to be a base class of other classes. It provides a template to organize an object hierarchy with required details, such as a spotlight (object) being a type of light (abstract class) that requires a <span>brightness property.</span></li>
<li class="calibre15"><strong class="bold">Inheritance</strong>: Abstraction is possible due to inheritance because a derived class inherits all <a id="_idIndexMarker200" class="pcalibre1 pcalibre calibre6"/>properties and methods of the base class when creating a new class from it, which means we can reuse, extend, and modify the behavior of the base class. In the preceding light example, a point light will have the same brightness property as the spotlight if both are inherited from the light abstract <span>base class.</span></li>
<li class="calibre15"><strong class="bold">Polymorphism</strong>: This is <a id="_idIndexMarker201" class="pcalibre1 pcalibre calibre6"/>a Greek word, meaning <em class="italic">one name with many forms</em> or <em class="italic">having many forms</em>, which we can apply in C# to mean one name with multiple functions. Polymorphism allows a class to have multiple implementations with the same name by overriding it, thanks <span>to inheritance.</span></li>
</ul>
<p class="calibre3">Continuing with the preceding light example, we can implement inherited methods from the base class differently across the spotlight and point light abstractions by having different code for a <strong class="source-inline">ChangeLightRadius()</strong> method – a spotlight has a <em class="italic">cone </em><span><em class="italic">of light</em></span><span>.</span></p>
<p class="calibre3">In contrast, a point light is omnidirectional, so it behaves differently. Polymorphism <a id="_idIndexMarker202" class="pcalibre1 pcalibre calibre6"/>helps in code reuse since classes, once written, tested, and implemented, can be reused as required and save a lot of time while keeping things more <span>logically structured.</span></p>
<p class="callout-heading">Additional reading | C#</p>
<p class="callout"><strong class="bold">Microsoft C# documentation for object-oriented </strong><span><strong class="bold">programming</strong></span><span>: </span><a href="https://learn.microsoft.com/en-us/dotnet/csharp/fundamentals/object-oriented/" class="pcalibre1 pcalibre calibre6"><span>https://learn.microsoft.com/en-us/dotnet/csharp/fundamentals/object-oriented/</span></a></p>
<h3 class="calibre10">The MonoBehaviour class</h3>
<p class="calibre3">The <strong class="source-inline">MonoBehaviour</strong> class is <a id="_idIndexMarker203" class="pcalibre1 pcalibre calibre6"/>the base class that every Unity script assignable to a GameObject derives from – this is Unity’s <strong class="bold">component-based architecture</strong>. You’ve <a id="_idIndexMarker204" class="pcalibre1 pcalibre calibre6"/>seen the word <em class="italic">class</em> mentioned previously, so for clarity, a class is an object type. You will be creating custom object types that group variables, methods, and events together to give your script data and provide its <span>intended function.</span></p>
<p class="calibre3">Deriving the class from <strong class="source-inline">MonoBehaviour</strong> – due to inheritance – provides a base set of variables, methods, and events for components added to GameObjects; this is also a requirement – you cannot add a script to a GameObject unless it inherits from <strong class="source-inline">MonoBehaviour</strong>. We’ll be using the functionality the <strong class="source-inline">MonoBehaviour</strong> base class provides for our custom script components throughout the projects in <span>the book.</span></p>
<p class="callout-heading">Important note</p>
<p class="callout">Due to the nature of the <strong class="source-inline1">MonoBehaviour</strong> class requiring it to be an instance of an object in the <strong class="bold">Scene Hierarchy</strong>, you cannot use the <strong class="source-inline1">new</strong> keyword to create a new instance of it, as you could for a class that does not derive <span>from anything.</span></p>
<p class="calibre3">The code for the new <strong class="source-inline">PlayerController</strong> class we created previously, as generated from the default Unity template, already derives from <strong class="source-inline">MonoBehaviour</strong> for us – as denoted by <strong class="source-inline">:</strong> just after the <strong class="source-inline">public class</strong> declaration line in <span>the following:</span></p>
<pre class="source-code">
using UnityEngine;
public class PlayerController : MonoBehaviour
{
    // Start is called before the first frame update
    void Start()
    {
    }
    // Update is called once per frame
    void Update()
    {
    }
}</pre> <p class="callout-heading">// (C#) | Code commenting</p>
<p class="callout">A single-line <strong class="bold">comment</strong> is started <a id="_idIndexMarker205" class="pcalibre1 pcalibre calibre6"/>with two forward slashes (<strong class="source-inline1">//</strong>). The C# compiler will strip out this text and ignore it when running <span>the program.</span></p>
<p class="callout">Don’t be <a id="_idIndexMarker206" class="pcalibre1 pcalibre calibre6"/>afraid to comment on anything and everything in the code to clarify the intent. There are always at least two people looking at your code when programming – you and yourself in 6 months’ time (or sometimes on any Monday morning). You <em class="italic">will</em> forget why you did what <span>you did.</span></p>
<p class="callout"><strong class="bold">Self-commenting code</strong>/<strong class="bold">self-documenting code</strong> is something that you may hear when <a id="_idIndexMarker207" class="pcalibre1 pcalibre calibre6"/>discussing the topic of code commenting, which relies on <a id="_idIndexMarker208" class="pcalibre1 pcalibre calibre6"/>good class, method, and variable naming. This, of course, is important. Still, my opinion is that you can spend an awful lot of time deliberating what to name things – while interrupting your train of thought – where a simple few words in a comment can instead bring quick clarity to the <span>desired intention.</span></p>
<p class="calibre3">The <strong class="source-inline">Start()</strong> and <strong class="source-inline">Update()</strong> methods are also provided for us. <strong class="source-inline">MonoBehaviour</strong> provides Message events for initializing any code in <strong class="source-inline">Start()</strong> and running code on each frame update in <strong class="source-inline">Update()</strong>. There are several other Message events that <strong class="source-inline">MonoBehaviour</strong> provides, and we’ll be exploring them in the <span>upcoming chapters.</span></p>
<p class="callout-heading">namespace (C#)</p>
<p class="callout"><strong class="source-inline1">using UnityEngine;</strong> at the top of the preceding <strong class="source-inline1">PlayerController</strong> code example is what gives the containing code access to the <strong class="source-inline1">MonoBehaviour</strong> base class. <strong class="bold">Namespaces</strong> are a <a id="_idIndexMarker209" class="pcalibre1 pcalibre calibre6"/>way of organizing and providing levels of separation in your code. They are handy for providing containers to control the scope of classes and methods in larger projects. You can, and should, add your own namespaces to <span>your classes.</span></p>
<p class="calibre3">With the basics <a id="_idIndexMarker210" class="pcalibre1 pcalibre calibre6"/>of understanding how to create a new C# script, open it in the VS IDE, and identify the essential parts of a <strong class="source-inline">MonoBehaviour</strong>-derived class out of the way, we can now explore some best-practice principles to follow as we write code for our game with <span>SOLID principles.</span></p>
<h2 id="_idParaDest-52" class="calibre8"><a id="_idTextAnchor052" class="pcalibre1 pcalibre calibre6"/>SOLID principles</h2>
<p class="calibre3"><strong class="bold">SOLID</strong> is an acronym <a id="_idIndexMarker211" class="pcalibre1 pcalibre calibre6"/>adopted to represent the first five principles of object-oriented design by Robert C. Martin and applies to various programming languages, not just C#. They are basic design principles to keep the code you write maintainable and extensible while avoiding refactoring (restructuring existing code) unnecessarily in the future. The resulting code should be easily read and followed by other developers – avoid writing <span>spaghetti code!</span></p>
<p class="callout-heading">Spaghetti code</p>
<p class="callout"><strong class="bold">Spaghetti code</strong> is a phrase <a id="_idIndexMarker212" class="pcalibre1 pcalibre calibre6"/>used to describe unstructured and difficult-to-understand-and-maintain source code in your projects. The cause can be attributed to several factors, which usually boil down to not following best practices such as SOLID principles, <strong class="bold">don’t repeat yourself</strong> (<strong class="bold">DRY</strong>), and clean code – code that is formatted correctly and organized in a manner that is easily read or modified by others, or by yourself in 6 <span>months’ time!</span></p>
<p class="calibre3">The SOLID principles are <span>as follows:</span></p>
<ul class="calibre17">
<li class="calibre15"><strong class="bold">S – </strong><strong class="bold">single-responsibility principle</strong><strong class="bold">(SRP)</strong>: Each class or function (a <em class="italic">function</em> for a <a id="_idIndexMarker213" class="pcalibre1 pcalibre calibre6"/>language-agnostic term, but I will refer to functions in C# as methods) in your code should only have a <span>single responsibility.</span></li>
</ul>
<p class="calibre3">It means <em class="italic">do one thing</em> and not everything, including the kitchen sink! Everything within the class should contribute to the one reason it exists. Multiple single-function classes can work together to complete larger, more complex tasks. If something breaks, it’s generally easier to know where the bug exists, and it will also be isolated from <span>that class.</span></p>
<ul class="calibre17">
<li class="calibre15"><strong class="bold">O – </strong><strong class="bold">open-closed principle</strong><strong class="bold"> (OCP)</strong>: Classes can be extended but <span>not modified.</span></li>
</ul>
<p class="calibre3">No, this is <a id="_idIndexMarker214" class="pcalibre1 pcalibre calibre6"/>not a contradiction; how can something be both open and closed simultaneously? Well, it means that a class should be open for extension but closed for modification. Through polymorphism, we can change the behavior of an abstract base class by the inheriting class while leaving the base class unmodified. By designing base classes that <em class="italic">never change</em>, you prevent undesirable changes that propagate to dependent classes, contributing to code that is not reusable and ultimately harder to <span>work with.</span></p>
<ul class="calibre17">
<li class="calibre15"><strong class="bold">L – </strong><strong class="bold">Liskov substitution principle</strong>: Methods that reference base classes must be <a id="_idIndexMarker215" class="pcalibre1 pcalibre calibre6"/>able to use derived <span>classes seamlessly.</span></li>
</ul>
<p class="calibre3">Any function that uses a reference to a base class should be able to use a derivative of that class without knowing it. That might sound a bit confusing, so let’s use the light example from the earlier OOP concepts – a method that references a light should not care whether that light is a spotlight or a point light. We can substitute a point light for a spotlight, and the code should <span>just work.</span></p>
<p class="calibre3">We can accomplish this substitution through the use of an <strong class="bold">interface</strong> (a type that is similar to a class, but it only represents a structure of declarations – this is commonly referred to as a <strong class="bold">contract</strong>, but you can also think of it as a <em class="italic">blueprint for a </em><span><em class="italic">class definition</em></span><span>).</span></p>
<p class="calibre3">An interface can <a id="_idIndexMarker216" class="pcalibre1 pcalibre calibre6"/>also be used to implement the <strong class="bold">open-closed principle</strong> by having a base class take an interface as an abstract reference for injecting different functionality. The functionality can be extended while the reference in the closed base class remains <span>the same.</span></p>
<ul class="calibre17">
<li class="calibre15"><strong class="bold">I – </strong><strong class="bold">Interface segregation principle</strong>: Several smaller scope interfaces are preferred <a id="_idIndexMarker217" class="pcalibre1 pcalibre calibre6"/>over a single <span>monolithic interface.</span></li>
</ul>
<p class="calibre3">Classes should not include behaviors they do not use in their single-responsibility role. In Martin’s original introduction, he describes it as a <em class="italic">disadvantage of fat interfaces</em>, where the functions of a large multipurpose interface can instead be broken up into groups of member functions to provide better cohesion. This can prevent classes from using interfaces that they do not require <span>to function.</span></p>
<ul class="calibre17">
<li class="calibre15"><strong class="bold">D – </strong><strong class="bold">Dependency inversion principle</strong>: Use abstractions over direct <span>class references.</span></li>
</ul>
<p class="calibre3">This last <a id="_idIndexMarker218" class="pcalibre1 pcalibre calibre6"/>principle states that concrete classes should depend upon interfaces – or abstract functions and classes – rather than concrete functions and classes. Abstract classes should also not depend on concrete classes; interfaces should be used here. The advantage here means code requires less work to change because the interface abstractions decouple concrete classes – a change in one also does not break the other. Loosely coupled code is more flexible and easier to <span>test. Yay!</span></p>
<p class="callout-heading">Additional reading | SOLID principles</p>
<p class="callout">To read the original quotes and ideas behind the SOLID principles, as introduced by Robert C. Martin, you can refer to this <span>article: </span><a href="https://learn.microsoft.com/en-us/archive/msdn-magazine/2014/may/csharp-best-practices-dangers-of-violating-solid-principles-in-csharp" class="pcalibre1 pcalibre calibre6"><span>https://learn.microsoft.com/en-us/archive/msdn-magazine/2014/may/csharp-best-practices-dangers-of-violating-solid-principles-in-csharp</span></a></p>
<p class="callout">Alternatively, just do some web searching on the <span>subject: </span><a href="https://www.google.com/search?q=SOLID+programming+principles%0D" class="pcalibre1 pcalibre calibre6"><span>https://www.google.com/search?q=SOLID+programming+principles</span></a></p>
<p class="calibre3">After this <a id="_idIndexMarker219" class="pcalibre1 pcalibre calibre6"/>brief introduction, you may not completely understand these principles, but don’t worry – we’ll be using them in practice in the upcoming chapters, so you will learn how they are implemented. With a basic understanding of the SOLID principles, we can now talk about design patterns that implement the ideas the SOLID <span>principles present.</span></p>
<h2 id="_idParaDest-53" class="calibre8"><a id="_idTextAnchor053" class="pcalibre1 pcalibre calibre6"/>Design patterns</h2>
<p class="calibre3">Now that you know what the C# language is and some principles to keep in mind while coding your games, let’s see how to apply them <span>in practice.</span></p>
<p class="calibre3">When writing the <a id="_idIndexMarker220" class="pcalibre1 pcalibre calibre6"/>code for your game, you can make your own decisions on how to approach the architecture. Within Unity, there aren’t any restrictions or specific ways things need to be set up – it can be as messy or as organized as <span>you like.</span></p>
<p class="calibre3">However, it should be evident that the more disorganized and unstructured your code is, the harder it will be to work with and extend upon in the future. We’ve already touched on some fundamental principles with OOP and SOLID, but those are just principles to follow. To execute those principles, we use <span>design patterns.</span></p>
<h3 class="calibre10">Common design patterns in games development</h3>
<p class="calibre3">The following <a id="_idIndexMarker221" class="pcalibre1 pcalibre calibre6"/>is a list of common design patterns used to solve common problems when writing code – this is not an extensive list by any means, and we’re only touching on the reasons for the <span>patterns here:</span></p>
<ul class="calibre17">
<li class="calibre15"><strong class="bold">Singleton pattern (a “singleton”)</strong>: One of the most popular design patterns in software <a id="_idIndexMarker222" class="pcalibre1 pcalibre calibre6"/>and games. This pattern creates a <a id="_idIndexMarker223" class="pcalibre1 pcalibre calibre6"/>single instance of the desired class using a static variable (a single copy of a variable is created and accessible from all objects simply by the declaring class name) – for example, <strong class="source-inline">MyClass.Instance.MyMember</strong> (where <strong class="source-inline">Instance</strong> is the static variable and <strong class="source-inline">MyMember</strong> is any publicly accessible variable <span>or method).</span></li>
</ul>
<p class="calibre3">This pattern gets a bad reputation for misuse, but it can be pretty helpful for small projects – it’s quick and easy to implement and use everywhere (hello, game jams!). This reputation is mainly related to more extensive projects where static variables <a id="_idIndexMarker224" class="pcalibre1 pcalibre calibre6"/>make for code that’s harder to troubleshoot <a id="_idIndexMarker225" class="pcalibre1 pcalibre calibre6"/>and debug – the general sentiment is that when you make something accessible to every part of the code, you’re just asking <span>for trouble!</span></p>
<ul class="calibre17">
<li class="calibre15"><strong class="bold">Service locator pattern</strong> (a better alternative?): Unity uses this pattern as part of its <a id="_idIndexMarker226" class="pcalibre1 pcalibre calibre6"/>component structure by using the <strong class="source-inline">GetComponent()</strong> method of its GameObject scripting API. Essentially, the <a id="_idIndexMarker227" class="pcalibre1 pcalibre calibre6"/>locator will retrieve the reference to the required class or object instance so that it can be consumed in the <span>calling method.</span></li>
<li class="calibre15"><strong class="bold">Observer pattern (events)</strong>: Another one of the most popular design patterns. This pattern enables a listener to register with and receive notifications <a id="_idIndexMarker228" class="pcalibre1 pcalibre calibre6"/>from a provider. This is generally performed with a one-to-many relationship, where any number of listeners are notified when <a id="_idIndexMarker229" class="pcalibre1 pcalibre calibre6"/>the provider object changes state and invokes the notification. This pattern in C# is implemented using events. An event is a special keyword in C# that enforces a proper pattern, where only the declaring class can invoke <span>the notification.</span></li>
<li class="calibre15"><strong class="bold">State pattern/</strong><strong class="bold">finite state machine</strong><strong class="bold"> (FSM)</strong>: This <a id="_idIndexMarker230" class="pcalibre1 pcalibre calibre6"/>pattern allows <a id="_idIndexMarker231" class="pcalibre1 pcalibre calibre6"/>an object to change its behavior – and/or <a id="_idIndexMarker232" class="pcalibre1 pcalibre calibre6"/>appearance (think of a GameObject in a Scene) – when <a id="_idIndexMarker233" class="pcalibre1 pcalibre calibre6"/>its state is changed to one of a finite set of predefined states. A typical use case would be for a <strong class="source-inline">GameManager</strong> class, where you could have states for loading, playing, paused, game over, win, lose, and so on. Events can be triggered when entering and exiting states to extend state-based functionality easily. The <a id="_idIndexMarker234" class="pcalibre1 pcalibre calibre6"/>object the pattern is implemented <a id="_idIndexMarker235" class="pcalibre1 pcalibre calibre6"/>on can also delegate state-related <a id="_idIndexMarker236" class="pcalibre1 pcalibre calibre6"/>behavior to separate classes, such as a <strong class="source-inline">Tick()</strong> method <a id="_idIndexMarker237" class="pcalibre1 pcalibre calibre6"/>called on every <span>frame update.</span></li>
<li class="calibre15"><strong class="bold">Command pattern</strong>: This pattern turns a request for executing functions into an object <a id="_idIndexMarker238" class="pcalibre1 pcalibre calibre6"/>that contains all the required information about the request. The command pattern is popular in C# for when we <a id="_idIndexMarker239" class="pcalibre1 pcalibre calibre6"/>want to delay or queue a request’s execution, or when we would want to keep track of the sequence of operations (such as in a <span>replay system).</span></li>
</ul>
<p class="calibre3">The other benefit of this pattern is that it decouples the invoking class from the object that executes the process – loosely coupled code (one class will not affect another class, reducing dependency) is easier to test <span>and maintain!</span></p>
<ul class="calibre17">
<li class="calibre15"><strong class="bold">Manager pattern</strong>: This pattern serves to manage the multiple – usually many – instances of <a id="_idIndexMarker240" class="pcalibre1 pcalibre calibre6"/>another type of object while providing access to <a id="_idIndexMarker241" class="pcalibre1 pcalibre calibre6"/>the instances that are being managed. If you have thousands of objects being instantiated in your Scene, with scripts defining an <strong class="source-inline">Update()</strong> method, each one is added to a list of scripts that need to be updated in <span>each frame.</span></li>
</ul>
<p class="calibre3">This pattern can reduce the number of <strong class="source-inline">Update()</strong> methods being called each frame to reduce overhead – these Unity messages are called from native C++ to managed C#, and they have a cost! For example, the manager will be the only object with an <strong class="source-inline">Update()</strong> method that runs on each frame update, while the many instances referenced only have a <strong class="source-inline">Tick()</strong> method that the <span>manager calls.</span></p>
<p class="callout-heading">Additional reading | Programming patterns</p>
<p class="callout"><strong class="bold">Game Programming Patterns</strong> (the web <a id="_idIndexMarker242" class="pcalibre1 pcalibre calibre6"/>version is <span>free): </span><a href="https://gameprogrammingpatterns.com/contents.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://gameprogrammingpatterns.com/contents.xhtml</span></a></p>
<p class="callout-heading">Optimization note</p>
<p class="callout">If you don’t need to use the Unity message events, then remove them from your code – even empty <strong class="source-inline1">Start()</strong> and <strong class="source-inline1">Update()</strong> methods are still cached and called on every script derived from <strong class="source-inline1">MonoBehaviour</strong>, and in the case of <strong class="source-inline1">Update()</strong>, it will be called on every <span>frame update!</span></p>
<p class="calibre3">In this section, you learned about creating scripts and editing them with the VS2022 IDE and received <a id="_idIndexMarker243" class="pcalibre1 pcalibre calibre6"/>an introduction to the C# language, SOLID principles, and some common <span>design patterns.</span></p>
<p class="calibre3">We’ll dig into specific use cases in the upcoming chapters as we flesh out the features and functionality in our collection game, starting with the next section, where we’ll put together a simple player controller for our <span>ladybug character.</span></p>
<h1 id="_idParaDest-54" class="calibre5"><a id="_idTextAnchor054" class="pcalibre1 pcalibre calibre6"/>Coding a simple player controller with the new Input System</h1>
<p class="calibre3">You’ll be <a id="_idIndexMarker244" class="pcalibre1 pcalibre calibre6"/>surprised to find that most of the <a id="_idIndexMarker245" class="pcalibre1 pcalibre calibre6"/>work to make our player character move has already been done for us by Unity’s features. The features that we’ll be looking at in this section are <span>as follows:</span></p>
<ul class="calibre17">
<li class="calibre15"><strong class="bold">The new Input System</strong>: For receiving keyboard device input from <span>the player.</span></li>
<li class="calibre15"><strong class="bold">2D physics engine</strong>: For translating input values into movement and providing interaction with objects in <span>the environment.</span></li>
</ul>
<h2 id="_idParaDest-55" class="calibre8"><a id="_idTextAnchor055" class="pcalibre1 pcalibre calibre6"/>New Input System</h2>
<p class="calibre3">The new <strong class="bold">Input System</strong> is a package <a id="_idIndexMarker246" class="pcalibre1 pcalibre calibre6"/>that provides input device support for <a id="_idIndexMarker247" class="pcalibre1 pcalibre calibre6"/>controlling objects in your project in a flexible and configurable way. It also replaces the legacy Input Manager. We’ll first want to make sure that it’s installed to <span>use it:</span></p>
<ol class="calibre14">
<li class="calibre15">Open the Package Manager from the <strong class="bold">File</strong> menu by going to <strong class="bold">Windows</strong> | <strong class="bold">Package Manager</strong> and following <span>these steps.</span></li>
<li class="calibre15">Make sure the <strong class="bold">Packages</strong> drop-down list is set to <strong class="bold">Package: Unity Registry</strong> (just under the <span>window’s tab).</span></li>
<li class="calibre15">Find <strong class="bold">Input System</strong> in the list of packages (the dialog’s left side) and click to <span>select it.</span></li>
<li class="calibre15">Now, click the <strong class="bold">Install</strong> button in the window’s <span>bottom-right corner.</span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer034">
<img alt="Figure 2.15 – The Input System installation Package Manager" src="image/B18347_02_15.jpg" class="calibre40"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 2.15 – The Input System installation Package Manager</p>
<p class="calibre3">If, once the installation completes, you receive a warning stating <strong class="bold">The project is using the new input system package, but the native platform backends for the new input system are not enabled in player settings</strong>, go ahead and click <strong class="bold">Yes</strong> to enable the backends. Note that this will restart the Editor – so, if you have unsaved changes in your Scene, click <strong class="bold">Save</strong> <span>when prompted.</span></p>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><strong class="bold">Input </strong><span><strong class="bold">System</strong></span><span>: </span><a href="https://docs.unity3d.com/Packages/com.unity.inputsystem%401.3/manual/" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/Packages/com.unity.inputsystem%401.3/manual/</span></a></p>
<p class="calibre3">We’re ready <a id="_idIndexMarker248" class="pcalibre1 pcalibre calibre6"/>to start coding our player movement in the next section with the Input <span>System installed.</span></p>
<h2 id="_idParaDest-56" class="calibre8"><a id="_idTextAnchor056" class="pcalibre1 pcalibre calibre6"/>Player controller script</h2>
<p class="calibre3">Before we <a id="_idIndexMarker249" class="pcalibre1 pcalibre calibre6"/>jump into coding, we’ll first need to understand that there are two ways we can work with the new <span>Input System:</span></p>
<ul class="calibre17">
<li class="calibre15">Receiving input directly from an <span><strong class="bold">Input Device</strong></span></li>
<li class="calibre15">Receiving input through an <strong class="bold">Input </strong><span><strong class="bold">Action</strong></span><span> indirectly</span></li>
</ul>
<p class="calibre3">We’ll cover both of these approaches in the book, but we’ll start with reading directly from an Input Device – the keyboard. Having determined our approach to receiving player input, let’s start coding that now, since we’ve already created our ladybug character’s player controller script in a <span>previous section.</span></p>
<h3 class="calibre10">Receiving keyboard input</h3>
<p class="calibre3">Processing <a id="_idIndexMarker250" class="pcalibre1 pcalibre calibre6"/>player input through the keyboard directly from the Input Device is straightforward. You simply need to get a reference to the current keyboard device and read the property appropriate for the desired function. We read input in the <strong class="source-inline">Update()</strong> method because it runs <span>every frame.</span></p>
<p class="calibre3">Let’s have a look at this portion of the <strong class="source-inline">Update()</strong> method in the following <span><strong class="source-inline">PlayerController</strong></span><span> code:</span></p>
<pre class="source-code">
    // Update is called once per frame - process input
    void Update()
    {
        var keyboard = Keyboard.current;
        // Keyboard connected?
        if (keyboard == null)
            return;     // No - stop running code.
        if (keyboard.spaceKey.IsPressed())
        {
            // Move while holding spacebar key down.
            …</pre> <p class="calibre3">Within the <strong class="source-inline">Update()</strong> method (between the <strong class="source-inline">{}</strong> squiggly brackets), we start by assigning a <a id="_idIndexMarker251" class="pcalibre1 pcalibre calibre6"/>variable (a container for storing data) for the current keyboard device with <strong class="source-inline">var keyboard = Keyboard.current;</strong> (in C#, every line of code to be executed must end in <span>a semicolon).</span></p>
<p class="callout-heading">var (C#)</p>
<p class="callout">The <strong class="source-inline1">var</strong> keyword is an <a id="_idIndexMarker252" class="pcalibre1 pcalibre calibre6"/>implicitly typed variable that infers the type from the right side of the assignment statement (what comes after the equals sign). This means that we don’t need to use an <strong class="source-inline1">int</strong> type for a math expression that returns an integer value – <strong class="source-inline1">var</strong> will infer that it should be of an <span><strong class="source-inline1">int</strong></span><span> type.</span></p>
<p class="calibre3"><strong class="source-inline">Keyboard.current</strong> is available to our code from the Input System, simply by including the namespace for <strong class="source-inline">InputSystem</strong> at the top of our script with the <span><strong class="source-inline">using</strong></span><span> keyword:</span></p>
<pre class="source-code">
using UnityEngine;
using UnityEngine.InputSystem;
public class PlayerController : MonoBehaviour
{
    …</pre> <p class="calibre3">Once the current keyboard device is assigned to our keyboard variable, we can check to make sure a keyboard is connected by testing the variable against a <strong class="source-inline">null</strong> value, using the <strong class="source-inline">== operator</strong> (a single <strong class="source-inline">=</strong> is for assigning a value, whereas a double <strong class="source-inline">==</strong> is an <em class="italic">is </em><span><em class="italic">equal?</em></span><span> operation).</span></p>
<p class="calibre3">Here, we can see that if the keyboard value is equal to <strong class="source-inline">null</strong>, we stop running the code in this <a id="_idIndexMarker253" class="pcalibre1 pcalibre calibre6"/>method immediately by using the <span><strong class="source-inline">return</strong></span><span> keyword:</span></p>
<pre class="source-code">
        // Keyboard connected?
        if (keyboard == null)
            return;     // No - stop running code.
        …</pre> <p class="callout-heading">null (C#)</p>
<p class="callout">The <strong class="source-inline1">null</strong> value <a id="_idIndexMarker254" class="pcalibre1 pcalibre calibre6"/>means there is <em class="italic">no </em><span><em class="italic">object</em></span><span> assigned.</span></p>
<p class="calibre3">The last part of the code snippet we’ll be looking at here to receive input from the keyboard is checking whether a specified key is currently being held down. We do this by simply stating which key we’re interested in – <strong class="source-inline">spaceKey</strong> – and evaluating the value returned from the <strong class="source-inline">IsPressed()</strong> method to see whether it <span>is </span><span><strong class="source-inline">true</strong></span><span>:</span></p>
<pre class="source-code">
        if (keyboard.spaceKey.IsPressed())
        {
            // Move while holding spacebar key down.
            …</pre> <p class="callout-heading">if (C#)</p>
<p class="callout">An <strong class="source-inline1">if</strong> statement tests <a id="_idIndexMarker255" class="pcalibre1 pcalibre calibre6"/>whether a condition is evaluated to <strong class="source-inline1">true</strong> or <strong class="source-inline1">false</strong> and executes the directly preceding block or line of code <span>if </span><span><strong class="source-inline1">true</strong></span><span>.</span></p>
<p class="callout">In C#, a variable type that holds a <strong class="source-inline1">true</strong> or <strong class="source-inline1">false</strong> value is called a <strong class="source-inline1">bool</strong> type (Boolean). A <strong class="source-inline1">bool</strong> type has a default value of <strong class="source-inline1">false</strong> when it’s declared without a specific value <span>being assigned.</span></p>
<h3 class="calibre10">Moving with 2D physics</h3>
<p class="calibre3">We are receiving input from the player and are ready to process it <span>now. Yay!</span></p>
<p class="calibre3">Technically speaking, following the single responsibility principle, we’d now create a second <a id="_idIndexMarker256" class="pcalibre1 pcalibre calibre6"/>script to handle the player movement. For now, since our collection game is small, with a single input, it doesn’t require a more <span>complex architecture.</span></p>
<p class="calibre3">When the <a id="_idIndexMarker257" class="pcalibre1 pcalibre calibre6"/>player is holding down the <em class="italic">spacebar</em>, let’s move them forward while the key is held down and stop them moving when <span>it’s released:</span></p>
<pre class="source-code">
        if (keyboard.spaceKey.IsPressed())
        {
            // Move while holding spacebar key down.
        }
        else if (keyboard.spaceKey.wasReleasedThisFrame)
        {
            // The spacebar key was released – stop moving.
        }</pre> <p class="callout-heading">else if (C#)</p>
<p class="callout">An <strong class="source-inline1">else if</strong> statement tests <a id="_idIndexMarker258" class="pcalibre1 pcalibre calibre6"/>a new condition only if the previous <strong class="source-inline1">if</strong> statement evaluates to a <strong class="source-inline1">false</strong> condition and executes the directly proceeding block or line of code if <strong class="source-inline1">true</strong>. To evaluate multiple conditions, you can cascade multiple <strong class="source-inline1">else if</strong> statements as many times as <span>is required.</span></p>
<p class="calibre3">Using the <strong class="source-inline">Update()</strong> method is excellent for processing player input. Still, we want to move the player using <strong class="source-inline">2D Physics</strong>, and for that, we need to use <strong class="source-inline">FixedUpdate()</strong> – this is called <a id="_idIndexMarker259" class="pcalibre1 pcalibre calibre6"/>every physics <strong class="bold">Fixed Timestep</strong>, which is <a id="_idIndexMarker260" class="pcalibre1 pcalibre calibre6"/>at 50 times per second at the default value of <strong class="source-inline">0.02</strong> (this value, generally, doesn’t need to <span>be changed).</span></p>
<p class="calibre3">You might already wonder how we can tell a different Unity message event that is being called <em class="italic">automatically</em> to execute code from another Unity message event. We’ll simply use a <strong class="source-inline">bool</strong> variable as a <em class="italic">flag</em> to indicate that code should <span>be executed.</span></p>
<p class="calibre3">Let’s create <span>one now:</span></p>
<pre class="source-code">
public class PlayerController : MonoBehaviour
{
    private bool _shouldMoveForward;
    …</pre> <p class="callout-heading">Public and private accessors (C#) | Serialization</p>
<p class="callout"><strong class="bold">Accessors</strong> such as <strong class="bold">public</strong> and <strong class="bold">private</strong> define the scope of a variable for how it can be accessed <a id="_idIndexMarker261" class="pcalibre1 pcalibre calibre6"/>internally and externally by the class. A public accessor assigned to a <a id="_idIndexMarker262" class="pcalibre1 pcalibre calibre6"/>variable makes it accessible to other external classes, whereas a private accessor makes it accessible only within the class. If you do not explicitly declare an accessor, the default will be internal (refer <span>to </span><a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/access-modifiers" class="pcalibre1 pcalibre calibre6"><span>https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/access-modifiers</span></a><span>).</span></p>
<p class="callout">Another function of declaring a variable public is Unity marking it for serialization. <strong class="bold">Serialization</strong> is the <a id="_idIndexMarker263" class="pcalibre1 pcalibre calibre6"/>process of transforming an object’s state into a format that Unity can use – this is required for fields to be available in the <span><strong class="bold">Inspector</strong></span><span> window.</span></p>
<p class="calibre3">We’ve created the variable as a private field to only be accessible within the <strong class="source-inline">PlayerController</strong> class. We did not assign a value when declaring it so that it will have a starting value of <strong class="source-inline">false</strong> – our flag will not prompt code execution when the <span>program starts.</span></p>
<p class="calibre3">To execute <a id="_idIndexMarker264" class="pcalibre1 pcalibre calibre6"/>the code in <strong class="source-inline">FixedUpdate()</strong> to move the player, we’ll set it to <strong class="source-inline">true</strong>, with the <em class="italic">spacebar</em> key being held down and set back to <strong class="source-inline">false</strong> when it <span>is released:</span></p>
<p class="calibre3">Our player input code will now look <span>like this:</span></p>
<pre class="source-code">
        if (keyboard.spaceKey.IsPressed())
        {
            // Move while holding spacebar key down.
            _shouldMoveForward = true;
        }
        else if (keyboard.spaceKey.wasReleasedThisFrame)
        {
            // The spacebar key was released - stop moving.
            _shouldMoveForward = false;
        }</pre> <p class="calibre3">And we’ll check the value of the <strong class="source-inline">_shouldMoveForward</strong> Boolean flag in <strong class="source-inline">FixedUpdate()</strong> <span>like this:</span></p>
<pre class="source-code">
    // FixedUpdate is called every physics fixed timestep
    private void FixedUpdate()
    {
        if (_shouldMoveForward)
        {
            // Process physics movement.
        }
        else
        {
            // Stop movement.
        }
    }</pre> <p class="callout-heading">Tip</p>
<p class="callout">Refer to the <strong class="source-inline1">InputSystem</strong> documentation for all the possible properties and methods available on a keyboard device. You can also see what is available right within the VS IDE when pressing the <em class="italic">.</em> (period/dot) character. IntelliSense will provide a list of all the possible choices for completion (for example, when typing <strong class="source-inline1">keyboard</strong> and then <strong class="source-inline1">.</strong>, the popup list will have both the <strong class="source-inline1">IsPressed()</strong> method and the <strong class="source-inline1">wasReleasedThisFrame</strong> <span>property listed).</span></p>
<h4 class="calibre29">Rigidbody2D</h4>
<p class="calibre3">Moving objects in the Scene with the ability to interact with other objects is really quite easy when <a id="_idIndexMarker265" class="pcalibre1 pcalibre calibre6"/>using the physics system – you get a lot of value <em class="italic">out of the box</em>, since you don’t have to program these interactions yourself. For example, moving the <a id="_idIndexMarker266" class="pcalibre1 pcalibre calibre6"/>player is as simple as setting a velocity value for the direction <span>of movement.</span></p>
<p class="calibre3">Consider the following addition to our <span><strong class="source-inline">FixedUpdate()</strong></span><span> method:</span></p>
<pre class="source-code">
    private void FixedUpdate()
    {
        if (_shouldMoveForward)
        {
            // Process physics movement.
            // Up is the direction the object sprite
            // is currently facing.
            Rb.velocity = transform.up * MoveSpeed;
        }
        else
        {
            // Stop movement.
            Rb.velocity = Vector2.zero;
        }
    }</pre> <p class="calibre3">We’ve added a line that assigns a value to an <strong class="source-inline">Rb</strong> object’s <strong class="source-inline">velocity</strong> property, by multiplying the <strong class="source-inline">transform.up</strong> value with a <strong class="source-inline">MoveSpeed</strong> variable’s value. <strong class="source-inline">Rb</strong> is a public field we declare, representing the <strong class="source-inline">Rigidbody2D</strong> component that we’ll add to the player <a id="_idIndexMarker267" class="pcalibre1 pcalibre calibre6"/>GameObject in the <strong class="bold">Inspector</strong> window later. Because we declare <strong class="source-inline">Rb</strong> as public, assignments can also be made in the <span><strong class="bold">Inspector</strong></span><span> window.</span></p>
<p class="calibre3">Let’s add the <a id="_idIndexMarker268" class="pcalibre1 pcalibre calibre6"/>declaration for <strong class="source-inline">Rb</strong> and the <strong class="source-inline">MoveSpeed</strong> variable – with a default value of <strong class="source-inline">10f</strong> (<strong class="source-inline">f</strong> indicates that this is a float value, a numeric value stored in floating-point representation) – to provide some speed to <span>the movement:</span></p>
<pre class="source-code">
public class PlayerController : MonoBehaviour
{
    public Rigidbody2D Rb;
    public float MoveSpeed = 10f;</pre> <p class="callout-heading">Tip | VS IntelliSense</p>
<p class="callout">You can type <strong class="source-inline1">MoveSpeed</strong> first in the <strong class="source-inline1">Rb.velocity</strong> assignment line of code, but VS will complain that it is not declared yet with a squiggly red underline. You can easily add the variable declaration to the code by first clicking on the underlined word, then pressing <em class="italic">Alt</em>/<em class="italic">Cmd</em> + <em class="italic">Enter</em>, and selecting the <strong class="bold">Generate</strong> field <span>under </span><span><strong class="bold">MoveSpeed</strong></span><span>.</span></p>
<p class="calibre3">By setting a value to <strong class="source-inline">velocity</strong>, we tell the object to move in a specified direction – that direction is indicated by <strong class="source-inline">transform.up</strong> – and at the speed indicated by the <strong class="source-inline">MoveSpeed</strong> multiplier value. The player sprite will always move in the direction indicated by <strong class="source-inline">transform.up</strong>, no matter its rotation, as seen in the <span>following diagram:</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer035">
<img alt="Figure 2.16 – The ladybug Sprite Transform.up direction" src="image/B18347_02_16.jpg" class="calibre41"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 2.16 – The ladybug Sprite Transform.up direction</p>
<p class="callout-heading">Transform.up (Unity API)</p>
<p class="callout">This manipulates the position of an object on the <em class="italic">Y</em> axis (the green axis) in world space. It’s similar to <strong class="source-inline1">Vector3.up</strong>, but <strong class="source-inline1">Transform.up</strong> instead moves the object while considering <span>its rotation.</span></p>
<p class="callout">Other axes available are right (the <em class="italic">X</em> axis – red) and forward (the <em class="italic">Z</em> axis – <span>blue).</span></p>
<p class="calibre3">When the <a id="_idIndexMarker269" class="pcalibre1 pcalibre calibre6"/>player releases the <em class="italic">spacebar</em> key, <strong class="source-inline">_shouldMoveForward</strong> is assigned <strong class="source-inline">false</strong>, which results in <strong class="source-inline">Rb.velocity</strong> being set to <strong class="source-inline">Vector2.zero</strong> – velocity <a id="_idIndexMarker270" class="pcalibre1 pcalibre calibre6"/>is a <strong class="source-inline">Vector2</strong> structure, meaning that it can be used to represent 2D positions by <strong class="source-inline">X</strong> and <strong class="source-inline">Y</strong> values, as represented by this notation – <strong class="source-inline">Vector2(float, float)</strong>. <strong class="source-inline">Vector2.zero</strong> is shorthand for <span><strong class="source-inline">Vector2(0</strong></span><span>, </span><span><strong class="source-inline">0)</strong></span><span>.</span></p>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><span><strong class="bold">Vector2</strong></span><span>: </span><a href="https://docs.unity3d.com/ScriptReference/Vector2.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/ScriptReference/Vector2.xhtml</span></a></p>
<h4 class="calibre29">Vector Math, Mathf, and Quaternion</h4>
<p class="calibre3">The code, so <a id="_idIndexMarker271" class="pcalibre1 pcalibre calibre6"/>far, has tackled moving the player character in a forward direction in relation to the direction the sprite is facing. Still, it’s currently only facing <a id="_idIndexMarker272" class="pcalibre1 pcalibre calibre6"/>one direction – up. We’ll guide our player around the <a id="_idIndexMarker273" class="pcalibre1 pcalibre calibre6"/>environment by having it look in the direction of the mouse pointer – steering the <span>forward movement.</span></p>
<p class="calibre3">We can accomplish this by reading another input device – the mouse – and using some vector math to rotate the player object, according to where the mouse pointer is positioned on <span>the screen.</span></p>
<p class="calibre3">Have a look at the following <span><strong class="source-inline">LookAtMousePointer()</strong></span><span> method:</span></p>
<pre class="source-code">
    private void LookAtMousePointer()
    {
        var mouse = Mouse.current;
        if (mouse == null)
            return;
        var mousePos = Camera.main.ScreenToWorldPoint(
            mouse.position.ReadValue());
        var direction = (Vector2)mousePos - Rb.position;
        var angle = Mathf.Atan2(
            direction.y, direction.x) * Mathf.Rad2Deg
               + SpriteRotationOffset;
        // Direct rotation.
        Rb.rotation = angle;
    }</pre> <p class="calibre3">Let’s analyze <a id="_idIndexMarker274" class="pcalibre1 pcalibre calibre6"/>the code item <span>by item:</span></p>
<ol class="calibre14">
<li class="calibre15">Just like how <a id="_idIndexMarker275" class="pcalibre1 pcalibre calibre6"/>we verified we had a valid keyboard, <strong class="source-inline">mouse</strong> is being assigned and checked for <strong class="source-inline">null</strong> (stops running the code with <strong class="source-inline">return</strong> if none <span>is assigned)</span></li>
<li class="calibre15">The <strong class="source-inline">mousePos</strong> variable is assigned by the return value of the <strong class="source-inline">mouse.position.ReadValue()</strong> method, which returns a <strong class="source-inline">Vector2</strong> position, and uses the main camera reference in <strong class="source-inline">Scene (Camera.main)</strong> to convert its <strong class="source-inline">Vector2</strong> screen space position to a <strong class="source-inline">Vector3</strong> world point (the 3D coordinate system the Unity <span>engine uses).</span></li>
<li class="calibre15">The direction from the mouse position to the <strong class="source-inline">Rigidbody2D</strong> position on the player is calculated using a simple vector math expression – subtracting one vector from another is a quick way to calculate the <span>direction. Simple!</span></li>
<li class="calibre15">Note that you can only use vector arithmetic operations on the same vector type – here, we have <strong class="source-inline">Vector3</strong> representing the mouse position and <strong class="source-inline">Vector2</strong> representing the <strong class="source-inline">Rigidbody2D</strong> position. To treat the <strong class="source-inline">mousePos</strong> variable as <strong class="source-inline">Vector2</strong> in the expression, we cast the value by prepending <strong class="source-inline">(Vector2)</strong> to it (we only need the <strong class="source-inline">x</strong> and <strong class="source-inline">y</strong> values <span>for 2D).</span></li>
<li class="calibre15">Now, we need the rotation angle to apply to the player’s <strong class="source-inline">Rigidbody2D</strong>. Unity provides a math library for just such an occasion – <strong class="source-inline">Mathf</strong>. In particular, we’re using the <strong class="source-inline">Atan2</strong> method, which returns an angle in radians from a <span>2D vector.</span></li>
<li class="calibre15">We’ll actually want our angle value to be in degrees of rotation – not radians – so again, <strong class="source-inline">Mathf</strong> to the rescue. <strong class="source-inline">Mathf.Rad2Deg</strong> is a conversion constant (equal to <em class="italic">360 / (PI x 2)</em>) that we’ll multiply with the returned radians, and with that, we have our degrees of rotation value. The <strong class="source-inline">SpriteRotationOffset</strong> public variable provides an offset if the sprite’s direction is not facing <strong class="source-inline">Transform.right</strong> – the direction the equation results in (we do need a value of -90 degrees here, since our ladybug sprite is pointing up, <span>not right).</span></li>
<li class="calibre15">Finally, we set the resulting angle (in degrees of rotation) to the <span><strong class="source-inline">Rb.rotation</strong></span><span> property!</span></li>
</ol>
<p class="calibre3">To make <a id="_idIndexMarker276" class="pcalibre1 pcalibre calibre6"/>sure our player rotation is being set every frame, add a <a id="_idIndexMarker277" class="pcalibre1 pcalibre calibre6"/>call to the <strong class="source-inline">LookAtMousePointer()</strong> method at the end <span>of </span><span><strong class="source-inline">Update()</strong></span><span>:</span></p>
<pre class="source-code">
    void Update()
    {
        …
        LookAtMousePointer();
    }</pre> <h4 class="calibre29">Smoothing rotation</h4>
<p class="calibre3">Setting the <strong class="source-inline">Rb.rotation</strong> value for every frame update would be sufficient to make pointing the <a id="_idIndexMarker278" class="pcalibre1 pcalibre calibre6"/>player in the direction of the mouse pointer work, but we can <span>do better!</span></p>
<p class="calibre3">We can <a id="_idIndexMarker279" class="pcalibre1 pcalibre calibre6"/>accomplish a smoother rotation and adjust the rotation speed to alter gameplay using an interpolation <a id="_idIndexMarker280" class="pcalibre1 pcalibre calibre6"/>method that Unity provides, called <strong class="bold">Slerp</strong>. Slerp will smooth the rotation and remove abrupt rotations while providing a better game feel, enhancing the <span>player experience.</span></p>
<p class="callout-heading">Slerp (Unity API) | Additional reading | Unity documentation</p>
<p class="callout"><strong class="bold">Slerp</strong> is shorthand <a id="_idIndexMarker281" class="pcalibre1 pcalibre calibre6"/>for <strong class="bold">spherically interpolated</strong>. It provides a method that interpolates values between <em class="italic">A</em> and <em class="italic">B</em> by an amount of <em class="italic">T</em>. The difference <a id="_idIndexMarker282" class="pcalibre1 pcalibre calibre6"/>between this and <strong class="bold">linear interpolation</strong> (<strong class="bold">Lerp</strong>) is that the <em class="italic">A</em> and <em class="italic">B</em> vectors are treated as directions instead of <span>location points.</span></p>
<p class="callout"><span><strong class="bold">Quaternion.Slerp</strong></span><span>: </span><a href="https://docs.unity3d.com/ScriptReference/Quaternion.Slerp.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/ScriptReference/Quaternion.Slerp.xhtml</span></a></p>
<p class="calibre3">Replace the <a id="_idIndexMarker283" class="pcalibre1 pcalibre calibre6"/>direct rotation assignment (<strong class="source-inline">Rb.rotation = angle;</strong>) with the following <span>code snippet:</span></p>
<pre class="source-code">
        // Interpolated rotation – smoothed.
        // Forward (Z-axis) is what we want to rotate on.
        var q = Quaternion.AngleAxis(angle,
            Vector3.forward);
        Rb.transform.rotation = Quaternion.Slerp(
            Rb.transform.rotation, q, Time.deltaTime
               * LookAtSpeed);</pre> <p class="calibre3">Let’s break down <span>this code:</span></p>
<ol class="calibre14">
<li class="calibre15">To interpolate <a id="_idIndexMarker284" class="pcalibre1 pcalibre calibre6"/>the rotation value, we’ll need to <a id="_idIndexMarker285" class="pcalibre1 pcalibre calibre6"/>use a slightly different approach using <strong class="source-inline">Quaternion</strong> (based on complex numbers that represent rotations that can easily be interpolated and what Unity uses internally to represent <span>all rotations).</span></li>
<li class="calibre15">The first calculation we’ll need to get our angle degrees into a quaternion value (<strong class="source-inline">var q</strong>) is using the <strong class="source-inline">AngleAxis()</strong> method to calculate the rotation around an axis. Here, we provide <strong class="source-inline">Vector3.forward</strong> as our rotation axis – referring to <span><em class="italic">Figure 2</em></span><em class="italic">.16</em>, we can see that it will rotate the ladybug sprite on the <em class="italic">XY</em> plane, which is precisely what <span>we want!</span></li>
<li class="calibre15">Unlike with <strong class="source-inline">Rb.rotation</strong>, which required a float value for the angle degrees, we need to assign a quaternion value now, so we’ll have to use the <strong class="source-inline">Rb.transform.rotation</strong> <span>property instead.</span></li>
<li class="calibre15">Finally, we will use <strong class="source-inline">Quaternion.Slerp()</strong> to interpolate the rotation value, producing a smooth rotation from the player character’s current rotation to the desired rotation – pointing in the direction of the <span>mouse pointer.</span></li>
</ol>
<p class="calibre3">We can change the rotation speed by using the <strong class="source-inline">LookAtSpeed</strong> public variable value. The speed value is multiplied by <strong class="source-inline">Time.deltaTime</strong> to make this a frame rate independent <a id="_idIndexMarker286" class="pcalibre1 pcalibre calibre6"/>rotation speed (which means it will be consistent <a id="_idIndexMarker287" class="pcalibre1 pcalibre calibre6"/>across all different performing systems that will run <span>the game).</span></p>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><span><strong class="bold">Time.deltaTime</strong></span><span>: </span><a href="https://docs.unity3d.com/ScriptReference/Time-deltaTime.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/ScriptReference/Time-deltaTime.xhtml</span></a></p>
<p class="calibre3">Our final <a id="_idIndexMarker288" class="pcalibre1 pcalibre calibre6"/>variable declarations, including the newly added variables for <strong class="source-inline">SpriteRotationOffset</strong> and <strong class="source-inline">LookAtSpeed</strong>, with some default starting values assigned, look like <span>the following:</span></p>
<pre class="source-code">
public class PlayerController: MonoBehaviour
{
    public Rigidbody2D Rb;
    public float MoveSpeed = 10f;
    public float SpriteRotationOffset = -90f;
    public float LookAtSpeed = 2f;
    private bool _shouldMoveForward;
    …</pre> <p class="callout-heading">PlayerController.cs Code</p>
<p class="callout">To view the completed code for the <strong class="source-inline1">PlayerCharacter</strong> class, visit the GitHub repo <span>here: </span><a href="https://github.com/PacktPublishing/Unity-2022-by-Example/tree/main/ch2/Unity%20Project/Assets/Scripts" class="pcalibre1 pcalibre calibre6"><span>https://github.com/PacktPublishing/Unity-2022-by-Example/tree/main/ch2/Unity%20Project/Assets/Scripts</span></a></p>
<p class="calibre3">This section taught us how to read player input directly using Input Devices, move a <strong class="source-inline">Rigidbody2D</strong> object by manipulating its velocity, and implement smooth rotation using vector math <span>and quaternions.</span></p>
<h1 id="_idParaDest-57" class="calibre5"><a id="_idTextAnchor057" class="pcalibre1 pcalibre calibre6"/>Summary</h1>
<p class="calibre3">This chapter introduced many subjects, including level design concepts, adding 2D artwork to a project, preparing it with Unity’s 2D tooling as sprites, and using the prepared artwork to draw a 2D game environment with a <strong class="bold">Tilemap</strong>. We also created scripts using the C# language and Visual Studio IDE to add functionality to GameObjects, for reading input and moving the player character <span>with physics.</span></p>
<p class="calibre3">In the next chapter, we’ll add a virtual camera system to follow the ladybug character around the level, add a basic UI, and process conditions for winning and losing <span>the game.</span></p>
</div>
</div></body></html>