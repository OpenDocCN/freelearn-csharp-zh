<html><head></head><body>
<div id="_idContainer051">
<h1 class="chapter-number" id="_idParaDest-34"><a id="_idTextAnchor101"/><span class="koboSpan" id="kobo.1.1">2</span></h1>
<h1 id="_idParaDest-35"><a id="_idTextAnchor102"/><span class="koboSpan" id="kobo.2.1">Building Our First .NET MAUI App</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In this chapter, we will create a to-do list app and, in doing so, explore all the bits and pieces of what makes up an app. </span><span class="koboSpan" id="kobo.3.2">We will look at creating pages, adding content to pages, navigating between pages, and creating a stunning layout. </span><span class="koboSpan" id="kobo.3.3">Well, </span><em class="italic"><span class="koboSpan" id="kobo.4.1">stunning</span></em><span class="koboSpan" id="kobo.5.1"> might be a bit of a stretch, but we will be sure to design the app so that you can tweak it to your needs once it </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">is complete!</span></span></p>
<p><span class="koboSpan" id="kobo.7.1">The following topics will be covered in </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">this chapter:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.9.1">Setting up </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">the project</span></span></li>
<li><span class="koboSpan" id="kobo.11.1">Persisting data locally on a device using the </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">repository pattern</span></span></li>
<li><span class="koboSpan" id="kobo.13.1">What MVVM is and why it’s a great fit for .</span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">NET MAUI</span></span></li>
<li><span class="koboSpan" id="kobo.15.1">Using .NET MAUI pages (as views) and navigating between them using .NET MAUI controls </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">in XAML</span></span></li>
<li><span class="koboSpan" id="kobo.17.1">Using </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">data binding</span></span></li>
<li><span class="koboSpan" id="kobo.19.1">Using styling in .</span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">NET MAUI</span></span></li>
</ul>
<h1 id="_idParaDest-36"><a id="_idTextAnchor103"/><a id="_idTextAnchor104"/><span class="koboSpan" id="kobo.21.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.22.1">To complete this project, you need to have Visual Studio installed on your </span><strong class="bold"><span class="koboSpan" id="kobo.23.1">Macintosh</span></strong><span class="koboSpan" id="kobo.24.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.25.1">Mac</span></strong><span class="koboSpan" id="kobo.26.1">) or PC, as well as the .NET mobile components. </span><span class="koboSpan" id="kobo.26.2">Refer to </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.27.1">Chapter 1</span></em></span><span class="koboSpan" id="kobo.28.1">, </span><em class="italic"><span class="koboSpan" id="kobo.29.1">Introduction to .NET MAUI</span></em><span class="koboSpan" id="kobo.30.1">, for more details on how to set up your environment.</span><a id="_idTextAnchor105"/><span class="koboSpan" id="kobo.31.1"> This chapter provides screenshots and instructions for Visual Studio </span><span class="No-Break"><span class="koboSpan" id="kobo.32.1">on Windows.</span></span></p>
<p><span class="koboSpan" id="kobo.33.1">This chapter will be a classic </span><strong class="bold"><span class="koboSpan" id="kobo.34.1">File</span></strong><span class="koboSpan" id="kobo.35.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.36.1">New</span></strong><span class="koboSpan" id="kobo.37.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.38.1">Project</span></strong><span class="koboSpan" id="kobo.39.1"> chapter, guiding you step by step through the process of creating your first to-do list app. </span><span class="koboSpan" id="kobo.39.2">No downloads will be required whatsoever, apart from a few </span><span class="No-Break"><span class="koboSpan" id="kobo.40.1">NuGet packages.</span></span></p>
<p><span class="koboSpan" id="kobo.41.1">You can find the full source for the code in this chapter </span><span class="No-Break"><span class="koboSpan" id="kobo.42.1">at </span></span><a href="https://github.com/PacktPublishing/MAUI-Projects-3rd-Edition"><span class="No-Break"><span class="koboSpan" id="kobo.43.1">https://github.com/Packt</span></span><span class="koboSpan" id="kobo.44.1">
Publishing/MAUI-Projects-3rd-Edition</span></a><span class="koboSpan" id="kobo.45.1"> in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.46.1">Chapter02</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.47.1"> folder.</span></span></p>
<h1 id="_idParaDest-37"><a id="_idTextAnchor106"/><span class="koboSpan" id="kobo.48.1">Project overview</span></h1>
<p><span class="koboSpan" id="kobo.49.1">Everyone needs a</span><a id="_idIndexMarker176"/><span class="koboSpan" id="kobo.50.1"> way of keeping track of things. </span><span class="koboSpan" id="kobo.50.2">To kick-start our .NET MAUI development learning curve, we’ve decided that a to-do list app is the best way to get started and to help you keep track of things. </span><span class="koboSpan" id="kobo.50.3">A simple, classic </span><span class="No-Break"><span class="koboSpan" id="kobo.51.1">win-win scenario.</span></span></p>
<p><span class="koboSpan" id="kobo.52.1">We will start by creating a project and defining a repository to store the items of a to-do list. </span><span class="koboSpan" id="kobo.52.2">We will render these items in list form and allow the user to edit them using a detailed user interface. </span><span class="koboSpan" id="kobo.52.3">We will also look at how to store the to-do list items locally on a device</span><a id="_idIndexMarker177"/><span class="koboSpan" id="kobo.53.1"> through </span><strong class="bold"><span class="koboSpan" id="kobo.54.1">SQLite.NET</span></strong><span class="koboSpan" id="kobo.55.1"> so that they don’t get lost when we exit </span><span class="No-Break"><span class="koboSpan" id="kobo.56.1">the app</span><a id="_idTextAnchor107"/><span class="koboSpan" id="kobo.57.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.58.1">The build time for this project is about </span><span class="No-Break"><span class="koboSpan" id="kobo.59.1">2 hour</span><a id="_idTextAnchor108"/><a id="_idTextAnchor109"/><span class="koboSpan" id="kobo.60.1">s.</span></span></p>
<h1 id="_idParaDest-38"><a id="_idTextAnchor110"/><span class="koboSpan" id="kobo.61.1">Setting up the project</span></h1>
<p><span class="koboSpan" id="kobo.62.1">.NET MAUI introduces a </span><a id="_idIndexMarker178"/><span class="koboSpan" id="kobo.63.1">new code-sharing paradigm called single project. </span><span class="koboSpan" id="kobo.63.2">Previously, in Xamarin.Forms, you would have had a separate project for each platform your app would be deployed to. </span><span class="koboSpan" id="kobo.63.3">In .NET MAUI, all platforms are in a single project that is multi-targeted to all the supported platforms. </span><span class="koboSpan" id="kobo.63.4">By default, all code is considered shared, unless it is in one of the platform-specific subfolders. </span><span class="koboSpan" id="kobo.63.5">We will explore this further as we progress through this and </span><span class="No-Break"><span class="koboSpan" id="kobo.64.1">future chapters.</span></span></p>
<p><span class="koboSpan" id="kobo.65.1">Let’s </span><span class="No-Break"><span class="koboSpan" id="kobo.66.1">get starte</span><a id="_idTextAnchor111"/><span class="koboSpan" id="kobo.67.1">d!</span></span></p>
<h2 id="_idParaDest-39"><a id="_idTextAnchor112"/><span class="koboSpan" id="kobo.68.1">Creating the new project</span></h2>
<p><span class="koboSpan" id="kobo.69.1">The first step is </span><a id="_idIndexMarker179"/><span class="koboSpan" id="kobo.70.1">to create a new .NET MAUI project. </span><span class="koboSpan" id="kobo.70.2">Open Visual Studio 2022 and select </span><strong class="bold"><span class="koboSpan" id="kobo.71.1">Create a </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.72.1">new project</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.73.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer036">
<span class="koboSpan" id="kobo.74.1"><img alt="Figure 2.1 – Visual Studio 2﻿022" src="image/Figure_2.1_B19214.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.75.1">Figure 2.1 – Visual Studio 2</span><a id="_idTextAnchor113"/><span class="koboSpan" id="kobo.76.1">022</span></p>
<p><span class="koboSpan" id="kobo.77.1">This will </span><a id="_idIndexMarker180"/><span class="koboSpan" id="kobo.78.1">open the </span><strong class="bold"><span class="koboSpan" id="kobo.79.1">Create a new project</span></strong><span class="koboSpan" id="kobo.80.1"> wizard. </span><span class="koboSpan" id="kobo.80.2">In the search field, type in </span><strong class="source-inline"><span class="koboSpan" id="kobo.81.1">maui</span></strong><span class="koboSpan" id="kobo.82.1"> and select the </span><strong class="bold"><span class="koboSpan" id="kobo.83.1">.NET MAUI App</span></strong><span class="koboSpan" id="kobo.84.1"> item from </span><span class="No-Break"><span class="koboSpan" id="kobo.85.1">the list:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer037">
<span class="koboSpan" id="kobo.86.1"><img alt="Figure 2.2 – Create a new proje﻿ct" src="image/Figure_2.2_B19214.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.87.1">Figure 2.2 – Create a new proje</span><a id="_idTextAnchor114"/><span class="koboSpan" id="kobo.88.1">ct</span></p>
<p><span class="koboSpan" id="kobo.89.1">Complete the next </span><a id="_idIndexMarker181"/><span class="koboSpan" id="kobo.90.1">page of the wizard by naming your project </span><strong class="source-inline"><span class="koboSpan" id="kobo.91.1">DoToo</span></strong><span class="koboSpan" id="kobo.92.1">, then </span><span class="No-Break"><span class="koboSpan" id="kobo.93.1">click </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.94.1">Next</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.95.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer038">
<span class="koboSpan" id="kobo.96.1"><img alt="Figure 2.3 – Configure your new proj﻿ect" src="image/Figure_2.3_B19214.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.97.1">Figure 2.3 – Configure your new proj</span><a id="_idTextAnchor115"/><span class="koboSpan" id="kobo.98.1">ect</span></p>
<p><span class="koboSpan" id="kobo.99.1">The next step will </span><a id="_idIndexMarker182"/><span class="koboSpan" id="kobo.100.1">prompt you for the version of .NET Core to </span><a id="_idIndexMarker183"/><span class="koboSpan" id="kobo.101.1">support. </span><span class="koboSpan" id="kobo.101.2">At the time of writing, .NET 6 is available as </span><strong class="bold"><span class="koboSpan" id="kobo.102.1">Long-Term Support</span></strong><span class="koboSpan" id="kobo.103.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.104.1">LTS</span></strong><span class="koboSpan" id="kobo.105.1">), and .NET 7 is available as </span><strong class="bold"><span class="koboSpan" id="kobo.106.1">Standard Term Support</span></strong><span class="koboSpan" id="kobo.107.1">. </span><span class="koboSpan" id="kobo.107.2">For this </span><a id="_idIndexMarker184"/><span class="koboSpan" id="kobo.108.1">book, we will assume that you will be using .</span><span class="No-Break"><span class="koboSpan" id="kobo.109.1">NET 7:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer039">
<span class="koboSpan" id="kobo.110.1"><img alt="Figure 2.4 – Additional information" src="image/Figure_2.4_B19214.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.111.1">Figure 2.4 – Additional information</span></p>
<p><span class="koboSpan" id="kobo.112.1">Finalize the setup by clicking </span><strong class="bold"><span class="koboSpan" id="kobo.113.1">Create</span></strong><span class="koboSpan" id="kobo.114.1"> and wait for Visual Studio to create </span><span class="No-Break"><span class="koboSpan" id="kobo.115.1">the proj</span><a id="_idTextAnchor116"/><span class="koboSpan" id="kobo.116.1">ect.</span></span></p>
<p><span class="koboSpan" id="kobo.117.1">Congratulations! </span><span class="koboSpan" id="kobo.117.2">We’ve </span><a id="_idIndexMarker185"/><span class="koboSpan" id="kobo.118.1">just created our first .NET MAUI app. </span><span class="koboSpan" id="kobo.118.2">Let’s take a look at what the template wizard generated </span><span class="No-Break"><span class="koboSpan" id="kobo.119.1">fo</span><a id="_idTextAnchor117"/><span class="koboSpan" id="kobo.120.1">r us.</span></span></p>
<h2 id="_idParaDest-40"><a id="_idTextAnchor118"/><span class="koboSpan" id="kobo.121.1">Examining the files</span></h2>
<p><span class="koboSpan" id="kobo.122.1">The selected template</span><a id="_idIndexMarker186"/><span class="koboSpan" id="kobo.123.1"> has now created a single project called </span><strong class="source-inline"><span class="koboSpan" id="kobo.124.1">DoToo</span></strong><span class="koboSpan" id="kobo.125.1"> as</span><a id="_idIndexMarker187"/><span class="koboSpan" id="kobo.126.1"> a .NET library that can target iOS, Mac Catalyst (macOS), Android, and Windows platforms. </span><span class="koboSpan" id="kobo.126.2">You can switch the target platform using the main toolbar in Visual Studio, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.127.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.128.1">.5</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.129.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer040">
<span class="koboSpan" id="kobo.130.1"><img alt="Figure 2.5 – The Debug Target drop-down menu" src="image/Figure_2.5_B19214.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.131.1">Figure 2.5 – The Debug Target drop-down menu</span></p>
<p><span class="koboSpan" id="kobo.132.1">The Windows platform is selected by default, but you can easily switch to iOS or Android by using the </span><strong class="bold"><span class="koboSpan" id="kobo.133.1">Debug Target</span></strong><span class="koboSpan" id="kobo.134.1"> drop-down menu. </span><span class="koboSpan" id="kobo.134.2">In the dropdown under the </span><strong class="bold"><span class="koboSpan" id="kobo.135.1">Framework</span></strong><span class="koboSpan" id="kobo.136.1"> sub-menu, you will find all the supported </span><span class="No-Break"><span class="koboSpan" id="kobo.137.1">target platforms.</span></span></p>
<p><span class="koboSpan" id="kobo.138.1">The target framework </span><a id="_idIndexMarker188"/><span class="koboSpan" id="kobo.139.1">will also change appropriately when you choose a target device. </span><span class="koboSpan" id="kobo.139.2">If you select an emulator under the </span><strong class="bold"><span class="koboSpan" id="kobo.140.1">Android Emulators</span></strong><span class="koboSpan" id="kobo.141.1"> menu item, then the Android target framework will become the current framework, whereas if you select an iOS simulator or device from one of the iOS menu items, iOS will be the </span><span class="No-Break"><span class="koboSpan" id="kobo.142.1">current fra</span><a id="_idTextAnchor119"/><span class="koboSpan" id="kobo.143.1">mework.</span></span></p>
<p><span class="koboSpan" id="kobo.144.1">The project should now look </span><span class="No-Break"><span class="koboSpan" id="kobo.145.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer041">
<span class="koboSpan" id="kobo.146.1"><img alt="Figure 2.6 – .NET MAUI project str﻿ucture" src="image/Figure_2.6_B19214.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.147.1">Figure 2.6 – .NET MAUI project str</span><a id="_idTextAnchor120"/><span class="koboSpan" id="kobo.148.1">ucture</span></p>
<p><span class="koboSpan" id="kobo.149.1">We will highlight a few important files in the project so that we have a</span><a id="_idTextAnchor121"/><span class="koboSpan" id="kobo.150.1"> basic understanding of</span><a id="_idIndexMarker189"/><span class="koboSpan" id="kobo.151.1"> what they are. </span><span class="koboSpan" id="kobo.151.2">First, we will look at the shared code, after which we’ll look at the files/code specific to each platform (stored under the different </span><span class="No-Break"><span class="koboSpan" id="kobo.152.1">platform fo</span><a id="_idTextAnchor122"/><span class="koboSpan" id="kobo.153.1">lders).</span></span></p>
<h3><span class="koboSpan" id="kobo.154.1">Shared code</span></h3>
<p><span class="koboSpan" id="kobo.155.1">Under </span><strong class="source-inline"><span class="koboSpan" id="kobo.156.1">Dependencies</span></strong><span class="koboSpan" id="kobo.157.1">, we will find references to any external dependencies, such as each </span><a id="_idIndexMarker190"/><span class="koboSpan" id="kobo.158.1">referenced .NET mobile framework. </span><span class="koboSpan" id="kobo.158.2">Under each framework, you </span><a id="_idIndexMarker191"/><span class="koboSpan" id="kobo.159.1">will find the .NET MAUI dependency under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.160.1">packages</span></strong><span class="koboSpan" id="kobo.161.1"> folder. </span><span class="koboSpan" id="kobo.161.2">We will update the .NET MAUI package version in the </span><em class="italic"><span class="koboSpan" id="kobo.162.1">Updating the .NET MAUI packages</span></em><span class="koboSpan" id="kobo.163.1"> section and add more dependencies as we progress through </span><span class="No-Break"><span class="koboSpan" id="kobo.164.1">this chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.165.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.166.1">MauiProgram.cs</span></strong><span class="koboSpan" id="kobo.167.1"> file is the starting point for the application. </span><span class="koboSpan" id="kobo.167.2">The initial template will generate a </span><strong class="source-inline"><span class="koboSpan" id="kobo.168.1">MauiProgram</span></strong><span class="koboSpan" id="kobo.169.1"> class that looks </span><span class="No-Break"><span class="koboSpan" id="kobo.170.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.171.1">
public static class MauiProgram
{
    public static MauiApp CreateMauiApp()
    {
        var builder = MauiApp.CreateBuilder();
        builder
            .UseMauiApp&lt;App&gt;()
            .ConfigureFonts(fonts =&gt;
            {
                fonts.AddFont("OpenSans-Regular.ttf", 
"OpenSansRegular");
                fonts.AddFont("OpenSans-Semibold.ttf", 
"OpenSansSemibold");
            });
#if DEBUG
        builder.Logging.AddDebug();
#endif
        return builder.Build();
    }
}</span></pre> <p><span class="koboSpan" id="kobo.172.1">The static </span><strong class="source-inline"><span class="koboSpan" id="kobo.173.1">MauiProgram</span></strong><span class="koboSpan" id="kobo.174.1"> class contains a single </span><strong class="source-inline"><span class="koboSpan" id="kobo.175.1">CreateMauiApp</span></strong><span class="koboSpan" id="kobo.176.1"> method that returns </span><strong class="source-inline"><span class="koboSpan" id="kobo.177.1">MauiApp</span></strong><span class="koboSpan" id="kobo.178.1">. </span><span class="koboSpan" id="kobo.178.2">This instance is created by using </span><strong class="source-inline"><span class="koboSpan" id="kobo.179.1">MauiAppBuilder</span></strong><span class="koboSpan" id="kobo.180.1">, which works in much the same way that the ASP.NET builders work; </span><strong class="source-inline"><span class="koboSpan" id="kobo.181.1">MauiAppBuilder</span></strong><span class="koboSpan" id="kobo.182.1"> uses a </span><strong class="bold"><span class="koboSpan" id="kobo.183.1">Fluent API</span></strong><span class="koboSpan" id="kobo.184.1"> to </span><a id="_idIndexMarker192"/><span class="koboSpan" id="kobo.185.1">construct the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.186.1">Application</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.187.1"> instance.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.188.1">What is a Fluent API?</span></p>
<p class="callout"><span class="koboSpan" id="kobo.189.1">A Fluent API allows</span><a id="_idIndexMarker193"/><span class="koboSpan" id="kobo.190.1"> method chaining wherein each method of the API returns the same context. </span><span class="koboSpan" id="kobo.190.2">Fluent APIs form a distinct language in themselves by using terms specific to the topic of the API. </span><span class="koboSpan" id="kobo.190.3">This makes the API easier to grasp and use. </span><span class="koboSpan" id="kobo.190.4">C#’s </span><strong class="bold"><span class="koboSpan" id="kobo.191.1">Language Integrated Query</span></strong><span class="koboSpan" id="kobo.192.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.193.1">LINQ</span></strong><span class="koboSpan" id="kobo.194.1">) is a</span><a id="_idIndexMarker194"/><span class="koboSpan" id="kobo.195.1"> good example of a </span><span class="No-Break"><span class="koboSpan" id="kobo.196.1">Fluent API.</span></span></p>
<p><span class="koboSpan" id="kobo.197.1">Extension methods are used to add features and services to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.198.1">MauiApp</span></strong><span class="koboSpan" id="kobo.199.1"> instance. </span><span class="koboSpan" id="kobo.199.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.200.1">UseMauiApp</span></strong><span class="koboSpan" id="kobo.201.1"> extension method identifies the subclass of </span><strong class="source-inline"><span class="koboSpan" id="kobo.202.1">Microsoft.Maui.Controls.Application</span></strong><span class="koboSpan" id="kobo.203.1"> to use. </span><span class="koboSpan" id="kobo.203.2">By default, this class is defined in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.204.1">App.xaml</span></strong><span class="koboSpan" id="kobo.205.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.206.1">App.xaml.cs</span></strong><span class="koboSpan" id="kobo.207.1"> files. </span><span class="koboSpan" id="kobo.207.2">Another extension method, </span><strong class="source-inline"><span class="koboSpan" id="kobo.208.1">ConfigureFonts</span></strong><span class="koboSpan" id="kobo.209.1">, is used by the template to register custom font files in use by the application. </span><span class="koboSpan" id="kobo.209.2">Yet another example of an extension method that can be used is </span><strong class="source-inline"><span class="koboSpan" id="kobo.210.1">ConfigureLifecycleEvents</span></strong><span class="koboSpan" id="kobo.211.1">, which is used to set up handlers for the cross-platform life cycle </span><a id="_idIndexMarker195"/><span class="koboSpan" id="kobo.212.1">events </span><a id="_idIndexMarker196"/><span class="koboSpan" id="kobo.213.1">available in .NET MAUI. </span><span class="koboSpan" id="kobo.213.2">We will discuss </span><strong class="source-inline"><span class="koboSpan" id="kobo.214.1">ConfigureLifecycleEvents</span></strong><span class="koboSpan" id="kobo.215.1"> more in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.216.1">Chapter 3</span></em></span><span class="koboSpan" id="kobo.217.1">, </span><em class="italic"><span class="koboSpan" id="kobo.218.1">Converting a Xamarin.Forms App into .</span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.219.1">NET MAUI</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.220.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.221.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.222.1">App.xaml</span></strong><span class="koboSpan" id="kobo.223.1"> file is a XAML file that represents the app. </span><span class="koboSpan" id="kobo.223.2">This is a good place to put application-wide resources, which we will do later. </span><span class="koboSpan" id="kobo.223.3">We can also see the </span><strong class="source-inline"><span class="koboSpan" id="kobo.224.1">App.xaml.cs</span></strong><span class="koboSpan" id="kobo.225.1"> file, which contains the </span><span class="No-Break"><span class="koboSpan" id="kobo.226.1">startup code.</span></span></p>
<p><span class="koboSpan" id="kobo.227.1">If we open </span><strong class="source-inline"><span class="koboSpan" id="kobo.228.1">App.xaml.cs</span></strong><span class="koboSpan" id="kobo.229.1">, we can see the starting point for our .NET </span><span class="No-Break"><span class="koboSpan" id="kobo.230.1">MAUI application:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.231.1">
public partial class App : Application
{
    public App()
    {
        InitializeComponent();
        MainPage = new AppShell();
    }
}</span></pre> <p><span class="koboSpan" id="kobo.232.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.233.1">MainPage</span></strong><span class="koboSpan" id="kobo.234.1"> property is assigned to a page, which is particularly important as this determines which page is shown first to the user. </span><span class="koboSpan" id="kobo.234.2">In this template, this is the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.235.1">DoToo.AppShell()</span></strong></span><span class="No-Break"><strong class="bold"> </strong></span><span class="No-Break"><span class="koboSpan" id="kobo.236.1">class.</span></span></p>
<p><span class="koboSpan" id="kobo.237.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.238.1">AppShell.xaml</span></strong><span class="koboSpan" id="kobo.239.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.240.1">AppShell.xaml.cs</span></strong><span class="koboSpan" id="kobo.241.1"> files declare the first visible UI component in the .NET MAUI app. </span><span class="koboSpan" id="kobo.241.2">Shell provides a form of navigation between pages. </span><span class="koboSpan" id="kobo.241.3">When </span><a id="_idIndexMarker197"/><span class="koboSpan" id="kobo.242.1">you </span><a id="_idIndexMarker198"/><span class="koboSpan" id="kobo.243.1">open </span><strong class="source-inline"><span class="koboSpan" id="kobo.244.1">AppShell.xaml</span></strong><span class="koboSpan" id="kobo.245.1">, it should look </span><span class="No-Break"><span class="koboSpan" id="kobo.246.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.247.1">
&lt;Shell
    x:Class="DoToo.AppShell"
    xmlns=http://schemas.microsoft.com/dotnet/2021/maui
    xmlns:x=http://schemas.microsoft.com/winfx/2009/xaml
    
    Shell.FlyoutBehavior="Disabled"&gt;
    &lt;ShellContent
        Title="Home"
        ContentTemplate="{DataTemplate local:MainPage}"
        Route="MainPage" /&gt;
&lt;/Shell&gt;</span></pre> <p><span class="koboSpan" id="kobo.248.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.249.1">ShellContent</span></strong><span class="koboSpan" id="kobo.250.1"> element identifies an individual page that is displayed within the shell. </span><span class="koboSpan" id="kobo.250.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.251.1">ContentTemplate</span></strong><span class="koboSpan" id="kobo.252.1"> attribute is used to locate the class that implements the page – in this case, </span><strong class="source-inline"><span class="koboSpan" id="kobo.253.1">MainPage</span></strong><span class="koboSpan" id="kobo.254.1"> – while </span><strong class="source-inline"><span class="koboSpan" id="kobo.255.1">Route</span></strong><span class="koboSpan" id="kobo.256.1"> is the unique identifier for </span><span class="No-Break"><span class="koboSpan" id="kobo.257.1">the page.</span></span></p>
<p><span class="koboSpan" id="kobo.258.1">The last two files are the </span><strong class="source-inline"><span class="koboSpan" id="kobo.259.1">MainPage.xaml</span></strong><span class="koboSpan" id="kobo.260.1"> file, which contains the first page of the application, and the code-behind file, which is </span><span class="No-Break"><span class="koboSpan" id="kobo.261.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.262.1">MainPage.xaml.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.263.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.264.1">Next, we will work through each platform’s files. </span><span class="koboSpan" id="kobo.264.2">Each platform has a unique folder under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.265.1">Platforms</span></strong><span class="koboSpan" id="kobo.266.1"> folder. </span><span class="koboSpan" id="kobo.266.2">Android files are in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.267.1">Android</span></strong><span class="koboSpan" id="kobo.268.1"> folder, iOS files are in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.269.1">iOS</span></strong><span class="koboSpan" id="kobo.270.1"> folder, Mac Catalyst files are in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.271.1">MacCatalyst</span></strong><span class="koboSpan" id="kobo.272.1"> folder, Tizen files are in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.273.1">Tizen</span></strong><span class="koboSpan" id="kobo.274.1"> folder, and </span><a id="_idIndexMarker199"/><span class="koboSpan" id="kobo.275.1">Windows </span><a id="_idIndexMarker200"/><span class="koboSpan" id="kobo.276.1">files are in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.277.1">Windows</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.278.1"> folder.</span></span></p>
<h3><span class="koboSpan" id="kobo.279.1">Android</span></h3>
<p><span class="koboSpan" id="kobo.280.1">The Android-specific</span><a id="_idIndexMarker201"/><span class="koboSpan" id="kobo.281.1"> platform code lives </span><a id="_idIndexMarker202"/><span class="koboSpan" id="kobo.282.1">under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.283.1">Platforms/Android</span></strong><span class="koboSpan" id="kobo.284.1"> folder in </span><span class="No-Break"><span class="koboSpan" id="kobo.285.1">the project:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer042">
<span class="koboSpan" id="kobo.286.1"><img alt="Figure 2.7 – Android-specific files" src="image/Figure_2.7_B19214.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.287.1">Figure 2.7 – Android-specific files</span></p>
<p><span class="koboSpan" id="kobo.288.1">The important files here are </span><strong class="source-inline"><span class="koboSpan" id="kobo.289.1">MainActivity.cs</span></strong><span class="koboSpan" id="kobo.290.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.291.1">MainApplication.cs</span></strong><span class="koboSpan" id="kobo.292.1">. </span><span class="koboSpan" id="kobo.292.2">These two files contain the entry point for our application when we run the app on an Android device. </span><span class="koboSpan" id="kobo.292.3">A standard Android app will declare </span><strong class="bold"><span class="koboSpan" id="kobo.293.1">Activity</span></strong><span class="koboSpan" id="kobo.294.1"> as </span><strong class="bold"><span class="koboSpan" id="kobo.295.1">MainLauncher</span></strong><span class="koboSpan" id="kobo.296.1">. </span><span class="koboSpan" id="kobo.296.2">In .NET MAUI, this is done using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.297.1">MainLauncher</span></strong><span class="koboSpan" id="kobo.298.1"> property of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.299.1">Activity</span></strong><span class="koboSpan" id="kobo.300.1"> class attribute. </span><strong class="source-inline"><span class="koboSpan" id="kobo.301.1">MauiAppCompatActivity</span></strong><span class="koboSpan" id="kobo.302.1"> will search for a type decorated with </span><strong class="source-inline"><span class="koboSpan" id="kobo.303.1">ApplicationAttribute</span></strong><span class="koboSpan" id="kobo.304.1"> and </span><span class="No-Break"><span class="koboSpan" id="kobo.305.1">instantiate it.</span></span></p>
<p><span class="koboSpan" id="kobo.306.1">This attribute can be found in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.307.1">MainApplication</span></strong><span class="koboSpan" id="kobo.308.1"> class in </span><strong class="source-inline"><span class="koboSpan" id="kobo.309.1">MainApplication.cs</span></strong><span class="koboSpan" id="kobo.310.1">. </span><span class="koboSpan" id="kobo.310.2">During initialization, </span><strong class="source-inline"><span class="koboSpan" id="kobo.311.1">MainApplication</span></strong><span class="koboSpan" id="kobo.312.1"> will call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.313.1">CreateMauiApp</span></strong><span class="koboSpan" id="kobo.314.1"> method, which, in turn, calls </span><strong class="source-inline"><span class="koboSpan" id="kobo.315.1">MauiProgram.CreateMauiApp</span></strong><span class="koboSpan" id="kobo.316.1">, which we explored earlier in </span><span class="No-Break"><span class="koboSpan" id="kobo.317.1">this chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.318.1">You don’t need to understand these files in detail; just remember that they are important for i</span><a id="_idTextAnchor123"/><span class="koboSpan" id="kobo.319.1">n</span><a id="_idTextAnchor124"/><span class="koboSpan" id="kobo.320.1">itializing </span><span class="No-Break"><span class="koboSpan" id="kobo.321.1">our app.</span></span></p>
<h3><span class="koboSpan" id="kobo.322.1">iOS and Mac Catalyst</span></h3>
<p><span class="koboSpan" id="kobo.323.1">The iOS and Mac</span><a id="_idIndexMarker203"/><span class="koboSpan" id="kobo.324.1"> Catalyst platform</span><a id="_idIndexMarker204"/><span class="koboSpan" id="kobo.325.1"> files are identical, but each has a folder for customizing the platform. </span><span class="koboSpan" id="kobo.325.2">Each platform’s files are contained in their respective named folder under the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.326.1">Platform</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.327.1"> folder:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer043">
<span class="koboSpan" id="kobo.328.1"><img alt="Figure 2.8 – iOS platform-specific files" src="image/Figure_2.8_B19214.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.329.1">Figure 2.8 – iOS platform-specific files</span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.330.1">AppDelegate.cs</span></strong><span class="koboSpan" id="kobo.331.1"> is the equivalent of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.332.1">MainApplication</span></strong><span class="koboSpan" id="kobo.333.1"> class in the Android platform. </span><span class="koboSpan" id="kobo.333.2">It contains a single method called </span><strong class="source-inline"><span class="koboSpan" id="kobo.334.1">CreateMauiApp</span></strong><span class="koboSpan" id="kobo.335.1"> that has the same implementation as Android; it calls the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.336.1">MauiProgram.CreateMauiApp</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.337.1"> method.</span></span></p>
<p><span class="koboSpan" id="kobo.338.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.339.1">Program.cs</span></strong><span class="koboSpan" id="kobo.340.1"> file is the entry point for an iOS app. </span><span class="koboSpan" id="kobo.340.2">It contains the </span><strong class="source-inline"><span class="koboSpan" id="kobo.341.1">Main</span></strong><span class="koboSpan" id="kobo.342.1"> method, which calls </span><strong class="source-inline"><span class="koboSpan" id="kobo.343.1">UIApplication.Main</span></strong><span class="koboSpan" id="kobo.344.1">, the launching point for an iOS application, and references the </span><strong class="source-inline"><span class="koboSpan" id="kobo.345.1">AppDelegate</span><a id="_idTextAnchor125"/></strong><span class="koboSpan" id="kobo.346.1"> type </span><span class="No-Break"><span class="koboSpan" id="kobo.347.1">to instantiate.</span></span></p>
<p><span class="koboSpan" id="kobo.348.1">The code starts by initializing .NET MAUI and then loads the application. </span><span class="koboSpan" id="kobo.348.2">After that, it returns control to iOS. </span><span class="koboSpan" id="kobo.348.3">It must do this within 17 seconds; otherwise, the app is terminated by </span><span class="No-Break"><span class="koboSpan" id="kobo.349.1">the OS.</span></span></p>
<p><span class="koboSpan" id="kobo.350.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.351.1">info.plist</span></strong><span class="koboSpan" id="kobo.352.1"> file is an iOS-specific file that contains information about the app, such as the bundle ID and its provisioning profiles. </span><span class="koboSpan" id="kobo.352.2">Visual Studio has a graphical editor for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.353.1">info.plist</span></strong><span class="koboSpan" id="kobo.354.1"> file, but since it is a standard XML file, it can be edited in any </span><span class="No-Break"><span class="koboSpan" id="kobo.355.1">text editor.</span></span></p>
<p><span class="koboSpan" id="kobo.356.1">As with the Android </span><a id="_idIndexMarker205"/><span class="koboSpan" id="kobo.357.1">app’s startup code, we </span><a id="_idIndexMarker206"/><span class="koboSpan" id="kobo.358.1">don’t need to under</span><a id="_idTextAnchor126"/><span class="koboSpan" id="kobo.359.1">stand what is going on here in detail, other than that it’s important for</span><a id="_idTextAnchor127"/><span class="koboSpan" id="kobo.360.1"> initializing </span><span class="No-Break"><span class="koboSpan" id="kobo.361.1">our app.</span></span></p>
<h3><span class="koboSpan" id="kobo.362.1">Tizen</span></h3>
<p><span class="koboSpan" id="kobo.363.1">Tizen is Samsung’s</span><a id="_idIndexMarker207"/><span class="koboSpan" id="kobo.364.1"> custom distribution of Android. </span><span class="koboSpan" id="kobo.364.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.365.1">Main.cs</span></strong><span class="koboSpan" id="kobo.366.1"> file is the</span><a id="_idIndexMarker208"/><span class="koboSpan" id="kobo.367.1"> launching point and, like the Android platform, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.368.1">Program</span></strong><span class="koboSpan" id="kobo.369.1"> class has a </span><strong class="source-inline"><span class="koboSpan" id="kobo.370.1">CreateMauiApp</span></strong><span class="koboSpan" id="kobo.371.1"> method. </span><span class="koboSpan" id="kobo.371.2">Tizen is not enabled by default. </span><span class="koboSpan" id="kobo.371.3">To enable it, follow the instructions in the comments in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.372.1">DoToo.csproj</span></strong><span class="koboSpan" id="kobo.373.1"> file. </span><span class="koboSpan" id="kobo.373.2">To develop applications for Tizen, you will need to install additional software distributed </span><span class="No-Break"><span class="koboSpan" id="kobo.374.1">by Samsung.</span></span></p>
<h3><span class="koboSpan" id="kobo.375.1">Windows</span></h3>
<p><span class="koboSpan" id="kobo.376.1">The last </span><a id="_idIndexMarker209"/><span class="koboSpan" id="kobo.377.1">platform </span><a id="_idIndexMarker210"/><span class="koboSpan" id="kobo.378.1">we will examine is the </span><strong class="bold"><span class="koboSpan" id="kobo.379.1">WinUI</span></strong><span class="koboSpan" id="kobo.380.1"> app. </span><span class="koboSpan" id="kobo.380.2">The file </span><a id="_idIndexMarker211"/><span class="koboSpan" id="kobo.381.1">structure looks </span><span class="No-Break"><span class="koboSpan" id="kobo.382.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer044">
<span class="koboSpan" id="kobo.383.1"><img alt="Figure 2.9 – Windows-specific files" src="image/Figure_2.9_B19214.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.384.1">Figure 2.9 – Windows-specific files</span></p>
<p><span class="koboSpan" id="kobo.385.1">It has an </span><strong class="source-inline"><span class="koboSpan" id="kobo.386.1">App.xaml</span></strong><span class="koboSpan" id="kobo.387.1"> file, which is like the one in the shared code, but specific to </span><strong class="bold"><span class="koboSpan" id="kobo.388.1">Universal Windows Platform</span></strong><span class="koboSpan" id="kobo.389.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.390.1">UWP</span></strong><span class="koboSpan" id="kobo.391.1">) apps. </span><span class="koboSpan" id="kobo.391.2">It also has a related file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.392.1">App.xaml.cs</span></strong><span class="koboSpan" id="kobo.393.1">. </span><span class="koboSpan" id="kobo.393.2">This </span><a id="_idIndexMarker212"/><span class="koboSpan" id="kobo.394.1">file is the Windows equivalent of Android’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.395.1">MauiApplication</span></strong><span class="koboSpan" id="kobo.396.1">, which contains the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.397.1">CreateMauiApp</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.398.1"> method.</span></span></p>
<p><span class="koboSpan" id="kobo.399.1">That’s it for the</span><a id="_idIndexMarker213"/><span class="koboSpan" id="kobo.400.1"> platform project files. </span><span class="koboSpan" id="kobo.400.2">Next, we will look at how to keep .NET MAUI up </span><span class="No-Break"><span class="koboSpan" id="kobo.401.1">to date.</span></span></p>
<h2 id="_idParaDest-41"><a id="_idTextAnchor128"/><span class="koboSpan" id="kobo.402.1">Updating the .NET MAUI packages</span></h2>
<p class="callout-heading"><span class="koboSpan" id="kobo.403.1">Note – Windows users</span></p>
<p class="callout"><span class="koboSpan" id="kobo.404.1">Since .NET MAUI is distributed as part of Visual Studio, it is best to allow Visual Studio to update the packages when you update Visual Studio. </span><span class="koboSpan" id="kobo.404.2">If you follow these steps, you can probably get .NET MAUI into an </span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">unusable state.</span></span></p>
<p><span class="koboSpan" id="kobo.406.1">.NET MAUI is</span><a id="_idIndexMarker214"/><span class="koboSpan" id="kobo.407.1"> distributed as a set of optional </span><strong class="bold"><span class="koboSpan" id="kobo.408.1">.NET workloads</span></strong><span class="koboSpan" id="kobo.409.1">. </span><span class="koboSpan" id="kobo.409.2">Workloads</span><a id="_idIndexMarker215"/><span class="koboSpan" id="kobo.410.1"> are managed from the command line using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.411.1">dotnet workload</span></strong><span class="koboSpan" id="kobo.412.1"> command. </span><span class="koboSpan" id="kobo.412.2">To see the currently installed workloads and their versions, you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.413.1">dotnet workload list</span></strong><span class="koboSpan" id="kobo.414.1"> command. </span><span class="koboSpan" id="kobo.414.2">Visual Studio 2022 has a built-in developer PowerShell to execute commands. </span><span class="koboSpan" id="kobo.414.3">To access it, press </span><em class="italic"><span class="koboSpan" id="kobo.415.1">Ctrl</span></em><span class="koboSpan" id="kobo.416.1"> + </span><em class="italic"><span class="koboSpan" id="kobo.417.1">`</span></em><span class="koboSpan" id="kobo.418.1"> on both macOS </span><span class="No-Break"><span class="koboSpan" id="kobo.419.1">and Windows.</span></span></p>
<p><span class="koboSpan" id="kobo.420.1">Running the </span><strong class="source-inline"><span class="koboSpan" id="kobo.421.1">dotnet workload list</span></strong><span class="koboSpan" id="kobo.422.1"> should give you the following output. </span><span class="koboSpan" id="kobo.422.2">Note that your version numbers may </span><span class="No-Break"><span class="koboSpan" id="kobo.423.1">be higher:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.424.1">
C:\Users\cummings.michael\Source\Repos\DoToo
&gt; dotnet workload list
Installed Workload Ids      Manifest Version                              Installation Source
---------------------------------------------------------------------------------------------
maui-windows                6.0.486/6.0.400                          
     VS 17.3.32901.215
maui-maccatalyst            6.0.486/6.0.400                          
     VS 17.3.32901.215
maccatalyst                 15.4.446-ci.-release-6-0-4xx.446/6.0.400
      VS 17.3.32901.215
maui-ios                    6.0.486/6.0.400                         
      VS 17.3.32901.215
ios                         15.4.446-ci.-release-6-0-4xx.446/6.0.400
      VS 17.3.32901.215
maui-android                6.0.486/6.0.400                         
      VS 17.3.32901.215
android                     32.0.448/6.0.400                        
      VS 17.3.32901.215
Use `dotnet workload search` to find additional workloads to install.</span></pre> <p><span class="koboSpan" id="kobo.425.1">To update the </span><a id="_idIndexMarker216"/><span class="koboSpan" id="kobo.426.1">packages in the MAUI workload, you can run </span><strong class="source-inline"><span class="koboSpan" id="kobo.427.1">dotnet workload update</span></strong><span class="koboSpan" id="kobo.428.1">. </span><span class="koboSpan" id="kobo.428.2">This is a sample of the result from running </span><span class="No-Break"><span class="koboSpan" id="kobo.429.1">that command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.430.1">
C:\Users\cummings.michael\Source\Repos\DoToo
&gt; dotnet workload update
No workloads installed for this feature band. </span><span class="koboSpan" id="kobo.430.2">To update workloads 
installed with earlier SDK
versions, include the --from-previous-sdk option.
</span><span class="koboSpan" id="kobo.430.3">Updated advertising manifest microsoft.net.sdk.android.
</span><span class="koboSpan" id="kobo.430.4">Updated advertising manifest microsoft.net.sdk.tvos.
</span><span class="koboSpan" id="kobo.430.5">Updated advertising manifest microsoft.net.sdk.macos.
</span><span class="koboSpan" id="kobo.430.6">Updated advertising manifest microsoft.net.sdk.maui.
</span><span class="koboSpan" id="kobo.430.7">Updated advertising manifest microsoft.net.workload.emscripten.
</span><span class="koboSpan" id="kobo.430.8">Updated advertising manifest microsoft.net.sdk.ios.
</span><span class="koboSpan" id="kobo.430.9">Updated advertising manifest microsoft.net.sdk.maccatalyst.
</span><span class="koboSpan" id="kobo.430.10">Updated advertising manifest microsoft.net.workload.mono.toolchain.
</span><span class="koboSpan" id="kobo.430.11">Downloading microsoft.net.sdk.android.manifest-6.0.400.msi.x64 
(32.0.465)
Installing Microsoft.NET.Sdk.Android.Manifest-6.0.400.32.0.465-x64.msi 
......... </span><span class="koboSpan" id="kobo.430.12">Done
Downloading microsoft.net.sdk.ios.manifest-6.0.400.msi.x64 (15.4.454)
Downloading microsoft.net.sdk.maccatalyst.manifest-6.0.400.msi.x64 
(15.4.454)
Downloading microsoft.net.sdk.macos.manifest-6.0.400.msi.x64 
(12.3.454)
Installing Microsoft.NET.Sdk.macOS.Manifest-6.0.400.12.3.454-x64.msi ...... </span><span class="koboSpan" id="kobo.430.13">Done
Downloading microsoft.net.sdk.maui.manifest-6.0.400.msi.x64 (6.0.540)
Installing Microsoft.NET.Sdk.Maui.Manifest-6.0.400.6.0.540-x64.msi 
...... </span><span class="koboSpan" id="kobo.430.14">Done
Downloading microsoft.net.sdk.tvos.manifest-6.0.400.msi.x64 (15.4.454)
Downloading microsoft.net.workload.mono.toolchain.manifest-6.0.400.
</span><span class="koboSpan" id="kobo.430.15">msi.x64 (6.0.9)
Installing Microsoft.NET.Workload.Mono.ToolChain.Manifest-
6.0.400.6.0.9-x64.msi ....... </span><span class="koboSpan" id="kobo.430.16">Done
Downloading microsoft.net.workload.emscripten.manifest-6.0.400.msi.x64 
(6.0.9)
Installing Microsoft.NET.Workload.Emscripten.Manifest-
6.0.400.6.0.9-x64.msi ...... </span><span class="koboSpan" id="kobo.430.17">Done
No workloads installed for this feature band. </span><span class="koboSpan" id="kobo.430.18">To update workloads 
installed 
with earlier SDK versions, include the --from-previous-sdk option.
</span><span class="koboSpan" id="kobo.430.19">Successfully updated workload(s): .</span></pre> <p><span class="koboSpan" id="kobo.431.1">To see the</span><a id="_idIndexMarker217"/><span class="koboSpan" id="kobo.432.1"> result, just run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.433.1">dotnet workload list</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.434.1">command again:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.435.1">
C:\Users\cummings.michael\Source\Repos\DoToo
&gt; dotnet workload list
Installed Workload Ids      Manifest Version
Installation Source
---------------------------------------------------------------------------------------------
maui-windows                6.0.540/6.0.400                            
   VS 17.3.32901.215
maui-maccatalyst            6.0.540/6.0.400                            
   VS 17.3.32901.215
maccatalyst                 15.4.446-ci.-release-6-0-4xx.446/6.0.400   
   VS 17.3.32901.215
maui-ios                    6.0.540/6.0.400                            
   VS 17.3.32901.215
ios                         15.4.446-ci.-release-6-0-4xx.446/6.0.400   
   VS 17.3.32901.215
maui-android                6.0.540/6.0.400                            
   VS 17.3.32901.215
android                     32.0.465/6.0.400                           
   VS 17.3.32901.215
Use `dotnet workload search` to find </span><a id="_idTextAnchor129"/><a id="_idTextAnchor130"/><a id="_idTextAnchor131"/><span class="koboSpan" id="kobo.436.1">additional workloads to install.</span></pre> <p><span class="koboSpan" id="kobo.437.1">Now that we</span><a id="_idIndexMarker218"/><span class="koboSpan" id="kobo.438.1"> have a basic understanding of how .NET MAUI projects are structured, we can start building our </span><span class="No-Break"><span class="koboSpan" id="kobo.439.1">first app!</span></span></p>
<h1 id="_idParaDest-42"><a id="_idTextAnchor132"/><span class="koboSpan" id="kobo.440.1">Creating a repository and a TodoItem model</span></h1>
<p><span class="koboSpan" id="kobo.441.1">Any good architecture</span><a id="_idIndexMarker219"/><span class="koboSpan" id="kobo.442.1"> always </span><a id="_idIndexMarker220"/><span class="koboSpan" id="kobo.443.1">involves abstraction. </span><span class="koboSpan" id="kobo.443.2">In this app, we need something to store and retrieve the items of our to-do list. </span><span class="koboSpan" id="kobo.443.3">Later, these will be stored in a SQLite database, but adding a reference to the database directly in the code that is responsible for the GUI is generally a bad idea as it tightly couples your data storage implementation to the UI layer, making it harder to test your UI code independently from </span><span class="No-Break"><span class="koboSpan" id="kobo.444.1">the database.</span></span></p>
<p><span class="koboSpan" id="kobo.445.1">So, what we need is something to abstract our database from the GUI. </span><span class="koboSpan" id="kobo.445.2">For this app, we’ve chosen to use a simple repository pattern. </span><span class="koboSpan" id="kobo.445.3">This repository is simply a class that sits between the SQLite database and our upcoming </span><strong class="source-inline"><span class="koboSpan" id="kobo.446.1">ViewModel</span></strong><span class="koboSpan" id="kobo.447.1"> class. </span><span class="koboSpan" id="kobo.447.2">This is the class that handles the interaction with the view, which, in turn, handles </span><span class="No-Break"><span class="koboSpan" id="kobo.448.1">the GUI.</span></span></p>
<p><span class="koboSpan" id="kobo.449.1">The repository will expose methods for getting, adding, and updating items, as well as events that allow other parts of the app to react to changes in the repository. </span><span class="koboSpan" id="kobo.449.2">It will be hidden behind an interface so that we can replace the entire implementation later without modifying anything but a line of code in the init</span><a id="_idTextAnchor133"/><span class="koboSpan" id="kobo.450.1">ialization of the app. </span><span class="koboSpan" id="kobo.450.2">This is made possible by</span><a id="_idIndexMarker221"/><span class="koboSpan" id="kobo.451.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.452.1">Microsoft.Extension</span><a id="_idTextAnchor134"/><span class="koboSpan" id="kobo.453.1">s.DependencyInjection</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.454.1">NuGet package.</span></span></p>
<h2 id="_idParaDest-43"><a id="_idTextAnchor135"/><span class="koboSpan" id="kobo.455.1">Defining a to-do list item</span></h2>
<p><span class="koboSpan" id="kobo.456.1">We will start by</span><a id="_idIndexMarker222"/><span class="koboSpan" id="kobo.457.1"> creating a </span><strong class="source-inline"><span class="koboSpan" id="kobo.458.1">TodoItem</span></strong><span class="koboSpan" id="kobo.459.1"> class, which represents a single item on the list. </span><span class="koboSpan" id="kobo.459.2">This is a</span><a id="_idIndexMarker223"/><span class="koboSpan" id="kobo.460.1"> simple </span><strong class="bold"><span class="koboSpan" id="kobo.461.1">Plain Old CLR Object</span></strong><span class="koboSpan" id="kobo.462.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.463.1">POCO</span></strong><span class="koboSpan" id="kobo.464.1">) class, where </span><strong class="bold"><span class="koboSpan" id="kobo.465.1">CLR</span></strong><span class="koboSpan" id="kobo.466.1"> stands </span><a id="_idIndexMarker224"/><span class="koboSpan" id="kobo.467.1">for </span><strong class="bold"><span class="koboSpan" id="kobo.468.1">Common Language Runtime</span></strong><span class="koboSpan" id="kobo.469.1">. </span><span class="koboSpan" id="kobo.469.2">In other words, this is a .NET class without any dependencies on third-party assemblies. </span><span class="koboSpan" id="kobo.469.3">To create the class, follow </span><span class="No-Break"><span class="koboSpan" id="kobo.470.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.471.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.472.1">DoToo</span></strong><span class="koboSpan" id="kobo.473.1"> project, create a folder </span><span class="No-Break"><span class="koboSpan" id="kobo.474.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.475.1">Models</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.476.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.477.1">Add a class called </span><strong class="source-inline"><span class="koboSpan" id="kobo.478.1">TodoItem.cs</span></strong><span class="koboSpan" id="kobo.479.1"> to that folder and enter the </span><span class="No-Break"><span class="koboSpan" id="kobo.480.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.481.1">
namespace DoToo.Models;
using System;
public class TodoItem
{
    public int Id { get; set; }
    public string Title { get; set; }</span><a id="_idTextAnchor136"/><span class="koboSpan" id="kobo.482.1">
    public bool Completed { get; set; }
    public DateTime Due { get; set; }
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.483.1">This code is self-explanatory; it’s a simple POCO class that only contains properties and no logic. </span><span class="koboSpan" id="kobo.483.2">We have a </span><strong class="source-inline"><span class="koboSpan" id="kobo.484.1">Title</span></strong><span class="koboSpan" id="kobo.485.1"> property that describes what we want to be done, a flag named </span><strong class="source-inline"><span class="koboSpan" id="kobo.486.1">Completed</span></strong><span class="koboSpan" id="kobo.487.1"> that determines whether the to-do list item is completed, a </span><strong class="source-inline"><span class="koboSpan" id="kobo.488.1">Due</span></strong><span class="koboSpan" id="kobo.489.1"> date for when we expect it</span><a id="_idIndexMarker225"/><span class="koboSpan" id="kobo.490.1"> to be done, and a unique </span><strong class="source-inline"><span class="koboSpan" id="kobo.491.1">Id</span></strong><span class="koboSpan" id="kobo.492.1"> property t</span><a id="_idTextAnchor137"/><a id="_idTextAnchor138"/><span class="koboSpan" id="kobo.493.1">hat we will need later for </span><span class="No-Break"><span class="koboSpan" id="kobo.494.1">the database.</span></span></p>
<h2 id="_idParaDest-44"><a id="_idTextAnchor139"/><span class="koboSpan" id="kobo.495.1">Creating a repository and its interface</span></h2>
<p><span class="koboSpan" id="kobo.496.1">Now that</span><a id="_idIndexMarker226"/><span class="koboSpan" id="kobo.497.1"> we </span><a id="_idIndexMarker227"/><span class="koboSpan" id="kobo.498.1">have the </span><strong class="source-inline"><span class="koboSpan" id="kobo.499.1">TodoItem</span></strong><span class="koboSpan" id="kobo.500.1"> class, let’s define an interface that describes a repository that will store our to-do </span><span class="No-Break"><span class="koboSpan" id="kobo.501.1">list items:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.502.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.503.1">DoToo</span></strong><span class="koboSpan" id="kobo.504.1"> project, create a folder </span><span class="No-Break"><span class="koboSpan" id="kobo.505.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.506.1">Repositories</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.507.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.508.1">Create an interface called </span><strong class="source-inline"><span class="koboSpan" id="kobo.509.1">ITodoItemRepository.cs</span></strong><span class="koboSpan" id="kobo.510.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.511.1">Repositories</span></strong><span class="koboSpan" id="kobo.512.1"> folder </span><a id="_idIndexMarker228"/><span class="koboSpan" id="kobo.513.1">and </span><a id="_idIndexMarker229"/><span class="koboSpan" id="kobo.514.1">write the </span><span class="No-Break"><span class="koboSpan" id="kobo.515.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.516.1">
namespace DoToo.Repositories;
using DoToo.Models;
public interface ITodoItemRepository
{
    event EventHandler&lt;TodoItem&gt; OnItemAdded;
    event EventHandler&lt;TodoItem&gt; OnItemUpdated;
    Task&lt;List&lt;TodoItem&gt;&gt; GetItemsAsync();
    Task AddItemAsync(TodoItem item);
    Task UpdateItemAsync(TodoItem item);
    Task AddOrUpdateAsync(TodoItem item);
}</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.517.1">Wait, what? </span><span class="koboSpan" id="kobo.517.2">No Delete method?</span></p>
<p class="callout"><span class="koboSpan" id="kobo.518.1">The eagle-eyed among you might have noticed that we are not defining a </span><strong class="source-inline"><span class="koboSpan" id="kobo.519.1">Delete</span></strong><span class="koboSpan" id="kobo.520.1"> method in this interface. </span><span class="koboSpan" id="kobo.520.2">This is something that should be in a real-world app. </span><span class="koboSpan" id="kobo.520.3">While the app that we are creating in this chapter does not support deleting items, we are quite sure tha</span><a id="_idTextAnchor140"/><span class="koboSpan" id="kobo.521.1">t you could add this yourself if you </span><span class="No-Break"><span class="koboSpan" id="kobo.522.1">want to!</span></span></p>
<p><span class="koboSpan" id="kobo.523.1">This interface defines everything we need for our app. </span><span class="koboSpan" id="kobo.523.2">It is there to create logical insulation between your implementation of a repository and the user of that repository. </span><span class="koboSpan" id="kobo.523.3">If any other parts of your application want an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.524.1">ITodoItemRepository</span></strong><span class="koboSpan" id="kobo.525.1">, we can pass it an object that implements </span><strong class="source-inline"><span class="koboSpan" id="kobo.526.1">ITodoItemRepository</span></strong><span class="koboSpan" id="kobo.527.1">, regardless of how </span><span class="No-Break"><span class="koboSpan" id="kobo.528.1">it’s implemented.</span></span></p>
<p><span class="koboSpan" id="kobo.529.1">With that said, let’s </span><span class="No-Break"><span class="koboSpan" id="kobo.530.1">implement </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.531.1">ITodoItemRepository</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.532.1">:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.533.1">Create a class called </span><strong class="source-inline"><span class="koboSpan" id="kobo.534.1">TodoItemRepository.cs</span></strong><span class="koboSpan" id="kobo.535.1"> in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.536.1">Repositories</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.537.1"> folder.</span></span></li>
<li><span class="koboSpan" id="kobo.538.1">Enter the </span><a id="_idIndexMarker230"/><span class="No-Break"><span class="koboSpan" id="kobo.539.1">following </span></span><span class="No-Break"><a id="_idIndexMarker231"/></span><span class="No-Break"><span class="koboSpan" id="kobo.540.1">code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.541.1">
namespace DoToo.Repositories;
using DoToo.Models;
public class TodoItemRepository : ITodoItemRepository
{
    public event EventHandler&lt;TodoItem&gt; OnItemAdded;
    public event EventHandler&lt;TodoItem&gt; OnItemUpdated;
    public async Task&lt;List&lt;TodoItem&gt;&gt; GetItemsAsync()
    {
        return null; // Just to make it build
    }
    public async Task AddItemAsync(TodoItem item)
    {
    }
    public async Task UpdateItemAsync(TodoItem item)
    {
    }
    public async Task AddOrUpdateAsync(TodoItem item)
    {
        if (item.Id == 0)
        {
            await AddItemAsync(item);
        }
        else
        {
            </span><a id="_idTextAnchor141"/><span class="koboSpan" id="kobo.542.1">await UpdateItemAsync(item);
        }
    }
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.543.1">This code is the bare-bones implementation of the interface, except for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.544.1">AddOrUpdateAsync(...)</span></strong><span class="koboSpan" id="kobo.545.1"> method. </span><span class="koboSpan" id="kobo.545.2">This handles a small piece of logic that states that if the </span><strong class="source-inline"><span class="koboSpan" id="kobo.546.1">Id</span></strong><span class="koboSpan" id="kobo.547.1"> value of an item is </span><strong class="source-inline"><span class="koboSpan" id="kobo.548.1">0</span></strong><span class="koboSpan" id="kobo.549.1">, it’s a new item. </span><span class="koboSpan" id="kobo.549.2">Any item with an </span><strong class="source-inline"><span class="koboSpan" id="kobo.550.1">Id</span></strong><span class="koboSpan" id="kobo.551.1"> value greater than </span><strong class="source-inline"><span class="koboSpan" id="kobo.552.1">0</span></strong><span class="koboSpan" id="kobo.553.1"> is stored in the database. </span><span class="koboSpan" id="kobo.553.2">This is because the database assigns a value larger than </span><strong class="source-inline"><span class="koboSpan" id="kobo.554.1">0</span></strong><span class="koboSpan" id="kobo.555.1"> when we create rows in </span><span class="No-Break"><span class="koboSpan" id="kobo.556.1">a table.</span></span></p>
<p><span class="koboSpan" id="kobo.557.1">There are also two </span><a id="_idIndexMarker232"/><span class="koboSpan" id="kobo.558.1">events </span><a id="_idIndexMarker233"/><span class="koboSpan" id="kobo.559.1">defined in</span><a id="_idTextAnchor142"/><span class="koboSpan" id="kobo.560.1"> the preceding code. </span><span class="koboSpan" id="kobo.560.2">They will be used to notify subscribers of </span><a id="_idTextAnchor143"/><span class="koboSpan" id="kobo.561.1">a list of items that have been updated </span><span class="No-Break"><span class="koboSpan" id="kobo.562.1">or added.</span></span></p>
<h2 id="_idParaDest-45"><a id="_idTextAnchor144"/><span class="koboSpan" id="kobo.563.1">Connecting SQLite to persist data</span></h2>
<p><span class="koboSpan" id="kobo.564.1">We now have an</span><a id="_idIndexMarker234"/><span class="koboSpan" id="kobo.565.1"> interface, as well as a skeleton to </span><a id="_idIndexMarker235"/><span class="koboSpan" id="kobo.566.1">implement that interface. </span><span class="koboSpan" id="kobo.566.2">The last thing we need to do to finish this section</span><a id="_idTextAnchor145"/><span class="koboSpan" id="kobo.567.1"> is to conne</span><a id="_idTextAnchor146"/><span class="koboSpan" id="kobo.568.1">ct SQLite in the implementation of </span><span class="No-Break"><span class="koboSpan" id="kobo.569.1">the repository.</span></span></p>
<h3><span class="koboSpan" id="kobo.570.1">Adding the SQLite NuGet package</span></h3>
<p><span class="koboSpan" id="kobo.571.1">To access SQLite in </span><a id="_idIndexMarker236"/><span class="koboSpan" id="kobo.572.1">this project, we need to add a NuGet package called </span><strong class="source-inline"><span class="koboSpan" id="kobo.573.1">sqlite-net-pcl</span></strong><span class="koboSpan" id="kobo.574.1"> to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.575.1">DoToo</span></strong><span class="koboSpan" id="kobo.576.1"> project. </span><span class="koboSpan" id="kobo.576.2">To do this, right-click on the </span><strong class="bold"><span class="koboSpan" id="kobo.577.1">Dependencies</span></strong><span class="koboSpan" id="kobo.578.1"> item under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.579.1">DoToo</span></strong><span class="koboSpan" id="kobo.580.1"> project node of the solution and click </span><strong class="bold"><span class="koboSpan" id="kobo.581.1">Manage </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.582.1">NuGet Packages...</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.583.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer045">
<span class="koboSpan" id="kobo.584.1"><img alt="Figure 2.10 – Manage NuGet Packages..." src="image/Figure_2.10_B19214.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.585.1">Figure 2.10 – Manage NuGet Packages...</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.586.1">Portable Class Library (PCL)</span></p>
<p class="callout"><span class="koboSpan" id="kobo.587.1">You might </span><a id="_idIndexMarker237"/><span class="koboSpan" id="kobo.588.1">have noticed that the NuGet package is suffixed with </span><strong class="source-inline"><span class="koboSpan" id="kobo.589.1">-pcl</span></strong><span class="koboSpan" id="kobo.590.1">. </span><span class="koboSpan" id="kobo.590.2">This is an example of what happens when naming conventions go wrong. </span><span class="koboSpan" id="kobo.590.3">This package supports .NET Standard 1.0, even though the name says PCL, which was the predecessor of .</span><span class="No-Break"><span class="koboSpan" id="kobo.591.1">NET Standard.</span></span></p>
<p><span class="koboSpan" id="kobo.592.1">This brings up the </span><strong class="bold"><span class="koboSpan" id="kobo.593.1">NuGet Package </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.594.1">Manager</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.595.1"> window:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer046">
<span class="koboSpan" id="kobo.596.1"><img alt="Figure 2.11 – NuGet Package Manager" src="image/Figure_2.11_B19214.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.597.1">Figure 2.11 – NuGet Package Manager</span></p>
<p><span class="koboSpan" id="kobo.598.1">To install the SQLite NuGet package, follow </span><span class="No-Break"><span class="koboSpan" id="kobo.599.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.600.1">Click </span><strong class="bold"><span class="koboSpan" id="kobo.601.1">Browse</span></strong><span class="koboSpan" id="kobo.602.1"> and enter </span><strong class="source-inline"><span class="koboSpan" id="kobo.603.1">sqlite-net-pcl</span></strong><span class="koboSpan" id="kobo.604.1"> in the </span><span class="No-Break"><span class="koboSpan" id="kobo.605.1">search box.</span></span></li>
<li><span class="koboSpan" id="kobo.606.1">Select the package</span><a id="_idIndexMarker238"/><span class="koboSpan" id="kobo.607.1"> by </span><strong class="bold"><span class="koboSpan" id="kobo.608.1">sQLite-net</span></strong><span class="koboSpan" id="kobo.609.1"> and </span><span class="No-Break"><span class="koboSpan" id="kobo.610.1">click </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.611.1">Install</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.612.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.613.1">A dialog will be displayed showing you all the packages that will be downloaded</span><a id="_idIndexMarker239"/><span class="koboSpan" id="kobo.614.1"> to your system; accept the changes to complete </span><span class="No-Break"><span class="koboSpan" id="kobo.615.1">the installation.</span></span></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.616.1">Important</span></p>
<p class="callout"><span class="koboSpan" id="kobo.617.1">Version 1.8.116 of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.618.1">sqlite-net-pcl</span></strong><span class="koboSpan" id="kobo.619.1"> package references versions of the native library that are not fully compatible with .NET 6+ on all platforms. </span><span class="koboSpan" id="kobo.619.2">To work around this, you need to add additional references to the following packages manually with a version of at </span><span class="No-Break"><span class="koboSpan" id="kobo.620.1">least 2.1:</span></span></p>
<p class="callout"><span class="koboSpan" id="kobo.621.1">    - </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.622.1">SQLitePCLRaw.core</span></strong></span></p>
<p class="callout"><span class="koboSpan" id="kobo.623.1">    - </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.624.1">SQLitePCLRaw.provider.sqlite3</span></strong></span></p>
<p class="callout"><span class="koboSpan" id="kobo.625.1">    - </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.626.1">SQLitePCLRaw.bundle_green</span></strong></span></p>
<p class="callout"><span class="koboSpan" id="kobo.627.1">    - </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.628.1">SQLitePCLRaw.provider.dynamic_cdecl</span></strong></span></p>
<p class="callout"><span class="koboSpan" id="kobo.629.1">See </span><a href="https://github.com/praeclarum/sqlite-net/issues/1102"><span class="koboSpan" id="kobo.630.1">https://github.com/praeclarum/sqlite-net/issues/1102</span></a><span class="koboSpan" id="kobo.631.1"> for more details and a </span><span class="No-Break"><span class="koboSpan" id="kobo.632.1">potential resolution.</span></span></p>
<p><span class="koboSpan" id="kobo.633.1">Once the installation is complete, we can add some code to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.634.1">TodoItem</span></strong><span class="koboSpan" id="kobo.635.1"> class to map the C# object </span><a id="_idIndexMarker240"/><span class="koboSpan" id="kobo.636.1">to a table and cr</span><a id="_idTextAnchor147"/><a id="_idTextAnchor148"/><a id="_idTextAnchor149"/><span class="koboSpan" id="kobo.637.1">eate the connection to the database in </span><span class="No-Break"><span class="koboSpan" id="kobo.638.1">the repository.</span></span></p>
<h3><span class="koboSpan" id="kobo.639.1">Updating the TodoItem class</span></h3>
<p><span class="koboSpan" id="kobo.640.1">Since SQLite is </span><a id="_idIndexMarker241"/><span class="koboSpan" id="kobo.641.1">a relational database, it needs to know some basic information about how to create the tables that will store our objects. </span><span class="koboSpan" id="kobo.641.2">This is done using attributes, which are defined in the </span><span class="No-Break"><span class="koboSpan" id="kobo.642.1">SQLite namespace:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.643.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.644.1">Models/TodoItem.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.645.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.646.1">Add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.647.1">using SQLite</span></strong><span class="koboSpan" id="kobo.648.1"> statement at the start of the file right below the </span><strong class="source-inline"><span class="koboSpan" id="kobo.649.1">namespace</span></strong><span class="koboSpan" id="kobo.650.1"> statement, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.651.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.652.1">
namespace DoToo.Models;
</span><strong class="bold"><span class="koboSpan" id="kobo.653.1">using SQLite;</span></strong><span class="koboSpan" id="kobo.654.1">
public class TodoItem</span></pre></li> <li><span class="koboSpan" id="kobo.655.1">Add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.656.1">PrimaryKey</span></strong><span class="koboSpan" id="kobo.657.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.658.1">AutoIncrement</span></strong><span class="koboSpan" id="kobo.659.1"> attributes right before the </span><strong class="source-inline"><span class="koboSpan" id="kobo.660.1">Id</span></strong><span class="koboSpan" id="kobo.661.1"> property, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.662.1">following code:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.663.1">[PrimaryKey, AutoIncrement]</span></strong><span class="koboSpan" id="kobo.664.1">
public int Id { get; set; }</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.665.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.666.1">PrimaryKey</span></strong><span class="koboSpan" id="kobo.667.1"> attribute instructs SQLite that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.668.1">Id</span></strong><span class="koboSpan" id="kobo.669.1"> property is the primary key of the table. </span><span class="koboSpan" id="kobo.669.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.670.1">AutoIncrement</span></strong><span class="koboSpan" id="kobo.671.1"> attribute makes sure that the value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.672.1">Id</span></strong><span class="koboSpan" id="kobo.673.1"> is increased by 1 for each new </span><strong class="source-inline"><span class="koboSpan" id="kobo.674.1">TodoItem</span></strong><span class="koboSpan" id="kobo.675.1"> class that is added to </span><span class="No-Break"><span class="koboSpan" id="kobo.676.1">the table.</span></span></p></li> </ol>
<p><span class="koboSpan" id="kobo.677.1">With the data object classes properly configured, it</span><a id="_idTextAnchor150"/><a id="_idTextAnchor151"/><span class="koboSpan" id="kobo.678.1"> is now time to create the connection to </span><span class="No-Break"><span class="koboSpan" id="kobo.679.1">the database.</span></span></p>
<h3><span class="koboSpan" id="kobo.680.1">Creating a connection to the SQLite database</span></h3>
<p><span class="koboSpan" id="kobo.681.1">We will now add</span><a id="_idIndexMarker242"/><span class="koboSpan" id="kobo.682.1"> all the code needed to communicate with the database. </span><span class="koboSpan" id="kobo.682.2">The first thing we need to do is define a connection field that will hold the connection to </span><span class="No-Break"><span class="koboSpan" id="kobo.683.1">the database:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.684.1">Open the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.685.1">Repositories/TodoItemRepository.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.686.1"> file.</span></span></li>
<li><span class="koboSpan" id="kobo.687.1">Add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.688.1">using SQLite</span></strong><span class="koboSpan" id="kobo.689.1"> statement right below the existing </span><strong class="source-inline"><span class="koboSpan" id="kobo.690.1">using</span></strong><span class="koboSpan" id="kobo.691.1"> statements, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.692.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.693.1">
namespace DoToo.Repositories;
using DoToo.Models;
</span><strong class="bold"><span class="koboSpan" id="kobo.694.1">using SQLite;</span></strong><span class="koboSpan" id="kobo.695.1">
public class TodoItemRepository : ITodoItemRepository</span></pre></li> <li><span class="koboSpan" id="kobo.696.1">Add</span><a id="_idTextAnchor152"/><span class="koboSpan" id="kobo.697.1"> the following field right below the </span><span class="No-Break"><span class="koboSpan" id="kobo.698.1">class declaration:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.699.1">
private SQLiteAsyncConnection connection;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.700.1">The connection needs to be initialized. </span><span class="koboSpan" id="kobo.700.2">Once it is initialized, it can be reused throughout the lifespan of the repository. </span><span class="koboSpan" id="kobo.700.3">Since the method is asynchronous, it cannot be called from the constructor without introducing a locking strategy. </span><span class="koboSpan" id="kobo.700.4">To keep things simple, we will simply call it from each of the methods that are defined by the interface. </span><span class="koboSpan" id="kobo.700.5">To do so, add the following code to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.701.1">TodoItemRepository</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.702.1"> class:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.703.1">
private async Task CreateConnectionAsync() 
{ 
    if (connection != null) 
    { 
        return; 
    } 
 
    var documentPath = Environment.GetFolderPath(Environment.
</span><span class="koboSpan" id="kobo.703.2">SpecialFolder.MyDocuments); 
    var databasePath = Path.Combine(documentPath, "TodoItems.db"); 
 
    connection = new SQLiteAsyncConnection(databasePath);  
    await connection.CreateTableAsync&lt;TodoItem&gt;(); 
 
    if (await connection.Table&lt;TodoItem&gt;().CountAsync() == 0) 
    { 
        await connection.InsertAsync(new TodoItem() 
        { 
            Title = "Welcome to DoToo", 
            Due = DateTime.Now 
        }); 
    } 
}</span></pre> <p><span class="koboSpan" id="kobo.704.1">The method begins</span><a id="_idIndexMarker243"/><span class="koboSpan" id="kobo.705.1"> by checking whether we already have a connection. </span><span class="koboSpan" id="kobo.705.2">If we do, we can simply </span><strong class="source-inline"><span class="koboSpan" id="kobo.706.1">return</span></strong><span class="koboSpan" id="kobo.707.1">. </span><span class="koboSpan" id="kobo.707.2">If we don’t have a connection set up, we define a path on the disk to indicate where we want the database file to be located. </span><span class="koboSpan" id="kobo.707.3">In this case, we will choose the </span><strong class="source-inline"><span class="koboSpan" id="kobo.708.1">MyDocuments</span></strong><span class="koboSpan" id="kobo.709.1"> folder. </span><span class="koboSpan" id="kobo.709.2">.NET MAUI will find the closest match to this on each platform that </span><span class="No-Break"><span class="koboSpan" id="kobo.710.1">we target.</span></span></p>
<p><span class="koboSpan" id="kobo.711.1">Then, we create the connection and store the reference to that connection in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.712.1">connection</span></strong><span class="koboSpan" id="kobo.713.1"> field. </span><span class="koboSpan" id="kobo.713.2">We need to make sure that SQLite has created a table that mirrors the schema of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.714.1">TodoItem</span></strong><span class="koboSpan" id="kobo.715.1"> table. </span><span class="koboSpan" id="kobo.715.2">To make developing the app easier, we add a default to-do list item if the </span><strong class="source-inline"><span class="koboSpan" id="kobo.716.1">TodoItem</span></strong><span class="koboSpan" id="kobo.717.1"> table </span><span class="No-Break"><span class="koboSpan" id="kobo.718.1">is empty.</span></span></p>
<p><span class="koboSpan" id="kobo.719.1">Next, we</span><a id="_idTextAnchor153"/><a id="_idTextAnchor154"/><a id="_idTextAnchor155"/><span class="koboSpan" id="kobo.720.1">’ll add the implementation for the </span><span class="No-Break"><span class="koboSpan" id="kobo.721.1">database operations.</span></span></p>
<h3><span class="koboSpan" id="kobo.722.1">Implementing the GetItemsAsync(), AddItemsAsync(), and UpdateItemsAsync() methods</span></h3>
<p><span class="koboSpan" id="kobo.723.1">The only </span><a id="_idIndexMarker244"/><span class="koboSpan" id="kobo.724.1">thing left</span><a id="_idIndexMarker245"/><span class="koboSpan" id="kobo.725.1"> to do</span><a id="_idIndexMarker246"/><span class="koboSpan" id="kobo.726.1"> in the repository is to implement the methods for getting, adding, and </span><span class="No-Break"><span class="koboSpan" id="kobo.727.1">updating items:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.728.1">Locate the </span><strong class="source-inline"><span class="koboSpan" id="kobo.729.1">GetItemsAsync()</span></strong><span class="koboSpan" id="kobo.730.1"> method in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.731.1">TodoItemRepository</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.732.1"> class.</span></span></li>
<li><span class="koboSpan" id="kobo.733.1">Update the </span><strong class="source-inline"><span class="koboSpan" id="kobo.734.1">GetItemsAsync()</span></strong><span class="koboSpan" id="kobo.735.1"> method with the </span><span class="No-Break"><span class="koboSpan" id="kobo.736.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.737.1">
public async Task&lt;List&lt;TodoItem&gt;&gt; GetItemsAsync()
{
    await CreateConnectionAsync();
    return await connection.Table&lt;TodoItem&gt;().ToListAsync();
}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.738.1">To ensure that the connection to the database is valid, we call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.739.1">CreateConnectionAsync()</span></strong><span class="koboSpan" id="kobo.740.1"> method we created in the previous section. </span><span class="koboSpan" id="kobo.740.2">When this method returns, we can ensure that it is initialized and that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.741.1">TodoItem</span></strong><span class="koboSpan" id="kobo.742.1"> table has </span><span class="No-Break"><span class="koboSpan" id="kobo.743.1">been created.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.744.1">Then, we use the connection to access the </span><strong class="source-inline"><span class="koboSpan" id="kobo.745.1">TodoItem</span></strong><span class="koboSpan" id="kobo.746.1"> table and return a </span><strong class="source-inline"><span class="koboSpan" id="kobo.747.1">List&lt;TodoItem&gt;</span></strong><span class="koboSpan" id="kobo.748.1"> item that contains all the to-do list items in </span><span class="No-Break"><span class="koboSpan" id="kobo.749.1">the database.</span></span></p></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.750.1">SQLite and LINQ</span></p>
<p class="callout"><span class="koboSpan" id="kobo.751.1">SQLite supports querying data</span><a id="_idIndexMarker247"/><span class="koboSpan" id="kobo.752.1"> using LINQ. </span><span class="koboSpan" id="kobo.752.2">You can play around with this after the project is complete to get a better understanding of how to work it with databases in </span><span class="No-Break"><span class="koboSpan" id="kobo.753.1">your app.</span></span></p>
<p><span class="koboSpan" id="kobo.754.1">The code for adding items is </span><span class="No-Break"><span class="koboSpan" id="kobo.755.1">even simpler:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.756.1">Locate the </span><strong class="source-inline"><span class="koboSpan" id="kobo.757.1">AddItemAsync()</span></strong><span class="koboSpan" id="kobo.758.1"> method in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.759.1">TodoItemRepository</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.760.1"> class.</span></span></li>
<li><span class="koboSpan" id="kobo.761.1">Update the </span><strong class="source-inline"><span class="koboSpan" id="kobo.762.1">AddItemAsync()</span></strong><span class="koboSpan" id="kobo.763.1"> method with the </span><span class="No-Break"><span class="koboSpan" id="kobo.764.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.765.1">
public async Task AddItemAsync(TodoItem item)
{
    await CreateConnectionAsync();
    await connection.InsertAsync(item);
    OnItemAdded?.Invoke(this, item);
}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.766.1">The call to </span><strong class="source-inline"><span class="koboSpan" id="kobo.767.1">CreateConnectionAsync()</span></strong><span class="koboSpan" id="kobo.768.1"> makes sure that we have a connection in the same way as we did for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.769.1">GetItemsAsync()</span></strong><span class="koboSpan" id="kobo.770.1"> method. </span><span class="koboSpan" id="kobo.770.2">After this, we insert it into the database using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.771.1">InsertAsyncAsync(...)</span></strong><span class="koboSpan" id="kobo.772.1"> method on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.773.1">connection</span></strong><span class="koboSpan" id="kobo.774.1"> object. </span><span class="koboSpan" id="kobo.774.2">After an item has been inserted into the tabl</span><a id="_idTextAnchor156"/><span class="koboSpan" id="kobo.775.1">e, we invoke the </span><strong class="source-inline"><span class="koboSpan" id="kobo.776.1">OnItemAdded</span></strong><span class="koboSpan" id="kobo.777.1"> event to notify </span><span class="No-Break"><span class="koboSpan" id="kobo.778.1">any subscribers.</span></span></p></li> </ol>
<p><span class="koboSpan" id="kobo.779.1">The code to update</span><a id="_idIndexMarker248"/><span class="koboSpan" id="kobo.780.1"> an </span><a id="_idIndexMarker249"/><span class="koboSpan" id="kobo.781.1">item is the same as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.782.1">AddItemAsync()</span></strong><span class="koboSpan" id="kobo.783.1"> method but also</span><a id="_idIndexMarker250"/><span class="koboSpan" id="kobo.784.1"> includes calls to </span><strong class="source-inline"><span class="koboSpan" id="kobo.785.1">UpdateAsync</span></strong><span class="koboSpan" id="kobo.786.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.787.1">OnItemUpdated</span></strong><span class="koboSpan" id="kobo.788.1">. </span><span class="koboSpan" id="kobo.788.2">Let’s finish up by updating the </span><strong class="source-inline"><span class="koboSpan" id="kobo.789.1">UpdateItemAsync()</span></strong><span class="koboSpan" id="kobo.790.1"> method with the </span><span class="No-Break"><span class="koboSpan" id="kobo.791.1">following code:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.792.1">Locate the </span><strong class="source-inline"><span class="koboSpan" id="kobo.793.1">UpdateItemAsync()</span></strong><span class="koboSpan" id="kobo.794.1"> method in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.795.1">TodoItemRepository</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.796.1"> class.</span></span></li>
<li><span class="koboSpan" id="kobo.797.1">Update the </span><strong class="source-inline"><span class="koboSpan" id="kobo.798.1">UpdateItemAsync()</span></strong><span class="koboSpan" id="kobo.799.1"> method with the </span><span class="No-Break"><span class="koboSpan" id="kobo.800.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.801.1">
public async Task UpdateItemAsync(TodoItem item)
{
    await CreateConnectionAsync();
    await connecti</span><a id="_idTextAnchor157"/><span class="koboSpan" id="kobo.802.1">on.UpdateAsync(item);
    OnItemUpdated?.Invoke(this, item);
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.803.1">In the next section, we’ll get</span><a id="_idTextAnchor158"/><span class="koboSpan" id="kobo.804.1"> started with MVVM. </span><span class="koboSpan" id="kobo.804.2">Grab a cup of coffee and let’s </span><span class="No-Break"><span class="koboSpan" id="kobo.805.1">get started!</span></span></p>
<h1 id="_idParaDest-46"><a id="_idTextAnchor159"/><span class="koboSpan" id="kobo.806.1">Using MVVM – creating views and ViewModels</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.807.1">Model-View-ViewModel</span></strong><span class="koboSpan" id="kobo.808.1">, or </span><strong class="bold"><span class="koboSpan" id="kobo.809.1">MVVM</span></strong><span class="koboSpan" id="kobo.810.1"> for</span><a id="_idIndexMarker251"/><span class="koboSpan" id="kobo.811.1"> short, is all</span><a id="_idIndexMarker252"/><span class="koboSpan" id="kobo.812.1"> about </span><strong class="bold"><span class="koboSpan" id="kobo.813.1">separation of concerns</span></strong><span class="koboSpan" id="kobo.814.1">. </span><span class="koboSpan" id="kobo.814.2">It is an architectural</span><a id="_idIndexMarker253"/><span class="koboSpan" id="kobo.815.1"> pattern that defines three</span><a id="_idIndexMarker254"/><span class="koboSpan" id="kobo.816.1"> parts, each of which has a </span><span class="No-Break"><span class="koboSpan" id="kobo.817.1">specific meaning:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.818.1">Model</span></strong><span class="koboSpan" id="kobo.819.1">: This relates to anything that represents data and that can be referenced </span><span class="No-Break"><span class="koboSpan" id="kobo.820.1">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.821.1">ViewModel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.822.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.823.1">View</span></strong><span class="koboSpan" id="kobo.824.1">: This is the visual component. </span><span class="koboSpan" id="kobo.824.2">In .NET MAUI, this is represented by </span><span class="No-Break"><span class="koboSpan" id="kobo.825.1">a page.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.826.1">ViewModel</span></strong><span class="koboSpan" id="kobo.827.1">: This is the class that acts as the glue between the model and </span><span class="No-Break"><span class="koboSpan" id="kobo.828.1">the view.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.829.1">We are introducing MVVM here because the MVVM pattern was designed specifically around XAML-based GUIs. </span><span class="koboSpan" id="kobo.829.2">This app and the rest of the apps in this book will use XAML to define the GUI and we will use the MVVM pattern to separate the code into the three </span><span class="No-Break"><span class="koboSpan" id="kobo.830.1">aforementioned parts.</span></span></p>
<p><span class="koboSpan" id="kobo.831.1">In this app, we could say that the model is the repository and the to-do list items it returns. </span><strong class="source-inline"><span class="koboSpan" id="kobo.832.1">ViewModel</span></strong><span class="koboSpan" id="kobo.833.1"> refers to this repository and exposes properties that the view can bind to. </span><span class="koboSpan" id="kobo.833.2">The ground rule is that any logic should reside in </span><strong class="source-inline"><span class="koboSpan" id="kobo.834.1">ViewModel</span></strong><span class="koboSpan" id="kobo.835.1"> and no logic should reside in the view. </span><span class="koboSpan" id="kobo.835.2">The view should know how to present data, such as converting a Boolean value into </span><strong class="source-inline"><span class="koboSpan" id="kobo.836.1">Yes</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.837.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.838.1">No</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.839.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.840.1">MVVM can be implemented in many ways and there are quite a few frameworks that we can use to do</span><a id="_idIndexMarker255"/><span class="koboSpan" id="kobo.841.1"> so, such</span><a id="_idIndexMarker256"/><span class="koboSpan" id="kobo.842.1"> as </span><strong class="bold"><span class="koboSpan" id="kobo.843.1">Prism</span></strong><span class="koboSpan" id="kobo.844.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.845.1">MVVMCross</span></strong><span class="koboSpan" id="kobo.846.1">, or even </span><strong class="bold"><span class="koboSpan" id="kobo.847.1">TinyMvvm</span></strong><span class="koboSpan" id="kobo.848.1">. </span><span class="koboSpan" id="kobo.848.2">In</span><a id="_idIndexMarker257"/><span class="koboSpan" id="kobo.849.1"> this chapter, we have chosen to keep things simple and implement MVVM in a </span><a id="_idIndexMarker258"/><span class="koboSpan" id="kobo.850.1">vanilla way first, and then use portions of the </span><strong class="bold"><span class="koboSpan" id="kobo.851.1">CommunityToolkit.Mvvm</span></strong><span class="koboSpan" id="kobo.852.1"> library. </span><span class="koboSpan" id="kobo.852.2">CommunityTookit.Mvvm is an open source library produced by the .NET Foundation. </span><span class="koboSpan" id="kobo.852.3">It is a replacement </span><a id="_idIndexMarker259"/><span class="koboSpan" id="kobo.853.1">for the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.854.1">MVVMLight</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.855.1"> library.</span></span></p>
<p><span class="koboSpan" id="kobo.856.1">The main benefits of using MVVM as an architectural pattern are a clear separation of concerns, cleaner code, and great testability of </span><strong class="source-inline"><span class="koboSpan" id="kobo.857.1">ViewModel</span></strong><span class="koboSpan" id="kobo.858.1">. </span><span class="koboSpan" id="kobo.858.2">If you are interested in learning more about MVVM, and how to use it with .NET MAUI, </span><span class="No-Break"><span class="koboSpan" id="kobo.859.1">visit </span></span><a href="https://learn.microsoft.com/en-us/dotnet/arch﻿﻿﻿itecture/maui/mvvm"><span class="No-Break"><span class="koboSpan" id="kobo.860.1">https://learn.microsoft.com/en-us/dotnet/arch</span><span id="_idTextAnchor160"/><span id="_idTextAnchor161"/><span id="_idTextAnchor162"/><span class="koboSpan" id="kobo.861.1">itecture/maui/mvvm</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.862.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.863.1">Well, enough </span><a id="_idIndexMarker260"/><span class="koboSpan" id="kobo.864.1">of that – let’s write some</span><a id="_idIndexMarker261"/> <span class="No-Break"><span class="koboSpan" id="kobo.865.1">code instead!</span></span></p>
<h2 id="_idParaDest-47"><a id="_idTextAnchor163"/><span class="koboSpan" id="kobo.866.1">Defining a ViewModel base class</span></h2>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.867.1">ViewModel</span></strong><span class="koboSpan" id="kobo.868.1"> is the mediator </span><a id="_idIndexMarker262"/><span class="koboSpan" id="kobo.869.1">between the view and the model. </span><span class="koboSpan" id="kobo.869.2">We can benefit from it greatly by creating a common base class for all our </span><strong class="source-inline"><span class="koboSpan" id="kobo.870.1">ViewModel</span></strong><span class="koboSpan" id="kobo.871.1"> classes to inherit from. </span><span class="koboSpan" id="kobo.871.2">To do this, follow </span><span class="No-Break"><span class="koboSpan" id="kobo.872.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.873.1">Create a folder called </span><strong class="source-inline"><span class="koboSpan" id="kobo.874.1">ViewModels</span></strong><span class="koboSpan" id="kobo.875.1"> in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.876.1">DoToo</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.877.1"> project.</span></span></li>
<li><span class="koboSpan" id="kobo.878.1">Create a class called </span><strong class="source-inline"><span class="koboSpan" id="kobo.879.1">ViewModel</span></strong><span class="koboSpan" id="kobo.880.1"> in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.881.1">ViewModels</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.882.1"> folder.</span></span></li>
<li><span class="koboSpan" id="kobo.883.1">Add the </span><span class="No-Break"><span class="koboSpan" id="kobo.884.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.885.1">
using System.ComponentModel;
public abstract class ViewModel : INotifyPropertyChanged
{
    public event PropertyChangedEventHandler PropertyChanged;
    public void RaisePropertyChanged(params string[] 
propertyNames)
    {
        foreach (var propertyName in propertyNames)
        {
            PropertyChanged?.Invoke(this, new 
PropertyChangedEventArgs(propertyName));
         }
    }
    public INavigation Navigation { get; set; }
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.886.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.887.1">ViewModel</span></strong><span class="koboSpan" id="kobo.888.1"> class is a base class for all </span><strong class="source-inline"><span class="koboSpan" id="kobo.889.1">ViewModel</span></strong><span class="koboSpan" id="kobo.890.1"> objects. </span><span class="koboSpan" id="kobo.890.2">It is not meant to be instantiated on its own, so we mark it as </span><strong class="source-inline"><span class="koboSpan" id="kobo.891.1">abstract</span></strong><span class="koboSpan" id="kobo.892.1">. </span><span class="koboSpan" id="kobo.892.2">It implements </span><strong class="source-inline"><span class="koboSpan" id="kobo.893.1">INotifyPropertyChanged</span></strong><span class="koboSpan" id="kobo.894.1">, which is an interface defined in </span><strong class="source-inline"><span class="koboSpan" id="kobo.895.1">System.ComponentModel</span></strong><span class="koboSpan" id="kobo.896.1"> in the .NET base class libraries. </span><span class="koboSpan" id="kobo.896.2">This interface only defines one thing – the </span><strong class="source-inline"><span class="koboSpan" id="kobo.897.1">PropertyChanged</span></strong><span class="koboSpan" id="kobo.898.1"> event. </span><span class="koboSpan" id="kobo.898.2">Our </span><strong class="source-inline"><span class="koboSpan" id="kobo.899.1">ViewModel</span></strong><span class="koboSpan" id="kobo.900.1"> class must raise this event whenever we want the GUI to be aware of any changes to a property. </span><span class="koboSpan" id="kobo.900.2">This can be done manually by adding code to a setter in a property, as we did in the current implementation, or by using the </span><strong class="bold"><span class="koboSpan" id="kobo.901.1">CommunityToolkit.Mvvm</span></strong><span class="koboSpan" id="kobo.902.1"> library. </span><span class="koboSpan" id="kobo.902.2">We will talk about this in more detail in the </span><span class="No-Break"><span class="koboSpan" id="kobo.903.1">next section.</span></span></p>
<p><span class="koboSpan" id="kobo.904.1">We will also take a little shortcut here by adding an </span><strong class="source-inline"><span class="koboSpan" id="kobo.905.1">INavigation</span></strong><span class="koboSpan" id="kobo.906.1"> property to </span><strong class="source-inline"><span class="koboSpan" id="kobo.907.1">ViewModel</span></strong><span class="koboSpan" id="kobo.908.1">. </span><span class="koboSpan" id="kobo.908.2">This will help us with navigation later on. </span><span class="koboSpan" id="kobo.908.3">This is also something that can (and should) be </span><a id="_idIndexMarker263"/><span class="koboSpan" id="kobo.909.1">abstracted since we don’t want </span><strong class="source-inline"><span class="koboSpan" id="kobo.910.1">ViewModel</span></strong><span class="koboSpan" id="kobo.911.1"> to be depen</span><a id="_idTextAnchor164"/><a id="_idTextAnchor165"/><a id="_idTextAnchor166"/><span class="koboSpan" id="kobo.912.1">dent on .NET MAUI to be able to reuse the </span><strong class="source-inline"><span class="koboSpan" id="kobo.913.1">ViewModel</span></strong><span class="koboSpan" id="kobo.914.1"> classes on </span><span class="No-Break"><span class="koboSpan" id="kobo.915.1">any platform.</span></span></p>
<h2 id="_idParaDest-48"><a id="_idTextAnchor167"/><span class="koboSpan" id="kobo.916.1">Introducing the CommunityToolkit.Mvvm library’s ObservableObject and ObservableProperty</span></h2>
<p><span class="koboSpan" id="kobo.917.1">The traditional</span><a id="_idIndexMarker264"/><span class="koboSpan" id="kobo.918.1"> way of implementing</span><a id="_idIndexMarker265"/><span class="koboSpan" id="kobo.919.1"> a </span><strong class="source-inline"><span class="koboSpan" id="kobo.920.1">ViewModel</span></strong><span class="koboSpan" id="kobo.921.1"> class is to inherit it from a base class (such as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.922.1">ViewModel</span></strong><span class="koboSpan" id="kobo.923.1"> class that we defined previously) and then add code that might look </span><span class="No-Break"><span class="koboSpan" id="kobo.924.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.925.1">
public class MyTestViewModel : ViewModel
{
    private string name;
    public string Name
    {
        get { return name; }
        set
        {
            if (name != value)
            {
                name = value;
                RaisePropertyChanged(nameof(Name));
            }
        }
    }
}</span></pre> <p><span class="koboSpan" id="kobo.926.1">Each property that we want to add to a </span><strong class="source-inline"><span class="koboSpan" id="kobo.927.1">ViewModel</span></strong><span class="koboSpan" id="kobo.928.1"> class yields 13 lines of code. </span><span class="koboSpan" id="kobo.928.2">Not too bad, you might think. </span><span class="koboSpan" id="kobo.928.3">However, considering that a </span><strong class="source-inline"><span class="koboSpan" id="kobo.929.1">ViewModel</span></strong><span class="koboSpan" id="kobo.930.1"> class could potentially contain 10 to 20 properties, this rapidly turns into a lot of code. </span><span class="koboSpan" id="kobo.930.2">We can do better </span><span class="No-Break"><span class="koboSpan" id="kobo.931.1">than this.</span></span></p>
<p><span class="koboSpan" id="kobo.932.1">In just a few </span><a id="_idIndexMarker266"/><span class="koboSpan" id="kobo.933.1">simple </span><a id="_idIndexMarker267"/><span class="koboSpan" id="kobo.934.1">steps, we can use the CommunityToolkit.Mvvm library to automatically inject almost all the code during the </span><span class="No-Break"><span class="koboSpan" id="kobo.935.1">build process:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.936.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.937.1">DoToo</span></strong><span class="koboSpan" id="kobo.938.1"> project, install the CommunityToolkit.Mvvm </span><span class="No-Break"><span class="koboSpan" id="kobo.939.1">NuGet package.</span></span></li>
<li><span class="koboSpan" id="kobo.940.1">Update the </span><strong class="source-inline"><span class="koboSpan" id="kobo.941.1">ViewModel</span></strong><span class="koboSpan" id="kobo.942.1"> class so that it looks </span><span class="No-Break"><span class="koboSpan" id="kobo.943.1">like this:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.944.1">using CommunityToolkit.Mvvm.ComponentModel;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.945.1">[ObservableObject]</span></strong><span class="koboSpan" id="kobo.946.1">
public abstract </span><strong class="bold"><span class="koboSpan" id="kobo.947.1">partial</span></strong><span class="koboSpan" id="kobo.948.1"> class ViewModel
{
    public INavigation Navigation { get; set; }
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.949.1">We have changed the base class of our </span><strong class="source-inline"><span class="koboSpan" id="kobo.950.1">ViewModel</span></strong><span class="koboSpan" id="kobo.951.1"> class so that it has an </span><strong class="source-inline"><span class="koboSpan" id="kobo.952.1">ObservableObject</span></strong><span class="koboSpan" id="kobo.953.1"> attribute and added the </span><strong class="source-inline"><span class="koboSpan" id="kobo.954.1">partial</span></strong><span class="koboSpan" id="kobo.955.1"> modifier. </span><span class="koboSpan" id="kobo.955.2">This attribute will add the base implementation of </span><strong class="source-inline"><span class="koboSpan" id="kobo.956.1">INotifyPropertyChanged</span></strong><span class="koboSpan" id="kobo.957.1"> that was previously in our </span><strong class="source-inline"><span class="koboSpan" id="kobo.958.1">ViewModel</span></strong><span class="koboSpan" id="kobo.959.1"> base class automatically during the </span><span class="No-Break"><span class="koboSpan" id="kobo.960.1">build process.</span></span></p>
<p><span class="koboSpan" id="kobo.961.1">Once our base class has been modified, we can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.962.1">ObservableProperty</span></strong><span class="koboSpan" id="kobo.963.1"> attribute to automatically generate the property implementation. </span><span class="koboSpan" id="kobo.963.2">The result is that the test class we had previously is reduced to a single line of code per property. </span><span class="koboSpan" id="kobo.963.3">This makes the code base more readable because everything happens behind </span><span class="No-Break"><span class="koboSpan" id="kobo.964.1">the scenes:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.965.1">
public partial class MyTestViewModel : ViewModel
{
    [ObservableProperty]
    string name;
}</span></pre> <p><span class="koboSpan" id="kobo.966.1">There are a few things to note about the previous example. </span><span class="koboSpan" id="kobo.966.2">First, the class must be marked as </span><strong class="source-inline"><span class="koboSpan" id="kobo.967.1">partial</span></strong><span class="koboSpan" id="kobo.968.1"> for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.969.1">ObservableProperty</span></strong><span class="koboSpan" id="kobo.970.1"> attribute to work, just like the </span><strong class="source-inline"><span class="koboSpan" id="kobo.971.1">ObservableObject</span></strong><span class="koboSpan" id="kobo.972.1"> attribute. </span><span class="koboSpan" id="kobo.972.2">Second, when using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.973.1">ObservableProperty</span></strong><span class="koboSpan" id="kobo.974.1"> attribute, you place it on</span><a id="_idIndexMarker268"/><span class="koboSpan" id="kobo.975.1"> a</span><a id="_idIndexMarker269"/><span class="koboSpan" id="kobo.976.1"> private field, not a property. </span><span class="koboSpan" id="kobo.976.2">The CommunityToolkit.Mvvm library uses </span><strong class="bold"><span class="koboSpan" id="kobo.977.1">Source Generators</span></strong><span class="koboSpan" id="kobo.978.1">, a feature added in .NET 5, to generate the actual </span><span class="No-Break"><span class="koboSpan" id="kobo.979.1">property implementation.</span></span></p>
<p><span class="koboSpan" id="kobo.980.1">One of the great things about using Source Generators is that you can always view the generated source to see how things work. </span><span class="koboSpan" id="kobo.980.2">For example, to view the generated source for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.981.1">ViewModel</span></strong><span class="koboSpan" id="kobo.982.1"> class, do </span><span class="No-Break"><span class="koboSpan" id="kobo.983.1">the following:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.984.1">Open the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.985.1">ViewModel.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.986.1"> file.</span></span></li>
<li><span class="koboSpan" id="kobo.987.1">Right-click the </span><strong class="source-inline"><span class="koboSpan" id="kobo.988.1">ViewModel</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.989.1">type name.</span></span></li>
<li><span class="koboSpan" id="kobo.990.1">Select </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.991.1">Goto Implementation</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.992.1">.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.993.1">Normally, this would do nothing, as you are in the implementation of </span><strong class="source-inline"><span class="koboSpan" id="kobo.994.1">ViewModel</span></strong><span class="koboSpan" id="kobo.995.1">. </span><span class="koboSpan" id="kobo.995.2">However, since there is additional generated code, Visual Studio will show you a list of locations that contain implementations for </span><strong class="source-inline"><span class="koboSpan" id="kobo.996.1">ViewModel</span></strong><span class="koboSpan" id="kobo.997.1">, similar to what’s </span><span class="No-Break"><span class="koboSpan" id="kobo.998.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer047">
<span class="koboSpan" id="kobo.999.1"><img alt="Figure 2.12 – Finding all implementations of ViewModel" src="image/Figure_2.12_B19214.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1000.1">Figure 2.12 – Finding all implementations of ViewModel</span></p>
<p><span class="koboSpan" id="kobo.1001.1">The first item in the list is what we added to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1002.1">ViewModel.cs</span></strong><span class="koboSpan" id="kobo.1003.1"> file, and the second item in the list is the generated code. </span><span class="koboSpan" id="kobo.1003.2">By double-clicking the item, it will open the generated code in a new code window. </span><span class="koboSpan" id="kobo.1003.3">In the </span><em class="italic"><span class="koboSpan" id="kobo.1004.1">Creating TodoItemViewModel</span></em><span class="koboSpan" id="kobo.1005.1"> section, you can follow the</span><a id="_idIndexMarker270"/><span class="koboSpan" id="kobo.1006.1"> same</span><a id="_idIndexMarker271"/><span class="koboSpan" id="kobo.1007.1"> steps to see what is generated for the </span><span class="No-Break"><span class="koboSpan" id="kobo.1008.1">property implementations.</span></span></p>
<p><span class="koboSpan" id="kobo.1009.1">Now that we’ve seen how to implement proper</span><a id="_idTextAnchor168"/><a id="_idTextAnchor169"/><span class="koboSpan" id="kobo.1010.1">ties using a sample </span><strong class="source-inline"><span class="koboSpan" id="kobo.1011.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1012.1">, it is time to create the concrete </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1013.1">ViewModel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1014.1"> classes.</span></span></p>
<h2 id="_idParaDest-49"><a id="_idTextAnchor170"/><span class="koboSpan" id="kobo.1015.1">Creating MainViewModel</span></h2>
<p><span class="koboSpan" id="kobo.1016.1">So far, we have mainly </span><a id="_idIndexMarker272"/><span class="koboSpan" id="kobo.1017.1">prepared to write the code that will make up the app itself. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1018.1">MainViewModel</span></strong><span class="koboSpan" id="kobo.1019.1"> is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1020.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1021.1"> class for the first view that is displayed to the user. </span><span class="koboSpan" id="kobo.1021.2">It is responsible for providing data and logic to a list of to-do list items. </span><span class="koboSpan" id="kobo.1021.3">We will create the bare-bones </span><strong class="source-inline"><span class="koboSpan" id="kobo.1022.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1023.1"> classes and add code to them as we progress through </span><span class="No-Break"><span class="koboSpan" id="kobo.1024.1">this chapter:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1025.1">Create a class called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1026.1">MainViewModel</span></strong><span class="koboSpan" id="kobo.1027.1"> in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1028.1">ViewModels</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1029.1"> folder.</span></span></li>
<li><span class="koboSpan" id="kobo.1030.1">Add the following template code and resolve </span><span class="No-Break"><span class="koboSpan" id="kobo.1031.1">the references:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1032.1">
public class MainViewModel : ViewModel
{
    private readonly ITodoItemRepository repository;
    public MainViewModel(ITodoItemRepository repository)
    {
        this.repository = repository;
        Task.Run(as</span><a id="_idTextAnchor171"/><span class="koboSpan" id="kobo.1033.1">ync () =&gt; await LoadDataAsync());
    }
    private async Task LoadDataAsync()
    {
    }
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1034.1">The structure of </span><a id="_idIndexMarker273"/><span class="koboSpan" id="kobo.1035.1">this class is something that we will reuse for all the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1036.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1037.1"> classes </span><span class="No-Break"><span class="koboSpan" id="kobo.1038.1">to come.</span></span></p>
<p><span class="koboSpan" id="kobo.1039.1">Let’s summarize the important features we want the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1040.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1041.1"> class </span><span class="No-Break"><span class="koboSpan" id="kobo.1042.1">to have:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1043.1">We inherit from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1044.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1045.1"> class to gain access to shared logic, such as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1046.1">INotifyPropertyChanged</span></strong><span class="koboSpan" id="kobo.1047.1"> interface and common </span><span class="No-Break"><span class="koboSpan" id="kobo.1048.1">navigation code.</span></span></li>
<li><span class="koboSpan" id="kobo.1049.1">All dependencies to other classes, such as repositories and services, which are passed through the constructor of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1050.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1051.1">. </span><span class="koboSpan" id="kobo.1051.2">This is handled by the </span><strong class="bold"><span class="koboSpan" id="kobo.1052.1">dependency injection</span></strong><span class="koboSpan" id="kobo.1053.1"> pattern and, more specifically in our case, by </span><strong class="source-inline"><span class="koboSpan" id="kobo.1054.1">Microsoft.Extensions.DependencyInjection</span></strong><span class="koboSpan" id="kobo.1055.1">, which is the implementation of the dependency injection we are using. </span><span class="koboSpan" id="kobo.1055.2">We will add support for automatic dependency injection in the </span><em class="italic"><span class="koboSpan" id="kobo.1056.1">Wiring up dependency </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1057.1">injection</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1058.1"> section.</span></span></li>
<li><span class="koboSpan" id="kobo.1059.1">We use an</span><a id="_idIndexMarker274"/><span class="koboSpan" id="kobo.1060.1"> asynchronous call to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1061.1">LoadDataAsync()</span></strong><span class="koboSpan" id="kobo.1062.1"> as an entry point to initial</span><a id="_idTextAnchor172"/><span class="koboSpan" id="kobo.1063.1">ize the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1064.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1065.1"> class. </span><span class="koboSpan" id="kobo.1065.2">Different MV</span><a id="_idTextAnchor173"/><span class="koboSpan" id="kobo.1066.1">VM libraries might do this in different ways, but the basic functionality is </span><span class="No-Break"><span class="koboSpan" id="kobo.1067.1">the same.</span></span></li>
</ul>
<h2 id="_idParaDest-50"><a id="_idTextAnchor174"/><span class="koboSpan" id="kobo.1068.1">Creating TodoItemViewModel</span></h2>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1069.1">TodoItemViewModel</span></strong><span class="koboSpan" id="kobo.1070.1"> is </span><a id="_idIndexMarker275"/><span class="koboSpan" id="kobo.1071.1">the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1072.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1073.1"> class that represents each item in the to-do list on </span><strong class="source-inline"><span class="koboSpan" id="kobo.1074.1">MainView</span></strong><span class="koboSpan" id="kobo.1075.1">. </span><span class="koboSpan" id="kobo.1075.2">It does not have an entire view of its own, although it could have. </span><span class="koboSpan" id="kobo.1075.3">Instead, it is rendered by a template in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1076.1">ListView</span></strong><span class="koboSpan" id="kobo.1077.1">. </span><span class="koboSpan" id="kobo.1077.2">We will get back to this when we create the controls </span><span class="No-Break"><span class="koboSpan" id="kobo.1078.1">for </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1079.1">MainView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1080.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1081.1">The important thing here is that this </span><strong class="source-inline"><span class="koboSpan" id="kobo.1082.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1083.1"> object represents a single item, regardless of where we choose to </span><span class="No-Break"><span class="koboSpan" id="kobo.1084.1">render it.</span></span></p>
<p><span class="koboSpan" id="kobo.1085.1">Let’s create the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1086.1">TodoItemViewModel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1087.1"> class:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1088.1">Create a class called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1089.1">TodoItemViewModel</span></strong><span class="koboSpan" id="kobo.1090.1"> in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1091.1">ViewModels</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1092.1"> folder.</span></span></li>
<li><span class="koboSpan" id="kobo.1093.1">Update the class so that it matches the </span><span class="No-Break"><span class="koboSpan" id="kobo.1094.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1095.1">
namespace DoToo.ViewModels;
using CommunityToolkit.Mvvm.ComponentModel;
using DoToo.Models;
public partial class TodoItemViewModel : ViewModel
{
    public TodoItemViewModel(TodoItem item) =&gt; Item = item;
    public event EventHandler ItemStatusChanged;
    [ObservableProperty]
    TodoIte</span><a id="_idTextAnchor175"/><span class="koboSpan" id="kobo.1096.1">m item;
    public string StatusText =&gt; Item.Completed ? </span><span class="koboSpan" id="kobo.1096.2">"Reactivate" : "Completed";
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1097.1">As with any other </span><strong class="source-inline"><span class="koboSpan" id="kobo.1098.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1099.1"> class, we inherit the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1100.1">TodoItemViewModel</span></strong><span class="koboSpan" id="kobo.1101.1"> class from </span><strong class="source-inline"><span class="koboSpan" id="kobo.1102.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1103.1">. </span><span class="koboSpan" id="kobo.1103.2">We conform to the pattern of injecting all the dependencies into the constructor. </span><span class="koboSpan" id="kobo.1103.3">In this case, we pass an instance of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1104.1">TodoItem</span></strong><span class="koboSpan" id="kobo.1105.1"> class to the constructor that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1106.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1107.1"> object will use to expose </span><span class="No-Break"><span class="koboSpan" id="kobo.1108.1">the view.</span></span></p>
<p><span class="koboSpan" id="kobo.1109.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1110.1">ItemStatusChanged</span></strong><span class="koboSpan" id="kobo.1111.1"> event handler will be used later when we want to signal to the view that the state of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1112.1">TodoItem</span></strong><span class="koboSpan" id="kobo.1113.1"> class has changed. </span><span class="koboSpan" id="kobo.1113.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1114.1">Item</span></strong><span class="koboSpan" id="kobo.1115.1"> property allows us to access the item that we </span><span class="No-Break"><span class="koboSpan" id="kobo.1116.1">passed in.</span></span><a id="_idTextAnchor176"/></p>
<p><span class="koboSpan" id="kobo.1117.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1118.1">Statu</span><a id="_idTextAnchor177"/><span class="koboSpan" id="kobo.1119.1">sText</span></strong><span class="koboSpan" id="kobo.1120.1"> property </span><a id="_idIndexMarker276"/><span class="koboSpan" id="kobo.1121.1">is used to make the status of the to-do item human-readable in </span><span class="No-Break"><span class="koboSpan" id="kobo.1122.1">the view.</span></span></p>
<h2 id="_idParaDest-51"><a id="_idTextAnchor178"/><span class="koboSpan" id="kobo.1123.1">Creating the ItemViewModel class</span></h2>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1124.1">ItemViewModel</span></strong><span class="koboSpan" id="kobo.1125.1"> represents </span><a id="_idIndexMarker277"/><span class="koboSpan" id="kobo.1126.1">the to-do list item in a view that can be used to create new items and edit </span><span class="No-Break"><span class="koboSpan" id="kobo.1127.1">existing ones:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1128.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1129.1">ViewModels</span></strong><span class="koboSpan" id="kobo.1130.1"> folder, create a class </span><span class="No-Break"><span class="koboSpan" id="kobo.1131.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1132.1">ItemViewModel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1133.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1134.1">Add the </span><span class="No-Break"><span class="koboSpan" id="kobo.1135.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1136.1">
namespace DoToo.ViewModels;
using DoToo.Repositories;
public class ItemViewModel : ViewModel
{
    private readonly ITodoItemRepository repository;
    public ItemView</span><a id="_idTextAnchor179"/><span class="koboSpan" id="kobo.1137.1">Model(ITodoItemRepository repository)
    {
        this.repository = repository;
    }
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1138.1">The pattern is the same as for the previous two </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1139.1">ViewModel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1140.1"> classes:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1141.1">We use dependency injection to pass the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1142.1">TodoItemRepository</span></strong><span class="koboSpan" id="kobo.1143.1"> class to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1144.1">Vie</span><a id="_idTextAnchor180"/><span class="koboSpan" id="kobo.1145.1">wModel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1146.1"> object</span></span></li>
<li><span class="koboSpan" id="kobo.1147.1">We use inher</span><a id="_idTextAnchor181"/><span class="koboSpan" id="kobo.1148.1">itance from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1149.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1150.1"> base class to add the common features</span><a id="_idIndexMarker278"/><span class="koboSpan" id="kobo.1151.1"> defined by the </span><span class="No-Break"><span class="koboSpan" id="kobo.1152.1">base class</span></span></li>
</ul>
<h2 id="_idParaDest-52"><a id="_idTextAnchor182"/><span class="koboSpan" id="kobo.1153.1">Creating the MainView view</span></h2>
<p><span class="koboSpan" id="kobo.1154.1">Now that we are </span><a id="_idIndexMarker279"/><span class="koboSpan" id="kobo.1155.1">done with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1156.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1157.1"> classes, let’s create the skeleton code and the XAML required for the views. </span><span class="koboSpan" id="kobo.1157.2">The template created a file named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1158.1">MainPage.xml</span></strong><span class="koboSpan" id="kobo.1159.1">. </span><span class="koboSpan" id="kobo.1159.2">In MVVM, the convention is to use a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1160.1">-View</span></strong><span class="koboSpan" id="kobo.1161.1"> suffix instead. </span><span class="koboSpan" id="kobo.1161.2">We will also want to place all our views together in a subfolder, as we did with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1162.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1163.1"> classes. </span><span class="koboSpan" id="kobo.1163.2">Let’s deal with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1164.1">MainPage.xml</span></strong><span class="koboSpan" id="kobo.1165.1"> file first, which is the view that will be </span><span class="No-Break"><span class="koboSpan" id="kobo.1166.1">loaded first:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1167.1">Delete the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1168.1">MainPage.xml</span></strong><span class="koboSpan" id="kobo.1169.1"> file from the root of </span><span class="No-Break"><span class="koboSpan" id="kobo.1170.1">the project.</span></span></li>
<li><span class="koboSpan" id="kobo.1171.1">Create a folder called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1172.1">Views</span></strong><span class="koboSpan" id="kobo.1173.1"> in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1174.1">DoToo</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1175.1"> project.</span></span></li>
<li><span class="koboSpan" id="kobo.1176.1">Right-click on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1177.1">Views</span></strong><span class="koboSpan" id="kobo.1178.1"> folder, select </span><strong class="bold"><span class="koboSpan" id="kobo.1179.1">Add</span></strong><span class="koboSpan" id="kobo.1180.1">, and then click </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1181.1">New Item...</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1182.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1183.1">Select </span><strong class="bold"><span class="koboSpan" id="kobo.1184.1">.NET MAUI</span></strong><span class="koboSpan" id="kobo.1185.1"> under the </span><strong class="bold"><span class="koboSpan" id="kobo.1186.1">C# Items</span></strong><span class="koboSpan" id="kobo.1187.1"> node on </span><span class="No-Break"><span class="koboSpan" id="kobo.1188.1">the left.</span></span></li>
<li><span class="koboSpan" id="kobo.1189.1">Select </span><strong class="bold"><span class="koboSpan" id="kobo.1190.1">.NET MAUI ContentPage (XAML)</span><a id="_idTextAnchor183"/></strong><span class="koboSpan" id="kobo.1191.1"> and name </span><span class="No-Break"><span class="koboSpan" id="kobo.1192.1">it </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1193.1">MainView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1194.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1195.1">Click </span><strong class="bold"><span class="koboSpan" id="kobo.1196.1">Add</span></strong><span class="koboSpan" id="kobo.1197.1"> to create </span><span class="No-Break"><span class="koboSpan" id="kobo.1198.1">the page:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer048">
<span class="koboSpan" id="kobo.1199.1"><img alt="Figure 2.13 – Adding a new XAML file" src="image/Figure_2.13_B19214.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1200.1">Figure 2.13 – Adding a new XAML file</span></p>
<p><span class="koboSpan" id="kobo.1201.1">Let’s add</span><a id="_idIndexMarker280"/><span class="koboSpan" id="kobo.1202.1"> some content to the newly </span><span class="No-Break"><span class="koboSpan" id="kobo.1203.1">created view:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1204.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1205.1">MainView.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1206.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1207.1">Remove all the template code below the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1208.1">ContentPage</span></strong><span class="koboSpan" id="kobo.1209.1"> root node and add the XAML code highlighted in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1210.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1211.1">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/
maui"
             
  x:Class="DoToo.Views.MainView"
  </span><strong class="bold"><span class="koboSpan" id="kobo.1212.1">Title="Do Too!</span></strong><span class="koboSpan" id="kobo.1213.1">"&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.1214.1">  &lt;ContentPage.ToolbarItems&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1215.1">    &lt;ToolbarItem Text="Add" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1216.1">  &lt;/ContentPage.ToolbarItems&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1217.1">  &lt;Grid&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1218.1">    &lt;Grid.RowDefinitions&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1219.1">      &lt;RowDefinition Height="auto" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1220.1">      &lt;RowDefinition Height="*" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1221.1">    &lt;/Grid.RowDefinitions&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1222.1">    &lt;Button Text="Toggle filter" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1223.1">    &lt;ListView Grid.Row="1"&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1224.1">    &lt;/ListView&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1225.1">  &lt;/Grid&gt;</span></strong><span class="koboSpan" id="kobo.1226.1">
&lt;/ContentPage&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1227.1">To be able to access custom converters, we need to add a reference to a local namespace. </span><span class="koboSpan" id="kobo.1227.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1228.1"/></strong><span class="koboSpan" id="kobo.1229.1"> line defines this namespace for us. </span><span class="koboSpan" id="kobo.1229.2">We will not use it directly in this case, but it’s a good idea to have a local namespace defined. </span><span class="koboSpan" id="kobo.1229.3">If we create custom controls, we can access them by writing something such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1230.1">&lt;</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1231.1">local:MyControl /&gt;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1232.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1233.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1234.1">Title</span></strong><span class="koboSpan" id="kobo.1235.1"> property on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1236.1">ContentPage</span></strong><span class="koboSpan" id="kobo.1237.1"> page gives the page a title. </span><span class="koboSpan" id="kobo.1237.2">Depending on the platform we are running on, the title is displayed differently. </span><span class="koboSpan" id="kobo.1237.3">If we use a standard navigation bar, it will be displayed at the top, for example, in both iOS and Android. </span><span class="koboSpan" id="kobo.1237.4">A page should always have </span><span class="No-Break"><span class="koboSpan" id="kobo.1238.1">a title.</span></span></p>
<p><span class="koboSpan" id="kobo.1239.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1240.1">ContentPage.ToolbarItems</span></strong><span class="koboSpan" id="kobo.1241.1"> node defines a toolbar item for adding new to-do items. </span><span class="koboSpan" id="kobo.1241.2">It will also </span><a id="_idIndexMarker281"/><span class="koboSpan" id="kobo.1242.1">be rendered </span><a id="_idTextAnchor184"/><span class="koboSpan" id="kobo.1243.1">differently based on the platform, but it always follows the platform-specific </span><span class="No-Break"><span class="koboSpan" id="kobo.1244.1">UI guidelines.</span></span></p>
<p><span class="koboSpan" id="kobo.1245.1">A page in .NET MAUI (and in an XML document, in general) can only have one root node. </span><span class="koboSpan" id="kobo.1245.2">The root node in a .NET MAUI page populates the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1246.1">Content</span></strong><span class="koboSpan" id="kobo.1247.1"> property of the page itself. </span><span class="koboSpan" id="kobo.1247.2">Since we want our </span><strong class="source-inline"><span class="koboSpan" id="kobo.1248.1">MainView</span></strong><span class="koboSpan" id="kobo.1249.1"> view to contain a list of items and a button at the top to toggle a filter (to switch between all items and only active items), we need to add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1250.1">Layout</span></strong><span class="koboSpan" id="kobo.1251.1"> control to position them on the page. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1252.1">Grid</span></strong><span class="koboSpan" id="kobo.1253.1"> is a control that allows you to split up the available space based on rows </span><span class="No-Break"><span class="koboSpan" id="kobo.1254.1">and columns.</span></span></p>
<p><span class="koboSpan" id="kobo.1255.1">For our </span><strong class="source-inline"><span class="koboSpan" id="kobo.1256.1">MainView</span></strong><span class="koboSpan" id="kobo.1257.1"> view, we want to add two rows. </span><span class="koboSpan" id="kobo.1257.2">The first row is a space calculated by the height of the button (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1258.1">Height="auto"</span></strong><span class="koboSpan" id="kobo.1259.1">) and the second row takes up all the remaining space for </span><strong class="source-inline"><span class="koboSpan" id="kobo.1260.1">ListView</span></strong><span class="koboSpan" id="kobo.1261.1"> (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1262.1">Height="*"</span></strong><span class="koboSpan" id="kobo.1263.1">). </span><span class="koboSpan" id="kobo.1263.2">Elements such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1264.1">ListView</span></strong><span class="koboSpan" id="kobo.1265.1"> are positioned in the grid using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1266.1">Grid.Row</span></strong><span class="koboSpan" id="kobo.1267.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1268.1">Grid.Column</span></strong><span class="koboSpan" id="kobo.1269.1"> attributes. </span><span class="koboSpan" id="kobo.1269.2">Both properties default to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1270.1">0</span></strong><span class="koboSpan" id="kobo.1271.1"> if they are not specified, just like </span><span class="No-Break"><span class="koboSpan" id="kobo.1272.1">the button.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1273.1">ListView</span></strong><span class="koboSpan" id="kobo.1274.1"> is a control that presents items in a list, which is coincidently exactly what our app will do. </span><span class="koboSpan" id="kobo.1274.2">It’s worth noting that .NET MAUI does have a control called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1275.1">CollectionView</span></strong><span class="koboSpan" id="kobo.1276.1">, which can handle displaying collections of items better than </span><strong class="source-inline"><span class="koboSpan" id="kobo.1277.1">ListView</span></strong><span class="koboSpan" id="kobo.1278.1">. </span><span class="koboSpan" id="kobo.1278.2">Subsequent chapters will use this control, but we wanted to introduce you to the good old </span><strong class="source-inline"><span class="koboSpan" id="kobo.1279.1">ListView</span></strong><span class="koboSpan" id="kobo.1280.1"> control </span><span class="No-Break"><span class="koboSpan" id="kobo.1281.1">as well.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1282.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1283.1">If you are interested in how </span><strong class="source-inline"><span class="koboSpan" id="kobo.1284.1">Grid</span></strong><span class="koboSpan" id="kobo.1285.1"> works, you can search for more information about .NET MAUI grids on the internet or check out the official documentation </span><span class="No-Break"><span class="koboSpan" id="kobo.1286.1">at </span></span><a href="https://learn.microsoft.com/en-us/dotnet/maui/user-interface/layouts/grid"><span class="No-Break"><span class="koboSpan" id="kobo.1287.1">https://learn.microsoft.com/en-us/dotnet/maui/user-interface/layouts/grid</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1288.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1289.1">We also need to</span><a id="_idIndexMarker282"/><span class="koboSpan" id="kobo.1290.1"> wire up </span><strong class="source-inline"><span class="koboSpan" id="kobo.1291.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1292.1"> to the view. </span><span class="koboSpan" id="kobo.1292.2">This can be done by passing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1293.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1294.1"> class in the constructor of </span><span class="No-Break"><span class="koboSpan" id="kobo.1295.1">the view:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1296.1">Open the code-behind file of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1297.1">MainView</span></strong><span class="koboSpan" id="kobo.1298.1"> by expanding the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1299.1">MainView.xaml</span></strong><span class="koboSpan" id="kobo.1300.1"> file in </span><strong class="bold"><span class="koboSpan" id="kobo.1301.1">Solution Explorer</span></strong><span class="koboSpan" id="kobo.1302.1">. </span><span class="koboSpan" id="kobo.1302.2">The code-behind file is </span><span class="No-Break"><span class="koboSpan" id="kobo.1303.1">named </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1304.1">MainView.xaml.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1305.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1306.1">Add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1307.1">using DoToo.ViewModels</span></strong><span class="koboSpan" id="kobo.1308.1"> statement to the top of the file, adjacent to the existing </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1309.1">using</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1310.1"> statements.</span></span></li>
<li><span class="koboSpan" id="kobo.1311.1">Modify the constructor of the class so that it looks as follows by adding the </span><span class="No-Break"><span class="koboSpan" id="kobo.1312.1">highlighted code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1313.1">
public MainView(</span><strong class="bold"><span class="koboSpan" id="kobo.1314.1">MainViewModel viewModel</span></strong><span class="koboSpan" id="kobo.1315.1">)
{
    In</span><a id="_idTextAnchor185"/><span class="koboSpan" id="kobo.1316.1">itializeComponent();
    </span><strong class="bold"><span class="koboSpan" id="kobo.1317.1">viewModel.Navigation = Navigation;</span></strong><span class="koboSpan" id="kobo.1318.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.1319.1">BindingContext = viewModel;</span></strong><span class="koboSpan" id="kobo.1320.1">
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1321.1">We follow the same pattern as we did with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1322.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1323.1"> classes by passing any dependencies through the constructor. </span><span class="koboSpan" id="kobo.1323.2">A view is always dependent on a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1324.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1325.1"> class. </span><span class="koboSpan" id="kobo.1325.2">To simplify the project, we also assign the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1326.1">Navigation</span></strong><span class="koboSpan" id="kobo.1327.1"> property of the page directly to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1328.1">Navigation</span></strong><span class="koboSpan" id="kobo.1329.1"> property defined in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1330.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1331.1"> base class. </span><span class="koboSpan" id="kobo.1331.2">In a larger project, we might want to abstract this property as well to make sure that we separate the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1332.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1333.1"> classes from .NET MAUI. </span><span class="koboSpan" id="kobo.1333.2">For the sake of this app, however, it is OK to reference </span><span class="No-Break"><span class="koboSpan" id="kobo.1334.1">it directly.</span></span></p>
<p><span class="koboSpan" id="kobo.1335.1">Lastly, we assign </span><strong class="source-inline"><span class="koboSpan" id="kobo.1336.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1337.1"> to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1338.1">BindingContext</span></strong><span class="koboSpan" id="kobo.1339.1"> class of the page. </span><span class="koboSpan" id="kobo.1339.2">This</span><a id="_idTextAnchor186"/><span class="koboSpan" id="kobo.1340.1"> tells the .NET MAUI binding engine to use our </span><strong class="source-inline"><span class="koboSpan" id="kobo.1341.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1342.1"> object for the bindings that we will </span><span class="No-Break"><span class="koboSpan" id="kobo.1343.1">create</span></span><span class="No-Break"><a id="_idIndexMarker283"/></span><span class="No-Break"><span class="koboSpan" id="kobo.1344.1"> later.</span></span></p>
<p><span class="koboSpan" id="kobo.1345.1">At this point, since we have removed </span><strong class="source-inline"><span class="koboSpan" id="kobo.1346.1">MainPa</span><a id="_idTextAnchor187"/><span class="koboSpan" id="kobo.1347.1">ge</span></strong><span class="koboSpan" id="kobo.1348.1">, the project will no longer run. </span><span class="koboSpan" id="kobo.1348.2">We will fix this in the </span><em class="italic"><span class="koboSpan" id="kobo.1349.1">Making the app run</span></em> <span class="No-Break"><span class="koboSpan" id="kobo.1350.1">section later.</span></span></p>
<h2 id="_idParaDest-53"><a id="_idTextAnchor188"/><span class="koboSpan" id="kobo.1351.1">Creating the ItemView view</span></h2>
<p><span class="koboSpan" id="kobo.1352.1">The second view </span><a id="_idIndexMarker284"/><span class="koboSpan" id="kobo.1353.1">we will add is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1354.1">ItemView</span></strong><span class="koboSpan" id="kobo.1355.1">. </span><span class="koboSpan" id="kobo.1355.2">We will use this to add and edit the to-do </span><span class="No-Break"><span class="koboSpan" id="kobo.1356.1">list items:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1357.1">Create a new content page (in the same way that we created the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1358.1">MainView</span></strong><span class="koboSpan" id="kobo.1359.1"> view) and name </span><span class="No-Break"><span class="koboSpan" id="kobo.1360.1">it </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1361.1">ItemView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1362.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1363.1">Edit the XAML file so that it appears as in the following code. </span><span class="koboSpan" id="kobo.1363.2">The changes </span><span class="No-Break"><span class="koboSpan" id="kobo.1364.1">are highlighted:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1365.1">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ContentPage xmlns=http://schemas.microsoft.com/dotnet/2021/maui
              xmlns:x=http://schemas.microsoft.com/winfx/2009/xaml
  x:Class="DoToo.Views.ItemView"
</span><strong class="bold"><span class="koboSpan" id="kobo.1366.1">  Title="New todo item"&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1367.1">  &lt;ContentPage.ToolbarItems&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1368.1">    &lt;ToolbarItem Text="Save" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1369.1">  &lt;/ContentPage.ToolbarItems&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1370.1">  &lt;StackLayout Padding="14"&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1371.1">    &lt;Label Text="Title" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1372.1">    &lt;Entry /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1373.1">    &lt;Label Text="Due" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1374.1">    &lt;DatePicker /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1375.1">    &lt;StackLayout Orientation="Horizontal"&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1376.1">      &lt;Switch /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1377.1">      &lt;Label Text="Completed" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1378.1">    &lt;/StackLayout&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1379.1">  &lt;/StackLayout&gt;</span></strong><span class="koboSpan" id="kobo.1380.1">
&lt;/ContentPage&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1381.1">As with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1382.1">MainView</span></strong><span class="koboSpan" id="kobo.1383.1">, we need a title. </span><span class="koboSpan" id="kobo.1383.2">We will give it a default title of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1384.1">New todo item</span></strong><span class="koboSpan" id="kobo.1385.1"> for now, but we will change this to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1386.1">Edit todo item</span></strong><span class="koboSpan" id="kobo.1387.1"> when we reuse this view for editing later on. </span><span class="koboSpan" id="kobo.1387.2">The</span><a id="_idIndexMarker285"/><span class="koboSpan" id="kobo.1388.1"> user must be able to save a new or edited item, so we have added a toolbar </span><strong class="source-inline"><span class="koboSpan" id="kobo.1389.1">Save</span></strong><span class="koboSpan" id="kobo.1390.1"> button. </span><span class="koboSpan" id="kobo.1390.2">The content of the page uses </span><strong class="source-inline"><span class="koboSpan" id="kobo.1391.1">StackLayout</span></strong><span class="koboSpan" id="kobo.1392.1"> to structure the controls. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1393.1">StackLayout</span></strong><span class="koboSpan" id="kobo.1394.1"> adds an element vertically (the default option) or horizontally based on the space it calculates that the element takes up. </span><span class="koboSpan" id="kobo.1394.2">This is a CPU-intensive process, so we should only use it on small portions of our layout. </span><span class="koboSpan" id="kobo.1394.3">In </span><strong class="source-inline"><span class="koboSpan" id="kobo.1395.1">StackLayout</span></strong><span class="koboSpan" id="kobo.1396.1">, we add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1397.1">Label</span></strong><span class="koboSpan" id="kobo.1398.1"> control, which is a line of text over the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1399.1">Entry</span></strong><span class="koboSpan" id="kobo.1400.1"> control that comes underneath it. </span><span class="koboSpan" id="kobo.1400.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1401.1">Entry</span></strong><span class="koboSpan" id="kobo.1402.1"> control is a text input control that contains the name of the to-do list item. </span><span class="koboSpan" id="kobo.1402.2">Then, we have a section for </span><strong class="source-inline"><span class="koboSpan" id="kobo.1403.1">DatePicker</span></strong><span class="koboSpan" id="kobo.1404.1">, where the user can select a due date for the to-do list item. </span><span class="koboSpan" id="kobo.1404.2">The final control is a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1405.1">Switch</span></strong><span class="koboSpan" id="kobo.1406.1"> control, which renders a toggle button to control when an item is complete, as well as a heading next to it. </span><span class="koboSpan" id="kobo.1406.2">Since we want these to be displayed next to each other horizontally, we use a horizontal </span><strong class="source-inline"><span class="koboSpan" id="kobo.1407.1">StackLayout</span></strong><span class="koboSpan" id="kobo.1408.1"> control to </span><span class="No-Break"><span class="koboSpan" id="kobo.1409.1">do this.</span></span></p>
<p><span class="koboSpan" id="kobo.1410.1">The last step for the views is to wire up the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1411.1">ItemViewModel</span></strong><span class="koboSpan" id="kobo.1412.1"> model </span><span class="No-Break"><span class="koboSpan" id="kobo.1413.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1414.1">ItemView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1415.1">:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1416.1">Open the code-behind file of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1417.1">ItemView</span></strong><span class="koboSpan" id="kobo.1418.1"> by expanding the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1419.1">ItemView.xaml</span></strong><span class="koboSpan" id="kobo.1420.1"> file in </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1421.1">Solution Explorer</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1422.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1423.1">Add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1424.1">using DoToo.ViewModels</span></strong><span class="koboSpan" id="kobo.1425.1"> statement to the top of the file, adjacent to the existing </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1426.1">using</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1427.1"> statements.</span></span></li>
<li><span class="koboSpan" id="kobo.1428.1">Modify the constructor of the class so that it looks as follows. </span><span class="koboSpan" id="kobo.1428.2">Add the code that is marked </span><span class="No-Break"><span class="koboSpan" id="kobo.1429.1">in bold:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1430.1">
public ItemView (</span><strong class="bold"><span class="koboSpan" id="kobo.1431.1">ItemViewModel viewmodel</span></strong><span class="koboSpan" id="kobo.1432.1">)
{
    InitializeComponent ();
    </span><strong class="bold"><span class="koboSpan" id="kobo.1433.1">viewmodel.Navigation = Navigation;</span></strong><span class="koboSpan" id="kobo.1434.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.1435.1">BindingContext = viewmodel;</span></strong><span class="koboSpan" id="kobo.1436.1">
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1437.1">This </span><a id="_idTextAnchor189"/><a id="_idTextAnchor190"/><a id="_idTextAnchor191"/><span class="koboSpan" id="kobo.1438.1">code is</span><a id="_idIndexMarker286"/><span class="koboSpan" id="kobo.1439.1"> identical to the code that we added for </span><strong class="source-inline"><span class="koboSpan" id="kobo.1440.1">MainView</span></strong><span class="koboSpan" id="kobo.1441.1">, except for the type of </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1442.1">ViewModel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1443.1"> class.</span></span></p>
<h2 id="_idParaDest-54"><a id="_idTextAnchor192"/><span class="koboSpan" id="kobo.1444.1">Wiring up dependency injection</span></h2>
<p><span class="koboSpan" id="kobo.1445.1">Earlier, we </span><a id="_idIndexMarker287"/><span class="koboSpan" id="kobo.1446.1">discussed the dependency injection pattern, which states that all dependencies, such as the repositories and view models, must be passed through the constructor of the class. </span><span class="koboSpan" id="kobo.1446.2">This requirement has </span><span class="No-Break"><span class="koboSpan" id="kobo.1447.1">several benefits:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1448.1">It increases the readability of the code since we can quickly determine all the </span><span class="No-Break"><span class="koboSpan" id="kobo.1449.1">external dependencies</span></span></li>
<li><span class="koboSpan" id="kobo.1450.1">It makes dependency </span><span class="No-Break"><span class="koboSpan" id="kobo.1451.1">injection possible</span></span></li>
<li><span class="koboSpan" id="kobo.1452.1">It makes unit testing possible by </span><span class="No-Break"><span class="koboSpan" id="kobo.1453.1">mocking classes</span></span></li>
<li><span class="koboSpan" id="kobo.1454.1">We can control the lifetime of an object by specifying whether it should be a singleton or a new instance for </span><span class="No-Break"><span class="koboSpan" id="kobo.1455.1">each resolution</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1456.1">Dependency injection is a pattern that lets us determine, at runtime, which instance of an object should be passed to a constructor when an object is created. </span><span class="koboSpan" id="kobo.1456.2">We do this by defining a container where we register all the types of a class. </span><span class="koboSpan" id="kobo.1456.3">We let the framework that we are using resolve any dependencies between them. </span><span class="koboSpan" id="kobo.1456.4">Let’s say that we ask the container for a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1457.1">MainView</span></strong><span class="koboSpan" id="kobo.1458.1"> class. </span><span class="koboSpan" id="kobo.1458.2">The container takes care of resolving </span><strong class="source-inline"><span class="koboSpan" id="kobo.1459.1">MainViewModel</span></strong><span class="koboSpan" id="kobo.1460.1"> and any dependencies that the </span><span class="No-Break"><span class="koboSpan" id="kobo.1461.1">class has.</span></span></p>
<p><span class="koboSpan" id="kobo.1462.1">.NET MAUI uses the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1463.1">Microsoft.Extensions.DependencyInjection</span></strong><span class="koboSpan" id="kobo.1464.1"> NuGet library internally</span><a id="_idIndexMarker288"/><span class="koboSpan" id="kobo.1465.1"> and it is exposed for us to use in our applications. </span><span class="koboSpan" id="kobo.1465.2">The first step is to register the classes we want to participate in </span><span class="No-Break"><span class="koboSpan" id="kobo.1466.1">dependency injection.</span></span></p>
<h3><span class="koboSpan" id="kobo.1467.1">Registering View, ViewModels, and Services</span></h3>
<p><span class="koboSpan" id="kobo.1468.1">For our</span><a id="_idIndexMarker289"/><span class="koboSpan" id="kobo.1469.1"> classes</span><a id="_idIndexMarker290"/><span class="koboSpan" id="kobo.1470.1"> to be</span><a id="_idIndexMarker291"/><span class="koboSpan" id="kobo.1471.1"> available through dependency injection, they need to be registered with the dependency injection service. </span><span class="koboSpan" id="kobo.1471.2">.NET MAUI exposes the dependency injection service using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1472.1">Services</span></strong><span class="koboSpan" id="kobo.1473.1"> property of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1474.1">MauiAppBuilder</span></strong><span class="koboSpan" id="kobo.1475.1"> class. </span><span class="koboSpan" id="kobo.1475.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1476.1">Services</span></strong><span class="koboSpan" id="kobo.1477.1"> property will return an </span><strong class="source-inline"><span class="koboSpan" id="kobo.1478.1">IServiceCollection</span></strong><span class="koboSpan" id="kobo.1479.1"> object, also referred to as the container. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1480.1">IServiceCollection</span></strong><span class="koboSpan" id="kobo.1481.1"> has two methods we are interested in, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1482.1">AddSingleton</span></strong><span class="koboSpan" id="kobo.1483.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1484.1">AddTransient</span></strong><span class="koboSpan" id="kobo.1485.1">. </span><span class="koboSpan" id="kobo.1485.2">The “Transient” and “Singleton” in the method names refer to the lifetime of the objects. </span><span class="koboSpan" id="kobo.1485.3">Transient objects are created every time they are requested from the container. </span><span class="koboSpan" id="kobo.1485.4">Singleton objects are created only once, and that one instance is returned every time the class is requested from </span><span class="No-Break"><span class="koboSpan" id="kobo.1486.1">the container.</span></span></p>
<p><span class="koboSpan" id="kobo.1487.1">When registering classes with the container, it is recommended to use extension methods to group the types. </span><span class="koboSpan" id="kobo.1487.2">For this app, there are three groups: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1488.1">View</span></strong><span class="koboSpan" id="kobo.1489.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1490.1">ViewModels</span></strong><span class="koboSpan" id="kobo.1491.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1492.1">Services</span></strong><span class="koboSpan" id="kobo.1493.1">. </span><span class="koboSpan" id="kobo.1493.2">The extension methods will take a single parameter and return a single value, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1494.1">MauiAppBuilder</span></strong><span class="koboSpan" id="kobo.1495.1"> instance. </span><span class="koboSpan" id="kobo.1495.2">This is how the Builder pattern is implemented and allows us to chain the methods on the builder defined in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1496.1">CreateMauiApp</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1497.1"> method.</span></span></p>
<p><span class="koboSpan" id="kobo.1498.1">To implement the methods, follow </span><span class="No-Break"><span class="koboSpan" id="kobo.1499.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1500.1">Open the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1501.1">MauiProgram.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1502.1"> file.</span></span></li>
<li><span class="koboSpan" id="kobo.1503.1">Make the following changes to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1504.1">MauiProgram</span></strong><span class="koboSpan" id="kobo.1505.1"> class. </span><span class="koboSpan" id="kobo.1505.2">The changes are highlighted </span><span class="No-Break"><span class="koboSpan" id="kobo.1506.1">in bold:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1507.1">using DoToo.Repositories;</span></strong><span class="koboSpan" id="kobo.1508.1">
public static class MauiProgram
{
    public static MauiApp CreateMauiApp()
    {
        var builder = MauiApp.CreateBuilder();
        builder
            .UseMauiApp&lt;App&gt;()
            .ConfigureFonts(fonts =&gt;
            {
                fonts.AddFont("OpenSans-Regular.ttf", 
"OpenSansRegular");
                fonts.AddFont("OpenSans-Semibold.ttf", 
"OpenSansSemibold");
</span><strong class="bold"><span class="koboSpan" id="kobo.1509.1">            })</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1510.1">            .RegisterServices()</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1511.1">            .RegisterViewModels()</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1512.1">            .RegisterViews();</span></strong><span class="koboSpan" id="kobo.1513.1">
            return builder.Build();
    }
</span><strong class="bold"><span class="koboSpan" id="kobo.1514.1">    public static MauiAppBuilder RegisterServices(this </span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1515.1">MauiAppBuilder mauiAppBuilder)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1516.1">    {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1517.1">    mauiAppBuilder.Services.AddSingleton&lt;ITodoItemRepository,TodoItemRepository&gt;();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1518.1">        return mauiAppBuilder;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1519.1">    }</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1520.1">    public static MauiAppBuilder RegisterViewModels(this </span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1521.1">MauiAppBuilder mauiAppBuilder)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1522.1">    {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1523.1">         mauiAppBuilder.Services.AddTransient&lt;ViewModels.</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1524.1">MainViewModel&gt;();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1525.1">        mauiAppBuilder.Services.AddTransient&lt;ViewModels.</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1526.1">ItemViewModel&gt;();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1527.1">        return mauiAppBuilder;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1528.1">    }</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1529.1">    public static MauiAppBuilder RegisterViews(this </span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1530.1">MauiAppBuilder mauiAppBuilder)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1531.1">    {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1532.1">        mauiAppBuilder.Services.AddTransient&lt;Views.MainView&gt;();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1533.1">        mauiAppBuilder.Services.AddTransient&lt;Views.ItemView&gt;();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1534.1">        return mauiAppBuilder;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1535.1">    }</span></strong><span class="koboSpan" id="kobo.1536.1">
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1537.1">Normally, registering a type is done by using the type name as the generic argument to the registration method, as in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1538.1">mauiAppBuilder.Services.AddTransient&lt;Views.MainView&gt;();</span></strong><span class="koboSpan" id="kobo.1539.1">. </span><span class="koboSpan" id="kobo.1539.2">But that doesn’t work if you need to resolve an interface to an implementation, like what is happening in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1540.1">RegisterServices</span></strong><span class="koboSpan" id="kobo.1541.1"> method. </span><span class="koboSpan" id="kobo.1541.2">There, the registration method doesn’t use the generic argument; instead, it passes in the type to register as the first argument, and the second argument is the type of the instance </span><span class="No-Break"><span class="koboSpan" id="kobo.1542.1">to return.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1543.1">Info</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1544.1">To learn more about how </span><strong class="source-inline"><span class="koboSpan" id="kobo.1545.1">Microsoft.Extensions.DependencyInjection</span></strong><span class="koboSpan" id="kobo.1546.1"> works, visit </span><a href="https://learn.microsoft.com/en-us/dotnet/core/extensions/dependency-injection"><span class="koboSpan" id="kobo.1547.1">https://learn.microsoft.com/en-us/dotnet/core/extensions/dependency-injection</span></a><span class="koboSpan" id="kobo.1548.1"> in y</span><a id="_idTextAnchor193"/><span class="koboSpan" id="kobo.1549.1">our </span><span class="No-Break"><span class="koboSpan" id="kobo.1550.1">favorite browser.</span></span></p>
<p><span class="koboSpan" id="kobo.1551.1">Now</span><a id="_idIndexMarker292"/><span class="koboSpan" id="kobo.1552.1"> that </span><a id="_idIndexMarker293"/><span class="koboSpan" id="kobo.1553.1">dependency </span><a id="_idIndexMarker294"/><span class="koboSpan" id="kobo.1554.1">injection is wired up, we can get the project </span><span class="No-Break"><span class="koboSpan" id="kobo.1555.1">running again.</span></span></p>
<h2 id="_idParaDest-55"><a id="_idTextAnchor194"/><span class="koboSpan" id="kobo.1556.1">Making the app run</span></h2>
<p><span class="koboSpan" id="kobo.1557.1">There are just </span><a id="_idIndexMarker295"/><span class="koboSpan" id="kobo.1558.1">a few more changes we need to make to enable the app </span><span class="No-Break"><span class="koboSpan" id="kobo.1559.1">to run:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1560.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1561.1">App.xaml.cs</span></strong><span class="koboSpan" id="kobo.1562.1"> file by expanding the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1563.1">App.xaml</span></strong><span class="koboSpan" id="kobo.1564.1"> node in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1565.1">DoToo</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1566.1"> project.</span></span></li>
<li><span class="koboSpan" id="kobo.1567.1">Modify the following lines </span><span class="No-Break"><span class="koboSpan" id="kobo.1568.1">in bold:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1569.1">
public App(</span><strong class="bold"><span class="koboSpan" id="kobo.1570.1">Views.MainView view</span></strong><span class="koboSpan" id="kobo.1571.1">)
{
    InitializeComponent();
    </span><strong class="bold"><span class="koboSpan" id="kobo.1572.1">MainPage = new NavigationPage(view);</span></strong><span class="koboSpan" id="kobo.1573.1">
}</span></pre></li> <li><strong class="source-inline"><span class="koboSpan" id="kobo.1574.1">AppShell.Xaml</span></strong><span class="koboSpan" id="kobo.1575.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1576.1">AppShell.xaml.cs</span></strong><span class="koboSpan" id="kobo.1577.1"> are no longer used, so they can be deleted from </span><span class="No-Break"><span class="koboSpan" id="kobo.1578.1">the project.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.1579.1">When .NET MAUI initializes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1580.1">App</span></strong><span class="koboSpan" id="kobo.1581.1"> class via the builder, it does so by using the dependency injection container, so any arguments you add to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1582.1">App</span></strong><span class="koboSpan" id="kobo.1583.1"> constructor are resolved from the container as well, and their dependencies too. </span><span class="koboSpan" id="kobo.1583.2">In this case, we are importing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1584.1">MainView</span></strong><span class="koboSpan" id="kobo.1585.1"> class (and all its dependencies, including </span><strong class="source-inline"><span class="koboSpan" id="kobo.1586.1">MainViewModel</span></strong><span class="koboSpan" id="kobo.1587.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1588.1">TodoItemRepository</span></strong><span class="koboSpan" id="kobo.1589.1">) and wrapping it in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1590.1">NavigationPage</span></strong><span class="koboSpan" id="kobo.1591.1">. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1592.1">NavigationPage</span></strong><span class="koboSpan" id="kobo.1593.1"> is a page defined in .NET MAUI that adds a navigation bar and enables the user to navigate to </span><span class="No-Break"><span class="koboSpan" id="kobo.1594.1">other views.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1595.1">Information</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1596.1">.NET MAUI includes </span><strong class="source-inline"><span class="koboSpan" id="kobo.1597.1">Shell</span></strong><span class="koboSpan" id="kobo.1598.1">, and we have a whole chapter about it in this book. </span><span class="koboSpan" id="kobo.1598.2">However, to become a good .NET MAUI developer, you n</span><a id="_idTextAnchor195"/><span class="koboSpan" id="kobo.1599.1">eed to know the basics, and the basics of navigating in .NET MAUI uses the good old </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1600.1">NavigationPage</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1601.1"> control.</span></span></p>
<p><span class="koboSpan" id="kobo.1602.1">That’s it! </span><span class="koboSpan" id="kobo.1602.2">Now, your </span><a id="_idIndexMarker296"/><span class="koboSpan" id="kobo.1603.1">project should start. </span><span class="koboSpan" id="kobo.1603.2">Depending on the platform you are using, it might look </span><span class="No-Break"><span class="koboSpan" id="kobo.1604.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer049">
<span class="koboSpan" id="kobo.1605.1"><img alt="Figure 2.14 – The DoToo application in the Windows subsystem for Android" src="image/Figure_2.14_B19214.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1606.1">Figure 2.14 – The DoToo application in the Windows subsystem for Android</span></p>
<p><span class="koboSpan" id="kobo.1607.1">Now that we have the app running with a basic UI, let’s add some functionality, starting with </span><span class="No-Break"><span class="koboSpan" id="kobo.1608.1">displaying data.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1609.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1610.1">If you are debugging the app using the Windows target framework and it isn’t working, and you aren’t getting </span><a id="_idIndexMarker297"/><span class="koboSpan" id="kobo.1611.1">any error messages, try u</span><a id="_idTextAnchor196"/><a id="_idTextAnchor197"/><span class="koboSpan" id="kobo.1612.1">sing the Android target framework. </span><span class="koboSpan" id="kobo.1612.2">Sometimes, you can get better error reporting from a </span><span class="No-Break"><span class="koboSpan" id="kobo.1613.1">different platform.</span></span></p>
<h1 id="_idParaDest-56"><a id="_idTextAnchor198"/><span class="koboSpan" id="kobo.1614.1">Adding data bindings</span></h1>
<p><span class="koboSpan" id="kobo.1615.1">Data binding is the </span><a id="_idIndexMarker298"/><span class="koboSpan" id="kobo.1616.1">heart and soul of MVVM. </span><span class="koboSpan" id="kobo.1616.2">This is the way that the views and ViewModel communicate with each other. </span><span class="koboSpan" id="kobo.1616.3">In .NET MAUI, we need two things to make data </span><span class="No-Break"><span class="koboSpan" id="kobo.1617.1">binding happen:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1618.1">We need an object to </span><span class="No-Break"><span class="koboSpan" id="kobo.1619.1">implement </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1620.1">INotifyPropertyChanged</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1621.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1622.1">We need to set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1623.1">BindingContext</span></strong><span class="koboSpan" id="kobo.1624.1"> class of the page to that object. </span><span class="koboSpan" id="kobo.1624.2">We already do this on both </span><strong class="source-inline"><span class="koboSpan" id="kobo.1625.1">ItemView</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1626.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1627.1">MainView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1628.1">.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1629.1">A useful feature of data binding is that it allows us to use two-way communication. </span><span class="koboSpan" id="kobo.1629.2">For example, when data binding text to an </span><strong class="source-inline"><span class="koboSpan" id="kobo.1630.1">Entry</span></strong><span class="koboSpan" id="kobo.1631.1"> control, the property</span><a id="_idTextAnchor199"/><span class="koboSpan" id="kobo.1632.1"> on the data-bound object is updated directly. </span><span class="koboSpan" id="kobo.1632.2">Consider the </span><span class="No-Break"><span class="koboSpan" id="kobo.1633.1">following XAML:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1634.1">
&lt;Entry Text="{Binding Title}" /&gt;</span></pre> <p><span class="koboSpan" id="kobo.1635.1">To make this work, we need a property named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1636.1">Title</span></strong><span class="koboSpan" id="kobo.1637.1"> on the string object. </span><span class="koboSpan" id="kobo.1637.2">We have to look at the documentation, define an object, and </span><a id="_idIndexMarker299"/><span class="koboSpan" id="kobo.1638.1">let </span><strong class="bold"><span class="koboSpan" id="kobo.1639.1">IntelliSense</span></strong><span class="koboSpan" id="kobo.1640.1"> provide us with a hint to find out what type our property </span><span class="No-Break"><span class="koboSpan" id="kobo.1641.1">should be.</span></span></p>
<p><span class="koboSpan" id="kobo.1642.1">Controls that perform an action, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1643.1">Button</span></strong><span class="koboSpan" id="kobo.1644.1">, usually expose a property called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1645.1">Command</span></strong><span class="koboSpan" id="kobo.1646.1">. </span><span class="koboSpan" id="kobo.1646.2">This property is of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1647.1">ICommand</span></strong><span class="koboSpan" id="kobo.1648.1"> type, and we can either return </span><strong class="source-inline"><span class="koboSpan" id="kobo.1649.1">Microsoft.Maui.Controls.Command</span></strong><span class="koboSpan" id="kobo.1650.1"> or an implementation of our own. </span><span class="koboSpan" id="kobo.1650.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1651.1">Command</span></strong><span class="koboSpan" id="kobo.1652.1"> property is explained in the next section, where we will use it to navigate </span><span class="No-Break"><span class="koboSpan" id="kobo.1653.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1654.1">ItemView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1655.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1656.1">In the next few sections, we will be adding the data binding and command implementations to our views and ViewModels, starting with navigating from </span><strong class="source-inline"><span class="koboSpan" id="kobo.1657.1">MainView</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1658.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1659.1">ItemView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1660.1">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1661.1">Information</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1662.1">It’s also worth noting that .NET MAUI supports one-way binding in addition to two-way data binding, which comes in handy when you wa</span><a id="_idTextAnchor200"/><span class="koboSpan" id="kobo.1663.1">nt to display data in a view but not allow it to updat</span><a id="_idTextAnchor201"/><span class="koboSpan" id="kobo.1664.1">e the ViewModel. </span><span class="koboSpan" id="kobo.1664.2">From a performance perspective, it’s a good idea to mark those bindings</span><a id="_idIndexMarker300"/><span class="koboSpan" id="kobo.1665.1"> as </span><span class="No-Break"><span class="koboSpan" id="kobo.1666.1">one-way bindings.</span></span></p>
<h2 id="_idParaDest-57"><a id="_idTextAnchor202"/><span class="koboSpan" id="kobo.1667.1">Navigating from MainView to ItemView to add a new item</span></h2>
<p><span class="koboSpan" id="kobo.1668.1">We have an </span><strong class="source-inline"><span class="koboSpan" id="kobo.1669.1">Add</span></strong><span class="koboSpan" id="kobo.1670.1"> toolbar</span><a id="_idIndexMarker301"/><span class="koboSpan" id="kobo.1671.1"> button in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1672.1">MainView</span></strong><span class="koboSpan" id="kobo.1673.1">. </span><span class="koboSpan" id="kobo.1673.2">When the user taps this button, we want it to take them to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1674.1">ItemView</span></strong><span class="koboSpan" id="kobo.1675.1">. </span><span class="koboSpan" id="kobo.1675.2">The MVVM way to do this is to define a command and then bind that command to </span><span class="No-Break"><span class="koboSpan" id="kobo.1676.1">the button.</span></span></p>
<p><span class="koboSpan" id="kobo.1677.1">In .NET MAUI, to navigate to a view, you need a reference to an instance of the destination. </span><span class="koboSpan" id="kobo.1677.2">In this case, that would be </span><strong class="source-inline"><span class="koboSpan" id="kobo.1678.1">ItemView</span></strong><span class="koboSpan" id="kobo.1679.1">. </span><span class="koboSpan" id="kobo.1679.2">Since all our views have been registered with the dependency injection container, we will need a reference to the container to request a new instance of the view when we are ready to navigate. </span><span class="koboSpan" id="kobo.1679.3">We will use constructor injection to have the container provide us with its instance, </span><span class="No-Break"><span class="koboSpan" id="kobo.1680.1">like this:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1681.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1682.1">ViewModels/MainViewModel.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1683.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1684.1">Add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1685.1">using</span></strong><span class="koboSpan" id="kobo.1686.1"> statement </span><span class="No-Break"><span class="koboSpan" id="kobo.1687.1">for </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1688.1">DoToo.Views</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1689.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1690.1">Add the following field to </span><span class="No-Break"><span class="koboSpan" id="kobo.1691.1">the class:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1692.1">
private readonly IServiceProvider services;</span></pre></li> <li><span class="koboSpan" id="kobo.1693.1">Modify the constructor as follows. </span><span class="koboSpan" id="kobo.1693.2">The changes </span><span class="No-Break"><span class="koboSpan" id="kobo.1694.1">are highlighted:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1695.1">
public MainViewModel(ITodoItemRepository repository, 
</span><strong class="bold"><span class="koboSpan" id="kobo.1696.1">IServiceProvider services</span></strong><span class="koboSpan" id="kobo.1697.1">)
{
    this.repository = repository;
    </span><strong class="bold"><span class="koboSpan" id="kobo.1698.1">this.services = services;</span></strong><span class="koboSpan" id="kobo.1699.1">
    Task.Run(async () =&gt; await LoadDataAsync());
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1700.1">This will capture the instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1701.1">ItemView</span></strong><span class="koboSpan" id="kobo.1702.1"> that was created by the dependency injection container in a class field. </span><span class="koboSpan" id="kobo.1702.2">Now, let’s look at the </span><span class="No-Break"><span class="koboSpan" id="kobo.1703.1">command implementation.</span></span></p>
<p><span class="koboSpan" id="kobo.1704.1">All commands should be exposed as a generic </span><strong class="source-inline"><span class="koboSpan" id="kobo.1705.1">ICommand</span></strong><span class="koboSpan" id="kobo.1706.1"> type. </span><span class="koboSpan" id="kobo.1706.2">This abstracts the actual command implementation, which is good general practice to follow. </span><span class="koboSpan" id="kobo.1706.3">The command must be a property; in our case, we are creating a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.1707.1">Command</span></strong><span class="koboSpan" id="kobo.1708.1"> object that we assign to this property. </span><span class="koboSpan" id="kobo.1708.2">The property is read-only, which is usually fine for a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1709.1">Command</span></strong><span class="koboSpan" id="kobo.1710.1"> object. </span><span class="koboSpan" id="kobo.1710.2">The action of the command (the code that we want to run when the command is executed) is passed to the constructor of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1711.1">Command</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1712.1"> object.</span></span></p>
<p><span class="koboSpan" id="kobo.1713.1">Following those requirements, you might end up writing something like </span><span class="No-Break"><span class="koboSpan" id="kobo.1714.1">th</span><a id="_idTextAnchor203"/><span class="koboSpan" id="kobo.1715.1">e following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1716.1">
public ICommand AddItem =&gt; new Command(async () =&gt;
{
    await Navigation.PushAsync(itemView);
});</span></pre> <p><span class="koboSpan" id="kobo.1717.1">There is a lot of boilerplate code in that implementation that you would have to repeat for each</span><a id="_idIndexMarker302"/><span class="koboSpan" id="kobo.1718.1"> command. </span><span class="koboSpan" id="kobo.1718.2">This boilerplate code can get in the way of what the command is doing. </span><span class="koboSpan" id="kobo.1718.3">Like how we were able to eliminate boilerplate code with properties, we can do the same with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1719.1">ICommand</span></strong><span class="koboSpan" id="kobo.1720.1">, but instead, we can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1721.1">RelayCommand</span></strong><span class="koboSpan" id="kobo.1722.1"> attribute. </span><span class="koboSpan" id="kobo.1722.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1723.1">RelayCommand</span></strong><span class="koboSpan" id="kobo.1724.1"> attribute uses a source generator to wrap a method in a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.1725.1">Command</span></strong><span class="koboSpan" id="kobo.1726.1"> instance and expose it through a property. </span><span class="koboSpan" id="kobo.1726.2">The property name that’s generated is the method name with “Command” appended </span><span class="No-Break"><span class="koboSpan" id="kobo.1727.1">to it.</span></span></p>
<p><span class="koboSpan" id="kobo.1728.1"> Now, we can add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1729.1">Command</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1730.1">object’s implementation:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1731.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1732.1">ViewModels/MainViewModel.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1733.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1734.1">Add the following method to </span><span class="No-Break"><span class="koboSpan" id="kobo.1735.1">the class:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1736.1">
[RelayCommand]
public async Task AddItemAsync() =&gt; await Navigation.
</span><span class="koboSpan" id="kobo.1736.2">PushAsync(services.GetRequiredService&lt;ItemView&gt;());</span></pre></li> <li><span class="koboSpan" id="kobo.1737.1">Add </span><strong class="source-inline"><span class="koboSpan" id="kobo.1738.1">using CommunityToolkit.Mvvm.Input;</span></strong><span class="koboSpan" id="kobo.1739.1"> to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1740.1">usings</span></strong><span class="koboSpan" id="kobo.1741.1"> section of </span><span class="No-Break"><span class="koboSpan" id="kobo.1742.1">the file.</span></span></li>
<li><span class="koboSpan" id="kobo.1743.1">Update the class definition to allow the Source Generators to do </span><span class="No-Break"><span class="koboSpan" id="kobo.1744.1">their thing:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1745.1">
public </span><strong class="bold"><span class="koboSpan" id="kobo.1746.1">partial</span></strong><span class="koboSpan" id="kobo.1747.1"> class MainViewModel : ViewModel</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1748.1">The action of the command is simply to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1749.1">Navigation</span></strong><span class="koboSpan" id="kobo.1750.1"> service to push the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1751.1">itemView</span></strong><span class="koboSpan" id="kobo.1752.1"> instance onto the stack </span><span class="No-Break"><span class="koboSpan" id="kobo.1753.1">for us.</span></span></p>
<p><span class="koboSpan" id="kobo.1754.1">After that, we just need to wire up the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1755.1">AddItemAsync</span></strong><span class="koboSpan" id="kobo.1756.1"> command from </span><strong class="source-inline"><span class="koboSpan" id="kobo.1757.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1758.1"> to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1759.1">Add</span></strong><span class="koboSpan" id="kobo.1760.1"> button in </span><span class="No-Break"><span class="koboSpan" id="kobo.1761.1">the view:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1762.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1763.1">Views/MainView.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1764.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1765.1">Update the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1766.1">ContentPage</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1767.1"> element:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1768.1">
&lt;ContentPage xmlns=http://schemas.microsoft.com/dotnet/2021/maui
             xmlns:x=http://schemas.microsoft.com/winfx/2009/xaml
  </span><strong class="bold"><span class="koboSpan" id="kobo.1769.1"/></strong><span class="koboSpan" id="kobo.1770.1">
  x:Class="DoToo.Views.MainView"
  </span><strong class="bold"><span class="koboSpan" id="kobo.1771.1">x:DataType="viewModels:MainViewModel"</span></strong><span class="koboSpan" id="kobo.1772.1">
  Title="Do Too!"&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.1773.1">Add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1774.1">Command</span></strong><span class="koboSpan" id="kobo.1775.1"> attribute </span><span class="No-Break"><span class="koboSpan" id="kobo.1776.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1777.1">ToolbarItem</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1778.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1779.1">
&lt;ContentPage.ToolbarItems&gt;
  &lt;ToolbarItem Text="Add" </span><strong class="bold"><span class="koboSpan" id="kobo.1780.1">Command="{Binding AddItemAsyncCommand}"</span></strong><span class="koboSpan" id="kobo.1781.1"> /&gt;
&lt;/Co</span><a id="_idTextAnchor204"/><span class="koboSpan" id="kobo.1782.1">ntentPage.ToolbarItems&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1783.1">Run the app</span><a id="_idTextAnchor205"/> <a id="_idIndexMarker303"/><span class="koboSpan" id="kobo.1784.1">and tap the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1785.1">Add</span></strong><span class="koboSpan" id="kobo.1786.1"> button to navigate to the new </span><strong class="source-inline"><span class="koboSpan" id="kobo.1787.1">ItemView</span></strong><span class="koboSpan" id="kobo.1788.1"> view. </span><span class="koboSpan" id="kobo.1788.2">Notice that the back button </span><span class="No-Break"><span class="koboSpan" id="kobo.1789.1">appears automatically.</span></span></p>
<h2 id="_idParaDest-58"><a id="_idTextAnchor206"/><span class="koboSpan" id="kobo.1790.1">Adding new items to the list</span></h2>
<p><span class="koboSpan" id="kobo.1791.1">Now that we have</span><a id="_idIndexMarker304"/><span class="koboSpan" id="kobo.1792.1"> finished adding navigation to a new item, let’s add the code to create a new item and save it to </span><span class="No-Break"><span class="koboSpan" id="kobo.1793.1">the database:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1794.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1795.1">ViewModels/ItemViewModel.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1796.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1797.1">Add the</span><a id="_idIndexMarker305"/><span class="koboSpan" id="kobo.1798.1"> following code </span><span class="No-Break"><span class="koboSpan" id="kobo.1799.1">in bold:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1800.1">using CommunityToolkit.Mvvm.ComponentModel;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1801.1">using CommunityToolkit.Mvvm.Input;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1802.1">using DoToo.Models;</span></strong><span class="koboSpan" id="kobo.1803.1">
using DoToo.Repositories;
public </span><strong class="bold"><span class="koboSpan" id="kobo.1804.1">partial</span></strong><span class="koboSpan" id="kobo.1805.1"> class ItemViewModel : ViewModel
{
    private readonly ITodoItemRepository repository;
    </span><strong class="bold"><span class="koboSpan" id="kobo.1806.1">[ObservableProperty]</span></strong><span class="koboSpan" id="kobo.1807.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.1808.1">TodoItem item;</span></strong><span class="koboSpan" id="kobo.1809.1">
    public ItemViewModel(ITodoItemRepository repository)
    {
        this.repository = repository;
        </span><strong class="bold"><span class="koboSpan" id="kobo.1810.1">Item = new TodoItem() { Due = DateTime.Now.AddDays(1) };</span></strong><span class="koboSpan" id="kobo.1811.1">
    }
    </span><strong class="bold"><span class="koboSpan" id="kobo.1812.1">[RelayCommand]</span></strong><span class="koboSpan" id="kobo.1813.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.1814.1">public async T</span><a id="_idTextAnchor207"/><span class="koboSpan" id="kobo.1815.1">ask SaveAsync()</span></strong><span class="koboSpan" id="kobo.1816.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.1817.1">{</span></strong><span class="koboSpan" id="kobo.1818.1">
        </span><strong class="bold"><span class="koboSpan" id="kobo.1819.1">await repository.AddOrUpdateAsync(Item);</span></strong><span class="koboSpan" id="kobo.1820.1">
        </span><strong class="bold"><span class="koboSpan" id="kobo.1821.1">await Navigation.PopAsync();</span></strong><span class="koboSpan" id="kobo.1822.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.1823.1">}</span></strong><span class="koboSpan" id="kobo.1824.1">
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1825.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1826.1">Item</span></strong><span class="koboSpan" id="kobo.1827.1"> property holds a reference to the current item that we want to add or edit. </span><span class="koboSpan" id="kobo.1827.2">A new item is created in the constructor and when we want to edit an item, we can simply assign our own item to this property. </span><span class="koboSpan" id="kobo.1827.3">The new item is not added to the database unless we execute the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1828.1">Save</span></strong><span class="koboSpan" id="kobo.1829.1"> command defined at the end. </span><span class="koboSpan" id="kobo.1829.2">Once the item has been added or updated, we remove the view from the navigation stack and return to </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1830.1">MainView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1831.1"> again.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1832.1">Information</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1833.1">Since the navigation keeps pages in a stack, the framework declares methods that reflect operations that you can perform on a stack. </span><span class="koboSpan" id="kobo.1833.2">The operation of removing the topmost item in a stack is known as </span><em class="italic"><span class="koboSpan" id="kobo.1834.1">popping the stack</span></em><span class="koboSpan" id="kobo.1835.1">, so instead of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1836.1">RemoveAsync()</span></strong><span class="koboSpan" id="kobo.1837.1">, we have </span><strong class="source-inline"><span class="koboSpan" id="kobo.1838.1">PopAsync()</span></strong><span class="koboSpan" id="kobo.1839.1">. </span><span class="koboSpan" id="kobo.1839.2">To add a page to the navigation stack, we push it, so the method is </span><span class="No-Break"><span class="koboSpan" id="kobo.1840.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1841.1">PushAsync()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1842.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1843.1">Now that we have</span><a id="_idIndexMarker306"/><span class="koboSpan" id="kobo.1844.1"> extended </span><strong class="source-inline"><span class="koboSpan" id="kobo.1845.1">ItemViewModel</span></strong><span class="koboSpan" id="kobo.1846.1"> with the necessary commands and properties, it’s time to data-bind them in </span><span class="No-Break"><span class="koboSpan" id="kobo.1847.1">the XAML:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1848.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1849.1">Views/ItemView.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1850.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1851.1">Add the code marked </span><span class="No-Break"><span class="koboSpan" id="kobo.1852.1">in bold:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1853.1">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ContentPage
  xmlns=http://schemas.microsoft.com/dotnet/2021/maui
    xmlns:x=http://schemas.microsoft.com/winfx/2009/xaml
  </span><strong class="bold"><span class="koboSpan" id="kobo.1854.1"/></strong><span class="koboSpan" id="kobo.1855.1">
  x:Class="DoToo.Views.ItemView"
  </span><strong class="bold"><span class="koboSpan" id="kobo.1856.1">x:DataType="viewModels:ItemViewModel"</span></strong><span class="koboSpan" id="kobo.1857.1"> &gt;
  &lt;ContentPage.ToolbarItems&gt;
    &lt;ToolbarItem Text="Save" </span><strong class="bold"><span class="koboSpan" id="kobo.1858.1">Command="{Binding </span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1859.1">SaveAsyncCommand}"</span></strong><span class="koboSpan" id="kobo.1860.1"> /&gt;
  &lt;/ContentPage.ToolbarItems&gt;
  &lt;StackLayout Padding="14"&gt;
    &lt;Label Text="Title" /&gt;
    &lt;Entry </span><strong class="bold"><span class="koboSpan" id="kobo.1861.1">Text="{Binding Item.Title}"</span></strong><span class="koboSpan" id="kobo.1862.1"> /&gt;
    &lt;Label Text="Due" /&gt;
    &lt;DatePicker </span><strong class="bold"><span class="koboSpan" id="kobo.1863.1">Date="{Binding Item.Due}"</span></strong><span class="koboSpan" id="kobo.1864.1"> /&gt;
    &lt;StackLayout Orientation="Horizontal"&gt;
    &lt;Switch </span><strong class="bold"><span class="koboSpan" id="kobo.1865.1">IsToggled="{Binding Item.Completed}"</span></strong><span class="koboSpan" id="kobo.1866.1"> /&gt;
    &lt;Label Text="Completed" /&gt;
  &lt;/StackLayout&gt;
&lt;/ContentPage&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1867.1">The binding to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1868.1">ToolbarItems</span></strong><span class="koboSpan" id="kobo.1869.1"> command attribute triggers the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1870.1">SaveAsync</span></strong><span class="koboSpan" id="kobo.1871.1"> command exposed by </span><strong class="source-inline"><span class="koboSpan" id="kobo.1872.1">ItemViewModel</span></strong><span class="koboSpan" id="kobo.1873.1"> when a user taps the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1874.1">Save</span></strong><span class="koboSpan" id="kobo.1875.1"> link. </span><span class="koboSpan" id="kobo.1875.2">It’s worth noting again that any attribute called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1876.1">Command</span></strong><span class="koboSpan" id="kobo.1877.1"> indicate</span><a id="_idTextAnchor208"/><span class="koboSpan" id="kobo.1878.1">s that an action will take place and we must bind it to an instance of an object implementing the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1879.1">ICommand</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1880.1"> interface.</span></span></p>
<p><span class="koboSpan" id="kobo.1881.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1882.1">Entry</span></strong><span class="koboSpan" id="kobo.1883.1"> control that represents the title is data-bound to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1884.1">Item.Title</span></strong><span class="koboSpan" id="kobo.1885.1"> property of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1886.1">ItemViewModel</span></strong><span class="koboSpan" id="kobo.1887.1">, and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1888.1">Datepicker</span></strong><span class="koboSpan" id="kobo.1889.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1890.1">Switch</span></strong><span class="koboSpan" id="kobo.1891.1"> controls bind similarly to their </span><span class="No-Break"><span class="koboSpan" id="kobo.1892.1">respective properties.</span></span></p>
<p><span class="koboSpan" id="kobo.1893.1">We could have exposed </span><strong class="source-inline"><span class="koboSpan" id="kobo.1894.1">Title</span></strong><span class="koboSpan" id="kobo.1895.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1896.1">Due</span></strong><span class="koboSpan" id="kobo.1897.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1898.1">Complete</span></strong><span class="koboSpan" id="kobo.1899.1"> as properties directly on </span><strong class="source-inline"><span class="koboSpan" id="kobo.1900.1">ItemViewModel</span></strong><span class="koboSpan" id="kobo.1901.1">, but </span><a id="_idIndexMarker307"/><span class="koboSpan" id="kobo.1902.1">instead, we chose to reuse the already-existing </span><strong class="source-inline"><span class="koboSpan" id="kobo.1903.1">TodoItem</span></strong><span class="koboSpan" id="kobo.1904.1"> object as a ref</span><a id="_idTextAnchor209"/><a id="_idTextAnchor210"/><span class="koboSpan" id="kobo.1905.1">erence. </span><span class="koboSpan" id="kobo.1905.2">This is fine, so long as the properties of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1906.1">TodoItem</span></strong><span class="koboSpan" id="kobo.1907.1"> object implement the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1908.1">INotifyPropertyChange</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1909.1"> interface.</span></span></p>
<h2 id="_idParaDest-59"><a id="_idTextAnchor211"/><span class="koboSpan" id="kobo.1910.1">Binding ListView in MainView</span></h2>
<p><span class="koboSpan" id="kobo.1911.1">A to-do list</span><a id="_idIndexMarker308"/><span class="koboSpan" id="kobo.1912.1"> is </span><a id="_idIndexMarker309"/><span class="koboSpan" id="kobo.1913.1">not much use without a list of items. </span><span class="koboSpan" id="kobo.1913.2">Let’s extend </span><strong class="source-inline"><span class="koboSpan" id="kobo.1914.1">MainViewModel</span></strong><span class="koboSpan" id="kobo.1915.1"> with a list </span><span class="No-Break"><span class="koboSpan" id="kobo.1916.1">of items:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1917.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1918.1">ViewModels/MainViewModel.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1919.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1920.1">Add </span><strong class="source-inline"><span class="koboSpan" id="kobo.1921.1">using System.Collections.ObjectModel</span></strong><span class="koboSpan" id="kobo.1922.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1923.1">using</span></strong><span class="koboSpan" id="kobo.1924.1"> section of </span><span class="No-Break"><span class="koboSpan" id="kobo.1925.1">the class.</span></span></li>
<li><span class="koboSpan" id="kobo.1926.1">Add a property for the to-do </span><span class="No-Break"><span class="koboSpan" id="kobo.1927.1">list items:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1928.1">
[ObservableProperty]
ObservableCollection&lt;TodoItemViewModel&gt; items;</span></pre></li> </ol>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1929.1">ObservableCollection</span></strong><span class="koboSpan" id="kobo.1930.1"> is like an ordinary collection, but it has a useful superpower: it can notify listeners about changes in the list, such as when items are added or deleted. </span><span class="koboSpan" id="kobo.1930.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1931.1">ListView</span></strong><span class="koboSpan" id="kobo.1932.1"> control listens to changes in the list and updates itself automatically based on these. </span><span class="koboSpan" id="kobo.1932.2">However, it’s important to be aware that a change to an item in the list will not trigger an update. </span><span class="koboSpan" id="kobo.1932.3">Changing the title of an item will not cause the list to re-render. </span><span class="koboSpan" id="kobo.1932.4">Let’s move on to implementing the rest </span><span class="No-Break"><span class="koboSpan" id="kobo.1933.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1934.1">MainViewModel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1935.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1936.1">Now, we need </span><span class="No-Break"><span class="koboSpan" id="kobo.1937.1">some data:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1938.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1939.1">ViewModels/MainViewModel.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1940.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1941.1">Replace (or complete) the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1942.1">LoadDataAsync</span></strong><span class="koboSpan" id="kobo.1943.1"> method and create </span><span class="No-Break"><span class="koboSpan" id="kobo.1944.1">the </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1945.1">CreateTodo</span></strong></span><strong class="source-inline"><span class="koboSpan" id="kobo.1946.1">
ItemViewModel</span></strong><span class="koboSpan" id="kobo.1947.1"> and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1948.1">ItemStatusChanged</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1949.1"> methods:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1950.1">
private async Task LoadDataAsync()
{
    var items = await repository.GetItemsAsync();
    var itemViewModels = items.Select(i =&gt; CreateTodoItemViewModel(i));
    Items = new ObservableCollection&lt;TodoItemViewModel&gt; 
(itemViewModels);
}
private TodoItemViewModel CreateTodoItemViewModel(TodoItem item)
{
    var itemViewModel = new TodoItemViewModel(item);
    itemViewModel.ItemStatusChanged += ItemStatusChanged;
    return itemViewModel;
}
private void ItemStatusChanged(object sender, EventArgs e)
{
}</span></pre></li> <li><span class="koboSpan" id="kobo.1951.1">Resolve all </span><a id="_idIndexMarker310"/><span class="koboSpan" id="kobo.1952.1">new</span><a id="_idIndexMarker311"/><span class="koboSpan" id="kobo.1953.1"> references by adding the following </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1954.1">using</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1955.1"> statements:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1956.1">
using CommunityToolkit.Mvvm.ComponentModel;
using DoToo.Models;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1957.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1958.1">LoadData</span></strong><span class="koboSpan" id="kobo.1959.1"> method calls the repository to fetch all items. </span><span class="koboSpan" id="kobo.1959.2">Then, we wrap each to-do list item in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1960.1">TodoItemViewModel</span></strong><span class="koboSpan" id="kobo.1961.1">. </span><span class="koboSpan" id="kobo.1961.2">This contains more information that is specific to the view that we don’t want to add to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1962.1">TodoItem</span></strong><span class="koboSpan" id="kobo.1963.1"> class. </span><span class="koboSpan" id="kobo.1963.2">It is good practice to wrap plain objects in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1964.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1965.1">; this makes it simpler to add actions or extra properties to it. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1966.1">ItemStatusChanged</span></strong><span class="koboSpan" id="kobo.1967.1"> is a stub that is called when we change the status of the to-do list item from </span><strong class="source-inline"><span class="koboSpan" id="kobo.1968.1">active</span></strong><span class="koboSpan" id="kobo.1969.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1970.1">completed</span></strong><span class="koboSpan" id="kobo.1971.1">, and </span><span class="No-Break"><span class="koboSpan" id="kobo.1972.1">vice versa.</span></span></p>
<p><span class="koboSpan" id="kobo.1973.1">We also need to hook up some events from the repository to know when </span><span class="No-Break"><span class="koboSpan" id="kobo.1974.1">data changes:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1975.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1976.1">ViewModels/MainViewModel.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1977.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1978.1">Add the following code </span><span class="No-Break"><span class="koboSpan" id="kobo.1979.1">in bold:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1980.1">
public MainViewModel(TodoItemRepository repository, 
IServiceProvider services)
{
    </span><strong class="bold"><span class="koboSpan" id="kobo.1981.1">repository.OnItemAdded += (sender, item) =&gt;</span></strong><span class="koboSpan" id="kobo.1982.1">
        </span><strong class="bold"><span class="koboSpan" id="kobo.1983.1">items.Add(CreateTodoItemViewModel(item));</span></strong><span class="koboSpan" id="kobo.1984.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.1985.1">repository.OnItemUpdated += (sender, item) =&gt;</span></strong><span class="koboSpan" id="kobo.1986.1">
        </span><strong class="bold"><span class="koboSpan" id="kobo.1987.1">Task.Run(async () =&gt; await LoadDataAsync</span><a id="_idTextAnchor212"/><span class="koboSpan" id="kobo.1988.1">());</span></strong><span class="koboSpan" id="kobo.1989.1">
    this.repository = repository;
    this.services = services;
    Task.Run(async () =&gt; await LoadDataAsync());
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1990.1">When an item is added to the repository, no matter who added it, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1991.1">MainView</span></strong><span class="koboSpan" id="kobo.1992.1"> will add it to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1993.1">items</span></strong><span class="koboSpan" id="kobo.1994.1"> list. </span><span class="koboSpan" id="kobo.1994.2">Since</span><a id="_idIndexMarker312"/><span class="koboSpan" id="kobo.1995.1"> the</span><a id="_idIndexMarker313"/><span class="koboSpan" id="kobo.1996.1"> items collection is an observable collection, the list updates. </span><span class="koboSpan" id="kobo.1996.2">If an item is updated, we simply reload </span><span class="No-Break"><span class="koboSpan" id="kobo.1997.1">the list.</span></span></p>
<p><span class="koboSpan" id="kobo.1998.1">Let’s data-bind our items </span><span class="No-Break"><span class="koboSpan" id="kobo.1999.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2000.1">ListView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2001.1">:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.2002.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.2003.1">MainView.xaml</span></strong><span class="koboSpan" id="kobo.2004.1"> and locate the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2005.1">ListView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2006.1"> element.</span></span></li>
<li><span class="koboSpan" id="kobo.2007.1">Modify it so that it reflects the </span><span class="No-Break"><span class="koboSpan" id="kobo.2008.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2009.1">
&lt;ListView Grid.Row="1"
</span><strong class="bold"><span class="koboSpan" id="kobo.2010.1">  RowHeight="70" ItemsSource="{Binding Items}"&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2011.1">  &lt;ListView.ItemTemplate&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2012.1">    &lt;DataTemplate x:DataType="viewModels:TodoItemViewModel"&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2013.1">      &lt;ViewCell&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2014.1">        &lt;Grid Padding="15,10"&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2015.1">          &lt;Grid.RowDefinitions&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2016.1">              &lt;RowDefinition /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2017.1">              &lt;RowDefinition /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2018.1">          &lt;/Grid.RowDefinitions&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2019.1">          &lt;Grid.ColumnDefinitions&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2020.1">            &lt;ColumnDefinition Width="10" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2021.1">            &lt;ColumnDefinition Width="*" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2022.1">          &lt;/Grid.ColumnDefinitions&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2023.1">          &lt;BoxView Grid.RowSpan="2" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2024.1">          &lt;Label Grid.Column="1"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2025.1">            Text="{Binding Item.Title}" FontSize="Medium" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2026.1">          &lt;Label Grid.Column="1" Grid.Row="1"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2027.1">            Text="{Binding Item.Due}" FontSize="Micro" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2028.1">          &lt;Label Grid.Column="1" Grid.Row="1"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2029.1">            HorizontalTextAlignment="End" Text="Completed"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2030.1">            IsVisible="{Binding Item.Completed}"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2031.1">            FontSize="Micro" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2032.1">        &lt;/Grid&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2033.1">      &lt;/ViewCell&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2034.1">    &lt;/DataTemplate&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2035.1">  &lt;/ListView.ItemTemplate&gt;</span></strong><span class="koboSpan" id="kobo.2036.1">
&lt;/ListView&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.2037.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.2038.1">ItemsSource</span></strong><span class="koboSpan" id="kobo.2039.1"> binding tells </span><strong class="source-inline"><span class="koboSpan" id="kobo.2040.1">ListView</span></strong><span class="koboSpan" id="kobo.2041.1"> where to find the collection to iterate over and is local to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2042.1">ViewModel</span></strong><span class="koboSpan" id="kobo.2043.1">. </span><span class="koboSpan" id="kobo.2043.2">Any bindings in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2044.1">ViewCell</span></strong><span class="koboSpan" id="kobo.2045.1"> node, however, are local to each item that we iterate in the list. </span><span class="koboSpan" id="kobo.2045.2">In this case, we are binding to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2046.1">TodoItemViewModel</span></strong><span class="koboSpan" id="kobo.2047.1">, which contains a property named </span><strong class="source-inline"><span class="koboSpan" id="kobo.2048.1">Item</span></strong><span class="koboSpan" id="kobo.2049.1">. </span><span class="koboSpan" id="kobo.2049.2">This, in turn, has properties such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.2050.1">Title</span></strong><span class="koboSpan" id="kobo.2051.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2052.1">Due</span></strong><span class="koboSpan" id="kobo.2053.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.2054.1">Completed</span></strong><span class="koboSpan" id="kobo.2055.1">. </span><span class="koboSpan" id="kobo.2055.2">We can navigate down the hierarchy of objects without any</span><a id="_idTextAnchor213"/><span class="koboSpan" id="kobo.2056.1"> problem when defining </span><span class="No-Break"><span class="koboSpan" id="kobo.2057.1">a binding.</span></span></p>
<p><a id="_idTextAnchor214"/><span class="koboSpan" id="kobo.2058.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.2059.1">DataTemplate</span></strong><span class="koboSpan" id="kobo.2060.1"> element defines what each row will look like. </span><span class="koboSpan" id="kobo.2060.2">We use a grid to partition the space, just as we </span><span class="No-Break"><span class="koboSpan" id="kobo.2061.1">did earlier.</span></span></p>
<p><span class="koboSpan" id="kobo.2062.1">You may have noticed that we didn’t discuss what </span><strong class="source-inline"><span class="koboSpan" id="kobo.2063.1">BoxView</span></strong><span class="koboSpan" id="kobo.2064.1"> was for, and it isn’t bound to any properties of </span><strong class="source-inline"><span class="koboSpan" id="kobo.2065.1">ViewModel</span></strong><span class="koboSpan" id="kobo.2066.1">. </span><span class="koboSpan" id="kobo.2066.2">The next two sections will cover how we can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2067.1">Completed</span></strong><span class="koboSpan" id="kobo.2068.1"> property</span><a id="_idIndexMarker314"/><span class="koboSpan" id="kobo.2069.1"> to</span><a id="_idIndexMarker315"/><span class="koboSpan" id="kobo.2070.1"> color code our items </span><span class="No-Break"><span class="koboSpan" id="kobo.2071.1">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2072.1">BoxView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2073.1">.</span></span></p>
<h2 id="_idParaDest-60"><a id="_idTextAnchor215"/><span class="koboSpan" id="kobo.2074.1">Creating a ValueConverter object for the item’s status</span></h2>
<p><span class="koboSpan" id="kobo.2075.1">Sometimes, we</span><a id="_idIndexMarker316"/><span class="koboSpan" id="kobo.2076.1"> want to bind to objects that are a representation of the original value. </span><span class="koboSpan" id="kobo.2076.2">This could be a piece of text that is based on a Boolean value. </span><span class="koboSpan" id="kobo.2076.3">Instead of </span><strong class="source-inline"><span class="koboSpan" id="kobo.2077.1">true</span></strong><span class="koboSpan" id="kobo.2078.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.2079.1">false</span></strong><span class="koboSpan" id="kobo.2080.1">, for example, we might want to write </span><strong class="source-inline"><span class="koboSpan" id="kobo.2081.1">Yes</span></strong><span class="koboSpan" id="kobo.2082.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.2083.1">No</span></strong><span class="koboSpan" id="kobo.2084.1"> or return a color. </span><span class="koboSpan" id="kobo.2084.2">This is where </span><strong class="source-inline"><span class="koboSpan" id="kobo.2085.1">ValueConverter</span></strong><span class="koboSpan" id="kobo.2086.1"> comes in handy. </span><span class="koboSpan" id="kobo.2086.2">It can be used to convert a value to and from another value. </span><span class="koboSpan" id="kobo.2086.3">We are going to write a </span><strong class="source-inline"><span class="koboSpan" id="kobo.2087.1">ValueConverter</span></strong><span class="koboSpan" id="kobo.2088.1"> object that converts the status of a to-do list item into </span><span class="No-Break"><span class="koboSpan" id="kobo.2089.1">a color:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.2090.1">In the root of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2091.1">DoToo</span></strong><span class="koboSpan" id="kobo.2092.1"> project, create a folder </span><span class="No-Break"><span class="koboSpan" id="kobo.2093.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2094.1">Converters</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2095.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.2096.1">Create a class called </span><strong class="source-inline"><span class="koboSpan" id="kobo.2097.1">StatusColorConverter.cs</span></strong><span class="koboSpan" id="kobo.2098.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2099.1">Converters</span></strong><span class="koboSpan" id="kobo.2100.1"> folder and add the </span><span class="No-Break"><span class="koboSpan" id="kobo.2101.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2102.1">
using System;
using System.Globalization;
public class StatusColorConverter : IValueConverter
{
    public object Convert(object value, Type targetType, object 
parameter, CultureInfo culture)
    {
        return (Color)Application.Curre</span><a id="_idTextAnchor216"/><span class="koboSpan" id="kobo.2103.1">nt.Resources[
        (bool)value ? </span><span class="koboSpan" id="kobo.2103.2">"CompletedColor" : "ActiveColor"];
    }
    public object ConvertBack(object value, Type targetType, 
object parameter, CultureInfo culture)
    {
        return null;
    }
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.2104.1">A </span><strong class="source-inline"><span class="koboSpan" id="kobo.2105.1">ValueConverter</span></strong><span class="koboSpan" id="kobo.2106.1"> object is a class that implements </span><strong class="source-inline"><span class="koboSpan" id="kobo.2107.1">IValueConverter</span></strong><span class="koboSpan" id="kobo.2108.1">. </span><span class="koboSpan" id="kobo.2108.2">This, in turn, only has two methods defined. </span><span class="koboSpan" id="kobo.2108.3">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.2109.1">Convert</span></strong><span class="koboSpan" id="kobo.2110.1"> method is called when the view reads data from </span><strong class="source-inline"><span class="koboSpan" id="kobo.2111.1">ViewModel</span></strong><span class="koboSpan" id="kobo.2112.1"> and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2113.1">ConvertBack</span></strong><span class="koboSpan" id="kobo.2114.1"> method is used when </span><strong class="source-inline"><span class="koboSpan" id="kobo.2115.1">ViewModel</span></strong><span class="koboSpan" id="kobo.2116.1"> gets data from the view. </span><span class="koboSpan" id="kobo.2116.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.2117.1">ConvertBack</span></strong><span class="koboSpan" id="kobo.2118.1"> method is only used for controls that return data from plain text, such as the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2119.1">Entry</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2120.1"> control.</span></span></p>
<p><span class="koboSpan" id="kobo.2121.1">If we look at the implementation of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2122.1">Convert</span></strong><span class="koboSpan" id="kobo.2123.1"> method, we’ll notice that any value passed to the</span><a id="_idIndexMarker317"/><span class="koboSpan" id="kobo.2124.1"> method is of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2125.1">object</span></strong><span class="koboSpan" id="kobo.2126.1"> type. </span><span class="koboSpan" id="kobo.2126.2">This is because we don’t know what type the user has bound to the property to which we are adding this </span><strong class="source-inline"><span class="koboSpan" id="kobo.2127.1">ValueConverter</span></strong><span class="koboSpan" id="kobo.2128.1"> class. </span><span class="koboSpan" id="kobo.2128.2">We may also notice that we fetch colors from a resource file. </span><span class="koboSpan" id="kobo.2128.3">We could have defined the colors in the code, but this is not recommended. </span><span class="koboSpan" id="kobo.2128.4">So, instead, we went the extra mile and added them as a global resource to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2129.1">App.xaml</span></strong><span class="koboSpan" id="kobo.2130.1"> file. </span><span class="koboSpan" id="kobo.2130.2">Resources are a good thing to take another look at once you have finished </span><span class="No-Break"><span class="koboSpan" id="kobo.2131.1">this chapter:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.2132.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.2133.1">App.xaml</span></strong><span class="koboSpan" id="kobo.2134.1"> in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2135.1">DoToo</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2136.1"> project.</span></span></li>
<li><span class="koboSpan" id="kobo.2137.1">Add the following </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2138.1">ResourceDictionary</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2139.1"> element:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2140.1">
&lt;Application ...&gt;
    &lt;Application.Resources&gt;
        &lt;ResourceDictionary&gt;
            &lt;ResourceDictionary.MergedDictionaries&gt;
                &lt;ResourceDictionary Source="Resources/Styles/Colors.xaml" /&gt;
                &lt;ResourceDictionary Source="Resources/Styles/
Styles.xaml" /&gt;
        &lt;/ResourceDictionary.MergedDictionaries&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.2141.1">        &lt;ResourceDictionary&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2142.1">            &lt;Color x:Key="CompletedColor"&gt; #1C8859 &lt;/Color&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2143.1">            &lt;Color x:Key="ActiveColor"&gt; #D3D3D3 &lt;/Color&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2144.1">        &lt;/ResourceDictionary&gt;</span></strong><span class="koboSpan" id="kobo.2145.1">
        &lt;/ResourceDictionary&gt;
    &lt;/Application.Resources&gt;
&lt;/Application&gt;</span></pre></li> </ol>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.2146.1">ResourceDictionary</span></strong><span class="koboSpan" id="kobo.2147.1"> can define a wide range of different objects. </span><span class="koboSpan" id="kobo.2147.2">We only need the two colors that we want to access from </span><strong class="source-inline"><span class="koboSpan" id="kobo.2148.1">ValueConverter</span></strong><span class="koboSpan" id="kobo.2149.1">. </span><span class="koboSpan" id="kobo.2149.2">Notice that these can be accessed by the</span><a id="_idIndexMarker318"/><span class="koboSpan" id="kobo.2150.1"> key given to them and from any o</span><a id="_idTextAnchor217"/><a id="_idTextAnchor218"/><a id="_idTextAnchor219"/><span class="koboSpan" id="kobo.2151.1">ther XAML file using a static </span><span class="No-Break"><span class="koboSpan" id="kobo.2152.1">resource binding.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.2153.1">ValueConverter</span></strong><span class="koboSpan" id="kobo.2154.1"> itself is referenced as a static resource but from a </span><span class="No-Break"><span class="koboSpan" id="kobo.2155.1">local scope.</span></span></p>
<h3><span class="koboSpan" id="kobo.2156.1">Using ValueConverter</span></h3>
<p><span class="koboSpan" id="kobo.2157.1">We want to use our </span><a id="_idIndexMarker319"/><span class="koboSpan" id="kobo.2158.1">brand-new </span><strong class="source-inline"><span class="koboSpan" id="kobo.2159.1">StatusColorConverter</span></strong><span class="koboSpan" id="kobo.2160.1"> object in </span><strong class="source-inline"><span class="koboSpan" id="kobo.2161.1">MainView</span></strong><span class="koboSpan" id="kobo.2162.1">. </span><span class="koboSpan" id="kobo.2162.2">Unfortunately, we have to jump through some hoops to make this happen. </span><span class="koboSpan" id="kobo.2162.3">We need to do </span><span class="No-Break"><span class="koboSpan" id="kobo.2163.1">three things:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.2164.1">Define a namespace </span><span class="No-Break"><span class="koboSpan" id="kobo.2165.1">in XAML</span></span></li>
<li><span class="koboSpan" id="kobo.2166.1">Define a local resource that represents an instance of </span><span class="No-Break"><span class="koboSpan" id="kobo.2167.1">the converter</span></span></li>
<li><span class="koboSpan" id="kobo.2168.1">Declare that we want to use the converter in </span><span class="No-Break"><span class="koboSpan" id="kobo.2169.1">the binding</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.2170.1">Let’s start with </span><span class="No-Break"><span class="koboSpan" id="kobo.2171.1">the namespace:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.2172.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2173.1">Views/MainView.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2174.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.2175.1">Add the following namespace to </span><span class="No-Break"><span class="koboSpan" id="kobo.2176.1">the page:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2177.1">
&lt;ContentPage  xmlns="http://schemas.microsoft.com/dotnet/2021/
maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/
xaml"
  
</span><strong class="bold"><span class="koboSpan" id="kobo.2178.1">  </span></strong><span class="koboSpan" id="kobo.2179.1">
  x:Class="DoToo.Views.MainView" Title="Do Too!&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.2180.1">Add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.2181.1">Resource</span></strong><span class="koboSpan" id="kobo.2182.1"> node to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2183.1">MainView.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2184.1"> file:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.2185.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2186.1">Views/MainView.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2187.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.2188.1">Add the </span><a id="_idIndexMarker320"/><span class="koboSpan" id="kobo.2189.1">following </span><strong class="source-inline"><span class="koboSpan" id="kobo.2190.1">ResourceDictionary</span></strong><span class="koboSpan" id="kobo.2191.1"> element, shown in bold under the root element of the </span><span class="No-Break"><span class="koboSpan" id="kobo.2192.1">XAML file:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2193.1">
&lt;ContentPage ...&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.2194.1">  &lt;ContentPage.Resources&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2195.1">    &lt;ResourceDictionary&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2196.1">        &lt;converters:StatusColorConverter </span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2197.1">x:Key="statusColorConverter"/&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2198.1">    &lt;/ResourceDictionary&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2199.1">  &lt;/ContentPage.Resources&gt;</span></strong><span class="koboSpan" id="kobo.2200.1">
  &lt;ContentPage.ToolBarItems&gt;
    &lt;ToolbarItem Text="Add" Command="{Binding AddItem}" /&gt;
  &lt;/ContentPage.ToolbarItems&gt;
  &lt;Grid ...&gt;
  &lt;/Grid&gt;
&lt;/ContentPage&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.2201.1">This has the same form as the global resource dictionary, but since this one is defined in </span><strong class="source-inline"><span class="koboSpan" id="kobo.2202.1">MainView</span></strong><span class="koboSpan" id="kobo.2203.1">, it can only be accessed from there. </span><span class="koboSpan" id="kobo.2203.2">We could have defined this in the global resource d</span><a id="_idTextAnchor220"/><span class="koboSpan" id="kobo.2204.1">ictionary, but it’s usually more efficient to define objects that you only consume in one place as close to that place </span><span class="No-Break"><span class="koboSpan" id="kobo.2205.1">as possible.</span></span></p>
<p><span class="koboSpan" id="kobo.2206.1">The last step is to add </span><span class="No-Break"><span class="koboSpan" id="kobo.2207.1">the converter:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.2208.1">Locate the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2209.1">BoxView</span></strong><span class="koboSpan" id="kobo.2210.1"> node in the </span><span class="No-Break"><span class="koboSpan" id="kobo.2211.1">XAML file.</span></span></li>
<li><span class="koboSpan" id="kobo.2212.1">Add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2213.1">BackgroundColor</span></strong><span class="koboSpan" id="kobo.2214.1"> XAML, which is marked </span><span class="No-Break"><span class="koboSpan" id="kobo.2215.1">in bold:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2216.1">
&lt;BoxView Grid.RowSpan="2"
</span><strong class="bold"><span class="koboSpan" id="kobo.2217.1">        BackgroundColor="{Binding Item.Completed,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2218.1">        Converter={StaticResource statusColorConverter}}"</span></strong><span class="koboSpan" id="kobo.2219.1"> /&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.2220.1">What we have done here is bind a </span><strong class="source-inline"><span class="koboSpan" id="kobo.2221.1">bool</span></strong><span class="koboSpan" id="kobo.2222.1"> value to a property that takes a </span><strong class="source-inline"><span class="koboSpan" id="kobo.2223.1">Color</span></strong><span class="koboSpan" id="kobo.2224.1"> object. </span><span class="koboSpan" id="kobo.2224.2">Right before the data binding takes pla</span><a id="_idTextAnchor221"/><span class="koboSpan" id="kobo.2225.1">ce, however, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2226.1">ValueConverter</span></strong><span class="koboSpan" id="kobo.2227.1"> converts the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2228.1">bool</span></strong><span class="koboSpan" id="kobo.2229.1"> valu</span><a id="_idTextAnchor222"/><span class="koboSpan" id="kobo.2230.1">e into a</span><a id="_idIndexMarker321"/><span class="koboSpan" id="kobo.2231.1"> color. </span><span class="koboSpan" id="kobo.2231.2">This is just one of the many cases where </span><strong class="source-inline"><span class="koboSpan" id="kobo.2232.1">ValueConverter</span></strong><span class="koboSpan" id="kobo.2233.1"> comes in handy. </span><span class="koboSpan" id="kobo.2233.2">Keep this in mind when you define </span><span class="No-Break"><span class="koboSpan" id="kobo.2234.1">the GUI.</span></span></p>
<h2 id="_idParaDest-61"><a id="_idTextAnchor223"/><span class="koboSpan" id="kobo.2235.1">Navigating to an item using a command</span></h2>
<p><span class="koboSpan" id="kobo.2236.1">We want to be</span><a id="_idIndexMarker322"/><span class="koboSpan" id="kobo.2237.1"> able to see the details for a selected to-do list item. </span><span class="koboSpan" id="kobo.2237.2">When we tap a row, we should navigate to the item in </span><span class="No-Break"><span class="koboSpan" id="kobo.2238.1">that row.</span></span></p>
<p><span class="koboSpan" id="kobo.2239.1">To do this, we need to add the </span><span class="No-Break"><span class="koboSpan" id="kobo.2240.1">following code:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.2241.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2242.1">ViewModels/MainViewModel.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2243.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.2244.1">Add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2245.1">SelectedItem</span></strong><span class="koboSpan" id="kobo.2246.1"> property, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2247.1">OnSelectedItemChanging</span></strong><span class="koboSpan" id="kobo.2248.1"> event handler, and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2249.1">NavigateToItemAsync</span></strong><span class="koboSpan" id="kobo.2250.1"> method to </span><span class="No-Break"><span class="koboSpan" id="kobo.2251.1">the class:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2252.1">
[ObservableProperty]
TodoItemViewModel selectedItem;
partial void OnSelectedItemChanging(TodoItemViewModel value)
{
    if (value == null)
    {
        return;
    }
    MainThread.BeginInvokeOnMainThread(async () =&gt; {
        await NavigateToItemAsync(value);
    });
}
private async Task NavigateToItemAsync(TodoItemViewModel item)
{
    var itemView = services.GetRequiredService&lt;ItemView&gt;();
    var vm = itemView.BindingContext as ItemViewModel;
    vm.Item = item.Item;
    itemView.Title = "Edit todo item";
    await Navigation.PushAsync(itemView);
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.2253.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.2254.1">SelectedItem</span></strong><span class="koboSpan" id="kobo.2255.1"> property is a property that we will data-bind to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2256.1">ListView</span></strong><span class="koboSpan" id="kobo.2257.1">. </span><span class="koboSpan" id="kobo.2257.2">When we select a row in </span><strong class="source-inline"><span class="koboSpan" id="kobo.2258.1">ListView</span></strong><span class="koboSpan" id="kobo.2259.1">, this property is set to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2260.1">TodoItemViewModel</span></strong><span class="koboSpan" id="kobo.2261.1"> object that represents that row. </span><span class="koboSpan" id="kobo.2261.2">We are using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2262.1">ObservableProperty</span></strong><span class="koboSpan" id="kobo.2263.1"> attribute here to carry out its </span><strong class="source-inline"><span class="koboSpan" id="kobo.2264.1">PropertyChanged</span></strong><span class="koboSpan" id="kobo.2265.1"> magic. </span><span class="koboSpan" id="kobo.2265.2">However, since the setter is being generated through the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2266.1">ObservableProperty</span></strong><span class="koboSpan" id="kobo.2267.1"> attribute, there is no place to add additional code to the property. </span><span class="koboSpan" id="kobo.2267.2">Luckily, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2268.1">ObservableProperty</span></strong><span class="koboSpan" id="kobo.2269.1"> source generator also adds two partial methods that can be implemented. </span><span class="koboSpan" id="kobo.2269.2">We are using </span><strong class="source-inline"><span class="koboSpan" id="kobo.2270.1">OnSelectedItemChanging</span></strong><span class="koboSpan" id="kobo.2271.1"> to add additional functionality to the setter. </span><span class="koboSpan" id="kobo.2271.2">The other partial method is </span><strong class="source-inline"><span class="koboSpan" id="kobo.2272.1">OnSelectedItemChanged</span></strong><span class="koboSpan" id="kobo.2273.1">. </span><strong class="source-inline"><span class="koboSpan" id="kobo.2274.1">OnSelectedItemChanging</span></strong><span class="koboSpan" id="kobo.2275.1"> is called before the property value has changed and </span><strong class="source-inline"><span class="koboSpan" id="kobo.2276.1">OnSelectedItemChanged</span></strong><span class="koboSpan" id="kobo.2277.1"> is called after the value has changed. </span><span class="koboSpan" id="kobo.2277.2">Remember that you can always view the generated source to learn more about how these attributes are extending </span><span class="No-Break"><span class="koboSpan" id="kobo.2278.1">your code.</span></span></p>
<p><span class="koboSpan" id="kobo.2279.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.2280.1">OnSelectedItemChanging</span></strong><span class="koboSpan" id="kobo.2281.1"> method then calls </span><strong class="source-inline"><span class="koboSpan" id="kobo.2282.1">NavigateToItem</span></strong><span class="koboSpan" id="kobo.2283.1">, which creates a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.2284.1">ItemView</span></strong><span class="koboSpan" id="kobo.2285.1"> view using the .NET MAUI dependency injection container. </span><span class="koboSpan" id="kobo.2285.2">At this point, we change the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2286.1">Title</span></strong><span class="koboSpan" id="kobo.2287.1"> of the view from </span><strong class="source-inline"><span class="koboSpan" id="kobo.2288.1">"Add todo item"</span></strong><span class="koboSpan" id="kobo.2289.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2290.1">"Edit todo item"</span></strong><span class="koboSpan" id="kobo.2291.1">. </span><span class="koboSpan" id="kobo.2291.2">We extract </span><strong class="source-inline"><span class="koboSpan" id="kobo.2292.1">ViewModel</span></strong><span class="koboSpan" id="kobo.2293.1"> from the newly created </span><strong class="source-inline"><span class="koboSpan" id="kobo.2294.1">ItemView</span></strong><span class="koboSpan" id="kobo.2295.1"> view and assign the current </span><strong class="source-inline"><span class="koboSpan" id="kobo.2296.1">TodoItem</span></strong><span class="koboSpan" id="kobo.2297.1"> object that </span><strong class="source-inline"><span class="koboSpan" id="kobo.2298.1">TodoItemViewModel</span></strong><span class="koboSpan" id="kobo.2299.1"> contains. </span><span class="koboSpan" id="kobo.2299.2">Confused? </span><span class="koboSpan" id="kobo.2299.3">Remember that </span><strong class="source-inline"><span class="koboSpan" id="kobo.2300.1">TodoItemViewModel</span></strong><span class="koboSpan" id="kobo.2301.1"> wraps a </span><strong class="source-inline"><span class="koboSpan" id="kobo.2302.1">TodoItem</span></strong><span class="koboSpan" id="kobo.2303.1"> object, and it is that item that we want to pass </span><span class="No-Break"><span class="koboSpan" id="kobo.2304.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2305.1">ItemView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2306.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.2307.1">We are not </span><a id="_idIndexMarker323"/><span class="koboSpan" id="kobo.2308.1">done yet. </span><span class="koboSpan" id="kobo.2308.2">Now, we need to data-bind the new </span><strong class="source-inline"><span class="koboSpan" id="kobo.2309.1">SelectedItem</span></strong><span class="koboSpan" id="kobo.2310.1"> property to the right place in </span><span class="No-Break"><span class="koboSpan" id="kobo.2311.1">the view:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.2312.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2313.1">Views/MainView.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2314.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.2315.1">Locate </span><strong class="source-inline"><span class="koboSpan" id="kobo.2316.1">ListView</span></strong><span class="koboSpan" id="kobo.2317.1"> and add the attributes </span><span class="No-Break"><span class="koboSpan" id="kobo.2318.1">in bold:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2319.1">
&lt;ListView </span><strong class="bold"><span class="koboSpan" id="kobo.2320.1">x:Name="ItemsListView"</span></strong><span class="koboSpan" id="kobo.2321.1"> Grid.Row="1" RowHeight="70"
    ItemsSource="{Binding Items}"
    </span><strong class="bold"><span class="koboSpan" id="kobo.2322.1">SelectedItem="{Binding SelectedItem}"</span></strong><span class="koboSpan" id="kobo.2323.1">&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.2324.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.2325.1">SelectedItem</span></strong><span class="koboSpan" id="kobo.2326.1"> attribute binds the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2327.1">SelectedItem</span></strong><span class="koboSpan" id="kobo.2328.1"> property’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.2329.1">ListView</span></strong><span class="koboSpan" id="kobo.2330.1"> view to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2331.1">ViewModel</span></strong><span class="koboSpan" id="kobo.2332.1"> property. </span><span class="koboSpan" id="kobo.2332.2">When the selection o</span><a id="_idTextAnchor224"/><span class="koboSpan" id="kobo.2333.1">f an item in </span><strong class="source-inline"><span class="koboSpan" id="kobo.2334.1">ListView</span></strong><span class="koboSpan" id="kobo.2335.1"> changes, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2336.1">ViewModel</span></strong><span class="koboSpan" id="kobo.2337.1"> property’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.2338.1">SelectedItem</span></strong><span class="koboSpan" id="kobo.2339.1"> property is called and we navigate to the new and </span><span class="No-Break"><span class="koboSpan" id="kobo.2340.1">exciting views.</span></span></p>
<p><span class="koboSpan" id="kobo.2341.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.2342.1">x:Name</span></strong><span class="koboSpan" id="kobo.2343.1"> attribute is for naming </span><strong class="source-inline"><span class="koboSpan" id="kobo.2344.1">ListView</span></strong><span class="koboSpan" id="kobo.2345.1"> because we need to make a small and ugly hack to make this work. </span><strong class="source-inline"><span class="koboSpan" id="kobo.2346.1">ListView</span></strong><span class="koboSpan" id="kobo.2347.1"> stays selected after the navigation is done. </span><span class="koboSpan" id="kobo.2347.2">When we navigate back, it cannot be selected again until we select another row. </span><span class="koboSpan" id="kobo.2347.3">To mitigate this, we need to hook up to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2348.1">ItemSelected</span></strong><span class="koboSpan" id="kobo.2349.1"> event of </span><strong class="source-inline"><span class="koboSpan" id="kobo.2350.1">ListView</span></strong><span class="koboSpan" id="kobo.2351.1"> and reset the selected item directly on </span><strong class="source-inline"><span class="koboSpan" id="kobo.2352.1">ListView</span></strong><span class="koboSpan" id="kobo.2353.1">. </span><span class="koboSpan" id="kobo.2353.2">This is not recommended because we shouldn’t have any logic in our views, but sometimes, we have no </span><span class="No-Break"><span class="koboSpan" id="kobo.2354.1">other choice:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.2355.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2356.1">Views/MainView.xaml.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2357.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.2358.1">Add the following code </span><span class="No-Break"><span class="koboSpan" id="kobo.2359.1">in bold:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2360.1">
public MainView(MainViewModel viewmodel)
{
    InitializeComponent();
    viewmodel.Navigation = </span><a id="_idTextAnchor225"/><span class="koboSpan" id="kobo.2361.1">Navigation;
    BindingContext = viewmodel;
</span><strong class="bold"><span class="koboSpan" id="kobo.2362.1">    ItemsListView.ItemSelected += (s, e) =&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2363.1">    </span><a id="_idTextAnchor226"/><span class="koboSpan" id="kobo.2364.1">    ItemsListView.SelectedItem = null;</span></strong><span class="koboSpan" id="kobo.2365.1">
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.2366.1">We should</span><a id="_idIndexMarker324"/><span class="koboSpan" id="kobo.2367.1"> now be able to navigate to an item in the list. </span><span class="koboSpan" id="kobo.2367.2">Next, we will mark it </span><span class="No-Break"><span class="koboSpan" id="kobo.2368.1">as complete.</span></span></p>
<h2 id="_idParaDest-62"><a id="_idTextAnchor227"/><span class="koboSpan" id="kobo.2369.1">Marking an item as complete using a command</span></h2>
<p><span class="koboSpan" id="kobo.2370.1">We need to add a </span><a id="_idIndexMarker325"/><span class="koboSpan" id="kobo.2371.1">functionality that allows us to toggle items between </span><strong class="source-inline"><span class="koboSpan" id="kobo.2372.1">complete</span></strong><span class="koboSpan" id="kobo.2373.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.2374.1">active</span></strong><span class="koboSpan" id="kobo.2375.1">. </span><span class="koboSpan" id="kobo.2375.2">It is possible to navigate to the detailed view of the to-do list item, but this is too much work for a user. </span><span class="koboSpan" id="kobo.2375.3">Instead, we’ll add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.2376.1">ContextAction</span></strong><span class="koboSpan" id="kobo.2377.1"> item to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2378.1">ListView</span></strong><span class="koboSpan" id="kobo.2379.1">. </span><span class="koboSpan" id="kobo.2379.2">In iOS, for example, this is accessed by swiping left on </span><span class="No-Break"><span class="koboSpan" id="kobo.2380.1">a row:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.2381.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2382.1">ViewModel/TodoItemViewModel.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2383.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.2384.1">Add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.2385.1">using</span></strong><span class="koboSpan" id="kobo.2386.1"> statement </span><span class="No-Break"><span class="koboSpan" id="kobo.2387.1">for </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2388.1">CommunityToolkit.Mvvm.Input</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2389.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.2390.1">Add a command to toggle the status of the item and a piece of text that describes </span><span class="No-Break"><span class="koboSpan" id="kobo.2391.1">the status:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2392.1">
[RelayCommand]
void ToggleCompleted()
{
    Item.Completed = !Item.Completed;
    ItemStatusChanged?.Invoke(this, new EventArgs());
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.2393.1">Here, we have added a command for toggling the state of an item. </span><span class="koboSpan" id="kobo.2393.2">When executed, it inverses the current state and raises the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2394.1">ItemStatusChanged</span></strong><span class="koboSpan" id="kobo.2395.1"> event so that subscribers are notified. </span><span class="koboSpan" id="kobo.2395.2">To change the text of the context action button depending on the status, we added a </span><strong class="source-inline"><span class="koboSpan" id="kobo.2396.1">StatusText</span></strong><span class="koboSpan" id="kobo.2397.1"> property. </span><span class="koboSpan" id="kobo.2397.2">This is not recommended practice because we are adding code that only exists because of a specific UI case to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2398.1">ViewModel</span></strong><span class="koboSpan" id="kobo.2399.1">. </span><span class="koboSpan" id="kobo.2399.2">Ideally, this</span><a id="_idIndexMarker326"/><span class="koboSpan" id="kobo.2400.1"> would be handled by the view, perhaps by using </span><strong class="source-inline"><span class="koboSpan" id="kobo.2401.1">ValueConverter</span></strong><span class="koboSpan" id="kobo.2402.1">. </span><span class="koboSpan" id="kobo.2402.2">To save us from having to implement these steps, however, we have left it as a </span><span class="No-Break"><span class="koboSpan" id="kobo.2403.1">string property:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.2404.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2405.1">Views/MainView.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2406.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.2407.1">Locate the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2408.1">ListView.ItemTemplate</span></strong><span class="koboSpan" id="kobo.2409.1"> node and add the following </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2410.1">ViewCell.ContextActions</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2411.1"> node:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2412.1">
&lt;ListView.ItemTemplate&gt;
  &lt;DataTemplate&gt;
    &lt;ViewCell&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.2413.1">      &lt;ViewCell.ContextActions&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2414.1">        &lt;MenuItem Text="{Binding StatusText}" Command="{Binding </span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2415.1">ToggleCompletedCommand}" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2416.1">      &lt;/</span><a id="_idTextAnchor228"/><a id="_idTextAnchor229"/><span class="koboSpan" id="kobo.2417.1">ViewCell.ContextActions&gt;</span></strong><span class="koboSpan" id="kobo.2418.1">
      &lt;Grid Padding="15,10"&gt;
      ...
</span><span class="koboSpan" id="kobo.2418.2">      &lt;/Grid&gt;
    &lt;/ViewCell&gt;
  &lt;/DataTemplate&gt;
&lt;/ListView.ItemTemplate&gt;</span></pre></li> </ol>
<h2 id="_idParaDest-63"><a id="_idTextAnchor230"/><span class="koboSpan" id="kobo.2419.1">Creating the filter toggle function using a command</span></h2>
<p><span class="koboSpan" id="kobo.2420.1">We want to be </span><a id="_idIndexMarker327"/><span class="koboSpan" id="kobo.2421.1">able to toggle</span><a id="_idIndexMarker328"/><span class="koboSpan" id="kobo.2422.1"> between viewing active items only and all the items. </span><span class="koboSpan" id="kobo.2422.2">We will create a simple mechanism to </span><span class="No-Break"><span class="koboSpan" id="kobo.2423.1">do this.</span></span></p>
<p><span class="koboSpan" id="kobo.2424.1">Hook up the changes in </span><strong class="source-inline"><span class="koboSpan" id="kobo.2425.1">MainViewModel</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.2426.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.2427.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.2428.1">ViewModels/MainViewModel.cs</span></strong><span class="koboSpan" id="kobo.2429.1"> and </span><span class="No-Break"><span class="koboSpan" id="kobo.2430.1">locate </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2431.1">ItemStatusChangeMethod</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2432.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.2433.1">Add the implementation to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2434.1">ItemStatusChanged</span></strong><span class="koboSpan" id="kobo.2435.1"> method and a property called </span><strong class="source-inline"><span class="koboSpan" id="kobo.2436.1">ShowAll</span></strong><span class="koboSpan" id="kobo.2437.1"> to control </span><span class="No-Break"><span class="koboSpan" id="kobo.2438.1">the filtering:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2439.1">
private void ItemStatusChanged(object sender, EventArgs e)
{
</span><strong class="bold"><span class="koboSpan" id="kobo.2440.1">    i</span><a id="_idTextAnchor231"/><span class="koboSpan" id="kobo.2441.1">f (sender is TodoItemViewModel item)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2442.1">    {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2443.1">        if (!ShowAll &amp;&amp; item.Item.Completed)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2444.1">        {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2445.1">            Items.Remove(item);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2446.1">        }</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2447.1">        Task.Run(async () =&gt; await repository.UpdateItemAsync(item.Item));</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2448.1">    }</span></strong><span class="koboSpan" id="kobo.2449.1">
}
</span><strong class="bold"><span class="koboSpan" id="kobo.2450.1">[ObservableProperty]</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2451.1">bool showAll;</span></strong></pre></li> </ol>
<p><span class="koboSpan" id="kobo.2452.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.2453.1">ItemStatusChanged</span></strong><span class="koboSpan" id="kobo.2454.1"> event handler is triggered when we use the context action from the previous section. </span><span class="koboSpan" id="kobo.2454.2">Since the sender is always an object, we try to cast it to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2455.1">TodoItemViewModel</span></strong><span class="koboSpan" id="kobo.2456.1">. </span><span class="koboSpan" id="kobo.2456.2">If this is successful, we check whether we can remove it from the list if </span><strong class="source-inline"><span class="koboSpan" id="kobo.2457.1">ShowAll</span></strong><span class="koboSpan" id="kobo.2458.1"> is not </span><strong class="source-inline"><span class="koboSpan" id="kobo.2459.1">true</span></strong><span class="koboSpan" id="kobo.2460.1">. </span><span class="koboSpan" id="kobo.2460.2">This is a small optimization; we could have called </span><strong class="source-inline"><span class="koboSpan" id="kobo.2461.1">LoadData</span></strong><span class="koboSpan" id="kobo.2462.1"> and reloaded the entire list, but since the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2463.1">Items</span></strong><span class="koboSpan" id="kobo.2464.1"> list is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2465.1">ObservableCollection</span></strong><span class="koboSpan" id="kobo.2466.1">, it communicates to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2467.1">ListView</span></strong><span class="koboSpan" id="kobo.2468.1"> that one item has been removed from the list. </span><span class="koboSpan" id="kobo.2468.2">We also call the repository to update the item to persist the change </span><span class="No-Break"><span class="koboSpan" id="kobo.2469.1">of status.</span></span></p>
<p><span class="koboSpan" id="kobo.2470.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.2471.1">ShowAll</span></strong><span class="koboSpan" id="kobo.2472.1"> property is what controls which state our filter is in. </span><span class="koboSpan" id="kobo.2472.2">We need to adjust the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2473.1">LoadData</span></strong><span class="koboSpan" id="kobo.2474.1"> method to </span><span class="No-Break"><span class="koboSpan" id="kobo.2475.1">reflect this:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.2476.1">Locate the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2477.1">Load</span></strong><span class="koboSpan" id="kobo.2478.1"> method </span><span class="No-Break"><span class="koboSpan" id="kobo.2479.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2480.1">MainViewModel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2481.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.2482.1">Add the</span><a id="_idIndexMarker329"/><span class="koboSpan" id="kobo.2483.1"> following</span><a id="_idIndexMarker330"/><span class="koboSpan" id="kobo.2484.1"> lines of code marked </span><span class="No-Break"><span class="koboSpan" id="kobo.2485.1">in bold:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2486.1">
private async Task LoadDataAsync()
{
    var items = await repository.GetItemsAsync();
</span><strong class="bold"><span class="koboSpan" id="kobo.2487.1">    if (!ShowAll)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2488.1">    {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2489.1">        items = items.Where(x =&gt; x.Completed == false).ToList();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2490.1">    }</span></strong><span class="koboSpan" id="kobo.2491.1">
    var itemViewModels = items.Select(i =&gt; 
CreateTodoItemViewModel(i));
    Items = new ObservableCollection&lt;TodoItemViewModel&gt; (itemViewModels);
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.2492.1">If </span><strong class="source-inline"><span class="koboSpan" id="kobo.2493.1">ShowAll</span></strong><span class="koboSpan" id="kobo.2494.1"> is </span><strong class="source-inline"><span class="koboSpan" id="kobo.2495.1">false</span></strong><span class="koboSpan" id="kobo.2496.1">, we limit the content of the list to the items that have not been completed. </span><span class="koboSpan" id="kobo.2496.2">We can do this either by having two methods, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2497.1">GetAllItems()</span></strong><span class="koboSpan" id="kobo.2498.1"> and</span><a id="_idTextAnchor232"/> <strong class="source-inline"><span class="koboSpan" id="kobo.2499.1">GetActiveItems()</span></strong><span class="koboSpan" id="kobo.2500.1">, or by using a </span><strong class="source-inline"><span class="koboSpan" id="kobo.2501.1">filter</span></strong><span class="koboSpan" id="kobo.2502.1"> argument that can pass to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2503.1">GetItemsAsync()</span></strong><span class="koboSpan" id="kobo.2504.1">. </span><span class="koboSpan" id="kobo.2504.2">Take a minute to think about how we could </span><span class="No-Break"><span class="koboSpan" id="kobo.2505.1">implement this.</span></span></p>
<p><span class="koboSpan" id="kobo.2506.1">Let’s add the code that toggles </span><span class="No-Break"><span class="koboSpan" id="kobo.2507.1">the filter:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.2508.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2509.1">ViewModels/MainViewModel.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2510.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.2511.1">Add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2512.1">FilterText</span></strong><span class="koboSpan" id="kobo.2513.1"> and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2514.1">ToggleFilterAsync</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2515.1"> properties:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2516.1">
[RelayCommand]
private async Task ToggleFilterAsync()
{
    ShowAll = !ShowAll;
    await LoadDataAsync();
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.2517.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.2518.1">ShowAll</span></strong><span class="koboSpan" id="kobo.2519.1"> property is a Boolean value, and that does not display well in a human-readable form. </span><span class="koboSpan" id="kobo.2519.2">We </span><a id="_idIndexMarker331"/><span class="koboSpan" id="kobo.2520.1">will use </span><a id="_idIndexMarker332"/><span class="koboSpan" id="kobo.2521.1">another </span><strong class="source-inline"><span class="koboSpan" id="kobo.2522.1">ValueConverter</span></strong><span class="koboSpan" id="kobo.2523.1"> to change the status into a </span><span class="No-Break"><span class="koboSpan" id="kobo.2524.1">human-readable form:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.2525.1">Create a new class in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2526.1">Converters</span></strong><span class="koboSpan" id="kobo.2527.1"> folder </span><span class="No-Break"><span class="koboSpan" id="kobo.2528.1">named </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2529.1">FilterTextConverter.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2530.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.2531.1">Add the </span><span class="No-Break"><span class="koboSpan" id="kobo.2532.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2533.1">
using System;
using System.Globalization;
internal class FilterTextConverter : IValueConverter
{
    public object Convert(object value, Type targetType, object 
parameter, CultureInfo culture)
    {
        return (bool)value ? </span><span class="koboSpan" id="kobo.2533.2">"All" : "Active";
    }
    public object ConvertBack(object value, Type targetType, 
object parameter, CultureInfo culture)
    {
        return null;
    }
}</span></pre></li> </ol>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.2534.1">FilterTextConverter</span></strong><span class="koboSpan" id="kobo.2535.1"> is very similar to the previous converter we created. </span><span class="koboSpan" id="kobo.2535.2">The difference is that in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2536.1">Convert</span></strong><span class="koboSpan" id="kobo.2537.1"> method, we convert a </span><strong class="source-inline"><span class="koboSpan" id="kobo.2538.1">bool</span></strong><span class="koboSpan" id="kobo.2539.1"> value into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2540.1">"All"</span></strong><span class="koboSpan" id="kobo.2541.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.2542.1">"Active"</span></strong><span class="koboSpan" id="kobo.2543.1"> string. </span><span class="koboSpan" id="kobo.2543.2">This converter will be used in the view to change the value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.2544.1">ShowAll</span></strong><span class="koboSpan" id="kobo.2545.1"> into a value more suitable for display in the </span><span class="No-Break"><span class="koboSpan" id="kobo.2546.1">user interface.</span></span></p>
<p><span class="koboSpan" id="kobo.2547.1">The logic for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2548.1">ToggleFilterAsync</span></strong><span class="koboSpan" id="kobo.2549.1"> command is a simple inversion of the state and then a call to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2550.1">LoadDataAsync</span></strong><span class="koboSpan" id="kobo.2551.1">. </span><span class="koboSpan" id="kobo.2551.2">This, in turn, causes the list to </span><span class="No-Break"><span class="koboSpan" id="kobo.2552.1">be reloaded.</span></span></p>
<p><span class="koboSpan" id="kobo.2553.1">Before we can </span><a id="_idIndexMarker333"/><span class="koboSpan" id="kobo.2554.1">filter the items, we </span><a id="_idIndexMarker334"/><span class="koboSpan" id="kobo.2555.1">need to hook up the filter button to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2556.1">Command</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.2557.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2558.1">Converter</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2559.1">:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.2560.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2561.1">Views/MainView.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2562.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.2563.1">Add the following highlighted entry </span><span class="No-Break"><span class="koboSpan" id="kobo.2564.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2565.1">ResourceDictionary</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2566.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2567.1">
&lt;ResourceDictionary&gt;
    &lt;converters:StatusColorConverter  x:Key=
"statusColorConverter"/&gt;
    </span><strong class="bold"><span class="koboSpan" id="kobo.2568.1">&lt;converters:FilterTextConverter </span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2569.1">x:Key="filterTextConverter"/&gt;</span></strong><span class="koboSpan" id="kobo.2570.1">
&lt;/ResourceDictionary&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.2571.1">Locate the button that controls the filter (the only button in </span><span class="No-Break"><span class="koboSpan" id="kobo.2572.1">the file).</span></span></li>
<li><span class="koboSpan" id="kobo.2573.1">Adjust your code to reflect the </span><span class="No-Break"><span class="koboSpan" id="kobo.2574.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2575.1">
&lt;Button </span><strong class="bold"><span class="koboSpan" id="kobo.2576.1">Text="{Binding ShowAll,Converter={StaticResource </span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2577.1">filterTextConverter}, StringFormat='Filter: {0}'}</span><a id="_idTextAnchor233"/><span class="koboSpan" id="kobo.2578.1">"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2579.1">    Command="{Binding ToggleFilter</span><a id="_idTextAnchor234"/><span class="koboSpan" id="kobo.2580.1">AsyncCommand}"</span></strong><span class="koboSpan" id="kobo.2581.1"> /&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.2582.1">We have now finished with this feature! </span><span class="koboSpan" id="kobo.2582.2">However, our app isn’t very attractive; we’ll deal with</span><a id="_idIndexMarker335"/><span class="koboSpan" id="kobo.2583.1"> this</span><a id="_idIndexMarker336"/><span class="koboSpan" id="kobo.2584.1"> in the </span><span class="No-Break"><span class="koboSpan" id="kobo.2585.1">following section.</span></span></p>
<h1 id="_idParaDest-64"><a id="_idTextAnchor235"/><span class="koboSpan" id="kobo.2586.1">Laying out the contents</span></h1>
<p><span class="koboSpan" id="kobo.2587.1">This last section is </span><a id="_idIndexMarker337"/><span class="koboSpan" id="kobo.2588.1">about making</span><a id="_idTextAnchor236"/><a id="_idTextAnchor237"/><a id="_idTextAnchor238"/><span class="koboSpan" id="kobo.2589.1"> the app look a bit nicer. </span><span class="koboSpan" id="kobo.2589.2">We will just scratch the surface of the possibilities here, but this should give you some ideas about how </span><span class="No-Break"><span class="koboSpan" id="kobo.2590.1">styling works.</span></span></p>
<h2 id="_idParaDest-65"><a id="_idTextAnchor239"/><span class="koboSpan" id="kobo.2591.1">Setting an application-wide background color</span></h2>
<p><span class="koboSpan" id="kobo.2592.1">Styles are a great</span><a id="_idIndexMarker338"/><span class="koboSpan" id="kobo.2593.1"> way of applying</span><a id="_idIndexMarker339"/><span class="koboSpan" id="kobo.2594.1"> styling to elements. </span><span class="koboSpan" id="kobo.2594.2">They can be applied either to all elements of a type or the elements referenced by a key if you add an </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2595.1">x:Key</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2596.1"> attribute:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.2597.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2598.1">App.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2599.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.2600.1">Add the following XAML, which is in bold, to </span><span class="No-Break"><span class="koboSpan" id="kobo.2601.1">the file:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2602.1">
&lt;ResourceDictionary&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.2603.1">  &lt;Style TargetType="NavigationPage"&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2604.1">    &lt;Setter Property="BarBackgroundColor" Value="#A25EBB" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2605.1">    &lt;Setter Property="BarTextColor" Value="#FFFFFF" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2606.1">  &lt;/Style&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2607.1">  &lt;Style x:Key="FilterButton" TargetType="Button"&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2608.1">    &lt;Setter Property="Margin" Value="15" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2609.1">    &lt;Setter Property="BorderWidth" Value="1" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2610.1">    &lt;Setter Property="BorderColor" Value="Silver" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2611.1">    &lt;Setter Property="TextColor" Value="Black" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2612.1">  &lt;/Style&gt;</span></strong><span class="koboSpan" id="kobo.2613.1">
  &lt;Color x:Key="CompletedColor"&gt;#1C8859&lt;/Color&gt;
  &lt;Color x:Key="ActiveColor"&gt;#D3D3D3&lt;/Color&gt;
&lt;/ResourceDictionary&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.2614.1">The first style we will apply is a new background color and text color to the navigation bar. </span><span class="koboSpan" id="kobo.2614.2">The second style will be applied to the filter button. </span><span class="koboSpan" id="kobo.2614.3">We can define a style by setting </span><strong class="source-inline"><span class="koboSpan" id="kobo.2615.1">TargetType</span></strong><span class="koboSpan" id="kobo.2616.1">, which tells .NET MAUI which type of object this style can be applied to. </span><span class="koboSpan" id="kobo.2616.2">We can then add one or more properties that we want to set. </span><span class="koboSpan" id="kobo.2616.3">The result will be the same as if we had added these properties directly to the element in the </span><span class="No-Break"><span class="koboSpan" id="kobo.2617.1">XAML code.</span></span></p>
<p><span class="koboSpan" id="kobo.2618.1">Styles that lack the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2619.1">x:Key</span><a id="_idTextAnchor240"/></strong><span class="koboSpan" id="kobo.2620.1"> attribute are applied to all instances of the type defined in </span><strong class="source-inline"><span class="koboSpan" id="kobo.2621.1">TargetType</span></strong><span class="koboSpan" id="kobo.2622.1">. </span><span class="koboSpan" id="kobo.2622.2">Styles that have a </span><a id="_idTextAnchor241"/><span class="koboSpan" id="kobo.2623.1">key must be explicitly assigned in the XAML of the user interface. </span><span class="koboSpan" id="kobo.2623.2">We will</span><a id="_idIndexMarker340"/><span class="koboSpan" id="kobo.2624.1"> see examples </span><a id="_idIndexMarker341"/><span class="koboSpan" id="kobo.2625.1">of this when we define the filter button in the </span><span class="No-Break"><span class="koboSpan" id="kobo.2626.1">next section.</span></span></p>
<h2 id="_idParaDest-66"><a id="_idTextAnchor242"/><span class="koboSpan" id="kobo.2627.1">Laying out the MainView and ListView items</span></h2>
<p><span class="koboSpan" id="kobo.2628.1">In this section, we </span><a id="_idIndexMarker342"/><span class="koboSpan" id="kobo.2629.1">will imp</span><a id="_idTextAnchor243"/><a id="_idTextAnchor244"/><a id="_idTextAnchor245"/><span class="koboSpan" id="kobo.2630.1">rove the appearance</span><a id="_idIndexMarker343"/><span class="koboSpan" id="kobo.2631.1"> of </span><strong class="source-inline"><span class="koboSpan" id="kobo.2632.1">MainView</span></strong><span class="koboSpan" id="kobo.2633.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.2634.1">ListView</span></strong><span class="koboSpan" id="kobo.2635.1">. </span><span class="koboSpan" id="kobo.2635.2">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.2636.1">Views/MainView.xaml</span></strong><span class="koboSpan" id="kobo.2637.1"> and</span><a id="_idIndexMarker344"/><span class="koboSpan" id="kobo.2638.1"> apply the</span><a id="_idIndexMarker345"/><span class="koboSpan" id="kobo.2639.1"> changes in bold in the XAML code in each of the </span><span class="No-Break"><span class="koboSpan" id="kobo.2640.1">following sections.</span></span></p>
<h3><span class="koboSpan" id="kobo.2641.1">The ﬁlter button</span></h3>
<p><span class="koboSpan" id="kobo.2642.1">The filter button</span><a id="_idIndexMarker346"/><span class="koboSpan" id="kobo.2643.1"> allows us to toggle the state of the list to show only the active to-do items or all the to-do items. </span><span class="koboSpan" id="kobo.2643.2">Let’s style it to make it stand out a bit in </span><span class="No-Break"><span class="koboSpan" id="kobo.2644.1">the layout:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.2645.1">Find the </span><span class="No-Break"><span class="koboSpan" id="kobo.2646.1">filter button.</span></span></li>
<li><span class="koboSpan" id="kobo.2647.1">Make the </span><span class="No-Break"><span class="koboSpan" id="kobo.2648.1">following changes:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2649.1">
&lt;Button </span><strong class="bold"><span class="koboSpan" id="kobo.2650.1">Style="{DynamicResource FilterButton}"</span></strong><span class="koboSpan" id="kobo.2651.1">
        Text="{Binding ShowAll,Converter={StaticResource 
filterTextConverter}, StringFormat='Filter: {0}'}"
        </span><strong class="bold"><span class="koboSpan" id="kobo.2652.1">BackgroundColor="{DynamicResource ActiveColor}"</span></strong><span class="koboSpan" id="kobo.2653.1">
        </span><strong class="bold"><span class="koboSpan" id="kobo.2654.1">TextColor="Black"</span></strong><span class="koboSpan" id="kobo.2655.1">
        Command="{Binding ToggleFilterCommand}"&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.2656.1">  &lt;Button.Triggers&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2657.1">    &lt;DataTrigger TargetType="Button" Binding="{Binding ShowAll}" </span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2658.1">Value="True"&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2659.1">      &lt;Setter Property="BackgroundColor" Value="{DynamicResource </span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2660.1">CompletedColor}" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2661.1">      &lt;Setter Property="TextColor" Value="White" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2662.1">    &lt;/DataTrigger&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2663.1">  &lt;/Button.Triggers&gt;</span></strong><span class="koboSpan" id="kobo.2664.1">
&lt;/Button&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.2665.1">The style is applied </span><a id="_idIndexMarker347"/><span class="koboSpan" id="kobo.2666.1">using </span><strong class="source-inline"><span class="koboSpan" id="kobo.2667.1">DynamicResource</span></strong><span class="koboSpan" id="kobo.2668.1">. </span><span class="koboSpan" id="kobo.2668.2">Anything defined in a resource dictionary, either in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2669.1">App.xaml</span></strong><span class="koboSpan" id="kobo.2670.1"> file or in the local XAML file, is accessible through it. </span><span class="koboSpan" id="kobo.2670.2">Then, we set </span><strong class="source-inline"><span class="koboSpan" id="kobo.2671.1">BackgroundColor</span></strong><span class="koboSpan" id="kobo.2672.1">, again setting </span><strong class="source-inline"><span class="koboSpan" id="kobo.2673.1">DynamicResource</span></strong><span class="koboSpan" id="kobo.2674.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2675.1">ActiveColor</span></strong><span class="koboSpan" id="kobo.2676.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.2677.1">TextColor</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.2678.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2679.1">Black</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2680.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.2681.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.2682.1">Button.Triggers</span></strong><span class="koboSpan" id="kobo.2683.1"> node is a useful feature. </span><span class="koboSpan" id="kobo.2683.2">We can define several types of triggers that fire when certain criteria are met. </span><span class="koboSpan" id="kobo.2683.3">In this case, we use a data trigger that checks whether the value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.2684.1">ShowAll</span></strong><span class="koboSpan" id="kobo.2685.1"> changes to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2686.1">true</span></strong><span class="koboSpan" id="kobo.2687.1">. </span><span class="koboSpan" id="kobo.2687.2">If it do</span><a id="_idTextAnchor246"/><span class="koboSpan" id="kobo.2688.1">es, we set </span><strong class="source-inline"><span class="koboSpan" id="kobo.2689.1">TextColor</span></strong> <a id="_idTextAnchor247"/><span class="koboSpan" id="kobo.2690.1">to white </span><a id="_idIndexMarker348"/><span class="koboSpan" id="kobo.2691.1">and </span><strong class="source-inline"><span class="koboSpan" id="kobo.2692.1">BackgroundColor</span></strong><span class="koboSpan" id="kobo.2693.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2694.1">CompletedColor</span></strong><span class="koboSpan" id="kobo.2695.1">. </span><span class="koboSpan" id="kobo.2695.2">The coolest part is that when </span><strong class="source-inline"><span class="koboSpan" id="kobo.2696.1">ShowAll</span></strong><span class="koboSpan" id="kobo.2697.1"> becomes </span><strong class="source-inline"><span class="koboSpan" id="kobo.2698.1">false</span></strong><span class="koboSpan" id="kobo.2699.1"> again, it switches back to whichever value it </span><span class="No-Break"><span class="koboSpan" id="kobo.2700.1">was before.</span></span></p>
<h3><span class="koboSpan" id="kobo.2701.1">Touching up ListView</span></h3>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.2702.1">ListView</span></strong><span class="koboSpan" id="kobo.2703.1"> could use a </span><a id="_idIndexMarker349"/><span class="koboSpan" id="kobo.2704.1">couple of minor changes. </span><span class="koboSpan" id="kobo.2704.2">The first change is formatting the due date string to a more human-readable format and the second is changing the color of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2705.1">Completed</span></strong><span class="koboSpan" id="kobo.2706.1"> label to a nice </span><span class="No-Break"><span class="koboSpan" id="kobo.2707.1">green tint:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.2708.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2709.1">Views/MainView.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2710.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.2711.1">Locate the labels that bind </span><strong class="source-inline"><span class="koboSpan" id="kobo.2712.1">Item.Due</span></strong><span class="koboSpan" id="kobo.2713.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.2714.1">Item.Completed</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.2715.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2716.1">ListView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2717.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2718.1">
&lt;Label Grid.Column="1" Grid.Row="1"
      Text="</span><strong class="bold"><span class="koboSpan" id="kobo.2719.1">{Binding Item.Due, StringFormat='{0:MMMM d, yyyy}'}</span></strong><span class="koboSpan" id="kobo.2720.1">"
      FontSize="Micro" /&gt;
&lt;Label Grid.Column="1" Grid.Row="1"
      HorizontalTextAlignment="End"
      Text="Completed"
      IsVisible="{Binding Item.Completed}"
      FontSize="Micro"
      </span><strong class="bold"><span class="koboSpan" id="kobo.2721.1">TextColor="{StaticResource CompletedColor}</span></strong><span class="koboSpan" id="kobo.2722.1">" /&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.2723.1">Here, we added a formatting string to the binding to format the date using a specific format. </span><span class="koboSpan" id="kobo.2723.2">In this case, we used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2724.1">0:MMMM d, yyyy</span></strong><span class="koboSpan" id="kobo.2725.1"> format, which will display the date as a string in the format of, for example, May </span><span class="No-Break"><span class="koboSpan" id="kobo.2726.1">5, 2020.</span></span></p>
<p><span class="koboSpan" id="kobo.2727.1">We also added a text color to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2728.1">Completed</span></strong><span class="koboSpan" id="kobo.2729.1"> label that is only visible if an item is completed. </span><span class="koboSpan" id="kobo.2729.2">We did this by referencing our dictionary </span><span class="No-Break"><span class="koboSpan" id="kobo.2730.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2731.1">App.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2732.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.2733.1">Now that all the code</span><a id="_idTextAnchor248"/><span class="koboSpan" id="kobo.2734.1"> changes are complete, run our application. </span><span class="koboSpan" id="kobo.2734.2">Here is a small gallery of screenshots that should match </span><span class="No-Break"><span class="koboSpan" id="kobo.2735.1">your application:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer050">
<span class="koboSpan" id="kobo.2736.1"><img alt="Figure 2.15 – DoToo on Android" src="image/Figure_2.15_B19214.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.2737.1">Figure 2.15 – DoToo on Android</span></p>
<h1 id="_idParaDest-67"><a id="_idTextAnchor249"/><span class="koboSpan" id="kobo.2738.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.2739.1">You should now have a good grasp of all the steps involved in creating a .NET MAUI app from scratch. </span><span class="koboSpan" id="kobo.2739.2">In this chapter, we learned about the project structure and the important files in a newly created project. </span><span class="koboSpan" id="kobo.2739.3">We talked about dependency injection and learned the basics of MVVM by creating all the views and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2740.1">ViewModel</span></strong><span class="koboSpan" id="kobo.2741.1"> classes needed. </span><span class="koboSpan" id="kobo.2741.2">We also covered data storage in SQLite to persist data on our device in a fast and secure way. </span><span class="koboSpan" id="kobo.2741.3">Using the knowledge you’ve gained from this chapter, you should now be able to create the backbone of any app </span><span class="No-Break"><span class="koboSpan" id="kobo.2742.1">you’d like.</span></span></p>
<p><span class="koboSpan" id="kobo.2743.1">The next chapter will focus on upgrading an existing Xamarin.Forms application to .</span><span class="No-Break"><span class="koboSpan" id="kobo.2744.1">NET MAUI.</span></span></p>
</div>
</body></html>