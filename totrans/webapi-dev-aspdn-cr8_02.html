<html><head></head><body>
<div id="_idContainer027">
<h1 class="chapter-number" id="_idParaDest-37"><a id="_idTextAnchor068"/><span class="koboSpan" id="kobo.1.1">2</span></h1>
<h1 id="_idParaDest-38"><a id="_idTextAnchor069"/><span class="koboSpan" id="kobo.2.1">Getting Started with ASP.NET Core Web APIs</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.3.1">ASP.NET Core</span></strong><span class="koboSpan" id="kobo.4.1"> is a </span><a id="_idIndexMarker119"/><span class="koboSpan" id="kobo.5.1">cross-platform, open-source web application framework for building modern, cloud-enabled web applications and APIs. </span><span class="koboSpan" id="kobo.5.2">It is primarily used with the C# programming language. </span><span class="koboSpan" id="kobo.5.3">ASP.NET Core provides features to help you build web apps in various ways – for example, through ASP.NET MVC, web APIs, Razor Pages, Blazor, and so on. </span><span class="koboSpan" id="kobo.5.4">This book will mainly cover web APIs. </span><span class="koboSpan" id="kobo.5.5">In this chapter, we will learn how to build a simple REST web API with </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">ASP.NET Core.</span></span></p>
<p><span class="koboSpan" id="kobo.7.1">In this chapter, we’ll be covering the </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.9.1">Setting up the </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">development environment</span></span></li>
<li><span class="koboSpan" id="kobo.11.1">Creating a simple REST web </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">API project</span></span></li>
<li><span class="koboSpan" id="kobo.13.1">Building and running </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">the project</span></span></li>
<li><span class="koboSpan" id="kobo.15.1">Understanding the </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">MVC pattern</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.17.1">Dependency </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.18.1">injection</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.19.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.20.1">DI</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.22.1">Introduction to </span><span class="No-Break"><span class="koboSpan" id="kobo.23.1">minimal APIs</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.24.1">This chapter will provide you with the necessary information to create a basic REST web API project with ASP.NET Core. </span><span class="koboSpan" id="kobo.24.2">By the end of this chapter, you should have a better understanding of the steps required to create your first ASP.NET Core web </span><span class="No-Break"><span class="koboSpan" id="kobo.25.1">API project.</span></span></p>
<h1 id="_idParaDest-39"><a id="_idTextAnchor070"/><span class="koboSpan" id="kobo.26.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.27.1">You are expected to know the basic concepts of </span><strong class="bold"><span class="koboSpan" id="kobo.28.1">.NET Framework</span></strong><span class="koboSpan" id="kobo.29.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.30.1">.NET Core</span></strong><span class="koboSpan" id="kobo.31.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.32.1">object-oriented programming</span></strong><span class="koboSpan" id="kobo.33.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.34.1">OOP</span></strong><span class="koboSpan" id="kobo.35.1">). </span><span class="koboSpan" id="kobo.35.2">You should also have a basic understanding of the </span><strong class="bold"><span class="koboSpan" id="kobo.36.1">C#</span></strong><span class="koboSpan" id="kobo.37.1"> programming language. </span><span class="koboSpan" id="kobo.37.2">If you are not familiar with these concepts, you can refer to the </span><span class="No-Break"><span class="koboSpan" id="kobo.38.1">following resources:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.39.1">.NET </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.40.1">fundamentals</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.41.1">: </span></span><a href="https://learn.microsoft.com/en-us/dotnet/fundamentals/"><span class="No-Break"><span class="koboSpan" id="kobo.42.1">https://learn.microsoft.com/en-us/dotnet/fundamentals/</span></span></a></li>
<li><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.43.1">C#</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.44.1">: </span></span><a href="https://learn.microsoft.com/en-us/dotnet/csharp/"><span class="No-Break"><span class="koboSpan" id="kobo.45.1">https://learn.microsoft.com/en-us/dotnet/csharp/</span></span></a></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.46.1">OOP (</span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.47.1">C#)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.48.1">: </span></span><a href="https://learn.microsoft.com/en-us/dotnet/csharp/fundamentals/tutorials/oop"><span class="No-Break"><span class="koboSpan" id="kobo.49.1">https://learn.microsoft.com/en-us/dotnet/csharp/fundamentals/tutorials/oop</span></span></a></li>
</ul>
<p><span class="koboSpan" id="kobo.50.1">The code examples in this chapter can be found at  </span><a href="https://github.com/PacktPublishing/Web-API-Development-with-ASP.NET-Core-8/tree/main/samples/chapter2"><span class="No-Break"><span class="koboSpan" id="kobo.51.1">https://github.com/PacktPublishing/Web-API-Development-with-ASP.NET-Core-8/tree/main/samples/chapter2</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.52.1">.</span></span><a id="_idTextAnchor071"/></p>
<h1 id="_idParaDest-40"><a id="_idTextAnchor072"/><span class="koboSpan" id="kobo.53.1">Setting up the development environment</span></h1>
<p><span class="koboSpan" id="kobo.54.1">.NET Core is </span><a id="_idIndexMarker120"/><span class="koboSpan" id="kobo.55.1">fully cross-platform and can run on Windows, Linux, and macOS, so you can use any of these platforms to develop ASP.NET Core applications. </span><span class="koboSpan" id="kobo.55.2">The code samples in this book are written on Windows 11. </span><span class="koboSpan" id="kobo.55.3">However, you can run the same code on Linux </span><span class="No-Break"><span class="koboSpan" id="kobo.56.1">and macOS.</span></span></p>
<p><span class="koboSpan" id="kobo.57.1">There are also several IDEs available for ASP.NET Core, such as Visual Studio, </span><strong class="bold"><span class="koboSpan" id="kobo.58.1">Visual Studio Code</span></strong><span class="koboSpan" id="kobo.59.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.60.1">VS Code</span></strong><span class="koboSpan" id="kobo.61.1">), Visual Studio </span><a id="_idIndexMarker121"/><span class="koboSpan" id="kobo.62.1">for Mac, and Rider. </span><span class="koboSpan" id="kobo.62.2">In this book, we will mainly use </span><span class="No-Break"><span class="koboSpan" id="kobo.63.1">VS Code.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.64.1">Why not Visual Studio?</span></p>
<p class="callout"><span class="koboSpan" id="kobo.65.1">Visual Studio is a powerful IDE for the .NET platform. </span><span class="koboSpan" id="kobo.65.2">It provides a bunch of tools and features to elevate and enhance every stage of software development. </span><span class="koboSpan" id="kobo.65.3">However, VS Code is more lightweight and is open-source and cross-platform. </span><span class="koboSpan" id="kobo.65.4">We will use VS Code to understand the concepts of ASP.NET Core, then migrate to Visual Studio to use its rich features. </span><span class="koboSpan" id="kobo.65.5">If you are familiar with Visual Studio or any other IDE, feel free to </span><span class="No-Break"><span class="koboSpan" id="kobo.66.1">use it.</span></span></p>
<p><span class="koboSpan" id="kobo.67.1">Here is a list of </span><a id="_idIndexMarker122"/><span class="koboSpan" id="kobo.68.1">software, SDKs, and </span><a id="_idIndexMarker123"/><span class="koboSpan" id="kobo.69.1">tools you need </span><span class="No-Break"><span class="koboSpan" id="kobo.70.1">to install:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.71.1">VS </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.72.1">Code</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.73.1">: </span></span><a href="https://code.visualstudio.com/download"><span class="No-Break"><span class="koboSpan" id="kobo.74.1">https://code.visualstudio.com/download</span></span></a></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.75.1">.NET 8 </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.76.1">SDK</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.77.1">: </span></span><a href="https://dotnet.microsoft.com/en-us/download"><span class="No-Break"><span class="koboSpan" id="kobo.78.1">https://dotnet.microsoft.com/en-us/download</span></span></a></li>
</ul>
<p><span class="koboSpan" id="kobo.79.1">Both VS Code and the .NET 8 SDK are cross-platform, so please choose the correct one for your OS. </span><span class="koboSpan" id="kobo.79.2">When you install VS Code, please make sure you check the </span><strong class="bold"><span class="koboSpan" id="kobo.80.1">Add to </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.81.1">PATH</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.82.1"> option.</span></span></p>
<p><span class="koboSpan" id="kobo.83.1">If you use Windows, you may want to</span><a id="_idIndexMarker124"/><span class="koboSpan" id="kobo.84.1"> install </span><strong class="bold"><span class="koboSpan" id="kobo.85.1">Windows Terminal</span></strong><span class="koboSpan" id="kobo.86.1"> to run the command line. </span><span class="koboSpan" id="kobo.86.2">Windows Terminal is available for Windows 10 and above, and it provides a better user experience. </span><span class="koboSpan" id="kobo.86.3">But it is optional because you can also use the command </span><span class="No-Break"><span class="koboSpan" id="kobo.87.1">line dire</span><a id="_idTextAnchor073"/><span class="koboSpan" id="kobo.88.1">ctly.</span></span></p>
<h2 id="_idParaDest-41"><a id="_idTextAnchor074"/><span class="koboSpan" id="kobo.89.1">Configuring VS Code</span></h2>
<p><span class="koboSpan" id="kobo.90.1">Strictly </span><a id="_idIndexMarker125"/><span class="koboSpan" id="kobo.91.1">speaking, VS Code is a code editor. </span><span class="koboSpan" id="kobo.91.2">It </span><a id="_idIndexMarker126"/><span class="koboSpan" id="kobo.92.1">cannot recognize all the coding languages. </span><span class="koboSpan" id="kobo.92.2">Therefore, you’ll need to install some extensions to support your development workflow. </span><span class="koboSpan" id="kobo.92.3">You can browse and install extensions by clicking on the </span><strong class="bold"><span class="koboSpan" id="kobo.93.1">Extensions</span></strong><span class="koboSpan" id="kobo.94.1"> icon in the </span><strong class="bold"><span class="koboSpan" id="kobo.95.1">Activity</span></strong><span class="koboSpan" id="kobo.96.1"> bar on the left-hand side of the VS Code interface. </span><span class="koboSpan" id="kobo.96.2">Then, you will see a list of the most popular extensions on the VS </span><span class="No-Break"><span class="koboSpan" id="kobo.97.1">Code Marketplace:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer007">
<span class="koboSpan" id="kobo.98.1"><img alt="Figure 2.1 – The C# Dev Kit extension for VS Code" src="image/B18971_02_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.99.1">Figure 2.1 – Overview of the C# Dev Kit extension for VS Code</span></p>
<p><span class="koboSpan" id="kobo.100.1">You need to install this extension to support .</span><span class="No-Break"><span class="koboSpan" id="kobo.101.1">NET development:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.102.1">C# Dev Kit</span></strong><span class="koboSpan" id="kobo.103.1">: This is </span><a id="_idIndexMarker127"/><span class="koboSpan" id="kobo.104.1">the official C# extension for VS Code provided by Microsoft. </span><span class="koboSpan" id="kobo.104.2">When you install C# Dev Kit, the following extensions will automatically </span><span class="No-Break"><span class="koboSpan" id="kobo.105.1">be installed:</span></span><ul><li><strong class="bold"><span class="koboSpan" id="kobo.106.1">C# extension</span></strong><span class="koboSpan" id="kobo.107.1">: This</span><a id="_idIndexMarker128"/><span class="koboSpan" id="kobo.108.1"> extension provides C# language support powered </span><span class="No-Break"><span class="koboSpan" id="kobo.109.1">by OmniSharp</span></span></li><li><strong class="bold"><span class="koboSpan" id="kobo.110.1">IntelliCode for C# Dev Kit</span></strong><span class="koboSpan" id="kobo.111.1">: This</span><a id="_idIndexMarker129"/><span class="koboSpan" id="kobo.112.1"> extension provides AI-assisted IntelliSense </span><span class="No-Break"><span class="koboSpan" id="kobo.113.1">for C#</span></span></li><li><strong class="bold"><span class="koboSpan" id="kobo.114.1">.NET Runtime Install Tool</span></strong><span class="koboSpan" id="kobo.115.1">: This</span><a id="_idIndexMarker130"/><span class="koboSpan" id="kobo.116.1"> extension provides a unified way to install local, private versions of the .</span><span class="No-Break"><span class="koboSpan" id="kobo.117.1">NET runtime</span></span></li></ul></li>
</ul>
<p><span class="koboSpan" id="kobo.118.1">The C# Dev Kit extension </span><a id="_idIndexMarker131"/><span class="koboSpan" id="kobo.119.1">provides a lot of features to help you develop .NET applications. </span><span class="koboSpan" id="kobo.119.2">Press </span><em class="italic"><span class="koboSpan" id="kobo.120.1">Ctrl</span></em><span class="koboSpan" id="kobo.121.1"> + </span><em class="italic"><span class="koboSpan" id="kobo.122.1">Shift</span></em><span class="koboSpan" id="kobo.123.1"> + </span><em class="italic"><span class="koboSpan" id="kobo.124.1">P</span></em><span class="koboSpan" id="kobo.125.1"> (on Windows) or </span><em class="italic"><span class="koboSpan" id="kobo.126.1">Command</span></em><span class="koboSpan" id="kobo.127.1"> + </span><em class="italic"><span class="koboSpan" id="kobo.128.1">Shift</span></em><span class="koboSpan" id="kobo.129.1"> + </span><em class="italic"><span class="koboSpan" id="kobo.130.1">P</span></em><span class="koboSpan" id="kobo.131.1"> (on macOS) to open the Command Palette, then type </span><strong class="source-inline"><span class="koboSpan" id="kobo.132.1">.net</span></strong><span class="koboSpan" id="kobo.133.1"> to see the commands provided by the C# Dev Kit extension. </span><span class="koboSpan" id="kobo.133.2">You can use these commands to create new projects, generate </span><a id="_idIndexMarker132"/><span class="koboSpan" id="kobo.134.1">assets for build and debug, run tests, </span><span class="No-Break"><span class="koboSpan" id="kobo.135.1">and more.</span></span></p>
<p><span class="koboSpan" id="kobo.136.1">You can also install the following extensions to improve </span><span class="No-Break"><span class="koboSpan" id="kobo.137.1">your productivity:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.138.1">EditorConfig for VS Code</span></strong><span class="koboSpan" id="kobo.139.1">: This</span><a id="_idIndexMarker133"/><span class="koboSpan" id="kobo.140.1"> extension provides EditorConfig support for VS Code. </span><span class="koboSpan" id="kobo.140.2">EditorConfig helps teams of multiple developers maintain consistent coding styles when working on the same project across various editors </span><span class="No-Break"><span class="koboSpan" id="kobo.141.1">and IDEs.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.142.1">GitHub Copilot</span></strong><span class="koboSpan" id="kobo.143.1">: GitHub Copilot is</span><a id="_idIndexMarker134"/><span class="koboSpan" id="kobo.144.1"> your AI pair programmer. </span><span class="koboSpan" id="kobo.144.2">You can get code suggestions in real-time based on your context and comments in VS Code. </span><span class="koboSpan" id="kobo.144.3">This extension is not free, but you can try it for free for 30 days. </span><span class="koboSpan" id="kobo.144.4">If you are a student, a teacher, or a maintainer of a popular open-source project, you can get it </span><span class="No-Break"><span class="koboSpan" id="kobo.145.1">for free.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.146.1">To configure EditorConfig, you can create a file named </span><strong class="source-inline"><span class="koboSpan" id="kobo.147.1">.editorconfig</span></strong><span class="koboSpan" id="kobo.148.1"> in the root folder of the project. </span><span class="koboSpan" id="kobo.148.2">You can find a sample EditorConfig file </span><span class="No-Break"><span class="koboSpan" id="kobo.149.1">at </span></span><a href="https://learn.microsoft.com/en-us/dotnet/fundamentals/code-analysis/code-style-rule-options"><span class="No-Break"><span class="koboSpan" id="kobo.150.1">https://learn.microsoft.com/en-us/dotnet/fundamentals/code-analysis/code-style</span><span id="_idTextAnchor075"/><span class="koboSpan" id="kobo.151.1">-rule-options</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.152.1">.</span></span></p>
<h2 id="_idParaDest-42"><a id="_idTextAnchor076"/><span class="koboSpan" id="kobo.153.1">Checking the .NET SDK</span></h2>
<p><span class="koboSpan" id="kobo.154.1">Once</span><a id="_idIndexMarker135"/><span class="koboSpan" id="kobo.155.1"> you install the .NET SDK, you can check the version by running the </span><span class="No-Break"><span class="koboSpan" id="kobo.156.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.157.1">
dotnet --version</span></pre> <p><span class="koboSpan" id="kobo.158.1">You should be able to see the version number </span><span class="No-Break"><span class="koboSpan" id="kobo.159.1">as follows:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.160.1">
8.0.101-rc.2.23502.2</span></pre> <p><span class="koboSpan" id="kobo.161.1">Microsoft releases new versions of .NET SDKs frequently. </span><span class="koboSpan" id="kobo.161.2">If you encounter a different version number, </span><a id="_idIndexMarker136"/><span class="koboSpan" id="kobo.162.1">that </span><span class="No-Break"><span class="koboSpan" id="kobo.163.1">is acceptable.</span></span></p>
<p><span class="koboSpan" id="kobo.164.1">You can list all available SDKs by running the </span><span class="No-Break"><span class="koboSpan" id="kobo.165.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.166.1">
dotnet --list-sdks</span></pre> <p><span class="koboSpan" id="kobo.167.1">The preceding command will list all the available SDKs on your machine. </span><span class="koboSpan" id="kobo.167.2">For example, it may show the following output if have multiple .NET </span><span class="No-Break"><span class="koboSpan" id="kobo.168.1">SDKs installed:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.169.1">
6.0.415 [C:\Program Files\dotnet\sdk]7.0.402 [C:\Program Files\dotnet\sdk]
8.0.100 [C:\Program Files\dotnet\sdk]
8.0.101 [C:\Program Files\dotnet\sdk]</span></pre>
<p><span class="koboSpan" id="kobo.170.1">Multiple versions of .NET SDKs can be installed at the same time. </span><span class="koboSpan" id="kobo.170.2">We can specify the version of the .NET SDKs in the </span><span class="No-Break"><span class="koboSpan" id="kobo.171.1">project file.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.172.1">Which version of the SDKs should I use?</span></p>
<p class="callout"><span class="koboSpan" id="kobo.173.1">Every Microsoft </span><a id="_idIndexMarker137"/><span class="koboSpan" id="kobo.174.1">product has a lifecycle. </span><span class="koboSpan" id="kobo.174.2">.NET and .NET Core provides </span><strong class="bold"><span class="koboSpan" id="kobo.175.1">Long-term support</span></strong><span class="koboSpan" id="kobo.176.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.177.1">LTS</span></strong><span class="koboSpan" id="kobo.178.1">) releases that get 3 years of patches and free support. </span><span class="koboSpan" id="kobo.178.2">When this book was written, .NET 7 is still supported, until May 2024. </span><span class="koboSpan" id="kobo.178.3">Based on Microsoft's policy, even numbered releases are LTS releases. </span><span class="koboSpan" id="kobo.178.4">So .NET 8 is the latest LTS release. </span><span class="koboSpan" id="kobo.178.5">The code samples in this book are written with .</span><span class="No-Break"><span class="koboSpan" id="kobo.179.1">NET 8.0.</span></span></p>
<p class="callout"><span class="koboSpan" id="kobo.180.1">To learn more about .NET support policies, please </span><span class="No-Break"><span class="koboSpan" id="kobo.181.1">visit </span></span><a href="https://dotnet.microsoft.com/en-us/platform/support/policy"><span class="No-Break"><span class="koboSpan" id="kobo.182.1">https://dotnet.microsoft.com/en-us/platform/support/policy</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.183.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.184.1">We are now prepared to start developing ASP.NET Core applications. </span><span class="koboSpan" id="kobo.184.2">L</span><a id="_idTextAnchor077"/><span class="koboSpan" id="kobo.185.1">et’s get </span><span class="No-Break"><span class="koboSpan" id="kobo.186.1">to work!</span></span></p>
<h1 id="_idParaDest-43"><a id="_idTextAnchor078"/><span class="koboSpan" id="kobo.187.1">Creating a simple REST web API project</span></h1>
<p><span class="koboSpan" id="kobo.188.1">In this section, we</span><a id="_idIndexMarker138"/><span class="koboSpan" id="kobo.189.1"> will use the </span><strong class="bold"><span class="koboSpan" id="kobo.190.1">.NET command-line interface</span></strong><span class="koboSpan" id="kobo.191.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.192.1">.NET CLI</span></strong><span class="koboSpan" id="kobo.193.1">) to create a basic web API project and see how </span><span class="No-Break"><span class="koboSpan" id="kobo.194.1">it works.</span></span></p>
<p><span class="koboSpan" id="kobo.195.1">The .NET CLI is a</span><a id="_idIndexMarker139"/><span class="koboSpan" id="kobo.196.1"> command-line tool that helps you to create, develop, build, run, and publish .NET applications. </span><span class="koboSpan" id="kobo.196.2">It is included in the .</span><span class="No-Break"><span class="koboSpan" id="kobo.197.1">NET SDK.</span></span></p>
<p><span class="koboSpan" id="kobo.198.1">You have multiple ways to run .NET CLI commands. </span><span class="koboSpan" id="kobo.198.2">The most common way is to run the command in the terminal window or command prompt. </span><span class="koboSpan" id="kobo.198.3">Also, you can run the command in VS Code directly. </span><span class="koboSpan" id="kobo.198.4">VS Code provides an integrated terminal that starts at the root of your workspace. </span><span class="koboSpan" id="kobo.198.5">To open the terminal in VS Code, you can do any one of </span><span class="No-Break"><span class="koboSpan" id="kobo.199.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.200.1">Press </span><em class="italic"><span class="koboSpan" id="kobo.201.1">Ctrl</span></em><span class="koboSpan" id="kobo.202.1"> + </span><em class="italic"><span class="koboSpan" id="kobo.203.1">`</span></em><span class="koboSpan" id="kobo.204.1"> (on Windows) or </span><em class="italic"><span class="koboSpan" id="kobo.205.1">Command</span></em><span class="koboSpan" id="kobo.206.1"> + </span><em class="italic"><span class="koboSpan" id="kobo.207.1">`</span></em><span class="koboSpan" id="kobo.208.1"> (on macOS) to open </span><span class="No-Break"><span class="koboSpan" id="kobo.209.1">the terminal</span></span></li>
<li><span class="koboSpan" id="kobo.210.1">Use the </span><strong class="bold"><span class="koboSpan" id="kobo.211.1">View</span></strong><span class="koboSpan" id="kobo.212.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.213.1">Terminal</span></strong><span class="koboSpan" id="kobo.214.1"> menu item to open </span><span class="No-Break"><span class="koboSpan" id="kobo.215.1">the terminal</span></span></li>
<li><span class="koboSpan" id="kobo.216.1">From the Command Palette, use the </span><strong class="bold"><span class="koboSpan" id="kobo.217.1">View: Toggle Terminal</span></strong><span class="koboSpan" id="kobo.218.1"> command to open </span><span class="No-Break"><span class="koboSpan" id="kobo.219.1">the terminal</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.220.1">In the terminal, navigate to a folder where you want to create the project, then create a web API project by running the </span><span class="No-Break"><span class="koboSpan" id="kobo.221.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.222.1">
dotnet new webapi -n MyFirstApi -controllerscd MyFirstApi
code .</span></pre>
<p><span class="koboSpan" id="kobo.223.1">The preceding commands create a new web API project and open it in VS Code. </span><strong class="source-inline"><span class="koboSpan" id="kobo.224.1">dotnet new</span></strong><span class="koboSpan" id="kobo.225.1"> provides many options to create various types of projects, such as web APIs, console apps, class libraries, and </span><span class="No-Break"><span class="koboSpan" id="kobo.226.1">so on.</span></span></p>
<p><span class="koboSpan" id="kobo.227.1">There are some options we can use to specify </span><span class="No-Break"><span class="koboSpan" id="kobo.228.1">the project:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.229.1">-n|--name &lt;OUTPUT_NAME&gt;</span></strong><span class="koboSpan" id="kobo.230.1">: The name for the created output. </span><span class="koboSpan" id="kobo.230.2">If not specified, the name of the current directory </span><span class="No-Break"><span class="koboSpan" id="kobo.231.1">is used.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.232.1">-o|--output &lt;OUTPUT_PATH&gt;</span></strong><span class="koboSpan" id="kobo.233.1">: The output path for the created project. </span><span class="koboSpan" id="kobo.233.2">If not specified, the current directory </span><span class="No-Break"><span class="koboSpan" id="kobo.234.1">is used.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.235.1">-controllers|--use-controllers</span></strong><span class="koboSpan" id="kobo.236.1">: Indicates whether to use controllers for actions. </span><span class="koboSpan" id="kobo.236.2">If not specified, the default value </span><span class="No-Break"><span class="koboSpan" id="kobo.237.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.238.1">false</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.239.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.240.1">-minimal|--use-minimal-apis</span></strong><span class="koboSpan" id="kobo.241.1">: Indicates whether to use minimal APIs. </span><span class="koboSpan" id="kobo.241.2">The default value is </span><strong class="source-inline"><span class="koboSpan" id="kobo.242.1">false</span></strong><span class="koboSpan" id="kobo.243.1">, but the </span><strong class="source-inline"><span class="koboSpan" id="kobo.244.1">-controllers</span></strong><span class="koboSpan" id="kobo.245.1"> option will override the </span><strong class="source-inline"><span class="koboSpan" id="kobo.246.1">-minimal</span></strong><span class="koboSpan" id="kobo.247.1"> option. </span><span class="koboSpan" id="kobo.247.2">If neither </span><strong class="source-inline"><span class="koboSpan" id="kobo.248.1">-controllers</span></strong><span class="koboSpan" id="kobo.249.1"> nor </span><strong class="source-inline"><span class="koboSpan" id="kobo.250.1">-minimal</span></strong><span class="koboSpan" id="kobo.251.1"> is specified, the default value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">-controllers</span></strong><span class="koboSpan" id="kobo.253.1"> option, which is </span><strong class="source-inline"><span class="koboSpan" id="kobo.254.1">false</span></strong><span class="koboSpan" id="kobo.255.1">, will be used, so a minimal API will </span><span class="No-Break"><span class="koboSpan" id="kobo.256.1">be created.</span></span></li>
</ul>
<p class="callout-heading"><span class="koboSpan" id="kobo.257.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.258.1">Since .NET 6.0, ASP.NET Core 6.0 provides a new way to create web API projects, which is called </span><strong class="bold"><span class="koboSpan" id="kobo.259.1">minimal APIs</span></strong><span class="koboSpan" id="kobo.260.1">. </span><span class="koboSpan" id="kobo.260.2">It is a</span><a id="_idIndexMarker140"/><span class="koboSpan" id="kobo.261.1"> simplified approach for building APIs without controllers. </span><span class="koboSpan" id="kobo.261.2">We will introduce minimal APIs later. </span><span class="koboSpan" id="kobo.261.3">For now, we will use the traditional way to create a web API project with controllers. </span><span class="koboSpan" id="kobo.261.4">So, we need to specify the </span><strong class="source-inline"><span class="koboSpan" id="kobo.262.1">--</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.263.1">use-controllers</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.264.1"> option.</span></span></p>
<p><span class="koboSpan" id="kobo.265.1">To learn</span><a id="_idIndexMarker141"/><span class="koboSpan" id="kobo.266.1"> more about the </span><strong class="source-inline"><span class="koboSpan" id="kobo.267.1">dotnet new</span></strong><span class="koboSpan" id="kobo.268.1"> command, check this page: </span><a href="https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-new"><span class="koboSpan" id="kobo.269.1">https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-new</span></a><span class="koboSpan" id="kobo.270.1">. </span><span class="koboSpan" id="kobo.270.2">We will introduce more details on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.271.1">dotnet</span></strong><span class="koboSpan" id="kobo.272.1"> command in the </span><span class="No-Break"><span class="koboSpan" id="kobo.273.1">following sections.</span></span></p>
<p><span class="koboSpan" id="kobo.274.1">When you use VS Code to open the project, the C# Dev Kit extension can create a solution file for you. </span><span class="koboSpan" id="kobo.274.2">This feature makes VS Code more friendly to C# developers. </span><span class="koboSpan" id="kobo.274.3">You can see the following structure in the </span><span class="No-Break"><span class="koboSpan" id="kobo.275.1">Explorer view:</span></span></p>
<p><span class="koboSpan" id="kobo.276.1">The reason is that VS 2022 will create a sln file for the project, but .NET CLI does not. </span><span class="koboSpan" id="kobo.276.2">When using VS Code to open the project, the C# DevKit will create the sln file. </span><span class="koboSpan" id="kobo.276.3">I think it's worth mentioning </span><span class="No-Break"><span class="koboSpan" id="kobo.277.1">it here.</span></span></p>
<p><span class="koboSpan" id="kobo.278.1">The C# Dev Kit </span><a id="_idIndexMarker142"/><span class="koboSpan" id="kobo.279.1">extension provides a new feature, the solution explorer, which is located at the bottom. </span><span class="koboSpan" id="kobo.279.2">This feature is especially useful when working with multiple projects in one solution. </span><span class="koboSpan" id="kobo.279.3">You can drag and drop the </span><strong class="bold"><span class="koboSpan" id="kobo.280.1">SOLUTION EXPLORER</span></strong><span class="koboSpan" id="kobo.281.1"> to the top to make it </span><span class="No-Break"><span class="koboSpan" id="kobo.282.1">more visible.</span></span></p>
<p><span class="koboSpan" id="kobo.283.1">When you use VS Code to open the project, the C# Dev Kit extension can create a solution file for you. </span><span class="koboSpan" id="kobo.283.2">This feature makes VS Code more friendly to C# developers. </span><span class="koboSpan" id="kobo.283.3">You can see the following structure in the </span><span class="No-Break"><span class="koboSpan" id="kobo.284.1">Explorer view:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer008">
<span class="koboSpan" id="kobo.285.1"><img alt="Figure 2.2 – The solution explorer and the folder structure" src="image/B18971_02_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.286.1">Figure 2.2 – The solution explorer and the folder structure</span></p>
<p><span class="koboSpan" id="kobo.287.1">Next, we can </span><a id="_idIndexMarker143"/><span class="koboSpan" id="kobo.288.1">start to buil</span><a id="_idTextAnchor079"/><span class="koboSpan" id="kobo.289.1">d and run </span><span class="No-Break"><span class="koboSpan" id="kobo.290.1">the project.</span></span></p>
<h1 id="_idParaDest-44"><a id="_idTextAnchor080"/><span class="koboSpan" id="kobo.291.1">Building and running the project</span></h1>
<p><span class="koboSpan" id="kobo.292.1">In this section, we </span><a id="_idIndexMarker144"/><span class="koboSpan" id="kobo.293.1">will learn how to build and run the project and introduce some useful tools to help you test the APIs. </span><span class="koboSpan" id="kobo.293.2">To make it compatible with all platforms, we will use .NET CLI commands to build and run the project. </span><span class="koboSpan" id="kobo.293.3">We will also learn how to debug </span><a id="_idTextAnchor081"/><span class="koboSpan" id="kobo.294.1">the project in </span><span class="No-Break"><span class="koboSpan" id="kobo.295.1">VS Code.</span></span></p>
<h2 id="_idParaDest-45"><a id="_idTextAnchor082"/><span class="koboSpan" id="kobo.296.1">Building the project</span></h2>
<p><span class="koboSpan" id="kobo.297.1">The easiest way to</span><a id="_idIndexMarker145"/><span class="koboSpan" id="kobo.298.1"> build and run the project is to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.299.1">dotnet</span></strong><span class="koboSpan" id="kobo.300.1"> command. </span><span class="koboSpan" id="kobo.300.2">You can run the following command to build </span><span class="No-Break"><span class="koboSpan" id="kobo.301.1">the project:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.302.1">
dotnet build</span></pre> <p><span class="koboSpan" id="kobo.303.1">The preceding command will build the project and its dependencies and generate a set of binaries. </span><span class="koboSpan" id="kobo.303.2">You can find these binaries in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.304.1">bin</span></strong><span class="koboSpan" id="kobo.305.1"> folder. </span><span class="koboSpan" id="kobo.305.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.306.1">bin</span></strong><span class="koboSpan" id="kobo.307.1"> folder is the default output folder for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.308.1">dotnet build</span></strong><span class="koboSpan" id="kobo.309.1"> command. </span><span class="koboSpan" id="kobo.309.2">You can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.310.1">--output</span></strong><span class="koboSpan" id="kobo.311.1"> option to specify the output folder. </span><span class="koboSpan" id="kobo.311.2">However, it is recommended to use the default </span><strong class="source-inline"><span class="koboSpan" id="kobo.312.1">bin</span></strong><span class="koboSpan" id="kobo.313.1"> folder. </span><span class="koboSpan" id="kobo.313.2">The binaries are</span><a id="_idIndexMarker146"/><span class="koboSpan" id="kobo.314.1"> some </span><strong class="bold"><span class="koboSpan" id="kobo.315.1">Intermediate Language</span></strong><span class="koboSpan" id="kobo.316.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.317.1">IL</span></strong><span class="koboSpan" id="kobo.318.1">) files with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.319.1">.</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.320.1">dll</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.321.1"> extension.</span></span></p>
<p><span class="koboSpan" id="kobo.322.1">You might see the following popups when you use VS Code to open </span><span class="No-Break"><span class="koboSpan" id="kobo.323.1">the project:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer009">
<span class="koboSpan" id="kobo.324.1"><img alt="Figure 2.3 – VS Code prompts to restore dependencies" src="image/B18971_02_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.325.1">Figure 2.3 – VS Code prompts to restore dependencies</span></p>
<p><span class="koboSpan" id="kobo.326.1">This is because VS Code inspects that the project is a .NET project, and it is trying to restore the dependencies. </span><span class="koboSpan" id="kobo.326.2">You can click the </span><strong class="bold"><span class="koboSpan" id="kobo.327.1">Restore</span></strong><span class="koboSpan" id="kobo.328.1"> button to restore the dependencies. </span><span class="koboSpan" id="kobo.328.2">Similarly, if you see other prompts from VS Code to add assets to debug the project, please select </span><strong class="bold"><span class="koboSpan" id="kobo.329.1">Yes</span></strong><span class="koboSpan" id="kobo.330.1"> in </span><span class="No-Break"><span class="koboSpan" id="kobo.331.1">the dialog:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer010">
<span class="koboSpan" id="kobo.332.1"><img alt="Figure 2.4 – VS Code prompts to add required assets to build and debug" src="image/B18971_02_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.333.1">Figure 2.4 – VS Code prompts to add required assets to build and debug</span></p>
<p><span class="koboSpan" id="kobo.334.1">Some commands, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.335.1">dotnet build</span></strong><span class="koboSpan" id="kobo.336.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.337.1">dotnet run</span></strong><span class="koboSpan" id="kobo.338.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.339.1">dotnet test</span></strong><span class="koboSpan" id="kobo.340.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.341.1">dotnet publish</span></strong><span class="koboSpan" id="kobo.342.1">, will </span><a id="_idIndexMarker147"/><span class="koboSpan" id="kobo.343.1">implicitly restore dependencies. </span><span class="koboSpan" id="kobo.343.2">So don't worry if you missed out on </span><span class="No-Break"><span class="koboSpan" id="kobo.344.1">these prompts.</span></span></p>
<p><span class="koboSpan" id="kobo.345.1">If no errors or warnings are shown, that means </span><a id="_idTextAnchor083"/><span class="koboSpan" id="kobo.346.1">the build </span><span class="No-Break"><span class="koboSpan" id="kobo.347.1">is successful.</span></span></p>
<h2 id="_idParaDest-46"><a id="_idTextAnchor084"/><span class="koboSpan" id="kobo.348.1">Running the project</span></h2>
<p><span class="koboSpan" id="kobo.349.1">You</span><a id="_idIndexMarker148"/><span class="koboSpan" id="kobo.350.1"> can run the following command to run </span><span class="No-Break"><span class="koboSpan" id="kobo.351.1">the project:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.352.1">
dotnet run</span></pre> <p><span class="koboSpan" id="kobo.353.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.354.1">dotnet run</span></strong><span class="koboSpan" id="kobo.355.1"> command is a convenient way of running the project from the source code. </span><span class="koboSpan" id="kobo.355.2">Keep in mind that it is useful in development, but not for production. </span><span class="koboSpan" id="kobo.355.3">The reason is that if the dependencies are outside of the shared runtime, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.356.1">dotnet run</span></strong><span class="koboSpan" id="kobo.357.1"> command will resolve the dependencies from the NuGet cache. </span><span class="koboSpan" id="kobo.357.2">To run the application in production, you need to create a deployment package with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.358.1">dotnet publish</span></strong><span class="koboSpan" id="kobo.359.1"> command and deploy it. </span><span class="koboSpan" id="kobo.359.2">We will explore the deployment process in </span><span class="No-Break"><span class="koboSpan" id="kobo.360.1">future chapters.</span></span></p>
<p><span class="koboSpan" id="kobo.361.1">You should be able to see the </span><span class="No-Break"><span class="koboSpan" id="kobo.362.1">following output:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.363.1">
Building...info: Microsoft.Hosting.Lifetime[14]
      Now listening on: https://localhost:7291
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: http://localhost:5247
info: Microsoft.Hosting.Lifetime[0]
      Application started. </span><span class="koboSpan" id="kobo.363.2">Press Ctrl+C to shut down.
</span><span class="koboSpan" id="kobo.363.3">info: Microsoft.Hosting.Lifetime[0]
      Hosting environment: Development
info: Microsoft.Hosting.Lifetime[0]
      Content root path: C:\example_code\chapter2\MyFirstApi\MyFirstApi
info: Microsoft.Hosting.Lifetime[0]
      Application is shutting down...</span></pre>
<p><span class="koboSpan" id="kobo.364.1">There is a</span><a id="_idIndexMarker149"/><span class="koboSpan" id="kobo.365.1"> link in the output, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.366.1">http://localhost:5247</span></strong><span class="koboSpan" id="kobo.367.1">. </span><span class="koboSpan" id="kobo.367.2">The port number was randomly generated when we created the project. </span><span class="koboSpan" id="kobo.367.3">In a browser, navigate to </span><strong class="source-inline"><span class="koboSpan" id="kobo.368.1">http://localhost:&lt;your_port&gt;/swagger</span></strong><span class="koboSpan" id="kobo.369.1">. </span><span class="koboSpan" id="kobo.369.2">You will see the web API documentation with </span><strong class="bold"><span class="koboSpan" id="kobo.370.1">Swagger UI</span></strong><span class="koboSpan" id="kobo.371.1">, which</span><a id="_idIndexMarker150"/><span class="koboSpan" id="kobo.372.1"> offers a web-based UI to provide information and tools to interact with the API. </span><span class="koboSpan" id="kobo.372.2">You can use Swagger UI to </span><span class="No-Break"><span class="koboSpan" id="kobo.373.1">test APIs:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer011">
<span class="koboSpan" id="kobo.374.1"><img alt="Figure 2.5 – Swagger UI" src="image/B18971_02_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.375.1">Figure 2.5 – Swagger UI</span></p>
<p><span class="koboSpan" id="kobo.376.1">The </span><a id="_idIndexMarker151"/><span class="koboSpan" id="kobo.377.1">API project</span><a id="_idIndexMarker152"/><span class="koboSpan" id="kobo.378.1"> is now running! </span><span class="koboSpan" id="kobo.378.2">You can see the web API template provides a </span><strong class="source-inline"><span class="koboSpan" id="kobo.379.1">/WeatherForecast</span></strong><span class="koboSpan" id="kobo.380.1"> endpoint. </span><span class="koboSpan" id="kobo.380.2">If you navigate to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.381.1">http://localhost:5247/WeatherForecast</span></strong><span class="koboSpan" id="kobo.382.1"> link in the browser, you will see the </span><span class="No-Break"><span class="koboSpan" id="kobo.383.1">API response.</span></span></p>
<p><span class="koboSpan" id="kobo.384.1">To support HTTPS, you may need to trust the HTTPS development certificate by running the </span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.386.1">
dotnet dev-certs https --trust</span></pre> <p><span class="koboSpan" id="kobo.387.1">You will see a dialog if the certificate was not previously trusted. </span><span class="koboSpan" id="kobo.387.2">Select </span><strong class="bold"><span class="koboSpan" id="kobo.388.1">Yes</span></strong><span class="koboSpan" id="kobo.389.1"> to trust the </span><span class="No-Break"><span class="koboSpan" id="kobo.390.1">development certificate:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer012">
<span class="koboSpan" id="kobo.391.1"><img alt="Figure 2.6 – Installing the certificate for local development" src="image/B18971_02_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.392.1">Figure 2.6 – Installing the certificate for local development</span></p>
<p><span class="koboSpan" id="kobo.393.1">Please note</span><a id="_idIndexMarker153"/><span class="koboSpan" id="kobo.394.1"> that the preceding command does not work on Linux. </span><span class="koboSpan" id="kobo.394.2">See your Linux distribution docu</span><a id="_idTextAnchor085"/><span class="koboSpan" id="kobo.395.1">mentation for </span><span class="No-Break"><span class="koboSpan" id="kobo.396.1">more details.</span></span></p>
<h2 id="_idParaDest-47"><a id="_idTextAnchor086"/><span class="koboSpan" id="kobo.397.1">Changing the port number</span></h2>
<p><span class="koboSpan" id="kobo.398.1">The port number is </span><a id="_idIndexMarker154"/><span class="koboSpan" id="kobo.399.1">defined in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.400.1">launchSettings.json</span></strong><span class="koboSpan" id="kobo.401.1"> file in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.402.1">Properties</span></strong><span class="koboSpan" id="kobo.403.1"> folder. </span><span class="koboSpan" id="kobo.403.2">You can change the port number by editing the file. </span><span class="koboSpan" id="kobo.403.3">Based on the convention, when the web API project was created, a port from </span><strong class="source-inline"><span class="koboSpan" id="kobo.404.1">5000</span></strong><span class="koboSpan" id="kobo.405.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.406.1">5300</span></strong><span class="koboSpan" id="kobo.407.1"> will be selected for HTTP, and from </span><strong class="source-inline"><span class="koboSpan" id="kobo.408.1">7000</span></strong><span class="koboSpan" id="kobo.409.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.410.1">7300</span></strong><span class="koboSpan" id="kobo.411.1"> for HTTPS. </span><span class="koboSpan" id="kobo.411.2">Here is an example of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.412.1">launchSettings.json</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.413.1"> file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.414.1">
{  "$schema": "https://json.schemastore.org/launchsettings.json",
  ...
</span><span class="koboSpan" id="kobo.414.2">  "profiles": {
    "https": {
      "commandName": "Project",
      "dotnetRunMessages": true,
      "launchBrowser": true,
      "launchUrl": "swagger",
      "applicationUrl": "https://localhost:7291;http://localhost:5247",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    },
    ...
</span><span class="koboSpan" id="kobo.414.3">  }
}</span></pre>
<p><span class="koboSpan" id="kobo.415.1">You can update the port number here. </span><span class="koboSpan" id="kobo.415.2">Just keep in mind that the port number should be unique on your</span><a id="_idTextAnchor087"/><span class="koboSpan" id="kobo.416.1"> machine to </span><span class="No-Break"><span class="koboSpan" id="kobo.417.1">avoid conflicts.</span></span></p>
<h2 id="_idParaDest-48"><a id="_idTextAnchor088"/><span class="koboSpan" id="kobo.418.1">Hot Reload</span></h2>
<p><span class="koboSpan" id="kobo.419.1">When you use </span><strong class="source-inline"><span class="koboSpan" id="kobo.420.1">dotnet run</span></strong><span class="koboSpan" id="kobo.421.1"> to run</span><a id="_idIndexMarker155"/><span class="koboSpan" id="kobo.422.1"> the project, if you change the code, you need to stop the project and start it again. </span><span class="koboSpan" id="kobo.422.2">If your project is complicated, it takes time to stop and restart. </span><span class="koboSpan" id="kobo.422.3">To speed up development, you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.423.1">dotnet watch</span></strong><span class="koboSpan" id="kobo.424.1"> command to enable the Hot </span><span class="No-Break"><span class="koboSpan" id="kobo.425.1">Reload feature.</span></span></p>
<p><span class="koboSpan" id="kobo.426.1">.NET Hot Reload is a feature that allows you to apply code changes to a running app without restarting the app. </span><span class="koboSpan" id="kobo.426.2">It was first provided with .NET 6. </span><span class="koboSpan" id="kobo.426.3">Instead of using </span><strong class="source-inline"><span class="koboSpan" id="kobo.427.1">dotnet run</span></strong><span class="koboSpan" id="kobo.428.1">, you can use </span><strong class="source-inline"><span class="koboSpan" id="kobo.429.1">dotnet watch</span></strong><span class="koboSpan" id="kobo.430.1"> to activate Hot Reload in development. </span><span class="koboSpan" id="kobo.430.2">Once you update the code, the web browser will automatically refresh the page. </span><span class="koboSpan" id="kobo.430.3">However, Hot Reload does not support all code changes. </span><span class="koboSpan" id="kobo.430.4">In some cases, </span><strong class="source-inline"><span class="koboSpan" id="kobo.431.1">dotnet watch</span></strong><span class="koboSpan" id="kobo.432.1"> will ask you if you want to restart the application. </span><span class="koboSpan" id="kobo.432.2">There are some options: </span><strong class="source-inline"><span class="koboSpan" id="kobo.433.1">Yes</span></strong><span class="koboSpan" id="kobo.434.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.435.1">No</span></strong><span class="koboSpan" id="kobo.436.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.437.1">Always</span></strong><span class="koboSpan" id="kobo.438.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.439.1">Never</span></strong><span class="koboSpan" id="kobo.440.1">. </span><span class="koboSpan" id="kobo.440.2">Choose the appropriate option for the code change you want to apply, as </span><span class="No-Break"><span class="koboSpan" id="kobo.441.1">shown next:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.442.1">
dotnet watch  File changed: .\Services\IService.cs.dotnet watch  Unable to apply hot reload because of a rude edit.
</span><span class="koboSpan" id="kobo.442.2">   Do you want to restart your app - Yes (y) / No </span><a id="_idTextAnchor089"/><span class="koboSpan" id="kobo.443.1">(n) / Always (a) / Never (v)?</span></pre>
<p><span class="koboSpan" id="kobo.444.1">The API project is now running, and we can start to test </span><span class="No-Break"><span class="koboSpan" id="kobo.445.1">the API.</span></span></p>
<h2 id="_idParaDest-49"><a id="_idTextAnchor090"/><span class="koboSpan" id="kobo.446.1">Testing the API endpoint</span></h2>
<p><span class="koboSpan" id="kobo.447.1">The </span><a id="_idIndexMarker156"/><span class="koboSpan" id="kobo.448.1">browser can send a </span><strong class="source-inline"><span class="koboSpan" id="kobo.449.1">GET</span></strong><span class="koboSpan" id="kobo.450.1"> request easily, but it is not as simple for </span><strong class="source-inline"><span class="koboSpan" id="kobo.451.1">POST</span></strong><span class="koboSpan" id="kobo.452.1"> endpoints. </span><span class="koboSpan" id="kobo.452.2">There are various ways to call the API for testing purposes, such as Swagger UI, Postman, and other tools. </span><span class="koboSpan" id="kobo.452.3">In this section, we will introduce some tools you can</span><a id="_idTextAnchor091"/><span class="koboSpan" id="kobo.453.1"> use in the</span><a id="_idTextAnchor092"/> <span class="No-Break"><span class="koboSpan" id="kobo.454.1">development stage.</span></span></p>
<h2 id="_idParaDest-50"><a id="_idTextAnchor093"/><span class="koboSpan" id="kobo.455.1">Swagger UI</span></h2>
<p><span class="koboSpan" id="kobo.456.1">We </span><a id="_idIndexMarker157"/><span class="koboSpan" id="kobo.457.1">introduced </span><a id="_idIndexMarker158"/><span class="koboSpan" id="kobo.458.1">how to use SwaggerHub to design APIs in </span><a href="B18971_01.xhtml#_idTextAnchor012"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.459.1">Chapter 1</span></em></span></a><span class="koboSpan" id="kobo.460.1">. </span><span class="koboSpan" id="kobo.460.2">From version 5.0, ASP.NET Core enables OpenAPI support by default. </span><span class="koboSpan" id="kobo.460.3">It uses the </span><strong class="source-inline"><span class="koboSpan" id="kobo.461.1">Swashbuckle.AspNetCore</span></strong><span class="koboSpan" id="kobo.462.1"> NuGet package, which provides the Swagger UI to document and test </span><span class="No-Break"><span class="koboSpan" id="kobo.463.1">the APIs.</span></span></p>
<p><span class="koboSpan" id="kobo.464.1">We can use Swagger UI to test the API directly. </span><span class="koboSpan" id="kobo.464.2">Expand the first </span><strong class="source-inline"><span class="koboSpan" id="kobo.465.1">/WeatherForecast</span></strong><span class="koboSpan" id="kobo.466.1"> API in </span><a id="_idIndexMarker159"/><span class="koboSpan" id="kobo.467.1">Swagger UI and click the </span><strong class="bold"><span class="koboSpan" id="kobo.468.1">Try it out</span></strong><span class="koboSpan" id="kobo.469.1"> button. </span><span class="koboSpan" id="kobo.469.2">You</span><a id="_idIndexMarker160"/><span class="koboSpan" id="kobo.470.1"> will see an </span><strong class="bold"><span class="koboSpan" id="kobo.471.1">Execute</span></strong><span class="koboSpan" id="kobo.472.1"> button. </span><span class="koboSpan" id="kobo.472.2">Click the button, and you will see the </span><span class="No-Break"><span class="koboSpan" id="kobo.473.1">following response:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer013">
<span class="koboSpan" id="kobo.474.1"><img alt="Figure 2.7 – Testing an endpoint in Swagger UI" src="image/B18971_02_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.475.1">Figure 2.7 – Testing an endpoint in Swagger UI</span></p>
<p><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.476.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.477.1">.7</span></em><span class="koboSpan" id="kobo.478.1"> demonstrates </span><a id="_idIndexMarker161"/><span class="koboSpan" id="kobo.479.1">that the API is functioning correctly and is providing the expected response. </span><span class="koboSpan" id="kobo.479.2">To learn more about Swagger and</span><a id="_idIndexMarker162"/><span class="koboSpan" id="kobo.480.1"> OpenAPI, you </span><a id="_idIndexMarker163"/><span class="koboSpan" id="kobo.481.1">can </span><a id="_idIndexMarker164"/><span class="koboSpan" id="kobo.482.1">check the </span><span class="No-Break"><span class="koboSpan" id="kobo.483.1">following links:</span></span></p>
<ul>
<li><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.484.1">Swagger</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.485.1">: </span></span><a href="https://swagger.io/"><span class="No-Break"><span class="koboSpan" id="kobo.486.1">https://swagger.io/</span></span></a></li>
<li><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.487.1">OpenAPI</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.488.1">: </span></span><a href="https://www.openapis.org/"><span class="No-Break"><span class="koboSpan" id="kobo.489.1">https://www.openapis.org/</span></span></a></li>
<li><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.490.1">S</span><a id="_idTextAnchor094"/><span class="koboSpan" id="kobo.491.1">martBear</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.492.1">: </span></span><a href="https://www.smartbear.com/"><span class="No-Break"><span class="koboSpan" id="kobo.493.1">https://www.smartbear.com/</span></span></a></li>
</ul>
<h3><span class="koboSpan" id="kobo.494.1">Postman</span></h3>
<p><strong class="bold"><span class="koboSpan" id="kobo.495.1">Postman</span></strong><span class="koboSpan" id="kobo.496.1"> is a </span><a id="_idIndexMarker165"/><span class="koboSpan" id="kobo.497.1">powerful API platform for building and using APIs. </span><span class="koboSpan" id="kobo.497.2">It is widely used by many individual developers and organizations. </span><span class="koboSpan" id="kobo.497.3">You can</span><a id="_idIndexMarker166"/><span class="koboSpan" id="kobo.498.1"> download it </span><span class="No-Break"><span class="koboSpan" id="kobo.499.1">here: </span></span><a href="https://www.postman.com/downloads/"><span class="No-Break"><span class="koboSpan" id="kobo.500.1">https://www.postman.com/downloads/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.501.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.502.1">Click the </span><strong class="bold"><span class="koboSpan" id="kobo.503.1">+</span></strong><span class="koboSpan" id="kobo.504.1"> button to create a new tab. </span><span class="koboSpan" id="kobo.504.2">Use </span><strong class="source-inline"><span class="koboSpan" id="kobo.505.1">http://localhost:5247/WeatherForecast</span></strong><span class="koboSpan" id="kobo.506.1"> as the URL. </span><span class="koboSpan" id="kobo.506.2">Then, click the </span><strong class="bold"><span class="koboSpan" id="kobo.507.1">Send</span></strong><span class="koboSpan" id="kobo.508.1"> button. </span><span class="koboSpan" id="kobo.508.2">You will see the </span><span class="No-Break"><span class="koboSpan" id="kobo.509.1">response next:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer014">
<span class="koboSpan" id="kobo.510.1"><img alt="Figure 2.8 – Using Postman to call the API" src="image/B18971_02_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.511.1">Figure 2.8 – Using Postman to call the API</span></p>
<p><span class="koboSpan" id="kobo.512.1">Postman provides a rich set of features to test APIs. </span><span class="koboSpan" id="kobo.512.2">To learn more about Postman, check the official </span><span class="No-Break"><span class="koboSpan" id="kobo.513.1">documentation: </span></span><a href="https://learning.postman.com/docs/getting-started/introduction/"><span class="No-Break"><span class="koboSpan" id="kobo.514.1">https://learning.postman.co</span><span id="_idTextAnchor095"/><span class="koboSpan" id="kobo.515.1">m/docs/getting-started/introduction/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.516.1">.</span></span></p>
<h3><span class="koboSpan" id="kobo.517.1">HttpRepl</span></h3>
<p><strong class="bold"><span class="koboSpan" id="kobo.518.1">HTTP Read-Eval-Print Loop</span></strong><span class="koboSpan" id="kobo.519.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.520.1">HttpRepl</span></strong><span class="koboSpan" id="kobo.521.1">) is a</span><a id="_idIndexMarker167"/><span class="koboSpan" id="kobo.522.1"> command-line tool that allows you to test APIs. </span><span class="koboSpan" id="kobo.522.2">It is lightweight and cross-platform, so it can run anywhere. </span><span class="koboSpan" id="kobo.522.3">It supports the </span><strong class="source-inline"><span class="koboSpan" id="kobo.523.1">GET</span></strong><span class="koboSpan" id="kobo.524.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.525.1">POST</span></strong><span class="koboSpan" id="kobo.526.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.527.1">PUT</span></strong><span class="koboSpan" id="kobo.528.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.529.1">DELETE</span></strong><span class="koboSpan" id="kobo.530.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.531.1">HEAD</span></strong><span class="koboSpan" id="kobo.532.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.533.1">OPTIONS</span></strong><span class="koboSpan" id="kobo.534.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.535.1">PATCH</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.536.1">HTTP verbs.</span></span></p>
<p><span class="koboSpan" id="kobo.537.1">To install HttpRepl, you can use the </span><span class="No-Break"><span class="koboSpan" id="kobo.538.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.539.1">
dotnet tool install -g Microsoft.dotnet-httprepl</span></pre> <p><span class="koboSpan" id="kobo.540.1">After the installation, you can use the following command to connect to </span><span class="No-Break"><span class="koboSpan" id="kobo.541.1">our API:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.542.1">
httprepl &lt;ROOT URL&gt;/</span></pre> <p><strong class="source-inline"><span class="koboSpan" id="kobo.543.1">&lt;ROOT URL&gt;</span></strong><span class="koboSpan" id="kobo.544.1"> is the base URL of the web API, such as </span><span class="No-Break"><span class="koboSpan" id="kobo.545.1">the following:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.546.1">
httprepl http://localhost:5247/</span></pre> <p><span class="koboSpan" id="kobo.547.1">After the </span><a id="_idIndexMarker168"/><span class="koboSpan" id="kobo.548.1">connection is built, you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.549.1">ls</span></strong><span class="koboSpan" id="kobo.550.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.551.1">dir</span></strong><span class="koboSpan" id="kobo.552.1"> command to list the endpoints, such as </span><span class="No-Break"><span class="koboSpan" id="kobo.553.1">the following:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.554.1">
http://localhost:5247/&gt; ls.                 []
WeatherForecast   [GET]</span></pre>
<p><span class="koboSpan" id="kobo.555.1">The preceding command shows the </span><strong class="source-inline"><span class="koboSpan" id="kobo.556.1">WeatherForecast</span></strong><span class="koboSpan" id="kobo.557.1"> endpoint supports a </span><strong class="source-inline"><span class="koboSpan" id="kobo.558.1">GET</span></strong><span class="koboSpan" id="kobo.559.1"> operation. </span><span class="koboSpan" id="kobo.559.2">Then, we can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.560.1">cd</span></strong><span class="koboSpan" id="kobo.561.1"> command to navigate to the endpoint, such as </span><span class="No-Break"><span class="koboSpan" id="kobo.562.1">the following:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.563.1">
http://localhost:5247/&gt; cd WeatherForecast/WeatherForecast    [GET]</span></pre>
<p><span class="koboSpan" id="kobo.564.1">Then, we can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.565.1">get</span></strong><span class="koboSpan" id="kobo.566.1"> command to test the endpoint, such as </span><span class="No-Break"><span class="koboSpan" id="kobo.567.1">the following:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.568.1">
http://localhost:5247/WeatherForecast&gt; get</span></pre> <p><span class="koboSpan" id="kobo.569.1">The output looks </span><span class="No-Break"><span class="koboSpan" id="kobo.570.1">like this:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer015">
<span class="koboSpan" id="kobo.571.1"><img alt="Figure 2.9 – Output of HttpRepl" src="image/B18971_02_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.572.1">Figure 2.9 – Output of HttpRepl</span></p>
<p><span class="koboSpan" id="kobo.573.1">To </span><a id="_idIndexMarker169"/><span class="koboSpan" id="kobo.574.1">disconnect, press </span><em class="italic"><span class="koboSpan" id="kobo.575.1">Ctrl</span></em><span class="koboSpan" id="kobo.576.1"> + </span><em class="italic"><span class="koboSpan" id="kobo.577.1">C</span></em> <span class="No-Break"><span class="koboSpan" id="kobo.578.1">to exit.</span></span></p>
<p><span class="koboSpan" id="kobo.579.1">You can fi</span><a id="_idTextAnchor096"/><span class="koboSpan" id="kobo.580.1">nd more information about HttpRepl </span><span class="No-Break"><span class="koboSpan" id="kobo.581.1">at </span></span><a href="https://docs.microsoft.com/en-us/aspnet/core/web-api/http-repl/"><span class="No-Break"><span class="koboSpan" id="kobo.582.1">https://docs.microsoft.com/en-us/aspnet/core/web-api/http-repl/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.583.1">.</span></span></p>
<h3><span class="koboSpan" id="kobo.584.1">Thunder Client</span></h3>
<p><span class="koboSpan" id="kobo.585.1">If you prefer to do everything in </span><a id="_idIndexMarker170"/><span class="koboSpan" id="kobo.586.1">VS Code, </span><strong class="bold"><span class="koboSpan" id="kobo.587.1">Thunder Client</span></strong><span class="koboSpan" id="kobo.588.1"> is a great tool for testing APIs. </span><span class="koboSpan" id="kobo.588.2">Thunder Client is a lightweight REST API client extension for VS Code, allowing users to test their APIs without having to leave VS Code. </span><span class="koboSpan" id="kobo.588.3">This makes it an ideal choice for developers who want to streamline </span><span class="No-Break"><span class="koboSpan" id="kobo.589.1">their workflow:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer016">
<span class="koboSpan" id="kobo.590.1"><img alt="Figure 2.10 – The Thunder Client extension for VS Code" src="image/B18971_02_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.591.1">Figure 2.10 – The Thunder Client extension for VS Code</span></p>
<p><span class="koboSpan" id="kobo.592.1">After the</span><a id="_idIndexMarker171"/><span class="koboSpan" id="kobo.593.1"> installation, click the </span><strong class="bold"><span class="koboSpan" id="kobo.594.1">Thunder Client</span></strong><span class="koboSpan" id="kobo.595.1"> icon on the </span><strong class="bold"><span class="koboSpan" id="kobo.596.1">Action</span></strong><span class="koboSpan" id="kobo.597.1"> bar. </span><span class="koboSpan" id="kobo.597.2">From the sidebar, click the </span><strong class="bold"><span class="koboSpan" id="kobo.598.1">New Request</span></strong><span class="koboSpan" id="kobo.599.1"> button. </span><span class="koboSpan" id="kobo.599.2">The following UI will </span><span class="No-Break"><span class="koboSpan" id="kobo.600.1">be shown:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer017">
<span class="koboSpan" id="kobo.601.1"><img alt="Figure 2.11 – Testing the API with Thunder Client" src="image/B18971_02_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.602.1">Figure 2.11 – Testing the API with Thunder Client</span></p>
<p><span class="koboSpan" id="kobo.603.1">To learn more about Thunder Client, visit their GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.604.1">page: </span></span><a href="https://github.com/rangav/thunder-client-support"><span class="No-Break"><span class="koboSpan" id="kobo.605.1">https://github.com/rangav/thunder-client-support</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.606.1">.</span></span></p>
<h3><span class="koboSpan" id="kobo.607.1">Using .http files in VS 2022</span></h3>
<p><span class="koboSpan" id="kobo.608.1">If you use </span><a id="_idIndexMarker172"/><span class="koboSpan" id="kobo.609.1">Visual Studio 2022, you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.610.1">.http</span></strong><span class="koboSpan" id="kobo.611.1"> file to test the API. </span><span class="koboSpan" id="kobo.611.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.612.1">.http</span></strong><span class="koboSpan" id="kobo.613.1"> file is a text file that contains definitions of HTTP requests. </span><span class="koboSpan" id="kobo.613.2">The latest ASP.NET Core 8 template project provides a default </span><strong class="source-inline"><span class="koboSpan" id="kobo.614.1">.http</span></strong><span class="koboSpan" id="kobo.615.1"> file. </span><span class="koboSpan" id="kobo.615.2">You</span><a id="_idIndexMarker173"/><span class="koboSpan" id="kobo.616.1"> can find it in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.617.1">MyFirstApi</span></strong><span class="koboSpan" id="kobo.618.1"> folder. </span><span class="koboSpan" id="kobo.618.2">The content of the file is </span><span class="No-Break"><span class="koboSpan" id="kobo.619.1">as follows:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.620.1">
@MyFirstApi_HostAddress = http://localhost:5247GET {{MyFirstApi_HostAddress}}/weatherforecast/
Accept: application/json
###</span></pre>
<p><span class="koboSpan" id="kobo.621.1">The first line defines a variable named </span><strong class="source-inline"><span class="koboSpan" id="kobo.622.1">MyFirstApi_HostAddress</span></strong><span class="koboSpan" id="kobo.623.1"> with the value of the root URL of the API. </span><span class="koboSpan" id="kobo.623.2">The second line defines a </span><strong class="source-inline"><span class="koboSpan" id="kobo.624.1">GET</span></strong><span class="koboSpan" id="kobo.625.1"> request to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.626.1">/weatherforecast</span></strong><span class="koboSpan" id="kobo.627.1"> endpoint. </span><span class="koboSpan" id="kobo.627.2">The third line defines an </span><strong class="source-inline"><span class="koboSpan" id="kobo.628.1">Accept</span></strong><span class="koboSpan" id="kobo.629.1"> header. </span><span class="koboSpan" id="kobo.629.2">In this case, it accepts the </span><strong class="source-inline"><span class="koboSpan" id="kobo.630.1">application/json</span></strong><span class="koboSpan" id="kobo.631.1"> content type. </span><span class="koboSpan" id="kobo.631.2">Open this file in Visual Studio 2022, and you will see the </span><strong class="bold"><span class="koboSpan" id="kobo.632.1">Send Request</span></strong><span class="koboSpan" id="kobo.633.1"> button on the left side of the request. </span><span class="koboSpan" id="kobo.633.2">Click the button, and you will see the response </span><span class="No-Break"><span class="koboSpan" id="kobo.634.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer018">
<span class="koboSpan" id="kobo.635.1"><img alt="Figure 2.12 – Using the .http file to test the API in Visual Studio 2022" src="image/B18971_02_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.636.1">Figure 2.12 – Using the .http file to test the API in Visual Studio 2022</span></p>
<p><span class="koboSpan" id="kobo.637.1">However, when </span><a id="_idIndexMarker174"/><span class="koboSpan" id="kobo.638.1">this book was written, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.639.1">.http</span></strong><span class="koboSpan" id="kobo.640.1"> files lacked some features, such as environment variables. </span><span class="koboSpan" id="kobo.640.2">Also, this feature is only </span><a id="_idIndexMarker175"/><span class="koboSpan" id="kobo.641.1">available in Visual Studio 2022, so we will not use it in this book. </span><span class="koboSpan" id="kobo.641.2">But if you are interested in exploring this feature further, please refer to the Microsoft docs at </span><a href="https://learn.microsoft.com/en-us/aspnet/core/test/http-files"><span class="koboSpan" id="kobo.642.1">https://learn.microsoft.com/en-us/aspnet/core/test/http-files</span></a><span class="koboSpan" id="kobo.643.1"> for </span><span class="No-Break"><span class="koboSpan" id="kobo.644.1">more information.</span></span></p>
<p><span class="koboSpan" id="kobo.645.1">We have introduced some tools to test </span><a id="_idTextAnchor097"/><span class="koboSpan" id="kobo.646.1">APIs. </span><span class="koboSpan" id="kobo.646.2">Let's now learn how to </span><span class="No-Break"><span class="koboSpan" id="kobo.647.1">debug APIs.</span></span></p>
<h2 id="_idParaDest-51"><a id="_idTextAnchor098"/><span class="koboSpan" id="kobo.648.1">Debugging</span></h2>
<p><span class="koboSpan" id="kobo.649.1">VS Code has a</span><a id="_idIndexMarker176"/><span class="koboSpan" id="kobo.650.1"> built-in debugging feature that allows you to debug code. </span><span class="koboSpan" id="kobo.650.2">Unlike Visual Studio, it needs a </span><strong class="source-inline"><span class="koboSpan" id="kobo.651.1">launch.json</span></strong><span class="koboSpan" id="kobo.652.1"> configuration for debugging. </span><span class="koboSpan" id="kobo.652.2">When you open an ASP.NET Core project in VS Code, it will prompt you to add some assets. </span><span class="koboSpan" id="kobo.652.3">If you choose </span><strong class="bold"><span class="koboSpan" id="kobo.653.1">Yes</span></strong><span class="koboSpan" id="kobo.654.1">, VS Code can generate a </span><strong class="source-inline"><span class="koboSpan" id="kobo.655.1">launch.json</span></strong><span class="koboSpan" id="kobo.656.1"> file in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.657.1">.</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.658.1">vscode</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.659.1"> folder.</span></span></p>
<p><span class="koboSpan" id="kobo.660.1">If you missed it, you can add it manually from the </span><span class="No-Break"><span class="koboSpan" id="kobo.661.1">Debug view:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer019">
<span class="koboSpan" id="kobo.662.1"><img alt="Figure 2.13 – Creating a launch.json file from the Debug view" src="image/B18971_02_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.663.1">Figure 2.13 – Creating a launch.json file from the Debug view</span></p>
<p><span class="koboSpan" id="kobo.664.1">If you </span><a id="_idIndexMarker177"/><span class="koboSpan" id="kobo.665.1">cannot see the buttons in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.666.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.667.1">.13</span></em><span class="koboSpan" id="kobo.668.1">, you can open the Command Palette by pressing </span><em class="italic"><span class="koboSpan" id="kobo.669.1">Ctrl </span></em><span class="koboSpan" id="kobo.670.1">+</span><em class="italic"><span class="koboSpan" id="kobo.671.1"> Shift </span></em><span class="koboSpan" id="kobo.672.1">+</span><em class="italic"><span class="koboSpan" id="kobo.673.1"> P</span></em><span class="koboSpan" id="kobo.674.1"> (on Windows) or </span><em class="italic"><span class="koboSpan" id="kobo.675.1">Command </span></em><span class="koboSpan" id="kobo.676.1">+</span><em class="italic"><span class="koboSpan" id="kobo.677.1"> Shift </span></em><span class="koboSpan" id="kobo.678.1">+</span><em class="italic"><span class="koboSpan" id="kobo.679.1"> P</span></em><span class="koboSpan" id="kobo.680.1"> (on macOS), then type </span><strong class="source-inline"><span class="koboSpan" id="kobo.681.1">.net</span></strong><span class="koboSpan" id="kobo.682.1"> and choose </span><strong class="bold"><span class="koboSpan" id="kobo.683.1">.NET: Generate Assets for Build and Debug</span></strong><span class="koboSpan" id="kobo.684.1">. </span><span class="koboSpan" id="kobo.684.2">It will then generate a </span><strong class="source-inline"><span class="koboSpan" id="kobo.685.1">launch.json</span></strong><span class="koboSpan" id="kobo.686.1"> file in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.687.1">.</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.688.1">vscode</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.689.1"> folder:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer020">
<span class="koboSpan" id="kobo.690.1"><img alt="Figure 2.14 – Generating a launch.json file from the Command Palette" src="image/B18971_02_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.691.1">Figure 2.14 – Generating a launch.json file from the Command Palette</span></p>
<p><span class="koboSpan" id="kobo.692.1">The </span><a id="_idIndexMarker178"/><span class="koboSpan" id="kobo.693.1">content of the default </span><strong class="source-inline"><span class="koboSpan" id="kobo.694.1">launch.json</span></strong><span class="koboSpan" id="kobo.695.1"> configuration is </span><span class="No-Break"><span class="koboSpan" id="kobo.696.1">shown next:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.697.1">
{</span><strong class="source-inline"><span class="koboSpan" id="kobo.698.1">    "version": "0.2.0",</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.699.1">    "configurations": [</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.700.1">        {</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.701.1">            // Use IntelliSense to find out which attributes exist for C# debugging</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.702.1">            // Use hover for the description of the existing attributes</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.703.1">            // For further information visit https://github.com/dotnet/vscode-csharp/blob/main/debugger-launchjson.md.</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.704.1">            "name": ".NET Core Launch (web)",</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.705.1">            "type": "coreclr",</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.706.1">            "request": "launch",</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.707.1">            "preLaunchTask": "build",</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.708.1">            // If you have changed target frameworks, make sure to update the program path.</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.709.1">            "program": "${workspaceFolder}/bin/Debug/net8.0/MyFirstApi.dll",</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.710.1">            "args": [],</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.711.1">            "cwd": "${workspaceFolder}",</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.712.1">            "stopAtEntry": false,</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.713.1">            // Enable launching a web browser when ASP.NET Core starts. </span><span class="koboSpan" id="kobo.713.2">For more information: https://aka.ms/VSCode-CS-LaunchJson-WebBrowser</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.714.1">            "serverReadyAction": {</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.715.1">                "action": "openExternally",</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.716.1">                "pattern": "\\bNow listening on:\\s+(https?://\\S+)"</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.717.1">            },</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.718.1">            "env": {</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.719.1">                "ASPNETCORE_ENVIRONMENT": "Development"</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.720.1">            },</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.721.1">            "sourceFileMap": {</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.722.1">                "/Views": "${workspaceFolder}/Views"</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.723.1">            }</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.724.1">        },</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.725.1">        {</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.726.1">            "name": ".NET Core Attach",</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.727.1">            "type": "coreclr",</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.728.1">            "request": "attach"</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.729.1">        }</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.730.1">    ]</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.731.1">}</span></strong></pre>
<p><span class="koboSpan" id="kobo.732.1">This file specifies </span><a id="_idIndexMarker179"/><span class="koboSpan" id="kobo.733.1">the configuration for debugging. </span><span class="koboSpan" id="kobo.733.2">Some important attributes are </span><span class="No-Break"><span class="koboSpan" id="kobo.734.1">described next:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.735.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.736.1">program</span></strong><span class="koboSpan" id="kobo.737.1"> attribute specifies the path to the </span><span class="No-Break"><span class="koboSpan" id="kobo.738.1">executable file</span></span></li>
<li><span class="koboSpan" id="kobo.739.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.740.1">args</span></strong><span class="koboSpan" id="kobo.741.1"> attribute specifies the arguments to pass to the </span><span class="No-Break"><span class="koboSpan" id="kobo.742.1">executable file</span></span></li>
<li><span class="koboSpan" id="kobo.743.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.744.1">cwd</span></strong><span class="koboSpan" id="kobo.745.1"> attribute specifies the </span><span class="No-Break"><span class="koboSpan" id="kobo.746.1">working directory</span></span></li>
<li><span class="koboSpan" id="kobo.747.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.748.1">env</span></strong><span class="koboSpan" id="kobo.749.1"> attribute specifies the </span><span class="No-Break"><span class="koboSpan" id="kobo.750.1">environment variables</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.751.1">We do not need to change anything in this </span><span class="No-Break"><span class="koboSpan" id="kobo.752.1">file now.</span></span></p>
<p><span class="koboSpan" id="kobo.753.1">Set up a breakpoint in the app. </span><span class="koboSpan" id="kobo.753.2">For example, we can set a breakpoint in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.754.1">Get()</span></strong><span class="koboSpan" id="kobo.755.1"> method in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.756.1">WeatherForecastController.cs</span></strong><span class="koboSpan" id="kobo.757.1"> file by clicking in the left margin of the code window. </span><span class="koboSpan" id="kobo.757.2">Once the breakpoint is set, you will see a red dot before the line number in the </span><span class="No-Break"><span class="koboSpan" id="kobo.758.1">left margin:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer021">
<span class="koboSpan" id="kobo.759.1"><img alt="Figure 2.15 – Setting up a breakpoint in VS Code" src="image/B18971_02_15.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.760.1">Figure 2.15 – Setting up a breakpoint in VS Code</span></p>
<p><span class="koboSpan" id="kobo.761.1">To debug the app, open the </span><strong class="bold"><span class="koboSpan" id="kobo.762.1">Debug</span></strong><span class="koboSpan" id="kobo.763.1"> view by selecting the </span><strong class="bold"><span class="koboSpan" id="kobo.764.1">Debugging</span></strong><span class="koboSpan" id="kobo.765.1"> icon on the left-side menu. </span><span class="koboSpan" id="kobo.765.2">Make sure you choose the correct debugging configuration from the drop-down menu. </span><span class="koboSpan" id="kobo.765.3">For this case, please select </span><strong class="bold"><span class="koboSpan" id="kobo.766.1">.NET Core Launch (web)</span></strong><span class="koboSpan" id="kobo.767.1">. </span><span class="koboSpan" id="kobo.767.2">Then, select the green </span><a id="_idIndexMarker180"/><span class="koboSpan" id="kobo.768.1">arrow at the top of </span><span class="No-Break"><span class="koboSpan" id="kobo.769.1">the pane:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer022">
<span class="koboSpan" id="kobo.770.1"><img alt="Figure 2.16 – Debugging the API in VS Code" src="image/B18971_02_16.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.771.1">Figure 2.16 – Debugging the API in VS Code</span></p>
<p><span class="koboSpan" id="kobo.772.1">Send a</span><a id="_idIndexMarker181"/><span class="koboSpan" id="kobo.773.1"> request from any of the tools in the previous section, and you will see the program execution stops when it reaches the breakpoint, as </span><span class="No-Break"><span class="koboSpan" id="kobo.774.1">shown next:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer023">
<span class="koboSpan" id="kobo.775.1"><img alt="Figure 2.17 – Hitting the breakpoint in VS Code" src="image/B18971_02_17.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.776.1">Figure 2.17 – Hitting the breakpoint in VS Code</span></p>
<p><span class="koboSpan" id="kobo.777.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.778.1">Locals</span></strong><span class="koboSpan" id="kobo.779.1"> section of the </span><strong class="bold"><span class="koboSpan" id="kobo.780.1">VARIABLES</span></strong><span class="koboSpan" id="kobo.781.1"> window will display the values of variables that are defined in the </span><span class="No-Break"><span class="koboSpan" id="kobo.782.1">current context.</span></span></p>
<p><span class="koboSpan" id="kobo.783.1">You can also type a</span><a id="_idIndexMarker182"/><span class="koboSpan" id="kobo.784.1"> variable in the </span><strong class="bold"><span class="koboSpan" id="kobo.785.1">DEBUG CONSOLE</span></strong><span class="koboSpan" id="kobo.786.1"> window to check the value directly. </span><span class="koboSpan" id="kobo.786.2">To execute the next step, you can use the control toolbar at the top of the VS Code window. </span><span class="koboSpan" id="kobo.786.3">You can run the code line by line to monitor its execution. </span><span class="koboSpan" id="kobo.786.4">It is helpful if we need to know how the </span><span class="No-Break"><span class="koboSpan" id="kobo.787.1">program works.</span></span></p>
<p><span class="koboSpan" id="kobo.788.1">Now we have learned how to build, run, and test AP</span><a id="_idTextAnchor099"/><span class="koboSpan" id="kobo.789.1">Is, it is time to look at the code </span><span class="No-Break"><span class="koboSpan" id="kobo.790.1">of APIs.</span></span></p>
<h1 id="_idParaDest-52"><a id="_idTextAnchor100"/><span class="koboSpan" id="kobo.791.1">Understanding the MVC pattern</span></h1>
<p><span class="koboSpan" id="kobo.792.1">ASP.NET Core MVC is a rich </span><a id="_idIndexMarker183"/><span class="koboSpan" id="kobo.793.1">framework for building web applications with the </span><strong class="bold"><span class="koboSpan" id="kobo.794.1">Model-View-Controller</span></strong><span class="koboSpan" id="kobo.795.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.796.1">MVC</span></strong><span class="koboSpan" id="kobo.797.1">) design pattern. </span><span class="koboSpan" id="kobo.797.2">The MVC pattern enables web applications to separate the presentation from the business logic. </span><span class="koboSpan" id="kobo.797.3">An ASP.NET Core web API project follows the basic MVC pattern, but it does not have views, so it only has a Model layer and a Controller layer. </span><span class="koboSpan" id="kobo.797.4">Let’s look at this in a bit </span><span class="No-Break"><span class="koboSpan" id="kobo.798.1">more detail:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.799.1">Models</span></strong><span class="koboSpan" id="kobo.800.1">: Models</span><a id="_idIndexMarker184"/><span class="koboSpan" id="kobo.801.1"> are classes that represent the data that is used in the application. </span><span class="koboSpan" id="kobo.801.2">Normally, the data is stored in </span><span class="No-Break"><span class="koboSpan" id="kobo.802.1">a database.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.803.1">Controllers</span></strong><span class="koboSpan" id="kobo.804.1">: Controllers</span><a id="_idIndexMarker185"/><span class="koboSpan" id="kobo.805.1"> are classes that handle the business logic of the application. </span><span class="koboSpan" id="kobo.805.2">Based on the convention of ASP.NET Core, controllers are stored in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.806.1">Contro</span><a id="_idTextAnchor101"/><span class="koboSpan" id="kobo.807.1">llers</span></strong><span class="koboSpan" id="kobo.808.1"> folder. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.809.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.810.1">.18</span></em><span class="koboSpan" id="kobo.811.1"> shows an example of the MVC pattern in an web API project. </span><span class="koboSpan" id="kobo.811.2">However, the view layer is not included in the web API project. </span><span class="koboSpan" id="kobo.811.3">The request from the client will be mapped to the controller, and the controller will execute the business logic and return the response to </span><span class="No-Break"><span class="koboSpan" id="kobo.812.1">the client.</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer024">
<span class="koboSpan" id="kobo.813.1"><img alt="Figure 2.18 – The MVC pattern" src="image/B18971_02_18.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.814.1">Figure 2.18 – The MVC pattern</span></p>
<p><span class="koboSpan" id="kobo.815.1">Next, we will look at the code of the model and the controller in an ASP.NET Core web </span><span class="No-Break"><span class="koboSpan" id="kobo.816.1">API project.</span></span></p>
<h2 id="_idParaDest-53"><a id="_idTextAnchor102"/><span class="koboSpan" id="kobo.817.1">The model and the controller</span></h2>
<p><span class="koboSpan" id="kobo.818.1">In the ASP.NET Core template project, you can find a file named </span><strong class="source-inline"><span class="koboSpan" id="kobo.819.1">WeatherForecast.cs</span></strong><span class="koboSpan" id="kobo.820.1">. </span><span class="koboSpan" id="kobo.820.2">This file is a model. </span><span class="koboSpan" id="kobo.820.3">It is a pure C# class that represents a </span><span class="No-Break"><span class="koboSpan" id="kobo.821.1">data model.</span></span></p>
<p><span class="koboSpan" id="kobo.822.1">The controller is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.823.1">WeatherForecastController.cs</span></strong><span class="koboSpan" id="kobo.824.1"> file located in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.825.1">Controllers</span></strong><span class="koboSpan" id="kobo.826.1"> folder. </span><span class="koboSpan" id="kobo.826.2">It </span><a id="_idIndexMarker186"/><span class="koboSpan" id="kobo.827.1">contains </span><a id="_idIndexMarker187"/><span class="koboSpan" id="kobo.828.1">the </span><span class="No-Break"><span class="koboSpan" id="kobo.829.1">business logic.</span></span></p>
<p><span class="koboSpan" id="kobo.830.1">It looks </span><span class="No-Break"><span class="koboSpan" id="kobo.831.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.832.1">
[ApiController][Route("[controller]")]
public class WeatherForecastController : ControllerBase
{
    // Some code is ignored
    private readonly ILogger&lt;WeatherForecastController&gt; _logger;
    public WeatherForecastController(ILogger&lt;WeatherForecastController&gt; logger)
    {
        _logger = logger;
    }
    [HttpGet(Name = "GetWeatherForecast")]
    public IEnumerable&lt;WeatherForecast&gt; Get()
    {
        return Enumerable.Range(1, 5).Select(index =&gt; new WeatherForecast
        {
            Date = DateOnly.FromDateTime(DateTime.Now.AddDays(index)),
            TemperatureC = Random.Shared.Next(-20, 55),
            Summary = Summaries[Random.Shared.Next(Summaries.Length)]
        })
        .ToArray();
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.833.1">The constructor of the controller class has a parameter named </span><strong class="source-inline"><span class="koboSpan" id="kobo.834.1">ILogger&lt;WeatherForecastController&gt; logger</span></strong><span class="koboSpan" id="kobo.835.1">. </span><span class="koboSpan" id="kobo.835.2">This parameter is used to log messages. </span><span class="koboSpan" id="kobo.835.3">It is injected with DI by the ASP.NET Core framework. </span><span class="koboSpan" id="kobo.835.4">We will talk about DI in the </span><span class="No-Break"><span class="koboSpan" id="kobo.836.1">next section.</span></span></p>
<p><span class="koboSpan" id="kobo.837.1">This class has an </span><strong class="source-inline"><span class="koboSpan" id="kobo.838.1">[ApiController]</span></strong><span class="koboSpan" id="kobo.839.1"> attribute that indicates that it is a web API controller. </span><span class="koboSpan" id="kobo.839.2">It also has a </span><strong class="source-inline"><span class="koboSpan" id="kobo.840.1">[Route("[controller]")]</span></strong><span class="koboSpan" id="kobo.841.1"> attribute that indicates the URL of </span><span class="No-Break"><span class="koboSpan" id="kobo.842.1">the controller.</span></span></p>
<p><span class="koboSpan" id="kobo.843.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.844.1">Get()</span></strong><span class="koboSpan" id="kobo.845.1"> method has a </span><strong class="source-inline"><span class="koboSpan" id="kobo.846.1">[HttpGet(Name = "GetWeatherForecast")]</span></strong><span class="koboSpan" id="kobo.847.1"> attribute that indicates the name of the endpoint, and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.848.1">Get()</span></strong><span class="koboSpan" id="kobo.849.1"> method is a </span><strong class="source-inline"><span class="koboSpan" id="kobo.850.1">GET</span></strong><span class="koboSpan" id="kobo.851.1"> operation. </span><span class="koboSpan" id="kobo.851.2">This method returns a list of weather forecasts as </span><span class="No-Break"><span class="koboSpan" id="kobo.852.1">the response.</span></span></p>
<p><span class="koboSpan" id="kobo.853.1">Note that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.854.1">[Route("[controller]")]</span></strong><span class="koboSpan" id="kobo.855.1"> attribute is marked on the controller class. </span><span class="koboSpan" id="kobo.855.2">It means the path of the controller is </span><strong class="source-inline"><span class="koboSpan" id="kobo.856.1">/WeatherForecast</span></strong><span class="koboSpan" id="kobo.857.1">. </span><span class="koboSpan" id="kobo.857.2">Currently, there is no </span><strong class="source-inline"><span class="koboSpan" id="kobo.858.1">[Route]</span></strong><span class="koboSpan" id="kobo.859.1"> attribute on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.860.1">Get()</span></strong><span class="koboSpan" id="kobo.861.1"> method. </span><span class="koboSpan" id="kobo.861.2">We will learn more about routing in </span><span class="No-Break"><span class="koboSpan" id="kobo.862.1">future sections.</span></span></p>
<p><span class="koboSpan" id="kobo.863.1">We should now </span><a id="_idIndexMarker188"/><span class="koboSpan" id="kobo.864.1">have a basic </span><a id="_idIndexMarker189"/><span class="koboSpan" id="kobo.865.1">understanding of how ASP.NET Core web API works. </span><span class="koboSpan" id="kobo.865.2">The client sends the request to the web API, and the request will be mapped to the controller and the method. </span><span class="koboSpan" id="kobo.865.3">The controller will execute the business logic and return the response. </span><span class="koboSpan" id="kobo.865.4">We can use some methods to get, save, update, and delete data from the database in </span><span class="No-Break"><span class="koboSpan" id="kobo.866.1">the controllers.</span></span></p>
<p><span class="koboSpan" id="kobo.867.1">Next, let us create a new A</span><a id="_idTextAnchor103"/><span class="koboSpan" id="kobo.868.1">PI endpoint by adding a new model </span><span class="No-Break"><span class="koboSpan" id="kobo.869.1">and controller.</span></span></p>
<h2 id="_idParaDest-54"><a id="_idTextAnchor104"/><span class="koboSpan" id="kobo.870.1">Creating a new model and controller</span></h2>
<p><span class="koboSpan" id="kobo.871.1">In </span><a href="B18971_01.xhtml#_idTextAnchor012"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.872.1">Chapter 1</span></em></span></a><span class="koboSpan" id="kobo.873.1">, we showed an example REST API on </span><a href="https://jsonplaceholder.typicode.com/posts"><span class="koboSpan" id="kobo.874.1">https://jsonplaceholder.typicode.com/posts</span></a><span class="koboSpan" id="kobo.875.1">. </span><span class="koboSpan" id="kobo.875.2">It </span><a id="_idIndexMarker190"/><span class="koboSpan" id="kobo.876.1">returns a list of posts, as </span><span class="No-Break"><span class="koboSpan" id="kobo.877.1">shown next:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.878.1">
[  {
    "userId": 1,
    "id": 1,
    "title": "sunt aut facere repellat provident occaecati excepturi optio reprehenderit",
    "body": "quia et suscipit\nsuscipit recusandae consequuntur expedita et cum\nreprehenderit molestiae ut ut quas totam\nnostrum rerum est autem sunt rem eveniet architecto"
  },
  {
    "userId": 1,
    "id": 2,
    "title": "qui est esse",
    "body": "est rerum tempore vitae\nsequi sint nihil reprehenderit dolor beatae ea dolores neque\nfugiat blanditiis voluptate porro vel nihil molestiae ut reiciendis\nqui aperiam non debitis possimus qui neque nisi nulla"
  },
  ...
</span><span class="koboSpan" id="kobo.878.2">]</span></pre>
<p><span class="koboSpan" id="kobo.879.1">Let us implement a similar API. </span><span class="koboSpan" id="kobo.879.2">First, we need to create a new model. </span><span class="koboSpan" id="kobo.879.3">Create a new folder named </span><strong class="source-inline"><span class="koboSpan" id="kobo.880.1">Models</span></strong><span class="koboSpan" id="kobo.881.1"> in the project. </span><span class="koboSpan" id="kobo.881.2">Then, create</span><a id="_idIndexMarker191"/><span class="koboSpan" id="kobo.882.1"> a new file named </span><strong class="source-inline"><span class="koboSpan" id="kobo.883.1">Post.cs</span></strong><span class="koboSpan" id="kobo.884.1"> in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.885.1">Models</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.886.1"> folder:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.887.1">
namespace MyFirstApi.Models;public class Post
{
    public int UserId { get; set; }
    public int Id { get; set; }
    public string Title { get; set; } = string.Empty;
    public string Body { get; set; } = string.Empty;
}</span></pre>
<p class="callout-heading"><span class="koboSpan" id="kobo.888.1">File-scoped namespace declaration</span></p>
<p class="callout"><span class="koboSpan" id="kobo.889.1">From C# 10, you can use a new form of namespace declaration, as shown in the previous code snippet, which is called a file-scoped namespace declaration. </span><span class="koboSpan" id="kobo.889.2">All the members in this file are in the same namespace. </span><span class="koboSpan" id="kobo.889.3">It saves space and </span><span class="No-Break"><span class="koboSpan" id="kobo.890.1">reduces indentation.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.891.1">Nullable reference types</span></p>
<p class="callout"><span class="koboSpan" id="kobo.892.1">You may be wondering why we assign an empty string to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.893.1">Title</span></strong><span class="koboSpan" id="kobo.894.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.895.1">Body</span></strong><span class="koboSpan" id="kobo.896.1"> properties. </span><span class="koboSpan" id="kobo.896.2">This is because the properties are of type </span><strong class="source-inline"><span class="koboSpan" id="kobo.897.1">string</span></strong><span class="koboSpan" id="kobo.898.1">. </span><span class="koboSpan" id="kobo.898.2">If we do not initialize the property, the compiler </span><span class="No-Break"><span class="koboSpan" id="kobo.899.1">will complain:</span></span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.900.1">Non-nullable property 'Title' must contain a non-null value when exiting constructor. </span><span class="koboSpan" id="kobo.900.2">Consider declaring the property </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.901.1">as nullable.</span></strong></span></p>
<p class="callout"><span class="koboSpan" id="kobo.902.1">By default, the ASP.NET Core web API project template enabled the </span><strong class="bold"><span class="koboSpan" id="kobo.903.1">nullable reference types</span></strong><span class="koboSpan" id="kobo.904.1"> annotation</span><a id="_idIndexMarker192"/><span class="koboSpan" id="kobo.905.1"> in the project properties. </span><span class="koboSpan" id="kobo.905.2">If you check the project file, you will find </span><strong class="source-inline"><span class="koboSpan" id="kobo.906.1">&lt;Nullable&gt;enable&lt;/Nullable&gt;</span></strong><span class="koboSpan" id="kobo.907.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.908.1">&lt;</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.909.1">PropertyGroup&gt;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.910.1"> section.</span></span></p>
<p class="callout"><span class="koboSpan" id="kobo.911.1">Nullable reference types were introduced in C# 8.0. </span><span class="koboSpan" id="kobo.911.2">They can minimize the likelihood of errors that cause the runtime to throw a </span><strong class="source-inline"><span class="koboSpan" id="kobo.912.1">System.NullReferenceException</span></strong><span class="koboSpan" id="kobo.913.1"> error. </span><span class="koboSpan" id="kobo.913.2">For example, if we forget to initialize the </span><strong class="source-inline"><span class="koboSpan" id="kobo.914.1">Title</span></strong><span class="koboSpan" id="kobo.915.1"> property, we may get a </span><strong class="source-inline"><span class="koboSpan" id="kobo.916.1">System.NullReferenceException</span></strong><span class="koboSpan" id="kobo.917.1"> error when we try to access a property of it, such </span><span class="No-Break"><span class="koboSpan" id="kobo.918.1">as </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.919.1">Title.Length</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.920.1">.</span></span></p>
<p class="callout"><span class="koboSpan" id="kobo.921.1">With this feature enabled, any variable of a reference type is considered to be non-nullable. </span><span class="koboSpan" id="kobo.921.2">If you want to allow a variable to be nullable, you must append the type name with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.922.1">?</span></strong><span class="koboSpan" id="kobo.923.1"> operator to declare the variable as a nullable reference type; for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.924.1">public string Title? </span><span class="koboSpan" id="kobo.924.2">{ get; set; }</span></strong><span class="koboSpan" id="kobo.925.1">, which explicitly marks the property </span><span class="No-Break"><span class="koboSpan" id="kobo.926.1">as nullable.</span></span></p>
<p class="callout"><span class="koboSpan" id="kobo.927.1">To learn more about this feature, </span><span class="No-Break"><span class="koboSpan" id="kobo.928.1">see </span></span><a href="https://docs.microsoft.com/en-us/dotnet/csharp/nullable-references"><span class="No-Break"><span class="koboSpan" id="kobo.929.1">https://docs.microsoft.com/en-us/dotnet/csharp/nullable-references</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.930.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.931.1">Next, create </span><a id="_idIndexMarker193"/><span class="koboSpan" id="kobo.932.1">a new file named </span><strong class="source-inline"><span class="koboSpan" id="kobo.933.1">PostController.cs</span></strong><span class="koboSpan" id="kobo.934.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.935.1">Controllers</span></strong><span class="koboSpan" id="kobo.936.1"> folder. </span><span class="koboSpan" id="kobo.936.2">You can manually add it, or install the </span><strong class="source-inline"><span class="koboSpan" id="kobo.937.1">dotnet-aspnet-codegenerator</span></strong><span class="koboSpan" id="kobo.938.1"> tool to create it. </span><span class="koboSpan" id="kobo.938.2">To install the tool, run the following commands from the </span><span class="No-Break"><span class="koboSpan" id="kobo.939.1">project folder:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.940.1">
dotnet add package Microsoft.VisualStudio.Web.CodeGeneration.Designdotnet tool install -g dotnet-aspnet-codegenerator</span></pre>
<p><span class="koboSpan" id="kobo.941.1">The preceding commands install a NuGet package required for scaffolding. </span><span class="koboSpan" id="kobo.941.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.942.1">dotnet-aspnet-codegenerator</span></strong><span class="koboSpan" id="kobo.943.1"> tool is a scaffolding engine that is used to </span><span class="No-Break"><span class="koboSpan" id="kobo.944.1">generate code.</span></span></p>
<p><span class="koboSpan" id="kobo.945.1">Then, run the following command to generate </span><span class="No-Break"><span class="koboSpan" id="kobo.946.1">a controller:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.947.1">
dotnet-aspnet-codegenerator controller -name PostsController -api -outDir Controllers</span></pre> <p><span class="koboSpan" id="kobo.948.1">The preceding command generates an empty controller. </span><span class="koboSpan" id="kobo.948.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.949.1">-name</span></strong><span class="koboSpan" id="kobo.950.1"> option specifies the name of the controller. </span><span class="koboSpan" id="kobo.950.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.951.1">-api</span></strong><span class="koboSpan" id="kobo.952.1"> option indicates that the controller is an API controller. </span><span class="koboSpan" id="kobo.952.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.953.1">-outDir</span></strong><span class="koboSpan" id="kobo.954.1"> option specifies the output directory. </span><span class="koboSpan" id="kobo.954.2">Update the content of the </span><a id="_idIndexMarker194"/><span class="koboSpan" id="kobo.955.1">controller </span><span class="No-Break"><span class="koboSpan" id="kobo.956.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.957.1">
using Microsoft.AspNetCore.Mvc;using MyFirstApi.Models;
namespace MyFirstApi.Controllers;
[Route("api/[controller]")]
[ApiController]
public class PostsController : ControllerBase
{
    [HttpGet]
    public ActionResult&lt;List&lt;Post&gt;&gt; GetPosts()
    {
        return new List&lt;Post&gt;
        {
            new() { Id = 1, UserId = 1, Title = "Post1", Body = "The first post." </span><span class="koboSpan" id="kobo.957.2">},
            new() { Id = 2, UserId = 1, Title = "Post2", Body = "The second post." </span><span class="koboSpan" id="kobo.957.3">},
            new() { Id = 3, UserId = 1, Title = "Post3", Body = "The third post." </span><span class="koboSpan" id="kobo.957.4">}
        };
    }
}</span></pre>
<p class="callout-heading"><span class="koboSpan" id="kobo.958.1">Target-typed new expressions</span></p>
<p class="callout"><span class="koboSpan" id="kobo.959.1">When we create a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.960.1">List</span></strong><span class="koboSpan" id="kobo.961.1"> instance of a specific type, we will normally use code </span><span class="No-Break"><span class="koboSpan" id="kobo.962.1">like this:</span></span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.963.1">var list = </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.964.1">new List&lt;Post&gt;</span></strong></span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.965.1">{</span></strong></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.966.1"> new Post() { Id = 1, UserId = 1, Title = "Post1", Body = "The first </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.967.1">post." </span><span class="koboSpan" id="kobo.967.2">},</span></strong></span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.968.1">};</span></strong></p>
<p class="callout"><span class="koboSpan" id="kobo.969.1">When the list is declared as </span><strong class="source-inline"><span class="koboSpan" id="kobo.970.1">List&lt;Post&gt;</span></strong><span class="koboSpan" id="kobo.971.1">, the type is known, so it is not necessary to use </span><strong class="source-inline"><span class="koboSpan" id="kobo.972.1">new Post()</span></strong><span class="koboSpan" id="kobo.973.1"> here when adding new elements. </span><span class="koboSpan" id="kobo.973.2">The type specification can be omitted for constructors, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.974.1">new()</span></strong><span class="koboSpan" id="kobo.975.1">. </span><span class="koboSpan" id="kobo.975.2">This feature was introduced in </span><span class="No-Break"><span class="koboSpan" id="kobo.976.1">C# 9.0.</span></span></p>
<p><span class="koboSpan" id="kobo.977.1">The</span><a id="_idIndexMarker195"/><span class="koboSpan" id="kobo.978.1"> controller is named </span><strong class="source-inline"><span class="koboSpan" id="kobo.979.1">PostsController</span></strong><span class="koboSpan" id="kobo.980.1">. </span><span class="koboSpan" id="kobo.980.2">The convention is the resource name with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.981.1">Controller</span></strong><span class="koboSpan" id="kobo.982.1"> suffix. </span><span class="koboSpan" id="kobo.982.2">It is marked with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.983.1">ApiController</span></strong><span class="koboSpan" id="kobo.984.1"> attribute, which indicates that the controller is a web API controller. </span><span class="koboSpan" id="kobo.984.2">It also has a </span><strong class="source-inline"><span class="koboSpan" id="kobo.985.1">[Route("api/[controller]")]</span></strong><span class="koboSpan" id="kobo.986.1"> attribute that indicates the URL of the controller. </span><strong class="source-inline"><span class="koboSpan" id="kobo.987.1">[controller]</span></strong><span class="koboSpan" id="kobo.988.1"> is like a placeholder, which will be replaced with the name of the controller in the routing. </span><span class="koboSpan" id="kobo.988.2">So, the route of this controller </span><span class="No-Break"><span class="koboSpan" id="kobo.989.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.990.1">/api/posts</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.991.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.992.1">In this controller, we have a method named </span><strong class="source-inline"><span class="koboSpan" id="kobo.993.1">GetPosts()</span></strong><span class="koboSpan" id="kobo.994.1">. </span><span class="koboSpan" id="kobo.994.2">This method returns a list of posts as the response. </span><span class="koboSpan" id="kobo.994.3">The method is marked with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.995.1">[HttpGet]</span></strong><span class="koboSpan" id="kobo.996.1"> attribute, which indicates that this method is a </span><strong class="source-inline"><span class="koboSpan" id="kobo.997.1">GET</span></strong><span class="koboSpan" id="kobo.998.1"> operation. </span><span class="koboSpan" id="kobo.998.2">It does not have any route template, because it will match </span><strong class="source-inline"><span class="koboSpan" id="kobo.999.1">/api/posts</span></strong><span class="koboSpan" id="kobo.1000.1">. </span><span class="koboSpan" id="kobo.1000.2">For other methods, we can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1001.1">[Route("[action]")]</span></strong><span class="koboSpan" id="kobo.1002.1"> attribute to specify the </span><span class="No-Break"><span class="koboSpan" id="kobo.1003.1">route template.</span></span></p>
<p><span class="koboSpan" id="kobo.1004.1">The return type of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1005.1">GetPosts()</span></strong><span class="koboSpan" id="kobo.1006.1"> method is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1007.1">ActionResult&lt;IEnumerable&lt;Post&gt;&gt;</span></strong><span class="koboSpan" id="kobo.1008.1">. </span><span class="koboSpan" id="kobo.1008.2">ASP.NET Core can automatically convert the object to JSON and return it to the client in the response message. </span><span class="koboSpan" id="kobo.1008.3">Also, it can return other HTTP status codes, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1009.1">NotFound</span></strong><span class="koboSpan" id="kobo.1010.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1011.1">BadRequest</span></strong><span class="koboSpan" id="kobo.1012.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1013.1">InternalServerError</span></strong><span class="koboSpan" id="kobo.1014.1">, and so on. </span><span class="koboSpan" id="kobo.1014.2">We will see more </span><span class="No-Break"><span class="koboSpan" id="kobo.1015.1">examples later.</span></span></p>
<p><span class="koboSpan" id="kobo.1016.1">If you run </span><strong class="source-inline"><span class="koboSpan" id="kobo.1017.1">dotnet run</span></strong><span class="koboSpan" id="kobo.1018.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1019.1">dotnet watch</span></strong><span class="koboSpan" id="kobo.1020.1">, then navigate to Swagger UI, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1021.1">https://localhost:7291/swagger/index.html</span></strong><span class="koboSpan" id="kobo.1022.1">, you will see the new API listed. </span><span class="koboSpan" id="kobo.1022.2">The API is accessible </span><span class="No-Break"><span class="koboSpan" id="kobo.1023.1">at </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1024.1">/api/posts</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1025.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1026.1">Currently, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1027.1">/api/posts</span></strong><span class="koboSpan" id="kobo.1028.1"> endpoint </span><a id="_idIndexMarker196"/><span class="koboSpan" id="kobo.1029.1">returns a hardcoded list of posts. </span><span class="koboSpan" id="kobo.1029.2">Let us update </span><a id="_idTextAnchor105"/><span class="koboSpan" id="kobo.1030.1">the controller to return a list of posts from </span><span class="No-Break"><span class="koboSpan" id="kobo.1031.1">a service.</span></span></p>
<h2 id="_idParaDest-55"><a id="_idTextAnchor106"/><span class="koboSpan" id="kobo.1032.1">Creating a service</span></h2>
<p><span class="koboSpan" id="kobo.1033.1">Create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1034.1">Services</span></strong><span class="koboSpan" id="kobo.1035.1"> folder</span><a id="_idIndexMarker197"/><span class="koboSpan" id="kobo.1036.1"> in the project. </span><span class="koboSpan" id="kobo.1036.2">Then, create a new file named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1037.1">PostService.cs</span></strong><span class="koboSpan" id="kobo.1038.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1039.1">Services</span></strong><span class="koboSpan" id="kobo.1040.1"> folder, as </span><span class="No-Break"><span class="koboSpan" id="kobo.1041.1">shown next:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1042.1">
using MyFirstApi.Models;namespace MyFirstApi.Services;
public class PostsService
{
    private static readonly List&lt;Post&gt; AllPosts = new();
    public Task CreatePost(Post item)
    {
        AllPosts.Add(item);
        return Task.CompletedTask;
    }
    public Task&lt;Post?&gt; UpdatePost(int id, Post item)
    {
        var post = AllPosts.FirstOrDefault(x =&gt; x.Id == id);
        if (post != null)
        {
            post.Title = item.Title;
            post.Body = item.Body;
            post.UserId = item.UserId;
        }
        return Task.FromResult(post);
    }
    public Task&lt;Post?&gt; GetPost(int id)
    {
        return Task.FromResult(AllPosts.FirstOrDefault(x =&gt; x.Id == id));
    }
    public Task&lt;List&lt;Post&gt;&gt; GetAllPosts()
    {
        return Task.FromResult(AllPosts);
    }
    public Task DeletePost(int id)
    {
        var post = AllPosts.FirstOrDefault(x =&gt; x.Id == id);
        if (post != null)
        {
            AllPosts.Remove(post);
        }
        return Task.CompletedTask;
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.1043.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1044.1">PostsService</span></strong><span class="koboSpan" id="kobo.1045.1"> class is </span><a id="_idIndexMarker198"/><span class="koboSpan" id="kobo.1046.1">a simple demo service that manages the list of posts. </span><span class="koboSpan" id="kobo.1046.2">It has methods to create, update, and delete posts. </span><span class="koboSpan" id="kobo.1046.3">To simplify the implementation, it uses a static field to store the list of posts. </span><span class="koboSpan" id="kobo.1046.4">This is just for demonstration purposes; please do not use this </span><span class="No-Break"><span class="koboSpan" id="kobo.1047.1">in production.</span></span></p>
<p><span class="koboSpan" id="kobo.1048.1">Next, we will follow the API design to implement CRUD operations. </span><span class="koboSpan" id="kobo.1048.2">You can review </span><a id="_idTextAnchor107"/><span class="koboSpan" id="kobo.1049.1">the </span><em class="italic"><span class="koboSpan" id="kobo.1050.1">REST-based API design</span></em><span class="koboSpan" id="kobo.1051.1"> section of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1052.1">previous chapter.</span></span></p>
<h2 id="_idParaDest-56"><a id="_idTextAnchor108"/><span class="koboSpan" id="kobo.1053.1">Implementing a GET operation</span></h2>
<p><span class="koboSpan" id="kobo.1054.1">The</span><a id="_idIndexMarker199"/><span class="koboSpan" id="kobo.1055.1"> design for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1056.1">viewPost()</span></strong><span class="koboSpan" id="kobo.1057.1"> operation is </span><span class="No-Break"><span class="koboSpan" id="kobo.1058.1">as follows:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-2">
<colgroup>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1059.1">Operation name</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1060.1">URL</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1061.1">HTTP method</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1062.1">Input</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1063.1">Response</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1064.1">Description</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1065.1">viewPost()</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1066.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1067.1">posts/{postId}</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1068.1">GET</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.1069.1">PostId</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.1070.1">Post, 200</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.1071.1">View a </span><span class="No-Break"><span class="koboSpan" id="kobo.1072.1">post detail</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Figure"><span class="koboSpan" id="kobo.1073.1">Table 2.1 – The design for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1074.1">viewPost()</span></strong><span class="koboSpan" id="kobo.1075.1"> operation</span></p>
<p><span class="koboSpan" id="kobo.1076.1">Update </span><a id="_idIndexMarker200"/><span class="koboSpan" id="kobo.1077.1">the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1078.1">PostController</span></strong><span class="koboSpan" id="kobo.1079.1"> class </span><span class="No-Break"><span class="koboSpan" id="kobo.1080.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1081.1">
using Microsoft.AspNetCore.Mvc;using MyFirstApi.Models;
using MyFirstApi.Services;
namespace MyFirstApi.Controllers;
[Route("api/[controller]")]
[ApiController]
public class PostsController : ControllerBase
{
    private readonly PostsService _postsService;
    public PostsController()
    {
        _postsService = new PostsService();
    }
    [HttpGet("{id}")]
    public async Task&lt;ActionResult&lt;Post&gt;&gt; GetPost(int id)
    {
        var post = await _postsService.GetPost(id);
        if (post == null)
        {
            return NotFound();
        }
        return Ok(post);
    }
    // Omitted for brevity
}</span></pre>
<p><span class="koboSpan" id="kobo.1082.1">In the</span><a id="_idIndexMarker201"/><span class="koboSpan" id="kobo.1083.1"> constructor method of the controller, we initialize the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1084.1">_postsService</span></strong><span class="koboSpan" id="kobo.1085.1"> field. </span><span class="koboSpan" id="kobo.1085.2">Note that we use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1086.1">new()</span></strong><span class="koboSpan" id="kobo.1087.1"> constructor to create an instance of the service. </span><span class="koboSpan" id="kobo.1087.2">That means the controller is coupled with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1088.1">PostsService</span></strong><span class="koboSpan" id="kobo.1089.1"> class. </span><span class="koboSpan" id="kobo.1089.2">We will see how to decouple the controller and the service in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1090.1">next chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.1091.1">Then, create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1092.1">GetPost()</span></strong><span class="koboSpan" id="kobo.1093.1"> method that returns a post with the specified ID. </span><span class="koboSpan" id="kobo.1093.2">It has a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1094.1">[HttpGet("{id}")]</span></strong><span class="koboSpan" id="kobo.1095.1"> attribute to indicate the URL of the operation. </span><span class="koboSpan" id="kobo.1095.2">The URL will be mapped to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1096.1">/api/posts/{id}</span></strong><span class="koboSpan" id="kobo.1097.1">. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1098.1">id</span></strong><span class="koboSpan" id="kobo.1099.1"> is a placeholder, which will be replaced with the ID of the post. </span><span class="koboSpan" id="kobo.1099.2">Then, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1100.1">id</span></strong><span class="koboSpan" id="kobo.1101.1"> will be passed to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1102.1">GetPost()</span></strong><span class="koboSpan" id="kobo.1103.1"> method as </span><span class="No-Break"><span class="koboSpan" id="kobo.1104.1">a parameter.</span></span></p>
<p><span class="koboSpan" id="kobo.1105.1">If the post is not found, the method will return a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1106.1">NotFound</span></strong><span class="koboSpan" id="kobo.1107.1"> response. </span><span class="koboSpan" id="kobo.1107.2">ASP.NET Core provides a set of built-in response messages, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1108.1">NotFound</span></strong><span class="koboSpan" id="kobo.1109.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1110.1">BadRequest</span></strong><span class="koboSpan" id="kobo.1111.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1112.1">InternalServerError</span></strong><span class="koboSpan" id="kobo.1113.1">, and </span><span class="No-Break"><span class="koboSpan" id="kobo.1114.1">so on.</span></span></p>
<p><span class="koboSpan" id="kobo.1115.1">If you call the API now, it will return </span><strong class="source-inline"><span class="koboSpan" id="kobo.1116.1">NotFound</span></strong><span class="koboSpan" id="kobo.1117.1"> because we have not created </span><span class="No-Break"><span class="koboSpan" id="kobo.1118.1">a post</span><a id="_idTextAnchor109"/><span class="koboSpan" id="kobo.1119.1">.</span></span></p>
<h2 id="_idParaDest-57"><a id="_idTextAnchor110"/><span class="koboSpan" id="kobo.1120.1">Implementing a CREATE operation</span></h2>
<p><span class="koboSpan" id="kobo.1121.1">The design</span><a id="_idIndexMarker202"/><span class="koboSpan" id="kobo.1122.1"> for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1123.1">createPost()</span></strong><span class="koboSpan" id="kobo.1124.1"> operation is </span><span class="No-Break"><span class="koboSpan" id="kobo.1125.1">as follows:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table002-1">
<colgroup>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1126.1">Operation name</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1127.1">URL</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1128.1">HTTP method</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1129.1">Input</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1130.1">Response</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1131.1">Description</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1132.1">createPost()</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1133.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1134.1">posts</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1135.1">POST</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.1136.1">Post</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.1137.1">Post, 201</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.1138.1">Create a </span><span class="No-Break"><span class="koboSpan" id="kobo.1139.1">new post</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Figure"><span class="koboSpan" id="kobo.1140.1">Table 2.2 – The design for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1141.1">createPost()</span></strong><span class="koboSpan" id="kobo.1142.1"> operation</span></p>
<p><span class="koboSpan" id="kobo.1143.1">Create a new method named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1144.1">CreatePost()</span></strong><span class="koboSpan" id="kobo.1145.1"> in the controller. </span><span class="koboSpan" id="kobo.1145.2">As the controller has been mapped to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1146.1">api/posts</span></strong><span class="koboSpan" id="kobo.1147.1">, we do not need to specify the route of this method. </span><span class="koboSpan" id="kobo.1147.2">The content of the method is </span><span class="No-Break"><span class="koboSpan" id="kobo.1148.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1149.1">
[HttpPost]public async Task&lt;ActionResult&lt;Post&gt;&gt; CreatePost(Post post)
{
    await _postsService.CreatePost(post);
    return CreatedAtAction(nameof(GetPost), new { id = post.Id }, post);
}</span></pre>
<p><span class="koboSpan" id="kobo.1150.1">When</span><a id="_idIndexMarker203"/><span class="koboSpan" id="kobo.1151.1"> we call this endpoint, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1152.1">post</span></strong><span class="koboSpan" id="kobo.1153.1"> object will be serialized in the JSON format that is attached to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1154.1">POST</span></strong><span class="koboSpan" id="kobo.1155.1"> request body. </span><span class="koboSpan" id="kobo.1155.2">In this method, we can get the post from the request and then call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1156.1">CreatePost()</span></strong><span class="koboSpan" id="kobo.1157.1"> method in the service to create a new post. </span><span class="koboSpan" id="kobo.1157.2">Then, we will return the built-in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1158.1">CreatedAtAction</span></strong><span class="koboSpan" id="kobo.1159.1">, which returns a response message with the specified action name, route values, and post. </span><span class="koboSpan" id="kobo.1159.2">For this case, it will call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1160.1">GetPost()</span></strong><span class="koboSpan" id="kobo.1161.1"> action to return the newly </span><span class="No-Break"><span class="koboSpan" id="kobo.1162.1">created post.</span></span></p>
<p><span class="koboSpan" id="kobo.1163.1">Now, we can test the API. </span><span class="koboSpan" id="kobo.1163.2">For example, we can send a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1164.1">POST</span></strong><span class="koboSpan" id="kobo.1165.1"> request in </span><span class="No-Break"><span class="koboSpan" id="kobo.1166.1">Thunder Client.</span></span></p>
<p><span class="koboSpan" id="kobo.1167.1">Change the method to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1168.1">POST</span></strong><span class="koboSpan" id="kobo.1169.1">. </span><span class="koboSpan" id="kobo.1169.2">Use the following JSON data as </span><span class="No-Break"><span class="koboSpan" id="kobo.1170.1">the body:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1171.1">
{  "userId": 1,
  "id": 1,
  "title": "Hello ASP.NET Core",
  "body": "ASP.NET Core is a cross-platform, high-performance, open-source framework for building modern, cloud-enabled, Internet-connected apps."
</span><span class="koboSpan" id="kobo.1171.2">}</span></pre>
<p><span class="koboSpan" id="kobo.1172.1">Click the </span><strong class="bold"><span class="koboSpan" id="kobo.1173.1">Send</span></strong><span class="koboSpan" id="kobo.1174.1"> button. </span><span class="koboSpan" id="kobo.1174.2">Note that the status of the response is </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1175.1">201 Created</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1176.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer025">
<span class="koboSpan" id="kobo.1177.1"><img alt="Figure 2.19 – Sending a POST request" src="image/B18971_02_19.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1178.1">Figure 2.19 – Sending a POST request</span></p>
<p><span class="koboSpan" id="kobo.1179.1">Then, send</span><a id="_idIndexMarker204"/><span class="koboSpan" id="kobo.1180.1"> a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1181.1">GET</span></strong><span class="koboSpan" id="kobo.1182.1"> request to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1183.1">api/posts/1</span></strong><span class="koboSpan" id="kobo.1184.1"> endpoint. </span><span class="koboSpan" id="kobo.1184.2">We can get a response </span><span class="No-Break"><span class="koboSpan" id="kobo.1185.1">like this:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer026">
<span class="koboSpan" id="kobo.1186.1"><img alt="Figure 2.20 – Sending a GET request" src="image/B18971_02_20.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1187.1">Figure 2.20 – Sending a GET request</span></p>
<p><a id="_idTextAnchor111"/><span class="koboSpan" id="kobo.1188.1">Please note</span><a id="_idIndexMarker205"/><span class="koboSpan" id="kobo.1189.1"> that the post we created is stored in the memory of the service. </span><span class="koboSpan" id="kobo.1189.2">Because we have not provided a database to store the data, if we restart the application, the post will </span><span class="No-Break"><span class="koboSpan" id="kobo.1190.1">be lost.</span></span></p>
<p><span class="koboSpan" id="kobo.1191.1">Next, let us see how to implement an </span><span class="No-Break"><span class="koboSpan" id="kobo.1192.1">update operation.</span></span></p>
<h2 id="_idParaDest-58"><a id="_idTextAnchor112"/><span class="koboSpan" id="kobo.1193.1">Implementing an UPDATE operation</span></h2>
<p><span class="koboSpan" id="kobo.1194.1">The design</span><a id="_idIndexMarker206"/><span class="koboSpan" id="kobo.1195.1"> for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1196.1">updatePost()</span></strong><span class="koboSpan" id="kobo.1197.1"> operation is </span><span class="No-Break"><span class="koboSpan" id="kobo.1198.1">as follows:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table003-1">
<colgroup>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1199.1">Operation name</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1200.1">URL</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1201.1">HTTP method</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1202.1">Input</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1203.1">Response</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1204.1">Description</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1205.1">updatePost()</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1206.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1207.1">posts/{postId}</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1208.1">PUT</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.1209.1">Post</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.1210.1">Post, 200</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.1211.1">Update a </span><span class="No-Break"><span class="koboSpan" id="kobo.1212.1">new post</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Figure"><span class="koboSpan" id="kobo.1213.1">Table 2.3 – The design for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1214.1">updatePost()</span></strong><span class="koboSpan" id="kobo.1215.1"> operation</span></p>
<p><span class="koboSpan" id="kobo.1216.1">Create a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.1217.1">UpdatePost()</span></strong><span class="koboSpan" id="kobo.1218.1"> method in the controller, as </span><span class="No-Break"><span class="koboSpan" id="kobo.1219.1">shown next:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1220.1">
[HttpPut("{id}")]public async Task&lt;ActionResult&gt; UpdatePost(int id, Post post)
{
    if (id != post.Id)
    {
        return BadRequest();
    }
    var updatedPost = await _postsService.UpdatePost(id, post);
    if (updatedPost == null)
    {
        return NotFound();
    }
    return Ok(post);
}</span></pre>
<p><span class="koboSpan" id="kobo.1221.1">This </span><a id="_idIndexMarker207"/><span class="koboSpan" id="kobo.1222.1">method has a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1223.1">[HttpPut("{id}")]</span></strong><span class="koboSpan" id="kobo.1224.1"> attribute to indicate that it is a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1225.1">PUT</span></strong><span class="koboSpan" id="kobo.1226.1"> operation. </span><span class="koboSpan" id="kobo.1226.2">Similarly, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1227.1">id</span></strong><span class="koboSpan" id="kobo.1228.1"> is a placeholder, which will be replaced with the ID of the post. </span><span class="koboSpan" id="kobo.1228.2">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1229.1">PUT</span></strong><span class="koboSpan" id="kobo.1230.1"> request, we should attach the serialized content of the post to the </span><span class="No-Break"><span class="koboSpan" id="kobo.1231.1">request body.</span></span></p>
<p><span class="koboSpan" id="kobo.1232.1">This time, let us test the API with HttpRepl. </span><span class="koboSpan" id="kobo.1232.2">Run the following command to connect to </span><span class="No-Break"><span class="koboSpan" id="kobo.1233.1">the server:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1234.1">
httprepl https://localhost:7291/api/postsconnect https://localhost:7291/api/posts/1
put -h Content-Type=application/json -c "{"userId": 1,"id": 1,"title": "Hello ASP.NET Core 8","body": "ASP.NET Core is a cross-platform, high-performance, open-source framework for building modern, cloud-enabled, Internet-connected apps."}"</span></pre>
<p><span class="koboSpan" id="kobo.1235.1">You will see </span><span class="No-Break"><span class="koboSpan" id="kobo.1236.1">this output:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1237.1">
HTTP/1.1 200 OKContent-Type: application/json; charset=utf-8
Date: Thu, 18 Aug 2022 11:25:26 GMT
Server: Kestrel
Transfer-Encoding: chunked
{
  "userId": 1,
  "id": 1,
  "title": "Hello ASP.NET Core 8",
  "body": "ASP.NET Core is a cross-platform, high-performance, open-source framework for building modern, cloud-enabled, Internet-connected apps."
</span><span class="koboSpan" id="kobo.1237.2">}</span></pre>
<p><span class="koboSpan" id="kobo.1238.1">Then, we</span><a id="_idIndexMarker208"/><span class="koboSpan" id="kobo.1239.1"> can update the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1240.1">GetPosts()</span></strong><span class="koboSpan" id="kobo.1241.1"> method </span><span class="No-Break"><span class="koboSpan" id="kobo.1242.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1243.1">
[HttpGet]public async Task&lt;ActionResult&lt;List&lt;Post&gt;&gt;&gt; GetPosts()
{
    var posts = await _postService.GetAllPosts();
    return Ok(posts);
</span><a id="_idTextAnchor113"/><span class="koboSpan" id="kobo.1244.1">}</span></pre>
<p><span class="koboSpan" id="kobo.1245.1">We have implemented </span><strong class="source-inline"><span class="koboSpan" id="kobo.1246.1">GET</span></strong><span class="koboSpan" id="kobo.1247.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1248.1">POST</span></strong><span class="koboSpan" id="kobo.1249.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1250.1">PUT</span></strong><span class="koboSpan" id="kobo.1251.1"> operations. </span><span class="koboSpan" id="kobo.1251.2">Next, you can try to implement the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1252.1">DeletePost()</span></strong><span class="koboSpan" id="kobo.1253.1"> method using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1254.1">DELETE</span></strong><span class="koboSpan" id="kobo.1255.1"> operation </span><span class="No-Break"><span class="koboSpan" id="kobo.1256.1">by yourself.</span></span></p>
<h1 id="_idParaDest-59"><a id="_idTextAnchor114"/><span class="koboSpan" id="kobo.1257.1">Dependency injection</span></h1>
<p><span class="koboSpan" id="kobo.1258.1">In the preceding </span><a id="_idIndexMarker209"/><span class="koboSpan" id="kobo.1259.1">example of the controller, there is a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1260.1">_postsService</span></strong><span class="koboSpan" id="kobo.1261.1"> field that is initialized in the constructor method of the controller by using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1262.1">new()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1263.1"> constructor:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1264.1">
private readonly PostsService _postsService;public PostsController()
{
    _postsService = new PostsService();
}</span></pre>
<p><span class="koboSpan" id="kobo.1265.1">That says the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1266.1">PostsController</span></strong><span class="koboSpan" id="kobo.1267.1"> class depends on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1268.1">PostsService</span></strong><span class="koboSpan" id="kobo.1269.1"> class, and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1270.1">PostsService</span></strong><span class="koboSpan" id="kobo.1271.1"> class is a dependency of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1272.1">PostsController</span></strong><span class="koboSpan" id="kobo.1273.1"> class. </span><span class="koboSpan" id="kobo.1273.2">If we want to replace </span><strong class="source-inline"><span class="koboSpan" id="kobo.1274.1">PostsService</span></strong><span class="koboSpan" id="kobo.1275.1"> with a different implementation to save the data, we have to update the code of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1276.1">PostsController</span></strong><span class="koboSpan" id="kobo.1277.1">. </span><span class="koboSpan" id="kobo.1277.2">If the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1278.1">PostsService</span></strong><span class="koboSpan" id="kobo.1279.1"> class has its own dependencies, they must also be initialized by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1280.1">PostsController</span></strong><span class="koboSpan" id="kobo.1281.1"> class. </span><span class="koboSpan" id="kobo.1281.2">When the project grows larger, the dependencies will become more complex. </span><span class="koboSpan" id="kobo.1281.3">Also, this kind of implementation is not easy to test </span><span class="No-Break"><span class="koboSpan" id="kobo.1282.1">and maintain.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.1283.1">Dependency injection</span></strong><span class="koboSpan" id="kobo.1284.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1285.1">DI</span></strong><span class="koboSpan" id="kobo.1286.1">) is one of the most well-known design patterns in the software development world. </span><span class="koboSpan" id="kobo.1286.2">It helps decouple classes that depend on each other. </span><span class="koboSpan" id="kobo.1286.3">You may find the following terms being used</span><a id="_idIndexMarker210"/><span class="koboSpan" id="kobo.1287.1"> interchangeably: </span><strong class="bold"><span class="koboSpan" id="kobo.1288.1">Dependency Inversion Principle</span></strong><span class="koboSpan" id="kobo.1289.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1290.1">DIP</span></strong><span class="koboSpan" id="kobo.1291.1">), </span><strong class="bold"><span class="koboSpan" id="kobo.1292.1">Inversion of Control</span></strong><span class="koboSpan" id="kobo.1293.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1294.1">IoC</span></strong><span class="koboSpan" id="kobo.1295.1">), and DI. </span><span class="koboSpan" id="kobo.1295.2">These</span><a id="_idIndexMarker211"/><span class="koboSpan" id="kobo.1296.1"> terms are commonly confused even though they are related. </span><span class="koboSpan" id="kobo.1296.2">You can find multiple articles and blog posts that explain them. </span><span class="koboSpan" id="kobo.1296.3">Some say they are the same thing, but some say not. </span><span class="koboSpan" id="kobo.1296.4">What </span><span class="No-Break"><span class="koboSpan" id="kobo.1297.1">are t</span><a id="_idTextAnchor115"/><span class="koboSpan" id="kobo.1298.1">hey?</span></span></p>
<h2 id="_idParaDest-60"><a id="_idTextAnchor116"/><span class="koboSpan" id="kobo.1299.1">Understanding DI</span></h2>
<p><span class="koboSpan" id="kobo.1300.1">The Dependency Inversion Principle is </span><a id="_idIndexMarker212"/><span class="koboSpan" id="kobo.1301.1">one of the </span><em class="italic"><span class="koboSpan" id="kobo.1302.1">SOLID</span></em><span class="koboSpan" id="kobo.1303.1"> principles in </span><strong class="bold"><span class="koboSpan" id="kobo.1304.1">object-oriented</span></strong><span class="koboSpan" id="kobo.1305.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1306.1">OO</span></strong><span class="koboSpan" id="kobo.1307.1">) design. </span><span class="koboSpan" id="kobo.1307.2">It was </span><a id="_idIndexMarker213"/><span class="koboSpan" id="kobo.1308.1">defined by Robert C. </span><span class="koboSpan" id="kobo.1308.2">Martin in his book </span><em class="italic"><span class="koboSpan" id="kobo.1309.1">Agile Software Development: Principles, Patterns, and Practices</span></em><span class="koboSpan" id="kobo.1310.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1311.1">Pearson</span></em><span class="koboSpan" id="kobo.1312.1">, in 2002. </span><span class="koboSpan" id="kobo.1312.2">The principle states, “</span><em class="italic"><span class="koboSpan" id="kobo.1313.1">high-level modules should not depend on low-level modules; both should depend on abstractions. </span><span class="koboSpan" id="kobo.1313.2">Abstractions should not depend on details. </span><span class="koboSpan" id="kobo.1313.3">Details should depend </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1314.1">upon abstractions</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1315.1">.”</span></span></p>
<p><span class="koboSpan" id="kobo.1316.1">In the preceding controller, we said </span><strong class="source-inline"><span class="koboSpan" id="kobo.1317.1">PostsController</span></strong><span class="koboSpan" id="kobo.1318.1"> depends on </span><strong class="source-inline"><span class="koboSpan" id="kobo.1319.1">PostsService</span></strong><span class="koboSpan" id="kobo.1320.1">. </span><span class="koboSpan" id="kobo.1320.2">The controller is the high-level module, and the service is the low-level module. </span><span class="koboSpan" id="kobo.1320.3">When the service is changed, the controller must be changed as well. </span><span class="koboSpan" id="kobo.1320.4">Keep in mind that the term </span><em class="italic"><span class="koboSpan" id="kobo.1321.1">inversion</span></em><span class="koboSpan" id="kobo.1322.1"> does not mean that the low-level module will depend on the high level. </span><span class="koboSpan" id="kobo.1322.2">Instead, both of them should depend on abstractions that expose the behavior needed by high-level modules. </span><span class="koboSpan" id="kobo.1322.3">If we invert this dependency relationship by creating an interface for the service, both the controller and the service will </span><a id="_idIndexMarker214"/><span class="koboSpan" id="kobo.1323.1">depend on the interface. </span><span class="koboSpan" id="kobo.1323.2">The implementation of the service can change as long as it respects </span><span class="No-Break"><span class="koboSpan" id="kobo.1324.1">the interface.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.1325.1">IoC</span></strong><span class="koboSpan" id="kobo.1326.1"> is a </span><a id="_idIndexMarker215"/><span class="koboSpan" id="kobo.1327.1">programming principle that inverts the flow of control in an application. </span><span class="koboSpan" id="kobo.1327.2">In traditional programming, custom code is responsible for instantiating objects and controlling the execution of the main function. </span><span class="koboSpan" id="kobo.1327.3">IoC inverts the flow of control as compared to traditional control flow. </span><span class="koboSpan" id="kobo.1327.4">With IoC, the framework does the instantiation, calling custom or </span><span class="No-Break"><span class="koboSpan" id="kobo.1328.1">task-specific code.</span></span></p>
<p><span class="koboSpan" id="kobo.1329.1">It can be used to differentiate a framework from a class library. </span><span class="koboSpan" id="kobo.1329.2">Normally, the framework calls the application code, and the application code calls the library. </span><span class="koboSpan" id="kobo.1329.3">This kind of IoC is sometimes referred to as the Hollywood principle: “</span><em class="italic"><span class="koboSpan" id="kobo.1330.1">Don’t call us, we’ll </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1331.1">call you</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1332.1">.”</span></span></p>
<p><span class="koboSpan" id="kobo.1333.1">IoC is related to DIP, but it is not the same. </span><span class="koboSpan" id="kobo.1333.2">DIP concerns decoupling dependencies between high-level modules and low-level modules through shared abstractions (interfaces). </span><span class="koboSpan" id="kobo.1333.3">IoC is used to increase the modularity of the program and make it extensible. </span><span class="koboSpan" id="kobo.1333.4">There are</span><a id="_idIndexMarker216"/><span class="koboSpan" id="kobo.1334.1"> several technologies to implement IoC, such as </span><strong class="bold"><span class="koboSpan" id="kobo.1335.1">Service Locator</span></strong><span class="koboSpan" id="kobo.1336.1">, DI, the template method design pattern, the strategy design pattern, and </span><span class="No-Break"><span class="koboSpan" id="kobo.1337.1">so on.</span></span></p>
<p><span class="koboSpan" id="kobo.1338.1">DI is a form of IoC. </span><span class="koboSpan" id="kobo.1338.2">This term was coined by Martin Fowler in 2004. </span><span class="koboSpan" id="kobo.1338.3">It separates the concerns of constructing objects and using them. </span><span class="koboSpan" id="kobo.1338.4">When an object or a function (the client) needs a dependency, it does not know how to construct it. </span><span class="koboSpan" id="kobo.1338.5">Instead, the client only needs to declare the interfaces of the dependency, and the dependency is injected into the client by external code (an injector). </span><span class="koboSpan" id="kobo.1338.6">It makes it easier to change the implementation of the dependency. </span><span class="koboSpan" id="kobo.1338.7">It is often similar to the strategy design pattern. </span><span class="koboSpan" id="kobo.1338.8">The difference is that the strategy pattern can use different strategies to construct the dependency, while DI typically only uses a single instance of </span><span class="No-Break"><span class="koboSpan" id="kobo.1339.1">the dependency.</span></span></p>
<p><span class="koboSpan" id="kobo.1340.1">There are three main types </span><span class="No-Break"><span class="koboSpan" id="kobo.1341.1">of DI:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.1342.1">Constructor injection</span></strong><span class="koboSpan" id="kobo.1343.1">: The</span><a id="_idIndexMarker217"/><span class="koboSpan" id="kobo.1344.1"> dependencies are provided as parameters of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1345.1">client’s constructor</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1346.1">Setter injection</span></strong><span class="koboSpan" id="kobo.1347.1">: The</span><a id="_idIndexMarker218"/><span class="koboSpan" id="kobo.1348.1"> client exposes a setter method to accept </span><span class="No-Break"><span class="koboSpan" id="kobo.1349.1">the dependency</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1350.1">Interface injection</span></strong><span class="koboSpan" id="kobo.1351.1">: The</span><a id="_idIndexMarker219"/><span class="koboSpan" id="kobo.1352.1"> dependency’s interface provides an injector method that will inject the dependency into any client passed </span><span class="No-Break"><span class="koboSpan" id="kobo.1353.1">to it</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1354.1">As you can see, these three terms are related, but there are some differences. </span><span class="koboSpan" id="kobo.1354.2">Simply put, DI is a technique for achieving IoC between classes and their dependencies. </span><span class="koboSpan" id="kobo.1354.3">ASP.NET Core supports DI as a </span><span class="No-Break"><span class="koboSpan" id="kobo.1355.1">first-cl</span><a id="_idTextAnchor117"/><span class="koboSpan" id="kobo.1356.1">ass citizen.</span></span></p>
<h2 id="_idParaDest-61"><a id="_idTextAnchor118"/><span class="koboSpan" id="kobo.1357.1">DI in ASP.NET Core</span></h2>
<p><span class="koboSpan" id="kobo.1358.1">ASP.NET Core </span><a id="_idIndexMarker220"/><span class="koboSpan" id="kobo.1359.1">uses constructor injection to request dependencies. </span><span class="koboSpan" id="kobo.1359.2">To use it, we need to do </span><span class="No-Break"><span class="koboSpan" id="kobo.1360.1">the following:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1361.1">Define interfaces and </span><span class="No-Break"><span class="koboSpan" id="kobo.1362.1">their implementations.</span></span></li>
<li><span class="koboSpan" id="kobo.1363.1">Register the interfaces and the implementations to the </span><span class="No-Break"><span class="koboSpan" id="kobo.1364.1">service container.</span></span></li>
<li><span class="koboSpan" id="kobo.1365.1">Add services as the constructor parameters to inject </span><span class="No-Break"><span class="koboSpan" id="kobo.1366.1">the dependencies.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.1367.1">You can download the example project named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1368.1">DependencyInjectionDemo</span></strong><span class="koboSpan" id="kobo.1369.1"> from the folder </span><strong class="source-inline"><span class="koboSpan" id="kobo.1370.1">samples/chapter2/ DependencyInjectionDemo/DependencyInjectionDemo</span></strong><span class="koboSpan" id="kobo.1371.1"> in the chapter's </span><span class="No-Break"><span class="koboSpan" id="kobo.1372.1">GitHub repository.</span></span></p>
<p><span class="koboSpan" id="kobo.1373.1">Follow the steps below to use DI in </span><span class="No-Break"><span class="koboSpan" id="kobo.1374.1">ASP.NET Core:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1375.1">First, we will create an interface and its implementation. </span><span class="koboSpan" id="kobo.1375.2">Copy the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1376.1">Post.cs</span></strong><span class="koboSpan" id="kobo.1377.1"> file and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1378.1">PostService.cs</span></strong><span class="koboSpan" id="kobo.1379.1"> file from the previous </span><strong class="source-inline"><span class="koboSpan" id="kobo.1380.1">MyFirstApi</span></strong><span class="koboSpan" id="kobo.1381.1"> project to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1382.1">DependencyInjectionDemo</span></strong><span class="koboSpan" id="kobo.1383.1"> project. </span><span class="koboSpan" id="kobo.1383.2">Create a new interface named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1384.1">IPostService</span></strong><span class="koboSpan" id="kobo.1385.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1386.1">Service</span></strong><span class="koboSpan" id="kobo.1387.1"> folder, as </span><span class="No-Break"><span class="koboSpan" id="kobo.1388.1">shown next:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1389.1">
public interface IPostService{    Task CreatePost(Post item);    Task&lt;Post?&gt; UpdatePost(int id, Post item);    Task&lt;Post?&gt; GetPost(int id);    Task&lt;List&lt;Post&gt;&gt; GetAllPosts();    Task DeletePost(int id);}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1390.1">Then, update</span><a id="_idIndexMarker221"/><span class="koboSpan" id="kobo.1391.1"> the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1392.1">PostService</span></strong><span class="koboSpan" id="kobo.1393.1"> class to implement the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1394.1">IPostService</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1395.1"> interface:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.1396.1">public class PostsService : IPostService</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1397.1">You may also need to update the namespace of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1398.1">Post</span></strong><span class="koboSpan" id="kobo.1399.1"> class and the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1400.1">PostService</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1401.1"> class.</span></span></p></li> <li><span class="koboSpan" id="kobo.1402.1">Next, we can register the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1403.1">IPostService</span></strong><span class="koboSpan" id="kobo.1404.1"> interface and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1405.1">PostService</span></strong><span class="koboSpan" id="kobo.1406.1"> implementation to the service container. </span><span class="koboSpan" id="kobo.1406.2">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1407.1">Program.cs</span></strong><span class="koboSpan" id="kobo.1408.1"> file, and you will find that an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1409.1">WebApplicationBuilder</span></strong><span class="koboSpan" id="kobo.1410.1"> named builder is created by calling the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1411.1">WebApplication.CreateBuilder()</span></strong><span class="koboSpan" id="kobo.1412.1"> method. </span><span class="koboSpan" id="kobo.1412.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1413.1">CreateBuilder()</span></strong><span class="koboSpan" id="kobo.1414.1"> method is the entry point of the application. </span><span class="koboSpan" id="kobo.1414.2">We can configure the application by using the builder instance, and then call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1415.1">builder.Build()</span></strong><span class="koboSpan" id="kobo.1416.1"> method to build the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1417.1">WebApplication</span></strong><span class="koboSpan" id="kobo.1418.1">. </span><span class="koboSpan" id="kobo.1418.2">Add the </span><span class="No-Break"><span class="koboSpan" id="kobo.1419.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1420.1">
builder.Services.AddScoped&lt;IPostService, PostsService&gt;();</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1421.1">The preceding code utilizes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1422.1">AddScoped()</span></strong><span class="koboSpan" id="kobo.1423.1"> method, which indicates that the service is created once per client request and disposed of upon completion of </span><span class="No-Break"><span class="koboSpan" id="kobo.1424.1">the request.</span></span></p></li> <li><span class="koboSpan" id="kobo.1425.1">Copy the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1426.1">PostsController.cs</span></strong><span class="koboSpan" id="kobo.1427.1"> file from the previous </span><strong class="source-inline"><span class="koboSpan" id="kobo.1428.1">MyFirstApi</span></strong><span class="koboSpan" id="kobo.1429.1"> project to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1430.1">DependencyInjectionDemo</span></strong><span class="koboSpan" id="kobo.1431.1"> project. </span><span class="koboSpan" id="kobo.1431.2">Update the namespace and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1432.1">using</span></strong><span class="koboSpan" id="kobo.1433.1"> statements. </span><span class="koboSpan" id="kobo.1433.2">Then, update the constructor method of the controller </span><span class="No-Break"><span class="koboSpan" id="kobo.1434.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1435.1">
private readonly IPostService _postsService;public PostsController(IPostService postService){    _postsService = postService;}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1436.1">The preceding code uses the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1437.1">IPostService</span></strong><span class="koboSpan" id="kobo.1438.1"> interface as the constructor parameter. </span><span class="koboSpan" id="kobo.1438.2">The service container will inject the correct implementation into </span><span class="No-Break"><span class="koboSpan" id="kobo.1439.1">the controller.</span></span></p></li> </ol>
<p><span class="koboSpan" id="kobo.1440.1">DI has four roles: services, clients, interfaces, and injectors. </span><span class="koboSpan" id="kobo.1440.2">In this example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1441.1">IPostService</span></strong><span class="koboSpan" id="kobo.1442.1"> is the interface, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1443.1">PostService</span></strong><span class="koboSpan" id="kobo.1444.1"> is the service, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1445.1">PostsController</span></strong><span class="koboSpan" id="kobo.1446.1"> is the client, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1447.1">builder.Services</span></strong><span class="koboSpan" id="kobo.1448.1"> is the injector, which is a collection of services for the application to compose. </span><span class="koboSpan" id="kobo.1448.2">It is sometimes referred to as a </span><span class="No-Break"><span class="koboSpan" id="kobo.1449.1">DI container.</span></span></p>
<p><span class="koboSpan" id="kobo.1450.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1451.1">PostsController</span></strong><span class="koboSpan" id="kobo.1452.1"> class requests the instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1453.1">IPostService</span></strong><span class="koboSpan" id="kobo.1454.1"> from its constructor. </span><span class="koboSpan" id="kobo.1454.2">The </span><a id="_idIndexMarker222"/><span class="koboSpan" id="kobo.1455.1">controller, which is the client, does not know where the service is, nor how it is constructed. </span><span class="koboSpan" id="kobo.1455.2">The controller only knows the interface. </span><span class="koboSpan" id="kobo.1455.3">The service has been registered in the service container, which can inject the correct implementation into the controller. </span><span class="koboSpan" id="kobo.1455.4">We do not need to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1456.1">new</span></strong><span class="koboSpan" id="kobo.1457.1"> keyword to create an instance of the service. </span><span class="koboSpan" id="kobo.1457.2">That says the client and the service </span><span class="No-Break"><span class="koboSpan" id="kobo.1458.1">are decoupled.</span></span></p>
<p><span class="koboSpan" id="kobo.1459.1">This DI feature is provided in a NuGet package called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1460.1">Microsoft.Extensions.DependencyInjection</span></strong><span class="koboSpan" id="kobo.1461.1">. </span><span class="koboSpan" id="kobo.1461.2">When an ASP.NET Core project is created, this package is added automatically. </span><span class="koboSpan" id="kobo.1461.3">If you create a console project, you may need to install it manually by using the </span><span class="No-Break"><span class="koboSpan" id="kobo.1462.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1463.1">
dotnet add package Microsoft.Extensions.DependencyInjection</span></pre> <p><span class="koboSpan" id="kobo.1464.1">If we want to replace the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1465.1">IPostService</span></strong><span class="koboSpan" id="kobo.1466.1"> with another implementation, we can do so by registering the new implementation to the service container. </span><span class="koboSpan" id="kobo.1466.2">The code of the controller does not need to be changed. </span><span class="koboSpan" id="kobo.1466.3">That is one of the benefits </span><span class="No-Break"><span class="koboSpan" id="kobo.1467.1">of DI.</span></span></p>
<p><span class="koboSpan" id="kobo.1468.1">Next, let us discuss the lifeti</span><a id="_idTextAnchor119"/><span class="koboSpan" id="kobo.1469.1">me </span><span class="No-Break"><span class="koboSpan" id="kobo.1470.1">of services.</span></span></p>
<h3><span class="koboSpan" id="kobo.1471.1">DI lifetimes</span></h3>
<p><span class="koboSpan" id="kobo.1472.1">In the previous example, the service is registered using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1473.1">AddScoped()</span></strong><span class="koboSpan" id="kobo.1474.1"> method. </span><span class="koboSpan" id="kobo.1474.2">In ASP.NET Core, there </span><a id="_idIndexMarker223"/><span class="koboSpan" id="kobo.1475.1">are three lifetimes when the service </span><span class="No-Break"><span class="koboSpan" id="kobo.1476.1">is registered:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.1477.1">Transient</span></strong><span class="koboSpan" id="kobo.1478.1">: A transient service</span><a id="_idIndexMarker224"/><span class="koboSpan" id="kobo.1479.1"> is created each time it is requested and disposed of at the end of </span><span class="No-Break"><span class="koboSpan" id="kobo.1480.1">the request.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1481.1">Scoped</span></strong><span class="koboSpan" id="kobo.1482.1">: In </span><a id="_idIndexMarker225"/><span class="koboSpan" id="kobo.1483.1">web applications, a scope means a request (connection). </span><span class="koboSpan" id="kobo.1483.2">A scoped service is created once per client request and disposed of at the end of </span><span class="No-Break"><span class="koboSpan" id="kobo.1484.1">the request.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1485.1">Singleton</span></strong><span class="koboSpan" id="kobo.1486.1">: A singleton service</span><a id="_idIndexMarker226"/><span class="koboSpan" id="kobo.1487.1"> is created the first time it is requested or when providing the implementation instance to the service container. </span><span class="koboSpan" id="kobo.1487.2">All subsequent requests will use the </span><span class="No-Break"><span class="koboSpan" id="kobo.1488.1">same instance.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1489.1">To demonstrate the difference between these lifetimes, we will use a simple </span><span class="No-Break"><span class="koboSpan" id="kobo.1490.1">demo service:</span></span></p>
<p><span class="koboSpan" id="kobo.1491.1">Create a new interface named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1492.1">IDemoService</span></strong><span class="koboSpan" id="kobo.1493.1"> and its implementation named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1494.1">DemoService</span></strong><span class="koboSpan" id="kobo.1495.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1496.1">Services</span></strong><span class="koboSpan" id="kobo.1497.1"> folder, as </span><span class="No-Break"><span class="koboSpan" id="kobo.1498.1">shown next:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1499.1">IDemoService.cs:</span></p>
<pre class="source-code">
<strong class="source-inline"><span class="koboSpan" id="kobo.1500.1">namespace DependencyInjectionDemo.Services;</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1501.1">public interface IDemoService</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1502.1">{</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1503.1">    SayHello();</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1504.1">}</span></strong></pre>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1505.1">DemoService.cs:</span></p>
<pre class="source-code">
<strong class="source-inline"><span class="koboSpan" id="kobo.1506.1">namespace DependencyInjectionDemo.Services;</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1507.1">public class DemoService : IDemoService</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1508.1">{</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1509.1">    private readonly Guid _serviceId;</span></strong><span class="koboSpan" id="kobo.1510.1">
    private readonly DateTime _createdAt;
</span><strong class="source-inline"><span class="koboSpan" id="kobo.1511.1">    public DemoService()</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1512.1">    {</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1513.1">        _serviceId = Guid.NewGuid();</span></strong><span class="koboSpan" id="kobo.1514.1">
        _createdAt = DateTime.Now;
</span><strong class="source-inline"><span class="koboSpan" id="kobo.1515.1">    }</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1516.1">    public string SayHello()</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1517.1">    {</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1518.1">        return $"Hello! </span><span class="koboSpan" id="kobo.1518.2">My Id is {_serviceId}. </span><span class="koboSpan" id="kobo.1518.3">I was created at {_createdAt:yyyy-MM-dd HH:mm:ss}.</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1519.1">";</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1520.1">    }</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1521.1">}</span></strong></pre>
<p class="list-inset"><span class="koboSpan" id="kobo.1522.1">The implementation will generate an ID and a time when it was created, and output it when the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1523.1">SayHello()</span></strong><span class="koboSpan" id="kobo.1524.1"> method </span><span class="No-Break"><span class="koboSpan" id="kobo.1525.1">is called.</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1526.1">Then, we</span><a id="_idIndexMarker227"/><span class="koboSpan" id="kobo.1527.1"> can register the interface and the implementation to the service container. </span><span class="koboSpan" id="kobo.1527.2">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1528.1">Program.cs</span></strong><span class="koboSpan" id="kobo.1529.1"> file and add the code </span><span class="No-Break"><span class="koboSpan" id="kobo.1530.1">as follows:</span></span><pre class="source-code">
<strong class="source-inline"><span class="koboSpan" id="kobo.1531.1">builder.Services.AddScoped&lt;IDemoService, DemoService&gt;();</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1532.1">Create a controller named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1533.1">DemoController.cs</span></strong><span class="koboSpan" id="kobo.1534.1">. </span><span class="koboSpan" id="kobo.1534.2">Now, we can add the service as constructor parameters to inject </span><span class="No-Break"><span class="koboSpan" id="kobo.1535.1">the dependency:</span></span><pre class="source-code">
<strong class="source-inline"><span class="koboSpan" id="kobo.1536.1">[ApiController]</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1537.1">[Route("[controller]")]</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1538.1">public class DemoController : ControllerBase</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1539.1">{</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1540.1">    private readonly IDemoService _demoService;</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1541.1">    public DemoController(IDemoService demoService)</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1542.1">    {</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1543.1">        _demoService = demoService;</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1544.1">    }</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1545.1">    [HttpGet]</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1546.1">    public ActionResult Get()</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1547.1">    {</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1548.1">        return Content(_demoService.SayHello());</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1549.1">    }</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1550.1">}</span></strong></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1551.1">For this </span><a id="_idIndexMarker228"/><span class="koboSpan" id="kobo.1552.1">example, if you test the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1553.1">/demo</span></strong><span class="koboSpan" id="kobo.1554.1"> endpoint, you will see the GUID value and the creation time in the output change </span><span class="No-Break"><span class="koboSpan" id="kobo.1555.1">every time:</span></span></p>
<pre class="console">
<strong class="source-inline"><span class="koboSpan" id="kobo.1556.1">http://localhost:5147/&gt; get demo</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1557.1">HTTP/1.1 200 OK</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1558.1">Content-Length: 91</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1559.1">Content-Type: text/plain; charset=utf-8</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1560.1">Date: Fri, 20 Oct 2023 22:06:46 GMT</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1561.1">Server: Kestrel</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1562.1">Hello! </span><span class="koboSpan" id="kobo.1562.2">My Id is 6ca84d82-90cb-4dd6-9a34-5ea7573508ac. </span><span class="koboSpan" id="kobo.1562.3">I was created at 2023-10-21 11:06:46.</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1563.1">http://localhost:5147/&gt; get demo</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1564.1">HTTP/1.1 200 OK</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1565.1">Content-Length: 91</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1566.1">Content-Type: text/plain; charset=utf-8</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1567.1">Date: Fri, 20 Oct 2023 22:07:02 GMT</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1568.1">Server: Kestrel</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1569.1">Hello! </span><span class="koboSpan" id="kobo.1569.2">My Id is 9bc5cf49-661d-45bb-b9ed-e0b3fe937827. </span><span class="koboSpan" id="kobo.1569.3">I was created at 2023-10-21 11:07:02.</span></strong></pre>
<p><span class="koboSpan" id="kobo.1570.1">We can</span><a id="_idIndexMarker229"/><span class="koboSpan" id="kobo.1571.1"> change the lifetime to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1572.1">AddSingleton()</span></strong><span class="koboSpan" id="kobo.1573.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.1574.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1575.1">
builder.Services.AddSingleton&lt;IDemoService, DemoService&gt;();</span></pre> <p><span class="koboSpan" id="kobo.1576.1">The GUID values and the creation time values will be the same for </span><span class="No-Break"><span class="koboSpan" id="kobo.1577.1">all requests:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1578.1">
http://localhost:5147/&gt; get demoHTTP/1.1 200 OK
Content-Length: 91
Content-Type: text/plain; charset=utf-8
Date: Fri, 20 Oct 2023 22:08:57 GMT
Server: Kestrel
Hello! </span><span class="koboSpan" id="kobo.1578.2">My Id is a1497ead-bff6-4020-b337-28f1d3af7b05. </span><span class="koboSpan" id="kobo.1578.3">I was created at 2023-10-21 11:08:02.
</span><span class="koboSpan" id="kobo.1578.4">http://localhost:5147/&gt; get demo
HTTP/1.1 200 OK
Content-Length: 91
Content-Type: text/plain; charset=utf-8
Date: Fri, 20 Oct 2023 22:09:12 GMT
Server: Kestrel
Hello! </span><span class="koboSpan" id="kobo.1578.5">My Id is a1497ead-bff6-4020-b337-28f1d3af7b05. </span><span class="koboSpan" id="kobo.1578.6">I was created at 2023-10-21 11:08:02.</span></pre>
<p><span class="koboSpan" id="kobo.1579.1">As the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1580.1">DemoController</span></strong><span class="koboSpan" id="kobo.1581.1"> class only requests the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1582.1">IDemoService</span></strong><span class="koboSpan" id="kobo.1583.1"> interface once for each request, we cannot differentiate the behavior between </span><strong class="source-inline"><span class="koboSpan" id="kobo.1584.1">scoped</span></strong><span class="koboSpan" id="kobo.1585.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1586.1">transient</span></strong><span class="koboSpan" id="kobo.1587.1"> services. </span><span class="koboSpan" id="kobo.1587.2">Let us look at a more </span><span class="No-Break"><span class="koboSpan" id="kobo.1588.1">complex example.</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1589.1">You can </span><a id="_idIndexMarker230"/><span class="koboSpan" id="kobo.1590.1">find the example code in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1591.1">DependencyInjectionDemo</span></strong><span class="koboSpan" id="kobo.1592.1"> project. </span><span class="koboSpan" id="kobo.1592.2">There are three interfaces along with </span><span class="No-Break"><span class="koboSpan" id="kobo.1593.1">their implementations:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1594.1">
public interface IService{    string Name { get; }    string SayHello();}public interface ITransientService : IService{}public class TransientService : ITransientService{    private readonly Guid _serviceId;</span><strong class="source-inline"><span class="koboSpan" id="kobo.1595.1">    private readonly DateTime _createdAt;</span></strong><span class="koboSpan" id="kobo.1596.1">    public TransientService()    {        _serviceId = Guid.NewGuid();        _createdAt = DateTime.Now;    }    public string Name =&gt; nameof(TransientService);    public string SayHello()    {        return $"Hello! </span><span class="koboSpan" id="kobo.1596.2">I am {Name}. </span><span class="koboSpan" id="kobo.1596.3">My Id is {_serviceId}. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1597.1">I was created at {_createdAt:yyyy-MM-dd HH:mm:ss}.</span></strong><span class="koboSpan" id="kobo.1598.1">";    }}public interface ISingletonService : IService{}public class SingletonService : ISingletonService{    private readonly Guid _serviceId;    private readonly DateTime _createdAt;    public SingletonService()    {        _serviceId = Guid.NewGuid();        _createdAt = DateTime.Now;    }    public string Name =&gt; nameof(SingletonService);    public string SayHello()    {        return $"Hello! </span><span class="koboSpan" id="kobo.1598.2">I am {Name}. </span><span class="koboSpan" id="kobo.1598.3">My Id is {_serviceId}.</span><strong class="source-inline"><span class="koboSpan" id="kobo.1599.1"> I was created at {_createdAt:yyyy-MM-dd HH:mm:ss}.</span></strong><span class="koboSpan" id="kobo.1600.1">";    }}public interface IScopedService : IService{}public class ScopedService : IScopedService{    private readonly Guid _serviceId;    private readonly DateTime _createdAt;    private readonly ITransientService _transientService;    private readonly ISingletonService _singletonService;    public ScopedService(ITransientService transientService, ISingletonService singletonService)    {        _transientService = transientService;        _singletonService = singletonService;        _serviceId = Guid.NewGuid();        _createdAt = DateTime.Now;    }    public string Name =&gt; nameof(ScopedService);    public string SayHello()    {        var scopedServiceMessage = $"Hello! </span><span class="koboSpan" id="kobo.1600.2">I am {Name}. </span><span class="koboSpan" id="kobo.1600.3">My Id is {_serviceId}.</span><strong class="source-inline"><span class="koboSpan" id="kobo.1601.1"> I was created at {_createdAt:yyyy-MM-dd HH:mm:ss}.</span></strong><span class="koboSpan" id="kobo.1602.1">";        var transientServiceMessage = $"{_transientService.SayHello()} I am from {Name}.";        var singletonServiceMessage = $"{_singletonService.SayHello()} I am from {Name}.";        return            $"{scopedServiceMessage}{Environment.NewLine}{transientServiceMessage}{Environment.NewLine}{singletonServiceMessage}";    }}</span></pre></li> <li><span class="koboSpan" id="kobo.1603.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1604.1">Program.cs</span></strong><span class="koboSpan" id="kobo.1605.1"> file, we can register them to the service container </span><span class="No-Break"><span class="koboSpan" id="kobo.1606.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1607.1">
builder.Services.AddScoped&lt;IScopedService, ScopedService&gt;();builder.Services.AddTransient&lt;ITransientService, TransientService&gt;();builder.Services.AddSingleton&lt;ISingletonService, SingletonService&gt;();</span></pre></li> <li><span class="koboSpan" id="kobo.1608.1">Then, create </span><a id="_idIndexMarker231"/><span class="koboSpan" id="kobo.1609.1">a controller named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1610.1">LifetimeController.cs</span></strong><span class="koboSpan" id="kobo.1611.1">. </span><span class="koboSpan" id="kobo.1611.2">The code is </span><span class="No-Break"><span class="koboSpan" id="kobo.1612.1">shown next:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1613.1">
[ApiController][Route("[controller]")]public class LifetimeController : ControllerBase{    private readonly IScopedService _scopedService;    private readonly ITransientService _transientService;    private readonly ISingletonService _singletonService;    public LifetimeController(IScopedService scopedService, ITransientService transientService,        ISingletonService singletonService)    {        _scopedService = scopedService;        _transientService = transientService;        _singletonService = singletonService;    }    [HttpGet]    public ActionResult Get()    {        var scopedServiceMessage = _scopedService.SayHello();        var transientServiceMessage = _transientService.SayHello();        var singletonServiceMessage = _singletonService.SayHello();        return Content(            $"{scopedServiceMessage}{Environment.NewLine}{transientServiceMessage}{Environment.NewLine}{singletonServiceMessage}");    }}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1614.1">In this </span><a id="_idIndexMarker232"/><span class="koboSpan" id="kobo.1615.1">example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1616.1">ScopedService</span></strong><span class="koboSpan" id="kobo.1617.1"> has two dependencies: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1618.1">ITransientService</span></strong><span class="koboSpan" id="kobo.1619.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1620.1">ISingletonService</span></strong><span class="koboSpan" id="kobo.1621.1">. </span><span class="koboSpan" id="kobo.1621.2">So, when </span><strong class="source-inline"><span class="koboSpan" id="kobo.1622.1">ScopedService</span></strong><span class="koboSpan" id="kobo.1623.1"> is created, it will ask for the instances of these dependencies from the service container. </span><span class="koboSpan" id="kobo.1623.2">On the other hand, the controller also has dependencies: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1624.1">IScopedService</span></strong><span class="koboSpan" id="kobo.1625.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1626.1">ITransientService</span></strong><span class="koboSpan" id="kobo.1627.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1628.1">ISingletonService</span></strong><span class="koboSpan" id="kobo.1629.1">. </span><span class="koboSpan" id="kobo.1629.2">When the controller is created, it will ask for these three dependencies. </span><span class="koboSpan" id="kobo.1629.3">That means </span><strong class="source-inline"><span class="koboSpan" id="kobo.1630.1">ITransientService</span></strong><span class="koboSpan" id="kobo.1631.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1632.1">ISingletonService</span></strong><span class="koboSpan" id="kobo.1633.1"> will be needed twice for each request. </span><span class="koboSpan" id="kobo.1633.2">But let us check the output of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1634.1">following requests:</span></span></p>
<pre class="console">
<strong class="source-inline"><span class="koboSpan" id="kobo.1635.1">http://localhost:5147/&gt; get lifetime</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1636.1">HTTP/1.1 200 OK</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1637.1">Content-Length: 625</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1638.1">Content-Type: text/plain; charset=utf-8</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1639.1">Date: Fri, 20 Oct 2023 22:20:44 GMT</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1640.1">Server: Kestrel</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1641.1">Hello! </span><span class="koboSpan" id="kobo.1641.2">I am ScopedService. </span><span class="koboSpan" id="kobo.1641.3">My Id is df87d966-0e86-4f08-874f-ba6ce71de560. </span><span class="koboSpan" id="kobo.1641.4">I was created at 2023-10-21 11:20:44.</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1642.1">Hello! </span><span class="koboSpan" id="kobo.1642.2">I am TransientService. </span><span class="koboSpan" id="kobo.1642.3">My Id is 77e29268-ad48-423c-94e5-de1d09bd3ba5. </span><span class="koboSpan" id="kobo.1642.4">I was created at 2023-10-21 11:20:44. </span><span class="koboSpan" id="kobo.1642.5">I am from ScopedService.</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1643.1">Hello! </span><span class="koboSpan" id="kobo.1643.2">I am SingletonService. </span><span class="koboSpan" id="kobo.1643.3">My Id is 95a44c5b-8678-48c6-a2f0-cc6b90423773. </span><span class="koboSpan" id="kobo.1643.4">I was created at 2023-10-21 11:20:44. </span><span class="koboSpan" id="kobo.1643.5">I am from ScopedService.</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1644.1">Hello! </span><span class="koboSpan" id="kobo.1644.2">I am TransientService. </span><span class="koboSpan" id="kobo.1644.3">My Id is e77564d1-e146-4d29-b74b-a07f8f6640c1. </span><span class="koboSpan" id="kobo.1644.4">I was created at 2023-10-21 11:20:44.</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1645.1">Hello! </span><span class="koboSpan" id="kobo.1645.2">I am SingletonService. </span><span class="koboSpan" id="kobo.1645.3">My Id is 95a44c5b-8678-48c6-a2f0-cc6b90423773. </span><span class="koboSpan" id="kobo.1645.4">I was created at 2023-10-21 11:20:44.</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1646.1">http://localhost:5147/&gt; get lifetime</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1647.1">HTTP/1.1 200 OK</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1648.1">Content-Length: 625</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1649.1">Content-Type: text/plain; charset=utf-8</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1650.1">Date: Fri, 20 Oct 2023 22:20:57 GMT</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1651.1">Server: Kestrel</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1652.1">Hello! </span><span class="koboSpan" id="kobo.1652.2">I am ScopedService. </span><span class="koboSpan" id="kobo.1652.3">My Id is e5f802ed-5e4c-4abd-9213-8f13f97c1008. </span><span class="koboSpan" id="kobo.1652.4">I was created at 2023-10-21 11:20:57.</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1653.1">Hello! </span><span class="koboSpan" id="kobo.1653.2">I am TransientService. </span><span class="koboSpan" id="kobo.1653.3">My Id is daccb91b-438f-4561-9c86-13b02ad8e358. </span><span class="koboSpan" id="kobo.1653.4">I was created at 2023-10-21 11:20:57. </span><span class="koboSpan" id="kobo.1653.5">I am from ScopedService.</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1654.1">Hello! </span><span class="koboSpan" id="kobo.1654.2">I am SingletonService. </span><span class="koboSpan" id="kobo.1654.3">My Id is 95a44c5b-8678-48c6-a2f0-cc6b90423773. </span><span class="koboSpan" id="kobo.1654.4">I was created at 2023-10-21 11:20:44. </span><span class="koboSpan" id="kobo.1654.5">I am from ScopedService.</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1655.1">Hello! </span><span class="koboSpan" id="kobo.1655.2">I am TransientService. </span><span class="koboSpan" id="kobo.1655.3">My Id is 94e9e6c1-729a-4033-8a27-550ea10ba5d0. </span><span class="koboSpan" id="kobo.1655.4">I was created at 2023-10-21 11:20:57.</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1656.1">Hello! </span><span class="koboSpan" id="kobo.1656.2">I am SingletonService. </span><span class="koboSpan" id="kobo.1656.3">My Id is 95a44c5b-8678-48c6-a2f0-cc6b90423773. </span><span class="koboSpan" id="kobo.1656.4">I was created at 2023-10-21 11:20:44.</span></strong></pre>
<p><span class="koboSpan" id="kobo.1657.1">We can see that in each </span><a id="_idIndexMarker233"/><span class="koboSpan" id="kobo.1658.1">request, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1659.1">ScopedService</span></strong><span class="koboSpan" id="kobo.1660.1"> was created once, while </span><strong class="source-inline"><span class="koboSpan" id="kobo.1661.1">ITransientService</span></strong><span class="koboSpan" id="kobo.1662.1"> was created twice. </span><span class="koboSpan" id="kobo.1662.2">In both requests, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1663.1">SingletonService</span></strong><span class="koboSpan" id="kobo.1664.1"> was created </span><span class="No-Break"><span class="koboSpan" id="kobo.1665.1">only once.</span></span></p>
<h3><span class="koboSpan" id="kobo.1666.1">Group registration</span></h3>
<p><span class="koboSpan" id="kobo.1667.1">As the</span><a id="_idIndexMarker234"/><span class="koboSpan" id="kobo.1668.1"> project grows, we may have more and more services. </span><span class="koboSpan" id="kobo.1668.2">If we register all services in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1669.1">Program.cs</span></strong><span class="koboSpan" id="kobo.1670.1">, this file will be very large. </span><span class="koboSpan" id="kobo.1670.2">For this case, we can use group registration to register multiple services at once. </span><span class="koboSpan" id="kobo.1670.3">For example, we can create a service group </span><span class="No-Break"><span class="koboSpan" id="kobo.1671.1">named </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1672.1">LifetimeServicesCollectionExtensions.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1673.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1674.1">
public static class LifetimeServicesCollectionExtensions{
    public static IServiceCollection AddLifetimeServices(this IServiceCollection services)
    {
        services.AddScoped&lt;IScopedService, ScopedService&gt;();
        services.AddTransient&lt;ITransientService, TransientService&gt;();
        services.AddSingleton&lt;ISingletonService, SingletonService&gt;();
        return services;
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.1675.1">This is an extension method for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1676.1">IServiceCollection</span></strong><span class="koboSpan" id="kobo.1677.1"> interface. </span><span class="koboSpan" id="kobo.1677.2">It is used to register all services at once in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1678.1">Program.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1679.1"> file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1680.1">
// Group registrationbuilder.Services.AddLifetimeServices();</span></pre>
<p><span class="koboSpan" id="kobo.1681.1">In this way, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1682.1">Program.cs</span></strong><span class="koboSpan" id="kobo.1683.1"> file will be </span><a id="_idTextAnchor120"/><span class="koboSpan" id="kobo.1684.1">smaller and easier </span><span class="No-Break"><span class="koboSpan" id="kobo.1685.1">to read.</span></span></p>
<h3><span class="koboSpan" id="kobo.1686.1">Action injection</span></h3>
<p><span class="koboSpan" id="kobo.1687.1">Sometimes, one</span><a id="_idIndexMarker235"/><span class="koboSpan" id="kobo.1688.1"> controller may need many services but may not need all of them for all actions. </span><span class="koboSpan" id="kobo.1688.2">If we inject all the dependencies from the constructor, the constructor method will be large. </span><span class="koboSpan" id="kobo.1688.3">For this case, we can use action injection to inject dependencies only when needed. </span><span class="koboSpan" id="kobo.1688.4">See the </span><span class="No-Break"><span class="koboSpan" id="kobo.1689.1">following example:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1690.1">
[HttpGet]public ActionResult Get([FromServices] ITransientService transientService)
{
  ...
</span><span class="koboSpan" id="kobo.1690.2">}</span></pre>
<p><span class="koboSpan" id="kobo.1691.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1692.1">[FromServices]</span></strong><span class="koboSpan" id="kobo.1693.1"> attribute enables the service container to inject dependencies when needed without using constructor injection. </span><span class="koboSpan" id="kobo.1693.2">However, if you find that a service needs a lot of dependencies, it may indicate that the class has too many responsibilities. </span><span class="koboSpan" id="kobo.1693.3">Based on</span><a id="_idIndexMarker236"/><span class="koboSpan" id="kobo.1694.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.1695.1">Single Responsibility Principle</span></strong><span class="koboSpan" id="kobo.1696.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1697.1">SRP</span></strong><span class="koboSpan" id="kobo.1698.1">), consider refactoring the class to split the responsibilities into </span><span class="No-Break"><span class="koboSpan" id="kobo.1699.1">smaller classes.</span></span></p>
<p><span class="koboSpan" id="kobo.1700.1">Keep in mind that this kind of action injection only works for actions in the controller. </span><span class="koboSpan" id="kobo.1700.2">It does not support normal classes. </span><span class="koboSpan" id="kobo.1700.3">Additionally, since ASP.NET Core 7.0, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1701.1">[FromServices]</span></strong><span class="koboSpan" id="kobo.1702.1"> attribute can be omitted as the framework will automatically attempt to resolve any complex type parameters registered in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1703.1">DI container.</span></span></p>
<h3><span class="koboSpan" id="kobo.1704.1">Keyed services</span></h3>
<p><span class="koboSpan" id="kobo.1705.1">ASP.NET Core 8.0 introduces </span><a id="_idIndexMarker237"/><span class="koboSpan" id="kobo.1706.1">a new feature known as keyed services, or named services. </span><span class="koboSpan" id="kobo.1706.2">This feature allows developers to register services with a key, allowing them to access the service with that key. </span><span class="koboSpan" id="kobo.1706.3">This makes it easier to manage multiple services that implement the same interface within an application, as the key can be used to identify and access </span><span class="No-Break"><span class="koboSpan" id="kobo.1707.1">the service.</span></span></p>
<p><span class="koboSpan" id="kobo.1708.1">For example, we have a service interface </span><span class="No-Break"><span class="koboSpan" id="kobo.1709.1">named </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1710.1">IDataService</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1711.1">:</span></span></p>
<pre class="source-code">
<strong class="source-inline"><span class="koboSpan" id="kobo.1712.1">public interface IDataService</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1713.1">{</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1714.1">    string GetData();</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1715.1">}</span></strong></pre>
<p><span class="koboSpan" id="kobo.1716.1">This </span><strong class="source-inline"><span class="koboSpan" id="kobo.1717.1">IDataService</span></strong><span class="koboSpan" id="kobo.1718.1"> interface has two implementations: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1719.1">SqlDatabaseService</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1720.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1721.1">CosmosDatabaseService</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1722.1">:</span></span></p>
<pre class="source-code">
<strong class="source-inline"><span class="koboSpan" id="kobo.1723.1">public class SqlDatabaseService : IDataService</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1724.1">{</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1725.1">    public string GetData()</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1726.1">    {</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1727.1">        return "Data from SQL Database";</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1728.1">    }</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1729.1">}</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1730.1">public class CosmosDatabaseService : IDataService</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1731.1">{</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1732.1">    public string GetData()</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1733.1">    {</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1734.1">        return "Data from Cosmos Database";</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1735.1">    }</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1736.1">}</span></strong></pre>
<p><span class="koboSpan" id="kobo.1737.1">We can register</span><a id="_idIndexMarker238"/><span class="koboSpan" id="kobo.1738.1"> them to the service container using </span><span class="No-Break"><span class="koboSpan" id="kobo.1739.1">different keys:</span></span></p>
<pre class="source-code">
<strong class="source-inline"><span class="koboSpan" id="kobo.1740.1">builder.Services.AddKeyedScoped&lt;IDataService, SqlDatabaseService&gt;("sqlDatabaseService");</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1741.1">builder.Services.AddKeyedScoped&lt;IDataService, CosmosDatabaseService&gt;("cosmosDatabaseService");</span></strong></pre>
<p><span class="koboSpan" id="kobo.1742.1">Then, we can inject the service by using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1743.1">FromKeyedServices</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1744.1"> attribute:</span></span></p>
<pre class="source-code">
<strong class="source-inline"><span class="koboSpan" id="kobo.1745.1">[ApiController]</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1746.1">[Route("[controller]")]</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1747.1">public class KeyedServicesController : ControllerBase</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1748.1">{</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1749.1">    [HttpGet("sql")]</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1750.1">    public ActionResult GetSqlData([FromKeyedServices("sqlDatabaseService")] IDataService dataService) =&gt;</span></strong><span class="koboSpan" id="kobo.1751.1">
        </span><strong class="source-inline"><span class="koboSpan" id="kobo.1752.1">Content(dataService.GetData());</span></strong><span class="koboSpan" id="kobo.1753.1">
    </span><strong class="source-inline"><span class="koboSpan" id="kobo.1754.1">[HttpGet("cosmos")]</span></strong><span class="koboSpan" id="kobo.1755.1">
    </span><strong class="source-inline"><span class="koboSpan" id="kobo.1756.1">public ActionResult GetCosmosData([FromKeyedServices("cosmosDatabaseService")] IDataService dataService) =&gt;</span></strong><span class="koboSpan" id="kobo.1757.1">
        </span><strong class="source-inline"><span class="koboSpan" id="kobo.1758.1">Content(dataService.GetData());</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1759.1">}</span></strong></pre>
<p><span class="koboSpan" id="kobo.1760.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1761.1">FromKeyedServices</span></strong><span class="koboSpan" id="kobo.1762.1"> attribute </span><a id="_idIndexMarker239"/><span class="koboSpan" id="kobo.1763.1">is used to inject the service by using the specified key. </span><span class="koboSpan" id="kobo.1763.2">Test the API with HttpRepl, and you will see the output </span><span class="No-Break"><span class="koboSpan" id="kobo.1764.1">as follows:</span></span></p>
<pre class="source-code">
<strong class="source-inline"><span class="koboSpan" id="kobo.1765.1">http://localhost:5147/&gt; get keyedServices/sql</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1766.1">HTTP/1.1 200 OK</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1767.1">Content-Length: 22</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1768.1">Content-Type: text/plain; charset=utf-8</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1769.1">Date: Fri, 20 Oct 2023 22:48:49 GMT</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1770.1">Server: Kestrel</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1771.1">Data from SQL Database</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1772.1">http://localhost:5147/&gt; get keyedServices/cosmos</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1773.1">HTTP/1.1 200 OK</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1774.1">Content-Length: 25</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1775.1">Content-Type: text/plain; charset=utf-8</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1776.1">Date: Fri, 20 Oct 2023 22:48:54 GMT</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1777.1">Server: Kestrel</span></strong>
<strong class="source-inline"><span class="koboSpan" id="kobo.1778.1">Data from Cosmos Database</span></strong></pre>
<p><span class="koboSpan" id="kobo.1779.1">The </span><a id="_idIndexMarker240"/><span class="koboSpan" id="kobo.1780.1">keyed services can be used to register singleton or transient services as well. </span><span class="koboSpan" id="kobo.1780.2">Just use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1781.1">AddKeyedSingleton()</span></strong><span class="koboSpan" id="kobo.1782.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1783.1">AddKeyedTransient()</span></strong><span class="koboSpan" id="kobo.1784.1"> method respectively; </span><span class="No-Break"><span class="koboSpan" id="kobo.1785.1">for example:</span></span></p>
<pre class="source-code">
<strong class="source-inline"><span class="koboSpan" id="kobo.1786.1">builder.Services.AddKeyedSingleton&lt;IDataService, SqlDatabaseService&gt;("sqlDatabaseService");</span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.1787.1">builder.Services.AddKeyedTransient&lt;IDataService, CosmosDatabaseService&gt;("cosmosDatabaseService");</span></strong></pre>
<p><span class="koboSpan" id="kobo.1788.1">It is important to note that if an empty string is passed as the key, a default implementation</span><a id="_idIndexMarker241"/><span class="koboSpan" id="kobo.1789.1"> for the service must be registered with a key of an empty string, otherwise the service </span><a id="_idTextAnchor121"/><span class="koboSpan" id="kobo.1790.1">container will throw </span><span class="No-Break"><span class="koboSpan" id="kobo.1791.1">an exception.</span></span></p>
<p><span class="koboSpan" id="kobo.1792.1">Microsoft releases new versions of .NET SDKs frequently. </span><span class="koboSpan" id="kobo.1792.2">If you encounter a different version number, that </span><span class="No-Break"><span class="koboSpan" id="kobo.1793.1">is acceptable.</span></span></p>
<p><span class="koboSpan" id="kobo.1794.1">The preceding command will list all the available SDKs on your machine. </span><span class="koboSpan" id="kobo.1794.2">For example, it may show the following output if have multiple .NET </span><span class="No-Break"><span class="koboSpan" id="kobo.1795.1">SDKs installed.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1796.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1797.1">Every Microsoft product has a lifecycle. </span><span class="koboSpan" id="kobo.1797.2">.NET and .NET Core provides </span><strong class="bold"><span class="koboSpan" id="kobo.1798.1">Long-term support</span></strong><span class="koboSpan" id="kobo.1799.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1800.1">LTS</span></strong><span class="koboSpan" id="kobo.1801.1">) releases that get 3 years of patches and free support. </span><span class="koboSpan" id="kobo.1801.2">When this book was written, .NET 7 is still supported, until May 2024. </span><span class="koboSpan" id="kobo.1801.3">Based on Microsoft’s policy, even numbered releases are LTS releases. </span><span class="koboSpan" id="kobo.1801.4">So .NET 8 is the latest LTS release. </span><span class="koboSpan" id="kobo.1801.5">The code samples in this book are written with .</span><span class="No-Break"><span class="koboSpan" id="kobo.1802.1">NET 8.0.</span></span></p>
<p><span class="koboSpan" id="kobo.1803.1">When you use VS Code to open the project, the C# Dev Kit extension can create a solution file for you. </span><span class="koboSpan" id="kobo.1803.2">This feature makes VS Code more friendly to C# developers. </span><span class="koboSpan" id="kobo.1803.3">You can see the following structure in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1804.1">Explorer view:</span></span></p>
<p><span class="koboSpan" id="kobo.1805.1">It uses the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1806.1">Swashbuckle.AspNetCore</span></strong><span class="koboSpan" id="kobo.1807.1"> NuGet package, which provides the Swagger UI to document and test </span><span class="No-Break"><span class="koboSpan" id="kobo.1808.1">the APIs.</span></span></p>
<p><span class="koboSpan" id="kobo.1809.1">Follow the steps below to use DI in </span><span class="No-Break"><span class="koboSpan" id="kobo.1810.1">ASP.NET Core:</span></span></p>
<p><span class="koboSpan" id="kobo.1811.1">We can see that in each request, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1812.1">ScopedService</span></strong><span class="koboSpan" id="kobo.1813.1"> was created once, while </span><strong class="source-inline"><span class="koboSpan" id="kobo.1814.1">ITransientService</span></strong><span class="koboSpan" id="kobo.1815.1"> was created twice. </span><span class="koboSpan" id="kobo.1815.2">In both requests, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1816.1">SingletonService</span></strong><span class="koboSpan" id="kobo.1817.1"> was created </span><span class="No-Break"><span class="koboSpan" id="kobo.1818.1">only once.</span></span></p>
<h3><span class="koboSpan" id="kobo.1819.1">Using primary constructors to inject dependencies</span></h3>
<p><span class="koboSpan" id="kobo.1820.1">Beginning with .NET 8 and C# 12, we can use the </span><a id="_idIndexMarker242"/><span class="koboSpan" id="kobo.1821.1">primary constructor</span><a id="_idIndexMarker243"/><span class="koboSpan" id="kobo.1822.1"> to inject dependencies. </span><span class="koboSpan" id="kobo.1822.2">A primary constructor allows us to declare the constructor parameters directly in the class declaration, instead of </span><a id="_idIndexMarker244"/><span class="koboSpan" id="kobo.1823.1">using a separate constructor method. </span><span class="koboSpan" id="kobo.1823.2">For example, we can update the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1824.1">PostsController</span></strong><span class="koboSpan" id="kobo.1825.1"> class </span><span class="No-Break"><span class="koboSpan" id="kobo.1826.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1827.1">
```csharppublic class PostsController(IPostService postService) : ControllerBase
{
    // No need to define a private field to store the service 
    // No need to define a constructor method
}
```</span></pre>
<p><span class="koboSpan" id="kobo.1828.1">You can </span><a id="_idIndexMarker245"/><span class="koboSpan" id="kobo.1829.1">find a sample named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1830.1">PrimaryConstructorController.cs</span></strong><span class="koboSpan" id="kobo.1831.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1832.1">Controller</span></strong><span class="koboSpan" id="kobo.1833.1"> folder of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1834.1">DependencyInjectionDemo</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1835.1"> project.</span></span></p>
<p><span class="koboSpan" id="kobo.1836.1">When using the primary constructor in a class, note that the parameters passed to the class declaration cannot be used as properties or members. </span><span class="koboSpan" id="kobo.1836.2">For example, if a class declares a parameter named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1837.1">postService</span></strong><span class="koboSpan" id="kobo.1838.1"> in the class declaration, it cannot be accessed as a class member using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1839.1">this.postService</span></strong><span class="koboSpan" id="kobo.1840.1"> or from external code. </span><span class="koboSpan" id="kobo.1840.2">To learn more about the primary constructor, please refer to the documentation </span><span class="No-Break"><span class="koboSpan" id="kobo.1841.1">at </span></span><span class="No-Break"><span class="koboSpan" id="kobo.1842.1">https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/instance-constructors#primary-constructors</span></span><span class="No-Break"><span class="koboSpan" id="kobo.1843.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1844.1">Primary constructors can save us from writing fields and constructor methods. </span><span class="koboSpan" id="kobo.1844.2">So, we’ll use them in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1845.1">following examples.</span></span></p>
<p><span class="koboSpan" id="kobo.1846.1">Do not use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1847.1">new</span></strong><span class="koboSpan" id="kobo.1848.1"> to create service B, otherwise, service A will be tightly coupled with </span><span class="No-Break"><span class="koboSpan" id="kobo.1849.1">service B.</span></span></p>
<h3><span class="koboSpan" id="kobo.1850.1">Resolving a service when the app starts</span></h3>
<p><span class="koboSpan" id="kobo.1851.1">If we </span><a id="_idIndexMarker246"/><span class="koboSpan" id="kobo.1852.1">need a service in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1853.1">Program.cs</span></strong><span class="koboSpan" id="kobo.1854.1"> file, we cannot use constructor injection. </span><span class="koboSpan" id="kobo.1854.2">For this situation, we can resolve a scoped service for a limited duration at app startup, </span><span class="No-Break"><span class="koboSpan" id="kobo.1855.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1856.1">
var app = builder.Build();using (var serviceScope = app.Services.CreateScope())
{
    var services = serviceScope.ServiceProvider;
    var demoService = services.GetRequiredService&lt;IDemoService&gt;();
    var message = demoService.SayHello()</span><a id="_idTextAnchor122"/><span class="koboSpan" id="kobo.1857.1">;
    Console.WriteLine(message);
}</span></pre>
<p><span class="koboSpan" id="kobo.1858.1">The preceding code creates a scope and resolves the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1859.1">IDemoService</span></strong><span class="koboSpan" id="kobo.1860.1"> service from the service container. </span><span class="koboSpan" id="kobo.1860.2">Then, it can use the service to do something. </span><span class="koboSpan" id="kobo.1860.3">After the scope is disposed of, the service will be disposed of </span><span class="No-Break"><span class="koboSpan" id="kobo.1861.1">as well.</span></span></p>
<h2 id="_idParaDest-62"><a id="_idTextAnchor123"/><span class="koboSpan" id="kobo.1862.1">DI tips</span></h2>
<p><span class="koboSpan" id="kobo.1863.1">ASP.NET Core </span><a id="_idIndexMarker247"/><span class="koboSpan" id="kobo.1864.1">uses DI heavily. </span><span class="koboSpan" id="kobo.1864.2">The following are some tips to help you </span><span class="No-Break"><span class="koboSpan" id="kobo.1865.1">use DI:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1866.1">When designing your services, make the services as stateless as possible. </span><span class="koboSpan" id="kobo.1866.2">Do not use static classes and members unless you have to do so. </span><span class="koboSpan" id="kobo.1866.3">If you need to use a global state, consider using a singleton </span><span class="No-Break"><span class="koboSpan" id="kobo.1867.1">service instead.</span></span></li>
<li><span class="koboSpan" id="kobo.1868.1">Carefully design dependency relationships between services. </span><span class="koboSpan" id="kobo.1868.2">Do not create a </span><span class="No-Break"><span class="koboSpan" id="kobo.1869.1">cyclic dependency.</span></span></li>
<li><span class="koboSpan" id="kobo.1870.1">Do not use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1871.1">new</span></strong><span class="koboSpan" id="kobo.1872.1"> to create a service instance in another service. </span><span class="koboSpan" id="kobo.1872.2">For example, if service A depends on service B, the instance of service B should be injected into service A with DI. </span><span class="koboSpan" id="kobo.1872.3">Do not use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1873.1">new</span></strong><span class="koboSpan" id="kobo.1874.1"> to create service B, otherwise, service A will be tightly coupled with </span><span class="No-Break"><span class="koboSpan" id="kobo.1875.1">service B.</span></span></li>
<li><span class="koboSpan" id="kobo.1876.1">Use a </span><a id="_idIndexMarker248"/><span class="koboSpan" id="kobo.1877.1">DI container to manage the lifetime of services. </span><span class="koboSpan" id="kobo.1877.2">If a service implements the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1878.1">IDisposable</span></strong><span class="koboSpan" id="kobo.1879.1"> interface, the DI container will dispose of the service when the scope is disposed of. </span><span class="koboSpan" id="kobo.1879.2">Do not manually dispose </span><span class="No-Break"><span class="koboSpan" id="kobo.1880.1">of it.</span></span></li>
<li><span class="koboSpan" id="kobo.1881.1">When registering a service, do not use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1882.1">new</span></strong><span class="koboSpan" id="kobo.1883.1"> to create an instance of the service. </span><span class="koboSpan" id="kobo.1883.2">For example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1884.1">services.AddSingleton(new ExampleService());</span></strong><span class="koboSpan" id="kobo.1885.1"> registers a service instance that is not managed by the service container. </span><span class="koboSpan" id="kobo.1885.2">So, the DI framework will not be able to dispose of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1886.1">service automatically.</span></span></li>
<li><span class="koboSpan" id="kobo.1887.1">Avoid using the service locator pattern. </span><span class="koboSpan" id="kobo.1887.2">If DI can be used, do not use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1888.1">GetService()</span></strong><span class="koboSpan" id="kobo.1889.1"> method to obtain a </span><span class="No-Break"><span class="koboSpan" id="kobo.1890.1">service instance.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1891.1">You can learn more about the DI guidelines </span><span class="No-Break"><span class="koboSpan" id="kobo.1892.1">at </span></span><a href="https://docs.microsoft.com/zh-cn/dotnet/core/extensions/dependency-injection-guidelines"><span class="No-Break"><span class="koboSpan" id="kobo.1893.1">https://docs.microsoft.com/zh-cn/dotnet/core/extensions/dependency-injection-guidelines</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1894.1">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1895.1">Why there is no configuration method for the logger in the template project?</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1896.1">ASP.NET Core provides a built-in DI implementation for the logger. </span><span class="koboSpan" id="kobo.1896.2">When the project was created, logging was registered by the ASP.NET Core framework. </span><span class="koboSpan" id="kobo.1896.3">Therefore, there is no configuration method for the logger in the template project. </span><span class="koboSpan" id="kobo.1896.4">Actually, there are more than 250 services that are automatically registered by the ASP.NET </span><span class="No-Break"><span class="koboSpan" id="kobo.1897.1">Core framework.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1898.1">Can I use third-party DI containers?</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1899.1">It is highly recommended that you use the built-in DI implementation in ASP.NET Core. </span><span class="koboSpan" id="kobo.1899.2">But if you need any specific features that it does not support, such as property injection, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1900.1">Func&lt;T&gt;</span></strong><span class="koboSpan" id="kobo.1901.1"> support for lazy initialization, and so on, you can use third-party DI containers, such as </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1902.1">Autofac</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1903.1"> (</span></span><a href="https://autofac.org/"><span class="No-Break"><span class="koboSpan" id="kobo.1904.1">https://autofac.org/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1905.1">).</span></span></p>
<h1 id="_idParaDest-63"><a id="_idTextAnchor124"/><span class="koboSpan" id="kobo.1906.1">Introduction to minimal APIs</span></h1>
<p><span class="koboSpan" id="kobo.1907.1">In the </span><a id="_idIndexMarker249"/><span class="koboSpan" id="kobo.1908.1">previous section, </span><em class="italic"><span class="koboSpan" id="kobo.1909.1">Creating a simple web API project</span></em><span class="koboSpan" id="kobo.1910.1">, we created a simple web API project using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1911.1">dotnet new webapi -n MyFirstApi -controllers</span></strong><span class="koboSpan" id="kobo.1912.1"> command. </span><span class="koboSpan" id="kobo.1912.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1913.1">-controllers</span></strong><span class="koboSpan" id="kobo.1914.1"> option (or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1915.1">--use-controllers</span></strong><span class="koboSpan" id="kobo.1916.1">) indicates that the project will use controller-based routing. </span><span class="koboSpan" id="kobo.1916.2">Alternatively, the             </span><strong class="source-inline"><span class="koboSpan" id="kobo.1917.1">-minimal</span></strong><span class="koboSpan" id="kobo.1918.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1919.1">--use-minimal-apis</span></strong><span class="koboSpan" id="kobo.1920.1"> option can be used to create a project that uses minimal APIs. </span><span class="koboSpan" id="kobo.1920.2">In this section, we will introduce </span><span class="No-Break"><span class="koboSpan" id="kobo.1921.1">minimal APIs.</span></span></p>
<p><span class="koboSpan" id="kobo.1922.1">Minimal APIs is a new feature introduced in ASP.NET Core 6.0. </span><span class="koboSpan" id="kobo.1922.2">It is a new way to create APIs without using controllers. </span><span class="koboSpan" id="kobo.1922.3">Minimal APIs are designed to be simple and lightweight with minimal dependencies. </span><span class="koboSpan" id="kobo.1922.4">They are a good choice for small projects or prototypes, and also for projects that do not need the full features </span><span class="No-Break"><span class="koboSpan" id="kobo.1923.1">of controllers.</span></span></p>
<p><span class="koboSpan" id="kobo.1924.1">To create a minimal API project, we can use the </span><span class="No-Break"><span class="koboSpan" id="kobo.1925.1">following command:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1926.1">dotnet new webapi -n </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1927.1">MinimalApiDemo -minimal</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1928.1">There is no </span><strong class="source-inline"><span class="koboSpan" id="kobo.1929.1">Controllers</span></strong><span class="koboSpan" id="kobo.1930.1"> folder in the project. </span><span class="koboSpan" id="kobo.1930.2">Instead, you can find the following code in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1931.1">Program.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1932.1"> file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1933.1">
app.MapGet("/weatherforecast", () =&gt;{
    var forecast =  Enumerable.Range(1, 5).Select(index =&gt;
        new WeatherForecast
        (
            DateOnly.FromDateTime(DateTime.Now.AddDays(index)),
            Random.Shared.Next(-20, 55),
            summaries[Random.Shared.Next(summaries.Length)]
        ))
        .ToArray();
    return forecast;
})
.WithName("GetWeatherForecast")
.WithOpenApi();</span></pre>
<p><span class="koboSpan" id="kobo.1934.1">The preceding</span><a id="_idIndexMarker250"/><span class="koboSpan" id="kobo.1935.1"> code uses the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1936.1">MapGet()</span></strong><span class="koboSpan" id="kobo.1937.1"> method to map the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1938.1">GET</span></strong><span class="koboSpan" id="kobo.1939.1"> request to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1940.1">/weatherforecast</span></strong><span class="koboSpan" id="kobo.1941.1"> endpoint. </span><span class="koboSpan" id="kobo.1941.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1942.1">MapGet()</span></strong><span class="koboSpan" id="kobo.1943.1"> method is an extension method of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1944.1">IEndpointRouteBuilder</span></strong><span class="koboSpan" id="kobo.1945.1"> interface. </span><span class="koboSpan" id="kobo.1945.2">This interface is used to configure the endpoints in the application. </span><span class="koboSpan" id="kobo.1945.3">Its extension method, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1946.1">MapGet()</span></strong><span class="koboSpan" id="kobo.1947.1">, returns an </span><strong class="source-inline"><span class="koboSpan" id="kobo.1948.1">IEndpointConventionBuilder</span></strong><span class="koboSpan" id="kobo.1949.1"> interface that allows us to use fluent APIs to configure the endpoint by using other extension methods, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1950.1">WithName()</span></strong><span class="koboSpan" id="kobo.1951.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1952.1">WithOpenApi()</span></strong><span class="koboSpan" id="kobo.1953.1">. </span><span class="koboSpan" id="kobo.1953.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1954.1">WithName()</span></strong><span class="koboSpan" id="kobo.1955.1"> method is used to set the name of the endpoint. </span><span class="koboSpan" id="kobo.1955.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1956.1">WithOpenApi()</span></strong><span class="koboSpan" id="kobo.1957.1"> method is used to generate an OpenAPI document for </span><span class="No-Break"><span class="koboSpan" id="kobo.1958.1">the endpoint.</span></span></p>
<h2 id="_idParaDest-64"><a id="_idTextAnchor125"/><span class="koboSpan" id="kobo.1959.1">Creating a simple endpoint</span></h2>
<p><span class="koboSpan" id="kobo.1960.1">Let us</span><a id="_idIndexMarker251"/><span class="koboSpan" id="kobo.1961.1"> create a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.1962.1">/posts</span></strong><span class="koboSpan" id="kobo.1963.1"> endpoint that supports CRUD operations. </span><span class="koboSpan" id="kobo.1963.2">First, add the following code to the end of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1964.1">Program.cs</span></strong><span class="koboSpan" id="kobo.1965.1"> file to define a </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1966.1">Post</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1967.1"> class:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1968.1">
public class Post{
    public int Id { get; set; }
    public string Title { get; set; } = string.Empty;
    public string Content { get; set; } = string.Empty;
}</span></pre>
<p><span class="koboSpan" id="kobo.1969.1">Add the following code to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1970.1">Program.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1971.1"> file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1972.1">
var list = new List&lt;Post&gt;(){
    new() { Id = 1, Title = "First Post", Content = "Hello World" },
    new() { Id = 2, Title = "Second Post", Content = "Hello Again" },
    new() { Id = 3, Title = "Third Post", Content = "Goodbye World" },
};
app.MapGet("/posts",
    () =&gt; list).WithName("GetPosts").WithOpenApi().WithTags("Posts");
app.MapPost("/posts",
    (Post post) =&gt;
    {
        list.Add(post);
        return Results.Created($"/posts/{post.Id}", post);
    }).WithName("CreatePost").WithOpenApi().WithTags("Posts");
app.MapGet("/posts/{id}", (int id) =&gt;
{
    var post = list.FirstOrDefault(p =&gt; p.Id == id);
    return post == null ? </span><span class="koboSpan" id="kobo.1972.2">Results.NotFound() : Results.Ok(post);
}).WithName("GetPost").WithOpenApi().WithTags("Posts");
app.MapPut("/posts/{id}", (int id, Post post) =&gt;
{
    var index = list.FindIndex(p =&gt; p.Id == id);
    if (index == -1)
    {
        return Results.NotFound();
    }
    list[index] = post;
    return Results.Ok(post);
}).WithName("UpdatePost").WithOpenApi().WithTags("Posts");
app.MapDelete("/posts/{id}", (int id) =&gt;
{
    var post = list.FirstOrDefault(p =&gt; p.Id == id);
    if (post == null)
    {
        return Results.NotFound();
    }
    list.Remove(post);
    return Results.Ok();
}).WithName("DeletePost").WithOpenApi().WithTags("Posts");</span></pre>
<p><span class="koboSpan" id="kobo.1973.1">The preceding </span><a id="_idIndexMarker252"/><span class="koboSpan" id="kobo.1974.1">code defines </span><span class="No-Break"><span class="koboSpan" id="kobo.1975.1">five endpoints:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1976.1">GET /posts</span></strong><span class="koboSpan" id="kobo.1977.1">: Get </span><span class="No-Break"><span class="koboSpan" id="kobo.1978.1">all posts</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1979.1">POST /posts</span></strong><span class="koboSpan" id="kobo.1980.1">: Create a </span><span class="No-Break"><span class="koboSpan" id="kobo.1981.1">new post</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1982.1">GET /posts/{id}</span></strong><span class="koboSpan" id="kobo.1983.1">: Get a post </span><span class="No-Break"><span class="koboSpan" id="kobo.1984.1">by ID</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1985.1">PUT /posts/{id}</span></strong><span class="koboSpan" id="kobo.1986.1">: Update a post </span><span class="No-Break"><span class="koboSpan" id="kobo.1987.1">by ID</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1988.1">DELETE /posts/{id}</span></strong><span class="koboSpan" id="kobo.1989.1">: Delete a post </span><span class="No-Break"><span class="koboSpan" id="kobo.1990.1">by ID</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1991.1">We use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1992.1">WithTags</span></strong><span class="koboSpan" id="kobo.1993.1"> extension method to group these endpoints into a tag named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1994.1">Posts</span></strong><span class="koboSpan" id="kobo.1995.1">. </span><span class="koboSpan" id="kobo.1995.2">In this example, a list is used to store the posts. </span><span class="koboSpan" id="kobo.1995.3">In a real-world application, we should use a database to store </span><span class="No-Break"><span class="koboSpan" id="kobo.1996.1">the data.</span></span></p>
<h2 id="_idParaDest-65"><a id="_idTextAnchor126"/><span class="koboSpan" id="kobo.1997.1">Using DI in minimal APIs</span></h2>
<p><span class="koboSpan" id="kobo.1998.1">Minimal APIs </span><a id="_idIndexMarker253"/><span class="koboSpan" id="kobo.1999.1">support DI as well. </span><span class="koboSpan" id="kobo.1999.2">You can find the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2000.1">IPostService</span></strong><span class="koboSpan" id="kobo.2001.1"> interface and its </span><strong class="source-inline"><span class="koboSpan" id="kobo.2002.1">PostService</span></strong><span class="koboSpan" id="kobo.2003.1"> implementation in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2004.1">Services</span></strong><span class="koboSpan" id="kobo.2005.1"> folder. </span><span class="koboSpan" id="kobo.2005.2">Here is an example of using DI in </span><span class="No-Break"><span class="koboSpan" id="kobo.2006.1">minimal APIs:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.2007.1">
app.MapGet("/posts", async (IPostService postService) =&gt;{
    var posts = await postService.GetPostsAsync();
    return posts;
}).WithName("GetPosts").WithOpenApi().WithTags("Posts");
app.MapGet("/posts/{id}", async (IPostService postService, int id) =&gt;
{
    var post = await postService.GetPostAsync(id);
    return post == null ? </span><span class="koboSpan" id="kobo.2007.2">Results.NotFound() : Results.Ok(post);
}).WithName("GetPost").WithOpenApi().WithTags("Posts");
app.MapPost("/posts", async (IPostService postService, Post post) =&gt;
{
    var createdPost = await postService.CreatePostAsync(post);
    return Results.Created($"/posts/{createdPost.Id}", createdPost);
}).WithName("CreatePost").WithOpenApi().WithTags("Posts");
app.MapPut("/posts/{id}", async (IPostService postService, int id, Post post) =&gt;
{
    try
    {
        var updatedPost = await postService.UpdatePostAsync(id, post);
        return Results.Ok(updatedPost);
    }
    catch (KeyNotFoundException)
    {
        return Results.NotFound();
    }
}).WithName("UpdatePost").WithOpenApi().WithTags("Posts");
app.MapDelete("/posts/{id}", async (IPostService postService, int id) =&gt;
{
    try
    {
        await postService.DeletePostAsync(id);
        return Results.NoContent();
    }
    catch (KeyNotFoundException)
    {
        return Results.NotFound();
    }
}).WithName("DeletePost").WithOpenApi().WithTags("Posts");</span></pre>
<p><span class="koboSpan" id="kobo.2008.1">In the</span><a id="_idIndexMarker254"/><span class="koboSpan" id="kobo.2009.1"> preceding code, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2010.1">IPostService</span></strong><span class="koboSpan" id="kobo.2011.1"> interface is used as a parameter of the action method. </span><span class="koboSpan" id="kobo.2011.2">The DI container will inject the correct implementation into the action method. </span><span class="koboSpan" id="kobo.2011.3">You can run the project and test the endpoints. </span><span class="koboSpan" id="kobo.2011.4">It should have the same behavior as the </span><span class="No-Break"><span class="koboSpan" id="kobo.2012.1">controller-based project.</span></span></p>
<h2 id="_idParaDest-66"><a id="_idTextAnchor127"/><span class="koboSpan" id="kobo.2013.1">What is the difference between minimal APIs and controller-based APIs?</span></h2>
<p><span class="koboSpan" id="kobo.2014.1">Minimal APIs are </span><a id="_idIndexMarker255"/><span class="koboSpan" id="kobo.2015.1">simpler than controller-based APIs, allowing us to map endpoints to methods directly. </span><span class="koboSpan" id="kobo.2015.2">This makes minimal APIs a good choice for quickly creating simple APIs or demo projects. </span><span class="koboSpan" id="kobo.2015.3">However, minimal APIs do not support the full range of features that controllers provide, such as model binding, model validation, and so on. </span><span class="koboSpan" id="kobo.2015.4">These features may be added in the future. </span><span class="koboSpan" id="kobo.2015.5">Therefore, we will mainly use controller-based APIs and not discuss minimal APIs in detail in this book. </span><span class="koboSpan" id="kobo.2015.6">If you want to learn more about minimal APIs, please refer to the official documentation </span><span class="No-Break"><span class="koboSpan" id="kobo.2016.1">at </span></span><a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/minimal-apis"><span class="No-Break"><span class="koboSpan" id="kobo.2017.1">https://learn.microsoft.com/</span><span id="_idTextAnchor128"/><span class="koboSpan" id="kobo.2018.1">en-us/aspnet/core/fundamentals/minimal-apis</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.2019.1">.</span></span></p>
<h1 id="_idParaDest-67"><a id="_idTextAnchor129"/><span class="koboSpan" id="kobo.2020.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.2021.1">In this chapter, we created a simple web API project and introduced how to run the project locally and call the APIs with different clients. </span><span class="koboSpan" id="kobo.2021.2">We implemented basic CRUD operations using an in-memory list. </span><span class="koboSpan" id="kobo.2021.3">Also, we explained how to use DI in ASP.NET Core. </span><span class="koboSpan" id="kobo.2021.4">We explored the lifetime of services and learned some tips. </span><span class="koboSpan" id="kobo.2021.5">In addition, we introduced minimal APIs. </span><span class="koboSpan" id="kobo.2021.6">In the next chapter, we will delve further into the built-in components of </span><span class="No-Break"><span class="koboSpan" id="kobo.2022.1">ASP.NET Core.</span></span></p>
</div>
</body></html>