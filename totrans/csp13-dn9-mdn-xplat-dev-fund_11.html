<html><head></head><body><div id="book-content"><div id="sbo-rt-content"><div id="_idContainer564" class="Basic-Text-Frame">
    <h1 class="chapterNumber">11</h1>
    <h1 id="_idParaDest-661" class="chapterTitle">Querying and Manipulating Data Using LINQ</h1>
    <p class="normal">This chapter is about <strong class="keyWord">Language INtegrated Query</strong> (<strong class="keyWord">LINQ</strong>) expressions. LINQ is a set of <a id="_idIndexMarker1682"/>language extensions that enable you to work with sequences of data and then filter, sort, and project them into different outputs.</p>
    <p class="normal">This chapter will cover the following topics:</p>
    <ul>
      <li class="bulletList">Writing LINQ expressions</li>
      <li class="bulletList">LINQ in practice</li>
      <li class="bulletList">Sorting and more</li>
      <li class="bulletList">Using LINQ with EF Core</li>
      <li class="bulletList">Joining, grouping, and lookups</li>
    </ul>
    <h1 id="_idParaDest-662" class="heading-1">Writing LINQ expressions</h1>
    <p class="normal">The first <a id="_idIndexMarker1683"/>question we need to answer is a fundamental one: <em class="italic">Why does LINQ exist?</em></p>
    <h2 id="_idParaDest-663" class="heading-2">Comparing imperative and declarative language features</h2>
    <p class="normal">LINQ <a id="_idIndexMarker1684"/>was introduced in 2008 <a id="_idIndexMarker1685"/>with C# 3 and .NET Framework 3. Before that, if a C# and .NET programmer wanted to process a sequence <a id="_idIndexMarker1686"/>of items, they <a id="_idIndexMarker1687"/>had to use procedural, aka imperative, code statements. For example, a loop:</p>
    <ol>
      <li class="numberedList" value="1">Set the current position to the first item.</li>
      <li class="numberedList">Check if the item is one that should be processed by comparing one or more properties against specified values. For example, is the unit price greater than 50, or is the country equal to Belgium?</li>
      <li class="numberedList">If there’s a match, process that item. For example, output one or more of its properties to the user, update one or more properties to new values, delete the item, or perform an aggregate calculation, like counting or summing values.</li>
      <li class="numberedList">Move on to the next item. Repeat until all items have been processed.</li>
    </ol>
    <p class="normal">Procedural code tells the compiler <em class="italic">how</em> to achieve a goal. Do this, then do that. Since the compiler does not know what you are trying to achieve, it cannot help you as much. You are 100% responsible for ensuring that every <em class="italic">how-to</em> step is correct.</p>
    <p class="normal">LINQ makes these common tasks much easier, with less opportunity to introduce subtle bugs. Instead of needing to explicitly state each individual action, like move, read, update, and so on, LINQ enables the programmer to use a declarative aka functional style of writing statements.</p>
    <p class="normal">Declarative, aka functional, code tells the compiler <em class="italic">what</em> goal to achieve. The compiler works out the best way to achieve it. The statements also tend to be more concise.</p>
    <div class="packt_tip">
      <p class="normal"><strong class="keyWord">Good Practice</strong>: If you do not fully understand how LINQ works, then the statements you write can introduce their own subtle bugs! A code teaser doing the rounds in 2022 involved a sequence of tasks and understanding when they are executed (<a href="https://twitter.com/amantinband/status/1559187912218099714"><span class="url">https://twitter.com/amantinband/status/1559187912218099714</span></a>). Most experienced developers got it wrong! To be fair, it is the combination of LINQ behavior with multi-threading behavior that confused most. But by the end of this chapter, you will be better informed to understand why the code was dangerous due to LINQ behavior.</p>
    </div>
    <p class="normal">Although <a id="_idIndexMarker1688"/>we wrote a few LINQ <a id="_idIndexMarker1689"/>expressions in <em class="chapterRef">Chapter 10</em>, <em class="italic">Working with Data Using Entity Framework Core</em>, they <a id="_idIndexMarker1690"/>weren’t the focus, so I didn’t properly explain how LINQ works. Let’s now take the time to properly understand them.</p>
    <h2 id="_idParaDest-664" class="heading-2">LINQ components</h2>
    <p class="normal">LINQ <a id="_idIndexMarker1691"/>has several parts; some are required, and <a id="_idIndexMarker1692"/>some are optional:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Extension methods </strong>(<strong class="keyWord">required</strong>): These <a id="_idIndexMarker1693"/>include examples such as <code class="inlineCode">Where</code>, <code class="inlineCode">OrderBy</code>, and <code class="inlineCode">Select</code>. These are what provide the functionality of LINQ.</li>
      <li class="bulletList"><strong class="keyWord">LINQ providers </strong>(<strong class="keyWord">required</strong>): These <a id="_idIndexMarker1694"/>include <strong class="keyWord">LINQ to Objects</strong> for <a id="_idIndexMarker1695"/>processing in-memory <a id="_idIndexMarker1696"/>objects, <strong class="keyWord">LINQ to Entities</strong> for processing data stored in external databases and modeled with EF Core, and <strong class="keyWord">LINQ to XML</strong> for <a id="_idIndexMarker1697"/>processing data stored as XML. These providers are the part of LINQ that executes LINQ expressions in a way specific to different types of data.</li>
      <li class="bulletList"><strong class="keyWord">Lambda expressions</strong> (<strong class="keyWord">optional</strong>): These can be used instead of named methods <a id="_idIndexMarker1698"/>to simplify LINQ queries, for example, for the conditional logic of the <code class="inlineCode">Where</code> method for filtering.</li>
      <li class="bulletList"><strong class="keyWord">LINQ query comprehension syntax </strong>(<strong class="keyWord">optional</strong>): These include C# keywords like <code class="inlineCode">from</code>, <code class="inlineCode">in</code>, <code class="inlineCode">where</code>, <code class="inlineCode">orderby</code>, <code class="inlineCode">descending</code>, and <code class="inlineCode">select</code>. These are <a id="_idIndexMarker1699"/>aliases for some of the LINQ extension methods, and their use can simplify the queries you write, especially if you already have experience <a id="_idIndexMarker1700"/>with other query languages, such as <strong class="keyWord">Structured Query Language</strong> (<strong class="keyWord">SQL</strong>).</li>
    </ul>
    <p class="normal">When programmers are first introduced to LINQ, they often believe that LINQ query comprehension syntax is LINQ, but ironically, that is one of the parts of LINQ that is optional!</p>
    <h2 id="_idParaDest-665" class="heading-2">Building LINQ expressions with the Enumerable class</h2>
    <p class="normal">The LINQ <a id="_idIndexMarker1701"/>extension methods, such as <code class="inlineCode">Where</code> and <code class="inlineCode">Select</code>, are appended by the <code class="inlineCode">Enumerable</code> static class to any type, known <a id="_idIndexMarker1702"/>as a <strong class="keyWord">sequence</strong>, that implements <code class="inlineCode">IEnumerable&lt;T&gt;</code>. A sequence contains zero, one, or more items.</p>
    <p class="normal">For example, an array of any type implements the <code class="inlineCode">IEnumerable&lt;T&gt;</code> class, where <code class="inlineCode">T</code> is the <a id="_idIndexMarker1703"/>type of item in the array. This means that all arrays support LINQ to query and manipulate them.</p>
    <p class="normal">All generic collections, such as <code class="inlineCode">List&lt;T&gt;</code>, <code class="inlineCode">Dictionary&lt;TKey, TValue&gt;</code>, <code class="inlineCode">Stack&lt;T&gt;</code>, and <code class="inlineCode">Queue&lt;T&gt;</code>, implement <code class="inlineCode">IEnumerable&lt;T&gt;</code>, so they can be queried and manipulated with LINQ too.</p>
    <p class="normal"><code class="inlineCode">Enumerable</code> defines more than 50 extension methods, as summarized in <em class="italic">Table 11.1</em> and <em class="italic">Table 11.2</em>.</p>
    <div class="note">
      <p class="normal">These tables will be useful for you for future reference, but for now, you might want to briefly scan them to get a feel for what extension methods exist and come back later to review them properly. An online version of these tables is available at the following link: <a href="https://github.com/markjprice/cs13net9/blob/main/docs/ch11-linq-methods.md"><span class="url">https://github.com/markjprice/cs13net9/blob/main/docs/ch11-linq-methods.md</span></a>.</p>
    </div>
    <p class="normal">First, here <a id="_idIndexMarker1704"/>are the deferred <a id="_idIndexMarker1705"/>methods that return a new sequence of <code class="inlineCode">IEnumerable&lt;T&gt;</code> items:</p>
    <table id="table001-10" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Method(s)</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Where</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Returns a sequence of items that match a specified filter.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Index</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Returns a sequence of both the items and their indices. Introduced with .NET 9.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Select</code> and <code class="inlineCode">SelectMany</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Project items into a different shape, that is, a different type, and flattens a nested hierarchy of items.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Skip</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Skips a number of items.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">SkipWhile</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Skips while an expression is <code class="inlineCode">true</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">SkipLast</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Returns a new enumerable collection that contains elements from the source, with the last count elements of the source collection omitted.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Take</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Takes a number of items. .NET 6 introduced an overload that can be passed a <code class="inlineCode">Range</code>, for example, <code class="inlineCode">Take(range: 3..^5)</code>, meaning take a subset starting three items in from the start and ending five items in from the end, or instead of <code class="inlineCode">Skip(4)</code>, you could use <code class="inlineCode">Take(4..)</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">TakeWhile</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Takes items while an expression is <code class="inlineCode">true</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">TakeLast</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Returns a new enumerable collection that contains the last count elements from the source.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">OrderBy</code>, <code class="inlineCode">OrderByDescending</code>, <code class="inlineCode">ThenBy</code>, and <code class="inlineCode">ThenByDescending</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Sort items by a specified field or property.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Order</code> and <code class="inlineCode">OrderDescending</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Sort items by the item itself.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Reverse</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Reverses the order of the items.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">GroupBy</code>, <code class="inlineCode">GroupJoin</code>, and <code class="inlineCode">Join</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Group and/or join two sequences.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">AggregateBy</code>, <code class="inlineCode">CountBy</code>, <code class="inlineCode">DistinctBy</code>, <code class="inlineCode">ExceptBy</code>, <code class="inlineCode">IntersectBy</code>, <code class="inlineCode">UnionBy</code>, <code class="inlineCode">MinBy</code>, and <code class="inlineCode">MaxBy</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Allow <a id="_idIndexMarker1706"/>the comparison to be performed on a subset of items rather than all of them. For example, instead of removing duplicates with <code class="inlineCode">Distinct</code> by comparing an entire <code class="inlineCode">Person</code> object, you could remove <a id="_idIndexMarker1707"/>duplicates with <code class="inlineCode">DistinctBy</code> by comparing just their <code class="inlineCode">LastName</code> and <code class="inlineCode">DateOfBirth</code> properties. The <code class="inlineCode">CountBy</code> and <code class="inlineCode">AggregateBy</code> extension methods were introduced with .NET 9.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">AsEnumerable</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Returns the input sequence typed as <code class="inlineCode">IEnumerable&lt;T&gt;</code>. This is useful when the type has its own implementation of any of the LINQ extension methods, like <code class="inlineCode">Where</code>, and you want to call the standard LINQ <code class="inlineCode">Where</code> method instead.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">DefaultIfEmpty</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Returns the elements of an <code class="inlineCode">IEnumerable&lt;T&gt;</code>, or a default valued singleton collection if the sequence is empty. For example, if the sequence is an empty <code class="inlineCode">IEnumerable&lt;int&gt;</code>, it will return an <code class="inlineCode">IEnumerable&lt;int&gt;</code> containing a single item, <code class="inlineCode">0</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Cast&lt;T&gt;</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Casts items into a specified type. It is useful to convert non-generic objects into a generic type in scenarios where the compiler would otherwise complain.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">OfType&lt;T&gt;</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Removes items that do not match a specified type.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Distinct</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Removes duplicate items.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Except</code>, <code class="inlineCode">Intersect</code>, and <code class="inlineCode">Union</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Perform operations that return sets. Sets cannot have duplicate items. Although the inputs can be any sequence and, thereby, the inputs can have duplicates, the result is always a set.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Chunk</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Divides <a id="_idIndexMarker1708"/>a sequence into sized batches. The <code class="inlineCode">size</code> parameter specifies the number of items in each chunk. The last chunk will contain the <a id="_idIndexMarker1709"/>remaining items and could be smaller than <code class="inlineCode">size</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Append</code>, <code class="inlineCode">Concat</code>, and <code class="inlineCode">Prepend</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Perform sequence-combining operations.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Zip</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Performs a match operation on two or three sequences based on the position of items; for example, the item at position 1 in the first sequence matches the item at position 1 in the second sequence.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 11.1: Deferred LINQ extension methods</p>
    <p class="normal">Next, here are the non-deferred methods that return a single scalar value, like a single <code class="inlineCode">TSource</code> item, a number, or a <code class="inlineCode">bool</code>:</p>
    <table id="table002-10" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">First</code>, <code class="inlineCode">FirstOrDefault</code>, <code class="inlineCode">Last</code>, and <code class="inlineCode">LastOrDefault</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Get the first or last item in the sequence, throw an exception, or return the default value for the type, for example, <code class="inlineCode">0</code> for an <code class="inlineCode">int</code> and <code class="inlineCode">null</code> for a reference type, if there is not a first or last item.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Single</code> and <code class="inlineCode">SingleOrDefault</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Return an item that matches a specific filter, throw an exception, or return the default value for the type if there is not one exact match.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">ElementAt</code> and <code class="inlineCode">ElementAtOrDefault</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Return an item at a specified index position, throw an exception, or return the default value for the type if there is not an item at that position. .NET 6 introduced overloads that can be passed as an <code class="inlineCode">Index</code> instead of an <code class="inlineCode">int</code>, which is more efficient when working with <code class="inlineCode">Span&lt;T&gt;</code> sequences.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Aggregate</code>, <code class="inlineCode">Average</code>, <code class="inlineCode">Count</code>, <code class="inlineCode">LongCount</code>, <code class="inlineCode">Max</code>, <code class="inlineCode">Min</code>, and <code class="inlineCode">Sum</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Calculate aggregate values.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">TryGetNonEnumeratedCount</code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Count()</code> checks if a <code class="inlineCode">Count</code> property is implemented on the sequence and returns its value, or it enumerates the entire sequence to count its items. Introduced in .NET 6, this method only <a id="_idIndexMarker1710"/>checks for <code class="inlineCode">Count</code>; if it is missing, it returns <code class="inlineCode">false</code> and sets the <code class="inlineCode">out</code> parameter <a id="_idIndexMarker1711"/>to <code class="inlineCode">0</code> to avoid a potentially poor-performing operation.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">SequenceEqual</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Returns <code class="inlineCode">true</code> or <code class="inlineCode">false</code>, depending on whether two sequences are equal according to an equality comparer.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">All</code>, <code class="inlineCode">Any</code>, and <code class="inlineCode">Contains</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Return <code class="inlineCode">true</code> if all or any of the items match the filter, or if the sequence contains a specified item. If the sequence is a <code class="inlineCode">List&lt;T&gt;</code>, they use its native <code class="inlineCode">TrueForAll</code> method instead of LINQ’s <code class="inlineCode">All</code> method.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">ToArray</code>, <code class="inlineCode">ToList</code>, <code class="inlineCode">ToDictionary</code>, <code class="inlineCode">ToHashSet</code>, and <code class="inlineCode">ToLookup</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Convert a sequence into an array or collection. These are the only extension methods that force the execution of a LINQ expression immediately, rather than wait for deferred execution, which you will learn about shortly.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 11.2: Non-deferred LINQ extension methods</p>
    <div class="packt_tip">
      <p class="normal"><strong class="keyWord">Good Practice</strong>: Make sure that you understand and remember the difference between LINQ extension methods that start with <code class="inlineCode">As</code> and <code class="inlineCode">To</code>. The <code class="inlineCode">AsEnumerable</code> method casts the sequence into a different type but does not allocate memory, so that method are fast. Methods that start with <code class="inlineCode">To</code>, like <code class="inlineCode">ToList</code>, allocate memory for a new sequence of items, so they can be slow and will always use more memory resources.</p>
    </div>
    <p class="normal">The <code class="inlineCode">Enumerable</code> class also <a id="_idIndexMarker1712"/>has some methods that are not extension methods, as shown in <em class="italic">Table 11.3</em>:</p>
    <table id="table003-8" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Method</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Empty&lt;T&gt;</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Returns an empty sequence of the specified type <code class="inlineCode">T</code>. It is useful for passing an empty sequence to a method that requires an <code class="inlineCode">IEnumerable&lt;T&gt;</code>.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Range</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Returns a sequence of integers from the <code class="inlineCode">start</code> value with <code class="inlineCode">count</code> items. For example, <code class="inlineCode">Enumerable.Range(start: 5, count: 3)</code> would contain the integers 5, 6, and 7.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">Repeat</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Returns a sequence that contains the same element repeated <code class="inlineCode">count</code> times. For example, <code class="inlineCode">Enumerable.Repeat(element: "5", count: 3)</code> would contain the <code class="inlineCode">string</code> values <code class="inlineCode">"5"</code>, <code class="inlineCode">"5"</code>, and <code class="inlineCode">"5"</code>.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 11.3: Enumerable non-extension methods</p>
    <h1 id="_idParaDest-666" class="heading-1">LINQ in practice</h1>
    <p class="normal">Now, we can <a id="_idIndexMarker1713"/>build a console app to explore practical examples of using LINQ.</p>
    <h2 id="_idParaDest-667" class="heading-2">Understanding deferred execution</h2>
    <p class="normal">LINQ uses <strong class="keyWord">deferred execution</strong>. It is <a id="_idIndexMarker1714"/>important to understand <a id="_idIndexMarker1715"/>that calling most of the above extension methods does not execute a query and get the results. Most of these extension methods return a LINQ expression that represents a <em class="italic">question</em>, not an <em class="italic">answer</em>. Let’s explore:</p>
    <ol>
      <li class="numberedList" value="1">Use your preferred code editor to create a new project, as defined in the following list:<ul>
          <li class="bulletList level-2">Project template: <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code></li>
          <li class="bulletList level-2">Project file and folder: <code class="inlineCode">LinqWithObjects</code></li>
          <li class="bulletList level-2">Solution file and folder: <code class="inlineCode">Chapter11</code></li>
        </ul>
      </li>
      <li class="numberedList">In the project file, globally and statically import the <code class="inlineCode">System.Console</code> class.</li>
      <li class="numberedList">Add a new class file named <code class="inlineCode">Program.Helpers.cs</code>.</li>
      <li class="numberedList">In <code class="inlineCode">Program.Helpers.cs</code>, delete any existing statements, and then define <a id="_idIndexMarker1716"/>a partial <code class="inlineCode">Program</code> class with a method to output a section title, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
  <span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">SectionTitle</span><span class="hljs-function">(</span><span class="hljs-built_in">string</span><span class="hljs-params"> title</span><span class="hljs-function">)</span>
  {
    ConsoleColor previousColor = ForegroundColor;
    ForegroundColor = ConsoleColor.DarkYellow;
    WriteLine(<span class="hljs-string">$"*** </span><span class="hljs-subst">{title}</span><span class="hljs-string"> ***"</span>);
    ForegroundColor = previousColor;
  }
}
</code></pre>
      </li>
      <li class="numberedList">Add a new class file named <code class="inlineCode">Program.Functions.cs</code>.</li>
      <li class="numberedList">In <code class="inlineCode">Program.Functions.cs</code>, delete any existing statements, define a partial <code class="inlineCode">Program</code> class with a method named <code class="inlineCode">DeferredExecution</code> that is passed an array of <code class="inlineCode">string</code> values, and then define two queries, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
  <span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">DeferredExecution</span><span class="hljs-function">(</span><span class="hljs-built_in">string</span><span class="hljs-params">[] names</span><span class="hljs-function">)</span>
  {
    SectionTitle(<span class="hljs-string">"Deferred execution"</span>);
    <span class="hljs-comment">// Question: Which names end with an M?</span>
    <span class="hljs-comment">// (using a LINQ extension method)</span>
    <span class="hljs-keyword">var</span> query1 = names.Where(name =&gt; name.EndsWith(<span class="hljs-string">"m"</span>));
    <span class="hljs-comment">// Question: Which names end with an M?</span>
    <span class="hljs-comment">// (using LINQ query comprehension syntax)</span>
    <span class="hljs-keyword">var</span> query2 = <span class="hljs-keyword">from</span> name <span class="hljs-keyword">in</span> names <span class="hljs-keyword">where</span> name.EndsWith(<span class="hljs-string">"m"</span>) <span class="hljs-keyword">select</span> name;
  }
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, delete the existing statements, add statements to define a sequence of <code class="inlineCode">string</code> values for people who work in an office, and then <a id="_idIndexMarker1717"/>pass it as an argument to the <code class="inlineCode">DeferredExecution</code> method, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// A string array is a sequence that implements IEnumerable&lt;string&gt;.</span>
<span class="hljs-built_in">string</span>[] names = { <span class="hljs-string">"Michael"</span>, <span class="hljs-string">"Pam"</span>, <span class="hljs-string">"Jim"</span>, <span class="hljs-string">"</span><span class="hljs-string">Dwight"</span>,
  <span class="hljs-string">"Angela"</span>, <span class="hljs-string">"Kevin"</span>, <span class="hljs-string">"Toby"</span>, <span class="hljs-string">"Creed"</span> };
DeferredExecution(names);
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.Functions.cs</code>, in the <code class="inlineCode">DeferredExecution</code> method, to get the answer (in other words, to execute the query), you must <strong class="keyWord">materialize</strong> it by either calling one of the <code class="inlineCode">To</code> methods, like <code class="inlineCode">ToArray</code>, <code class="inlineCode">ToDictionary</code>, or <code class="inlineCode">ToLookup</code>, or by enumerating the query. Add statements to do this, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// Answer returned as an array of strings containing Pam and Jim.</span>
<span class="hljs-built_in">string</span>[] result1 = query1.ToArray();
<span class="hljs-comment">// Answer returned as a list of strings containing Pam and Jim.</span>
List&lt;<span class="hljs-built_in">string</span>&gt; result2 = query2.ToList();
<span class="hljs-comment">// Answer returned as we enumerate over the results.</span>
<span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">string</span> name <span class="hljs-keyword">in</span> query1)
{
  WriteLine(name); <span class="hljs-comment">// outputs Pam</span>
  names[<span class="hljs-number">2</span>] = <span class="hljs-string">"Jimmy"</span>; <span class="hljs-comment">// Change Jim to Jimmy.</span>
  <span class="hljs-comment">// On the second iteration Jimmy does not</span>
  <span class="hljs-comment">// end with an "m" so it does not get output.</span>
}
</code></pre>
      </li>
      <li class="numberedList">Run the console app and note the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">*** Deferred execution ***
Pam
</code></pre>
      </li>
    </ol>
    <p class="normal">Due to <a id="_idIndexMarker1718"/>deferred execution, after outputting the first result, <code class="inlineCode">Pam</code>, if the original array values change, then by the time we loop back around, there are no more matches because <code class="inlineCode">Jim</code> has become <code class="inlineCode">Jimmy</code> and does not end with an <code class="inlineCode">m</code>, so only <code class="inlineCode">Pam</code> is output.</p>
    <p class="normal">Before we get too deep into the weeds, let’s slow down and look at some common LINQ extension methods and how to use them, one at a time.</p>
    <h2 id="_idParaDest-668" class="heading-2">Filtering entities using Where</h2>
    <p class="normal">The <a id="_idIndexMarker1719"/>most common reason for using LINQ is to filter items in a sequence using the <code class="inlineCode">Where</code> extension <a id="_idIndexMarker1720"/>method. Let’s <a id="_idIndexMarker1721"/>explore filtering by defining a sequence of names and then applying LINQ operations to it:</p>
    <ol>
      <li class="numberedList" value="1">In the project file, add an element to prevent the <code class="inlineCode">System.Linq</code> namespace from automatically being imported globally, as shown highlighted in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;Using Include=<span class="hljs-string">"System.Console"</span> Static=<span class="hljs-string">"true"</span> /&gt;
<span class="code-highlight"><strong class="hljs-slc">  &lt;Using Remove=</strong><strong class="hljs-string-slc">"</strong><strong class="hljs-string-slc">System.Linq"</strong><strong class="hljs-slc"> /&gt;</strong></span>
&lt;/ItemGroup&gt;
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.Functions.cs</code>, add a new method named <code class="inlineCode">FilteringUsingWhere</code>, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">FilteringUsingWhere</span><span class="hljs-function">(</span><span class="hljs-built_in">string</span><span class="hljs-params">[] names</span><span class="hljs-function">)</span>
{
}
</code></pre>
      </li>
      <li class="numberedList">If you are using Visual Studio, navigate to <strong class="screenText">Tools</strong> | <strong class="screenText">Options</strong>. In the <strong class="screenText">Options</strong> dialog box, navigate to <strong class="screenText">Text Editor</strong> | <strong class="screenText">C#</strong> | <strong class="screenText">IntelliSense</strong>, clear the <strong class="screenText">Show items from unimported namespaces</strong> checkbox, and then click <strong class="screenText">OK</strong>.</li>
      <li class="numberedList">In <code class="inlineCode">FilteringUsingWhere</code>, attempt to call the <code class="inlineCode">Where</code> extension method on <a id="_idIndexMarker1722"/>the array of names, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">SectionTitle(<span class="hljs-string">"Filtering entities using Where"</span>);
<span class="hljs-keyword">var</span> query = names.W
</code></pre>
      </li>
      <li class="numberedList">As you <a id="_idIndexMarker1723"/>type the <code class="inlineCode">W</code>, note that in older code editors (or code editors with the option <a id="_idIndexMarker1724"/>to show items from unimported namespaces disabled), the <code class="inlineCode">Where</code> method is missing from the IntelliSense list of members of a <code class="inlineCode">string</code> array, as shown in <em class="italic">Figure 11.1</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_11_01.png" alt="" width="812" height="292"/></figure>
    <p class="packt_figref">Figure 11.1: IntelliSense with the Where extension method missing</p>
    <div class="note-one">
      <p class="normal">This is because <code class="inlineCode">Where</code> is an extension method. It does not exist on the array type. To make the <code class="inlineCode">Where</code> extension method available, we must import the <code class="inlineCode">System.Linq</code> namespace. This is implicitly imported by default in new .NET 6 and later projects, but we removed it to illustrate the point. Recent versions of code editors are smart enough to suggest using the <code class="inlineCode">Where</code> method anyway and indicate that they will import the <code class="inlineCode">System.Linq</code> namespace for you automatically.</p>
    </div>
    <ol>
      <li class="numberedList" value="6">If you <a id="_idIndexMarker1725"/>are using Visual Studio, navigate to <strong class="screenText">Tools</strong> | <strong class="screenText">Options</strong>. In the <strong class="screenText">Options</strong> dialog box, navigate to <strong class="screenText">Text Editor</strong> | <strong class="screenText">C#</strong> | <strong class="screenText">IntelliSense</strong>, select the <strong class="screenText">Show items from unimported namespaces</strong> checkbox, and then click <strong class="screenText">OK</strong>.</li>
      <li class="numberedList">In the <a id="_idIndexMarker1726"/>project file, comment <a id="_idIndexMarker1727"/>out the element that removed <code class="inlineCode">System.Linq</code>, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">&lt;!--&lt;Using Remove=<span class="hljs-string">"System.Linq"</span> /&gt;--&gt;
</code></pre>
      </li>
      <li class="numberedList">Save the change and build the project.</li>
      <li class="numberedList">Retype the <code class="inlineCode">W</code> for the <code class="inlineCode">Where</code> method, and note that the IntelliSense list now includes the extension methods added by the <code class="inlineCode">Enumerable</code> class, as shown in <em class="italic">Figure 11.2</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_11_02.png" alt="" width="812" height="292"/></figure>
    <p class="packt_figref">Figure 11.2: IntelliSense showing LINQ extension methods when System.Linq is imported</p>
    <div class="note-one">
      <p class="normal">Interestingly, as you can see in the screenshot of Visual Studio on my computer, GitHub Copilot even suggests autocompleting with a lambda expression, very similar to the one that we will eventually end up writing. But there are some important intermediate steps you need to see before we get to that, so do not insert any GitHub Copilot suggestions if you have that feature enabled.</p>
    </div>
    <ol>
      <li class="numberedList" value="10">As you <a id="_idIndexMarker1728"/>type the parentheses for the <code class="inlineCode">Where</code> method, IntelliSense <a id="_idIndexMarker1729"/>tells us that, to call <code class="inlineCode">Where</code>, we must pass in an instance of a <code class="inlineCode">Func&lt;string, bool&gt;</code> delegate.</li>
      <li class="numberedList">Enter an expression to create a new instance of a <code class="inlineCode">Func&lt;string, bool&gt;</code> delegate, and for now, note that we have not yet supplied a method name because we will define it in the next step, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">var</span> query = names.Where(<span class="hljs-keyword">new</span> Func&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">bool</span>&gt;( ))
</code></pre>
      </li>
      <li class="numberedList">Leave the statement unfinished for now.</li>
    </ol>
    <p class="normal">The <code class="inlineCode">Func&lt;string, bool&gt;</code> delegate tells us that for each <code class="inlineCode">string</code> variable passed to the method, the method must return a <code class="inlineCode">bool</code> value. If the method returns <code class="inlineCode">true</code>, it indicates that we should include the <code class="inlineCode">string</code> in the results, and if the method returns <code class="inlineCode">false</code>, it indicates that we should exclude it.</p>
    <h2 id="_idParaDest-669" class="heading-2">Targeting a named method</h2>
    <p class="normal">Let’s define <a id="_idIndexMarker1730"/>a method that only <a id="_idIndexMarker1731"/>includes names that are longer than four characters:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.Functions.cs</code>, add a method that will return <code class="inlineCode">true</code> only for names longer than four characters, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-built_in">bool</span><span class="hljs-function"> </span><span class="hljs-title">NameLongerThanFour</span><span class="hljs-function">(</span><span class="hljs-built_in">string</span><span class="hljs-params"> name</span><span class="hljs-function">)</span>
{
  <span class="hljs-comment">// Returns true for a name longer than four characters.</span>
  <span class="hljs-keyword">return</span> name.Length &gt; <span class="hljs-number">4</span>;
}
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">FilteringUsingWhere</code> method, pass the method’s name into the <code class="inlineCode">Func&lt;string, bool&gt;</code> delegate, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">var</span> query = names.Where(
  <span class="hljs-keyword">new</span> Func&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">bool</span>&gt;(<span class="code-highlight"><strong class="hljs-slc">NameLongerThanFour</strong></span>));
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">FilteringUsingWhere</code> method, add statements to enumerate the <code class="inlineCode">names</code> array using <code class="inlineCode">foreach</code>, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">string</span> item <span class="hljs-keyword">in</span> query)
{
  WriteLine(item);
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, comment out the call to <code class="inlineCode">DeferredExecution</code>, and then pass <code class="inlineCode">names</code> as an argument to the <code class="inlineCode">FilteringUsingWhere</code> method, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// DeferredExecution(names);</span>
FilteringUsingWhere(names);
</code></pre>
      </li>
      <li class="numberedList">Run the <a id="_idIndexMarker1732"/>code and <a id="_idIndexMarker1733"/>view the results, noting that only names longer than four letters are listed, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Michael
Dwight
Angela
Kevin
Creed
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-670" class="heading-2">Simplifying code by removing the explicit delegate instantiation</h2>
    <p class="normal">We <a id="_idIndexMarker1734"/>can simplify code by deleting the explicit instantiation of the <code class="inlineCode">Func&lt;string, bool&gt;</code> delegate because the C# compiler can instantiate the delegate for us:</p>
    <ol>
      <li class="numberedList" value="1">To help <a id="_idIndexMarker1735"/>you learn by seeing progressively improved code, in the <code class="inlineCode">FilteringUsingWhere</code> method, comment out the query and add a comment about how it works, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// Explicitly creating the required delegate.</span>
<span class="hljs-comment">// var query = names.Where(</span>
<span class="hljs-comment">//   new Func&lt;string, bool&gt;(NameLongerThanFour));</span>
</code></pre>
      </li>
      <li class="numberedList">Enter the query a second time but, this time, without the explicit instantiation of the delegate, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// The compiler creates the delegate automatically.</span>
<span class="hljs-keyword">var</span> query = names.Where(NameLongerThanFour);
</code></pre>
      </li>
      <li class="numberedList">Run the code, and note that it has the same behavior.</li>
    </ol>
    <h2 id="_idParaDest-671" class="heading-2">Targeting a lambda expression</h2>
    <p class="normal">We can <a id="_idIndexMarker1736"/>simplify our code even <a id="_idIndexMarker1737"/>further using a <strong class="keyWord">lambda expression</strong> in place of a named method.</p>
    <p class="normal">Although <a id="_idIndexMarker1738"/>it can look complicated at first, a lambda expression is simply a <em class="italic">nameless function</em>. It uses the <code class="inlineCode">=&gt;</code> (read as “goes to”) symbol to indicate the return value:</p>
    <ol>
      <li class="numberedList" value="1">Comment out the second query, and then add a third version of the query that uses a lambda expression, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// Using a lambda expression instead of a named method.</span>
<span class="hljs-keyword">var</span> query = names.Where(name =&gt; name.Length &gt; <span class="hljs-number">4</span>);
</code></pre>
      </li>
    </ol>
    <p class="normal-one">Note that the syntax for a lambda expression includes all the important parts of the <code class="inlineCode">NameLongerThanFour</code> method, and nothing more. A lambda expression only needs to define the following:</p>
    <ul>
      <li class="bulletList level-2">The names of input parameters: <code class="inlineCode">name</code></li>
      <li class="bulletList level-2">A return value expression: <code class="inlineCode">name.Length &gt; 4</code></li>
    </ul>
    <p class="normal-one">The type of the <code class="inlineCode">name</code> input parameter is inferred from the fact that the sequence contains <code class="inlineCode">string</code> values, and the return type must be a <code class="inlineCode">bool</code> value, as defined by the delegate, for <code class="inlineCode">Where</code> to work; therefore, the expression after the <code class="inlineCode">=&gt;</code> symbol must return a <code class="inlineCode">bool</code> value. The compiler does most of the work for us, so our code can be as concise as possible.</p>
    <ol>
      <li class="numberedList" value="2">Run the code, and note that it has the same behavior.</li>
    </ol>
    <h2 id="_idParaDest-672" class="heading-2">Lambda expressions with default parameter values</h2>
    <p class="normal">Introduced with C# 12, you can now provide default values for parameters in lambda <a id="_idIndexMarker1739"/>expressions, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">var</span> query = names.Where((<span class="hljs-built_in">string</span> name = <span class="hljs-string">"Bob"</span>) =&gt; name.Length &gt; <span class="hljs-number">4</span>);
</code></pre>
    <p class="normal">Our <a id="_idIndexMarker1740"/>purpose for using this lambda expression means that setting a default value is not necessary, but later, you will see more useful examples.</p>
    <h1 id="_idParaDest-673" class="heading-1">Sorting and more</h1>
    <p class="normal">Other commonly used extension methods are <code class="inlineCode">OrderBy</code> and <code class="inlineCode">ThenBy</code>, used to sort a sequence.</p>
    <h2 id="_idParaDest-674" class="heading-2">Sorting by a single property using OrderBy</h2>
    <p class="normal">Extension <a id="_idIndexMarker1741"/>methods can be chained if the previous method returns another sequence, that is, a type <a id="_idIndexMarker1742"/>that implements the <code class="inlineCode">IEnumerable&lt;T&gt;</code> interface.</p>
    <p class="normal">Let’s continue working with the current project to explore sorting:</p>
    <ol>
      <li class="numberedList" value="1">In the <code class="inlineCode">FilteringUsingWhere</code> method, append a call to <code class="inlineCode">OrderBy</code> to the end of the existing query, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">var</span> query = names
  .Where(name =&gt; name.Length &gt; <span class="hljs-number">4</span>)
  .OrderBy(name =&gt; name.Length);
</code></pre>
      </li>
    </ol>
    <div class="packt_tip-one">
      <p class="normal"><strong class="keyWord">Good Practice</strong>: Format the LINQ statement so that each extension method call happens on its own line, making it easier to read.</p>
    </div>
    <ol>
      <li class="numberedList" value="2">Run the code, and note that the names are now sorted by the shortest first, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Kevin
Creed
Dwight
Angela
Michael
</code></pre>
      </li>
    </ol>
    <p class="normal">To put <a id="_idIndexMarker1743"/>the longest <a id="_idIndexMarker1744"/>name first, you would use <code class="inlineCode">OrderByDescending</code>.</p>
    <h2 id="_idParaDest-675" class="heading-2">Sorting by a subsequent property using ThenBy</h2>
    <p class="normal">We <a id="_idIndexMarker1745"/>might want to <a id="_idIndexMarker1746"/>sort by more than one property, for example, to sort names of the same length in alphabetical order:</p>
    <ol>
      <li class="numberedList" value="1">In the <code class="inlineCode">FilteringUsingWhere</code> method, append a call to the <code class="inlineCode">ThenBy</code> method at the end of the existing query, as highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">var</span> query = names
  .Where(name =&gt; name.Length &gt; <span class="hljs-number">4</span>)
  .OrderBy(name =&gt; name.Length)
  <span class="code-highlight"><strong class="hljs-slc">.ThenBy(name =&gt; name)</strong></span>;
</code></pre>
      </li>
      <li class="numberedList">Run the code, and note the slight difference in the following sort order. Within a group of names of the same length, the names are sorted alphabetically by the full value of the <code class="inlineCode">string</code>, so <code class="inlineCode">Creed</code> comes before <code class="inlineCode">Kevin</code>, and <code class="inlineCode">Angela</code> comes before <code class="inlineCode">Dwight</code>, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Creed
Kevin
Angela
Dwight
Michael
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-676" class="heading-2">Sorting by the item itself</h2>
    <p class="normal">.NET 7 introduced the <code class="inlineCode">Order</code> and <code class="inlineCode">OrderDescending</code> extension methods. These simplify <a id="_idIndexMarker1747"/>ordering by the item itself. For example, if you have a sequence of <code class="inlineCode">string</code> values, then before .NET 7, you would have had to call the <code class="inlineCode">OrderBy</code> method and pass a lambda that selects the items themselves, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">var</span> query = names.OrderBy(name =&gt; name);
</code></pre>
    <p class="normal">With .NET 7 or later, we can simplify the statement, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">var</span> query = names.Order();
</code></pre>
    <p class="normal"><code class="inlineCode">OrderDescending</code> does a similar thing but in descending order.</p>
    <p class="normal">Remember that the <code class="inlineCode">names</code> array contains instances of the <code class="inlineCode">string</code> type, which implements the <code class="inlineCode">IComparable</code> interface. This is why they can be ordered, aka sorted. If the array contained instances of a complex type, like <code class="inlineCode">Person</code> or <code class="inlineCode">Product</code>, then those types would have to implement the <code class="inlineCode">IComparable</code> interface so that they could be ordered too.</p>
    <h2 id="_idParaDest-677" class="heading-2">Declaring a query using var or a specified type</h2>
    <p class="normal">While writing <a id="_idIndexMarker1748"/>a LINQ expression, it is convenient <a id="_idIndexMarker1749"/>to use <code class="inlineCode">var</code> to declare the query object. This is because the return type frequently changes as you work on a LINQ expression. For example, our query started as an <code class="inlineCode">IEnumerable&lt;string&gt;</code> and is currently an <code class="inlineCode">IOrderedEnumerable&lt;string&gt;</code>:</p>
    <ol>
      <li class="numberedList" value="1">Hover your mouse over the <code class="inlineCode">var</code> keyword, and note that its type is <code class="inlineCode">IOrderedEnumerable&lt;string&gt;</code>, as shown in <em class="italic">Figure 11.3</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_11_03.png" alt="" width="812" height="270"/></figure>
    <p class="packt_figref">Figure 11.3: Hover over var to see the actual implied type of the query expression</p>
    <div class="note-one">
      <p class="normal">In <em class="italic">Figure 11.3</em>, I added extra vertical space between <code class="inlineCode">names</code> and <code class="inlineCode">.Where</code> so that the tooltip did not cover up the query.</p>
    </div>
    <ol>
      <li class="numberedList" value="2">Replace <code class="inlineCode">var</code> with <a id="_idIndexMarker1750"/>the actual type, as shown <a id="_idIndexMarker1751"/>highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-slc">IOrderedEnumerable&lt;</strong><strong class="hljs-built_in-slc">string</strong><strong class="hljs-slc">&gt;</strong></span> query = names
  .Where(name =&gt; name.Length &gt; <span class="hljs-number">4</span>)
  .OrderBy(name =&gt; name.Length)
  .ThenBy(name =&gt; name);
</code></pre>
      </li>
    </ol>
    <div class="packt_tip-one">
      <p class="normal"><strong class="keyWord">Good practice</strong>: Once you have finished working on a query, you could change the declared type from <code class="inlineCode">var</code> to the actual type to make it clearer what the type is. This is easy because your code editor can tell you what it is. Doing this is just for clarity. It has no effect on performance because C# changes all <code class="inlineCode">var</code> declarations to the actual types at compile time.</p>
    </div>
    <ol>
      <li class="numberedList" value="3">Run the code, and note that it has the same behavior.</li>
    </ol>
    <h2 id="_idParaDest-678" class="heading-2">Filtering by type</h2>
    <p class="normal">The <code class="inlineCode">Where</code> extension method is great for filtering by values, such as text and numbers. But <a id="_idIndexMarker1752"/>what if the sequence contains multiple types and you want to filter by a specific type, respecting any inheritance hierarchy?</p>
    <p class="normal">Imagine that you have a sequence of exceptions. There are hundreds of exception types that form a complex inheritance hierarchy, as partially shown in <em class="italic">Figure 11.4</em>:</p>
    <figure class="mediaobject"><img src="../Images/B22322_11_04.png" alt="" width="878" height="238"/></figure>
    <p class="packt_figref">Figure 11.4: A partial exception inheritance hierarchy</p>
    <p class="normal">Let’s explore filtering by type:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.Functions.cs</code>, define a new method to list, and then filter exception-derived objects using the <code class="inlineCode">OfType&lt;T&gt;</code> extension method to remove exceptions that are not arithmetic exceptions, writing only the arithmetic exceptions to the console, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">FilteringByType</span><span class="hljs-function">()</span>
{
  SectionTitle(<span class="hljs-string">"Filtering by type"</span>);
  List&lt;Exception&gt; exceptions = <span class="hljs-keyword">new</span>()
  {
    <span class="hljs-keyword">new</span> ArgumentException(), <span class="hljs-keyword">new</span> SystemException(),
    <span class="hljs-keyword">new</span> IndexOutOfRangeException(), <span class="hljs-keyword">new</span> InvalidOperationException(),
    <span class="hljs-keyword">new</span> NullReferenceException(), <span class="hljs-keyword">new</span> InvalidCastException(),
    <span class="hljs-keyword">new</span> OverflowException(), <span class="hljs-keyword">new</span> DivideByZeroException(),
    <span class="hljs-keyword">new</span> ApplicationException()
  };
  IEnumerable&lt;ArithmeticException&gt; arithmeticExceptionsQuery =
    exceptions.OfType&lt;ArithmeticException&gt;();
  <span class="hljs-keyword">foreach</span> (ArithmeticException exception <span class="hljs-keyword">in</span> arithmeticExceptionsQuery)
  {
    WriteLine(exception);
  }
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, comment out the call to <code class="inlineCode">FilteringUsingWhere</code>, and then add a call to the <code class="inlineCode">FilteringByType</code> method, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// FilteringUsingWhere(names);</span>
FilteringByType();
</code></pre>
      </li>
      <li class="numberedList">Run <a id="_idIndexMarker1753"/>the code, and note that the results only include exceptions of the <code class="inlineCode">ArithmeticException</code> type or the <code class="inlineCode">ArithmeticException</code>-derived types, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">System.OverflowException: Arithmetic operation resulted in an overflow.
System.DivideByZeroException: Attempted to divide by zero.
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-679" class="heading-2">Working with sets and bags</h2>
    <p class="normal">Sets are one <a id="_idIndexMarker1754"/>of the most fundamental concepts in mathematics. A <strong class="keyWord">set</strong> is a <a id="_idIndexMarker1755"/>collection of <a id="_idIndexMarker1756"/>one or more unique objects. A <strong class="keyWord">multiset</strong>, aka a <strong class="keyWord">bag</strong>, is a <a id="_idIndexMarker1757"/>collection of one or more objects that can have duplicates.</p>
    <p class="normal">You might remember being taught about Venn diagrams in school. Common set operations include the <strong class="keyWord">intersect</strong> or <strong class="keyWord">union</strong> between sets.</p>
    <p class="normal">Let’s write some code that will define three arrays of <code class="inlineCode">string</code> values for cohorts of apprentices, and then we’ll perform some common set and multiset operations on them:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.Functions.cs</code>, add a method that outputs any sequence of <code class="inlineCode">string</code> variables as <a id="_idIndexMarker1758"/>a comma-separated single <code class="inlineCode">string</code> to the <a id="_idIndexMarker1759"/>console output, along with an optional description, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Output</span><span class="hljs-function">(</span><span class="hljs-params">IEnumerable&lt;</span><span class="hljs-built_in">string</span><span class="hljs-params">&gt; cohort,</span>
<span class="hljs-keyword"> </span><span class="hljs-params"> </span><span class="hljs-built_in">string</span><span class="hljs-params"> description = </span><span class="hljs-string">""</span><span class="hljs-function">)</span>
{
  <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">string</span>.IsNullOrEmpty(description))
  {
    WriteLine(description);
  }
  Write(<span class="hljs-string">" "</span>);
  WriteLine(<span class="hljs-built_in">string</span>.Join(<span class="hljs-string">"</span><span class="hljs-string">, "</span>, cohort.ToArray()));
  WriteLine();
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.Functions.cs</code>, add a method that defines three arrays of names, outputs them, and then performs various set operations on them, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">WorkingWithSets</span><span class="hljs-function">()</span>
{
  <span class="hljs-built_in">string</span>[] cohort1 =
    { <span class="hljs-string">"Rachel"</span>, <span class="hljs-string">"Gareth"</span>, <span class="hljs-string">"Jonathan"</span>, <span class="hljs-string">"George"</span> };
  <span class="hljs-built_in">string</span>[] cohort2 =
    { <span class="hljs-string">"Jack"</span>, <span class="hljs-string">"Stephen"</span>, <span class="hljs-string">"Daniel"</span>, <span class="hljs-string">"Jack"</span>, <span class="hljs-string">"Jared"</span> };
  <span class="hljs-built_in">string</span>[] cohort3 =
    { <span class="hljs-string">"Declan"</span>, <span class="hljs-string">"Jack"</span>, <span class="hljs-string">"Jack"</span>, <span class="hljs-string">"Jasmine"</span>, <span class="hljs-string">"Conor"</span> };
  SectionTitle(<span class="hljs-string">"The cohorts"</span>);
  Output(cohort1, <span class="hljs-string">"Cohort 1"</span>);
  Output(cohort2, <span class="hljs-string">"Cohort 2"</span>);
  Output(cohort3, <span class="hljs-string">"Cohort 3"</span>);
  SectionTitle(<span class="hljs-string">"Set operations"</span>);
  Output(cohort2.Distinct(), <span class="hljs-string">"cohort2.Distinct()"</span>);
  Output(cohort2.DistinctBy(name =&gt; name.Substring(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)),
    <span class="hljs-string">"cohort2.DistinctBy(name =&gt; name.Substring(0, 2)):"</span>);
  Output(cohort2.Union(cohort3), <span class="hljs-string">"cohort2.Union(cohort3)"</span>);
  Output(cohort2.Concat(cohort3), <span class="hljs-string">"cohort2.Concat(cohort3)"</span>);
  Output(cohort2.Intersect(cohort3), <span class="hljs-string">"cohort2.Intersect(cohort3)"</span>);
  Output(cohort2.Except(cohort3), <span class="hljs-string">"cohort2.Except(cohort3)"</span>);
  Output(cohort1.Zip(cohort2,(c1, c2) =&gt; <span class="hljs-string">$"</span><span class="hljs-subst">{c1}</span><span class="hljs-string"> matched with </span><span class="hljs-subst">{c2}</span><span class="hljs-string">"</span>),
    <span class="hljs-string">"cohort1.Zip(cohort2)"</span>);
}
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, comment <a id="_idIndexMarker1760"/>out the call to <code class="inlineCode">FilteringByType</code>, and then <a id="_idIndexMarker1761"/>add a call to the <code class="inlineCode">WorkingWithSets</code> method, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// FilteringByType();</span>
WorkingWithSets();
</code></pre>
      </li>
      <li class="numberedList">Run the code and view the results, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">Cohort 1
  Rachel, Gareth, Jonathan, George
Cohort 2
  Jack, Stephen, Daniel, Jack, Jared
Cohort 3
  Declan, Jack, Jack, Jasmine, Conor
cohort2.Distinct()
  Jack, Stephen, Daniel, Jared
cohort2.DistinctBy(name =&gt; name.Substring(0, 2)):
  Jack, Stephen, Daniel
cohort2.Union(cohort3)
  Jack, Stephen, Daniel, Jared, Declan, Jasmine, Conor
cohort2.Concat(cohort3)
  Jack, Stephen, Daniel, Jack, Jared, Declan, Jack, Jack, Jasmine, Conor
cohort2.Intersect(cohort3)
  Jack
cohort2.Except(cohort3)
  Stephen, Daniel, Jared
cohort1.Zip(cohort2)
  Rachel matched with Jack, Gareth matched with Stephen, Jonathan matched with Daniel, George matched with Jack
</code></pre>
      </li>
    </ol>
    <p class="normal">With <code class="inlineCode">Zip</code>, if there are unequal numbers of items in the two sequences, then some items will <a id="_idIndexMarker1762"/>not have a matching partner. Those without a <a id="_idIndexMarker1763"/>partner, like <code class="inlineCode">Jared</code>, will not be included in the result.</p>
    <p class="normal">For the <code class="inlineCode">DistinctBy</code> example, instead of removing duplicates by comparing the whole name, we define a lambda key selector to remove duplicates by comparing the first two characters, so <code class="inlineCode">Jared</code> is removed because <code class="inlineCode">Jack</code> is already a name that starts with <code class="inlineCode">Ja</code>.</p>
    <h2 id="_idParaDest-680" class="heading-2">Getting the index as well as items</h2>
    <p class="normal">.NET 9 introduced the <code class="inlineCode">Index</code> LINQ extension method. In previous versions of .NET, if you wanted <a id="_idIndexMarker1764"/>to get the index position of each item as well as the items themselves, you could do it using the <code class="inlineCode">Select</code> method, but it was a bit messy.</p>
    <p class="normal">Let’s see an example of the old way and the new way:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.Functions.cs</code>, add a method that defines an array of names and outputs them with their index position, using the old way (the <code class="inlineCode">Select</code> method) and then the new way (the <code class="inlineCode">Index</code> method), as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">WorkingWithIndices</span><span class="hljs-function">()</span>
{
  <span class="hljs-built_in">string</span>[] theSeven = { <span class="hljs-string">"Homelander"</span>,
<span class="hljs-built_in">   </span> <span class="hljs-string">"Black Noir"</span>, <span class="hljs-string">"The Deep"</span>, <span class="hljs-string">"A-Train"</span>,
    <span class="hljs-string">"Queen Maeve"</span>, <span class="hljs-string">"Starlight"</span>, <span class="hljs-string">"Stormfront"</span> };
  SectionTitle(<span class="hljs-string">"</span><span class="hljs-title">Working With Indices</span><span class="hljs-string"> (old)"</span>);
  <span class="hljs-keyword">foreach</span> (var (item, index) in
<span class="hljs-keyword">    </span>theSeven.Select((item, index) =&gt; (item, index)))
  {
    WriteLine($"{index}: {item}");
  }
  SectionTitle(<span class="hljs-string">"</span><span class="hljs-title">Working With Indices</span><span class="hljs-string"> (new)"</span>);
  <span class="hljs-keyword">foreach</span> (var (index, item) in theSeven.Index())
  {
    WriteLine($"{index}: {item}");
  }
}
</code></pre>
      </li>
    </ol>
    <div class="packt_tip-one">
      <p class="normal"><strong class="keyWord">Warning!</strong> Note the order of the two declared variables that will hold the index and the item. When using the <code class="inlineCode">Select</code> method, you must declare the <code class="inlineCode">item</code> first and then the <code class="inlineCode">index</code> second. When using the <code class="inlineCode">Index</code> method, you must declare the <code class="inlineCode">index</code> first and then the <code class="inlineCode">item</code> second.</p>
    </div>
    <ol>
      <li class="numberedList" value="2">In <code class="inlineCode">Program.cs</code>, comment <a id="_idIndexMarker1765"/>out the call to <code class="inlineCode">WorkingWithSets</code>, and then add a call to the <code class="inlineCode">WorkingWithIndices</code> method, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// WorkingWithSets();</span>
WorkingWithIndices();
</code></pre>
      </li>
      <li class="numberedList">Run the code and view the results, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">*** Working With Indices (old) ***
0: Homelander
1: Black Noir
2: The Deep
3: A-Train
4: Queen Maeve
5: Starlight
6: Stormfront
*** Working With Indices (new) ***
0: Homelander
1: Black Noir
2: The Deep
3: A-Train
4: Queen Maeve
5: Starlight
6: Stormfront
</code></pre>
      </li>
    </ol>
    <p class="normal">So far, we have <a id="_idIndexMarker1766"/>used the LINQ to Objects provider to work with in-memory objects. Next, we will use the LINQ to Entities provider to work with entities stored in a database.</p>
    <h1 id="_idParaDest-681" class="heading-1">Using LINQ with EF Core</h1>
    <p class="normal">We have looked at LINQ queries that filter and sort, but none that change the shape <a id="_idIndexMarker1767"/>of the items in the sequence. This <a id="_idIndexMarker1768"/>operation is called <strong class="keyWord">projection</strong> because it’s about <a id="_idIndexMarker1769"/>projecting items of one shape into another shape. To learn about projection, it is best to have some more complex types to work with, so in the next project, instead of using <code class="inlineCode">string</code> sequences, we will use sequences of entities from the Northwind sample database that you were introduced to in <em class="chapterRef">Chapter 10</em>, <em class="chapterRef">Working with Data Using Entity Framework Core</em>.</p>
    <p class="normal">I will give instructions to use SQLite because it is cross-platform, but if you prefer to use SQL Server, then feel free to do so. I have included some commented code to enable SQL Server if you choose.</p>
    <h2 id="_idParaDest-682" class="heading-2">Creating a console app for exploring LINQ to Entities</h2>
    <p class="normal">First, we <a id="_idIndexMarker1770"/>must create <a id="_idIndexMarker1771"/>a console app and Northwind database to work with:</p>
    <ol>
      <li class="numberedList" value="1">Use your preferred code editor to add a new <strong class="screenText">Console App</strong> / <code class="inlineCode">console</code> project, named <code class="inlineCode">LinqWithEFCore</code>, to the <code class="inlineCode">Chapter11</code> solution.</li>
      <li class="numberedList">In the project file, globally and statically import the <code class="inlineCode">System.Console</code> class.</li>
      <li class="numberedList">In the <code class="inlineCode">LinqWithEFCore</code> project, add a package reference to the EF Core provider for SQLite and/or SQL Server, as shown in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;!--To use SQLite--&gt;
  &lt;PackageReference Version=<span class="hljs-string">"9.0.0"</span>
    Include=<span class="hljs-string">"Microsoft.EntityFrameworkCore.Sqlite"</span> /&gt;
  &lt;!--To use SQL Server--&gt;
  &lt;PackageReference Version=<span class="hljs-string">"9.0.0"</span>
    Include=<span class="hljs-string">"Microsoft.EntityFrameworkCore.SqlServer"</span> /&gt;
&lt;/ItemGroup&gt;
</code></pre>
      </li>
      <li class="numberedList">Build the <code class="inlineCode">LinqWithEFCore</code> project to restore packages.</li>
      <li class="numberedList">Copy the <code class="inlineCode">Northwind4Sqlite.sql</code> file to the <code class="inlineCode">LinqWithEFCore</code> folder.</li>
      <li class="numberedList">At a command prompt or terminal in the <code class="inlineCode">LinqWithEFCore</code> folder, create the Northwind database by executing the following command:
        <pre class="programlisting con-one"><code class="hljs-con">sqlite3 Northwind.db -init Northwind4Sqlite.sql
</code></pre>
      </li>
      <li class="numberedList">Be patient because this command might take a while to create the database structure. Eventually, you will see the SQLite command prompt, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con"> -- Loading resources from Northwind4Sqlite.sql
SQLite version 3.38.0 2022-02-22 15:20:15
Enter ".help" for usage hints.
sqlite&gt;
</code></pre>
      </li>
      <li class="numberedList">To exit SQLite command mode, press <em class="keystroke">Ctrl</em> + <em class="keystroke">C</em> twice on Windows or <em class="keystroke">Cmd</em> + <em class="keystroke">D</em> on macOS or Linux.</li>
      <li class="numberedList">If you <a id="_idIndexMarker1772"/>prefer to work with SQL Server, then you should already <a id="_idIndexMarker1773"/>have the Northwind database created in SQL Server from the previous chapter.</li>
    </ol>
    <h2 id="_idParaDest-683" class="heading-2">Building an EF Core model</h2>
    <p class="normal">We must define an EF Core model to represent the database and tables that we will <a id="_idIndexMarker1774"/>work with. We will define the model manually to take complete control, and to prevent a relationship from being automatically defined between the <code class="inlineCode">Categories</code> and <code class="inlineCode">Products</code> tables. Later, you will use LINQ to join the two entity sets:</p>
    <ol>
      <li class="numberedList" value="1">In the <code class="inlineCode">LinqWithEFCore</code> project, add a new folder named <code class="inlineCode">EntityModels</code>.</li>
      <li class="numberedList">In the <code class="inlineCode">EntityModels</code> folder, add three class files to the project, named <code class="inlineCode">NorthwindDb.cs</code>, <code class="inlineCode">Category.cs</code>, and <code class="inlineCode">Product.cs</code>.</li>
      <li class="numberedList">Modify the class file named <code class="inlineCode">Category.cs</code>, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// To use [Required] and [StringLength].</span>
<span class="hljs-keyword">using</span> System.ComponentModel.DataAnnotations;
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Northwind.EntityModels</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Category</span>
{
  <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> CategoryId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
  [<span class="hljs-meta">Required</span>]
  [<span class="hljs-meta">StringLength(15)</span>]
  <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> CategoryName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">null</span>!;
  <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>? Description { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
      </li>
      <li class="numberedList">Modify <a id="_idIndexMarker1775"/>the class file named <code class="inlineCode">Product.cs</code>, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// To use [Required] and [StringLength].</span>
<span class="hljs-keyword">using</span> System.ComponentModel.DataAnnotations;
<span class="hljs-comment">// To use [Column].</span>
<span class="hljs-keyword">using</span> System.ComponentModel.DataAnnotations.Schema;
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Northwind.EntityModels</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Product</span>
{
  <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> ProductId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
  [<span class="hljs-meta">Required</span>]
  [<span class="hljs-meta">StringLength(40)</span>]
  <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> ProductName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">null</span>!;
  <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span>? SupplierId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
  <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span>? CategoryId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
  [<span class="hljs-meta">StringLength(20)</span>]
  <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>? QuantityPerUnit { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
  <span class="hljs-comment">// Required for SQL Server provider.</span>
  [<span class="hljs-meta">Column(TypeName = </span><span class="hljs-string">"money"</span><span class="hljs-meta">)</span>]
  <span class="hljs-keyword">public</span> <span class="hljs-built_in">decimal</span>? UnitPrice { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
  <span class="hljs-keyword">public</span> <span class="hljs-built_in">short</span>? UnitsInStock { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
  <span class="hljs-keyword">public</span> <span class="hljs-built_in">short</span>? UnitsOnOrder { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
  <span class="hljs-keyword">public</span> <span class="hljs-built_in">short</span>? ReorderLevel { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
  <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> Discontinued { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
      </li>
    </ol>
    <div class="note-one">
      <p class="normal">We have deliberately not defined any relationships between <code class="inlineCode">Category</code> and <code class="inlineCode">Product</code> so that we can see how to manually associate them with each other using LINQ later.</p>
    </div>
    <ol>
      <li class="numberedList" value="5">Modify <a id="_idIndexMarker1776"/>the class file named <code class="inlineCode">NorthwindDb.cs</code>, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">using</span> Microsoft.Data.SqlClient; <span class="hljs-comment">// To use SqlConnectionStringBuilder.</span>
<span class="hljs-keyword">using</span> Microsoft.EntityFrameworkCore; <span class="hljs-comment">// To use DbContext, DbSet&lt;T&gt;.</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Northwind.EntityModels</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">NorthwindDb</span> : <span class="hljs-title">DbContext</span>
{
  <span class="hljs-keyword">public</span> DbSet&lt;Category&gt; Categories { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">null</span>!;
  <span class="hljs-keyword">public</span> DbSet&lt;Product&gt; Products { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">null</span>!;
  <span class="hljs-keyword">protected</span><span class="hljs-function"> </span><span class="hljs-keyword">override</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">OnConfiguring</span><span class="hljs-function">(</span>
<span class="hljs-params">    DbContextOptionsBuilder optionsBuilder</span><span class="hljs-function">)</span>
  {
    <span class="hljs-meta">#</span><span class="hljs-keyword">region</span><span class="hljs-meta"> To use SQLite</span>
    <span class="hljs-built_in">string</span> database = <span class="hljs-string">"</span><span class="hljs-string">Northwind.db"</span>;
    <span class="hljs-built_in">string</span> dir = Environment.CurrentDirectory;
    <span class="hljs-built_in">string</span> path = <span class="hljs-built_in">string</span>.Empty;
    <span class="hljs-comment">// The database file will stay in the project folder.</span>
    <span class="hljs-comment">// We will automatically adjust the relative path to</span>
    <span class="hljs-comment">// account for running in Visual Studio or CLI.</span>
    <span class="hljs-keyword">if</span> (dir.EndsWith(<span class="hljs-string">"net9.0"</span>))
    {
      <span class="hljs-comment">// Running in the &lt;project&gt;\bin\&lt;Debug|Release&gt;\net9.0 directory.</span>
      path = Path.Combine(<span class="hljs-string">"</span><span class="hljs-string">.."</span>, <span class="hljs-string">".."</span>, <span class="hljs-string">".."</span>, database);
    }
    <span class="hljs-keyword">else</span>
    {
      <span class="hljs-comment">// Running in the &lt;project&gt; directory.</span>
      path = database;
    }
    path = Path.GetFullPath(path); <span class="hljs-comment">// Convert to absolute path.</span>
    WriteLine(<span class="hljs-string">$"SQLite database path: </span><span class="hljs-subst">{path}</span><span class="hljs-string">"</span>);
    <span class="hljs-keyword">if</span> (!File.Exists(path))
    {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> FileNotFoundException(
        message: <span class="hljs-string">$"</span><span class="hljs-subst">{path}</span><span class="hljs-string"> not found."</span>, fileName: path);
    }
    <span class="hljs-comment">// To use SQLite.</span>
    optionsBuilder.UseSqlite(<span class="hljs-string">$"Data Source=</span><span class="hljs-subst">{path}</span><span class="hljs-string">"</span>);
    <span class="hljs-meta">#</span><span class="hljs-keyword">endregion</span>
    <span class="hljs-meta">#</span><span class="hljs-keyword">region</span><span class="hljs-meta"> To use SQL Server</span>
    SqlConnectionStringBuilder builder = <span class="hljs-keyword">new</span>();
    builder.DataSource = <span class="hljs-string">"."</span>;
    builder.InitialCatalog = <span class="hljs-string">"Northwind"</span>;
    builder.IntegratedSecurity = <span class="hljs-literal">true</span>;
    builder.Encrypt = <span class="hljs-literal">true</span>;
    builder.TrustServerCertificate = <span class="hljs-literal">true</span>;
    builder.MultipleActiveResultSets = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">string</span> connection = builder.ConnectionString;
    <span class="hljs-comment">// WriteLine($"SQL Server connection: {connection}");</span>
    <span class="hljs-comment">// To use SQL Server.</span>
    <span class="hljs-comment">// optionsBuilder.UseSqlServer(connection);</span>
    <span class="hljs-meta">#</span><span class="hljs-keyword">endregion</span>
  }
  <span class="hljs-keyword">protected</span><span class="hljs-function"> </span><span class="hljs-keyword">override</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">OnModelCreating</span><span class="hljs-function">(</span>
<span class="hljs-params">    ModelBuilder modelBuilder</span><span class="hljs-function">)</span>
  {
    <span class="hljs-keyword">if</span> (Database.ProviderName <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span> &amp;&amp;
      Database.ProviderName.Contains(<span class="hljs-string">"Sqlite"</span>))
    {
      <span class="hljs-comment">// SQLite data provider does not directly support the</span>
      <span class="hljs-comment">// decimal type so we can convert to double instead.</span>
      modelBuilder.Entity&lt;Product&gt;()
        .Property(product =&gt; product.UnitPrice)
        .HasConversion&lt;<span class="hljs-built_in">double</span>&gt;();
    }
  }
}
</code></pre>
      </li>
    </ol>
    <div class="note-one">
      <p class="normal">If you want to use SQL Server, then comment out the statement that calls <code class="inlineCode">UseSqlite</code> and uncomment the statement that calls <code class="inlineCode">UseSqlServer</code>.</p>
    </div>
    <ol>
      <li class="numberedList" value="6">Build <a id="_idIndexMarker1777"/>the project and fix any compiler errors.</li>
    </ol>
    <h2 id="_idParaDest-684" class="heading-2">Filtering and sorting sequences</h2>
    <p class="normal">Now, let’s <a id="_idIndexMarker1778"/>write statements <a id="_idIndexMarker1779"/>to filter and sort sequences of rows from the tables:</p>
    <ol>
      <li class="numberedList" value="1">In the <code class="inlineCode">LinqWithEFCore</code> project, add a new class file named <code class="inlineCode">Program.Helpers.cs</code>.</li>
      <li class="numberedList">In <code class="inlineCode">Program.Helpers.cs</code>, define a partial <code class="inlineCode">Program</code> class with a method to configure the console to support special characters, like the Euro currency symbol, and control the current culture, as well as a method to output a section title, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">using</span> System.Globalization; <span class="hljs-comment">// To use CultureInfo.</span>
<span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
  <span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">ConfigureConsole</span><span class="hljs-function">(</span><span class="hljs-built_in">string</span><span class="hljs-params"> culture = </span><span class="hljs-string">"en-US"</span><span class="hljs-params">,</span>
<span class="hljs-params">    </span><span class="hljs-built_in">bool</span><span class="hljs-params"> useComputerCulture = </span><span class="hljs-literal">false</span><span class="hljs-function">)</span>
  {
    <span class="hljs-comment">// To enable Unicode characters like Euro symbol in the console.</span>
    OutputEncoding = System.Text.Encoding.UTF8;
    <span class="hljs-keyword">if</span> (!useComputerCulture)
    {
      CultureInfo.CurrentCulture = CultureInfo.GetCultureInfo(culture);
    }
    WriteLine(<span class="hljs-string">$"CurrentCulture: </span><span class="hljs-subst">{CultureInfo.CurrentCulture.DisplayName}</span><span class="hljs-string">"</span>);
  }
  <span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">SectionTitle</span><span class="hljs-function">(</span><span class="hljs-built_in">string</span><span class="hljs-params"> title</span><span class="hljs-function">)</span>
  {
    ConsoleColor previousColor = ForegroundColor;
    ForegroundColor = ConsoleColor.DarkYellow;
    WriteLine(<span class="hljs-string">$"*** </span><span class="hljs-subst">{title}</span><span class="hljs-string"> ***"</span>);
    ForegroundColor = previousColor;
  }
}
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">LinqWithEFCore</code> project, add a new class file named <code class="inlineCode">Program.Functions.cs</code>.</li>
      <li class="numberedList">In <code class="inlineCode">Program.Functions.cs</code>, define a partial <code class="inlineCode">Program</code> class, and add a method <a id="_idIndexMarker1780"/>to filter <a id="_idIndexMarker1781"/>and sort products, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">using</span> Northwind.EntityModels; <span class="hljs-comment">// To use NorthwindDb, Category, Product.</span>
<span class="hljs-keyword">using</span> Microsoft.EntityFrameworkCore; <span class="hljs-comment">// To use DbSet&lt;T&gt;.</span>
<span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
  <span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">FilterAndSort</span><span class="hljs-function">()</span>
  {
    SectionTitle(<span class="hljs-string">"Filter and sort"</span>);
    <span class="hljs-keyword">using</span> NorthwindDb db = <span class="hljs-keyword">new</span>();
    DbSet&lt;Product&gt; allProducts = db.Products;
    IQueryable&lt;Product&gt; filteredProducts =
      allProducts.Where(product =&gt; product.UnitPrice &lt; <span class="hljs-number">10</span>M);
    IOrderedQueryable&lt;Product&gt; sortedAndFilteredProducts =
      filteredProducts.OrderByDescending(product =&gt; product.UnitPrice);
    WriteLine(<span class="hljs-string">"Products that cost less than $10:"</span>);
    <span class="hljs-keyword">foreach</span> (Product p <span class="hljs-keyword">in</span> sortedAndFilteredProducts)
    {
      WriteLine(<span class="hljs-string">"{0}: {1} costs {2:$#,##0.00}"</span>,
        p.ProductId, p.ProductName, p.UnitPrice);
    }
    WriteLine();
  }
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">Note <a id="_idIndexMarker1782"/>the following <a id="_idIndexMarker1783"/>about the preceding code:</p>
    <ul>
      <li class="bulletList level-2"><code class="inlineCode">DbSet&lt;T&gt;</code> implements <code class="inlineCode">IEnumerable&lt;T&gt;</code>, so LINQ can be used to query and manipulate sequences of entities in models built for EF Core. (Actually, I should say <code class="inlineCode">TEntity</code> instead of <code class="inlineCode">T</code>, but the name of this generic type has no functional effect. The only requirement is that the type is a <code class="inlineCode">class</code>. The name just indicates that the class is expected to be an entity model.)</li>
      <li class="bulletList level-2">The sequences implement <code class="inlineCode">IQueryable&lt;T&gt;</code> (or <code class="inlineCode">IOrderedQueryable&lt;T&gt;</code> after a call to an ordering LINQ method) instead of <code class="inlineCode">IEnumerable&lt;T&gt;</code> or <code class="inlineCode">IOrderedEnumerable&lt;T&gt;</code>. This is an indication that we are using a LINQ provider that builds the query, using expression trees. They represent code in a tree-like data structure and enable the creation of dynamic queries, which is useful for building LINQ queries for external data providers, like SQLite.</li>
      <li class="bulletList level-2">The LINQ expression will be converted into another query language, such as SQL. Enumerating the query with <code class="inlineCode">foreach</code> or calling a method such as <code class="inlineCode">ToArray</code> will force the execution of the query and materialize the results.</li>
    </ul>
    <ol>
      <li class="numberedList" value="5">In <code class="inlineCode">Program.cs</code>, delete <a id="_idIndexMarker1784"/>any existing statements, and then call the <code class="inlineCode">ConfigureConsole</code> and <code class="inlineCode">FilterAndSort</code> methods, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">ConfigureConsole(); <span class="hljs-comment">// Sets US English by default.</span>
FilterAndSort();
</code></pre>
      </li>
      <li class="numberedList">Run the <a id="_idIndexMarker1785"/>project and view the result, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">CurrentCulture: English (United States)
*** Filter and sort ***
SQLite database path: C:\cs13net9\Chapter11\LinqWithEFCore\Northwind.db
Products that cost less than $10:
41: Jack's New England Clam Chowder costs $9.65
45: Rogede sild costs $9.50
47: Zaanse koeken costs $9.50
19: Teatime Chocolate Biscuits costs $9.20
23: Tunnbröd costs $9.00
75: Rhönbräu Klosterbier costs $7.75
54: Tourtière costs $7.45
52: Filo Mix costs $7.00
13: Konbu costs $6.00
24: Guaraná Fantástica costs $4.50
33: Geitost costs $2.50
</code></pre>
      </li>
    </ol>
    <p class="normal-one">Although this query outputs the information we want, it does so inefficiently because it gets all the columns from the <code class="inlineCode">Products</code> table, instead of just the three columns we need. Let’s log the generated SQL.</p>
    <ol>
      <li class="numberedList" value="7">In the <code class="inlineCode">FilterAndSort</code> method, before enumerating the results using <code class="inlineCode">foreach</code>, add a statement to output the SQL, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">WriteLine(<span class="hljs-string">"Products that cost less than $10:"</span>);
<span class="code-highlight"><strong class="hljs-slc">WriteLine(sortedAndFilteredProducts.ToQueryString());</strong></span>
</code></pre>
      </li>
      <li class="numberedList">Run the <a id="_idIndexMarker1786"/>code, and <a id="_idIndexMarker1787"/>view the result that shows the SQL executed before the product details, as shown in the following partial output:
        <pre class="programlisting con-one"><code class="hljs-con">Products that cost less than $10:
SELECT "p"."ProductId", "p"."CategoryId", "p"."Discontinued", "p"."ProductName", "p"."QuantityPerUnit", "p"."ReorderLevel", "p"."SupplierId", "p"."UnitPrice", "p"."UnitsInStock", "p"."UnitsOnOrder"
FROM "Products" AS "p"
WHERE "p"."UnitPrice" &lt; 10.0
ORDER BY "p"."UnitPrice" DESC
41: Jack's New England Clam Chowder costs $9.65
...
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-685" class="heading-2">Projecting sequences into new types</h2>
    <p class="normal">Before we look at <strong class="keyWord">projection</strong>, we should review object initialization syntax. If you have a <a id="_idIndexMarker1788"/>class defined, then you can instantiate an object using the class name, <code class="inlineCode">new()</code>, and curly braces to set initial values for fields and properties, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// Person.cs</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Person</span>
{
  <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
  <span class="hljs-keyword">public</span> DateTime DateOfBirth { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
<span class="hljs-comment">// Program.cs</span>
Person knownTypeObject = <span class="hljs-keyword">new</span>()
{
  Name = <span class="hljs-string">"Boris Johnson"</span>,
  DateOfBirth = <span class="hljs-keyword">new</span>(year: <span class="hljs-number">1964</span>, month: <span class="hljs-number">6</span>, day: <span class="hljs-number">19</span>)
};
</code></pre>
    <p class="normal">C# 3 and later <a id="_idIndexMarker1789"/>allow instances of <strong class="keyWord">anonymous types</strong> to be instantiated using the <code class="inlineCode">var</code> keyword, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">var</span> anonymouslyTypedObject = <span class="hljs-keyword">new</span>
{
  Name = <span class="hljs-string">"Boris Johnson"</span>,
  DateOfBirth = <span class="hljs-keyword">new</span> DateTime(year: <span class="hljs-number">1964</span>, month: <span class="hljs-number">6</span>, day: <span class="hljs-number">19</span>)
};
</code></pre>
    <p class="normal">Although we did not specify a type, the compiler can infer an anonymous type from <a id="_idIndexMarker1790"/>the setting of two properties, named <code class="inlineCode">Name</code> and <code class="inlineCode">DateOfBirth</code>. The compiler can infer the types of the two properties from the values assigned: a literal <code class="inlineCode">string</code> and a new instance of a date/time value.</p>
    <p class="normal">This capability is especially useful when writing LINQ queries to project an existing type into a new type, without having to explicitly define the new type. Since the type is anonymous, this can only work with <code class="inlineCode">var</code>-declared local variables.</p>
    <p class="normal">Let’s make the SQL command executed against the database table more efficient by adding a call to the <code class="inlineCode">Select</code> method, projecting instances of the <code class="inlineCode">Product</code> class into instances of a new anonymous type with only three properties:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.Functions.cs</code>, in the <code class="inlineCode">FilterAndSort</code> method, add a statement to extend the LINQ query to use the <code class="inlineCode">Select</code> method to return only the three properties (that is, table columns) that we need, modify the call to <code class="inlineCode">ToQueryString</code> to use the new <code class="inlineCode">projectedProducts</code> query, and modify the <code class="inlineCode">foreach</code> statement to use the <code class="inlineCode">var</code> keyword and the new <code class="inlineCode">projectedProducts</code> query, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">IOrderedQueryable&lt;Product&gt; sortedAndFilteredProducts =
  filteredProducts.OrderByDescending(product =&gt; product.UnitPrice);
<span class="code-highlight"><strong class="hljs-keyword-slc">var</strong><strong class="hljs-slc"> projectedProducts = sortedAndFilteredProducts</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  .Select(product =&gt; </strong><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc">// Anonymous type.</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  {</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    product.ProductId,</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    product.ProductName,</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    product.UnitPrice</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  });</strong></span>
WriteLine(<span class="hljs-string">"Products that cost less than $10:"</span>);
WriteLine(<span class="code-highlight"><strong class="hljs-slc">projectedProducts</strong></span>.ToQueryString());
<span class="hljs-keyword">foreach</span> (<span class="code-highlight"><strong class="hljs-keyword-slc">var</strong></span> p <span class="hljs-keyword">in</span> <span class="code-highlight"><strong class="hljs-slc">projectedProducts</strong></span>)
{
</code></pre>
      </li>
      <li class="numberedList">Hover <a id="_idIndexMarker1791"/>your mouse over the <code class="inlineCode">new</code> keyword in the <code class="inlineCode">Select</code> method call, or the <code class="inlineCode">var</code> keyword in the <code class="inlineCode">foreach</code> statement, and note that it is an anonymous type, as shown in <em class="italic">Figure 11.5</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B22322_11_05.png" alt="" width="812" height="278"/></figure>
    <p class="packt_figref">Figure 11.5: An anonymous type used during LINQ projection</p>
    <ol>
      <li class="numberedList" value="3">Run the project, and confirm that the output is the same as before and the generated SQL is more efficient, as shown in the following output:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">SELECT</span> "p"."ProductId", "p"."ProductName", "p"."UnitPrice"
<span class="hljs-keyword">FROM</span> "Products" <span class="hljs-keyword">AS</span> "p"
<span class="hljs-keyword">WHERE</span> "p"."UnitPrice" <span class="hljs-operator">&lt;</span> <span class="hljs-number">10.0</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> "p"."UnitPrice" <span class="hljs-keyword">DESC</span>
</code></pre>
      </li>
    </ol>
    <div class="note-one">
      <p class="normal"><strong class="keyWord">More Information</strong>: You can learn more about projection using the <code class="inlineCode">Select</code> method <a id="_idIndexMarker1792"/>at the following link: <a href="https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/linq/projection-operations"><span class="url">https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/linq/projection-operations</span></a>.</p>
    </div>
    <p class="normal">Let’s <a id="_idIndexMarker1793"/>continue to look at common LINQ queries by learning how to join, group, and perform lookups.</p>
    <h1 id="_idParaDest-686" class="heading-1">Joining, grouping, and lookups</h1>
    <p class="normal">There are three extension methods for joining, grouping, and creating grouped lookups:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">Join</code>: This method <a id="_idIndexMarker1794"/>has four parameters: the sequence that you want to join with, the property or properties on the <em class="italic">left</em> sequence to match on, the property or properties on the <em class="italic">right</em> sequence to match on, and a projection.</li>
      <li class="bulletList"><code class="inlineCode">GroupJoin</code>: This method <a id="_idIndexMarker1795"/>has the same parameters, but it combines the matches into a group object with a <code class="inlineCode">Key</code> property for the matching value and an <code class="inlineCode">IEnumerable&lt;T&gt;</code> type for the multiple matches.</li>
      <li class="bulletList"><code class="inlineCode">ToLookup</code>: This method <a id="_idIndexMarker1796"/>creates a new data structure with the sequence grouped by a key.</li>
    </ul>
    <h2 id="_idParaDest-687" class="heading-2">Joining sequences</h2>
    <p class="normal">Let’s explore <a id="_idIndexMarker1797"/>these methods when working with two tables, <code class="inlineCode">Categories</code> and <code class="inlineCode">Products</code>:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.Functions.cs</code>, add a method to select categories and products, join them, and output them, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">JoinCategoriesAndProducts</span><span class="hljs-function">()</span>
{
  SectionTitle(<span class="hljs-string">"Join categories and products"</span>);
  <span class="hljs-keyword">using</span> NorthwindDb db = <span class="hljs-keyword">new</span>();
  <span class="hljs-comment">// Join every product to its category to return 77 matches.</span>
  <span class="hljs-keyword">var</span> queryJoin = db.Categories.Join(
    inner: db.Products,
    outerKeySelector: category =&gt; category.CategoryId,
    innerKeySelector: product =&gt; product.CategoryId,
    resultSelector: (c, p) =&gt;
      <span class="hljs-keyword">new</span> { c.CategoryName, p.ProductName, p.ProductId });
  <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> p <span class="hljs-keyword">in</span> queryJoin)
  {
    WriteLine(<span class="hljs-string">$"</span><span class="hljs-subst">{p.ProductId}</span><span class="hljs-string">: </span><span class="hljs-subst">{p.ProductName}</span><span class="hljs-string"> in </span><span class="hljs-subst">{p.CategoryName}</span><span class="hljs-string">."</span>);
  }
}
</code></pre>
      </li>
    </ol>
    <div class="note-one">
      <p class="normal">In a join, there are two sequences, <code class="inlineCode">outer</code> and <code class="inlineCode">inner</code>. In the preceding example, <code class="inlineCode">categories</code> is the outer sequence and <code class="inlineCode">products</code> is the inner sequence.</p>
    </div>
    <ol>
      <li class="numberedList" value="2">In <code class="inlineCode">Program.cs</code>, comment out the call to <code class="inlineCode">FilterAndSort</code>, and then call the <code class="inlineCode">JoinCategoriesAndProducts</code> method, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">ConfigureConsole(); <span class="hljs-comment">// Sets US English by default.</span>
<span class="code-highlight"><strong class="hljs-comment-slc">//</strong></span><span class="hljs-comment"> FilterAndSort();</span>
<span class="code-highlight"><strong class="hljs-slc">JoinCategoriesAndProducts();</strong></span>
</code></pre>
      </li>
      <li class="numberedList">Run the code and view the results. Note that there is a single line of output for each of the 77 products, as shown in the following output (edited to only include the first four items):
        <pre class="programlisting con-one"><code class="hljs-con">1: Chai in Beverages.
2: Chang in Beverages.
3: Aniseed Syrup in Condiments.
4: Chef Anton's Cajun Seasoning in Condiments.
...
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.Functions.cs</code>, in the <code class="inlineCode">JoinCategoriesAndProducts</code> method, at the end <a id="_idIndexMarker1798"/>of the existing query, call the <code class="inlineCode">OrderBy</code> method to sort by <code class="inlineCode">CategoryName</code>, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">var</span> queryJoin = db.Categories.Join(
  inner: db.Products,
  outerKeySelector: category =&gt; category.CategoryId,
  innerKeySelector: product =&gt; product.CategoryId,
  resultSelector: (c, p) =&gt;
    <span class="hljs-keyword">new</span> { c.CategoryName, p.ProductName, p.ProductId })
  <span class="code-highlight"><strong class="hljs-slc">.OrderBy(cp =&gt; cp.CategoryName)</strong></span>;
</code></pre>
      </li>
      <li class="numberedList">Run the code and view the results. Note that there is a single line of output for each of the 77 products, and the results show all products in the <code class="inlineCode">Beverages</code> category first, then the <code class="inlineCode">Condiments</code> category, and so on, as shown in the following partial output:
        <pre class="programlisting con-one"><code class="hljs-con">1: Chai in Beverages.
2: Chang in Beverages.
24: Guaraná Fantástica in Beverages.
34: Sasquatch Ale in Beverages.
...
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-688" class="heading-2">Group-joining sequences</h2>
    <p class="normal">Let’s explore <a id="_idIndexMarker1799"/>group joining when working with the same two tables that we used to explore joining, <code class="inlineCode">Categories</code> and <code class="inlineCode">Products</code>, so that we can compare the subtle differences:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.Functions.cs</code>, add a method to group and join, show the group name, and then show all the items within each group, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">GroupJoinCategoriesAndProducts</span><span class="hljs-function">()</span>
{
  SectionTitle(<span class="hljs-string">"Group join categories and products"</span>);
  <span class="hljs-keyword">using</span> NorthwindDb db = <span class="hljs-keyword">new</span>();
  <span class="hljs-comment">// Group all products by their category to return 8 matches.</span>
  <span class="hljs-keyword">var</span> queryGroup = db.Categories.AsEnumerable().GroupJoin(
    inner: db.Products,
    outerKeySelector: category =&gt; category.CategoryId,
    innerKeySelector: product =&gt; product.CategoryId,
    resultSelector: (c, matchingProducts) =&gt; <span class="hljs-keyword">new</span>
    {
      c.CategoryName,
      Products = matchingProducts.OrderBy(p =&gt; p.ProductName)
    });
  <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> c <span class="hljs-keyword">in</span> queryGroup)
  {
    WriteLine(<span class="hljs-string">$"</span><span class="hljs-subst">{c.CategoryName}</span><span class="hljs-string"> has </span><span class="hljs-subst">{c.Products.Count()}</span><span class="hljs-string"> products."</span>);
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> product <span class="hljs-keyword">in</span> c.Products)
    {
      WriteLine(<span class="hljs-string">$"  </span><span class="hljs-subst">{product.ProductName}</span><span class="hljs-string">"</span>);
    }
  }
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">If we had not called the <code class="inlineCode">AsEnumerable</code> method, then a runtime exception would have been thrown, as shown in the following output:</p>
    <pre class="programlisting con-one"><code class="hljs-con">Unhandled exception. System.ArgumentException:  Argument type 'System.Linq.IOrderedQueryable`1[Packt.Shared.Product]' does not match the corresponding member type 'System.Linq.IOrderedEnumerable`1[Packt.Shared.Product]' (Parameter 'arguments[1]')
</code></pre>
    <p class="normal-one">This is because not all LINQ extension methods can be converted from expression trees into some other query syntax, like SQL. In these cases, we can convert from <code class="inlineCode">IQueryable&lt;T&gt;</code> to <code class="inlineCode">IEnumerable&lt;T&gt;</code> by calling the <code class="inlineCode">AsEnumerable</code> method, which forces query processing to use LINQ to EF Core <a id="_idIndexMarker1800"/>only to bring the data into the application, and then LINQ to Objects to execute more complex processing in memory. But, often, this is less efficient.</p>
    <ol>
      <li class="numberedList" value="2">In <code class="inlineCode">Program.cs</code>, call the <code class="inlineCode">GroupJoinCategoriesAndProducts</code> method.</li>
      <li class="numberedList">Run the code, view the results, and note that the products inside each category have been sorted by their name, as defined in the query and as shown in the following partial output:
        <pre class="programlisting con-one"><code class="hljs-con">Beverages has 12 products.
  Chai
  Chang
  ...
Condiments has 12 products.
  Aniseed Syrup
  Chef Anton's Cajun Seasoning
  ...
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-689" class="heading-2">Grouping for lookups</h2>
    <p class="normal">Instead of <a id="_idIndexMarker1801"/>writing a LINQ query expression to join and group and running it once, you might want to use a LINQ extension method to create, and then store a reusable in-memory collection that has entities that have been grouped.</p>
    <p class="normal">We have a table named <code class="inlineCode">Products</code> in the Northwind database that includes a column for the categories that they reside in, as partially shown in <em class="italic">Table 11.4</em>:</p>
    <table id="table004-7" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">ProductName</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">CategoryID</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Chai</p>
          </td>
          <td class="table-cell">
            <p class="normal">1</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Chang</p>
          </td>
          <td class="table-cell">
            <p class="normal">1</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Aniseed Syrup</p>
          </td>
          <td class="table-cell">
            <p class="normal">2</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Chef Anton’s Cajun Seasoning</p>
          </td>
          <td class="table-cell">
            <p class="normal">2</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Chef Anton’s Gumbo Mix</p>
          </td>
          <td class="table-cell">
            <p class="normal">2</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">...</p>
          </td>
          <td class="table-cell">
            <p class="normal">...</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 11.4: The first five rows of the Products table</p>
    <p class="normal">You might <a id="_idIndexMarker1802"/>want to create a data structure in memory that can group the <code class="inlineCode">Product</code> entities by their category, and then provide a quick way to look up all the products in a specific category.</p>
    <p class="normal">You can create this using the <code class="inlineCode">ToLookup</code> LINQ method, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">ILookup&lt;<span class="hljs-built_in">int</span>, Product&gt;? productsByCategoryId =
  db.Products.ToLookup(keySelector: category =&gt; category.CategoryId);
</code></pre>
    <p class="normal">When you call the <code class="inlineCode">ToLookup</code> method, you must specify a <strong class="keyWord">key selector</strong> to choose what value you want to group by. This value can then later be used to look up the group and its items.</p>
    <p class="normal">The <code class="inlineCode">ToLookup</code> method creates a dictionary-like data structure of key-value pairs in memory that has unique category IDs for the key and a collection of <code class="inlineCode">Product</code> objects for the value, as partially shown in <em class="italic">Table 11.5</em>:</p>
    <table id="table005-6" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Key</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Value (each one is a collection of Product objects)</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">1</p>
          </td>
          <td class="table-cell">
            <p class="normal">[Chai], [Chang], and so on</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">2</p>
          </td>
          <td class="table-cell">
            <p class="normal">[Aniseed Syrup], [Chef Anton’s Cajun Seasoning], [Chef Anton’s Gumbo Mix], and so on</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">...</p>
          </td>
          <td class="table-cell">
            <p class="normal">...</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 11.5: The first two rows in the lookup</p>
    <p class="normal">Note that <a id="_idIndexMarker1803"/>the product names in square brackets, such as [<code class="inlineCode">Chai</code>], represent an entire <code class="inlineCode">Product</code> object.</p>
    <p class="normal">Instead of using the <code class="inlineCode">CategoryId</code> values as the key to the lookup, we could use the category names from the related categories table.</p>
    <p class="normal">Let’s do this in a code example:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.Functions.cs</code>, add a method to join products to category names, and then convert them into a lookup, enumerate through the whole lookup using an <code class="inlineCode">IGrouping&lt;string, Product&gt;</code> to represent each row in the lookup dictionary, and look up an individual collection of products for a specific category, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">ProductsLookup</span><span class="hljs-function">()</span>
{
  SectionTitle(<span class="hljs-string">"Products lookup"</span>);
  <span class="hljs-keyword">using</span> NorthwindDb db = <span class="hljs-keyword">new</span>();
  <span class="hljs-comment">// Join all products to their category to return 77 matches.</span>
  <span class="hljs-keyword">var</span> productQuery = db.Categories.Join(
    inner: db.Products,
    outerKeySelector: category =&gt; category.CategoryId,
    innerKeySelector: product =&gt; product.CategoryId,
    resultSelector: (c, p) =&gt; <span class="hljs-keyword">new</span> { c.CategoryName, Product = p });
  ILookup&lt;<span class="hljs-built_in">string</span>, Product&gt; productLookup = productQuery.ToLookup(
    keySelector: cp =&gt; cp.CategoryName,
    elementSelector: cp =&gt; cp.Product);
  <span class="hljs-keyword">foreach</span> (IGrouping&lt;<span class="hljs-built_in">string</span>, Product&gt; <span class="hljs-keyword">group</span> <span class="hljs-keyword">in</span> productLookup)
  {
    <span class="hljs-comment">// Key is Beverages, Condiments, and so on.</span>
    WriteLine(<span class="hljs-string">$"</span><span class="hljs-subst">{</span><span class="hljs-keyword">group</span><span class="hljs-subst">.Key}</span><span class="hljs-string"> has </span><span class="hljs-subst">{</span><span class="hljs-keyword">group</span><span class="hljs-subst">.Count()}</span><span class="hljs-string"> products."</span>);
    <span class="hljs-keyword">foreach</span> (Product product <span class="hljs-keyword">in</span> <span class="hljs-keyword">group</span>)
    {
      WriteLine(<span class="hljs-string">$" </span><span class="hljs-subst">{product.ProductName}</span><span class="hljs-string">"</span>);
    }
  }
  <span class="hljs-comment">// We can look up the products by a category name.</span>
  Write(<span class="hljs-string">"Enter a category name: "</span>);
  <span class="hljs-built_in">string</span> categoryName = ReadLine()!;
  WriteLine();
  WriteLine(<span class="hljs-string">$"Products in </span><span class="hljs-subst">{categoryName}</span><span class="hljs-string">:"</span>);
  IEnumerable&lt;Product&gt; productsInCategory = productLookup[categoryName];
  <span class="hljs-keyword">foreach</span> (Product product <span class="hljs-keyword">in</span> productsInCategory)
  {
    WriteLine(<span class="hljs-string">$"  </span><span class="hljs-subst">{product.ProductName}</span><span class="hljs-string">"</span>);
  }
}
</code></pre>
      </li>
    </ol>
    <div class="note-one">
      <p class="normal"><strong class="keyWord">Selector</strong> parameters are <a id="_idIndexMarker1804"/>lambda expressions that select sub-elements for different purposes. For example, <code class="inlineCode">ToLookup</code> has a <code class="inlineCode">keySelector</code> to select the part of each item that will be the key and an <code class="inlineCode">elementSelector</code> to select the part of each item that will be the value. You can learn <a id="_idIndexMarker1805"/>more at the following link: <a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.tolookup"><span class="url">https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.tolookup</span></a>.</p>
    </div>
    <ol>
      <li class="numberedList" value="2">In <code class="inlineCode">Program.cs</code>, call the <code class="inlineCode">ProductsLookup</code> method.</li>
      <li class="numberedList">Run the code, view the results, enter a category name like <code class="inlineCode">Seafoods</code>, and note <a id="_idIndexMarker1806"/>that the products have been looked up and listed for that category, as shown in the following partial output:
        <pre class="programlisting con-one"><code class="hljs-con">Beverages has 12 products.
  Chai
  Chang
  ...
Condiments has 12 products.
  Aniseed Syrup
  Chef Anton's Cajun Seasoning
  ...
Enter a category name: Seafood
Products in Seafood:
  Ikura
  Konbu
  Carnarvon Tigers
  Nord-Ost Matjeshering
  Inlagd Sill
  Gravad lax
  Boston Crab Meat
  Jack's New England Clam Chowder
  Rogede sild
  Spegesild
  Escargots de Bourgogne
  Röd Kaviar
</code></pre>
      </li>
    </ol>
    <p class="normal">There is a lot more to LINQ, and in the final section, you will have the opportunity to explore further with some online material to walk through.</p>
    <h1 id="_idParaDest-690" class="heading-1">Practicing and exploring</h1>
    <p class="normal">Test your knowledge and understanding by answering some questions, getting some hands-on practice, and exploring with deeper research the topics covered in this chapter.</p>
    <h2 id="_idParaDest-691" class="heading-2">Exercise 11.1 – Online material</h2>
    <p class="normal">Online materials can be extra content written by me for this book, or it can be references to content created by Microsoft or third parties.</p>
    <h3 id="_idParaDest-692" class="heading-3">Aggregating and paging sequences</h3>
    <p class="normal">You can learn how to use LINQ aggregate methods and implement paging for data at the following link:</p>
    <p class="normal"><a href="https://github.com/markjprice/cs13net9/blob/main/docs/ch11-aggregating.md"><span class="url">https://github.com/markjprice/cs13net9/blob/main/docs/ch11-aggregating.md</span></a></p>
    <h3 id="_idParaDest-693" class="heading-3">Using multiple threads with parallel LINQ</h3>
    <p class="normal">You can improve performance and scalability by using multiple threads to run LINQ queries. Learn how by completing the online-only section found at the following link:</p>
    <p class="normal"><a href="https://github.com/markjprice/cs13net9/blob/main/docs/ch11-plinq.md"><span class="url">https://github.com/markjprice/cs13net9/blob/main/docs/ch11-plinq.md</span></a></p>
    <h3 id="_idParaDest-694" class="heading-3">Working with LINQ to XML</h3>
    <p class="normal">If you want to process or generate XML using LINQ, then you can learn the basics of how by completing the online-only section found at the following link:</p>
    <p class="normal"><a href="https://github.com/markjprice/cs13net9/blob/main/docs/ch11-linq-to-xml.md"><span class="url">https://github.com/markjprice/cs13net9/blob/main/docs/ch11-linq-to-xml.md</span></a></p>
    <h3 id="_idParaDest-695" class="heading-3">Creating your own LINQ extension methods</h3>
    <p class="normal">If you want to create your own LINQ extension methods, then you can learn the basics of how by completing the online-only section found at the following link:</p>
    <p class="normal"><a href="https://github.com/markjprice/cs13net9/blob/main/docs/ch11-custom-linq-methods.md"><span class="url">https://github.com/markjprice/cs13net9/blob/main/docs/ch11-custom-linq-methods.md</span></a></p>
    <h3 id="_idParaDest-696" class="heading-3">Design of the new LINQ methods in .NET 9</h3>
    <p class="normal">You can read about the design of the new LINQ extension methods introduced in .NET 9 at the following links:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">AggregateBy</code>: <a href="https://github.com/dotnet/runtime/issues/91533"><span class="url">https://github.com/dotnet/runtime/issues/91533</span></a>.</li>
      <li class="bulletList"><code class="inlineCode">CountBy</code>: <a href="https://github.com/dotnet/runtime/issues/77716"><span class="url">https://github.com/dotnet/runtime/issues/77716</span></a>.</li>
      <li class="bulletList"><code class="inlineCode">Index</code>: <a href="https://github.com/dotnet/runtime/issues/95563"><span class="url">https://github.com/dotnet/runtime/issues/95563</span></a>.</li>
    </ul>
    <h2 id="_idParaDest-697" class="heading-2">Exercise 11.2 – Practice querying with LINQ</h2>
    <p class="normal">In the <code class="inlineCode">Chapter11</code> solution, create a console application, named <code class="inlineCode">Exercise_LinqQueries</code>, that prompts the user for a city and then lists the company names for Northwind customers in that city, as shown in the following output:</p>
    <pre class="programlisting con"><code class="hljs-con">Enter the name of a city: London
There are 6 customers in London:
  Around the Horn
  B's Beverages
  Consolidated Holdings
  Eastern Connection
  North/South
  Seven Seas Imports
</code></pre>
    <p class="normal">Then, enhance the application by displaying a list of all the unique cities that customers already reside in as a prompt to the user before they enter their preferred city, as shown in the following output:</p>
    <pre class="programlisting con"><code class="hljs-con">Aachen, Albuquerque, Anchorage, Århus, Barcelona, Barquisimeto, Bergamo, Berlin, Bern, Boise, Bräcke, Brandenburg, Bruxelles, Buenos Aires, Butte, Campinas, Caracas, Charleroi, Cork, Cowes, Cunewalde, Elgin, Eugene, Frankfurt a.M., Genève, Graz, Helsinki, I. de Margarita, Kirkland, Kobenhavn, Köln, Lander, Leipzig, Lille, Lisboa, London, Luleå, Lyon, Madrid, Mannheim, Marseille, México D.F., Montréal, München, Münster, Nantes, Oulu, Paris, Portland, Reggio Emilia, Reims, Resende, Rio de Janeiro, Salzburg, San Cristóbal, San Francisco, Sao Paulo, Seattle, Sevilla, Stavern, Strasbourg, Stuttgart, Torino, Toulouse, Tsawassen, Vancouver, Versailles, Walla Walla, Warszawa
</code></pre>
    <h2 id="_idParaDest-698" class="heading-2">Exercise 11.3 – Test your knowledge</h2>
    <p class="normal">Answer the following questions:</p>
    <ol>
      <li class="numberedList" value="1">What are the two required parts of LINQ?</li>
      <li class="numberedList">Which LINQ extension method would you use to return a subset of properties from a type?</li>
      <li class="numberedList">Which LINQ extension method would you use to filter a sequence?</li>
      <li class="numberedList">List five LINQ extension methods that perform aggregation.</li>
      <li class="numberedList">What is the difference between the <code class="inlineCode">Select</code> and <code class="inlineCode">SelectMany</code> extension methods?</li>
      <li class="numberedList">What is the difference between <code class="inlineCode">IEnumerable&lt;T&gt;</code> and <code class="inlineCode">IQueryable&lt;T&gt;</code>? How do you switch between them?</li>
      <li class="numberedList">What does the last type parameter <code class="inlineCode">T</code> in generic <code class="inlineCode">Func</code> delegates like <code class="inlineCode">Func&lt;T1, T2, T&gt;</code> represent?</li>
      <li class="numberedList">What is the benefit of a LINQ extension method that ends with <code class="inlineCode">OrDefault</code>?</li>
      <li class="numberedList">Why is query comprehension syntax optional?</li>
      <li class="numberedList">How can you create your own LINQ extension methods?</li>
    </ol>
    <h2 id="_idParaDest-699" class="heading-2">Exercise 11.4 – Explore topics</h2>
    <p class="normal">Use the links on the following page to learn more details about the topics covered in this chapter:</p>
    <p class="normal"><a href="https://github.com/markjprice/cs13net9/blob/main/docs/book-links.md#chapter-11---querying-and-manipulating-data-using-linq"><span class="url">https://github.com/markjprice/cs13net9/blob/main/docs/book-links.md#chapter-11---querying-and-manipulating-data-using-linq</span></a></p>
    <h1 id="_idParaDest-700" class="heading-1">Summary</h1>
    <p class="normal">In this chapter, you learned how to write LINQ queries to perform common tasks like:</p>
    <ul>
      <li class="bulletList">Selecting just the properties of an item that you need.</li>
      <li class="bulletList">Filtering items based on conditions.</li>
      <li class="bulletList">Sorting items.</li>
      <li class="bulletList">Projecting items into different types.</li>
      <li class="bulletList">Joining and grouping items.</li>
    </ul>
    <p class="normal">In the next chapter, you will be introduced to web development using ASP.NET Core. In the remaining chapters, you will learn how to implement modern features of ASP.NET Core, like Blazor and Minimal APIs.</p>
  </div>
</div></div></body></html>