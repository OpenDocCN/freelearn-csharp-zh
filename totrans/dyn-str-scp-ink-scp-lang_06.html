<html><head></head><body><div><div><h1 id="_idParaDest-78"><em class="italic"><a id="_idTextAnchor077"/>Chapter 5</em>: Tunnels and Threads</h1>
			<p>This chapter begins <a id="_idIndexMarker173"/>with the concept of a <strong class="bold">tunnel</strong>. Created using multiple diverts and at least two knots (please refer to <a href="B17597_02_Final_PG_ePub.xhtml#_idTextAnchor031"><em class="italic">Chapter 2</em></a>, <em class="italic">Knots, Diverts, and Looping Patterns</em>), tunnels serve as a faster way in which to create complex structures than previously discussed in the last chapters. Following this, we will move on to review <strong class="bold">threads</strong>, which is <a id="_idIndexMarker174"/>another way of using diverts to connect multiple parts of an ink project dynamically. Finally, we will look at combining tunnels and threads to make even more complex structures based on the simple rules of how ink understands knots and diverts within a story.</p>
			<p>In this chapter, we will cover the following main topics:</p>
			<ul>
				<li>Diverting to a divert</li>
				<li>Pulling on threads</li>
				<li>Combining tunnels and threads</li>
			</ul>
			<p>In this chapter, we will explore the various ways of using tunnels and threads to make more complex projects. We have already explored multiple levels of choices and their outcomes to create a subdivided story. Instead of diverting to one knot or stitch after another, we will learn how to integrate tunnels as a series of diverts before returning to their original location. We will also look at how knots can be easily combined into one by <em class="italic">threading</em> them together.</p>
			<h1 id="_idParaDest-79"><a id="_idTextAnchor078"/>Technical requirements</h1>
			<p>The examples used in this chapter, in the <code>*.ink</code> files, can be found on GitHub at <a href="https://github.com/PacktPublishing/Dynamic-Story-Scripting-with-the-ink-Scripting-Language/tree/main/Chapter5">https://github.com/PacktPublishing/Dynamic-Story-Scripting-with-the-ink-Scripting-Language/tree/main/Chapter5</a>.</p>
			<h1 id="_idParaDest-80"><a id="_idTextAnchor079"/>Diverting to a divert</h1>
			<p>In <a href="B17597_02_Final_PG_ePub.xhtml#_idTextAnchor031"><em class="italic">Chapter 2</em></a>, <em class="italic">Knots, Diverts, and Looping Patterns</em>, the concept of a divert was introduced <a id="_idIndexMarker175"/>alongside story sections called knots. Using diverts and knots, looping structures were created and other ink concepts were also revealed as alternatives (please refer to <a href="B17597_03_Final_PG_ePub.xhtml#_idTextAnchor048"><em class="italic">Chapter 3</em></a>, <em class="italic">Sequences, Cycles, and Shuffling Text</em>). The use of functions and passing values to knots were covered in <a href="B17597_04_Final_PG_ePub.xhtml#_idTextAnchor062"><em class="italic">Chapter 4</em></a>, <em class="italic">Variables, Lists, and Functions</em>. This section builds on those concepts by explaining how diverts can be used to create more advanced stories. </p>
			<p>In <a href="B17597_02_Final_PG_ePub.xhtml#_idTextAnchor031"><em class="italic">Chapter 2</em></a>, <em class="italic">Knots, Diverts, and Looping Patterns</em>, diverts appeared according to the following pattern:</p>
			<p class="SC---Link" lang="en-US" xml:lang="en-US">Example 1:</p>
			<pre>For the reader, &lt;&gt;
-&gt; next_part
== next_part
this appears as one line.
-&gt; DONE</pre>
			<div><div><img src="img/Figure_5.1_B17597.jpg" alt="Figure 5.1 – Inky's output for Example 1&#13;&#10;" width="505" height="100"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.1 – Inky's output for Example 1</p>
			<p>A divert can also be used multiple times. In ink, this is known as the concept of a <strong class="bold">tunnel</strong>. The flow will move to a knot and then back to its original position. From the reader's perspective, the flow <em class="italic">tunnels</em> from one section to another. Tunnels are an incredibly useful concept in ink where looping structures are common.</p>
			<p>In this topic, we will review how to make and use tunnels. Instead of needing to specify each location of a divert within a knot or a stitch, a tunnel allows an author to move the flow of a story through a series of sections and then back again when the tunnel finally<a id="_idIndexMarker176"/> ends.</p>
			<h2 id="_idParaDest-81"><a id="_idTextAnchor080"/>Making tunnels</h2>
			<p>Tunnels are <a id="_idIndexMarker177"/>created in ink by using a divert, <code>-&gt;</code>, the name of a knot or stitch, and then another divert, <code>-&gt;</code>. This signals to ink that the flow will move to the knot and then back again. In the destination knot, two diverts are then used together: <code>-&gt;-&gt;</code>. This creates the <em class="italic">tunneling</em> effect of the flow moving to the knot and then moving back again:</p>
			<p class="SC---Link" lang="en-US" xml:lang="en-US">Example 2:</p>
			<pre>For the reader, &lt;&gt;
-&gt; next_part -&gt;
&lt;&gt; as one line
== next_part
this appears
-&gt;-&gt;</pre>
			<p><em class="italic">Example 2</em> can appear confusing if you don't remember how the flow works in ink. A divert moves the flow to a destination in the story. In <em class="italic">Example 2</em>, the flow starts with the text of <code>For the reader, &lt;&gt;</code>. Then, this is diverted to the <code>next_part</code> knot. The start of the tunnel begins with the code of <code>-&gt; next_part -&gt;</code>, continues into the <code>next_part</code> knot, and then returns with the use of two diverts, <code>-&gt;-&gt;</code>. For a reader who only sees the output, it will appear as a complete sentence:</p>
			<div><div><img src="img/Figure_5.2_B17597.jpg" alt="Figure 5.2 – Inky's output from Example 2&#13;&#10;" width="497" height="90"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.2 – Inky's output from Example 2</p>
			<p class="callout-heading">Reminder</p>
			<p class="callout"><em class="italic">Chapter 1, Text, Flow, Choices, and Weaves</em>, introduced the concept of glue and the use of the less-than and greater-than symbols together. This concept <em class="italic">glues</em> one line to the end of the previous. In <em class="italic">Example 2</em>, glue is used before the start of the tunnel and then after it ends to create the complete sentence from the knot in the story.</p>
			<p>Tunnels can connect any two points within a story. In <em class="italic">Example 2</em>, the tunnel started, moved to a knot, and then returned. Another use of a tunnel might be to create a series of story events for a player to view. You can do this by creating a tunnel from one knot to the next<a id="_idIndexMarker178"/> until the end of the story:</p>
			<p class="SC---Link" lang="en-US" xml:lang="en-US">Example 3:</p>
			<pre>You lift the body onto your back and then carry it over to the edge of the hole before dropping it again. You watch it hit the ground with a pleasant thump. It is dirty work, gravedigging is (you laugh at your own joke as you brush some dirt off your hands and onto your already dirty pants), but it pays the bills.
-&gt; past -&gt; present -&gt; future -&gt; DONE
== past
You did not want to be a gravedigger at first. Who does? No, you stumbled into it as many people do. You needed the money and dead people were dead as far as you were concerned. Dig a hole, put the body in, cover the hole. Easy work. Easy money.
-&gt;-&gt;
== present
You shake your head and then kick the body so that it plops into the grave. Another sound you did not expect to like when you started so many years ago, but you take little joys where you can. Life is funny that way.
-&gt;-&gt;
== future
"There's no future in the dead," your wife had said. But she is dead now, too. And what did she know? Other than dirt! (You laugh at another of your jokes.)
You pick up the shovel.
One load of dirt after another.
It is a living. Or a dying! (You laugh again to yourself as you continue.)
-&gt;-&gt;</pre>
			<p>In <em class="italic">Example 3</em>, the <a id="_idIndexMarker179"/>three different knots (that is, <code>past</code>, <code>present</code>, and <code>future</code>) are all part of one long tunnel. The first connects to the <code>past</code> knot, the <code>past</code> knot is then connected to the <code>present</code> knot, the <code>present</code> knot is connected to the <code>future</code> knot, and, finally, the <code>future</code> knot is connected to the <code>DONE</code> knot to end the flow and the story. In each of these cases, the use of the two diverts, <code>-&gt;-&gt;</code>, points back to where the tunnel started before it continues to the next knot in the longer series. As with <em class="italic">Example 2</em> and its complete sentence, the resulting output from <em class="italic">Example 3</em> is one single flow through the sections to create a complete narrative experience for the reader. </p>
			<h2 id="_idParaDest-82"><a id="_idTextAnchor081"/>Tunneling to tunnels</h2>
			<p><em class="italic">Example 3</em> pointed<a id="_idIndexMarker180"/> towards a great use of tunnels: they can connect to other tunnels! It is possible to tunnel into a tunnel in ink. While linear patterns such as the one used in <em class="italic">Example 3</em> are common, advanced patterns reuse tunnels as part of larger, looping structures. Because knots that use two diverts will always return to where they started, it is possible to use knots to perform small calculations or to check values before continuing the repeating pattern:</p>
			<p class="SC---Link" lang="en-US" xml:lang="en-US">Example 4:</p>
			<pre>VAR playful = 0
VAR anger = 0
On your daily walk, you decide to sit for a few minutes on a nearby bench. You close your eyes to take in the evening sun.
Suddenly, you hear a small sound and look down. A kitten is circling your legs.
-&gt; kitten
== kitten
-&gt; check_kitten -&gt;
+ [Scratch the kitten on its head]
    You pet the kitten on its head.
    -&gt; scratch_head -&gt; kitten
+ [Scratch the kitten on its side]
    You pet the kitten on its side.
    -&gt; scratch_side -&gt; kitten
== scratch_head
~ playful = playful + 1
-&gt;-&gt;
== scratch_side
~ anger = anger + 1
-&gt;-&gt;
== check_kitten
{anger &gt;= 2: The kitten seems angry and walks away. -&gt; DONE}
{playful &gt;= 2: One moment, you were scratching the kitten and the next your hand has some small cuts on it. You decide to leave the kitten alone. -&gt; DONE}
-&gt;-&gt;</pre>
			<p><em class="italic">Example 4</em> demonstrates a more complex pattern using knots, variables, and tunnels. For each loop of the <code>kitten</code> knot, a tunnel is created for the <code>check_kitten</code> knot, which then returns to <code>kitten</code> again. In the <code>check_kitten</code> knot, two checks are made. The first check is to make sure the value of the <code>anger</code> variable is greater than or equal to <code>2</code>. If it is, the<a id="_idIndexMarker181"/> sentence is shown and then the story diverts to <code>DONE</code>. The second check is to make sure the <code>playful</code> variable is greater than or equal to <code>2</code>. If this second check is true, a different sentence is shown, and the story diverts to <code>DONE</code>. Inside the weave created by the two sticky choices, each option, either <code>scratch_head</code> or <code>scratch_side</code>. Inside each, the knots associated with the player's actions increase the value of the variable.</p>
			<p><em class="italic">Example 4</em> uses multiple tunnels to create a complex pattern. However, there is another concept in ink that would make the same code easier to understand: <strong class="bold">threads</strong>. As we will discuss in the next section, threads allow us to easily pull in knots without needing to divert to them first.</p>
			<h1 id="_idParaDest-83"><a id="_idTextAnchor082"/>Pulling on threads</h1>
			<p>Diverts were<a id="_idIndexMarker182"/> introduced as <em class="italic">pointing</em> to their destination. To create a tunnel, a hyphen and a greater-than symbol were combined, <code>-&gt;</code>, on either side of the name of the knot or stitch. However, diverts can <em class="italic">point</em> inward as well. When a divert is created with a less-than symbol and a hyphen, <code>&lt;-</code>, it becomes a different concept called a <strong class="bold">thread</strong>. Instead of moving the flow to the destination, ink <em class="italic">threads</em> the destination's text or code into another location.</p>
			<p>In this section, we will work with threads to collapse more complex weaves into simpler structures. Instead of multiple levels of choices and their text outcomes, we will use threads to achieve the same result in a more efficient way.</p>
			<h2 id="_idParaDest-84"><a id="_idTextAnchor083"/>Making threads</h2>
			<p>Often, threads are<a id="_idIndexMarker183"/> considered to be an inverse of diverts. Instead of the flow moving to the section of the story, the section of the story moves to the current position of the flow. Returning to the code from <em class="italic">Example 4</em>, threads can be used in multiple places to achieve the same result:</p>
			<p class="SC---Link" lang="en-US" xml:lang="en-US">Example 5:</p>
			<pre>VAR playful = 0
VAR anger = 0
On your daily walk, you decide to sit for a few minutes on a nearby bench. You close your eyes to take in the evening sun.
Suddenly, you hear a small sound and look down. A kitten is circling your legs.
-&gt; kitten
== kitten
&lt;- check_kitten
+ [Scratch the kitten on its head]
    You pet the kitten on its head.
    &lt;- scratch head 
    -&gt; kitten
+ [Scratch kitten on its side]
    You pet the kitten on its side.
    &lt;- scratch_side 
    -&gt; kitten
== scratch_head
~ playful = playful + 1
== scratch_side
~ anger = anger + 1
== check_kitten
{anger &gt;= 2: The kitten seems angry and walks away. -&gt; DONE}
{playful &gt;= 2: One moment, you were scratching the kitten and the next your hand has some small cuts on it. You decide to leave the kitten alone. -&gt; DONE}</pre>
			<p>In <em class="italic">Example 5</em>, threads <a id="_idIndexMarker184"/>are used in place of the previous tunnels in <em class="italic">Example 4</em>. The <code>scratch_head</code> and <code>scratch_side</code> knots are now <em class="italic">threaded</em> into the code of the <code>kitten</code> knot. This is also true for <code>check_kitten</code>. Instead of creating multiple tunnels, threads are often used to collapse an increasingly complex structure into sections that can be <em class="italic">threaded</em> together.</p>
			<p class="callout-heading">Warning</p>
			<p class="callout">Sometimes, the use of complex tunnel and thread structures can confuse Inky. Always double-check all of the code when using these more advanced concepts!</p>
			<h2 id="_idParaDest-85"><a id="_idTextAnchor084"/>Using multiple threads</h2>
			<p>Each use of a<a id="_idIndexMarker185"/> thread must be on its own line. The reason why they cannot be combined is that ink moves the section of the story up to the location of the current flow. A second thread cannot have its content moved to the previous location. It no longer exists! However, threads, like diverts, can also be elements within a set or alternative. Just as a different form of a divert can be <em class="italic">pointing</em> inward, threads can be used with a shuffle on a single line:</p>
			<p class="SC---Link" lang="en-US" xml:lang="en-US">Example 6:</p>
			<pre>"Hey! Jesse!" you shout, trying to get her attention. Hearing your voice, she turns, and you hurry to catch up with her as you jog from the building after your class.
{~ &lt;- question_one|&lt;- question_two}
== question_one
&lt;&gt; "How was your class"? you ask.
== question_two
&lt;&gt; "Are you going to the party tonight?" you ask.</pre>
			<p>In <em class="italic">Example 6</em>, threads are used as elements of a shuffle. Each time the story is run, one of the two threads will be chosen and <em class="italic">threaded</em> into the story, creating a new experience. Combining threads with alternatives in this way is useful when creating <em class="italic">alternative</em> content for a story that is accessed as part of the thread itself.</p>
			<p>A common pattern found in many role-playing video games uses various player statistics to determine what content is available based on testing the value of a variable. If it is within a certain<a id="_idIndexMarker186"/> range, content can then be <em class="italic">threaded</em> into the current weave. This will add additional context for the result of an action for the reader:</p>
			<p class="SC---Link" lang="en-US" xml:lang="en-US">Example 7:</p>
			<pre>VAR strength = 16
VAR intelligence = 16
-&gt; save_or_doom
== save_or_doom
The villain holds the ancient artifact and is moments away from enslaving the world with its limitless power as part of a complex ritual.
* {strength &gt; 15} [Use strength]
    &lt;- use_strength
* {intelligence &gt; 15} [Use intelligence]
    &lt;- use_intelligence
- -&gt; DONE
= use_strength
You throw your hand axe as hard as you can. It strikes the artifact, shattering it into multiple pieces and ending the ritual.
= use_intelligence
You quickly calculate the size of the artifact based on its materials and cast the spell to banish it to another dimension. In a blink of an eye, the ritual ends!</pre>
			<p>Each of the stitches in <em class="italic">Example 7</em> holds additional text. Because the stitches are a part of the <a id="_idIndexMarker187"/>overall <code>save_or_doom</code> knot, they can be used as part of a thread. Subsections of a story are still <em class="italic">sections</em>.</p>
			<p><em class="italic">Example 7</em> also uses conditional options, as covered in <a href="B17597_02_Final_PG_ePub.xhtml#_idTextAnchor031"><em class="italic">Chapter 2</em></a>, <em class="italic">Knots, Diverts, and Looping Patterns</em>, and variables, as discussed in <a href="B17597_04_Final_PG_ePub.xhtml#_idTextAnchor062"><em class="italic">Chapter 4</em></a>, <em class="italic">Variables, Lists, and Functions</em>. By testing for the range of values of the <code>strength</code> and <code>intelligence</code> variables, the <code>15</code>, both options are shown:</p>
			<div><div><img src="img/Figure_5.3_B17597.jpg" alt="Figure 5.3 – Inky's output from Example 7&#13;&#10;" width="977" height="227"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.3 – Inky's output from Example 7</p>
			<p>A single thread can be created using the inverse action of diverting. Instead of moving to a location, the section moves to the current moment in the flow. Additionally, multiple threads can be combined to create a continuous narrative experience for the reader as they are pulled together. When working with threads, there is one more important aspect: the <code>DONE</code> keyword. In the last section of this topic, we will examine how threads can be closed and what this means when you are using threads inside each other.</p>
			<h2 id="_idParaDest-86"><a id="_idTextAnchor085"/>Ending threads</h2>
			<p>The <code>DONE</code> and <code>END</code> keywords <a id="_idIndexMarker188"/>were<a id="_idIndexMarker189"/> introduced in <a href="B17597_02_Final_PG_ePub.xhtml#_idTextAnchor031"><em class="italic">Chapter 2</em></a>, <em class="italic">Knots, Diverts, and Looping Patterns</em>. The<a id="_idIndexMarker190"/> differences between the two keywords were explained in their usage. The <code>END</code> keyword stops the story, and the <code>DONE</code> keyword stops the current flow. When using threads, the flow of a story is also affected. In other words, the <code>DONE</code> keyword closes the <em class="italic">current</em> flow. In many cases, this will be the story itself. When using threads, the keyword closes the thread itself.</p>
			<p>When creating knots in Inky, often, authors will get a warning suggesting the <code>DONE</code> keyword is needed within a knot that does not contain the keyword. When working with threads, this warning clues the author into this important aspect of threads and the <code>DONE</code> keyword:</p>
			<p class="SC---Link" lang="en-US" xml:lang="en-US">Example 8:</p>
			<pre>&lt;- thread_1
&lt;- thread_2
== thread_1
* This is a choice
-&gt; DONE
== thread_2
* This is another choice
-&gt; DONE</pre>
			<p><em class="italic">Example 8</em> uses two instances of the <code>DONE</code> keyword. This might seem strange, but each use of the keyword closes its own thread. When run within Inky, the two choices, each within a separate thread, will be combined:</p>
			<div><div><img src="img/Figure_5.4_B17597.jpg" alt="Figure 5.4 – The combined thread output for Example 8&#13;&#10;" width="558" height="193"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.4 – The combined thread output for Example 8</p>
			<p>In <em class="italic">Example 8</em>, the separate uses of the <code>DONE</code> keyword do not interact with each other. Each thread is <a id="_idIndexMarker191"/>contained within itself. This becomes evident when trying to move the inclusion of the second thread inside the first after the <code>DONE</code> keyword:</p>
			<p class="SC---Link" lang="en-US" xml:lang="en-US">Example 9:</p>
			<pre>&lt;- thread_1
== thread_1
* This is a choice
-&gt; DONE
&lt;- thread_2
== thread_2
* This is another choice
-&gt; DONE</pre>
			<p>In <em class="italic">Example 9</em>, the second thread comes after the use of the <code>DONE</code> keyword. Unlike <em class="italic">Example 8</em>, where both choices will be combined into a single weave, the story will end before the second thread occurs:</p>
			<div><div><img src="img/Figure_5.5_B17597.jpg" alt="Figure 5.5 – Thread closing in Example 9&#13;&#10;" width="390" height="69"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.5 – Thread closing in Example 9</p>
			<p><em class="italic">Example 9</em> demonstrates the interaction between the <code>DONE</code> keyword and the threads. The <code>DONE</code> keyword closes the current flow. In <em class="italic">Example 9</em>, the second thread inside the first is never reached because it is closed using the <code>DONE</code> keyword.</p>
			<p>Threads and tunnels are not separate concepts, but two different ways in which to achieve similar results based on the needs of the author. In the next topic, we will look at various ways of combining both concepts to create even more complex stories. We will use<a id="_idIndexMarker192"/> tunnels to move to a location in a story and examine how threads can be repeated instead of writing more code.</p>
			<h1 id="_idParaDest-87"><a id="_idTextAnchor086"/>Combining tunnels and threads</h1>
			<p>Tunnels <a id="_idIndexMarker193"/>allow<a id="_idIndexMarker194"/> the flow of a story to move to a knot or a stitch and then return. Threads act as the inverse, moving the content from the knot or the stitch to the current flow position. Together, they form a powerful way in which to craft a story composed of different parts. Often, in advanced projects, these two concepts are paired together with weaves and gathering points to expand or contract the number of possible branches.</p>
			<p>Tunnels can be reused, and threads can be repeated. In this topic, we will explore how threads and tunnels can be combined to create more complex stories using less overall code.</p>
			<h2 id="_idParaDest-88"><a id="_idTextAnchor087"/>Reusing tunnels and repeating threads</h2>
			<p><em class="italic">Example 4</em> used <a id="_idIndexMarker195"/>multiple<a id="_idIndexMarker196"/> tunnels, and <em class="italic">Example 5</em> showed the same result using multiple threads. It is also possible to combine multiple tunnels and threads by breaking up content into stitches as part of multiple knots for each part of a story. For example, many role-playing video games start by presenting dialogue from a character. Then, they provide the player with the illusion of control by letting them choose between various options before, finally, looping back to the same options until the player makes a certain selection to continue:</p>
			<p class="SC---Link" lang="en-US" xml:lang="en-US">Example 10:</p>
			<pre>VAR has_rake = false
-&gt; tutorial
== tutorial
= awake
You feel a hand on your shoulder and wake up to a young woman frowning down at you.
Jane: "I see you are finally awake! I wish you would stop sleeping under this tree instead of working."
Jane: "Uncle John is going to catch you one of these days and then you will be in trouble."
Jane: "Do you remember what you need to do today?"
* [What was it again?]
    &lt;- tasks
* [I remember.]
    &lt;- remember
- -&gt; rake -&gt;
-&gt; old_shrine
= tasks
Jane: "In case you forgot, you need to clean up all the leaves around the old shrine."
Jane: "And don't forget to take your rake!"
= remember
Jane: "Good! Get out to that old shrine and finish your cleaning!"
= rake
+ [Pick up rake]
    ~ has_rake = true
+ [Skip the rake]
    ~ has_rake = false
- -&gt;-&gt;
== old_shrine
{has_rake == false: You realize you do not have your rake.}
+ {has_rake == false} [Retrieve rake]
    -&gt; tutorial.rake -&gt;
    {has_rake == false: -&gt; old_shrine}
- You begin to rake the leaves around the old shrine.
-&gt; DONE</pre>
			<p><em class="italic">Example 10</em> reuses <a id="_idIndexMarker197"/>a tunnel. The<a id="_idIndexMarker198"/> first instance occurs when the reader selects between the <code>old_shrine</code> knot and does not have the rake (that is, if <code>has_rake</code> is equal to <code>false</code>), they are prompted with the <strong class="bold">Retrieve rake</strong> option and the second possible instance of the tunnel.</p>
			<p>Threads are used in <em class="italic">Example 10</em> to break up the text of the responses from the character. This creates a simplified weave with the text split into its stitches. For authors, this pattern allows them to change or add to the response text without needing to worry about the code portion of the weave.</p>
			<p>Finally, gathering points (as discussed in <a href="B17597_01_Final_PG_ePub.xhtml#_idTextAnchor014"><em class="italic">Chapter 1</em></a>, <em class="italic">Text, Flow, Choices, and Weaves</em>) are used three times. The first one collapses the possible branches of the first weave and creates the first instance of a tunnel. The second occurs as part of the <code>rake</code> stitch. This gathering point is the end of both instances of tunnels and collapses the result of either option: <code>has_rake</code> is equal to <code>true</code>), the <strong class="bold">Retrieve rake</strong> option no longer appears, and the story ends with the character raking the leaves at the old shrine.</p>
			<p><code>"This is an example," Dan wrote</code>. However, in <em class="italic">Example 8</em>, the name of the character appears before the dialogue to signal who is saying the words. <a href="B17597_10_Final_PG_ePub.xhtml#_idTextAnchor145"><em class="italic">Chapter 10</em></a>, <em class="italic">Dialogue Systems with ink</em>, will revisit the use of tags and examine some approaches<a id="_idIndexMarker200"/> for <a id="_idIndexMarker201"/>writing and tagging dialogue appearing in a video game.</p>
			<h2 id="_idParaDest-89"><a id="_idTextAnchor088"/>Threads with tunnels</h2>
			<p>Threads<a id="_idIndexMarker202"/> move <a id="_idIndexMarker203"/>a section of a story to the current flow position when moving through the in-memory version of the code. Internally, this does not change their actual location in the larger story code but their connection to the current version of the flow as the story is run. This means it is possible to include a tunnel inside a thread. In these scenarios, the flow would <em class="italic">thread</em> the knot or stitch and then move to another section and back again:</p>
			<p class="SC---Link" lang="en-US" xml:lang="en-US">Example 11:</p>
			<pre>&lt;- knot_example.stitch_one
&lt;- knot_example.stitch_two
== knot_example
= stitch_one
-&gt; tunnel -&gt;
= stitch_two
-&gt; tunnel -&gt;
== tunnel
This is a tunnel inside a thread!
-&gt;-&gt;</pre>
			<p><em class="italic">Example 11</em> demonstrates the basic pattern of using tunnels inside threads. This is safe to do in ink because of the way the flow <em class="italic">threads</em> through the knots or stitches. A more complicated usage might be part of a dialogue system for a video game, where data is passed to knots to perform different small calculations as part of the reaction to a player following<a id="_idIndexMarker204"/> certain <a id="_idIndexMarker205"/>branches of a conversation:</p>
			<p class="SC---Link" lang="en-US" xml:lang="en-US">Example 12:</p>
			<pre>VAR reputation = 10
-&gt; villager_1
== villager_1
Villager: Heroes! You have returned from fighting the monsters in the forest! Did you find any sign of my husband? He has been missing for several days.
+ \(Lie\) We have not found him yet.
    &lt;- adjust_reputation(-10)
+ We found what was left of him. I'm sorry to report he is 
  dead.
    &lt;- adjust_reputation(10)
+ I used his leg to fight off some spiders! Oh. Right... 
  he's, you know, dead.
    &lt;- adjust_reputation(-15)
- -&gt; DONE
== adjust_reputation(amount)
~ reputation = reputation + amount
-&gt; report_reputation -&gt;
== report_reputation
Current reputation: {reputation}</pre>
			<p><em class="italic">Example 12</em> is a more practical example of the pattern introduced in <em class="italic">Example 1</em>. It uses a thread to pass data to a knot as if it was a function. Additionally, <em class="italic">Example 12</em> uses a tunnel inside the <code>adjust_reputation</code> knot as a connection to the <code>report_reputation</code> knot. For each choice, the value of the <code>reputation</code> variable will be changed after a reader makes the selection. The new value of <code>reputation</code> will be shown as a result.</p>
			<p class="callout-heading">Note</p>
			<p class="callout"><em class="italic">Example 12</em> uses a backslash, <code>\</code>, with opening, <code>(</code>, and closing, <code>)</code>, parentheses. These <em class="italic">escape</em> the use<a id="_idIndexMarker206"/> of the parentheses instead of creating an optional<a id="_idIndexMarker207"/> label. </p>
			<h1 id="_idParaDest-90"><a id="_idTextAnchor089"/>Summary</h1>
			<p>In this chapter, we learned even more about how diverts work with knots and stitches in ink. We explored how the concept of a tunnel connects two different sections in ink. When a story runs, the flow moves to the knot or the stitch and then returns with the use of two diverts, <code>-&gt;-&gt;</code>. We also reviewed how tunnels can be used as part of a more complicated flow pattern of a longer series of connections between two sections. Next, we saw how threads, another concept in ink, act as the inverse of a divert, where a section is moved to the current flow location instead of the flow moving to its content. Finally, we examined some patterns of using tunnels inside threads to pass data to a knot and show the changed values of a variable. </p>
			<p>Threads and tunnels, while more advanced concepts, create simpler overall code. Threads allow developers to separate code into different sections and then <em class="italic">thread</em> them back together again. Tunnels allow developers to achieve the same general result as threads but in a different way. Instead of pulling content together, a tunnel moves to a knot or a stitch and then back again, <em class="italic">tunneling</em> through a story to a location and then back again. Threads and tunnels have their specific usages, but both allow a developer to create more complex projects by using their different sections more efficiently.</p>
			<p>In the next chapter, we move on to use the ink-Unity Integration plugin. While Inky has been used to show the ink code output, the ink-Unity Integration plugin will allow us to have far more control over how an ink story runs. In the coming chapters, we will also learn how to use C# and the ink API to make selections, change the value of variables, and even access functions in ink code.</p>
			<h1 id="_idParaDest-91"><a id="_idTextAnchor090"/>Questions</h1>
			<ol>
				<li>To return from a tunnel in a knot or a stitch, which ink concept must be used twice?</li>
				<li>How do tunnels work in ink?</li>
				<li>How are threads different from diverts and tunnels?</li>
				<li>Can multiple threads be used on the same line?</li>
			</ol>
		</div>
	</div></body></html>