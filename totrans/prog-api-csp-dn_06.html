<html><head></head><body>
  <div id="_idContainer066">
   <h1 class="chapter-number" id="_idParaDest-77">
    <a id="_idTextAnchor077">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     6
    </span>
   </h1>
   <h1 id="_idParaDest-78">
    <a id="_idTextAnchor078">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Azure Functions
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.3.1">
     Determining the execution environment of your APIs can have a large impact on how they run, how they scale, how much they cost, and what features come out of the box.
    </span>
    <span class="koboSpan" id="kobo.3.2">
     Azure Functions provides a different hosting option that complements existing Azure services with a focus on event-driven execution.
    </span>
    <span class="koboSpan" id="kobo.3.3">
     While Functions provides many ways to react to different things in a system, we’ll focus on a specific event: the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.4.1">
      HTTP request.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.5.1">
     In this chapter, we’ll cover some technical aspects related to hosting and billing and finish with a walkthrough that includes cloud deployment
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.6.1">
      and configuration.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.7.1">
     By the end of this chapter, you’ll have a good base to continue your API journey by knowing about the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.8.1">
      following aspects:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.9.1">
      Hosting considerations that affect certain runtime options and limitations based on the needs of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.10.1">
       your application.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.11.1">
      How certain aspects of your application can
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.12.1">
       affect billing.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.13.1">
      The structure, general familiarity, and possibilities of code design related specifically to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.14.1">
       HTTP APIs.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.15.1">
      Deploying to Azure from Visual Studio.
     </span>
     <span class="koboSpan" id="kobo.15.2">
      Automated builds, continuous integration, and continuous delivery will be covered later in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.16.1">
       this book.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.17.1">
      Making runtime configuration changes
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.18.1">
       without redeployment.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.19.1">
      How to adjust scaling settings to reduce the potential cost of a public endpoint, colloquially known as a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.20.1">
       Denial-of-Wallet attack.
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-79">
    <a id="_idTextAnchor079">
    </a>
    <span class="koboSpan" id="kobo.21.1">
     Technical requirements
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.22.1">
     To build Azure Functions in Visual Studio, you’ll need the Azure development workload available in Visual Studio Installer.
    </span>
    <span class="koboSpan" id="kobo.22.2">
     The source code for this chapter is available
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.23.1">
      at
     </span>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.24.1">
      https://github.com/PacktPublishing/Programming-APIs-with-C-Sharp-and-.NET/tree/main/Chapter06
     </span>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.25.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-80">
    <a id="_idTextAnchor080">
    </a>
    <span class="koboSpan" id="kobo.26.1">
     Understanding Functions
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.27.1">
     Azure Functions
    </span>
    <a id="_idIndexMarker116">
    </a>
    <span class="koboSpan" id="kobo.28.1">
     fills a large role in execution environments while focusing on event-based data processing.
    </span>
    <span class="koboSpan" id="kobo.28.2">
     Traditionally, those environments have a lot of overhead in terms of hardware or
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.29.1">
      virtual machines
     </span>
    </strong>
    <span class="koboSpan" id="kobo.30.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.31.1">
      VMs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.32.1">
     ) and
    </span>
    <a id="_idIndexMarker117">
    </a>
    <span class="koboSpan" id="kobo.33.1">
     boilerplate code.
    </span>
    <span class="koboSpan" id="kobo.33.2">
     Functions is Microsoft’s execution environment to allow ease of development, deployment, and scaling.
    </span>
    <span class="koboSpan" id="kobo.33.3">
     While a few types of underlying execution environments are available, it defaults to consumption, which brings a set of defaults that are well suited to a large variety of different data processing scenarios and are billed per event execution.
    </span>
    <span class="koboSpan" id="kobo.33.4">
     If you need more CPU cores or memory, other environments are available; these will be covered later in this chapter.
    </span>
    <span class="koboSpan" id="kobo.33.5">
     While all execution environments in Functions are considered serverless in the sense that you don’t have to manage individual instances, other non-consumption environments are not pay-per-use and instead are charged based on the amount of CPU cores and memory allocated to each instance.
    </span>
    <span class="koboSpan" id="kobo.33.6">
     C# is the predominant language that’s used, although a variety of languages and bindings
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.34.1">
      are supported.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.35.1">
     The main entry points for the execution of these applications are triggers.
    </span>
    <span class="koboSpan" id="kobo.35.2">
     A variety of these triggers exist to react to external events.
    </span>
    <span class="koboSpan" id="kobo.35.3">
     From queue polling to ServiceBus pushing, reacting to blob, or database record changes, many ready-to-go bindings allow you to mix and match your solution.
    </span>
    <span class="koboSpan" id="kobo.35.4">
     For APIs, the triggers we care most about are
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.36.1">
      HTTP triggers.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.37.1">
     HTTP triggers are exactly what they
    </span>
    <a id="_idIndexMarker118">
    </a>
    <a id="_idIndexMarker119">
    </a>
    <span class="koboSpan" id="kobo.38.1">
     sound like: a request-response to a normal API request.
    </span>
    <span class="koboSpan" id="kobo.38.2">
     These requests can come from all the usual suspects: browsers, webhooks, service-to-service calls, and so on.
    </span>
    <span class="koboSpan" id="kobo.38.3">
     They can be routed to individual functions using the built-in routing template support.
    </span>
    <span class="koboSpan" id="kobo.38.4">
     Incoming data from these routes can be automatically matched to the specified data types, deserialized,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.39.1">
      and bound.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.40.1">
     Built-in authorization is either none or API key-based, with the latter available in two flavors: function-specific or a single global application key.
    </span>
    <span class="koboSpan" id="kobo.40.2">
     Other standard authorization can be implemented with Entra ID, manually in code,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.41.1">
      or both.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.42.1">
     Hosting should also be considered since your application will need to run somewhere – likely, though not necessarily, in the cloud.
    </span>
    <span class="koboSpan" id="kobo.42.2">
     Various hosting and packaging options are provided, allowing you to tailor deployment to accommodate your application’s needs.
    </span>
    <span class="koboSpan" id="kobo.42.3">
     ZIP files, Docker, plain file copy (xcopy), and on-premises are all available.
    </span>
    <span class="koboSpan" id="kobo.42.4">
     AMD64 Windows and Linux are
    </span>
    <a id="_idIndexMarker120">
    </a>
    <span class="koboSpan" id="kobo.43.1">
     supported on Azure, while ARM64 is supported in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.44.1">
      other scenarios.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.45.1">
     At this point, you should have a good understanding of the environment in which Azure Functions operates and what’s available
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.46.1">
      to you.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-81">
    <a id="_idTextAnchor081">
    </a>
    <span class="koboSpan" id="kobo.47.1">
     Hosting
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.48.1">
     There are a variety of hosting
    </span>
    <a id="_idIndexMarker121">
    </a>
    <span class="koboSpan" id="kobo.49.1">
     options available to suit practically any need.
    </span>
    <span class="koboSpan" id="kobo.49.2">
     Each has its pros and cons.
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.50.1">
      Consumption
     </span>
    </strong>
    <span class="koboSpan" id="kobo.51.1">
     is the default and will be used in this
    </span>
    <a id="_idIndexMarker122">
    </a>
    <span class="koboSpan" id="kobo.52.1">
     chapter.
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.53.1">
      Flex Consumption
     </span>
    </strong>
    <span class="koboSpan" id="kobo.54.1">
     (in preview at the time of
    </span>
    <a id="_idIndexMarker123">
    </a>
    <span class="koboSpan" id="kobo.55.1">
     writing),
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.56.1">
      Premium
     </span>
    </strong>
    <span class="koboSpan" id="kobo.57.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.58.1">
      Application Service Environment
     </span>
    </strong>
    <span class="koboSpan" id="kobo.59.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.60.1">
      ASE
     </span>
    </strong>
    <span class="koboSpan" id="kobo.61.1">
     ), and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.62.1">
      Kubernetes
     </span>
    </strong>
    <span class="koboSpan" id="kobo.63.1">
     are additional supported offerings that won’t
    </span>
    <a id="_idIndexMarker124">
    </a>
    <span class="koboSpan" id="kobo.64.1">
     be discussed in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.65.1">
      this
     </span>
    </span>
    <span class="No-Break">
     <a id="_idIndexMarker125">
     </a>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.66.1">
      book.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.67.1">
     Although powerful, Consumption comes with several limitations.
    </span>
    <span class="koboSpan" id="kobo.67.2">
     First, the instance memory is limited to 1.5 GB, which can put a hard limit on the types of applications that can be run directly inside this Functions option.
    </span>
    <span class="koboSpan" id="kobo.67.3">
     The second is that the instance only has a single core.
    </span>
    <span class="koboSpan" id="kobo.67.4">
     The third is timeout.
    </span>
    <span class="koboSpan" id="kobo.67.5">
     Azure only allows a timeout limit of 5 to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.68.1">
      10 minutes.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.69.1">
     However, many workloads do fit
    </span>
    <a id="_idIndexMarker126">
    </a>
    <span class="koboSpan" id="kobo.70.1">
     well within these constraints.
    </span>
    <span class="koboSpan" id="kobo.70.2">
     From standard
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.71.1">
      Software-as-a-Service
     </span>
    </strong>
    <span class="koboSpan" id="kobo.72.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.73.1">
      SaaS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.74.1">
     ), APIs, and periodic updates to CRUD and Durable Functions-related calls (explained in the next chapter), the potential is there for the vast majority of these to fit well within
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.75.1">
      the limits.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.76.1">
     Needing more compute resources can be common in artificial intelligence workloads, for example.
    </span>
    <span class="koboSpan" id="kobo.76.2">
     While Consumption is conceptually easy to think about, Premium is the next step up.
    </span>
    <span class="koboSpan" id="kobo.76.3">
     You’re billed for individual CPU vCores and GBs of memory allocated together in classic VM form.
    </span>
    <span class="koboSpan" id="kobo.76.4">
     Managing these VMs is completely delegated to Azure.
    </span>
    <span class="koboSpan" id="kobo.76.5">
     You set the maximum (and/or minimum) of the number of instances that the application can scale out to, and Azure handles the rest.
    </span>
    <span class="koboSpan" id="kobo.76.6">
     The current limitations are 4 vCores and 14 GB of memory per host.
    </span>
    <span class="koboSpan" id="kobo.76.7">
     Windows allows up to 100 hosts, and Linux between 20 and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.77.1">
      100 hosts.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-82">
    <a id="_idTextAnchor082">
    </a>
    <span class="koboSpan" id="kobo.78.1">
     Application packaging
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.79.1">
     There are a few application packaging
    </span>
    <a id="_idIndexMarker127">
    </a>
    <span class="koboSpan" id="kobo.80.1">
     and deployment options available as well, depending on what size of resource you require.
    </span>
    <span class="koboSpan" id="kobo.80.2">
     Docker is supported on Premium and App Service, allowing you to control the runtime environment with precision.
    </span>
    <span class="koboSpan" id="kobo.80.3">
     ZIP files (published archives containing your entire application) are supported for all runtimes and required
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.81.1">
      with Consumption.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.82.1">
     History
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.83.1">
     Note that most of the runtime hosting modes, while they may still be available, are now considered deprecated.
    </span>
    <span class="koboSpan" id="kobo.83.2">
     Originally, compiled functions were loaded inside the same physical operating system process that the function host was running in.
    </span>
    <span class="koboSpan" id="kobo.83.3">
     This “in-proc” model allowed direct function calling between the host and custom functions but introduced potential issues with library dependencies and language updates.
    </span>
    <span class="koboSpan" id="kobo.83.4">
     Hard dependencies on specific library versions couldn’t be changed, and new C# language versions couldn’t be used if they were incompatible with the existing runtime.
    </span>
    <span class="koboSpan" id="kobo.83.5">
     Assembly loading quirks were also common, with varying success
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.84.1">
      in workarounds.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.85.1">
     Azure Functions initially launched with an Azure-based browser editor, and although it was serverless, the model had room for improvement.
    </span>
    <span class="koboSpan" id="kobo.85.2">
     Later, a new version allowed standard .NET assemblies to be compiled so that the function host, starting the physical operating system process, would load.
    </span>
    <span class="koboSpan" id="kobo.85.3">
     This introduced dependency resolution conflicts and required pinning functions to the same runtime version as the host, highlighting the need for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.86.1">
      further solutions.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.87.1">
     Today, with out-of-process hosting, the majority of the aforementioned problems go away.
    </span>
    <span class="koboSpan" id="kobo.87.2">
     Your function application runs in its own operating system process, managing its own startup, dependency injection, language, and .NET version.
    </span>
    <span class="koboSpan" id="kobo.87.3">
     Communication is handled through an internal channel between the host application and your function application.
    </span>
    <span class="koboSpan" id="kobo.87.4">
     This is the recommended way forward for .NET 6 and .NET
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.88.1">
      8 functions.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.89.1">
     Though historical context is worth knowing for completeness, the defaults guide you through the recommended experience out of the box.
    </span>
    <span class="koboSpan" id="kobo.89.2">
     So, how does the Consumption plan measure the usage of your API?
    </span>
    <span class="koboSpan" id="kobo.89.3">
     Let’s take
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.90.1">
      a look.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-83">
    <a id="_idTextAnchor083">
    </a>
    <span class="koboSpan" id="kobo.91.1">
     Billing
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.92.1">
     The billing model for
    </span>
    <a id="_idIndexMarker128">
    </a>
    <span class="koboSpan" id="kobo.93.1">
     Consumption is a new metric that you may not be familiar with unless you’ve dealt with cloud cost estimation before.
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.94.1">
      Gigabytes per second
     </span>
    </strong>
    <span class="koboSpan" id="kobo.95.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.96.1">
      GB/s
     </span>
    </strong>
    <span class="koboSpan" id="kobo.97.1">
     ) is
    </span>
    <a id="_idIndexMarker129">
    </a>
    <span class="koboSpan" id="kobo.98.1">
     the measure that’s used in Consumption to accurately bill for applications and is the first part of the billing process.
    </span>
    <span class="koboSpan" id="kobo.98.2">
     Whether they’re quick and fast responses or memory-hungry multi-second responses, this style of metric allows it to be reported as a single numeric value.
    </span>
    <span class="koboSpan" id="kobo.98.3">
     For example, a single request that takes 1 second to respond, using 1 GB of memory, would result in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.99.1">
      1*1s*1GB=1GB/s
     </span>
    </strong>
    <span class="koboSpan" id="kobo.100.1">
     for billing.
    </span>
    <span class="koboSpan" id="kobo.100.2">
     As for the inverse, four requests taking 250 milliseconds using the same 1 GB of memory would also equal 1 GB/s:
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.101.1">
      4*250ms*1GB=1GB/s
     </span>
    </strong>
    <span class="koboSpan" id="kobo.102.1">
     .
    </span>
    <span class="koboSpan" id="kobo.102.2">
     At the time of writing, Azure’s free tier grants 400,000 GB/s of free usage per month.
    </span>
    <span class="koboSpan" id="kobo.102.3">
     With each request potentially taking an average of 100ms and using 256 MB of memory, that works out to be 16 million requests.
    </span>
    <span class="koboSpan" id="kobo.102.4">
     The second part of billing is more straightforward: the number of requests.
    </span>
    <span class="koboSpan" id="kobo.102.5">
     Azure grants 1 million requests for free per month, and it’s $0.20 per million requests
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.103.1">
      after that.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-84">
    <a id="_idTextAnchor084">
    </a>
    <span class="koboSpan" id="kobo.104.1">
     Project walkthrough
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.105.1">
     In this section, we’ll begin creating a new Functions project, adding an additional HTTP trigger with an API route, and setting up some configuration that practically all applications
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.106.1">
      will require.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-85">
    <a id="_idTextAnchor085">
    </a>
    <span class="koboSpan" id="kobo.107.1">
     Starting up
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.108.1">
     Creating a new Functions project
    </span>
    <a id="_idIndexMarker130">
    </a>
    <span class="koboSpan" id="kobo.109.1">
     is just like creating any other project.
    </span>
    <span class="koboSpan" id="kobo.109.2">
     There are templates available in Visual Studio’s new project wizard to aid you with this.
    </span>
    <span class="koboSpan" id="kobo.109.3">
     Follow
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.110.1">
      these steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.111.1">
      Select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.112.1">
       Azure Functions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.113.1">
      or search for it using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.114.1">
       functions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.115.1">
      keyword and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.116.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.117.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.118.1">
       :
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer039">
     <span class="koboSpan" id="kobo.119.1">
      <img alt="Figure 6.1 – New project wizard" src="image/B21988_06_01.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.120.1">
     Figure 6.1 – New project wizard
    </span>
   </p>
   <ol>
    <li value="2">
     <span class="koboSpan" id="kobo.121.1">
      Name your
     </span>
     <a id="_idIndexMarker131">
     </a>
     <span class="koboSpan" id="kobo.122.1">
      project and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.123.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.124.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.125.1">
       :
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer040">
     <span class="koboSpan" id="kobo.126.1">
      <img alt="Figure 6.2 – Project configuration" src="image/B21988_06_02.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.127.1">
     Figure 6.2 – Project configuration
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.128.1">
      Select the runtime and
     </span>
     <a id="_idIndexMarker132">
     </a>
     <span class="koboSpan" id="kobo.129.1">
      hosting configuration options.
     </span>
     <span class="koboSpan" id="kobo.129.2">
      Usually, the latest
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.130.1">
       Long Term Support
      </span>
     </strong>
     <span class="koboSpan" id="kobo.131.1">
      option is a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.132.1">
       safe bet:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer041">
     <span class="koboSpan" id="kobo.133.1">
      <img alt="Figure 6.3 – Functions worker configuration" src="image/B21988_06_03.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.134.1">
     Figure 6.3 – Functions worker configuration
    </span>
   </p>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.135.1">
      Select the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.136.1">
       Http trigger
      </span>
     </strong>
     <span class="koboSpan" id="kobo.137.1">
      option, choose
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.138.1">
       Anonymous
      </span>
     </strong>
     <span class="koboSpan" id="kobo.139.1">
      under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.140.1">
       Authorization level
      </span>
     </strong>
     <span class="koboSpan" id="kobo.141.1">
      , and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.142.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.143.1">
        Create
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.144.1">
       .
      </span>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.145.1">
       We’ll cover authentication and authorization later in this book.
      </span>
      <span class="koboSpan" id="kobo.145.2">
       As mentioned earlier, Docker containers are supported, but leave this option unchecked for now.
      </span>
      <span class="koboSpan" id="kobo.145.3">
       Ensure the
      </span>
      <strong class="bold">
       <span class="koboSpan" id="kobo.146.1">
        Azurite
       </span>
      </strong>
      <span class="koboSpan" id="kobo.147.1">
       option is selected.
      </span>
      <span class="koboSpan" id="kobo.147.2">
       This supports backend state management for various things and is also the “Durable” in Durable Functions, something that will be covered in the next chapter.
      </span>
      <span class="koboSpan" id="kobo.147.3">
       Other triggers can be
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.148.1">
        added later:
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer042">
     <span class="koboSpan" id="kobo.149.1">
      <img alt="Figure 6.4 – Additional Functions authorization options" src="image/B21988_06_04.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.150.1">
     Figure 6.4 – Additional Functions authorization options
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.151.1">
      Many different
     </span>
     <a id="_idIndexMarker133">
     </a>
     <span class="koboSpan" id="kobo.152.1">
      triggers are available, and you can mix and match as needed.
     </span>
     <span class="koboSpan" id="kobo.152.2">
      Right-click on the project in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.153.1">
       Solution Explorer
      </span>
     </strong>
     <span class="koboSpan" id="kobo.154.1">
      area and select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.155.1">
       Add
      </span>
     </strong>
     <span class="koboSpan" id="kobo.156.1">
      |
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.157.1">
       New
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.158.1">
        Azure Function
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.159.1">
       :
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer043">
     <span class="koboSpan" id="kobo.160.1">
      <img alt="Figure 6.5 – Adding a new Azure Function" src="image/B21988_06_05.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.161.1">
     Figure 6.5 – Adding a new Azure Function
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.162.1">
      You may need to
     </span>
     <a id="_idIndexMarker134">
     </a>
     <span class="koboSpan" id="kobo.163.1">
      search for
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.164.1">
       Function
      </span>
     </strong>
     <span class="koboSpan" id="kobo.165.1">
      in the list, then
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.166.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.167.1">
        Add
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.168.1">
       :
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer044">
     <span class="koboSpan" id="kobo.169.1">
      <img alt="Figure 6.6 – New item dialog" src="image/B21988_06_06.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.170.1">
     Figure 6.6 – New item dialog
    </span>
   </p>
   <ol>
    <li value="7">
     <span class="koboSpan" id="kobo.171.1">
      A list of triggers
     </span>
     <a id="_idIndexMarker135">
     </a>
     <span class="koboSpan" id="kobo.172.1">
      should appear.
     </span>
     <span class="koboSpan" id="kobo.172.2">
      Select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.173.1">
       Http trigger
      </span>
     </strong>
     <span class="koboSpan" id="kobo.174.1">
      , choose
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.175.1">
       Anonymous
      </span>
     </strong>
     <span class="koboSpan" id="kobo.176.1">
      for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.177.1">
       Authorization level
      </span>
     </strong>
     <span class="koboSpan" id="kobo.178.1">
      , and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.179.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.180.1">
        Add
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.181.1">
       :
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer045">
     <span class="koboSpan" id="kobo.182.1">
      <img alt="Figure 6.7 – The New Azure Function dialog" src="image/B21988_06_07.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.183.1">
     Figure 6.7 – The New Azure Function dialog
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.184.1">
     Note that templates are revised over time, and this new one may look different compared to the original Function.
    </span>
    <span class="koboSpan" id="kobo.184.2">
     It also may add some interesting new objects that may look familiar to you, including
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.185.1">
      IActionResult
     </span>
    </strong>
    <span class="koboSpan" id="kobo.186.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.187.1">
      OkObjectResult
     </span>
    </strong>
    <span class="koboSpan" id="kobo.188.1">
     .
    </span>
    <span class="koboSpan" id="kobo.188.2">
     These come from ASP.NET Core libraries.
    </span>
    <span class="koboSpan" id="kobo.188.3">
     Install the latest
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.189.1">
      Microsoft.Azure.Functions.Worker.Extensions.Http.AspNetCore
     </span>
    </strong>
    <span class="koboSpan" id="kobo.190.1">
     NuGet package if it wasn’t referenced
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.191.1">
      by default.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.192.1">
     With that, you’ve created two HTTP endpoints that
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.193.1">
      should compile.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-86">
    <a id="_idTextAnchor086">
    </a>
    <span class="koboSpan" id="kobo.194.1">
     Options
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.195.1">
     Most applications will need options or
    </span>
    <a id="_idIndexMarker136">
    </a>
    <a id="_idIndexMarker137">
    </a>
    <span class="koboSpan" id="kobo.196.1">
     configuration in some form.
    </span>
    <span class="koboSpan" id="kobo.196.2">
     .NET provides built-in support for passing options in many forms, including custom ones, to your application when it starts up.
    </span>
    <span class="koboSpan" id="kobo.196.3">
     These different instances, such as environment variables, JSON (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.197.1">
      appsettings.json
     </span>
    </strong>
    <span class="koboSpan" id="kobo.198.1">
     ) and XML files, and command-line arguments, are all layered on top of one another so that individual settings can be overridden as needed.
    </span>
    <span class="koboSpan" id="kobo.198.2">
     Note that this is different from settings that are altered while the application is running, which are more advanced and circumstantial when creating APIs, and thus won’t be covered in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.199.1">
      this book.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.200.1">
     To add support for these options, follow
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.201.1">
      these steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.202.1">
      Add a new class called
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.203.1">
       MyOptions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.204.1">
      , make it
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.205.1">
       public
      </span>
     </strong>
     <span class="koboSpan" id="kobo.206.1">
      , and add a standard
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.207.1">
       string
      </span>
     </strong>
     <span class="koboSpan" id="kobo.208.1">
      property called
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.209.1">
       MyReturnValue
      </span>
     </strong>
     <span class="koboSpan" id="kobo.210.1">
      .
     </span>
     <span class="koboSpan" id="kobo.210.2">
      We’ll use this to control the return value of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.211.1">
       the Function.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.212.1">
      Go ahead and default the property value in the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.213.1">
       MyOptions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.214.1">
      class to anything you like.
     </span>
     <span class="koboSpan" id="kobo.214.2">
      We’ll override it in the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.215.1">
       appsettings.json
      </span>
     </strong>
     <span class="koboSpan" id="kobo.216.1">
      file in a moment, and change it at startup time during deployment later in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.217.1">
       this chapter.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.218.1">
      Add a new property to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.219.1">
       appsettings.json
      </span>
     </strong>
     <span class="koboSpan" id="kobo.220.1">
      file named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.221.1">
       MyReturnValue
      </span>
     </strong>
     <span class="koboSpan" id="kobo.222.1">
      , and a different value than you originally defaulted to in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.223.1">
       the code.
      </span>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.224.1">
       Now, we must configure the application so that it can use the configuration framework
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.225.1">
        at startup.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.226.1">
      Modify
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.227.1">
       .ConfigureServices
      </span>
     </strong>
     <span class="koboSpan" id="kobo.228.1">
      in
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.229.1">
       Program.cs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.230.1">
      to add an additional argument to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.231.1">
       context
      </span>
     </strong>
     <span class="koboSpan" id="kobo.232.1">
      Lambda.
     </span>
     <span class="koboSpan" id="kobo.232.2">
      Add calls to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.233.1">
       .AddOptions&lt;MyOptions&gt;
      </span>
     </strong>
     <span class="koboSpan" id="kobo.234.1">
      to the services variable, or chain them onto the end of
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.235.1">
       .ConfigureFunctionsApplicationInsights
      </span>
     </strong>
     <span class="koboSpan" id="kobo.236.1">
      .
     </span>
     <span class="koboSpan" id="kobo.236.2">
      Chain a call after
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.237.1">
       .AddOptions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.238.1">
      to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.239.1">
       .BindConfiguration
      </span>
     </strong>
     <span class="koboSpan" id="kobo.240.1">
      , taking an empty string.
     </span>
     <span class="koboSpan" id="kobo.240.2">
      This binds values in the root configuration path to matching property names in the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.241.1">
        MyOptions
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.242.1">
       class.
      </span>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.243.1">
       The
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.244.1">
        Program.cs
       </span>
      </strong>
      <span class="koboSpan" id="kobo.245.1">
       file should
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.246.1">
        look this:
       </span>
      </span>
     </p>
     <pre class="source-code"><span class="koboSpan" id="kobo.247.1">
var host = new HostBuilder()
    .ConfigureFunctionsWebApplication()
    .ConfigureServices((context, services) =&gt;
    {
        services.AddApplicationInsightsTelemetryWorkerService()
            .ConfigureFunctionsApplicationInsights()
            .AddOptions&lt;MyOptions&gt;()
            .BindConfiguration("");
    })
    .Build();
host.Run();</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.248.1">
       The
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.249.1">
        MyOptions.cs
       </span>
      </strong>
      <span class="koboSpan" id="kobo.250.1">
       file should
      </span>
      <a id="_idIndexMarker138">
      </a>
      <a id="_idIndexMarker139">
      </a>
      <span class="koboSpan" id="kobo.251.1">
       look
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.252.1">
        like this:
       </span>
      </span>
     </p>
     <pre class="source-code"><span class="koboSpan" id="kobo.253.1">public class MyOptions
{
    public string? </span><span class="koboSpan" id="kobo.253.2">MyReturnProperty { get; set; } = "my value in 
    code";
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.254.1">
      Modify
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.255.1">
       Function1.cs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.256.1">
      so that it includes
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.257.1">
       IOptions&lt;MyOptions&gt;
      </span>
     </strong>
     <span class="koboSpan" id="kobo.258.1">
      in the constructor, then save a reference to that as a class member.
     </span>
     <span class="koboSpan" id="kobo.258.2">
      Have
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.259.1">
       OkObjectResult
      </span>
     </strong>
     <span class="koboSpan" id="kobo.260.1">
      return
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.261.1">
       _options.Value.MyReturnProperty
      </span>
     </strong>
     <span class="koboSpan" id="kobo.262.1">
      so that we can see
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.263.1">
       values changing.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.264.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.265.1">
      Function1.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.266.1">
     file should look
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.267.1">
      like this:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.268.1">
public class Function1
{
    private readonly IOptions&lt;MyOptions&gt; _options;
    private readonly ILogger&lt;Function1&gt; _logger;
    public Function1(IOptions&lt;MyOptions&gt; options, ILogger&lt;Function1&gt; 
    logger)
    {
        _options = options;
        _logger = logger;
    }
    [Function("Function1")]
    public IActionResult Run([HttpTrigger(AuthorizationLevel.
</span><span class="koboSpan" id="kobo.268.2">    Anonymous, "get", "post")] HttpRequest req)
    {
        _logger.LogInformation("C# HTTP trigger function processed a 
        request.");
        return new OkObjectResult(_options.Value.MyReturnProperty);
    }
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.269.1">
     Test this out by running it.
    </span>
    <span class="koboSpan" id="kobo.269.2">
     You should see the standard output console window with some informational Function messages including the visible routes.
    </span>
    <span class="koboSpan" id="kobo.269.3">
     Hold
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.270.1">
      Ctrl
     </span>
    </em>
    <span class="koboSpan" id="kobo.271.1">
     and click (on Windows) to run them in your browser, or use any standard HTTP software.
    </span>
    <span class="koboSpan" id="kobo.271.2">
     You should see your hard-coded string
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.272.1">
      as output:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer046">
     <span class="koboSpan" id="kobo.273.1">
      <img alt="Figure 6.8 – Expected output in the browser" src="image/B21988_06_08.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.274.1">
     Figure 6.8 – Expected output in the browser
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.275.1">
     Congratulations!
    </span>
    <span class="koboSpan" id="kobo.275.2">
     Not only is your Function
    </span>
    <a id="_idIndexMarker140">
    </a>
    <a id="_idIndexMarker141">
    </a>
    <span class="koboSpan" id="kobo.276.1">
     running, but it’s been set up so that its values can be altered at deployment time.
    </span>
    <span class="koboSpan" id="kobo.276.2">
     Now, let’s learn how to route incoming requests to different sections
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.277.1">
      of code.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-87">
    <a id="_idTextAnchor087">
    </a>
    <span class="koboSpan" id="kobo.278.1">
     Routing
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.279.1">
     You’ll almost certainly need multiple routes in your Function API, including routing parameters, query parameters, and so on.
    </span>
    <span class="koboSpan" id="kobo.279.2">
     This forms part of the “shape” or public
    </span>
    <a id="_idIndexMarker142">
    </a>
    <a id="_idIndexMarker143">
    </a>
    <span class="koboSpan" id="kobo.280.1">
     contract of your API.
    </span>
    <span class="koboSpan" id="kobo.280.2">
     Routing supports this concept.
    </span>
    <span class="koboSpan" id="kobo.280.3">
     If you’re familiar with ASP.NET Core routes, then you’ll be right at home as they’re also supported,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.281.1">
      including constraints.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.282.1">
     How do different requests know where to enter into your application?
    </span>
    <span class="koboSpan" id="kobo.282.2">
     How should you describe what types of data should be allowed to be processed?
    </span>
    <span class="koboSpan" id="kobo.282.3">
     Let’s start with a classic storefront
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.283.1">
      products endpoint:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.284.1">
      Duplicate
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.285.1">
       Function1.cs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.286.1">
      and rename it
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.287.1">
       Products.cs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.288.1">
      , ensuring that you include all the references to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.289.1">
       Function1
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.290.1">
       in it.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.291.1">
      Add
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.292.1">
       string category
      </span>
     </strong>
     <span class="koboSpan" id="kobo.293.1">
      and an
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.294.1">
       int id
      </span>
     </strong>
     <span class="koboSpan" id="kobo.295.1">
      parameter to the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.296.1">
        Run
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.297.1">
       method.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.298.1">
      Instead of returning a string in
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.299.1">
       OkObjectResult
      </span>
     </strong>
     <span class="koboSpan" id="kobo.300.1">
      , return an anonymous object containing
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.301.1">
       category
      </span>
     </strong>
     <span class="koboSpan" id="kobo.302.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.303.1">
       id
      </span>
     </strong>
     <span class="koboSpan" id="kobo.304.1">
      so that we can see the values that are passed in from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.305.1">
       the route.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.306.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.307.1">
      Product.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.308.1">
     file should look
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.309.1">
      like this:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.310.1">
public class Products
{
    private readonly IOptions&lt;MyOptions&gt; _options;
    private readonly ILogger&lt;Products&gt; _logger;
    public Products(IOptions&lt;MyOptions&gt; options, ILogger&lt;Products&gt; 
    logger)
    {
        _options = options;
        _logger = logger;
    }
    [Function(nameof(Products))]
    public IActionResult Run([HttpTrigger(AuthorizationLevel.
</span><span class="koboSpan" id="kobo.310.2">    Anonymous, "get", Route = "products/{category:alpha}/{id:int?}")] 
    HttpRequest req,
        string category, int id = 0)
    {
        _logger.LogInformation("C# HTTP trigger function processed a 
        request.");
        return new OkObjectResult(new
        {
            category,
            id
        });
    }
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.311.1">
     Note the new
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.312.1">
      Route
     </span>
    </strong>
    <span class="koboSpan" id="kobo.313.1">
     property in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.314.1">
      HttpTrigger
     </span>
    </strong>
    <span class="koboSpan" id="kobo.315.1">
     attribute,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.316.1">
      "products/{category:alpha}/{id:int?}"
     </span>
    </strong>
    <span class="koboSpan" id="kobo.317.1">
     .
    </span>
    <span class="koboSpan" id="kobo.317.2">
     This allows us to customize, restrict, and parse out the arguments from the desired endpoint.
    </span>
    <span class="koboSpan" id="kobo.317.3">
     Since these route designs will likely be part of a larger web API for third-party consumers to use, you’ll want to take care in creating them.
    </span>
    <span class="koboSpan" id="kobo.317.4">
     You know that the product ID must be numeric, but you may want to restrict the category so that it only
    </span>
    <a id="_idIndexMarker144">
    </a>
    <a id="_idIndexMarker145">
    </a>
    <span class="koboSpan" id="kobo.318.1">
     contains letters.
    </span>
    <span class="koboSpan" id="kobo.318.2">
     When implemented as a route template, it would look like the one we mentioned previously:
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.319.1">
      "products/{category:alpha}/{id:int?}"
     </span>
    </strong>
    <span class="koboSpan" id="kobo.320.1">
     .
    </span>
    <span class="koboSpan" id="kobo.320.2">
     This will only match incoming requests that have your desired URI segments in the specified format.
    </span>
    <span class="koboSpan" id="kobo.320.3">
     The question mark (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.321.1">
      ?
     </span>
    </strong>
    <span class="koboSpan" id="kobo.322.1">
     ) denotes that the specified parameter is optional, and can be defaulted in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.323.1">
      method parameters.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.324.1">
     Did you notice that
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.325.1">
       Figure 6
      </span>
     </em>
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.326.1">
      .8
     </span>
    </em>
    <span class="koboSpan" id="kobo.327.1">
     had the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.328.1">
      api
     </span>
    </strong>
    <span class="koboSpan" id="kobo.329.1">
     URL segment prefixed to it when it wasn’t specified in the route?
    </span>
    <span class="koboSpan" id="kobo.329.2">
     Where does this prefix come from?
    </span>
    <span class="koboSpan" id="kobo.329.3">
     By default,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.330.1">
      api
     </span>
    </strong>
    <span class="koboSpan" id="kobo.331.1">
     is the default prefix for Functions.
    </span>
    <span class="koboSpan" id="kobo.331.2">
     This can be changed in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.332.1">
      host.json
     </span>
    </strong>
    <span class="koboSpan" id="kobo.333.1">
     file under the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.334.1">
      extensions
     </span>
    </strong>
    <span class="koboSpan" id="kobo.335.1">
     &gt; http &gt;
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.336.1">
       routePrefix
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.337.1">
      setting:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.338.1">
{
  "version": "2.0",
  "logging": {
    "applicationInsights": {
      "samplingSettings": {
        "isEnabled": true,
        "excludedTypes": "Request"
      },
      "enableLiveMetricsFilters": true
    }
  },
  "extensions": {
    "http": {
      "routePrefix": "myapi"
    }
  }
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.339.1">
     More details on overriding settings after
    </span>
    <a id="_idIndexMarker146">
    </a>
    <a id="_idIndexMarker147">
    </a>
    <span class="koboSpan" id="kobo.340.1">
     deployment can be found in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.341.1">
      Post-deployment
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.342.1">
       reconfiguration
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.343.1">
      section.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.344.1">
     Now, let’s create the necessary Azure cloud resources
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.345.1">
      and environment.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-88">
    <a id="_idTextAnchor088">
    </a>
    <span class="koboSpan" id="kobo.346.1">
     Deploying
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.347.1">
     First, we need to create some resources before we can view them in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.348.1">
      Visual Studio.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-89">
    <a id="_idTextAnchor089">
    </a>
    <span class="koboSpan" id="kobo.349.1">
     Azure resource creation
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.350.1">
     Let’s deploy your Function to
    </span>
    <a id="_idIndexMarker148">
    </a>
    <a id="_idIndexMarker149">
    </a>
    <span class="koboSpan" id="kobo.351.1">
     production!
    </span>
    <span class="koboSpan" id="kobo.351.2">
     To do so, create a
    </span>
    <a id="_idIndexMarker150">
    </a>
    <a id="_idIndexMarker151">
    </a>
    <span class="koboSpan" id="kobo.352.1">
     new
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.353.1">
      Consumption Linux Function
     </span>
    </strong>
    <span class="koboSpan" id="kobo.354.1">
     and follow
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.355.1">
      these steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.356.1">
      Go to
     </span>
     <a href="https://portal.azure.com">
      <span class="koboSpan" id="kobo.357.1">
       https://portal.azure.com
      </span>
     </a>
     <span class="koboSpan" id="kobo.358.1">
      and create a new resource group if you don’t have
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.359.1">
       one already:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer047">
     <span class="koboSpan" id="kobo.360.1">
      <img alt="Figure 6.9 – Creating a new resource group" src="image/B21988_06_09.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.361.1">
     Figure 6.9 – Creating a new resource group
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.362.1">
     Place it in an Azure region geographically close to you.
    </span>
    <span class="koboSpan" id="kobo.362.2">
     We’ll use this same region when we create other resources to minimize lag and
    </span>
    <a id="_idIndexMarker152">
    </a>
    <a id="_idIndexMarker153">
    </a>
    <span class="koboSpan" id="kobo.363.1">
     potential bandwidth.
    </span>
    <span class="koboSpan" id="kobo.363.2">
     Click on the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.364.1">
      Review + create
     </span>
    </strong>
    <span class="koboSpan" id="kobo.365.1">
     tab,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.366.1">
      then
     </span>
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.367.1">
       Create
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.368.1">
      :
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer048">
     <span class="koboSpan" id="kobo.369.1">
      <img alt="Figure 6.10 – Successfully creating a new resource group" src="image/B21988_06_10.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.370.1">
     Figure 6.10 – Successfully creating a new resource group
    </span>
   </p>
   <ol>
    <li value="2">
     <span class="koboSpan" id="kobo.371.1">
      Inside this resource group, create a new
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.372.1">
       Function app:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer049">
     <span class="koboSpan" id="kobo.373.1">
      <img alt="Figure 6.11 – Creating a new resource inside the resource group" src="image/B21988_06_11.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.374.1">
     Figure 6.11 – Creating a new resource inside the resource group
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.375.1">
      Search for
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.376.1">
       function
      </span>
     </strong>
     <span class="koboSpan" id="kobo.377.1">
      if you don’t see it in the default
     </span>
     <a id="_idIndexMarker154">
     </a>
     <a id="_idIndexMarker155">
     </a>
     <span class="koboSpan" id="kobo.378.1">
      selection.
     </span>
     <span class="koboSpan" id="kobo.378.2">
      Select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.379.1">
       Create
      </span>
     </strong>
     <span class="koboSpan" id="kobo.380.1">
      |
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.381.1">
       Function App
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.382.1">
       to continue:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer050">
     <span class="koboSpan" id="kobo.383.1">
      <img alt="Figure 6.12 – Selecting Function App as the resource to create" src="image/B21988_06_12.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.384.1">
     Figure 6.12 – Selecting Function App as the resource to create
    </span>
   </p>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.385.1">
      Next, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.386.1">
       Consumption
      </span>
     </strong>
     <span class="koboSpan" id="kobo.387.1">
      as your
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.388.1">
       hosting
      </span>
     </span>
     <span class="No-Break">
      <a id="_idIndexMarker156">
      </a>
      <a id="_idIndexMarker157">
      </a>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.389.1">
       option:
      </span>
     </span>
    </li>
   </ol>
   <p class="IMG---Figure">
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer051">
     <span class="koboSpan" id="kobo.390.1">
      <img alt="Figure 6.13 – Function hosting configuration" src="image/B21988_06_13.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.391.1">
     Figure 6.13 – Function hosting configuration
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.392.1">
      Select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.393.1">
       .NET
      </span>
     </strong>
     <span class="koboSpan" id="kobo.394.1">
      for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.395.1">
       Runtime stack
      </span>
     </strong>
     <span class="koboSpan" id="kobo.396.1">
      ,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.397.1">
       8 (LTS), isolated worker model
      </span>
     </strong>
     <span class="koboSpan" id="kobo.398.1">
      for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.399.1">
       Version
      </span>
     </strong>
     <span class="koboSpan" id="kobo.400.1">
      , and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.401.1">
       Linux
      </span>
     </strong>
     <span class="koboSpan" id="kobo.402.1">
      for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.403.1">
       Operating system
      </span>
     </strong>
     <span class="koboSpan" id="kobo.404.1">
      .
     </span>
     <span class="koboSpan" id="kobo.404.2">
      Select the
     </span>
     <a id="_idIndexMarker158">
     </a>
     <a id="_idIndexMarker159">
     </a>
     <span class="koboSpan" id="kobo.405.1">
      region that you selected when you created the resource group and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.406.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.407.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.408.1">
       :
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer052">
     <span class="koboSpan" id="kobo.409.1">
      <img alt="Figure 6.14 – Function details" src="image/B21988_06_14.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.410.1">
     Figure 6.14 – Function details
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.411.1">
      A
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.412.1">
       storage account
      </span>
     </strong>
     <span class="koboSpan" id="kobo.413.1">
      resource will also need to be created to hold various things for the Function runtime, including logs, your deployment
     </span>
     <a id="_idIndexMarker160">
     </a>
     <a id="_idIndexMarker161">
     </a>
     <span class="koboSpan" id="kobo.414.1">
      package, and optionally the Durable state, something we’ll discuss in the next chapter.
     </span>
     <span class="koboSpan" id="kobo.414.2">
      Disable
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.415.1">
       Blob service diagnostic settings
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.416.1">
       for now:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer053">
     <span class="koboSpan" id="kobo.417.1">
      <img alt="Figure 6.15 – Storage configuration" src="image/B21988_06_15.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.418.1">
     Figure 6.15 – Storage configuration
    </span>
   </p>
   <ol>
    <li value="7">
     <span class="koboSpan" id="kobo.419.1">
      Enable
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.420.1">
       public access
      </span>
     </strong>
     <span class="koboSpan" id="kobo.421.1">
      .
     </span>
     <span class="koboSpan" id="kobo.421.2">
      Then, choose
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.422.1">
       No
      </span>
     </strong>
     <span class="koboSpan" id="kobo.423.1">
      for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.424.1">
       Enable
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.425.1">
        Application Insights
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.426.1">
       :
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer054">
     <span class="koboSpan" id="kobo.427.1">
      <img alt="Figure 6.16 – Application Insights creation" src="image/B21988_06_16.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.428.1">
     Figure 6.16 – Application Insights creation
    </span>
   </p>
   <ol>
    <li value="8">
     <span class="koboSpan" id="kobo.429.1">
      Disable
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.430.1">
       continuous deployment
      </span>
     </strong>
     <span class="koboSpan" id="kobo.431.1">
      , an aspect that will also be covered in
     </span>
     <a href="B21998_10.xhtml#_idTextAnchor136">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.432.1">
         Chapter 10
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.433.1">
      .
     </span>
     <span class="koboSpan" id="kobo.433.2">
      We can use
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.434.1">
       Tags
      </span>
     </strong>
     <span class="koboSpan" id="kobo.435.1">
      to filter or group resources, and so on.
     </span>
     <span class="koboSpan" id="kobo.435.2">
      Add tags if desired, or leave this section empty and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.436.1">
       Review + create
      </span>
     </strong>
     <span class="koboSpan" id="kobo.437.1">
      .
     </span>
     <span class="koboSpan" id="kobo.437.2">
      Review your
     </span>
     <a id="_idIndexMarker162">
     </a>
     <a id="_idIndexMarker163">
     </a>
     <span class="koboSpan" id="kobo.438.1">
      settings; if everything looks good,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.439.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.440.1">
        Create
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.441.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.442.1">
      At this point, the deployment process will continue.
     </span>
     <span class="koboSpan" id="kobo.442.2">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.443.1">
       Go to resource
      </span>
     </strong>
     <span class="koboSpan" id="kobo.444.1">
      ; you’ll be taken to your brand
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.445.1">
       new Function!
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer055">
     <span class="koboSpan" id="kobo.446.1">
      <img alt="Figure 6.17 – Portal overview blade for your Azure Function" src="image/B21988_06_17.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.447.1">
     Figure 6.17 – Portal overview blade for your Azure Function
    </span>
   </p>
   <ol>
    <li value="10">
     <span class="koboSpan" id="kobo.448.1">
      Click on the URL listed on the right-hand side.
     </span>
     <span class="koboSpan" id="kobo.448.2">
      You’ll be taken to a default page indicating that your Function
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.449.1">
       is running:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer056">
     <span class="koboSpan" id="kobo.450.1">
      <img alt="Figure 6.18 – Default Azure Functions landing page﻿" src="image/B21988_06_18.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.451.1">
     Figure 6.18 – Default Azure Functions landing page
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.452.1">
     Tip
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.453.1">
     While these steps and screenshots are accurate at the time of writing, Azure often changes and upgrades its design, features, flow, and so on.
    </span>
    <span class="koboSpan" id="kobo.453.2">
     It’s recommended that you check out the official documentation for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.454.1">
      updated guidance.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.455.1">
     Now that the Function resource is running with
    </span>
    <a id="_idIndexMarker164">
    </a>
    <a id="_idIndexMarker165">
    </a>
    <span class="koboSpan" id="kobo.456.1">
     a default template, let’s deploy from
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.457.1">
      Visual Studio.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-90">
    <a id="_idTextAnchor090">
    </a>
    <span class="koboSpan" id="kobo.458.1">
     Publishing from Visual Studio
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.459.1">
     Let’s walk through deploying manually from
    </span>
    <a id="_idIndexMarker166">
    </a>
    <a id="_idIndexMarker167">
    </a>
    <span class="koboSpan" id="kobo.460.1">
     Visual Studio.
    </span>
    <span class="koboSpan" id="kobo.460.2">
     Automated deployments, also known as continuous delivery, will be covered in
    </span>
    <a href="B21998_10.xhtml#_idTextAnchor136">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.461.1">
        Chapter 10
       </span>
      </em>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.462.1">
      :
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.463.1">
      Back in
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.464.1">
       Visual Studio
      </span>
     </strong>
     <span class="koboSpan" id="kobo.465.1">
      , right-click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.466.1">
       FunctionsChapter6
      </span>
     </strong>
     <span class="koboSpan" id="kobo.467.1">
      project and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.468.1">
       select
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.469.1">
        Publish…
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.470.1">
       :
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer057">
     <span class="koboSpan" id="kobo.471.1">
      <img alt="Figure 6.19 – Publishing our project" src="image/B21988_06_19.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.472.1">
     Figure 6.19 – Publishing our project
    </span>
   </p>
   <ol>
    <li value="2">
     <span class="koboSpan" id="kobo.473.1">
      Then, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.474.1">
       Azure
      </span>
     </strong>
     <span class="koboSpan" id="kobo.475.1">
      and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.476.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.477.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.478.1">
       :
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer058">
     <span class="koboSpan" id="kobo.479.1">
      <img alt="Figure 6.20 – Types of publishing" src="image/B21988_06_20.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.480.1">
     Figure 6.20 – Types of publishing
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.481.1">
      Select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.482.1">
       Azure Function App (Linux)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.483.1">
      and
     </span>
     <a id="_idIndexMarker168">
     </a>
     <a id="_idIndexMarker169">
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.484.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.485.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.486.1">
       :
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer059">
     <span class="koboSpan" id="kobo.487.1">
      <img alt="Figure 6.21 – Azure publishing targets" src="image/B21988_06_21.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.488.1">
     Figure 6.21 – Azure publishing targets
    </span>
   </p>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.489.1">
      Select the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.490.1">
       Microsoft account
      </span>
     </strong>
     <span class="koboSpan" id="kobo.491.1">
      and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.492.1">
       subscription
      </span>
     </strong>
     <span class="koboSpan" id="kobo.493.1">
      you created the Function resource under.
     </span>
     <span class="koboSpan" id="kobo.493.2">
      Search or locate your Function by name, select it, and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.494.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.495.1">
        Finish
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.496.1">
       :
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer060">
     <span class="koboSpan" id="kobo.497.1">
      <img alt="Figure 6.22 – Selecting the account, subscription, and resource to publish to" src="image/B21988_06_22.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.498.1">
     Figure 6.22 – Selecting the account, subscription, and resource to publish to
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.499.1">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.500.1">
       Finish
      </span>
     </strong>
     <span class="koboSpan" id="kobo.501.1">
      , then
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.502.1">
       Close
      </span>
     </strong>
     <span class="koboSpan" id="kobo.503.1">
      when you’re done.
     </span>
     <span class="koboSpan" id="kobo.503.2">
      Details
     </span>
     <a id="_idIndexMarker170">
     </a>
     <a id="_idIndexMarker171">
     </a>
     <span class="koboSpan" id="kobo.504.1">
      about your published profile will appear, including its
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.505.1">
       Configuration
      </span>
     </strong>
     <span class="koboSpan" id="kobo.506.1">
      and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.507.1">
       Target Runtime
      </span>
     </strong>
     <span class="koboSpan" id="kobo.508.1">
      , as well as any dependencies that
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.509.1">
       it needs:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer061">
     <span class="koboSpan" id="kobo.510.1">
      <img alt="Figure 6.23 – Function publish profile" src="image/B21988_06_23.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.511.1">
     Figure 6.23 – Function publish profile
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.512.1">
     When you’re ready, click
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.513.1">
      Publish
     </span>
    </strong>
    <span class="koboSpan" id="kobo.514.1">
     .
    </span>
    <span class="koboSpan" id="kobo.514.2">
     Once that succeeds, you can view your new API route at https://&lt;my resource name&gt;.azurewebsites.net/api/products/electronics/471337.
    </span>
    <span class="koboSpan" id="kobo.514.3">
     Note that you can see the default data if you
    </span>
    <a id="_idIndexMarker172">
    </a>
    <a id="_idIndexMarker173">
    </a>
    <span class="koboSpan" id="kobo.515.1">
     go to https://&lt;my
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.516.1">
      resource name&gt;.azurewebsites.net/api/Function
     </span>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.517.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.518.1">
     As mentioned previously in this chapter, we’ll now look at changing a configuration value without recompiling the Function, and without
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.519.1">
      redeploying it.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-91">
    <a id="_idTextAnchor091">
    </a>
    <span class="koboSpan" id="kobo.520.1">
     Post-deployment reconfiguration
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.521.1">
     Now, let’s change the configuration to
    </span>
    <a id="_idIndexMarker174">
    </a>
    <a id="_idIndexMarker175">
    </a>
    <span class="koboSpan" id="kobo.522.1">
     a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.523.1">
      different value:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.524.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.525.1">
       Environment variables
      </span>
     </strong>
     <span class="koboSpan" id="kobo.526.1">
      blade, under the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.527.1">
       Settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.528.1">
      section of the Function resource in the Azure portal, create a new key to override the setting we hard-coded earlier.
     </span>
     <span class="koboSpan" id="kobo.528.2">
      Use
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.529.1">
       MyReturnProperty
      </span>
     </strong>
     <span class="koboSpan" id="kobo.530.1">
      as the key since we’re reading the configuration variables from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.531.1">
       root namespace:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer062">
     <span class="koboSpan" id="kobo.532.1">
      <img alt="Figure 6.24 - Adding a new environment variable to override a setting" src="image/B21988_06_24.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.533.1">
     Figure 6.24 - Adding a new environment variable to override a setting
    </span>
   </p>
   <ol>
    <li value="2">
     <strong class="bold">
      <span class="koboSpan" id="kobo.534.1">
       Apply
      </span>
     </strong>
     <span class="koboSpan" id="kobo.535.1">
      this addition,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.536.1">
       Apply
      </span>
     </strong>
     <span class="koboSpan" id="kobo.537.1">
      the changes, and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.538.1">
       Confirm
      </span>
     </strong>
     <span class="koboSpan" id="kobo.539.1">
      the save; your Function application will be restarted.
     </span>
     <span class="koboSpan" id="kobo.539.2">
      Navigate to https://&lt;my resource name&gt;.azurewebsites.net/api/Function1 so that you can see the new
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.540.1">
       configuration value:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer063">
     <span class="koboSpan" id="kobo.541.1">
      <img alt="Figure 6.25 – Overridden configuration value" src="image/B21988_06_25.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.542.1">
     Figure 6.25 – Overridden configuration value
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.543.1">
     This can be nested arbitrarily deep.
    </span>
    <span class="koboSpan" id="kobo.543.2">
     For example, if your
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.544.1">
      MyOptions
     </span>
    </strong>
    <span class="koboSpan" id="kobo.545.1">
     class’s
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.546.1">
      MyReturnValue
     </span>
    </strong>
    <span class="koboSpan" id="kobo.547.1">
     was a complex type with its own
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.548.1">
      MyOtherReturnValue
     </span>
    </strong>
    <span class="koboSpan" id="kobo.549.1">
     property, the
    </span>
    <a id="_idIndexMarker176">
    </a>
    <a id="_idIndexMarker177">
    </a>
    <span class="koboSpan" id="kobo.550.1">
     path for the key in Azure would be
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.551.1">
      MyReturnValue__MyOtherReturnValue
     </span>
    </strong>
    <span class="koboSpan" id="kobo.552.1">
     .
    </span>
    <span class="koboSpan" id="kobo.552.2">
     Note that there are two underscores between the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.553.1">
      property names.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.554.1">
     Since this is publicly accessible, it has the potential to cost you money if a rogue process becomes aware of your new endpoint.
    </span>
    <span class="koboSpan" id="kobo.554.2">
     Securing this new site with what’s colloquially known as
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.555.1">
      Easy Auth
     </span>
    </strong>
    <span class="koboSpan" id="kobo.556.1">
     will be discussed later in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.557.1">
      this book.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.558.1">
     But in the meantime, you can adjust some hosting options to limit the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.559.1">
      potential cost.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.560.1">
      Navigate to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.561.1">
       Settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.562.1">
      |
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.563.1">
       Scale out
      </span>
     </strong>
     <span class="koboSpan" id="kobo.564.1">
      and change
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.565.1">
       Maximum Scale Out Limit
      </span>
     </strong>
     <span class="koboSpan" id="kobo.566.1">
      to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.567.1">
       1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.568.1">
      .
     </span>
     <span class="koboSpan" id="kobo.568.2">
      Then,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.569.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.570.1">
        Save
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.571.1">
       :
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer064">
     <span class="koboSpan" id="kobo.572.1">
      <img alt="Figure 6.26 – Limiting scale out" src="image/B21988_06_26.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.573.1">
     Figure 6.26 – Limiting scale out
    </span>
   </p>
   <ol>
    <li value="2">
     <span class="koboSpan" id="kobo.574.1">
      Then, navigate to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.575.1">
       Settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.576.1">
      |
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.577.1">
       Configuration
      </span>
     </strong>
     <span class="koboSpan" id="kobo.578.1">
      , change
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.579.1">
       Daily Usage Quota
      </span>
     </strong>
     <span class="koboSpan" id="kobo.580.1">
      to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.581.1">
       1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.582.1">
      , and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.583.1">
       Save
      </span>
     </strong>
     <span class="koboSpan" id="kobo.584.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.585.1">
       then
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.586.1">
        Continue
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.587.1">
       :
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer065">
     <span class="koboSpan" id="kobo.588.1">
      <img alt="Figure 6.27 – Adding a daily quota" src="image/B21988_06_27.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.589.1">
     Figure 6.27 – Adding a daily quota
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.590.1">
     At this point, while you haven’t secured your
    </span>
    <a id="_idIndexMarker178">
    </a>
    <a id="_idIndexMarker179">
    </a>
    <span class="koboSpan" id="kobo.591.1">
     site against bots or malicious actors, you have at least taken a few steps to mitigate any
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.592.1">
      potential damage.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-92">
    <a id="_idTextAnchor092">
    </a>
    <span class="koboSpan" id="kobo.593.1">
     Summary
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.594.1">
     In this chapter, we walked through creating multiple HTTP endpoints inside a single Azure Function, adding a route template to assist with managing differing URI segments at runtime.
    </span>
    <span class="koboSpan" id="kobo.594.2">
     Then, we added configuration options to our project, deployed it to Azure, and adjusted the configuration options after deployment.
    </span>
    <span class="koboSpan" id="kobo.594.3">
     To limit the potential cost of a deployed, live HTTP endpoint, we adjusted two settings until authorization was
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.595.1">
      in place.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.596.1">
     Now that you understand how HTTP triggers work in Azure Functions, in the next chapter, we’ll explore other types of triggers we can use to build reliable, stateful, and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.597.1">
      scalable workflows.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-93">
    <a id="_idTextAnchor093">
    </a>
    <span class="koboSpan" id="kobo.598.1">
     You try it
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.599.1">
     Write an API using Azure Functions, create a Function resource in Azure, and then deploy your Function to it with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.600.1">
      Visual Studio.
     </span>
    </span>
   </p>
  </div>
 </body></html>