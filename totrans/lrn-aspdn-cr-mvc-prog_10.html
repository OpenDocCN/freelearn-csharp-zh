<html><head></head><body><div class="chapter" title="Chapter&#xA0;10.&#xA0;Building HTTP-based Web Services Using ASP.NET Web API">&#13;
<div class="titlepage">&#13;
<div>&#13;
<div>&#13;
<h1 class="title"><a id="ch10"/>&#13;
 Chapter 10. Building HTTP-based Web Services Using ASP.NET Web API</h1>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
<p>So far, we have learned how to create web applications using ASP.NET Core. But there are times when simply creating a web application is not enough. Let's assume you are using ASP.NET Core to create a web application that provides weather information for all the cities across the world. People access your web application to find out weather information, and they are satisfied with the service. But this weather information may be needed by many other websites or web applications, such as tourism websites, news websites, and many other mobile applications.</p>&#13;
<p>Instead of writing the code all over again for their websites, you can create and publish the web services and the websites can consume the required web services whenever they need to.</p>&#13;
<p>In this chapter, you are going to learn about the following topics:</p>&#13;
<div class="itemizedlist">&#13;
<ul class="itemizedlist">&#13;
<li class="listitem">What an HTTP-based service is and how it is useful</li>&#13;
<li class="listitem">What Fiddler is</li>&#13;
<li class="listitem">How to compose an HTTP request using Fiddler and fire the same in order to get an HTTP response</li>&#13;
<li class="listitem">How to design and implement the HTTP service using Web API</li>&#13;
</ul>&#13;
</div>&#13;
<p>Microsoft provides ASP.NET Web API for programmers to build HTTP-based services. But HTTP is not just used to serve the webpages. You can use HTTP as a platform. This brings several advantages:</p>&#13;
<div class="itemizedlist">&#13;
<ul class="itemizedlist">&#13;
<li class="listitem">As web services built using ASP.NET Web API use HTTP for communication, these web services can be consumed from all kinds of applications from console applications to web applications, and from WCF services to mobile applications</li>&#13;
<li class="listitem">Whenever there is any change in the logic/code of the web services, the clients (the websites that consume the services) do not need to change anything. They can consume the web services just as they were consuming them earlier</li>&#13;
</ul>&#13;
</div>&#13;
<div class="section" title="HTTP basics">&#13;
<div class="titlepage">&#13;
<div>&#13;
<div>&#13;
<h1 class="title"><a id="ch10lvl1sec67"/>&#13;
 HTTP basics</h1>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
<p>HTTP is a powerful platform for building services. You can use the existing HTTP verbs to build services. For example, you can use the existing HTTP verb GET to get the list of products or POST to update information about the product. Let's take a quick look at how HTTP works with respect to building the services.</p>&#13;
<p>There is no difference in the underlying mechanism between serving the HTML pages in ASP.NET MVC and serving the data in the context of HTTP services. Both follow a request-response pattern and the same routing mechanism.</p>&#13;
<p>An HTTP request can be sent from any client (desktop, laptop, tablet, mobile, and so on) to the server and the server will respond back with an HTTP response. An HTTP response can be sent to the client in any format such as JSON or XML. This is shown in the following figure:</p>&#13;
<div class="mediaobject"><img src="Image00194.jpg" alt="HTTP basics"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>In the preceding diagram, a request is sent from the desktop computer (it could equally be sent from a mobile or tablet; it makes no difference) and the server sends back the HTTP response for the request. As HTTP is supported in most of the devices, it is ubiquitous.</p>&#13;
<div class="section" title="HTTP verbs">&#13;
<div class="titlepage">&#13;
<div>&#13;
<div>&#13;
<h2 class="title"><a id="ch10lvl2sec63"/>&#13;
 HTTP verbs</h2>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
<p>HTTP verbs describe how the request has to be sent. These are the methods defined in HTTP that dictate how the HTTP requests are sent from the client to the server</p>&#13;
</div>&#13;
<div class="section" title="GET method">&#13;
<div class="titlepage">&#13;
<div>&#13;
<div>&#13;
<h2 class="title"><a id="ch10lvl2sec64"/>&#13;
 GET method</h2>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
<p>When we use an HTTP GET request, the information is passed through the URL itself:</p>&#13;
<pre class="programlisting">GET api/employees/{id} 
</pre>&#13;
<p>This <code class="literal">GET</code>&#13;
 request gets the employee information based on the passed ID. The advantage of using the <code class="literal">GET</code>&#13;
 request is that it is lightweight, and all the required information will be passed in the URL or header itself, as shown in the following diagram:</p>&#13;
<div class="mediaobject"><img src="Image00195.jpg" alt="GET method"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
</div>&#13;
<div class="section" title="PUT method">&#13;
<div class="titlepage">&#13;
<div>&#13;
<div>&#13;
<h2 class="title"><a id="ch10lvl2sec65"/>&#13;
 PUT method</h2>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
<p>The <code class="literal">PUT</code>&#13;
  method is used to create a resource or to update it. <code class="literal">PUT</code>&#13;
 is an idempotent operation, meaning that the expected behavior would not change even if it is executed multiple times:</p>&#13;
<div class="mediaobject"><img src="Image00196.jpg" alt="PUT method"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
</div>&#13;
<div class="section" title="POST method">&#13;
<div class="titlepage">&#13;
<div>&#13;
<div>&#13;
<h2 class="title"><a id="ch10lvl2sec66"/>&#13;
 POST method</h2>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
<p>You can use POST to create or update the resource. Usually, POST is used to create the resource rather than update it. As per HTTP standards, whenever you create a new resource, you should return a <span class="strong">&#13;
<strong>201 HTTP</strong>&#13;
</span>&#13;
 status code:</p>&#13;
<div class="mediaobject"><img src="Image00197.jpg" alt="POST method"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
</div>&#13;
<div class="section" title="DELETE method">&#13;
<div class="titlepage">&#13;
<div>&#13;
<div>&#13;
<h2 class="title"><a id="ch10lvl2sec67"/>&#13;
 DELETE method</h2>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
<p>The DELETE method is used to delete the resource. Usually, when you delete a resource, you would be passing the ID as a parameter, and you would not be passing anything in the body of the request:</p>&#13;
<div class="mediaobject"><img src="Image00198.jpg" alt="DELETE method"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>Usually, HTTP services would be consumed by other applications and services. Applications that consume services are referred to as clients. One of the options to test HTTP services is to build the clients. But this would be time-consuming, and we may throw away the client code once we test the HTTP services.</p>&#13;
<p>Another option, which is widely used, is to use applications that enable us to fire HTTP requests and monitor the responses. There are many applications available, Fiddler being one such widely used application.</p>&#13;
</div>&#13;
<div class="section" title="Fiddler tool">&#13;
<div class="titlepage">&#13;
<div>&#13;
<div>&#13;
<h2 class="title"><a id="ch10lvl2sec68"/>&#13;
 Fiddler tool</h2>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
<p>Fiddler is the proxy server application used to monitor the HTTP and HTTPS traffic. You can monitor the requests that are being sent to the server from the client, the responses that are sent to the client, and the responses that are being received from the server. It is like seeing the traffic in the pipe between the server and the client. You can even compose a request, fire it, and analyze the response received without ever needing to write the client for the services.</p>&#13;
<p>You can download Fiddler at <a class="ulink" href="http://www.telerik.com/fiddler">http://www.telerik.com/fiddler</a>&#13;
 . You'll see the following window:</p>&#13;
<div class="mediaobject"><img src="Image00199.jpg" alt="Fiddler tool"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>Enough theory. Let us create a simple web service using ASP.NET Web API.</p>&#13;
<p>Fire up Visual Studio 2015:</p>&#13;
<div class="mediaobject"><img src="Image00200.jpg" alt="Fiddler tool"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>When you click <span class="strong">&#13;
<strong>OK</strong>&#13;
</span>&#13;
 , a Web API solution will be created. Just as the ASP.NET Core application controller inherits from the Controller class.</p>&#13;
<div class="mediaobject"><img src="Image00201.jpg" alt="Fiddler tool"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>The Web API class will also inherit from the same Controller class. This is the difference between ASP.NET Core and earlier versions of ASP.NET MVC. In earlier versions, all Web API controller classes inherited from the <code class="literal">ApiController</code>&#13;
 class. In ASP.NET 5, it has been unified, and the same base Controller class is being used for both building web applications and services.</p>&#13;
<p>The following is the <code class="literal">ValuesController</code>&#13;
 class that will be created by default when you choose the <span class="strong">&#13;
<strong>Web API</strong>&#13;
</span>&#13;
 template option when creating the project:</p>&#13;
<div class="mediaobject"><img src="Image00202.jpg" alt="Fiddler tool"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>Before we create our own custom Controller, let's analyze the default API Controller. In the <code class="literal">ValuesController</code>&#13;
 file, several API methods are already defined.</p>&#13;
<p>There are two overloaded <code class="literal">GET</code>&#13;
 methods—one with a parameter and another without a parameter. The <code class="literal">GET</code>&#13;
 method without a parameter returns all the resources of the type. In this case, we are returning just a couple of strings. In the real world, we would be returning the metadata of the resources. For example, if we fire the <code class="literal">GET</code>&#13;
 request on the movies API Controller, it would return information about all the movies. The <code class="literal">GET</code>&#13;
 method with an <code class="literal">id</code>&#13;
 parameter returns the resource whose ID matches with the passed ID. For example, if you pass a movie ID, it would return the information about that movie. The body of the other methods, such as <code class="literal">PUT</code>&#13;
 , <code class="literal">POST</code>&#13;
 , and <code class="literal">DELETE</code>&#13;
 , are empty in this Controller, and we will talk about these methods later.</p>&#13;
<p>When you run the application, you will get the following output:</p>&#13;
<div class="mediaobject"><img src="Image00203.jpg" alt="Fiddler tool"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>By default, it fires a request to <code class="literal">api/values</code>&#13;
 , and the values are displayed in the browser.</p>&#13;
<p>Let's learn how to fire an HTTP request from the Fiddler application. Open the Fiddler application. In the bottom left-hand corner, select the <span class="strong">&#13;
<strong>Web Browsers</strong>&#13;
</span>&#13;
 option in the red box. Choosing this option will enable us to view the traffic coming from the <span class="strong">&#13;
<strong>Web Browsers</strong>&#13;
</span>&#13;
 :</p>&#13;
<div class="mediaobject"><img src="Image00204.jpg" alt="Fiddler tool"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>Select the <span class="strong">&#13;
<strong>Composer</strong>&#13;
</span>&#13;
 tab, enter the URL <code class="literal">http://localhost:49933/api/values</code>&#13;
 , as shown in the following screenshot, and click the <span class="strong">&#13;
<strong>Execute</strong>&#13;
</span>&#13;
 button in the top right-hand corner:</p>&#13;
<div class="mediaobject"><img src="Image00205.jpg" alt="Fiddler tool"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>Once you click the <span class="strong">&#13;
<strong>Execute</strong>&#13;
</span>&#13;
 button, an HTTP session will be created, visible on the left-hand side pane (highlighted in the blue box). Click on the session and select the <span class="strong">&#13;
<strong>Inspectors</strong>&#13;
</span>&#13;
 tab on the top right-hand side pane. Select the JSON tab in the bottom right-hand side pane (highlighted by the purple-bordered box in the following screenshot).</p>&#13;
<p>You can see the JSON data returned from the HTTP request—<span class="strong">&#13;
<strong>value1</strong>&#13;
</span>&#13;
 and <span class="strong">&#13;
<strong>value2</strong>&#13;
</span>&#13;
 in the following screenshot:</p>&#13;
<div class="mediaobject"><img src="Image00206.jpg" alt="Fiddler tool"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>Now it's our turn to write a custom API.</p>&#13;
<p>In this custom API, we are going to provide API methods to create an employee object, list all the employee objects, and delete an employee object.</p>&#13;
<p>First, let us create a model for the employee. We need to create a folder to hold these models. Right-click on the project, select <span class="strong">&#13;
<strong>Add</strong>&#13;
</span>&#13;
  | <span class="strong">&#13;
<strong>New folder</strong>&#13;
</span>&#13;
 , and name the folder as <code class="literal">Models</code>&#13;
 :</p>&#13;
<div class="mediaobject"><img src="Image00207.jpg" alt="Fiddler tool"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>Right-click on the <code class="literal">Models</code>&#13;
 folder and select <span class="strong">&#13;
<strong>Add</strong>&#13;
</span>&#13;
 | <span class="strong">&#13;
<strong>New Item…</strong>&#13;
</span>&#13;
  to create an employee model class. This employee model class is just a POCO class. See the following code:</p>&#13;
<pre class="programlisting">public class Employee
{
  public int Id {get; set;}
  public string FirstName {get; set;}
  public string LastName {get; set;}
  public string Department {get; set;}
}</pre>&#13;
<p>Then, we define the repository interface to handle the model:</p>&#13;
<pre class="programlisting">public interface IEmployeeRepository
{
  void AddEmployee(Employee e);
  IEnumerable&lt;Employee&gt; GetAllEmployees();
  Employee GetEmployee(int id);
  Employee RemoveEmployee(int id);
  void UpdateEmployee(Employee employee);
}</pre>&#13;
<p>Then we implement the interface for this model:</p>&#13;
<pre class="programlisting">public class EmployeeRepository : IEmployeeRepository
{
  private static List&lt;Employee&gt; employees = new List&lt;Employee&gt;();

  public EmployeeRepository()
  {

    Employee employee1 = new Employee
    {
      FirstName = "Mugil",
      LastName = "Ragu",
      Department = "Finance",
      Id = 1
    };

   Employee employee2 = new Employee
   {
      FirstName = "John",
      LastName = "Skeet",
      Department = "IT",
      Id = 2
   };

  employees.Add(employee1);
  employees.Add(employee2);
  }

  public IEnumerable&lt;Employee&gt; GetAllEmployees()
  {
    return employees;
  }

  public void AddEmployee(Employee e)
  {
    e.Id = GetNextRandomId();
    employees.Add(e);
  }

  public Employee GetEmployee(int id)
  {
    return employees.Where(emp =&gt; emp.Id == id).FirstOrDefault();
  }

  public Employee RemoveEmployee(int id)
  {
    Employee employee = employees.Where(emp =&gt; emp.Id ==   id).FirstOrDefault();
    if (employee !=null )
    {
      employees.Remove(employee);
    }
    return employee;
  }

  public void UpdateEmployee(Employee emp)
  {
    Employee employee = employees.Where(e =&gt; e.Id ==  emp.Id).FirstOrDefault();
    if(employee != null)
    {
    employee.Department = emp.Department;
    employee.FirstName = emp.FirstName;
    employee.LastName = emp.LastName;
    }
  }

  private int GetNextRandomId()
  {
    int id = -1;
    bool isIdExists;
    Random random = new Random();
    do
    {
      id = random.Next();
      isIdExists = employees.Any(emp =&gt; emp.Id == id);
    } while (isIdExists);
    return id;
  }
}</pre>&#13;
<p>There are few things to be noted in the implementation class:</p>&#13;
<div class="itemizedlist">&#13;
<ul class="itemizedlist">&#13;
<li class="listitem">We have decided not to use the database as our objective is to create an HTTP service using Web API, and not to write the data access code.</li>&#13;
<li class="listitem">We are using an in-memory list to hold the data. All the operations will be performed on this list. As a matter of fact, the data could be in any form, ranging from relational databases to a simple in-memory list.</li>&#13;
<li class="listitem">In the constructor method, we are adding an object to the list. This list will be acting as the database for our HTTP service.</li>&#13;
<li class="listitem">The <code class="literal">GetAllEmployees</code>&#13;
 API method will return all the employees as the <code class="literal">IEnumerable</code>&#13;
 interface.</li>&#13;
<li class="listitem">The <code class="literal">AddEmployee</code>&#13;
  method will add the employee (passed as a parameter) to the list.</li>&#13;
<li class="listitem">The <code class="literal">GetEmployee</code>&#13;
  method will return the employee whose ID matches that of the parameter.</li>&#13;
<li class="listitem">The <code class="literal">RemoveEmployee</code>&#13;
  method will remove the employee from the list.</li>&#13;
<li class="listitem">The <code class="literal">UpdateEmployee</code>&#13;
  method will update the employee information.</li>&#13;
<li class="listitem">The <code class="literal">GetNextRandomId</code>&#13;
 method will return the next available random integer. This integer value is being used to generate the employee ID.</li>&#13;
</ul>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;

<div class="section" title="Dependency Injection">&#13;
<div class="titlepage">&#13;
<div>&#13;
<div>&#13;
<h1 class="title"><a id="ch10lvl1sec68"/>&#13;
 Dependency Injection</h1>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
<p>In most real-world projects, we do not instantiate any objects using the <code class="literal">new</code>&#13;
 instance in any of the Controllers, the reason being that we don't want to have tight coupling between the dependent components (between the Controller and the repository). Instead, we pass an interface to the Controller, and the Dependency Injection container (such as <span class="strong">&#13;
<strong>Unity</strong>&#13;
</span>&#13;
 ) will create an object for us when it is needed for the Controller. This design pattern is commonly referred to as <span class="strong">&#13;
<strong>Inversion of Control</strong>&#13;
</span>&#13;
 .</p>&#13;
<p>Let's say that a class by the name of <span class="emphasis">&#13;
<em>ClassA</em>&#13;
</span>&#13;
 uses another class, <span class="emphasis">&#13;
<em>ClassB</em>&#13;
</span>&#13;
 . In this case, it is enough for <span class="emphasis">&#13;
<em>ClassA</em>&#13;
</span>&#13;
 to know about the behavior, methods, and properties of <span class="emphasis">&#13;
<em>ClassB</em>&#13;
</span>&#13;
 , and it doesn't need the internal implementation details of <span class="emphasis">&#13;
<em>ClassB</em>&#13;
</span>&#13;
 . So, we can abstract <span class="emphasis">&#13;
<em>ClassB</em>&#13;
</span>&#13;
 and make an interface out of the class, and then have that interface as the parameter instead of the concrete class. The advantage of this approach is that we can pass any class at runtime as long as it implements a commonly agreed contract (interface).</p>&#13;
<p>In ASP.NET 5 (including ASP.NET Core and Web API), we have inbuilt support for Dependency Injection. In the <code class="literal">ConfigureServices</code>&#13;
 method, we have added the line (highlighted in bold) that performs the Dependency Injection. We instruct the inbuilt Dependency Injection container to create the <code class="literal">EmployeeRepository</code>&#13;
  class wherever we are referring to the <code class="literal">IEmployeeRepository</code>&#13;
  interface and we also instruct it to be a singleton; meaning that the same object (which is to be created by the Dependency Injection container) is to be shared for the entire lifecycle of the application:</p>&#13;
<pre class="programlisting">public void ConfigureServices(IServiceCollection services)
{
  // Add framework services.
  services.AddApplicationInsightsTelemetry(Configuration);
  services.AddMvc();
<span class="strong">
<strong>  services.AddSingleton&lt;IEmployeeRepository, EmployeeRepository&gt;();
</strong>&#13;

</span>&#13;


}
</pre>&#13;
<p>In the preceding code, we have used the Singleton pattern for the Dependency Injection, which creates services only the first time they are requested. There are other types of lifetime services such as <span class="strong">&#13;
<strong>Transient</strong>&#13;
</span>&#13;
 and <span class="strong">&#13;
<strong>Scoped</strong>&#13;
</span>&#13;
 . Transient lifetime services are created each time they are requested and Scoped lifetime services are created once per request. The following are code snippets created when you use such lifetimes:</p>&#13;
<pre class="programlisting">
<span class="strong">
<strong>services.AddTransient</strong>&#13;

</span>&#13;


<span class="strong">
<strong>  &lt;IEmployeeRepository, EmployeeRepository&gt;();

</strong>&#13;

</span>&#13;


<span class="strong">
<strong>services.AddScoped  &lt;</strong>&#13;

</span>&#13;


<span class="strong">
<strong>IEmployeeRepository, EmployeeRepository&gt;();</strong>&#13;

</span>&#13;


</pre>&#13;
<p>Now it's time to get into the meat of the action creating the API controller. Right-click on the <span class="strong">&#13;
<strong>Controllers</strong>&#13;
</span>&#13;
 folder and select <span class="strong">&#13;
<strong>Add |</strong>&#13;
</span>&#13;
  <span class="strong">&#13;
<strong>New Item</strong>&#13;
</span>&#13;
 . Then select <span class="strong">&#13;
<strong>Web API Controller Class</strong>&#13;
</span>&#13;
 from the list, as shown in the following screenshot. Name your Controller, and click the <span class="strong">&#13;
<strong>Add</strong>&#13;
</span>&#13;
 button:</p>&#13;
<div class="mediaobject"><img src="Image00208.jpg" alt="Dependency Injection"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>Remove the generated code in the Controller and add the following constructor:</p>&#13;
<pre class="programlisting">public EmployeeController(IEmployeeRepository employeesRepo)
{
  employeeRepository = employeesRepo;
}
private IEmployeeRepository employeeRepository {get; set;}</pre>&#13;
<p>In the preceding constructor, we are injecting the dependency. At the time of calling this constructor, the <code class="literal">EmployeeRepository</code>&#13;
 object will be created.</p>&#13;
<p>Let us implement a couple of <code class="literal">GET</code>&#13;
 methods—the first one will return all the employees' details and the second <code class="literal">GET</code>&#13;
 method will return the employee based on the passed employee ID:</p>&#13;
<pre class="programlisting">public IEnumerable&lt;Employee&gt; GetAll()
{
  return employeeRepository.GetAllEmployees();
}

[HttpGet("{id}",Name ="GetEmployee")]
public IActionResult GetById(int id)
{
  var employee = employeeRepository.GetEmployee(id);
  if(employee == null)
  {
  return NotFound();
  }
  return new ObjectResult(employee);
}</pre>&#13;
<p>Let us call these HTTP methods from Fiddler.</p>&#13;
<p>Run the solution, open the Fiddler application, and click on the <span class="strong">&#13;
<strong>Composer</strong>&#13;
</span>&#13;
 tab.</p>&#13;
<p>Select the HTTP method (we have chosen the <code class="literal">GET</code>&#13;
 method as we have a GET API method) and enter the URL <code class="literal">http://localhost:49933/api/employee</code>&#13;
 .</p>&#13;
<p>Please note that when I run my application, it runs on port <code class="literal">49933</code>&#13;
 ; the port number will be different in your case, so construct your URL accordingly.</p>&#13;
<p>Once you enter the URL and the method is selected, click the <span class="strong">&#13;
<strong>Execute</strong>&#13;
</span>&#13;
 button as shown in the following screenshot:</p>&#13;
<div class="mediaobject"><img src="Image00209.jpg" alt="Dependency Injection"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>Once you click the <span class="strong">&#13;
<strong>Execute</strong>&#13;
</span>&#13;
 button, an HTTP session will be created, and the request will be fired.</p>&#13;
<p>Click on the session on the left-hand side pane (as shown in the following screenshot) and select the <span class="strong">&#13;
<strong>Inspectors</strong>&#13;
</span>&#13;
 tab in the right-hand side pane. You can view the result in the <span class="strong">&#13;
<strong>JSON</strong>&#13;
</span>&#13;
 tab in the bottom right-hand side pane:</p>&#13;
<div class="mediaobject"><img src="Image00210.jpg" alt="Dependency Injection"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>Let us fire another HTTP request to get a particular employee's information, say the employee whose ID is 2. We would construct the URL by appending the ID <code class="literal">http://localhost:49933/api/employee/2</code>&#13;
  as following:</p>&#13;
<div class="mediaobject"><img src="Image00211.jpg" alt="Dependency Injection"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>Select the recently created HTTP session and click on it:</p>&#13;
<p>You can see the result in JSON format in the right-hand side pane.</p>&#13;
<p>Now, we are going to add <code class="literal">Create</code>&#13;
 , <code class="literal">Update</code>&#13;
 , and <code class="literal">Delete</code>&#13;
 operations to our service. To start with, we are going to provide the Create functionality to add employees' to our service:</p>&#13;
<pre class="programlisting">[HttpPost]
public IActionResult Add([FromBody] Employee emp)
{
  if (emp == null)
  {
    return BadRequest();
  }
  employeeRepository.AddEmployee(emp);
  return CreatedAtRoute("GetEmployee", new { id = emp.Id }, emp);
}</pre>&#13;
<p>The following points should be considered when following the preceding <code class="literal">Add</code>&#13;
 method:</p>&#13;
<div class="orderedlist">&#13;
<ol class="orderedlist arabic">&#13;
<li class="listitem" value="1">We are passing the <code class="literal">Employee</code>&#13;
 object as a parameter. We are instructing the <code class="literal">Add</code>&#13;
 method to take that object from the body of the request by specifying a <code class="literal">[FromBody]</code>&#13;
 attribute:<div class="itemizedlist">&#13;
<ul class="itemizedlist">&#13;
<li class="listitem">If no employee object is passed, we would be returning the bad request to the calling client</li>&#13;
<li class="listitem">If it is not null, we would be calling the repository method to add the employee to our list (in the real world, we would be adding it to the database)</li>&#13;
</ul>&#13;
</div>&#13;
</li>&#13;
<li class="listitem" value="2">Once we have added the employee, we are returning the <span class="emphasis">&#13;
<em>201 status code</em>&#13;
</span>&#13;
 (as per the HTTP standards) when a new resource is created.</li>&#13;
</ol>&#13;
<div style="height:10px; width: 1px"/>&#13;
</div>&#13;
<p>Open the Fiddler application and follow these steps to add the employee:</p>&#13;
<div class="orderedlist">&#13;
<ol class="orderedlist arabic">&#13;
<li class="listitem" value="1">Select the HTTP method as <code class="literal">POST</code>&#13;
 and enter the URL <code class="literal">http://localhost:54504/api/employee/</code>&#13;
 .</li>&#13;
<li class="listitem" value="2">You need to specify the content type as <code class="literal">application/json</code>&#13;
  in the request header. Please see the following screenshot, where we have added <code class="literal">Content-Type: application/json</code>&#13;
 to the request header.</li>&#13;
<li class="listitem" value="3">As mentioned in the code, we have to pass the employee object in the form of JSON in the body of the request. In the following request, we have formed a JSON that contains the properties of the <code class="literal">Employee</code>&#13;
 object with the values in the brackets { "FirstName" : "James", "LastName" : "Anderson","Department" : "IT"}:<div class="mediaobject"><img src="Image00212.jpg" alt="Dependency Injection"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
</li>&#13;
</ol>&#13;
<div style="height:10px; width: 1px"/>&#13;
</div>&#13;
<p>Once you have composed the request, you can click the <span class="strong">&#13;
<strong>Execute</strong>&#13;
</span>&#13;
 button to fire the request. This will return the <span class="emphasis">&#13;
<em>201 HTTP status code</em>&#13;
</span>&#13;
 , which is the standard HTTP response for creating a new resource:</p>&#13;
<div class="mediaobject"><img src="Image00213.jpg" alt="Dependency Injection"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>As soon as we have created the resource in the server, we are redirecting the response to get the newly created resource. This occurs when we call the <code class="literal">CreatedAtRoute</code>&#13;
 method with the newly created employee ID passed as a parameter.</p>&#13;
<p>Click on the session on the left-hand side and select the <span class="strong">&#13;
<strong>Inspector</strong>&#13;
</span>&#13;
 tab in the right-hand side pane. Now you can see the response of the request. The response contains the <code class="literal">Employee</code>&#13;
 object which was newly created in the server. We have to note that the ID of the <code class="literal">Employee</code>&#13;
 object is generated at the server, and is available in the following response. In this case, the ID generated for the employee is <code class="literal">1771082655</code>&#13;
 :</p>&#13;
<div class="mediaobject"><img src="Image00214.jpg" alt="Dependency Injection"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>In the bottom right-hand side panel in the preceding Fiddler window, we can see the complete JSON response of the newly created resource.</p>&#13;
<p>Now we are going to add a Web API method to update the resource. The method for updating the resource is very similar to that used to create the resource, with only a few differences. When we created the resource, we used the <code class="literal">HTTP POST</code>&#13;
 method, whereas when we updated the resource, we used the <code class="literal">HTTP PUT</code>&#13;
 method.</p>&#13;
<p>If the passed employee ID could not be found in the repository, we return a <span class="emphasis">&#13;
<em>404 error</em>&#13;
</span>&#13;
 response, the HTTP standard error response for a resource that has not been found.</p>&#13;
<p>The following is the Web API controller method code for updating the resource:</p>&#13;
<pre class="programlisting">[HttpPut]
public IActionResult Update([FromBody] Employee emp)
{
  if( emp == null)
  {
    return BadRequest();
  }
  Employee employee = employeeRepository.GetEmployee(emp.Id);
  if(employee == null)
  {
    return NotFound();
  }
  employeeRepository.UpdateEmployee(emp);
  return new NoContentResult();
}</pre>&#13;
<p>The following is the repository layer code for updating the employee:</p>&#13;
<pre class="programlisting">public void UpdateEmployee(Employee emp)
{
  Employee employee = employees.Where(e =&gt; e.Id == emp.Id).FirstOrDefault();
  if (employee != null)
  {
    employee.Department = emp.Department;
    employee.FirstName = emp.FirstName;
    employee.LastName = emp.LastName;
  }
}</pre>&#13;
<p>Open the Fiddler application, and compose a request of <code class="literal">HTTP PUT</code>&#13;
 . As we are going to pass the <code class="literal">Employee</code>&#13;
 object in the body of the request, we need to mention the content type as <code class="literal">application/json</code>&#13;
 . In the body of the request, we need to supply the <code class="literal">Employee</code>&#13;
 object in JSON format, as shown in the following screenshot:</p>&#13;
<div class="mediaobject"><img src="Image00215.jpg" alt="Dependency Injection"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>When you click the <span class="strong">&#13;
<strong>Execute</strong>&#13;
</span>&#13;
 button, the <code class="literal">HTTP PUT</code>&#13;
 request will be fired and our Web API method will get called. Once it succeeds, the <span class="emphasis">&#13;
<em>HTTP 204</em>&#13;
</span>&#13;
 response will be returned:</p>&#13;
<div class="mediaobject"><img src="Image00216.jpg" alt="Dependency Injection"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<div class="section" title="Delete method">&#13;
<div class="titlepage">&#13;
<div>&#13;
<div>&#13;
<h2 class="title"><a id="ch10lvl2sec69"/>&#13;
 Delete method</h2>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
<p>The <code class="literal">HTTP DELETE</code>&#13;
 method should be used when deleting a resource. There is no need to pass anything in the body of the request.</p>&#13;
<div class="section" title="The Web API method for deleting a resource">&#13;
<div class="titlepage">&#13;
<div>&#13;
<div>&#13;
<h3 class="title"><a id="ch10lvl3sec27"/>&#13;
 The Web API method for deleting a resource</h3>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
<p>The <code class="literal">Delete</code>&#13;
 Web API method has a <code class="literal">void</code>&#13;
 return type, which will return an <span class="emphasis">&#13;
<em>HTTP 200</em>&#13;
</span>&#13;
 response:</p>&#13;
<pre class="programlisting">[HttpDelete("{id}")]
public void Delete(int id)
{
  employeeRepository.RemoveEmployee(id);
}</pre>&#13;
</div>&#13;
<div class="section" title="Web Repository layer code for deleting the employee data">&#13;
<div class="titlepage">&#13;
<div>&#13;
<div>&#13;
<h3 class="title"><a id="ch10lvl3sec28"/>&#13;
 Web Repository layer code for deleting the employee data</h3>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
<p>In the following repository layer method, we are removing the employee (whose ID matches with that of the parameter passed) from the internal list of employees. But in the real world, we would be interacting with the database to delete that particular employee. Consider the following code:</p>&#13;
<pre class="programlisting">public Employee RemoveEmployee(int id)
{
  Employee employee = employees.Where(emp =&gt; emp.Id ==   id).FirstOrDefault();
  if(employee != null)
  {
    employees.Remove(employee);
  }
  return employee;
}</pre>&#13;
<p>Open the Fiddler application, select the <code class="literal">DELETE</code>&#13;
 HTTP method, pass the URL with the parameter, and click on the <span class="strong">&#13;
<strong>Execute</strong>&#13;
</span>&#13;
 button. Please note that we are not passing the content type in the request header as we are not passing any employee object in the body of the request:</p>&#13;
<div class="mediaobject"><img src="Image00217.jpg" alt="Web Repository layer code for deleting the employee data"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>As we are returning void, the Web API <code class="literal">DELETE</code>&#13;
 method returns an <span class="emphasis">&#13;
<em>HTTP 200</em>&#13;
</span>&#13;
 status, as you can see in the left-hand side pane of the Fiddler application:</p>&#13;
<div class="mediaobject"><img src="Image00218.jpg" alt="Web Repository layer code for deleting the employee data"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
</div>&#13;
</div>&#13;
</div>&#13;

<div class="section" title="Summary">&#13;
<div class="titlepage">&#13;
<div>&#13;
<div>&#13;
<h1 class="title"><a id="ch10lvl1sec69"/>&#13;
 Summary</h1>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
<p>In this chapter, you learned about the HTTP service and its purpose. We discussed how to design and implement the HTTP service using Web API. We used the Fiddler tool to construct the HTTP request and get the response back. We also learned how to write the Web API method to perform CRUD operations end to end, from writing the Web API methods to firing the requests and getting the responses back.</p>&#13;
</div>&#13;

<h1>读累了记得休息一会哦~</h1>
<p> </p>
<p><strong>公众号：古德猫宁李</strong></p>
<ul>
<li>电子书搜索下载</li>
<li>书单分享</li>
<li>书友学习交流</li>

<p> </p>
</ul>
<p><strong>网站：</strong><a href="https://www.chenjin5.com">沉金书屋 https://www.chenjin5.com</a></p>
<ul>
<li>电子书搜索下载</li>
<li>电子书打包资源分享</li>
<li>学习资源分享</li>

</ul>
</body></html>