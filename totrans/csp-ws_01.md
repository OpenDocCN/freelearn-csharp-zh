# 1. 欢迎来到 C#

概述

本章将向您介绍 C# 的基础知识。您将从学习 .NET 命令行界面 (CLI) 的基础知识以及如何使用 Visual Studio Code (VS Code) 作为基本集成开发环境 (IDE) 开始。然后，您将了解各种 C# 数据类型以及如何为这些类型声明变量，之后将进入关于算术和逻辑运算符的部分。到本章结束时，您将了解如何处理异常和错误，并能够用 C# 编写简单的程序。

# 简介

C# 是一种在 2000 年代初期由微软团队创建的编程语言，该团队由安德斯·海尔斯伯格领导，他也是一些其他流行语言的创造者之一，例如 Delphi 和 Turbo Pascal，这两种语言在 1990 年代被广泛使用。在过去 20 年中，C# 不断发展和演变，根据 Stack Overflow 的 2020 年洞察，如今它已成为全球最广泛使用的编程语言之一。

它在技术社区中占据如此崇高的地位有其原因。C# 允许你为广泛的市场和设备编写应用程序。从具有高安全标准的银行业务，到拥有巨大交易量的电子商务公司，它是一种被需要性能和可靠性的公司所信赖的语言。除此之外，C# 还使得编写 Web、桌面、移动甚至物联网应用程序成为可能，让你可以为几乎任何类型的设备进行开发。

C# 最初仅限于在 Windows 上运行；然而，在过去几年中，C# 团队已经做出了共同努力，使其实现跨平台兼容。如今，它可以与所有主要操作系统发行版一起使用，即 Windows、Linux 和 macOS。目标很简单：在任何地方开发、构建和运行 C#，让每个开发者和团队选择他们最 productive 或最喜欢的环境。

C# 的另一个显著特点是它是一种强类型编程语言。您将在接下来的部分中深入了解这一点，并看到强类型在编程时能够提供更好的数据安全性。

此外，C# 在过去几年中已成为开源语言，微软是其主要维护者。这非常有优势，因为它允许语言从全球范围内持续改进，并得到一个既推广又投资的稳固公司的支持。C# 也是一种多范式语言，这意味着你可以用它以多种编程风格编写软件，以美观、简洁和正确的方式。

# 使用 .NET CLI 运行和开发 C#

在 C# 世界中，你将经常听到一个术语 .NET。它是 C# 的基础，是一个语言构建在其之上的框架。它既有一个软件开发工具包 (SDK)，允许开发语言，也有一个运行时，允许语言运行。

话虽如此，要开始使用 C# 进行开发，你只需要安装 .NET SDK。此安装将在开发环境中提供编译器和运行时。在本节中，你将了解为在本地开发和运行 C# 准备环境的基本步骤。

注意

请参阅本书的*前言*部分，了解如何逐步下载 .NET 6.0 SDK 并将其安装到你的机器上的详细说明。

一旦完成 .NET 6.0 SDK 的安装，你将拥有一个称为 .NET CLI 的东西。这个命令行界面（CLI）允许你使用非常简单的命令直接从你的终端创建新项目、编译它们并运行它们。

安装后，在你的首选终端中运行以下命令：

[PRE0]

你应该看到如下输出：

[PRE1]

此输出显示你在计算机上安装了 6.0.100 版本的 SDK。这意味着你已准备好开始开发你的应用程序。如果你输入 `dotnet -–help`，你会注意到 CLI 中将出现几个命令供你选择运行。在本节中，你将了解你需要创建和运行应用程序的最基本命令：`new`、`build` 和 `run`。

`dotnet new` 命令允许你创建一个引导项目以开始开发。CLI 有几个内置模板，它们只是为各种类型的应用程序（如 Web 应用程序、桌面应用程序等）提供的基本引导。在 `dotnet new` 命令中，你必须指定两件事：

+   模板名称

+   项目名称

名称作为参数传递，这意味着你应该使用 `-n` 或 `–name` 标志来指定它。命令如下：

[PRE2]

例如，要创建一个名为 `MyConsoleApp` 的新控制台应用程序，你可以简单地输入：

[PRE3]

这将生成一个新文件夹，其中包含一个名为 `MyConsoleApp.csproj` 的文件，这是编译器构建你的项目所需的全部元数据文件，以及构建和运行应用程序所需的某些文件。

接下来，`dotnet build` 命令允许你构建一个应用程序并使其准备好运行。此命令应仅放置在两个位置：

+   一个包含 `.csproj` 文件的项目文件夹。

+   包含 `.sln` 文件的文件夹。

解决方案（`.sln`）文件是包含一个或多个项目文件元数据的文件。它们用于将多个项目文件组织成单个构建。

最后，第三个重要的命令是 dotnet `run`。此命令允许你正确地运行应用程序。你可以在包含你的 .NET 应用 `.csproj` 文件的文件夹中不带任何参数调用此命令，或者不带 `-–project` 标志通过 CLI 传递项目文件夹。`run` 命令还会在运行之前自动构建应用程序。

## 使用 CLI 和 VS Code 创建程序

在阅读本书的过程中，您将使用 Visual Studio Code (VS Code) 作为您的代码编辑器。它适用于所有平台，您可以在 https://code.visualstudio.com/ 下载适用于您操作系统的版本。尽管 VS Code 不是一个完整的集成开发环境 (IDE)，但它拥有许多扩展，使其成为开发 C# 的强大工具，无论使用的是哪种操作系统。

为了正确开发 C# 代码，你主要需要安装 Microsoft C# 扩展。它为 VS Code 提供了代码补全和识别错误的能力，可在 [https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csharp](https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csharp) 获取。

注意

在继续之前，建议您安装 VS Code 和 Microsoft C# 扩展。您可以在本书的 *前言* 中找到安装过程的逐步说明。

## C# 程序的基本结构

为了运行，每个 C# 程序都需要一个称为入口点的东西。在 C# 中，程序的默认入口点是 `Main` 方法。无论您的程序类型如何，是 Web 应用程序、桌面应用程序，甚至是简单的控制台应用程序，`Main` 方法都将作为您的 C# 程序的 **入口点**。这意味着每次应用程序运行时，运行时都会在您的代码中搜索此方法并执行其中的代码块。

此结构由 CLI 的 `new` 命令为您创建。一个 `Program.cs` 文件包含一个名为 `Program` 的类，其中有一个名为 `Main` 的方法，该方法包含一个在程序构建并运行后将被执行的单一指令。您将在以后学习更多关于方法和类的内容，但就现在而言，只需知道类通常是包含一组数据的东西，并且可以通过这些 **方法** 对这些数据进行操作。

关于基本 C# 概念的另一个重要注意事项是 `//`。

## 练习 1.01：创建一个输出 "Hello World" 的控制台应用程序

在这个练习中，您将看到上一节中学习的 CLI 命令，在构建您的第一个 C# 程序时。它将是一个简单的控制台应用程序，将在控制台上打印 `Hello World`。

执行以下步骤来完成此操作：

1.  打开 VS Code 集成终端并输入以下内容：

    [PRE4]

此命令将在 `Exercise1_01` 文件夹中创建一个新的控制台应用程序。

1.  在命令行中，输入以下内容：

    [PRE5]

您应该看到以下输出：

![图 1.1: "Hello World" 在控制台上的输出](img/B16835_01_01.jpg)

图 1.1: "Hello World" 在控制台上的输出

注意

您可以在 [https://packt.link/HErU6](https://packt.link/HErU6) 找到此练习使用的代码。

在这个练习中，你使用 C# 创建了可能的最基本程序，这是一个将一些文本打印到提示符的控制台应用程序。你还学习了如何使用 .NET CLI，这是 .NET SDK 内部构建的机制，用于创建和管理 .NET 项目。

现在继续下一节，了解如何编写顶层语句。

### 顶层语句

你一定注意到了在*练习1.01*中，默认情况下，当你创建一个控制台应用程序时，你会有一个`Program.cs`文件，其中包含以下内容：

+   一个名为`Program`的类。

+   静态void `Main`关键字。

你将在后面详细学习类和方法，但就目前而言，为了简单起见，你不需要这些资源来使用C#创建和执行程序。最新版本(.NET 6)引入了一个功能，使得编写简单的程序更加容易和简洁。例如，考虑以下：

[PRE6]

你可以简单地用以下两行代码替换这个片段，如下所示：

[PRE7]

通过使用这样的顶层语句，你可以编写简洁的程序。你只需将需要执行的语句放在程序顶部即可。这也有助于加快学习C#的曲线，因为你不需要一开始就担心高级概念。这里唯一需要注意的是，项目只能有一个包含顶层语句的文件。

正因如此，在本章中，你会发现所有练习都将使用这种格式，以便尽可能清晰地说明。

## 声明变量

你现在将迈出创建自己程序的第一步。本节将深入探讨变量的概念——它们是什么以及如何使用它们。

变量是给计算机内存位置起的名字，该位置存储了一些可能变化的数据。为了使变量存在，它首先必须用类型和名字**声明**。它也可以给它赋值。变量的声明可以通过几种不同的方式实现。

关于C#中变量命名约定的基本考虑如下：

+   名称必须是唯一的，以字母开头，并且只能包含字母、数字和下划线字符（`_`）。名称也可以以下划线字符开头。

+   名称是区分大小写的；因此，`myVariable`和`MyVariable`是不同的名称。

+   保留关键字，如`int`或`string`，不能用作名称（这是一个编译器限制），除非你在名称前加上`@`符号，例如`@int`或`@string`。

变量可以通过两种方式声明：显式和隐式。这两种声明方式都有其优缺点，你将在下一节中探讨。

### 显式声明变量

可以通过写出其类型和值来**显式声明**一个变量。假设你想要创建两个变量，`a`和`b`，它们都包含整数。这样做显式地看起来像这样：

[PRE8]

在使用变量之前，必须给它赋值。否则，C#编译器在构建你的程序时会报错。以下示例说明了这一点：

[PRE9]

你也可以在同一行声明多个变量，如下面的代码片段所示，其中你声明了三个变量；两个变量持有值`100`，一个变量持有值`10`：

[PRE10]

### 隐式声明变量

记住，C# 是一种强类型编程语言；这意味着变量将始终与一个类型相关联。无论类型是隐式声明还是显式声明，使用 `var` 关键字，C# 编译器都会根据已分配给它的值推断变量类型。

假设你想使用这种方法创建一个包含一些文本的变量。这可以通过以下语句完成：

[PRE11]

要在变量中存储文本，你应该使用双引号（`"`）开始和结束文本。在上面的例子中，通过查看分配给 `name` 的值，C# 知道这个变量持有的类型是字符串，即使声明中没有提到类型。

### 显式声明与隐式声明

显式声明通过声明类型提高了可读性，这是这种技术的主要优点之一。另一方面，它们往往会使得代码变得更加冗长，尤其是在处理一些数据类型（你将在后面看到）时，例如 `Collections`。

实际上，选择声明风格取决于程序员的个人喜好，在某些情况下可能还会受到公司指南的影响。在学习之旅中，建议你选择一种可以使你的学习路径更加顺畅的风格，因为从纯粹的技术角度来看，它们之间几乎没有实质性的区别。

在下一个练习中，你将亲自通过将变量分配给来自用户与控制台应用程序交互的输入来完成这个任务，用户将被要求输入他们的名字。为了完成这个练习，你将使用 C# 提供的以下内置方法，你将在你的 C# 之旅中经常使用这些方法：

+   `Console.ReadLine()`: 这允许你检索用户在控制台上提示的值。

+   `Console.WriteLine()`: 这会将作为参数传递的值作为输出写入控制台。

## 练习 1.02：将变量分配给用户输入

在这个练习中，你将创建一个交互式控制台应用程序。该应用程序应该要求你输入你的名字，一旦提供，它应该显示包含你的名字的问候语。

要完成这个练习，请执行以下步骤：

1.  打开命令提示符并输入以下内容：

    [PRE12]

此命令在 `Exercise1_02` 文件夹中创建一个新的控制台应用程序。

1.  打开 `Program.cs` 文件。在 `Main` 方法中粘贴以下内容：

    [PRE13]

1.  保存文件。在命令行中，输入以下内容：

    [PRE14]

这将输出以下内容：

[PRE15]

1.  现在，请在控制台中输入你的名字，然后按键盘上的 `Enter` 键。例如，如果你输入 `Mateus`，以下将是输出结果：

    [PRE16]

    注意

    你可以在 [https://packt.link/1fbVH](https://packt.link/1fbVH) 找到用于此练习的代码。

你对变量是什么、如何声明它们以及如何给它们赋值已经很熟悉了。现在，是时候开始讨论这些变量可以存储什么数据了，更具体地说，是讨论有哪些数据类型。

# 数据类型

在本节中，你将讨论C#中的主要数据类型及其功能。

## 字符串

C#使用`string`关键字来标识存储文本作为字符序列的数据。你可以以多种方式声明字符串，如下面的代码片段所示。然而，当将某个值赋给字符串变量时，你必须将内容放在一对双引号之间，如最后两个示例所示：

[PRE17]

一种简单但有效的技术（你在前面的*练习1.02*中使用过）称为字符串插值。使用这种技术，将普通文本值与变量值混合变得非常简单，这样文本就可以在这两者之间结合。你可以通过以下步骤组合两个或多个字符串：

1.  在初始引号之前插入一个`$`符号。

1.  现在，在字符串中放置大括号和你要放入字符串中的变量的名称。在这种情况下，这是通过在初始字符串中放置`{name}`来完成的：

    [PRE18]

关于字符串，需要记住的另一个重要事实是它们是不可变的。这意味着字符串对象在创建后不能被更改。这是因为C#中的字符串是一个字符数组。数组是收集相同类型对象并具有固定长度的数据结构。你将在接下来的章节中详细学习数组。

在下一个练习中，你将探索字符串不可变性。

## 练习1.03：检查字符串不可变性

在这个练习中，你将使用两个字符串来演示字符串引用始终是不可变的。执行以下步骤来完成此操作：

1.  打开VS Code集成终端并输入以下内容：

    [PRE19]

1.  打开`Program.cs`文件，创建一个具有`void`返回类型的方法，该方法替换字符串的一部分，如下所示：

    [PRE20]

在前面的代码片段中，使用了`Replace`函数将第一个字符串（在这个例子中是`World`）替换为第二个字符串（`Mars`）。

1.  现在，创建一个执行相同操作但返回结果的方法：

    [PRE21]

1.  现在在前面方法之后插入以下内容。在这里，你创建了两个字符串变量，并在尝试使用前面创建的方法修改它们后观察它们的行为：

    [PRE22]

1.  最后，从命令行调用`dotnet run --project Exercise1_03`。你应该在控制台上看到以下输出：

    [PRE23]

    注意

    你可以在[https://packt.link/ZoNiw](https://packt.link/ZoNiw)找到用于此练习的代码。

通过这个练习，你看到了字符串不可变性的实际应用。当你传递一个作为引用类型的字符串（`Hello World!`）作为方法参数时，它没有被修改。这就是当你使用返回`void`的`FormatString`方法时发生的情况。由于字符串不可变性，会创建一个新的字符串，但不会分配给任何变量，原始字符串保持不变。第二个方法返回一个新的字符串，然后这个字符串被打印到控制台。

## 字符串比较

即使字符串是引用类型，当你使用 `.Equals()` 方法、等号运算符 (`==`) 和其他运算符（例如 `!=`）时，你实际上是在比较字符串的值，如下例所示：

[PRE24]

现在，你可以比较这些值并调用 `Console.WriteLine()` 来输出结果，如下所示：

[PRE25]

运行前面的代码会产生以下输出：

[PRE26]

你得到这个输出是因为，尽管字符串是引用类型，但 `==` 和 `.Equals` 比较都是针对字符串值进行的。还要记住，字符串是不可变的。这意味着当你将 `second` 赋值给 `first` 并将 `first` 设置为 `null` 时，会为 `first` 创建一个新的值，因此 `second` 的引用不会改变。

## 数值类型

C# 将其数值类型分为两大类——整型数和浮点型数。整型数类型如下：

+   `sbyte`: 存储从 -128 到 127 的值

+   `short`: 存储从 -32,768 到 32,767 的值

+   `int`: 存储从 -2,147,483,648 到 2,147,483,647 的值

+   `long`: 存储从 -9,223,372,036,854,775,808 到 9,223,372,036,854,775,807 的值

选择使用哪种整型取决于你想要存储的值的范围。

所有这些类型都称为有符号值。这意味着它们可以存储负数和正数。还有另一系列类型称为无符号类型。无符号类型是 `byte`、`ushort`、`uint` 和 `ulong`。它们之间的主要区别是有符号类型可以存储负数，而无符号类型只能存储大于或等于零的数字。你将大多数时间使用有符号类型，所以不必担心一次性记住所有这些。

另一类，即浮点类型，指的是用于存储带有一个或多个小数点的数字的类型。在 C# 中有三种浮点类型：

+   `float`: 占用四个字节，可以存储从 ± 1.5 x 10−45 到 ± 3.4 x 1038 的数字，精度范围为六到九位数字。要使用 `var` 声明一个浮点数，你只需在数字末尾附加 `f`，如下所示：

    [PRE27]

+   `double`: 占用八个字节，可以存储从 ± 5.0 × 10−324 到 ± 1.7 × 1030 的数字，精度范围为 15 到 17 位数字。要使用 `var` 声明一个双精度数，你可以在数字末尾附加 `d`，如下所示：

    [PRE28]

+   `decimal`: 占用 16 字节，可以存储从 ± 1.0 x 10-28 到 ± 7.9228 x 1028 的数字，精度范围为 28 到 29 位数字。要使用 `var` 声明一个十进制数，你只需在数字末尾附加 `m`，如下所示：

    [PRE29]

选择浮点数类型主要取决于所需的精度程度。例如，`decimal` 主要用于需要非常高的精度且不能依赖四舍五入进行准确计算的金融应用程序。对于 GPS 坐标，如果你想要处理通常有 10 位数字的亚米精度，`double` 变量可能很合适。

在选择数值类型时，还需要考虑的一个相关点是性能。分配给变量的内存空间越大，使用这些变量的操作性能就越低。因此，如果不需要高精度，`float`类型的变量将比`double`类型的变量性能更好，而`double`类型的变量又将比`decimal`类型的变量性能更好。

现在你已经掌握了变量及其主要类型的概念。接下来，你将使用它们进行一些基本的计算，例如加法、减法和乘法。这可以通过C#中可用的算术运算符来完成，如`+`、`-`、`/`和`*`。因此，继续进行下一个练习，你将使用这些运算符创建一个基本的计算器。

## 练习1.04：使用基本算术运算符

在这个练习中，你将创建一个简单的计算器，它接收两个输入并显示它们之间的结果，这取决于选定的算术运算。

以下步骤将帮助你完成这个练习：

1.  打开VS Code集成终端，并输入以下命令：

    [PRE30]

1.  导航到项目文件夹，打开`Program.cs`文件，然后在`Main`方法中声明两个变量来读取用户输入，如下所示：

    [PRE31]

前面的代码片段使用了`.ReadLine`方法来读取输入。然而，这个方法返回的是一个`string`类型，而你需要评估一个数字。因此，这里使用了`Parse`方法。所有数值类型都有一个名为`Parse`的方法，它接收一个字符串并将其转换为数字。

1.  接下来，你需要将这些基本运算符的输出写入控制台。将以下代码添加到`Main`方法中：

    [PRE32]

1.  使用`dotnet run`命令运行程序，如果你输入`10`和`20`，你应该会看到以下输出：

    [PRE33]

    注意

    你可以在[https://packt.link/ldWVv](https://packt.link/ldWVv)找到这个练习使用的代码。

因此，你已经使用算术运算符在C#中构建了一个简单的计算器应用程序。你还学习了解析的概念，它用于将字符串转换为数字。在下一节中，将简要介绍类，这是C#编程的核心概念之一。

# 类

类是C#编程的一个基本组成部分，将在*第2章*，*构建高质量面向对象代码*中全面介绍。本节将介绍类的基础知识，以便你可以在程序中使用它们。

在C#中，当你想要定义一个对象类型时，会使用保留的`class`关键字。一个对象，也可以称为实例，不过是一个分配了内存块来存储信息的实体。根据这个定义，类的作用就是通过一些属性来描述这个对象，并指定这个对象可以通过方法执行的操作，从而作为对象的蓝图。

例如，假设你有一个名为`Person`的类，具有两个属性`Name`和`Age`，以及一个检查`Person`是否为孩子的方法。方法是可以放置逻辑以执行某些操作的地方。它们可以返回特定类型的数据，或者有特殊的`void`关键字，表示它们不返回任何内容，只是执行一些操作。你还可以有调用其他方法的方法：

[PRE34]

尽管如此，还有一个问题。由于类充当蓝图（或者如果你更喜欢，定义），你实际上是如何为类定义的信息分配内存的？这是通过一个称为实例化的过程来完成的。当你实例化一个对象时，你会在一个称为堆的预留区域为其分配一些内存空间。当你将一个变量分配给一个对象时，你是在设置这个变量，使其拥有这个内存空间的地址，因此每次你操作这个变量时，它都会指向并操作在这个内存空间分配的数据。以下是一个简单的实例化示例：

[PRE35]

注意，`Person`具有具有两个魔法关键字的属性——`get`和`set`。获取器定义了可以检索属性值，而设置器定义了可以设置属性值。

另一个重要的概念是构造函数的概念。构造函数是一个没有返回类型的方法，通常位于类的顶层，以提高可读性。它指定了创建对象所需的内容。默认情况下，类将始终有一个无参数的构造函数。如果定义了具有参数的另一个构造函数，则类将仅限于这个一个。在这种情况下，如果你仍然想要一个无参数的构造函数，你必须指定一个。这非常有用，因为类可以有多个构造函数。

话虽如此，你可以以下方式为具有设置器的对象属性赋值：

+   在创建时，通过其构造函数：

    [PRE36]

+   在创建时，通过直接变量赋值：

    [PRE37]

+   在对象创建后，如下所示：

    [PRE38]

在你接下来会看到的类中，还有很多内容。目前，主要思想如下：

+   类是对象的蓝图，可以具有描述这些对象的属性和方法。

+   对象需要被实例化，这样你才能对它们执行操作。

+   类默认有一个无参数的构造函数，但可以根据需要有许多自定义的构造函数。

+   对象变量是引用，包含分配给对象在名为堆的专用内存区域内的特殊内存地址。

# 日期

在C#中，可以使用`DateTime`值类型来表示日期。它是一个具有两个静态属性的结构体，分别称为`MinValue`和`MaxValue`，其中`MinValue`是公元0001年1月1日00:00:00，而`MaxValue`是公元9999年12月31日23:59:59。正如其名称所暗示的，这两个值都代表了根据格里高利日历日期格式的最小和最大日期。`DateTime`对象的默认值是`MinValue`。

可以以多种方式构造 `DateTime` 变量。以下是一些最常见的方法：

+   按如下方式分配当前时间：

    [PRE39]

这将变量设置为调用计算机上的当前日期和时间，以本地时间表示。

[PRE40]

这将变量设置为这台计算机上的当前日期和时间，以协调世界时（UTC）表示。

+   您还可以使用构造函数传递天数、月份、年份、小时、分钟，甚至秒和毫秒。

+   对于 `DateTime` 对象，还有一个特殊属性称为 `Ticks`。它是自 `DateTime.MinValue` 以来经过的 100 纳秒数的度量。每次您有这种类型的对象时，都可以调用 `Ticks` 属性来获取这样的值。

+   另一种特殊类型用于日期的是 `TimeSpan` 结构。一个 `TimeSpan` 对象表示一个时间间隔，以天、小时、分钟和秒为单位。当需要获取日期之间的间隔时，它非常有用。现在您将看到它在实际中的应用。

## 练习 1.05：使用日期算术

在这个练习中，您将使用 `TimeSpan` 方法/结构来计算您的本地时间和 UTC 时间之间的差异。为了完成这个练习，请执行以下步骤：

1.  打开 VS Code 集成终端并输入以下内容：

    [PRE41]

1.  打开 `Program.cs` 文件。

1.  将以下代码粘贴到 `Main` 方法中并保存文件：

    [PRE42]

在前面的代码片段中，您首先检查当前本地日期和 UTC 日期是否相等。然后，使用 `TimeSpan` 方法检查它们之间的间隔（如果有的话）。接下来，打印本地时间和 UTC 时间之间的差异，并打印当前日期两天后的日期（在这种情况下为 `31/12/ 2020`）。

1.  保存文件。在命令行中，输入以下内容：

    [PRE43]

您应该看到以下输出：

[PRE44]

注意

您可以在 [https://packt.link/WIScZ](https://packt.link/WIScZ) 找到用于此练习的代码。

注意，根据您的时区，您可能会看到不同的输出。

## 日期格式化

您还可以将 `DateTime` 值格式化为本地化字符串。这意味着根据 C# 语言中称为“文化”的特殊概念来格式化 `DateTime` 实例，它是您本地时间的表示。例如，不同国家的日期表示方式不同。现在请看以下示例，其中日期以法国和美国使用的格式输出：

[PRE45]

您也可以显式定义您希望日期输出的格式，如下例所示，其中传递了 `yyyyMMddTHH:mm:ss` 值，表示您希望日期以年、月、日、时、分（带冒号）和秒（也带冒号）的顺序输出：

[PRE46]

将显示以下输出：

[PRE47]

# 逻辑运算符和布尔表达式

您已经熟悉这些了。回想一下，在前面的练习中，您做了以下比较：

[PRE48]

这个输出将 `true` 值赋给 `now` 如果日期相等。但正如你所知，它们可能并不一定相同。因此，如果日期不同，将分配一个 `false` 值。这两个值是这种布尔表达式的结果，被称为布尔值。这就是为什么 `now` 变量的类型是 `bool`。

布尔表达式是每个程序中每个逻辑比较的基础。基于这些比较，计算机可以在程序中执行特定的行为。以下是一些其他布尔表达式和变量赋值的示例：

+   将检查 `a` 是否大于 `b` 的比较结果赋值：

    [PRE49]

+   将检查 `b` 是否大于或等于 `a` 的比较结果赋值：

    [PRE50]

+   检查两个字符串是否相等，并将此比较的结果赋值给变量：

    [PRE51]

显然，前一个比较的结果将是 `false`，并将这个值赋给 `areTheseAnimalsSame` 变量。

现在你已经学习了什么是布尔值以及它们是如何工作的，现在是时候看看你可以用来比较布尔变量和表达式的逻辑运算符了：

+   `&&`（与）运算符：这个运算符将执行相等比较。如果两者相等则返回 `true`，如果不相等则返回 `false`。考虑以下示例，其中你检查两个字符串的长度是否为 `0`：

    [PRE52]

+   `||`（或）运算符：这个运算符将检查被比较的值中是否至少有一个是 `true`。例如，在这里你检查至少有一个字符串的长度为零：

    [PRE53]

+   `!`（非）运算符：这个运算符取一个布尔表达式或值并取反；也就是说，它返回相反的值。例如，考虑以下示例，其中你取反了一个检查字符串长度是否为零的比较结果：

    [PRE54]

## 使用 if-else 语句

到目前为止，你已经学习了关于类型、变量和运算符的内容。现在，是时候深入了解帮助你将这些概念应用于现实世界问题的机制了——即决策语句。

在 C# 中，`if-else` 语句是实现代码分支的最受欢迎的选择之一，这意味着如果条件满足，则告诉代码遵循一条路径，否则遵循另一条路径。它们是评估布尔表达式并基于此评估结果继续程序执行的逻辑语句。

例如，你可以使用 `if-else` 语句来检查输入的密码是否满足某些标准（例如至少有六个字符和一个数字）。在下一个练习中，你将做 exactly that，在一个简单的控制台应用程序中。

## 练习 1.06：使用 if-else 进行分支

在这个练习中，你将使用`if-else`语句编写一个简单的凭证检查程序。应用程序应该要求用户输入他们的用户名；除非这个值至少有六个字符长，否则用户不能继续。一旦这个条件得到满足，用户应该被要求输入密码。密码也应该至少有六个字符，并且至少包含一个数字。只有当这两个标准都满足后，程序才应显示成功信息，例如`User successfully registered`。

以下步骤将帮助你完成这个练习：

1.  在VS Code集成终端中，创建一个名为`Exercise1_06`的新控制台项目：

    [PRE55]

1.  在`Main`方法中，添加以下代码以请求用户输入用户名，并将值分配给一个变量：

    [PRE56]

1.  接下来，程序需要检查用户名是否超过六个字符，如果不是，则将错误信息写入控制台：

    [PRE57]

1.  现在，在`else`子句中，你将继续验证并要求用户输入密码。一旦用户输入了密码，需要检查三个点。第一个条件是检查密码是否至少有六个字符，然后是否有至少一个数字。然后，如果这些条件中的任何一个失败，控制台应该显示错误信息；否则，应该显示成功信息。为此，添加以下代码：

    [PRE58]

从前面的代码片段中，你可以看到如果用户输入的字符少于六个，会显示错误信息`The password must have at least 6 characters.`。如果密码不包含任何数字但满足前面的条件，则会显示另一个错误信息`The password must contain at least one number.`。

注意这里使用的逻辑条件是`!password.Any(c => char.IsDigit(c))`。你将在*第二章*，*构建高质量面向对象代码*中了解更多关于`=>`符号的内容，但就目前而言，你只需要知道这一行会检查密码中的每个字符，并使用`IsDigit`函数来检查该字符是否为数字。这是对每个字符进行的，如果没有找到数字，则会显示错误信息。如果所有条件都满足，则会显示成功信息`User successfully registered.`。

1.  使用`dotnet run`运行程序。你应该会看到以下输出：

    [PRE59]

    注意

    你可以在[https://packt.link/3Q7oK](https://packt.link/3Q7oK)找到这个练习所使用的代码。

在这个练习中，你使用了if-else分支语句来实现一个简单的用户注册程序。

## 三元操作符

另一个简单易用且有效的决策操作符是三元操作符。它允许你根据布尔比较设置变量的值。例如，考虑以下示例：

[PRE60]

在这里，你使用 `?` 符号来检查它之前放置的布尔条件是否有效。编译器为 `person` 对象运行 `IsChild` 函数。如果该方法返回 `true`，则第一个值（在 `:` 符号之前）将被分配给 `gift` 变量。如果该方法返回 `false`，则第二个值（在 `:` 符号之后）将被分配给 `gift` 变量。

三元运算符简单且使基于简单布尔验证的赋值更加简洁。你将在你的 C# 之旅中经常使用它。

## 引用类型和值类型

C# 中有两种类型的变量，即引用类型和值类型。值类型变量，如结构体，包含自身值，正如其名称所示。这些值存储在称为堆栈的内存空间中。当声明此类类型的变量时，将分配特定的内存空间来存储此值，如下图所示：

![图 1.2：值类型变量的内存分配](img/B16835_01_02.jpg)

图 1.2：值类型变量的内存分配

在这里，变量的值，即 `5`，存储在 RAM 中的 `0x100` 位置。C# 的内置值类型包括 `bool`、`byte`、`char`、`decimal`、`double`、`enum`、`float`、`int`、`long`、`sbyte`、`short`、`struct`、`uint`、`ulong` 和 `ushort`。

引用类型变量的场景不同。在本章中，你需要了解的三个主要引用类型是 `string`、数组和 `class`。当分配新的引用类型变量时，存储在内存中的不是值本身，而是一个值分配的内存地址。例如，考虑以下图示：

![图 1.3：引用类型变量的内存分配](img/B16835_01_03.jpg)

图 1.3：引用类型变量的内存分配

在这里，存储在内存中的不是字符串变量（`Hello`）的值，而是它分配的地址（`0x100`）。为了简洁起见，你不会深入探讨这个主题，但了解以下要点很重要：

+   当值类型变量作为参数传递或作为另一个变量的值分配时，.NET 运行时会将变量的值复制到另一个对象。这意味着原始变量不会受到在较新和后续变量中做出的任何更改的影响，因为值是从一个地方直接复制到另一个地方的。

+   当引用类型变量作为参数传递或作为另一个变量的值分配时，.NET 会传递堆内存地址而不是值。这意味着在方法内部对此变量所做的任何后续更改都将反映在外部。

例如，考虑以下处理整数的代码。这里，你声明一个名为 `a` 的 `int` 变量并将其值设置为 `100`。稍后，你创建另一个名为 `b` 的 `int` 变量并将 `a` 的值赋给它。最后，你修改 `b`，将其增加 `100`：

[PRE61]

`a` 和 `b` 的值将在以下输出中显示：

[PRE62]

在这个例子中，`a` 的值被复制到 `b` 中。从这一点开始，你对 `b` 所做的任何其他修改都只会反映在 `b` 上，而 `a` 将继续保持其原始值。

现在，如果你将引用类型作为方法参数传递，会发生什么？考虑以下程序。这里，你有一个名为 `Car` 的类，具有两个属性——`Name` 和 `GearType`。在程序中有一个名为 `UpgradeGearType` 的方法，它接收 `Car` 类型的对象并将其 `GearType` 更改为 `Automatic`：

[PRE63]

在创建 `Car` 的 `UpgradeGearType()` 方法后，输出将如下所示：

[PRE64]

因此，你可以看到，如果你将一个 `car`（在这种情况下）作为参数传递给一个方法（例如示例中的 `UpgradeGearType`），在这个 **对象** 内部所做的任何更改都会在方法调用之后和外部反映出来。这是因为引用类型引用内存中的特定位置。

## 练习 1.07：掌握值和引用相等

在这个练习中，你将看到值类型和引用类型的相等比较有何不同。执行以下步骤来完成此操作：

1.  在 VS Code 中，打开集成终端并输入以下内容：

    [PRE65]

1.  打开 `Program.cs` 文件。在同一文件中，创建一个名为 `GoldenRetriever` 的结构体，具有 `Name` 属性，如下所示：

    [PRE66]

1.  仍然在同一文件中，创建一个名为 `BorderCollie` 的另一个类，具有类似的 `Name` 属性：

    [PRE67]

1.  还必须创建一个最终的类，一个名为 `Bernese` 的类，也具有 `Name` 属性，但额外重写了原生的 `Equals` 方法：

    [PRE68]

在这里，`this` 关键字用于引用当前的 `borderCollie` 类。

1.  最后，在 `Program.cs` 文件中，你将为这些类型创建一些对象。请注意，由于你正在使用 **顶层语句**，这些声明应该在类和结构体声明之上：

    [PRE69]

1.  现在，在之前的声明之后，使用 `Equals` 方法比较这些值并将结果赋给一些变量：

    [PRE70]

1.  最后，使用以下代码将比较结果打印到控制台：

    [PRE71]

1.  使用 `dotnet run` 从命令行运行程序，你将看到以下输出：

    [PRE72]

    注意

    你可以在 [https://packt.link/xcWN9](https://packt.link/xcWN9) 找到用于此练习的代码。

如前所述，结构体是值类型。因此，当两个相同结构体的对象使用 `Equals` 进行比较时，.NET 内部会检查所有结构体属性。如果这些属性的值相等，则返回 `true`。以 `Golden Retrievers` 为例，如果你有一个 `FamilyName` 属性，并且这个属性在两个对象之间不同，则相等比较的结果将是 `false`。

对于类和所有其他引用类型，相等比较相当不同。默认情况下，在相等比较时检查对象引用。如果引用不同（除非两个变量被分配到同一个对象），相等比较将返回`false`。这解释了示例中`Border Collies`的结果，即两个实例的引用是不同的。

然而，可以在引用类型中实现一个名为`Equals`的方法。给定两个对象，`Equals`方法可以用于在方法内部放置的逻辑之后的比较。这正是Bernese dogs示例中发生的情况。

### 默认值类型

现在你已经处理了值和引用类型，你将简要探索默认值类型。在C#中，每个类型都有一个默认值，如下表所示：

![图1.4：默认值类型表](img/B16835_01_04.jpg)

图1.4：默认值类型表

这些默认值可以使用`default`关键字分配给变量。要在变量声明中使用此词，必须在变量名称之前显式声明变量类型。例如，考虑以下代码片段，其中你将`default`值分配给两个`int`变量：

[PRE73]

在这种情况下，`a`和`b`都将被分配值为`0`。请注意，在这种情况下不能使用`var`。这是因为，对于隐式声明的变量，编译器需要将值分配给变量以推断其类型。因此，以下代码片段将导致错误，因为没有设置类型，无论是通过显式声明还是通过变量赋值：

[PRE74]

## 使用`switch`语句增强决策

当需要测试单个表达式与三个或更多条件时，`switch`语句通常用作if-else结构的替代方案，即当你想要执行多个代码部分中的一个时，如下所示：

[PRE75]

匹配表达式应该返回以下类型之一：`char`、`string`、`bool`、`numbers`、`enum`和`object`。然后，这个值将在匹配的某个case子句或默认子句中进行评估，如果它不匹配任何先前的子句。

重要的是要说明，在`switch`语句中，只有一个`switch`部分会被执行。C#不允许从一个`switch`部分继续执行到下一个。然而，`switch`语句本身并不知道如何停止。你可以使用`break`关键字，如果你只想执行某些操作而不返回，或者如果需要返回某些值。

此外，`switch`语句上的`default`关键字是如果没有匹配其他选项，执行将去的地方。在下一个练习中，你将使用`switch`语句创建一个餐厅菜单应用程序。

## 练习1.08：使用`switch`来点餐

在这个练习中，您将创建一个控制台应用程序，允许用户从餐厅提供的菜单中选择食物项目。应用程序应显示订单的确认收据。您将使用`switch`语句来实现逻辑。

按照以下步骤完成此练习：

1.  创建一个名为`Exercise1_08`的新控制台项目。

1.  现在，创建一个`System.Text.StringBuilder`。这是一个帮助以多种方式构建字符串的类。在这里，您是逐行构建字符串，以便它们可以在控制台上正确显示：

    [PRE76]

1.  在控制台上显示菜单，并要求用户选择一个选项：

    [PRE77]

1.  读取用户按下的键并将其分配给一个变量，使用`Console.ReadKey()`方法。此方法与您之前使用的`ReadLine()`方法类似，区别在于它读取方法调用后立即按下的键。为此添加以下代码：

    [PRE78]

1.  现在是时候使用`switch`语句了。在此处将`option.KeyChar.ToString()`用作`switch`子句的匹配表达式。键`1`、`2`、`3`和`4`应分别导致接受`汉堡`、`芝士汉堡`、`双层芝士汉堡`和`可乐`的订单：

    [PRE79]

然而，任何其他输入都应被视为无效，并显示一条消息，告知您已选择无效选项：

[PRE80]

1.  最后，使用`dotnet run --project Exercise1_08`运行程序，并与控制台交互以查看可能的输出。例如，如果您输入`1`，您应该看到以下输出：

    [PRE81]

    注意

    您可以在[https://packt.link/x1Mvn](https://packt.link/x1Mvn)找到用于此练习的代码。

类似地，您还应该获取其他选项的输出。您已经学习了C#中的分支语句。在用C#编程时，您还会经常使用另一种类型的语句，称为迭代语句。下一节将详细介绍这一主题。

## 迭代语句

迭代语句，也称为循环，是实际应用中有用的语句类型，因为您经常需要在满足某些条件（例如，操作必须递增到某个值的数字）之前，在您的应用程序中连续重复某些逻辑执行。C#提供了多种实现此类迭代的方法，在本节中，您将详细检查这些方法。

### while

您将考虑的第一个迭代语句是`while`语句。此语句允许C#程序在某个布尔表达式评估为`true`时执行一系列指令。它具有最基本的结构之一。考虑以下代码片段：

[PRE82]

前面的代码片段展示了如何使用`while`语句。请注意，`while`关键字后面跟着一对括号，括号内包含一个逻辑条件；在这种情况下，条件是`i`的值必须小于`10`。大括号内编写的代码将在该条件为`true`时执行。

因此，前面的代码将打印从`0`开始的`i`的值，直到`10`。这是一段相当简单的代码；在下一个练习中，您将使用`while`语句进行一些更复杂的操作，例如检查您输入的数字是否为质数。

## 练习1.09：使用`while`循环检查数字是否为质数

在这个练习中，您将使用`while`循环来检查您输入的数字是否为质数。为此，`while`循环将检查计数器是否小于或等于数字除以`2`的整数结果。当这个条件满足时，您检查数字除以计数器的余数是否为`0`。如果不是，您增加计数器并继续，直到循环条件不满足。如果满足，这意味着数字不是`false`，循环可以停止。

执行以下步骤以完成此练习：

1.  在VS Code集成终端中，创建一个名为`Exercise1_09`的新控制台项目。

1.  在`Program.cs`文件中，创建以下方法，该方法将执行您在练习开始时引入的逻辑：

    [PRE83]

1.  现在，输入一个数字，这样您就可以检查它是否为质数：

    [PRE84]

1.  现在，检查数字是否为质数并打印结果：

    [PRE85]

1.  最后，在VS Code集成终端中，调用`dotnet run --project Exercise1_09`并与程序交互。例如，尝试输入`29`作为输入：

    [PRE86]

如预期，`29`的结果为`true`，因为它是一个质数。

注意

您可以在[https://packt.link/5oNg5](https://packt.link/5oNg5)找到用于此练习的代码。

前面的练习旨在向您展示一个带有一些更复杂逻辑的`while`循环的简单结构。它检查一个数字（命名为`input`）并打印它是否为质数。在这里，您再次看到了`break`关键字被用来停止程序执行。现在继续学习跳转语句。

### 跳转语句

在循环中还有一些其他重要的关键字也值得提及。这些关键字被称为跳转语句，用于将程序执行转移到另一个部分。例如，您可以按如下方式重写`IsPrime`方法：

[PRE87]

在这里，您反转了逻辑检查。您不是检查余数是否为零然后中断程序执行，而是检查余数是否不为零，如果是这样，就使用`continue`语句将执行传递到下一个迭代。

现在，看看您如何使用另一个特殊关键字`goto`来重写它：

[PRE88]

可以使用`goto`关键字从一个代码部分跳转到另一个由所谓的标签定义的部分。在这种情况下，标签被命名为`isNotAPrime`。最后，看看另一种编写这种逻辑的方法：

[PRE89]

现在，您不是使用`break`或`continue`来停止程序执行，而是简单地使用`return`来中断循环执行，因为您已经找到了您要找的结果。

### do-while

`do-while` 循环与之前类似，但有一个细微的区别：它至少执行一次逻辑，而简单的 `while` 语句如果首次执行时条件不满足，可能永远不会执行。它具有以下结构：

[PRE90]

在这个例子中，你从 `0` 开始写入 `t` 的值，并在它小于 `5` 时持续递增。在深入研究下一类循环之前，了解一个新概念，即数组。

### 数组

数组是一种用于存储许多相同类型对象的数据结构。例如，以下示例是一个声明为整数数组变量的变量：

[PRE91]

关于数组的一个重要注意事项是它们具有固定容量。这意味着数组在其创建时将定义长度，并且这个长度不能改变。长度可以通过各种方式确定。在前面的例子中，长度是通过计算数组中的对象数量来推断的。然而，创建数组的另一种方式如下：

[PRE92]

在这里，你正在创建一个容量为 `5` 个整数的数组，但你没有为数组元素指定任何值。当创建任何数据类型的数组而不向其中添加元素时，该值类型的默认值将设置为数组的每个位置。例如，考虑以下图示：

![图 1.5：未分配索引的值类型数组](img/B16835_01_05.jpg)

图 1.5：未分配索引的值类型数组

前面的图示显示，当你创建一个包含五个元素的整数数组时，如果不为任何元素分配值，数组将自动在每个位置填充默认值。在这种情况下，默认值是 `0`。现在考虑以下图示：

![图 1.6：具有固定大小和单个索引的引用类型数组](img/B16835_01_06.jpg)

图 1.6：具有固定大小和单个索引的引用类型数组

在前面的例子中，你创建了一个包含五个对象的数组，并将 `"Hello"` 字符串值分配给索引 `1` 的元素。数组的其他位置自动分配对象的默认值，该默认值为 `null`。

最后，值得注意的是，所有数组都有索引，这指的是单个数组元素的位置。第一个位置始终具有索引 `0`。因此，大小为 `n` 的数组中的位置可以从索引 `0` 到 `n-1` 指定。因此，如果你调用 `numbers[2]`，这意味着你正在尝试访问 `numbers` 数组中的位置 `2` 的元素。

### for 循环

`for` 循环在布尔表达式匹配指定条件时执行一系列指令。就像 `while` 循环一样，可以使用跳转语句来停止循环执行。它具有以下结构：

[PRE93]

初始化语句在循环开始之前执行。它用于声明并分配一个仅用于循环作用域内的局部变量。

但在更复杂的场景中，它也可以用来组合其他语句表达式。条件指定了一个布尔条件，指示循环何时继续或退出。迭代器通常用于在初始化部分创建的变量中增加或减少。以下是一个例子，其中使用`for`循环打印整数数组的元素：

[PRE94]

在这个例子中，已经创建了一个初始化变量`j`，其初始值为`0`。`for`循环将在`j`小于数组长度减`1`时持续执行（记住索引总是从`0`开始）。在每次迭代后，`j`的值增加`1`。这样，`for`循环就会遍历整个数组并执行给定的操作，即打印当前数组元素的值。

C#还允许使用**嵌套循环**，即**循环中的循环**，你将在下一个练习中看到。

## 练习1.10：使用冒泡排序对数组进行排序

在这个练习中，你将执行一种最简单的排序算法。冒泡排序包括遍历数组中的每一对元素，并在它们未排序时交换它们。最终，期望得到一个按升序排列的数组。你将使用嵌套的`for`循环来实现这个算法。

首先，应该将待排序的数组作为参数传递给此方法。对于数组的每个元素，如果当前元素大于下一个元素，则应交换它们的位置。这种交换通过将下一个元素的值存储在一个临时变量中，将当前元素的值赋给下一个元素，最后使用存储的临时值设置当前元素的值来实现。一旦第一个元素与其他所有元素进行比较，就会开始对第二个元素进行比较，依此类推，直到最终数组被排序。

以下步骤将帮助你完成这个练习：

1.  使用以下命令创建一个新的控制台项目：

    [PRE95]

1.  在`Program.cs`文件中，创建一个方法来实现排序算法。添加以下代码：

    [PRE96]

1.  现在创建一个包含一些数字的**数组**，如下所示：

    [PRE97]

1.  调用`BubbleSort`方法，将数组作为参数传递，并将结果赋给一个变量，如下所示：

    [PRE98]

1.  最后，你需要打印出数组已排序的消息。为此，遍历数组，打印数组元素：

    [PRE99]

1.  使用 `dotnet run --project Exercise1_10` 命令运行程序。你应该会在屏幕上看到以下输出：

    [PRE100]

    注意

    你可以在[https://packt.link/cJs8y](https://packt.link/cJs8y)找到这个练习使用的代码。

在这个练习中，你使用了在上一节学到的两个概念：数组和for循环。你操作数组，通过索引访问它们的值，并使用for循环遍历这些索引。

有另一种方法可以遍历数组或`foreach`语句的每个元素。你将在下一节中探索这一点。

### foreach语句

`foreach`语句为集合中的每个元素执行一组指令。就像`for`循环一样，`break`、`continue`、`goto`和`return`关键字也可以与`foreach`语句一起使用。考虑以下示例，其中你遍历数组的每个元素并将其写入控制台作为输出：

[PRE101]

前面的代码片段将数字从`1`到`5`打印到控制台。你可以使用`foreach`语句与比数组更多的东西一起使用；它们还可以与列表、集合和span一起使用，这些是将在后续章节中介绍的其他数据结构。

## 文件处理

到目前为止，你一直在创建主要与CPU和内存交互的程序。本节将重点介绍I/O操作，即物理磁盘上的输入和输出操作。文件处理是这类操作的一个很好的例子。

C#有几个类可以帮助你执行I/O操作。其中一些如下：

+   `File`：这个类提供了对文件进行操作的方法，即读取、写入、创建、删除、复制和移动磁盘上的文件。

+   `Directory`：与`File`类类似，这个类包括创建、移动和枚举磁盘上的目录和子目录的方法。

+   `Path`：提供处理磁盘上文件和目录的绝对路径和相对路径的实用工具。相对路径始终与当前应用程序执行的当前目录内的某个路径相关联，而绝对路径则指向硬盘内的一个绝对位置。

+   `DriveInfo`：提供有关磁盘驱动器的信息，例如`Name`、`DriveType`、`VolumeLabel`和`DriveFormat`。

你已经知道文件主要是一些数据集合，它们位于硬盘的某个位置，可以通过某些程序打开进行读取或写入。当你在一个C#应用程序中打开一个文件时，你的程序通过一个通信通道将文件作为一系列字节读取。这个通信通道被称为流。流有两种类型：

+   输入流用于读取操作。

+   输出流用于写入操作。

`Stream`类是C#中的一个抽象类，它使你可以执行与这种字节流相关的常见操作。对于硬盘上的文件处理，你将使用专门为此目的设计的`FileStream`类。以下是这个类两个重要的属性：`FileAccess`和`FileMode`。

### FileAccess

这是一个`enum`，它为你提供了在打开指定文件时选择访问级别选项：

+   `Read`：以只读模式打开文件。

+   `ReadWrite`：以读写模式打开文件。

+   `Write`：以只写模式打开文件。这很少使用，因为你通常会在写入的同时进行一些读取。

### FileMode

这是一个 `enum`，指定可以在文件上执行的操作。它应与访问模式一起使用，因为某些模式仅与某些访问级别一起工作。查看以下选项：

+   `追加`：当你想在文件末尾添加内容时使用此选项。如果文件不存在，则会创建一个新文件。对于此操作，文件必须具有写入权限；否则，任何尝试读取都会失败并抛出 `NotSupportedException` 异常。异常是一个重要的概念，将在本章后面进行介绍。

+   `创建`：使用此选项来创建新文件或覆盖现有文件。对于此选项，也需要写入权限。在 Windows 中，如果文件存在但被隐藏，则会抛出 `UnauthorizedAccessException` 异常。

+   `CreateNew`：这与 `Create` 类似，但用于创建新文件，并且也需要写入权限。然而，如果文件已存在，则会抛出 `IOException` 异常。

+   `打开`：正如其名所示，此模式用于打开文件。文件必须具有读取或读取和写入权限。如果文件不存在，则会抛出 `FileNotFoundException` 异常。

+   `OpenOrCreate`：这与 `Open` 类似，但如果文件不存在，则会创建一个新文件。

## 练习 1.11：从文本文件中读取内容

在此练习中，你将从一个逗号分隔值 (CSV) 文件中读取文本。CSV 文件仅包含由字符串表示的数据，并且由冒号或分号分隔。

执行以下步骤以完成此练习：

1.  打开命令提示符并输入以下内容：

    [PRE102]

1.  在你的计算机中 `Exercise1_11` 项目文件夹位置，创建一个名为 `products.csv` 的文件，并将以下内容粘贴到其中：

    [PRE103]

1.  打开 `Program.cs` 文件，并用以下内容替换其内容：

    [PRE104]

1.  在命令提示符中调用 `dotnet run`，你将得到一个输出，其内容与您创建的 CSV 文件内容相同。

    注意

    你可以在 [https://packt.link/5flid](https://packt.link/5flid) 找到用于此练习的代码。

此练习有一些相当有趣的结果，你将逐步了解。首先，你使用 `FileStream` 类打开了一个文件。这允许你从文件开始流式传输字节，具有两个特殊属性，即 `FileMode` 和 `FileAccess`。它将返回一个 `StreamReader` 类。此类使你能够将这些字节作为文本字符读取。

注意，你的 `Main` 方法已从 `void` 更改为 `async` Task。此外，已使用 `await` 关键字，该关键字用于异步操作。你将在接下来的章节中了解更多关于这些主题的内容。现在，你只需要知道异步操作是那些不会阻塞程序执行的操作。这意味着你可以在读取时输出行；也就是说，你不需要等待它们全部被读取。

在下一节中，你将了解处理文件、数据库和网络连接的特殊关键字。

### 可丢弃对象

前一个练习中还有一个特殊之处，那就是 `using` 关键字。这是一个用于从内存中清理未管理资源的关键字。这些资源是特殊对象，它们处理一些操作系统资源，例如文件、数据库和网络连接。它们被称为 **特殊**，因为它们执行所谓的 I/O 操作；也就是说，它们与机器的真实资源（如网络和硬盘）交互，而不仅仅是与内存空间。

C# 中对象使用的内存由称为垃圾回收器的东西来处理。默认情况下，C# 处理堆栈和堆内存空间。唯一不执行此清理的对象类型称为未管理对象。

从内存中清理这些对象意味着资源将可供计算机中的另一个进程使用。这意味着文件可以被另一个进程处理，数据库连接可以再次由连接池使用，等等。这些类型的资源被称为可处置资源。每次你处理可处置资源时，在创建对象时都可以使用 `using` 关键字。然后，编译器知道当 `using` 语句关闭时，它可以自动释放这些资源。

## 练习 1.12：向文本文件写入

在这个练习中，你将使用 `FileStream` 类将一些文本写入 CSV 文件。

按照以下步骤完成此练习：

1.  打开 VS Code 集成终端并输入以下内容：

    [PRE105]

1.  在你的计算机上的一个合适位置，将上一个练习中的 `products.csv` 文件复制并粘贴到这个练习的文件夹中。

1.  在 `Program.cs` 中创建一个名为 `ReadFile` 的方法，该方法将接收一个 `FileStream` 文件并遍历文件行，将结果输出到控制台：

    [PRE106]

1.  现在，在你的程序中，使用 `StreamWriter` 打开 `products.csv` 文件，并向其中添加更多信息，如下所示：

    [PRE107]

1.  最后，修改文件后读取文件内容：

    [PRE108]

1.  在 VS Code 集成终端中调用 `dotnet run --project Exercise1_12`，你将能够看到你刚刚创建的 CSV 文件的内容，以及你刚刚追加的行：

    [PRE109]

注意，对于每次运行，程序将追加一行，所以你会看到更多行被添加。

注意

你可以在 [https://packt.link/dUk2z](https://packt.link/dUk2z) 找到用于此练习的代码。

有时你的程序可能在某个点失败并无法提供输出。这种情况被称为异常错误。下一节将详细介绍此类错误。

## 异常

异常表示程序在某些原因下未能执行，可能由代码本身或.NET运行时引发。通常，异常是一个严重的失败，甚至可能终止程序的执行。幸运的是，C# 提供了一种特殊的方式来处理异常，即 `try/catch` 块：

[PRE110]

在`try`块中，你调用可能会抛出异常的代码，而在`catch`块中，你可以处理所抛出的异常。例如，考虑以下示例：

[PRE111]

此方法接受两个整数并返回它们之间的除法结果。然而，如果`b`是`0`会发生什么？在这种情况下，运行时会抛出`System.DivideByZeroException`，表示无法执行除法。你如何在现实世界的程序中处理这个异常？你将在下一个练习中探索这个问题。

## 练习1.13：使用try/catch处理无效用户输入

在这个练习中，你将创建一个控制台应用程序，该程序从你那里接收两个输入，将第一个数字除以第二个数字，并输出结果。如果你输入了无效字符，应用程序应该抛出异常，并且所有这些都应该在程序逻辑中处理。

执行以下步骤以完成此练习：

1.  在VS Code集成终端中，创建一个名为`Exercise1_13`的新控制台应用程序。

1.  在`Program.cs`文件中创建以下方法：

    [PRE112]

1.  现在，创建一个布尔变量来指示除法是否正确执行。将其初始值设置为`false`：

    [PRE113]

1.  编写一个`while`循环，检查除法是否成功执行。如果成功了，程序应该终止。如果没有，程序应该提示你输入有效数据并再次执行除法。添加以下代码来完成此操作：

    [PRE114]

1.  最后，使用`dotnet run`命令执行程序并与控制台交互。尝试插入字符串而不是数字，看看你会得到什么输出。以下是一个示例输出：

    [PRE115]

    注意

    你可以在[https://packt.link/EVsrJ](https://packt.link/EVsrJ)找到用于此练习的代码。

在这个练习中，你处理了两种类型的异常，如下所示：

+   当无法将`string`变量转换为整数时，`int.Parse(string str)`方法会抛出`System.FormatException`异常。

+   当`double Divide(int a, int b)`方法中的`b`为0时，会抛出`System.DivideByZeroException`异常。

现在你已经看到了如何处理异常，重要的是要注意一个经验法则，这将有助于你在C#的学习之旅中，那就是*你应该只捕获你可以处理或需要处理的异常*。只有在少数情况下，异常处理才是真正必要的，如下所示：

+   当你想**抑制**异常，即捕获它并假装什么都没发生时。这被称为异常抑制。这应该在抛出的异常不会影响程序流程时发生。

+   当你想控制程序的执行流程以执行一些替代操作时，就像在前面的练习中所做的那样

+   当你想捕获一种异常并将其抛出为另一种类型时。例如，在与你的 Web API 通信时，你可能会看到类型为 `HttpException` 的异常，这表明目标不可达。你可以在这种情况下使用自定义异常，例如 `IntegrationException`，以更清楚地表明它发生在你的应用程序的某个部分，该部分执行了一些与外部 API 的集成操作。

`throw` 关键字也可以用于在特定情况下故意停止程序执行流程。例如，考虑你正在创建一个 `Person` 对象，并且 `Name` 属性在创建时不应为 `null`。你可以在这个类上强制执行 `System.ArgumentException` 或 `System.ArgumentNullException`，如下面的代码片段所示，它使用 `ArgumentNullException` 来执行此操作：

[PRE116]

在这里，如果 `name` 参数的值为 `null` 或如果你只输入空格字符，则会抛出 `ArgumentNullException` 异常，程序无法成功执行。null/空格条件是通过 `IsNullOrWhiteSpace` 函数检查的，该函数可用于字符串变量。

现在是时候通过一个活动来练习你在前面的部分中学到的所有内容了。

## 活动 1.01：创建一个猜数字游戏

要完成这个活动，你需要使用在本章中学习并实践过的概念来创建一个猜数字游戏。在这个游戏中，首先，必须生成一个1到10之间的随机数，但不能输出到控制台。然后，控制台应提示用户输入一个数字并猜测哪个随机数已被生成，用户最多有五次机会。

每次输入错误时，应显示一个警告消息，让用户知道他们还剩下多少次机会，如果所有五次机会都因猜测错误而耗尽，则程序终止。然而，一旦用户猜对了，在程序终止之前应显示一个成功消息。

以下步骤将帮助你完成这个活动：

1.  创建一个名为 `numberToBeGuessed` 的变量，将其分配给 C# 中的随机数。你可以使用以下代码片段来完成此操作：

    [PRE117]

这会为你生成一个介于 `0` 和 `10` 之间的随机数。如果你想使游戏稍微困难一些，可以将 `10` 替换为一个更大的数字，或者为了使游戏更容易，可以替换为一个更小的数字，但在这个活动中，你将使用 `10` 作为最大值。

1.  创建一个名为 `remainingChances` 的变量，用于存储用户剩余的机会数。

1.  创建一个名为 `numberFound` 的变量，并将其分配一个 `false` 值。

1.  现在，创建一个`while`循环，该循环将在仍有机会的情况下执行。在这个循环中，添加代码以输出剩余的机会数量，直到猜出正确的数字。然后，创建一个名为`number`的变量，它将接收`number`变量，如果猜对了，将`true`值分配给`numberFound`变量。如果没有猜对，剩余的机会数量应该减少`1`。

1.  最后，添加代码来通知用户他们是否正确猜出了数字。如果他们猜对了，你可以输出类似于`恭喜！你用{remainingChanges}次机会猜对了数字！`的信息。如果他们用完了机会，输出`你用完了机会。数字是{numberToBeGuessed}。`。

    注意

    本活动的解决方案可以在[https://packt.link/qclbF](https://packt.link/qclbF)找到。

# 摘要

本章为你概述了C#的基础知识以及如何用它来编写程序。你探索了从变量声明、数据类型、基本算术和逻辑运算符到文件和异常处理的各个方面。你还了解了C#在处理值和引用类型时如何分配内存。

在本章的练习和活动中，你能够解决一些现实世界的问题，并思考出可以用这种语言及其资源实现解决方案。你学习了如何在控制台应用程序中提示用户输入，如何处理系统中的文件，以及最后如何通过异常处理来处理意外的输入。

下一章将涵盖面向对象编程的精华，深入探讨类和对象的概念。你还将了解编写易于维护的简洁代码的重要性，以及你可以遵循的原则来编写这样的代码。
