<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Enhancing Reports"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Enhancing Reports</h1></div></div></div><p>In the previous chapter we saw how to create a simple report and display this report in our application. In this chapter, we will create a new report but this report will be more complex than the previous one. We will see how to group data using one or more fields, how to filter data by parameters, and how to add a subreport.</p><p>We will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Using parameter fields</li><li class="listitem" style="list-style-type: disc">Working with formula fields</li><li class="listitem" style="list-style-type: disc">Working with subreport</li><li class="listitem" style="list-style-type: disc">Grouping and sorting data</li><li class="listitem" style="list-style-type: disc">Adding the report to a form</li></ul></div><p>In this chapter, we will have two sections. In the first section we will create a new report to display employees, like the one we had created in the previous chapter, but we will add some filters to this new report. This will allow the user to select those employees who have the same data. We see in the following screenshot that all employees in the report have the same data (<span class="strong"><strong>Country</strong></span>, <span class="strong"><strong>City</strong></span>, and <span class="strong"><strong>Title</strong></span>). This can be achieved by using parameter fields. In the first section we will see how to use these.</p><div class="mediaobject"><img src="graphics/5-1.jpg" alt="Enhancing Reports"/></div><p>In the second section, we will create a new report to display all the <span class="strong"><strong>Employee Details </strong></span> and their <span class="strong"><strong>Employee orders</strong></span> as shown in the following screenshot. We will also see how to use subreports, grouping, sorting, and formula fields.</p><div class="mediaobject"><img src="graphics/5-2.jpg" alt="Enhancing Reports"/></div><div class="section" title="Using parameter fields"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec28"/>Using parameter fields</h1></div></div></div><p>We will create a new <a id="id126" class="indexterm"/>report the same way we created one in the previous chapter, using the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We will use the same TableAdapter that we created in the previous chapter (<span class="strong"><strong>EmployeesTableAdapter</strong></span>) as shown in the following screenshot:<div class="mediaobject"><img src="graphics/5-3.jpg" alt="Using parameter fields"/></div></li><li class="listitem">Add a new <a id="id127" class="indexterm"/>Crystal Reports to our application and rename it to <code class="literal">crFilteredEmployees</code>.</li><li class="listitem">As shown in the following screenshot, we will select the <span class="strong"><strong>As a Blank Report</strong></span> radio button to learn how to connect to database with your report after the report creation. Click on the <span class="strong"><strong>OK</strong></span> button.<div class="mediaobject"><img src="graphics/5-4.jpg" alt="Using parameter fields"/></div></li><li class="listitem">From <span class="strong"><strong>Field </strong></span><a id="id128" class="indexterm"/><span class="strong"><strong>Explorer</strong></span>, right-click on <span class="strong"><strong>Database Fields</strong></span> and choose <span class="strong"><strong>Database Expert</strong></span>. Select the <code class="literal">Employees</code> table as shown in the following screenshot. Click on the <span class="strong"><strong>OK</strong></span> button.<div class="mediaobject"><img src="graphics/5-5.jpg" alt="Using parameter fields"/></div></li><li class="listitem">Now you will see the table <span class="strong"><strong>Fields</strong></span> when you navigate to <span class="strong"><strong>Field Explorer</strong></span> | <span class="strong"><strong>Database Fields</strong></span> | <span class="strong"><strong>Employees</strong></span> as shown in the following screenshot:<div class="mediaobject"><img src="graphics/5-6.jpg" alt="Using parameter fields"/></div></li><li class="listitem">Drag <span class="strong"><strong>Employees</strong></span> fields to the <span class="strong"><strong>Details</strong></span> section in our report and format the report, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/5-7.jpg" alt="Using parameter fields"/></div><p>Until now our report would have displayed all employees, so now we need to update this report to filter employees by their data (<span class="strong"><strong>Country</strong></span>, <span class="strong"><strong>City</strong></span>, and <span class="strong"><strong>Title</strong></span>). In the next steps we will see how to add filters to our report.</p></li><li class="listitem">In <span class="strong"><strong>Field Explorer</strong></span>, <a id="id129" class="indexterm"/>right-click on <span class="strong"><strong>Parameter Fields</strong></span> and select <span class="strong"><strong>New</strong></span>.<p>As we see in the following screenshot, we will name this parameter <code class="literal">pmCountry</code> and select its <span class="strong"><strong>Type</strong></span> as <span class="strong"><strong>String</strong></span>. We will keep the default values for other fields in the form and click on the <span class="strong"><strong>OK</strong></span> button:</p><div class="mediaobject"><img src="graphics/5-8.jpg" alt="Using parameter fields"/></div></li><li class="listitem">Create two more<a id="id130" class="indexterm"/> parameters with the type <span class="strong"><strong>String</strong></span> and name them <code class="literal">pmCity</code> and <code class="literal">pmTitle</code>. Now we have three parameters, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/5-9.jpg" alt="Using parameter fields"/></div><p>Until now we hadn't used these parameters and they don't have any effect in our report.</p></li><li class="listitem">Right-click on the report and navigate to <span class="strong"><strong>Report</strong></span> | <span class="strong"><strong>Selection Formula</strong></span> | <span class="strong"><strong>Record</strong></span>. We will see this in the following screenshot:<div class="mediaobject"><img src="graphics/5-10.jpg" alt="Using parameter fields"/></div></li><li class="listitem">We will write<a id="id131" class="indexterm"/> some code to apply parameters to our reports, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/5-11.jpg" alt="Using parameter fields"/></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">In the first line of code: (<code class="literal">{Employees.Title}={?pmTitle}</code>), we filtered Employees Title by <code class="literal">pmTitle</code> parameter.</li><li class="listitem" style="list-style-type: disc">In the second line of code (<code class="literal">{Employees.Country}={?pmCountry}</code>), we filtered Employees Country by <code class="literal">pmCountry</code> parameter.</li><li class="listitem" style="list-style-type: disc">In the third line of code: (<code class="literal">{Employees.City}={?pmCity}</code>), we filtered Employees City by <code class="literal">pmCity</code> parameter.</li><li class="listitem" style="list-style-type: disc">At the end we tied the three lines with the <code class="literal">and</code> keyword to ensure that the three filters must be applied together; if one filter failed the others will fail.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip02"/>Tip</h3><p>You can drag-and-drop <span class="strong"><strong>Table</strong></span> and <span class="strong"><strong>Parameter</strong></span> fields to the code box from the report fields in the upper box (field tree).</p></div></div></li></ul></div></li><li class="listitem">Save and <a id="id132" class="indexterm"/>close the form from the top.<p>Until now we finished our report design, now we need to display our report in the application; when the user clicks <code class="literal">btnEmpByFilters</code> button (<span class="strong"><strong>By Filters</strong></span>), the values of <span class="strong"><strong>Title</strong></span>, <span class="strong"><strong>City</strong></span>, and <span class="strong"><strong>Country</strong></span> ComboBoxes are dynamically passed to our report parameters <code class="literal">pmTitle</code>, <code class="literal">pmCity</code>, and <code class="literal">pmCountry</code>.</p></li><li class="listitem">Open <span class="strong"><strong>MainForm</strong></span> from <span class="strong"><strong>Solution Explorer</strong></span>. Double-click on the <code class="literal">btnEmpByFilters</code> button to move to the click event code and write the code that we see in the following screenshot:<div class="mediaobject"><img src="graphics/5-12.jpg" alt="Using parameter fields"/></div><p>We have seen most of the previously mentioned lines of code in our previous chapter, but here we added only three extra lines of codes to pass the three parameters to our report dynamically. The three lines of code are as follows:</p><div class="informalexample"><pre class="programlisting">report.SetParameterValue("pmTitle",cbEmpTitle.Text);
report.SetParameterValue("pmCountry", cbEmpCountry.Text);
report.SetParameterValue("pmCity", cbEmpCity.Text);</pre></div></li><li class="listitem">When we run the application and test the result, we will see the report results, depending on what data was provided in the filters.<p>We need to improve our report so the user can use one filter or two rather than three filters, or he can stop all filters. We will allow the user to stop any filter by writing the <code class="literal">"ALL"</code> string in the combo boxes used to filter the report data. We only need to change the parameters code in our report to meet this improvement.</p></li><li class="listitem">Right-click <a id="id133" class="indexterm"/>on any <span class="strong"><strong>Parameter Fields</strong></span> in <span class="strong"><strong>Field Explorer</strong></span> and select <span class="strong"><strong>Find in Formula</strong></span>.</li><li class="listitem">Update the code we wrote before to the new one as in the following screenshot then save and close.<div class="mediaobject"><img src="graphics/5-13.jpg" alt="Using parameter fields"/></div></li><li class="listitem">Run the application to test the new change. Type<code class="literal">"ALL"</code> in the three combo boxes used to filter the report data, and click on the <span class="strong"><strong>By filters</strong></span> button. You will now see the data of all the employees in the report. You can change one or two filters and keep the others to test the report result.</li></ol></div><p>In the next section, we will create a report to display the data of all the employees with the employee orders. This report contains a main report that consists of the employee data and another subreport that contains the employee orders. We will see how to use subreport by filtering data in the main report fields.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First we will create a TableAdapter that contains all the data from <code class="literal">Employees</code> table, the select query will look like the following screenshot:<div class="mediaobject"><img src="graphics/5-14.jpg" alt="Using parameter fields"/></div><p>In the <a id="id134" class="indexterm"/>preceding query, we used <code class="literal">LEFT OUTER JOIN</code> to select all data from the left table that contains all employees' data and selected the supervisor (<code class="literal">ReportsTo</code>) data from the second table if it exists. We didn't use <code class="literal">INNER JOIN</code> because the employee with ID 2 (<code class="literal">Fuller</code>) does not have a supervisor (<code class="literal">ReportsTo</code>). We are also using <code class="literal">SELF JOIN</code> with the same table, which we learned in the previous chapters. The TableAdapter will look like the following screenshot:</p><div class="mediaobject"><img src="graphics/5-15.jpg" alt="Using parameter fields"/></div></li><li class="listitem">We will create a new crystal report with the name <code class="literal">crEmployeeDetails</code> and pass <code class="literal">Employee1</code> as the report data source. Drag-and-drop data fields to the <span class="strong"><strong>Employee Details</strong></span> section in our report and format the fields to look like the following screenshot:<div class="mediaobject"><img src="graphics/5-16.jpg" alt="Using parameter fields"/></div></li></ol></div><p>Please note that<a id="id135" class="indexterm"/> in the previous reports we used SQL queries to display the employees' and supervisors' full names in our report. In this section we will use a formula field to display their full name. As we saw in the previous screenshot, <span class="strong"><strong>Full Name</strong></span> and <span class="strong"><strong>Reports To</strong></span> are formula fields <code class="literal">(@fmu_FullName</code>, <code class="literal">@fmu_ReportTo</code>). We will see how to use formula fields now.</p></div></div>
<div class="section" title="Working with formula fields"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec29"/>Working with formula fields</h1></div></div></div><p>In this section we will see<a id="id136" class="indexterm"/> how to use formula fields and how they are useful and powerful for improving our reports.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">From <span class="strong"><strong>Field Explorer</strong></span>, right-click on <span class="strong"><strong>Formula Fields</strong></span> and select New. Type in the formula name <code class="literal">fmu_FullName</code> and click on the <span class="strong"><strong>OK</strong></span> button. We will see this in the following screenshot:<div class="mediaobject"><img src="graphics/5-17.jpg" alt="Working with formula fields"/></div><p>This formula field will display the employee's full name in the same format that we created before using SQL query. Here we use the concatenate operator (<code class="literal">+</code>) to concatenate the title with the first and last name of the employee.</p></li><li class="listitem">Create another formula field and name it <code class="literal">fmu_ReportsTo</code>. You will see the formula code in the following screenshot:<div class="mediaobject"><img src="graphics/5-18.jpg" alt="Working with formula fields"/></div></li><li class="listitem">Drag-and-drop <a id="id137" class="indexterm"/>the two formula fields to the report as we did previously.</li><li class="listitem">Add a parameter field to the report and name it <code class="literal">EmpId</code>. We will use this parameter to filter the employees by ID as we see in the following screenshot:<div class="mediaobject"><img src="graphics/5-19.jpg" alt="Working with formula fields"/></div></li><li class="listitem">Open <span class="strong"><strong>MainForm</strong></span> from <span class="strong"><strong>Solution Explorer</strong></span>. Double-click on the <span class="strong"><strong>btnEmpById</strong></span> button to move to the click event code and write the code that we see in the following screenshot:<div class="mediaobject"><img src="graphics/5-20.jpg" alt="Working with formula fields"/></div></li><li class="listitem">Run the application to test our report, write an ID number in the <code class="literal">txtEmpId</code> textbox and click on the <span class="strong"><strong>By id</strong></span> button to test the result.</li></ol></div><p>With this step we finished the main report that contains the employee data; in the next several steps we will add a <a id="id138" class="indexterm"/>subreport to the main report, which will contain the employee orders.</p></div>
<div class="section" title="Working with subreport"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec30"/>Working with subreport</h1></div></div></div><p>Now we will see another <a id="id139" class="indexterm"/>powerful tool in Crystal Reports; that is subreport. Subreport is used to create a report inside another report and link the two reports with a relation or a filter.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create TableAdapter, which contains the employee orders and all the data in the table <code class="literal">Orders</code>. We will rename the adapter to <code class="literal">OrdersByEmployeeIdTableAdapter</code> as we see in the following screenshot:<div class="mediaobject"><img src="graphics/5-21.jpg" alt="Working with subreport"/></div></li><li class="listitem">In the main report, in the <span class="strong"><strong>Details</strong></span> section, right-click and navigate to <span class="strong"><strong>Insert</strong></span> | <span class="strong"><strong>Subreport</strong></span>. Drag-and-drop this subreport at the end of the main report (after the <code class="literal">Notes</code> field in the <span class="strong"><strong>Employee Details</strong></span> section). Then we will see the following screenshot:<div class="mediaobject"><img src="graphics/5-22.jpg" alt="Working with subreport"/></div><p>As we see, we can choose the subreport from the application reports, export it from hard disk, or create a new report using Report Wizard. We will choose the last option, so click on the <span class="strong"><strong>Report Wizard...</strong></span> button and complete the wizard as we have learned before. Make sure that you use the <code class="literal">OrdersByEmployeeId</code> table as a data source for the subreport. We will name the subreport <code class="literal">crOrdersByEmployeeId</code> and click on the <span class="strong"><strong>OK</strong></span> button.</p></li><li class="listitem">Right-click on<a id="id140" class="indexterm"/> the subreport and select <span class="strong"><strong>Edit Subreport</strong></span>. In subreport we will group the Employee orders by the country so in the next few steps we will see how to use grouping in Crystal Reports.</li></ol></div></div>
<div class="section" title="Grouping and sorting data"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec31"/>Grouping and sorting data</h1></div></div></div><p>In this section we will <a id="id141" class="indexterm"/>see how to <a id="id142" class="indexterm"/>group and sort report data with one or more fields.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In <span class="strong"><strong>Field Explorer</strong></span>, right-click on <span class="strong"><strong>Group Name Fields</strong></span> and select <span class="strong"><strong>Insert Group</strong></span>. We will see this in the following screenshot:<div class="mediaobject"><img src="graphics/5-23.jpg" alt="Grouping and sorting data"/></div><p>Choose the group field (<span class="strong"><strong>ShipCountry</strong></span>) and the sort type (<span class="strong"><strong>in ascending order.</strong></span>). We can change the field title from the <span class="strong"><strong>Options</strong></span> tab. Click on the <span class="strong"><strong>OK</strong></span> button.</p></li><li class="listitem">Format the <a id="id143" class="indexterm"/>subreport as we see in the following screenshot. You can see the <a id="id144" class="indexterm"/>two new sections that were added to the report after we created the group.<div class="mediaobject"><img src="graphics/5-24.jpg" alt="Grouping and sorting data"/></div><p>Now we need to filter data in the subreports using the parameter field in the main report.</p></li><li class="listitem">Go back to the main report, right-click on the subreport, and select the <span class="strong"><strong>Change subreport</strong></span> <span class="strong"><strong>Links…</strong></span>. We will see the following screenshot:<div class="mediaobject"><img src="graphics/5-25.jpg" alt="Grouping and sorting data"/></div><p>In this <a id="id145" class="indexterm"/>dialog, we will map the <span class="strong"><strong>EmpId</strong></span> parameter<a id="id146" class="indexterm"/> field from the main report to <span class="strong"><strong>EmployeeID</strong></span> in the subreport. From the <span class="strong"><strong>Available Fields</strong></span> list, we will select the <span class="strong"><strong>EmpId</strong></span> parameter and move it to the <span class="strong"><strong>Field(s) to link to:</strong></span> list. In the last part in the dialog we will choose <span class="strong"><strong>EmployeeID</strong></span> from the right drop-down list to link it with the <span class="strong"><strong>EmpId</strong></span> parameter in the left drop-down list. Click on the <span class="strong"><strong>OK</strong></span> button.</p><p>Now the two reports are connected together with one parameter: <span class="strong"><strong>EmpId</strong></span>. The last step is to fill the subreport with data before displaying your report to the user.</p></li><li class="listitem">Navigate back to the button click event to update your code as shown in the following screenshot:<div class="mediaobject"><img src="graphics/5-26.jpg" alt="Grouping and sorting data"/></div><p>We only added three lines of code to the old code, the three lines to fill the subreport with data using the <span class="strong"><strong>OrdersByEmployeeIdTableAdapter</strong></span> TableAdapter.</p></li><li class="listitem">Run our <a id="id147" class="indexterm"/>application to test the last changes. The final report <a id="id148" class="indexterm"/>will look like the following screenshot:<div class="mediaobject"><img src="graphics/5-27.jpg" alt="Grouping and sorting data"/></div></li><li class="listitem">As we see in the previous screenshot, the date format contains the time; we want to change this format to display the date only. Navigate back to our report, right-click on any date field in the report, select <span class="strong"><strong>Format Object</strong></span>, and select the date format as shown in the following screenshot:<div class="mediaobject"><img src="graphics/5-28.jpg" alt="Grouping and sorting data"/></div><p>After<a id="id149" class="indexterm"/> changing the date format for all date <a id="id150" class="indexterm"/>fields (<span class="strong"><strong>BirthDate</strong></span>, <span class="strong"><strong>HireDate</strong></span>, <span class="strong"><strong>OrderDate</strong></span>, and <span class="strong"><strong>ShippedDate</strong></span>), the report will look like the following screenshot:</p><div class="mediaobject"><img src="graphics/5-29.jpg" alt="Grouping and sorting data"/></div></li></ol></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec32"/>Summary</h1></div></div></div><p>In this chapter, we created two reports and we learned from the first one how to use parameter fields and how to use these fields to filter the report data. In the second report we learned how to use subreports and how to use grouping and sorting. In the next chapter, we will create special type of reports and we will see how to create a crosstab report.</p></div></body></html>