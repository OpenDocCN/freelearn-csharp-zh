<html><head></head><body>
		<div id="_idContainer432">
			<p><a id="_idTextAnchor142"/></p>
			<h1 id="_idParaDest-142"><em class="italic"><a id="_idTextAnchor143"/>Chapter 8</em>: The Scriptable Render Pipeline in Unity</h1>
			<p>In the <a href="B17146_07_Final_ASB_ePub.xhtml#_idTextAnchor121"><em class="italic">Chapter 7</em></a>, <em class="italic">Understanding the Mathematics of Computer Graphics in Unity</em>, we learned about the mathematics used in computer graphics. This knowledge is general computer graphics knowledge, and all 3D software and game engines use those mathematical concepts. For a game engine, rendering is one of the most important functions. In this chapter, we will specifically explore the rendering functions provided by Unity.</p>
			<p>The following key topics will be explored in this chapter:</p>
			<ul>
				<li>An introduction to the Scriptable Render Pipeline </li>
				<li><a id="_idTextAnchor144"/>Working with Unity's Universal Render Pipeline</li>
				<li>The Universal Render Pipeline shaders and materials</li>
				<li>Increasing performance of the Universal Render Pipeline</li>
			</ul>
			<p>By the end of this chapter, you will understand what the <strong class="bold">Scriptable Render Pipeline</strong> is and how to enable the Scriptable Render Pipeline-based <strong class="bold">Universal Render Pipeline</strong> and <strong class="bold">High Definition Render Pipeline</strong> in your project. You will also know how to use the <strong class="bold">Universal Render Pipeline Asset</strong> to configure your render pipeline and how to use the <strong class="bold">Volume framework</strong> to apply post-processing effects to your game. You will also know how to create a custom shader and material that can be used in the Universal Render Pipeline, how to use Unity's <strong class="bold">Frame Debugger</strong> tool to view the information of the rendering process, and how to use the <strong class="bold">SRP Batcher</strong> to reduce the number of draw calls in your project. </p>
			<p>It sounds exciting! Now, let's get started!</p>
			<h1 id="_idParaDest-143"><a id="_idTextAnchor145"/>An introduction to the Scriptable Render Pipeline</h1>
			<p>Since its first release in 2004, the Unity game engine has grown into the world's most widely used real-time content creation platform. A large number of games are developed using the <a id="_idIndexMarker684"/>Unity game engine. At the same time, Unity is being rapidly applied to the content design and production process of traditional industries, including VR, AR, and MR simulation applications, architectural design display, automobile design and manufacturing, and even film and television animation production. The development of real-time rendering technology based on computer graphics is an important reason for the rapid growth and widespread use of the Unity engine.</p>
			<p>Before the Unity 2018 version, developers could only use the <strong class="bold">built-in render pipeline</strong> provided by Unity. Since the Unity engine itself is a closed source engine, the built-in render pipeline in Unity is like a black box for developers, and developers cannot know the specific logic implementation of rendering inside the Unity engine. Furthermore, games developed using Unity's built-in render pipeline will use the same set of rendering logic on different platforms. It is very difficult for developers to customize the render pipeline for different platforms.</p>
			<p>With the release of the Scriptable Render Pipeline, developers can view its code directly on GitHub and use C# code to control the rendering process, customizing a unique rendering pipeline for their games or applications.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">You can find the code of the<a id="_idIndexMarker685"/> Scriptable Render Pipeline on GitHub: <a href="https://github.com/Unity-Technologies/Graphics">https://github.com/Unity-Technologies/Graphics</a>.</p>
			<p>The<a id="_idIndexMarker686"/> Scriptable Render Pipeline is a toolbox provided by Unity for developers, through which developers can freely implement specific rendering functions in Unity. For the convenience of developers, there are two pre-build render pipelines based on the Scriptable Render Pipeline available, namely the Universal Render Pipeline and the High Definition Render Pipeline. </p>
			<p>By using Scriptable Render Pipeline-based pre-built render pipelines, we can directly modify a specific function in the render pipelines without having to implement a new pipeline from scratch, simultaneously obtaining excellent rendering results and continuous updates. Therefore, when using Unity to develop games, there are three ready-made render pipelines to choose from:</p>
			<ul>
				<li>The legacy built-in render pipeline</li>
				<li>The Universal Render Pipeline </li>
				<li>The High Definition Render Pipeline</li>
			</ul>
			<p>Of course, you can also choose<a id="_idIndexMarker687"/> to develop your own render pipeline based on the Scriptable Render Pipeline.</p>
			<p>The following are some open source projects on GitHub made using the Universal Render Pipeline or the High Definition Render Pipeline, which you can download and use.</p>
			<h2 id="_idParaDest-144"><a id="_idTextAnchor146"/>The Fontainebleau Demo</h2>
			<p>The first one is <a id="_idIndexMarker688"/>the <strong class="bold">Fontainebleau Demo</strong> project, made with the High Definition Render Pipeline:</p>
			<div>
				<div id="_idContainer367" class="IMG---Figure">
					<img src="image/Figure_8.01_B17146.jpg" alt="Figure 8.1 – The Fontainebleau Demo&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.1 – The Fontainebleau Demo</p>
			<p>As shown in <em class="italic">Figure 8.1</em>, this project allows you to walk in a forest in first-person mode. You can find the <a id="_idIndexMarker689"/>project here: <a href="https://github.com/Unity-Technologies/FontainebleauDemo">https://github.com/Unity-Technologies/FontainebleauDemo</a>.</p>
			<h2 id="_idParaDest-145"><a id="_idTextAnchor147"/>The Spaceship Demo</h2>
			<p>The <a id="_idIndexMarker690"/>second project I want to introduce is the <strong class="bold">Spaceship Demo</strong> project. This is a playable AAA first-person mode demo, as shown in <em class="italic">Figure 8.2</em>:</p>
			<div>
				<div id="_idContainer368" class="IMG---Figure">
					<img src="image/Figure_8.02_B17146.jpg" alt="Figure 8.2 – The Spaceship Demo&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.2 – The Spaceship Demo</p>
			<p>In this open source project, you can see how to implement GPU-accelerated particle effects, such as realistic flames, smoke, and electrical spark visual effects. You can find the project<a id="_idIndexMarker691"/> here: <a href="https://github.com/Unity-Technologies/SpaceshipDemo">https://github.com/Unity-Technologies/SpaceshipDemo</a>.</p>
			<h2 id="_idParaDest-146"><a id="_idTextAnchor148"/>The BoatAttack Demo</h2>
			<p>If you choose <a id="_idIndexMarker692"/>to use the Universal Render Pipeline as the render pipeline of your game, then this open source project is worth checking out: </p>
			<div>
				<div id="_idContainer369" class="IMG---Figure">
					<img src="image/Figure_8.03_B17146.jpg" alt="Figure 8.3 – The BoatAttack Demo&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.3 – The BoatAttack Demo</p>
			<p>As shown in <em class="italic">Figure 8.3</em>, this is a boat racing game, made using the Universal Render Pipeline. You can find the<a id="_idIndexMarker693"/> project here: <a href="https://github.com/Unity-Technologies/BoatAttack">https://github.com/Unity-Technologies/BoatAttack</a>.</p>
			<p>In addition to open source projects on GitHub, Unity also provides developers with free resources on Unity's <strong class="bold">Asset Store</strong> for developers to learn and use. </p>
			<p>Here are some samples.</p>
			<h2 id="_idParaDest-147"><a id="_idTextAnchor149"/>The Heretic: Digital Human</h2>
			<p>The first<a id="_idIndexMarker694"/> one I want to share is the <strong class="bold">The Heretic: Digital Human</strong> project on the Asset Store:</p>
			<div>
				<div id="_idContainer370" class="IMG---Figure">
					<img src="image/Figure_8.04_B17146.jpg" alt="Figure 8.4 – The Heretic: Digital Human on the Asset Store&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.4 – The Heretic: Digital Human on the Asset Store</p>
			<p>As <a id="_idIndexMarker695"/>shown in <em class="italic">Figure 8.4</em>, this is a free project that shows how to make a digital human with real skin, eyes, eyebrows, and so on. You can find the project here: <a href="https://assetstore.unity.com/packages/essentials/tutorial-projects/the-heretic-digital-human-168620">https://assetstore.unity.com/packages/essentials/tutorial-projects/the-heretic-digital-human-168620</a>.</p>
			<h2 id="_idParaDest-148"><a id="_idTextAnchor150"/>The Heretic: VFX Character</h2>
			<p>The second <a id="_idIndexMarker696"/>project is from <strong class="bold">The Heretic</strong> on the Asset Store as well, and it's free to download:</p>
			<div>
				<div id="_idContainer371" class="IMG---Figure">
					<img src="image/Figure_8.05_B17146.jpg" alt="Figure 8.5 – The Heretic: VFX Character&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.5 – The Heretic: VFX Character</p>
			<p>As shown in <em class="italic">Figure 8.5</em>, this project demonstrates how to create a VFX-based character with the High Definition Render <a id="_idIndexMarker697"/>Pipeline in Unity. You can find the project here: <a href="https://assetstore.unity.com/packages/essentials/tutorial-projects/the-heretic-vfx-character-168622">https://assetstore.unity.com/packages/essentials/tutorial-projects/the-heretic-vfx-character-168622</a>.</p>
			<p>Well, after introducing a lot of projects based on Scriptable Render Pipeline, which are open source and free, are you more interested in this render pipeline now? If so, then we will briefly introduce the two pre-built render pipelines based on the Scriptable Render Pipeline, namely the Universal Render Pipeline and the High Definition Render Pipeline.</p>
			<h2 id="_idParaDest-149"><a id="_idTextAnchor151"/>Universal Render Pipeline</h2>
			<p>The Universal Render Pipeline<a id="_idIndexMarker698"/> is a pre-built render pipeline based on the Scriptable Render Pipeline in Unity. As its name implies, this render pipeline can be used on all platforms supported by Unity. Different pipelines cannot be mixed, so once you choose to use the Universal Render Pipeline, the built-in render pipeline and the High Definition Render Pipeline will not be enabled.</p>
			<p>Unity uses the legacy built-in render pipeline by default, but you can enable the Universal Render Pipeline in your project in different ways.</p>
			<p>If you want to develop a new project, then you can use the <strong class="bold">3D Sample Scene (URP)</strong> project template provided by <strong class="bold">Unity Hub</strong> to create a new Universal Render Pipeline project:</p>
			<div>
				<div id="_idContainer372" class="IMG---Figure">
					<img src="image/Figure_8.06_B17146.jpg" alt="Figure 8.6 – The 3D Sample Scene (URP) project template&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.6 – The 3D Sample Scene (URP) project template</p>
			<p>As shown in <em class="italic">Figure 8.6</em>, the <strong class="bold">3D Sample Scene (URP)</strong> project template configures project settings to use the Universal Render Pipeline in the project:</p>
			<div>
				<div id="_idContainer373" class="IMG---Figure">
					<img src="image/Figure_8.07_B17146.jpg" alt="Figure 8.7 – A new URP project&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.7 – A new URP project</p>
			<p>After waiting for the new project to be created, you can view the sample scene rendered using the Universal Render Pipeline, as shown in <em class="italic">Figure 8.7</em>.</p>
			<p>However, if you want to switch an existing project from the built-in render pipeline to the<a id="_idIndexMarker699"/> Universal Render Pipeline, recreating a new project using the Universal Render Pipeline is not suitable for your project. At this point, choosing to use Unity's Package Manager to install the Universal Render Pipeline is a more suitable option:</p>
			<div>
				<div id="_idContainer374" class="IMG---Figure">
					<img src="image/Figure_8.08_B17146.jpg" alt="Figure 8.8 – Opening the Package Manager window&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.8 – Opening the Package Manager window</p>
			<p>The Package Manager window can be opened by clicking on <strong class="bold">Window </strong>| <strong class="bold">Package Manager</strong> in the Unity Editor toolbar, as shown in the previous figure:</p>
			<div>
				<div id="_idContainer375" class="IMG---Figure">
					<img src="image/Figure_8.09_B17146.jpg" alt="Figure 8.9 – Package Manager&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.9 – Package Manager</p>
			<p>As shown in <em class="italic">Figure 8.9</em>, you can<a id="_idIndexMarker700"/> find the <strong class="bold">Universal RP</strong> package in the packages list and install it in your project.</p>
			<p>In this section, we briefly introduced the Universal Render Pipeline and how to install it in your project. A more detailed introduction on how to use it will be covered in the <em class="italic">Working with Unity's Universal Render Pipeline</em> section. Next, let's continue our journey to briefly explore the High Definition Render Pipeline and how to install it in your project.</p>
			<h2 id="_idParaDest-150"><a id="_idTextAnchor152"/>The High Definition Render Pipeline</h2>
			<p>The High Definition Render Pipeline<a id="_idIndexMarker701"/> is another pre-built render pipeline based on the Scriptable Render Pipeline in Unity. Unlike the Universal Render Pipeline, it does not support all platforms supported by Unity, only supporting high-end platforms. The following table shows the platforms supported by the High Definition Render Pipeline:</p>
			<div>
				<div id="_idContainer376" class="IMG---Figure">
					<img src="image/Figure_8.10_B17146.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.10 – The platforms supported by the High Definition Render Pipeline</p>
			<p>As shown in the previous table, the High Definition Render Pipeline is currently mainly used for platforms such as consoles or desktop computers. If you are developing a mobile-oriented project, then the High Definition Render Pipeline is not a suitable choice. </p>
			<p>Since we want to <a id="_idIndexMarker702"/>cover as many usage scenarios as possible, this chapter will mainly focus on the use of the Universal Render Pipeline – hence the brief introduction to the High Definition Render Pipeline. However, if you want to try it or really need to use the High Definition Render Pipeline, installing it is very similar to installing the Universal Render Pipeline, as described earlier.</p>
			<p>Firstly, if you are starting a new project, you can use the <strong class="bold">3D Sample Scene (HDRP)</strong> project template<a id="_idIndexMarker703"/> provided by Unity Hub to create a new High Definition Render Pipeline project.</p>
			<p>As shown in <em class="italic">Figure 8.11</em>, the <strong class="bold">3D Sample Scene (HDRP)</strong> project template configures project settings to use the High Definition Render Pipeline in the project:</p>
			<div>
				<div id="_idContainer377" class="IMG---Figure">
					<img src="image/Figure_8.11_B17146.jpg" alt="Figure 8.11 – The 3D Sample Scene (HDRP) template&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.11 – The 3D Sample Scene (HDRP) template</p>
			<p>After waiting for the new project to be created, you can view the sample scene rendered using the <a id="_idIndexMarker704"/>High Definition Render Pipeline, as shown in <em class="italic">Figure 8.12</em>:</p>
			<div>
				<div id="_idContainer378" class="IMG---Figure">
					<img src="image/Figure_8.12_B17146.jpg" alt="Figure 8.12 – A new HDRP project&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.12 – A new HDRP project</p>
			<p>Of course, you can also install the <strong class="bold">High Definition RP</strong> package from the Package Manager in Unity:</p>
			<div>
				<div id="_idContainer379" class="IMG---Figure">
					<img src="image/Figure_8.13_B17146.jpg" alt="Figure 8.13 – Installing High Definition RP via Package Manager&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.13 – Installing High Definition RP via Package Manager</p>
			<p>As shown in <em class="italic">Figure 8.13</em>, you can find the <strong class="bold">High Definition RP</strong> package in the packages list and install it to your project.</p>
			<p>In this section, we briefly introduced the High Definition Render Pipeline and how to install it in your project. </p>
			<p>By reading this <a id="_idIndexMarker705"/>section, <em class="italic">An Introduction to the Scriptable Render Pipeline</em>, you should now have an understanding of what the Scriptable Render Pipeline is and how to install a Scriptable Render Pipeline-based Universal Render Pipeline and High Definition Render Pipeline in your project. Next, we will discuss in detail how to use the Universal Render Pipeline correctly in your project.</p>
			<p>Let's get started!</p>
			<h1 id="_idParaDest-151"><a id="_idTextAnchor153"/>Working with Unity's Universal Render Pipeline </h1>
			<p>The Universal Render Pipeline<a id="_idIndexMarker706"/> is widely used by Unity developers. It is not only used to develop games for PC or video game consoles; you can also use it to develop mobile games. </p>
			<p>We can create a new Universal Render Pipeline project through the Unity Hub project template. Through the project template, Unity will automatically set up all the render pipeline resources for us. The project also contains a sample scene, as shown in <em class="italic">Figure 8.14</em>. You can find a camera, a directional light, a spot light, a post-process volume, reflection probes, and some models in this scene:</p>
			<div>
				<div id="_idContainer380" class="IMG---Figure">
					<img src="image/Figure_8.14_B17146.jpg" alt="Figure 8.14 – The sample scene of the Universal Render Pipeline&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.14 – The sample scene of the Universal Render Pipeline</p>
			<p>For starters, this <a id="_idIndexMarker707"/>sample scene is a good starting point. We will use it to explain how to use the Universal Render Pipeline.</p>
			<h2 id="_idParaDest-152"><a id="_idTextAnchor154"/>Exploring the sample scene</h2>
			<p>Let's first explore this <a id="_idIndexMarker708"/>sample scene. As you can see in <em class="italic">Figure 8.14</em>, this scene is not complicated, but it contains most of the functions of the Universal Render Pipeline. We will introduce these components in the scene separately. </p>
			<h3>The main camera</h3>
			<p>Let's start with the <a id="_idIndexMarker709"/>main camera in the scene. We can select the <strong class="bold">Main Camera</strong> in the <strong class="bold">Hierarchy</strong> window to open the <strong class="bold">Inspector</strong> window of it, as shown in the following figure:</p>
			<div>
				<div id="_idContainer381" class="IMG---Figure">
					<img src="image/Figure_8.15_B17146.jpg" alt="Figure 8.15 – The Main Camera object&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.15 – The Main Camera object</p>
			<p>There is a <strong class="bold">Camera</strong> component<a id="_idIndexMarker710"/> attached to the <strong class="bold">Main Camera</strong> object, which provides all the functions related to the camera object. You can set the background, culling mask, anti-aliasing setting, perspective settings of the camera, and so on.</p>
			<p>Another component that you need to be aware of is the <strong class="bold">Universal Additional Camera Data</strong> component, which you can find at the bottom of <em class="italic">Figure 8.15</em>. If you are using the Universal Render Pipeline, Unity does not allow you to remove it from the camera because this component is used to store data internally.</p>
			<h3>The directional light</h3>
			<p>There is only one directional light<a id="_idIndexMarker711"/> in this sample project, which is used to simulate the sunlight. You can modify the color, intensity, and shadow effect of the light by modifying the settings of the <strong class="bold">Light</strong> component attached to the light object in the scene. You can also modify the rotation property of the <strong class="bold">Transform</strong> component of the light object to adjust the direction of the directional light, as shown in <em class="italic">Figure 8.16</em>.</p>
			<div>
				<div id="_idContainer382" class="IMG---Figure">
					<img src="image/Figure_8.16_B17146.jpg" alt="Figure 8.16 – The Directional Light object&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.16 – The Directional Light object</p>
			<p>In this example, the <a id="_idIndexMarker712"/>intensity value of this light is <strong class="bold">2</strong>, and soft shadows are used.</p>
			<h3>The Spot Light</h3>
			<p>There are four types of lights in<a id="_idIndexMarker713"/> Unity, which are <strong class="bold">Directional Light</strong>, <strong class="bold">Point Light</strong>, <strong class="bold">Spot Light</strong>, and <strong class="bold">Area Light</strong>. In this sample scene, in addition to a directional light used to simulate the sunlight, there is also a spot light used to simulate a spotlight:</p>
			<div>
				<div id="_idContainer383" class="IMG---Figure">
					<img src="image/Figure_8.17_B17146.jpg" alt="Figure 8.17 – The Spot Light object&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.17 – The Spot Light object</p>
			<p>As shown in the preceding figure, the effect of the spotlight object in Unity is like spotlights in the real world. The settings of a spot light are similar to the settings of a directional light in Unity: </p>
			<div>
				<div id="_idContainer384" class="IMG---Figure">
					<img src="image/Figure_8.18_B17146.jpg" alt="Figure 8.18 – The Spot Light settings&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.18 – The Spot Light settings</p>
			<p>You still can modify<a id="_idIndexMarker714"/> the color, intensity, and shadow effect of the spot light by modifying the settings of the <strong class="bold">Light</strong> component attached to the <strong class="bold">Spot Light</strong> object, and you can also modify the range and the inner/outer spot angle of this spot light, as shown in <em class="italic">Figure 8.18</em>.</p>
			<h3>The Post-process Volume</h3>
			<p>Now, <a id="_idIndexMarker715"/>let's take a look at the Post-process Volume object in the sample scene. In game development, post-processing is a technique that is often used to add various effects to a rendered image, common effects such as tone mapping, depth of field, bloom, anti-aliasing, and motion blur:</p>
			<div>
				<div id="_idContainer385" class="IMG---Figure">
					<img src="image/Figure_8.19_B17146.jpg" alt="Figure 8.19 – Post-process Volume&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.19 – Post-process Volume</p>
			<p>The Universal Render <a id="_idIndexMarker716"/>Pipeline provides the <strong class="bold">Volume</strong> component and the <strong class="bold">Volume Profile</strong> object to manage different post-processing effects applied to rendered images, as shown in <em class="italic">Figure 8.19</em>. One advantage of using the <strong class="bold">Volume</strong> component is that component and specific settings can be decoupled. All settings on the <strong class="bold">Volume</strong> component come from the associated <strong class="bold">Volume Profile</strong> object. We will discuss the <strong class="bold">Volume Profile</strong> object in detail later.</p>
			<p>In this sample scene, the <strong class="bold">Tonemapping</strong>, <strong class="bold">Bloom</strong>, and <strong class="bold">Vignette</strong> effects are applied. If you're curious about the original rendered image without post-processing, let's see what happens when we disable this post-process volume:</p>
			<div>
				<div id="_idContainer386" class="IMG---Figure">
					<img src="image/Figure_8.20_B17146.jpg" alt="Figure 8.20 – The original image (top) versus the post-processed image (bottom) &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.20 – The original image (top) versus the post-processed image (bottom) </p>
			<p><em class="italic">Figure 8.20</em> shows a comparison of the original image and the post-processed image of the sample scene.</p>
			<h3>The reflection probes</h3>
			<p>A <strong class="bold">reflection probe</strong> can <a id="_idIndexMarker717"/>provide efficient reflection information for related models in a scene by sampling the scene around itself so that the surface of the model in the scene has a realistic reflection effect:</p>
			<div>
				<div id="_idContainer387" class="IMG---Figure">
					<img src="image/Figure_8.21_B17146.jpg" alt="Figure 8.21 – Reflection probes in the scene&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.21 – Reflection probes in the scene</p>
			<p>In this sample scene, we<a id="_idIndexMarker718"/> can see there are three reflection probes as child objects of the GameObject named <strong class="bold">Reflection Probes</strong>, as shown in the preceding figure. </p>
			<p>If we select one of these reflection probes, then the corresponding reflection probe will be displayed in the scene view and show the reflection information, as shown in <em class="italic">Figure 8.22</em>:</p>
			<div>
				<div id="_idContainer388" class="IMG---Figure">
					<img src="image/Figure_8.22_B17146.jpg" alt="Figure 8.22 – Viewing the reflection information in the scene&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.22 – Viewing the reflection information in the scene</p>
			<p>Since the reflection probes in different positions will obtain different reflection information, in order to use <a id="_idIndexMarker719"/>the reflection information correctly, they need to be placed in the proper place. While the definition of "proper place" varies from scene to scene, a general guideline is that you should place reflection probes near any large objects in the scene that will be significantly reflected. For example, place reflection probes in the areas around the center and corners of walls in the scene. Of course, this doesn't mean ignoring all the smaller objects in the scene. For example, a campfire in a scene may be a small object compared to a wall, but reflecting the fire from the campfire is just as important to create a realistic rendering of the scene.</p>
			<h2 id="_idParaDest-153"><a id="_idTextAnchor155"/>The Universal Render Pipeline asset</h2>
			<p>Since this new <a id="_idIndexMarker720"/>sample project is created using the Universal Render Pipeline template, Unity has automatically set everything up for us to make the Universal Render Pipeline work properly. However, if your project is using the built-in render pipeline for development and you want to switch to using the Universal Render Pipeline, or if your project has been developed using the Universal Render Pipeline but you want to use another render pipeline, it is necessary to know how to set up it in Unity.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">In this chapter, we are <a id="_idIndexMarker721"/>using the <strong class="bold">forward rendering path</strong> in the Universal Render Pipeline. The<a id="_idIndexMarker722"/> so-called <strong class="bold">rendering path</strong> refers to a series of operations related to lighting and shading. Unity's built-in render pipeline provides different rendering paths, such as the forward rendering path and <a id="_idIndexMarker723"/>the <strong class="bold">deferred rendering path</strong>. After version 12.0.0 of the Universal Render Pipeline, developers can also use the deferred rendering path in the pipeline, but that is beyond the scope of this chapter. If you are interested in this topic, you can find out more at <a href="mailto:https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@12.0/manual/rendering/deferred-rendering-path.html">https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@12.0/manual/rendering/deferred-rendering-path.html</a> and <a href="mailto:https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@12.0/manual/urp-universal-renderer.html#rendering-path-comparison">https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@12.0/manual/urp-universal-renderer.html#rendering-path-comparison</a>.</p>
			<p>We will walk <a id="_idIndexMarker724"/>you through the following steps to learn how to set up a render pipeline for your project in Unity:</p>
			<ol>
				<li>Let's start with the <strong class="bold">Project Settings</strong> window. You can open this window through <strong class="bold">Edit </strong>| <strong class="bold">Project Settings</strong> in the Unity Editor toolbar. </li>
				<li>Next, click the <strong class="bold">Graphics</strong> item in the category list on the left to open the<strong class="bold"> Graphics </strong>Settings panel, as shown in <em class="italic">Figure 8.23</em>:</li>
			</ol>
			<div>
				<div id="_idContainer389" class="IMG---Figure">
					<img src="image/Figure_8.23_B17146.jpg" alt="Figure 8.23 – The Graphics settings&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.23 – The Graphics settings</p>
			<p>Let's take a look at the <strong class="bold">Scriptable Render Pipeline Settings</strong> property in detail:</p>
			<ul>
				<li>The <strong class="bold">Scriptable Render Pipeline Settings</strong> property of the <strong class="bold">Graphics</strong> settings is associated with an object of the <strong class="bold">Universal Render Pipeline Asset</strong> type named <strong class="bold">UniversalRP-HighQuality</strong>, which is automatically created when this project is created using the template.</li>
				<li>If the <strong class="bold">Scriptable Render Pipeline Settings</strong> property of the <strong class="bold">Graphics</strong> settings is set to none, then Unity will use the default built-in render pipeline. </li>
			</ul>
			<ol>
				<li value="3">You can find <a id="_idIndexMarker725"/>this <strong class="bold">Universal Render Pipeline Asset</strong> object in the <strong class="bold">Assets</strong> &gt; <strong class="bold">Settings</strong> folder of the project:</li>
			</ol>
			<div>
				<div id="_idContainer390" class="IMG---Figure">
					<img src="image/Figure_8.24_B17146.jpg" alt="Figure 8.24 – The Universal Render Pipeline Asset objects&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.24 – The Universal Render Pipeline Asset objects</p>
			<ol>
				<li value="4">Then, select the <strong class="bold">UniversalRP-HighQuality</strong> object to open the <strong class="bold">Inspector </strong>window so that we can check the detailed information of this <strong class="bold">Universal Render Pipeline Asset</strong> object. As shown in <em class="italic">Figure 8.25</em>, a <strong class="bold">Universal Render Pipeline Asset</strong> object provides various settings for the current Universal Render Pipeline, such as rendering functions and rendering quality:</li>
			</ol>
			<div>
				<div id="_idContainer391" class="IMG---Figure">
					<img src="image/Figure_8.25_B17146.jpg" alt="Figure 8.25 – The Inspector window of this Universal Render Pipeline Asset object&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.25 – The Inspector window of this Universal Render Pipeline Asset object</p>
			<ul>
				<li>Next, let's walk <a id="_idIndexMarker726"/>through these settings. We can configure the general settings of the render pipeline in the <strong class="bold">General</strong> section, as shown in <em class="italic">Figure 8.26</em>. For example, if the <strong class="bold">Depth Texture</strong> option is enabled, you can access the depth map generated by the render pipeline from your shader code:</li>
			</ul>
			<div>
				<div id="_idContainer392" class="IMG---Figure">
					<img src="image/Figure_8.26_B17146.jpg" alt="Figure 8.26 – The General settings&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.26 – The General settings</p>
			<p class="callout-heading">Note</p>
			<p class="callout">In game development, <strong class="bold">depth textures</strong> are <a id="_idIndexMarker727"/>used to represent the depth information of objects in 3D space from the camera's perspective.</p>
			<ul>
				<li>We can also control the global rendering quality:</li>
			</ul>
			<div>
				<div id="_idContainer393" class="IMG---Figure">
					<img src="image/Figure_8.27_B17146.jpg" alt="Figure 8.27 – The Quality settings&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.27 – The Quality settings</p>
			<p>In <em class="italic">Figure 8.27</em>, we enable the global <strong class="bold">HDR</strong> option, and the global <strong class="bold">Anti Aliasing</strong> setting is <strong class="bold">2x</strong>. We can also modify the rendering resolution by adjusting the <strong class="bold">Render Scale</strong> slider.</p>
			<ul>
				<li>As a very important factor for real-time rendering, the lighting of the Universal Render Pipeline can also be configured in the <strong class="bold">Lighting</strong> section, as shown in <em class="italic">Figure 8.28</em>: </li>
			</ul>
			<div>
				<div id="_idContainer394" class="IMG---Figure">
					<img src="image/Figure_8.28_B17146.jpg" alt="Figure 8.28 – The Lighting settings&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.28 – The Lighting settings</p>
			<p>The main light in <a id="_idIndexMarker728"/>the settings panel is the brightest directional light in the game scene. You can decide whether to enable it and whether to allow it to cast shadows.</p>
			<ul>
				<li>In <em class="italic">Figure 8.29</em>, you can find the <strong class="bold">Shadows</strong> settings under the <strong class="bold">Lighting</strong> settings. You can modify the parameters here to adjust what the shadows look like in Unity:</li>
			</ul>
			<div>
				<div id="_idContainer395" class="IMG---Figure">
					<img src="image/Figure_8.29_B17146.jpg" alt="Figure 8.29 – The Shadows settings&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.29 – The Shadows settings</p>
			<ul>
				<li>Finally, let's explore the <strong class="bold">Advanced</strong> settings:</li>
			</ul>
			<div>
				<div id="_idContainer396" class="IMG---Figure">
					<img src="image/Figure_8.30_B17146.jpg" alt="Figure 8.30 – The Advanced settings&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.30 – The Advanced settings</p>
			<p>Here, we can check the <strong class="bold">SRP Batcher</strong> option to enable the SRP Batcher function to improve the performance of the Universal Render Pipeline, which we will explain in <a id="_idIndexMarker729"/>detail in the <em class="italic">Increasing performance of the Universal Render Pipeline</em> section. We can also modify the level of the <strong class="bold">Debug</strong> log output, as shown in <em class="italic">Figure 8.30</em>.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">If there is no Universal Render Pipeline Asset in your project, you can create a new one by clicking <strong class="bold">Assets</strong> &gt; <strong class="bold">Create</strong> &gt; <strong class="bold">Rendering</strong> &gt; <strong class="bold">Universal Render Pipeline</strong> &gt; <strong class="bold">Pipeline Asset</strong> in the Unity Editor toolbar.</p>
			<p>In this section, we introduced the Universal Render Pipeline Asset in Unity and how to switch between different render pipelines by changing the <strong class="bold">Scriptable Render Pipeline Settings</strong> property of the <strong class="bold">Graphics</strong> settings. Next, we will explore another important asset in the Universal Render Pipeline, namely the Volume Profile.</p>
			<h2 id="_idParaDest-154"><a id="_idTextAnchor156"/>The Volume framework and post-processing</h2>
			<p>The <strong class="bold">Volume</strong> framework<a id="_idIndexMarker730"/> is provided to game developers by the Scriptable Render Pipeline. By using this framework, developers can decouple a component from the specific settings of the component. Those render pipelines based on the Scriptable Render Pipeline, such as the Universal Render Pipeline and the High Definition Render Pipeline, use this framework.</p>
			<p>As we mentioned before, the Universal Render Pipeline uses the <strong class="bold">Volume</strong> component and the <strong class="bold">Volume Profile</strong> object to manage different post-processing effects applied to rendered images. The following steps demonstrate how to enable the Volume framework and apply some post-processing effects<a id="_idIndexMarker731"/> to the sample project:</p>
			<ol>
				<li value="1">First of all, we need to add a <strong class="bold">Volume</strong> component to a GameObject in the scene to enable the Volume framework, as shown in the following figure:</li>
			</ol>
			<div>
				<div id="_idContainer397" class="IMG---Figure">
					<img src="image/Figure_8.31_B17146.jpg" alt="Figure 8.31 – Adding a Volume component&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.31 – Adding a Volume component</p>
			<ol>
				<li value="2">In <em class="italic">Figure 8.31</em>, the <strong class="bold">Profile</strong> property of this <strong class="bold">Volume</strong> component is <strong class="bold">0</strong>, so we can either create a <a id="_idIndexMarker732"/>new <strong class="bold">Volume Profile</strong> file by clicking <a id="_idIndexMarker733"/>the <strong class="bold">New</strong> button below it or assign an existing <strong class="bold">Volume Profile</strong> file to it. Here, we will create a new <strong class="bold">Volume Profile</strong> file: </li>
			</ol>
			<div>
				<div id="_idContainer398" class="IMG---Figure">
					<img src="image/Figure_8.32_B17146.jpg" alt="Figure 8.32 – Creating a new Volume Profile file&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.32 – Creating a new Volume Profile file</p>
			<ol>
				<li value="3">Click the <strong class="bold">Add Override</strong> button to open the <strong class="bold">Volume Overrides</strong> panel, and click the <strong class="bold">Post-processing</strong> item to open the <strong class="bold">Post-processing</strong> overrides list:  </li>
			</ol>
			<div>
				<div id="_idContainer399" class="IMG---Figure">
					<img src="image/Figure_8.33_B17146.jpg" alt="Figure 8.33 – Add Override&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.33 – Add Override</p>
			<ol>
				<li value="4">In <em class="italic">Figure 8.34</em>, you can see lots of post-processing effects in the <strong class="bold">Post-processing</strong> overrides list. You can choose the effects that you want to apply to the rendered image, such as <strong class="bold">Bloom</strong>:</li>
			</ol>
			<div>
				<div id="_idContainer400" class="IMG---Figure">
					<img src="image/Figure_8.34_B17146.jpg" alt="Figure 8.34 – Post-processing effects&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.34 – Post-processing effects</p>
			<ol>
				<li value="5">Finally, let's <a id="_idIndexMarker734"/>modify the configuration of the <strong class="bold">Bloom</strong> effect; check the <strong class="bold">Threshold</strong> and <strong class="bold">Intensity</strong> options and set their values to <strong class="bold">0.9</strong> and <strong class="bold">4</strong> respectively, as shown in the following figure:</li>
			</ol>
			<div>
				<div id="_idContainer401" class="IMG---Figure">
					<img src="image/Figure_8.35_B17146.jpg" alt="Figure 8.35 – Setting up the Bloom effect&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.35 – Setting up the Bloom effect</p>
			<p>After completing the preceding steps, switch to the game view. We can see the game scene in <em class="italic">Figure 8.36</em> after applying the <strong class="bold">Bloom</strong> effect:</p>
			<div>
				<div id="_idContainer402" class="IMG---Figure">
					<img src="image/Figure_8.36_B17146.jpg" alt="Figure 8.36 – The applied Bloom effect image (top) versus the original image (bottom)&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.36 – The applied Bloom effect image (top) versus the original image (bottom)</p>
			<p>In this section, we started by exploring the sample scene that is included in the template to learn the functions of the Universal Render Pipeline. Then, we introduced how to switch between different render pipelines and the Universal Render Pipeline Assets. Finally, we demonstrated how to use the Volume framework to implement post-processing in the Universal Render Pipeline. The next stop of our journey is to explore the shaders and materials that are important for rendering in Unity.</p>
			<h1 id="_idParaDest-155"><a id="_idTextAnchor157"/>The Universal Render Pipeline shaders and materials </h1>
			<p><strong class="bold">Shaders</strong> and <strong class="bold">materials</strong> are <a id="_idIndexMarker735"/>essential for rendering models in Unity. Shaders are used to <a id="_idIndexMarker736"/>provide algorithms to calculate the color of each pixel. A material provides various parameters for the shader associated with it to determine how to render the model, such as providing texture as the input of the shader and defining how the shader samples the texture:</p>
			<div>
				<div id="_idContainer403" class="IMG---Figure">
					<img src="image/Figure_8.37_B17146.jpg" alt="Figure 8.37 – Materials and shaders&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.37 – Materials and shaders</p>
			<p>If we select a model in the scene, such as the safety hat model, the material settings will be displayed in the <strong class="bold">Inspector</strong> window, as shown in <em class="italic">Figure 8.37</em>.</p>
			<h2 id="_idParaDest-156"><a id="_idTextAnchor158"/>Commonly used shaders </h2>
			<p>Each material can be<a id="_idIndexMarker737"/> associated with a specified shader, and the parameters required by this shader are displayed in the <strong class="bold">Inspector</strong> window. The commonly used shader when using the Universal Render Pipeline is <strong class="bold">Universal Render Pipeline/Lit</strong>, and this safety hat model is rendered using this shader as well. By adjusting various parameters, the <em class="italic"> </em><strong class="bold">Universal Render Pipeline/Lit</strong> shader can be used to render different material surfaces, such as metal, glass, and wood.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The shader <a id="_idIndexMarker738"/>with <strong class="bold">Lit</strong> in its name implies that this shader will perform lighting calculations. The shader with <strong class="bold">Unlit</strong> in the <a id="_idIndexMarker739"/>name means that the shader does not consider the lighting factor when calculating the color of a pixel.</p>
			<p>We can change the shader associated with a material by selecting a different one through the <strong class="bold">Shader</strong> drop-down window, as shown in <em class="italic">Figure 8.38</em>:</p>
			<div>
				<div id="_idContainer404" class="IMG---Figure">
					<img src="image/Figure_8.38_B17146.jpg" alt="Figure 8.38 – Shaders&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.38 – Shaders</p>
			<p>Once we have<a id="_idIndexMarker740"/> determined the shader associated with the material, we can then provide various parameters for this specific shader through this material: </p>
			<div>
				<div id="_idContainer405" class="IMG---Figure">
					<img src="image/Figure_8.39_B17146.jpg" alt="Figure 8.39 – The parameters of the shader&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.39 – The parameters of the shader</p>
			<p>In <em class="italic">Figure 8.39</em>, developers can specify various maps in the <strong class="bold">Surface Inputs</strong> section for the <strong class="bold">Universal Render Pipeline/Lit</strong> shader. The textures associated with these map parameters are used to provide different <a id="_idIndexMarker741"/>information for the shader. We will explain in detail as follows:</p>
			<ul>
				<li><strong class="bold">Base Map</strong> is used to provide the base color of the surface to the shader. </li>
				<li><strong class="bold">Metallic Map</strong> is used to provide metallic workflow information to the shader to determine how "metal-like" the surface is. </li>
				<li><strong class="bold">Normal Map</strong> is used to add more details to the surface of the model that do not exist on the original model.</li>
				<li><strong class="bold">Occlusion Map</strong> is <a id="_idIndexMarker742"/>used to provide information to the shader to simulate shadows from ambient lighting.</li>
			</ul>
			<p>The parameters required by different shaders may be different, and due to different shader algorithms, the final rendering results are also different:</p>
			<div>
				<div id="_idContainer406" class="IMG---Figure">
					<img src="image/Figure_8.40_B17146.jpg" alt="Figure 8.40 – The Unlit shader&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.40 – The Unlit shader</p>
			<p>For example, if we change the shader associated with this material to <strong class="bold">Universal Render Pipeline/Unlit</strong>, then only <strong class="bold">Base Map</strong> remains in the <strong class="bold">Surface Inputs</strong> section to provide the base color for the surface:</p>
			<div>
				<div id="_idContainer407" class="IMG---Figure">
					<img src="image/Figure_8.41_B17146.jpg" alt="Figure 8.41 – The safety hat model&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.41 – The safety hat model</p>
			<p>The safety hat model rendered with this material will only display the basic color and will no longer be affected by any lighting. You can see the difference between the safety hat model and the surrounding models in the preceding screenshot.</p>
			<h2 id="_idParaDest-157"><a id="_idTextAnchor159"/>Upgrading project materials to Universal Render Pipeline materials</h2>
			<p>As we<a id="_idIndexMarker743"/> mentioned <a id="_idIndexMarker744"/>at the beginning of this chapter, if you choose to use the Universal Render Pipeline, the built-in render pipeline will no longer be available. This includes not only the built-in render pipeline itself but also the shaders used with the built-in render pipeline. </p>
			<p>Therefore, when changing an existing project that is being developed using the built-in render pipeline to use the Universal Render Pipeline, developers often encounter a problem known as "material errors":</p>
			<div>
				<div id="_idContainer408" class="IMG---Figure">
					<img src="image/Figure_8.42_B17146.jpg" alt="Figure 8.42 – The built-in Standard shader cannot be used in the Universal Render Pipeline&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.42 – The built-in Standard shader cannot be used in the Universal Render Pipeline</p>
			<p>For example, we can change the shader used to render the safety hat model from <strong class="bold">Universal Render Pipeline/Unlit</strong> to the built-in <strong class="bold">Standard</strong> shader. Then, you can see that the safety hat model displays a pink color, which means that there is an error in the material, as shown in the preceding figure.</p>
			<p>Therefore, if your project is developing using the built-in render pipeline but you need to switch to using the Universal Render Pipeline, then in order to ensure that the Universal Render Pipeline can work correctly, you need to upgrade the existing materials to Universal Render Pipeline materials. </p>
			<p>You can manually modify the shaders associated with the existing materials, such as replacing the built-in <strong class="bold">Standard</strong> shader with the <strong class="bold">Universal Render Pipeline/Lit</strong> shader:</p>
			<div>
				<div id="_idContainer409" class="IMG---Figure">
					<img src="image/Figure_8.43_B17146.jpg" alt="Figure 8.43 – Upgrading the project materials&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.43 – Upgrading the project materials</p>
			<p>On the other<a id="_idIndexMarker745"/> hand, Unity also<a id="_idIndexMarker746"/> provides a function for developers to upgrade existing materials to Universal Render Pipeline materials automatically. You can find it by clicking <strong class="bold">Edit</strong> &gt; <strong class="bold">Render Pipeline</strong> &gt; <strong class="bold">Universal Render Pipeline</strong> &gt; <strong class="bold">Upgrade Project Materials to UniversalRP Materials</strong> in the Unity Editor toolbar, as shown in the preceding screenshot.</p>
			<div>
				<div id="_idContainer410" class="IMG---Figure">
					<img src="image/Figure_8.44_B17146.jpg" alt="Figure 8.44 – Material Upgrader&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.44 – Material Upgrader</p>
			<p>Then, the <strong class="bold">Material Upgrader</strong> window will pop up. As shown in <em class="italic">Figure 8.44</em>, the changes cannot be undone, so if you want to upgrade all of the materials in your project to Universal Render Pipeline materials and have backed up the project, click the <strong class="bold">Proceed</strong> button.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">This <strong class="bold">Material Upgrader</strong> tool<a id="_idIndexMarker747"/> can only upgrade the built-in shaders to Universal Render Pipeline shaders but not the custom shaders created by developers. Therefore, the custom shaders still need to be modified manually.</p>
			<h2 id="_idParaDest-158"><a id="_idTextAnchor160"/>Creating a shader and a Shader Graph</h2>
			<p>Sometimes, you<a id="_idIndexMarker748"/> may want to create a new shader to implement some custom features that can be used with the Universal Render Pipeline. There are two ways to do it – you can either<a id="_idIndexMarker749"/> create a new shader file or a Shader Graph file.</p>
			<h3>Creating a new shader file</h3>
			<p>First of all, even if our <a id="_idIndexMarker750"/>project uses the Universal Render Pipeline, we can still use the legacy way to create custom shader files using shader templates in the built-in render pipeline in Unity. As shown in <em class="italic">Figure 8.45</em>, we can click <strong class="bold">Assets</strong> &gt; <strong class="bold">Create</strong> &gt; <strong class="bold">Shader</strong> to create a new shader:</p>
			<div>
				<div id="_idContainer411" class="IMG---Figure">
					<img src="image/Figure_8.45_B17146.jpg" alt="Figure 8.45 – Create a shader file&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.45 – Create a shader file</p>
			<p>Some built-in shader templates are listed, such as <strong class="bold">Standard Surface Shader</strong>, <strong class="bold">Unlit Shader</strong>, and <strong class="bold">Image Effect Shader</strong>. Here, we choose the <strong class="bold">Unlit Shader</strong> item to create a new shader that does <a id="_idIndexMarker751"/>not consider lighting factors and name this shader <strong class="source-inline">CustomShader</strong>:</p>
			<div>
				<div id="_idContainer412" class="IMG---Figure">
					<img src="image/Figure_8.46_B17146.jpg" alt="Figure 8.46 – CustomShader&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.46 – CustomShader</p>
			<p>Then, a shader file is created in our project, as shown in the preceding figure. You can open a shader source file in your IDE by double-clicking it, and then you can use Unity's <strong class="bold">ShaderLab language</strong> to <a id="_idIndexMarker752"/>write shader code that defines how Unity calculates the color rendered for each pixel. </p>
			<p class="callout-heading">Note</p>
			<p class="callout">How to write shaders in Unity's <a id="_idIndexMarker753"/>ShaderLab language is beyond the scope of this chapter, but if you're interested, you can find more information at <a href="mailto:https://docs.unity.cn/Packages/com.unity.render-pipelines.universal@7.7/manual/writing-custom-shaders-urp.html">https://docs.unity.cn/Packages/com.unity.render-pipelines.universal@7.7/manual/writing-custom-shaders-urp.html</a>.</p>
			<p>In addition to creating a shader file, we can also create a new custom Shader Graph file to render these models in the scene. Let's continue.</p>
			<h3>Creating a new Shader Graph file</h3>
			<p>Compared with the legacy way of <a id="_idIndexMarker754"/>creating a shader file, creating a new <strong class="bold">Shader Graph</strong> file is easier. The Shader Graph feature was introduced to Unity for the first time in Unity 2018. When developing a Shader Graph file, you don't need to write shader code but use the visualization node to develop directly.</p>
			<p>We can still create a new unlit shader, but this time, we will use Shader Graph instead of a shader file, as shown in the following steps below:</p>
			<ol>
				<li value="1">As shown in <em class="italic">Figure 8.47</em>, click <strong class="bold">Assets</strong> &gt; <strong class="bold">Create</strong> &gt; <strong class="bold">Shader</strong> &gt; <strong class="bold">Universal Render Pipeline</strong> &gt; <strong class="bold">Unlit Shader Graph</strong> in the Unity Editor toolbar to create a new Shader Graph file and name it <strong class="source-inline">CustomShaderGraph</strong>:  </li>
			</ol>
			<div>
				<div id="_idContainer413" class="IMG---Figure">
					<img src="image/Figure_8.47_B17146.jpg" alt="Figure 8.47 – Creating a new Shader Graph file&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.47 – Creating a new Shader Graph file</p>
			<ol>
				<li value="2">A new Shader Graph<a id="_idIndexMarker755"/> file is created, and its suffix is <strong class="source-inline">.shadergraph</strong>, as shown in the following figure:</li>
			</ol>
			<div>
				<div id="_idContainer414" class="IMG---Figure">
					<img src="image/Figure_8.48_B17146.jpg" alt="Figure 8.48 – A Shader Graph file&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.48 – A Shader Graph file</p>
			<ol>
				<li value="3">Double-click this file, and this time, the Shader Graph file will not be opened in an IDE but a visual node editor, displayed directly in the Unity Editor, as shown in <em class="italic">Figure 8.49</em>:</li>
			</ol>
			<div>
				<div id="_idContainer415" class="IMG---Figure">
					<img src="image/Figure_8.49_B17146.jpg" alt="Figure 8.49 – The Shader Graph editor&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.49 – The Shader Graph editor</p>
			<p>This visual node <a id="_idIndexMarker756"/>editor is a lot to take in, so let's walk through it in more detail:</p>
			<ul>
				<li>In Unity, a shader usually consists of two parts, namely the <strong class="bold">Vertex</strong> program and the <strong class="bold">Fragment</strong> program.</li>
				<li>The <strong class="bold">Vertex</strong> program is usually used to convert the 3D coordinates of the vertices of the model into 2D coordinates in the screen space. We already introduced the knowledge of coordinate systems in the previous chapter. In this example, there are three nodes in the vertex program, namely <strong class="bold">Position</strong>, <strong class="bold">Normal</strong>, and <strong class="bold">Tangent</strong>.</li>
				<li>Alternatively, the <strong class="bold">Fragment</strong> program determines the color of the pixels, and in this example, the <strong class="bold">Fragment</strong> program only has one node, named <strong class="bold">Base Color</strong>.</li>
				<li>You can also preview the result of this shader in the <strong class="bold">Main Preview</strong> window in the lower-right corner, as shown in <em class="italic">Figure 8.49</em>. This shader we just created here will render pixels in blue.</li>
			</ul>
			<p>Now that we've created a new Shader Graph file and opened it in the Shader Graph editor, which allows us to edit, add, and delete nodes, we will next take a look at how to edit a node in a Shader Graph file. Let's go!</p>
			<h3>Editing the properties of a node in Shader Graph</h3>
			<p>We can edit the <a id="_idIndexMarker757"/>properties of an existing node in the Shader Graph file. As we mentioned earlier, there is a node named <strong class="bold">Base Color</strong>, so let's edit this node as follows:</p>
			<div>
				<div id="_idContainer416" class="IMG---Figure">
					<img src="image/Figure_8.50_B17146.jpg" alt="Figure 8.50 – Edit the Base Color node&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.50 – Edit the Base Color node</p>
			<ol>
				<li value="1">In the Shader Graph editor, select the <strong class="bold">Base Color</strong> node in the <strong class="bold">Fragment</strong> section.</li>
				<li>Click the color input of this node to open the color picker window.</li>
				<li>Select the color you want to use in the color picker window – in this case, we chose yellow for the <strong class="bold">Base Color</strong> node. The <strong class="bold">Main Preview</strong> window shows us what's happening to the shader, as shown in <em class="italic">Figure 8.50</em>.</li>
			</ol>
			<p>As you can see, it is very easy to modify an existing node; in addition to modifying a node, we can also create a new one to provide more data to the shader. Let's continue.</p>
			<h3>Adding a new node in Shader Graph</h3>
			<p>Developing a<a id="_idIndexMarker758"/> shader usually involves sampling a texture and <a id="_idIndexMarker759"/>returning a color value for the shader to use. Let's perform the following steps to add a new node to add the ability to sample textures to our example shader:</p>
			<ol>
				<li value="1">Right-click in the Shader Graph editor and select <strong class="bold">Create Node</strong> from the pop-up menu:</li>
			</ol>
			<div>
				<div id="_idContainer417" class="IMG---Figure">
					<img src="image/Figure_8.51_B17146.jpg" alt="Figure 8.51 – Creating a node&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.51 – Creating a node</p>
			<ol>
				<li value="2">Enter <strong class="source-inline">texture</strong> in the search bar in the top-left corner of the <strong class="bold">Create Node</strong> window, and then select <strong class="bold">Sample Texture 2D</strong> item in the results list:</li>
			</ol>
			<div>
				<div id="_idContainer418" class="IMG---Figure">
					<img src="image/Figure_8.52_B17146.jpg" alt="Figure 8.52 – Selecting the Sample Texture 2D node&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.52 – Selecting the Sample Texture 2D node</p>
			<ol>
				<li value="3">As <a id="_idIndexMarker760"/>shown in <em class="italic">Figure 8.53</em>, a new <strong class="bold">Sample Texture 2D</strong> node<a id="_idIndexMarker761"/> is created. Click the <strong class="bold">Texture</strong> slot of this node to provide the texture asset:</li>
			</ol>
			<div>
				<div id="_idContainer419" class="IMG---Figure">
					<img src="image/Figure_8.53_B17146.jpg" alt="Figure 8.53 – Clicking the Texture slot of the node&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.53 – Clicking the Texture slot of the node</p>
			<ol>
				<li value="4">Select a texture from the pop-up <strong class="bold">Select Texture</strong> window:</li>
			</ol>
			<div>
				<div id="_idContainer420" class="IMG---Figure">
					<img src="image/Figure_8.54_B17146.jpg" alt="Figure 8.54 – Selecting a texture&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.54 – Selecting a texture</p>
			<ol>
				<li value="5">Then, as <a id="_idIndexMarker762"/>shown in <em class="italic">Figure 8.55</em>, the <strong class="bold">Sample Texture 2D</strong> node<a id="_idIndexMarker763"/> samples the texture from its <strong class="bold">Texture</strong> input and gets the texture's color:</li>
			</ol>
			<div>
				<div id="_idContainer421" class="IMG---Figure">
					<img src="image/Figure_8.55_B17146.jpg" alt="Figure 8.55 – Loading data from a texture asset&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.55 – Loading data from a texture asset</p>
			<p>Now, we have added a new node to the Shader Graph file, but the color obtained from texture <a id="_idIndexMarker764"/>sampling is still stored in the <strong class="bold">Sample Texture 2D</strong> node. Next, we need to connect it with the <strong class="bold">Base Color</strong> node in the <strong class="bold">Fragment</strong> section so<a id="_idIndexMarker765"/> that the shader can render the pixels with the colors obtained from this texture.</p>
			<h3>Connect two nodes in Shader Graph</h3>
			<p>We can pass <a id="_idIndexMarker766"/>data such as color from one node to another <a id="_idIndexMarker767"/>by connecting two nodes in a Shader Graph file, so let's connect the <strong class="bold">Sample Texture 2D</strong> node with the <strong class="bold">Base Color</strong> node using the following steps:</p>
			<ol>
				<li value="1">Click the radio button next to the <strong class="bold">RGBA(4)</strong> output, as shown in <em class="italic">Figure 8.56</em>:</li>
			</ol>
			<div>
				<div id="_idContainer422" class="IMG---Figure">
					<img src="image/Figure_8.56_B17146.jpg" alt="Figure 8.56 – Clicking the radio button&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.56 – Clicking the radio button</p>
			<ol>
				<li value="2">After that, a line that can be dragged freely will appear:</li>
			</ol>
			<div>
				<div id="_idContainer423" class="IMG---Figure">
					<img src="image/Figure_8.57_B17146.jpg" alt="Figure 8.57 – A line will appear&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.57 – A line will appear</p>
			<ol>
				<li value="3">Drag this line to the color input of the <strong class="bold">Base Color</strong> node. As shown in <em class="italic">Figure 8.58</em>, we <a id="_idIndexMarker768"/>connected these two nodes, and <a id="_idIndexMarker769"/>the <strong class="bold">Main Preview</strong> window shows us that the shader has rendered the pixel using the color obtained from the texture:</li>
			</ol>
			<div>
				<div id="_idContainer424" class="IMG---Figure">
					<img src="image/Figure_8.58_B17146.jpg" alt="Figure 8.58 – Connecting two nodes&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.58 – Connecting two nodes</p>
			<p>Now you should know how to create a Shader Graph file and how to modify, add, and connect nodes in it. As developers, we do not need to write shader code when using Shader Graph, but Unity will automatically generate shader code based on the content of the Shader Graph file. </p>
			<p>In this section, we introduced knowledge related to Universal Render Pipeline shaders and materials, then demonstrated how to upgrade a built-in material to Universal Render Pipeline material, and finally, explored how to create a custom shader that can be used in the Universal Render Pipeline. Next, we will continue to discuss how to find performance issues and improve performance of the Universal Render Pipeline.</p>
			<h1 id="_idParaDest-159"><a id="_idTextAnchor161"/>Increasing performance of the Universal Render Pipeline</h1>
			<p>Rendering is a major<a id="_idIndexMarker770"/> function of a game engine. Therefore, it is very important to understand<a id="_idIndexMarker771"/> how to use Unity's render pipeline efficiently. In this section, the topic we will discuss is performance.</p>
			<h2 id="_idParaDest-160"><a id="_idTextAnchor162"/>The Frame Debugger </h2>
			<p>First, we should learn how to use tools to view and locate performance bottlenecks caused by rendering in Unity. </p>
			<p>The <strong class="bold">Frame Debugger</strong> tool in the Unity<a id="_idIndexMarker772"/> Editor is our recommended tool, which allows us to easily view the entire process of rendering a frame in Unity.</p>
			<p>Let's follow the following steps to see how Unity's render pipeline renders a frame of your game:</p>
			<ol>
				<li value="1">Start the game in <a id="_idIndexMarker773"/>the editor by clicking the <strong class="bold">Play</strong> button:</li>
			</ol>
			<div>
				<div id="_idContainer425" class="IMG---Figure">
					<img src="image/Figure_8.59_B17146.jpg" alt="Figure 8.59 – Playing the game in the editor&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.59 – Playing the game in the editor</p>
			<ol>
				<li value="2">Click <strong class="bold">Window</strong> &gt; <strong class="bold">Analysis</strong> &gt; <strong class="bold">Frame Debugger</strong> in the Unity Editor toolbar to open the <strong class="bold">Frame Debugger</strong> window, as shown in <em class="italic">Figure 8.60</em>:</li>
			</ol>
			<div>
				<div id="_idContainer426" class="IMG---Figure">
					<img src="image/Figure_8.60_B17146.jpg" alt="Figure 8.60 – Opening the Frame Debugger&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.60 – Opening the Frame Debugger</p>
			<ol>
				<li value="3">In the <strong class="bold">Frame Debug</strong> window, click the <strong class="bold">Enable</strong> button to take a snapshot of the current frame of<a id="_idIndexMarker774"/> your game, as shown in <em class="italic">Figure 8.61</em>:<div id="_idContainer427" class="IMG---Figure"><img src="image/Figure_8.61_B17146.jpg" alt="Figure 8.61 – The Frame Debugger&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption"> </p>
			<p class="figure-caption">Figure 8.61 – The Frame Debugger</p>
			<ol>
				<li value="4">In <em class="italic">Figure 8.62</em>, we <a id="_idIndexMarker775"/>can see there are <strong class="bold">109</strong> draw calls, which call to the graphics <a id="_idIndexMarker776"/>APIs, such <a id="_idIndexMarker777"/>as <strong class="bold">OpenGL</strong>, <strong class="bold">Direct3D</strong>, and <strong class="bold">Vulkan</strong>, to draw objects. We can also select a specific draw call to view the detailed information of it:  </li>
			</ol>
			<div>
				<div id="_idContainer428" class="IMG---Figure">
					<img src="image/Figure_8.62_B17146.jpg" alt="Figure 8.62 – Viewing the draw call information&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.62 – Viewing the draw call information</p>
			<p>Through the Frame<a id="_idIndexMarker778"/> Debugger tool, we can understand the entire rendering process and view the information of a specific draw call, which provides us with insight to determine what should be done to improve rendering performance. For example, in <em class="italic">Figure 8.62</em>, we can see that <strong class="bold">33</strong> draw calls are used to render opaque objects. Therefore, reducing the count of draw calls here is what we should do. Next, we will introduce how to use the SRP Batcher to do it.</p>
			<h2 id="_idParaDest-161"><a id="_idTextAnchor163"/>The SRP Batcher</h2>
			<p>The <strong class="bold">SRP Batcher</strong> is a <a id="_idIndexMarker779"/>feature provided by the Scriptable Render Pipeline, so every render pipeline based on the Scriptable Render Pipeline can use this feature to reduce the number of draw calls and improve rendering performance. </p>
			<p>In order to ensure that the SRP Batcher can work correctly in your project, you need to ensure two things. The first is to enable the <strong class="bold">SRP Batcher</strong> function of the Universal Render Pipeline, and the second is to ensure that the shaders in your project are compatible with the SRP Batcher.</p>
			<p>Let's first make sure that the SRP Batcher is enabled in the render pipeline. As we mentioned in <em class="italic">The Universal Render Pipeline Asset</em> subsection, we can enable it by checking the <strong class="bold">SRP Batcher</strong> option in the <strong class="bold">Advanced</strong> settings of the Universal Render Pipeline Asset file that our project is using, as shown in <em class="italic">Figure 8.63</em>:</p>
			<div>
				<div id="_idContainer429" class="IMG---Figure">
					<img src="image/Figure_8.63_B17146.jpg" alt="Figure 8.63 – Enabling the SRP Batcher&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.63 – Enabling the SRP Batcher</p>
			<p>Next, let's <a id="_idIndexMarker780"/>check whether the shaders we are using to render these opaque objects are compatible with the SRP Batcher:</p>
			<div>
				<div id="_idContainer430" class="IMG---Figure">
					<img src="image/Figure_8.64_B17146.jpg" alt="Figure 8.64 – The SRP Batcher compatibility status of the shader&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.64 – The SRP Batcher compatibility status of the shader</p>
			<p>We can find the SRP Batcher compatibility status of the shader in the <strong class="bold">Inspector</strong> window, as shown in the preceding figure. Here, the <strong class="bold">Universal Render Pipeline/Lit</strong> shader is used, which is compatible with the SRP Batcher.</p>
			<p>Now, let's run the game and check the Frame Debugger again:</p>
			<div>
				<div id="_idContainer431" class="IMG---Figure">
					<img src="image/Figure_8.65_B17146.jpg" alt="Figure 8.65 – The number of draw calls is reduced&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.65 – The number of draw calls is reduced</p>
			<p>As you can see in <em class="italic">Figure 8.65</em>, the <a id="_idIndexMarker781"/>total number of draw calls has been reduced from <strong class="bold">109</strong> to <strong class="bold">91</strong>, the number of draw calls used to render opaque objects has been reduced from <strong class="bold">33</strong> to <strong class="bold">20</strong>, and each draw call is marked as <strong class="bold">SRP Batch</strong>.</p>
			<p>In this section, we started by introducing how to use Unity's Frame Debugger tool to view the entire rendering process and the information of a specific draw call. Then, we also explored how to reduce the number of draw calls and improve rendering performance by using the SRP Batcher.</p>
			<h1 id="_idParaDest-162"><a id="_idTextAnchor164"/>Summary</h1>
			<p>This chapter introduces three ready-made render pipelines to choose from in Unity, namely the legacy built-in render pipeline and two pre-made render pipelines based on the Scriptable Render Pipeline – the Universal Render Pipeline and the High Definition Render Pipeline. At the same time, we also introduced some open source projects that use these render pipelines for you to learn and use.</p>
			<p>Then, we discussed how to use the Universal Render Pipeline in Unity by first exploring a sample scene, and then we explained how to use the Universal Render Pipeline Asset to configure your render pipeline and the Volume framework to apply post-processing effects to your game.</p>
			<p>We also introduced the concept of shaders and materials, demonstrated how to upgrade a built-in material to Universal Render Pipeline material, and explored how to create a custom shader that can be used in the Universal Render Pipeline.</p>
			<p>Finally, we explored how to use Unity's Frame Debugger tool to view the information of the rendering process and how to use the SRP Batcher to reduce the number of draw calls.</p>
			<p>By reading this chapter, you should now understand how to work with the Universal Render Pipeline correctly in Unity. In the next chapter, we will introduce how to use the <strong class="bold">Data-Oriented Technology Stack</strong> (<strong class="bold">DOTS</strong>) in Unity.</p>
		</div>
	</body></html>