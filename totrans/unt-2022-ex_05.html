<html><head></head><body>
<div id="sbo-rt-content" class="calibre1"><div id="_idContainer050" class="calibre2">
<h1 class="chapter-number" id="_idParaDest-58"><a id="_idTextAnchor058" class="pcalibre1 pcalibre calibre6"/>3</h1>
<h1 id="_idParaDest-59" class="calibre5"><a id="_idTextAnchor059" class="pcalibre1 pcalibre calibre6"/>Completing the Collection Game</h1>
<p class="calibre3">In <a href="B18347_02.xhtml#_idTextAnchor041" class="pcalibre1 pcalibre calibre6"><span><em class="italic">Chapter 2</em></span></a>, you were introduced to level design, adding different 2D assets, using assets with Tilemap to create a game environment, and creating scripts using the C# language and the <strong class="bold">Visual Studio</strong> (<strong class="bold">VS</strong>) IDE<a id="_idIndexMarker289" class="pcalibre1 pcalibre calibre6"/> to add movement to the <span>player character.</span></p>
<p class="calibre3">With the player moving around the environment, we’ll want a way to follow them visually around the level. This chapter will use Unity’s camera system called <strong class="bold">Cinemachine</strong> (<strong class="bold">CM</strong>) – a <a id="_idIndexMarker290" class="pcalibre1 pcalibre calibre6"/>powerful camera control feature that makes polished camera movement easy to add and <span>set up.</span></p>
<p class="calibre3">We’ll finish the chapter with an introduction to adding a <strong class="bold">user interface</strong> (<strong class="bold">UI</strong>). You’ll learn how to add text to the screen to track gameplay progress with a timer and score. We’ll use Unity’s UI system, commonly called <strong class="bold">uGUI</strong>, to<a id="_idIndexMarker291" class="pcalibre1 pcalibre calibre6"/> accomplish <span>this task.</span></p>
<p class="calibre3">In this chapter, we’re going to cover the following <span>main topics:</span></p>
<ul class="calibre17">
<li class="calibre15">Using CM to follow the Player <span>and playtesting</span></li>
<li class="calibre15">Game mechanics and how to create with <span>code (components)</span></li>
<li class="calibre15">Introduction to uGUI, the timer, counting, <span>and winning</span></li>
</ul>
<p class="calibre3">By the end of this chapter, you’ll be able to code game mechanics with C# scripts by adding functionality to GameObjects and be comfortable with adding essential UI to <span>your game.</span></p>
<h1 id="_idParaDest-60" class="calibre5"><a id="_idTextAnchor060" class="pcalibre1 pcalibre calibre6"/>Technical requirements</h1>
<p class="calibre3">You can download the complete project on GitHub <span>at </span><a href="https://github.com/PacktPublishing/Unity-2022-by-Example" class="pcalibre1 pcalibre calibre6"><span>https://github.com/PacktPublishing/Unity-2022-by-Example</span></a><span>.</span></p>
<h1 id="_idParaDest-61" class="calibre5"><a id="_idTextAnchor061" class="pcalibre1 pcalibre calibre6"/>Using CM to follow the Player and playtesting</h1>
<p class="calibre3"><strong class="bold">CM </strong>is<a id="_idIndexMarker292" class="pcalibre1 pcalibre calibre6"/> expansive in its features – no wonder it’s an Emmy award-winning suite of codeless camera tools – but we’re only going to focus on one function: the ability to have a camera follow our ladybug around the <span>2D environment.</span></p>
<p class="calibre3">First, we’ll need to ensure we have the CM package installed by going to <strong class="bold">Windows</strong> | <strong class="bold">Package Manager</strong>, selecting <strong class="bold">Cinemachine</strong>, and clicking the <strong class="bold">Install</strong> button. CM won’t help us much without a Player to follow around, so let’s get the Player we designed in the previous chapter and import it into our <span>level scene.</span></p>
<h2 id="_idParaDest-62" class="calibre8"><a id="_idTextAnchor062" class="pcalibre1 pcalibre calibre6"/>Creating a Player Prefab</h2>
<p class="calibre3">Unity’s <strong class="bold">Prefab</strong> system<a id="_idIndexMarker293" class="pcalibre1 pcalibre calibre6"/> allows you to store configured GameObjects as reusable <a id="_idIndexMarker294" class="pcalibre1 pcalibre calibre6"/>assets (files) in your project – complete with all its components, assigned<a id="_idIndexMarker295" class="pcalibre1 pcalibre calibre6"/> values, and any child GameObjects. You can even have Prefabs as children of another Prefab; in this case, we call <a id="_idIndexMarker296" class="pcalibre1 pcalibre calibre6"/>them <span><strong class="bold">nested Prefabs</strong></span><span>.</span></p>
<p class="calibre3">Additionally, new <a id="_idIndexMarker297" class="pcalibre1 pcalibre calibre6"/>Prefab assets can be derived from an original Prefab as a <strong class="bold">Prefab Variant</strong> (the same base properties but unique variations – when the base Prefab is modified, so are all its <span>derived variants).</span></p>
<p class="calibre3">One of the powers of Prefabs is the ability to spawn new instances of them into your scene at runtime (think swarms of<a id="_idIndexMarker298" class="pcalibre1 pcalibre calibre6"/> enemy <strong class="bold">non-player characters</strong> (<strong class="bold">NPCs</strong>), projectiles, pick-up items, repeating parts of an environment, and <span>so</span><span><a id="_idIndexMarker299" class="pcalibre1 pcalibre calibre6"/></span><span> on).</span></p>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><span><strong class="bold">Prefabs</strong></span><span>: </span><a href="https://docs.unity3d.com/2022.3/Documentation/Manual/Prefabs.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/2022.3/Documentation/Manual/Prefabs.xhtml</span></a></p>
<p class="calibre3">Follow these steps to create a<a id="_idIndexMarker300" class="pcalibre1 pcalibre calibre6"/> Prefab of our <span>player character:</span></p>
<ol class="calibre14">
<li class="calibre15">Open the scene you previously saved with your player <span>character design.</span></li>
<li class="calibre15">Create a <strong class="source-inline">Prefabs</strong> folder at <strong class="source-inline">Assets/Prefabs</strong> and make it the <span>current folder.</span></li>
<li class="calibre15">Click and <a id="_idIndexMarker301" class="pcalibre1 pcalibre calibre6"/>drag the <strong class="bold">Player</strong> GameObject from the <strong class="bold">Scene Hierarchy</strong> into the <strong class="source-inline">Assets/Prefabs</strong> folder. In <span><em class="italic">Figure 3</em></span><em class="italic">.1</em>, you can see our freshly created ladybug Player <span>Prefab asset.</span></li>
<li class="calibre15">Now, go back to your game level scene and click and drag the <strong class="bold">Player</strong> Prefab from the <strong class="bold">Project</strong> window to the <strong class="bold">Hierarchy</strong> window (this will place the Player object at position (<strong class="source-inline">0</strong>, <strong class="source-inline">0</strong>, <strong class="source-inline">0</strong>) in <span>the scene).</span></li>
<li class="calibre15">You may not be able to <a id="_idIndexMarker302" class="pcalibre1 pcalibre calibre6"/>see the player character in the scene View because we have not assigned any Sorting Layer for its sprites. Rather than assigning the Sorting Layer to all the sprites individually, we can simply use the <strong class="bold">Sorting Group</strong> component<a id="_idIndexMarker303" class="pcalibre1 pcalibre calibre6"/> <span>as follows:</span><ol class="calibre42"><li class="calibre15">With the Player selected, in the <strong class="bold">Inspector</strong>, click on <strong class="bold">Add Component</strong> and type <strong class="source-inline">sorting</strong> in the <strong class="bold">Search</strong> field. Select <strong class="bold">Sorting Group</strong> in <span>the results.</span></li><li class="calibre15">We’ve previously established the <strong class="bold">Sorting Layers</strong> for the tilemaps. From that, we can determine that <strong class="bold">Default</strong> will be suitable for the <span>player character.</span></li><li class="calibre15">Set the <strong class="bold">Order in Layer</strong> value to something high such as <strong class="source-inline">1000</strong>, to ensure that the player will always draw as the top-most sprite if we add any additional<a id="_idIndexMarker304" class="pcalibre1 pcalibre calibre6"/> sprites to this <a id="_idIndexMarker305" class="pcalibre1 pcalibre calibre6"/><span>Sorting Layer.</span></li></ol></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer037">
<img alt="Figure 3.1 – The Ladybug Player Prefab" src="image/B18347_03_01.jpg" class="calibre43"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 3.1 – The Ladybug Player Prefab</p>
<p class="callout-heading">Tip | Unity documentation</p>
<p class="callout">To apply changes to a Prefab in the <strong class="bold">Scene Hierarchy</strong> – while the Prefab is not open in <strong class="bold">Prefab Mode</strong> (an isolated environment for directly editing the Prefab) – use the <strong class="bold">Review</strong>, <strong class="bold">Revert</strong>, or <strong class="bold">Apply Override</strong> drop-down at the top of the <strong class="bold">Inspector</strong> (simply shown as <strong class="bold">Overrides</strong>). Alternatively, the quickest way to enter <strong class="bold">Prefab Mode</strong> is by double-clicking on a Prefab in the <span>Project window.</span></p>
<p class="callout"><em class="italic">Editing a Prefab in Prefab Mode</em> | <em class="italic">Editing in </em><span><em class="italic">Isolation</em></span><span>: </span><a href="https://docs.unity3d.com/2022.3/Documentation/Manual/EditingInPrefabMode.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/2022.3/Documentation/Manual/EditingInPrefabMode.xhtml</span></a></p>
<h2 id="_idParaDest-63" class="calibre8"><a id="_idTextAnchor063" class="pcalibre1 pcalibre calibre6"/>Creating a 2D follow camera</h2>
<p class="calibre3">With CM, it’s trivial<a id="_idIndexMarker306" class="pcalibre1 pcalibre calibre6"/> to create a follow camera for a 2D environment. Now that we<a id="_idIndexMarker307" class="pcalibre1 pcalibre calibre6"/> have our player in the scene, we can add a CM camera that will follow the player around as it moves with the <span>following steps:</span></p>
<ol class="calibre14">
<li class="calibre15">Create a <a id="_idIndexMarker308" class="pcalibre1 pcalibre calibre6"/>new CM <strong class="bold">virtual camera</strong> (<strong class="bold">vcam</strong>) from the <strong class="bold">Hierarchy</strong> window’s <strong class="bold">Create</strong> menu or the main <strong class="bold">File</strong> menu by going to <strong class="bold">GameObject</strong> | <strong class="bold">Cinemachine</strong> | <strong class="bold">2D Camera</strong> – for the first vcam added to the scene, this also adds a <strong class="bold">Cinemachine Brain</strong> component<a id="_idIndexMarker309" class="pcalibre1 pcalibre calibre6"/> to <strong class="bold">Main Camera</strong> (CM controls <strong class="bold">Main Camera</strong> through one or <span>many vcams).</span></li>
<li class="calibre15">With the new vcam selected, drag the <strong class="bold">Player</strong> object from the <strong class="bold">Hierarchy</strong> to the <strong class="bold">Follow</strong> field in the <strong class="bold">CinemachineVirtualCamera</strong> component (to assign its reference), as seen in the <span>following screenshot:</span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer038">
<img alt="Figure 3.2 – The CM Follow Player Inspector assignment" src="image/B18347_03_02.jpg" class="calibre44"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 3.2 – The CM Follow Player Inspector assignment</p>
<ol class="calibre14">
<li value="3" class="calibre15">Within<a id="_idIndexMarker310" class="pcalibre1 pcalibre calibre6"/> the <strong class="bold">Body</strong> section, expand the arrow to the left of <strong class="bold">Body</strong> if <a id="_idIndexMarker311" class="pcalibre1 pcalibre calibre6"/>necessary; you can adjust XY damping, screen position, dead zones, and so on. Play around with these settings and fine-tune your camera to<a id="_idIndexMarker312" class="pcalibre1 pcalibre calibre6"/> follow <span>your preferences.</span></li>
</ol>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><span><strong class="bold">Cinemachine</strong></span><span>: </span><a href="https://docs.unity3d.com/Packages/com.unity.cinemachine%402.3/manual/index.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/Packages/com.unity.cinemachine%402.3/manual/index.xhtml</span></a></p>
<p class="callout"><strong class="bold">Cinemachine </strong><span><strong class="bold">feature</strong></span><span>: </span><a href="https://unity.com/unity/features/editor/art-and-design/cinemachine" class="pcalibre1 pcalibre calibre6"><span>https://unity.com/unity/features/editor/art-and-design/cinemachine</span></a></p>
<p class="callout"><em class="italic">Cinemachine for 2D Tips and </em><span><em class="italic">Tricks</em></span><span>: </span><a href="https://blog.unity.com/technology/cinemachine-for-2d-tips-and-tricks" class="pcalibre1 pcalibre calibre6"><span>https://blog.unity.com/technology/cinemachine-for-2d-tips-and-tricks</span></a></p>
<p class="calibre3">We can now explore the entire environment knowing that the camera will follow us <span>around. Yay!</span></p>
<h2 id="_idParaDest-64" class="calibre8"><a id="_idTextAnchor064" class="pcalibre1 pcalibre calibre6"/>Playtesting the level</h2>
<p class="calibre3">The last step to make our level<a id="_idIndexMarker313" class="pcalibre1 pcalibre calibre6"/> playable is to add the necessary components (that is, <strong class="bold">PlayerController</strong> and physics), adjust the component values, and assign the <span>component references.</span></p>
<p class="calibre3">Let’s do this now with the <span>following steps:</span></p>
<ol class="calibre14">
<li class="calibre15">Open the <strong class="bold">Player</strong> Prefab in <strong class="bold">Prefab Mode</strong> by selecting it in the <strong class="bold">Hierarchy</strong> or selecting the <strong class="bold">Prefab</strong> asset in the <strong class="bold">Project</strong> window, and then click <strong class="bold">Open</strong> at the top of <span>the </span><span><strong class="bold">Inspector</strong></span><span>.</span></li>
<li class="calibre15">Add a <strong class="bold">CapsuleCollider2D</strong> component by clicking <strong class="bold">Add Component</strong>, searching for <strong class="source-inline">collider</strong>, and selecting it in the results – this will provide physics interactions with other colliders in the environment via Unity’s built-in 2D physics <span>engine (Box2D).</span></li>
<li class="calibre15">Adjust the collider to fit the graphics for your player using both the <strong class="bold">Offset</strong> and <strong class="bold">Size</strong> fields, then use the <strong class="bold">Edit Collider</strong> button to move it manually into position in the <span>scene View.</span></li>
<li class="calibre15">Add a <strong class="bold">Rigidbody 2D</strong> component by clicking <strong class="bold">Add Component</strong>, searching for <strong class="source-inline">rigidbody</strong>, and selecting it in the results – this will provide the physics properties to our player character, such as how it’s affected by gravity, its mass, drag, position/rotation constraints, and the type of <strong class="bold">Collision Detection</strong> <span>to employ:</span><ol class="calibre42"><li class="calibre15">Enable <strong class="bold">Auto Mass</strong> by clicking the checkbox as this will automatically set the mass to the 2D <span>collider’s mass.</span></li><li class="calibre15">Set the values for <strong class="bold">Linear Drag</strong> (<strong class="source-inline">100</strong>) and <strong class="bold">Angular Drag</strong> (<strong class="source-inline">1</strong>) to refine the player movement (adjust to <span>your preferences).</span></li><li class="calibre15">Most importantly, disable <strong class="bold">Gravity</strong> by setting its value to <strong class="source-inline">0</strong> – in a top-down environment, everything is already <em class="italic">sitting on the ground</em>, so we don’t assign any gravity (if we did, the object would fall toward the bottom of the screen since gravity is based on the <em class="italic">y</em> axis; this works well for a 2D side-on <span>game view).</span></li></ol></li>
<li class="calibre15">Add the <strong class="bold">PlayerController</strong> script by using the <strong class="bold">Add Component</strong> button in the <strong class="bold">Inspector</strong> or dragging the script from the <strong class="bold">Project</strong> window onto <strong class="bold">Player</strong> in the <strong class="bold">Hierarchy</strong> window or, with the <strong class="bold">Player</strong> object already selected, into <span>the </span><span><strong class="bold">Inspector</strong></span><span>.</span></li>
<li class="calibre15">Assign the <strong class="bold">Rigidbody 2D</strong> component <a id="_idIndexMarker314" class="pcalibre1 pcalibre calibre6"/>to the <strong class="bold">Rb</strong> field by clicking on the component’s <strong class="bold">Rigidbody 2D</strong> title and dragging it to the <strong class="bold">Rb</strong> field (where it currently says <strong class="bold">None (Rigidbody 2D)</strong>) – this creates a direct reference to the component that our <strong class="source-inline">PlayerController</strong> <span>script uses.</span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer039">
<img alt="Figure 3.3 – The Player Prefab components configuration" src="image/B18347_03_03.jpg" class="calibre45"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 3.3 – The Player Prefab components configuration</p>
<p class="calibre3">That’s it! We can now press the <strong class="bold">Play</strong> button on the main toolbar to playtest our <span>level design.</span></p>
<p class="calibre3">The ladybug <a id="_idIndexMarker315" class="pcalibre1 pcalibre calibre6"/>will rotate to face the mouse pointer’s position and move in the direction it’s facing while the spacebar is being held down. Tiles on the <strong class="bold">Tilemap</strong> with <strong class="bold">TilemapCollider2D</strong> assigned will prevent the player from moving into <span>those areas.</span></p>
<p class="calibre3">Now is an excellent time to adjust the values on the <strong class="bold">Rigidbody 2D</strong> fields for mass and drag and test changing the values for the move, and look at rotation speeds on <strong class="source-inline">PlayerController</strong>. Here, you can see the default values we <span>started with:</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer040">
<img alt="Figure 3.4 – The PlayerController Inspector field values" src="image/B18347_03_04.jpg" class="calibre46"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 3.4 – The PlayerController Inspector field values</p>
<p class="calibre3">Making these adjustments <a id="_idIndexMarker316" class="pcalibre1 pcalibre calibre6"/>affects the game feel and the overall player experience, so spend time fine-tuning these values until it just <em class="italic">feels right</em> to you as the game designer. <span>Have fun!</span></p>
<p class="callout-heading">Tip</p>
<p class="callout">When you find values that you like and want to quickly go back and forth between them during testing (without having to write them on a scratch pad somewhere), you can use <strong class="bold">Presets</strong> (the <em class="italic">slider icon</em> on the<a id="_idIndexMarker317" class="pcalibre1 pcalibre calibre6"/> right side of the <strong class="bold">Component</strong> title <span>bar): </span><a href="https://docs.unity3d.com/2022.3/Documentation/Manual/Presets.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/2022.3/Documentation/Manual/Presets.xhtml</span></a></p>
<p class="calibre3">In this section, you learned how to read input directly from an input device to move the player character with a custom C# script while using physics, you explored the timesaving and powerful features adding a CM vcam provides, and you understood that playtesting is about refining values to get the right game feel for a good <span>player experience.</span></p>
<p class="callout-heading">Bonus activity</p>
<p class="callout">Make the ladybug player character move while also holding down the left <span>mouse button.</span></p>
<p class="calibre3">In the next section, we’ll implement some interactions for the player by coding <span>collecting pickups.</span></p>
<h1 id="_idParaDest-65" class="calibre5"><a id="_idTextAnchor065" class="pcalibre1 pcalibre calibre6"/>Game mechanics and how to create with code (components)</h1>
<p class="calibre3">This section will explore the concept of game mechanics and what that means for the gameplay in the <em class="italic">Outer World</em> collection game we’re making. We’ll define precisely the mechanic we’ll be using in a brief expansion on<a id="_idIndexMarker318" class="pcalibre1 pcalibre calibre6"/> the <strong class="bold">Game Design Document</strong> (<strong class="bold">GDD</strong>) and finish with writing the code for the mechanic by adding a new Prefab with a custom component that uses a 2D physics <span>interaction event.</span></p>
<h2 id="_idParaDest-66" class="calibre8"><a id="_idTextAnchor066" class="pcalibre1 pcalibre calibre6"/>What is a game mechanic?</h2>
<p class="calibre3">A <strong class="bold">game mechanic</strong> can <a id="_idIndexMarker319" class="pcalibre1 pcalibre calibre6"/>loosely be defined as the rules that dictate the gameplay and how the player is supposed to engage with the mechanics sufficiently to provide a joyful and entertaining experience. Examples of some popular types of gameplay mechanics include collecting, moving, shooting, and <span>building things.</span></p>
<p class="calibre3">Some game mechanic<a id="_idIndexMarker320" class="pcalibre1 pcalibre calibre6"/> rules that dictate gameplay are followed by the game and not the player, such as the game only unlocking a new level when the player completes the <span>current level.</span></p>
<p class="callout-heading">Buff &amp; Nerf | game balance</p>
<p class="callout">Changing elements of mechanics to a player’s advantage is known <a id="_idIndexMarker321" class="pcalibre1 pcalibre calibre6"/>as the <strong class="bold">Buff</strong> and to their disadvantage is the <strong class="bold">Nerf</strong>, keeping <a id="_idIndexMarker322" class="pcalibre1 pcalibre calibre6"/>the game <span>balanced: </span><a href="https://www.inverse.com/gaming/nerf-buff-meaning-video-games-coined-series" class="pcalibre1 pcalibre calibre6"><span>https://www.inverse.com/gaming/nerf-buff-meaning-video-games-coined-series</span></a></p>
<p class="calibre3">Let’s explore adding our game’s primary <span>mechanic now.</span></p>
<h2 id="_idParaDest-67" class="calibre8"><a id="_idTextAnchor067" class="pcalibre1 pcalibre calibre6"/>Adding to our GDD</h2>
<p class="calibre3">The game<a id="_idIndexMarker323" class="pcalibre1 pcalibre calibre6"/> mechanic we’re going to add to our GDD and implement is the collection of pickup items in the environment. We can describe it <span>as follows:</span></p>
<table class="no-table-style" id="table001-2">
<colgroup class="calibre11">
<col class="calibre12"/>
<col class="calibre12"/>
</colgroup>
<tbody class="calibre13">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="bold">Name </strong><span><strong class="bold">of Game</strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span>Outer World</span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="bold">What is the core game mechanic for the </strong><span><strong class="bold">collection game?</strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3">The player will find and collect “water diamonds” throughout the environment by touching them until all are collected, or the countdown <span>timer expires.</span></p>
</td>
</tr>
</tbody>
</table>
<p class="img---caption" lang="en-US" xml:lang="en-US">Table 3.1 – The GDD game mechanic addition</p>
<p class="callout-heading">Additional reading | Game mechanics</p>
<p class="callout">Will Wright (<em class="italic">The Sims</em> creator), <em class="italic">5 Tips for Writing Game </em><span><em class="italic">Mechanics</em></span><span>: </span><a href="https://www.masterclass.com/articles/will-wrights-tips-for-writing-game-mechanics#will-wrights-5-tips-for-writing-game-mechanics" class="pcalibre1 pcalibre calibre6"><span>https://www.masterclass.com/articles/will-wrights-tips-for-writing-game-mechanics#will-wrights-5-tips-for-writing-game-mechanics</span></a></p>
<p class="calibre3">Now that we have our core <a id="_idIndexMarker324" class="pcalibre1 pcalibre calibre6"/>game mechanic defined, let’s put the code together to make <span>it work!</span></p>
<p class="callout-heading">Bonus activity</p>
<p class="callout">By exploring the idea of adding additional physics-based objects to our level, design a game mechanic that involves the player pushing around tile blocks that we’ll call <em class="italic">toolboxes</em>. The toolboxes could inconvenience the player and slow them down in pursuit of collecting the <em class="italic">water diamonds</em> or provide additional gameplay by requiring them to be moved into <span>specific locations.</span></p>
<h2 id="_idParaDest-68" class="calibre8"><a id="_idTextAnchor068" class="pcalibre1 pcalibre calibre6"/>Collecting pickups</h2>
<p class="calibre3">A lot of the <a id="_idIndexMarker325" class="pcalibre1 pcalibre calibre6"/>basics for working within Unity and creating component-based scripts have been covered by this point, so we’re going to be moving a bit faster in putting things together – while not spending as much time explaining the <span>small details.</span></p>
<p class="calibre3">The primary objective of our core mechanic is collecting objects. We’ll accomplish this by taking advantage of the interaction events the 2D physics engine provides. Here <span>we go!</span></p>
<h3 class="calibre10">Creating a collectible item Prefab</h3>
<p class="calibre3">First, we need a sprite for our<a id="_idIndexMarker326" class="pcalibre1 pcalibre calibre6"/> collected object – the <em class="italic">water diamond</em>. You can either create your sprite art within Unity (as we did with the ladybug character) or<a id="_idIndexMarker327" class="pcalibre1 pcalibre calibre6"/> import one (the suggested size is a 64 px square). Create a new Prefab for the collection object with the <span>following steps:</span></p>
<ol class="calibre14">
<li class="calibre15">Add your <em class="italic">water diamond</em> sprite to <span>the scene.</span></li>
<li class="calibre15">Parent the <strong class="bold">Graphics</strong> object’s sprite to an empty <span>GameObject (container).</span></li>
<li class="calibre15">On the parent GameObject, add a primitive collider that best fits the shape of your <em class="italic">water diamond</em> sprite – I chose <strong class="bold">CapsuleCollider2D</strong>, as seen in <span><em class="italic">Figure 3</em></span><span><em class="italic">.5</em></span><span>.</span></li>
<li class="calibre15">Enable the <strong class="bold">IsTrigger</strong> field on the <strong class="bold">CapsuleCollider2D</strong> component since we don’t want any collision interactions to occur between the diamond and the Player; we just want to receive a message for the <span>interaction event.</span></li>
</ol>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout">The simple takeaway here is that when <strong class="source-inline1">IsTrigger</strong> is enabled, no physical collisions between objects will occur – objects won’t move in response to <span>forces applied.</span></p>
<p class="callout"><span><strong class="source-inline1">Collider.isTrigger</strong></span><span>: </span><a href="https://docs.unity3d.com/2022.3/Documentation/ScriptReference/Collider-isTrigger.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/2022.3/Documentation/ScriptReference/Collider-isTrigger.xhtml</span></a></p>
<ol class="calibre14">
<li value="5" class="calibre15">Let’s not forget to <a id="_idIndexMarker328" class="pcalibre1 pcalibre calibre6"/>ensure the sprite is drawn at the<a id="_idIndexMarker329" class="pcalibre1 pcalibre calibre6"/> correct depth in our <strong class="source-inline">Sprite Renderer</strong>’s <strong class="bold">Sorting Layers</strong>. Let’s use the <strong class="bold">Objects</strong> layer and set the <strong class="bold">Order in Layer</strong> value to something high such <span>as </span><span><strong class="source-inline">100</strong></span><span>.</span></li>
<li class="calibre15">If you created your sprite within Unity using the Sprite Creator tool’s shapes, select the <strong class="bold">Graphics</strong> parent object and add a <strong class="bold">Sorting Group</strong> component to assign the <span>Sorting Layer.</span></li>
<li class="calibre15">Drag the <a id="_idIndexMarker330" class="pcalibre1 pcalibre calibre6"/>root object the sprite was parented to into the <strong class="source-inline">Assets/Prefabs</strong> folder in the <span><strong class="bold">Project</strong></span><span> window.</span></li>
</ol>
<p class="callout-heading">Tip | Unity documentation</p>
<p class="callout">Objects in the <strong class="bold">Hierarchy</strong> window turn blue and have the right caret (arrow) to their right when the GameObject is made into a Prefab. Clicking the caret will take you into <strong class="bold">Prefab Mode</strong> in the context of the scene (as shown in <span><em class="italic">Figure 3</em></span><span><em class="italic">.5</em></span><span>).</span></p>
<p class="callout"><em class="italic">Editing a Prefab in Prefab Mode</em> | <em class="italic">Editing in </em><span><em class="italic">context</em></span><span>: </span><a href="https://docs.unity3d.com/2022.3/Documentation/Manual/EditingInPrefabMode.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/2022.3/Documentation/Manual/EditingInPrefabMode.xhtml</span></a></p>
<p class="calibre3">You can verify your <a id="_idIndexMarker331" class="pcalibre1 pcalibre calibre6"/>collectible <strong class="bold">Water Diamond</strong> Prefab setup with the <span>following</span><span><a id="_idIndexMarker332" class="pcalibre1 pcalibre calibre6"/></span><span> screenshot:</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer041">
<img alt="Figure 3.5 – Water Diamond Prefab with collider" src="image/B18347_03_05.jpg" class="calibre20"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 3.5 – Water Diamond Prefab with collider</p>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><strong class="bold">Collider </strong><span><strong class="bold">2D</strong></span><span>: </span><a href="https://docs.unity3d.com/2022.3/Documentation/ScriptReference/CapsuleCollider2D.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/2022.3/Documentation/ScriptReference/CapsuleCollider2D.xhtml</span></a></p>
<p class="callout"><strong class="bold">Optimizing Physics </strong><span><strong class="bold">Performance</strong></span><span>: </span><a href="https://docs.unity3d.com/2022.3/Documentation/Manual/iphone-Optimizing-Physics.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/2022.3/Documentation/Manual/iphone-Optimizing-Physics.xhtml</span></a></p>
<p class="callout">Note that the performance order of<a id="_idIndexMarker333" class="pcalibre1 pcalibre calibre6"/> 2D colliders, from the fastest to slowest, is: <strong class="bold">Circle</strong>, <strong class="bold">Capsule</strong>, <strong class="bold">Box</strong>, <strong class="bold">Composite</strong>, <strong class="bold">Polygon</strong>, and <span>then </span><span><strong class="bold">Edge</strong></span><span>.</span></p>
<p class="calibre3">Okay, we have our Prefab for the collectible item’s sprite; now, let’s code <span>the interaction.</span></p>
<h3 class="calibre10">Creating the CollectItem component</h3>
<p class="calibre3">Create a new <a id="_idIndexMarker334" class="pcalibre1 pcalibre calibre6"/>script in the <strong class="source-inline">Scripts</strong> folder and name it <strong class="source-inline">CollectItem</strong>. Replace<a id="_idIndexMarker335" class="pcalibre1 pcalibre calibre6"/> the generated code with the <span>following template:</span></p>
<pre class="source-code">
using UnityEngine;
public class CollectItem : MonoBehaviour
{
    void Start()
    {
        Debug.Log($"{gameObject.name}'s Start
            called", gameObject);
    }
    private void OnTriggerEnter2D(Collider2D collision)
    {
        Debug.Log("Collision message event triggered!");
        Destroy(gameObject);
    }
    private void OnDestroy()
    {
        Debug.Log("Destroyed");
    }
}</pre> <p class="calibre3">Let’s have a look at the<a id="_idIndexMarker336" class="pcalibre1 pcalibre calibre6"/> code line <span>by line:</span></p>
<ol class="calibre14">
<li class="calibre15">The <strong class="source-inline">Debug.Log()</strong> line in <strong class="source-inline">Start()</strong> will just output a message to our <strong class="bold">Console Window</strong> (aka <strong class="bold">Console</strong>) with the name of the GameObject the <strong class="source-inline">Start()</strong> method was called on. We can use this to verify that all of the collectible item<a id="_idIndexMarker337" class="pcalibre1 pcalibre calibre6"/> objects we’ll add to the<a id="_idIndexMarker338" class="pcalibre1 pcalibre calibre6"/> scene are <em class="italic">registering</em> themselves. We’ll be using this to increment the count for total items needing to be collected in the level (the 10 in <em class="italic">0 of 10</em>) when we add our UI in the <span>next section.</span></li>
</ol>
<p class="callout-heading">$ string interpolation | C#</p>
<p class="callout">The dollar sign (<strong class="source-inline1">$</strong>) in <strong class="source-inline1">Debug.Log($"{gameObject.name}'s Start called");</strong> is for identifying an interpolated string. The text within <strong class="source-inline1">{}</strong> (open/close squiggly brackets) in the string literal (represented by two double quotes (<strong class="source-inline1">""</strong>)) is a string result of the inserted code (usually a variable <span>or expression).</span></p>
<p class="callout">Refer to the C# language reference for additional <span>reading: </span><a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/tokens/interpolated" class="pcalibre1 pcalibre calibre6"><span>https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/tokens/interpolated</span></a></p>
<p class="calibre3">Because we’ve added a second parameter to the <strong class="source-inline">Debug.Log()</strong> call (<strong class="source-inline">gameObject</strong>), when the <strong class="bold">Console</strong> log item is clicked on, the corresponding object in the <strong class="bold">Hierarchy</strong> will be highlighted. The <strong class="source-inline">gameObject</strong> (camelCase) keyword refers to the current GameObject (PascalCase) the component is running on (also provided by the <strong class="source-inline">MonoBehaviour</strong> <span>base class).</span></p>
<p class="callout-heading">Optimization note | Unity documentation</p>
<p class="callout">Note that you’ll want to comment out <strong class="source-inline1">Debug.Log()</strong> statements for performance reasons once you’ve finished testing and they are no <span>longer needed.</span></p>
<p class="callout"><span><strong class="bold">Debug</strong></span><span>: </span><a href="https://docs.unity3d.com/2022.3/Documentation/Manual/class-Debug.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/2022.3/Documentation/Manual/class-Debug.xhtml</span></a></p>
<ol class="calibre14">
<li value="2" class="calibre15"><strong class="source-inline">OnTriggerEnter2D(Collider2D collision)</strong> is where the magic happens. This <a id="_idIndexMarker339" class="pcalibre1 pcalibre calibre6"/>Unity message is called when a collision occurs between two physics objects where one of the objects has a collider <strong class="source-inline">IsTrigger</strong> value enabled. We receive a reference to the other object’s collider with the collision parameter value (we’ll be using <strong class="source-inline">collision</strong> to detect whether the other object is the Player in the <span>next section).</span></li>
<li class="calibre15"><strong class="source-inline">OnDestroy()</strong> is another<a id="_idIndexMarker340" class="pcalibre1 pcalibre calibre6"/> Unity message that is called when the GameObject in the scene is destroyed – by using the <strong class="source-inline">Destroy()</strong> method, as you can see in the <strong class="source-inline">OnTriggerEnter2D()</strong> method previously, when the Player collides with the collectible item, it will process the collection of the item in <strong class="source-inline">OnTriggerEnter2D()</strong> and then remove the item from the scene by calling <strong class="source-inline">Destroy(gameObject)</strong> (so items cannot be <span>collected again).</span></li>
<li class="calibre15">Save the <strong class="source-inline">CollectItem</strong> script and add it as a component to your <strong class="bold">Water Diamond</strong> collectible item Prefab (do that in <strong class="bold">Prefab Mode</strong> or the <strong class="bold">Hierarchy</strong>; but, either way, don’t forget to save or apply your overrides). Note that any component being added that is intended to work with <strong class="source-inline">Collider</strong> components must be on the same GameObject as the collider – you can see in the <strong class="bold">Inspector</strong>, in <span><em class="italic">Figure 3</em></span><em class="italic">.6</em>, where the <strong class="source-inline">CollectItem</strong> script is just below the <span><strong class="source-inline">CapsuleCollider2D</strong></span><span> component.</span></li>
<li class="calibre15">Have a look at the following screenshot displaying the <strong class="source-inline">Debug.Log()</strong> output in the <strong class="bold">Console</strong> while playtesting and running the ladybug character into the <em class="italic">water </em><span><em class="italic">diamond</em></span><span> sprites:</span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer042">
<img alt="Figure 3.6 – Playtesting the collectible items" src="image/B18347_03_06.jpg" class="calibre20"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 3.6 – Playtesting the collectible items</p>
<p class="callout-heading">Important note</p>
<p class="callout">Two additional things worth mentioning in the previous screenshot are <span>as follows.</span></p>
<p class="callout">The <strong class="bold">Editor</strong> is tinted orange because I’ve assigned a color to show when entering <strong class="bold">Play Mode</strong> – set colors in <strong class="bold">Edit</strong> | <strong class="bold">Preferences</strong> | <strong class="bold">Colors </strong>then<strong class="bold"> General</strong> | <strong class="bold">Playmode tint</strong>. This tint <em class="italic">should</em> remind you that you are in <strong class="bold">Play Mode</strong>, and most changes you make to <strong class="bold">Component</strong> values will not be saved when stopping (changes in file-based assets will be <span>saved, however).</span></p>
<p class="callout">I’ve added some empty GameObjects to the <strong class="bold">Scene Hierarchy</strong> to organize objects into logical groupings. For any object added for purely organizational purposes (that is, no child assets are being used in the game), you can assign it an <strong class="source-inline1">EditorOnly</strong> tag so that it is not included in the final game build (saving some resources in <span>the process).</span></p>
<p class="calibre3">You can go ahead <a id="_idIndexMarker341" class="pcalibre1 pcalibre calibre6"/>and duplicate the <strong class="bold">Water Diamond</strong> Prefab by<a id="_idIndexMarker342" class="pcalibre1 pcalibre calibre6"/> selecting one in the <strong class="bold">Hierarchy</strong> and pressing <em class="italic">Ctrl</em>/<em class="italic">Cmd</em> + <em class="italic">D</em> several times and <a id="_idIndexMarker343" class="pcalibre1 pcalibre calibre6"/>repositioning it throughout the level. Playtest to get a feel for how well you can move around the level to reach each of <span>the items!</span></p>
<p class="callout-heading">Tip</p>
<p class="callout">You can organize all of the <strong class="bold">Water Diamond</strong> collectible items in the scene in an empty root GameObject – just make sure the root object is at (<strong class="source-inline1">0</strong>, <strong class="source-inline1">0</strong>, <strong class="source-inline1">0</strong>) before dragging in <span>the items.</span></p>
<p class="callout">You can quickly reset the <strong class="source-inline1">Transform</strong> component of a GameObject in the <strong class="bold">Inspector</strong> by clicking the vertical ellipsis button (to the right of the <strong class="bold">Help</strong> and <strong class="bold">Presets</strong> buttons in the title bar) and <span>choosing </span><span><strong class="bold">Reset</strong></span><span>.</span></p>
<p class="calibre3">With that, our<a id="_idIndexMarker344" class="pcalibre1 pcalibre calibre6"/> game is shaping into something fun! But what about<a id="_idIndexMarker345" class="pcalibre1 pcalibre calibre6"/> adding to the challenge? We’ll use hazards to slow the player when they touch one… <span>look out!</span></p>
<h2 id="_idParaDest-69" class="calibre8"><a id="_idTextAnchor069" class="pcalibre1 pcalibre calibre6"/>Hitting hazards</h2>
<p class="calibre3">We’ve previously <a id="_idIndexMarker346" class="pcalibre1 pcalibre calibre6"/>discussed hazards in the game, and level design, so now let’s look at implementing them before coming to a win/lose condition in the final section of <span>this chapter.</span></p>
<p class="calibre3">First, let’s define our nerf mechanic by adding it to our <span>GDD document:</span></p>
<table class="no-table-style" id="table002">
<colgroup class="calibre11">
<col class="calibre12"/>
<col class="calibre12"/>
</colgroup>
<tbody class="calibre13">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="bold">Name </strong><span><strong class="bold">of game</strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span>Outer World</span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><strong class="bold">What is a nerf mechanic for the player in the </strong><span><strong class="bold">collection game?</strong></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3">The player’s speed will be decreased when they touch a “toxic puddle” in the environment – increasing the challenge of collecting all “water diamonds” before the <span>timer expires.</span></p>
</td>
</tr>
</tbody>
</table>
<p class="img---caption" lang="en-US" xml:lang="en-US">Table 3.2 – The GDD nerf mechanic addition</p>
<p class="calibre3">Okay, we need to add <em class="italic">toxic puddles</em> to the level then! We could do these the same way we created the <strong class="bold">Water Diamond</strong> Prefabs and populate the level in that fashion, but let’s take a different approach here and revisit <span>our tilemaps.</span></p>
<p class="calibre3">Add toxic puddles in challenging<a id="_idIndexMarker347" class="pcalibre1 pcalibre calibre6"/> locations throughout the level by following <span>these steps:</span></p>
<ol class="calibre14">
<li class="calibre15">Create a new <strong class="bold">Tilemap</strong> in the <strong class="bold">Hierarchy</strong> (as a child of <strong class="bold">Grid</strong>) named <strong class="source-inline">Tilemap - Hazards - </strong><span><strong class="source-inline">Trigger</strong></span><span>.</span></li>
<li class="calibre15">Open the <strong class="bold">Tile Palette</strong> (<strong class="bold">Window</strong> | <strong class="bold">2D</strong> | <strong class="bold">Tile Palette</strong>) and make sure the active tilemap is the tilemap we just created in the <span>previous step.</span></li>
<li class="calibre15">Select <strong class="bold">Environment Objects</strong> from the available <strong class="bold">Palettes</strong> dropdown <span>menu list.</span></li>
<li class="calibre15">Select the <em class="italic">black splotch/puddle</em> sprite from the available tiles and use the <strong class="bold">Paintbrush</strong> tool (shortcut key <em class="italic">B</em>) to scatter these tiles in strategic spots throughout your level (my suggestion would be to place them near <span>water diamonds!).</span></li>
<li class="calibre15">Since we want to make the toxic puddles interactable (via the physics engine), add a <strong class="source-inline">TilemapCollider2D</strong> component to the <strong class="bold">Tilemap</strong> GameObject in <span>the </span><span><strong class="bold">Hierarchy</strong></span><span>.</span></li>
<li class="calibre15">Compared to the previous collision objects’ <strong class="bold">Tilemap</strong>, the difference is that now we’re going to enable the <strong class="source-inline">TileMapCollider2D.IsTrigger</strong> value so that we can use the <strong class="source-inline">OnTriggerEnter2D()</strong> event to respond to <span>the collision.</span></li>
</ol>
<p class="calibre3">Here is what the setup looks like with the new hazards tilemap, toxic puddles painted in the level (selected in the Tile Palette), and <strong class="source-inline">TileMapCollider2D</strong>’s <strong class="bold">Is Trigger</strong> <span>box ticked:</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer043">
<img alt="Figure 3.7 – The Hazards Tilemap trigger collider setup" src="image/B18347_03_07.jpg" class="calibre47"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 3.7 – The Hazards Tilemap trigger collider setup</p>
<p class="calibre3">In <span><em class="italic">Figure 3</em></span><em class="italic">.7</em>, you can see that I’ve <a id="_idIndexMarker348" class="pcalibre1 pcalibre calibre6"/>already added a <strong class="source-inline">TouchHazard</strong> component for the Player interaction with the hazard <span>tilemap’s tiles.</span></p>
<p class="calibre3">Let’s have a look at the <span><strong class="source-inline">TouchHazard</strong></span><span> script:</span></p>
<pre class="source-code">
using UnityEngine;
public class TouchHazard : MonoBehaviour
{
    [Header("Make sure the 'Player' tag is also
        assigned!")]
    public PlayerController Player;
    private void OnTriggerEnter2D(Collider2D collision)
    {
        if (collision.CompareTag(Player.tag))
        {
            Debug.Log("You touched a toxic puddle!");
            Player.SlowPlayerSpeed();
        }
    }
}</pre> <p class="calibre3">Now, let’s break it down <a id="_idIndexMarker349" class="pcalibre1 pcalibre calibre6"/>point <span>by point:</span></p>
<ol class="calibre14">
<li class="calibre15">The first new line you’ll notice here is we’ve added some <em class="italic">header information</em>. <strong class="source-inline">[Header]</strong> is an attribute that we can decorate the public field with to show some information to the developer – or designer - viewable in the <strong class="bold">Inspector</strong> along with a field. You can see this message in the <strong class="bold">Inspector</strong> in <span><em class="italic">Figure 3</em></span><span><em class="italic">.7</em></span><span>.</span></li>
</ol>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><span><strong class="bold">Attribute</strong></span><span>: </span><a href="https://docs.unity3d.com/2022.3/Documentation/Manual/Attributes.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/2022.3/Documentation/Manual/Attributes.xhtml</span></a></p>
<ol class="calibre14">
<li value="2" class="calibre15">The first public variable we’re declaring here – <strong class="source-inline">Player</strong> – is for the <strong class="source-inline">PlayerController</strong> reference. Instead of using a GameObject reference here – requiring an additional step to access a component added to the GameObject – we’re using the object type of the component to access its public <span>members directly.</span></li>
<li class="calibre15">We can see here again that we’re using the <strong class="source-inline">OnTriggerEnter2D</strong> message called when the 2D collider on the tilemap reports <span>a collision.</span></li>
<li class="calibre15">Now that we have a collision occurring, we will do a quick test with an <strong class="source-inline">if</strong> statement to see <em class="italic">who</em> collided with the hazard tiles by using the <span><strong class="source-inline">collision.CompareTag()</strong></span><span> method.</span></li>
</ol>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><span><strong class="bold">CompareTag</strong></span><span>: </span><a href="https://docs.unity3d.com/2022.3/Documentation/ScriptReference/GameObject.CompareTag.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/2022.3/Documentation/ScriptReference/GameObject.CompareTag.xhtml</span></a></p>
<p class="calibre3">We’re <a id="_idIndexMarker350" class="pcalibre1 pcalibre calibre6"/>specifying which tag we want to detect by passing in the player’s tag assignment with <strong class="source-inline">Player.tag</strong>. So, let’s make sure the <strong class="bold">Player</strong> Prefab has the <strong class="bold">Player</strong> tag assigned to <span>it now!</span></p>
<ol class="calibre14">
<li value="5" class="calibre15">With the <strong class="bold">Player</strong> object selected in the <strong class="bold">Hierarchy</strong>, go to the top of the <strong class="bold">Inspector</strong> and, using the <strong class="bold">Tag</strong> drop-down (<em class="italic">A</em>), select the <strong class="bold">Player</strong> tag from the list and then apply the change to the <strong class="bold">Player</strong> Prefab by using the <strong class="bold">Overrides</strong> drop-down and clicking <strong class="bold">Apply All</strong> (<em class="italic">B</em>), as seen in the <span>following figure:</span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer044">
<img alt="Figure 3.8 – Set Player tag in Inspector and apply override" src="image/B18347_03_08.jpg" class="calibre48"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 3.8 – Set Player tag in Inspector and apply override</p>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><span><strong class="bold">Tags</strong></span><span>: </span><a href="https://docs.unity3d.com/2022.3/Documentation/Manual/Tags.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/2022.3/Documentation/Manual/Tags.xhtml</span></a></p>
<p class="callout"><strong class="bold">Tags and </strong><span><strong class="bold">layers</strong></span><span>: </span><a href="https://docs.unity3d.com/2022.3/Documentation/Manual/class-TagManager.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/2022.3/Documentation/Manual/class-TagManager.xhtml</span></a></p>
<ol class="calibre14">
<li value="6" class="calibre15">If the result of our <strong class="source-inline">if</strong> statement returns <strong class="source-inline">true</strong> (the tags matched), then the <strong class="bold">Player</strong> object has touched a <a id="_idIndexMarker351" class="pcalibre1 pcalibre calibre6"/>toxic puddle, so the player’s movement will be nerfed – slowed down for some time. The more the <a id="_idIndexMarker352" class="pcalibre1 pcalibre calibre6"/>player touches them, the more challenging it will be to collect all the water diamonds before the <span>timer expires!</span><ol class="calibre42"><li class="calibre15">We’ll first use the <strong class="source-inline">Debug.Log()</strong> statement to notify us in the <strong class="bold">Console</strong> that the collision on the Player <span>has occurred.</span></li><li class="calibre15">The next line calls <strong class="source-inline">SlowPlayerSpeed()</strong> on the <strong class="source-inline">Player</strong> object reference. Accessing <a id="_idIndexMarker353" class="pcalibre1 pcalibre calibre6"/>public members of an object is performed with <strong class="bold">dot notation</strong> – the name <a id="_idIndexMarker354" class="pcalibre1 pcalibre calibre6"/>of the object, followed by a dot (<em class="italic">.</em>), followed by the name of the member, as <span>in </span><span><strong class="source-inline">Player.SlowPlayerSpeed()</strong></span><span>.</span></li><li class="calibre15">Let’s have a look at the <em class="italic">additions</em> required for adding the <strong class="source-inline">SlowPlayerSpeed()</strong> public method to our <span><strong class="source-inline">PlayerController</strong></span><span> class:</span></li></ol><pre class="source-code">
public class PlayerController : MonoBehaviour
{
    …
    [Header("Hit Hazard Speed")]
    public float SlowedSpeed = 2f;
    public float SlowedTime = 5f;   // Seconds
    private float _speedStartValue;
    private void Start()
    {
        _speedStartValue = MoveSpeed;
    }
    …
    public void SlowPlayerSpeed()
    {
        MoveSpeed = SlowedSpeed;
        Invoke(nameof(RestoreSpeed), SlowedTime);
    }
    private void RestoreSpeed()
    {
        MoveSpeed = _speedStartValue;
    }
}</pre><ol class="calibre42"><li value="4" class="calibre15">We can see a few new <a id="_idIndexMarker355" class="pcalibre1 pcalibre calibre6"/>variables are required to support slowing the player character’s speed for a short duration. The public variables, assignable in the <strong class="bold">Inspector</strong>, are <span>as follows:</span><ol class="calibre42"><li class="calibre15"><strong class="source-inline">SlowedSpeed</strong>: A <strong class="source-inline">float</strong> variable to specify the new slower move speed of the player, with a default value <span>of </span><span><strong class="source-inline">2f</strong></span><span>.</span></li><li class="calibre15"><strong class="source-inline">SlowedTime</strong>: A <strong class="source-inline">float</strong> variable to specify the duration (in seconds) to keep the speed at the <strong class="source-inline">SlowedSpeed</strong> value, with a default value of <strong class="source-inline">5f</strong> (<span>5 seconds).</span></li></ol></li><li class="calibre15">The <strong class="source-inline">Start()</strong> method is used to cache (retain) the original <strong class="source-inline">MoveSpeed</strong> value of <span>the player.</span></li><li class="calibre15">The <strong class="source-inline">SlowPlayerSpeed()</strong> method has been added – called from the <strong class="source-inline">TouchHazard</strong> class – to set the current <strong class="source-inline">MoveSpeed</strong> of the player to the <strong class="source-inline">SlowedSpeed</strong> value to slow <span>down movement.</span></li><li class="calibre15">Following the <strong class="source-inline">MoveSpeed</strong> assignment, the <strong class="source-inline">Invoke()</strong> method (<strong class="source-inline">MonoBehaviour</strong>) is being used with a delay time value (the second parameter) to wait to call the new <strong class="source-inline">RestoreSpeed()</strong> method until the time specified by the <strong class="source-inline">SlowedTime</strong> variable <span>has passed.</span></li><li class="calibre15">We’re also using the C# <strong class="source-inline">nameof()</strong> expression with the <strong class="source-inline">RestoreSpeed()</strong> method here, so we aren’t using a string literal for the <span>method name.</span></li></ol></li> </ol>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><span><strong class="bold">Invoke</strong></span><span>: </span><a href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.Invoke.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/ScriptReference/MonoBehaviour.Invoke.xhtml</span></a></p>
<ol class="calibre14">
<li value="9" class="calibre15">Finally, we’ve <a id="_idIndexMarker356" class="pcalibre1 pcalibre calibre6"/>added the <strong class="source-inline">RestoreSpeed()</strong> method, which simply resets the <strong class="source-inline">MoveSpeed</strong> variable back to its original value – resetting player movement back <span>to normal.</span></li>
</ol>
<p class="calibre3">With that, we can now enable the hazards interaction by referring to <span><em class="italic">Figure 3</em></span><span><em class="italic">.7</em></span><span>:</span></p>
<ol class="calibre14">
<li class="calibre15">Add the <strong class="bold">TouchHazard</strong> component to the <strong class="bold">Tilemap - Hazards - </strong><span><strong class="bold">Trigger</strong></span><span> object.</span></li>
<li class="calibre15">Drag the <strong class="bold">Player</strong> object from the <strong class="bold">Hierarchy</strong> to the <strong class="bold">Player</strong> field in the <span><strong class="bold">TouchHazard</strong></span><span> component.</span></li>
<li class="calibre15">Verify the <strong class="bold">SlowedSpeed</strong> and <strong class="bold">SlowedTime</strong> values in the <strong class="bold">PlayerController</strong> component on <span>the </span><span><strong class="bold">Player</strong></span><span>.</span></li>
</ol>
<p class="calibre3">You’ll now want to playtest your level and adjust the speed and duration of the hazard effect until it suits you (I’ve chosen a <strong class="bold">SlowedSpeed</strong> value of <strong class="source-inline">2</strong> and a <strong class="bold">SlowedTime</strong> value of <strong class="source-inline">5</strong>, as my initial values); move the hazards and diamonds around the level to make it more challenging or fun. Again, just have fun with <span>this part!</span></p>
<p class="calibre3">In this section, we understood what a game mechanic is and how to define it in the GDD, and we learned how to implement a collection mechanic and hazard that affects gameplay at our level. Next, we’ll be applying the finishing touches to the collection game by adding a UI, countdown timer, and <span>win condition.</span></p>
<h1 id="_idParaDest-70" class="calibre5"><a id="_idTextAnchor070" class="pcalibre1 pcalibre calibre6"/>Introduction to uGUI, the timer, counting, and winning</h1>
<p class="calibre3">The player needs to know what’s going on in the game, and the way we inform the player of this critical information is with a UI. Unity provides easy-to-use tooling for creating a UI, and it’s <a id="_idIndexMarker357" class="pcalibre1 pcalibre calibre6"/>commonly referred to as <strong class="bold">uGUI</strong> (or <strong class="bold">Unity Graphical User Interface</strong>) – pronounced <em class="italic">You-gooey</em>. Formally, it’s just <strong class="bold">Unity UI</strong> (searching <em class="italic">ugui</em> in the documentation returns <em class="italic">No </em><span><em class="italic">results found</em></span><span>).</span></p>
<p class="calibre3">Unity UI is a <a id="_idIndexMarker358" class="pcalibre1 pcalibre calibre6"/>GameObject-based UI system, so you’ll already be familiar with adding UI<a id="_idIndexMarker359" class="pcalibre1 pcalibre calibre6"/> components to display and interact with UI controls in <span>different ways.</span></p>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><strong class="bold">Unity </strong><span><strong class="bold">UI</strong></span><span>: </span><a href="https://docs.unity3d.com/Packages/com.unity.ugui%401.0/manual/index.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/Packages/com.unity.ugui%401.0/manual/index.xhtml</span></a></p>
<p class="callout"><em class="italic">UI How </em><span><em class="italic">Tos</em></span><span>: </span><a href="https://docs.unity3d.com/Packages/com.unity.ugui%401.0/manual/UIHowTos.xhtml?q=unity%20ui" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/Packages/com.unity.ugui%401.0/manual/UIHowTos.xhtml?q=unity%20ui</span></a></p>
<p class="calibre3">The three key pieces of information the player needs to see in the collection game are <span>as follows:</span></p>
<ul class="calibre17">
<li class="calibre15">The number of items collected versus the total number <span>to collect</span></li>
<li class="calibre15">The time remaining to collect all <span>the items</span></li>
<li class="calibre15">The winning state (win/lose) when the <span>game ends</span></li>
</ul>
<p class="calibre3">The first UI object we’ll discuss adding is the Canvas because it’s what’s responsible for drawing <span>our UI.</span></p>
<h2 id="_idParaDest-71" class="calibre8"><a id="_idTextAnchor071" class="pcalibre1 pcalibre calibre6"/>Canvas</h2>
<p class="calibre3">The <strong class="bold">Canvas</strong> is a<a id="_idIndexMarker360" class="pcalibre1 pcalibre calibre6"/> defined area where all the UI widgets are contained – think of it as a piece of paper where everything to be drawn will be contained on the page. As mentioned previously, the Unity UI is GameObject based, so the Canvas is a GameObject with a Canvas component. All UI widgets added to the scene must be children of <span>a Canvas.</span></p>
<p class="calibre3">Adding a UI Canvas<a id="_idIndexMarker361" class="pcalibre1 pcalibre calibre6"/> to our scene is as simple as going to <strong class="bold">UI</strong> | <strong class="bold">Canvas</strong> in the <strong class="bold">Create</strong> menu. The first time a Canvas is added to the scene, it also adds<a id="_idIndexMarker362" class="pcalibre1 pcalibre calibre6"/> an <strong class="bold">EventSystem</strong>. We’ll have to select the <strong class="bold">EventSystem</strong> and update it to use the new Input System. Click <strong class="bold">Replace with InputSystemUIInputModule</strong>, as seen in <span><em class="italic">Figure 3</em></span><span><em class="italic">.9</em></span><span>:</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer045">
<img alt="Figure 3.9 – Update EventSystem for new Input System" src="image/B18347_03_09.jpg" class="calibre49"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 3.9 – Update EventSystem for new Input System</p>
<p class="calibre3">With the <strong class="bold">Canvas</strong> added and the Input System now sorted, let’s set our Canvas to scale the UI to the screen using the <strong class="bold">Reference Resolution</strong> setting. As before, we’re standardizing on a player screen of Full HD (1920x1080), so enter the values in the fields accordingly. We<a id="_idIndexMarker363" class="pcalibre1 pcalibre calibre6"/> also want to <a id="_idIndexMarker364" class="pcalibre1 pcalibre calibre6"/>balance the resolution matching mode (<strong class="bold">Match Width Or Height</strong>) with a <strong class="bold">Match</strong> value of <strong class="source-inline">0.5</strong>, as shown in the <span>following figure:</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer046">
<img alt="Figure 3.10 – Canvas Scaler" src="image/B18347_03_10.jpg" class="calibre50"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 3.10 – Canvas Scaler</p>
<p class="calibre3">The Canvas is all set, so let’s add our first UI widget for displaying the current count of <span>items collected!</span></p>
<h2 id="_idParaDest-72" class="calibre8"><a id="_idTextAnchor072" class="pcalibre1 pcalibre calibre6"/>TextMesh Pro</h2>
<p class="calibre3"><strong class="bold">TextMesh Pro</strong> (<strong class="bold">TMP</strong>) is <a id="_idIndexMarker365" class="pcalibre1 pcalibre calibre6"/>a set of tools for creating highly customizable and high-quality 2D and 3D UI text in your projects. We’ll use TMP text widgets to display all gameplay information, including the items collected, the countdown timer, and the<a id="_idIndexMarker366" class="pcalibre1 pcalibre calibre6"/> <span>win/lose message.</span></p>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><span><strong class="bold">TextMeshPro</strong></span><span>: </span><a href="https://docs.unity3d.com/2022.3/Documentation/Manual/com.unity.textmeshpro.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/2022.3/Documentation/Manual/com.unity.textmeshpro.xhtml</span></a></p>
<p class="callout"><strong class="bold">TextMesh Pro </strong><span><strong class="bold">documentation</strong></span><span>: </span><a href="https://docs.unity3d.com/Packages/com.unity.textmeshpro%404.0/manual/index.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/Packages/com.unity.textmeshpro%404.0/manual/index.xhtml</span></a></p>
<p class="calibre3">With the<a id="_idIndexMarker367" class="pcalibre1 pcalibre calibre6"/> Canvas object selected in the <strong class="bold">Hierarchy</strong>, use the <strong class="bold">Create</strong> menu to add a <strong class="bold">UI</strong> | <strong class="bold">Text – TextMeshPro</strong> text widget to the scene. If this is the first time you’re adding a <strong class="bold">TextMeshPro</strong> widget to your project, you’ll be prompted to install the essential <a id="_idIndexMarker368" class="pcalibre1 pcalibre calibre6"/>resources. Click <strong class="bold">Import </strong><span><strong class="bold">TMP Essentials</strong></span><span>:</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer047">
<img alt="Figure 3.11 – The TMP Importer dialog" src="image/B18347_03_11.jpg" class="calibre51"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 3.11 – The TMP Importer dialog</p>
<p class="calibre3">Use the following steps to make the collected item text shown in the bottom-left corner of <span>the screen:</span></p>
<ol class="calibre14">
<li class="calibre15">Rename the newly added TMP text object <strong class="source-inline">Collected </strong><span><strong class="source-inline">Count Text</strong></span><span>.</span></li>
<li class="calibre15">To anchor the text to the bottom-left corner of the screen, use <strong class="bold">Anchor Presets</strong> (<em class="italic">A</em>), hold both the <em class="italic">Shift</em> (<strong class="bold">Also set pivot</strong>) and <em class="italic">Alt</em> (<strong class="bold">Also set position</strong>) keys down (<em class="italic">B</em>), then click the bottom-left <span>anchor (</span><span><em class="italic">C</em></span><span>):</span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer048">
<img alt="Figure 3.12 – TextMeshPro rect anchor setting" src="image/B18347_03_12.jpg" class="calibre20"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 3.12 – TextMeshPro rect anchor setting</p>
<ol class="calibre14">
<li value="3" class="calibre15">Use the following settings to <a id="_idIndexMarker369" class="pcalibre1 pcalibre calibre6"/>provide default text to display and style the text (refer to <span><em class="italic">Figure 3</em></span><em class="italic">.12</em> as <span>a reference):</span><ol class="calibre42"><li class="calibre15"><strong class="bold">Default text</strong>: <strong class="source-inline">0 </strong><span><strong class="source-inline">of 0</strong></span></li><li class="calibre15"><strong class="bold">Font </strong><span><strong class="bold">Style</strong></span><span>: </span><span><strong class="bold">Bold</strong></span></li><li class="calibre15"><strong class="bold">Font </strong><span><strong class="bold">Size</strong></span><span>: </span><span><strong class="bold">48</strong></span></li><li class="calibre15"><strong class="bold">Extra Settings</strong> | <strong class="bold">Margin</strong> | <span><strong class="bold">Left</strong></span><span>: </span><span><strong class="bold">50</strong></span></li></ol></li>
</ol>
<p class="calibre3">With that, we’re ready to have the text updated every time an item is collected. Let’s see how to tie it all together in the <span>next section.</span></p>
<h2 id="_idParaDest-73" class="calibre8"><a id="_idTextAnchor073" class="pcalibre1 pcalibre calibre6"/>Updating the pickup count</h2>
<p class="calibre3">The problem we’re<a id="_idIndexMarker370" class="pcalibre1 pcalibre calibre6"/> going to solve now is <em class="italic">how is UI text updated when an item is collected?</em> We can refer to design patterns for a solution! We previously covered both the Singleton and Observer patterns, and either one will suit our <span>needs here.</span></p>
<p class="calibre3">To provide an example in practice, we will use both, starting with <span>the Singleton.</span></p>
<p class="calibre3">The pickup count will be displayed as <strong class="bold">2 of 10</strong> – meaning 2 items of a total of 10 have been collected. So, we’ll first need the total count of collectible items in the scene. The <strong class="source-inline">GameManager</strong>, will be responsible for holding the data (variables) for the collectibles, so this will become a <span>Singleton instance.</span></p>
<p class="calibre3">The <strong class="source-inline">Start()</strong> method for each collectible item in the scene will be called when the game first runs, so we’ll use this to add each collectible item to the total <span>items count.</span></p>
<p class="calibre3">Let’s first create the <strong class="source-inline">GameManager</strong> script and make it a Singleton instance by adding the following lines to the variable declaration section (near the top of <span>the class):</span></p>
<pre class="source-code">
    // Singleton instance.
    public static GameManager Instance
        { get; private set; }
    private void Awake() =&gt; Instance = this;</pre> <p class="calibre3">The <strong class="source-inline">GameManager</strong> class itself is declared a <strong class="source-inline">public static</strong> property – we want to directly access the class from another type using the <strong class="source-inline">Instance</strong> variable. We’ve let <strong class="source-inline">get</strong> remain public, while declaring <strong class="source-inline">set</strong> as private so external classes will only be able <span>to read.</span></p>
<p class="calibre3">In the <strong class="source-inline">Awake()</strong> method, we’re setting the <strong class="source-inline">Instance</strong> variable to <strong class="source-inline">this</strong>, the current class instance. We’re using an expression body here (indicated by <strong class="source-inline">=&gt;</strong>) instead of the usual <strong class="source-inline">{}</strong> squiggly brackets (block body) to keep the code concise, since it’s only a single expression <span>that’s needed.</span></p>
<p class="callout-heading">Property (C#)</p>
<p class="callout">A C# property is a class member that uses explicit accessors for the <strong class="source-inline1">get</strong> and <strong class="source-inline1">set</strong> methods to read or write <span>data values.</span></p>
<p class="calibre3">Now, we can add the<a id="_idIndexMarker371" class="pcalibre1 pcalibre calibre6"/> variable for storing the total number of collectible items, the public method for incrementing the total, and the call to the incrementing method from the <strong class="source-inline">CollectItem</strong> class by following <span>these steps:</span></p>
<ol class="calibre14">
<li class="calibre15">Add a private <strong class="source-inline">_totalCollectibleItems</strong> integer variable to the variable declaration section. Its accessor is private because it’s encapsulated only to change its value within the declaring class (with OOP encapsulation, it’s considered bad practice to modify variable values outside <span>the class):</span><pre class="source-code">
    private int _totalCollectibleItems;</pre></li> <li class="calibre15">Add a public <strong class="source-inline">AddCollectibleItem()</strong> method with no return type (<strong class="source-inline">void</strong>), as an expression body, to increment the <strong class="source-inline">_totalCollectibleItems</strong> current value. The <strong class="source-inline">++</strong> unary arithmetic operator increments the operand by 1. The <strong class="source-inline">public</strong> accessor means that we can call this method outside the declaring class, which we will do next from the <strong class="source-inline">CollectItem</strong> class via the <span>Singleton instance:</span><pre class="source-code">
    public void AddCollectibleItem() =&gt;
        _totalCollectibleItems++;</pre></li> <li class="calibre15">Now, in the <strong class="source-inline">CollectItem</strong> class, add the following to the bottom of the <strong class="source-inline">Start()</strong> method for calling the <strong class="source-inline">GameManager</strong> Singleton instance to add the collectible item to the <a id="_idIndexMarker372" class="pcalibre1 pcalibre calibre6"/>total <span>items count:</span><pre class="source-code">
    void Start()
    {
        …
        GameManager.Instance.AddCollectibleItem();
    }</pre></li> </ol>
<p class="calibre3">With that, we now know how many <strong class="bold">Water Diamond</strong> collectible items are in the scene for the player to collect. While adding them to our level design, we don’t need to know beforehand how many were added and manually specified somewhere; we’re always guaranteed to have the total count since <strong class="source-inline">Start()</strong> will be called on every object instance in the <span>scene. Easy-peasy!</span></p>
<p class="calibre3">The second part of <a id="_idIndexMarker373" class="pcalibre1 pcalibre calibre6"/>the UI display for the collectible items requires the number of items currently collected. We’ll do that now with the second design pattern we’re covering in <span>practice: Observer.</span></p>
<h3 class="calibre10">Incrementing collected item count</h3>
<p class="calibre3">We’ve<a id="_idIndexMarker374" class="pcalibre1 pcalibre calibre6"/> already seen how to access the <strong class="source-inline">GameManager</strong> Singleton instance via a static variable. We’re going to do something similar with the <strong class="source-inline">CollectItem</strong> class to know when any item has <span>been collected.</span></p>
<p class="calibre3">Typically, every instance of an object in the scene is independent of one another – each with its independent members. We want <strong class="source-inline">GameManager</strong> to register and listen (that is, observe) for any one of the items being collected, so we’re going to accomplish this by invoking a static event – a static declaration will make it common across all class instances, so we won’t need a reference to any individual <span>item’s instance.</span></p>
<p class="calibre3">Let’s go ahead and add our static event to the <strong class="source-inline">CollectItem</strong> class, then register the listener from <strong class="source-inline">GameManager</strong> to take action when the event <span>is invoked:</span></p>
<ol class="calibre14">
<li class="calibre15">Add the following public static variable declaration <span>to </span><span><strong class="source-inline">CollectItem</strong></span><span>:</span><pre class="source-code">
    public static event UnityAction OnItemCollected;</pre></li> </ol>
<p class="calibre3">The <strong class="source-inline">event</strong> keyword is added to the declaration to enforce invocation only from within the declaring class – we don’t want external classes to be able to trigger <span>the event!</span></p>
<p class="calibre3">We’re using <strong class="source-inline">UnityAction</strong> here as a method delegate, so we can use it to refer to calling multiple methods through it or even pass it as a method argument. It’s also common practice to preface<a id="_idIndexMarker375" class="pcalibre1 pcalibre calibre6"/> naming event delegates and methods with the word <em class="italic">On</em> (as <span>in </span><span><strong class="source-inline">OnItemCollected</strong></span><span>).</span></p>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><span><strong class="bold">UnityAction</strong></span><span>: </span><a href="https://docs.unity3d.com/2022.3/Documentation/ScriptReference/Events.UnityAction.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/2022.3/Documentation/ScriptReference/Events.UnityAction.xhtml</span></a></p>
<ol class="calibre14">
<li value="2" class="calibre15">Add the following line to the top of the <strong class="source-inline">OnTriggerEnter2D()</strong> method to invoke or <em class="italic">trigger</em> the event (also known<a id="_idIndexMarker376" class="pcalibre1 pcalibre calibre6"/> as <strong class="bold">event invocation</strong>) when the item <span>is collected:</span><pre class="source-code">
        OnItemCollected?.Invoke();</pre></li> </ol>
<p class="calibre3">The question<a id="_idIndexMarker377" class="pcalibre1 pcalibre calibre6"/> mark and dot (<strong class="source-inline">?.</strong>) appended to <strong class="source-inline">OnItemCollected</strong> is a null-conditional operator – it will only perform the operation if the operand does not evaluate to <strong class="source-inline">null</strong>. In this case, it means if there are no registered listeners, we don’t want to throw a <strong class="source-inline">NullReferenceException</strong> error when calling <strong class="source-inline">Invoke</strong> (executing <span>the event).</span></p>
<p class="callout-heading">NullReferenceException (C#)</p>
<p class="callout">A <strong class="bold">NullReferenceException</strong> (<strong class="bold">NRE</strong>) is<a id="_idIndexMarker378" class="pcalibre1 pcalibre calibre6"/> an error that can occur when trying to access a member of a <strong class="source-inline1">null</strong> object (<span>not assigned).</span></p>
<ol class="calibre14">
<li value="3" class="calibre15">Moving into the <strong class="source-inline">GameManager</strong> class now, we add a private variable to track the number of items collected by <span>the player:</span><pre class="source-code">
    private int _collectedItemCount;</pre></li> <li class="calibre15">The class encapsulates this variable – because its accessor is set to <strong class="source-inline">private</strong> – so, let’s add an <strong class="source-inline">ItemCollected()</strong> method that increments <span>the count:</span><pre class="source-code">
    private void ItemCollected() =&gt;
        _collectedItemCount++;</pre></li> </ol>
<p class="calibre3">We’re simply incrementing the count by 1 every time an item is collected by using the ++ arithmetic operator after the <span>variable (postfix).</span></p>
<ol class="calibre14">
<li value="5" class="calibre15">What is the <strong class="source-inline">ItemCollected()</strong> method called now? Well, that’s where registering with the <strong class="source-inline">CollectItem.OnItemCollected</strong> event comes in. We’ll use the <strong class="source-inline">OnEnable()</strong> and <strong class="source-inline">OnDisable()</strong> Unity message events – these are called when the behavior is first enabled and active, then becomes <span>disabled, respectively:</span><pre class="source-code">
    private void OnEnable()
    {
        CollectItem.OnItemCollected += ItemCollected;
    }
    private void OnDisable()
    {
        CollectItem.OnItemCollected -= ItemCollected;
    }</pre></li> </ol>
<p class="calibre3">The <strong class="source-inline">+=</strong> operator <a id="_idIndexMarker379" class="pcalibre1 pcalibre calibre6"/>specifies adding an event handler method when subscribing to events. We’re registering the <strong class="source-inline">ItemCollected</strong> method to be called when the <strong class="source-inline">CollectItem.ItemCollected</strong> event is invoked (that is, registering <span>a listener).</span></p>
<p class="callout-heading">Important note</p>
<p class="callout">To avoid resource leaks, unsubscribing from events should always <span>be performed!</span></p>
<p class="calibre3">The <strong class="source-inline">-=</strong> operator specifies removing an event handler method to stop subscribing to events. We’re unregistering the <strong class="source-inline">ItemCollected</strong> method so that it will no longer be called when the <strong class="source-inline">CollectItem.ItemCollected</strong> event is invoked. Suppose we don’t unregister the event handler, and the object holding the handler method is destroyed. In that case, it will throw an <strong class="bold">NRE</strong> error (i.e., you can’t call a method on an object that is <strong class="source-inline">null</strong>) – and<a id="_idIndexMarker380" class="pcalibre1 pcalibre calibre6"/> we quite certainly won’t be happy <span>with that!</span></p>
<p class="callout-heading">Tip</p>
<p class="callout">Don’t forget, if the handler method isn’t already created, you can have VS generate the method for you by clicking on the <strong class="source-inline1">ItemCollected</strong> text, then using <em class="italic">Alt/Cmd</em> + <em class="italic">Enter</em> and selecting <strong class="bold">Generate </strong><span><strong class="bold">method ItemCollected</strong></span><span>.</span></p>
<p class="calibre3">Now that we have our total and collected item values calculated, let’s update the <span>UI display.</span></p>
<h3 class="calibre10">Updating the UI</h3>
<p class="calibre3">The text component <a id="_idIndexMarker381" class="pcalibre1 pcalibre calibre6"/>displaying the collected item progress has already been added to the scene as <strong class="bold">Collected Count Text</strong>. Now, we need a way to reference and update the text displayed every time a <strong class="bold">Water Diamond</strong> is collected by <span>the player.</span></p>
<p class="calibre3">We’ll create a new <strong class="source-inline">UIManager</strong> class to keep UI functionality separate from <strong class="source-inline">GameManager</strong> – following the single <span>responsibility principle.</span></p>
<p class="calibre3">Create a new script called <strong class="source-inline">UIManager</strong> and add the <span>following code:</span></p>
<pre class="source-code">
using UnityEngine;
using TMPro;
public class UIManager : MonoBehaviour
{
    public TextMeshProUGUI CollectedItemText;
    void Start()
    {
        CollectedItemText.text = string.Empty;
    }
    public void UpdateCollectedItemsText(
        int currentItemCount, int totalCollectableItems) =&gt;
            CollectedItemText.text =
                $"{currentItemCount} of
                    {totalCollectableItems}";
}</pre> <p class="calibre3">Here’s what we’ll do<a id="_idIndexMarker382" class="pcalibre1 pcalibre calibre6"/> when writing the new <span><strong class="source-inline">UIManager</strong></span><span> script.</span></p>
<ol class="calibre14">
<li class="calibre15">The first thing we’ll do is add a <strong class="source-inline">using</strong> statement for <strong class="source-inline">TextMeshPro</strong> (<strong class="source-inline">TMPro</strong>) so that we can reference the TMP text <span>component’s properties.</span></li>
<li class="calibre15">We’ll then add a public variable for the <strong class="bold">Collected Count Text</strong> TMP object to be assigned to in the <strong class="bold">Inspector</strong> (<span>for referencing).</span></li>
<li class="calibre15">When the game starts playing, we reset the <strong class="source-inline">CollectedCountText</strong> text to not display anything by using <strong class="source-inline">string.Empty</strong> (a zero-length string equivalent to <strong class="source-inline">""</strong>) – this will clear out any temporary display text we entered at design time for adjusting position and <span>display values.</span></li>
<li class="calibre15">Lastly, the <strong class="source-inline">UpdateCollectedItemsText()</strong> method is added that sets the <strong class="source-inline">CollectedCountText</strong> text. It has two method parameters, one for the current item count and the other for the total collectible items in the scene. We’re again using string interpolation to combine the variables’ values with <em class="italic">of</em> <span>for display.</span></li>
</ol>
<p class="calibre3">Let’s return to the Unity Editor to complete the <strong class="source-inline">UIManager</strong> by adding it to the <strong class="bold">GameManager</strong> object as a new component. Then, drag in the reference for the <strong class="bold">Collected Item</strong> TMP text object to assign it to the <strong class="source-inline">CollectedCountText</strong> field, as seen in the <strong class="bold">Inspector</strong> in the <span>following figure:</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer049">
<img alt="Figure 3.13 – The Manager Inspector assignments" src="image/B18347_03_13.jpg" class="calibre20"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 3.13 – The Manager Inspector assignments</p>
<p class="calibre3">The last thing <a id="_idIndexMarker383" class="pcalibre1 pcalibre calibre6"/>we have to do to get our text displayed when collecting an object is to wire up the <strong class="source-inline">UI.UpdateCollectedItemsText()</strong> call <span>in </span><span><strong class="source-inline">GameManager.ItemCollected()</strong></span><span>:</span></p>
<ol class="calibre14">
<li class="calibre15">In <strong class="source-inline">GameManger</strong>, add a public variable to hold the reference to the <span><strong class="source-inline">UIManager</strong></span><span> component:</span><pre class="source-code">
    public UIManager UI;</pre></li> <li class="calibre15">Change the <strong class="source-inline">ItemCollected()</strong> method to now call the <strong class="source-inline">UI.UpdateCollectedItemsText()</strong> method passing in an incremented <strong class="source-inline">_collectedItemCount</strong> and the <span><strong class="source-inline">_totalCollectibleItems</strong></span><span> values:</span><pre class="source-code">
    private void ItemCollected() =&gt;
        UI.UpdateCollectedItemsText(
            ++_collectedItemCount,
                _totalCollectibleItems);</pre></li> </ol>
<p class="calibre3">The <strong class="source-inline">++</strong> operator in front of <strong class="source-inline">_collectedItemCount</strong> means that we will pre-increment its operand (prefix) and then read the value. We want the already incremented value to be passed to <span>the method.</span></p>
<p class="callout-heading">-- (C#)</p>
<p class="callout">Note that the <strong class="source-inline1">--</strong> unary arithmetic operator is also available in C#, and instead of incrementing the operand by 1, it decrements it. The same rules apply to a pre- or <span>post-decrementer assignment.</span></p>
<p class="calibre3">With that, the only <a id="_idIndexMarker384" class="pcalibre1 pcalibre calibre6"/>remaining task is to drag <strong class="source-inline">UIManager</strong> to the <strong class="bold">UI</strong> field on the <strong class="source-inline">GameManager</strong> component to assign its reference (refer to <span><em class="italic">Figure 3</em></span><em class="italic">.13</em>). Save your files <span>and playtest!</span></p>
<p class="calibre3">We now have the game keeping track of the number of collected water diamonds and displaying progress to the player. It’s not quite a game yet, so we’ll add a simple countdown timer that we’ll later tie in to win/lose conditions in the <span>next section.</span></p>
<h2 id="_idParaDest-74" class="calibre8"><a id="_idTextAnchor074" class="pcalibre1 pcalibre calibre6"/>The Timer script</h2>
<p class="calibre3">Referring to our <a id="_idIndexMarker385" class="pcalibre1 pcalibre calibre6"/>GDD in <em class="italic">Table 3.1</em>, we know that the game will be lost if the countdown timer reaches 0 before the player collects all the water diamonds. For that, we’ll need a simple timer script that subtracts 1 second from the time every second. Let’s see how we can accomplish that and notify listeners of both time-changing and <span>expiring events.</span></p>
<p class="calibre3">Create a new script named <strong class="source-inline">Timer</strong> and refer to the <span>following code:</span></p>
<pre class="source-code">
using UnityEngine;
using UnityEngine.Events;
public class Timer : MonoBehaviour
{
    public event UnityAction&lt;int&gt; OnTimeUpdate;
    public event UnityAction OnTimeExpired;
    private int _timeSeconds, _timeCurrent;
    public void StartTimer(int time)
    {
        _timeSeconds = time;
        _timeCurrent = 0;
        InvokeRepeating(nameof(UpdateTimer), 1f, 1f);
    }
    public void StopTimer() =&gt; CancelInvoke();
    private void UpdateTimer()
    {
        _timeCurrent++;
        OnTimeUpdate?.Invoke(_timeCurrent);
        if (_timeCurrent &gt;= _timeSeconds)
        {
            StopTimer();
            OnTimeExpired?.Invoke();
        }
    }
}</pre> <p class="calibre3">Let’s have a look at the <a id="_idIndexMarker386" class="pcalibre1 pcalibre calibre6"/>code and review <span>what’s new:</span></p>
<ol class="calibre14">
<li class="calibre15">The <strong class="source-inline">OnTimeUpdate</strong> event has a parameter added: <strong class="source-inline">UnityAction&lt;int&gt;</strong>. This allows passing an integer value to the listener when the event is invoked (you can add up to four types as parameters with <strong class="source-inline">UnityAction</strong>). We use the passed-in <strong class="source-inline">int</strong> value (seconds) for the displayed time remaining in <span>the UI.</span></li>
<li class="calibre15">We’ve declared two <strong class="source-inline">int</strong> type variables in a single line, <strong class="source-inline">_timeSeconds</strong> and <strong class="source-inline">_timeCurrent</strong>, by separating the variable names with <span>a comma.</span></li>
<li class="calibre15"><strong class="source-inline">StartTimer()</strong> is a public method that GameManager will call to start the timer countdown and begin <span>the gameplay.</span></li>
<li class="calibre15"><strong class="source-inline">InvokeRepeating()</strong> is <a id="_idIndexMarker387" class="pcalibre1 pcalibre calibre6"/>similar to <strong class="source-inline">Invoke()</strong> except, you guessed it, with a repeating time specified. We use this to update the timer value <span>every second.</span></li>
</ol>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><span><strong class="bold">InvokeRepeating</strong></span><span>: </span><a href="https://docs.unity3d.com/2022.3/Documentation/ScriptReference/MonoBehaviour.InvokeRepeating.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/2022.3/Documentation/ScriptReference/MonoBehaviour.InvokeRepeating.xhtml</span></a></p>
<p class="calibre3"><strong class="source-inline">InvokeRepeating()</strong> takes a string representation for the method’s name as a parameter, just as <strong class="source-inline">Invoke()</strong> does, and any time you’re typing a string literal into the code, it should raise a flag – hardcoded strings or <em class="italic">magic strings</em> are pure evil! So, instead of typing a string, we’ll use the <strong class="source-inline">nameof</strong> expression to return the method name as a <span>string. Sweet!</span></p>
<p class="callout-heading">nameof (C#)</p>
<p class="callout">The <strong class="source-inline1">nameof</strong> expression obtains a string constant from a variable, type, or member and is evaluated at compile time. This can be used instead of a string literal. It ensures no spelling errors and allows VS CodeLens to <span>produce references.</span></p>
<ol class="calibre14">
<li value="5" class="calibre15">The <strong class="source-inline">StopTimer()</strong> method calls <strong class="source-inline">CancelInvoke()</strong>, which will stop the timer counting down (by halting the <span><strong class="source-inline">InvokeRepeating</strong></span><span> process).</span></li>
<li class="calibre15">The <strong class="source-inline">UpdateTimer()</strong> method is responsible for incrementing the timer and invoking the <strong class="source-inline">OnTimeUpdate</strong> event, passing the <span><strong class="source-inline">_timeCurrent</strong></span><span> value.</span></li>
<li class="calibre15">Finally, we test for a timer expired condition using the <strong class="source-inline">&gt;=</strong> comparison operator: is <strong class="source-inline">_timeCurrent</strong> greater than or equal to <strong class="source-inline">_timeSeconds</strong>? We use <strong class="source-inline">&gt;=</strong> instead of <strong class="source-inline">==</strong> for working with an edge case where the time incremented may skip a second, and we’d miss an equal condition. Also, the timer will be stopped, and the <strong class="source-inline">OnTimeExpired</strong> event will <span>be triggered.</span></li>
</ol>
<p class="calibre3">Whew! Not a long <a id="_idIndexMarker388" class="pcalibre1 pcalibre calibre6"/>script, but several vital parts make it all function to work well with our other components. Speaking of, we can now integrate the <strong class="source-inline">Timer</strong> code with <strong class="source-inline">GameManager</strong> and <strong class="source-inline">UIManager</strong> to start the running of the timer and update the time remaining text in <span>the UI.</span></p>
<h3 class="calibre10">Additions to GameManager</h3>
<p class="calibre3">With the <strong class="source-inline">Timer</strong> script all ready, let’s<a id="_idIndexMarker389" class="pcalibre1 pcalibre calibre6"/> connect the <strong class="source-inline">Timer</strong> script in the <strong class="source-inline">GameManager</strong> class to start running the timer and handling events for time updates and <span>countdown expiration.</span></p>
<p class="calibre3">The first thing we’ll tackle is starting the timer countdown when the game begins. The timer countdown starts by calling the <strong class="source-inline">Timer.StartTimer()</strong> public method through a direct reference assigned in the <strong class="bold">Inspector</strong>, which is initiated from the <strong class="source-inline">Start()</strong> method of the <span><strong class="source-inline">GameManager</strong></span><span> class.</span></p>
<p class="calibre3">Follow these steps to see how it’s <span>set up:</span></p>
<ol class="calibre14">
<li class="calibre15">Add a public variable, <strong class="source-inline">GameTimer</strong>, to reference the <strong class="source-inline">Timer</strong> component added to the <strong class="bold">GameManager</strong> GameObject in <span>the </span><span><strong class="bold">Hierarchy</strong></span><span>:</span><pre class="source-code">
    public Timer GameTimer;</pre></li> <li class="calibre15">Add a public int variable, <strong class="source-inline">GameplayTime</strong>, to specify the amount of time in seconds the game will count down from – this is the total time the player will have to collect all the water diamonds. The best way to know what value to set is to playtest <span>the game!</span><pre class="source-code">
    public int GameplayTime;</pre></li> <li class="calibre15">The timer is started from the <strong class="source-inline">Start()</strong> method when the game is run. We call <strong class="source-inline">Invoke()</strong> on the <strong class="source-inline">StartTimer()</strong> method with a 2-second delay – giving the players time to orient themselves a bit before <span>gameplay starts:</span><pre class="source-code">
    private void Start() =&gt;
        Invoke(nameof(StartTimer), 2f);</pre></li> <li class="calibre15">Add the <strong class="source-inline">StartTimer()</strong> method, which performs the actual call to the <strong class="source-inline">Timer</strong>’s <strong class="source-inline">StartTimer()</strong> method, passing in the amount of time to count <span>down from:</span><pre class="source-code">
    private void StartTimer() =&gt;
        GameTimer.StartTimer(GameplayTime);</pre></li> <li class="calibre15">Lastly, back in<a id="_idIndexMarker390" class="pcalibre1 pcalibre calibre6"/> the <strong class="bold">Editor</strong>, add the <strong class="source-inline">Timer</strong> component to the <strong class="bold">GameManager</strong> GameObject in the <strong class="bold">Hierarchy</strong> and assign the reference to it in the <strong class="bold">GameTimer</strong> field (refer to <span><em class="italic">Figure 3</em></span><span><em class="italic">.13</em></span><span>).</span></li>
</ol>
<p class="calibre3">The preceding steps have integrated <strong class="source-inline">Timer</strong> with our <strong class="source-inline">GameManager</strong> and start the time counting down when the game begins. But we still have to handle the Timer’s events, so let’s first add the listener for the time <span>being updated:</span></p>
<ol class="calibre14">
<li class="calibre15">In the <strong class="source-inline">OnEnable()</strong> method, add the listener for the <strong class="source-inline">OnTimeUpdate</strong> event with the handler <span>method specified:</span><pre class="source-code">
    private void OnEnable()
    {
        …
        GameTimer.OnTimeUpdate += TimeUpdated;
    }</pre></li> <li class="calibre15">Remember, when we subscribe to an event, we should also unsubscribe from it to prevent memory leaks, so add the following code <span>to </span><span><strong class="source-inline">OnDi<a id="_idTextAnchor075" class="pcalibre1 pcalibre calibre6"/>sable()</strong></span><span>:</span><pre class="source-code">
    private void OnDisable()
    {
        …
        GameTimer.OnTimeUpdate -= TimeUpdated;
    }</pre></li> <li class="calibre15">Create the <strong class="source-inline">TimeUpdated()</strong> method (<em class="italic">Alt/Cmd</em> + <em class="italic">Enter</em>), where we’ll execute the code for handling when the timer is updated with a <span>new time:</span><pre class="source-code">
    private void TimeUpdated(int seconds) =&gt;
        UI.UpdateTimerText(seconds, GameplayTime);</pre></li> </ol>
<p class="calibre3">Same as before, we’re calling a public method on our UI reference for updating the countdown timer text <a id="_idIndexMarker391" class="pcalibre1 pcalibre calibre6"/>while adding the values for the seconds passed in from <strong class="source-inline">Timer</strong> and the total <span>gameplay time.</span></p>
<p class="callout-heading">Note on code architecture</p>
<p class="callout">We could have added a listener to the <strong class="source-inline1">Timer.OnTimeUpdate</strong> event right within <strong class="source-inline1">UIManager</strong> to update the countdown timer text, but I decided to only have one reference to the <strong class="source-inline1">Timer</strong> in the project and handle all timer events in <strong class="source-inline1">GameManager</strong>. This will keep things cleaner, and it is more straightforward to troubleshoot any issues since the timer-related code is all within <span>one class.</span></p>
<p class="calibre3">We’ll add the <strong class="source-inline">UpdateTimerText()</strong> method in the next section, where we’ll <span>update </span><span><strong class="source-inline">UIManager</strong></span><span>.</span></p>
<h3 class="calibre10">Additions to UIManager</h3>
<p class="calibre3">Let’s get right to adding the additional <a id="_idIndexMarker392" class="pcalibre1 pcalibre calibre6"/>variables and methods to support updating the timer text and the game over messages we’ll finish in the <span>next section:</span></p>
<ol class="calibre14">
<li class="calibre15">Open up the <strong class="source-inline">UIManager</strong> script and make the <span>following revisions:</span><pre class="source-code">
    public TextMeshProUGUI TimerText;
    public TextMeshProUGUI GameOverText;
    void Start()
    {
        …
        TimerText.text = string.Empty;
        GameOverText.text = string.Empty;
    }
    public void UpdateTimerText(int currentSeconds,
        int totalSeconds)
    {
        var ts = System.TimeSpan.FromSeconds(
            totalSeconds – currentSeconds);
        TimerText.text = $"{ts.Minutes}:{ts.Seconds:00}";
    }
    public void SetGameOverText(string text) =&gt;
        GameOverText.text = text;</pre></li> <li class="calibre15">Add the two <strong class="source-inline">TextMeshProUGUI</strong> public fields for the text displayed in the UI for the <a id="_idIndexMarker393" class="pcalibre1 pcalibre calibre6"/>timer and game <span>over text.</span></li>
<li class="calibre15">In <strong class="source-inline">Start()</strong>, we’ll clear out any placeholder text used during design time, so no text will be displayed until <span>it’s updated.</span></li>
<li class="calibre15">Add the <strong class="source-inline">UpdateTimerText()</strong> method with the current and total seconds parameters to calculate the time remaining in the countdown <span>to display.</span></li>
</ol>
<p class="calibre3">Note that we’re using <strong class="source-inline">System.TimeSpan</strong> to make things easy. We can then use the <strong class="source-inline">ts</strong> variable when displaying the text, formatting it to show minutes and seconds, where seconds will always be displayed with two digits (<strong class="source-inline">00</strong> <span>being specified).</span></p>
<ol class="calibre14">
<li value="5" class="calibre15">Finally, add the <strong class="source-inline">SetGameOverText()</strong> method for, you guessed it, updating the <strong class="source-inline">GameOverText</strong> text for displaying the game <span>over message.</span></li>
</ol>
<p class="calibre3">To finish up the revisions, we’ll go back into the <strong class="bold">Editor</strong> and create two new <strong class="bold">Text - TextMeshPro</strong> UI widgets as children of <strong class="bold">Canvas</strong> in the <strong class="bold">Scene Hierarchy</strong> (refer to <span><em class="italic">Figure 3</em></span><span><em class="italic">.13</em></span><span>):</span></p>
<ol class="calibre14">
<li class="calibre15">To display the timer in the UI, name it <em class="italic">Countdown Timer Text</em> and anchor it to the top center of the screen. Size the text to something easily visible to <span>the player.</span></li>
<li class="calibre15">To display the game over text in the UI, name it <em class="italic">Game Over Text</em> and anchor it to the center of the screen. Give the text a large size, covering most of the screen, so there is <a id="_idIndexMarker394" class="pcalibre1 pcalibre calibre6"/>no mistaking when the game is over and the player has either won <span>or lost.</span></li>
</ol>
<p class="calibre3">When you’ve finished the UI design for these text widgets, drag them to the <strong class="bold">TimerText</strong> and <strong class="bold">GameOverText</strong> fields on the <span><strong class="source-inline">UIManager</strong></span><span> component.</span></p>
<p class="calibre3">A game just isn’t a game unless you can win or lose playing it! So, let’s finish up the collection game in the <span>next section.</span></p>
<h2 id="_idParaDest-75" class="calibre8"><a id="_idTextAnchor076" class="pcalibre1 pcalibre calibre6"/>Winning the game</h2>
<p class="calibre3">Everything we require to <a id="_idIndexMarker395" class="pcalibre1 pcalibre calibre6"/>determine a win-and-lose condition is already in place. Let’s start with the win condition: they win if the player collects all the water diamonds before the countdown <span>timer expires.</span></p>
<p class="calibre3">This is a simple equality conditional statement: does the accumulated item count equal the total collectible items count? If we check this condition when an item is collected, and it equates to <strong class="source-inline">true</strong>, we know we’ve won <span>the game.</span></p>
<p class="calibre3">In <strong class="source-inline">GameManager</strong>, revise the <strong class="source-inline">ItemCollected()</strong> method to include this check, and we’ll call a <strong class="source-inline">Win()</strong> method <span>if </span><span><strong class="source-inline">true</strong></span><span>.</span></p>
<p class="calibre3">You’ll first have to<a id="_idIndexMarker396" class="pcalibre1 pcalibre calibre6"/> refactor the expression body to a block body to include additional lines of code in the method (hint: VS can refactor this for you and add the squiggly brackets). It will now look <span>as follows:</span></p>
<pre class="source-code">
    private void ItemCollected()
    {
        UI.UpdateCollectedItemsText(
            ++_collectedItemCount, _totalCollectibleItems);
        if (_collectedItemCount == _totalCollectibleItems)
            Win();
    }</pre> <p class="calibre3">That was easy! Now, let’s state the losing condition: they lose if the countdown timer runs out before the player collects all the water diamonds. This requires just a bit more work, but we’re just going to use what we’ve already implemented, specifically, the <span><strong class="source-inline">Timer.OnTimeExpired</strong></span><span> event.</span></p>
<p class="calibre3">In <strong class="source-inline">GameManager</strong>, again, let’s add a listener to <strong class="source-inline">OnEnable()</strong> for the time expiring and assign a <span>handler method:</span></p>
<pre class="source-code">
    private void OnEnable()
    {
        …
        GameTimer.OnTimeExpired += TimeExpired;
    }</pre> <p class="calibre3"><span>Again, unsubscribe:</span></p>
<pre class="source-code">
    private void OnDisable()
    {
        …
        GameTimer.OnTimeExpired -= TimeExpired;
    }</pre> <p class="calibre3">Create the <strong class="source-inline">TimeExpired()</strong> method as an expression body where we’ll just call <strong class="source-inline">Lose()</strong> – the time has expired; if the player had already collected all the items – and won – this method would never <span>be reached:</span></p>
<pre class="source-code">
    private void TimeExpired() =&gt; Lose();</pre> <p class="calibre3">Finally, as the very <a id="_idIndexMarker397" class="pcalibre1 pcalibre calibre6"/>last steps for completing the collection game, referring to the additions to the following <strong class="source-inline">GameManager</strong> script, we’ll add both the <strong class="source-inline">WinText</strong> and <strong class="source-inline">LoseText</strong> public fields that hold the messages to be displayed when the game ends (as seen in <span><em class="italic">Figure 3</em></span><span><em class="italic">.13</em></span><span>):</span></p>
<pre class="source-code">
    public string WinText = "You win!";
    public string LoseText = "You lose!";</pre> <p class="calibre3">If you don’t assign some default text values to the variable declarations here, then don’t forget to assign them in <span>the </span><span><strong class="bold">Inspector</strong></span><span>!</span></p>
<p class="calibre3">We’ll also add the <strong class="source-inline">Win()</strong> and <span><strong class="source-inline">Lose()</strong></span><span> methods:</span></p>
<pre class="source-code">
    private void Win()
    {
        GameTimer.StopTimer();
        UI.SetGameOverText(WinText);
        Time.timeScale = 0f;
    }
    private void Lose()
    {
        UI.SetGameOverText(LoseText);
        Time.timeScale = 0f;
    }</pre> <p class="calibre3">A quick breakdown of these two new methods is <span>as follows:</span></p>
<ol class="calibre14">
<li class="calibre15">The <strong class="source-inline">Win()</strong> method starts off by stopping the timer by calling <strong class="source-inline">GameTimer.StopTimer()</strong>. This will cancel invoking the update timer method since our game is <span>over now.</span></li>
<li class="calibre15">Both of these methods call <strong class="source-inline">UI.SetGameOverText()</strong> but with the corresponding argument to display the correct message, <strong class="source-inline">WinText</strong> and <span><strong class="source-inline">LoseText</strong></span><span> respectively.</span></li>
<li class="calibre15">They each set the <strong class="source-inline">timeScale</strong> variable of the running game <strong class="source-inline">Time</strong> to <strong class="source-inline">0</strong>, which has the effect of pausing the game (with some exceptions; see the following callout block on <strong class="source-inline">Time.timeScale</strong> for <span>more information).</span></li>
</ol>
<p class="calibre3">Note that setting <strong class="source-inline">timeScale</strong> to zero will technically have the same result as calling <strong class="source-inline">GameTimer.StopTimer()</strong> here, since the only option at this point, is to restart the game. Still, I like to be explicit with some statements so that the intent is clearly visible in the code (so long as it’s not something that would otherwise <a id="_idIndexMarker398" class="pcalibre1 pcalibre calibre6"/>negatively impact things, of <span>course, heh).</span></p>
<p class="callout-heading">Additional reading | Unity documentation</p>
<p class="callout"><span><strong class="source-inline1">Time.timeScale</strong></span><span>: </span><a href="https://docs.unity3d.com/2022.3/Documentation/ScriptReference/Time-timeScale.xhtml" class="pcalibre1 pcalibre calibre6"><span>https://docs.unity3d.com/2022.3/Documentation/ScriptReference/Time-timeScale.xhtml</span></a></p>
<p class="calibre3">Since we broke things up into smaller chunks of code quite a bit in this section, you may want to refer to the completed <strong class="source-inline">GameManager</strong> script, which can be found in the GitHub repo <span>here: </span><a href="https://github.com/PacktPublishing/Unity-2022-by-Example/tree/main/ch3" class="pcalibre1 pcalibre calibre6"><span>https://github.com/PacktPublishing/Unity-2022-by-Example/tree/main/ch3</span></a></p>
<p class="calibre3">With that, our game is<a id="_idIndexMarker399" class="pcalibre1 pcalibre calibre6"/> complete. Yay! However, one more crucial step is needed before we can share our game with the world… and that is making sure others find the game challenging and fun <span>to play.</span></p>
<h3 class="calibre10">Playtesting</h3>
<p class="calibre3">Now is the time to playtest<a id="_idIndexMarker400" class="pcalibre1 pcalibre calibre6"/> and change the parameters of your level design, change the paths where the player can go, move objects and hazards, move the collectibles, and tweak the gameplay time to make the game challenging and fun <span>for players.</span></p>
<p class="calibre3">Have other people play your game – watch them play, if you can, to get an idea of how they play your game and get their feedback. Implement and iterate on changes in response to playtesting to improve <span>your game!</span></p>
<p class="callout-heading">Downloading the completed game code</p>
<p class="callout">Remember, the example code for this book can be downloaded from the GitHub repo <span>here: </span><a href="https://github.com/PacktPublishing/Unity-2022-by-Example" class="pcalibre1 pcalibre calibre6"><span>https://github.com/PacktPublishing/Unity-2022-by-Example</span></a></p>
<h1 id="_idParaDest-76" class="calibre5"><a id="_idTextAnchor077" class="pcalibre1 pcalibre calibre6"/>Summary</h1>
<p class="calibre3">This chapter was an introduction to the power of the CM camera system for quickly adding a Player follow camera, implementing game mechanics for collecting items that engage the player, displaying key game progression elements to the player with Unity UI, and how to finish and balance our collection game with both win and <span>lose conditions.</span></p>
<p class="calibre3">In the next chapter, we’ll introduce the next project in the book by defining the GDD for the <em class="italic">Outer World</em> 2D adventure game, learning how to import original artwork to use with additional Unity level building tooling, and exploring more aspects of level design and <span>game polish.</span></p>
</div>
</div></body></html>