- en: Chapter 5. Enhancing Reports
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第5章。增强报告
- en: In the previous chapter we saw how to create a simple report and display this
    report in our application. In this chapter, we will create a new report but this
    report will be more complex than the previous one. We will see how to group data
    using one or more fields, how to filter data by parameters, and how to add a subreport.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们看到了如何创建一个简单的报告并在我们的应用程序中显示这个报告。在本章中，我们将创建一个新的报告，但这个报告将比上一个更复杂。我们将看到如何使用一个或多个字段来分组数据，如何通过参数筛选数据，以及如何添加子报告。
- en: 'We will cover the following topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将涵盖以下主题：
- en: Using parameter fields
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用参数字段
- en: Working with formula fields
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用公式字段
- en: Working with subreport
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用子报告
- en: Grouping and sorting data
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分组和排序数据
- en: Adding the report to a form
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将报告添加到表单中
- en: In this chapter, we will have two sections. In the first section we will create
    a new report to display employees, like the one we had created in the previous
    chapter, but we will add some filters to this new report. This will allow the
    user to select those employees who have the same data. We see in the following
    screenshot that all employees in the report have the same data (**Country**, **City**,
    and **Title**). This can be achieved by using parameter fields. In the first section
    we will see how to use these.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将有两个部分。在第一部分，我们将创建一个新的报告来显示员工，就像我们在上一章中创建的那样，但我们将为此新报告添加一些筛选器。这将允许用户选择具有相同数据的员工。在下面的截图中，我们可以看到报告中的所有员工都具有相同的数据（**国家**、**城市**和**职位**）。这可以通过使用参数字段来实现。在第一部分，我们将看到如何使用这些字段。
- en: '![Enhancing Reports](img/5-1.jpg)'
  id: totrans-9
  prefs: []
  type: TYPE_IMG
  zh: '![增强报告](img/5-1.jpg)'
- en: In the second section, we will create a new report to display all the **Employee
    Details** and their **Employee orders** as shown in the following screenshot.
    We will also see how to use subreports, grouping, sorting, and formula fields.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在第二部分，我们将创建一个新的报告来显示所有**员工详细信息**和他们的**员工订单**，如下面的截图所示。我们还将看到如何使用子报告、分组、排序和公式字段。
- en: '![Enhancing Reports](img/5-2.jpg)'
  id: totrans-11
  prefs: []
  type: TYPE_IMG
  zh: '![增强报告](img/5-2.jpg)'
- en: Using parameter fields
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用参数字段
- en: 'We will create a new report the same way we created one in the previous chapter,
    using the following steps:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将以与上一章中创建报告相同的方式创建一个新的报告，步骤如下：
- en: We will use the same TableAdapter that we created in the previous chapter (**EmployeesTableAdapter**)
    as shown in the following screenshot:![Using parameter fields](img/5-3.jpg)
  id: totrans-14
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将使用我们在上一章中创建的相同的TableAdapter（**EmployeesTableAdapter**），如下面的截图所示：![使用参数字段](img/5-3.jpg)
- en: Add a new Crystal Reports to our application and rename it to `crFilteredEmployees`.
  id: totrans-15
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向我们的应用程序添加一个新的Crystal Reports，并将其重命名为`crFilteredEmployees`。
- en: As shown in the following screenshot, we will select the **As a Blank Report**
    radio button to learn how to connect to database with your report after the report
    creation. Click on the **OK** button.![Using parameter fields](img/5-4.jpg)
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如以下截图所示，我们将选择**作为一个空白报告**单选按钮，以了解在创建报告后如何使用报告连接到数据库。点击**确定**按钮。![使用参数字段](img/5-4.jpg)
- en: From **Field** **Explorer**, right-click on **Database Fields** and choose **Database
    Expert**. Select the `Employees` table as shown in the following screenshot. Click
    on the **OK** button.![Using parameter fields](img/5-5.jpg)
  id: totrans-17
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从**字段资源管理器**，右键单击**数据库字段**并选择**数据库专家**。选择`Employees`表，如下面的截图所示。点击**确定**按钮。![使用参数字段](img/5-5.jpg)
- en: Now you will see the table **Fields** when you navigate to **Field Explorer**
    | **Database Fields** | **Employees** as shown in the following screenshot:![Using
    parameter fields](img/5-6.jpg)
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在当您导航到**字段资源管理器** | **数据库字段** | **Employees**时，您将看到**字段**表，如下面的截图所示：![使用参数字段](img/5-6.jpg)
- en: Drag **Employees** fields to the **Details** section in our report and format
    the report, as shown in the following screenshot:![Using parameter fields](img/5-7.jpg)
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**员工**字段拖到我们的报告中的**详细信息**部分，并格式化报告，如下面的截图所示：![使用参数字段](img/5-7.jpg)
- en: Until now our report would have displayed all employees, so now we need to update
    this report to filter employees by their data (**Country**, **City**, and **Title**).
    In the next steps we will see how to add filters to our report.
  id: totrans-20
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 到目前为止，我们的报告会显示所有员工，因此现在我们需要更新这个报告以通过他们的数据（**国家**、**城市**和**职位**）来筛选员工。在接下来的步骤中，我们将看到如何向我们的报告添加筛选器。
- en: In **Field Explorer**, right-click on **Parameter Fields** and select **New**.
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**字段资源管理器**中，右键单击**参数字段**并选择**新建**。
- en: 'As we see in the following screenshot, we will name this parameter `pmCountry`
    and select its **Type** as **String**. We will keep the default values for other
    fields in the form and click on the **OK** button:'
  id: totrans-22
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如以下截图所示，我们将此参数命名为`pmCountry`，并选择其**类型**为**String**。我们将保留表单中其他字段的默认值，并点击**OK**按钮：
- en: '![Using parameter fields](img/5-8.jpg)'
  id: totrans-23
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![使用参数字段](img/5-8.jpg)'
- en: Create two more parameters with the type **String** and name them `pmCity` and
    `pmTitle`. Now we have three parameters, as shown in the following screenshot:![Using
    parameter fields](img/5-9.jpg)
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建两个更多类型的**String**参数，分别命名为`pmCity`和`pmTitle`。现在我们共有三个参数，如下截图所示：![使用参数字段](img/5-9.jpg)
- en: Until now we hadn't used these parameters and they don't have any effect in
    our report.
  id: totrans-25
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 到目前为止，我们还没有使用这些参数，它们在我们的报告中没有任何效果。
- en: Right-click on the report and navigate to **Report** | **Selection Formula**
    | **Record**. We will see this in the following screenshot:![Using parameter fields](img/5-10.jpg)
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键单击报告，导航到**报告** | **选择公式** | **记录**。以下截图显示了这一操作：![使用参数字段](img/5-10.jpg)
- en: We will write some code to apply parameters to our reports, as shown in the
    following screenshot:![Using parameter fields](img/5-11.jpg)
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将编写一些代码将参数应用到我们的报告中，如下截图所示：![使用参数字段](img/5-11.jpg)
- en: 'In the first line of code: (`{Employees.Title}={?pmTitle}`), we filtered Employees
    Title by `pmTitle` parameter.'
  id: totrans-28
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在代码的第一行（`{Employees.Title}={?pmTitle}`）中，我们通过`pmTitle`参数过滤了员工标题。
- en: In the second line of code (`{Employees.Country}={?pmCountry}`), we filtered
    Employees Country by `pmCountry` parameter.
  id: totrans-29
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在第二行代码（`{Employees.Country}={?pmCountry}`）中，我们通过`pmCountry`参数过滤了员工国家。
- en: 'In the third line of code: (`{Employees.City}={?pmCity}`), we filtered Employees
    City by `pmCity` parameter.'
  id: totrans-30
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在第三行代码（`{Employees.City}={?pmCity}`）中，我们通过`pmCity`参数过滤了员工城市。
- en: At the end we tied the three lines with the `and` keyword to ensure that the
    three filters must be applied together; if one filter failed the others will fail.
  id: totrans-31
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最后，我们使用`and`关键字将三条语句绑定在一起，以确保三个过滤器必须一起应用；如果其中一个过滤器失败，其他过滤器也会失败。
- en: Tip
  id: totrans-32
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: You can drag-and-drop **Table** and **Parameter** fields to the code box from
    the report fields in the upper box (field tree).
  id: totrans-33
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您可以从上方的报告字段（字段树）中将**表**和**参数**字段拖放到代码框中。
- en: Save and close the form from the top.
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从顶部保存并关闭表单。
- en: Until now we finished our report design, now we need to display our report in
    the application; when the user clicks `btnEmpByFilters` button (**By Filters**),
    the values of **Title**, **City**, and **Country** ComboBoxes are dynamically
    passed to our report parameters `pmTitle`, `pmCity`, and `pmCountry`.
  id: totrans-35
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经完成了报告设计，现在我们需要在应用程序中显示我们的报告；当用户点击`btnEmpByFilters`按钮（**按过滤器**）时，**标题**、**城市**和**国家**组合框的值将动态传递到我们的报告参数`pmTitle`、`pmCity`和`pmCountry`。
- en: Open **MainForm** from **Solution Explorer**. Double-click on the `btnEmpByFilters`
    button to move to the click event code and write the code that we see in the following
    screenshot:![Using parameter fields](img/5-12.jpg)
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从**解决方案资源管理器**中打开**MainForm**。双击`btnEmpByFilters`按钮，进入点击事件代码，并编写以下截图所示的代码：![使用参数字段](img/5-12.jpg)
- en: 'We have seen most of the previously mentioned lines of code in our previous
    chapter, but here we added only three extra lines of codes to pass the three parameters
    to our report dynamically. The three lines of code are as follows:'
  id: totrans-37
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们在上一章中看到了大多数之前提到的代码行，但在这里我们只添加了三条额外的代码行，以动态地将三个参数传递到我们的报告中。这三条代码行如下：
- en: '[PRE0]'
  id: totrans-38
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: When we run the application and test the result, we will see the report results,
    depending on what data was provided in the filters.
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当我们运行应用程序并测试结果时，我们将看到报告结果，具体取决于过滤器中提供的数据。
- en: We need to improve our report so the user can use one filter or two rather than
    three filters, or he can stop all filters. We will allow the user to stop any
    filter by writing the `"ALL"` string in the combo boxes used to filter the report
    data. We only need to change the parameters code in our report to meet this improvement.
  id: totrans-40
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们需要改进我们的报告，使用户可以使用一个或两个过滤器，而不是三个过滤器，或者他可以停止所有过滤器。我们将允许用户通过在用于过滤报告数据的组合框中输入`"ALL"`字符串来停止任何过滤器。我们只需要更改报告中参数的代码以满足这一改进。
- en: Right-click on any **Parameter Fields** in **Field Explorer** and select **Find
    in Formula**.
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**字段资源管理器**中右键单击任何**参数字段**，并选择**在公式中查找**。
- en: Update the code we wrote before to the new one as in the following screenshot
    then save and close.![Using parameter fields](img/5-13.jpg)
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将我们之前编写的代码更新为新版本，如以下截图所示，然后保存并关闭。![使用参数字段](img/5-13.jpg)
- en: Run the application to test the new change. Type`"ALL"` in the three combo boxes
    used to filter the report data, and click on the **By filters** button. You will
    now see the data of all the employees in the report. You can change one or two
    filters and keep the others to test the report result.
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行应用程序以测试新的更改。在用于过滤报告数据的三个组合框中输入 `"ALL"`，然后单击 **按筛选器** 按钮。现在您将看到报告中的所有员工数据。您可以更改一个或两个筛选器，保留其他筛选器以测试报告结果。
- en: In the next section, we will create a report to display the data of all the
    employees with the employee orders. This report contains a main report that consists
    of the employee data and another subreport that contains the employee orders.
    We will see how to use subreport by filtering data in the main report fields.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将创建一个报告来显示所有员工的订单数据。此报告包含一个主报告，其中包含员工数据，以及另一个包含员工订单的子报告。我们将通过在主报告字段中过滤数据来了解如何使用子报告。
- en: First we will create a TableAdapter that contains all the data from `Employees`
    table, the select query will look like the following screenshot:![Using parameter
    fields](img/5-14.jpg)
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们将创建一个包含 `Employees` 表中所有数据的 TableAdapter，选择查询将类似于以下屏幕截图：![使用参数字段](img/5-14.jpg)
- en: 'In the preceding query, we used `LEFT OUTER JOIN` to select all data from the
    left table that contains all employees'' data and selected the supervisor (`ReportsTo`)
    data from the second table if it exists. We didn''t use `INNER JOIN` because the
    employee with ID 2 (`Fuller`) does not have a supervisor (`ReportsTo`). We are
    also using `SELF JOIN` with the same table, which we learned in the previous chapters.
    The TableAdapter will look like the following screenshot:'
  id: totrans-46
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在前面的查询中，我们使用了 `LEFT OUTER JOIN` 来选择包含所有员工数据的左表中的所有数据，并在第二个表中存在的情况下选择了主管（`ReportsTo`）数据。我们没有使用
    `INNER JOIN`，因为 ID 为 2 的员工（`Fuller`）没有主管（`ReportsTo`）。我们还在使用与之前章节中学习相同的表进行 `SELF
    JOIN`。TableAdapter 将类似于以下屏幕截图：
- en: '![Using parameter fields](img/5-15.jpg)'
  id: totrans-47
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![使用参数字段](img/5-15.jpg)'
- en: We will create a new crystal report with the name `crEmployeeDetails` and pass
    `Employee1` as the report data source. Drag-and-drop data fields to the **Employee
    Details** section in our report and format the fields to look like the following
    screenshot:![Using parameter fields](img/5-16.jpg)
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将创建一个新的水晶报告，命名为 `crEmployeeDetails`，并将 `Employee1` 作为报告数据源。将数据字段拖放到报告中的 **员工详细信息**
    部分，并格式化字段以类似于以下屏幕截图：![使用参数字段](img/5-16.jpg)
- en: Please note that in the previous reports we used SQL queries to display the
    employees' and supervisors' full names in our report. In this section we will
    use a formula field to display their full name. As we saw in the previous screenshot,
    **Full Name** and **Reports To** are formula fields `(@fmu_FullName`, `@fmu_ReportTo`).
    We will see how to use formula fields now.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，在之前的报告中，我们使用了 SQL 查询来显示报告中的员工和主管的全名。在本节中，我们将使用公式字段来显示他们的全名。正如我们在之前的屏幕截图中看到的，**全名**和**汇报对象**是公式字段
    `(@fmu_FullName`, `@fmu_ReportTo`)。现在我们将了解如何使用公式字段。
- en: Working with formula fields
  id: totrans-50
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 与公式字段一起工作
- en: In this section we will see how to use formula fields and how they are useful
    and powerful for improving our reports.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将了解如何使用公式字段以及它们如何有助于提高我们的报告的实用性和强大功能。
- en: From **Field Explorer**, right-click on **Formula Fields** and select New. Type
    in the formula name `fmu_FullName` and click on the **OK** button. We will see
    this in the following screenshot:![Working with formula fields](img/5-17.jpg)
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从 **字段资源管理器**，右键单击 **公式字段** 并选择新建。输入公式名称 `fmu_FullName` 并单击 **确定** 按钮。您将在以下屏幕截图中看到：![与公式字段一起工作](img/5-17.jpg)
- en: This formula field will display the employee's full name in the same format
    that we created before using SQL query. Here we use the concatenate operator (`+`)
    to concatenate the title with the first and last name of the employee.
  id: totrans-53
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此公式字段将以我们之前使用 SQL 查询创建的相同格式显示员工的姓名。在这里，我们使用连接运算符（`+`）将头衔与员工的姓氏和名字连接起来。
- en: Create another formula field and name it `fmu_ReportsTo`. You will see the formula
    code in the following screenshot:![Working with formula fields](img/5-18.jpg)
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建另一个公式字段并将其命名为 `fmu_ReportsTo`。您将在以下屏幕截图中看到公式代码：![与公式字段一起工作](img/5-18.jpg)
- en: Drag-and-drop the two formula fields to the report as we did previously.
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将两个公式字段拖放到报告中，就像我们之前做的那样。
- en: Add a parameter field to the report and name it `EmpId`. We will use this parameter
    to filter the employees by ID as we see in the following screenshot:![Working
    with formula fields](img/5-19.jpg)
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将参数字段添加到报告中，并将其命名为`EmpId`。我们将使用此参数按ID过滤员工，如下截图所示：![处理公式字段](img/5-19.jpg)
- en: Open **MainForm** from **Solution Explorer**. Double-click on the **btnEmpById**
    button to move to the click event code and write the code that we see in the following
    screenshot:![Working with formula fields](img/5-20.jpg)
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从**解决方案资源管理器**中打开**MainForm**。双击**btnEmpById**按钮进入点击事件代码，并编写以下截图所示的代码：![处理公式字段](img/5-20.jpg)
- en: Run the application to test our report, write an ID number in the `txtEmpId`
    textbox and click on the **By id** button to test the result.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行应用程序以测试我们的报告，在`txtEmpId`文本框中输入一个ID号码，然后点击**按ID**按钮以测试结果。
- en: With this step we finished the main report that contains the employee data;
    in the next several steps we will add a subreport to the main report, which will
    contain the employee orders.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 通过这一步，我们完成了包含员工数据的主体报告；在接下来的几个步骤中，我们将向主报告添加一个子报告，该子报告将包含员工订单。
- en: Working with subreport
  id: totrans-60
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 处理子报告
- en: Now we will see another powerful tool in Crystal Reports; that is subreport.
    Subreport is used to create a report inside another report and link the two reports
    with a relation or a filter.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们将看到Crystal Reports中的另一个强大工具；那就是子报告。子报告用于在另一个报告中创建报告，并通过关系或过滤器将两个报告链接起来。
- en: Create TableAdapter, which contains the employee orders and all the data in
    the table `Orders`. We will rename the adapter to `OrdersByEmployeeIdTableAdapter`
    as we see in the following screenshot:![Working with subreport](img/5-21.jpg)
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建包含员工订单和`Orders`表中所有数据的TableAdapter。我们将根据以下截图将适配器重命名为`OrdersByEmployeeIdTableAdapter`：![处理子报告](img/5-21.jpg)
- en: In the main report, in the **Details** section, right-click and navigate to
    **Insert** | **Subreport**. Drag-and-drop this subreport at the end of the main
    report (after the `Notes` field in the **Employee Details** section). Then we
    will see the following screenshot:![Working with subreport](img/5-22.jpg)
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主报告中，在**细节**部分，右键单击并导航到**插入** | **子报告**。将此子报告拖放到主报告的末尾（在**员工细节**部分的`Notes`字段之后）。然后我们将看到以下截图：![处理子报告](img/5-22.jpg)
- en: As we see, we can choose the subreport from the application reports, export
    it from hard disk, or create a new report using Report Wizard. We will choose
    the last option, so click on the **Report Wizard...** button and complete the
    wizard as we have learned before. Make sure that you use the `OrdersByEmployeeId`
    table as a data source for the subreport. We will name the subreport `crOrdersByEmployeeId`
    and click on the **OK** button.
  id: totrans-64
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如我们所见，我们可以从应用程序报告中选择子报告，从硬盘上导出它，或使用报表向导创建一个新的报告。我们将选择最后一个选项，因此点击**报表向导...**按钮并完成向导，就像我们之前学过的那样。确保您使用`OrdersByEmployeeId`表作为子报告的数据源。我们将子报告命名为`crOrdersByEmployeeId`并点击**确定**按钮。
- en: Right-click on the subreport and select **Edit Subreport**. In subreport we
    will group the Employee orders by the country so in the next few steps we will
    see how to use grouping in Crystal Reports.
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键单击子报告并选择**编辑子报告**。在子报告中，我们将按国家分组员工订单，因此接下来我们将看到如何在Crystal Reports中使用分组。
- en: Grouping and sorting data
  id: totrans-66
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 分组和排序数据
- en: In this section we will see how to group and sort report data with one or more
    fields.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将看到如何使用一个或多个字段对报告数据进行分组和排序。
- en: In **Field Explorer**, right-click on **Group Name Fields** and select **Insert
    Group**. We will see this in the following screenshot:![Grouping and sorting data](img/5-23.jpg)
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**字段浏览器**中，右键单击**分组名称字段**并选择**插入分组**。以下截图将展示这一过程：![分组和排序数据](img/5-23.jpg)
- en: Choose the group field (**ShipCountry**) and the sort type (**in ascending order.**).
    We can change the field title from the **Options** tab. Click on the **OK** button.
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 选择分组字段（**ShipCountry**）和排序类型（**升序**）。我们可以通过**选项**选项卡更改字段标题。点击**确定**按钮。
- en: Format the subreport as we see in the following screenshot. You can see the
    two new sections that were added to the report after we created the group.![Grouping
    and sorting data](img/5-24.jpg)
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按以下截图格式化子报告。您可以看到在创建分组后添加到报告中的两个新部分。![分组和排序数据](img/5-24.jpg)
- en: Now we need to filter data in the subreports using the parameter field in the
    main report.
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 现在我们需要使用主报告中的参数字段在子报告中过滤数据。
- en: Go back to the main report, right-click on the subreport, and select the **Change
    subreport** **Links…**. We will see the following screenshot:![Grouping and sorting
    data](img/5-25.jpg)
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回到主报告，右键单击子报告，并选择**更改子报告** **链接…**。我们将看到以下截图：![分组和排序数据](img/5-25.jpg)
- en: In this dialog, we will map the **EmpId** parameter field from the main report
    to **EmployeeID** in the subreport. From the **Available Fields** list, we will
    select the **EmpId** parameter and move it to the **Field(s) to link to:** list.
    In the last part in the dialog we will choose **EmployeeID** from the right drop-down
    list to link it with the **EmpId** parameter in the left drop-down list. Click
    on the **OK** button.
  id: totrans-73
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在此对话框中，我们将主报告中的**EmpId**参数字段映射到子报告中的**EmployeeID**。从**可用字段**列表中，我们将选择**EmpId**参数并将其移动到**要链接的字段（s）**列表中。在对话框的最后部分，我们将从右侧下拉列表中选择**EmployeeID**，将其与左侧下拉列表中的**EmpId**参数链接。点击**确定**按钮。
- en: 'Now the two reports are connected together with one parameter: **EmpId**. The
    last step is to fill the subreport with data before displaying your report to
    the user.'
  id: totrans-74
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 现在两个报告通过一个参数：**EmpId**连接在一起。最后一步是在向用户显示报告之前填充子报告中的数据。
- en: Navigate back to the button click event to update your code as shown in the
    following screenshot:![Grouping and sorting data](img/5-26.jpg)
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回到按钮点击事件，更新你的代码，如下截图所示：![分组和排序数据](img/5-26.jpg)
- en: We only added three lines of code to the old code, the three lines to fill the
    subreport with data using the **OrdersByEmployeeIdTableAdapter** TableAdapter.
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们只向旧代码中添加了三行代码，这三行代码用于使用**OrdersByEmployeeIdTableAdapter** TableAdapter填充子报告中的数据。
- en: Run our application to test the last changes. The final report will look like
    the following screenshot:![Grouping and sorting data](img/5-27.jpg)
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行我们的应用程序以测试最后更改。最终的报告将看起来如下截图所示：![分组和排序数据](img/5-27.jpg)
- en: As we see in the previous screenshot, the date format contains the time; we
    want to change this format to display the date only. Navigate back to our report,
    right-click on any date field in the report, select **Format Object**, and select
    the date format as shown in the following screenshot:![Grouping and sorting data](img/5-28.jpg)
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如前一个截图所示，日期格式包含时间；我们希望更改此格式以仅显示日期。返回到我们的报告，在报告中的任何日期字段上右键单击，选择**格式对象**，并选择如下截图所示的日期格式：![分组和排序数据](img/5-28.jpg)
- en: 'After changing the date format for all date fields (**BirthDate**, **HireDate**,
    **OrderDate**, and **ShippedDate**), the report will look like the following screenshot:'
  id: totrans-79
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在所有日期字段（**BirthDate**、**HireDate**、**OrderDate**和**ShippedDate**）更改日期格式后，报告将看起来如下截图所示：
- en: '![Grouping and sorting data](img/5-29.jpg)'
  id: totrans-80
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![分组和排序数据](img/5-29.jpg)'
- en: Summary
  id: totrans-81
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we created two reports and we learned from the first one how
    to use parameter fields and how to use these fields to filter the report data.
    In the second report we learned how to use subreports and how to use grouping
    and sorting. In the next chapter, we will create special type of reports and we
    will see how to create a crosstab report.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们创建了两个报告，并从第一个报告中学习了如何使用参数字段以及如何使用这些字段来过滤报告数据。在第二个报告中，我们学习了如何使用子报告以及如何使用分组和排序。在下一章中，我们将创建特殊类型的报告，并了解如何创建交叉表报告。
