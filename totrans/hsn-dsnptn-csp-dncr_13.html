<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Reactive Programming Patterns and Techniques</h1>
                </header>
            
            <article>
                
<p>In the previous chapter (<a href="b1363fa4-f669-4670-9d40-a7e888557249.xhtml">Chapter 9</a>, <em>Functional Programming Practices</em>), we delved into functional programming and learned about <strong>Func</strong>, <strong>Predicate</strong>, <strong>LINQ</strong>, <strong>Lambda</strong>, <strong>anonymous functions</strong>, <strong>expression trees</strong>, and <strong>recursion</strong>. We also looked at the implementation of the strategy pattern using functional programming.</p>
<p>This chapter will explore the use of reactive programming and provides a hands-on demonstration of reactive programming using the C# language. We will delve into the principles and models of reactive programming and discuss the <kbd>IObservable</kbd> and <kbd>IObserver</kbd> <span>providers</span>.</p>
<p>The inventory application will be expanded in two main ways: by reacting to changes and by discussing the <strong>Model-View-ViewModel</strong><span> (</span><strong>MVVM</strong>) pattern.</p>
<p>The following topics will be covered in this chapter:</p>
<ul>
<li>The principles of reactive programming</li>
<li>Reactive and IObservable</li>
<li>Reactive extensions—.NET Rx Extensions</li>
<li>Inventory application use case—getting inventory with a filter, paging, and sorting</li>
<li>Patterns and practices – MVVM</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p>This chapter contains various code examples to explain the concepts of reactive programming. The code is kept simple and is only for demonstration purposes. Most of the examples involve a .NET Core console application written in C#.</p>
<div class="packt_infobox"><span>The complete source code is available at the following link: </span><a href="https://github.com/PacktPublishing/Hands-On-Design-Patterns-with-C-and-.NET-Core/tree/master/Chapter10">https://github.com/PacktPublishing/Hands-On-Design-Patterns-with-C-and-.NET-Core/tree/master/Chapter10</a>.</div>
<p>Running and executing the code will require the following:</p>
<ul>
<li>Visual Studio 2019 (you can also use Visual Studio 2017)</li>
<li>Setting up .NET Core </li>
<li>SQL Server (the Express Edition is used in this chapter)</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing Visual Studio</h1>
                </header>
            
            <article>
                
<p>To run the code examples, you will need to install Visual Studio (the preferred IDE). To do so, you can follow these instructions:</p>
<ol>
<li>Download Visual Studio 2017 or the later version (2019) from the download link mentioned with the installation instructions:<span> </span><a href="https://docs.microsoft.com/en-us/visualstudio/install/install-visual-studio">https://docs.microsoft.com/en-us/visualstudio/install/install-visual-studio</a>.</li>
<li>Follow the installation instructions.</li>
<li>Multiple options are available for Visual Studio installation. Here, we are using Visual Studio for Windows.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up .NET Core</h1>
                </header>
            
            <article>
                
<p class="mce-root">If you do not have .NET Core installed, you will need to follow these steps:</p>
<ol>
<li class="mce-root">Download .NET Core for Windows:<span> </span><a href="https://www.microsoft.com/net/download/windows">https://www.microsoft.com/net/download/windows</a>.<a href="https://www.microsoft.com/net/download/windows"/></li>
<li>For multiple versions and a related library, visit <a href="https://dotnet.microsoft.com/download/dotnet-core/2.2">https://dotnet.microsoft.com/download/dotnet-core/2.2</a>.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing SQL Server</h1>
                </header>
            
            <article>
                
<p class="mce-root">If you do not have SQL Server installed, you can follow these instructions:</p>
<ol>
<li>Download SQL Server from the following link: <a href="https://www.microsoft.com/en-in/download/details.aspx?id=1695">https://www.microsoft.com/en-in/download/details.aspx?id=1695</a>.</li>
<li>You can find the installation instructions here: <a href="https://docs.microsoft.com/en-us/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-2017">https://docs.microsoft.com/en-us/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-2017</a>.</li>
</ol>
<div class="mce-root packt_infobox">For troubleshooting and for more information, refer to the following link: <a href="https://www.blackbaud.com/files/support/infinityinstaller/content/installermaster/tkinstallsqlserver2008r2.htm">https://www.blackbaud.com/files/support/infinityinstaller/content/installermaster/tkinstallsqlserver2008r2.htm</a>.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The principles of reactive programming</h1>
                </header>
            
            <article>
                
<p>These days, everyone is talking about <strong>asynchronous programming</strong>. Various applications are built on RESTful services that use asynchronous programming. <span>The term <em>asynchronous</em> is relevant to reactive programming. Reactive is all about data streams, and reactive programming is a mo</span><span>del structure that is built around asynchronous data streams. Reactive programming is also known as <em>the art of programming the propagation of changes</em>. Let's go back to our example from <a href="ac0ad344-5cd2-4c11-bcfe-cf55b9c4ce3c.xhtml">Chapter 8</a>, </span><em>Concurrent Programming in .NET Core,</em> <span>where we were discussing the ticket collection counters at a big conference.</span></p>
<p><span>In addition to the three ticket-collection counters, we have one more counter named the calculation counter. This fourth counter concentrates on counting the collection, and it counts how many tickets are distributed from each of the three counters. Consider the following diagram:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/747ea7b4-c8c3-4740-a44a-fb4986c84231.png" style=""/></div>
<p>In the preceding diagram, the total of A+B+C is the sum of the remaining three columns; it is 1+1+1 = 3. The <strong>Total</strong> column always shows the sum of rest of the three columns, and it will never show the actual person who is standing in the queue and waiting for their turn to collect the ticket. The value of the <strong>Total</strong> column depends upon the number of the remaining columns. If <strong>Counter A</strong> had two people in a queue, then the <strong>Total</strong> column would have the sum of 2+1+1 = 4. You can also refer to the <strong>Total</strong> column as a computed column. This column calculates the sum as soon as other rows/columns shift their counts (people waiting in the queue). If we were to write the <strong>Total</strong> column in C#, we would choose the computed property, and this would look as follows: <kbd>public int TotalColumn { get { return ColumnA + ColumnB + ColumnC; } }</kbd>.</p>
<p>In the preceding diagram, data flows from column to column. You can treat this as a data stream. You can create a stream for anything such as click events and hover events. Anything can be a stream variable: user inputs, properties, caches, data structures, and more. In the stream world, you can listen to the stream and react accordingly.</p>
<div class="packt_infobox">A sequence of events is called a <strong>stream</strong>. A stream can emit three things: a value, an error, and a signal for completion.</div>
<p>You can easily work with a stream in this way:</p>
<ul>
<li>One stream can be the input for another stream.</li>
<li>Multiple streams can be the input for another stream.</li>
<li>Streams can be merged.</li>
<li>Data values can be mapped from one stream to another.</li>
<li>Streams can be filtered with the data/events that you need.</li>
</ul>
<p>To understand streams more closely, see the following diagram that represents a stream (a sequence of events):</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/e147faca-305d-440c-87b6-0ba924c39f34.png" style=""/></div>
<p>The preceding diagram is a representation of a stream (sequence of events) where we have one to four events. Any of these events can be triggered or someone can click on any of them. These events can be represented by values and these values can be strings. The X s<span>ign </span>shows that an error has occurred during the operation where streams are merged or their data is being mapped. Finally, the | sign shows that a stream (or an operation) is complete.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Be reactive with reactive programming</h1>
                </header>
            
            <article>
                
<p>Obviously, our computed property (discussed in the previous section) cannot be reactive or represent reactive programming. Reactive programming has specific designs and technologies. To experience the reactive programming or to be reactive, you can start with documents, available at <a href="http://reactivex.io/">http://reactivex.io/</a> and experience it by going through the reactive manifesto (<a href="https://www.reactivemanifesto.org/">https://www.reactivemanifesto.org/</a>)<a href="https://www.reactivemanifesto.org/">.</a></p>
<p><a href="https://www.reactivemanifesto.org/"/></p>
<div class="packt_infobox">In simple terms, reactive properties are binding properties that react when an event is triggered.</div>
<p>Nowadays, when we deal with various large systems/applications, we find that they are too large to handle at once. These large systems are divided or composed into smaller systems. These smaller units/systems rely on reactive properties. To adhere to reactive programming, reactive systems apply design principles so that these properties can apply to all methods. With the help of this design/approach, we can make a composable system.</p>
<p>According to the manifesto, reactive programming and reactive systems are <span>both</span><span> </span><span>different.</span></p>
<p>On the basis of the reactive manifesto, we can conclude that reactive systems are as follows:</p>
<ul>
<li><strong>Responsive</strong>: Reactive systems are event-based design systems; these systems are quick to respond to any request in a short amount of time.</li>
<li><strong>Scalable</strong>: Reactive systems are reactive in nature. These systems can react to changing the scalability rate by expanding or reducing the allocated resources.</li>
<li><strong>Resilient</strong>: A resilient system is one that will not stop even if there is a failure/exception. Reactive systems are designed in such a way so that in any exception or failure, the system will never die; it remains working.</li>
<li><strong>Message-based</strong>: Any data item represents a message that can be sent to a specific destination. When a message or data item has arrived at a given state, an event emits a signal to notify the subscribers that a message has reached. Reactive systems rely on this message passing.</li>
</ul>
<p>The following diagram shows a pictorial view of a reactive system:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/2e361032-d61e-429f-a4f8-9745429379ec.png" style=""/></div>
<p>In this diagram, a reactive system is composed of small systems that are resilient, scalable, responsive, and message-based.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Reactive streams in action</h1>
                </header>
            
            <article>
                
<p>So far, we have discussed the fact that reactive programming is a data stream. In the previous sections, we have also discussed how streams work and how these streams travel in a timely manner. We have seen an example of events and discussed the data streams in a reactive program. Now, let's go ahead with the same example and look at how two streams work with various operations.</p>
<p>In the next example, we have two observable streams of an integer data type collection. Please note that we are using the pseudo code in this section to explain the behavior and the way in which these collections of data streams work.</p>
<p>The following diagram represents two observable streams. The first stream, <kbd>Observer1</kbd>, contains numbers <strong>1</strong>, <strong>2</strong>, and <strong>4</strong>, whereas <kbd>Observer2</kbd>, which is a second stream, contains numbers <strong>3</strong> and <strong>5</strong>:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/35ab0fbd-3968-400c-9032-08126e65ac7a.png" style=""/></div>
<p>Merging two streams involves combining their sequence elements into a new stream. The following diagram shows a new stream that results when <kbd>Observer1</kbd> and <kbd>Observer2</kbd> are merged:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/d4aeb61d-ed6b-4fcf-9a24-8562bed48a92.png" style=""/></div>
<p>The preceding diagram is only a representation of a stream and is not an actual representation of the sequence of elements in the stream. In this diagram, we have seen that elements (numbers) are in the sequence <strong>1</strong>, <strong>2</strong>, <strong>3</strong>, <strong>4</strong>, <strong>5</strong>, but this is not true in a realistic example. The sequence can vary; it could be <strong>1</strong>, <strong>2</strong>, <strong>4</strong>, <strong>3</strong>, <strong>5</strong>, or in any other order.</p>
<p>Filtering a stream is just like skipping elements/records. You can imagine a <kbd>Where</kbd> clause in LINQ, which looks something like this: <span class="packt_screen"><kbd>myCollection.Where(num =&gt; num &lt;= 3);</kbd>.</span></p>
<p>The following diagram illustrates a pictorial view of criteria, where we're trying to pick only the elements that are meeting the specific criteria:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/1a2965f1-b4a3-4034-82f1-7119a41fad65.png" style=""/></div>
<p>We are filtering our stream and picking only those elements that are <em>&lt;=3</em>. This means we are skipping elements <strong>4</strong> and <strong>5</strong>. In this case, we can say the filter is there to skip elements or to match the criteria.</p>
<p>To understand a map stream, you can imagine any mathematical operation where you would be counting sequences or incrementing numbers by adding some constant values. For example, if we have an integer value of <em>3</em> and our map stream is <em>+3</em>, that means we are counting a sequence as <em>3 + 3 = 6</em>. You can also correlate this with the LINQ and select and project the output like this: <kbd>return myCollection.Select(num =&gt; num+3);</kbd>.</p>
<p>The following diagram represents a map of the stream:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/031e8a71-9f81-475c-ac46-ae15cd06bc7c.png" style=""/></div>
<p>After applying filters with the condition, <em>&lt;= 3</em>, our stream has the elements <strong>1</strong>, <strong>2</strong>, and <strong>3</strong>. Additionally, we applied <kbd>Map (+3)</kbd> to the filtered stream with the elements <strong>1</strong>, <strong>2</strong>, and <strong>3</strong>, and, finally, our stream has the elements <strong>4</strong>,<strong>5</strong>,<strong>6</strong> (1+3, 2+3, 3+3).</p>
<p>In the real world, these operations would occur sequentially or on demand. We have already done this operation of sequences so that we can apply the operations of merge, filter, and mapping in a sequential manner. The following diagram represents the flow of our imaginary example:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/c3bfc2c2-2d3a-484f-a99f-8f8c3082316c.png" style=""/></div>
<p>So, we have tried to represent our examples through diagrams, and we have gone through various operations where two streams talk to each other, and we got a new stream, and then we filtered and mapped the stream.</p>
<div class="packt_infobox">To understand this better, refer to <a href="https://rxmarbles.com/">https://rxmarbles.com/</a>.</div>
<p>Now let's create a simple code to complete this example in the real world. First, we will study the code that implements the example, and then we will discuss the output of the stream.</p>
<p>Consider the following code snippet as an example of the <kbd>IObservable</kbd> interface:</p>
<p><kbd>public static IObservable&lt;T&gt; From&lt;T&gt;(this T[] source) =&gt; source.ToObservable();</kbd></p>
<p>This code represents an extension method of a <kbd>T</kbd> type array. We created a generic method and named it <kbd>From</kbd>. This method returns an <kbd>Observable</kbd> sequence.</p>
<div class="packt_infobox">You can visit the official documentation to know more about extension methods here: <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/extension-methods">https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/extension-methods</a>.</div>
<p>In our code, we have the <kbd>TicketCounter</kbd> class. This class has two observers that are actually arrays of the integer data type. The following code shows two observables:</p>
<pre>public IObservable&lt;int&gt; Observable1 =&gt; <strong>Counter1.</strong>From();<br/>public IObservable&lt;int&gt; Observable2 =&gt; <strong>Counter2.</strong>From();</pre>
<p>In this code, we apply the <kbd>From()</kbd> extension method to <kbd>Counter1</kbd> and <kbd>Counter2</kbd>. These counters actually represent our ticket counters and recall our example from <a href="ac0ad344-5cd2-4c11-bcfe-cf55b9c4ce3c.xhtml">Chapter 8</a>, <em>Concurrent programming in .NET Core</em><span class="packt_screen">.</span></p>
<p>The following code snippet represents <kbd>Counter1</kbd> and <kbd>Counter2</kbd>:</p>
<pre>internal class TicketCounter<br/>{<br/>    private IObservable&lt;int&gt; _observable;<br/>    public int[] Counter1;<br/>    public int[] Counter2;<br/>    public TicketCounter(int[] counter1, int[] counter2)<br/>    {<br/>        Counter1 = counter1;<br/>        Counter2 = counter2;<br/>    }<br/>...<br/>}</pre>
<p>In this code, we have two fields, <kbd>Counter1</kbd> and <kbd>Counter2</kbd>, and they are initialized from the constructor. When the <kbd>TicketCounter</kbd> class is being initialized, these fields get the values from the constructor of the class, as defined in the following code: </p>
<pre>TicketCounter ticketCounter = new TicketCounter(new int[]{1,3,4}, new int[]{2,5});</pre>
<p>To understand the complete code, go to and execute the code by hitting <em>F5</em> in Visual Studio. From here, you will see the following screen:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/7ca5c074-4bcc-4994-bb14-27c1f6df5946.png" style=""/></div>
<p>This is the console output and, in this console window, the user has been asked to enter a comma-separated number from <kbd>0</kbd> to <kbd>9</kbd>. Go ahead and enter a comma-separated number here. Please note that, here, we are trying to create a code that depicts our diagram of data stream representation, which was discussed earlier in this section:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/d898ad73-55f7-4510-8b2b-b860bce2c9cf.png" style=""/></div>
<p>As per the preceding diagram, we have entered two different comma-separated numbers. The first is <kbd>1,2,4</kbd> and the second is <kbd>3,5</kbd>. Now consider our <kbd>Merge</kbd> method:</p>
<pre>public IObservable&lt;int&gt; Merge() =&gt; _observable = Observable1.<strong>Merge</strong>(Observable2);</pre>
<p>The <kbd>Merge</kbd> method is merging two sequences of the data stream into <kbd>_observable</kbd>. The <kbd>Merge</kbd> operation is initiated with the following code:</p>
<pre>Console.Write("\n\tEnter comma separated number (0-9): ");<br/>var num1 = Console.ReadLine();<br/>Console.Write("\tEnter comma separated number (0-9): ");<br/>var num2 = Console.ReadLine();<br/>var counter1 = num1.ToInts(',');<br/>var counter2 = num2.ToInts(',');<br/><strong>TicketCounter </strong>ticketCounter = new <strong>TicketCounter</strong>(counter1, counter2);</pre>
<p>In this code, the user is prompted to enter comma-separated numbers, and then the program stores these numbers into <kbd>counter1</kbd> and <kbd>counter2</kbd> by applying the <kbd>ToInts</kbd> method. The following is the code of our <kbd>ToInts</kbd> method:</p>
<pre>public static int[] ToInts(this string commaseparatedStringofInt, char separator) =&gt;<br/>    Array.ConvertAll(commaseparatedStringofInt.Split(separator), int.Parse);</pre>
<p>This code is an extension method for <kbd>string</kbd>. The target variable is of a <kbd>string</kbd> type that contains integers separated by <kbd>separator</kbd>. In this method, we are using the built-in <kbd>ConvertAll</kbd> method that is provided by .NET Core. This first splits the string and checks whether the split value is of an <kbd>integer</kbd> type. It then returns the <kbd>Array</kbd> of integers. This method produces the output, as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/481c8752-3a12-4265-86d3-05dd0b57ceca.png" style=""/></div>
<p><span>The following is the output of our <kbd>merge</kbd> operation:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/b45912b4-2e62-4a21-8fad-4ea7d1524d85.png" style=""/></div>
<p>The preceding output shows that we <span>now</span><span> </span><span>have a final merged observer stream with the elements in sequence.</span><span> Let's apply a filter to this stream. The following code is our</span> <kbd>Filter</kbd> <span>method:</span></p>
<pre>public IObservable&lt;int&gt; <strong>Filter</strong>() =&gt; _observable = from num in _observable<br/>    where num &lt;= 3<br/>    select num;</pre>
<p>We have the filter criteria for the number <kbd>&lt;= 3</kbd>, which means we will pick only the elements whose values are either less than or equal to <kbd>3</kbd>. This method will initiate with the following code:</p>
<pre>ticketCounter.Print(ticketCounter.Filter());</pre>
<p>When the preceding code is executed, it produces the following output:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/22aede10-aae2-4fee-9e9d-8d549af5ea7d.png" style=""/></div>
<p>Finally, we have a filtered stream with the elements in the sequence 1,3,2. Now we need to map on this stream. We need a mapped element with <kbd>num + 3</kbd>, which means we need to output an integer number by adding <kbd>3</kbd> to this number. The following is our <kbd>Map</kbd> method:</p>
<pre>public IObservable&lt;int&gt; <strong>Map</strong>() =&gt; _observable = from num in _observable<br/>    select num + 3;</pre>
<p>The preceding method will be initialized with the following code:</p>
<pre>Console.Write("\n\tMap (+ 3):");<br/>ticketCounter.Print(ticketCounter.<strong>Map</strong>());</pre>
<p>On execution of the preceding method, we will see the following output:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/b1f0aa3c-79ef-48d4-98e2-c178c079b892.png" style=""/></div>
<p>After applying the <kbd>Map</kbd> method, we have the stream of an element in the sequence of 4,6,5. We have discussed how reactive works even with an imaginary example. We have created a small .NET Core console application to see the power of <kbd>Merge</kbd>, <kbd>Filter</kbd>, and <kbd>Map</kbd> operations on the observables. The following is the output of our console application:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/8ed54e75-5467-4282-ab32-9dbf41194cfa.png" style=""/></div>
<p>The previous snapshot is telling the whole story of the execution of our sample application; <kbd>Counter1</kbd> and <kbd>Counter2</kbd> are data streams that contain the sequences of data 1,2,4 and 3,5. We have the preceding output for <kbd>Merge</kbd> with the result <kbd>1,3,2,5,4 Filter (&lt;=3)</kbd><span class="packt_screen">,</span> with the result 1,3,2 and <kbd>Map (+3)</kbd> with the data 4,6,5.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Reactive and IObservable</h1>
                </header>
            
            <article>
                
<p>In the previous section, we discussed reactive programming and went through its model. In this section, we will discuss the Microsoft implementation of reactive programming. In response to reactive programming in .NET Core, we have various interfaces that provide a way to implement reactive programming in our application.</p>
<p><kbd>IObservable&lt;T&gt;</kbd><span> is a generic interface that is defined in the</span> <kbd>System</kbd> <span>namespace and declared as</span> <kbd>public interface IObservable&lt;out T&gt;</kbd><span>. Here, </span><kbd>T</kbd> <span>represents a generic type of parameter that provides notification information. In simple terms, this interface helps us to define a provider for notifications, and these notifications can be pushed for information. You can use the observer pattern while implementing the</span> <kbd>IObservable&lt;T&gt;</kbd> <span>interface in your application.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Observer pattern – implementation using IObservable&lt;T&gt;</h1>
                </header>
            
            <article>
                
<p>In simple terms, a subscriber registers with a provider so that the subscriber may get notifications related to the message information. These notifications notify the provider that messages have been delivered to subscribers. This information may also be related to changes in operations or any other changes in the method or object itself. This is also known as <strong>state changes</strong>.</p>
<div class="packt_infobox">The observer pattern specifies two terms: <span class="packt_screen">Observer</span> and <span class="packt_screen">Observable</span>. The observable is a provider also known as the <strong>subject</strong><em>.</em> The observer is registered with the <kbd>Observable</kbd>/<kbd>Subject</kbd>/<kbd>Provider</kbd> types, and the observer will be automatically notified by the provider whenever any changes occur due to the pre-defined criteria/condition, change or event, and so on.<em><br/></em></div>
<p>The following diagram is a simple representation of the observer pattern, where the subject is notifying two different observers:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/4d2b83fd-d913-4456-bf7a-b587b7e12da5.png" style=""/></div>
<p>Go back to the <kbd>FlixOne</kbd> inventory web application from <a href="b1363fa4-f669-4670-9d40-a7e888557249.xhtml">Chapter 9</a>, <em>Functional Programming Practices</em>, initiate your Visual Studio, and open the <kbd>FlixOne.sln</kbd> <span>solution.</span></p>
<p>Open <span class="packt_screen">Solution Explorer</span>. From here, you will see that our project will look similar to the following snapshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/6c18ba34-8fb5-4905-b012-8d55995ca8fc.png" style=""/></div>
<p>Expand the <span class="packt_screen">Common</span> folder under <span class="packt_screen">Solution Explorer</span> and add two files: <kbd>ProductRecorder.cs</kbd> and <kbd>ProductReporter.cs</kbd>. These files are the implementation of the <kbd>IObservable&lt;T&gt;</kbd> and <kbd>IObserver&lt;T&gt;</kbd> interfaces. We also need to add a new <span class="packt_screen">ViewModel</span> so that we can report actual messages to the users. To do so, expand the <kbd>Models</kbd> folder and add the <kbd>MessageViewModel.cs</kbd> file.</p>
<p>The following code is showing our <kbd>MessageViewModel</kbd> class:</p>
<pre>public class MessageViewModel<br/>{<br/>    public string MsgId { get; set; }<br/>    public bool IsSuccess { get; set; }<br/>    public string Message { get; set; }<br/><br/>    public override string ToString() =&gt; $"Id:{MsgId}, Success:{IsSuccess}, Message:{Message}";<br/>}</pre>
<p><kbd>MessageViewModel</kbd> contains the following:</p>
<ul>
<li><kbd>MsgId</kbd>: A unique identifier</li>
<li><kbd>IsSuccess</kbd>: Shows whether the operation has failed or succeeded</li>
<li><kbd>Message</kbd>: A success message or an error message that depends upon the value of <kbd>IsSuccess</kbd></li>
<li><kbd>ToString()</kbd>: An override method that returns a string after concatenating all the information</li>
</ul>
<p>Let's now discuss our two classes; the following code is from the <kbd>ProductRecorder</kbd> class:</p>
<pre>public class ProductRecorder : IObservable&lt;Product&gt;<br/>{<br/>    private readonly List&lt;IObserver&lt;Product&gt;&gt; _observers;<br/><br/>    public ProductRecorder() =&gt; _observers = new List&lt;IObserver&lt;Product&gt;&gt;();<br/><br/>    public IDisposable Subscribe(IObserver&lt;Product&gt; observer)<br/>    {<br/>        if (!_observers.Contains(observer))<br/>            _observers.Add(observer);<br/>        return new Unsubscriber(_observers, observer);<br/>    }<br/>...<br/>}</pre>
<p>Our <kbd>ProductRecorder</kbd> class implements the <kbd>IObservable&lt;Product&gt;</kbd> interface. If you recall our discussion regarding the observer pattern, you will come to know that this class is actually a provider, a subject, or an observable. The <kbd>IObservable&lt;T&gt;</kbd> interface has a <kbd>Subscribe</kbd> method that we need to use to subscribe our subscribers or observers (we will discuss the observer later in this section).</p>
<p>There should be a criteria or a condition so that the subscriber can get notifications. In our case, we have a <kbd>Record</kbd> method that serves this purpose. Consider the following code:</p>
<pre>public void Record(Product product)<br/>{<br/>    var discountRate = product.Discount.FirstOrDefault(x =&gt; x.ProductId == product.Id)?.DiscountRate;<br/>    foreach (var observer in _observers)<br/>    {<br/>        if (discountRate == 0 || discountRate - 100 &lt;= 1)<br/>            observer.OnError(<br/>                new Exception($"Product:{product.Name} has invalid discount rate {discountRate}"));<br/>        else<br/>            observer.OnNext(product);<br/>    }<br/>}</pre>
<p>The preceding is a <kbd>Record</kbd> method. We created this method to showcase the power of the pattern. This method is simply checking for the valid discount rates. If <kbd>discount rate</kbd> is not valid, as per the criteria/condition, this method would raise an exception and share the product name with an invalid <kbd>discount rate</kbd>.</p>
<p>The previous method validates the discount rate as per the criteria and sends a notification about the raised exception to the subscriber upon failure of the criteria. Take a look at the iteration block (the <kbd>foreach</kbd> loop) and imagine a situation where we do not have anything to iterate and all the subscribers have been notified. Can we imagine what will happen in this case? The same kind of situation may arise for <kbd>infinite</kbd> loop. To stop this, we need something that terminates the loop. For this, we have the following <kbd>EndRecording</kbd> method:</p>
<pre>public void EndRecording()<br/>{<br/>    foreach (var observer in _observers.ToArray())<br/>        if (_observers.Contains(observer))<br/>            observer.OnCompleted();<br/>    _observers.Clear();<br/>}</pre>
<p>Our <kbd>EndRecoding</kbd> method is looping through the collection of <kbd>_observers</kbd> and triggering the <kbd>OnCompleted()</kbd> method explicitly. Finally, it cleared the <kbd>_observers</kbd> collection.</p>
<p>Now, let's discuss the <kbd>ProductReporter</kbd> class. This class is an example of the implementation of the <kbd>IObserver&lt;T&gt;</kbd> interface. Consider the following code:</p>
<pre>public void OnCompleted()<br/>{<br/>    PrepReportData(true, $"Report has completed: {Name}");<br/>    Unsubscribe();<br/>}<br/><br/>public void OnError(Exception error) =&gt; PrepReportData(false, $"Error ocurred with instance: {Name}");<br/><br/>public void OnNext(Product value)<br/>{<br/>    var msg =<br/>        $"Reporter:{Name}. Product - Name: {value.Name}, Price:{value.Price},Desc: {value.Description}";<br/>    PrepReportData(true, msg);<br/>}</pre>
<p>The <kbd>IObserver&lt;T&gt;</kbd> interface has the <kbd>OnComplete</kbd>, <kbd>OnError</kbd>, and <kbd>OnNext</kbd> methods that we have to implement in the <kbd>ProductReporter</kbd> class. The purpose of the <kbd>OnComplete</kbd> method is to notify the subscriber that the job has been done and then flush out the code. Furthermore, <kbd>OnError</kbd> is invoked when an error occurs during execution, while <kbd>OnNext</kbd> provides information of the next element in the sequence of a stream.</p>
<p>In the following code, <kbd>PrepReportData</kbd> is a value addition that gives the user a formatted report about all the operations of the process:</p>
<pre>private void PrepReportData(bool isSuccess, string message)<br/>{<br/>    var model = new MessageViewModel<br/>    {<br/>        MsgId = Guid.NewGuid().ToString(),<br/>        IsSuccess = isSuccess,<br/>        Message = message<br/>    };<br/><br/>    Reporter.Add(model);<br/>}</pre>
<p>The preceding method is simply making additions to our <kbd>Reporter</kbd> collection, which is a collection of <kbd>MessageViewModel</kbd> classes. Note that, for simplicity purposes, you can also use the <kbd>ToString()</kbd> method that we have implemented in our <kbd>MessageViewModel</kbd> class.</p>
<p>The following code snippet shows the <kbd>Subcribe</kbd> and <kbd>Unsubscribe</kbd> methods:</p>
<pre>public virtual void Subscribe(IObservable&lt;Product&gt; provider)<br/>{<br/>    if (provider != null)<br/>        _unsubscriber = provider.Subscribe(this);<br/>}<br/><br/>private void Unsubscribe() =&gt; _unsubscriber.Dispose();</pre>
<p>The previous two methods tell the system that there is a provider. Subscribers could subscribe to the provider or unsubscribe/dispose of it upon completion of the operations.</p>
<p>Now it's time to showcase our implementation and see some good results. To do so, we need to make some changes to our existing <kbd>Product Listing</kbd> page and add a new <span class="packt_screen">View page</span> to our project.</p>
<p>Add the following link to our <kbd>Index.cshtml</kbd> page so that we can see the new link to view <span class="packt_screen">Audit Report</span>:</p>
<pre>&lt;a asp-action="Report"&gt;Audit Report&lt;/a&gt;</pre>
<p>In the preceding code snippet, we added a new link to show the <span class="packt_screen">Audit Report</span> based on our implementation of the <kbd>Report Action</kbd> method, which we have defined in our <kbd>ProductConstroller</kbd> class.</p>
<p>After adding this code, our <span class="packt_screen">Product Listin</span><span class="packt_screen">g</span> page will look as follows:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/8ef8a83f-a7a4-4df1-85cc-96b6ed21a54c.png" style=""/></div>
<p>First, let's discuss the <kbd>Report action</kbd> method. For this, consider the following code:</p>
<pre>var mango = _repositry.GetProduct(new Guid("09C2599E-652A-4807-A0F8-390A146F459B"));<br/>var apple = _repositry.GetProduct(new Guid("7AF8C5C2-FA98-42A0-B4E0-6D6A22FC3D52"));<br/>var orange = _repositry.GetProduct(new Guid("E2A8D6B3-A1F9-46DD-90BD-7F797E5C3986"));<br/>var model = new List&lt;MessageViewModel&gt;();<br/>//provider<br/>ProductRecorder productProvider = new ProductRecorder();<br/>//observer1<br/>ProductReporter productObserver1 = new ProductReporter(nameof(mango));<br/>//observer2<br/>ProductReporter productObserver2 = new ProductReporter(nameof(apple));<br/>//observer3<br/>ProductReporter productObserver3 = new ProductReporter(nameof(orange));</pre>
<p>In the preceding code, we are only taking the first three products for demonstration purposes. Please note that you can modify the code as per your own implementation. In the code, we have created a <kbd>productProvider</kbd> class and three observers to subscribe to our <kbd>productProvider</kbd> class.</p>
<p>The following diagram is a pictorial view of all the activities to showcase the <kbd>IObservable&lt;T&gt;</kbd> and <kbd>IObserver&lt;T&gt;</kbd> interfaces that we have discussed:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/846c2b3f-d4ee-49c8-b5d5-106160ff4a5f.png" style=""/></div>
<p>The following code is used to subscribe to <kbd>productrovider</kbd>:</p>
<pre>//subscribe<br/>productObserver1.Subscribe(productProvider);<br/>productObserver2.Subscribe(productProvider);<br/>productObserver3.Subscribe(productProvider);</pre>
<p>Finally, we need to log the report and then unsubscribe:</p>
<pre>//Report and Unsubscribe<br/>productProvider.Record(mango);<br/>model.AddRange(productObserver1.Reporter);<br/>productObserver1.Unsubscribe();<br/>productProvider.Record(apple);<br/>model.AddRange(productObserver2.Reporter);<br/>productObserver2.Unsubscribe();<br/>productProvider.Record(orange);<br/>model.AddRange(productObserver3.Reporter);<br/>productObserver3.Unsubscribe();</pre>
<p>Let's come back to our screen and add the <kbd>Report.cshtml</kbd> file to <span class="packt_screen">Views</span> | <span class="packt_screen">Product.</span> The following code is part of our <span class="packt_screen">Report</span> page. You can find the complete code in the <kbd>Product</kbd> folder:</p>
<pre>@model IEnumerable&lt;MessageViewModel&gt;<br/><br/>    &lt;thead&gt;<br/>    &lt;tr&gt;<br/>        &lt;th&gt;<br/>            @Html.DisplayNameFor(model =&gt; model.IsSuccess)<br/>        &lt;/th&gt;<br/>        &lt;th&gt;<br/>            @Html.DisplayNameFor(model =&gt; model.Message)<br/>        &lt;/th&gt;<br/>    &lt;/tr&gt;<br/>    &lt;/thead&gt;</pre>
<p>This code will create a header for the columns of our table that shows the audit report.</p>
<p>The following code will complete the table and add values to the <kbd>IsSuccess</kbd> and <kbd>Message</kbd> <span>columns</span><span>:</span></p>
<pre>    &lt;tbody&gt;<br/>    @foreach (var item in Model)<br/>    {<br/>        &lt;tr&gt;<br/>            &lt;td&gt;<br/>                @Html.HiddenFor(modelItem =&gt; item.MsgId)<br/>                @Html.DisplayFor(modelItem =&gt; item.IsSuccess)<br/>            &lt;/td&gt;<br/>            &lt;td&gt;<br/>                @Html.DisplayFor(modelItem =&gt; item.Message)<br/>            &lt;/td&gt;<br/><br/>        &lt;/tr&gt;<br/>    }<br/>    &lt;/tbody&gt;<br/>&lt;/table&gt;</pre>
<p>At this point, we are done with our implementation of the observer pattern using <kbd>IObservable&lt;T&gt;</kbd> and <kbd>IObserver&lt;T&gt;</kbd> interfaces. Run the project by pressing <em>F5</em> in Visual Studio, click on <span class="packt_screen">Product</span> in the home page, and then click on the <span class="packt_screen">Audit Report</span> link. From here, you will see that the audit report of our selected products, as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/078bcd2a-09a4-484c-8d76-95933be89587.png" style=""/></div>
<p>The preceding screenshot shows a simple listing page that shows the data from a <kbd>MessageViewModel</kbd> class. You can make the changes and modify them as per your requirement. In general, audit reports are coming from a lot of operational activities that we are seeing in the preceding screen. You could also save the audited data in the database and then serve this data accordingly for different purposes such as for reporting to admin and more.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Reactive extensions – .NET Rx extensions</h1>
                </header>
            
            <article>
                
<p class="mce-root">The discussion in the previous session was aimed at reactive programming and the implementation of reactive programming using the <kbd>IObservable&lt;T&gt;</kbd> and <kbd>IObserver&lt;T&gt;</kbd> interfaces as an observer pattern. In this section, we will extend our learning with the help of <strong>Rx Extensions</strong>. If you would like to find out more about the development of Rx Extensions, you should follow the official repository at <a href="https://github.com/dotnet/reactive">https://github.com/dotnet/reactive</a>.</p>
<p>Please note that Rx Extensions are now merged with the <kbd>System</kbd> namespace, and you can find everything in the <kbd>System.Reactive</kbd><span class="packt_screen"> </span><span>namespace</span><span>. If you have experience with Rx Extensions, you should know that the namespace of these extensions has been changed, as follows:</span></p>
<ul>
<li><kbd>Rx.Main</kbd> has been changed to <kbd>System.Reactive</kbd>.</li>
<li><kbd>Rx.Core</kbd> has been changed to <kbd>System.Reactive.Core</kbd>.</li>
<li><kbd>Rx.Interfaces</kbd> has been changed to <kbd>System.Reactive.Interfaces</kbd>.</li>
<li><kbd>Rx.Linq</kbd> has been changed to <kbd>System.Reactive.Linq</kbd>.</li>
<li><kbd>Rx.PlatformServices</kbd> has been changed to <kbd>System.Reactive.PlatformServices</kbd>.</li>
<li><kbd>Rx.Testing</kbd> has been changed to <kbd>Microsoft.Reactive.Testing</kbd>.</li>
</ul>
<p>To initiate Visual Studio, open the <kbd>SimplyReactive</kbd> project (discussed in the previous section) and open the <span class="packt_screen">NuGet Package Manager.</span> Click on <span class="packt_screen">Browse</span> and enter the search term <kbd>System.Reactive</kbd>. From here<span class="packt_screen">,</span> you will see the following results:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/f1de57f4-7e26-4caa-9028-33a6d4e13cd5.png"/></div>
<p>The aim of this section is to make you aware of reactive extensions but not delve into its internal development. These extensions are under the Apache2.0 license and maintained by .NET Foundation. We have already implemented reactive extensions in our <kbd>SimplyReactive</kbd> <span>application</span><span>.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Inventory application use case</h1>
                </header>
            
            <article>
                
<p>In this section, we will continue with our FlixOne inventory application. Throughout this section, we will discuss the web application pattern and extend our web application developed in <a href="4f644693-85a7-4543-af8c-109d8519b2e5.xhtml">Chapter 4</a>, <em>Implementing Design Patterns - Basics Part 2</em>.</p>
<div class="packt_infobox">This chapter continues looking at web applications that were discussed in the previous chapter. If you skipped the previous chapter (<a href="b1363fa4-f669-4670-9d40-a7e888557249.xhtml"/><a href="b1363fa4-f669-4670-9d40-a7e888557249.xhtml">Chapter 9</a>, <em>Functional Programming Practices</em>), please revisit it to get up to speed with the current chapter.</div>
<p>In this section, we will go through the process of requirement gathering and then discuss the various challenges of development and business with our web application that we developed previously.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Starting the project</h1>
                </header>
            
            <article>
                
<p class="mce-root">In <a href="232b63cb-5006-431d-8378-b7e2ba4c1119.xhtml">Chapter 7</a>, <em>Implementing Design Patterns for Web Applications - Part 2</em>, we added features to our FlixOne inventory web application. We extended the application after considering the following points:</p>
<ul>
<li>The business needs a rich UI.</li>
<li>New opportunities demand a responsive web application.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Requirements</h1>
                </header>
            
            <article>
                
<p class="mce-root">After several meetings and discussions with management, <strong>Business Analyst</strong> (<strong>BA</strong>), and presales folks, the management of the organization decided to work upon the following high-level requirements.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Business requirements</h1>
                </header>
            
            <article>
                
<p>Our business team listed the following requirements:</p>
<ul>
<li><strong>Item filtering</strong>: Currently, users are unable to filter items by category. To extend the list-view feature, the user should be able to filter the product item based on its respective category.</li>
<li><strong>Item sorting</strong>: Currently, items are appearing in the order in which they have been added to the database. There is no mechanism where a user can sort items based on the item's name, price, and so on.</li>
</ul>
<div class="packt_infobox">The FlixOne inventory management web application is an imaginary product. We are creating this application to discuss the various design patterns required/used in the web project.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting inventory with a filter, paging, and sorting</h1>
                </header>
            
            <article>
                
<p>As per our business requirements, we need to apply a filter, paging, and sorting to our FlixOne inventory application. First, let's start implementing the sorting. To do so, I've created a project and put this project in the <kbd>FlixOneWebExtended</kbd> folder. Start Visual Studio and open the FlixOne solution. We will apply to sort to our product listing sheet for these columns: <kbd>Category</kbd>, <kbd>productName</kbd>, <kbd>Description</kbd>, and <kbd>Price</kbd>. Please note that we will not be using<span> any external component for sorting, but we will create our own login.</span></p>
<p>Open the <span class="packt_screen">Solution Explorer</span>, and open <kbd>ProductController</kbd>, which is available in the <kbd>Controllers</kbd> folder. Add the <kbd>[FromQuery]Sort sort</kbd> parameter to the <kbd>Index</kbd> method. Please note that the <kbd>[FromQuery]</kbd> <span>attribute</span><span> </span><span>indicates that this parameter is a query parameter. We will use this parameter to maintain our sorting order.</span></p>
<p>The following code shows the <kbd>Sort</kbd> class:</p>
<pre>public class <strong>Sort</strong><br/>{<br/>    public <strong>SortOrder</strong> Order { get; set; } = SortOrder.A;<br/>    public string ColName { get; set; }<br/>    public <strong>ColumnType</strong> ColType { get; set; } = ColumnType.Text;<br/>}</pre>
<p>The <kbd>Sort</kbd> class contains three public properties as detailed here:</p>
<ul>
<li><kbd>Order</kbd>: Indicates the sorting order. The <kbd>SortOrder</kbd> is an enum defined as <kbd>public enum SortOrder { D, A, N }</kbd>.</li>
<li><kbd>ColName</kbd>: Indicates the column name.</li>
<li><kbd>ColType</kbd>: Indicates the type of a column; <kbd>ColumnType</kbd> is an enum defined as <kbd>public enum ColumnType { Text, Date, Number }</kbd>.</li>
</ul>
<p>Open the <kbd>IInventoryRepositry</kbd> interface, and add the <kbd>IEnumerable&lt;Product&gt; GetProducts(Sort sort)</kbd> <span>method.</span><span> This method is responsible for sorting the results. Please note that we are going to use LINQ queries to apply sorting. Implement this <kbd>InventoryRepository</kbd> class </span><span>method</span><span> </span><span>and add the following code:</span></p>
<pre>public IEnumerable&lt;Product&gt; GetProducts(Sort sort)<br/>{<br/>    if(sort.ColName == null)<br/>        sort.ColName = "";<br/>    switch (sort.ColName.ToLower())<br/>    {<br/>        case "categoryname":<br/>        {<br/>            var products = sort.Order == SortOrder.A<br/>                ? ListProducts().OrderBy(x =&gt; x.Category.Name)<br/>                : ListProducts().OrderByDescending(x =&gt; x.Category.Name);<br/>            return PDiscounts(products);<br/><br/>        }</pre>
<p>The following code is handling the case when <kbd>sort.ColName</kbd> is <kbd>productname</kbd>:</p>
<pre><br/>       case "productname":<br/>        {<br/>            var products = sort.Order == SortOrder.A<br/>                ? ListProducts().OrderBy(x =&gt; x.Name)<br/>                : ListProducts().OrderByDescending(x =&gt; x.Name);<br/>            return PDiscounts(products);<br/>        }</pre>
<p>The following code is handling the case when <kbd>sort.ColName</kbd> is <kbd>productprice</kbd>:</p>
<pre><br/>        case "productprice":<br/>        {<br/>            var products = sort.Order == SortOrder.A<br/>                ? ListProducts().OrderBy(x =&gt; x.Price)<br/>                : ListProducts().OrderByDescending(x =&gt; x.Price);<br/>            return PDiscounts(products);<br/>        }<br/>        default:<br/>            return PDiscounts(ListProducts().OrderBy(x =&gt; x.Name));<br/>    }<br/>}</pre>
<p>In the previous code, we set the value of the <kbd>sort</kbd> parameter as blank if it contains a null value, and then we process it by using <kbd>switch..case</kbd> in <kbd>sort.ColName.ToLower()</kbd>.</p>
<p>The following is our <kbd>ListProducts()</kbd> method that gives us the result of the <kbd>IIncludeIQuerable&lt;Product,Category&gt;</kbd> type:</p>
<pre>private IIncludableQueryable&lt;Product, Category&gt; ListProducts() =&gt;<br/>    _inventoryContext.Products.Include(c =&gt; c.Category);</pre>
<p>The preceding code simply gives us <kbd>Products</kbd> by including <kbd>Categories</kbd> for each product. The sorting order will come from our user, so we need to modify our <kbd>Index.cshtml</kbd> page. We also need to add an anchor tag to the header columns of the table. For this, consider the following code:</p>
<pre> &lt;thead&gt;<br/>        &lt;tr&gt;<br/>            &lt;th&gt;<br/>                @Html.ActionLink(Html.DisplayNameFor(model =&gt; model.CategoryName), "Index", new Sort { ColName = "CategoryName", ColType = ColumnType.Text, Order = SortOrder.A })<br/>            &lt;/th&gt;<br/>            &lt;th&gt;<br/>                @Html.ActionLink(Html.DisplayNameFor(model =&gt; model.ProductName), "Index", new Sort { ColName = "ProductName", ColType = ColumnType.Text, Order = SortOrder.A })<br/><br/>            &lt;/th&gt;<br/>            &lt;th&gt;<br/>                @Html.ActionLink(Html.DisplayNameFor(model =&gt; model.ProductDescription), "Index", new Sort { ColName = "ProductDescription", ColType = ColumnType.Text, Order = SortOrder.A })<br/>            &lt;/th&gt;<br/>        &lt;/tr&gt;<br/>    &lt;/thead&gt;</pre>
<p>The preceding code show the header columns of the table; <kbd>new Sort { ColName = "ProductName", ColType = ColumnType.Text, Order = SortOrder.A }</kbd> is the main way we are implementing <kbd>SorOrder</kbd>.</p>
<p>Run the application and you will see the following snapshot of the <span class="packt_screen">Product Listing</span> page with the sorting feature:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/c72b4b9f-358a-41d8-9ff6-6f5c30f075af.png" style=""/></div>
<p>Now, open the <kbd>Index.cshtml</kbd> page, and add the following code to the page:</p>
<pre>@using (Html.BeginForm())<br/>{<br/>    &lt;p&gt;<br/>        Search by: @Html.TextBox("searchTerm")<br/>        &lt;input type="submit" value="Search" class="btn-sm btn-success" /&gt;<br/>    &lt;/p&gt;<br/>}</pre>
<p>In the preceding code, we are adding a textbox under <kbd>Form</kbd>. Here, the user inputs the data/value, and this data submits to the server as soon as the user clicks the submit button. At the server side, the filtered data will returned back and show the product listing. After the implementation of the preceding code, our <span class="packt_screen">Product Listing</span> page will look like this:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/dcf4ab01-e7d0-46b5-be17-6a942f083335.png" style=""/></div>
<p>Go to the <kbd>Index</kbd> method in <kbd>ProductController</kbd> and change the parameters. Now the <kbd>Index</kbd> method looks like this:</p>
<pre>public IActionResult Index([FromQuery]Sort sort, string searchTerm)<br/>{<br/>    var products = _repositry.GetProducts(sort, searchTerm);<br/>    return View(products.ToProductvm());<br/>}</pre>
<p>Similarly, we need to update the method parameters of <kbd>GetProducts()</kbd> in <kbd>InventoryRepository</kbd> and <kbd>InventoryRepository</kbd>. The following is the code for the <kbd>InventoryRepository</kbd> <span>class:</span></p>
<pre>private IEnumerable&lt;Product&gt; ListProducts(string searchTerm = "")<br/>{<br/>    var includableQueryable = _inventoryContext.Products.Include(c =&gt; c.Category).ToList();<br/>    if (!string.IsNullOrEmpty(searchTerm))<br/>    {<br/>        includableQueryable = includableQueryable.Where(x =&gt;<br/>            x.Name.Contains(searchTerm) || x.Description.Contains(searchTerm) ||<br/>            x.Category.Name.Contains(searchTerm)).ToList();<br/>    }<br/><br/>    return includableQueryable;<br/>}</pre>
<p>Now run the project by pressing <em>F5</em> from Visual Studio and navigating to the filter/search option in <span class="packt_screen">Product Listing</span>. For this, see this snapshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/802ed721-1eb2-4afc-8b51-3be146702b5b.png" style=""/></div>
<p>After entering your search term, click on the <span class="packt_screen">Search</span> button, and this will give you the results, as shown in the following snapshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/a6f32b34-7662-4b1d-be5f-6d5a7c0c1bec.png" style=""/></div>
<p>In the preceding <span class="packt_screen">Product Listing</span> screenshot, we are filtering our <span class="packt_screen">Product</span> records with <kbd>searchTerm</kbd> <kbd>mango</kbd>, and it produces single results, as shown in the previous snapshot. There is one issue in this approach for searching data: add <kbd>fruit</kbd> as a search term, and see what will happen. It will produce zero results. This is demonstrated in the following snapshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/06ac51ab-3dfb-47e7-9e2a-8aeea1d0f932.png" style=""/></div>
<p>We do not get any result, which means our search is not working when we are putting <kbd>searchTerm</kbd> in lowercase. This means our search is case-sensitive. We need to change our code to get it started.</p>
<p>Here is our modified code:</p>
<pre>var includableQueryable = _inventoryContext.Products.Include(c =&gt; c.Category).ToList();<br/>if (!string.IsNullOrEmpty(searchTerm))<br/>{<br/>    includableQueryable = includableQueryable.Where(x =&gt;<br/>        x.Name.Contains(searchTerm, StringComparison.InvariantCultureIgnoreCase) ||<br/>        x.Description.Contains(searchTerm, StringComparison.InvariantCultureIgnoreCase) ||<br/>        x.Category.Name.Contains(searchTerm, StringComparison.InvariantCultureIgnoreCase)).ToList();<br/>}</pre>
<p>We are ignoring the case to make our search case-insensitive. We used <kbd>StringComparison.InvariantCultureIgnoreCase</kbd> and ignored the case. Now our search will work with either capital or lowercase letters. The following is the snapshot that produces results using lowercase <kbd>fruit</kbd>:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/80ddb52c-00e6-4041-b490-377f78e502a6.png" style=""/></div>
<p>In a previous discussion during the FlixOne app extension, we applied <kbd>Sort</kbd> and <kbd>Filter</kbd>; now we need to add <kbd>paging</kbd>. To do so, we have added a new class named, <kbd>PagedList</kbd> as follows:</p>
<pre>public class PagedList&lt;T&gt; : List&lt;T&gt;<br/>{<br/>    public PagedList(List&lt;T&gt; list, int totalRecords, int currentPage, int recordPerPage)<br/>    {<br/>        CurrentPage = currentPage;<br/>        TotalPages = (int) Math.Ceiling(totalRecords / (double) recordPerPage);<br/><br/>        AddRange(list);<br/>    }<br/>}</pre>
<p>Now, change the parameters of the <kbd>Index</kbd> method of <kbd>ProductController</kbd> as follows:</p>
<pre>public IActionResult Index([FromQuery] Sort sort, string searchTerm, <br/>    string currentSearchTerm,<br/>    int? pagenumber,<br/>    int? pagesize)</pre>
<p>Add the following code to the <kbd>Index.cshtml</kbd> page:</p>
<pre>@{<br/>    var prevDisabled = !Model.HasPreviousPage ? "disabled" : "";<br/>    var nextDisabled = !Model.HasNextPage ? "disabled" : "";<br/>}<br/><br/>&lt;a asp-action="Index"<br/>   asp-route-sortOrder="@ViewData["CurrentSort"]"<br/>   asp-route-pageNumber="@(Model.CurrentPage - 1)"<br/>   asp-route-currentFilter="@ViewData["currentSearchTerm"]"<br/>   class="btn btn-sm btn-success @prevDisabled"&gt;<br/>    Previous<br/>&lt;/a&gt;<br/>&lt;a asp-action="Index"<br/>   asp-route-sortOrder="@ViewData["CurrentSort"]"<br/>   asp-route-pageNumber="@(Model.CurrentPage + 1)"<br/>   asp-route-currentFilter="@ViewData["currentSearchTerm"]"<br/>   class="btn btn-sm btn-success @nextDisabled"&gt;<br/>    Next<br/>&lt;/a&gt;</pre>
<p>The preceding code makes it possible to move our screen to the next or the previous page. Our final screen will look like this:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/d2e1909c-873b-4285-b592-2c69ed0d6667.png" style=""/></div>
<p>In this section, we have discussed and extended the features of our FlixOne application by implementing <kbd>Sorting</kbd>, <kbd>Paging</kbd>, and <kbd>Filter</kbd>. The aim of this section was to give you hands-on experience with a working application. We have coded our application in such a way that it will directly meet real-world applications. With the preceding enhancement, our application is <span>now</span><span> </span><span>capable of giving a product listing that can be sorted, paginated, and filtered.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Patterns and Practices – MVVM</h1>
                </header>
            
            <article>
                
<p>In <a href="8e089021-1efb-4b88-8bf2-e26f69f883b9.xhtml">Chapter 6</a>, <em>Implementing Design Patterns for Web Applications - Part 1</em>, we discussed the <strong><span>MVC</span></strong> pattern and created an application based on this. </p>
<p>Ken Cooper and Ted Peters are the names behind the invention of the MVVM pattern. At the time of this invention, both Ken and Ted were architects at the Microsoft Corporation. They made this pattern to simplify the UI of event-driven programming. Later on, it was implemented in <strong>Windows Presentation Foundation</strong> (<strong>WPF</strong>) and <strong>Silverlight</strong>.</p>
<div class="packt_infobox">The MVVM pattern was announced in 2005 by John Gossman. John has blogged about this pattern in context with building WPF applications. The link for this is at <a href="https://blogs.msdn.microsoft.com/johngossman/2005/10/08/introduction-to-modelviewviewmodel-pattern-for-building-wpf-apps/">https://blogs.msdn.microsoft.com/johngossman/2005/10/08/introduction-to-modelviewviewmodel-pattern-for-building-wpf-apps/</a>.<a href="https://blogs.msdn.microsoft.com/johngossman/2005/10/08/introduction-to-modelviewviewmodel-pattern-for-building-wpf-apps/"/></div>
<p>MVVM is considered to be one of the variations of MVC to meet the modern <span><strong>User Interface</strong> (</span><strong>UI</strong>) development approach, where UI development is the core responsibility of designer/UI-developers rather than application developers. In this approach of development, a designer who is a graphical enthusiast and is focused on making a UI more attractive may or may not bother about the development part of the application. Generally, designers (UI persons) use various tools to make the <span><span>UI</span></span> more attractive. The UI can be made with a simple HTML, CSS, and so on, using rich controls of WPF or Silverlight.</p>
<div class="packt_infobox"><strong>Microsoft Silverlight</strong> is a framework that helps to develop applications with a rich UI. Many developers refer to it as an alternative of Flash by Adobe. In July 2015, Microsoft announced that it was no longer supporting Silverlight. Microsoft announced the support of WPF in .NET Core 3.0 during its build (<a href="https://developer.microsoft.com/en-us/events/build">https://developer.microsoft.com/en-us/events/build</a>). There is also a blog with more insight into the plan to support WPF found here: <a href="https://devblogs.microsoft.com/dotnet/net-core-3-and-support-for-windows-desktop-applications/">https://devblogs.microsoft.com/dotnet/net-core-3-and-support-for-windows-desktop-applications/</a>.</div>
<p>The MVVM pattern can be elaborated with its various components as follows:</p>
<ul>
<li><strong>Model</strong>: Holds data and does not care about any business logic in the application. I prefer to refer to this as a domain object because it holds the actual data of the application we are working with. In other words, we can say that a model is not responsible for making the data beautiful. For example, in a product model of our FlixOne application, a product model holds the value of various properties, and these describe a product by its name, description, category name, price, and more. These properties contain the actual data of the product, but the model is not responsible for making behavioral changes to any of the data. For example, it's not the responsibility of our product mode to format the product description to look perfect on the UI. On the other hand, many of our models contain validations and other computed properties. The main challenge is to maintain the pure and cleaned model, which means that the model should resemble the real-world model. In our case, our <kbd>product</kbd> model is called a <strong>clean model</strong>. A clean model is one that resembles the actual properties of real products. For example, if the <kbd>Product</kbd> model is storing the data of fruits, then it should show properties such as the color of fruits and so on. The following code is from a model of our imaginary application:</li>
</ul>
<pre style="padding-left: 60px">export class <strong>Product</strong> {<br/>  name: string;<br/>  cat: string; <br/>  desc: string;<br/>}</pre>
<p style="padding-left: 60px">Note that the preceding code is written in Angular. We will discuss Angular code in detail in the upcoming section, <em>Implementing MVVM</em>.</p>
<ul>
<li><strong>View</strong>: This is a data representation for the end user to access via the UI. This simply displays the value of the data, and this value may or may not be formatted. For example, we can show the discount rate as 18% on the UI, while it would be stored as 18.00 in the model. The view can also responsible for behavioral changes. The view accepts user inputs; for example, there would be a view that provides a form/screen to add a new product. Also, the view can manage the user input such as the key pressed, detecting a keyword, and more. It could also be an active view or a passive view. The view that accepts the user input and manipulates the data model (properties) according to the user input is an active view. A passive view is one that does nothing. In other words, a view that is not associated with the model is a passive view, and this kind of view is manipulated by a controller.</li>
</ul>
<ul>
<li><strong>ViewModel</strong>: This works as a middleman between View and Model. Its responsibility is to make the presentation better. In our previous example, where View shows the discount rate as 18% but Model has a discount rate of 18.00, it is the responsibility of View Model to format 18.00 to 18% so that View can display the formatted discount rate.</li>
</ul>
<p>If we combine all the points discussed, we can visualize the entire MVVM pattern, which would look like the following diagram:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/61f3a6af-ade5-4d96-88d1-4d959db0bc1c.png" style=""/></div>
<p>The preceding diagram is a pictorial view of MVVM, and it shows us that <strong>View Model</strong> separates <strong>View</strong> and <strong>Model</strong>. <strong>ViewModel</strong> also maintains the <kbd>state</kbd> and <kbd>perform</kbd> operations. This helps <strong>View</strong> to present the final output to the end user. The view is UI, which gets data and presents it to the end user. In the next section, we will implement the MVVM pattern using Angular.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Implementation of MVVM</h1>
                </header>
            
            <article>
                
<p>In the previous section, we understood what the MVVM pattern <span>is</span><span> </span><span>and how it works. In this section, we will use our FlixOne application and build an application using Angular. To demonstrate the MVVM pattern, we will use the API built on ASP.NET Core 2.2.</span></p>
<p>Start <span class="packt_screen">Visual Studio</span> and open <span class="packt_screen">FlixOne Solution</span> from the <kbd>FlixOneMVVM</kbd> folder. Run the <kbd>FlixOne.API</kbd> <span>project </span>where you will see the following <span class="packt_screen">Swagger</span> documentation page:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/9cc95489-4408-41f9-81a0-393b2ae85317.png" style=""/></div>
<p>The preceding screenshot is the snapshot of our <span class="packt_screen">Product APIs</span> documentation, where we have incorporated <span class="packt_screen">Swagger</span> for the API documentation. If you want to, you can test the API from this screen. If the APIs are returning results, then your project is successfully set up. If not, please check the prerequisites for this project, and also check the <kbd>README.md</kbd> file from the Git repository for this chapter. We have everything that is required to build a new UI; as discussed previously, we will create an Angular application that will consume our Product APIs. To get started, follow these steps:</p>
<ol>
<li>Open the <span class="packt_screen">Solution Explorer</span>.</li>
<li>Right-click on <span class="packt_screen">FlixOne</span><span class="packt_screen"> Solution</span>. </li>
<li>Click on <span class="packt_screen">Add New Project</span>.</li>
</ol>
<ol start="4">
<li>From the <span class="packt_screen">Add New Project</span> window, select <span class="packt_screen">ASP.NET Core Web Application</span>. Call it <span class="packt_screen">FlixOne.Web</span> and click <span class="packt_screen">OK</span>. After doing so, refer to this screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/e9f81475-6de0-46c7-bfe0-fb72a917416f.png" style=""/></div>
<ol start="5">
<li>From the next window, select <span class="packt_screen">Angular</span>, make sure you have selected <span class="packt_screen">ASP.NET Core 2.2</span>, click <span class="packt_screen">OK</span>, and refer to this screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/798ace74-dc36-45d9-aebd-c958464837c1.png" style=""/></div>
<ol start="6">
<li>Open <span class="packt_screen">Solution Explorer</span> and you will find the new <kbd>FlixOne.Web</kbd> project and folder hierarchy, which looks like this:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/afcc2e76-f48c-4abf-910f-9e7382731283.png" style=""/></div>
<ol start="7">
<li>From the <span class="packt_screen">Solution Explorer</span>, right-click on the <span class="packt_screen">FlixOne.Web</span> project, and click on the <span class="packt_screen">Set as</span> <span class="packt_screen">Startup</span> project, and then refer to the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/a4bac5f7-1e4f-447a-bd53-ee09dcf3a150.png" style=""/></div>
<ol start="8">
<li>Run the <kbd>FlixOne.Web</kbd> project and see the output, which will look like the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/f4643910-9a24-4f31-9102-f27f812cacf8.png"/></div>
<p>We have set up our Angular app successfully. Go back to your <span class="packt_screen">Visual Studio</span> and open the <span class="packt_screen">Output</span> window. Refer to the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/5f215bcf-3786-4f4d-95aa-1737550c1192.png"/></div>
<p>You will find <kbd>ng serve "--port" "60672"</kbd> from the <span class="packt_screen">Output</span> window; this is a command that tells the Angular app to listen and serve. Open the <kbd>package.json</kbd> file from <kbd>Solution Explorer</kbd>; this file belongs to the <kbd>ClientApp</kbd> <span>folder.</span> You will notice <kbd>"@angular/core": "6.1.10"</kbd>, which means our application is built on <kbd>angular6</kbd>.</p>
<p>The following is the code of our <kbd>product.component.html</kbd> (this is a view):</p>
<pre>&lt;table class='table table-striped' *ngIf="forecasts"&gt;<br/>  &lt;thead&gt;<br/>    &lt;tr&gt;<br/>      &lt;th&gt;Name&lt;/th&gt;<br/>      &lt;th&gt;Cat. Name (C)&lt;/th&gt;<br/>      &lt;th&gt;Price(F)&lt;/th&gt;<br/>      &lt;th&gt;Desc&lt;/th&gt;<br/>    &lt;/tr&gt;<br/>  &lt;/thead&gt;<br/>  &lt;tbody&gt;<br/>    &lt;tr *ngFor="let forecast of forecasts"&gt;<br/>      &lt;td&gt;{{ forecast.productName }}&lt;/td&gt;<br/>      &lt;td&gt;{{ forecast.categoryName }}&lt;/td&gt;<br/>      &lt;td&gt;{{ forecast.productPrice }}&lt;/td&gt;<br/>      &lt;td&gt;{{ forecast.productDescription }}&lt;/td&gt;<br/>    &lt;/tr&gt;<br/>  &lt;/tbody&gt;<br/>&lt;/table&gt;</pre>
<p>Run the application from Visual Studio, and click on <span class="packt_screen">Product</span>, where you will get a <span class="packt_screen">Product Listing</span> screen similar to this:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/d2388694-3340-4811-bf69-d26781422dfa.png" style=""/></div>
<p>In this section, we have created a small demo application in Angular.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>The aim of this chapter was to get you through the reactive programming by discussing its principles and the reactive programming model. Reactive is all about the data stream, which we have discussed with examples. We extended our example from <a href="ac0ad344-5cd2-4c11-bcfe-cf55b9c4ce3c.xhtml">Chapter 8</a>, <span class="cdp-organizer-chapter-title"><span class="cdp-organize-title-label"><em>Concurrent Programming in .NET Core</em></span></span>, where we discussed the use case of the ticket collection counter at a conference.</p>
<p>We explored the reactive system during our discussion of the reactive manifesto. We discussed the reactive system through the help of showcasing the <kbd>merge</kbd>, <kbd>filter</kbd>, and <kbd>map</kbd> operations, and how streams work with the help of examples. Also, we discussed the <kbd>IObservable</kbd> interface and the Rx extensions, using examples.</p>
<p>We carried forward our <kbd>FlixOne</kbd> inventory application and discussed the use cases to implement the paging and the sorting of inventory data for products. Finally, we discussed the MVVM pattern and created a small application on a MVVM architecture.</p>
<p>In the next chapter (<a href="1dd82c08-3988-4c19-aa44-4bc2fd3277a9.xhtml">Chapter 11</a>, <em>Advanced Database Design and Application Techniques</em>), advanced database and application techniques will be explored, including applying <strong>Command Query Responsibility Segregation</strong> (<strong>CQRS</strong>) and a ledger-style database.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<p class="mce-root"><span>The following questions will allow you to consolidate the information contained in this chapter:</span></p>
<ol>
<li>What is a stream?</li>
<li>What are reactive properties?</li>
<li>What is a reactive system?</li>
<li>What is meant by merging two reactive streams?</li>
<li>What is the MVVM pattern?</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<p>To learn more about the topics covered in this chapter, refer to the following book. This book will provide you with various in-depth and hands-on exercises for reactive programming:</p>
<ul>
<li><em>Reactive Programming for .NET Developer</em>s, <em>Antonio Esposito</em> and <em>Michael Ciceri</em>, Packt Publishing: <a href="https://www.packtpub.com/web-development/reactive-programming-net-developers">https://www.packtpub.com/web-development/reactive-programming-net-developers</a></li>
</ul>
<p><span> </span></p>


            </article>

            
        </section>
    </body></html>