<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Consulting</h1></div></div></div><p>In this chapter, we will learn how Microsoft Dynamics NAV fits a consultancy company. Most consultancy companies have project-related processes. They take on larger projects that take a certain time to complete. Some consultancy companies also purchase and sell items.</p><p>For the projects, the consultancy company needs to keep track of used resources and items. Sometimes they can invoice the resource hours they spend one-on-one but most of the time they will also take a risk in doing fixed price projects. In this case, it is even more important to know if the project was budgeted well and ensure money is not lost on the way.</p><p>There are many types of companies working this way. Examples are accountancy firms and lawyers, but also many companies in the construction business work like this.</p><p>For this chapter, we will use an example, a company we are all very familiar with, either because of working as an employee, a customer, or maybe even an owner. We will look at the business process of a Microsoft Dynamics NAV Partner.</p><p>The partner in our case sells Microsoft Dynamics NAV licenses for new projects. They also help existing customers in upgrades and support. Lastly, they are selling infrastructure solutions, assembling servers, and desktop systems in house.</p><p>We will discuss four different project scenarios and see how Microsoft Dynamics NAV can be used to support those. To do this, we will create some modifications along the way. The objects required for this chapter can be downloaded from <code class="literal">http://ftp.packtpub.com/chapter8.fob</code>. After reading this chapter, you will have a good understanding of the possibilities and limitations of the Job Module in Microsoft Dynamics NAV, how it fits in with the rest of the product, and how it can be expanded safely.</p><div><div><div><div><h1 class="title"><a id="ch08lvl1sec57"/>The process</h1></div></div></div><p>The<a class="indexterm" id="id1065"/> two main <a class="indexterm" id="id1066"/>processes for Microsoft Dynamics NAV partners are implementing new projects and providing services such as supporting and upgrading to existing customers. A third process is selling infrastructure and assembling computer systems but this is an extra service, not the core business.</p><p>To support the projects (jobs), the company needs people, software licenses, and hardware. The people (resources) need to be carefully planned on the projects as they are the least flexible part of the company. Hardware (items) and software licenses (G/L Accounts) will be purchased from vendors like Microsoft. </p><p>The projects can be divided into large and small projects. The larger projects are new implementations and upgrades. Smaller projects are usually implementing small features and helping users with regular support issues.</p><p>Invoicing can be done in various ways. New implementations and small projects can be invoiced per billable hour while upgrades are sold at a fixed price. For hardware, we will use items. Licenses are invoiced directly to the general ledger.</p><p>Large projects also have budgets and planning that needs to be maintained. If the budget is fully used and the planning milestones have not been reached, there should be a new budget created in order to complete the project.</p><p>To support this process, we will use the Jobs functionality<a class="indexterm" id="id1067"/> with some customizations. Projects are called Jobs in Microsoft Dynamics NAV so we will use that term from now on.</p><div><div><h3 class="title"><a id="note50"/>Note</h3><p>The Jobs module has been completely redesigned by Microsoft for Version 5. In this chapter, we will use a lot of the new functionality where we would have done customizations in the older versions of Microsoft Dynamics NAV.</p></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec163"/>Fits</h2></div></div></div><p>The<a class="indexterm" id="id1068"/> registration of the <a class="indexterm" id="id1069"/>Jobs module can be done using the standard functionality of Microsoft Dynamics NAV as well as the budgeting and planning.</p><p>The standard software also allows us to invoice Jobs both fixed price and on time and materials. We can also purchase items for our Jobs. In Microsoft Dynamics NAV 2013, a timesheet module has been added to the application, which we will use and explain in this chapter.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec164"/>Gaps</h2></div></div></div><p>The<a class="indexterm" id="id1070"/> Jobs module<a class="indexterm" id="id1071"/> in Microsoft Dynamics NAV is often referenced as a framework that almost always needs some changes. Fortunately, it is designed to be easily changed and we will do so to support our processes.</p><div><div><div><div><h3 class="title"><a id="ch08lvl3sec172"/>Resource groups</h3></div></div></div><p>Although<a class="indexterm" id="id1072"/> many companies work this way, budgeting for resource groups is not possible. We will create a solution for that. We will also make it possible to see the total number of planned, used, and invoiced hours.</p></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec173"/>Item calculation</h3></div></div></div><p>We will <a class="indexterm" id="id1073"/>create a solution calculating the system assembling. As hardware specifications are changing very rapidly, we do not want to create a new item for each system we may only sell once or twice.</p></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec174"/>Issue registration</h3></div></div></div><p>Our<a class="indexterm" id="id1074"/> support team needs a single point for registration of all support issues for all customers and to follow up their workflow. For this, we will also create functionality to register and followup issues.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec58"/>Getting started</h1></div></div></div><p>Before we start creating any new jobs, we should have a look at the following data and posting model<a class="indexterm" id="id1075"/> of the Microsoft Dynamics NAV Jobs module:</p><div><img alt="Getting started" src="img/0365EN_08_01.jpg"/></div><p>The starting point is <a class="indexterm" id="id1076"/>the job table that has <strong>Job Tasks</strong>
<a class="indexterm" id="id1077"/> and <strong>Job Planning Lines</strong>
<a class="indexterm" id="id1078"/> that we can use for budgeting and planning. Each job can have its own prices. </p><p>The <strong>Job Planning Lines</strong> get invoiced through the standard Microsoft Dynamics NAV Sales functionality, which then creates<a class="indexterm" id="id1079"/> <strong>Job Ledger Entries</strong>.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec165"/>How many jobs</h2></div></div></div><p>The first step is<a class="indexterm" id="id1080"/> setting up a new job. There can be different angles on setting up jobs. This depends on how we want to work with the system. The minimum requirement is to have at least one job per bill to customer. This enables us to do the invoicing. Some companies use jobs this way to use it as a pre-invoice engine.</p><p>Another angle can be to set up new jobs nicely for each project that we do for the customer. In our case, this starts with the basic Dynamics NAV implementation. When this is finished, we close the job. If the customer has any new requirements, we need to start a new job. This way we can keep better track of what issues we have outstanding with each customer. The downside of this methodology is that it requires some work to set up a new job every time.</p><p>Most companies end up with a solution in the middle. It is common to set up a new job for larger jobs and to have a job for support issues. This also allows us to set up different invoicing strategies for each job. We will use this strategy.</p><div><div><div><div><h3 class="title"><a id="ch08lvl3sec175"/>Job Card</h3></div></div></div><p>Let's have a look at the<a class="indexterm" id="id1081"/> <strong>Job Card</strong>
<a class="indexterm" id="id1082"/> and the important fields there:</p><div><img alt="Job Card" src="img/0365EN_08_02.jpg"/></div><p>Let's see these fields<a class="indexterm" id="id1083"/> in more detail:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>No.</strong>: This is the unique number of a job. We can use different Number Series strategies for this, from simple sequential numbering to linked Number Series for different job types or manual numbering.</li><li class="listitem" style="list-style-type: disc"><strong>Description</strong>: This field should contain a logical description of the job for internal use. Most people will search in this field so make sure to have certain rules for naming. This will make searching for old jobs easier in the future.</li><li class="listitem" style="list-style-type: disc"><strong>Bill-to Customer No.</strong>: Each job has one bill-to customer. If we want to invoice multiple customers for one job, we need to customize the application.</li><li class="listitem" style="list-style-type: disc"><strong>Search Description</strong>: By default, this will be populated with the value of the description field but can be changed to another value if required.</li><li class="listitem" style="list-style-type: disc"><strong>Person Responsible</strong>: This <a class="indexterm" id="id1084"/>is an informative field indicating who is responsible for this job.</li><li class="listitem" style="list-style-type: disc"><strong>Blocked</strong>: If this field is checked, it is not possible to make new entries for this job. We use this for closed jobs.</li><li class="listitem" style="list-style-type: disc"><strong>Job Posting Group</strong>: This refers to the G/L Accounts that are used for the <strong>Work In Progress</strong> (<strong>WIP</strong>) postings. There can be different G/L Accounts for different types of Jobs or WIP methods.</li><li class="listitem" style="list-style-type: disc"><strong>WIP Method</strong>: Each job can have one WIP method. We will discuss this briefly later in this chapter.</li><li class="listitem" style="list-style-type: disc"><strong>Status</strong>: The jobs have a limited set of status fields. The only available status values are <strong>Planning</strong>, <strong>Quote</strong>, <strong>Order</strong>, and <strong>Completed</strong>.<div><div><h3 class="title"><a id="tip46"/>Tip</h3><p>Most companies want to have more sub statuses for the order phase. The best approach for this is to add a new status field that maps with the standard status field. This requires minimum changes to the application while creating new workflow possibilities.</p></div></div></li><li class="listitem" style="list-style-type: disc"><strong>Allow Schedule/Contract Lines</strong>: If this field is not checked, it is not possible to create planning lines that have the options <strong>Both Schedule</strong> and <strong>Contract</strong>. When planning lines are created they will be split into a schedule and a contract line.</li><li class="listitem" style="list-style-type: disc"><strong>Starting</strong> <strong>Date </strong>and <strong>Ending Date</strong>: These are informative fields that are only used to calculate the currency exchange rates for the job.</li><li class="listitem" style="list-style-type: disc"><strong>Foreign Trade</strong>: In the Jobs module, it is possible to send calculate and create invoices in another currency than the local currency. This will multiply the complexity of the implementation and should be used carefully.</li></ul></div></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec166"/>Job task and planning lines</h2></div></div></div><p>When the <a class="indexterm" id="id1085"/>job is created, the next step is to create Job Tasks and Planning Lines. These can be used in different ways.</p><p>Using <a class="indexterm" id="id1086"/>Job Task lines, we can divide the job into smaller pieces, which we can then schedule and invoice. The more detailed the Job Tasks, the better we can measure the progress of the job. But the amount of work required to maintain them would also be more. Balance is a keyword for success here.</p><div><img alt="Job task and planning lines" src="img/0365EN_08_03.jpg"/><div><p>Creating Job Tasks and Planning Lines</p></div></div><p>The Job Tasks can be created with the same structure as the Chart of Accounts, meaning the actual Task Lines can be grouped using Begin and End Total lines. Each level can be indented for better readability.</p><p>The <a class="indexterm" id="id1087"/>Job Planning Lines<a class="indexterm" id="id1088"/> are the detail lines of each Job Task. This defines what we will do and how this will be invoiced. A Job Planning Line can be linked to the master data types Resource, Item, G/L Account, or Text.</p><div><div><h3 class="title"><a id="tip47"/>Tip</h3><p>Job Tasks and Job Planning Lines can be copied very easily from other jobs. This allows us to reuse them and even create template jobs for frequently used combinations.</p></div></div><p>The Line Type<a class="indexterm" id="id1089"/> in the Job Planning Line defines how it will be invoiced. There are three types:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Schedule</strong>: The amounts<a class="indexterm" id="id1090"/> on this line will only be used for budgeting purposes. When invoicing, we need to post one or more job journal lines that will be invoiced or we can create another Job Planning Line with the invoice amount. Schedule lines should be used when billing for time and materials.</li><li class="listitem" style="list-style-type: disc"><strong>Contract</strong>: This <a class="indexterm" id="id1091"/>line will be invoiced with the exact amounts. However, the amounts do not show up in the budget. This can be used when invoicing fixed price jobs in a schedule, for example, 50 percent when signing the contract and 50 percent on job completion.</li><li class="listitem" style="list-style-type: disc"><strong>Both Schedule and Contract</strong>: This <a class="indexterm" id="id1092"/>line will be invoiced in exactly the same way as the contract lines but the amount will also show up in the budget.</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec167"/>Job journal</h2></div></div></div><p>When the Job Tasks and Job Planning Lines are set up, we can start the job. During the job, we will consume resources and items from our company. This should be registered using the Job journal. The <strong>Job Journal</strong> is the lowest level of the Journal Posting diagram we drafted in <a class="link" href="ch01.html" title="Chapter 1. Introduction to Microsoft Dynamics NAV">Chapter 1</a>, <em>Introduction to Microsoft Dynamics NAV</em>, and uses the other journals to create the resource, item, and general ledger entries.</p><p>When<a class="indexterm" id="id1093"/> creating a <a class="indexterm" id="id1094"/>Job Journal Line, the following few fields are particularly important for the process:</p><div><img alt="Job journal" src="img/0365EN_08_04.jpg"/></div><p>Let's have a look at the fields<a class="indexterm" id="id1095"/> in more detail:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Line Type</strong>: This has the same options as the <strong>Job Planning Line</strong>, <strong>Schedule, Contract</strong>, and <strong>Both Schedule and Contract</strong>. When the job journal line should be invoiced, the type should be <strong>Contract</strong>. When the job journal line is part of a fixed price, the Line Type should be left blank. Then the Line Type is <strong>Schedule</strong>, the system will create additional Job Planning Lines of this type, which may corrupt our budget for the customer since they are already created.</li><li class="listitem" style="list-style-type: disc"><strong>Unit Cost and Unit Price</strong>: These fields will determine the cost of the job and price that <a class="indexterm" id="id1096"/>will <a class="indexterm" id="id1097"/>be invoiced to the customer if the Line Type is <strong>Contract</strong>. This information is also used in the calculation of the work in progress.</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec168"/>Job examples</h2></div></div></div><p>Let's go through <a class="indexterm" id="id1098"/>some different job scenarios to see how we can use this functionality.</p><div><div><div><div><h3 class="title"><a id="ch08lvl3sec176"/>Chapter objects</h3></div></div></div><p>The chapter objects<a class="indexterm" id="id1099"/> contain both the changes that we will discuss in this chapter as well as the example jobs we will use. After importing <code class="literal">chapter8.fob</code> as described in <a class="link" href="apa.html" title="Appendix A. Installation Guide">Appendix</a>, <em>Installation Guide</em>, run page 123.456.700 <strong>Jobs Add-on Setup</strong> and run <strong>Initialise Application</strong>.</p><div><img alt="Chapter objects" src="img/0365EN_08_05.jpg"/></div><p>When this completes, restart the Role Tailored Client. You should now see the Project Manager Role Center.</p></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec177"/>The new implementation</h3></div></div></div><p>Implementing Microsoft Dynamics NAV 2013 is not an easy task and many things need to be taken care of before we can use the product. We will implement Microsoft Dynamics NAV<a class="indexterm" id="id1100"/> for Packt Publishing. The Job for this example is <code class="literal">EXAMPLE1</code>.</p><p>For the implementation, we will create various Job Task groups. Each part of the implementation gets a code. As the sorting is done on this field, we will create code using numbers and a logical name, for example, <code class="literal">0200. SETUP</code> and <code class="literal">0210. FIN</code>.</p><div><div><h3 class="title"><a id="tip48"/>Tip</h3><p>Leave enough space in the numbers to add additional lines if required. This will avoid renaming, which is an expensive task for the database engine and users will have to wait until it is completed.</p></div></div><p>Our consultants <a class="indexterm" id="id1101"/>will help the customer to install the system, help with the setup, and convert the data from the old system. When this is done we will help them with testing and train them using Microsoft Dynamics NAV. The consultants will be set up in the system as Resources, which are in turn entered into the Job Planning Lines.</p><p>When everything is working as expected, we can schedule a go-live weekend and help them in the first period using the system.</p><div><img alt="The new implementation" src="img/0365EN_08_06.jpg"/></div><p>Invoicing a job like this is done using a budget. We will make a precalculation of the number of hours <a class="indexterm" id="id1102"/>we think are necessary and start with that. During the job we need to measure the used budget and compare it with the progress.</p><div><div><div><div><h4 class="title"><a id="ch08lvl4sec26"/>Budgeting</h4></div></div></div><p>The <a class="indexterm" id="id1103"/>budget is created using the Job Planning Lines. During this phase of the job, we do not yet know which resource will be used for the Job Tasks and it might even be done by more than one resource. This is why we want to use Resource Groups in our budget.</p><div><div><h3 class="title"><a id="note51"/>Note</h3><p>This is not possible in the standard application so we have created a modification, which we will discuss at the end of this chapter.</p></div></div><div><img alt="Budgeting" src="img/0365EN_08_07.jpg"/></div><p>The <strong>Line Type</strong> of these Job Planning Lines is <strong>Schedule</strong>. This means that these lines are just for budgeting and schedule purposes. The system will invoice the actual consumption posted in the Job Journal.</p></div></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec178"/>The infrastructure</h3></div></div></div><p>To use<a class="indexterm" id="id1104"/> Microsoft Dynamics NAV 2013, Packt Publishing needs a new infrastructure. Their current systems do not meet the requirements for Microsoft Dynamics NAV 2013.</p><p>For this job, we could create new Job Task Lines in the implementation job, but for a clearer overview, we will create a new job, <code class="literal">EXAMPLE2</code>.</p><p>Our company builds and sells its own computer systems. We can build both servers and desktop systems. As none of the systems are exactly the same and available components switch regularly, we <a class="indexterm" id="id1105"/>do not want to create an item and a bill of materials for each system. Instead we use a calculation system, which we add as a customization to Dynamics NAV that allows us to determine a price for a system. For other products like switches, routers, printers, and laptops, we use items that we purchase from vendors.</p><p>The Job Tasks and Job Planning Lines for this job look like this:</p><div><img alt="The infrastructure" src="img/0365EN_08_08.jpg"/><div><p>Job Tasks and Job Planning Lines</p></div></div><p>The installation costs in this job are <strong>Resource Groups</strong> with Line Type Schedule, just as in the previous job, so we invoice actual hours spent on the Job.</p><p>The other lines are of type <strong>Both Schedule and Contract</strong>. This means we will invoice exactly what is in the budget. The Job Journal Lines for these tasks should be posted with a blank Line Type.</p></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec179"/>The upgrade</h3></div></div></div><p>Our <a class="indexterm" id="id1106"/>customer requests an upgrade from Navision Version 3.70 to Microsoft Dynamics NAV 2013. We can do this for a fixed price but we require a fee to analyze the system.</p><p>For the <code class="literal">EXAMPLE3</code> job, we can start with a limited number of Job Task Lines, just for the quote. When the customer agrees to do the upgrade, we can add new Job Task Lines.</p><p>Both the quote <a class="indexterm" id="id1107"/>and the upgrade are a fixed price and posted directly to the general ledger. This does not mean we cannot have our resources register the actual hours using the Job Journal but the <strong>Line Type</strong> should be blank.</p><p>Another part of the upgrade is not done at a fixed price. The system needs a redesign, a conversion to SQL Server 2014, and the customer wants additional training and support.</p><div><img alt="The upgrade" src="img/0365EN_08_09.jpg"/><div><p>Upgrading for re-design</p></div></div><p>The fixed price part of the upgrade is invoiced in three phases. When the job starts, we invoice 50 percent, and when we deliver the test system, we invoice 40 percent, and finally 10 percent is invoiced three months after go-live.</p><p>This is done using lines of <strong>Both Schedule and Contract</strong> Line Type.</p></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec180"/>The support team</h3></div></div></div><p>For <a class="indexterm" id="id1108"/>the support team, our policy is to create one job per fiscal year per customer. We will use this job, <code class="literal">EXAMPLE4</code>, to invoice the maintenance of the license and all support issues.</p><p>The support issues can be both little questions customers call us for, like changing a report or a page, or implementing new features that requires only a few days' work.</p><p>Each issue and new feature will be created as a Job Task Line. The new features will be created by the account manager who sells the feature. We can then decide if the invoicing is done at a fixed price, using contract lines, or on time and materials using schedule lines.</p><p>Our support team also needs to use the job system, but we do not want them to manually create a new Job Task Line for each support call and we also want them to view all outstanding issues for all customers easily. For this, we have created a new issue registration system, which we will discuss at the end of this chapter.</p><p>Each issue in<a class="indexterm" id="id1109"/> the system is linked to a Job Task. When support engineers create a new issue, the Job Task Line is automatically generated for them and they can use it in our time and billing system.</p></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec169"/>Time sheets</h2></div></div></div><p>For all the jobs<a class="indexterm" id="id1110"/> in our examples, it is critical to have a solid registration of resource hours. In the standard Microsoft Dynamics NAV Job application resources need either to post a Job Journal for each combination of job, Job Task and Posting Date or we can use the new Time Sheet application introduced in Version 2013.</p><div><div><h3 class="title"><a id="tip49"/>Tip</h3><p>On the MSDN page at <a class="ulink" href="http://msdn.microsoft.com/en-us/library/hh175112(v=nav.71).aspx">http://msdn.microsoft.com/en-us/library/hh175112(v=nav.71).aspx</a>, you can find more information on how to set up and use Time Sheets in Microsoft Dynamics NAV.</p></div></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec181"/>Design pattern</h3></div></div></div><p>The <a class="indexterm" id="id1111"/>
<strong>Time Sheet</strong> application is layered above the Resource Journal Line and is created using Resources and Job Tasks.</p><div><img alt="Design pattern" src="img/0365EN_08_10.jpg"/></div><p>There is an approval process for the person responsible for the job allowing them to make corrections.</p><div><img alt="Design pattern" src="img/0365EN_08_11.jpg"/></div><p>The time sheet <a class="indexterm" id="id1112"/>is designed to be created for each week. The time sheets are generated using a process, not by the user. After that the resource can create <strong>Time Sheet Line</strong> for each Job Task Line and populate the number of hours each day of the week.</p><div><img alt="Design pattern" src="img/0365EN_08_12.jpg"/></div><p>If we look at the <a class="indexterm" id="id1113"/>preceding time sheet, we can see after it updated that <strong>Wednesday</strong> is missing 2 hours.</p></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec170"/>Purchasing</h2></div></div></div><p>For some jobs, it <a class="indexterm" id="id1114"/>might be<a class="indexterm" id="id1115"/> necessary to purchase items specifically for that job. In Microsoft Dynamics NAV 2013, the Jobs module was integrated with the Requisition Worksheet we looked at in <a class="link" href="ch05.html" title="Chapter 5. Production">Chapter 5</a>, <em>Production</em> and <a class="link" href="ch06.html" title="Chapter 6. Trade">Chapter 6</a>, <em>Trade</em>. However, in this example, we will create the purchase orders manually like this:</p><div><img alt="Purchasing" src="img/0365EN_08_13.jpg"/></div><p>When <a class="indexterm" id="id1116"/>purchasing for <a class="indexterm" id="id1117"/>a job, the <strong>Job No.</strong> and <strong>Job Task No.</strong> fields should be used. If we set the Job Line Type to contract this item will be invoiced to the customer. Usually, this is not required since it should have been in the Job Planning Lines already.</p><div><div><div><div><h3 class="title"><a id="ch08lvl3sec182"/>Item costing versus work in progress</h3></div></div></div><p>After <a class="indexterm" id="id1118"/>we post this purchase document and navigate from the purchase invoice, we can see that the system has created two value entries for this item:</p><div><img alt="Item costing versus work in progress" src="img/0365EN_08_14.jpg"/></div><p>This is very important for the costing as we discussed in the previous chapters.</p><div><div><h3 class="title"><a id="note52"/>Note</h3><p>Purchased items for jobs are not calculated as inventory but used for the work in progress calculation.</p></div></div></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec171"/>Invoicing</h2></div></div></div><p>When <a class="indexterm" id="id1119"/>everything in <a class="indexterm" id="id1120"/>our jobs is set up as required and the Job Journal is used to post the usage, creating the invoices is a simple task.</p><p>In the Job Manager Role Center, we can see if a job is due to be invoiced. This is done using a flow filter on the <strong>Planning Date</strong> field of the <strong>Job Planning Lines</strong>.</p><div><img alt="Invoicing" src="img/0365EN_08_15.jpg"/></div><p>Each Job Planning Line has a planning date. This can be used to schedule our resources but is far more useful for invoice scheduling. Each Job Planning Line that is ready to be invoiced should get the invoice date in the <strong>Planning Date</strong> field.</p><p>The invoices can then be created using the batch report <strong>Job Create Sales Invoice (1093)</strong> but we can also preview the invoice by using the report <strong>Job Suggested Billing (1011)</strong>. This report can be started from each job.</p><div><img alt="Invoicing" src="img/0365EN_08_16.jpg"/><div><p>Job-Suggested Billing</p></div></div><p>The sales invoice lines are created using the same description as the Job Planning Lines. To clarify information<a class="indexterm" id="id1121"/> for the customer on the invoice we can use extra text lines.</p><p>When the invoice is <a class="indexterm" id="id1122"/>created and posted, the Job Task is updated with the actual invoicing information.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec172"/>Calculating work in progress</h2></div></div></div><p>Since most <a class="indexterm" id="id1123"/>jobs<a class="indexterm" id="id1124"/> are not completed in a day or a week, it is important to know the status of each job in time. This can be measured in quantity and financially. In quantities, we can see how much of the budget is being used by looking at the <strong>Job Task</strong> page. For financial progress, we can calculate the WIP.</p><p>WIP calculates the cost we made and the sales we invoiced on the job and creates Job WIP Entries for this. This can then be posted to the general ledger if required. The WIP amounts depend on the WIP method.</p><p>In Microsoft Dynamics NAV, WIP is calculated based on a combination of costs and sales as set up in the Job WIP method table.</p><p>Let's create an example and calculate the WIP for five example methods.</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Code</p>
</th><th style="text-align: left" valign="bottom">
<p>Recognized costs</p>
</th><th style="text-align: left" valign="bottom">
<p>Recognized sales</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">COMPLETED CONTRACT</code>
</p>
</td><td style="text-align: left" valign="top">
<p>At completion</p>
</td><td style="text-align: left" valign="top">
<p>At completion</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">COST OF SALES</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Cost of sales</p>
</td><td style="text-align: left" valign="top">
<p>Contract (invoiced price)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">COST VALUE</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Cost value</p>
</td><td style="text-align: left" valign="top">
<p>Contract (invoiced price)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">PERC. OF COMPLETION</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Usage (total cost)</p>
</td><td style="text-align: left" valign="top">
<p>Percentage of completion</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">SALES VALUE</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Usage (total cost)</p>
</td><td style="text-align: left" valign="top">
<p>Sales value</p>
</td></tr></tbody></table></div><p>We created a job with a total price of 1000 and total cost of 500. We used 4 resource hours' worth 500 and cost 250. We invoiced nothing.</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom"> </th><th style="text-align: left" valign="bottom">
<p>Recog. cost</p>
</th><th style="text-align: left" valign="bottom">
<p>Recog. sales</p>
</th><th style="text-align: left" valign="bottom">
<p>WIP cost</p>
</th><th style="text-align: left" valign="bottom">
<p>WIP sales</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Cost value</p>
</td><td style="text-align: left" valign="top">
<p>125</p>
</td><td style="text-align: left" valign="top">
<p>0</p>
</td><td style="text-align: left" valign="top">
<p>125</p>
</td><td style="text-align: left" valign="top">
<p>0</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Sales value</p>
</td><td style="text-align: left" valign="top">
<p>250</p>
</td><td style="text-align: left" valign="top">
<p>250</p>
</td><td style="text-align: left" valign="top">
<p>0</p>
</td><td style="text-align: left" valign="top">
<p>250</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Cost of sales</p>
</td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top">
<p>250</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>Percentage of completion</p>
</td><td style="text-align: left" valign="top">
<p>250</p>
</td><td style="text-align: left" valign="top">
<p>250</p>
</td><td style="text-align: left" valign="top">
<p>0</p>
</td><td style="text-align: left" valign="top">
<p>250</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Completed contract</p>
</td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top">
<p>250</p>
</td><td style="text-align: left" valign="top"> </td></tr></tbody></table></div><p>Now, we send an invoice to the customer for the hours spent. We invoice 500.</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom"> </th><th style="text-align: left" valign="bottom">
<p>Recog. cost</p>
</th><th style="text-align: left" valign="bottom">
<p>Recog. sales</p>
</th><th style="text-align: left" valign="bottom">
<p>WIP cost</p>
</th><th style="text-align: left" valign="bottom">
<p>WIP sales</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Cost value</p>
</td><td style="text-align: left" valign="top">
<p>375</p>
</td><td style="text-align: left" valign="top">
<p>500</p>
</td><td style="text-align: left" valign="top">
<p>-125</p>
</td><td style="text-align: left" valign="top">
<p>0</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Sales value</p>
</td><td style="text-align: left" valign="top">
<p>250</p>
</td><td style="text-align: left" valign="top">
<p>250</p>
</td><td style="text-align: left" valign="top">
<p>0</p>
</td><td style="text-align: left" valign="top">
<p>-250</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Cost of sales</p>
</td><td style="text-align: left" valign="top">
<p>500</p>
</td><td style="text-align: left" valign="top">
<p>500</p>
</td><td style="text-align: left" valign="top">
<p>-250</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>Percentage of completion</p>
</td><td style="text-align: left" valign="top">
<p>250</p>
</td><td style="text-align: left" valign="top">
<p>250</p>
</td><td style="text-align: left" valign="top">
<p>0</p>
</td><td style="text-align: left" valign="top">
<p>-250</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Completed contract</p>
</td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top">
<p>250</p>
</td><td style="text-align: left" valign="top">
<p>-500</p>
</td></tr></tbody></table></div><p>In the last example, we<a class="indexterm" id="id1125"/> will <a class="indexterm" id="id1126"/>use an item that costs 250 that we cannot invoice. We now have 500 costs and 500 sales.</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom"> </th><th style="text-align: left" valign="bottom">
<p>Recog. cost</p>
</th><th style="text-align: left" valign="bottom">
<p>Recog. sales</p>
</th><th style="text-align: left" valign="bottom">
<p>WIP cost</p>
</th><th style="text-align: left" valign="bottom">
<p>WIP sales</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Cost value</p>
</td><td style="text-align: left" valign="top">
<p>500</p>
</td><td style="text-align: left" valign="top">
<p>500</p>
</td><td style="text-align: left" valign="top">
<p>0</p>
</td><td style="text-align: left" valign="top">
<p>0</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Sales value</p>
</td><td style="text-align: left" valign="top">
<p>250</p>
</td><td style="text-align: left" valign="top">
<p>250</p>
</td><td style="text-align: left" valign="top">
<p>0</p>
</td><td style="text-align: left" valign="top">
<p>-250</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Cost of sales</p>
</td><td style="text-align: left" valign="top">
<p>500</p>
</td><td style="text-align: left" valign="top">
<p>500</p>
</td><td style="text-align: left" valign="top">
<p>0</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>Percentage of completion</p>
</td><td style="text-align: left" valign="top">
<p>500</p>
</td><td style="text-align: left" valign="top">
<p>500</p>
</td><td style="text-align: left" valign="top">
<p>0</p>
</td><td style="text-align: left" valign="top">
<p>0</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Completed contract</p>
</td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top">
<p>500</p>
</td><td style="text-align: left" valign="top">
<p>-500</p>
</td></tr></tbody></table></div><p>When the WIP is positive, it means that we have done more than we invoiced. When the WIP is negative, we have invoiced more than we have done.</p><p>Each company that uses Microsoft Dynamics NAV should make their own decision about what WIP method to use. WIP methods can change for each job and even change during a job.</p><div><div><div><div><h3 class="title"><a id="ch08lvl3sec183"/>WIP post to general ledger</h3></div></div></div><p>Some accountants <a class="indexterm" id="id1127"/>want to post the WIP amounts to the general ledger. The benefit of doing this is to have all the financial information in one place for easier reporting.</p><p>The G/L Accounts for the WIP posting are set up in the Job Posting Group. When posting WIP to the general ledger, there is always a reversal posting. When a company does monthly reporting, the WIP is posted on the last day of the month and reversed on the first day of the next month.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec59"/>Changing jobs</h1></div></div></div><p>In this chapter, we <a class="indexterm" id="id1128"/>have used some changes to the Job functionality in order to make it work for CRONUS International Ltd. to sell Microsoft Dynamics NAV.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec173"/>Quantity budgeting</h2></div></div></div><p>For some <a class="indexterm" id="id1129"/>companies, it is very important to know the total number of hours required for a job and the number of hours used rather than the exact amounts.</p><p>For this, we have created new flow fields in the <strong>Job Task</strong> table:</p><div><img alt="Quantity budgeting" src="img/0365EN_08_17.jpg"/></div><p>The flow field definition is quite special.</p><div><pre class="programlisting">Sum("Job Planning Line"."Quantity (Base)" 
  WHERE (Job No. = FIELD(Job No.),
         Job Task No. = FIELD(Job Task No.),
<strong>         Job Task No. = FIELD(FILTER(Totaling)),</strong>
         Contract Line = CONST(Yes),
         Planning Date = FIELD(Planning Date Filter)))</pre></div><div><img alt="Quantity budgeting" src="img/0365EN_08_18.jpg"/></div><p>The <strong>Totaling</strong> field is <a class="indexterm" id="id1130"/>for the lines of type <strong>End-Total</strong>. The <code class="literal">ValueIsFilter</code> property<a class="indexterm" id="id1131"/> ensures that the field will be interpreted as a filter instead of a value.</p><p>The result is visible in the Job Task page (1002).</p><div><img alt="Quantity budgeting" src="img/0365EN_08_19.jpg"/><div><p>Result of ValueIsFilter property</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec174"/>Resource Groups</h2></div></div></div><p>For scheduling, we have implemented the <a class="indexterm" id="id1132"/>possibility of using Resource Groups in the <strong>Job Planning Lines</strong> as well as <strong>Calculations</strong>. This is done by adding two new fields, <strong>Add-on Type</strong> and <strong>Add-on No.</strong>:</p><div><img alt="Resource Groups" src="img/0365EN_08_20.jpg"/></div><p>These fields<a class="indexterm" id="id1133"/> replace the standard <strong>Type</strong> and <strong>No</strong>. fields on the pages allowing users to select these new options. The caption of the new fields matches the replacement fields.</p><div><pre class="programlisting">
<strong>Add-on No. - OnValidate()</strong>
CASE "Add-on Type" OF
  "Add-on Type"::Resource, "Add-on Type"::Item, "Add-on Type"::"G/L Account", "Add-on Type"::Text:
    BEGIN
      VALIDATE(Type, "Add-on Type");
      VALIDATE("No.", "Add-on No.");
    END;
  "Add-on Type"::"Resource Group":
    BEGIN
      TESTFIELD("Line Type", "Line Type"::Schedule);
      VALIDATE(Type, Type::Text);
      VALIDATE("No.", '');
      ResGroup.GET("Add-on No.");
      Description := ResGroup.Name;
      "Resource Group No." := ResGroup."No.";
      GetJob;
      ResCost.SETRANGE(Type, 
        ResPrice.Type::"Group(Resource)");
      ResCost.SETRANGE(Code, ResGroup."No.");
      IF ResCost.FINDFIRST THEN BEGIN
        "Unit Cost" := ROUND(
            CurrExchRate.ExchangeAmtLCYToFCY(
              "Currency Date","Currency Code",
              ResCost."Unit Cost","Currency Factor"),
            UnitAmountRoundingPrecision);</pre></div><p>In the C/AL code, we can make sure that when users select the values available in the standard product, the normal code is executed. If a user selects a Resource Group, we execute our own business logic.</p><p>To make sure everything <a class="indexterm" id="id1134"/>works as expected we use the Type <code class="literal">Text</code> in the background. <code class="literal">Line Type</code> is set to <code class="literal">Schedule</code> because we do not want to invoice Resource Groups, we just want them to be budgeted.</p><p>The <code class="literal">Unit Cost</code> and <code class="literal">Unit Price</code> are calculated using the Resource Cost and Resource Price tables, which support the use of Resource Groups. This is an inheritance from the previous Job functionality prior to Version 5.0.</p><p>The page Job Planning List (1007) is changed to show our add-on fields instead of the normal fields.</p><p>To completely finish this functionality, we would also need to change the reports that show the Job Planning Lines and the C/AL code that creates the Job Planning Lines when posting a Job Journal Line. This is not done in the example code for this chapter.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec175"/>Calculations</h2></div></div></div><p>Some <a class="indexterm" id="id1135"/>companies using the Job functionality have a need for flexible calculations. In our example, we use it to calculate the price of a computer system but other examples are book publishers or construction companies.</p><p>They want to know what it costs to create a product without exactly knowing which screws, hinges, or color of chipboard is used. For these companies, we designed a simple but effective calculation module.</p><p>In our database, there are<a class="indexterm" id="id1136"/> two example calculations: a server, and a desktop system.</p><div><img alt="Calculations" src="img/0365EN_08_21.jpg"/></div><p>The calculation is <a class="indexterm" id="id1137"/>designed using a header/line construction with a Number Series and a Line Number. The calculation lines are items.</p><p>When a new calculation is created some lines are automatically inserted. This is done in a C/AL function that is called from the <code class="literal">OnInsert</code> trigger.</p><p>The <code class="literal">OnInsert</code> trigger will also copy the default <code class="literal">Unit Price</code> for <code class="literal">Hours</code> from our setup table.</p><div><pre class="programlisting">
<strong>OnInsert()</strong>
CalcSetup.GET;

IF "No." = '' THEN BEGIN
  CalcSetup.TESTFIELD("Calculation Nos.");
  NoSeriesMgt.InitSeries(CalcSetup."Calculation Nos.",xRec."No. Series",0D,"No.","No. Series");
END;

"Unit Price Hours (LCY)" := CalcSetup."Unit Price Hours";
InitLines;</pre></div><p>The <a class="indexterm" id="id1138"/>
<code class="literal">InitLines</code> function <a class="indexterm" id="id1139"/>creates a calculation line for each item marked as <strong>Calculation Item</strong>. This is a new field that we added to the item table:</p><div><pre class="programlisting">
<strong>InitLines()</strong>
CalcLn.RESET;

i := 0;
Item.SETRANGE("Calculation Item", TRUE);
IF Item.FINDSET THEN REPEAT
  i += 10000;
  CalcLn."Calculation No." := "No.";
  CalcLn."Line No." := i;
  CalcLn.VALIDATE("Item No.", Item."No.");
  CalcLn.INSERT;
UNTIL Item.NEXT = 0;</pre></div><p>In the calculation, we can choose how many we will use from each item and the system will calculate the cost and price but also the required number of <code class="literal">Hours</code> that is required. The <code class="literal">Unit Cost</code> and <code class="literal">Unit Price</code> are used from the item table. <code class="literal">Hours</code> is calculated from a new field, and we added <code class="literal">Minutes</code> on the item table as well.</p><div><pre class="programlisting">
<strong>Calculate()</strong>
CalcLn.RESET;
CalcLn.SETRANGE("Calculation No.","No.");
CalcLn.CALCSUMS("Unit Cost", "Unit Price", Profit, Hours);
CalcLn.FIND('-');
CalcLn.MODIFYALL(Changed,Calculated::Calculated);

CalcLn.CALCSUMS("Unit Cost", "Unit Price", Hours);

"Unit Cost" := CalcLn."Unit Cost";
"Unit Price" := CalcLn."Unit Price";
Profit := "Unit Price" - "Unit Cost";
Hours := CalcLn.Hours;

Correct;
"Total Price Hours (LCY)" := "Hours (After Correction)" * "Unit Price Hours (LCY)";
"Total Price" := "Total Price Hours (LCY)" + 
  "Unit Price (After Correction)";
Calculated := Calculated::Calculated;
MODIFY;

Correct()
"Unit Price (After Correction)" := "Unit Price" + ("Unit Price" * ("Correction % Items" / 100));
"Profit (After Correction)" := 
  "Unit Price (After Correction)" - "Unit Cost";
"Hours (After Correction)" := 
  Hours + (Hours * ("Correction % Hours" / 100));</pre></div><p>When we now use<a class="indexterm" id="id1140"/> the <a class="indexterm" id="id1141"/>
<code class="literal">Calculate</code> function, the system will generate a total <code class="literal">Unit Cost</code>, <code class="literal">Unit Price</code>, and <code class="literal">Hours</code> for this product to be created. Flexibility is added to the system by allowing users to correct hours and usage with a percentage.</p><p>The calculation can be used in a Job Planning Line the same way as the Resource Groups earlier; the only difference is that we use the G/L Account type in the background to invoice a calculation fixed price. Let's look at the C/AL code in the <code class="literal">OnValidate</code> trigger of the <code class="literal">Add-On No.</code> field in the Job Planning Line:</p><div><pre class="programlisting">
<strong>Add-on No. - OnValidate()</strong>
CASE "Add-on Type" OF
  "Add-on Type"::Resource ... "Add-on Type"::Text:
      ...
  "Add-on Type"::"Resource Group":  
      ...
  "Add-on Type"::Calculation:
    BEGIN
      Calc.GET("Add-on No.");
      IF Calc."Turnover Account No." = '' THEN BEGIN
        TESTFIELD("Line Type", "Line Type"::Schedule);
        VALIDATE(Type, Type::Text);
        VALIDATE("No.", '');
      END ELSE BEGIN
        TESTFIELD("Line Type", 
          "Line Type"::"Both Schedule and Contract");
        VALIDATE(Type, Type::"G/L Account");
        VALIDATE("No.", Calc."Turnover Account No.");

      END;
      Description := Calc.Description;
      GetJob;</pre></div><p>To complete this functionality, we will create a method to use the hours in the calculation for the Resource planning. This can be done using Job Planning Lines of line type Schedule with no unit cost and unit price.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec176"/>Issue registration</h2></div></div></div><p>For our <a class="indexterm" id="id1142"/>support team, we have implemented an issue registration solution. This allows them to have a simple application where they can register issues for all customers and keep track of the status without going in and out of each job.</p><div><img alt="Issue registration" src="img/0365EN_08_22.jpg"/></div><p>The issue registration is a header/line construction with a Number Series and a line number. The lines can be used to phrase questions and answers.</p><p>When a support engineer creates a new issue, the system will create the Job Task automatically. Let's have a look at the C/AL code that does that:</p><div><pre class="programlisting">
<strong>CreateJobTask()</strong>
TESTFIELD("Job No.");
TESTFIELD("Job Task No.", '');

OldJobTask.SETRANGE("Job No.", "Job No.");
OldJobTask.SETRANGE("Job Task Type", 
  OldJobTask."Job Task Type"::Posting);
IF OldJobTask.ISEMPTY THEN
  OldJobTask.SETRANGE("Job Task Type",
    OldJobTask."Job Task Type"::"Begin-Total");
OldJobTask.FINDLAST;

JobTask."Job No." := "Job No.";
JobTask."Job Task No." := INCSTR(OldJobTask."Job Task No.");
JobTask.Description := Description;
JobTask."Job Task Type" := JobTask."Job Task Type"::Posting;
JobTask.INSERT(TRUE);
CODEUNIT.RUN(CODEUNIT::"Job Task-Indent Direct", JobTask);

"Job Task No." := JobTask."Job Task No.";</pre></div><p>The system <a class="indexterm" id="id1143"/>searches for the last <code class="literal">Job Task</code> of the type <code class="literal">Posting</code> in the Job. If that cannot be found, it searches for the last <code class="literal">Begin-Total</code> line.</p><p>Assuming this line exists, we create a new <code class="literal">Job Task</code> line using the <code class="literal">INCSTR</code> function to increment the number. The description is copied to the <code class="literal">Job Task</code>. The support engineers can now register their hours on this <code class="literal">Job Task</code>.</p><p>This piece of C/AL code is very simple but shows how effective a small solution can be without even touching any of the standard Microsoft Dynamics NAV objects. This is a very safe way of developing.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec60"/>Summary</h1></div></div></div><p>In this chapter, we have learned how to implement the Job functionality of Microsoft Dynamics NAV. We also discussed different strategies of setting up Jobs and Job Tasks.</p><p>We created several examples with different invoicing methods using the Job Planning Lines in a creative way. When purchasing items for jobs, the items are not used for costing but in the work in progress calculation we discussed in detail.</p><p>Invoicing is done automatically when everything is done as it should be done. Lastly, we designed some small enhancements for the Job module without doing big changes in the standard application. This was the last chapter about the functionality of Microsoft Dynamics NAV. We have discussed all possibilities of the application and how they should be changed without risking or breaking anything.</p><p>In the next chapter, we will look at how Microsoft Dynamics NAV can interface with other applications.</p></div></body></html>