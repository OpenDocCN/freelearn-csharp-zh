# *第 6 章*：添加和使用 ink-Unity Integration 插件

本章首先讨论如何在 Unity 项目及其项目窗口中添加 `.ink` 文件及其编译形式 `.json`。然后，我们将回顾如何将 Inky 与 ink 源文件关联，并使用它直接从 Unity 编辑文件。最后，我们将通过检查如何调整项目的插件设置来结束本章。

在本章中，我们将涵盖以下主要主题：

+   添加 ink-Unity Integration 插件

+   处理 ink 文件

+   调整插件设置

在本章中，我们将查找、导入和使用 ink-Unity Integration 插件。这将使我们能够处理 ink 文件并调整插件设置。没有插件，我们无法处理 ink 文件，本章中概述的步骤将帮助开发者为后续章节设置包，这些章节将专注于处理 ink 文件和安装插件后可用的 Story API。

关于 Unity 版本的说明

本章已在 **Unity 2020.3 (LTS)** 和 **Unity 2021.1 (当前版本)** 上进行测试。本章还涵盖了 **ink-Unity Integration** 插件的 *1.0.2* 版本。Inkle 报告称，ink-Unity Integration 插件的 *1.0.2* 版本与 Unity 的 *2018.4* 及更高版本兼容，但推荐使用的是 *2020.3 (LTS)* 和 *2021.1 (当前版本)*。

# 技术要求

本章中使用的示例，在 `*.ink` 文件中，可以在 GitHub 上找到：[https://github.com/PacktPublishing/Dynamic-Story-Scripting-with-the-ink-Scripting-Language/tree/main/Chapter6](https://github.com/PacktPublishing/Dynamic-Story-Scripting-with-the-ink-Scripting-Language/tree/main/Chapter6).

# 添加 ink-Unity Integration 插件

没有特殊的包，即 ink-Unity Integration 插件，我们无法在 Unity 中处理 Ink 文件。像其他 Unity 包一样，它只能添加到现有项目中，并且必须重新导入以供任何想要使用其代码和可用 API 的新项目使用。在本主题中，我们将介绍查找、导入和验证插件是否已准备好在项目中使用的步骤。本主题中的每个部分都应与第一个部分，即 *查找和导入插件*，使用相同的项目，从基于 2D 模板创建新 Unity 项目的说明开始。

注意

该包的官方名称是 ink-Unity Integration。然而，ink 的创造者 Inkle 在其自己的文档中称这个包为 *插件*。本书遵循相同的命名约定以避免混淆。

## 查找和导入插件

查找和导入 ink-Unity Integration 插件的过程需要以下步骤：

1.  使用内置的 2D 模板创建一个新的 Unity 项目。

    警告

    **Inkle** 不建议使用 Unity Asset Store 版本的 ink-Unity Integration 插件，因为更新之间存在延迟。本书将使用插件开发者推荐的安装方法来获取最新版本。

1.  导航到 ink-Unity 集成插件的**OpenUPM**页面：[https://openupm.com/packages/com.inklestudios.ink-unity-integration/](https://openupm.com/packages/com.inklestudios.ink-unity-integration/)。

1.  点击右侧的**获取安装器.unitypackage**链接：![图 6.1 – ink-Unity 集成插件的 OpenUPM 页面

    ![图片](img/Figure_6.1_B17597.jpg)

    图 6.1 – ink-Unity 集成插件的 OpenUPM 页面

1.  点击**获取安装器.unitypackage**链接将提示文件下载。下载完成后，找到本地文件并运行安装程序。

1.  在 Unity 打开时打开下载的安装文件。这将打开 Unity 中的**导入 Unity 包**窗口并加载安装文件的 内容。![图 6.2 – 显示 ink-Unity 集成的导入 Unity 包窗口

    ![图片](img/Figure_6.2_B17597.jpg)

    图 6.2 – 显示 ink-Unity 集成的导入 Unity 包窗口

1.  在**导入 Unity 包**窗口中，点击**全部**然后**导入**。这将确保所有文件都被选中并导入。一旦导入完成，Unity 将显示一条消息，说明已向项目中添加了一个新的作用域注册表。![图 6.3 – Unity 中导入作用域注册表的窗口](img/Figure_6.3_B17597.jpg)

    图 6.3 – Unity 中导入作用域注册表的窗口

1.  点击**关闭**按钮关闭**导入作用域注册表**窗口。Unity 还打开了**项目设置**窗口。这也可以关闭。

作为最后一步，我们将测试包是否已安装并准备好使用。在下一节中，我们将与**包管理器**窗口一起工作。

## 验证包是否已安装

根据Unity的版本、使用的其他包或开发者设置，有时可能不清楚 ink-Unity Integration 包是否已安装并准备好使用。

要验证插件已启用并准备好使用，请按照以下步骤操作：

1.  通过点击**文件**菜单中的**窗口**然后点击**包管理器**来打开**包管理器**窗口：![图 6.4 – Unity 中已选中包管理器的窗口菜单

    ![图片](img/Figure_6.4_B17597.jpg)

    图 6.4 – Unity 中已选中包管理器的窗口菜单

1.  在**包管理器**窗口中，点击**包**下拉菜单，并确保**在项目中**被选中：![图 6.5 – 包管理器，已选中“在项目中”选项

    ![图片](img/Figure_6.5_B17597.jpg)

    图 6.5 – 包管理器，已选中“在项目中”选项

1.  如果ink-Unity集成插件包含在当前项目中正在使用的包列表中，并且其名称旁边有一个绿色的勾选标记表示已安装到当前项目中，则该插件已准备好使用。![img/Figure_6.6_B17597.jpg](img/Figure_6.6_B17597.jpg)

    ![img/Figure_6.6_B17597.jpg](img/Figure_6.6_B17597.jpg)

    图6.6 – 包管理器显示已安装的ink Unity集成包

1.  在验证ink Unity集成包已安装后，可以关闭**包管理器**窗口。

在下一节中，我们将继续介绍如何处理ink文件。安装ink-Unity集成插件后，我们将学习如何创建ink文件、编辑它们以及使用插件内置的自动编译过程。

# 处理ink文件

Unity只了解它所监视的文件夹内的文件。要处理其他文件，必须将它们作为新资产添加到现有项目中。安装ink-Unity集成插件后，Unity将监视所有新的`.ink`文件类型文件，并将自动根据其**项目设置**编译它们以供Unity项目使用。然而，第一步是使用插件将这些Ink源文件添加到现有Unity项目中。

## 添加ink源文件

使用Inky创建的文件以`.ink`文件类型保存。这些是项目的**源**文件。它们是Ink故事的代码形式。要在Unity中使用ink，第一步是创建一个新的`.ink`文件。

在Unity中创建新的ink源文件，请打开一个现有项目并确保**项目**窗口已打开。（如果未打开，可以通过点击**窗口**菜单中的**通用**然后**项目**来重新打开。）

在Unity中做同样的事情通常有多种方式。这同样适用于在**项目**窗口中创建新文件。创建新ink文件的一种方法是使用**项目**窗口的工具栏和**创建**菜单，然后选择**Ink**选项。也可以通过在**项目**窗口中右键单击并进入**创建**菜单然后选择**Ink**来创建：

![img/Figure_6.7_B17597.jpg](img/Figure_6.7_B17597.jpg)

图6.7 – 项目窗口中的创建菜单

创建的Ink源文件可以重命名，或者可以通过单击其文件名区域外接受默认名称“新”Ink。在创建后不久，ink-Unity集成插件将生成一个与创建的文件同名的新文件。

![img/Figure_6.8_B17597.jpg](img/Figure_6.8_B17597.jpg)

![img/Figure_6.8_B17597.jpg](img/Figure_6.8_B17597.jpg)

图6.8 – ink-Unity集成插件在Unity项目视图生成的文件

自动编译设置

如果Unity没有根据墨迹源文件自动生成`.json`文件，则可能是自动编译设置被关闭了。请参考本章后面关于“调整插件设置”主题中的“更新自动重新编译”部分，了解如何更改此设置。

点击生成的文件将显示它是一个 `.json` 文件。当 ink 运行故事时，它会将其称为 `.ink` 文件的内容编译成 `.json` 文件。

安装 ink-Unity 集成插件后，将为每个现有的 `.ink` 文件自动创建一个新的 `.json` 文件。插件还将跟踪更改，并在检测到新更改时重新编译项目。

## 使用 Inky 编辑源文件

ink 源文件最好使用 Inky 编辑。然而，新的 ink 源文件通常通过 Unity 项目的 `.ink` 文件添加，这些文件可以在 Unity 内打开时与 Inky 关联以进行编辑。

根据操作系统，说明不同。接下来的两个部分包含 *Windows (10 及以后)* 和 *macOS (11.1 及以后)* 的步骤。

### Windows：将 Inky 与 ink 源文件关联

要在 Windows 10 及以后开始将 Inky 与所有 `.ink` 文件关联，请按照以下步骤操作：

1.  在 Unity 的 **项目** 窗口中点击创建的文件。这将将其在 **检查器** 视图中打开：![图 6.9 – ink 源文件的检查器视图](img/Figure_6.9_B17597.jpg)

    图 6.9 – ink 源文件的检查器视图

1.  点击 `.ink` 文件。![图 6.10 – Windows 10 中的文件关联提示](img/Figure_6.10_B17597.jpg)

    图 6.10 – Windows 10 中的文件关联提示

1.  点击 **更多应用** 并滚动到列表底部：![图 6.11 – Windows 10 中的程序列表

    ![图 6.11 – Windows 10 中的程序列表](img/Figure_6.11_B17597.jpg)

    图 6.11 – Windows 10 中的程序列表

1.  点击找到的 `Inky.exe` 文件并选择它：![图 6.12 – Windows 10 中的应用程序选择器](img/Figure_6.12_B17597.jpg)

    图 6.12 – Windows 10 中的应用程序选择器

1.  点击 `.ink` 文件。几秒钟后，Windows 将在 Inky 中打开 Unity 的 **项目** 窗口中找到的 `.ink` 文件。

今后，假设 `Inky.exe` 文件未被删除，Unity 将将所有 `.ink` 文件的打开操作重定向到 Inky。

### macOS：将 Inky 与 ink 源文件关联

要在 macOS (11.1 及以后) 中开始将 Inky 与所有 `.ink` 文件关联，请按照以下步骤操作：

1.  在 Unity 的 **项目** 窗口中右键单击创建的文件。点击 **在 Finder 中显示**：![图 6.13 – macOS 中 Unity 的文件上下文菜单](img/Figure_6.13_B17597.jpg)

    图 6.13 – macOS 中 Unity 的文件上下文菜单

1.  Finder 打开后，右键单击文件并导航到 **打开方式**：![图 6.14 – macOS 中的打开方式文件上下文菜单](img/Figure_6.14_B17597.jpg)

    ![图 6.14 – macOS 中的打开方式文件上下文菜单](img/Figure_6.14_B17597.jpg)

    图 6.14 – macOS 中的打开方式文件上下文菜单

1.  如果 `Inky.app` 未出现，点击 **其他…**：![图 6.15 – macOS 中的应用程序选择器](img/Figure_6.15_B17597.jpg)

    ![图 6.15 – Windows 10 中的程序选择器](img/Figure_6.15_B17597.jpg)

    图 6.15 – macOS 中的应用程序选择器

1.  在列表中搜索 `Inky` 在 `Inky.app` 中。点击 **打开**。

今后，假设 `Inky.app` 文件未被删除，Unity 将将所有 `.ink` 文件的打开操作重定向到 Inky。

## 更新 ink 源文件

一旦Inky与墨迹源文件关联，编辑文件就会变得容易得多。双击`.json`文件中的文件，这意味着源文件和编译文件将始终是最新的。

1.  要查看此过程实际操作，请双击“添加墨迹源文件”部分中创建的墨迹文件，以在Inky中打开它。

1.  将其内容更改为以下`示例1`：

    [PRE0]

1.  通过点击`.json`文件保存文件在Inky中。**控制台**窗口也会显示此过程何时开始和完成。

![图6.16 – 显示墨迹编译信息的控制台窗口

![图片](img/Figure_6.16_B17597.jpg)

图6.16 – 显示墨迹编译信息的控制台窗口

在Unity项目中安装了ink-Unity集成插件并与.ink文件关联的Inky，可以将新的墨迹源文件添加到Unity项目中，然后使用Inky进行编辑。每次保存时，ink-Unity集成插件将根据其**项目设置**重新编译它们。更新墨迹源文件变得像将它们添加到Unity项目并在Inky中编辑它们一样简单。

在ink-Unity集成插件准备就绪后，我们将在下一节中检查其设置以及如何更新自动编译功能。

# 调整插件设置

ink-Unity集成插件包含多个可以根据Unity项目的需求进行更改的设置。本主题将回顾如何找到**项目设置**窗口并更新一个常见选项 – 自动重新编译。

## 查找ink-Unity集成设置

Ink-Unity集成插件包含默认设置。这些可以通过作为**项目设置**的一部分进行编辑来更改：

1.  点击“编辑”然后**项目设置**：![图6.17 – 已选择项目设置的编辑菜单](img/Figure_6.17_B17597.jpg)

    图6.17 – 已选择项目设置的编辑菜单

1.  从侧边栏选项中点击**墨迹**以查看项目的相关设置。

![图6.18 – Unity中的墨迹项目设置

![图片](img/Figure_6.18_B17597.jpg)

图6.18 – Unity中的墨迹项目设置

在下一节中，我们将使用**项目设置**窗口来更新一个常见设置，即墨迹源文件的自动重新编译。

## 更新自动重新编译

如果项目有一个大的墨迹源文件或者许多不同的较小文件，每个文件都使用ink中的`INCLUDE`关键字，那么每次文件更改时编译过程可能需要超过几秒钟。在这些情况下，关闭墨迹源文件的重新编译可能防止ink-Unity集成插件浪费时间重新编译墨迹源文件。

1.  在**项目设置**窗口中，点击**墨迹**：![图6.19 – Unity中的墨迹项目设置

    ![图片](img/Figure_6.19_B17597.jpg)

    图6.19 – Unity中的墨迹项目设置

1.  点击**自动编译所有墨迹**旁边的复选框以禁用自动编译过程。（稍后可以通过再次点击复选框来重新启用。）

在这个主题中，我们检查了Ink **项目设置**窗口并更新了自动编译选项。根据ink源文件的大小和其他因素，编译过程有时在更改之间可能需要太长时间。更新ink源文件的自动编译通常是一个非常有用的设置，需要了解并更新，具体取决于项目。

# 摘要

在本章中，我们作为第一个主题的一部分学习了如何在网络上找到ink-Unity集成插件。我们回顾了如何导入包以及验证它已被安装。这对于所有使用该插件的项目来说是一个重要步骤，因为对于任何新项目都必须重新导入。

在第二个主题“与ink文件一起工作”中，我们探讨了如何在Unity中创建新的ink文件。我们检查了如何在Windows 10和macOS中将Inky与ink源文件关联起来。然后我们学习了如何编辑ink文件以及ink-Unity集成插件将如何检测任何更改，如果启用了**项目设置**中的选项，它将重新创建编译后的JSON文件。

最后，在*调整插件设置*主题中，我们检查了使用ink-Unity集成插件时的设置。我们首先回顾了如何通过从可用选项中选择**Ink**来找到插件的**项目设置**。接下来，我们检查了如何调整ink文件的自动重新编译。

在下一章中，我们将继续使用Ink API来处理运行中的故事。ink-Unity集成插件帮助根据ink源文件生成JSON文件。我们将在下一章中使用这些JSON文件，并学习如何将故事的部分作为更大Unity项目的一部分来加载。

# 问题

1.  Inkle是否推荐使用Unity Asset Store？

1.  使用ink-Unity集成插件在Unity中创建ink文件至少有一种方法吗？

1.  哪个程序是编辑ink文件的不错选择？

1.  ink-Unity集成插件的自动编译过程可以更改吗？
