# 第10章. 选择和使用源控制策略

源控制是每个开发者工具箱的一个基本部分。无论你是业余爱好者还是专业程序员；当你从办公桌起身回家时，你最好确保你的代码是安全的。在本章中，我们将探讨选择和使用源控制策略。我们将查看的一些主题包括：

+   设置Visual Studio账户管理和确定最适合你的源控制解决方案

+   设置Visual Studio GitHub集成，首次提交代码，并提交更改

+   使用GitHub进行团队合作，处理和解决代码冲突

# 简介

在我的职业生涯中，我使用过Visual SourceSafe、SVN、VSTS、Bitbucket和GitHub。实际上，你如何操作并不重要，重要的是你要确保你的源代码安全并进行了版本控制。

# 设置Visual Studio账户管理和确定最适合你的源控制解决方案

Visual Studio允许开发者创建账户并登录。如果你经常使用热桌或者在不同地点的多台机器上工作（比如工作场所和家用电脑），这尤其有益，因为Visual Studio会自动同步你在登录的机器上的设置。

## 准备工作

本食谱将假设你已经在你的机器上完成了Visual Studio 2015的安装。无论你是安装了Visual Studio 2015的试用版还是授权版本，这都不重要。

## 如何操作...

1.  安装完成后，打开Visual Studio：![如何操作...](img/B05391_10_27.jpg)

1.  在Visual Studio的右上角，你会看到一个**登录**链接：![如何操作...](img/B05391_10_28.jpg)

1.  点击**登录**链接，你将被允许在这里输入你的电子邮件地址。我发现使用我的Outlook电子邮件地址很有用。在我看来，这是最好的网络电子邮件之一。

    ### 注意

    请注意，我并不是因为任何原因而推荐Outlook，我只是真的认为它是一个非常好的产品。我还有一个Gmail账户以及一个iCloud电子邮件账户。

    ![如何操作...](img/B05391_10_29.jpg)

1.  添加你的电子邮件账户后，Visual Studio会重定向你到一个登录页面：![如何操作...](img/B05391_10_30.jpg)

1.  由于我已经有一个Outlook账户，Visual Studio只需我使用它进行登录。如果你没有账户，你可以在这里创建一个：![如何操作...](img/B05391_10_31.jpg)

1.  Visual Studio现在会要求你输入一些额外的信息。需要注意的是，如果你有一个Team Services账户，你可以在这里将其链接。目前，请将其留空，因为这将稍后在另一个食谱中处理：![如何操作...](img/B05391_10_32.jpg)

1.  创建账户后，你可以通过查看Visual Studio IDE右上角的所选账户来确认你已经登录：![如何操作...](img/B05391_10_33.jpg)

1.  点击您账户名称旁边的向下箭头，您可以看到您的**账户设置…**![如何操作...](img/B05391_10_34.jpg)

1.  这将显示您的账户概览，从这里您可以进一步个性化您的账户：![如何操作...](img/B05391_10_35.jpg)

源代码控制的选择是每个开发者都有强烈意见的话题。不幸的是，如果您为老板工作，这个决定可能甚至不由您决定。许多公司已经按照他们喜欢的样子设置了源代码控制系统，您将需要遵循公司程序。事情就是这样。然而，了解作为独立开发者可用的选项是很好的。

所有优秀的开发者都应该在业余时间编写代码。您不仅在工作时是开发者。我们吃饭、呼吸、睡觉、生活都与代码息息相关。这是我们是谁和我们是什么的一部分。我要说的是，为了使您作为开发者的工作做得更好，您必须在业余时间玩代码。开始一个宠物项目，召集一些朋友，决定一起编写一些软件。这不仅会使你们在所做的事情上变得更好，而且你们会互相学到很多。

如果您是一名远程开发者，每天都不通勤到办公室工作，您仍然可以与开发者社区保持联系。为开发者提供了如此多的资源，开发者社区也乐于帮助新手并帮助他们成长。如果您不承诺（字面意思）保持您的代码安全，那么开始一个个人或宠物项目是没有用的。为此，您甚至不需要支付一分钱。Visual Studio Online（现在称为团队服务）和GitHub都为开发者提供了一个绝佳的平台来保护您的代码。

让我们从查看团队服务开始。您可以通过将浏览器指向[https://www.visualstudio.com/en-us/products/what-is-visual-studio-online-vs](https://www.visualstudio.com/en-us/products/what-is-visual-studio-online-vs)来找到该网站。

在这里，您将看到微软为开发者提供了一个使用团队服务的绝佳机会。对于最多五个用户，这是完全免费的。这意味着您和您的伙伴们可以协作完成下一个大项目，同时确保您的代码保持安全。注册就像点击**免费开始**链接一样简单：

![如何操作...](img/B05391_10_36.jpg)

第二个出色的选择是GitHub。它在免费提供方面略有不同，要求开发者在使用免费账户时使用公共仓库。如果您不介意您的代码基本上是开源的，那么GitHub是一个不错的选择。然而，在GitHub上，您可以拥有无限的合作者和公共仓库：

![如何操作...](img/B05391_10_24.jpg)

## 它是如何工作的...

选择源代码控制主要取决于您代码的开放性。如果您可以承担让其他开发者查看和下载您的代码，那么 GitHub 是一个很好的选择。如果您需要您的代码保持私密，并且只与特定的人共享，那么付费的 GitHub 账户将更适合。如果您目前不想花钱，那么 Team Services 将是您的最佳选择。

# 设置 Visual Studio GitHub 集成，首次提交代码以及提交更改

GitHub 多年来一直是一个强大的工具。许多开发者对其深信不疑。实际上，当使用苹果的 Xcode IDE 时，它就是默认选项。无论您出于什么原因选择使用 GitHub，请放心，您和您的代码都处于安全可靠的手中。

## 准备工作

以下步骤将假设您已经注册了 GitHub，并且已经启用了**双因素认证**。如果您还没有注册 GitHub 账户，您可以通过访问 [www.github.com](http://www.github.com) 并创建一个新账户来注册。要在您的 GitHub 账户上启用**双因素认证**（我强烈建议这样做），请按照以下步骤操作：

1.  点击您的个人形象旁边的向下箭头，并选择**设置**：![准备工作](img/B05391_10_22.jpg)

1.  在下一页左侧出现的**个人设置**菜单中，选择**安全**：![准备工作](img/B05391_10_23.jpg)

1.  安全页面上的第一个部分将是您的**双因素认证**状态。要开始设置，请点击**设置双因素认证**按钮：![准备工作](img/B05391_10_25.jpg)

1.  您将看到一个关于**双因素认证**的简要概述，并可以选择**使用应用程序设置**（我推荐）或**使用短信设置**。使用应用程序是最简单的，如果您有智能手机或平板电脑，您可以从相应的应用商店下载一个身份验证器应用程序。从那时起，按照 GitHub 给您的提示完成**双因素认证**的设置：![准备工作](img/B05391_10_26.jpg)

## 如何操作...

1.  如果您是首次安装 Visual Studio 2015，请查看**自定义**安装选项。在**常用工具**下，展开后您将看到将 GitHub 添加到 Visual Studio 安装中的选项。在选择了该选项和其他安装选项后，点击**下一步**并完成安装向导窗口。现在 Visual Studio 2015 将开始安装。您可以现在休息一下，去喝杯咖啡，因为安装可能需要一段时间，具体取决于您的硬件和互联网连接速度：![如何操作...](img/B05391_10_01.jpg)

1.  如果您已经安装了Visual Studio 2015但没有添加GitHub扩展，您可以从以下链接轻松下载并安装它：[https://visualstudio.github.com/downloads/GitHub.VisualStudio.vsix](https://visualstudio.github.com/downloads/GitHub.VisualStudio.vsix)。

1.  假设您有一个想要添加到GitHub的现有应用程序，将其添加到新仓库的过程相当简单。我仅仅创建了一个只包含模板代码的控制台应用程序，但您可以将任何项目类型和大小添加到GitHub：![如何操作...](img/B05391_10_02.jpg)

1.  在Visual Studio 2015的**视图**菜单中，选择**团队资源管理器**选项：![如何操作...](img/B05391_10_03.jpg)

1.  在**托管服务提供商**部分，您将看到两个选项。目前，我们将选择**GitHub**，因为我们已经有了账户，所以我们将点击**连接…**![如何操作...](img/B05391_10_04.jpg)

1.  您现在将看到GitHub登录页面。如果您没有现有的GitHub账户，您也可以从这里注册：![如何操作...](img/B05391_10_05.jpg)

1.  由于我在GitHub账户上设置了**两步验证**，我需要使用我的认证器应用程序输入生成的认证码并验证自己：![如何操作...](img/B05391_10_06.jpg)

1.  经过认证后，您将返回到**管理连接**屏幕：![如何操作...](img/B05391_10_07.jpg)

1.  接下来，您需要点击顶部的**团队资源管理器**窗口中的Home图标，它是一个小房子的图片。从**主页**屏幕，点击**同步**按钮：![如何操作...](img/B05391_10_08.jpg)

1.  这将显示**发布**窗口。在GitHub下，点击**开始使用**链接。这将把您的项目发布到GitHub上的新仓库。

    ### 注意

    记住，如果您使用的是免费的GitHub，所有您的仓库都是公开的。如果您正在编写不能公开的代码（不是开源的），那么请注册一个包含私有仓库的付费GitHub账户。

    ![如何操作...](img/B05391_10_09.jpg)

1.  然后，GitHub将提示您添加此发布的详细信息。因为您之前已经连接到GitHub，所以您的用户名已经在下拉菜单中选中。准备好后，点击**发布**：![如何操作...](img/B05391_10_10.jpg)

1.  当项目发布到GitHub后，您将自动返回到**主页**屏幕：![如何操作...](img/B05391_10_11.jpg)

1.  在线查看您的GitHub账户，您会看到项目已经被添加：![如何操作...](img/B05391_10_12.jpg)

1.  接下来，让我们对`CommandCentre`应用程序进行一些修改。直接添加一个新类到您的项目中。我命名为`Dominion.cs`，但您可以根据自己的喜好命名：![如何操作...](img/B05391_10_13.jpg)

1.  你会注意到，一旦你对项目进行了更改，解决方案就会用红色勾号标记更改的项目：![如何操作...](img/B05391_10_14.jpg)

1.  要将更改添加到你的GitHub仓库，你可以遵循两条路径。第一个选项是进入**团队资源管理器 - 主页**窗口，然后点击**更改**按钮：![如何操作...](img/B05391_10_15.jpg)

1.  第二个（在我看来更方便的）选项是右键单击**解决方案资源管理器**中的解决方案，然后从上下文菜单中选择**提交...**菜单项：![如何操作...](img/B05391_10_16.jpg)

1.  当你第一次执行提交操作时，GitHub可能会要求你提供用户信息：![如何操作...](img/B05391_10_17.jpg)

1.  在你被允许提交更改之前，你必须填写所需的提交信息。在一个真实的项目团队中，你的提交信息应该尽可能详细。考虑使用任务项代码（或待办事项代码）来唯一标识正在添加的代码。这将在未来某个时候为你（或另一位开发者）节省很多麻烦，我保证：![如何操作...](img/B05391_10_18.jpg)

1.  有一个重要的事情需要注意，那就是如果你点击**提交所有**按钮旁边的向下箭头，你有三个提交选项可供选择。**提交所有**按钮只会记录你在本地机器上所做的更改。换句话说，更改不会反映在远程仓库中。**提交所有并推送**按钮会记录你在本地机器上的更改，并将这些更改推送到你的远程GitHub仓库。**提交所有并同步**按钮会记录你在本地机器上的更改，然后它会从远程仓库拉取任何更改，最后进行推送。如果你在团队中工作，你会想要这样做。然而，对于这个配方，我只会进行**提交所有并推送**，因为我是这个仓库唯一的开发者：![如何操作...](img/B05391_10_19.jpg)

1.  当提交完成时，**团队资源管理器**窗口会通知你提交成功：![如何操作...](img/B05391_10_20.jpg)

1.  转到GitHub在线，你会看到新推送的更改反映在你的GitHub仓库中，以及提交信息：![如何操作...](img/B05391_10_21.jpg)

1.  GitHub是任何开发者的绝佳源代码管理解决方案。考虑创建一个开源项目。这比你想象的更有益。

## 它是如何工作的...

免费GitHub账户允许您创建公共仓库。这意味着任何人都可以在GitHub上搜索、查看和克隆您的项目到自己的桌面。这是GitHub的核心思想。这对不想花钱的独立开发者和企业来说显然是一个关键因素。然而，企业比独立开发者更有能力承担费用。但我认为，一些公司宁愿自己搭建而不是使用云中托管的服务提供商。这意味着他们更愿意通过在自己的企业服务器上设置源控制系统来保持源控制在自己手中。为独立开发者提供GitHub选项是一个绝佳的解决方案。对于那些需要私有仓库的人来说，费用也不是障碍。

# 使用GitHub团队合作，处理和解决代码冲突

当在团队中工作时，GitHub和团队服务真正发挥其优势。协作努力的效果非常强大。有时，这可能会有些挑战。让我们看看如何使用GitHub在团队环境中工作。

## 准备就绪

我们将使用已检查到GitHub的现有`CommandCentre`应用程序。在您允许其他开发者将代码推送到您的分支之前，您需要将他们添加为协作者。为此，登录GitHub并点击加号旁边的向下箭头。在菜单中点击**新建协作者**：

![准备就绪](img/B05391_10_50.jpg)

您可以通过输入他们的GitHub用户名、全名或电子邮件地址来搜索要添加的协作者：

![准备就绪](img/B05391_10_51.jpg)

完成后，点击**添加协作者**按钮将该用户添加为项目的协作者：

![准备就绪](img/B05391_10_52.jpg)

## 如何操作...

1.  假设一位新开发者（我们称他为John）加入了团队。您已经将开发者添加为项目的协作者。John开始设置他的Visual Studio环境，包括连接到GitHub。在菜单中点击**团队**，然后点击**管理连接…**![如何操作...](img/B05391_10_37.jpg)

1.  在**托管服务提供商**选项中，选择GitHub服务下的**连接…**![如何操作...](img/B05391_10_38.jpg)

1.  使用您的电子邮件地址和密码登录GitHub。

    ### 注意

    注意，如果您刚刚注册了GitHub，您需要点击发送到您注册时指定的电子邮件地址的验证电子邮件。如果不验证您的电子邮件地址，您将无法从Visual Studio登录。

    ![如何操作...](img/B05391_10_39.jpg)

1.  连接后，您将看到GitHub详细信息已加载：![如何操作...](img/B05391_10_40.jpg)

1.  我们现在想要在`CommandCentre`应用程序上工作。您可以通过按名称搜索在GitHub上找到它：![如何操作...](img/B05391_10_41.jpg)

1.  当您找到正确的项目时，从页面上的**HTTPS**文本框中复制URL：![如何操作...](img/B05391_10_42.jpg)

1.  在Visual Studio中，展开**本地Git仓库**并点击**克隆**。将复制的URL粘贴到Git仓库路径中，并指定代码应在您的硬盘上克隆到的位置。准备好后，点击**克隆**：![如何操作...](img/B05391_10_43.jpg)

1.  当代码被克隆时，您将在之前指定的文件夹路径中看到它：![如何操作...](img/B05391_10_44.jpg)

1.  是时候对代码进行一些更改了。以正常方式在Visual Studio中打开项目。John决定在`Dominion.cs`类上工作，并添加了一个返回倒计时整数的函数：![如何操作...](img/B05391_10_45.jpg)

1.  代码更改完成后，John将刚刚添加的代码提交到GitHub仓库：![如何操作...](img/B05391_10_46.jpg)

1.  GitHub随后要求输入John的姓名和电子邮件地址以进行此提交：![如何操作...](img/B05391_10_47.jpg)

1.  John添加了一个有意义的提交信息来描述他所作的更改：![如何操作...](img/B05391_10_48.jpg)

1.  然后，他点击**全部提交并同步**：![如何操作...](img/B05391_10_49.jpg)

1.  John的更改已提交到GitHub仓库：![如何操作...](img/B05391_10_53.jpg)

1.  在办公室的另一边，我正在处理同一块代码。唯一的问题是，我添加了与自己的`CountDown`逻辑实现相同的方法：![如何操作...](img/B05391_10_54.jpg)

1.  我准备好并将我的更改提交到GitHub：![如何操作...](img/B05391_10_55.jpg)

1.  GitHub立即阻止我这样做。这是因为如果我的代码被推送，John之前的提交将会丢失。GitHub在GitHub帮助中对此有很好的帮助文件：[https://help.github.com/articles/dealing-with-non-fast-forward-errors/](https://help.github.com/articles/dealing-with-non-fast-forward-errors/)。![如何操作...](img/B05391_10_56.jpg)

1.  要解决这个问题，请点击**拉取**以获取John所做的最新提交。此时，您的代码将处于冲突状态。这听起来很糟糕，但并非如此。这使您能够控制决定使用哪段代码。您可以看到，拉取操作显示了有冲突的文件以及John添加的传入提交信息：![如何操作...](img/B05391_10_57.jpg)

1.  要查看冲突，请点击消息弹出窗口中的**解决冲突**链接：![如何操作...](img/B05391_10_58.jpg)

1.  您将看到**解决冲突**屏幕上列出有冲突的文件。点击一个文件将展开为简短摘要和操作选项屏幕。始终点击**比较文件**链接以查看冲突文件之间的差异：![如何操作...](img/B05391_10_59.jpg)

1.  代码中的差异立即显而易见。你接下来遵循的过程取决于你们团队合作的方式。通常，冲突可能相当复杂，与相关开发者讨论前进的方式总是一个好主意：![如何操作...](img/B05391_10_60.jpg)

1.  在这种情况下，我和约翰决定他的代码更好、更简洁。因此，决定简单地点击**取远程**并使用约翰的代码。当你点击了链接后，你需要点击**提交合并**：![如何操作...](img/B05391_10_61.jpg)

1.  在添加提交信息后，你可以将你的代码推送到仓库。在这种情况下，我简单地用约翰的代码替换了我所有的代码，但可能存在你需要使用你自己的代码和另一位开发者的代码的情况。GitHub允许我们轻松地处理这些冲突：![如何操作...](img/B05391_10_62.jpg)

1.  在将代码推送到远程后，GitHub会通知你代码已成功同步：![如何操作...](img/B05391_10_63.jpg)

## 它是如何工作的...

GitHub简化了提交、解决冲突和合并代码的痛苦。毫无疑问，它是任何开发者工具箱中的必备工具，对于开发团队来说是必不可少的。
