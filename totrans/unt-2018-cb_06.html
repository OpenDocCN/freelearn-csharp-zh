<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Shader Graphs and Video Players</h1>
                </header>
            
            <article>
                
<p>In this chapter, we will cover the following topics:</p>
<p class="mce-root"/>
<ul>
<li>Playing videos by manually adding a VideoPlayer component to a GameObject</li>
<li>Using scripting to control video playback on scene textures</li>
<li>Using scripting to play a sequence of videos back-to-back</li>
<li>Creating and using a simple Shader Graph</li>
<li>Using a Shader Graph to create a color glow effect</li>
<li>Toggling a Shader Graph color glow effect through C# code</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p>Two powerful recent additions to Unity have been the Video Player component (and API), and the Shader Graph tool. Between them, they offer easier and more configurable ways to work with visual content in games. For example, they help with the loading and playing of videos on different visible objects, and provide a comprehensive way for non-shader programmers to construct sophisticated shader transformations using a visual graphing approach.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The big picture</h1>
                </header>
            
            <article>
                
<p>The two core new Unity features discussed in this chapter are <strong>Shader Graphs</strong> and the <strong>Video Player</strong>. Each has its own section below.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The new Shader Graph tool</h1>
                </header>
            
            <article>
                
<p>In 2018, Unity published details about the exciting new <strong><span class="KeyWordPACKT">Shader Graph</span></strong> feature. <strong><span class="KeyWordPACKT">Shader Graph</span></strong> is a tool that allows <strong>visual</strong> building of shaders, by creating and connecting inputs and output of <span class="KeyWordPACKT">nodes</span>. Currently, it only works with the <span class="KeyWordPACKT">Lightweight Scriptable Render Pipeline</span>, but should eventually work with many pipelines.</p>
<p>Unity's <strong><span class="KeyWordPACKT">Scriptable Render Pipeline</span></strong> allow different, and customizable, rending pipelines, that can be efficiently targeted for specific projects and hardware settings (for example, exploiting GPUs in powerful desktop computers, or reducing performance requirements for less powerful mobile devices).</p>
<p>Some great <strong><span class="KeyWordPACKT">Shader Graph</span></strong> features include the following:</p>
<ul>
<li>An instant, visual preview of <span class="ItalicsPACKT">each</span> node in the graph, so that you can see how different nodes are contributing to the final <strong><span class="KeyWordPACKT">Master</span></strong> output node.</li>
<li>Properties can be publicly <span class="ItalicsPACKT">exposed</span> in the graph (via the <strong><span class="ScreenTextPACKT">Blackboard</span></strong>), so that they become customizable values in the <strong><span class="KeyWordPACKT">Inspector</span></strong> for the <strong><span class="KeyWordPACKT">Material</span></strong> using the <strong><span class="KeyWordPACKT">Shader Graph</span></strong>.</li>
<li>Publicly exposed properties can also be accessed and changed via scripts.</li>
<li>The output of one node can become one of the inputs to another node, so a sophisticated shader can be created from many combined, simple component nodes:</li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img src="assets/190af154-9f0f-4288-95be-c62117a37765.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign"><span>This screenshot illustrates how Shader Graphs are composed of a graph of connected nodes, where the output of one node becomes the input to another node. Node input/outputs can be numeric values, Textures, noise, Boolean true/false values, Colors etc.</span></div>
<p><strong><span class="KeyWordPACKT">Shader Graph</span></strong> files are created in the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel, and can be selected as a <span class="ItalicsPACKT">graph</span> shader in the <kbd>Shader</kbd> property of a <strong>Material</strong>.</p>
<p>Several recipes are presented in this chapter to introduce some of the powerful <strong><span class="KeyWordPACKT">Shader Graph</span></strong> features and workflow.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Playing videos with the new Video Player</h1>
                </header>
            
            <article>
                
<p>In 2017, Unity replaced the old <kbd><span class="KeyWordPACKT">MovieTexture</span></kbd> with the <span class="KeyWordPACKT">VideoPlayer</span> component (as well as the associated <span class="KeyWordPACKT">VideoClip</span> asset file type). Playing videos is as simple as manually adding a <span class="KeyWordPACKT">VideoPlayer</span> component in the <span class="KeyWordPACKT">Inspector</span> to a GameObject at design t<span class="KeyWordPACKT">ime</span>, and associating a <span class="KeyWordPACKT">VideoClip</span> asset file from the <span class="KeyWordPACKT">Project</span> panel, or providing the URL of a online resource.</p>
<p>Videos can be played on the c<span class="KeyWordPACKT">amera's</span> far plane (appearing <span class="ItalicsPACKT">behind the</span> scene content), or near plane (appearing <span class="ItalicsPACKT">in front of</span> content <span>–</span> often with semi-transparency). Video content can also be directed to a <kbd><span class="KeyWordPACKT">RenderTexture</span></kbd> asset, which can then (via a <span class="KeyWordPACKT">Material</span>) be displayed on a 2D or 3D object in the scene. The internal t<span class="KeyWordPACKT">exture</span> used by a <span class="KeyWordPACKT">VideoPlayer</span> can also be mapped to a t<span class="KeyWordPACKT">exture</span> on screen <span>–</span> such as <span class="KeyWordPACKT">UI Raw Image</span>.</p>
<p>Scripting can be used to manage video playback for single and arrays (sequence) of video clips. Several recipes are presented in this chapter to introduce these different ways to work with the <span class="KeyWordPACKT">VideoPlayer</span>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Online references materials</h1>
                </header>
            
            <article>
                
<p>The following are useful sources of information for the topics of this chapter.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Shader Graph online resources</h1>
                </header>
            
            <article>
                
<p>Unity documentation and third-party articles about the <span class="KeyWordPACKT">Shader Graphs</span> can be found online at the following links:</p>
<ul>
<li>The <span class="KeyWordPACKT">Shader Graph</span> blog introduction: <a href="https://blogs.unity3d.com/2018/02/27/introduction-to-shader-graph-build-your-shaders-with-a-visual-editor/" target="_blank"><span class="URLPACKT">https://blogs.unity3d.com/2018/02/27/introduction-to-shader-graph-build-your-shaders-with-a-visual-editor/</span></a></li>
<li>The Unity <span class="KeyWordPACKT">Shader Graph</span> overview: <a href="https://unity3d.com/shader-graph" target="_blank"><span class="URLPACKT">https://unity3d.com/shader-graph</span></a></li>
<li>The Unity GitHub Shader Graph wiki: <a href="https://github.com/Unity-Technologies/ShaderGraph/wiki" target="_blank"><span class="URLPACKT">https://github.com/Unity-Technologies/ShaderGraph/wiki</span></a></li>
<li>The <span class="KeyWordPACKT">Shader Graph</span> example library on GitHub: <a href="https://github.com/UnityTechnologies/ShaderGraph_ExampleLibrary" target="_blank"><span class="URLPACKT">https://github.com/UnityTechnologies/ShaderGraph_ExampleLibrary</span></a></li>
<li>Great video tutorial of <span class="KeyWordPACKT">Shader Graph</span> from Unity Technology's Andy Tough at GDC 2018: <a href="https://www.youtube.com/watch?v=NsWNRLD-FEI" target="_blank"><span class="URLPACKT">https://www.youtube.com/watch?v=NsWNRLD-FEI</span></a></li>
<li>Unity's manual page about the Scriptable Render Pipeline: <a href="https://docs.unity3d.com/Manual/ScriptableRenderPipeline.html" target="_blank"><span class="URLPACKT">https://docs.unity3d.com/Manual/ScriptableRenderPipeline.html</span></a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Video Player online resources</h1>
                </header>
            
            <article>
                
<p>Unity documentation and third-party articles about the <span class="KeyWordPACKT">Video Player</span> can be found online at the following links:</p>
<ul>
<li>The Unity <span class="KeyWordPACKT">Video Player</span> manual page: <a href="https://docs.unity3d.com/Manual/class-VideoPlayer.html" target="_blank"><span class="URLPACKT">https://docs.unity3d.com/Manual/class-VideoPlayer.html</span></a></li>
<li>The Unity Scripting reference for the <span class="KeyWordPACKT">VideoPlayer</span> class: <a href="https://docs.unity3d.com/ScriptReference/Video.VideoPlayer.html" target="_blank"><span class="URLPACKT">https://docs.unity3d.com/ScriptReference/Video.VideoPlayer.html</span></a></li>
<li>Creative Chris' blog post about the <span class="KeyWordPACKT">Video Player:</span> <a href="https://creativechris.me/2017/02/07/unitys-new-video-playback-component/" target="_blank"><span class="URLPACKT">https://creativechris.me/2017/02/07/unitys-new-video-playback-component/</span></a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Playing videos by manually adding a VideoPlayer component to a GameObject</h1>
                </header>
            
            <article>
                
<p>TV sets, projectors, monitors.... If you want complex animated materials in your level, you can play video files as texture maps. In this recipe, we will learn how to add and use <span class="KeyWordPACKT">VideoPlayer</span> components on the m<span class="KeyWordPACKT">ain camera</span>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>If you need a video file so that you can follow this recipe, please use the <kbd><span class="ScreenTextPACKT">videoTexture.mov</span></kbd> file included in the <kbd>13_01</kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To place videos manually with a VideoPlayer component, follow these steps:</p>
<ol>
<li>Import the provided <kbd><span class="ScreenTextPACKT">videoTexture.mov</span></kbd> file.</li>
<li>Add a 3D Cube to the scene by choosing menu: <span class="ScreenTextPACKT"><span class="packt_screen">GameObject</span> | <span class="packt_screen">3D Object</span> | <span class="packt_screen">Cube</span></span>.</li>
</ol>
<ol start="3">
<li>Select the <span class="KeyWordPACKT">Main Camera</span> GameObject, and in the <span class="KeyWordPACKT">Inspector,</span> add a <span class="ScreenTextPACKT">Video Player</span> component by clicking <span class="ScreenTextPACKT"><span class="packt_screen">Add Component</span></span>, and choosing <span class="ScreenTextPACKT"><span class="packt_screen">Video</span> | <span class="packt_screen">Video Player</span></span>. Unity will have noticed that we are adding the <span class="ScreenTextPACKT">Video Player</span> component to a c<span class="KeyWordPACKT">amera</span>, and so should have set up the default properties correctly for us:
<ul>
<li><span class="ScreenTextPACKT"><span class="packt_screen">Play On Awake</span></span> (Checked)</li>
<li><span class="ScreenTextPACKT"><span class="packt_screen">Wait For First Frame</span></span> (Checked)</li>
<li><span class="ScreenTextPACKT"><span class="packt_screen">Render Mode</span></span>: <span class="packt_screen">Camera Far Plane</span></li>
<li><span class="ScreenTextPACKT"><span class="packt_screen">Camera</span></span>: <span class="packt_screen"><span class="ScreenTextPACKT">Main Camera</span> (Camera)</span></li>
</ul>
</li>
<li>Drag the v<span class="KeyPACKT">ideo clip</span> asset file <span class="ScreenTextPACKT">videoTexture</span> from the <span class="KeyWordPACKT">Project</span> panel into the <span class="ScreenTextPACKT">Video Clip</span> property slot in the <span class="KeyWordPACKT">Inspector, like so:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/94eec315-4dc5-4382-afce-fd3a7e7575e1.png" style="width:38.67em;height:18.25em;"/></p>
<ol start="5">
<li>Test your s<span class="KeyWordPACKT">cene</span>. You should be able to see the movie being played behind the sc<span class="KeyWordPACKT">ene</span> content.</li>
<li>You can choose whether to stretch the video content by changing the <span class="ScreenTextPACKT"><span class="packt_screen">Aspect Ratio</span></span> property in the <span class="KeyWordPACKT">Inspector</span> (for example, you can change it to <span class="ScreenTextPACKT">Stretch in order t</span>o fill in the complete background of the screen).</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>We gave the <span class="ScreenTextPACKT">Video Player</span> component a reference to a <span class="ScreenTextPACKT">Video Clip</span> asset file. Since we added the <span class="ScreenTextPACKT">Video Player</span> component to a <span class="KeyWordPACKT">Camera</span> (the <span class="KeyWordPACKT">Main Camera,</span> in this example), it automatically chose the <span class="KeyWordPACKT">Camera</span> <span class="ScreenTextPACKT">Far Play Render Mode</span> linked to the <span class="KeyWordPACKT">Main Camera</span>.</p>
<p>The default setting is <span class="ScreenTextPACKT">Play On Awake</span>, so as soon as the first frame has loaded (since <span class="ScreenTextPACKT">Wait For First Frame</span> is also checked by default), the video will start playing. The video is displayed behind all m<span class="KeyWordPACKT">ain camera</span> content (the <span class="ItalicsPACKT">far</span> plane). Because of this, we see our <span class="KeyWordPACKT">3D Cube</span> in the s<span class="KeyWordPACKT">cene</span>, with the video playing in the background.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Here are some additional ways to work with the <span class="ScreenTextPACKT">Video Player</span> component.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Semi-transparent video and Camera Near Plane</h1>
                </header>
            
            <article>
                
<p>Sometimes, we may want to play a video so that it's the user's main focus, but allow them to see s<span class="KeyWordPACKT">cene</span> objects in the background.</p>
<p>To achieve this with the <span class="ScreenTextPACKT">Video Player</span> component, we just need to make two changes:</p>
<ol>
<li>Change the <span class="ScreenTextPACKT">Render Mode</span> to <span class="ScreenTextPACKT">Near Camera Plane</span> (so that the video content is played <span class="ItalicsPACKT">in front of</span> the s<span class="KeyWordPACKT">cene</span> content).</li>
<li>To allow the user to partially see through the video, we need to make the <span class="ScreenTextPACKT">Video Player</span> semi-transparent. Change its <span class="ScreenTextPACKT">Alpha</span> property to 0.5.</li>
</ol>
<p>Now, when you run the s<span class="KeyWordPACKT">cene</span>, you'll see the video playing in front of s<span class="KeyWordPACKT">cene</span> content, but now you will be able to see the <span class="KeyWordPACKT">3D cube</span> in the background.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Audio issues and AudioSource solution</h1>
                </header>
            
            <article>
                
<p>At the time of writing this book, there seem to be issues with the <span class="ScreenTextPACKT">Direct</span> option for <span class="ScreenTextPACKT">Audio Output Mode</span> audio playback for some non-Apple systems. One solution is to add an <span class="ScreenTextPACKT">AudioSource</span> component to the same GameObject that has the <span class="ScreenTextPACKT">VideoPlayer</span> component, and to set the <span class="ScreenTextPACKT">Audio Output Mode</span> to <span class="ScreenTextPACKT">AudioSource</span>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using scripting to control video playback on scene textures</h1>
                </header>
            
            <article>
                
<p>While the last recipe demonstrated how we can plan videos using the <span class="ScreenTextPACKT">Video Player</span> component that's set up at d<span class="KeyWordPACKT">esign time</span>, much more is possible when controlling video playback through scripting.</p>
<p>In this recipe, we'll using scripting to play/pause the playback of a video rendered onto a <span class="KeyWordPACKT">3D cube:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/d4333282-1119-4ece-94ac-4daf280a1f0d.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>If you need a video file to follow this recipe, please use the <kbd><span class="ScreenTextPACKT">videoTexture.mov</span></kbd> file included in the <kbd>13_01</kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To use scripting to control video playback, follow these steps:</p>
<ol>
<li>Import the provided <kbd><span class="ScreenTextPACKT">videoTexture.mov</span></kbd> file.</li>
<li>Create a <span class="KeyWordPACKT">3D cube by choosing</span> menu: <span class="ScreenTextPACKT"><span class="packt_screen">Create</span> | <span class="packt_screen">3D</span> | <span class="packt_screen">Cube</span></span>.</li>
</ol>
<ol start="3">
<li>Create a C# script class named <kbd><span class="ScreenTextPACKT">PlayPauseMainTexture</span></kbd>, and attach an instance object as a component to your <span class="ScreenTextPACKT">3D cube</span> GameObject:</li>
</ol>
<pre style="padding-left: 60px">using UnityEngine;<br/>     using UnityEngine.Video;<br/> <br/>     [RequireComponent(typeof(VideoPlayer))]<br/>     [RequireComponent(typeof(AudioSource))]<br/> <br/>     public class PlayPauseMainTexture : MonoBehaviour {<br/>         public VideoClip videoClip;<br/> <br/>         private VideoPlayer videoPlayer;<br/>         private AudioSource audioSource;<br/> <br/>         void Start() {<br/>             videoPlayer = GetComponent&amp;lt;VideoPlayer&amp;gt;();<br/>             audioSource = GetComponent&amp;lt;AudioSource&amp;gt;();<br/> <br/>             videoPlayer.playOnAwake = false;<br/>             audioSource.playOnAwake = false;<br/> <br/>             videoPlayer.source = VideoSource.VideoClip;<br/>             videoPlayer.clip = videoClip;<br/> <br/>             videoPlayer.audioOutputMode = VideoAudioOutputMode.AudioSource;<br/>             videoPlayer.SetTargetAudioSource(0, audioSource);<br/> <br/>             videoPlayer.renderMode = VideoRenderMode.MaterialOverride;<br/>             videoPlayer.targetMaterialRenderer = GetComponent&amp;lt;Renderer&amp;gt;();<br/>             videoPlayer.targetMaterialProperty = "_MainTex";<br/>         }<br/> <br/>         void Update() {<br/>             if (Input.GetButtonDown("Jump"))<br/>                 PlayPause();<br/>         }<br/> <br/>         private void PlayPause() {<br/>             if (videoPlayer.isPlaying)<br/>                     videoPlayer.Pause();<br/>             else<br/>                 videoPlayer.Play();<br/>         }<br/>     } </pre>
<ol start="4">
<li>Ensure that your <span class="KeyWordPACKT">3D cu</span><span class="KeyWordPACKT">be</span> is selected in the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel. Then, drag the <span class="ScreenTextPACKT">Video Clip</span> asset file <span class="ScreenTextPACKT"><kbd>videoTexture</kbd></span> from the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel into the <span class="ScreenTextPACKT">Video Clip</span> property slot of the <span class="ScreenTextPACKT"><kbd>PlayPauseMainTexture</kbd> component (script)</span> in the <span class="KeyWordPACKT">Inspector</span>.</li>
<li>Run your s<span class="KeyWordPACKT">cene</span>. Pressing the spacebar should play/pause playback of the video on the surfaces of the <span class="KeyWordPACKT">3D cube</span>. You should also hear the beeping audio for video.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>We added the instance object of our scripted class to the <span class="KeyWordPACKT">3D cube</span>, and dragged a reference to a <span class="ScreenTextPACKT">Video Clip</span> asset file to the public slot. In our code, we are telling the <span class="KeyWordPACKT">VideoPlayer</span> component to override the <span class="KeyWordPACKT">Material</span> of the object it is a component of (in this case, the <span class="ScreenTextPACKT">3D cube</span>) so that the <span class="ScreenTextPACKT">Video Player</span> will render (display) onto the main t<span class="KeyWordPACKT">exture</span> of the <span class="ScreenTextPACKT">3D cube</span>:</p>
<pre>videoPlayer.renderMode = VideoRenderMode.MaterialOverride;<br/> videoPlayer.targetMaterialRenderer = GetComponent&amp;lt;Renderer&amp;gt;();<br/> videoPlayer.targetMaterialProperty = "_MainTex";<br/> </pre>
<p class="SourceCode">The basics to using scripting and the <span class="ScreenTextPACKT">VideoPlayer</span> is as follows. As well as defining and setting up where the <span class="ScreenTextPACKT">Video Player</span> will render, we also need to do the following each time:</p>
<ol>
<li>Create or get references to the <span class="ScreenTextPACKT">VideoPlayer</span> and <span class="ScreenTextPACKT">AudioSource</span> components (we will automatically have both components for this recipe since we have the <kbd><span class="CodeInTextPACKT">RequireComponent(...)</span></kbd> script instructions immediately before our class declaration):</li>
</ol>
<pre class="SourceCode" style="padding-left: 60px"><span>videoPlayer = GetComponent&amp;lt;VideoPlayer&amp;gt;();<br/> audioSource = GetComponent&amp;lt;AudioSource&amp;gt;();</span></pre>
<ol start="2">
<li>Set their <span class="ScreenTextPACKT">Play On A</span><span class="ScreenTextPACKT">wake</span> to <span class="ScreenTextPACKT"><kbd>true</kbd>/<kbd>false</kbd></span>:</li>
</ol>
<pre style="padding-left: 60px">videoPlayer.playOnAwake = false;<br/> audioSource.playOnAwake = false; </pre>
<ol start="3">
<li>Define where the <span class="ScreenTextPACKT">Video Player</span> will find a reference to the <span class="ScreenTextPACKT">Video Clip</span> to play:</li>
</ol>
<pre style="padding-left: 60px">videoPlayer.source = VideoSource.VideoClip;<br/> videoPlayer.clip = videoClip; </pre>
<ol start="4">
<li>Define the audio settings (so that you can output to the <span class="ScreenTextPACKT">AudioSource</span> component):</li>
</ol>
<pre style="padding-left: 60px">videoPlayer.audioOutputMode = VideoAudioOutputMode.AudioSource;<br/> videoPlayer.SetTargetAudioSource(0, audioSource); </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Here are some additional ways to work with <span class="ScreenTextPACKT">Video Player</span> scripting.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Ensuring that a movie's prepared before playing it with the prepareCompleted event</h1>
                </header>
            
            <article>
                
<p>In the preceding recipe, the movie has time to prepare since the game waits until we press the jumo/space key. If we are using scripting to set up a <span class="ScreenTextPACKT">Video Player</span> for a v<span class="ScreenTextPACKT">ideo clip</span>, we need to do some initial work before the video is ready to play. Unity provides the <kbd><span class="CodeInTextPACKT">prepareCompleted</span></kbd> event, which allows us to register a method to be invoked once a <span class="ScreenTextPACKT">VideoPlayer</span> is ready to play.</p>
<p>Do the following:</p>
<ol>
<li>Add a <span class="ScreenTextPACKT">UI Raw Image</span> to the s<span class="KeyWordPACKT">cene by c</span>hoosing menu: <span class="ScreenTextPACKT"><span class="packt_screen">Create</span> | <span class="packt_screen">UI</span> | <span class="packt_screen">Raw Image</span></span>.</li>
<li>Create a new empty GameObject named <span class="ScreenTextPACKT">video-object</span>.</li>
<li>Create a C# script class named <kbd><span class="CodeInTextPACKT">PrepareCompleted</span></kbd>, and attach an instance object as a component to GameObject's <span class="ScreenTextPACKT">video-object</span>:</li>
</ol>
<pre style="padding-left: 60px">    using UnityEngine;<br/>     using UnityEngine.UI;<br/>     using UnityEngine.Video;<br/> <br/>     public class PrepareCompleted: MonoBehaviour {<br/>         public RawImage image;<br/>         public VideoClip videoClip;<br/> <br/>         private VideoPlayer videoPlayer;<br/>         private AudioSource audioSource;<br/> <br/>         void Start() {<br/>             SetupVideoAudioPlayers();<br/>             videoPlayer.prepareCompleted += PlayVideoWhenPrepared;<br/>             videoPlayer.Prepare();<br/>             Debug.Log("A - PREPARING");<br/>         }<br/> <br/>         private void SetupVideoAudioPlayers() {<br/>             videoPlayer = gameObject.AddComponent&amp;lt;VideoPlayer&amp;gt;();<br/>             audioSource = gameObject.AddComponent&amp;lt;AudioSource&amp;gt;();<br/> <br/>             videoPlayer.playOnAwake = false;<br/>             audioSource.playOnAwake = false;<br/> <br/>             videoPlayer.source = VideoSource.VideoClip;<br/>             videoPlayer.clip = videoClip;<br/> <br/>             videoPlayer.audioOutputMode = VideoAudioOutputMode.AudioSource;<br/>             videoPlayer.SetTargetAudioSource(0, audioSource);<br/>         }<br/> <br/>         private void PlayVideoWhenPrepared(VideoPlayer theVideoPlayer) {<br/>             Debug.Log("B - IS PREPARED");<br/> <br/>             image.texture = theVideoPlayer.texture;<br/> <br/>             Debug.Log("C - PLAYING");<br/>             theVideoPlayer.Play();<br/>         }<br/>     } </pre>
<ol start="4">
<li>Ensure that video-objec<span class="ScreenTextPACKT">t</span> is selected in the <span class="KeyWordPACKT"><span class="packt_screen">Projec</span>t</span> panel. Now, drag the <span class="ScreenTextPACKT">Raw Image</span> from the <span class="KeyWordPACKT">Hierarchy</span> into the <span class="ScreenTextPACKT">Raw Image</span> slot. Then, drag the <span class="ScreenTextPACKT">Video Clip</span> asset file <kbd><span class="ScreenTextPACKT">videoTexture</span></kbd> from the <span class="KeyWordPACKT">Project</span> panel into the <span class="ScreenTextPACKT">Video Clip</span> property slot of the <span class="ScreenTextPACKT"><kbd>PrepareCompleted</kbd> component (script)</span> in the <span class="KeyWordPACKT">Inspector</span>.</li>
<li>Test your s<span class="KeyWordPACKT">cene</span>. You should be able to see the movie being played behind the s<span class="KeyWordPACKT">cene</span> content.</li>
</ol>
<p>You can see that, in the <kbd><span class="CodeInTextPACKT">Start()</span></kbd> method, we first register a method named <kbd><span class="CodeInTextPACKT">PlayVideoWhenPrepared</span></kbd> with the <kbd><span class="CodeInTextPACKT">videoPlayer.prepareCompleted</span></kbd> event, before invoking the <kbd><span class="CodeInTextPACKT">Prepare()</span></kbd> method of the <kbd><span class="ScreenTextPACKT">videoPlayer</span></kbd> component:</p>
<pre>videoPlayer.prepareCompleted += PlayVideoWhenPrepared;<br/> videoPlayer.Prepare(); </pre>
<p>The <kbd><span class="CodeInTextPACKT">PlayVideoWhenPrepared(...)</span></kbd> method has to accept a parameter as a reference to a <span class="ScreenTextPACKT">VideoPlayer</span> object. We first directly assign the <span class="ScreenTextPACKT">VideoPlayer's</span> texture property to the Raw Image's texture. Then, we send the <kbd><span class="CodeInTextPACKT">Play()</span></kbd> message.</p>
<div class="packt_infobox">Directly working with the <span class="ScreenTextPACKT">VideoPlayer</span> texture works for this example, but usually setting up a separate <span class="ScreenTextPACKT">Render Texture</span> is more reliable and flexible - <span>se</span>e the following subsection for how to do this.</div>
<p>You can track progress of clip preparation and so on through the <span class="ScreenTextPACKT">Log</span> messages in the <span class="KeyWordPACKT"><span class="packt_screen">Console</span></span> panel.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Outputting video playback to a Render Texture asset</h1>
                </header>
            
            <article>
                
<p>A flexible way to work with <span class="KeyWordPACKT">Video Players</span> is to output their playback to a <span class="KeyWordPACKT">Render Texture</span> asset file. A <span class="KeyWordPACKT">Material</span> can be created to get input from the <span class="KeyWordPACKT">Render Texture</span>, and GameObjects using that <span class="KeyWordPACKT">Material</span> will display the video. Also, some GameObjects can directly have the <span class="KeyWordPACKT">Render Texture</span> assigned as their t<span class="KeyWordPACKT">exture</span>.</p>
<p>Do the following:</p>
<ol>
<li>In the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel, create a new <span class="KeyWordPACKT">Render Texture</span> asset file named <kbd><span class="ScreenTextPACKT">myRenderTexture</span></kbd> (menu: <span class="ScreenTextPACKT"><span class="packt_screen">Create</span> | <span class="packt_screen">Render Texture</span></span>).</li>
<li>Select the <span class="KeyWordPACKT">UI Raw Image</span> in the <span class="KeyWordPACKT">Hierarchy</span>, and assign its <span class="ScreenTextPACKT">Raw Image (Script)</span> t<span class="KeyWordPACKT">exture</span> property to the <kbd><span class="ScreenTextPACKT">myRenderTexture</span></kbd> asset file.</li>
<li>In the <span class="KeyWordPACKT">Project</span> panel, create a new <span class="KeyWordPACKT">Material</span> asset file named <kbd><span class="ScreenTextPACKT">m_video</span></kbd>. For this <span class="KeyWordPACKT">Material</span>, in the <span class="KeyWordPACKT">Inspector</span>, set its <span class="KeyWordPACKT">Albedo Texture</span> property to <kbd><span class="ScreenTextPACKT">myRenderTexture</span></kbd> (drag it from the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel into the <span class="KeyWordPACKT">Inspector</span>).</li>
<li>Create a new <span class="KeyWordPACKT">3D capsule</span> in the s<span class="KeyWordPACKT">cene</span>, and assign it the <span class="KeyWordPACKT">Material</span> <span class="ScreenTextPACKT">m_video</span>.</li>
<li>Edit the C# script class <kbd><span class="ScreenTextPACKT">PrepareCompleted</span></kbd> by replacing the public <kbd>rawImage</kbd> variable with a public <kbd><span class="CodeInTextPACKT">renderTexture</span></kbd> variable:</li>
</ol>
<pre style="padding-left: 60px">  public VideoClip videoClip;<br/>   public RenderTexture renderTexture; </pre>
<ol start="6">
<li>Edit the C# script class <kbd>PrepareCompleted</kbd> by adding the following statements at the end of the <kbd><span class="CodeInTextPACKT">SetupVideoAudioPlayers()</span></kbd> method to output video to <kbd><span class="ScreenTextPACKT">RenderTexture</span></kbd>:</li>
</ol>
<pre style="padding-left: 60px">    videoPlayer.renderMode = VideoRenderMode.RenderTexture;<br/>     videoPlayer.targetTexture = renderTexture; </pre>
<ol start="7">
<li>Edit the C# script class <span class="ScreenTextPACKT">PrepareCompleted</span> in the <kbd><span class="CodeInTextPACKT">PlayVideoWhenPrepared()</span></kbd> method. Remove the statement that directly assigns the <span class="ScreenTextPACKT">VideoPlayer's</span> t<span class="KeyWordPACKT">exture</span> property to the <span class="KeyWordPACKT">Raw Image's</span> T<span class="KeyWordPACKT">exture</span>:</li>
</ol>
<pre style="padding-left: 60px">    private void PlayVideoWhenPrepared(VideoPlayer theVideoPlayer) {<br/>         Debug.Log("B - IS PREPARED");<br/> <br/>         // Play video<br/>         Debug.Log("C - PLAYING");<br/>         theVideoPlayer.Play();<br/>     } </pre>
<ol start="8">
<li>Ensure that the GameObject <span class="ScreenTextPACKT">video-object</span> is selected in the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel. Now, drag the <kbd><span class="ScreenTextPACKT">myRenderTexture</span></kbd> asset from the <span class="KeyWordPACKT">Project</span> panel into the <span class="ScreenTextPACKT">Render Texture</span> public property of the <span class="ScreenTextPACKT">Prepare Completed (Script)</span> in the <span class="ItalicsPACKT">Inspector</span>.</li>
<li>Run the s<span class="KeyWordPACKT">cene</span>. You should now see the video playing both in the <span class="ScreenTextPACKT">UI Raw Image</span> and also rendered over the <span class="ScreenTextPACKT">3D Capsule</span> object:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/cd64a526-f7d8-4f1a-97b7-073c95a49bdb.png" style="width:28.33em;height:15.33em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Ensuring that the movie is prepared before playing with coroutines</h1>
                </header>
            
            <article>
                
<p>Many Unity programmers are very used to working with <span class="KeyWordPACKT">coroutines</span>, so instead of using the <kbd><span class="CodeInTextPACKT">prepareCompleted</span></kbd> event, we can rewrite the preceding script by using a <span class="KeyWordPACKT">coroutine</span>.</p>
<p>Do the following:</p>
<ol>
<li>Remove the <kbd><span class="CodeInTextPACKT">PlayVideoWhenPrepared()</span></kbd> method.</li>
<li>Add a new using statement at the top of the script (so that we can refer to <span class="CodeInTextPACKT">IEnumerator interface</span>):</li>
</ol>
<pre style="padding-left: 60px">    using System.Collections; </pre>
<ol start="3">
<li>Replace the existing <kbd><span class="CodeInTextPACKT">Start()</span></kbd> method with the following:</li>
</ol>
<pre style="padding-left: 60px">    private IEnumerator Start() {<br/>         SetupVideoAudioPlayers();<br/>         videoPlayer.Prepare();<br/> <br/>         while (!videoPlayer.isPrepared)<br/>             yield return null;<br/> <br/>         videoPlayer.Play();<br/>     } </pre>
<p>As we can see, our <kbd><span class="CodeInTextPACKT">Start()</span></kbd> method has become a <span class="KeyWordPACKT">coroutine</span> (returning an <span class="CodeInTextPACKT">IEnumerator</span>), which means that it can <span class="CodeInTextPACKT">yield</span> control back to Unity during its execution. In the next frame, it will resume execution at that same statement.</p>
<p>There is a while loop that will continue running until the <span class="CodeInTextPACKT">isPrepared</span> property is true for V<span class="CodeInTextPACKT">ideoPlayer</span>. So, each frame of Unity will return to this while loop, and if the V<span class="CodeInTextPACKT">ideoPlayer</span> is still not prepared, it enters the loop again and yields execution until the next frame. When Vi<span class="CodeInTextPACKT">deoPlayer</span> <span class="CodeInTextPACKT">isPrepared</span> is finally true, the loop condition is false, so the statement after the loop is executed (<kbd><span class="CodeInTextPACKT">videoPLayer.Play()</span></kbd>), and the method finally completes its execution.</p>
<p>For a single video, there is little to choose from between the <kbd><span class="CodeInTextPACKT">isPrepared</span></kbd> event and the preceding c<span class="KeyWordPACKT">oroutine</span>. However, for a sequence of videos, the use of the <kbd><span class="CodeInTextPACKT">isPrepared</span></kbd> and <kbd><span class="CodeInTextPACKT">loopPointReached</span></kbd> events helps us make much simpler logic for preparing and then waiting to play the next video in a sequence (see the next recipe for more information).</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Downloading an online video (rather than a clip)</h1>
                </header>
            
            <article>
                
<p>Rather than dragging an existing <span class="KeyWordPACKT">Video Clip</span> asset file to specify which video to play, the <span class="KeyWordPACKT">Video Player</span> can also download <span class="KeyWordPACKT">Video Clips</span> from an online source. We need to assign a string URL to the <span class="KeyWordPACKT">Video Player's</span> <span class="ScreenTextPACKT">URL</span> property.</p>
<p>Do the following:</p>
<ol>
<li>Declare a public array of strings, in which one or more URLs can be defined:</li>
</ol>
<pre style="padding-left: 60px">    public string[] urls = {<br/>         "http://mirrors.standaloneinstaller.com/video-sample/grb_2.mov",<br/>         "http://mirrors.standaloneinstaller.com/video-sample/lion-sample.mov"<br/>     }; </pre>
<ol start="2">
<li>Declare a new method that returns one URL string, randomly chosen from the array:</li>
</ol>
<pre style="padding-left: 60px">    public string RandomUrl(string[] urls)<br/>     {<br/>         int index = Random.Range(0, urls.Length);<br/>         return urls[index];<br/>     } </pre>
<ol start="3">
<li>Finally, in the <kbd><span class="CodeInTextPACKT">SetupVideoAudioPlayers()</span></kbd> method, we need to get the random URL string, and assign it to the <span class="ScreenTextPACKT">Video Player's</span> <kbd><span class="ScreenTextPACKT">url</span></kbd> property:</li>
</ol>
<pre style="padding-left: 60px">    private void SetupVideoAudioPlayers()<br/>     {<br/>         ... as before<br/> <br/>         // assign video clip<br/>         string randomUrl = RandomUrl(urls);<br/>         videoPlayer.url = randomUrl;<br/> <br/>         ... as before<br/>     } </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using scripting to play a sequence of videos back-to-back</h1>
                </header>
            
            <article>
                
<p>One of the advantages of scripting is that it allows us to easily work with multiple items through loops and arrays, and so on. In this recipe, we'll work with an array of <span class="KeyWordPACKT">Video Clip</span> assets and use scripting to play them back-to-back (one starts as soon as the previous clip finishes), illustrating the use of the <span class="CodeInTextPACKT">isPrepared</span> and <span class="CodeInTextPACKT">loopPointReached</span> events to avoid complicated loops and <span class="KeyWordPACKT">coroutines</span>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>If you need video files in order to follow this recipe, please use the <span class="ScreenTextPACKT"><kbd>videoTexture.mov</kbd> file</span> included in the <kbd>13_01</kbd> folder.</p>
<div class="packt_infobox"><strong>NOTE:</strong> The Standalone Installer website provides a good online source of test videos: <span class="URLPACKT">http://standaloneinstaller.com/blog/big-list-of-sample-videos-for-testers-124.html.</span></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To play a sequence of videos using scripting, follow these steps:</p>
<ol>
<li>Import the provided <kbd><span class="ScreenTextPACKT">videoTexture.mov</span></kbd> file, and perhaps a second v<span class="KeyWordPACKT">ideo clip</span>, so that we can have a sequence of two different videos to test (although you can run the same one twice if you wish).</li>
<li>In the <span class="KeyWordPACKT">Project</span> panel, create a new <span class="KeyWordPACKT">Render Texture</span> asset file named <span class="ScreenTextPACKT">myRenderTexture</span> (menu: <span class="ScreenTextPACKT"><span class="packt_screen">Create | Render Texture</span></span>).</li>
<li>Add a <span class="KeyWordPACKT">UI Raw Image</span> to the scene by choosing menu: <span class="ScreenTextPACKT"><span class="packt_screen">Create | UI | Raw Image</span></span>.</li>
<li>Select the UI Raw Image in the <span class="KeyWordPACKT">Hierarchy</span>, and assign its <span class="ScreenTextPACKT">Raw Image (Script)</span> <span class="KeyWordPACKT">Texture</span> property to the <span class="ScreenTextPACKT">myRenderTexture asset file</span>.</li>
<li>In the <span class="KeyWordPACKT">Project</span> panel, create a new Material asset file named <span class="ScreenTextPACKT">m_video</span>. For this <span class="KeyWordPACKT">Material</span>, in the Inspector, set its Albedo Texture property to <span class="ScreenTextPACKT">myRenderTexture</span> (drag it from the <span class="KeyWordPACKT">Project</span> panel into the <span class="KeyWordPACKT">Inspector</span>).</li>
<li>Create a <span class="KeyWordPACKT">3D cube by </span>choosing menu: <span class="ScreenTextPACKT"><span class="packt_screen">Create | 3D | Cube</span></span>. Assign <span class="KeyWordPACKT">the</span> <span class="ScreenTextPACKT">m_video</span> Material to your <span class="KeyWordPACKT">3D cube</span>.</li>
<li>Create a new empty GameObject named <span class="ScreenTextPACKT">video-object</span>.</li>
<li>Create a C# script class named <span class="ScreenTextPACKT">VideoSequenceRenderTexture</span>, and attach an instance object as a component to the GameObject's <span class="ScreenTextPACKT">video-object</span>:</li>
</ol>
<pre style="padding-left: 60px">    using UnityEngine;<br/>     using UnityEngine.Video;<br/> <br/>     public class VideoSequenceRenderTexture : MonoBehaviour {<br/>         public RenderTexture renderTexture;<br/>         public VideoClip[] videoClips;<br/> <br/>         private VideoPlayer[] videoPlayers;<br/>         private int currentVideoIndex;<br/> <br/>         void Start() {<br/>             SetupObjectArrays();<br/>             currentVideoIndex = 0;<br/>             videoPlayers[currentVideoIndex].prepareCompleted += PlayNextVideo;<br/>             videoPlayers[currentVideoIndex].Prepare();<br/>             Debug.Log("A - PREPARING video: " + currentVideoIndex);<br/>         }<br/> <br/>         private void SetupObjectArrays() {<br/>             videoPlayers = new VideoPlayer[videoClips.Length];<br/>             for (int i = 0; i &amp;lt; videoClips.Length; i++)<br/>                 SetupVideoAudioPlayers(i);<br/>         }<br/> <br/>         private void PlayNextVideo(VideoPlayer theVideoPlayer) {<br/>             VideoPlayer currentVideoPlayer = videoPlayers[currentVideoIndex];<br/> <br/>             Debug.Log("B - PLAYING Index: " + currentVideoIndex);<br/>             currentVideoPlayer.Play();<br/> <br/>             currentVideoIndex++;<br/>             bool someVideosLeft = currentVideoIndex &amp;lt; videoPlayers.Length;<br/> <br/>             if (someVideosLeft) {<br/>                 VideoPlayer nextVideoPlayer = videoPlayers[currentVideoIndex];<br/>                 nextVideoPlayer.Prepare();<br/>                 Debug.Log("A - PREPARING video: " + currentVideoIndex);<br/>                 currentVideoPlayer.loopPointReached += PlayNextVideo;<br/>             } else {<br/>                 Debug.Log("(no videos left)");<br/>             }<br/>         }<br/> <br/>         private void SetupVideoAudioPlayers(int i) {<br/>             string newGameObjectName = "videoPlayer_" + i;<br/>             GameObject containerGo = new GameObject(newGameObjectName);<br/>             containerGo.transform.SetParent(transform);<br/>             containerGo.transform.SetParent(transform);<br/> <br/>             VideoPlayer videoPlayer = containerGo.AddComponent&amp;lt;VideoPlayer&amp;gt;();<br/>             AudioSource audioSource = containerGo.AddComponent&amp;lt;AudioSource&amp;gt;();<br/> <br/>             videoPlayers[i] = videoPlayer;<br/> <br/>             videoPlayer.playOnAwake = false;<br/>             audioSource.playOnAwake = false;<br/> <br/>             videoPlayer.source = VideoSource.VideoClip;<br/>             videoPlayer.clip = videoClips[i];<br/> <br/>             videoPlayer.audioOutputMode = VideoAudioOutputMode.AudioSource;<br/>             videoPlayer.SetTargetAudioSource(0, audioSource);<br/> <br/>             videoPlayer.renderMode = VideoRenderMode.RenderTexture;<br/>             videoPlayer.targetTexture = renderTexture;<br/>         }<br/>     } </pre>
<ol start="9">
<li>Ensure that the GameObject <span class="ScreenTextPACKT">video-object</span> is selected in the <span class="KeyWordPACKT">Project</span> panel. Now, drag the <span class="ScreenTextPACKT">myRenderTexture asset</span> from the <span class="KeyWordPACKT">Project</span> panel into the <span class="ScreenTextPACKT">Render Texture</span> public property of the <span class="ScreenTextPACKT">PrepareCompleted (Script)</span> in the <span class="KeyWordPACKT">Inspector</span>. For the <span class="ScreenTextPACKT">Video Clips</span> property, set the size to 2 <span>–</span> you should now see two v<span class="ScreenTextPACKT">ideo clip</span> elements (elements 0 and 1). From the <span class="KeyWordPACKT">Project</span> panel, drag in a vi<span class="KeyWordPACKT">deo clip</span> to each slot.</li>
</ol>
<ol start="10">
<li>Run the s<span class="KeyWordPACKT">cene</span>. You should now see the first v<span class="ScreenTextPACKT">ideo clip</span> playing both for the <span class="ScreenTextPACKT">UI Raw Image</span> and the <span class="KeyWordPACKT">3D cube</span> surface. Once the the first v<span class="KeyWordPACKT">ideo clip</span> has finished playing, the second v<span class="KeyWordPACKT">ideo clip</span> should immediately start playing.</li>
</ol>
<div class="packt_infobox">You can track the progress of clip preparation and so on through the <span class="ScreenTextPACKT">Log</span> messages in the <span class="KeyWordPACKT">Console</span> panel.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>This script class makes the <span class="KeyWordPACKT">Video Player</span> objects output their videos to <span class="KeyWordPACKT">Render Texture's </span>asset file, <span class="ScreenTextPACKT">myRenderTexture</span>. This is used by both <span class="KeyWordPACKT">3D cube</span> and the <span class="KeyWordPACKT">UI Raw Image</span> for their surface display.</p>
<p>The <span class="CodeInTextPACKT">videoClips variable</span> is a public array of video<span class="ScreenTextPACKT"> clip</span> references.</p>
<p>The instance object of the C# script class <span class="ScreenTextPACKT">VideoSequenceRenderTexture</span> was added as a component to GameObject's <span class="ScreenTextPACKT">video-object</span>. This script will create child GameObjects of GameObject <span class="ScreenTextPACKT">video-object</span>, each containing a <span class="ScreenTextPACKT">VideoPlayer</span> and <span class="ScreenTextPACKT">AudioSource</span> component, ready to play each of the v<span class="ScreenTextPACKT">ideo clips</span> assigned in the public array's <span class="CodeInTextPACKT">videoClips variables</span>.</p>
<p>The <kbd><span class="CodeInTextPACKT">SetupObjectArrays()</span></kbd> method initializes <span class="CodeInTextPACKT">videoPlayers</span> to be an array the same length as <span class="CodeInTextPACKT">videoClips</span>. It then loops for each item, invoking <kbd><span class="CodeInTextPACKT">SetupVideoAudioPlayers(...)</span></kbd> by passing the current integer index.</p>
<p><span class="CodeInTextPACKT">The <kbd>SetupVideoAudioPlayers(...)</kbd></span> method creates a new child GameObject for GameObject's <span class="ScreenTextPACKT">video-object</span>, and adds <span class="ScreenTextPACKT">VideoPlayer</span> and <span class="ScreenTextPACKT">AudioSource</span> components to that GameObject. It sets the <span class="KeyWordPACKT">Video Player</span> <span class="ScreenTextPACKT">clip</span> property to the corresponding element in the public <span class="CodeInTextPACKT">videoClips</span> array variable. It also adds a reference to the new <span class="ScreenTextPACKT">VideoPlayer</span> component to the appropriate location in the <span class="CodeInTextPACKT">videoPlayers array</span>. It then sets the Video Player to output audio to the new <span class="ScreenTextPACKT">AudioSource</span> component, and to output its video to the <span class="CodeInTextPACKT">renderTexture</span> public variable.</p>
<p>The <kbd><span class="CodeInTextPACKT">Start()</span></kbd> method does the following:</p>
<ul>
<li>It invokes <kbd><span class="CodeInTextPACKT">SetupObjectArrays()</span></kbd></li>
<li>It sets the <span class="CodeInTextPACKT">currentVideoIndex variable</span> to 0 (for the first item in the arrays)</li>
<li>It registers <span class="CodeInTextPACKT"><kbd>PlayNextVideo</kbd> method</span> for the <span class="CodeInTextPACKT">prepareCompleted</span> event of the first <span class="CodeInTextPACKT">videoPlayers </span>object (<span class="CodeInTextPACKT">currentVideoIndex = 0</span>)</li>
<li>It invokes the <kbd><span class="CodeInTextPACKT">Prepare()</span></kbd> method for the <span class="CodeInTextPACKT">videoPlayers</span> object (<span class="CodeInTextPACKT">currentVideoIndex = 0</span>)</li>
<li>Finally, it logs a debug message stating that the item is preparing</li>
</ul>
<p>The <kbd><span class="CodeInTextPACKT">PlayNextVideo(...)</span></kbd> method does the following:</p>
<ul>
<li>It gets a reference to the <span class="KeyWordPACKT">Video Player</span> element of the <span class="CodeInTextPACKT">videoPlayers</span> array that corresponds to the <span class="CodeInTextPACKT">currentVideoIndex variable</span></li>
</ul>
<div class="packt_infobox">This method ignores the reference to the <span class="CodeInTextPACKT">videoPlayer</span> argument it receives <span>–</span> this parameter is required in the method declaration since it is the required <span class="ItalicsPACKT">signature</span> to allow this method to register for the <span class="CodeInTextPACKT">prepareCompleted</span> and <span class="CodeInTextPACKT">loopPointReached events.</span></div>
<ul>
<li>It sends a <kbd><span class="CodeInTextPACKT">Play()</span></kbd> message to the current <span class="KeyWordPACKT">Video Player</span></li>
<li>It then increments the value of <span class="CodeInTextPACKT">currentVideoIndex</span>, and tests whether there are any remaining v<span class="KeyWordPACKT">ideo clips</span> in the array</li>
<li>If there are remaining clips, then it gets a reference to the next clip, and sends it a <kbd><span class="CodeInTextPACKT">Prepare()</span></kbd> message; also the currently playing <span class="KeyWordPACKT">Video Player</span> has its <span class="CodeInTextPACKT">loopPointReached</span> event registered for the <span class="CodeInTextPACKT">PlayNextVideo method<br/></span> (If there are no videos left, then a simple debug log message is printed and the method ends)</li>
</ul>
<p>The clever bit is when the currently playing <span class="KeyWordPACKT">Video Player</span> has its <span class="CodeInTextPACKT">loopPointReached</span> event registered for the <span class="CodeInTextPACKT">PlayNextVideo method</span>. The <span class="CodeInTextPACKT">loopPointReached</span> event occurs when a vi<span class="KeyWordPACKT">deo clip</span> has finished playing, and will start to look again (if its loop property is <span class="CodeInTextPACKT">true</span>). What we are doing with this script is say that when the current <span class="KeyWordPACKT">Video Player video clip</span> has finished, the <kbd><span class="CodeInTextPACKT">PlayNextVideo(...)</span></kbd> method should be invoked again <span>–</span> once again using the value of currentVideoIndex to send a <kbd><span class="CodeInTextPACKT">Play()</span></kbd> message to the next <span class="KeyWordPACKT">Video Player</span>, and then testing for any remaining Video Players, and so on until the end of the array has been reached.</p>
<p>This is a good example of conditions (if statements) being used with events, rather than coroutine while loops. As long as you're happy with how methods can be registered with C# events, then this approach allows our code to be less complex by avoiding loops and <span class="KeyWordPACKT">coroutine</span> <span class="CodeInTextPACKT">yield null</span> statements.</p>
<p>In the following screenshot, we can see how our <span class="ScreenTextPACKT">video-object</span> GameObject, at <span class="KeyWordPACKT">runtime</span>, ends up with <span class="ScreenTextPACKT">videoPlayer_&amp;lt;n&amp;gt;</span> child GameObjects <span>– </span>one for each element in the array. This allows one <span class="ScreenTextPACKT">VideoPlayer</span> to be playing while the next is preparing, and so on:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/4a699930-958c-44a4-a501-da55667644ec.png" style="width:44.17em;height:17.92em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating and using a simple Shader Graph</h1>
                </header>
            
            <article>
                
<p>The new <span class="KeyWordPACKT">Shader Graph</span> feature in Unity 2018 is a powerful and exciting feature, opening up shader creation and editing to everyone, without any need for complex mathematics or coding skills. In this recipe, we'll create a simple <span class="KeyWordPACKT">Shader Graph</span> to generate a checkerboard pattern, and create a <span class="KeyWordPACKT">Material</span> that uses that shader, and apply it to a <span class="KeyWordPACKT">3D cube. The end result will be as follows:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/e3659fae-9246-4166-b56f-ec293e82a3f3.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To create and use a simple Shader Graph, follow these steps:</p>
<ol>
<li>First, we need to set up the <span class="KeyWordPACKT">Lightweight Rendering Pipeline</span>. Use the <span class="KeyWordPACKT">Package Manager</span> to import the <span class="ScreenTextPACKT">Lightweight Rendering Pipeline</span> package.</li>
<li>In the <span class="KeyWordPACKT">Project</span> panel, create a new <span class="ScreenTextPACKT">Lightweight Pipeline Asset</span> file named <span class="ScreenTextPACKT">myLightweightAsset</span>. Choose menu: <span class="packt_screen"><span class="ScreenTextPACKT">Create | Rendering | Lightweight Pipeline Asset</span></span>.</li>
<li>In the <span class="KeyWordPACKT">Inspector, </span>display the project's g<span class="ScreenTextPACKT">raphics</span> settings by choosing menu: <span class="ScreenTextPACKT"><span class="packt_screen">Edit | Project Settings | Graphics</span></span>. Then, drag <span class="ScreenTextPACKT">myLightweightAsset</span> from the <span class="KeyWordPACKT">Project</span> panel into the <span class="ScreenTextPACKT">Scriptable Render Pipeline Settings</span> property:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/29679a07-63e1-4157-8965-841f8d891138.png" style="width:38.00em;height:8.33em;"/></p>
<ol start="4">
<li>Use the Pack<span class="KeyWordPACKT">age Manager</span> to import the <span class="ScreenTextPACKT">Shader Graph</span> package.</li>
<li>In the <span class="KeyWordPACKT">Project</span> panel, create a new <span class="KeyWordPACKT">Physically-Based Rendering</span> (<span class="KeyWordPACKT">PBR</span>) <span class="KeyWordPACKT">Shader Graph</span>, named <span class="ScreenTextPACKT">myShaderGraph</span>. Choose menu: <span class="ScreenTextPACKT"><span class="packt_screen">Create | Shader | PBR Graph</span></span>.</li>
<li>In the <span class="KeyWordPACKT">Project</span> panel, create a new <span class="KeyWordPACKT">Material</span> named <span class="ScreenTextPACKT">m_cube</span>. Choose menu<span class="ScreenTextPACKT">: <span class="packt_screen">Create | Material</span></span>.</li>
<li>With the <span class="ScreenTextPACKT">m_cube</span> selected, in the <span class="KeyWordPACKT">Inspector, </span>set its <span class="KeyWordPACKT">Shader</span> property to <span class="ScreenTextPACKT">myShaderGraph</span>. For the <span class="KeyWordPACKT">Material's</span> <span class="ScreenTextPACKT">Shader</span> property, choose menu: <span class="ScreenTextPACKT"><span class="packt_screen">graphs | myShaderGraph</span>:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/016a978c-ae54-4e8f-ac9b-294a86f8b7a9.png" style="width:20.42em;height:9.08em;"/></p>
<ol start="8">
<li>Add a 3D cube to the scene (menu: <span class="ScreenTextPACKT"><span class="packt_screen">GameObject | 3D Object | Cube</span></span>). Set the <span class="KeyWordPACKT">Material</span> for this <span class="KeyWordPACKT">3D Cube</span> to <span class="ScreenTextPACKT">m_Cube.</span></li>
</ol>
<ol start="9">
<li>In the <span class="KeyWordPACKT">Project</span> panel, double click <span class="ScreenTextPACKT">myShaderGraph</span> to open the <span class="KeyWordPACKT">Shader Graph</span> editing panel. A new <span class="ScreenTextPACKT">PRB Shader Graph</span> will open with three components: (1) the BlackBoard (for publically exposing parameters); (2) the Master PRB node; (3) the output previewer node:</li>
</ol>
<div class="packt_infobox">It is easiest, when editing a <span class="KeyWordPACKT">Shader Graph</span>, to <span class="ItalicsPACKT">maximize</span> the <span class="KeyWordPACKT">Shader Graph</span> panel.</div>
<p class="CDPAlignCenter CDPAlign"><img src="assets/f836663f-0dfa-4550-b7e5-d8e519d5972e.png" style="width:37.58em;height:12.67em;"/></p>
<ol start="10">
<li>Right-click the output previewer, and select <span class="ScreenTextPACKT">Cube:</span></li>
</ol>
<div class="packt_infobox">You can zoom and rotate the preview mesh. You can also choose a custom mesh from within your project, allowing a preview of the Shader Graph on the intended destination's 3D object.</div>
<div class="CDPAlignCenter CDPAlign"><img src="assets/a07de4f3-176a-4c94-a72a-552cccc7a5e4.png"/></div>
<ol start="11">
<li>Let's flood the shader with a red color. Choose red from the color picker for the top property of the <span class="ScreenTextPACKT">PRB Master</span> node <span class="ScreenTextPACKT">Albedo</span>.</li>
<li>Create a new graph node by right-clicking the mouse and choosing menu: <span class="ScreenTextPACKT"><span class="packt_screen">Create Node | Procedural | Checkerboard</span></span>. You'll see the checkerboard patter in the preview for this node. Set the X property to 2, and the Y property to 3.</li>
<li>Now, drag a link from the checkerboard note output <span class="ScreenTextPACKT">Out(3)</span>, to the <span class="ScreenTextPACKT">Emission (3)</span> input for the <span class="ScreenTextPACKT">PRB Master</span> node. You should now see a red/pink checkerboard patter in <span class="ScreenTextPACKT">the PBR Master</span> node preview, and you'll also see the following output applied to the <span class="ScreenTextPACKT">Cube</span> mesh in the output previewer node:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/0a3af4a4-8c12-4c7d-ab3c-0d772d2968dd.png"/></p>
<ol start="14">
<li>You must save the changes to your <span class="KeyWordPACKT">Shader Graph</span> before you can see them applied to the scene. Click the <span class="ScreenTextPACKT">Save Asset</span> button on the top-left of the <span class="KeyWordPACKT">Shader Graph</span> panel.</li>
<li>Save and run your s<span class="KeyWordPACKT">cene</span>. You should see a red/pink checkerboard <span class="KeyWordPACKT">3D cube</span> being displayed.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>You enabled the <span class="ScreenTextPACKT">Lightweight Rending Pipeline</span> by installing the package, creating an asset, and choosing that asset for the Project's <span class="ScreenTextPACKT">Scriptable Rending Pipeline Graphics</span> property.</p>
<p>You then created a new <span class="KeyWordPACKT">Shader Graph</span> asset file, and a new <span class="KeyWordPACKT">Material</span> that uses your shader.</p>
<p>Your <span class="KeyWordPACKT">Shader Graph</span> feeds a procedurally generated checkerboard into the <span class="ScreenTextPACKT">Emission</span> property of the <span class="KeyWordPACKT">PBR Master</span> output node, and also tints the output by choosing a red <span class="ScreenTextPACKT">Color</span> value for the <span class="ScreenTextPACKT">Albedo</span> property. You saved the changes to your <span class="KeyWordPACKT">Shader Graph</span> asset so that they will be available when the s<span class="KeyWordPACKT">cene</span> runs.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a glow effect with Shader Graph</h1>
                </header>
            
            <article>
                
<p>In the previous recipe, a simple <span class="KeyWordPACKT">Shader Graph</span> was created by using a <span class="KeyWordPACKT">Material</span> for a primitive <span class="KeyWordPACKT">3D Cube</span> mesh. In this recipe, we'll take things further, creating a <span class="KeyWordPACKT">Shader Graph</span> that applies a parameterized glow effect to a 3D object. The end result will look as follows:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/c62fbcaf-c6c6-447a-814c-575c4dbab0d6.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>This recipe builds on the previous one, so make a copy of that project and use the copy for this recipe.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To create a glow effect with a Shader Graph, follow these steps:</p>
<ol>
<li>In the <span class="KeyWordPACKT">Project</span> panel, create a new <span class="KeyWordPACKT">Physically-Based Rendering (PBR) Shader Graph,</span> named <span class="ScreenTextPACKT">glowShaderGraph</span>. Choose menu: <span class="ScreenTextPACKT"><span class="packt_screen">Create | Shader | PBR Graph</span></span>.</li>
<li>In the <span class="KeyWordPACKT">Project</span> panel, create a new <span class="KeyWordPACKT">Material </span>named <kbd><span class="ScreenTextPACKT">m_glow</span></kbd>. Choose menu: <span class="ScreenTextPACKT"><span class="packt_screen">Create | Material</span></span>.</li>
<li><span class="ScreenTextPACKT"><span>3.</span></span> With the <span class="ScreenTextPACKT">m_glow</span> selected, in the <span class="KeyWordPACKT">Inspector,</span> set its <span class="ScreenTextPACKT">Shader</span> property to <span class="ScreenTextPACKT">glowShaderGraph</span>. For the <span class="KeyWordPACKT">Material's</span> <span class="ScreenTextPACKT">Shader</span> property, choose menu: <span class="ScreenTextPACKT"><span class="packt_screen">graphs | glowShaderGraph</span>.</span></li>
</ol>
<ol start="4">
<li>We now need a 3D mesh object in the scene that uses <kbd><span class="ScreenTextPACKT">m_glow</span></kbd>. While we could just use a <span class="ScreenTextPACKT">3D Cube</span> again, it's more fun to add a low-polygon textured character to the sc<span class="KeyWordPACKT">ene</span>. For this recipe, we've used the free Unity Asset Store character pack <span class="ScreenTextPACKT"><span class="packt_screen">Fantasy Mushroom Mon(ster)</span></span> from <span class="packt_screen">AmusedArt</span>. Once the package has been added, drag the <span class="ScreenTextPACKT">Mushroom Monster Prefab into the scene</span> from Project panel folder: <span class="ScreenTextPACKT"><span class="packt_screen">amusedART | Mushroom Monster | Prefab</span>:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b9aa2515-d5dc-4aec-8a50-c8df9d2206d8.png" style="width:37.08em;height:9.50em;"/></p>
<ol start="5">
<li>In the <span class="packt_screen">Proj<span class="KeyWordPACKT">ect</span></span> panel, double click <span class="ScreenTextPACKT"><span class="packt_screen">glowShaderGraph</span></span> to open the <span class="KeyWordPACKT"><span class="packt_screen">Shader Graph</span></span> editing panel.</li>
<li>Right-click the output previewer, select <span class="ScreenTextPACKT"><span class="packt_screen">Custom Mesh</span></span>, and choose <span class="ScreenTextPACKT"><span class="packt_screen">MushroomMon</span></span> from the selection dialog.</li>
<li>Add a new <strong>T<span class="KeyWordPACKT">exture</span></strong> exposed property to your <strong><span class="KeyWordPACKT">Shader Graph</span></strong> by creating a new property t<span class="ScreenTextPACKT">exture</span> in the <strong><span class="KeyWordPACKT">Shader Graph</span></strong> <span class="ScreenTextPACKT"><span class="packt_screen">Blackboard</span></span>. Click the plus <span class="packt_screen">+</span> button and choose property type <span class="ScreenTextPACKT"><span class="packt_screen">Texture</span></span>.</li>
<li>In the <span class="ScreenTextPACKT"><span class="packt_screen">Blackboard</span>,</span> change the <span class="packt_screen">D<span class="ScreenTextPACKT">efault</span></span> value of the property <span class="ScreenTextPACKT"><span class="packt_screen">Texture</span></span> from <span class="ScreenTextPACKT"><span class="packt_screen">None</span></span> to <span class="ScreenTextPACKT"><span class="packt_screen">Mushroom Green</span></span>.</li>
<li>To use a publically exposed <span class="packt_screen"><span class="ScreenTextPACKT">Blackboard</span></span> property in our <span class="KeyWordPACKT"><strong>Shader Graph</strong>, </span>we need to drag a reference to the property from the <span class="ScreenTextPACKT"><span class="packt_screen">Blackboard</span></span> into the <span class="ScreenTextPACKT"><span class="packt_screen">Graph</span></span> area. Drag the <span class="ScreenTextPACKT"><span class="packt_screen">Blackboard</span></span> property <span class="KeyWordPACKT">Texture</span> into the <span class="ScreenTextPACKT"><span class="packt_screen">Graph</span></span> area. You should see a new node with the title <span class="ScreenTextPACKT"><span class="packt_screen">Property</span></span>, and value <span class="ScreenTextPACKT"><span class="packt_screen">Texture (T)</span>:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/ac0e71ae-d4d4-4c3a-89e8-73b48b600156.png" style="width:22.83em;height:7.33em;"/></p>
<ol start="10">
<li>There is no <strong><span class="KeyWordPACKT">Texture</span></strong> input to the <span class="ScreenTextPACKT"><span class="packt_screen">Master PDB Node</span></span>, so we need to add a converter node that can take (sample) data from a <strong><span class="KeyWordPACKT">2D Texture</span></strong> image, and turn it into RBG values that can be sent to the <span class="ScreenTextPACKT"><span class="packt_screen">Albedo</span></span> input of the <strong><span class="ScreenTextPACKT">PBR Master Node</span></strong>. Create a new <span class="ScreenTextPACKT"><span class="packt_screen">Sample Texture 2D</span></span> node in your <span class="KeyWordPACKT"><strong>Shader Graph</strong> by right-clicking the mouse,</span> then choose menu: <span class="ScreenTextPACKT"><span class="packt_screen">Create Node | Input | Texture | Sample Texture 2D</span></span>.</li>
<li>Now, let's send the <strong><span class="KeyWordPACKT">Texture</span></strong> <span class="ScreenTextPACKT"><span class="packt_screen">Mushroom Green</span></span> into the <span class="ScreenTextPACKT"><span class="packt_screen">Master PRB Node</span></span> via the <span class="ScreenTextPACKT"><span class="packt_screen">Sample Texture 2D</span></span> converter node. Link the <span class="ScreenTextPACKT"><span class="packt_screen">Texture (T)</span></span> output from the Property node to the <span class="ScreenTextPACKT"><span class="packt_screen">Texture (T)</span></span> input of the <span class="ScreenTextPACKT"><span class="packt_screen">Sample Texture 2D</span> node</span>. You should now see the <span class="ScreenTextPACKT"><span class="packt_screen">Mushroom Green Texture</span></span> image appear in the 2D rectangular preview at the bottom of the <span class="ScreenTextPACKT"><span class="packt_screen">Sample Texture 2D node</span></span>.</li>
<li>Next, link the <span class="ScreenTextPACKT"><span class="packt_screen">RGBA (4)</span></span> output of the <span class="ScreenTextPACKT"><span class="packt_screen">Sample Texture 2D</span></span> node to the <span class="ScreenTextPACKT"><span class="packt_screen">Albedo (3)</span></span> input of the Master PRB node (Unity will intelligently just ignore the 4th <span class="ScreenTextPACKT"><span class="packt_screen">Alpha (A)</span></span> values). You should now see the <span class="ScreenTextPACKT"><span class="packt_screen">Mushroom Green Texture</span></span> image appear in the preview at the bottom of the <span class="ScreenTextPACKT"><span class="packt_screen">Master PRB</span></span> node. You should also see the <span class="ScreenTextPACKT"><span class="packt_screen">Mushroom Green Texture</span></span> being applied to the <span class="ScreenTextPACKT"><span class="packt_screen">3D Mushroom Monster Mesh</span></span> in the <strong><span class="KeyWordPACKT">Shader Graph</span></strong> output previewer node:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/135b7f81-4e15-4b0e-a312-6c7fd035e885.png"/></p>
<ol start="13">
<li>One way to create a glow effect is by applying a <span class="ScreenTextPACKT"><span class="packt_screen">Fresnel Effect</span></span>. Create a new <span class="packt_screen"><span class="ScreenTextPACKT">Fresnel E</span>ffect</span> node in our <strong><span class="KeyWordPACKT">Shader Graph</span></strong>. Link the <span class="ScreenTextPACKT"><span class="packt_screen">Out (3)</span></span> output from the <span class="ScreenTextPACKT"><span class="packt_screen">Fresnel Effect</span> node</span> to the <span class="packt_screen">Em<span class="ScreenTextPACKT">ission (3)</span></span> input of the<strong> </strong><span class="KeyWordPACKT"><strong>PRB Master</strong> node. </span>You should now see a brighter glow outline effect in the <strong><span class="KeyWordPACKT">Shader Graph</span></strong> output previewer node.</li>
</ol>
<div class="packt_infobox">Augustin-Jean Fresnel (1788-1827) studied and documented how an object's reflection depends on the viewing angle <span>–</span> for example, looking straight down into still water, there is little sunlight reflected and we can see into the water clearly. But if our eyes are closer to the level of the water (for example, if we are swimming), then much more light is reflected by the water. Simulating this effect in a digital shader is a way to make the edges of an object lighter, since light is glancing off the edges of the object and reflected to our game camera.</div>
<ol start="14">
<li>Let's tint our <span class="ScreenTextPACKT"><span class="packt_screen">Fresnel Effect</span></span> by combining it with a publicly exposed <span class="ScreenTextPACKT"><span class="packt_screen">Color</span></span> property, which can be set by game designers either in the Inspector or through C# code.</li>
<li>First, delete the link from the <span class="ScreenTextPACKT"><span class="packt_screen">Out (3)</span></span> output from the <span class="ScreenTextPACKT"><span class="packt_screen">Fresnel Effect</span> node</span> to the <span class="ScreenTextPACKT"><span class="packt_screen">Emission (3)</span></span> input of the <span class="ScreenTextPACKT"><span class="packt_screen">PBR Master</span> node.</span></li>
<li>Add a new <span class="packt_screen"><span class="ScreenTextPACKT">Color</span></span> exposed property to your <strong><span class="KeyWordPACKT">Shader Graph</span></strong> by creating a new property <span class="ScreenTextPACKT"><span class="packt_screen">Color</span></span> in the <strong><span class="KeyWordPACKT">Shader G</span><span class="KeyWordPACKT">raph</span></strong> <span class="ScreenTextPACKT"><span class="packt_screen">Blackboard</span></span>. Click the plus <span class="packt_screen">+</span> button and choose the <span class="ScreenTextPACKT"><span class="packt_screen">Color</span> property type.</span></li>
<li>In the <span class="ScreenTextPACKT"><span class="packt_screen">Blackboard</span>, </span>set the <span class="ScreenTextPACKT"><span class="packt_screen">Default</span></span> value of the Color property to red (using the Color picker).</li>
<li>Drag the <span class="ScreenTextPACKT">Blackboard's</span> <span class="ScreenTextPACKT"><span class="packt_screen">Color</span></span> property into the <span class="ScreenTextPACKT"><span class="packt_screen">Graph</span></span> area. You should see a new node with the title <span class="ScreenTextPACKT"><span class="packt_screen">Property</span> and a value of </span> <strong><span class="ScreenTextPACKT">Color(4)</span></strong>.</li>
<li>Create a new <strong><span class="ScreenTextPACKT">Multiply</span></strong> node in your <span class="KeyWordPACKT"><strong>Shader Graph</strong> by right-clicking the mouse and</span> then choosing menu: <span class="ScreenTextPACKT"><span class="packt_screen">Create Node | Math | Basic | Multiply</span></span>.</li>
</ol>
<div class="packt_infobox">The mathematical <span class="ScreenTextPACKT">Multiply</span> node is an easy way to combine values from two nodes, which are then to be passed to a single input of a third node.</div>
<ol start="20">
<li>Let's combine the <span class="ScreenTextPACKT"><span class="packt_screen">Color</span></span> and <span class="ScreenTextPACKT"><span class="packt_screen">Fresnel Effect</span></span> by making both inputs to the <span class="ScreenTextPACKT"><span class="packt_screen">Multiply</span></span> node. Link the <span class="packt_screen"><span class="ScreenTextPACKT">Color (4)</span></span> output from the <span class="ScreenTextPACKT"><span class="packt_screen">Property (Color)</span> node</span> to the <span class="ScreenTextPACKT"><span class="packt_screen">A (4)</span></span> input of the <span class="ScreenTextPACKT"><span class="packt_screen">Multiply</span> node</span>. Next, link the <span class="ScreenTextPACKT"><span class="packt_screen">Out (3)</span></span> output from the <span class="ScreenTextPACKT"><span class="packt_screen">Fresnel Effect</span></span> node to the <span class="packt_screen"><span class="ScreenTextPACKT">B (4)</span></span> input of the <span class="packt_screen">Multiply</span> node. Finally, link the <span class="packt_screen"><span class="ScreenTextPACKT">Out (3)</span></span> output from the <span class="ScreenTextPACKT"><span class="packt_screen">Fresnel Effect</span></span> node to the <span class="ScreenTextPACKT"><span class="packt_screen">Emission (3)</span></span> input of the <span class="ScreenTextPACKT"><span class="packt_screen">PRB Master</span> node.</span> You should now see a red tinted glow outline effect in the <strong><span class="KeyWordPACKT">Shader Graph</span></strong> output previewer node: <span>The overview screenshot below shows these node connections completed for our Shader Graph</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/aec5981c-5feb-4025-a7a2-c4c7bdabd1c3.png"/></p>
<ol start="21">
<li>Save your updated <span class="KeyWordPACKT"><strong>Shader Graph</strong> by </span>clicking the <span class="ScreenTextPACKT"><span class="packt_screen">Save Asset</span></span> button at the top-right of the <strong><span class="KeyWordPACKT">Shader Graph</span></strong> panel.</li>
<li>Save and run your Sc<span class="KeyWordPACKT">ene</span>. You should see a red glow around the character.</li>
<li>In the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel, locate the <strong><span class="KeyWordPACKT">Material</span></strong> that your 3D GameObject uses (for the <span class="ScreenTextPACKT">Green Mushroom Monster,</span> it is folder: <span class="ScreenTextPACKT"><span class="packt_screen">Project | amusedART | Mushroom_Monster | Materials | MusroomMonGreen</span></span>). The publicly exposed properties of the <span class="ScreenTextPACKT"><strong>Shader Graph</strong> <span class="packt_screen">Blackboard</span></span> should appear in the <strong><span class="KeyWordPACKT">Inspector</span></strong> as customizable properties. Change the <span class="ScreenTextPACKT"><span class="packt_screen">Color</span></span> property to blue. Run the s<span class="ScreenTextPACKT">cene</span> again. The glow effect around the 3D GameObject should now be blue:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/6a7a69b0-5269-4459-becb-ca27edd6f3a2.png" style="width:39.25em;height:10.25em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>You created a new <strong><span class="KeyWordPACKT">Shader Graph</span></strong>, which has several connected nodes. The output(s) of one node become the input(s) of another node.</p>
<p>You created publicly exposed properties for <span class="ScreenTextPACKT"><span class="packt_screen">Color</span></span> and <span class="ScreenTextPACKT"><span class="packt_screen">Texture</span></span> using the <strong><span class="ScreenTextPACKT">Shader Graph</span></strong> <span class="ScreenTextPACKT"><span class="packt_screen">Blackboard</span></span>, and introduced those properties as inputs in your Graph.</p>
<p>You used a <span class="ScreenTextPACKT">Sample Texture 2D</span> node to convert the <strong><span class="KeyWordPACKT">2D Texture</span></strong> image into RBG values suitable for the <strong><span class="ScreenTextPACKT">Albedo</span></strong> input for the <strong><span class="ScreenTextPACKT">PBR Master</span></strong> node.</p>
<p>You created a <span class="ScreenTextPACKT"><span class="packt_screen">Fresnel Effect</span></span> node, and combined this, via a <span class="ScreenTextPACKT"><span class="packt_screen">Multiply</span></span> node, with the publicly exposed <span class="ScreenTextPACKT"><span class="packt_screen">Color</span></span> property, sending the output into the <span class="ScreenTextPACKT"><span class="packt_screen">Emission</span></span> input of the <span class="ScreenTextPACKT"><span class="packt_screen">PRB Master</span></span> node.</p>
<p>You then learned how to change the publicly exposed property for <span class="ScreenTextPACKT"><span class="packt_screen">Color</span></span> in the <span class="ScreenTextPACKT">Inspector</span> via the <span class="KeyWordPACKT">Material's</span> properties.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Toggling a Shader Graph color glow effect through C# code</h1>
                </header>
            
            <article>
                
<p>Effects such as the glow effect from the previous recipe are often features we wish to toggle on and off under different circumstances. The effect could be turned on or off during a game to visually communicate the status of a GameObject—<span>f</span>or example, an <em><span class="ItalicsPACKT">angry</span></em> character might glow red, while a <em><span class="ItalicsPACKT">happy</span></em> monster might glow green, and so on.</p>
<p>We'll add to the previous recipe to create a new publicly exposed <strong><span class="KeyWordPACKT">Shader Graph</span></strong> <span class="ScreenTextPACKT"><span class="packt_screen">Blackboard</span></span> property named <span class="ScreenTextPACKT"><span class="packt_screen">Power</span></span>, and write code that can be used to set this value to zero or five in order to turn the glow effect on and off. We'll also access the <span class="ScreenTextPACKT"><span class="packt_screen">Color</span></span> property so that we're able to set what color the glow effect displays.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>This recipe builds on the previous one, so make a copy of that project and use the copy for this recipe.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To toggle the glow effect from the <span class="KeyWordPACKT">Shader Graph</span>, follow these steps:</p>
<ol>
<li>First, delete the link from the <span class="ScreenTextPACKT"><span class="packt_screen">Out (3)</span></span> output from the <span class="ScreenTextPACKT">Multiply</span> node to the <span class="ScreenTextPACKT"><span class="packt_screen">Emission (3)</span></span> input of the <span class="ScreenTextPACKT"><span class="packt_screen">PBR Master</span> node.</span> We are doing this because the output of this <span class="ScreenTextPACKT"><span class="packt_screen">Multiply</span></span> node will become an input for a second <span class="ScreenTextPACKT"><span class="packt_screen">Multiple</span></span> node that we are about to create.</li>
<li>Create a new <span class="packt_screen"><span class="ScreenTextPACKT">Multiply</span></span> node in your <span class="KeyWordPACKT"><strong>Shader Graph</strong> by right-clicking the mouse and </span>then choosing menu: <span class="ScreenTextPACKT"><span class="packt_screen">Create Node | Math | Basic | Multiply</span></span>.</li>
<li>Link the <span class="ScreenTextPACKT"><span class="packt_screen">Out (4)</span></span> output from the original <span class="ScreenTextPACKT"><span class="packt_screen">Multiply</span></span> node to the <span class="ScreenTextPACKT"><span class="packt_screen">A (4)</span></span> input of your new <span class="ScreenTextPACKT"><span class="packt_screen">Multiply</span></span> node. Also, link the <span class="packt_screen"><span class="ScreenTextPACKT">Out (3)</span></span> output from the new <span class="ScreenTextPACKT"><span class="packt_screen">Multiply</span></span> node to the <span class="ScreenTextPACKT"><span class="packt_screen">Emission (3)</span></span> input of the<span class="packt_screen"> <span class="ScreenTextPACKT">PBR Master</span></span> <span class="ScreenTextPACKT">node</span>.</li>
<li>Add a new <kbd><span class="ScreenTextPACKT">float</span></kbd> (decimal number), exposed to the <span class="ScreenTextPACKT"><span class="packt_screen">Power</span></span> property, to your <strong><span class="KeyWordPACKT">Shader Graph</span></strong> by creating a new property in the <strong><span class="KeyWordPACKT">Shader Graph</span></strong> <span class="ScreenTextPACKT"><span class="packt_screen">Blackboard</span></span>. Click the plus <span class="packt_screen">+</span> button and choose property type <kbd><span class="ScreenTextPACKT">Vector 1</span></kbd>, and rename this <kbd>P<span class="ScreenTextPACKT">ower</span></kbd>.</li>
<li>In the <span class="ScreenTextPACKT"><span class="packt_screen">Blackboard</span>, s</span>et the <span class="ScreenTextPACKT">Default</span> value of the <span class="ScreenTextPACKT"><span class="packt_screen">Power</span> property</span> to <kbd>5</kbd>. Also, set the display <span class="packt_screen">Mode</span> to <span class="ScreenTextPACKT"><span class="packt_screen">Slider</span> with the values of </span><span class="ScreenTextPACKT">Min</span> 0 and <span class="ScreenTextPACKT">Max</span> 5.</li>
<li>Drag the <span class="packt_screen">B<span class="ScreenTextPACKT">lackboard</span> <span class="ScreenTextPACKT">Power</span></span> property into the <span class="packt_screen"><span class="ScreenTextPACKT">Graph</span></span> area. You should see a new node with the title <span class="ScreenTextPACKT"><span class="packt_screen">Property</span></span>, and a value of <span class="ScreenTextPACKT"><span class="packt_screen">Power(1)</span></span>.</li>
<li>Finally, link the <span class="ScreenTextPACKT"><span class="packt_screen">Power(1)</span></span> output from <span class="ScreenTextPACKT">Property node (Power)</span> to the <span class="ScreenTextPACKT">B (4)</span> input of the new <span class="ScreenTextPACKT">Multiply</span> node:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/05d4056a-9c21-44ab-99cb-16c4d235c537.png"/></p>
<ol start="8">
<li>Save your updated <span class="KeyWordPACKT"><strong>Shader Graph</strong> by clicking </span>the <span class="ScreenTextPACKT"><span class="packt_screen">Save Asset</span></span> button at the top-right of the <strong><span class="KeyWordPACKT">Shader Graph</span></strong> panel.</li>
<li>Create a new C# script class named <kbd><span class="ScreenTextPACKT">GlowManager</span></kbd> containing the following:</li>
</ol>
<pre style="padding-left: 60px">    using UnityEngine;<br/> <br/>     public class GlowManager : MonoBehaviour {<br/>         private string powerId = "Vector1_AA07C639";<br/>         private string colorId = "Color_466BE55E";<br/> <br/>         void Update () {<br/>             if (Input.GetKeyDown("0"))<br/>                 GetComponent&amp;lt;Renderer&amp;gt;().material.SetFloat(powerId, 0);<br/> <br/>             if (Input.GetKeyDown("1"))<br/>                 SetGlowColor(Color.red);<br/> <br/>             if (Input.GetKeyDown("2"))<br/>                 SetGlowColor(Color.blue);<br/>         }<br/> <br/>         private void SetGlowColor(Color c) {<br/>             GetComponent&amp;lt;Renderer&amp;gt;().material.SetFloat(powerId, 5);<br/>             GetComponent&amp;lt;Renderer&amp;gt;().material.SetColor(colorId, c);<br/>         }<br/>     } </pre>
<ol start="10">
<li>Select <strong>Shade<span class="KeyWordPACKT">r Graph</span></strong> <span class="packt_screen"><span class="ScreenTextPACKT">glo</span><span class="ScreenTextPACKT">wShaderGraph</span></span> in the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel, and view its properties in the <span class="KeyWordPACKT"><span class="packt_screen">Inspector</span>:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/513e2e16-bfd0-4367-8b45-7d0a1294baa9.png" style="width:34.83em;height:10.33em;"/></p>
<ol start="11">
<li>Find the internal IDs of the publicly exposed properties <span class="ScreenTextPACKT">Power</span> and <span class="ScreenTextPACKT">Color</span> <span>–</span> they will be something like <span class="ScreenTextPACKT">Vector1_AA07C639</span> and <span class="ScreenTextPACKT">Color_466BE55E</span>. Copy these IDs into C# script statements by setting the ID strings:</li>
</ol>
<pre>    private string powerId = "Vector1_AA07C639";<br/>    private string colorId = "Color_466BE55E"; </pre>
<div class="packt_infobox">At the time of writing this book, the current version of <span class="KeyWordPACKT"><strong>Shader Graph</strong></span> doesn't provide a convenient way to access exposed properties using the names chosen in the <span class="KeyWordPACKT">Shader Graph</span> <span class="ScreenTextPACKT">Blackboard,</span> hence the need to look up the internal ID needed for the <kbd><span class="CodeInTextPACKT">material.SetFloat(powerId, power)</span></kbd> statement when changing the value. It is likely that Unity will soon update the <strong><span class="KeyWordPACKT">Shader Graph</span></strong> scripting API to make this action more straightforward.</div>
<ol start="12">
<li>In the <span class="packt_screen">Hierarchy</span>, locate the component of your 3D GameObject that contains the <span class="packt_screen">Mesh Re<span class="ScreenTextPACKT">nderer</span></span> component (for our <span class="ScreenTextPACKT"><span class="packt_screen">Mushroom Monster</span></span> example, this is the <span class="ScreenTextPACKT"><span class="packt_screen">Mushroom Mon</span></span> child of the <span class="ScreenTextPACKT"><span class="packt_screen">Mushroom Monster</span></span> GameObject). Add an instance object of the <kbd><span class="ScreenTextPACKT">GlowManager</span></kbd> script class as a component to this <strong>GameObject</strong>.</li>
<li>Save and run your <span class="packt_screen">S<span class="KeyWordPACKT">cene</span></span>. Pressing the <em>1</em> key should turn on the red glow effect, pressing the <em>2</em> key should turn on the blue glow effect, and pressing the <em>0</em> key should turn off the glow effect.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>You created a new <span class="packt_screen"><span class="ScreenTextPACKT">Power</span></span> exposed property for your <strong><span class="KeyWordPACKT">Shader Graph</span></strong> that combined with the <span class="ScreenTextPACKT"><span class="packt_screen">Fresnel</span></span> color effect so that a value of <span class="ScreenTextPACKT"><span class="packt_screen">zero</span></span> will turn off the effect. You looked up the internal IDs of the <span class="ScreenTextPACKT"><span class="packt_screen">Power</span></span> and <span class="ScreenTextPACKT"><span class="packt_screen">Color</span></span> exposed properties, and updated the C# script so that it can update these properties.</p>
<p>The scriptclass checks for the 0/1/2 keys, and correspondingly turns the effect off/to a red glow/to a blue glow.</p>
<p>By combining publicly exposed properties with code, you are able to change <strong><span class="KeyWordPACKT">Shader Graph</span></strong> values at runtime through events detected by code.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Here are some ways to take your <strong>Shader Graph</strong> features even further.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using Sine Time to create a pulsating glow effect</h1>
                </header>
            
            <article>
                
<p>You could make the glow effect <em><span class="ItalicsPACKT">pulse</span></em> by creating a <span class="ScreenTextPACKT"><span class="packt_screen">Time</span></span> node, and linking the <span class="ScreenTextPACKT">Sine <span class="packt_screen">Time (1)</span></span> output to the <span class="ScreenTextPACKT"><span class="packt_screen">Fresnel Effect</span></span> input <span class="ScreenTextPACKT"><span class="packt_screen">Power (1)</span></span>. As the <span class="ScreenTextPACKT">Sine Time</span> value changes between - 1/0/+1, it will influence how strong the <span class="ScreenTextPACKT"><span class="packt_screen">Fresnel Effect</span></span> is, changing the brightness of the glow effect.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using the Compile and Show Code button as another way to find exposed property IDs</h1>
                </header>
            
            <article>
                
<p>When you are viewing the properties of a <strong><span class="KeyWordPACKT">Shader Graph</span></strong> asset in the <strong>Inspector</strong>, you'll see a button entitled <span class="ScreenTextPACKT"><span class="packt_screen">Compile and Show Code</span></span>. If you click this, you'll then see a generated <span class="ScreenTextPACKT"><span class="packt_screen">ShaderLab</span></span> code file in your script editor.</p>
<p>It isn't the actual code used by Unity, but it provides a good idea of the code that is generated from your <strong><span class="KeyWordPACKT">Shader Graph</span></strong>. The internal IDs for your publicly exposed <span class="ScreenTextPACKT"><span class="packt_screen">Blackboard</span></span> properties are listed in the <span class="CodeInTextPACKT">Properties</span> section, which is at the beginning of the generated code:</p>
<pre>Shader "graphs/glowShaderGraph" {<br/>    Properties { 

     [NoScaleOffset]  Texture_C5AA766B ("Texture", 2D) = "white" { }<br/>      Vector1_AA07C639 ("Power", Range(0.000,5.000)) = 5.000 

     Color_466BE55E ("Color", Color) = (1.000,0.000,0.038368,0.000)<br/>    } 

   etc. </pre>


            </article>

            
        </section>
    </body></html>