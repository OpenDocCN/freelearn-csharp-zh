

# 部署到生产环境

在本章中，我们将探讨我们在将 Blazor 应用程序部署到生产环境时拥有的不同选项。由于选项很多，详细说明它们将是一本单独的书。

我们不会深入探讨，而是会涵盖我们需要考虑的不同事项，以便我们可以部署到任何提供商。

最后，部署是我们为了利用我们所构建的内容而需要做的事情。

在本章中，我们将涵盖以下内容：

+   持续交付选项

+   主机选项

# 技术要求

本章是关于一般部署的，因此我们不需要任何代码。

# 持续交付选项

当将任何内容部署到生产环境时，我们应该考虑确保移除不确定因素。例如，如果我们是从自己的机器上部署，我们如何知道它是最新版本？我们如何知道我们的队友最近没有解决问题，而我们分支中没有修复？坦白说，我们甚至不知道源控制中的版本是否与生产中的版本相同，或者生产中的版本是否存在于源控制中？你知道那句老话：“朋友不会让朋友右键点击并发布”（到生产环境中，那就是）？

这就是**持续集成**和**持续交付/部署**（**CI/CD**）出现的地方。我们确保有其他东西将部署到生产环境中。关于部署可以写整本书，所以我们不会深入这个主题。

GitHub Actions 和 Azure DevOps（或 Azure Pipelines）是微软的两个 CI/CD 产品。还有很多其他产品，如 Jenkins、TeamCity 和 GitLab——列表很长。如果我们目前使用的 CI/CD 系统支持部署 ASP.NET，它将能够处理 Blazor，因为最终，Blazor 只是一个 ASP.NET 网站。

如果我们有测试（我们应该有），我们还应该确保将测试设置为 CI/CD 管道的一部分。好事是，我们不需要添加任何特定的硬件来测试我们的组件；如果我们的 CI/CD 管道可以运行单元测试，它就会工作。

由于 Blazor 是 ASP.NET，我们没有任何阻止我们进一步进行网站自动化测试的理由。

还有一种叫做**wasm-tools**的东西，我们将在第十六章“深入 WebAssembly”中探讨。

# 主机选项

当涉及到托管 Blazor 时，有许多选项。任何可以托管 ASP.NET Core 站点的云服务都应该能够无任何问题地运行 Blazor。

我们需要考虑一些事情，让我们逐一探讨选项。

## 托管 Blazor Server/InteractiveServer

如果云提供商可以启用/禁用 WebSockets，我们希望启用它们，因为 SignalR 使用的就是该协议。

有时，云服务提供商可能支持.NET Core 3.x，但不支持.NET 8。但不用担心；通过确保以自包含模式发布我们的应用程序，我们确保部署还添加了运行项目所需的任何文件（这可能不是所有托管提供商都适用）。

这也是确保我们运行在期望的确切框架版本上的一个好方法。

## 运行交互式 WebAssembly

交互式 WebAssembly 使用.NET Core 后端（就像我们为博客所做的那样），我们托管了一个.NET Core 网站，因此托管 Blazor 服务器的规则同样适用。对于我们的博客，我们还添加了 SignalR，因此我们还需要启用 WebSocket。

## 托管 Blazor WebAssembly 独立版本

如果我们使用 Blazor WebAssembly 独立模板，我们不需要考虑.NET Core 托管。我们可以在 Azure Static Web Apps 或 GitHub Pages 上托管我们的应用程序。这是做 Blazor WebAssembly 独立站点的优点之一。

## 在 IIS 上托管

我们还可以在**互联网信息服务器**（**IIS**）上托管我们的应用程序。安装托管包，如果机器上安装了 IIS，它还会确保包含 ASP.NET Core IIS 模块。

您需要确保在服务器上启用 WebSocket 协议。

我们目前在我们的网站上运行 IIS，并使用 Azure DevOps 来部署我们的网站。由于我们使用 Blazor 服务器，停机时间非常明显。一旦 Web 丢失了 SignalR 连接，网站将显示重新连接的消息。

对于我们使用的网站，在部署新版本时大约有 8 到 10 秒的停机时间，这相当快。

# 摘要

在本章中，我们讨论了为什么我们应该使用 CI/CD，因为它在确保应用程序质量方面有很大差异。我们查看了一些我们需要做的事情，以便在任何支持.NET 8 的云服务提供商上运行我们的 Blazor 应用程序。

部署可能是应用程序中最重要的一步。如果没有部署我们的应用程序，它就只是代码。在本章中提到的诸如 CI/CD、托管和部署等事项，我们现在已经准备好部署代码。

在下一章中，我们将更深入地探讨如何将现有网站移植，使用 Blazor 与其他技术结合，或者使用其他技术与 Blazor 结合。
