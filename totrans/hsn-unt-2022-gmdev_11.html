<html><head></head><body>
  <div id="_idContainer608" class="Basic-Text-Frame">
    <h1 class="chapterNumber">11</h1>
    <h1 id="_idParaDest-141" class="chapterTitle">Visual Effects with Particle Systems and Visual Effect Graph</h1>
    <p class="normal">In this chapter, we will continue learning about visual effects for our game. We will be discussing particle systems, a way to simulate fire, waterfalls, smoke, and all kinds of fluids. Also, we will see the two Unity <strong class="keyWord">particle systems</strong> to create these kinds of effects, <strong class="keyWord">Shuriken</strong>, and <strong class="keyWord">Visual Effect Graph</strong>, the latter being more powerful than the first but requiring more hardware. </p>
    <p class="normal">In this chapter, we will cover the following particle system topics: </p>
    <ul>
      <li class="bulletList">Introduction to Shuriken particle systems</li>
      <li class="bulletList">Creating fluid simulations</li>
      <li class="bulletList">Creating complex simulations with Visual Effect Graph</li>
    </ul>
    <h1 id="_idParaDest-142" class="heading-1">Introduction to Shuriken particle systems</h1>
    <p class="normal">All graphics <a id="_idIndexMarker692"/>and effects we have created so far use static meshes—3D models that can’t be skewed, bent, or deformed in any way. <strong class="keyWord">Fluids</strong> such as fire and smoke clearly can’t be represented using this kind of mesh, but actually, we can simulate these effects with a combination of static meshes, and this is where particle systems are useful. </p>
    <p class="normal"><strong class="keyWord">Particle systems</strong> are objects <a id="_idIndexMarker693"/>that emit and animate lots of <strong class="keyWord">particles </strong>or <strong class="keyWord">billboards</strong>, which are simple quad meshes that face the camera. Each particle is a static mesh, but rendering, animating, and combining lots of them can generate the illusion of a fluid. </p>
    <p class="normal">In <em class="italic">Figure 11.1</em> you can see a smoke effect using particle systems on the left, and on the right, the <strong class="keyWord">Wireframe</strong> view of the same particles. There you can see the quads that create the illusion of smoke, which is done by applying a smoke texture <a id="_idIndexMarker694"/>to each of the particles and animating them, so they spawn at the bottom and move up in random directions:</p>
    <figure class="mediaobject"><img src="../Images/B18585_11_01.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.1: On the left side, a smoke particle system; on the right side, the wireframe of the same system</p>
    <p class="normal">In this section, we will cover the following topics related to particles:</p>
    <ul>
      <li class="bulletList">Creating a basic particle system with Shuriken</li>
      <li class="bulletList">Using advanced modules</li>
    </ul>
    <p class="normal">Let’s start by discussing how to create our very first particle system using Shuriken.</p>
    <h2 id="_idParaDest-143" class="heading-2">Creating a basic particle system with Shuriken</h2>
    <p class="normal">To illustrate <a id="_idIndexMarker695"/>the creation of a particle system, let’s create an explosion effect. The idea is to spawn lots of particles at once and spread them in all directions. Let’s start with creating the Shuriken particle system and configuring the basic settings it provides to change its default behavior. To do so, follow these steps:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Select the <strong class="screenText">GameObject | Effects | Particle System</strong> option:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_02.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.2: Particle System button</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">You should <a id="_idIndexMarker696"/>see the effect in the following screenshot. The default behavior is a column of particles going up, like the smoke effect shown previously. Let’s change that:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_03.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.3: Default particle system appearance</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">Click the created object in the scene and look at the Inspector.</li>
      <li class="numberedList">Open the <strong class="screenText">Shape</strong> section by clicking on the title. Here you will be able to specify the particle emitter shape from where the particles are going to be spawned.</li>
      <li class="numberedList">Change the <strong class="screenText">Shape</strong> property to <strong class="screenText">Sphere</strong>. Now the particles should move in all possible directions instead of following the default cone:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_04.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.4: Shape properties</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">In the particle system <strong class="keyWord">module</strong> (usually known as <strong class="screenText">Main</strong>) set <strong class="screenText">Start Speed</strong> to <code class="inlineCode">10</code>. This will make the particles move faster.</li>
      <li class="numberedList">In the same module, set <strong class="screenText">Start Lifetime</strong> to <code class="inlineCode">0.5</code>. This specifies how long a particle <a id="_idIndexMarker697"/>will live. In this case, we have given a lifetime of half a second. In combination with the speed (10 meters per second), this makes the particles disappear after moving 5 meters:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_05.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.5: Main Particle System module</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="8">Open the <strong class="screenText">Emission</strong> module and set <strong class="screenText">Rate over Time</strong> to <code class="inlineCode">0</code>. This property specifies how many particles will be emitted per second, but for an explosion, we actually need a burst of particles, so we won’t emit particles constantly over time in this case.</li>
      <li class="numberedList">In the <strong class="screenText">Bursts</strong> list, click the <strong class="screenText">+</strong> button at the bottom, and in the created item in the list, set the count column to <code class="inlineCode">100</code>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_06.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.6: Emission module</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="10">In the <strong class="screenText">Main</strong> module (the one titled <strong class="screenText">Particle System</strong>) set <strong class="screenText">Duration</strong> to <code class="inlineCode">1</code> and uncheck <strong class="screenText">Looping</strong>. In <a id="_idIndexMarker698"/>our case, the explosion won’t repeat constantly; we just need one explosion:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_07.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.7: Looping checkbox</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="11">Now that the particle isn’t looping, you need to manually hit the <strong class="screenText">Play</strong> button that is shown in the <strong class="screenText">Particle Effect</strong> window in the bottom-right part of the Scene view to see the system. If you don’t see that window, remember to first select the GameObject with the Particle System in the Hierarchy.</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_08.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.8: Particle system playback controls</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="12">Set <strong class="screenText">Stop Action</strong> to <strong class="screenText">Destroy</strong>. This will destroy the object when the <strong class="screenText">Duration</strong> time has passed. This will just work when you are running the game, so you can safely use this configuration while editing your scene:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_09.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.9: Stop Action set to Destroy</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="13">Set the <strong class="screenText">Start Size</strong> of the <strong class="screenText">Main</strong> module to <code class="inlineCode">3</code>. This will make the particles bigger so they seem denser:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_10.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.10: Particle system Start Size</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="14">Click on <a id="_idIndexMarker699"/>the down-pointing arrow at the right of the <strong class="screenText">Start Rotation</strong> property of the <strong class="screenText">Main</strong> module and select <strong class="screenText">Random Between Two Constants</strong>.</li>
      <li class="numberedList">Set the <strong class="screenText">Start Rotation</strong> to <code class="inlineCode">0</code> and <code class="inlineCode">360</code> in the two input values that appeared after <em class="italic">step 14</em>. This allows us to give the particles a random rotation when they spawn to make them look slightly different from each other:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_11.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.11: Random Start Rotation</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="16">Now the particles behave as expected, but they don’t look as expected. Let’s change that. Create a new material by clicking on the <strong class="screenText">+</strong> icon in the Project view and selecting <strong class="screenText">Material</strong>. Call it <code class="inlineCode">Explosion</code>.</li>
      <li class="numberedList">Set its shader to <strong class="screenText">Universal Render Pipeline/Particles/Unlit</strong>. This is a special shader that is used to apply a texture to the Shuriken particle system:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_12.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.12: Particle system material shader</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="18">Download a <a id="_idIndexMarker700"/>smoke particle texture from the internet or the <strong class="screenText">Asset Store</strong>. In this case, it is important to download one with a black background; ignore the others:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_13.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.13: Smoke particle texture</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="19">Set this texture as the <strong class="screenText">Base Map</strong> of the material.</li>
      <li class="numberedList">Set the <strong class="screenText">Surface Type</strong> to <strong class="screenText">Transparent</strong> and the <strong class="screenText">Blending Mode</strong> to <strong class="screenText">Additive</strong>. Doing this will make the particles blend with each other, instead of being drawn on each other, to simulate a big mass of smoke instead of individual smoke puffs. We use <strong class="screenText">Additive</strong> mode because our texture has a black background and because we want to create a lighting effect (the explosion will brighten the scene):</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_14.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.14: Surface options for particles</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="21">Drag your material to the <strong class="screenText">Material</strong> property of the <strong class="screenText">Renderer</strong> module:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_15.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.15: Particle material settings</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="22">Now your <a id="_idIndexMarker701"/>system should look like the following figure:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_16.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.16: Result of the previous settings</p>
    <p class="normal">With those steps, we have changed how the particles or billboards will spawn (using the <strong class="screenText">Emission</strong> module), in which direction they will move (using the <strong class="screenText">Shape</strong> module), how fast they will move, how long they will last, how big they will be (using the <strong class="screenText">Main</strong> module), and what they will look like (using the <strong class="screenText">Renderer</strong> module). Creating particle systems is a simple case of properly configuring their different settings. Of course, doing it properly is an art on its own; it requires creativity and knowledge of how to use all the settings and configurations they provide. So, to increase our skillset, let’s discuss some advanced modules.</p>
    <h2 id="_idParaDest-144" class="heading-2">Using advanced modules</h2>
    <p class="normal">Our system <a id="_idIndexMarker702"/>looks nice, but we can improve it a lot, so let’s enable some new modules to increase its quality:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Check the checkbox on the left of <strong class="screenText">Color over Lifetime</strong> to enable it:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_17.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.17: Enabling the Color over Lifetime module</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">Open the module by clicking on the title, and click the white bar on the right of the <strong class="screenText">Color</strong> property. This will open the gradient editor.</li>
      <li class="numberedList">Click slightly to the right of the top-left white marker in the bar to create a new marker. Also, click slightly to the left of the top-right white marker to create the fourth marker. These markers will allow us to specify the transparency of the particles during their life:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_18.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.18: Color over Lifetime gradient editor</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">If you created unwanted markers, just drag them outside the window to remove them.</li>
      <li class="numberedList">Click on the top-left marker (not the one we created, the one that was already there) and set the <strong class="screenText">Alpha</strong> slider at the bottom to <code class="inlineCode">0</code>. Do the same with the top-right marker, as shown in the following screenshot. Now you should see the particles fading away instead of popping out of existence when the explosion is finishing:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_19.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.19: Fade-in and fade-out gradient</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Enable <a id="_idIndexMarker703"/>the <strong class="screenText">Limit Velocity over Lifetime</strong> module by clicking on its checkbox.</li>
      <li class="numberedList">Set the <strong class="screenText">Dampen</strong> setting to <code class="inlineCode">0.1</code>. This will make the particles slowly stop instead of continuing to move:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_20.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.20: Dampen the velocity to make the particles stop</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="8">Enable <strong class="screenText">Rotation over Lifetime</strong> and set the <strong class="screenText">Angular Velocity</strong> between <code class="inlineCode">-90</code> and <code class="inlineCode">90</code>. Remember that you should set the value in <strong class="screenText">Random Between Two Constants</strong> by clicking on the down-pointing arrow to the right of the property. Now the particles should rotate during their lives to simulate more motion:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_21.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.21: Random rotation velocity</p>
    <p class="normal">Some of these effects will be very subtle given the short <strong class="screenText">Lifetime</strong> we set in the <strong class="screenText">Main Module </strong>when we just created the particle. Feel free to increase the <strong class="screenText">Lifetime</strong> value to see those effects in more detail, but consider that this could lead to an excessive number of particles if you spawn them frequently, reducing performance. Just be wary about how they impact your performance when tweaking those values.</p>
    <p class="normal">As you can see, there are lots of extra modules that can be enabled and disabled to add layers of <a id="_idIndexMarker704"/>behavior on top of the existing ones, so again, use them creatively to create all kinds of effects. Remember that you can create Prefabs of these systems to replicate them all over your scene. I also recommend searching for and downloading particle effects from the Asset Store to see how other people have used the same system to create amazing effects. Seeing a variety of different systems is the best way to learn how to create them, and that is what we are going to do in the next section: create more systems!</p>
    <h1 id="_idParaDest-145" class="heading-1">Creating fluid simulations</h1>
    <p class="normal">As we said, the best way to learn how to create particle systems is to keep looking for already-created <a id="_idIndexMarker705"/>particle systems and explore how people have used the various system settings to create completely different simulations.</p>
    <p class="normal">In this section, we will learn how to create the following effects using particle systems:</p>
    <ul>
      <li class="bulletList">A waterfall effect</li>
      <li class="bulletList">A bonfire effect</li>
    </ul>
    <p class="normal">Let’s start with the simplest one, the waterfall effect.</p>
    <h2 id="_idParaDest-146" class="heading-2">Creating a waterfall effect</h2>
    <p class="normal">In order to do <a id="_idIndexMarker706"/>this, follow these steps:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Create a new particle system (<strong class="screenText">GameObject </strong>|<strong class="screenText"> Effects </strong>| <strong class="screenText">Particle System</strong>).</li>
      <li class="numberedList">Set <strong class="screenText">Shape</strong> to <strong class="screenText">Edge</strong> and its <strong class="screenText">Radius</strong> to <code class="inlineCode">5</code> in the <strong class="screenText">Shape</strong> module. This will make the particles spawn along a line of emission:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_22.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.22: Edge shape</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">Set the <strong class="screenText">Rate over Lifetime</strong> of the <strong class="screenText">Emission</strong> module to <code class="inlineCode">50</code>.</li>
      <li class="numberedList">Set the <strong class="screenText">Start Size</strong> of the <strong class="screenText">Main</strong> module to <code class="inlineCode">3</code> and the <strong class="screenText">Start Lifetime</strong> to <code class="inlineCode">3</code>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_23.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.23: Main module settings</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Set <a id="_idIndexMarker707"/>the <strong class="screenText">Gravity Modifier</strong> of the Main module to <code class="inlineCode">0.5</code>. This will make the particles fall down:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_24.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.24: Gravity Modifier in the Main module</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Use the same <code class="inlineCode">Explosion</code> material we created previously for this system:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_25.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.25: Explosion particle material</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="7">Enable <strong class="screenText">Color Over Lifetime</strong> and open the <strong class="screenText">Gradient</strong> editor.</li>
      <li class="numberedList">Click the bottom-right marker, and this time you should see a color picker instead of an alpha slider. The top markers allow you to change the transparency over time, while the bottom ones change the color of the particles over time. Set a light blue color in this marker:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_26.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.26: White to light blue gradient</p>
    <p class="normal">As a challenge, I suggest you add a little particle system where this one ends to create some water splashes, simulating the water colliding with a lake at the bottom. Now we can add <a id="_idIndexMarker708"/>this particle system to one of the hills of our scene to decorate it, like in the following screenshot. I have adjusted the system a little bit to look better in this scenario. I challenge you to tweak it by yourself to make it look like this:</p>
    <figure class="mediaobject"><img src="../Images/B18585_11_27.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.27: The waterfall particle system being applied to our current scene</p>
    <p class="normal">Now, let’s create another effect: a bonfire.</p>
    <h2 id="_idParaDest-147" class="heading-2">Creating a bonfire effect</h2>
    <p class="normal">In order to create <a id="_idIndexMarker709"/>a bonfire, do the following:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Create a particle system like we did in the section <em class="italic">Creating a basic particle system with Shuriken</em>, in <strong class="screenText">GameObject | Effects | Particle System</strong>.</li>
      <li class="numberedList">Look for a <strong class="screenText">Fire Particle Texture Sheet</strong> texture on the internet or the Asset Store. This kind of texture should look like a grid of different flame textures. The idea is to apply a flame animation to our particles swapping all those mini textures:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_28.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.28: Particles texture sprite sheet</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">Create a particle <strong class="screenText">material</strong> that uses the <strong class="screenText">Universal Render Pipeline/Particles/Unlit</strong> shader. </li>
      <li class="numberedList">Set the flames sprite sheet texture as the <strong class="screenText">Base Map</strong>.</li>
      <li class="numberedList">Set the color at the right of the <strong class="screenText">Base Map</strong> to white. </li>
      <li class="numberedList">Set this material as the particle material. Remember to set <strong class="screenText">Surface Type</strong> to <strong class="screenText">Transparent</strong> and <strong class="screenText">Blending Mode </strong>to <strong class="screenText">Additive</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_29.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.29: A material with a particle sprite sheet</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="7">Enable the <strong class="screenText">Texture Sheet Animation</strong> module and set the <strong class="screenText">Tiles</strong> property according <a id="_idIndexMarker710"/>to your fire sheet. In my case, I have a grid of 4x4 sprites, so I put <code class="inlineCode">4</code> in <strong class="screenText">X</strong> and <code class="inlineCode">4</code> in <strong class="screenText">Y</strong>. After this, you should see the particles swapping textures:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_30.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.30: Enabling Texture Sheet Animation</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="8">Set <strong class="screenText">Start Speed</strong> to <code class="inlineCode">0</code> and <strong class="screenText">Start Size</strong> to <code class="inlineCode">1.5</code> in the Main module.</li>
      <li class="numberedList">Set <strong class="screenText">Radius</strong> to <code class="inlineCode">0.5</code> in <strong class="screenText">Shape</strong>.</li>
      <li class="numberedList">Create a second particle system and make it a child of the fire system:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_31.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.31: Parenting particle systems</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="11">Apply the <strong class="screenText">Explosion</strong> material from the explosion example.</li>
      <li class="numberedList">Set <strong class="screenText">Angle</strong> to <code class="inlineCode">0</code> and <strong class="screenText">Radius</strong> to <code class="inlineCode">0.5</code> in the <strong class="screenText">Shape</strong> module.</li>
    </ol>
    <p class="normal">The system should look like this:</p>
    <figure class="mediaobject"><img src="../Images/B18585_11_32.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.32: Result of combining fire and smoke particle systems</p>
    <p class="normal">As you can see, you can combine several particle systems to create a single effect. Take care when <a id="_idIndexMarker711"/>doing this because it’s easy to emit too many particles and affect the game’s performance. Particles are not cheap and may cause <a id="_idIndexMarker712"/>a reduction in the game’s <strong class="keyWord">FPS (Frames Per Second)</strong> if you are not cautious with them.</p>
    <p class="normal">So far, we have explored one of the Unity systems that you can use to create these kinds of effects, and while this system is enough for most situations, Unity recently released a new one that can <a id="_idIndexMarker713"/>generate more complex effects, called <strong class="keyWord">Visual Effect Graph</strong>. Let’s see how to use it and see how it differs from Shuriken.</p>
    <h1 id="_idParaDest-148" class="heading-1">Creating complex simulations with Visual Effect Graph</h1>
    <p class="normal">The particle <a id="_idIndexMarker714"/>system we have <a id="_idIndexMarker715"/>used so far is called Shuriken, and it handles all calculations in the CPU. This has both pros and cons. A pro is that it can run on all possible devices that Unity supports, regardless of their capabilities (all of them have CPUs), but a con is that we can exceed CPU capabilities easily if we are not cautious with the number of particles we emit. Modern games require more complex particle systems to generate believable effects, and this kind of CPU-based particle system solution has started to reach its limit. This is where the Visual Effect Graph comes in:</p>
    <figure class="mediaobject"><img src="../Images/B18585_11_33.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.33: On the left, a massive particle system, and on the right, an example of a Visual Effect Graph</p>
    <p class="normal"><strong class="keyWord">Visual Effect Graph</strong> is a GPU-based <a id="_idIndexMarker716"/>particle system solution, meaning that the system is executed in the video card instead of the CPU. That’s <a id="_idIndexMarker717"/>because video cards <a id="_idIndexMarker718"/>are far more efficient at executing lots and lots of little simulations, like the ones each particle of a system needs, so we can reach far higher orders of magnitude in the number of particles with the GPU than we can with the CPU. The con here is that we need a fairly modern GPU that has <strong class="keyWord">compute shader</strong> capabilities to support this system, so we will exclude certain target platforms using this system (forget about most mobile phones), so use it if your target platform supports it (mid- to high-end PCs, consoles, and some high-end phones). </p>
    <p class="normal">In this section, we will discuss the following topics of Visual Effect Graph:</p>
    <ul>
      <li class="bulletList">Installing Visual Effect Graph</li>
      <li class="bulletList">Creating and analyzing a Visual Effect Graph</li>
      <li class="bulletList">Creating a rain effect</li>
    </ul>
    <p class="normal">Let’s start by seeing how we can add support for Visual Effect Graph in our project.</p>
    <h2 id="_idParaDest-149" class="heading-2">Installing Visual Effect Graph</h2>
    <p class="normal">So far, we have used lots of Unity features that were already installed in our project, but Unity can <a id="_idIndexMarker719"/>be extended with a myriad of plugins, both official and third-party. Visual Effect Graph is one of those features that needs to be independently <a id="_idIndexMarker720"/>installed if you are using <strong class="keyWord">Universal Render Pipeline</strong> <strong class="keyWord">(URP)</strong>. We can do that using the Package Manager, a Unity window dedicated to managing official Unity plugins. </p>
    <p class="normal">Something to think about when you are installing those packages is that each package or plugin has its own version, independent of the Unity version. That means that you can have Unity 2022.1 installed, but Visual Effect Graph 13.1.8 or whatever version you want, and you can actually update the package to a newer version without upgrading Unity. This is important because some versions of these packages require a minimum version of Unity—for example, Visual Effect Graph 13.1.8 requires Unity 2022.1 as a minimum. Moreover, some packages depend on other packages and specific versions of those packages, so we need to ensure we have the correct versions of every package to ensure compatibility. To be clear, the dependencies of a package are installed automatically, but sometimes we can have them installed separately, so in that scenario, we need to check the required version. It sounds complicated, but it is simpler than it sounds.</p>
    <p class="normal">At the time of writing this book, in order to get Visual Effect Graph working properly we need version 13.1.8, and also we need the same version of <strong class="keyWord">Universal RP</strong>. Yes, Universal RP is another feature you can install using the Package Manager, but as we created the project using the Universal RP template, it was already installed for us with the proper version. With that in mind, let’s install the Visual Effect Graph as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">In the top menu of Unity, go to <strong class="screenText">Window | Package Manager</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_34.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.34: Package Manager location</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">Remember to be sure the <strong class="screenText">Packages</strong> dropdown is in <strong class="screenText">Unity Registry</strong> mode, to see the Unity official packages list:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_35.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.35: Package Manager Unity Registry mode</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">In the left column, locate <strong class="screenText">Universal RP</strong> and check whether it says 13.1.8 or higher <a id="_idIndexMarker721"/>to the right. If it does, jump to <em class="italic">step 6</em>. Remember, though, that a higher version may look different or have different steps for use than the ones displayed in this chapter.</li>
      <li class="numberedList">If you don’t have version 13.1.8 or higher, click on the right-pointing arrow at the left to display a list of all possible versions to install. Locate 13.1.8 and click it. In my case it says <strong class="screenText">Currently installed</strong> as I have that version already installed in the project, and there’s no other one available for Unity 2022:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_36.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.36: Package version selector</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Click on the <strong class="screenText">Update to 13.1.8</strong> button in the bottom-right part of the window and wait for the package to update.</li>
      <li class="numberedList">Look for the <strong class="screenText">Visual Effect Graph </strong>package on the left side of the window. As you did with Universal RP, make sure you select version 11.0.0 or the closest higher available:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_37.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.37: Visual Effect Graph package</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="7">Click the <strong class="screenText">Install</strong> button at the bottom-right of the window and wait for the package <a id="_idIndexMarker722"/>to install. Sometimes it is recommended to restart Unity after installing packages, so save your changes and restart Unity.</li>
    </ol>
    <p class="normal">Now that we have installed Visual Effect Graph, let’s create our first particle system using it.</p>
    <h2 id="_idParaDest-150" class="heading-2">Creating and analyzing a Visual Effect Graph</h2>
    <p class="normal">The method <a id="_idIndexMarker723"/>to create a particle system using Visual Effect Graph is similar to a regular Particle System. We will chain and configure modules as parts of <a id="_idIndexMarker724"/>the behavior of the particles, each module adding some specific behavior, but the way we do it is very different than with Shuriken. First, we need to create a <strong class="keyWord">Visual Effect Graph</strong>, an asset that will contain all the modules and configurations, and then make a GameObject that will execute the Graph asset to spawn particles. Let’s do that with the following steps:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">In the Project window, click on the <strong class="screenText">+</strong> button and look for <strong class="screenText">Visual Effects | Visual Effect Graph</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_38.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.38: Visual Effect Graph</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">Create an <strong class="screenText">Empty</strong> GameObject using the <strong class="screenText">GameObject</strong> | <strong class="screenText">Create Empty</strong> option:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_39.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.39: Empty GameObject creation</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">Select <a id="_idIndexMarker725"/>the created object and look at the <strong class="screenText">Inspector</strong>.</li>
      <li class="numberedList">Using the <strong class="screenText">Add Component</strong> search bar, look for the <strong class="screenText">Visual Effect</strong> component and <a id="_idIndexMarker726"/>click on it to add it to the object:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_40.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.40: Adding a component to the Visual Effect Graph</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Drag the <strong class="screenText">Visual Effect</strong> asset we created to the <strong class="screenText">Asset Template</strong> property of the <strong class="screenText">Visual Effect</strong> component in our GameObject:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_41.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.41: Visual Effect using the previously created Visual Effect asset</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">You should see clock particles being emitted from our object, which is the default behavior included in a new Visual Effect asset, meaning it’s being executed correctly:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_42.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.42: Default Visual Effect asset results</p>
    <p class="normal">Now that <a id="_idIndexMarker727"/>we have a base effect, let’s create something that <a id="_idIndexMarker728"/>requires a lot of particles, such as dense rain. Before doing so, we will explore some core concepts of Visual Effect Graph. If you double-click the Visual Effect asset, you will see the following editor:</p>
    <figure class="mediaobject"><img src="../Images/B18585_11_43.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.43: Visual Effect Graph editor window</p>
    <p class="normal">This window <a id="_idIndexMarker729"/>is composed of several interconnected nodes, generating <a id="_idIndexMarker730"/>a flow of actions to be executed. As with the Shader Graph, you can navigate this window by keeping the <em class="italic">Alt</em> key (<em class="italic">Option</em> on Mac) pressed and dragging with the mouse the empty areas of the graph. At first, it seems similar to the Shader Graph, but it works a little bit differently, so let’s study each section of the default graph.</p>
    <p class="normal">The first area to explore is the dotted one that contains three nodes. This is what Unity calls a <strong class="keyWord">System</strong>. A System is a <a id="_idIndexMarker731"/>set of nodes that defines how a particle will behave, and you can have as many as you want, which is the equivalent of having several particle system objects. Each System is <a id="_idIndexMarker732"/>composed of <strong class="keyWord">Contexts</strong>, the nodes inside the dotted area, and in this case, we have <strong class="screenText">Initialize Particle</strong>, <strong class="screenText">Update Particle</strong>, and <strong class="screenText">Output Particle Quad</strong>. Each Context represents a different stage of the particle system logic flow, so let’s define what each Context in our graph does:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Initialize Particle</strong>: This defines the initial data of each emitted particle, such as position, color, speed, and size. It is similar to the <strong class="screenText">Start</strong> properties in the Main <a id="_idIndexMarker733"/>module of the particle system we saw at the beginning of this chapter. The logic in this node will only execute when a new particle is emitted.</li>
      <li class="bulletList"><strong class="keyWord">Update Particle</strong>: Here, we can apply modifications to the data of the living particles. We can <a id="_idIndexMarker734"/>change particle data such as the current velocity or particle size of all the frames. This is similar to the <strong class="screenText">Overtime</strong> nodes of the Shuriken particle systems.</li>
      <li class="bulletList"><strong class="keyWord">Output Particle Quad</strong>: This Context will be executed when the particle needs <a id="_idIndexMarker735"/>to be rendered. It will read the particle data to see where to render, how to render, which texture and color to use, and the different visual settings. This is similar to the renderer module of the previous particle system.</li>
    </ul>
    <p class="normal">Inside each Context, apart from some base configurations, we can add <strong class="keyWord">Blocks</strong>. Each Block is an <a id="_idIndexMarker736"/>action that will be executed in the Context. We have <a id="_idIndexMarker737"/>actions that can be executed in any Context and then some specific Context actions. As an example, we can use an <strong class="screenText">Add Position Block</strong> in the Initialize Particle Context to move the initial particle position, but if we use the same Block in the Update Particle Context, it will move the particle constantly. So basically, Contexts are different situations that happen in the life of the particle, and Blocks are actions that are executed in those situations:</p>
    <figure class="mediaobject"><img src="../Images/B18585_11_44.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.44: A Set Velocity Random Block inside the Initialize Particle Context. This sets the initial velocity of a particle</p>
    <p class="normal">Also, we can have <strong class="keyWord">Standalone Contexts</strong>, Contexts outside Systems, such as <strong class="screenText">Spawn</strong>. This Context is responsible for telling the System that a new particle needs to be created. We can add Blocks to specify when the context will tell the system to create the particle, such as at a fixed rate over time, bursts, and so on. The idea is that Spawn will create particles according to its Blocks, while a System is responsible for initializing, updating, and rendering each of them, again, according to the blocks we set up inside each one of those Contexts.</p>
    <p class="normal">So, we can <a id="_idIndexMarker738"/>see that there are lots of similarities with Shuriken, but the <a id="_idIndexMarker739"/>way to create a system here is quite different. Let’s reinforce this by creating a rain effect, which will require lots of particles—a nice use case for Visual Effect Graph.</p>
    <h2 id="_idParaDest-151" class="heading-2">Creating a rain effect</h2>
    <p class="normal">In order to create <a id="_idIndexMarker740"/>this effect, do the following:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Set the <strong class="screenText">Capacity</strong> property of the <strong class="screenText">Initialize Particle</strong> Context to <code class="inlineCode">10000</code>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_45.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.45: Initialize Particle Context</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">Set the <strong class="screenText">Rate</strong> of the <strong class="screenText">Constant Spawn Rate</strong> of the <strong class="screenText">Spawn</strong> context to <code class="inlineCode">10000</code>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_46.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.46: Constant Spawn Rate Block</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">Set the <strong class="screenText">A</strong> and <strong class="screenText">B</strong> properties to <code class="inlineCode">0</code>, <code class="inlineCode">-50</code>, and <code class="inlineCode">0</code> and <code class="inlineCode">0</code>, <code class="inlineCode">-75</code>, and <code class="inlineCode">0</code> respectively in the <strong class="screenText">Set Velocity Random </strong>block in the <strong class="screenText">Initialize Particle</strong> Context. This will set a random velocity pointing downward for our particles:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_47.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.47: Set Velocity Random Block</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Right-click the <strong class="screenText">Initialize Particle</strong> title, and select <strong class="screenText">Create Block</strong>.</li>
      <li class="numberedList">Search <a id="_idIndexMarker741"/>for the <strong class="screenText">Set Position Random</strong> block and click on it:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_48.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.48: Adding blocks</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Set the <strong class="screenText">A</strong> and <strong class="screenText">B</strong> properties of the <strong class="screenText">Set Position Random</strong> Block to <code class="inlineCode">-50</code>, <code class="inlineCode">0</code>, and <code class="inlineCode">-50</code> and <code class="inlineCode">50</code>, <code class="inlineCode">0</code>, and <code class="inlineCode">50</code> respectively. This will define an initial area in which to randomly spawn the particle.</li>
      <li class="numberedList">Click the arrow at the left of the <strong class="screenText">Bounds</strong> property of the <strong class="screenText">Initialize Particle</strong> Block to display its properties, and set <strong class="screenText">Center</strong> and <strong class="screenText">Size</strong> to <code class="inlineCode">0</code>, <code class="inlineCode">-12.5</code>, and <code class="inlineCode">0</code> and <code class="inlineCode">100</code>, <code class="inlineCode">25</code>, and <code class="inlineCode">100</code> respectively. This will define the area where the particles should be visible. Particles can actually move outside this area, but it is important to render the particles only in the areas we are interested in them being visible.</li>
    </ol>
    <div class="packt_tip">
      <p class="normal">Search <code class="inlineCode">Frustum culling</code> on the internet for more information about bounds.</p>
    </div>
    <figure class="mediaobject"><img src="../Images/B18585_11_49.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.49: Configuring blocks</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="8">Select the GameObject that is executing the system, and in the bottom-right window <a id="_idIndexMarker742"/>in the Scene view check the <strong class="screenText">Show Bounds</strong> checkbox to see the previously defined bounds:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_50.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.50: Visual Effect playback controls</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="9">If you don’t see the window at the bottom right, click the <strong class="screenText">VE</strong> (Visual Effect) button at <a id="_idIndexMarker743"/>the top-left side of the screen to display it. This button will be shown only if you have selected the <strong class="screenText">Rain</strong> visual effect GameObject in the <strong class="screenText">Hierarchy</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_51.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.51: Another way to display the Visual Effect playback controls</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="10">If you can’t see the changes being applied, click the <strong class="screenText">Compile</strong> button in the top left of the window, the one that looks like a paper bin beneath a downward-pointing arrow. Also, you can save your changes using <em class="italic">Ctrl</em> + <em class="italic">S</em> (<em class="italic">Command</em> + <em class="italic">S</em> on Mac):</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_52.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.52: VFX asset saving controls</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="11">Set the <a id="_idIndexMarker744"/>object position to cover the whole base area. In my case, the position is <code class="inlineCode">100</code>, <code class="inlineCode">37</code>, and <code class="inlineCode">100</code>. Remember that you need to change the <strong class="screenText">Position</strong> of the <strong class="screenText">Transform</strong> component for this:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_53.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.53: Setting a Transform position</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="12">Set the <strong class="screenText">A</strong> and <strong class="screenText">B</strong> properties of the <strong class="screenText">Set Lifetime Random</strong> Block in the <strong class="screenText">Initialize Particle</strong> to <code class="inlineCode">0.5</code>. This will make the particles have a shorter life, ensuring that they are always inside the bounds:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_54.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.54: Set Lifetime Random Block</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="13">Change the <strong class="screenText">Main Texture</strong> property of the <strong class="screenText">Output Particle Quad</strong> Context to another texture. In this case, the previously downloaded smoke texture can work here, even though it’s not water, because we will modify its appearance in a moment. Also, you can try to download a water droplet texture if you want to:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_55.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.55: VFX Graph Main Texture</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="14">Set <strong class="screenText">Blend Mode</strong> of the <strong class="screenText">Output Particle Quad</strong> Context to <strong class="screenText">Additive</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_56.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.56: Additive mode of VFX Graph</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="15">We need <a id="_idIndexMarker745"/>to stretch our particles a little bit to look like actual raindrops instead of falling balls. Before accomplishing that, first we need to change the orientation of our particles, so they don’t point at the camera all the time. In order to do this, right-click on the <strong class="screenText">Orient Block</strong> in the <strong class="screenText">Output Particle Quad</strong> Context and select <strong class="screenText">Delete</strong> (or press <em class="italic">Delete</em> on PC or <em class="italic">Command</em> + <em class="italic">Backspace</em> on Mac):</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_57.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.57: Deleting a block</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="16">We want to stretch our particles according to their velocity direction. Another preparation step before actually doing that is to select the title of the <strong class="screenText">Output Particle Quad</strong> context and hit the space bar to look for a block to add. In this case, we need to search and add the <strong class="screenText">Orient Along Velocity</strong> block.</li>
      <li class="numberedList">Add a <strong class="screenText">Set Scale</strong> Block to the <strong class="screenText">Initialize Particle</strong> Context and set the <strong class="screenText">Scale</strong> property to <code class="inlineCode">0.25</code>, <code class="inlineCode">1.5</code>, and <code class="inlineCode">0.25</code>. This will stretch the particles to look like falling drops:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_58.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.58: Set Scale Block</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="18">Click the <strong class="screenText">Compile</strong> button in the top-left window again to see the changes. Your <a id="_idIndexMarker746"/>system should look like this:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_59.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.59: Rain results</p>
    <p class="normal">We have just modified lots of different properties of the Visual Effect Graph, but if you want to have two instances of the same Visual Effect Graph, but with slight differences, I recommend you look at the Blackboard feature, which will allow you to expose properties in the Inspector. For example, you can make less dense rain on another scene, making <a id="_idIndexMarker747"/>the spawn rate lower, or change the particle color to make acid rain, all using the same graph, but let’s keep things simple for now.</p>
    <div class="note">
      <p class="normal">The Blackboard feature is also present in Shader Graph.</p>
      <p class="normal">From here, you can experiment by adding and removing Blocks from the Contexts as you wish, and again, I recommend you look for already-created Visual Effect Graphs to find ideas for other systems. Actually, you can get ideas for Visual Effect Graph by looking at effects made in Shuriken and using the analogous <a id="_idIndexMarker748"/>blocks. Also, I recommend you search for the Visual Effect Graph documentation online or at: <a href="https://docs.unity3d.com/Packages/com.unity.visualeffectgraph@13.1/manual/index.html"><span class="url">https://docs.unity3d.com/Packages/com.unity.visualeffectgraph@13.1/manual/index.html</span></a> to learn more about this system. You can also access the documentation of any Unity Package by clicking the <strong class="screenText">View Documentation</strong> button in the Package Manager while the package is selected.</p>
    </div>
    <p class="normal"> </p>
    <figure class="mediaobject"><img src="../Images/B18585_11_60.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.60: Package Manager documentation link </p>
    <p class="normal">Now that we have learnt how to create different visual effects, let’s see how to use them via scripting to achieve effects that react to what’s happening in the game.</p>
    <h1 id="_idParaDest-152" class="heading-1">Scripting Visual Effects</h1>
    <p class="normal">Visual feedback <a id="_idIndexMarker749"/>is the concept of using different VFX, such as particles and a VFX graph, to reinforce what is happening. For example, say right now we are shooting our weapon, and we know that this is happening because we can see the bullets. However, it doesn’t feel like a real shooting effect, because a proper shooting effect should have a muzzle effect on the tip of our gun. Another example would be the enemy dying—it just disappears with no animation! That doesn’t feel as satisfying as it could be. We can instead add a little explosion (considering they are robots).</p>
    <p class="normal">Let’s start <a id="_idIndexMarker750"/>making our enemies spawn an explosion when they die by doing the following:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Create an explosion effect or download one from the Asset Store. It shouldn’t loop and it needs to be destroyed automatically when the explosion is over (ensure <strong class="screenText">Looping</strong> is unchecked and <strong class="screenText">Stop Action</strong> is set to <code class="inlineCode">Destroy</code> in the main module).</li>
      <li class="numberedList">Some explosions in the Asset Store might use non-URP-compatible shaders. You can fix them by using <strong class="screenText">Window | Rendering | Render Pipeline Converter</strong>, as we saw in <em class="chapterRef">Chapter 4</em>, <em class="italic">Importing and Integrating Assets</em>.</li>
      <li class="numberedList">Manually upgrade the materials that didn’t upgrade automatically. </li>
      <li class="numberedList">Add a script to the <code class="inlineCode">Enemy</code> prefab called <code class="inlineCode">ExplosionOnDeath</code>. This will be responsible for spawning the particles Prefab when the enemy dies.</li>
      <li class="numberedList">Add a field of the <code class="inlineCode">GameObject</code> type called <code class="inlineCode">particlePrefab</code> and drag the explosion Prefab to it.</li>
    </ol>
    <div class="note">
      <p class="normal">You may be expecting to add the explosion spawning to the <code class="inlineCode">Life</code> component. In that case, you are assuming that anything to do with life will spawn a particle when dying, but consider scenarios where characters die with a falling animation instead, or maybe an object that just despawns with no effect whatsoever. If a certain behavior is not used in most scenarios, it is better to code it in a separate optional script to allow us to mix and match different components and get the exact behavior we want.</p>
    </div>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Make the script access the <code class="inlineCode">Life</code> component and subscribe to its <code class="inlineCode">onDeath</code> event.</li>
      <li class="numberedList">In the <code class="inlineCode">listener</code> function, spawn the particle system in the same location:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_61.png" alt="Graphical user interface, text, application, chat or text message  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 11.61: The explosion spawner script</p>
    <p class="normal">The Visual <a id="_idIndexMarker751"/>Scripting version would look like this:</p>
    <figure class="mediaobject"><img src="../Images/B18585_11_62.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.62: The explosion spawner visual script</p>
    <p class="normal">As you can see, we are just using the same concepts we learned about in previous chapters <a id="_idIndexMarker752"/>but combining them in new ways. This is what programming is all about.</p>
    <p class="normal">Let’s continue with the muzzle effect, which will also be a particle system, but we will take another approach this time:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">If you don’t have one already, download a weapon model from the Asset Store. The character in the package we used in the book already comes with one, so we will use that one.</li>
      <li class="numberedList">If it’s not already in your character, instantiate the weapon so that it is the parent of the hand of the player. Remember that our character is rigged and has a hand bone, so you should put the weapon there.</li>
      <li class="numberedList">The weapon that comes with the character we downloaded in this book is a special scenario where the weapon has a <strong class="screenText">SkinnedMeshRenderer</strong>. This component uses the <em class="italic">Skinning Animation</em> system that we will learn to use in <em class="chapterRef">Chapter 17</em>,<em class="italic"> Create Animations with Animator, Cinemachine, and Timeline</em>. In this case, the movement of the weapon will be affected by the animations we will use in that chapter, so for now let’s keep the weapon where it is located now, even if it looks odd.</li>
      <li class="numberedList">Create or get a muzzle particle system. In this case, my muzzle particle system was <a id="_idIndexMarker753"/>created as a short particle system that has a burst of particles and then automatically stops. Try to get one with that behavior because there are others out there that will loop instead, and the script to handle that scenario would be different.</li>
      <li class="numberedList">Create an instance of the particle system prefab in the editor and parent it inside the weapon, locating it in front of the weapon, aligned with the cannon of the gun. Make sure the <strong class="screenText">Play On Awake</strong> property of the main module of the particle system is unchecked; we don’t want the muzzle to fire until we press the fire key:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_63.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.63: The muzzle parented to the weapon</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Create a field of the <code class="inlineCode">ParticleSystem</code> type called <code class="inlineCode">muzzleEffect</code> in <code class="inlineCode">PlayerShooting</code>.</li>
      <li class="numberedList">Drag the muzzle effect GameObject that is parented in the gun to it in the Inspector. Now, we have a reference to the <code class="inlineCode">ParticleSystem</code> component of the muzzle to manage it.</li>
      <li class="numberedList">Inside the <code class="inlineCode">if</code> statement that checks whether we are shooting, execute <code class="inlineCode">muzzleEffect.Play();</code> to play the particle system. It will automatically stop and is short <a id="_idIndexMarker754"/>enough to finish between key presses:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_64.png" alt="Graphical user interface, text, application  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 11.64: The muzzle parented to the weapon</p>
    <p class="normal">The Visual Scripting version’s additional nodes and variables would be the following:</p>
    <figure class="mediaobject"><img src="../Images/B18585_11_65.png" alt="Graphical user interface, application  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 11.65: The muzzle playing visual script</p>
    <p class="normal">Finally, we need to <a id="_idIndexMarker755"/>play the muzzle effect also on the AI while shooting by doing the following:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">As we did with <code class="inlineCode">PlayerShooting</code>, create a field of the <code class="inlineCode">ParticleSystem</code> type called <code class="inlineCode">muzzleEffect</code> in <code class="inlineCode">EnemyFSM</code>.</li>
      <li class="numberedList">Inside the <code class="inlineCode">Shoot</code> method, add the line <code class="inlineCode">muzzleEffect.Play();</code> at the end of the method to play the particle system:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18585_11_66.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.66: The muzzle playing C# script</p>
    <p class="normal">The Visual <a id="_idIndexMarker756"/>Scripting version’s additional nodes for the <code class="inlineCode">Attack State</code> and <code class="inlineCode">Attack Base</code> will be:</p>
    <figure class="mediaobject"><img src="../Images/B18585_11_67.png" alt="Graphical user interface, text, application, chat or text message  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 11.67: The muzzle playing script for the Attack State</p>
    <p class="normal">Remember to <a id="_idIndexMarker757"/>add those nodes to both attack states and to add the <code class="inlineCode">muzzleEffect</code> variable to the AI Variables component.</p>
    <h1 id="_idParaDest-153" class="heading-1">Summary</h1>
    <p class="normal">In this chapter, we discussed two different ways to create particle systems: using Shuriken and VFX Graph. We used them to simulate different fluid phenomena, such as fire, a waterfall, smoke, and rain. The idea is to combine particle systems with meshes to generate all the possible props needed for your scene. Also, as you can imagine, creating these kinds of effects professionally requires you to go deeper. If you want to dedicate yourself to this (another part of the job of a technical artist), you will need to learn how to create your own particle textures to get the exact look and feel you want, code scripts that control certain aspects of the systems, and several other aspects of particle creation. However, that is outside the scope of the book.</p>
    <p class="normal">Now that we have some rain in our scene, we can see that the sky and the lighting in the scene don’t really reflect a rainy day, so let’s fix that in the next chapter!</p>
  </div>
</body></html>