<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer379">&#13;
    <h1 class="chapterNumber">12</h1>&#13;
    <h1 id="_idParaDest-233" class="chapterTitle">Saving, Loading, and Serializing Data</h1>&#13;
    <p class="normal">Every game you've ever played works with data, whether it's your player stats, game progress, or online multiplayer scoreboards. Your favorite game also manages internal data, meaning the programmers used hardcoded information to build levels, keep track of enemy stats, and write helpful utilities. In other words, data is everywhere.</p>&#13;
    <p class="normal">In this chapter, we're going to start with how both C# and Unity handle the filesystem on your computer, and move on to reading, writing, and serializing our game data. Our focus is on working with the three most common data formats you'll likely come across: text files, XML, and JSON.</p>&#13;
    <p class="normal">By the end of this chapter, you'll have a foundational understanding of your computer's filesystem, data formats, and basic read-write functionality. This will be the foundation you build your game data on, creating a more enriching and engaging experience for your players. You'll also be in a good position to start thinking about what game data is important enough to save, and how your C# classes and objects will look in different data formats.</p>&#13;
    <p class="normal">Along the way, we will cover the following topics:</p>&#13;
    <ul>&#13;
      <li class="bullet">Introducing text, XML, and JSON formats</li>&#13;
      <li class="bullet">Understanding the filesystem</li>&#13;
      <li class="bullet">Working with different stream types</li>&#13;
      <li class="bullet">Reading and writing game data</li>&#13;
      <li class="bullet">Serializing objects</li>&#13;
    </ul>&#13;
    <h1 id="_idParaDest-234" class="title">Introducing data formats</h1>&#13;
    <p class="normal">Data can take different forms in programming, but the three formats you should be familiar with at the <a id="_idIndexMarker761"/>beginning of your data journey are:</p>&#13;
    <ul>&#13;
      <li class="bullet"><strong class="keyword">Text</strong>, which is what <a id="_idIndexMarker762"/>you're reading right now</li>&#13;
      <li class="bullet"><strong class="keyword">XML </strong>(<strong class="keyword">Extensible Markup Language</strong>), which is a way of encoding document information <a id="_idIndexMarker763"/>so it's readable for you and a computer</li>&#13;
      <li class="bullet"><strong class="keyword">JSON </strong>(<strong class="keyword">JavaScript Object Notation</strong>), which is a human-readable text format made up <a id="_idIndexMarker764"/>of attribute-value pairs and arrays</li>&#13;
    </ul>&#13;
    <p class="normal">Each of these data formats has its own strengths and drawbacks, as well as applications in programming. For instance, text is generally used to store simpler, non-hierarchical, or nested information. XML is better at storing information in a document format, while JSON has a more diverse range of capabilities, specifically with database information and server communication with applications. </p>&#13;
    <div class="note">&#13;
      <p class="Information-Box--PACKT-">You can find more information <a id="_idIndexMarker765"/>about XML at <a href="https://www.xml.com"><span class="url">https://www.xml.com</span></a> and JSON <a id="_idIndexMarker766"/>at <a href="https://www.json.org"><span class="url">https://www.json.org</span></a>.</p>&#13;
    </div>&#13;
    <p class="normal">Data is a big topic in any programming language, so let's start off by breaking down what XML and JSON formats actually look like in the next two sections.</p>&#13;
    <h2 id="_idParaDest-235" class="title">Breaking down XML</h2>&#13;
    <p class="normal">A typical XML file has a standardized format. Each element of the XML document has an opening (<code class="Code-In-Text--PACKT-">&lt;element_name&gt;</code>), a closing tag (<code class="Code-In-Text--PACKT-">&lt;/element_name&gt;</code>), and supports tag attributes (<code class="Code-In-Text--PACKT-">&lt;element_name attribute= "attribute_name"&gt;&lt;/element_name&gt;</code>). A basic file will start with the <a id="_idIndexMarker767"/>version and encoding being used, then the starting or root element, followed by a list of element items, and finally the closing element. As a blueprint, it would look like this:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>&#13;
<span class="hljs-tag">&lt;</span><span class="hljs-name">root_element</span><span class="hljs-tag">&gt;</span>&#13;
<span class="hljs-tag">    &lt;</span><span class="hljs-name">element_item</span><span class="hljs-tag">&gt;</span>[Information goes here]<span class="hljs-tag">&lt;/</span><span class="hljs-name">element_item</span><span class="hljs-tag">&gt;</span>&#13;
<span class="hljs-tag">    &lt;</span><span class="hljs-name">element_item</span><span class="hljs-tag">&gt;</span>[Information goes here]<span class="hljs-tag">&lt;/</span><span class="hljs-name">element_item</span><span class="hljs-tag">&gt;</span>&#13;
<span class="hljs-tag">    &lt;</span><span class="hljs-name">element_item</span><span class="hljs-tag">&gt;</span>[Information goes here]<span class="hljs-tag">&lt;/</span><span class="hljs-name">element_item</span><span class="hljs-tag">&gt;</span>&#13;
<span class="hljs-tag">&lt;/</span><span class="hljs-name">root_element</span><span class="hljs-tag">&gt;</span>&#13;
</code></pre>&#13;
    <p class="normal">XML data can also store more complex objects by using child elements. For example, we'll be turning <a id="_idIndexMarker768"/>a list of weapons into XML using the <code class="Code-In-Text--PACKT-">Weapon</code> class we wrote earlier in the book. Since each weapon has properties for its name and damage value, that will look like this:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">// 1&#13;
<span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span>&#13;
// 2&#13;
<span class="hljs-tag">&lt;</span><span class="hljs-name">ArrayOfWeapon</span><span class="hljs-tag">&gt;</span>&#13;
     // 3&#13;
    <span class="hljs-tag">&lt;</span><span class="hljs-name">Weapon</span><span class="hljs-tag">&gt;</span>&#13;
     // 4&#13;
        <span class="hljs-tag">&lt;</span><span class="hljs-name">name</span><span class="hljs-tag">&gt;</span>Sword of Doom<span class="hljs-tag">&lt;/</span><span class="hljs-name">name</span><span class="hljs-tag">&gt;</span>&#13;
        <span class="hljs-tag">&lt;</span><span class="hljs-name">damage</span><span class="hljs-tag">&gt;</span>100<span class="hljs-tag">&lt;/</span><span class="hljs-name">damage</span><span class="hljs-tag">&gt;</span>&#13;
     // 5&#13;
    <span class="hljs-tag">&lt;/</span><span class="hljs-name">Weapon</span><span class="hljs-tag">&gt;</span>&#13;
    <span class="hljs-tag">&lt;</span><span class="hljs-name">Weapon</span><span class="hljs-tag">&gt;</span>&#13;
        <span class="hljs-tag">&lt;</span><span class="hljs-name">name</span><span class="hljs-tag">&gt;</span>Butterfly knives<span class="hljs-tag">&lt;/</span><span class="hljs-name">name</span><span class="hljs-tag">&gt;</span>&#13;
        <span class="hljs-tag">&lt;</span><span class="hljs-name">damage</span><span class="hljs-tag">&gt;</span>25<span class="hljs-tag">&lt;/</span><span class="hljs-name">damage</span><span class="hljs-tag">&gt;</span>&#13;
    <span class="hljs-tag">&lt;/</span><span class="hljs-name">Weapon</span><span class="hljs-tag">&gt;</span>&#13;
    <span class="hljs-tag">&lt;</span><span class="hljs-name">Weapon</span><span class="hljs-tag">&gt;</span>&#13;
        <span class="hljs-tag">&lt;</span><span class="hljs-name">name</span><span class="hljs-tag">&gt;</span>Brass Knuckles<span class="hljs-tag">&lt;/</span><span class="hljs-name">name</span><span class="hljs-tag">&gt;</span>&#13;
        <span class="hljs-tag">&lt;</span><span class="hljs-name">damage</span><span class="hljs-tag">&gt;</span>15<span class="hljs-tag">&lt;/</span><span class="hljs-name">damage</span><span class="hljs-tag">&gt;</span>&#13;
    <span class="hljs-tag">&lt;/</span><span class="hljs-name">Weapon</span><span class="hljs-tag">&gt;</span>&#13;
// 6&#13;
<span class="hljs-tag">&lt;/</span><span class="hljs-name">ArrayOfWeapon</span><span class="hljs-tag">&gt;</span>&#13;
</code></pre>&#13;
    <p class="normal">Let's break down the example above to make sure we've got it right:</p>&#13;
    <ol>&#13;
      <li class="numbered">The XML document starts with the version being used</li>&#13;
      <li class="numbered">The root element is declared with an opening tag named <code class="Code-In-Text--PACKT-">ArrayOfWeapon</code>, which will hold all our element items</li>&#13;
      <li class="numbered">A weapon item is created with an opening tag named <code class="Code-In-Text--PACKT-">Weapon</code></li>&#13;
      <li class="numbered">Its child properties are added with opening and closing tags on a single line for <code class="Code-In-Text--PACKT-">name</code> and <code class="Code-In-Text--PACKT-">damage</code></li>&#13;
      <li class="numbered">The weapon item is closed, and two more weapon items are added</li>&#13;
      <li class="numbered">The array is closed, marking the end of the document</li>&#13;
    </ol>&#13;
    <p class="normal">The good news is our application doesn't have to manually write our data in this format. C# has an entire library of classes and methods to help us translate simple text and class objects directly into XML. </p>&#13;
    <p class="normal">We'll dive into practical code examples a little later on, but first we need to understand how JSON works.</p>&#13;
    <h2 id="_idParaDest-236" class="title">Breaking down JSON </h2>&#13;
    <p class="normal">The JSON data format is <a id="_idIndexMarker769"/>similar to XML, but without the tags. Instead, everything is based on attribute-value pairs, like the <strong class="keyword">Dictionary</strong> collection type we worked with back in <em class="chapterRef">Chapter 4</em>, <em class="italic">Control Flow and Collection Types</em>. Each JSON document starts with a parent dictionary that holds as many attribute-value pairs as you need. Dictionaries use open and closed curly braces ( <code class="Code-In-Text--PACKT-">{ }</code> ), a colon separates each attribute and value, and each attribute-value pair is separated by a comma:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// Parent dictionary for the entire file</span>&#13;
{&#13;
    <span class="hljs-comment">// List of attribute-value pairs where you store your data</span>&#13;
    <span class="hljs-string">"attribute_name"</span>: <span class="hljs-keyword">value</span>,&#13;
    <span class="hljs-string">"attribute_name"</span>: <span class="hljs-keyword">value</span>&#13;
}&#13;
</code></pre>&#13;
    <p class="normal">JSON can also have child or nested structures by setting the value of an attribute-value pair to an array of attribute-value pairs. For instance, if we want to store a weapon, it would look like this:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// Parent dictionary</span>&#13;
{&#13;
    <span class="hljs-comment">// Weapon attribute with its value set to an child dictionary</span>&#13;
    <span class="hljs-string">"weapon"</span>: {&#13;
          <span class="hljs-comment">// Attribute-value pairs with weapon data</span>&#13;
          <span class="hljs-string">"name"</span>: <span class="hljs-string">"Sword of Doom"</span>,&#13;
          <span class="hljs-string">"damage"</span>: <span class="hljs-number">100</span>&#13;
    }&#13;
}&#13;
</code></pre>&#13;
    <p class="normal">Finally, JSON data is often made up of lists, or arrays, or objects. Continuing our example, if we wanted to store a list of all the weapons our player could choose, we would use a pair of square brackets to denote an array:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// Parent dictionary</span>&#13;
{&#13;
    <span class="hljs-comment">// List of weapon attribute set to an array of weapon objects</span>&#13;
    <span class="hljs-string">"weapons"</span>: [&#13;
        <span class="hljs-comment">// Each weapon object stored as its own dictionary</span>&#13;
        {&#13;
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"Sword of Doom"</span>,&#13;
            <span class="hljs-string">"damage"</span>: <span class="hljs-number">100</span>&#13;
        },&#13;
        {&#13;
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"Butterfly knives"</span>,&#13;
            <span class="hljs-string">"damage"</span>: <span class="hljs-number">25</span>&#13;
        },&#13;
        {&#13;
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"Brass Knuckles"</span>,&#13;
            <span class="hljs-string">"damage"</span>: <span class="hljs-number">15</span>&#13;
        }&#13;
    ]&#13;
}&#13;
</code></pre>&#13;
    <p class="normal">You can mix and match any of these techniques to store any kind of complex data you need, which is one of JSON's main strengths. But just like with XML, don't be overtaken by the new syntax – C# and Unity both have helper classes and methods to translate text and class <a id="_idIndexMarker770"/>objects into JSON without us having to do any heavy lifting. Reading XML and JSON is sort of like learning a new language—the more you use it the more familiar it becomes. Soon it'll be second nature!</p>&#13;
    <p class="normal">Now that we've dipped our toes into data formatting basics, we can start talking about how the filesystem on your computer works and what properties we can access from our C# code.</p>&#13;
    <h1 id="_idParaDest-237" class="title">Understanding the filesystem</h1>&#13;
    <p class="normal">When we say filesystem, we're talking about something you're already familiar with – how files and folders are created, organized, and stored on your computer. When you create a new folder <a id="_idIndexMarker771"/>on your computer, you can name it and put files or other folders inside it. It's also represented by an icon, which is both a visual cue and a way to drag, drop, and move it anywhere you like. </p>&#13;
    <p class="normal">Everything you can do on your desktop you can do in code. All you need is the name of the folder, or directory as it's called, and a location to store it. Anytime you want to add a file or subfolder, you reference the parent directory and add your new content. </p>&#13;
    <p class="normal">To drive the filesystem home, let's start building out the <code class="Code-In-Text--PACKT-">DataManager</code> class:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Right-click in the <strong class="screenText">Hierarchy </strong>and choose <strong class="screenText">Create Empty</strong>, then name it <strong class="screenText">Data_Manager</strong>:<figure class="mediaobject"><img src="Images/B17573_12_01.png" alt="" width="750" height="403"/></figure>&#13;
        <p class="packt_figref">Figure 12.1: Data_Manager in the Hierarchy</p>&#13;
      </li>&#13;
      <li class="numbered">Select the <strong class="screenText">Data_Manager</strong> object in the <strong class="screenText">Hierarchy</strong> and drag the <code class="Code-In-Text--PACKT-">DataManager</code> script we <a id="_idIndexMarker772"/>created in <em class="chapterRef">Chapter 10</em>, <em class="italic">Revisiting Types, Methods, and Classes</em>, from the <strong class="screenText">Scripts</strong> folder into the <strong class="screenText">Inspector</strong>:<figure class="mediaobject"><img src="Images/B17573_12_02.png" alt="" width="751" height="420"/></figure>&#13;
        <p class="packt_figref">Figure 12.2: Data_Manager in the Inspector</p>&#13;
      </li>&#13;
      <li class="numbered">Open the <code class="Code-In-Text--PACKT-">DataManager</code> script and <a id="_idIndexMarker773"/>update it with the following code to print out a few filesystem properties:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">using</span> System.Collections;&#13;
<span class="hljs-keyword">using</span> System.Collections.Generic;&#13;
<span class="hljs-keyword">using</span> UnityEngine;&#13;
 &#13;
<span class="code-highlight"><strong class="hljs-comment-slc">// 1</strong></span>&#13;
<span class="code-highlight"><strong class="hljs-keyword-slc">using</strong><strong class="hljs-slc"> System.IO;</strong></span>&#13;
 &#13;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DataManager</span> : <span class="hljs-title">MonoBehaviour</span>, <span class="hljs-title">IManager</span>&#13;
{&#13;
    <span class="hljs-comment">// ... No variable changes needed ...</span>&#13;
 &#13;
    <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Initialize</span><span class="hljs-function">()</span>&#13;
    {&#13;
        _state = <span class="hljs-string">"Data Manager initialized.."</span>;&#13;
        Debug.Log(_state);&#13;
    &#13;
        <span class="code-highlight"><strong class="hljs-comment-slc">// 2</strong></span>&#13;
        <span class="code-highlight"><strong class="hljs-slc">FilesystemInfo();</strong></span>&#13;
    }&#13;
    <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">FilesystemInfo</span><span class="hljs-function">()</span>&#13;
    {&#13;
        <span class="code-highlight"><strong class="hljs-comment-slc">// 3</strong></span>&#13;
        <span class="code-highlight"><strong class="hljs-slc">Debug.LogFormat(</strong><strong class="hljs-string-slc">"Path separator character: {0}"</strong><strong class="hljs-slc">,</strong></span>&#13;
          <span class="code-highlight"><strong class="hljs-slc">Path.PathSeparator);</strong></span>&#13;
        <span class="code-highlight"><strong class="hljs-slc">Debug.LogFormat(</strong><strong class="hljs-string-slc">"Directory separator character: {0}"</strong><strong class="hljs-slc">,</strong></span>&#13;
          <span class="code-highlight"><strong class="hljs-slc">Path.DirectorySeparatorChar);</strong></span>&#13;
        <span class="code-highlight"><strong class="hljs-slc">Debug.LogFormat(</strong><strong class="hljs-string-slc">"Current directory: {0}"</strong><strong class="hljs-slc">,</strong></span>&#13;
          <span class="code-highlight"><strong class="hljs-slc">Directory.GetCurrentDirectory());</strong></span>&#13;
        <span class="code-highlight"><strong class="hljs-slc">Debug.LogFormat(</strong><strong class="hljs-string-slc">"Temporary path: {0}"</strong><strong class="hljs-slc">,</strong></span>&#13;
          <span class="code-highlight"><strong class="hljs-slc">Path.GetTempPath());</strong></span>&#13;
    }&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
    </ol>&#13;
    <p class="normal">Let's break down the code:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">First, we add the <code class="Code-In-Text--PACKT-">System.IO</code> namespace, which has all the classes and methods we need to work with the filesystem.</li>&#13;
      <li class="numbered">We call the <code class="Code-In-Text--PACKT-">FilesystemInfo</code> method we create in the next step.</li>&#13;
      <li class="numbered">We create the <code class="Code-In-Text--PACKT-">FilesystemInfo</code> method to print out a few filesystem properties. Every <a id="_idIndexMarker774"/>operating system handles its filesystem paths differently—a path is the location of a directory or file written in a string. On Macs:<ul>&#13;
          <li class="bullet-l2">Paths are separated by a colon (<code class="Code-In-Text--PACKT-">:</code>)</li>&#13;
          <li class="bullet-l2">Directories are separated by a forward slash (<code class="Code-In-Text--PACKT-">/</code>)</li>&#13;
          <li class="bullet-l2">The current directory path is where the <em class="italic">Hero Born</em> project is stored</li>&#13;
          <li class="bullet-l2">The temporary path is the location of your filesystem's temporary folder</li>&#13;
        </ul>&#13;
      </li>&#13;
    </ol>&#13;
    <p class="normal">If you're on other platforms and operating systems, make sure to check the <code class="Code-In-Text--PACKT-">Path</code> and <code class="Code-In-Text--PACKT-">Directory</code> methods for yourself before working with the filesystem.</p>&#13;
    <p class="normal">Run the game and take a look at the output:</p>&#13;
    <figure class="mediaobject"><img src="Images/B17573_12_03.png" alt="" width="832" height="262"/></figure>&#13;
    <p class="packt_figref">Figure 12.3: Console messages from Data Manager</p>&#13;
    <p class="normal">The <code class="Code-In-Text--PACKT-">Path</code> and <code class="Code-In-Text--PACKT-">Directory</code> classes are the foundation we're going to be building on to store our data in the <a id="_idIndexMarker775"/>following sections. However, they're both large classes, so I encourage you to look into their documentation as you continue your data journey.</p>&#13;
    <div class="note">&#13;
      <p class="Information-Box--PACKT-">You can find <a id="_idIndexMarker776"/>more documentation for the Path class at <a href="https://docs.microsoft.com/en-us/dotnet/api/system.io.path"><span class="url">https://docs.microsoft.com/en-us/dotnet/api/system.io.path</span></a> and <a id="_idIndexMarker777"/>the Directory class at <a href="https://docs.microsoft.com/en-us/dotnet/api/system.io.directory"><span class="url">https://docs.microsoft.com/en-us/dotnet/api/system.io.directory</span></a>.</p>&#13;
    </div>&#13;
    <p class="normal">Now that we have a simple example of filesystem properties printed out in our <code class="Code-In-Text--PACKT-">DataManager</code> script, we can create a filesystem path to the location where we want to save our data.</p>&#13;
    <h2 id="_idParaDest-238" class="title">Working with asset paths</h2>&#13;
    <p class="normal">In a purely C# application, you would have to choose what folder to save your files in and write out the <a id="_idIndexMarker778"/>folder path in a string. However, Unity provides a handy pre-configured path as part of the <code class="Code-In-Text--PACKT-">Application</code> class where you can store persistent game data. Persistent data means the information is saved and kept each time the program runs, which makes it ideal for this kind of player information. </p>&#13;
    <div class="note">&#13;
      <p class="Information-Box--PACKT-">It's important to know that the path to Unity's persistent data directory is cross-platform, meaning <a id="_idIndexMarker779"/>that it's different whether you're building a game for iOS, Android, Windows, and more. You can find out more information in the Unity documentation at <a href="https://docs.unity3d.com/ScriptReference/Application-persistentDataPath.html"><span class="url">https://docs.unity3d.com/ScriptReference/Application-persistentDataPath.html</span></a>.</p>&#13;
    </div>&#13;
    <p class="normal">The only update we need to make to <code class="Code-In-Text--PACKT-">DataManager</code> is creating a private variable to hold our path string. We're making this private because we don't want any other script to be able to access <a id="_idIndexMarker780"/>or change the value. That way, <code class="Code-In-Text--PACKT-">DataManager</code> is responsible for all data-related logic and nothing else.</p>&#13;
    <p class="normal">Add the following variable to <code class="Code-In-Text--PACKT-">DataManager.cs</code>:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DataManager</span> : <span class="hljs-title">MonoBehaviour</span>, <span class="hljs-title">IManager</span>&#13;
{&#13;
    <span class="hljs-comment">// ... No other variable changes needed ...</span>&#13;
 &#13;
    <span class="code-highlight"><strong class="hljs-comment-slc">// 1</strong></span>&#13;
    <span class="code-highlight"><strong class="hljs-keyword-slc">private</strong><strong class="hljs-slc"> </strong><strong class="hljs-built_in-slc">string</strong><strong class="hljs-slc"> _dataPath;</strong></span>&#13;
    <span class="code-highlight"><strong class="hljs-comment-slc">// 2</strong></span>&#13;
    <span class="code-highlight"><strong class="hljs-keyword-slc">void</strong><strong class="hljs-function-slc"> </strong><strong class="hljs-title-slc">Awake</strong><strong class="hljs-function-slc">()</strong></span>&#13;
    <span class="code-highlight"><strong class="hljs-slc">{</strong></span>&#13;
        <span class="code-highlight"><strong class="hljs-slc">_dataPath = Application.persistentDataPath + </strong><strong class="hljs-string-slc">"/Player_Data/"</strong><strong class="hljs-slc">;</strong></span>&#13;
    &#13;
        <span class="code-highlight"><strong class="hljs-slc">Debug.Log(_dataPath);</strong></span>&#13;
    <span class="code-highlight"><strong class="hljs-slc">}</strong></span>&#13;
 &#13;
    <span class="hljs-comment">// ... No other changes needed ...</span>&#13;
}&#13;
</code></pre>&#13;
    <p class="normal">Let's break down our code update:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">We created a private variable to hold the data path string </li>&#13;
      <li class="numbered">We set the data path string to the application's <code class="Code-In-Text--PACKT-">persistentDataPath</code> value, added a new folder name called <strong class="screenText">Player_Data </strong>using open and closed forward slashes, and printed out the complete path:<ul>&#13;
          <li class="bullet-l2">It's important to note that <code class="Code-In-Text--PACKT-">Application.persistentDataPath</code> can only be used in a <code class="Code-In-Text--PACKT-">MonoBehaviour</code> method like <code class="Code-In-Text--PACKT-">Awake()</code>, <code class="Code-In-Text--PACKT-">Start()</code>, <code class="Code-In-Text--PACKT-">Update()</code>, and so on and the game needs to be running for Unity to return a valid path.</li>&#13;
        </ul>&#13;
        <figure class="mediaobject"><img src="Images/B17573_12_04.png" alt="" width="1099" height="138"/></figure>&#13;
    <p class="packt_figref">Figure 12.4: File path for Unity persistent data files</p>&#13;
      </li>&#13;
    </ol>&#13;
&#13;
    <p class="normal">Since I'm using a Mac, my persistent data folder is nested inside my <code class="Code-In-Text--PACKT-">/Users </code>folder. Remember to check out <a href="https://docs.unity3d.com/ScriptReference/Application-persistentDataPath.html"><span class="url">https://docs.unity3d.com/ScriptReference/Application-persistentDataPath.html</span></a> to find out where your data is stored if you're using a different device.</p>&#13;
    <p class="normal">When you're not working with a predefined asset path like Unity's persistent data directory, C# has a handy <a id="_idIndexMarker781"/>method called <code class="Code-In-Text--PACKT-">Combine</code> in the <code class="Code-In-Text--PACKT-">Path</code> class for automatically configuring path variables. The <code class="Code-In-Text--PACKT-">Combine()</code> method can take up to four strings as input parameters or an array of strings representing the path components. For example, a path to your <code class="Code-In-Text--PACKT-">User</code> directory might look like:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">var</span> path = Path.Combine(<span class="hljs-string">"/Users"</span>, <span class="hljs-string">"hferrone"</span>, <span class="hljs-string">"Chapter_12"</span>);&#13;
</code></pre>&#13;
    <p class="normal">This takes care of any potential cross-platform issues with separating characters and back or forward slashes in paths and directories. </p>&#13;
    <p class="normal">Now that we have a path to store our data, let's create a new directory, or folder, in the filesystem. This will let us store our data securely and between game runs, as opposed to temporary storage where it would be deleted or overwritten.</p>&#13;
    <h2 id="_idParaDest-239" class="title">Creating and deleting directories</h2>&#13;
    <p class="normal">Creating a new directory folder is straightforward—we check to see if one already exists with the same <a id="_idIndexMarker782"/>name at the same path, and if not, we tell C# to create it for us. Everyone has their <a id="_idIndexMarker783"/>own ways of dealing with duplicates in their files and folders, so we'll be repeating a fair bit <a id="_idIndexMarker784"/>of duplicate checking code in the rest of the chapter. </p>&#13;
    <p class="normal">I'd still recommend following the <strong class="keyword">DRY</strong> (<strong class="keyword">Don't Repeat Yourself</strong>) principle in real-world applications; the duplicate checking code is only repeated here to make the examples complete and easy to understand:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Add the following method to <code class="Code-In-Text--PACKT-">DataManager</code>:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">NewDirectory</span><span class="hljs-function">()</span>&#13;
{&#13;
    <span class="hljs-comment">// 1</span>&#13;
    <span class="hljs-keyword">if</span>(Directory.Exists(_dataPath))&#13;
    {&#13;
        <span class="hljs-comment">// 2</span>&#13;
        Debug.Log(<span class="hljs-string">"Directory already exists..."</span>);&#13;
        <span class="hljs-keyword">return</span>;&#13;
    }&#13;
    <span class="hljs-comment">// 3</span>&#13;
    Directory.CreateDirectory(_dataPath);&#13;
    Debug.Log(<span class="hljs-string">"New directory created!"</span>);&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Call the new method inside <code class="Code-In-Text--PACKT-">Initialize()</code>:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Initialize</span><span class="hljs-function">()</span>&#13;
{&#13;
    _state = <span class="hljs-string">"Data Manager initialized.."</span>;&#13;
    Debug.Log(_state);&#13;
    <span class="code-highlight"><strong class="hljs-slc">NewDirectory();</strong></span>&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
    </ol>&#13;
    <p class="normal">Let's break down what we did:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">First, we check if <a id="_idIndexMarker785"/>the directory folder already exists using the path we created in the last step</li>&#13;
      <li class="numbered">If it's already been <a id="_idIndexMarker786"/>created, we send ourselves a message in the console and use the <code class="Code-In-Text--PACKT-">return</code> keyword to exit the method without going any further</li>&#13;
      <li class="numbered">If the directory folder doesn't exist, we pass the <code class="Code-In-Text--PACKT-">CreateDirectory()</code> method our data path and log that it's been created</li>&#13;
    </ol>&#13;
    <p class="normal">Run the game and make sure that you see the right debug logs in the console, as well as the new directory folder in your persistent data folder. </p>&#13;
    <p class="normal">If you can't find it, use the <code class="Code-In-Text--PACKT-">_dataPath</code> value we printed out in the previous step. </p>&#13;
    <figure class="mediaobject"><img src="Images/B17573_12_05.png" alt="" width="826" height="149"/></figure>&#13;
    <p class="packt_figref">Figure 12.5: Console message for new directory creation</p>&#13;
    <figure class="mediaobject"><img src="Images/B17573_12_06.png" alt="" width="826" height="228"/></figure>&#13;
    <p class="packt_figref">Figure 12.6: New directory created on the desktop</p>&#13;
    <p class="normal">If you run the game a <a id="_idIndexMarker787"/>second time, no duplicate directory folder will be created, which is <a id="_idIndexMarker788"/>exactly the kind of safe code we want.</p>&#13;
    <figure class="mediaobject"><img src="Images/B17573_12_07.png" alt="" width="818" height="152"/></figure>&#13;
    <p class="packt_figref">Figure 12.7: Console message for duplicate directory folders</p>&#13;
    <p class="normal">Deleting a directory is very similar to how we created it – we check if it exists, then we use the <code class="Code-In-Text--PACKT-">Directory</code> class to delete whatever folder is at the path we pass in.</p>&#13;
    <p class="normal">Add the following method to <code class="Code-In-Text--PACKT-">DataManager</code>:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">DeleteDirectory</span><span class="hljs-function">()</span>&#13;
{&#13;
    <span class="hljs-comment">// 1</span>&#13;
    <span class="hljs-keyword">if</span>(!Directory.Exists(_dataPath))&#13;
    {&#13;
        <span class="hljs-comment">// 2</span>&#13;
        Debug.Log(<span class="hljs-string">"Directory doesn't exist or has already been</span>&#13;
<span class="hljs-string">deleted..."</span>);&#13;
            &#13;
        <span class="hljs-keyword">return</span>;&#13;
    }&#13;
    <span class="hljs-comment">// 3</span>&#13;
    Directory.Delete(_dataPath, <span class="hljs-literal">true</span>);&#13;
    Debug.Log(<span class="hljs-string">"Directory successfully deleted!"</span>);&#13;
}&#13;
</code></pre>&#13;
    <p class="normal">Since we want to <a id="_idIndexMarker789"/>keep the directory we just created, you don't have to call this <a id="_idIndexMarker790"/>function right now. However, if you want to try it out all you need to do is replace <code class="Code-In-Text--PACKT-">NewDirectory()</code> with <code class="Code-In-Text--PACKT-">DeleteDirectory()</code> in the <code class="Code-In-Text--PACKT-">Initialize()</code> function.</p>&#13;
    <p class="normal">An empty directory folder isn't super useful, so let's create our first text file and save it in our new location.</p>&#13;
    <h2 id="_idParaDest-240" class="title">Creating, updating, and deleting files</h2>&#13;
    <p class="normal">Working with files is <a id="_idIndexMarker791"/>similar to creating and deleting a directory, so we already have <a id="_idIndexMarker792"/>the basic building blocks we need. To make sure we don't duplicate data, we'll check if the <a id="_idIndexMarker793"/>file already exists, and if not, we'll create a new one in our new directory folder. </p>&#13;
    <div class="note">&#13;
      <p class="Information-Box--PACKT-">We'll be working with the <code class="Code-In-Text--PACKT-">File</code> class for this section, which has a ton of helpful methods to help <a id="_idIndexMarker794"/>us implement our features. You can find the entire list at <a href="https://docs.microsoft.com/en-us/dotnet/api/system.io.file"><span class="url">https://docs.microsoft.com/en-us/dotnet/api/system.io.file</span></a>.</p>&#13;
    </div>&#13;
    <p class="normal">An important point to drive home about files before we start is that they need to be opened before you can add text, and they need to be closed after you're finished. If you don't close the file you're programmatically working with, it will stay open in the program's memory. This both uses computation power for something you're not actively editing and can create potential memory leaks. More on them later in the chapter.</p>&#13;
    <div class="note">&#13;
      <p class="Information-Box--PACKT-">We're going to be writing individual methods for each action we want to perform (create, update, and delete). We're also going to check if the files we're working with exist or not in each case, which is repetitive. I've structured this part of the book so you can get a solid grasp of each of the procedures. However, you can absolutely combine them into more economical methods after you've learned the basics.</p>&#13;
    </div>&#13;
    <p class="normal">Take the following steps:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Add a new private <a id="_idIndexMarker795"/>string path for the new text file and set its value in <code class="Code-In-Text--PACKT-">Awake</code>:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">private</span> <span class="hljs-built_in">string</span> _dataPath;&#13;
<span class="code-highlight"><strong class="hljs-keyword-slc">private</strong><strong class="hljs-slc"> </strong><strong class="hljs-built_in-slc">string</strong><strong class="hljs-slc"> _textFile;</strong></span>&#13;
<span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Awake</span><span class="hljs-function">()</span>&#13;
{&#13;
    _dataPath = Application.persistentDataPath + <span class="hljs-string">"/Player_Data/"</span>;&#13;
        &#13;
    Debug.Log(_dataPath);&#13;
 &#13;
    <span class="code-highlight"><strong class="hljs-slc">_textFile = _dataPath + </strong><strong class="hljs-string-slc">"Save_Data.txt"</strong><strong class="hljs-slc">;</strong></span>&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Add a new <a id="_idIndexMarker796"/>method to <code class="Code-In-Text--PACKT-">DataManager</code>:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">NewTextFile</span><span class="hljs-function">()</span>&#13;
{&#13;
    <span class="hljs-comment">// 1</span>&#13;
    <span class="hljs-keyword">if</span> (File.Exists(_textFile))&#13;
    {&#13;
        Debug.Log(<span class="hljs-string">"File already exists..."</span>);&#13;
        <span class="hljs-keyword">return</span>;&#13;
    }&#13;
    <span class="hljs-comment">// 2</span>&#13;
    File.WriteAllText(_textFile, <span class="hljs-string">"&lt;SAVE DATA&gt;\n\n"</span>);&#13;
    <span class="hljs-comment">// 3</span>&#13;
    Debug.Log(<span class="hljs-string">"New file created!"</span>);&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Call the new <a id="_idIndexMarker797"/>method in <code class="Code-In-Text--PACKT-">Initialize()</code>:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Initialize</span><span class="hljs-function">()</span>&#13;
{&#13;
    _state = <span class="hljs-string">"Data Manager initialized.."</span>;&#13;
    Debug.Log(_state);&#13;
 &#13;
    FilesystemInfo();&#13;
    NewDirectory();&#13;
    <span class="code-highlight"><strong class="hljs-slc">NewTextFile();</strong></span>&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
    </ol>&#13;
    <p class="normal">Let's break down our new code:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">We check if the file <a id="_idIndexMarker798"/>already exists, and if it does we <code class="Code-In-Text--PACKT-">return</code> out of the method to avoid duplicates:<ul>&#13;
          <li class="bullet-l2">It's worth <a id="_idIndexMarker799"/>noting that this approach works well for new files that aren't going to be changed. We'll cover updating and overwriting <a id="_idIndexMarker800"/>data to files in the next exercise.</li>&#13;
        </ul>&#13;
      </li>&#13;
      <li class="numbered">We use the <code class="Code-In-Text--PACKT-">WriteAllText()</code> method because it does everything we need all in one: <ul>&#13;
          <li class="bullet-l2">A new file is created using our <code class="Code-In-Text--PACKT-">_textFile</code> path</li>&#13;
          <li class="bullet-l2">We add a title string that says <code class="Code-In-Text--PACKT-">&lt;SAVE DATA&gt;</code> and add two new lines with the <code class="Code-In-Text--PACKT-">\n</code> characters</li>&#13;
          <li class="bullet-l2">Then the file is closed for us automatically</li>&#13;
        </ul>&#13;
      </li>&#13;
      <li class="numbered">We print out a log message to let us know everything went smoothly</li>&#13;
    </ol>&#13;
    <p class="normal">When you play the game now, you'll see the debug log in the console and the new text file in your persistent data folder location:</p>&#13;
    <figure class="mediaobject"><img src="Images/B17573_12_08.png" alt="" width="828" height="134"/></figure>&#13;
    <p class="packt_figref">Figure 12.8: Console messages for new file creation</p>&#13;
    <figure class="mediaobject"><img src="Images/B17573_12_09.png" alt="" width="824" height="375"/></figure>&#13;
    <p class="packt_figref">Figure 12.9: New file created on desktop</p>&#13;
    <p class="normal">To update our new <a id="_idIndexMarker801"/>text file, we'll do a similar set of operations. It's always nice to know <a id="_idIndexMarker802"/>when a new game is started, so your next task is to add a method to <a id="_idIndexMarker803"/>write that information to our save data file:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Add a new <code class="Code-In-Text--PACKT-">using</code> directive to the top of <code class="Code-In-Text--PACKT-">DataManager</code>:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">using</span> System.Collections;&#13;
<span class="hljs-keyword">using</span> System.Collections.Generic;&#13;
<span class="hljs-keyword">using</span> UnityEngine;&#13;
<span class="hljs-keyword">using</span> System.IO;&#13;
<span class="code-highlight"><strong class="hljs-keyword-slc">using</strong><strong class="hljs-slc"> System;</strong></span>&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Add a new method to <code class="Code-In-Text--PACKT-">DataManager</code>:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">UpdateTextFile</span><span class="hljs-function">()</span>&#13;
{&#13;
    <span class="hljs-comment">// 1</span>&#13;
    <span class="hljs-keyword">if</span> (!File.Exists(_textFile))&#13;
    {&#13;
        Debug.Log(<span class="hljs-string">"File doesn't exist..."</span>);&#13;
        <span class="hljs-keyword">return</span>;&#13;
    }&#13;
 &#13;
    <span class="hljs-comment">// 2</span>&#13;
    File.AppendAllText(_textFile, <span class="hljs-string">$"Game started: </span><span class="hljs-subst">{DateTime.Now}</span><span class="hljs-string">\n"</span>);&#13;
    <span class="hljs-comment">// 3</span>&#13;
    Debug.Log(<span class="hljs-string">"File updated successfully!"</span>);&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Call the new <a id="_idIndexMarker804"/>method in <code class="Code-In-Text--PACKT-">Initialize()</code>:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Initialize</span><span class="hljs-function">()</span>&#13;
{&#13;
    _state = <span class="hljs-string">"Data Manager initialized.."</span>;&#13;
    Debug.Log(_state);&#13;
 &#13;
    FilesystemInfo();&#13;
    NewDirectory();&#13;
    NewTextFile();&#13;
    <span class="code-highlight"><strong class="hljs-slc">UpdateTextFile();</strong></span>&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
    </ol>&#13;
    <p class="normal">Let's break down the above code:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">If the file exists, we <a id="_idIndexMarker805"/>don't want to duplicate it so we just exit out of the method without any further action</li>&#13;
      <li class="numbered">If the file does exist, we use <a id="_idIndexMarker806"/>another all-in-one method called <code class="Code-In-Text--PACKT-">AppendAllText()</code> to add the game's start time:<ul>&#13;
          <li class="bullet-l2">This method opens the file</li>&#13;
          <li class="bullet-l2">It adds a new line of text that's passed in as a method parameter</li>&#13;
          <li class="bullet-l2">It closes the file </li>&#13;
        </ul>&#13;
      </li>&#13;
      <li class="numbered">Print out a log message to let us know everything went smoothly</li>&#13;
    </ol>&#13;
    <p class="normal">Play the game again and you'll see our console message and a new line in our text file with the new game's date and time:</p>&#13;
    <figure class="mediaobject"><img src="Images/B17573_12_10.png" alt="" width="826" height="195"/></figure>&#13;
    <p class="packt_figref">Figure 12.10: Console messages for updating the text file</p>&#13;
    <figure class="mediaobject"><img src="Images/B17573_12_11.png" alt="" width="826" height="355"/></figure>&#13;
    <p class="packt_figref">Figure 12.11: Text file data updated </p>&#13;
    <p class="normal">In order to read our <a id="_idIndexMarker807"/>new file data, we need a method to grab all the file's text and <a id="_idIndexMarker808"/>hand it back to us in a string. Luckily, the <code class="Code-In-Text--PACKT-">File </code>class has <a id="_idIndexMarker809"/>methods to do just that:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Add a new method to <code class="Code-In-Text--PACKT-">DataManager</code>:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// 1</span>&#13;
<span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">ReadFromFile</span><span class="hljs-function">(</span><span class="hljs-built_in">string</span><span class="hljs-params"> filename</span><span class="hljs-function">)</span>&#13;
{&#13;
    <span class="hljs-comment">// 2</span>&#13;
    <span class="hljs-keyword">if</span> (!File.Exists(filename))&#13;
    {&#13;
        Debug.Log(<span class="hljs-string">"File doesn't exist..."</span>);&#13;
        <span class="hljs-keyword">return</span>;&#13;
    }&#13;
 &#13;
    <span class="hljs-comment">// 3</span>&#13;
    Debug.Log(File.ReadAllText(filename));&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Call the new method in <code class="Code-In-Text--PACKT-">Initialize()</code> and pass in the <code class="Code-In-Text--PACKT-">_textFile</code> as a parameter:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Initialize</span><span class="hljs-function">()</span>&#13;
{&#13;
    _state = <span class="hljs-string">"Data Manager initialized.."</span>;&#13;
    Debug.Log(_state);&#13;
 &#13;
    FilesystemInfo();&#13;
    NewDirectory();&#13;
    NewTextFile();&#13;
    UpdateTextFile();&#13;
    <span class="code-highlight"><strong class="hljs-slc">ReadFromFile(_textFile);</strong></span>&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
    </ol>&#13;
    <p class="normal">Let's break down the new method's code below:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">We create a <a id="_idIndexMarker810"/>new method that takes in a string parameter for the file we <a id="_idIndexMarker811"/>want to read</li>&#13;
      <li class="numbered">If the file doesn't exist, there's no action needed so we exit out of the method</li>&#13;
      <li class="numbered">We use the <code class="Code-In-Text--PACKT-">ReadAllText()</code> method to <a id="_idIndexMarker812"/>get all the file's text data as a string and print it out to the console</li>&#13;
    </ol>&#13;
    <p class="normal">Play the game and you'll see a console message with our previous save and a new one!</p>&#13;
    <figure class="mediaobject"><img src="Images/B17573_12_12.png" alt="" width="826" height="328"/></figure>&#13;
    <p class="packt_figref">Figure 12.12: Console message with saved text data read from file </p>&#13;
    <p class="normal">Lastly, let's add a method to delete our text file if we wanted. We're not actually going to use this method, as we want to keep our text file as is, but you can always try it out for yourself:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">DeleteFile</span><span class="hljs-function">(</span><span class="hljs-built_in">string</span><span class="hljs-params"> filename</span><span class="hljs-function">)</span>&#13;
{&#13;
    <span class="hljs-keyword">if</span> (!File.Exists(filename))&#13;
    {&#13;
        Debug.Log(<span class="hljs-string">"File doesn't exist or has already been deleted..."</span>);&#13;
            &#13;
        <span class="hljs-keyword">return</span>;&#13;
    }&#13;
 &#13;
    File.Delete(_textFile);&#13;
    Debug.Log(<span class="hljs-string">"File successfully deleted!"</span>);&#13;
}&#13;
</code></pre>&#13;
    <p class="normal">Now that we've dipped our toes a little deeper into the filesystem waters, it's time to talk about a slightly upgraded way of working with information — data streams!</p>&#13;
    <h1 id="_idParaDest-241" class="title">Working with streams</h1>&#13;
    <p class="normal">So far, we've been letting the <code class="Code-In-Text--PACKT-">File</code> class do all of the heavy lifting with our data. What we haven't talked <a id="_idIndexMarker813"/>about is how the <code class="Code-In-Text--PACKT-">File</code> class, or any other class that deals with reading and writing data, does that work under the hood.</p>&#13;
    <p class="normal">For computers, data is made up of bytes. Think of bytes as the computer's atoms, they make up everything—there's even a C# <code class="Code-In-Text--PACKT-">byte</code> type. When we read, write, or update a file, our data is converted into an array of bytes, which are then streamed to or from the file using a <code class="Code-In-Text--PACKT-">Stream</code>. The data stream is responsible for carrying the data as a sequence of bytes to or from a file, acting as a translator or intermediary for us between our game application and the data files themselves.</p>&#13;
    <figure class="mediaobject"><img src="Images/B17573_12_13.png" alt="" width="828" height="223"/></figure>&#13;
    <p class="packt_figref">Figure 12.13: Diagram of streaming data to a file</p>&#13;
    <p class="normal">The <code class="Code-In-Text--PACKT-">File</code> class uses <code class="Code-In-Text--PACKT-">Stream</code> objects for us automatically, and there are different <code class="Code-In-Text--PACKT-">Stream</code> subclasses for <a id="_idIndexMarker814"/>different functionality:</p>&#13;
    <ul>&#13;
      <li class="bullet">Use a <code class="Code-In-Text--PACKT-">FileStream</code> to read and write data to your files</li>&#13;
      <li class="bullet">Use a <code class="Code-In-Text--PACKT-">MemoryStream</code> to read and write data to memory</li>&#13;
      <li class="bullet">Use a <code class="Code-In-Text--PACKT-">NetworkStream</code> to read and write data to other networked computers</li>&#13;
      <li class="bullet">Use a <code class="Code-In-Text--PACKT-">GZipStream</code> to compress data for easier storage and downloading</li>&#13;
    </ul>&#13;
    <p class="normal">In the coming sections, we'll get into managing stream resources, using helper classes called <code class="Code-In-Text--PACKT-">StreamReader</code><strong class="keyword"> </strong>and <code class="Code-In-Text--PACKT-">StreamWriter</code> to create, read, update, and delete files. You'll also learn how to format XML more easily using the <code class="Code-In-Text--PACKT-">XmlWriter</code> class.</p>&#13;
    <h2 id="_idParaDest-242" class="title">Managing your Stream resources</h2>&#13;
    <p class="normal">One important topic we haven't talked about yet is resource allocation. What that means is some processes in your code will put computing power and memory on a sort of layaway plan where <a id="_idIndexMarker815"/>you can't touch it. These processes will wait until you explicitly tell your program or game to close and return the layaway resources to you so you're back to full power. Streams are one such process, and they need to be closed after you're done using them. If you don't properly close your streams, your program will keep using those resources even though you're not.</p>&#13;
    <p class="normal">Luckily, C# has a handy interface called <code class="Code-In-Text--PACKT-">IDisposable</code> that all <code class="Code-In-Text--PACKT-">Stream</code> classes implement. This interface only has one method, <code class="Code-In-Text--PACKT-">Dispose()</code>, which tells the stream when to give you back the resources it's been using. </p>&#13;
    <p class="normal">You don't have to worry too much about this, as we'll cover an automatic <a id="_idIndexMarker816"/>way to make sure your streams are always closed correctly. Resource management is just a good programming concept to understand.</p>&#13;
    <p class="normal">We'll be using a <code class="Code-In-Text--PACKT-">FileStream</code> for the rest of the chapter, but we'll be doing so with convenience classes called <code class="Code-In-Text--PACKT-">StreamWriter</code> and <code class="Code-In-Text--PACKT-">StreamReader</code>. These classes leave out the manual conversion of data to bytes, but still use <code class="Code-In-Text--PACKT-">FileStream</code> objects themselves. </p>&#13;
    <h2 id="_idParaDest-243" class="title">Using a StreamWriter and StreamReader</h2>&#13;
    <p class="normal">Both the <code class="Code-In-Text--PACKT-">StreamWriter</code> and <code class="Code-In-Text--PACKT-">StreamReader</code> classes serve as helpers for using objects belonging to <code class="Code-In-Text--PACKT-">FileStream</code> to write and read text data to a specific file. These classes are a big help because <a id="_idIndexMarker817"/>they create, open, and return a stream you can use with minimal boilerplate code. The example code we've covered so far is fine for small data files, but streams <a id="_idIndexMarker818"/>are the way to go if you're dealing with large and complex data objects. </p>&#13;
    <p class="normal">All we need is the name of the file we want to write to or read from and we're all set. Your next task is to use a stream to write text to a new file:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Add a new private string path for the new streaming text file and set its value in <code class="Code-In-Text--PACKT-">Awake()</code>:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">private</span> <span class="hljs-built_in">string</span> _dataPath;&#13;
<span class="hljs-keyword">private</span> <span class="hljs-built_in">string</span> _textFile;&#13;
<span class="code-highlight"><strong class="hljs-keyword-slc">private</strong><strong class="hljs-slc"> </strong><strong class="hljs-built_in-slc">string</strong><strong class="hljs-slc"> _streamingTextFile;</strong></span>&#13;
 &#13;
<span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Awake</span><span class="hljs-function">()</span>&#13;
{&#13;
    _dataPath = Application.persistentDataPath + <span class="hljs-string">"/Player_Data/"</span>;&#13;
    Debug.Log(_dataPath);&#13;
 &#13;
    _textFile = _dataPath + <span class="hljs-string">"Save_Data.txt"</span>;&#13;
    <span class="code-highlight"><strong class="hljs-slc">_streamingTextFile = _dataPath + </strong><strong class="hljs-string-slc">"Streaming_Save_Data.txt"</strong><strong class="hljs-slc">;</strong></span>&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Add a new method to <code class="Code-In-Text--PACKT-">DataManager</code>:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">WriteToStream</span><span class="hljs-function">(</span><span class="hljs-built_in">string</span><span class="hljs-params"> filename</span><span class="hljs-function">)</span>&#13;
{&#13;
    <span class="hljs-comment">// 1</span>&#13;
    <span class="hljs-keyword">if</span> (!File.Exists(filename))&#13;
    {&#13;
        <span class="hljs-comment">// 2</span>&#13;
        StreamWriter newStream = File.CreateText(filename);&#13;
 &#13;
        <span class="hljs-comment">// 3</span>&#13;
        newStream.WriteLine(<span class="hljs-string">"&lt;Save Data&gt; for HERO BORN \n\n"</span>);&#13;
        newStream.Close();&#13;
        Debug.Log(<span class="hljs-string">"New file created with StreamWriter!"</span>);&#13;
    }&#13;
 &#13;
    <span class="hljs-comment">// 4</span>&#13;
    StreamWriter streamWriter = File.AppendText(filename);&#13;
 &#13;
    <span class="hljs-comment">// 5</span>&#13;
    streamWriter.WriteLine(<span class="hljs-string">"Game ended: "</span> + DateTime.Now);&#13;
    streamWriter.Close();&#13;
    Debug.Log(<span class="hljs-string">"File contents updated with StreamWriter!"</span>);&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Delete or comment <a id="_idIndexMarker819"/>out the methods in <code class="Code-In-Text--PACKT-">Initialize()</code> that we <a id="_idIndexMarker820"/>used in the previous section and add in our new code:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Initialize</span><span class="hljs-function">()</span>&#13;
{&#13;
    _state = <span class="hljs-string">"Data Manager initialized.."</span>;&#13;
    Debug.Log(_state);&#13;
 &#13;
    FilesystemInfo();&#13;
    NewDirectory();&#13;
    <span class="code-highlight"><strong class="hljs-slc">WriteToStream(_streamingTextFile);</strong></span>&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
    </ol>&#13;
    <p class="normal">Let's break down the new method in the above code:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">First, we check if the file doesn't exist</li>&#13;
      <li class="numbered">If the file hasn't been created yet, we add a new <code class="Code-In-Text--PACKT-">StreamWriter</code> instance called <code class="Code-In-Text--PACKT-">newStream</code>, which uses the <code class="Code-In-Text--PACKT-">CreateText()</code> method to create and open the new file</li>&#13;
      <li class="numbered">Once the file is open, we use the <code class="Code-In-Text--PACKT-">WriteLine()</code> method to add a header, close the stream, and print out a debug message</li>&#13;
      <li class="numbered">If the file already <a id="_idIndexMarker821"/>exists and we just want to update it, we grab our <a id="_idIndexMarker822"/>file through a new <code class="Code-In-Text--PACKT-">StreamWriter</code> instance using the <code class="Code-In-Text--PACKT-">AppendText()</code> method so our existing data doesn't get overwritten</li>&#13;
      <li class="numbered">Finally, we write a new line with our game data, close the stream, and print out a debug message:<figure class="mediaobject"><img src="Images/B17573_12_14.png" alt="" width="751" height="168"/></figure>&#13;
&#13;
    <p class="packt_figref">Figure 12.14: Console messages for writing and updating text with a stream</p>&#13;
    <figure class="mediaobject"><img src="Images/B17573_12_15.png" alt="" width="751" height="313"/></figure>&#13;
    <p class="packt_figref">Figure 12.15: New file created and updated with a stream</p>&#13;
      </li>&#13;
    </ol>&#13;
    <p class="normal">Reading from a stream is almost exactly like the <code class="Code-In-Text--PACKT-">ReadFromFile()</code> method we created in the last section. The only difference is that we'll use a <code class="Code-In-Text--PACKT-">StreamReader</code> instance to open and read the information. Again, you want to use streams when you're dealing with big data files or complex objects instead of manually creating and writing to files with the <code class="Code-In-Text--PACKT-">File</code> class:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Add a new method to <code class="Code-In-Text--PACKT-">DataManager</code>:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">ReadFromStream</span><span class="hljs-function">(</span><span class="hljs-built_in">string</span><span class="hljs-params"> filename</span><span class="hljs-function">)</span>&#13;
{&#13;
    <span class="hljs-comment">// 1</span>&#13;
    <span class="hljs-keyword">if</span> (!File.Exists(filename))&#13;
    {&#13;
        Debug.Log(<span class="hljs-string">"File doesn't exist..."</span>);&#13;
        <span class="hljs-keyword">return</span>;&#13;
    }&#13;
 &#13;
    <span class="hljs-comment">// 2</span>&#13;
    StreamReader streamReader = <span class="hljs-keyword">new</span> StreamReader(filename);&#13;
    Debug.Log(streamReader.ReadToEnd());&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Call the new <a id="_idIndexMarker823"/>method in <code class="Code-In-Text--PACKT-">Initialize()</code> and pass in the <code class="Code-In-Text--PACKT-">_streamingTextFile</code> as a parameter:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Initialize</span><span class="hljs-function">()</span>&#13;
{&#13;
    _state = <span class="hljs-string">"Data Manager initialized.."</span>;&#13;
    Debug.Log(_state);&#13;
 &#13;
    FilesystemInfo();&#13;
    NewDirectory();&#13;
    WriteToStream(_streamingTextFile);&#13;
    <span class="code-highlight"><strong class="hljs-slc">ReadFromStream(_streamingTextFile);</strong></span>&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
    </ol>&#13;
    <p class="normal">Let's break down our new code:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">First, we check if the <a id="_idIndexMarker824"/>file doesn't exist, and if it doesn't then we print out a console message and exit the method</li>&#13;
      <li class="numbered">If the file does exist, we create a new <code class="Code-In-Text--PACKT-">StreamReader</code> instance with the name of the file we want to access and print out the entire contents using the <code class="Code-In-Text--PACKT-">ReadToEnd</code> method:<figure class="mediaobject"><img src="Images/B17573_12_16.png" alt="" width="751" height="223"/></figure>&#13;
    <p class="packt_figref">Figure 12.16: Console printing out saved data read from a stream</p>&#13;
      </li>&#13;
    </ol>&#13;
&#13;
    <p class="normal">As you'll start to notice, a lot of our code is starting to look the same. The only difference is our use of stream classes <a id="_idIndexMarker825"/>to do the actual reading-writing work. However, it's important to keep in mind how different use cases will determine which <a id="_idIndexMarker826"/>route you take. Refer back to the beginning of this section to review how each stream type is different.</p>&#13;
    <p class="normal">So far, we've covered the basic features of a <strong class="keyword">CRUD</strong> (<strong class="keyword">Creating</strong>, <strong class="keyword">Reading</strong>, <strong class="keyword">Updating</strong>, <strong class="keyword">and</strong> <strong class="keyword">Deleting</strong>) application using text files. But text files aren't the only data format you'll be using in C# games <a id="_idIndexMarker827"/>and applications. You're likely to see lots of XML and JSON in the wild once you start working with databases and your own complex data structures, which text can't compare to in efficiency or storage.</p>&#13;
    <p class="normal">In the next section, we'll work with some basic XML data, then talk about an easier way to manage streams.</p>&#13;
    <h2 id="_idParaDest-244" class="title">Creating an XMLWriter</h2>&#13;
    <p class="normal">Sometimes you won't just have plain old text to write and read from a file. Your project might require XML-formatted <a id="_idIndexMarker828"/>documents, in which case you'll need to know how to use a regular <code class="Code-In-Text--PACKT-">FileStream</code> to save and load XML data.</p>&#13;
    <p class="normal">Writing XML data to a file isn't all that different from what we've been doing with text and streams. The only difference is we'll explicitly create a <code class="Code-In-Text--PACKT-">FileStream</code> and use it to create an instance of an <code class="Code-In-Text--PACKT-">XmlWriter</code>. Think of the <code class="Code-In-Text--PACKT-">XmlWriter</code> class as a wrapper that takes our data stream, applies XML formatting, and spits out our information as an XML file. Once we have that, we can structure the document in the proper XML format using methods from the <code class="Code-In-Text--PACKT-">XmlWriter</code> class and close the file. </p>&#13;
    <p class="normal">Your next task is to create a file path for a new XML document and add the ability to write XML data to that file using the <code class="Code-In-Text--PACKT-">DataManager</code> class:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Add the highlighted <code class="Code-In-Text--PACKT-">using</code> directive to the top of the <code class="Code-In-Text--PACKT-">DataManager</code> class:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">using</span> System.Collections;&#13;
<span class="hljs-keyword">using</span> System.Collections.Generic;&#13;
<span class="hljs-keyword">using</span> UnityEngine;&#13;
<span class="hljs-keyword">using</span> System.IO;&#13;
<span class="hljs-keyword">using</span> System;&#13;
<span class="code-highlight"><strong class="hljs-keyword-slc">using</strong><strong class="hljs-slc"> System.Xml;</strong></span>&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Add a new private <a id="_idIndexMarker829"/>string path for the new XML file and set its value in <code class="Code-In-Text--PACKT-">Awake()</code>:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// ... No other variable changes needed ...</span>&#13;
<span class="code-highlight"><strong class="hljs-keyword-slc">private</strong><strong class="hljs-slc"> </strong><strong class="hljs-built_in-slc">string</strong><strong class="hljs-slc"> _xmlLevelProgress;</strong></span>&#13;
<span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Awake</span><span class="hljs-function">()</span>&#13;
{&#13;
     <span class="hljs-comment">// ... No other changes needed ...</span>&#13;
     <span class="code-highlight"><strong class="hljs-slc">_xmlLevelProgress = _dataPath + </strong><strong class="hljs-string-slc">"Progress_Data.xml"</strong><strong class="hljs-slc">;</strong></span>&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Add a new method at the bottom of the <code class="Code-In-Text--PACKT-">DataManager</code> class:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">WriteToXML</span><span class="hljs-function">(</span><span class="hljs-built_in">string</span><span class="hljs-params"> filename</span><span class="hljs-function">)</span>&#13;
{&#13;
    <span class="hljs-comment">// 1</span>&#13;
    <span class="hljs-keyword">if</span> (!File.Exists(filename))&#13;
    {&#13;
        <span class="hljs-comment">// 2</span>&#13;
        FileStream xmlStream = File.Create(filename);&#13;
 &#13;
        <span class="hljs-comment">// 3</span>&#13;
        XmlWriter xmlWriter = XmlWriter.Create(xmlStream);&#13;
 &#13;
        <span class="hljs-comment">// 4</span>&#13;
        xmlWriter.WriteStartDocument();&#13;
        <span class="hljs-comment">// 5</span>&#13;
        xmlWriter.WriteStartElement(<span class="hljs-string">"level_progress"</span>);&#13;
 &#13;
        <span class="hljs-comment">// 6</span>&#13;
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">5</span>; i++)&#13;
        {&#13;
            xmlWriter.WriteElementString(<span class="hljs-string">"level"</span>, <span class="hljs-string">"Level-"</span> + i);&#13;
        }&#13;
 &#13;
        <span class="hljs-comment">// 7</span>&#13;
        xmlWriter.WriteEndElement();&#13;
 &#13;
        <span class="hljs-comment">// 8</span>&#13;
        xmlWriter.Close();&#13;
        xmlStream.Close();&#13;
    }&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Call the new <a id="_idIndexMarker830"/>method in <code class="Code-In-Text--PACKT-">Initialize()</code> and pass in <code class="Code-In-Text--PACKT-">_xmlLevelProgress</code> as a parameter:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Initialize</span><span class="hljs-function">()</span>&#13;
{&#13;
    _state = <span class="hljs-string">"Data Manager initialized.."</span>;&#13;
    Debug.Log(_state);&#13;
 &#13;
    FilesystemInfo();&#13;
    NewDirectory();&#13;
    <span class="code-highlight"><strong class="hljs-slc">WriteToXML(_xmlLevelProgress);</strong></span>&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
    </ol>&#13;
    <p class="normal">Let's break down our XML writing method:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">First, we check if the file already exists</li>&#13;
      <li class="numbered">If the file doesn't exist, we create a new <code class="Code-In-Text--PACKT-">FileStream</code> using the new path variable we created</li>&#13;
      <li class="numbered">We then create a new <code class="Code-In-Text--PACKT-">XmlWriter</code> instance and pass it our new <code class="Code-In-Text--PACKT-">FileStream</code></li>&#13;
      <li class="numbered">Next, we use the <code class="Code-In-Text--PACKT-">WriteStartDocument</code> method to specify XML version 1.0</li>&#13;
      <li class="numbered">Then we call the <code class="Code-In-Text--PACKT-">WriteStartElement</code> method to add the opening root element tag named <code class="Code-In-Text--PACKT-">level_progress</code></li>&#13;
      <li class="numbered">Now we can add individual elements to our document using the <code class="Code-In-Text--PACKT-">WriteElementString</code> method, passing in <code class="Code-In-Text--PACKT-">level</code> as the element tag and the level number using a <code class="Code-In-Text--PACKT-">for</code> loop and its index value of <code class="Code-In-Text--PACKT-">i</code></li>&#13;
      <li class="numbered">To close the document, we use the <code class="Code-In-Text--PACKT-">WriteEndElement</code> method to add a closing <code class="Code-In-Text--PACKT-">level</code> tag</li>&#13;
      <li class="numbered">Finally, we close the writer and stream to release the stream resources we've been using</li>&#13;
    </ol>&#13;
    <p class="normal">If you run the game <a id="_idIndexMarker831"/>now, you'll see a new <code class="Code-In-Text--PACKT-">.xml</code> file in our <strong class="screenText">Player_Data</strong> folder with the level progress information:</p>&#13;
    <figure class="mediaobject"><img src="Images/B17573_12_17.png" alt="" width="826" height="285"/></figure>&#13;
    <p class="packt_figref">Figure 12.17: New XML file created with document data</p>&#13;
    <p class="normal">You'll notice that there is no indenting or formatting, which is expected because we didn't specify any output formatting. We're not going to use any of them in this example because we'll be talking about a more efficient way of writing XML data in the next section, on serialization.</p>&#13;
    <div class="note">&#13;
      <p class="Information-Box--PACKT-">You can find <a id="_idIndexMarker832"/>the list of output formatting properties at <a href="https://docs.microsoft.com/dotnet/api/system.xml.xmlwriter#specifying-the-output-format"><span class="url">https://docs.microsoft.com/dotnet/api/system.xml.xmlwriter#specifying-the-output-format</span></a>.</p>&#13;
    </div>&#13;
    <p class="normal">The good news is that reading an XML file is no different than reading any other file. You can call either the <code class="Code-In-Text--PACKT-">readfromfile()</code> or <code class="Code-In-Text--PACKT-">readfromstream()</code> methods inside <code class="Code-In-Text--PACKT-">initialize()</code> and get the same console output:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Initialize</span><span class="hljs-function">()</span>&#13;
{&#13;
    _state = <span class="hljs-string">"Data Manager initialized.."</span>;&#13;
    Debug.Log(_state);&#13;
    FilesystemInfo();&#13;
    NewDirectory();&#13;
    WriteToXML(_xmlLevelProgress);&#13;
    <span class="code-highlight"><strong class="hljs-slc">ReadFromStream(_xmlLevelProgress);</strong></span>&#13;
}&#13;
</code></pre>&#13;
    <figure class="mediaobject"><img src="Images/B17573_12_18.png" alt="" width="828" height="208"/></figure>&#13;
    <p class="packt_figref">Figure 12.18: Console output from reading the XML file data</p>&#13;
    <p class="normal">Now that we've written a <a id="_idIndexMarker833"/>few methods using streams, let's take a look at how to efficiently, and more importantly automatically, close any stream. </p>&#13;
    <h2 id="_idParaDest-245" class="title">Automatically closing streams</h2>&#13;
    <p class="normal">When you're working with streams, wrapping them in a <code class="Code-In-Text--PACKT-">using</code> statement automatically closes the stream for you by calling the <code class="Code-In-Text--PACKT-">Dispose()</code> method from the <code class="Code-In-Text--PACKT-">IDisposable</code> interface we <a id="_idIndexMarker834"/>mentioned earlier. </p>&#13;
    <p class="normal">This way, you never have to worry about unused allocated resources your program might be keeping open for no reason.</p>&#13;
    <p class="normal">The syntax is almost exactly the same as what we've already done, except we use the <code class="Code-In-Text--PACKT-">using</code> keyword at the beginning of the line, then reference a new stream inside a pair of parentheses, followed by a set of curly braces. Anything we want the stream to do, like read or write data, is done inside the curly braces block of code. For example, creating a new text file as we did in the <code class="Code-In-Text--PACKT-">WriteToStream()</code> method would look like this:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// The new stream is wrapped in a using statement</span>&#13;
<span class="hljs-keyword">using</span>(StreamWriter newStream = File.CreateText(filename))&#13;
{&#13;
     <span class="hljs-comment">// Any writing functionality goes inside the curly braces</span>&#13;
     newStream.WriteLine(<span class="hljs-string">"&lt;Save Data&gt; for HERO BORN \n"</span>);&#13;
}&#13;
</code></pre>&#13;
    <p class="normal">As soon as the stream logic is inside the code block, the outer <code class="Code-In-Text--PACKT-">using </code>statement automatically closes the stream and <a id="_idIndexMarker835"/>returns the allocated resources to your program. From here on out, I'd recommend always using this syntax to write your streaming code. It's more efficient, much safer, and will demonstrate your understanding of basic resource management!</p>&#13;
    <p class="normal">With our text and XML stream code working, it's time to move on. If you're wondering why we didn't stream any JSON data, it's because we need to add one more tool to our data toolbox—serialization!</p>&#13;
    <h1 id="_idParaDest-246" class="title">Serializing data </h1>&#13;
    <p class="normal">When we talk about serializing and deserializing data, what we're really talking about is translation. While we've <a id="_idIndexMarker836"/>been translating our text and XML piecemeal in previous sections, being able to take an entire object and translate it in one shot is a great tool to have. </p>&#13;
    <p class="normal">By definition:</p>&#13;
    <ul>&#13;
      <li class="bullet">The act of <strong class="keyword">serializing </strong>an object <a id="_idIndexMarker837"/>translates the object's entire state into another format</li>&#13;
      <li class="bullet">The act of <strong class="keyword">deserializing </strong>is the <a id="_idIndexMarker838"/>reverse, taking the data from a file and restoring it to its former object state</li>&#13;
    </ul>&#13;
    <p class="packt_figref"><img src="Images/B17573_12_19.png" alt="" width="825" height="368"/></p>&#13;
    <p class="packt_figref">Figure 12.19: Example of serializing an object into XML and JSON</p>&#13;
    <p class="normal">Let's take a practical example from the above image — an instance of our <code class="Code-In-Text--PACKT-">Weapon</code> class. Each weapon has its own name and damage properties and associated values, which is called its state. The state of an object is unique, which allows the program to tell them apart.</p>&#13;
    <p class="normal">An object's state also <a id="_idIndexMarker839"/>includes properties or fields that are reference types. For instance, if we had a <code class="Code-In-Text--PACKT-">Character</code> class that had a <code class="Code-In-Text--PACKT-">Weapon</code> property, C# would still recognize the weapon's <code class="Code-In-Text--PACKT-">name</code> and <code class="Code-In-Text--PACKT-">damage</code> properties when serializing and deserializing. You might hear objects with reference properties referred to as object graphs out in the programming world.</p>&#13;
    <p class="normal">Before we jump in, it's worth noting that serializing objects can be tricky if you're not keeping a close eye on making sure the object properties match the data from a file, and vice versa. For example, if there's a mismatch between your class object properties and the data being deserialized, the serializer will return an empty object. We'll cover this in more detail when we try to serialize a C# list into JSON later in the chapter.</p>&#13;
    <p class="normal">To really get the hang of this, let's take our <code class="Code-In-Text--PACKT-">Weapon</code> example and turn it into working code.</p>&#13;
    <h2 id="_idParaDest-247" class="title">Serializing and deserializing XML </h2>&#13;
    <p class="normal">Your task for the rest <a id="_idIndexMarker840"/>of this chapter is to serialize and deserialize a list <a id="_idIndexMarker841"/>of weapons into XML and JSON, with XML going first!</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Add a new <code class="Code-In-Text--PACKT-">using</code> directive to the top of the <code class="Code-In-Text--PACKT-">DataManager</code> class:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">using</span> System.Collections;&#13;
<span class="hljs-keyword">using</span> System.Collections.Generic;&#13;
<span class="hljs-keyword">using</span> UnityEngine;&#13;
<span class="hljs-keyword">using</span> System.IO;&#13;
<span class="hljs-keyword">using</span> System;&#13;
<span class="hljs-keyword">using</span> System.Xml;&#13;
<span class="code-highlight"><strong class="hljs-keyword-slc">using</strong><strong class="hljs-slc"> System.Xml.Serialization;</strong></span>&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Add a serializable attribute to the <code class="Code-In-Text--PACKT-">Weapon</code> class so Unity and C# know the object can be serialized:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-slc">[</strong><strong class="hljs-meta-slc">Serializable</strong><strong class="hljs-slc">]</strong></span>&#13;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> Weapon&#13;
{&#13;
    <span class="hljs-comment">// ... No other changes needed ...</span>&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Add two new <a id="_idIndexMarker842"/>variables, one for the XML file path and one for the list of weapons:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// ... No other variable changes needed ...</span>&#13;
<span class="code-highlight"><strong class="hljs-keyword-slc">private</strong><strong class="hljs-slc"> </strong><strong class="hljs-built_in-slc">string</strong><strong class="hljs-slc"> _xmlWeapons;</strong></span>&#13;
<span class="code-highlight"><strong class="hljs-keyword-slc">private</strong><strong class="hljs-slc"> List&lt;Weapon&gt; weaponInventory = </strong><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> List&lt;Weapon&gt;</strong></span>&#13;
<span class="code-highlight"><strong class="hljs-slc">{</strong></span>&#13;
    <span class="code-highlight"><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> Weapon(</strong><strong class="hljs-string-slc">"Sword of Doom"</strong><strong class="hljs-slc">, </strong><strong class="hljs-number-slc">100</strong><strong class="hljs-slc">),</strong></span>&#13;
    <span class="code-highlight"><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> Weapon(</strong><strong class="hljs-string-slc">"Butterfly knives"</strong><strong class="hljs-slc">, </strong><strong class="hljs-number-slc">25</strong><strong class="hljs-slc">),</strong></span>&#13;
    <span class="code-highlight"><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> Weapon(</strong><strong class="hljs-string-slc">"Brass Knuckles"</strong><strong class="hljs-slc">, </strong><strong class="hljs-number-slc">15</strong><strong class="hljs-slc">),</strong></span>&#13;
<span class="code-highlight"><strong class="hljs-slc">};</strong></span>&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Set the XML file <a id="_idIndexMarker843"/>path value in <code class="Code-In-Text--PACKT-">Awake</code>:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Awake</span><span class="hljs-function">()</span>&#13;
{&#13;
    <span class="hljs-comment">// ... No other changes needed ...</span>&#13;
    <span class="code-highlight"><strong class="hljs-slc">_xmlWeapons = _dataPath + </strong><strong class="hljs-string-slc">"WeaponInventory.xml"</strong><strong class="hljs-slc">;</strong></span>&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Add a new method at the bottom of the <code class="Code-In-Text--PACKT-">DataManager</code> class:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">SerializeXML</span><span class="hljs-function">()</span>&#13;
{&#13;
    <span class="hljs-comment">// 1</span>&#13;
    <span class="hljs-keyword">var</span> xmlSerializer = <span class="hljs-keyword">new</span> XmlSerializer(<span class="hljs-keyword">typeof</span>(List&lt;Weapon&gt;));&#13;
 &#13;
    <span class="hljs-comment">// 2</span>&#13;
    <span class="hljs-keyword">using</span>(FileStream stream = File.Create(_xmlWeapons))&#13;
    {&#13;
        <span class="hljs-comment">// 3</span>&#13;
        xmlSerializer.Serialize(stream, weaponInventory);&#13;
    }&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Call the new method in <code class="Code-In-Text--PACKT-">Initialize</code>:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Initialize</span><span class="hljs-function">()</span>&#13;
{&#13;
    _state = <span class="hljs-string">"Data Manager initialized.."</span>;&#13;
    Debug.Log(_state);&#13;
 &#13;
    FilesystemInfo();&#13;
    NewDirectory();&#13;
    <span class="code-highlight"><strong class="hljs-slc">SerializeXML();</strong></span>&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
    </ol>&#13;
    <p class="normal">Let's break down our new method:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">First, we create an <code class="Code-In-Text--PACKT-">XmlSerializer</code> instance and pass in the type of data we're going to be <a id="_idIndexMarker844"/>translating. In this case, the _<code class="Code-In-Text--PACKT-">weaponInventory</code> is of type <code class="Code-In-Text--PACKT-">List&lt;Weapon&gt;</code>, which is what we use in the <code class="Code-In-Text--PACKT-">typeof</code> operator:<ul>&#13;
          <li class="bullet-l2">The <code class="Code-In-Text--PACKT-">XmlSerializer</code> class is another helpful formatting wrapper, just like the <code class="Code-In-Text--PACKT-">XmlWriter</code> class we used earlier</li>&#13;
        </ul>&#13;
      </li>&#13;
      <li class="numbered">Then, we create a <code class="Code-In-Text--PACKT-">FileStream</code> using the <code class="Code-In-Text--PACKT-">_xmlWeapons</code> file path and wrapped in a <code class="Code-In-Text--PACKT-">using</code> code block <a id="_idIndexMarker845"/>to make sure it's closed properly.</li>&#13;
      <li class="numbered">Finally, we call the <code class="Code-In-Text--PACKT-">Serialize()</code> method and pass in the stream and the data we want to translate.</li>&#13;
    </ol>&#13;
    <p class="normal">Run the game again and take a look at the new XML document we created without having to specify any additional formatting!</p>&#13;
    <p class="normal"><img src="Images/B17573_12_20.png" alt="" width="825" height="450"/></p>&#13;
    <p class="packt_figref">Figure 12.20: XML output in the weapon inventory file</p>&#13;
    <p class="normal">To read back our XML into a <a id="_idIndexMarker846"/>list of weapons, we set up everything almost <a id="_idIndexMarker847"/>exactly same except we use the <code class="Code-In-Text--PACKT-">Deserialize()</code> method from the <code class="Code-In-Text--PACKT-">XmlSerializer</code> class instead:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Add the following method to the bottom of the <code class="Code-In-Text--PACKT-">DataManager</code> class:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">DeserializeXML</span><span class="hljs-function">()</span>&#13;
{&#13;
    <span class="hljs-comment">// 1</span>&#13;
    <span class="hljs-keyword">if</span> (File.Exists(_xmlWeapons))&#13;
    {&#13;
        <span class="hljs-comment">// 2</span>&#13;
        <span class="hljs-keyword">var</span> xmlSerializer = new XmlSerializer(<span class="hljs-keyword">typeof</span>(List&lt;Weapon&gt;));&#13;
 &#13;
        <span class="hljs-comment">// 3</span>&#13;
        <span class="hljs-keyword">using</span> (FileStream stream = File.OpenRead(_xmlWeapons))&#13;
        {&#13;
           <span class="hljs-comment">// 4</span>&#13;
            <span class="hljs-keyword">var</span> weapons = (List&lt;Weapon&gt;)xmlSerializer.Deserialize(stream);&#13;
 &#13;
           <span class="hljs-comment">// 5</span>&#13;
           <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> weapon <span class="hljs-keyword">in</span> weapons)&#13;
           {&#13;
               Debug.LogFormat(<span class="hljs-string">"Weapon: {0} - Damage: {1}"</span>, &#13;
                 weapon.name, weapon.damage);&#13;
           }&#13;
        }&#13;
    }&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Call the new method in <code class="Code-In-Text--PACKT-">Initialize</code> and pass in the <code class="Code-In-Text--PACKT-">_xmlWeapons</code> as a parameter:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Initialize</span><span class="hljs-function">()</span>&#13;
{&#13;
    _state = <span class="hljs-string">"Data Manager initialized.."</span>;&#13;
    Debug.Log(_state);&#13;
 &#13;
    FilesystemInfo();&#13;
    NewDirectory();&#13;
    SerializeXML();&#13;
    <span class="code-highlight"><strong class="hljs-slc">DeserializeXML();</strong></span>&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
    </ol>&#13;
    <p class="normal">Let's break down the <code class="Code-In-Text--PACKT-">deserialize()</code> method:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">First, we check if the file exists</li>&#13;
      <li class="numbered">If the file exists, we <a id="_idIndexMarker848"/>create an <code class="Code-In-Text--PACKT-">XmlSerializer</code> object and specify that <a id="_idIndexMarker849"/>we're going to put the XML data back into a <code class="Code-In-Text--PACKT-">List&lt;Weapon&gt;</code> object </li>&#13;
      <li class="numbered">Then, we open up a <code class="Code-In-Text--PACKT-">FileStream</code> with the <code class="Code-In-Text--PACKT-">_xmlWeapons</code> file name:<ul>&#13;
          <li class="bullet-l2">We're using <code class="Code-In-Text--PACKT-">File.OpenRead()</code> to specify that we want to open the file for reading, not writing</li>&#13;
        </ul>&#13;
      </li>&#13;
      <li class="numbered">Next, we create a variable to hold our deserialized list of weapons:<ul>&#13;
          <li class="bullet-l2">We put the explicit <code class="Code-In-Text--PACKT-">List&lt;Weapon&gt;</code> cast in front of the call to <code class="Code-In-Text--PACKT-">Deserialize()</code> so that we get the correct type back from the serializer</li>&#13;
        </ul>&#13;
      </li>&#13;
      <li class="numbered">Finally, we use a <code class="Code-In-Text--PACKT-">foreach</code> loop to print out each weapon's name and damage values in the console</li>&#13;
    </ol>&#13;
    <p class="normal">When you run the game once again, you'll see that we get a console message for each weapon we deserialized from the XML list. </p>&#13;
    <figure class="mediaobject"><img src="Images/B17573_12_21.png" alt="" width="827" height="382"/></figure>&#13;
    <p class="packt_figref">Figure 12.21: Console output from deserializing XML</p>&#13;
    <p class="normal">That's all we need <a id="_idIndexMarker850"/>to do for XML data, but before we finish out the chapter <a id="_idIndexMarker851"/>we still need to learn how to work with JSON!</p>&#13;
    <h2 id="_idParaDest-248" class="title">Serializing and deserializing JSON</h2>&#13;
    <p class="normal">When it comes to serializing and deserializing JSON, Unity and C# aren't completely in sync. Essentially, C# has its own <code class="Code-In-Text--PACKT-">JsonSerializer</code> class that works the exact same way as the <code class="Code-In-Text--PACKT-">XmlSerializer</code> class we <a id="_idIndexMarker852"/>used in the previous examples. </p>&#13;
    <p class="normal">In order to access the JSON serializer, you need the <code class="Code-In-Text--PACKT-">System.Text.Json</code> <code class="Code-In-Text--PACKT-">using</code> directive. Here's the rub—Unity doesn't <a id="_idIndexMarker853"/>support that namespace. Instead, Unity uses the <code class="Code-In-Text--PACKT-">System.Text</code> namespace and implements its own JSON serializer class called <code class="Code-In-Text--PACKT-">JsonUtility</code>. </p>&#13;
    <p class="normal">Because our project is in Unity, we're going to work with Unity's supported serialization class. However, if you're working with a non-Unity C# project, the concepts are the same as the XML code we just wrote. </p>&#13;
    <div class="note">&#13;
      <p class="Information-Box--PACKT-">You can find a complete how-to that includes code from Microsoft at <a href="https://docs.microsoft.com/en-us/dotnet/standard/serialization/system-text-json-how-to#how-to-write-net-objects-as-json-serialize"><span class="url">https://docs.microsoft.com/en-us/dotnet/standard/serialization/system-text-json-how-to#how-to-write-net-objects-as-json-serialize</span></a>.</p>&#13;
    </div>&#13;
    <p class="normal">Your next task is to serialize a single weapon to get the hang of the <code class="Code-In-Text--PACKT-">JsonUtility</code> class:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Add a new <code class="Code-In-Text--PACKT-">using</code> directive to the top of the <code class="Code-In-Text--PACKT-">DataManager</code> class:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">using</span> System.Collections;&#13;
<span class="hljs-keyword">using</span> System.Collections.Generic;&#13;
<span class="hljs-keyword">using</span> UnityEngine;&#13;
<span class="hljs-keyword">using</span> System.IO;&#13;
<span class="hljs-keyword">using</span> System;&#13;
<span class="hljs-keyword">using</span> System.Xml;&#13;
<span class="hljs-keyword">using</span> System.Xml.Serialization;&#13;
<span class="code-highlight"><strong class="hljs-keyword-slc">using</strong><strong class="hljs-slc"> System.Text;</strong></span>&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Add a new private string path for the new XML file and set its value in <code class="Code-In-Text--PACKT-">Awake()</code>:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc">private</strong><strong class="hljs-slc"> </strong><strong class="hljs-built_in-slc">string</strong><strong class="hljs-slc"> _jsonWeapons;</strong></span>&#13;
<span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Awake</span><span class="hljs-function">()</span>&#13;
{&#13;
    <span class="code-highlight"><strong class="hljs-slc">_jsonWeapons = _dataPath + </strong><strong class="hljs-string-slc">"WeaponJSON.json"</strong><strong class="hljs-slc">;</strong></span>&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Add a new <a id="_idIndexMarker854"/>method at the bottom of the <code class="Code-In-Text--PACKT-">DataManager</code> class:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">SerializeJSON</span><span class="hljs-function">()</span>&#13;
{&#13;
    <span class="hljs-comment">// 1</span>&#13;
    Weapon sword = <span class="hljs-keyword">new</span> Weapon(<span class="hljs-string">"Sword of Doom"</span>, <span class="hljs-number">100</span>);&#13;
    <span class="hljs-comment">// 2</span>&#13;
    <span class="hljs-built_in">string</span> jsonString = JsonUtility.ToJson(sword, <span class="hljs-literal">true</span>);&#13;
 &#13;
    <span class="hljs-comment">// 3</span>&#13;
    <span class="hljs-keyword">using</span>(StreamWriter stream = File.CreateText(_jsonWeapons))&#13;
    {&#13;
        <span class="hljs-comment">// 4</span>&#13;
        stream.WriteLine(jsonString);&#13;
    }&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Call the new method <a id="_idIndexMarker855"/>in <code class="Code-In-Text--PACKT-">Initialize()</code> and pass in the <code class="Code-In-Text--PACKT-">_jsonWeapons</code> as a parameter:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Initialize</span><span class="hljs-function">()</span>&#13;
{&#13;
    _state = <span class="hljs-string">"Data Manager initialized.."</span>;&#13;
    Debug.Log(_state);&#13;
 &#13;
    FilesystemInfo();&#13;
    NewDirectory();&#13;
    <span class="code-highlight"><strong class="hljs-slc">SerializeJSON();</strong></span>&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
    </ol>&#13;
    <p class="normal">Here's the breakdown of the serialize method:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">First, we need a weapon to work with, so we create one with our class initializer</li>&#13;
      <li class="numbered">Then we declare a variable to hold the translated JSON data when it's formatted as a string and call the <code class="Code-In-Text--PACKT-">ToJson()</code> method:<ul>&#13;
          <li class="bullet-l2">The <code class="Code-In-Text--PACKT-">ToJson()</code> method we're using takes in the <code class="Code-In-Text--PACKT-">sword</code> object we want to serialize and a Boolean value of <code class="Code-In-Text--PACKT-">true</code> so the string is pretty printed with proper indenting. If we didn't specify a <code class="Code-In-Text--PACKT-">true</code> value, the JSON would still print out, it would just be a regular string, which isn't easily readable.</li>&#13;
        </ul>&#13;
      </li>&#13;
      <li class="numbered">Now that we have <a id="_idIndexMarker856"/>a text string to write to a file, we create a <code class="Code-In-Text--PACKT-">StreamWriter</code> stream and pass in the <code class="Code-In-Text--PACKT-">_jsonWeapons</code> file name</li>&#13;
      <li class="numbered">Finally, we <a id="_idIndexMarker857"/>use the <code class="Code-In-Text--PACKT-">WriteLine()</code> method and pass it the <code class="Code-In-Text--PACKT-">jsonString</code> value to write to the file</li>&#13;
    </ol>&#13;
    <p class="normal">Run the program and look at the new JSON file we created and wrote data into!</p>&#13;
    <figure class="mediaobject"><img src="Images/B17573_12_22.png" alt="" width="822" height="388"/></figure>&#13;
    <p class="packt_figref">Figure 12.22: JSON file with weapon properties serialized</p>&#13;
    <p class="normal">Now let's try and serialize our list of weapons we used in the XML examples and see what happens.</p>&#13;
    <p class="normal">Update the <code class="Code-In-Text--PACKT-">SerializeJSON()</code> method to use the existing list of weapons instead of the single <code class="Code-In-Text--PACKT-">sword</code> instance:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">SerializeJSON</span><span class="hljs-function">()</span>&#13;
{&#13;
    <span class="hljs-built_in">string</span> jsonString = JsonUtility.ToJson(<span class="code-highlight"><strong class="hljs-slc">weaponInventory,</strong></span> <span class="hljs-literal">true</span>);&#13;
 &#13;
    <span class="hljs-keyword">using</span>(StreamWriter stream = &#13;
      File.CreateText(_jsonWeapons))&#13;
    {&#13;
        stream.WriteLine(jsonString);&#13;
    }&#13;
}&#13;
</code></pre>&#13;
    <p class="normal">When you run the game again, you'll see the JSON file data was overwritten and all we ended up with is an empty array:</p>&#13;
    <figure class="mediaobject"><img src="Images/B17573_12_23.png" alt="" width="828" height="391"/></figure>&#13;
    <p class="packt_figref">Figure 12.23: JSON file with an empty object after serialization</p>&#13;
    <p class="normal">Again, this is because the way Unity handles JSON serialization doesn't support lists or arrays by themselves. Any list or <a id="_idIndexMarker858"/>array needs to be part of a class object for Unity's <code class="Code-In-Text--PACKT-">JsonUtility</code> class to recognize and handle it correctly.</p>&#13;
    <p class="normal">Don't panic, if we think <a id="_idIndexMarker859"/>about this, it's a fairly intuitive fix—we just need to create a class that has a weapons list property and use that when we serialize our data into JSON!</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Open <code class="Code-In-Text--PACKT-">Weapon.cs</code> and add the following serializable <code class="Code-In-Text--PACKT-">WeaponShop</code> class to the bottom of the file. Be super careful to put the new class outside the <code class="Code-In-Text--PACKT-">Weapon </code>class curly braces:&#13;
        <pre class="programlisting code"><code class="hljs-code">[<span class="hljs-meta">Serializable</span>]&#13;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">WeaponShop</span>&#13;
{&#13;
    <span class="hljs-keyword">public</span> List&lt;Weapon&gt; inventory;&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Back in the <code class="Code-In-Text--PACKT-">DataManager</code> class, update the <code class="Code-In-Text--PACKT-">SerializeJSON()</code> method with the following code:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">SerializeJSON</span><span class="hljs-function">()</span>&#13;
{&#13;
    <span class="hljs-comment">// 1</span>&#13;
    <span class="code-highlight"><strong class="hljs-slc">WeaponShop shop = </strong><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> WeaponShop();</strong></span>&#13;
    <span class="code-highlight"><strong class="hljs-comment-slc">// 2</strong></span>&#13;
    <span class="code-highlight"><strong class="hljs-slc">shop.inventory = weaponInventory;</strong></span>&#13;
 &#13;
    <span class="hljs-comment">// 3</span>&#13;
    <span class="hljs-built_in">string</span> jsonString = JsonUtility.ToJson(<span class="code-highlight"><strong class="hljs-slc">shop</strong></span>, <span class="hljs-literal">true</span>);&#13;
 &#13;
    <span class="hljs-keyword">using</span>(StreamWriter stream = File.CreateText(_jsonWeapons))&#13;
    {&#13;
        stream.WriteLine(jsonString);&#13;
    }&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
    </ol>&#13;
    <p class="normal">Let's break down the changes we just made:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">First, we create <a id="_idIndexMarker860"/>a new variable called <code class="Code-In-Text--PACKT-">shop</code>, which is an instance of the <code class="Code-In-Text--PACKT-">WeaponShop</code> class </li>&#13;
      <li class="numbered">Then we <a id="_idIndexMarker861"/>set the <code class="Code-In-Text--PACKT-">inventory</code> property to the <code class="Code-In-Text--PACKT-">weaponInventory</code> list of weapons we already declared</li>&#13;
      <li class="numbered">Finally, we pass the <code class="Code-In-Text--PACKT-">shop</code> object to the <code class="Code-In-Text--PACKT-">ToJson()</code> method and write the new string data to the JSON file</li>&#13;
    </ol>&#13;
    <p class="normal">Run the game again and look at the pretty printed list of weapons we've created:</p>&#13;
    <figure class="mediaobject"><img src="Images/B17573_12_24.png" alt="" width="826" height="400"/></figure>&#13;
    <p class="packt_figref">Figure 12.24: List object properly serialized into JSON</p>&#13;
    <p class="normal">Deserializing JSON text back <a id="_idIndexMarker862"/>into an object is the reverse process of what we just did:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Add a new <a id="_idIndexMarker863"/>method at the bottom of the <code class="Code-In-Text--PACKT-">DataManager</code> class:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">DeserializeJSON</span><span class="hljs-function">()</span>&#13;
{&#13;
    <span class="hljs-comment">// 1</span>&#13;
    <span class="hljs-keyword">if</span>(File.Exists(_jsonWeapons))&#13;
    {&#13;
        <span class="hljs-comment">// 2</span>&#13;
        <span class="hljs-keyword">using</span> (StreamReader stream = <span class="hljs-keyword">new</span> StreamReader(_jsonWeapons))&#13;
        {&#13;
            <span class="hljs-comment">// 3</span>&#13;
            <span class="hljs-keyword">var</span> jsonString = stream.ReadToEnd();&#13;
 &#13;
            <span class="hljs-comment">// 4</span>&#13;
            <span class="hljs-keyword">var</span> weaponData = JsonUtility.FromJson&lt;WeaponShop&gt;&#13;
              (jsonString);&#13;
 &#13;
            <span class="hljs-comment">// 5</span>&#13;
            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> weapon <span class="hljs-keyword">in</span> weaponData.inventory)&#13;
            {&#13;
                Debug.LogFormat(<span class="hljs-string">"Weapon: {0} - Damage: {1}"</span>, &#13;
                  weapon.name, weapon.damage);&#13;
            }&#13;
        }&#13;
    }&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Call the new method in <code class="Code-In-Text--PACKT-">Initialize()</code> and pass <code class="Code-In-Text--PACKT-">_jsonWeapons</code> in as a parameter:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Initialize</span><span class="hljs-function">()</span>&#13;
{&#13;
    _state = <span class="hljs-string">"Data Manager initialized.."</span>;&#13;
    Debug.Log(_state);&#13;
 &#13;
    FilesystemInfo();&#13;
    NewDirectory();&#13;
    SerializeJSON();&#13;
    <span class="code-highlight"><strong class="hljs-slc">DeserializeJSON();</strong></span>&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
    </ol>&#13;
    <p class="normal">Let's break down the <code class="Code-In-Text--PACKT-">DeserializeJSON()</code> method below:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">First, we check if the file exists </li>&#13;
      <li class="numbered">If it does exist, we create <a id="_idIndexMarker864"/>a stream with the <code class="Code-In-Text--PACKT-">_jsonWeapons</code> file path wrapped in a <code class="Code-In-Text--PACKT-">using</code> code block</li>&#13;
      <li class="numbered">Then, we use the <a id="_idIndexMarker865"/>stream's <code class="Code-In-Text--PACKT-">ReadToEnd()</code> method to grab the entire JSON text from the file</li>&#13;
      <li class="numbered">Next, we create a variable to hold our deserialized list of weapons and call the <code class="Code-In-Text--PACKT-">FromJson()</code> method:<ul>&#13;
          <li class="bullet-l2">Notice that we specify that we want to turn our JSON into a <code class="Code-In-Text--PACKT-">WeaponShop</code> object with the <code class="Code-In-Text--PACKT-">&lt;WeaponShop&gt;</code> syntax before passing in the JSON string variable</li>&#13;
        </ul>&#13;
      </li>&#13;
      <li class="numbered">Finally, we loop through the weapon shop's <code class="Code-In-Text--PACKT-">inventory</code> list property and print out each weapon's name and damage values in the console</li>&#13;
    </ol>&#13;
    <p class="normal">Run the game one last time and you'll see a console message printed out for each weapon in our JSON data:</p>&#13;
    <figure class="mediaobject"><img src="Images/B17573_12_25.png" alt="" width="823" height="395"/></figure>&#13;
    <p class="packt_figref">Figure 12.25: Console output from deserializing a list of JSON objects</p>&#13;
    <h1 id="_idParaDest-249" class="title">Data roundup</h1>&#13;
    <p class="normal">Every individual module and topic we've covered in this chapter can be used by itself or combined to suit your project's needs. For example, you could use text files to store character dialogue and <a id="_idIndexMarker866"/>only load it when you need to. This would be more efficient than having the game keep track of it every time it runs, even when the information isn't being used.</p>&#13;
    <p class="normal">You could also put character data or enemy statistics into either an XML or JSON file and read from the file anytime you need to level up a character or spawn a new monster. Finally, you could fetch data from a third-party database and serialize it into your own custom classes. This is a super common scenario with storing player accounts and external game data. </p>&#13;
    <div class="note">&#13;
      <p class="Information-Box--PACKT-">You can find a list <a id="_idIndexMarker867"/>of data types that can be serialized in C# at <a href="https://docs.microsoft.com/en-us/dotnet/framework/wcf/feature-details/types-supported-by-the-data-contract-serializer"><span class="url">https://docs.microsoft.com/en-us/dotnet/framework/wcf/feature-details/types-supported-by-the-data-contract-serializer</span></a>. Unity handles serialization a little differently, so make <a id="_idIndexMarker868"/>sure you check the available types at <a href="https://docs.unity3d.com/ScriptReference/SerializeField.html"><span class="url">https://docs.unity3d.com/ScriptReference/SerializeField.html</span></a>. </p>&#13;
    </div>&#13;
    <p class="normal">The point I'm trying to <a id="_idIndexMarker869"/>make is that data is everywhere, and it's your job to create a system that handles it the way your game needs, brick by brick.</p>&#13;
    <h1 id="_idParaDest-250" class="title">Summary</h1>&#13;
    <p class="normal">And that's a wrap on the basics of working with data! Congratulations on making it through this monster chapter intact. Data in any programming context is a big topic, so take everything you've learned in this chapter as a jumping-off point. </p>&#13;
    <p class="normal">You already know how to navigate the filesystem, and create, read, update, and delete files. You also learned how to effectively work with text, XML, and JSON data formats, as well as data streams. And you know how to take an entire object's state and serialize or deserialize it into both XML and JSON. All in all, learning these skills was no small feat. Don't forget to review and revisit this chapter more than once; there's a lot here that might not become second nature on the first run-through.</p>&#13;
    <p class="normal">In the next chapter, we'll discuss the basics of generic programming, get a little hands-on experience with delegates and events, and wrap up with an overview of exception handling.</p>&#13;
    <h1 id="_idParaDest-251" class="title">Pop quiz – data management</h1>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Which namespace gives you access to the <code class="Code-In-Text--PACKT-">Path</code> and <code class="Code-In-Text--PACKT-">Directory</code> classes?</li>&#13;
      <li class="numbered">In Unity, what folder path do you use to save data between runs of your game?</li>&#13;
      <li class="numbered">What data type do <code class="Code-In-Text--PACKT-">Stream</code> objects use to read and write information to files?</li>&#13;
      <li class="numbered">What happens when you serialize an object into JSON?</li>&#13;
    </ol>&#13;
    <h1 class="heading-1">JOIN us on Discord!</h1>&#13;
    <p class="normal">Read this book alongside other users, Unity/C# experts, and Harrison Ferrone. Ask questions, provide solutions to other readers, chat with the author via <em class="italic">Ask Me Anything sessions</em> and much more.</p>&#13;
<p class="normal">Join Now! </p>&#13;
    <p class="normal"><a href="https://packt.link/csharpunity2021"><span class="url">https://packt.link/csharpunity2021</span></a></p>&#13;
    <p class="normal"><span class="url"><img style="height: 8em; width: auto;" src="Images/QR_Code_9781801813945.png" alt="" width="354" height="354"/></span></p>&#13;
  </div>&#13;
</div></body></html>