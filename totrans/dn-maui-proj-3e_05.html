<html><head></head><body>
<div id="_idContainer110">
<h1 class="chapter-number" id="_idParaDest-100"><a id="_idTextAnchor399"/><span class="koboSpan" id="kobo.1.1">5</span></h1>
<h1 id="_idParaDest-101"><a id="_idTextAnchor400"/><span class="koboSpan" id="kobo.2.1">A Matchmaking App with a Rich UX Using Animations</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In this chapter, we will create the base functionality for a matchmaking app. </span><span class="koboSpan" id="kobo.3.2">We won’t be rating people, however, because of privacy issues. </span><span class="koboSpan" id="kobo.3.3">Instead, we will download images from a random source on the internet. </span><span class="koboSpan" id="kobo.3.4">This project is for anyone who wants an introduction to how to write reusable controls. </span><span class="koboSpan" id="kobo.3.5">We will also look at using animations to make our application feel nicer to use. </span><span class="koboSpan" id="kobo.3.6">This app will not be a </span><strong class="bold"><span class="koboSpan" id="kobo.4.1">Model-View-ViewModel</span></strong><span class="koboSpan" id="kobo.5.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.6.1">MVVM</span></strong><span class="koboSpan" id="kobo.7.1">) application since we want to isolate the creation and usage of a control from the slight overhead </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">of MVVM.</span></span></p>
<p><span class="koboSpan" id="kobo.9.1">The following topics will be covered in </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">this chapter:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.11.1">Creating a </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">custom control</span></span></li>
<li><span class="koboSpan" id="kobo.13.1">Styling the app to look like a photo, with descriptive text </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">beneath it</span></span></li>
<li><span class="koboSpan" id="kobo.15.1">Creating animations using .</span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">NET MAUI</span></span></li>
<li><span class="koboSpan" id="kobo.17.1">Subscribing to </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">custom events</span></span></li>
<li><span class="koboSpan" id="kobo.19.1">Reusing the custom control over and </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">over again</span></span></li>
<li><span class="koboSpan" id="kobo.21.1">Handling </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">pan gestures</span></span></li>
</ul>
<h1 id="_idParaDest-102"><a id="_idTextAnchor401"/><a id="_idTextAnchor402"/><span class="koboSpan" id="kobo.23.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.24.1">To be able to complete this chapter’s project, you will need to have Visual Studio for Mac or Windows installed, as well as the necessary .NET MAUI workloads. </span><span class="koboSpan" id="kobo.24.2">See </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.25.1">Chapter 1</span></em></span><span class="koboSpan" id="kobo.26.1">,</span><em class="italic"><span class="koboSpan" id="kobo.27.1"> Introduction to .NET MAUI</span></em><span class="koboSpan" id="kobo.28.1">, for more details on how to set up </span><span class="No-Break"><span class="koboSpan" id="kobo.29.1">your environment.</span></span></p>
<p><span class="koboSpan" id="kobo.30.1">You can find the full source for the code in this chapter </span><span class="No-Break"><span class="koboSpan" id="kobo.31.1">at </span></span><a href="https://github.com/PackPublishing/MAUI-Projects-3rd-Edition"><span class="No-Break"><span class="koboSpan" id="kobo.32.1">https://github.com/PackPublishing/MAUI-Projects-3rd-Edition</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.33.1">.</span></span></p>
<h1 id="_idParaDest-103"><a id="_idTextAnchor403"/><span class="koboSpan" id="kobo.34.1">Project overview</span></h1>
<p><span class="koboSpan" id="kobo.35.1">Many of us have been there, faced with the conundrum of whether to swipe left or right. </span><span class="koboSpan" id="kobo.35.2">All of a sudden, you may find yourself wondering: </span><em class="italic"><span class="koboSpan" id="kobo.36.1">How does this work? </span><span class="koboSpan" id="kobo.36.2">How does the swipe magic happen?</span></em><span class="koboSpan" id="kobo.37.1"> Well, in this project, we’re going to learn all about it. </span><span class="koboSpan" id="kobo.37.2">We will start by defining a </span><strong class="source-inline"><span class="koboSpan" id="kobo.38.1">MainPage</span></strong><span class="koboSpan" id="kobo.39.1"> file in which the images of our application will reside. </span><span class="koboSpan" id="kobo.39.2">After that, we will implement the image control, and gradually add the </span><strong class="bold"><span class="koboSpan" id="kobo.40.1">graphical user interface</span></strong><span class="koboSpan" id="kobo.41.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.42.1">GUI</span></strong><span class="koboSpan" id="kobo.43.1">) and functionality to it until we have nailed the perfect </span><span class="No-Break"><span class="koboSpan" id="kobo.44.1">swiping experience.</span></span></p>
<p><a id="_idTextAnchor404"/><span class="koboSpan" id="kobo.45.1">The build time for this project is about </span><span class="No-Break"><span class="koboSpan" id="kobo.46.1">90 minutes.</span></span></p>
<h1 id="_idParaDest-104"><a id="_idTextAnchor405"/><span class="koboSpan" id="kobo.47.1">Creating the matchmaking app</span></h1>
<p><span class="koboSpan" id="kobo.48.1">In this project, we will learn more about creating reusable controls that can be added to an </span><strong class="bold"><span class="koboSpan" id="kobo.49.1">Extensible Application Markup Language</span></strong><span class="koboSpan" id="kobo.50.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.51.1">XAML</span></strong><span class="koboSpan" id="kobo.52.1">) page. </span><span class="koboSpan" id="kobo.52.2">To keep things simple, we will not be using MVVM, but bare-metal .NET MAUI without any data binding. </span><span class="koboSpan" id="kobo.52.3">What we aim to create is an app that allows the user to swipe images, either to the right or the left, just as most popular matchmaking </span><span class="No-Break"><span class="koboSpan" id="kobo.53.1">applications do.</span></span></p>
<p><span class="koboSpan" id="kobo.54.1">Well, let’s get started by creating </span><span class="No-Break"><span class="koboSpan" id="kobo.55.1">the project!</span></span></p>
<h2 id="_idParaDest-105"><a id="_idTextAnchor406"/><span class="koboSpan" id="kobo.56.1">Setting up the project</span></h2>
<p><span class="koboSpan" id="kobo.57.1">This project, like all the rest, is a </span><strong class="bold"><span class="koboSpan" id="kobo.58.1">File</span></strong><span class="koboSpan" id="kobo.59.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.60.1">New</span></strong><span class="koboSpan" id="kobo.61.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.62.1">Project...</span></strong><span class="koboSpan" id="kobo.63.1">-style project. </span><span class="koboSpan" id="kobo.63.2">This means that we will not be importing any code at all. </span><span class="koboSpan" id="kobo.63.3">So, this first section is all about creating the project and setting up the basic </span><span class="No-Break"><span class="koboSpan" id="kobo.64.1">project structure.</span></span></p>
<p><span class="koboSpan" id="kobo.65.1">Let’s </span><span class="No-Break"><span class="koboSpan" id="kobo.66.1">get started!</span></span></p>
<h3><a id="_idTextAnchor407"/><a id="_idTextAnchor408"/><a id="_idTextAnchor409"/><span class="koboSpan" id="kobo.67.1">Creating the new project</span></h3>
<p><span class="koboSpan" id="kobo.68.1">So, </span><span class="No-Break"><span class="koboSpan" id="kobo.69.1">let’s begin.</span></span></p>
<p><a id="_idTextAnchor410"/><span class="koboSpan" id="kobo.70.1">The first step is to create a new .NET </span><span class="No-Break"><span class="koboSpan" id="kobo.71.1">MAUI project:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.72.1">Open Visual Studio 2022 and select </span><strong class="bold"><span class="koboSpan" id="kobo.73.1">Create a </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.74.1">new project</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.75.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer102">
<span class="koboSpan" id="kobo.76.1"><img alt="Figure 5.1 – Visual Studio 2022" src="image/B19214_05_1.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.77.1">Figure 5.1 – Visual Studio 2022</span></p>
<p class="list-inset"><a id="_idTextAnchor411"/><span class="koboSpan" id="kobo.78.1">This will open the </span><strong class="bold"><span class="koboSpan" id="kobo.79.1">Create a new </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.80.1">project</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.81.1"> wizard.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.82.1">In the search field, type </span><strong class="source-inline"><span class="koboSpan" id="kobo.83.1">maui</span></strong><span class="koboSpan" id="kobo.84.1"> and select the </span><strong class="bold"><span class="koboSpan" id="kobo.85.1">.NET MAUI App</span></strong><span class="koboSpan" id="kobo.86.1"> item from </span><span class="No-Break"><span class="koboSpan" id="kobo.87.1">the list:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer103">
<span class="koboSpan" id="kobo.88.1"><img alt="Figure 5.2 – Create a new project" src="image/B19214_05_2.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.89.1">Figure 5.2 – Create a new project</span></p>
<ol>
<li value="3"><span class="No-Break"><span class="koboSpan" id="kobo.90.1">Cl</span><a id="_idTextAnchor412"/><span class="koboSpan" id="kobo.91.1">ick </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.92.1">Next</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.93.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.94.1">Complete the next step of the wizard by naming your project. </span><span class="koboSpan" id="kobo.94.2">We will be calling our application </span><strong class="source-inline"><span class="koboSpan" id="kobo.95.1">Swiper</span></strong><span class="koboSpan" id="kobo.96.1"> in this case. </span><span class="koboSpan" id="kobo.96.2">Move on to the next dialog box by clicking </span><strong class="bold"><span class="koboSpan" id="kobo.97.1">Create</span></strong><span class="koboSpan" id="kobo.98.1">, as illustrated in the </span><span class="No-Break"><span class="koboSpan" id="kobo.99.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer104">
<span class="koboSpan" id="kobo.100.1"><img alt="Figure 5.3 – Configure your new project" src="image/B19214_05_3.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.101.1">Figure 5.3 – Configure your new project</span></p>
<ol>
<li value="5"><span class="No-Break"><span class="koboSpan" id="kobo.102.1">Cli</span><a id="_idTextAnchor413"/><span class="koboSpan" id="kobo.103.1">ck </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.104.1">Next</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.105.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.106.1">The last step will prompt you for the version of .NET Core to support. </span><span class="koboSpan" id="kobo.106.2">At the time of writing, .NET 6 is available as </span><strong class="bold"><span class="koboSpan" id="kobo.107.1">Long-Term Support</span></strong><span class="koboSpan" id="kobo.108.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.109.1">LTS</span></strong><span class="koboSpan" id="kobo.110.1">), and .NET 7 is available as </span><strong class="bold"><span class="koboSpan" id="kobo.111.1">Standard Term Support</span></strong><span class="koboSpan" id="kobo.112.1">. </span><span class="koboSpan" id="kobo.112.2">For this book, we will assume that you will be using .</span><span class="No-Break"><span class="koboSpan" id="kobo.113.1">NET 7:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer105">
<span class="koboSpan" id="kobo.114.1"><img alt="Figure 5.4 – Additional information" src="image/B19214_05_4.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.115.1">Figure 5.4 – Additional information</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.116.1">Finalize the setup by clicking </span><strong class="bold"><span class="koboSpan" id="kobo.117.1">Create</span></strong><span class="koboSpan" id="kobo.118.1"> and wait for Visual Studio to create </span><span class="No-Break"><span class="koboSpan" id="kobo.119.1">the project.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.120.1">Just like that, the app has been created. </span><span class="koboSpan" id="kobo.120.2">Let’s start by designing the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.121.1">MainPage</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.122.1"> file.</span></span></p>
<h3><span class="koboSpan" id="kobo.123.1">Desi</span><a id="_idTextAnchor414"/><a id="_idTextAnchor415"/><a id="_idTextAnchor416"/><a id="_idTextAnchor417"/><span class="koboSpan" id="kobo.124.1">gning the MainPage file</span></h3>
<p><span class="koboSpan" id="kobo.125.1">A brand new .NET MAUI Shell app named </span><strong class="source-inline"><span class="koboSpan" id="kobo.126.1">Swiper</span></strong><span class="koboSpan" id="kobo.127.1"> has been created, with a single page called </span><strong class="source-inline"><span class="koboSpan" id="kobo.128.1">MainPage.xaml</span></strong><span class="koboSpan" id="kobo.129.1">. </span><span class="koboSpan" id="kobo.129.2">This is in the root of the project. </span><span class="koboSpan" id="kobo.129.3">We will need to replace the default XAML template with a new layout that will contain our </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.130.1">Swiper</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.131.1"> control.</span></span></p>
<p><span class="koboSpan" id="kobo.132.1">Let’s edit the already existing </span><strong class="source-inline"><span class="koboSpan" id="kobo.133.1">MainPage.xaml</span></strong><span class="koboSpan" id="kobo.134.1"> file by replacing the default content with what </span><span class="No-Break"><span class="koboSpan" id="kobo.135.1">we need:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.136.1">Open the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.137.1">MainPage.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.138.1"> file.</span></span></li>
<li><span class="koboSpan" id="kobo.139.1">Replace the content of the page with the following highlighted </span><span class="No-Break"><span class="koboSpan" id="kobo.140.1">XAML code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.141.1">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;ContentPage
  xmlns=http://schemas.microsoft.com/dotnet/2021/maui
  
  
  x:Class="Swiper.MainPage"&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.142.1">  &lt;Grid Padding="0,40" x:Name="MainGrid"&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.143.1">    &lt;Grid.RowDefinitions&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.144.1">      &lt;RowDefinition Height="400" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.145.1">      &lt;RowDefinition Height="*" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.146.1">    &lt;/Grid.RowDefinitions&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.147.1">    &lt;Grid Grid.Row="1" Padding="30"&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.148.1">        &lt;!-- Placeholder for later --&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.149.1">    &lt;/Grid&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.150.1">  &lt;/Grid&gt;</span></strong><span class="koboSpan" id="kobo.151.1">
&lt;/ContentPage&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.152.1">The XAML code within the </span><strong class="source-inline"><span class="koboSpan" id="kobo.153.1">ContentPage</span></strong><span class="koboSpan" id="kobo.154.1"> node defines two grids in the application. </span><span class="koboSpan" id="kobo.154.2">A grid is simply a container for other controls. </span><span class="koboSpan" id="kobo.154.3">It positions those controls based on rows and columns. </span><span class="koboSpan" id="kobo.154.4">The outer grid, in this case, defines two rows that will cover the entire available area of the screen. </span><span class="koboSpan" id="kobo.154.5">The first row is 400 units high and the second row, with </span><strong class="source-inline"><span class="koboSpan" id="kobo.155.1">Height="*"</span></strong><span class="koboSpan" id="kobo.156.1">, uses the rest of the </span><span class="No-Break"><span class="koboSpan" id="kobo.157.1">available space.</span></span></p>
<p><span class="koboSpan" id="kobo.158.1">The inner grid, which is defined within the first grid, is assigned to the second row with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.159.1">Grid.Row="1"</span></strong><span class="koboSpan" id="kobo.160.1"> attribute. </span><span class="koboSpan" id="kobo.160.2">The row and column indexes are zero-based, so </span><strong class="source-inline"><span class="koboSpan" id="kobo.161.1">"1"</span></strong><span class="koboSpan" id="kobo.162.1"> actually refers to the second row. </span><span class="koboSpan" id="kobo.162.2">We will add some content to this grid later in this chapter, but we’ll leave it empty </span><span class="No-Break"><span class="koboSpan" id="kobo.163.1">for now.</span></span></p>
<p><span class="koboSpan" id="kobo.164.1">Both grids define their padding. </span><span class="koboSpan" id="kobo.164.2">You could enter a single number, meaning that all sides will have the same padding, or – as in this case – enter two numbers. </span><span class="koboSpan" id="kobo.164.3">We have entered </span><strong class="source-inline"><span class="koboSpan" id="kobo.165.1">0,40</span></strong><span class="koboSpan" id="kobo.166.1">, which means that the left- and right-hand sides should have </span><strong class="source-inline"><span class="koboSpan" id="kobo.167.1">0</span></strong><span class="koboSpan" id="kobo.168.1"> units of padding and the top and bottom should have </span><strong class="source-inline"><span class="koboSpan" id="kobo.169.1">40</span></strong><span class="koboSpan" id="kobo.170.1"> units of padding. </span><span class="koboSpan" id="kobo.170.2">There is also a third option, with four digits, which sets the padding of the </span><em class="italic"><span class="koboSpan" id="kobo.171.1">left-hand</span></em><span class="koboSpan" id="kobo.172.1"> side, the </span><em class="italic"><span class="koboSpan" id="kobo.173.1">top</span></em><span class="koboSpan" id="kobo.174.1">, the </span><em class="italic"><span class="koboSpan" id="kobo.175.1">right-hand</span></em><span class="koboSpan" id="kobo.176.1"> side, and the </span><em class="italic"><span class="koboSpan" id="kobo.177.1">bottom</span></em><span class="koboSpan" id="kobo.178.1">, in that </span><span class="No-Break"><span class="koboSpan" id="kobo.179.1">specific order.</span></span></p>
<p><span class="koboSpan" id="kobo.180.1">The last thing to notice is that we give the outer grid a name, </span><strong class="source-inline"><span class="koboSpan" id="kobo.181.1">x:Name="MainGrid"</span></strong><span class="koboSpan" id="kobo.182.1">. </span><span class="koboSpan" id="kobo.182.2">This will make it directly accessible from the code-behind defined in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.183.1">MainPage.xaml.cs</span></strong><span class="koboSpan" id="kobo.184.1"> file. </span><span class="koboSpan" id="kobo.184.2">Since we are not using MVVM in this example, we will need a way to access the grid</span><a id="_idTextAnchor418"/><span class="koboSpan" id="kobo.185.1"> without </span><span class="No-Break"><span class="koboSpan" id="kobo.186.1">data binding.</span></span></p>
<h2 id="_idParaDest-106"><span class="koboSpan" id="kobo.187.1">Crea</span><a id="_idTextAnchor419"/><span class="koboSpan" id="kobo.188.1">ting the Swiper control</span></h2>
<p><span class="koboSpan" id="kobo.189.1">The main part of this project involves creating the </span><strong class="source-inline"><span class="koboSpan" id="kobo.190.1">Swiper</span></strong><span class="koboSpan" id="kobo.191.1"> control. </span><span class="koboSpan" id="kobo.191.2">A control, in a general sense, is a self-contained </span><strong class="bold"><span class="koboSpan" id="kobo.192.1">user interface</span></strong><span class="koboSpan" id="kobo.193.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.194.1">UI</span></strong><span class="koboSpan" id="kobo.195.1">) with a code-behind to go with it. </span><span class="koboSpan" id="kobo.195.2">For .NET MAUI, a control is implemented using </span><strong class="source-inline"><span class="koboSpan" id="kobo.196.1">ContentView</span></strong><span class="koboSpan" id="kobo.197.1">, as opposed to </span><strong class="source-inline"><span class="koboSpan" id="kobo.198.1">ContentPage</span></strong><span class="koboSpan" id="kobo.199.1">, which is what XAML pages are. </span><span class="koboSpan" id="kobo.199.2">It can be added to any XAML page as an element, or in code in the code-behind file. </span><span class="koboSpan" id="kobo.199.3">We will be adding the control from code in </span><span class="No-Break"><span class="koboSpan" id="kobo.200.1">this project.</span></span></p>
<h3><span class="koboSpan" id="kobo.201.1">Crea</span><a id="_idTextAnchor420"/><a id="_idTextAnchor421"/><a id="_idTextAnchor422"/><span class="koboSpan" id="kobo.202.1">ting the control</span></h3>
<p><span class="koboSpan" id="kobo.203.1">Creating the </span><strong class="source-inline"><span class="koboSpan" id="kobo.204.1">Swiper</span></strong><span class="koboSpan" id="kobo.205.1"> control is a straightforward process. </span><span class="koboSpan" id="kobo.205.2">We just need to make sure that we select the correct item template, which is </span><strong class="bold"><span class="koboSpan" id="kobo.206.1">Content View</span></strong><span class="koboSpan" id="kobo.207.1">, by doing </span><span class="No-Break"><span class="koboSpan" id="kobo.208.1">the following:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.209.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.210.1">Swiper</span></strong><span class="koboSpan" id="kobo.211.1"> project, create a folder </span><span class="No-Break"><span class="koboSpan" id="kobo.212.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.213.1">Controls</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.214.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.215.1">Right-click on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.216.1">Controls</span></strong><span class="koboSpan" id="kobo.217.1"> folder, select </span><strong class="bold"><span class="koboSpan" id="kobo.218.1">Add</span></strong><span class="koboSpan" id="kobo.219.1">, and then click </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.220.1">New item...</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.221.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.222.1">Select </span><strong class="bold"><span class="koboSpan" id="kobo.223.1">C# Items</span></strong><span class="koboSpan" id="kobo.224.1"> and then </span><strong class="bold"><span class="koboSpan" id="kobo.225.1">.NET MAUI</span></strong><span class="koboSpan" id="kobo.226.1"> from the left pane of the </span><strong class="bold"><span class="koboSpan" id="kobo.227.1">Add New Item</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.228.1">dialog box.</span></span></li>
<li><span class="koboSpan" id="kobo.229.1">Select the </span><strong class="bold"><span class="koboSpan" id="kobo.230.1">.NET MAUI ContentView (XAML)</span></strong><span class="koboSpan" id="kobo.231.1"> item. </span><span class="koboSpan" id="kobo.231.2">Make sure you don’t select the </span><strong class="bold"><span class="koboSpan" id="kobo.232.1">.NET MAUI ContentView (C#)</span></strong><span class="koboSpan" id="kobo.233.1"> option; this only creates a C# file and not an </span><span class="No-Break"><span class="koboSpan" id="kobo.234.1">XAML file.</span></span></li>
<li><span class="koboSpan" id="kobo.235.1">Name the </span><span class="No-Break"><span class="koboSpan" id="kobo.236.1">control </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.237.1">SwiperControl.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.238.1">.</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.239.1">Click </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.240.1">Add</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.241.1">.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.242.1">Refer to the following screenshot to view the </span><span class="No-Break"><span class="koboSpan" id="kobo.243.1">preceding information:</span></span></p></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer106">
<span class="koboSpan" id="kobo.244.1"><img alt="Figure 5.5 – Add New Item" src="image/B19214_05_5.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.245.1">Figure 5.5 – Add New Item</span></p>
<p><span class="koboSpan" id="kobo.246.1">This </span><a id="_idTextAnchor423"/><span class="koboSpan" id="kobo.247.1">adds an XAML file for the UI and a C# code-behind file. </span><span class="koboSpan" id="kobo.247.2">It should look </span><span class="No-Break"><span class="koboSpan" id="kobo.248.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer107">
<span class="koboSpan" id="kobo.249.1"><img alt="Fi﻿﻿gure 5.6 – Solution layout" src="image/B19214_05_6.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.250.1">Fi</span><a id="_idTextAnchor424"/><a id="_idTextAnchor425"/><span class="koboSpan" id="kobo.251.1">gure 5.6 – Solution layout</span></p>
<h3><span class="koboSpan" id="kobo.252.1">Defining the main grid</span></h3>
<p><span class="koboSpan" id="kobo.253.1">Let’s set the basic structure of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.254.1">Swiper</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.255.1"> control:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.256.1">Open the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.257.1">SwiperControl.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.258.1"> file.</span></span></li>
<li><span class="koboSpan" id="kobo.259.1">Replace the content with the highlighted code in the following </span><span class="No-Break"><span class="koboSpan" id="kobo.260.1">code block:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.261.1">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ContentView 
             
             x:Class="Swiper.Controls.SwiperControl"&gt;
&lt;ContentView.Content&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.262.1">  &lt;Grid&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.263.1">    &lt;Grid.ColumnDefinitions&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.264.1">      &lt;ColumnDefinition Width="100" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.265.1">      &lt;ColumnDefinition Width="*" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.266.1">      &lt;ColumnDefinition Width="100" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.267.1">    &lt;/Grid.ColumnDefinitions&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.268.1">    &lt;!-- ContentView for photo here --&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.269.1">    &lt;!-- StackLayout for like here --&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.270.1">    &lt;!-- StackLayout for deny here --&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.271.1">  &lt;/Grid&gt;</span></strong><span class="koboSpan" id="kobo.272.1">
&lt;/ContentView.Content&gt;
&lt;/ContentView&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.273.1">This defines a grid with three columns. </span><span class="koboSpan" id="kobo.273.2">The leftmost and rightmost columns will take up 100 units of space, and the center will occupy the rest of the available space. </span><span class="koboSpan" id="kobo.273.3">The spaces on the sides will be areas in which we will add labels to highlight the choice that the user has made. </span><span class="koboSpan" id="kobo.273.4">We’ve also added three comments that act as placeholders for the XAML code to </span><span class="No-Break"><span class="koboSpan" id="kobo.274.1">come in.</span></span></p>
<p><span class="koboSpan" id="kobo.275.1">We will continue by adding additional XAML to create the </span><span class="No-Break"><span class="koboSpan" id="kobo.276.1">photo layout.</span></span></p>
<h3><span class="koboSpan" id="kobo.277.1">Adding</span><a id="_idTextAnchor426"/><a id="_idTextAnchor427"/><a id="_idTextAnchor428"/><span class="koboSpan" id="kobo.278.1"> a content view for the photo</span></h3>
<p><span class="koboSpan" id="kobo.279.1">Now, we will extend the </span><strong class="source-inline"><span class="koboSpan" id="kobo.280.1">SwiperControl.xaml</span></strong><span class="koboSpan" id="kobo.281.1"> file by adding a definition of what we want the photo to look like. </span><span class="koboSpan" id="kobo.281.2">Our final result will look like </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.282.1">Figure 5</span></em></span><em class="italic"><span class="koboSpan" id="kobo.283.1">.7</span></em><span class="koboSpan" id="kobo.284.1">. </span><span class="koboSpan" id="kobo.284.2">Since we are going to pull images off the internet, we’ll display a loading text to make sure that the user gets feedback on what’s going on. </span><span class="koboSpan" id="kobo.284.3">To make it look like an instantly printed photo, we added some handwritten text under the photo, as can be seen in the </span><span class="No-Break"><span class="koboSpan" id="kobo.285.1">following figure:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer108">
<span class="koboSpan" id="kobo.286.1"><img alt="Figure 5.7 – The photo UI design" src="image/B19214_05_7.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.287.1">Figure 5.7 – The photo UI design</span></p>
<p><span class="koboSpan" id="kobo.288.1">The preceding figure shows what we would like the photo to look like. </span><span class="koboSpan" id="kobo.288.2">To make this a reality, we need to add some XAML code to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.289.1">SwiperControl</span></strong><span class="koboSpan" id="kobo.290.1"> file by doing </span><span class="No-Break"><span class="koboSpan" id="kobo.291.1">the following:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.292.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.293.1">SwiperControl.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.294.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.295.1">Add the highlighted XAML code following the </span><strong class="source-inline"><span class="koboSpan" id="kobo.296.1">&lt;!-- ContentView for photo here --&gt;</span></strong><span class="koboSpan" id="kobo.297.1"> comment. </span><span class="koboSpan" id="kobo.297.2">Make sure that you do not replace the entire </span><strong class="source-inline"><span class="koboSpan" id="kobo.298.1">ContentView</span></strong><span class="koboSpan" id="kobo.299.1"> control for the page; just add this under the comment, as illustrated in the following code block. </span><span class="koboSpan" id="kobo.299.2">The rest of the page should </span><span class="No-Break"><span class="koboSpan" id="kobo.300.1">be untouched:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.301.1">&lt;!-- ContentView for photo here --&gt;</span></strong><span class="koboSpan" id="kobo.302.1">
  &lt;ContentView x:Name="photo" Padding="40" Grid.ColumnSpan="3" &gt;
    &lt;Grid x:Name="photoGrid" BackgroundColor="Black" Padding="1" &gt;
      &lt;Grid.RowDefinitions&gt;
        &lt;RowDefinition Height="*" /&gt;
        &lt;RowDefinition Height="40" /&gt;
      &lt;/Grid.RowDefinitions&gt;
      &lt;BoxView Grid.RowSpan="2" BackgroundColor="White" /&gt;
</span><a id="_idTextAnchor429"/><span class="koboSpan" id="kobo.303.1">      &lt;Image x:Name="image" Margin="10" BackgroundColor="#AAAAAA" Aspect="AspectFill" /&gt;
      &lt;Label x:Name="loadingLabel" Text="Loading..." </span><span class="koboSpan" id="kobo.303.2">TextColor="White" FontSize="Large" FontAttributes="Bold" HorizontalOptions="Center" VerticalOptions="Center" /&gt;
      &lt;Label Grid.Row="1" x:Name="descriptionLabel" Margin="10,0" Text="A picture of grandpa" FontFamily="Bradley Hand" /&gt;
    &lt;/Grid&gt;
  &lt;/ContentView&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.304.1">A </span><strong class="source-inline"><span class="koboSpan" id="kobo.305.1">ContentView</span></strong><span class="koboSpan" id="kobo.306.1"> control defines a new area where we can add other controls. </span><span class="koboSpan" id="kobo.306.2">One very important feature of a </span><strong class="source-inline"><span class="koboSpan" id="kobo.307.1">ContentView</span></strong><span class="koboSpan" id="kobo.308.1"> control is that it only takes one child control. </span><span class="koboSpan" id="kobo.308.2">Most of the time, we would add one of the available layout controls. </span><span class="koboSpan" id="kobo.308.3">In this case, we’ll use a </span><strong class="source-inline"><span class="koboSpan" id="kobo.309.1">Grid</span></strong><span class="koboSpan" id="kobo.310.1"> control to lay out the control, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.311.1">preceding code.</span></span></p>
<p><span class="koboSpan" id="kobo.312.1">The grid defines </span><span class="No-Break"><span class="koboSpan" id="kobo.313.1">two rows:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.314.1">A row for the photo itself, which takes up all the available space when the other rows have been </span><span class="No-Break"><span class="koboSpan" id="kobo.315.1">allocated space</span></span></li>
<li><span class="koboSpan" id="kobo.316.1">A row for the comment, which will be exactly 40 units </span><span class="No-Break"><span class="koboSpan" id="kobo.317.1">in height</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.318.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.319.1">Grid</span></strong><span class="koboSpan" id="kobo.320.1"> control itself is set to use a black background and a padding of 1. </span><span class="koboSpan" id="kobo.320.2">This, in combination with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.321.1">BoxView</span></strong><span class="koboSpan" id="kobo.322.1"> control, which has a white background, creates the frame that we see around the control. </span><span class="koboSpan" id="kobo.322.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.323.1">BoxView</span></strong><span class="koboSpan" id="kobo.324.1"> control is also set to span both rows of the grid (</span><strong class="source-inline"><span class="koboSpan" id="kobo.325.1">Grid.RowSpan="2"</span></strong><span class="koboSpan" id="kobo.326.1">), taking up the entire area of the grid, minus </span><span class="No-Break"><span class="koboSpan" id="kobo.327.1">the padding.</span></span></p>
<p><span class="koboSpan" id="kobo.328.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.329.1">Image</span></strong><span class="koboSpan" id="kobo.330.1"> control comes next. </span><span class="koboSpan" id="kobo.330.2">It has a background color set to a nice gray tone (</span><strong class="source-inline"><span class="koboSpan" id="kobo.331.1">#AAAAAA</span></strong><span class="koboSpan" id="kobo.332.1">) and a margin of 40, which will separate it a bit from the frame around it. </span><span class="koboSpan" id="kobo.332.2">It also has a hardcoded name (</span><strong class="source-inline"><span class="koboSpan" id="kobo.333.1">x:Name="image"</span></strong><span class="koboSpan" id="kobo.334.1">), which will allow us to interact with it from the code-behind. </span><span class="koboSpan" id="kobo.334.2">The last attribute, called </span><strong class="source-inline"><span class="koboSpan" id="kobo.335.1">Aspect</span></strong><span class="koboSpan" id="kobo.336.1">, determines what we should do if the image control isn’t of the same ratio as the source image. </span><span class="koboSpan" id="kobo.336.2">In this case, we want to fill the entire image area, but not show any blank areas. </span><span class="koboSpan" id="kobo.336.3">This effectively crops the image either in terms of height </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">or width.</span></span></p>
<p><span class="koboSpan" id="kobo.338.1">W</span><a id="_idTextAnchor430"/><a id="_idTextAnchor431"/><span class="koboSpan" id="kobo.339.1">e finish off by adding two labels, which also have hardcoded names for </span><span class="No-Break"><span class="koboSpan" id="kobo.340.1">later reference.</span></span></p>
<p><span class="koboSpan" id="kobo.341.1">That’s a wrap on the XAML for now; let’s move on to creating a description for </span><span class="No-Break"><span class="koboSpan" id="kobo.342.1">the photo.</span></span></p>
<h3><span class="koboSpan" id="kobo.343.1">C</span><a id="_idTextAnchor432"/><span class="koboSpan" id="kobo.344.1">reating the DescriptionGenerator class</span></h3>
<p><span class="koboSpan" id="kobo.345.1">At the bottom of the image, we can see a description. </span><span class="koboSpan" id="kobo.345.2">Since we don’t have any general descriptions of the images from our upcoming image source, we need to create a generator that makes up descriptions. </span><span class="koboSpan" id="kobo.345.3">Here’s a simple, yet fun, way to </span><span class="No-Break"><span class="koboSpan" id="kobo.346.1">do it:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.347.1">Create a folder called </span><strong class="source-inline"><span class="koboSpan" id="kobo.348.1">Utils</span></strong><span class="koboSpan" id="kobo.349.1"> in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.350.1">Swiper</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.351.1"> project.</span></span></li>
<li><span class="koboSpan" id="kobo.352.1">Create a new class called </span><strong class="source-inline"><span class="koboSpan" id="kobo.353.1">DescriptionGenerator</span></strong><span class="koboSpan" id="kobo.354.1"> in </span><span class="No-Break"><span class="koboSpan" id="kobo.355.1">that folder.</span></span></li>
<li><span class="koboSpan" id="kobo.356.1">Add the following code to </span><span class="No-Break"><span class="koboSpan" id="kobo.357.1">this class:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.358.1">
internal class DescriptionGenerator
{
  private string[] _adjectives = { "nice", "horrible", "great", "terribly old", "brand new" };
  private string[] _other = { "picture of grandpa", "car", "photo of a forest", "duck" };
  private static Random random = new();
  public string Generate()
  {
    var a = _adjectives[random.Next(_adjectives.Count())];
    var b = _other[random.Next(_other.Count())];
    return $"A {a} {b}";
  }
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.359.1">This class only has one purpose: it takes one random word from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.360.1">_adjectives</span></strong><span class="koboSpan" id="kobo.361.1"> array and combines it with a random word from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.362.1">_other</span></strong><span class="koboSpan" id="kobo.363.1"> array. </span><span class="koboSpan" id="kobo.363.2">By calling the </span><strong class="source-inline"><span class="koboSpan" id="kobo.364.1">Generate()</span></strong><span class="koboSpan" id="kobo.365.1"> method, we get a fresh new combination. </span><span class="koboSpan" id="kobo.365.2">Feel free to enter your own words in the arrays. </span><span class="koboSpan" id="kobo.365.3">Note that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.366.1">Random</span></strong><span class="koboSpan" id="kobo.367.1"> instance is a static field. </span><span class="koboSpan" id="kobo.367.2">This is because if we create new instances of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.368.1">Random</span></strong><span class="koboSpan" id="kobo.369.1"> class that are too close to each other in time, they get seeded with the same value and return the same sequence of </span><span class="No-Break"><span class="koboSpan" id="kobo.370.1">random numbers.</span></span></p>
<p><span class="koboSpan" id="kobo.371.1">Now that we can create a fun description for the photo, we need a way to capture the image and description for </span><span class="No-Break"><span class="koboSpan" id="kobo.372.1">the photo.</span></span></p>
<h3><span class="koboSpan" id="kobo.373.1">C</span><a id="_idTextAnchor433"/><a id="_idTextAnchor434"/><a id="_idTextAnchor435"/><span class="koboSpan" id="kobo.374.1">reating a Picture class</span></h3>
<p><span class="koboSpan" id="kobo.375.1">To abstract all the information about the image we want to display, we’ll create a class that encapsulates this information. </span><span class="koboSpan" id="kobo.375.2">There isn’t much information in our </span><strong class="source-inline"><span class="koboSpan" id="kobo.376.1">Picture</span></strong><span class="koboSpan" id="kobo.377.1"> class, but it is good coding practice to do this. </span><span class="koboSpan" id="kobo.377.2">Proceed </span><span class="No-Break"><span class="koboSpan" id="kobo.378.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.379.1">Create a new class called </span><strong class="source-inline"><span class="koboSpan" id="kobo.380.1">Picture</span></strong><span class="koboSpan" id="kobo.381.1"> in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.382.1">Utils</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.383.1"> folder.</span></span></li>
<li><span class="koboSpan" id="kobo.384.1">Add the following code to </span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">the class:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.386.1">
public class Picture
{
  public Uri Uri { get; init; }
  public string Description { get; init; }
  public Picture()
  {
    Uri = new Uri($"https://picsum.photos/400/400/?random&amp;ts={DateTime.Now.Ticks}");
     var generator = new DescriptionGenerator();
     Description = generator.Generate();
  }
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.387.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.388.1">Picture</span></strong><span class="koboSpan" id="kobo.389.1"> class has the following two </span><span class="No-Break"><span class="koboSpan" id="kobo.390.1">public properties:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.391.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.392.1">Uniform Resource Identifier</span></strong><span class="koboSpan" id="kobo.393.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.394.1">URI</span></strong><span class="koboSpan" id="kobo.395.1">) of an image exposed as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.396.1">Uri</span></strong><span class="koboSpan" id="kobo.397.1"> property, which points to its location on </span><span class="No-Break"><span class="koboSpan" id="kobo.398.1">the internet</span></span></li>
<li><span class="koboSpan" id="kobo.399.1">A description of that image, exposed as the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.400.1">Description</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.401.1"> property</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.402.1">In the constructor, we create a new URI, which points to a public source of test photos that we can use. </span><span class="koboSpan" id="kobo.402.2">The width and height are specified in the query string part of the URI. </span><span class="koboSpan" id="kobo.402.3">We also append a random timestamp to avoid the images being cached by .NET MAUI. </span><span class="koboSpan" id="kobo.402.4">This generates a unique URI each time we request </span><span class="No-Break"><span class="koboSpan" id="kobo.403.1">an image.</span></span></p>
<p><span class="koboSpan" id="kobo.404.1">We then use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.405.1">DescriptionGenerator</span></strong><span class="koboSpan" id="kobo.406.1"> class that we created previously to generate a random description for </span><span class="No-Break"><span class="koboSpan" id="kobo.407.1">the image.</span></span></p>
<p><span class="koboSpan" id="kobo.408.1">Note that the properties don’t define a </span><strong class="source-inline"><span class="koboSpan" id="kobo.409.1">set</span></strong><span class="koboSpan" id="kobo.410.1"> method, but instead use </span><strong class="source-inline"><span class="koboSpan" id="kobo.411.1">init</span></strong><span class="koboSpan" id="kobo.412.1">. </span><span class="koboSpan" id="kobo.412.2">Since we never need to change the values of </span><strong class="source-inline"><span class="koboSpan" id="kobo.413.1">URL</span></strong><span class="koboSpan" id="kobo.414.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.415.1">Description</span></strong><span class="koboSpan" id="kobo.416.1"> after the object is created, the properties can be read-only. </span><strong class="source-inline"><span class="koboSpan" id="kobo.417.1">init</span></strong><span class="koboSpan" id="kobo.418.1"> only allows the value to be set before the constructor completes. </span><span class="koboSpan" id="kobo.418.2">If you try to set the value after the constructor has run, the compiler will generate </span><span class="No-Break"><span class="koboSpan" id="kobo.419.1">an error.</span></span></p>
<p><span class="koboSpan" id="kobo.420.1">Now that we have all the pieces we need to start displaying images, let’s start pulling it </span><span class="No-Break"><span class="koboSpan" id="kobo.421.1">all together.</span></span></p>
<h3><span class="koboSpan" id="kobo.422.1">B</span><a id="_idTextAnchor436"/><a id="_idTextAnchor437"/><a id="_idTextAnchor438"/><span class="koboSpan" id="kobo.423.1">inding the picture to the control</span></h3>
<p><span class="koboSpan" id="kobo.424.1">Let’s begin to wire up the </span><strong class="source-inline"><span class="koboSpan" id="kobo.425.1">Swiper</span></strong><span class="koboSpan" id="kobo.426.1"> control so that it starts displaying images. </span><span class="koboSpan" id="kobo.426.2">We need to set the source of an image, and then control the visibility of the loading label based on the status of the image. </span><span class="koboSpan" id="kobo.426.3">Since we are using an image fetched from the internet, it might take a couple of seconds to download. </span><span class="koboSpan" id="kobo.426.4">A good UI will provide the user with proper feedback to help them avoid confusion r</span><a id="_idTextAnchor439"/><span class="koboSpan" id="kobo.427.1">egarding what is </span><span class="No-Break"><span class="koboSpan" id="kobo.428.1">going on.</span></span></p>
<p><span class="koboSpan" id="kobo.429.1">We will begin by setting the source for </span><span class="No-Break"><span class="koboSpan" id="kobo.430.1">the image.</span></span></p>
<h4><span class="koboSpan" id="kobo.431.1">S</span><a id="_idTextAnchor440"/><span class="koboSpan" id="kobo.432.1">etting the source</span></h4>
<p><span class="koboSpan" id="kobo.433.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.434.1">Image</span></strong><span class="koboSpan" id="kobo.435.1"> control (referred to as </span><strong class="source-inline"><span class="koboSpan" id="kobo.436.1">image</span></strong><span class="koboSpan" id="kobo.437.1"> in the code) has a </span><strong class="source-inline"><span class="koboSpan" id="kobo.438.1">source</span></strong><span class="koboSpan" id="kobo.439.1"> property. </span><span class="koboSpan" id="kobo.439.2">This property is of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.440.1">ImageSource</span></strong><span class="koboSpan" id="kobo.441.1"> abstract type. </span><span class="koboSpan" id="kobo.441.2">There are a few different types of image sources that you can use. </span><span class="koboSpan" id="kobo.441.3">The one we are interested in is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.442.1">UriImageSource</span></strong><span class="koboSpan" id="kobo.443.1"> type, which takes a URI, downloads the image, and allows the image control to </span><span class="No-Break"><span class="koboSpan" id="kobo.444.1">display it.</span></span></p>
<p><span class="koboSpan" id="kobo.445.1">Let’s extend the </span><strong class="source-inline"><span class="koboSpan" id="kobo.446.1">Swiper</span></strong><span class="koboSpan" id="kobo.447.1"> control so that we can set the source </span><span class="No-Break"><span class="koboSpan" id="kobo.448.1">and description:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.449.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.450.1">Controls/Swiper.Xaml.cs</span></strong><span class="koboSpan" id="kobo.451.1"> file (the code-behind for the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.452.1">Swiper</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.453.1"> control).</span></span></li>
<li><span class="koboSpan" id="kobo.454.1">Add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.455.1">using</span></strong><span class="koboSpan" id="kobo.456.1"> statement for </span><strong class="source-inline"><span class="koboSpan" id="kobo.457.1">Swiper.Utils</span></strong><span class="koboSpan" id="kobo.458.1">  (</span><strong class="source-inline"><span class="koboSpan" id="kobo.459.1">using Swiper.Utils;</span></strong><span class="koboSpan" id="kobo.460.1">) since we will be using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.461.1">Picture</span></strong><span class="koboSpan" id="kobo.462.1"> class from </span><span class="No-Break"><span class="koboSpan" id="kobo.463.1">that namespace.</span></span></li>
<li><span class="koboSpan" id="kobo.464.1">Add the following highlighted code to </span><span class="No-Break"><span class="koboSpan" id="kobo.465.1">the constructor:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.466.1">
public SwiperControl()
{
  InitializeComponent();
</span><strong class="bold"><span class="koboSpan" id="kobo.467.1">  var picture = new Picture();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.468.1">  descriptionLabel.Text = picture.Description;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.469.1">  image.Source = new UriImageSource() { Uri = picture.Uri };</span></strong><span class="koboSpan" id="kobo.470.1">
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.471.1">Here, we create a new instance of a </span><strong class="source-inline"><span class="koboSpan" id="kobo.472.1">Picture</span></strong><span class="koboSpan" id="kobo.473.1"> class and assign the description to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.474.1">descriptionLabel</span></strong><span class="koboSpan" id="kobo.475.1"> control in the GUI by setting the text property of that control. </span><span class="koboSpan" id="kobo.475.2">Then, we set the source of the image to a new instance of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.476.1">UriImageSource</span></strong><span class="koboSpan" id="kobo.477.1"> class, and assign the URI from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.478.1">picture</span></strong><span class="koboSpan" id="kobo.479.1"> instance. </span><span class="koboSpan" id="kobo.479.2">This will cause the image to be downloaded from the internet, and display it as soon as it </span><span class="No-Break"><span class="koboSpan" id="kobo.480.1">is downloaded.</span></span></p>
<p><span class="koboSpan" id="kobo.481.1">Next, we will change the visibility of the loading label for positive </span><span class="No-Break"><span class="koboSpan" id="kobo.482.1">user feedback.</span></span></p>
<h4><span class="koboSpan" id="kobo.483.1">C</span><a id="_idTextAnchor441"/><a id="_idTextAnchor442"/><a id="_idTextAnchor443"/><span class="koboSpan" id="kobo.484.1">ontrolling the loading label</span></h4>
<p><span class="koboSpan" id="kobo.485.1">While the image is downloading, we want to show a loading text centered over the image. </span><span class="koboSpan" id="kobo.485.2">This is already in the XAML file that we created earlier, so what we need to do is hide it once the image has been downloaded. </span><span class="koboSpan" id="kobo.485.3">We will do this by controlling the </span><strong class="source-inline"><span class="koboSpan" id="kobo.486.1">IsVisibleProperty</span></strong><span class="koboSpan" id="kobo.487.1"> property (yes, the property is actually named </span><strong class="source-inline"><span class="koboSpan" id="kobo.488.1">IsVisibleProperty</span></strong><span class="koboSpan" id="kobo.489.1">) of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.490.1">loadingLabel</span></strong><span class="koboSpan" id="kobo.491.1"> control by setting a binding to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.492.1">IsLoading</span></strong><span class="koboSpan" id="kobo.493.1"> property of the image. </span><span class="koboSpan" id="kobo.493.2">Any time the </span><strong class="source-inline"><span class="koboSpan" id="kobo.494.1">IsLoading</span></strong><span class="koboSpan" id="kobo.495.1"> property is changed on the image, the binding changes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.496.1">IsVisible</span></strong><span class="koboSpan" id="kobo.497.1"> property on the label. </span><span class="koboSpan" id="kobo.497.2">This is a nice </span><span class="No-Break"><span class="koboSpan" id="kobo.498.1">fire-and-forget approach.</span></span></p>
<p><span class="koboSpan" id="kobo.499.1">You might have noticed that we are using a binding when we said that we wouldn’t be using bindings at the beginning of this chapter. </span><span class="koboSpan" id="kobo.499.2">This is used as a shortcut, to avoid us having to write the code that would do essentially the same thing as this binding does. </span><span class="koboSpan" id="kobo.499.3">And to be fair, while we did say no MVVM and data binding, we are binding to ourselves, not between classes, so all the code is self-contained inside the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.500.1">Swiper</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.501.1"> control.</span></span></p>
<p><span class="koboSpan" id="kobo.502.1">Let’s add the code needed to control the </span><strong class="source-inline"><span class="koboSpan" id="kobo.503.1">loadingLabel</span></strong><span class="koboSpan" id="kobo.504.1"> control, </span><span class="No-Break"><span class="koboSpan" id="kobo.505.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.506.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.507.1">Swiper.xaml.cs</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.508.1">code-behind file.</span></span></li>
<li><span class="koboSpan" id="kobo.509.1">Add the following code marked in bold to </span><span class="No-Break"><span class="koboSpan" id="kobo.510.1">the constructor:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.511.1">
public SwiperControl()
{
  InitializeComponent();
  var picture = new Picture();
  descriptionLabel.Text = picture.Description;
  image.Source = new UriImageSource() { Uri = picture.Uri };
</span><strong class="bold"><span class="koboSpan" id="kobo.512.1">  loadingLabel.SetBinding(IsVisibleProperty, "IsLoading");</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.513.1">  loadingLabel.BindingContext = image;</span></strong><span class="koboSpan" id="kobo.514.1">
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.515.1">In the preceding code, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.516.1">loadingLabel</span></strong><span class="koboSpan" id="kobo.517.1"> control sets a binding to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.518.1">IsVisibleProperty</span></strong><span class="koboSpan" id="kobo.519.1"> property, which belongs to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.520.1">VisualElement</span></strong><span class="koboSpan" id="kobo.521.1"> class that all controls inherit from. </span><span class="koboSpan" id="kobo.521.2">It tells </span><strong class="source-inline"><span class="koboSpan" id="kobo.522.1">loadingLabel</span></strong><span class="koboSpan" id="kobo.523.1"> to listen to changes in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.524.1">IsLoading</span></strong><span class="koboSpan" id="kobo.525.1"> property of whichever object is assigned to the binding context. </span><span class="koboSpan" id="kobo.525.2">In this case, this is the </span><span class="No-Break"><span class="koboSpan" id="kobo.526.1">image control.</span></span></p>
<p><span class="koboSpan" id="kobo.527.1">Next, we will allow the user to “swipe right” or “</span><span class="No-Break"><span class="koboSpan" id="kobo.528.1">swipe left.”</span></span></p>
<h3><span class="koboSpan" id="kobo.529.1">H</span><a id="_idTextAnchor444"/><a id="_idTextAnchor445"/><span class="koboSpan" id="kobo.530.1">andling pan gestures</span></h3>
<p><span class="koboSpan" id="kobo.531.1">A core feature of this app is the pan gesture. </span><span class="koboSpan" id="kobo.531.2">A pan gesture is when a user presses on the control and moves it around the screen. </span><span class="koboSpan" id="kobo.531.3">We will also add a random rotation to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.532.1">Swiper</span></strong><span class="koboSpan" id="kobo.533.1"> control to make it look like there are photos in a stack when we add </span><span class="No-Break"><span class="koboSpan" id="kobo.534.1">multiple images.</span></span></p>
<p><span class="koboSpan" id="kobo.535.1">W</span><a id="_idTextAnchor446"/><span class="koboSpan" id="kobo.536.1">e will start by adding some fields to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.537.1">SwiperControl</span></strong><span class="koboSpan" id="kobo.538.1"> class, </span><span class="No-Break"><span class="koboSpan" id="kobo.539.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.540.1">Open the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.541.1">SwiperControl.xaml.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.542.1"> file.</span></span></li>
<li><span class="koboSpan" id="kobo.543.1">Add the following fields in the code to </span><span class="No-Break"><span class="koboSpan" id="kobo.544.1">the class:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.545.1">
private readonly double _initialRotation;
private static readonly Random _random = new Random();</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.546.1">The first field, </span><strong class="source-inline"><span class="koboSpan" id="kobo.547.1">_initialRotation</span></strong><span class="koboSpan" id="kobo.548.1">, stores the initial rotation of the image. </span><span class="koboSpan" id="kobo.548.2">We will set this in the constructor. </span><span class="koboSpan" id="kobo.548.3">The second field is a </span><strong class="source-inline"><span class="koboSpan" id="kobo.549.1">static</span></strong><span class="koboSpan" id="kobo.550.1"> field containing a </span><strong class="source-inline"><span class="koboSpan" id="kobo.551.1">Random</span></strong><span class="koboSpan" id="kobo.552.1"> object. </span><span class="koboSpan" id="kobo.552.2">As you might remember, it’s better to create one static random object to make sure multiple random objects don’t get created with the same seed. </span><span class="koboSpan" id="kobo.552.3">The seed is based on time, so if we create objects too close in time to each other, they get the same random sequence generated, so it wouldn’t be that random </span><span class="No-Break"><span class="koboSpan" id="kobo.553.1">at all.</span></span></p>
<p><span class="koboSpan" id="kobo.554.1">The next thing we have to do is create an event handler for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.555.1">PanUpdated</span></strong><span class="koboSpan" id="kobo.556.1"> event that we will bind to at the end of this section, </span><span class="No-Break"><span class="koboSpan" id="kobo.557.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.558.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.559.1">SwiperControl.xaml.cs</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.560.1">code-behind file.</span></span></li>
<li><span class="koboSpan" id="kobo.561.1">Add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.562.1">OnPanUpdated</span></strong><span class="koboSpan" id="kobo.563.1"> method to the class, </span><span class="No-Break"><span class="koboSpan" id="kobo.564.1">like this:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.565.1">
private void OnPanUpdated(object sender, PanUpdatedEventArgs e)
{
  switch (e.StatusType)
  {
    case GestureStatus.Started: PanStarted();
    break;
    case GestureStatus.Running: PanRunning(e);
    break;
    case GestureStatus.Completed: PanCompleted();
    break;
  }
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.566.1">This code is straightforward. </span><span class="koboSpan" id="kobo.566.2">We handle an event that takes a </span><strong class="source-inline"><span class="koboSpan" id="kobo.567.1">PanUpdatedEventArgs</span></strong><span class="koboSpan" id="kobo.568.1"> object as the second argument. </span><span class="koboSpan" id="kobo.568.2">This is a standard method of handling events. </span><span class="koboSpan" id="kobo.568.3">We then have a </span><strong class="source-inline"><span class="koboSpan" id="kobo.569.1">switch</span></strong><span class="koboSpan" id="kobo.570.1"> clause that checks which status the event </span><span class="No-Break"><span class="koboSpan" id="kobo.571.1">refers to.</span></span></p>
<p><span class="koboSpan" id="kobo.572.1">A</span><a id="_idTextAnchor447"/><span class="koboSpan" id="kobo.573.1"> pan gesture can have the following </span><span class="No-Break"><span class="koboSpan" id="kobo.574.1">three states:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.575.1">GestureStatus.Started</span></strong><span class="koboSpan" id="kobo.576.1">: The event is raised once with this state when the </span><span class="No-Break"><span class="koboSpan" id="kobo.577.1">panning begins</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.578.1">GestureStatus.Running</span></strong><span class="koboSpan" id="kobo.579.1">: The event is then raised multiple times, once for each time you move </span><span class="No-Break"><span class="koboSpan" id="kobo.580.1">your finger</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.581.1">GestureStatus.Completed</span></strong><span class="koboSpan" id="kobo.582.1">: The event is raised one last time when you </span><span class="No-Break"><span class="koboSpan" id="kobo.583.1">let go</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.584.1">For each of these states, we call specific methods that handle the different states. </span><span class="koboSpan" id="kobo.584.2">We’ll continue with adding those </span><span class="No-Break"><span class="koboSpan" id="kobo.585.1">methods now:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.586.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.587.1">SwiperControl.xaml.cs</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.588.1">code-behind file.</span></span></li>
<li><span class="koboSpan" id="kobo.589.1">Add the following three methods to the class, </span><span class="No-Break"><span class="koboSpan" id="kobo.590.1">like this:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.591.1">
private void PanStarted()
{
  photo.ScaleTo(1.1, 100);
}
private void PanRunning(PanUpdatedEventArgs e)
{
  photo.TranslationX = e.TotalX;
  photo.TranslationY = e.TotalY;
  photo.Rotation = _initialRotation + (photo.TranslationX / 25);
}
private void PanCompleted()
{
  photo.TranslateTo(0, 0, 250, Easing.SpringOut);
  photo.RotateTo(_initialRotation, 250, Easing.SpringOut);
  photo.ScaleTo(1, 250);
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.592.1">Let’s start by looking at </span><strong class="source-inline"><span class="koboSpan" id="kobo.593.1">PanStarted()</span></strong><span class="koboSpan" id="kobo.594.1">. </span><span class="koboSpan" id="kobo.594.2">When the user starts dragging the image, we want to add the effect of it raising a little bit over the surface. </span><span class="koboSpan" id="kobo.594.3">This is done by scaling the image by 10%. </span><span class="koboSpan" id="kobo.594.4">.NET MAUI has a set of excellent functions to do this. </span><span class="koboSpan" id="kobo.594.5">In this case, we call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.595.1">ScaleTo()</span></strong><span class="koboSpan" id="kobo.596.1"> method on the image control (named </span><strong class="source-inline"><span class="koboSpan" id="kobo.597.1">Photo</span></strong><span class="koboSpan" id="kobo.598.1">) and tell it to scale to </span><strong class="source-inline"><span class="koboSpan" id="kobo.599.1">1.1</span></strong><span class="koboSpan" id="kobo.600.1">, which corresponds to 10% of its original size. </span><span class="koboSpan" id="kobo.600.2">We also tell it to do this within a duration of </span><strong class="source-inline"><span class="koboSpan" id="kobo.601.1">100</span></strong> <strong class="bold"><span class="koboSpan" id="kobo.602.1">milliseconds</span></strong><span class="koboSpan" id="kobo.603.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.604.1">ms</span></strong><span class="koboSpan" id="kobo.605.1">). </span><span class="koboSpan" id="kobo.605.2">This call is also awaitable, which means we can wait for the control to finish animating before executing the next call. </span><span class="koboSpan" id="kobo.605.3">In this case, we are going to use a </span><span class="No-Break"><span class="koboSpan" id="kobo.606.1">fire-and-forget approach.</span></span></p>
<p><span class="koboSpan" id="kobo.607.1">Next, we have </span><strong class="source-inline"><span class="koboSpan" id="kobo.608.1">PanRunning()</span></strong><span class="koboSpan" id="kobo.609.1">, which is called multiple times during the pan operation. </span><span class="koboSpan" id="kobo.609.2">This takes an argument, called </span><strong class="source-inline"><span class="koboSpan" id="kobo.610.1">PanUpdatedEventArgs</span></strong><span class="koboSpan" id="kobo.611.1">, from the event handler that </span><strong class="source-inline"><span class="koboSpan" id="kobo.612.1">PanRunning()</span></strong><span class="koboSpan" id="kobo.613.1"> is called from. </span><span class="koboSpan" id="kobo.613.2">We could also just pass in </span><em class="italic"><span class="koboSpan" id="kobo.614.1">X</span></em><span class="koboSpan" id="kobo.615.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.616.1">Y</span></em><span class="koboSpan" id="kobo.617.1"> values as arguments to reduce the coupling of the code. </span><span class="koboSpan" id="kobo.617.2">This is something that you can experiment with. </span><span class="koboSpan" id="kobo.617.3">The method extracts the </span><em class="italic"><span class="koboSpan" id="kobo.618.1">X</span></em><span class="koboSpan" id="kobo.619.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.620.1">Y</span></em><span class="koboSpan" id="kobo.621.1"> components from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.622.1">TotalX</span></strong><span class="koboSpan" id="kobo.623.1">/</span><strong class="source-inline"><span class="koboSpan" id="kobo.624.1">TotalY</span></strong><span class="koboSpan" id="kobo.625.1"> properties of the event and assigns them to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.626.1">TranslationX</span></strong><span class="koboSpan" id="kobo.627.1">/</span><strong class="source-inline"><span class="koboSpan" id="kobo.628.1">TranslationY</span></strong><span class="koboSpan" id="kobo.629.1"> properties of the image control. </span><span class="koboSpan" id="kobo.629.2">We also adjust the rotation slightly, based on how far the image has </span><span class="No-Break"><span class="koboSpan" id="kobo.630.1">been moved.</span></span></p>
<p><span class="koboSpan" id="kobo.631.1">The last thing we need to do is restore everything to its initial state when the image is released. </span><span class="koboSpan" id="kobo.631.2">This can be done in </span><strong class="source-inline"><span class="koboSpan" id="kobo.632.1">PanCompleted()</span></strong><span class="koboSpan" id="kobo.633.1">. </span><span class="koboSpan" id="kobo.633.2">First, we translate (or move) the image back to its original local coordinates (</span><strong class="source-inline"><span class="koboSpan" id="kobo.634.1">0,0</span></strong><span class="koboSpan" id="kobo.635.1">) in </span><strong class="source-inline"><span class="koboSpan" id="kobo.636.1">250</span></strong><span class="koboSpan" id="kobo.637.1"> ms. </span><span class="koboSpan" id="kobo.637.2">We also added an easing function to make it overshoot the target a bit and then animate back. </span><span class="koboSpan" id="kobo.637.3">We can play around with the different predefined easing functions; these are useful for creating nice animations. </span><span class="koboSpan" id="kobo.637.4">We do the same to move the image back to its initial rotation. </span><span class="koboSpan" id="kobo.637.5">Finally, we scale it back to its original size in </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.638.1">250</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.639.1"> ms.</span></span></p>
<p><span class="koboSpan" id="kobo.640.1">Now, it’s time to add the code in the constructor that will wire up the pan gesture and set some initial rotation values. </span><span class="koboSpan" id="kobo.640.2">Proceed </span><span class="No-Break"><span class="koboSpan" id="kobo.641.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.642.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.643.1">SwiperControl.xaml.cs</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.644.1">code-behind file.</span></span></li>
<li><span class="koboSpan" id="kobo.645.1">Add the highlighted code to the constructor. </span><span class="koboSpan" id="kobo.645.2">Note that there is more code in the constructor, so don’t overwrite the whole method; just add the bold text shown in the following </span><span class="No-Break"><span class="koboSpan" id="kobo.646.1">code block:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.647.1">
public SwiperControl()
{
  InitializeComponent();
  var panGesture = new PanGestureRecognizer();
  panGesture.PanUpdated += OnPanUpdated;
  this.GestureRecognizers.Add(panGesture);
  _initialRotation = _random.Next(-10, 10);
  photo.RotateTo(_initialRotation, 100, Easing.SinOut);
  var picture = new Picture();
  descriptionLabel.Text = picture.Description;
  image.Source = new UriImageSource() { Uri = picture.Uri };
  loadingLabel.SetBinding(IsVisibleProperty, "IsLoading");
  loadingLabel.BindingContext = image;
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.648.1">A</span><a id="_idTextAnchor448"/><span class="koboSpan" id="kobo.649.1">ll .NET MAUI controls have a property called </span><strong class="source-inline"><span class="koboSpan" id="kobo.650.1">GestureRecognizers</span></strong><span class="koboSpan" id="kobo.651.1">. </span><span class="koboSpan" id="kobo.651.2">There are different types of gesture recognizers, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.652.1">TapGestureRecognizer</span></strong><span class="koboSpan" id="kobo.653.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.654.1">SwipeGestureRecognizer</span></strong><span class="koboSpan" id="kobo.655.1">. </span><span class="koboSpan" id="kobo.655.2">In our case, we are interested in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.656.1">PanGestureRecognizer</span></strong><span class="koboSpan" id="kobo.657.1"> type. </span><span class="koboSpan" id="kobo.657.2">We create a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.658.1">PanGestureRecognizer</span></strong><span class="koboSpan" id="kobo.659.1"> instance and subscribe to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.660.1">PanUpdated</span></strong><span class="koboSpan" id="kobo.661.1"> event by hooking it up to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.662.1">OnPanUpdated()</span></strong><span class="koboSpan" id="kobo.663.1"> method we created earlier. </span><span class="koboSpan" id="kobo.663.2">Then, we add it to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.664.1">Swiper</span></strong><span class="koboSpan" id="kobo.665.1"> controls </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.666.1">GestureRecognizers</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.667.1"> collection.</span></span></p>
<p><span class="koboSpan" id="kobo.668.1">After this, we set an initial rotation of the image and make sure we store the current rotation value so that we can modify t</span><a id="_idTextAnchor449"/><span class="koboSpan" id="kobo.669.1">he rotation, and then rotate it back to the </span><span class="No-Break"><span class="koboSpan" id="kobo.670.1">original state.</span></span></p>
<p><span class="koboSpan" id="kobo.671.1">Next, we will wire up the control temporarily so that we can test </span><span class="No-Break"><span class="koboSpan" id="kobo.672.1">it out.</span></span></p>
<h2 id="_idParaDest-107"><span class="koboSpan" id="kobo.673.1">T</span><a id="_idTextAnchor450"/><span class="koboSpan" id="kobo.674.1">esting the control</span></h2>
<p><span class="koboSpan" id="kobo.675.1">We now have all the code written to take the control for a test run. </span><span class="koboSpan" id="kobo.675.2">Proceed </span><span class="No-Break"><span class="koboSpan" id="kobo.676.1">as follows:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.677.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.678.1">MainPage.xaml.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.679.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.680.1">Add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.681.1">using</span></strong><span class="koboSpan" id="kobo.682.1"> statement for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.683.1">Swiper.Controls</span></strong><span class="koboSpan" id="kobo.684.1"> (</span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.685.1">using Swiper.Controls;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.686.1">).</span></span></li>
<li><span class="koboSpan" id="kobo.687.1">Add the following code marked in bold to </span><span class="No-Break"><span class="koboSpan" id="kobo.688.1">the constructor:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.689.1">
public MainPage()
{
  InitializeComponent();
  </span><strong class="bold"><span class="koboSpan" id="kobo.690.1">MainGrid.Children.Add(new SwiperControl());</span></strong><span class="koboSpan" id="kobo.691.1">
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.692.1">If all goes well with the build, we should end up with a photo like the one shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.693.1">following figure:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer109">
<span class="koboSpan" id="kobo.694.1"><img alt="Figure 5.8 – Testing the app" src="image/B19214_05_8.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.695.1">Figure 5.8 – Testing the app</span></p>
<p><span class="koboSpan" id="kobo.696.1">W</span><a id="_idTextAnchor451"/><span class="koboSpan" id="kobo.697.1">e can also drag the photo around (pan it). </span><span class="koboSpan" id="kobo.697.2">Notice the slight lift effect when you begin dragging, and the rotation of the photo based on the amount of translation, which is the t</span><a id="_idTextAnchor452"/><span class="koboSpan" id="kobo.698.1">otal movement. </span><span class="koboSpan" id="kobo.698.2">If you let go of the photo, it animates back </span><span class="No-Break"><span class="koboSpan" id="kobo.699.1">into place.</span></span></p>
<p><span class="koboSpan" id="kobo.700.1">Now that we have the </span><a id="_idIndexMarker572"/><span class="koboSpan" id="kobo.701.1">control displaying the photo and can swipe it left or right, we need to act on </span><span class="No-Break"><span class="koboSpan" id="kobo.702.1">those swipes.</span></span></p>
<h3><a id="_idTextAnchor453"/><span class="koboSpan" id="kobo.703.1">Creating decision zones</span></h3>
<p><span class="koboSpan" id="kobo.704.1">A matchmaking app</span><a id="_idIndexMarker573"/><span class="koboSpan" id="kobo.705.1"> is nothing without those special drop zones on each side of the screen. </span><span class="koboSpan" id="kobo.705.2">We want to do a few </span><span class="No-Break"><span class="koboSpan" id="kobo.706.1">things here:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.707.1">When a user drags an image to either side, text should appear that says </span><strong class="source-inline"><span class="koboSpan" id="kobo.708.1">LIKE</span></strong><span class="koboSpan" id="kobo.709.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.710.1">DENY</span></strong><span class="koboSpan" id="kobo.711.1"> (the </span><span class="No-Break"><span class="koboSpan" id="kobo.712.1">decision zones)</span></span></li>
<li><span class="koboSpan" id="kobo.713.1">When a user drops an image on a decision zone, the app should remove the image from </span><span class="No-Break"><span class="koboSpan" id="kobo.714.1">the page</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.715.1">We will create these zones by adding some XAML code to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.716.1">SwiperControl.xaml</span></strong><span class="koboSpan" id="kobo.717.1"> file and then add the necessary code to make this happen. </span><span class="koboSpan" id="kobo.717.2">It is worth noting that the zones are not hotspots for dropping the image, but rather for displaying labels on top of the control surface. </span><span class="koboSpan" id="kobo.717.3">The actual drop zones are calculated and determined</span><a id="_idTextAnchor454"/><span class="koboSpan" id="kobo.718.1"> based on how far you drag </span><span class="No-Break"><span class="koboSpan" id="kobo.719.1">the image.</span></span></p>
<p><span class="koboSpan" id="kobo.720.1">The first step</span><a id="_idIndexMarker574"/><span class="koboSpan" id="kobo.721.1"> is to add the UI for the left and right </span><span class="No-Break"><span class="koboSpan" id="kobo.722.1">swipe actions</span><a id="_idTextAnchor455"/><span class="koboSpan" id="kobo.723.1">.</span></span></p>
<h3><span class="koboSpan" id="kobo.724.1">Extending the grid</span></h3>
<p><span class="koboSpan" id="kobo.725.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.726.1">Swiper</span></strong><span class="koboSpan" id="kobo.727.1"> control has </span><a id="_idIndexMarker575"/><span class="koboSpan" id="kobo.728.1">three columns (left, right, and center) defined. </span><span class="koboSpan" id="kobo.728.2">We want to add some kind of visual feedback to the user if the image is dragged to either side of the page. </span><span class="koboSpan" id="kobo.728.3">We will do this by adding a </span><strong class="source-inline"><span class="koboSpan" id="kobo.729.1">StackLayout</span></strong><span class="koboSpan" id="kobo.730.1"> control with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.731.1">Label</span></strong><span class="koboSpan" id="kobo.732.1"> control on </span><span class="No-Break"><span class="koboSpan" id="kobo.733.1">each side.</span></span></p>
<p><span class="koboSpan" id="kobo.734.1">We will add the right-hand </span><span class="No-Break"><span class="koboSpan" id="kobo.735.1">side firs</span><a id="_idTextAnchor456"/><a id="_idTextAnchor457"/><span class="koboSpan" id="kobo.736.1">t.</span></span></p>
<h4><span class="koboSpan" id="kobo.737.1">Adding the StackLayout for liking photos</span></h4>
<p><span class="koboSpan" id="kobo.738.1">The first </span><a id="_idIndexMarker576"/><span class="koboSpan" id="kobo.739.1">thing we need to do is add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.740.1">StackLayout</span></strong><span class="koboSpan" id="kobo.741.1"> control for liking photos on the right-hand side of </span><span class="No-Break"><span class="koboSpan" id="kobo.742.1">the control:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.743.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.744.1">Controls/SwiperControl.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.745.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.746.1">Add the following code under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.747.1">&lt;!-- StackLayout for like here --&gt;</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.748.1">comment:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.749.1">
&lt;StackLayout Grid.Column="2" x:Name="likeStackLayout" Opacity="0" Padding="0, 100"&gt;
  &lt;Label Text="LIKE" TextColor="Lime" FontSize="30" Rotation=</span><a id="_idTextAnchor458"/><span class="koboSpan" id="kobo.750.1">"30" FontAttributes="Bold" /&gt;
&lt;/StackLayout&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.751.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.752.1">StackLayout</span></strong><span class="koboSpan" id="kobo.753.1"> control is the container of child elements that we want to display. </span><span class="koboSpan" id="kobo.753.2">It has a name and is assigned to be rendered in the third column (it says </span><strong class="source-inline"><span class="koboSpan" id="kobo.754.1">Grid.Column="2"</span></strong><span class="koboSpan" id="kobo.755.1"> in the code due to the zero indexing). </span><span class="koboSpan" id="kobo.755.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.756.1">Opacity</span></strong><span class="koboSpan" id="kobo.757.1"> property is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.758.1">0</span></strong><span class="koboSpan" id="kobo.759.1">, making it completely invisible, and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.760.1">Padding</span></strong><span class="koboSpan" id="kobo.761.1"> property is adjusted to make it move down a bit from </span><span class="No-Break"><span class="koboSpan" id="kobo.762.1">the top.</span></span></p>
<p><span class="koboSpan" id="kobo.763.1">Inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.764.1">StackLayout</span></strong><span class="koboSpan" id="kobo.765.1"> control, we’ll add the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.766.1">Label</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.767.1"> control.</span></span></p>
<p><span class="koboSpan" id="kobo.768.1">Now that we have the right-hand side, let’s add </span><span class="No-Break"><span class="koboSpan" id="kobo.769.1">the le</span><a id="_idTextAnchor459"/><a id="_idTextAnchor460"/><span class="koboSpan" id="kobo.770.1">ft.</span></span></p>
<h4><span class="koboSpan" id="kobo.771.1">Adding the StackLayout for denying photos</span></h4>
<p><span class="koboSpan" id="kobo.772.1">The next </span><a id="_idIndexMarker577"/><span class="koboSpan" id="kobo.773.1">step is to add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.774.1">StackLayout</span></strong><span class="koboSpan" id="kobo.775.1"> control for denying photos on the left-hand side of </span><span class="No-Break"><span class="koboSpan" id="kobo.776.1">the control:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.777.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.778.1">Controls/SwiperControl.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.779.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.780.1">Add the following code under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.781.1">&lt;!-- StackLayout for deny here --&gt;</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.782.1">comment:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.783.1">
&lt;StackLayout x:Name="denyStackLayout" Opacity="0" Padding="0, 100" HorizontalOptions="Start"&gt;
  &lt;Label Text="DENY" TextColor="Red" FontSize="30" Rotation="-20" FontAttributes="Bold" /&gt;
&lt;/StackLayout&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.784.1">The setup for the left-hand side </span><strong class="source-inline"><span class="koboSpan" id="kobo.785.1">StackLayout</span></strong><span class="koboSpan" id="kobo.786.1"> is the same, except that it should be in the first column, which is the default, so there is no need to add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.787.1">Grid.Column</span></strong><span class="koboSpan" id="kobo.788.1"> attribute. </span><span class="koboSpan" id="kobo.788.2">We have also specified </span><strong class="source-inline"><span class="koboSpan" id="kobo.789.1">HorizontalOptions="End"</span></strong><span class="koboSpan" id="kobo.790.1">, which means that the content shoul</span><a id="_idTextAnchor461"/><span class="koboSpan" id="kobo.791.1">d </span><span class="No-Break"><span class="koboSpan" id="kobo.792.1">be right-justified.</span></span></p>
<p><span class="koboSpan" id="kobo.793.1">With the UI all set, we can now work on the logic for providing the user visual feedback by adjusting the opacity of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.794.1">LIKE</span></strong><span class="koboSpan" id="kobo.795.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.796.1">DENIED</span></strong><span class="koboSpan" id="kobo.797.1"> text controls as the photo </span><span class="No-Break"><span class="koboSpan" id="kobo.798.1">is pan</span><a id="_idTextAnchor462"/><span class="koboSpan" id="kobo.799.1">ned.</span></span></p>
<h3><span class="koboSpan" id="kobo.800.1">Determining the screen size</span></h3>
<p><span class="koboSpan" id="kobo.801.1">To be able to calculate</span><a id="_idIndexMarker578"/><span class="koboSpan" id="kobo.802.1"> the percentage of how far the user has dragged the image, we need to know the size of the control. </span><span class="koboSpan" id="kobo.802.2">This is not determined until the control is laid out by .</span><span class="No-Break"><span class="koboSpan" id="kobo.803.1">NET </span><a id="_idTextAnchor463"/><span class="koboSpan" id="kobo.804.1">MAUI.</span></span></p>
<p><span class="koboSpan" id="kobo.805.1">We will override the </span><strong class="source-inline"><span class="koboSpan" id="kobo.806.1">OnSizeAllocated()</span></strong><span class="koboSpan" id="kobo.807.1"> method and add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.808.1">_screenWidth</span></strong><span class="koboSpan" id="kobo.809.1"> field in the class to keep track of the current width of </span><span class="No-Break"><span class="koboSpan" id="kobo.810.1">the window:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.811.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.812.1">SwiperControl.xaml.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.813.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.814.1">Add the following code to the file, putting the field at the beginning of the class and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.815.1">OnSizeAllocated()</span></strong><span class="koboSpan" id="kobo.816.1"> method below </span><span class="No-Break"><span class="koboSpan" id="kobo.817.1">the constructor:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.818.1">
private double _screenWidth = -1;
protected override void OnSizeAllocated(double width, double height)
{
  base.OnSizeAllocated(width, height);
  if (Application.Current.MainPage == null)
  {
    return;
  }
  _screenWidth = Application.Current.MainPage.Width;
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.819.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.820.1">_screenWidth</span></strong><span class="koboSpan" id="kobo.821.1"> field is used to store the width as soon as we have resolved it. </span><span class="koboSpan" id="kobo.821.2">We do this by overriding the </span><strong class="source-inline"><span class="koboSpan" id="kobo.822.1">OnSizeAllocated()</span></strong><span class="koboSpan" id="kobo.823.1"> method that is called by .NET MAUI when the size of the control is allocated. </span><span class="koboSpan" id="kobo.823.2">This is called multiple times. </span><span class="koboSpan" id="kobo.823.3">The first time it’s called is actually before the width and height have been set and before the </span><strong class="source-inline"><span class="koboSpan" id="kobo.824.1">MainPage</span></strong><span class="koboSpan" id="kobo.825.1"> property of the current app is set. </span><span class="koboSpan" id="kobo.825.2">At this time, the width and height are set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.826.1">-1</span></strong><span class="koboSpan" id="kobo.827.1">, and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.828.1">Application.Current.MainPage</span></strong><span class="koboSpan" id="kobo.829.1"> property is </span><strong class="source-inline"><span class="koboSpan" id="kobo.830.1">null</span></strong><span class="koboSpan" id="kobo.831.1">. </span><span class="koboSpan" id="kobo.831.2">We look for this state by null-checking </span><strong class="source-inline"><span class="koboSpan" id="kobo.832.1">Application.Current.MainPage</span></strong><span class="koboSpan" id="kobo.833.1"> and returning if it is </span><strong class="source-inline"><span class="koboSpan" id="kobo.834.1">null</span></strong><span class="koboSpan" id="kobo.835.1">. </span><span class="koboSpan" id="kobo.835.2">We could also have checked for </span><strong class="source-inline"><span class="koboSpan" id="kobo.836.1">-1</span></strong><span class="koboSpan" id="kobo.837.1"> values on the width. </span><span class="koboSpan" id="kobo.837.2">Either method would work. </span><span class="koboSpan" id="kobo.837.3">If it does have a value, however, we want to store it in our </span><strong class="source-inline"><span class="koboSpan" id="kobo.838.1">_screenWidth</span></strong><span class="koboSpan" id="kobo.839.1"> field for </span><span class="No-Break"><span class="koboSpan" id="kobo.840.1">later use.</span></span></p>
<p><span class="koboSpan" id="kobo.841.1">.NET MAUI will call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.842.1">OnSizeAllocated()</span></strong><span class="koboSpan" id="kobo.843.1"> method any time the frame of the app changes. </span><span class="koboSpan" id="kobo.843.2">This is most relevant for </span><strong class="bold"><span class="koboSpan" id="kobo.844.1">WinUI</span></strong><span class="koboSpan" id="kobo.845.1"> apps since they are in a window that a user can easily change. </span><span class="koboSpan" id="kobo.845.2">Android </span><a id="_idIndexMarker579"/><span class="koboSpan" id="kobo.846.1">and iOS apps are less likely to get a call to this method a second time since the app will take up the entire screen’s </span><span class="No-Break"><span class="koboSpan" id="kobo.847.1">real e</span><a id="_idTextAnchor464"/><a id="_idTextAnchor465"/><a id="_idTextAnchor466"/><a id="_idTextAnchor467"/><span class="koboSpan" id="kobo.848.1">state.</span></span></p>
<h3><span class="koboSpan" id="kobo.849.1">Adding code to calculate the state</span></h3>
<p><span class="koboSpan" id="kobo.850.1">To calculate the</span><a id="_idIndexMarker580"/><span class="koboSpan" id="kobo.851.1"> state of the image, we need to define what our zones are, and then create a function that takes the current amount of movement and updates the opacity of </span><a id="_idTextAnchor468"/><span class="koboSpan" id="kobo.852.1">the GUI decision zones based on how far we panned </span><span class="No-Break"><span class="koboSpan" id="kobo.853.1">the</span><a id="_idTextAnchor469"/><span class="koboSpan" id="kobo.854.1"> image.</span></span></p>
<h4><span class="koboSpan" id="kobo.855.1">Deﬁning a method for calculating the state</span></h4>
<p><span class="koboSpan" id="kobo.856.1">Let’s add</span><a id="_idIndexMarker581"/><span class="koboSpan" id="kobo.857.1"> the </span><strong class="source-inline"><span class="koboSpan" id="kobo.858.1">CalculatePanState()</span></strong><span class="koboSpan" id="kobo.859.1"> method to calculate how far we have panned the image, and if it should start to affect the GUI, by following these </span><span class="No-Break"><span class="koboSpan" id="kobo.860.1">few steps:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.861.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.862.1">Controls/SwiperControl.xaml.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.863.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.864.1">Add the properties at the top and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.865.1">CalculatePanState()</span></strong><span class="koboSpan" id="kobo.866.1"> method anywhere in the class, as shown in the following </span><span class="No-Break"><span class="koboSpan" id="kobo.867.1">code block:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.868.1">
private const double DeadZone = 0.4d;
private const double DecisionThreshold = 0.4d;
private void CalculatePanState(double panX)
{
  var halfScreenWidth = _screenWidth / 2;
  var deadZoneEnd = DeadZone * halfScreenWidth;
  if (Math.Abs(panX) &lt; deadZon</span><a id="_idTextAnchor470"/><span class="koboSpan" id="kobo.869.1">eEnd)
  {
    return;
  }
  var passedDeadzone = panX &lt; 0 ? </span><span class="koboSpan" id="kobo.869.2">panX + deadZoneEnd : panX - deadZoneEnd;
  var decisionZoneEnd = DecisionThreshold * halfScreenWidth;
  var opacity = passedDeadzone / decisionZoneEnd;
  opacity = double.Clamp(opacity, -1, 1);
  likeStackLayout.Opacity = opacity;
  denyStackLayout.Opacity = -opacity;
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.870.1">We define the following two values </span><span class="No-Break"><span class="koboSpan" id="kobo.871.1">as constants:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.872.1">DeadZone</span></strong><span class="koboSpan" id="kobo.873.1">, which defines that 40% (</span><strong class="source-inline"><span class="koboSpan" id="kobo.874.1">0.4</span></strong><span class="koboSpan" id="kobo.875.1">) of the available space on either side of the center point is a dead zone when panning an image. </span><span class="koboSpan" id="kobo.875.2">If we release the image in this zone, it simply returns to the center of the screen without any action </span><span class="No-Break"><span class="koboSpan" id="kobo.876.1">being taken.</span></span></li>
<li><span class="koboSpan" id="kobo.877.1">The next constant is </span><strong class="source-inline"><span class="koboSpan" id="kobo.878.1">DecisionThreshold</span></strong><span class="koboSpan" id="kobo.879.1">, which defines another 40% (</span><strong class="source-inline"><span class="koboSpan" id="kobo.880.1">0.4</span></strong><span class="koboSpan" id="kobo.881.1">) of the available space. </span><span class="koboSpan" id="kobo.881.2">This is used for interpolating the opacity of </span><strong class="source-inline"><span class="koboSpan" id="kobo.882.1">StackLayout</span></strong><span class="koboSpan" id="kobo.883.1"> on either side of </span><span class="No-Break"><span class="koboSpan" id="kobo.884.1">the layout.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.885.1">We then use these values to check the state of the panning action whenever the panning changes. </span><span class="koboSpan" id="kobo.885.2">If the absolute panning value of </span><em class="italic"><span class="koboSpan" id="kobo.886.1">X</span></em><span class="koboSpan" id="kobo.887.1"> (</span><strong class="source-inline"><span class="koboSpan" id="kobo.888.1">panX</span></strong><span class="koboSpan" id="kobo.889.1">) is less than the dead zone, we return without</span><a id="_idIndexMarker582"/><span class="koboSpan" id="kobo.890.1"> any action being taken. </span><span class="koboSpan" id="kobo.890.2">If not, we calculate how far over the dead zone we have passed and how far into the decision zone we are. </span><span class="koboSpan" id="kobo.890.3">We calculate the opacity values based on this interpolation and clamp the value between </span><strong class="source-inline"><span class="koboSpan" id="kobo.891.1">-1</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.892.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.893.1">1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.894.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.895.1">Finally, we set the opacity to this value for both </span><strong class="source-inline"><span class="koboSpan" id="kobo.896.1">likeStackLayout</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.897.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.898.1">denySta</span><a id="_idTextAnchor471"/><a id="_idTextAnchor472"/><span class="koboSpan" id="kobo.899.1">ckLayout</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.900.1">.</span></span></p>
<h4><span class="koboSpan" id="kobo.901.1">Wiring up the pan state check</span></h4>
<p><span class="koboSpan" id="kobo.902.1">While the image is being panned, we want to update the state, </span><span class="No-Break"><span class="koboSpan" id="kobo.903.1">as follows:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.904.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.905.1">Controls/SwiperControl.xaml.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.906.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.907.1">Add the following code in bold to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.908.1">PanRunning()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.909.1"> method:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.910.1">
private void PanRunning(PanUpdatedEventArgs e)
{
  photo.TranslationX = e.TotalX; photo.TranslationY =</span><a id="_idTextAnchor473"/><span class="koboSpan" id="kobo.911.1"> e.TotalY;
  photo.Rotation = _initialRotation + (photo.TranslationX / 25);
  </span><strong class="bold"><span class="koboSpan" id="kobo.912.1">CalculatePanState(e.TotalX);</span></strong><span class="koboSpan" id="kobo.913.1">
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.914.1">This addition to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.915.1">PanRunning()</span></strong><span class="koboSpan" id="kobo.916.1"> method passes the total amount of movement on the </span><em class="italic"><span class="koboSpan" id="kobo.917.1">x axis</span></em><span class="koboSpan" id="kobo.918.1"> to </span><a id="_idIndexMarker583"/><span class="koboSpan" id="kobo.919.1">the </span><strong class="source-inline"><span class="koboSpan" id="kobo.920.1">CalculatePanState()</span></strong><span class="koboSpan" id="kobo.921.1"> method, to determine if we need to adjust the opacity of either </span><strong class="source-inline"><span class="koboSpan" id="kobo.922.1">StackLayout</span></strong><span class="koboSpan" id="kobo.923.1"> on the right or the left of </span><span class="No-Break"><span class="koboSpan" id="kobo.924.1">th</span><a id="_idTextAnchor474"/><a id="_idTextAnchor475"/><span class="koboSpan" id="kobo.925.1">e control.</span></span></p>
<h3><span class="koboSpan" id="kobo.926.1">Adding exit logic</span></h3>
<p><span class="koboSpan" id="kobo.927.1">So far, all is well, except for the fact</span><a id="_idIndexMarker584"/><span class="koboSpan" id="kobo.928.1"> that if we drag an image to the edge and let go, the text stays. </span><span class="koboSpan" id="kobo.928.2">We need to determine when the user stops dragging the image, and, if so,</span><a id="_idTextAnchor476"/><span class="koboSpan" id="kobo.929.1"> whether or not the image is in a </span><span class="No-Break"><span class="koboSpan" id="kobo.930.1">decision zone.</span></span></p>
<p><span class="koboSpan" id="kobo.931.1">Let’s add the code needed to animate the photo back to its </span><span class="No-Break"><span class="koboSpan" id="kobo.932.1">origina</span><a id="_idTextAnchor477"/><span class="koboSpan" id="kobo.933.1">l position.</span></span></p>
<h4><span class="koboSpan" id="kobo.934.1">Checking if the image should exit</span></h4>
<p><span class="koboSpan" id="kobo.935.1">We want a simple function that determines if an image has panned far enough for it to count as an exit of that image. </span><span class="koboSpan" id="kobo.935.2">To create such a function, proceed </span><span class="No-Break"><span class="koboSpan" id="kobo.936.1">as follows:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.937.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.938.1">Controls/SwiperControl.xaml.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.939.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.940.1">Add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.941.1">CheckForExitCriteria()</span></strong><span class="koboSpan" id="kobo.942.1"> method to the class, as shown in the following </span><span class="No-Break"><span class="koboSpan" id="kobo.943.1">code snippet:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.944.1">
private bool CheckForExitCriteria()
{
  var halfScreenWidth = _screenWidth / 2;
  var decisionBreakpoint = DeadZone * halfScreenWidth;
  return (Math.Abs(photo.TranslationX) &gt; decisionBreakpoint);
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.945.1">This function calculates whether we have passed over the dead zone and into the decision zone. </span><span class="koboSpan" id="kobo.945.2">We need to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.946.1">Math.Abs()</span></strong><span class="koboSpan" id="kobo.947.1"> method to get the total absolute value to compare it against. </span><span class="koboSpan" id="kobo.947.2">We could have used </span><strong class="source-inline"><span class="koboSpan" id="kobo.948.1">&lt;</span></strong><span class="koboSpan" id="kobo.949.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.950.1">&gt;</span></strong><span class="koboSpan" id="kobo.951.1"> operators as well, but we are using this approach as it is more readable. </span><span class="koboSpan" id="kobo.951.2">This is a matter of code style and taste – feel free to do i</span><a id="_idTextAnchor478"/><a id="_idTextAnchor479"/><a id="_idTextAnchor480"/><span class="koboSpan" id="kobo.952.1">t </span><span class="No-Break"><span class="koboSpan" id="kobo.953.1">your way.</span></span></p>
<h4><span class="koboSpan" id="kobo.954.1">Removing the image</span></h4>
<p><span class="koboSpan" id="kobo.955.1">If we determine that an</span><a id="_idIndexMarker585"/><span class="koboSpan" id="kobo.956.1"> image has panned far enough for it to exit, we want to animate it off the screen and then remove the image from the page. </span><span class="koboSpan" id="kobo.956.2">To do this, proceed </span><span class="No-Break"><span class="koboSpan" id="kobo.957.1">as follows:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.958.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.959.1">Controls/SwiperControl.xaml.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.960.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.961.1">Add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.962.1">Exit()</span></strong><span class="koboSpan" id="kobo.963.1"> method to the class, as shown in the following </span><span class="No-Break"><span class="koboSpan" id="kobo.964.1">code block:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.965.1">
private void Exit()
{
  MainThread.BeginInvokeOnMainThread(async () =&gt;
  {
    var direction = photo.TranslationX &lt; 0 ? </span><span class="koboSpan" id="kobo.965.2">-1 : 1;
    await photo.TranslateTo(photo.TranslationX + (_screenWidth * direction), photo.TranslationY, 200, Easing.CubicIn);
    var parent = Parent as Layout;
    parent?.Children.Remove(this);
  });
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.966.1">Let’s break down the preceding code block to understand what the </span><strong class="source-inline"><span class="koboSpan" id="kobo.967.1">Exit()</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.968.1">method does:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.969.1">We begin by making sure that this call is done on the UI thread, which is also known as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.970.1">MainThread</span></strong><span class="koboSpan" id="kobo.971.1"> thread. </span><span class="koboSpan" id="kobo.971.2">This is because only the UI thread can </span><span class="No-Break"><span class="koboSpan" id="kobo.972.1">do animations.</span></span></li>
<li><span class="koboSpan" id="kobo.973.1">We also need to run this thread asynchronously so that we can kill two birds with one stone. </span><span class="koboSpan" id="kobo.973.2">Since this method is all about animating the image to either side of the screen, we need to determine in which direction to animate it. </span><span class="koboSpan" id="kobo.973.3">We do this by determining if the total translation of the image is positive </span><span class="No-Break"><span class="koboSpan" id="kobo.974.1">or negative.</span></span></li>
<li><span class="koboSpan" id="kobo.975.1">Then, we use this value to await a translation through the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.976.1">photo.TranslateTo()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.977.1"> call.</span></span></li>
<li><span class="koboSpan" id="kobo.978.1">We </span><strong class="source-inline"><span class="koboSpan" id="kobo.979.1">await</span></strong><span class="koboSpan" id="kobo.980.1"> this call since we don’t want the code execution to continue until it’s done. </span><span class="koboSpan" id="kobo.980.2">Once it has finished, we remove the control from the parent’s collection of children, causing it to disappear from </span><span class="No-Break"><span class="koboSpan" id="kobo.981.1">existe</span><a id="_idTextAnchor481"/><a id="_idTextAnchor482"/><a id="_idTextAnchor483"/><span class="koboSpan" id="kobo.982.1">nce forever.</span></span></li>
</ol>
<h4><span class="koboSpan" id="kobo.983.1">Updating PanCompleted</span></h4>
<p><span class="koboSpan" id="kobo.984.1">The decision </span><a id="_idIndexMarker586"/><span class="koboSpan" id="kobo.985.1">regarding whether the image</span><a id="_idIndexMarker587"/><span class="koboSpan" id="kobo.986.1"> should disappear or simply return to its original state is triggered in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.987.1">PanCompleted()</span></strong><span class="koboSpan" id="kobo.988.1"> method. </span><span class="koboSpan" id="kobo.988.2">Here, we will wire up the two methods that we created in the previous two sections. </span><span class="koboSpan" id="kobo.988.3">Proceed </span><span class="No-Break"><span class="koboSpan" id="kobo.989.1">as follows:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.990.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.991.1">Controls/SwiperControl.xaml.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.992.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.993.1">Add the following code in bold to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.994.1">PanCompleted()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.995.1"> method:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.996.1">
private void PanCompleted()
{
</span><strong class="bold"><span class="koboSpan" id="kobo.997.1">  if (CheckForExitCriteria())</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.998.1">  {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.999.1">    Exit();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1000.1">  }</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1001.1">  likeStackLayout.Opacity = 0;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1002.1">  denyStackLayout.Opacity = 0;</span></strong><span class="koboSpan" id="kobo.1003.1">
  photo.TranslateTo(0, 0, 250, Easing.SpringOut);
  photo.RotateTo(_initialRotation, 250, Easing.SpringOut);
  photo.ScaleTo(1, 250);
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1004.1">The last step in this section is to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1005.1">CheckForExitCriteria()</span></strong><span class="koboSpan" id="kobo.1006.1"> method, and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1007.1">Exit()</span></strong><span class="koboSpan" id="kobo.1008.1"> method if those criteria are met. </span><span class="koboSpan" id="kobo.1008.2">If the exit criteria are not met, we need to reset the state and the opacity of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1009.1">StackLayout</span></strong><span class="koboSpan" id="kobo.1010.1"> to make everything go back </span><span class="No-Break"><span class="koboSpan" id="kobo.1011.1">to normal.</span></span></p>
<p><span class="koboSpan" id="kobo.1012.1">Now that we can</span><a id="_idIndexMarker588"/><span class="koboSpan" id="kobo.1013.1"> swipe left or swipe right, let’s </span><a id="_idIndexMarker589"/><span class="koboSpan" id="kobo.1014.1">add some events to raise when the </span><a id="_idTextAnchor484"/><a id="_idTextAnchor485"/><span class="koboSpan" id="kobo.1015.1">user </span><span class="No-Break"><span class="koboSpan" id="kobo.1016.1">has swiped.</span></span></p>
<h3><span class="koboSpan" id="kobo.1017.1">Adding events to the control</span></h3>
<p><span class="koboSpan" id="kobo.1018.1">The last thing we</span><a id="_idIndexMarker590"/><span class="koboSpan" id="kobo.1019.1"> have left to do in the control itself is add some events that indicate whether the image has been </span><em class="italic"><span class="koboSpan" id="kobo.1020.1">liked</span></em><span class="koboSpan" id="kobo.1021.1"> or </span><em class="italic"><span class="koboSpan" id="kobo.1022.1">denied</span></em><span class="koboSpan" id="kobo.1023.1">. </span><span class="koboSpan" id="kobo.1023.2">We are going to use a clean interface, allowing for simple use of the control while hiding all the </span><span class="No-Break"><span class="koboSpan" id="kobo.1024.1">implem</span><a id="_idTextAnchor486"/><a id="_idTextAnchor487"/><a id="_idTextAnchor488"/><span class="koboSpan" id="kobo.1025.1">entation details.</span></span></p>
<h4><span class="koboSpan" id="kobo.1026.1">Declaring two events</span></h4>
<p><span class="koboSpan" id="kobo.1027.1">To make the control </span><a id="_idIndexMarker591"/><span class="koboSpan" id="kobo.1028.1">easier to interact with from the application itself, we’ll need to add events for </span><strong class="source-inline"><span class="koboSpan" id="kobo.1029.1">Like</span></strong><span class="koboSpan" id="kobo.1030.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1031.1">Deny</span></strong><span class="koboSpan" id="kobo.1032.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.1033.1">as follows:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1034.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1035.1">Controls/SwiperControl.xaml.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1036.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1037.1">Add two event declarations at the beginning of the class, as shown in the following </span><span class="No-Break"><span class="koboSpan" id="kobo.1038.1">code snippet:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1039.1">
public event EventHandler OnLike;
public event Ev</span><a id="_idTextAnchor489"/><span class="koboSpan" id="kobo.1040.1">entHandler OnDeny;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1041.1">These are two standard event declarations with out-of-the-b</span><a id="_idTextAnchor490"/><span class="koboSpan" id="kobo.1042.1">ox </span><span class="No-Break"><span class="koboSpan" id="kobo.1043.1">event handlers.</span></span></p>
<h4><span class="koboSpan" id="kobo.1044.1">Raising the events</span></h4>
<p><span class="koboSpan" id="kobo.1045.1">We need to add</span><a id="_idIndexMarker592"/><span class="koboSpan" id="kobo.1046.1"> code in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1047.1">Exit()</span></strong><span class="koboSpan" id="kobo.1048.1"> method to raise the events we created earlier, </span><span class="No-Break"><span class="koboSpan" id="kobo.1049.1">as follows:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1050.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1051.1">Controls/SwiperControl.xaml.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1052.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1053.1">Add the following code in bold to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1054.1">Exit()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1055.1"> method:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1056.1">
private void Exit()
{
  MainThread.BeginInvokeOnMainThread(async () =&gt;
  {
    var direction = photo.TranslationX &lt; 0 ? </span><span class="koboSpan" id="kobo.1056.2">-1 : 1;
</span><strong class="bold"><span class="koboSpan" id="kobo.1057.1">    if (direction &gt; 0)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1058.1">    {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1059.1">      OnLike?.Invoke(this, new EventArgs());</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1060.1">    }</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1061.1">    if (direction &lt; 0)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1062.1">    {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1063.1">      OnDeny?.Invoke(this, new EventArgs());</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1064.1">    }</span></strong><span class="koboSpan" id="kobo.1065.1">
    await photo.TranslateTo(photo.TranslationX + (_screenWidth * direction), photo.TranslationY, 200, Easing.CubicIn);
    var parent = Parent as Layout;
    parent?.Children.Re</span><a id="_idTextAnchor491"/><span class="koboSpan" id="kobo.1066.1">move(this);
  });
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1067.1">Here, we inject the code to check whether we are liking or denying an i</span><a id="_idTextAnchor492"/><span class="koboSpan" id="kobo.1068.1">mage. </span><span class="koboSpan" id="kobo.1068.2">We then raise the correct event based on </span><span class="No-Break"><span class="koboSpan" id="kobo.1069.1">this information.</span></span></p>
<p><span class="koboSpan" id="kobo.1070.1">We are now ready to finalize this app; the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1071.1">Swiper</span></strong><span class="koboSpan" id="kobo.1072.1"> control is complete, so now, we need to add the</span><a id="_idIndexMarker593"/><span class="koboSpan" id="kobo.1073.1"> right initializatio</span><a id="_idTextAnchor493"/><span class="koboSpan" id="kobo.1074.1">n code to </span><span class="No-Break"><span class="koboSpan" id="kobo.1075.1">finish it.</span></span></p>
<h2 id="_idParaDest-108"><a id="_idTextAnchor494"/><span class="koboSpan" id="kobo.1076.1">Wiring up the Swiper control</span></h2>
<p><span class="koboSpan" id="kobo.1077.1">We have now reached</span><a id="_idIndexMarker594"/><span class="koboSpan" id="kobo.1078.1"> the final part of this chapter. </span><span class="koboSpan" id="kobo.1078.2">In this section, we are going to wire up the images and make our app a closed-loop app that can be used forever. </span><span class="koboSpan" id="kobo.1078.3">We will add 10 images that we will download from the internet when the app st</span><a id="_idTextAnchor495"/><span class="koboSpan" id="kobo.1079.1">arts up. </span><span class="koboSpan" id="kobo.1079.2">Each time an image is removed, we’ll si</span><a id="_idTextAnchor496"/><span class="koboSpan" id="kobo.1080.1">mply add </span><span class="No-Break"><span class="koboSpan" id="kobo.1081.1">another one.</span></span></p>
<h3><span class="koboSpan" id="kobo.1082.1">Adding images</span></h3>
<p><span class="koboSpan" id="kobo.1083.1">Let’s start by creating </span><a id="_idIndexMarker595"/><span class="koboSpan" id="kobo.1084.1">some code that will add the images to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1085.1">MainView</span></strong><span class="koboSpan" id="kobo.1086.1"> class. </span><span class="koboSpan" id="kobo.1086.2">First, we will add the initial images; then, we will create a logic model for add</span><a id="_idTextAnchor497"/><span class="koboSpan" id="kobo.1087.1">ing a new image to the bottom of the stack each time an ima</span><a id="_idTextAnchor498"/><span class="koboSpan" id="kobo.1088.1">ge is liked </span><span class="No-Break"><span class="koboSpan" id="kobo.1089.1">or denied.</span></span></p>
<h4><span class="koboSpan" id="kobo.1090.1">Adding initial photos</span></h4>
<p><span class="koboSpan" id="kobo.1091.1">To make the photos look like they are stacked, we need at least 10 of them. </span><span class="koboSpan" id="kobo.1091.2">Proceed </span><span class="No-Break"><span class="koboSpan" id="kobo.1092.1">as follows:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1093.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1094.1">MainPage.xaml.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1095.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1096.1">Add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1097.1">AddInitalPhotos()</span></strong><span class="koboSpan" id="kobo.1098.1"> method and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1099.1">InsertPhotoMethod()</span></strong><span class="koboSpan" id="kobo.1100.1"> to the class, as illustrated in the following </span><span class="No-Break"><span class="koboSpan" id="kobo.1101.1">code block:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1102.1">
private void AddInitialPhotos()
{
  for (int i = 0; i &lt; 10; i++)
  {
    InsertPhoto();
  }
}
private void InsertPhoto()
{
  var photo = new SwiperControl();
  this.MainGrid.Childr</span><a id="_idTextAnchor499"/><span class="koboSpan" id="kobo.1103.1">en.Insert(0, photo);
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1104.1">First, we create a method called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1105.1">AddInitialPhotos()</span></strong><span class="koboSpan" id="kobo.1106.1"> that will be called upon startup. </span><span class="koboSpan" id="kobo.1106.2">This method simply calls the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1107.1">InsertPhoto()</span></strong><span class="koboSpan" id="kobo.1108.1"> method 10 times and adds a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.1109.1">SwiperControl</span></strong><span class="koboSpan" id="kobo.1110.1"> to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1111.1">MainGrid</span></strong><span class="koboSpan" id="kobo.1112.1"> each time. </span><span class="koboSpan" id="kobo.1112.2">It inserts the control at the first position in the </span><a id="_idIndexMarker596"/><span class="koboSpan" id="kobo.1113.1">stack, effectively putting it at the bottom of the pile since the co</span><a id="_idTextAnchor500"/><span class="koboSpan" id="kobo.1114.1">llection of controls is rendered from th</span><a id="_idTextAnchor501"/><span class="koboSpan" id="kobo.1115.1">e beginning to </span><span class="No-Break"><span class="koboSpan" id="kobo.1116.1">the end.</span></span></p>
<h4><span class="koboSpan" id="kobo.1117.1">Making the call from the constructor</span></h4>
<p><span class="koboSpan" id="kobo.1118.1">We need to call this method for the magic to happen, so follow these steps to </span><span class="No-Break"><span class="koboSpan" id="kobo.1119.1">do so:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1120.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1121.1">MainPage.xaml.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1122.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1123.1">Add the following code in bold to </span><span class="No-Break"><span class="koboSpan" id="kobo.1124.1">the constructor:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1125.1">
public MainPage()
{
  InitializeComponent();
  </span><strong class="bold"><span class="koboSpan" id="kobo.1126.1">AddInitialPhotos();</span></strong><span class="koboSpan" id="kobo.1127.1">
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1128.1">There isn’t much to say here. </span><span class="koboSpan" id="kobo.1128.2">Once the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1129.1">MainPage</span></strong><span class="koboSpan" id="kobo.1130.1"> object has been initialized</span><a id="_idTextAnchor502"/><span class="koboSpan" id="kobo.1131.1">, we call the method to </span><a id="_idIndexMarker597"/><span class="koboSpan" id="kobo.1132.1">add 10 random photos that we will dow</span><a id="_idTextAnchor503"/><span class="koboSpan" id="kobo.1133.1">nload from </span><span class="No-Break"><span class="koboSpan" id="kobo.1134.1">the internet.</span></span></p>
<h3><span class="koboSpan" id="kobo.1135.1">Adding count labels</span></h3>
<p><span class="koboSpan" id="kobo.1136.1">We want to add </span><a id="_idIndexMarker598"/><span class="koboSpan" id="kobo.1137.1">some values to the app as well. </span><span class="koboSpan" id="kobo.1137.2">We can do this by adding two labels below the collection of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1138.1">Swiper</span></strong><span class="koboSpan" id="kobo.1139.1"> controls. </span><span class="koboSpan" id="kobo.1139.2">Each time a user rates an image, we will increment one of two counters and display </span><span class="No-Break"><span class="koboSpan" id="kobo.1140.1">the result.</span></span></p>
<p><span class="koboSpan" id="kobo.1141.1">So, let’s add the XAML code needed to display </span><span class="No-Break"><span class="koboSpan" id="kobo.1142.1">the labels:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1143.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1144.1">MainPage.xaml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1145.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1146.1">Replace the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1147.1">&lt;!-- Placeholder for later --&gt;</span></strong><span class="koboSpan" id="kobo.1148.1"> comment with the following code marked </span><span class="No-Break"><span class="koboSpan" id="kobo.1149.1">in bold:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1150.1">
&lt;Grid Grid.Row="1" Padding="30"&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.1151.1">  &lt;Grid.RowDefinitions&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1152.1">    &lt;RowDefinition Height="auto" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1153.1">    &lt;RowDefinition Height="auto" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1154.1">    &lt;RowDefinition Height="auto" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1155.1">    &lt;RowDefinition Height="auto" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1156.1">  &lt;/Grid.RowDefinitions&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1157.1">  &lt;Label Text="LIKES" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1158.1">  &lt;Label x:Nam</span><a id="_idTextAnchor504"/><span class="koboSpan" id="kobo.1159.1">e="likeLabel" Grid.Row="1" Text="0" FontSize="Large" FontAttributes="Bold" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1160.1">  &lt;Label Grid.Row="2" Text="DENIED" /&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1161.1">  &lt;Label x:Name="denyLabel" Grid.Row="3" Text="0" FontSize="Large" FontAttributes="Bold" /&gt;</span></strong><span class="koboSpan" id="kobo.1162.1">
&lt;/Grid&gt;</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1163.1">This code adds a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.1164.1">Grid</span></strong><span class="koboSpan" id="kobo.1165.1"> control with four auto-height rows. </span><span class="koboSpan" id="kobo.1165.2">This means that we calculate the height of the content of each row and use this for the layout. </span><span class="koboSpan" id="kobo.1165.3">It is the same thing as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1166.1">StackLayout</span></strong><span class="koboSpan" id="kobo.1167.1">, but we wanted to demonstrate a better way of </span><span class="No-Break"><span class="koboSpan" id="kobo.1168.1">doing this.</span></span></p>
<p><span class="koboSpan" id="kobo.1169.1">We add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1170.1">Label</span></strong><span class="koboSpan" id="kobo.1171.1"> control in each row and name two of them </span><strong class="source-inline"><span class="koboSpan" id="kobo.1172.1">likeLabel</span></strong><span class="koboSpan" id="kobo.1173.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1174.1">denyLabel</span></strong><span class="koboSpan" id="kobo.1175.1">. </span><span class="koboSpan" id="kobo.1175.2">These two named labels will hold information about how many image</span><a id="_idTextAnchor505"/><span class="koboSpan" id="kobo.1176.1">s have been liked and </span><a id="_idIndexMarker599"/><a id="_idTextAnchor506"/><span class="koboSpan" id="kobo.1177.1">how many have </span><span class="No-Break"><span class="koboSpan" id="kobo.1178.1">been denied.</span></span></p>
<h3><span class="koboSpan" id="kobo.1179.1">Subscribing to events</span></h3>
<p><span class="koboSpan" id="kobo.1180.1">The last step is </span><a id="_idIndexMarker600"/><span class="koboSpan" id="kobo.1181.1">to wire up the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1182.1">OnLike</span></strong><span class="koboSpan" id="kobo.1183.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1184.1">OnDeny</span></strong><span class="koboSpan" id="kobo.1185.1"> events and dis</span><a id="_idTextAnchor507"/><span class="koboSpan" id="kobo.1186.1">play t</span><a id="_idTextAnchor508"/><span class="koboSpan" id="kobo.1187.1">he total count to </span><span class="No-Break"><span class="koboSpan" id="kobo.1188.1">the user.</span></span></p>
<h4><span class="koboSpan" id="kobo.1189.1">Adding methods to update the GUI and respond to events</span></h4>
<p><span class="koboSpan" id="kobo.1190.1">We need some</span><a id="_idIndexMarker601"/><span class="koboSpan" id="kobo.1191.1"> code to update the GUI and keep track of the count. </span><span class="koboSpan" id="kobo.1191.2">Proceed </span><span class="No-Break"><span class="koboSpan" id="kobo.1192.1">as follows:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1193.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1194.1">MainPage.xaml.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1195.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1196.1">Add the following code to </span><span class="No-Break"><span class="koboSpan" id="kobo.1197.1">the class:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1198.1">
private int _likeCount;
private int _denyCount;
private void UpdateGui()
{
  likeLabel.Text = _likeCount.ToString();
  denyLabel.Text = _denyCount.ToString();
}
private void Handle_OnLike(object sender, EventArgs e)
{
  _</span><a id="_idTextAnchor509"/><span class="koboSpan" id="kobo.1199.1">likeCount++;
  InsertPhoto();
  UpdateGui();
}
private void Handle_OnDeny(object sender, EventArgs e)
{
  _denyCount++;
  InsertPhoto();
  UpdateGui();
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1200.1">The two fields at the top of the preceding code block keep track of the number of likes and denies. </span><span class="koboSpan" id="kobo.1200.2">Since they are value-type variables, they default </span><span class="No-Break"><span class="koboSpan" id="kobo.1201.1">to zero.</span></span></p>
<p><span class="koboSpan" id="kobo.1202.1">To make the changes of these labels show up in the UI, we’ve created a method called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1203.1">UpdateGui()</span></strong><span class="koboSpan" id="kobo.1204.1">. </span><span class="koboSpan" id="kobo.1204.2">This takes the value of the two aforementioned fields and assigns it to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1205.1">Text</span></strong><span class="koboSpan" id="kobo.1206.1"> properties of </span><span class="No-Break"><span class="koboSpan" id="kobo.1207.1">both labels.</span></span></p>
<p><span class="koboSpan" id="kobo.1208.1">The two methods that follow are the event handlers that will be handling the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1209.1">OnLike</span></strong><span class="koboSpan" id="kobo.1210.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1211.1">OnDeny</span></strong><span class="koboSpan" id="kobo.1212.1"> events. </span><span class="koboSpan" id="kobo.1212.2">They </span><a id="_idIndexMarker602"/><span class="koboSpan" id="kobo.1213.1">increase the appropriate field, add a new photo, and then update t</span><a id="_idTextAnchor510"/><span class="koboSpan" id="kobo.1214.1">he GUI to reflect </span><span class="No-Break"><span class="koboSpan" id="kobo.1215.1">the change.</span></span></p>
<h4><span class="koboSpan" id="kobo.1216.1">Wiring up events</span></h4>
<p><span class="koboSpan" id="kobo.1217.1">Each time</span><a id="_idIndexMarker603"/><span class="koboSpan" id="kobo.1218.1"> a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.1219.1">SwiperControl</span></strong><span class="koboSpan" id="kobo.1220.1"> instance is created, we need to wire up the events, </span><span class="No-Break"><span class="koboSpan" id="kobo.1221.1">as follows:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1222.1">Open </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1223.1">MainPage.xaml.cs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1224.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1225.1">Add the following code in bold to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1226.1">InsertPhoto()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1227.1"> method:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1228.1">
private void InsertPhoto()
{
  var photo = new SwiperControl();
</span><strong class="bold"><span class="koboSpan" id="kobo.1229.1">  photo.OnDeny += Handle_OnDeny;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1230.1">  photo.OnLike += Handle_OnLike;</span></strong><span class="koboSpan" id="kobo.1231.1">
  this.MainGrid.Children.Insert(0, photo);
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1232.1">The added code wires up the event handlers that we defined earlier. </span><span class="koboSpan" id="kobo.1232.2">The events make it easy to interact with</span><a id="_idIndexMarker604"/><span class="koboSpan" id="kobo.1233.1"> our new control. </span><span class="koboSpan" id="kobo.1233.2">Try it for yourself and have a play around with</span><a id="_idTextAnchor511"/><span class="koboSpan" id="kobo.1234.1"> the app that you </span><span class="No-Break"><span class="koboSpan" id="kobo.1235.1">have created.</span></span></p>
<h1 id="_idParaDest-109"><a id="_idTextAnchor512"/><span class="koboSpan" id="kobo.1236.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.1237.1">Good job! </span><span class="koboSpan" id="kobo.1237.2">In this chapter, we learned how to create a reusable, good-looking control that can be used in any .NET MAUI app. </span><span class="koboSpan" id="kobo.1237.3">To enhance the </span><strong class="bold"><span class="koboSpan" id="kobo.1238.1">user experience</span></strong><span class="koboSpan" id="kobo.1239.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1240.1">UX</span></strong><span class="koboSpan" id="kobo.1241.1">) of the app, we used some animations that give the user more visual feedback. </span><span class="koboSpan" id="kobo.1241.2">We also got creative with the use of XAML to define a GUI of the control that looks like a photo, with a </span><span class="No-Break"><span class="koboSpan" id="kobo.1242.1">hand-written description.</span></span></p>
<p><span class="koboSpan" id="kobo.1243.1">After that, we used events to expose the behavior of the control back to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1244.1">MainPage</span></strong><span class="koboSpan" id="kobo.1245.1"> page to limit the contact surface between your app and the control. </span><span class="koboSpan" id="kobo.1245.2">Most importantly of all, we touched on the subject of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1246.1">GestureRecognizers</span></strong><span class="koboSpan" id="kobo.1247.1">, which can make our life much easier when dealing with </span><span class="No-Break"><span class="koboSpan" id="kobo.1248.1">common gestures.</span></span></p>
<p><span class="koboSpan" id="kobo.1249.1">Looking for ideas on how to make this app even better? </span><span class="koboSpan" id="kobo.1249.2">Try this out: keep a history of the likes and dislikes and add a view to display </span><span class="No-Break"><span class="koboSpan" id="kobo.1250.1">each collection.</span></span></p>
<p><span class="koboSpan" id="kobo.1251.1">In the next chapter, we will create a photo gallery app using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1252.1">CollectionView</span></strong><span class="koboSpan" id="kobo.1253.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1254.1">CarouselView</span></strong><span class="koboSpan" id="kobo.1255.1"> controls. </span><span class="koboSpan" id="kobo.1255.2">The app will also allow you to favorite photos you like by using storage to keep the favorites list between </span><span class="No-Break"><span class="koboSpan" id="kobo.1256.1">app runs.</span></span></p>
</div>
</body></html>