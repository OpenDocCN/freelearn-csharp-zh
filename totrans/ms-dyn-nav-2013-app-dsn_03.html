<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Financial Management"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Financial Management</h1></div></div></div><p>Whether you run a company, a non-profit organization, or an educational institute, doing proper bookkeeping is mandatory and required by the government.</p><p>This makes the financial management the most used part of Microsoft Dynamics NAV and the least obvious place to make changes, as federal regulations do not allow much creativity in this part of the application.</p><p>The first part of this chapter is all about the look, learn, and love principle that we discussed in the previous chapter. We cannot integrate our application with financial management without knowing the basic functionality and structure of the tool.</p><p>In the second part of the chapter, we will look at some examples of how to change or expand the way financial management works.</p><p>Lastly, we will look at how to create a posting in the general ledger from a newly designed posting routine.</p><p>After reading this chapter, you should be able to<a class="indexterm" id="id285"/> set up financial management in a new database and create basic postings to the general ledger and understand how to integrate financial management with your application.</p><div class="section" title="Chart of accounts"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec32"/>Chart of accounts</h1></div></div></div><p>A <a class="indexterm" id="id286"/>
<span class="strong"><strong>chart of accounts</strong></span> (<span class="strong"><strong>COA</strong></span>)<a class="indexterm" id="id287"/> is a list of the accounts used by an organization to define each class of items for which money or the equivalent is spent or received. It is used to organize the finances of the entity and to segregate expenditures, revenue, assets, and liabilities in order to give interested parties a better understanding of the financial health of the entity.</p><p>Every financial system starts with a COA and although the numbering might differ from country to country, we all have income statements and balance accounts.</p><div class="mediaobject"><img alt="Chart of accounts" src="graphics/0365EN_03_01.jpg"/></div><p>Microsoft Dynamics NAV also has some other special accounts: <span class="strong"><strong>Heading</strong></span>, <span class="strong"><strong>Begin-Total</strong></span>, and <span class="strong"><strong>End-Total</strong></span> accounts.</p><p>With these <a class="indexterm" id="id288"/>accounts, you can make the COA more readable. The accounts within the total accounts are automatically indented.</p><div class="section" title="Posting accounts"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec52"/>Posting accounts</h2></div></div></div><p>When<a class="indexterm" id="id289"/> creating a new posting account, there are <a class="indexterm" id="id290"/>several options to choose. Most of them are not mandatory but they make it easier to push the end users to using the correct account while generating entries.</p><p>Let's have a look at the options by opening a <span class="strong"><strong>G/L Account Card</strong></span>:</p><div class="mediaobject"><img alt="Posting accounts" src="graphics/0365EN_03_02.jpg"/></div><p>The first and <a class="indexterm" id="id291"/>most important decision to make<a class="indexterm" id="id292"/> is the type of account to be created. It can be either <span class="strong"><strong>Income Statement</strong></span> or <span class="strong"><strong>Balance Sheet</strong></span>. Income statement accounts are reset to zero every new fiscal year, while balance sheet accounts continue indefinitely. The total of the balance sheet accounts should always match the total of the income statement accounts.</p><div class="mediaobject"><img alt="Posting accounts" src="graphics/0365EN_03_03.jpg"/></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip16"/>Tip</h3><p>You can create two total accounts to check whether the balance in your G/L is accurate. Take a total of all income statements and all balance sheets.</p></div></div><p>You can also force <a class="indexterm" id="id293"/>an account to only accept debit or credit postings. The <span class="strong"><strong>No. Of Blank Lines</strong></span> and <span class="strong"><strong>New Page</strong></span> fields are used when printing reports and<a class="indexterm" id="id294"/> have no effect on the system. <span class="strong"><strong>Reconciliation Account</strong></span> is hardly used anymore unless, you do not use sub accounting.</p><p>
<span class="strong"><strong>Automatic Ext. Texts</strong></span>
<a class="indexterm" id="id295"/> creates the extra texts discussed in <a class="link" href="ch01.html" title="Chapter 1. Introduction to Microsoft Dynamics NAV">Chapter 1</a>, <span class="emphasis"><em>Introduction to Microsoft Dynamics NAV</em></span>, automatically when you use this account in a sales or purchasing document.</p><p>
<span class="strong"><strong>Direct Posting</strong></span> is a <a class="indexterm" id="id296"/>very important option. It is highly recommended to disable this option when an account is used in one of the posting setups. When <span class="strong"><strong>Direct Posting</strong></span> is enabled, an end user can create entries in this account, disrupting the balance between the general ledger and the sub administration. We'll discuss this in more detail later in this chapter.</p><p>When you do allow <span class="strong"><strong>Direct Posting</strong></span>, the fields on the <span class="strong"><strong>Posting</strong></span> tab are very important.</p><p>
<span class="strong"><strong>Gen. Posting Type</strong></span>
<a class="indexterm" id="id297"/> determines whether the account is used for purchase and/or sales for the VAT calculation and filtering in the VAT statements. A more detailed VAT specification is determined by the VAT business and product posting group. The general business and product posting groups can be used to automatically populate these fields, when this account is used.</p><p>In the <a class="indexterm" id="id298"/>
<span class="strong"><strong>Consolidation</strong></span> tab, you can populate the consolidation accounts used when consolidating two or more companies. We'll discuss consolidation later in this chapter.</p><p>Microsoft Dynamics NAV allows an additional reporting currency to be used. This is an inheritance from the days before the Euro in Europe and was very popular in the years of Euro introduction. Today, it is used by international companies, for example, a company based in the USA with a Dutch Parent company. In the<a class="indexterm" id="id299"/> <span class="strong"><strong>Reporting</strong></span> tab, you can determine how you want to handle exchange rate adjustments when using this functionality.</p></div><div class="section" title="VAT versus sales tax"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec53"/>VAT versus sales tax</h2></div></div></div><p>Microsoft Dynamics NAV <a class="indexterm" id="id300"/>allows the calculation of both European VAT <a class="indexterm" id="id301"/>and North American Sales Tax. The examples in this book are based on European VAT.</p><p>For sales tax, the <span class="strong"><strong>Tax Area Code</strong></span> and <span class="strong"><strong>Tax Group Code</strong></span> fields are used instead of the VAT Business Posting Group<a class="indexterm" id="id302"/> and the <a class="indexterm" id="id303"/>VAT Product Posting Group.</p></div><div class="section" title="The entry tables"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec54"/>The entry tables</h2></div></div></div><p>As <a class="indexterm" id="id304"/>discussed in <a class="link" href="ch01.html" title="Chapter 1. Introduction to Microsoft Dynamics NAV">Chapter 1</a>, <span class="emphasis"><em>Introduction to Microsoft Dynamics NAV</em></span>, the entries for the general ledger are created in the general journals when you post a sales or purchase document. So, let's have a closer look at this functionality and see what we can do with it.</p><div class="section" title="Sub accounting"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec19"/>Sub accounting</h3></div></div></div><p>In theory, you<a class="indexterm" id="id305"/> could run Microsoft Dynamics NAV with just the G/L Entry table, but in accounting, we have invented sub administrations.</p><p>Sub administrations <a class="indexterm" id="id306"/>are very old. Before computers were invented, people would have cards for all customers and vendors to keep track of their balance. Updating these cards was a manual and time-consuming process with a high probability of making mistakes.</p><p>In Microsoft Dynamics NAV, this is taken care of automatically. In the general ledger, we have four sub administrations:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Bank</strong></span>: For <a class="indexterm" id="id307"/>every transaction on a bank account, a <a class="indexterm" id="id308"/>bank ledger entry is created. The total of all bank ledger entries should match your bank account's balance. It allows you to quickly find payments.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Customer</strong></span>: Whenever <a class="indexterm" id="id309"/>you sell something to a customer or a <a class="indexterm" id="id310"/>customer pays a customer ledger, an entry is created. It allows you to analyze payment history and send out reminders.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Vendor</strong></span>: When you buy something<a class="indexterm" id="id311"/> using a vendor, the system creates a <a class="indexterm" id="id312"/>vendor ledger entry. We can use the vendor ledger entries to determine which invoice needs to be paid. The vendor ledger entries are the opposite of the customer ledger entries.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>VAT/TAX</strong></span>: These <a class="indexterm" id="id313"/>entries help us to easily create<a class="indexterm" id="id314"/> clear VAT/TAX statements.</li></ul></div><p>As discussed earlier, it is very important that the total of the sub administration matches the general ledger. For example, when your bank account balance is <span class="strong"><strong>2.846,54</strong></span>, the G/L Account should also have that amount.</p><div class="mediaobject"><img alt="Sub accounting" src="graphics/0365EN_03_04.jpg"/></div><p>For this, you <a class="indexterm" id="id315"/>can disable the <span class="strong"><strong>Direct Posting</strong></span> option we discussed earlier.</p></div></div></div></div>
<div class="section" title="Working with general journals"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec33"/>Working with general journals</h1></div></div></div><p>When we <a class="indexterm" id="id316"/>open <a class="indexterm" id="id317"/>a general journal, we can start making transactions. Let's discuss the possibilities.</p><div class="mediaobject"><img alt="Working with general journals" src="graphics/0365EN_03_05.jpg"/></div><p>The most important <a class="indexterm" id="id318"/>fields of a general journal are the <span class="strong"><strong>Posting Date</strong></span> and the <span class="strong"><strong>Document No</strong></span>. The total of amounts for each combination of<a class="indexterm" id="id319"/> these fields should always be in balance. In other words, all journal lines for any particular combination of <span class="strong"><strong>Posting Date</strong></span> and <span class="strong"><strong>Document No.</strong></span> should always add up to zero.</p><p>There are different account types we can post to. When we post directly to a <span class="strong"><strong>G/L Account</strong></span>, it is clear what will happen; a new <span class="strong"><strong>G/L Entry</strong></span> will be created for that amount. When we choose another <span class="strong"><strong>Account Type</strong></span>, the sub administrations will start to work. For example, when we choose <span class="strong"><strong>Customer</strong></span>, a <span class="strong"><strong>Customer Ledger Entry</strong></span> will be created as well as a <span class="strong"><strong>G/L Entry</strong></span>. Which <span class="strong"><strong>G/L account</strong></span> is used is determined by the posting group, which we will discuss later in this chapter.</p><p>Here, we also see the <span class="strong"><strong>Gen. Posting Type</strong></span>, <span class="strong"><strong>General Business</strong></span> and <span class="strong"><strong>Product Posting</strong></span> groups and <span class="strong"><strong>VAT Business</strong></span> and <span class="strong"><strong>Product Posting</strong></span> groups come back. These are inherited from the <span class="strong"><strong>G/L Account</strong></span> we discussed earlier, but you can choose a different one if you want.</p><p>The VAT options determine the VAT calculation that is done automatically. A VAT entry is created with the VAT amount and additional <span class="strong"><strong>G/L Entries</strong></span> are created.</p><p>There are two <a class="indexterm" id="id320"/>ways of balancing a general ledger. We can create two lines with the same debit and credit amount or we can use the balance fields.</p><p>Let's see some <a class="indexterm" id="id321"/>of this in an example. We have made a purchase somewhere at an irregular vendor. All we have is a small cash receipt with the amount and the VAT, which we want to bring into our company.</p><p>The amount is 440 including 10 percent VAT, so we want to create the following transaction:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Cost</p>
</th><th style="text-align: left" valign="bottom">
<p>VAT</p>
</th><th style="text-align: left" valign="bottom">
<p>Current account</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>400,00</p>
</td><td style="text-align: left" valign="top">
<p>40,00</p>
</td><td style="text-align: left" valign="top">
<p>440,00</p>
</td></tr></tbody></table></div><p>The transaction can also be seen in the following screenshot:</p><div class="mediaobject"><img alt="Working with general journals" src="graphics/0365EN_03_06.jpg"/></div><p>We can see that Microsoft Dynamics NAV calculates the <span class="strong"><strong>VAT Amount</strong></span> and by populating the balance account, we only need one line, which is always in balance.</p><p>When we <span class="strong"><strong>Navigate</strong></span> this transaction, we see that we have three <span class="strong"><strong>G/L Entries</strong></span> and one <span class="strong"><strong>VAT Entry</strong></span>.</p><div class="mediaobject"><img alt="Working with general journals" src="graphics/0365EN_03_07.jpg"/></div><a class="indexterm" id="id322"/><p>Opening the <span class="strong"><strong>G/L Entries</strong></span> shows the correct amounts.</p><div class="mediaobject"><img alt="Working with general journals" src="graphics/0365EN_03_08.jpg"/></div><p>In another example, we'll create<a class="indexterm" id="id323"/> a customer payment via the bank journal.</p><div class="section" title="Entry application"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec55"/>Entry application</h2></div></div></div><p>A<a class="indexterm" id="id324"/> bank journal <a class="indexterm" id="id325"/>is a general journal with a specific page ID. This allows the application to have a different user interface based on the same business logic. A specific feature of a bank journal is the possibility to easily apply payments to invoices.</p><div class="mediaobject"><img alt="Entry application" src="graphics/0365EN_03_09.jpg"/></div><p>The bank journal <a class="indexterm" id="id326"/>does not directly post to a G/L Account but uses other account types. In this case, the <span class="strong"><strong>Account Type</strong></span> is <span class="strong"><strong>Customer</strong></span> and the <span class="strong"><strong>Balance Account Type</strong></span> is <span class="strong"><strong>Bank Account</strong></span>. Instead of a list with G/L Accounts, the <span class="strong"><strong>Account No.</strong></span> field now refers to the <span class="strong"><strong>Customers</strong></span> and the <span class="strong"><strong>Balance Account No.</strong></span> fields refer to the <span class="strong"><strong>Bank Account</strong></span>. The latter is automatically populated from the Journal Batch definition.</p><p>We'll use the <span class="strong"><strong>Apply Entries</strong></span> feature to determine which invoice this payment applies to. If we did not do this, the system would not know which invoice is paid.</p><p>Another option would be to automatically apply entries, but when a customer decides to skip a payment, the system might get confused, so it is highly recommended to apply entries manually.</p><p>When we post this journal and navigate the entries, we see that all necessary sub administrations are updated:</p><div class="mediaobject"><img alt="Entry application" src="graphics/0365EN_03_11.jpg"/></div></div><div class="section" title="Posting groups"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec56"/>Posting groups</h2></div></div></div><p>In the<a class="indexterm" id="id327"/> previous section, we <a class="indexterm" id="id328"/>talked about using customer numbers and bank account numbers as an account number in the general journal. The system can then figure out what G/L Account numbers to use. But how does that work?</p><p>This is done using the various posting group matrices. Most application parts that post to the general ledger have their own <a class="indexterm" id="id329"/>posting group table. There are two types of posting groups: single layer and matrix layer.</p><p>The single layer has direct G/L Account columns and the matrix layer has an additional setup table:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Single layer</p>
</th><th style="text-align: left" valign="bottom">
<p>Matrix layer</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Customer posting group</p>
<p>Vendor posting group</p>
<p>Inventory posting group</p>
<p>Job posting group</p>
<p>Bank account posting group</p>
<p>FA posting group</p>
</td><td style="text-align: left" valign="top">
<p>Gen. business posting group</p>
<p>Gen. product posting group</p>
<p>VAT business posting group</p>
<p>VAT product posting group</p>
<p>Inventory posting setup</p>
</td></tr></tbody></table></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>Each country uses different account schedules and regulations. The G/L Accounts in this book are used for the CRONUS example database. These can be different in each country and implementation.</p></div></div><p>Let's have a look at <a class="indexterm" id="id330"/>
<span class="strong"><strong>Customer Posting Groups</strong></span>:</p><div class="mediaobject"><img alt="Posting groups" src="graphics/0365EN_03_12.jpg"/></div><p>We see three different codes with their own accounts. So where is this code used? Let's open <span class="strong"><strong>Customer Card</strong></span>:</p><div class="mediaobject"><img alt="Posting groups" src="graphics/0365EN_03_13.jpg"/></div><p>On the<a class="indexterm" id="id331"/> <span class="strong"><strong>Invoicing</strong></span> tab, we see the customer posting group. So this is what determines the customer G/L Accounts.</p><p>We also see other posting groups on <span class="strong"><strong>Customer Card</strong></span>. There is a <span class="strong"><strong>Gen. Bus. Posting Group</strong></span> and a <span class="strong"><strong>VAT Bus. Posting Group</strong></span>.</p><p>In our list, they are matrix layers. So they don't directly point to a G/L Account. When we open <span class="strong"><strong>Gen. Bus. Posting Group</strong></span>, we see this:</p><div class="mediaobject"><img alt="Posting groups" src="graphics/0365EN_03_14.jpg"/></div><p>Just a simple table connecting it to a <span class="strong"><strong>Default VAT Business Posting Group</strong></span>. To see where the G/L Accounts are defined, we need to go to the <span class="strong"><strong>General Posting Setup</strong></span>.</p><div class="mediaobject"><img alt="Posting groups" src="graphics/0365EN_03_15.jpg"/></div><p>Here we can see that, when combined with a <span class="strong"><strong>Gen. Prod. Posting Group</strong></span>, the G/L Accounts can be determined. So where does the <span class="strong"><strong>Gen. Prod. Posting Group</strong></span> come from? To find out, we need to go to <span class="strong"><strong>Item Card</strong></span>:</p><div class="mediaobject"><img alt="Posting groups" src="graphics/0365EN_03_16.jpg"/></div><p>Here we can see the same tab, <span class="strong"><strong>Invoicing</strong></span>, with the product posting groups.</p><p>Our journey ends here, as we can see the last matrix posting group, <span class="strong"><strong>Inventory</strong></span>. When we open this setup, we see that it is determined by the combination of <span class="strong"><strong>Inventory Posting Group</strong></span> and <span class="strong"><strong>Location Code</strong></span>:</p><div class="mediaobject"><img alt="Posting groups" src="graphics/0365EN_03_17.jpg"/></div></div><div class="section" title="Dimensions"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec57"/>Dimensions</h2></div></div></div><p>Apart <a class="indexterm" id="id332"/>from the general ledger and sub administrations, Microsoft Dynamics NAV allows a third level of posting. An unlimited number of dimensions can be attached to every posting and used to cross-analyze the system.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>Using more dimensions results in increased database activity during the processing of transactions and a more complex setup of the system. This should be carefully considered during the implementation.</p></div></div><p>Dimensions <a class="indexterm" id="id333"/>originated from the old project code and department code functionality, allowing you to consolidate or differentiate costs and profits. The dimensions are determined via a filtering mechanism. Every master data record can have dimension definitions.</p><p>Let's look at the sample dimension codes and values:</p><div class="mediaobject"><img alt="Dimensions" src="graphics/0365EN_03_18.jpg"/></div><p>The <span class="strong"><strong>Dimension Code Area</strong></span> has several <span class="strong"><strong>Dimension Values</strong></span>. Here, you can also have total records, just as in the general ledger.</p><p>When more than one master data record has the same dimension code with different values, it is able to set priorities. It is also possible to block combination of dimensions to be posted.</p><p>Dimensions are<a class="indexterm" id="id334"/> a powerful tool for analyzing data and structuring the system to avoid incorrect entries. However, it requires a lot of time and special skills to determine these combinations and maintain the setup.</p><p>We'll see more of dimensions as we discuss the reporting possibilities.</p></div><div class="section" title="Budgeting"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec58"/>Budgeting</h2></div></div></div><p>Microsoft Dynamics NAV <a class="indexterm" id="id335"/>allows <a class="indexterm" id="id336"/>budgeting as well. We can create our own budgeting codes. A budgeting code can be a year, or a department, or just some budget we want to try and throw away later.</p><p>Budgeting can be done on G/L Accounts but also on any dimension.</p><a class="indexterm" id="id337"/><p>The decision of budgeting periods is very important. If you want to compare monthly budgets with real figures, it does not make sense to create a yearly budget. Most companies use monthly budgets. It is also most likely that we want to create budgets for income statement accounts, not for balance sheets.</p><div class="mediaobject"><img alt="Budgeting" src="graphics/0365EN_03_19.jpg"/></div><p>Importing and exporting budgets to Excel is a very important feature. Here, we can easily copy and paste and, for example, automatically have the same values each month.</p><div class="section" title="Creating budget entries"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec20"/>Creating budget entries</h3></div></div></div><p>Budget entries <a class="indexterm" id="id338"/>are created by simply entering new amounts in the columns. In previous versions of Microsoft Dynamics NAV, a built-in mechanism would handle the creation of the entry based on deltas between the previous value and the newly entered value.</p><p>In Microsoft Dynamics NAV 2009, this was changed from the Role Tailored Client to C/AL Code. The <a class="indexterm" id="id339"/>matrix page object that handles the amount is Budget Matrix (9203). This page uses the Matrix Management Codeunit (9200) to simulate the classic built-in algorithms.</p></div></div><div class="section" title="Accounting periods"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec59"/>Accounting periods</h2></div></div></div><p>While most companies have<a class="indexterm" id="id340"/> accounting periods<a class="indexterm" id="id341"/> from January 1 to December 31 divided into months, there can be exceptions to this.</p><p>This is supported by Microsoft Dynamics NAV and set up in <span class="strong"><strong>Accounting Periods</strong></span>:</p><div class="mediaobject"><img alt="Accounting periods" src="graphics/0365EN_03_20.jpg"/></div><p>We are completely free to set up our own desired posting periods as long as there is a date algorithm.</p><div class="mediaobject"><img alt="Accounting periods" src="graphics/0365EN_03_21.jpg"/></div><p>A <a class="indexterm" id="id342"/>posting period <a class="indexterm" id="id343"/>should also be closed when appropriate. When closing a posting period, all Income Statement G/L Accounts are set to zero and the profit/loss is posted to a balance account.</p><div class="mediaobject"><img alt="Accounting periods" src="graphics/0365EN_03_22.jpg"/></div><p>When we <a class="indexterm" id="id344"/>run this batch, a general journal is populated with the postings. It is not recommended to make changes here.</p><div class="section" title="Closing dates"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec21"/>Closing dates</h3></div></div></div><p>After<a class="indexterm" id="id345"/> closing the income statement, it is still possible to<a class="indexterm" id="id346"/> make transactions but with special posting dates called closing dates. When putting a <span class="strong"><strong>C</strong></span> character in front of the posting date, the system will accept this as a special transaction and allow you to post it.</p><p> </p><div class="mediaobject"><img alt="Closing dates" src="graphics/0365EN_03_23.jpg"/></div><p>
</p><p>When filtering on <code class="literal">01-01-2013..31-12-2013</code>, the system will not include the entries on the closing dates. Filtering <a class="indexterm" id="id347"/>on <code class="literal">01-01-2013..C31-12-2013</code> and <code class="literal">01-01-2013..31-01-2014</code> will include the entries on the closing dates.</p></div></div><div class="section" title="Currencies"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec60"/>Currencies</h2></div></div></div><p>Besides<a class="indexterm" id="id348"/> having <a class="indexterm" id="id349"/>the possibility of the extra reporting currency, every transaction in Microsoft Dynamics NAV can have its own currency. The transaction is transformed into <a class="indexterm" id="id350"/>
<span class="strong"><strong>Local Currency</strong></span> (<span class="strong"><strong>LCY</strong></span>) with the current currency exchange rates.</p><p>Handling currency is simple, as long as the exchange rates do not change. After that, it can get complex. The exchange rate can change as often as you want but with a maximum of one per day. Before you consider implementing a daily change of exchange rates, you should look at the consequences.</p><p>When you change the currency exchange rate, everything in the system gets adjusted, which can lead to a huge number of transactions in your system. Changing the currency exchange rate requires the following two steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Enter new values. In our case, the new <span class="strong"><strong>USD</strong></span> rate in 2010 is <span class="strong"><strong>60</strong></span>:<div class="mediaobject"><img alt="Currencies" src="graphics/0365EN_03_24.jpg"/></div></li><li class="listitem">Implement the value and generate the entries.<div class="mediaobject"><img alt="Currencies" src="graphics/0365EN_03_25.jpg"/></div></li></ol></div></div><div class="section" title="Consolidation"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec61"/>Consolidation</h2></div></div></div><p>Consolidation<a class="indexterm" id="id351"/> means taking (part of) the general ledger<a class="indexterm" id="id352"/> of two or more companies together in one consolidated company. To handle consolidation in Microsoft Dynamics NAV, first the consolidation accounts have to be populated in the G/L Accounts. These consolidation accounts have to be valid accounts in the consolidation company.</p><p>A consolidation company is a "dummy" company in the database that just exists for consolidation purposes. The consolidation company has a business unit for each consolidated company.</p><p>The data can be exported out of the database via an XML or TXT format.</p><div class="mediaobject"><img alt="Consolidation" src="graphics/0365EN_03_26.jpg"/></div><p>The data is imported via the <span class="strong"><strong>Business Unit</strong></span> list in the consolidation company.</p><div class="mediaobject"><img alt="Consolidation" src="graphics/0365EN_03_27.jpg"/></div><p>The other option <a class="indexterm" id="id353"/>is to import it from within the database with the <span class="strong"><strong>Import Database</strong></span> function.</p></div><div class="section" title="VAT statement"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec62"/>VAT statement</h2></div></div></div><p>Most companies <a class="indexterm" id="id354"/>can issue VAT statements to get back the VAT <a class="indexterm" id="id355"/>they paid to vendors and pay the VAT they've received from customers. This is done in the VAT statement. This is a straightforward list where we can filter on the VAT entries.</p><div class="mediaobject"><img alt="VAT statement" src="graphics/0365EN_03_28.jpg"/></div><p>Every country<a class="indexterm" id="id356"/> has its own VAT statement and many countries have localizations in this application area.</p></div><div class="section" title="Data analysis"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec63"/>Data analysis</h2></div></div></div><p>Some<a class="indexterm" id="id357"/> companies <a class="indexterm" id="id358"/>do bookkeeping because it is mandatory and do very little with the generated information, but there is a lot you can do with the information the system creates.</p><p>In bigger companies, using analysis tools is often the only way to get a clear view on the company's assets.</p><div class="section" title="Chart of accounts"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec22000"/>Chart of accounts</h3></div></div></div><p>The <a class="indexterm" id="id359"/>chart of accounts<a class="indexterm" id="id360"/> is a reporting tool. The total accounts give a lot of information and by applying limit totals (flow filters), we can narrow down this information.</p><p> </p><div class="mediaobject"><img alt="Chart of accounts" src="graphics/0365EN_03_29.jpg"/></div><p>
</p><p>This <a class="indexterm" id="id361"/>example <a class="indexterm" id="id362"/>filters on G/L Account no. larger than or equal to 6000 and limits totals to 2014 and Department PROD.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip17"/>Tip</h3><p>You can save these views by clicking on the page name <span class="strong"><strong>Chart of Accounts</strong></span> and then <span class="strong"><strong>Save View As</strong></span>. By choosing a name that makes sense like Income Statement 2010 Production, it is easy to find.</p></div></div></div><div class="section" title="Account schedules"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec22"/>Account schedules</h3></div></div></div><p>For advanced <a class="indexterm" id="id363"/>reporting<a class="indexterm" id="id364"/> requirements, we can use the account schedules. Like the VAT statement, it allows us to filter on the G/L Entries in this case. We can filter on individual G/L Accounts or use the total filter. If the filter gets complex, we can sum individual rows and hide the source rows. We can also apply up to four dimensions to each account schedule.</p><div class="mediaobject"><img alt="Account schedules" src="graphics/0365EN_03_30.jpg"/></div><p>The account schedules<a class="indexterm" id="id365"/> also let you define your column layout. You can use multiple column layouts per schedule and reuse <span class="strong"><strong>Column Layouts</strong></span> across other schedules.</p><div class="mediaobject"><img alt="Account schedules" src="graphics/0365EN_03_31.jpg"/></div><p>The column layout can contain formulas and date filters. We can show either the budget or G/L Entries per column.</p><div class="mediaobject"><img alt="Account schedules" src="graphics/0365EN_03_32.jpg"/></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note07"/>Note</h3><p>For very valuable information on how to use account schedules, refer to <a class="ulink" href="http://dynamicsnavfinancials.com/">http://dynamicsnavfinancials.com/</a>
</p></div></div></div><div class="section" title="Analysis by dimensions"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec23"/>Analysis by dimensions</h3></div></div></div><p>As discussed <a class="indexterm" id="id366"/>earlier in this chapter, Microsoft Dynamics NAV allows an unlimited number of dimensions to be posted in the general ledger. To analyze this information, we need to tell the system what to compare. This is done in analysis by dimensions.</p><p>Each analysis <a class="indexterm" id="id367"/>view gets a unique code. An analysis view can be generated for an ad hoc requirement and thrown away afterwards or be in the system permanently for periodical reporting. Analysis views generate redundant information that can always be discarded and regenerated.</p><div class="mediaobject"><img alt="Analysis by dimensions" src="graphics/0365EN_03_33.jpg"/></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip18"/>Tip</h3><p>It is recommended to use a copy of the database on a separate system to use with analysis views and to update them during the night.</p></div></div><p>When updated, the <a class="indexterm" id="id368"/>analysis view contains all data within the filters in the analysis view entries. When not properly maintained, this can be a gigantic table with data.</p><p>The result of an analysis view can be viewed in a matrix where all values can be used as rows, columns, and filters.</p><div class="mediaobject"><img alt="Analysis by dimensions" src="graphics/0365EN_03_34.jpg"/></div><p>In this example, we <a class="indexterm" id="id369"/>view the results of a sales campaign per area and sales person.</p></div></div><div class="section" title="The setup"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec64"/>The setup</h2></div></div></div><p>Financial management <a class="indexterm" id="id370"/>has a single general ledger setup table, which <a class="indexterm" id="id371"/>is important as many of these setup fields will determine how the core of Microsoft Dynamics NAV behaves.</p><div class="mediaobject"><img alt="The setup" src="graphics/0365EN_03_35.jpg"/></div><p>We will discuss the setup options to find out what they do and to explore the possibilities of creating a flexible setup for an application:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Allow Posting From</strong></span> and <span class="strong"><strong>Allow Posting To</strong></span>: These<a class="indexterm" id="id372"/> limit the freedom of people to choose posting dates while posting<a class="indexterm" id="id373"/> to the general ledger. It is highly recommended to enable this feature to avoid posting dates like 01012090 instead of 01012009.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Register Time</strong></span>: This<a class="indexterm" id="id374"/> allows you to create an entry in the time register each time a user logs in and out.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Local Address Format</strong></span> and <span class="strong"><strong>Local Cont. Addr. Format</strong></span>: This refers to how the address should be<a class="indexterm" id="id375"/> printed for the <a class="indexterm" id="id376"/>local country. In Microsoft Dynamics NAV, it is best practice to leave <span class="strong"><strong>Country Code</strong></span> and <span class="strong"><strong>Currency Code</strong></span> blank for local values.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Inv. Rounding Precision (LCY)</strong></span> <a class="indexterm" id="id377"/>and <span class="strong"><strong>Inv. Rounding Type (LCY)</strong></span>: These define <a class="indexterm" id="id378"/>how the rounding on your invoices is calculated. <span class="strong"><strong>Nearest</strong></span> is a best practice and allows your customers to easily register your invoice in their system.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Allow G/L Acc Deletion Before</strong></span>: This <a class="indexterm" id="id379"/>allows you to clean up closed fiscal years. It is hardly ever used and you should consult your partner before using this feature.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Check G/L Account Usage</strong></span>: This<a class="indexterm" id="id380"/> checks whether the G/L Account is used in setup tables before it is deleted.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>EMU Currency</strong></span>: This<a class="indexterm" id="id381"/> is the currency that has a fixed conversion rate to the Euro in the European Union. The <span class="strong"><strong>LCY Code</strong></span> field is used when printing reports to indicate the companies' local currency.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Pmt. Disc. Excl. VAT</strong></span>: This<a class="indexterm" id="id382"/> indicates whether or not VAT is calculated when you apply payment discounts. When you check this field, you need to think about the <span class="strong"><strong>Adjust for Payment Disc.</strong></span> field, as this will recalculate the VAT.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Unrealized VAT</strong></span>: This <a class="indexterm" id="id383"/>should only be checked if your company has to deal with this issue. Otherwise, it will lead to unnecessary postings. This is VAT that is only valid when the customer pays the invoice rather than when the invoice is issued.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Prepayment Unrealized VAT</strong></span>: This<a class="indexterm" id="id384"/> should only be checked if your company handles <span class="strong"><strong>Unrealized VAT</strong></span> and if you want to implement this for the prepayment features.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Max. VAT Difference Allowed</strong></span>: This<a class="indexterm" id="id385"/> field determines the maximum amount of VAT differences. Most of the time, the VAT difference will be not more than 0, 01.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip19"/>Tip</h3><p>You can post VAT differences by selecting <span class="strong"><strong>FULL VAT</strong></span> in the <span class="strong"><strong>VAT Calculation Type</strong></span> for the VAT business posting group.</p></div></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>VAT Rounding Type</strong></span>: This <a class="indexterm" id="id386"/>determines how the VAT remainder is calculated. It recommended <span class="strong"><strong>Nearest</strong></span>.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Bill-to/Sell-to VAT Calc.</strong></span>: This<a class="indexterm" id="id387"/> allows you to change what the source for the VAT business posting group is, whether it is the Bill-to Customer or Sell-to Customer and Pay-to Vendor or Buy-from Vendor.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Print VAT specification</strong></span>: This<a class="indexterm" id="id388"/> field allows VAT on your invoices to always be in your local currency.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Bank Account Nos.</strong></span>: This<a class="indexterm" id="id389"/> is almost always number series that is manually determined. Most companies have up to 10 bank accounts.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Global Dimensions</strong></span>: This <a class="indexterm" id="id390"/>determines which dimensions are posted directly to the G/L Entries and sub administrations. These you can most often use when limiting totals and should be considered carefully.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Shortcut Dimensions</strong></span>: These <a class="indexterm" id="id391"/>are easier to access when you enter journals and documents. They can easily be switched later.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Additional Reporting Currency</strong></span>: This<a class="indexterm" id="id392"/> is a useful feature for international companies. Remember that it requires extra effort if the exchange rates change. You can change this later but a batch job will start, which might take a long time if you have a large database.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>VAT Exchange Rate Adjustment</strong></span>: This <a class="indexterm" id="id393"/>makes it possible to recalculate VAT if the reporting currency exchange rates changes. Think about this thoroughly before you activate it. It is most likely to generate information that is difficult to analyze and use.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Appln Rounding Precision</strong></span>: This can be <a class="indexterm" id="id394"/>used to allow rounding differences when applying different currencies.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Pmt. Disc. Tolerance Warning</strong></span>: This <a class="indexterm" id="id395"/>field when checked, a warning will appear whenever a difference is posted.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Pmt. Disc. Tolerance Posting</strong></span>: This <a class="indexterm" id="id396"/>determines if the payment tolerance amount is posted to a special account or to the normal discount account.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Payment Discount Grace Period</strong></span>: This <a class="indexterm" id="id397"/>can be used whether you want to be tolerant when people are one or two days late with their payment and still deduct the discount amount.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Payment Tolerance Warning</strong></span>: This <a class="indexterm" id="id398"/>option will show a warning whenever there is a tolerance amount posted to the general ledger.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Payment Tolerance Posting</strong></span>: This determines if a special G/L Account is used to post this amount.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Payment Tolerance %</strong></span>: This <a class="indexterm" id="id399"/>determines the tolerance percentage. To change this, a batch function is used that updates open entries.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Max. Payment Tolerance Amount</strong></span>: This<a class="indexterm" id="id400"/> field sets a maximum value to the amount so an invoice that is issued for 100.000 cannot have a tolerance amount of more than 5.000 if the percentage is set to 5 percent.</li></ul></div></div></div>
<div class="section" title="Customizing financial management"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec34"/>Customizing financial management</h1></div></div></div><p>As financial management<a class="indexterm" id="id401"/> is regulated by the government and the <a class="indexterm" id="id402"/>standard functionality is already very complete, this application area is unlikely to have many changes, even though we have some examples of where the functionality is changed.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>The examples in this chapter are included in the objects we used in <a class="link" href="ch02.html" title="Chapter 2. A Sample Application">Chapter 2</a>, <span class="emphasis"><em>A Sample Application</em></span>.</p></div></div><div class="section" title="Sales line description to G/L Entries"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec65"/>Sales line description to G/L Entries</h2></div></div></div><p>When we post <a class="indexterm" id="id403"/>a sales invoice, the system will generate the G/L Entries based on the sales lines. To avoid creating too many entries, they are compacted. This is done using a buffer table, the Invoice Post. Buffer:</p><div class="mediaobject"><img alt="Sales line description to G/L Entries" src="graphics/0365EN_03_36.jpg"/></div><p>Only for the combination of the preceding listed fields, a G/L Entry record is created. As we can see, the description is not one of these. This results in G/L Entries with the posting description of the sales header, which is often confusing for accountants when looking at the G/L Entries.</p><p>As an example, we will generate a sales invoice with one G/L Account line selling one of these books.</p><div class="mediaobject"><img alt="Sales line description to G/L Entries" src="graphics/0365EN_03_37.jpg"/></div><p>When we post this <a class="indexterm" id="id404"/>invoice, we will get these G/L Entries. Note that the description has gone.</p><div class="mediaobject"><img alt="Sales line description to G/L Entries" src="graphics/0365EN_03_38.jpg"/></div><p>To change this behavior, we have to change the <span class="strong"><strong>Invoice Post. Buffer</strong></span> table. The description field needs to be part of the unique combination since the grouping is done using a <code class="literal">FIND</code> command in the <code class="literal">UpdInvPostingBuffer</code> function<a class="indexterm" id="id405"/> in <code class="literal">Sales-Post Codeunit (80)</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>UpdInvPostingBuffer()</strong></span>
...
InvPostingBuffer[2] := InvPostingBuffer[1];
IF InvPostingBuffer[2].FIND THEN BEGIN
  InvPostingBuffer[2].Amount := 
    InvPostingBuffer[2].Amount + InvPostingBuffer[1].Amount;
  ...
  InvPostingBuffer[2].MODIFY;
END ELSE
  InvPostingBuffer[1].INSERT;</pre></div><p>This requires the<a class="indexterm" id="id406"/> following two steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We need to add the description field to the table.<div class="mediaobject"><img alt="Sales line description to G/L Entries" src="graphics/0365EN_03_39.jpg"/></div></li><li class="listitem">We need to add this new field to the key.<div class="mediaobject"><img alt="Sales line description to G/L Entries" src="graphics/0365EN_03_40.jpg"/></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip20"/>Tip</h3><p>A key in Microsoft Dynamics NAV can only contain 252 bytes, so be careful not to add too many fields to this table.</p></div></div></li></ol></div><p>When this is done, a <a class="indexterm" id="id407"/>change is required in populating the buffer table. This is done in the <code class="literal">PrepareSales</code> function<a class="indexterm" id="id408"/> in the table <code class="literal">Invoice Post. Buffer (49)</code> itself:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>PrepareSales()</strong></span>
CLEAR(Rec);
Type := SalesLine.Type;
"System-Created Entry" := TRUE;
...
"Job No." := SalesLine."Job No.";
"VAT %" := SalesLine."VAT %";
"VAT Difference" := SalesLine."VAT Difference";
//* Description &gt;&gt;&gt;
Description := SalesLine.Description;
//* Description &lt;&lt;&lt;
IF Type = Type::"Fixed Asset" THEN BEGIN
  ...
END;</pre></div><p>The last change<a class="indexterm" id="id409"/> we are going to make is in the posting routine of the sales documents. This is the Sales-Post codeunit (80) we discussed in <a class="link" href="ch02.html" title="Chapter 2. A Sample Application">Chapter 2</a>, <span class="emphasis"><em>A Sample Application</em></span>:</p><div class="informalexample"><pre class="programlisting">IF Invoice THEN BEGIN
  // Post sales and VAT to G/L entries from posting buffer
  LineCount := 0;
  IF InvPostingBuffer[1].FIND('+') THEN
    REPEAT
      LineCount := LineCount + 1;
      Window.UPDATE(3,LineCount);

      GenJnlLine.INIT;
      GenJnlLine."Posting Date" := "Posting Date";
      GenJnlLine."Document Date" := "Document Date";
//* Posting Description now from buffer table &gt;&gt;&gt;
//      GenJnlLine.Description := "Posting Description";
      GenJnlLine.Description :=
        InvPostingBuffer[1].Description;
//* Posting Description &lt;&lt;&lt;
      GenJnlLine."Reason Code" := "Reason Code";</pre></div><p>Instead of the posting description of the sales header, we will now use the new field in the buffer table. When we post the same invoice again, this is the changed result:</p><div class="mediaobject"><img alt="Sales line description to G/L Entries" src="graphics/0365EN_03_41.jpg"/></div><p>This makes it a lot easier to read the general ledger.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip21"/>Tip</h3><p>Making this change might cause our system to create more G/L Entries if we have large invoices with different descriptions. Creating extra G/L Entries takes more time during a posting routine, resulting in longer running posting transactions and a larger database.</p></div></div></div><div class="section" title="Extra fields in the G/L Entries"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec66"/>Extra fields in the G/L Entries</h2></div></div></div><p>Although the G/L Entry table<a class="indexterm" id="id410"/> has a lot of information, some companies want to add extra fields to it and populate these in the posting process.</p><p>For this example, we will use the database with the squash court application from <a class="link" href="ch02.html" title="Chapter 2. A Sample Application">Chapter 2</a>, <span class="emphasis"><em>A Sample Application</em></span>. For this business, it might be very useful to have the <span class="strong"><strong>Squash Court No.</strong></span> as a field in the G/L Entries to analyze.</p><p>The first step is to add the field to the G/L Entry table and make sure we have a table relation with the source table.</p><div class="mediaobject"><img alt="Extra fields in the G/L Entries" src="graphics/0365EN_03_42.jpg"/></div><p>We have learned that the G/L Entries are generated from the general journal so we need to add this field there as well. This can be done with copy and paste.</p><div class="mediaobject"><img alt="Extra fields in the G/L Entries" src="graphics/0365EN_03_43.jpg"/></div><p>The last step is to make sure we move the information from the journal to the ledger entry table. Like in our <a class="indexterm" id="id411"/>sample squash application, this is done in the <code class="literal">Gen. Jnl.-Post Line Codeunit (12)</code> only this codeunit has much more code.</p><p>We need to find the place where the G/L Entries are created and add our field there. This is done in the <code class="literal">InitGLEntry</code> function,<a class="indexterm" id="id412"/> as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>InitGLEntry()</strong></span>
...

GLEntry.INIT;
GLEntry."Posting Date" := GenJnlLine."Posting Date";
GLEntry."Document Date" := GenJnlLine."Document Date";
GLEntry."Document Type" := GenJnlLine."Document Type";
GLEntry."Document No." := GenJnlLine."Document No.";
...
GLEntry."Source Code" := GenJnlLine."Source Code";
//* Squash App. &gt;&gt;&gt;
GLEntry."Squash Court No." := GenJnlLine."Squash Court No.";
//* Squash App. &lt;&lt;&lt;
IF GenJnlLine."Account Type" = ...</pre></div><p>This is all that is required in Microsoft Dynamics NAV to add a field to the financial posting process. Of course, it does not make sense to do this unless we use it, so a logical next step could be to add this new field to the Invoice Post. Buffer table from our previous example.</p><p>This shows how easy it is to combine solutions in Microsoft Dynamics NAV.</p></div></div>
<div class="section" title="Integrating with financial management"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec35"/>Integrating with financial management</h1></div></div></div><p>Although <a class="indexterm" id="id413"/>it is not likely to make big changes in financial management, it might be necessary to create G/L Entries in a new posting routine.</p><p>In the previous chapter, we <a class="indexterm" id="id414"/>already pointed out briefly that during posting transactions in Microsoft Dynamics NAV, the actual journal line records are never really inserted in the database. They are used as temporary containers to hold the data during posting. Doing an actual <code class="literal">INSERT</code> would require defining a journal template name, journal batch name, and line no. and could cause locking in the database.</p><p>Let's create a new codeunit that will create a G/L transaction.</p><div class="section" title="Creating a G/L transaction"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec67"/>Creating a G/L transaction</h2></div></div></div><p>After <a class="indexterm" id="id415"/>creating the codeunit, we <a class="indexterm" id="id416"/>need<a class="indexterm" id="id417"/> to set up the two variables that are the minimum requirement to post something to the general ledger.</p><div class="mediaobject"><img alt="Creating a G/L transaction" src="graphics/0365EN_03_44.jpg"/></div><p>The preceding screenshot shows two variables:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>GenJnlLine</strong></span>: This<a class="indexterm" id="id418"/> is a reference to the <code class="literal">General Journal Line table (81)</code>.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>GenJnlPostLine</strong></span>: The <code class="literal">Gen. Jnl.-Post Line Codeunit (12)</code> creates<a class="indexterm" id="id419"/> the G/L Entries, the register, and the other financial entries.</li></ul></div><div class="section" title="The C/AL code"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec24"/>The C/AL code</h3></div></div></div><p>Creating a <a class="indexterm" id="id420"/>new G/L Entry requires some of mandatory fields. All the <a class="indexterm" id="id421"/>other fields in the general journal line are either optional for basic entries or mandatory in combination with more advanced postings, as we will find out later.</p><p>We will start by writing this code to the <code class="literal">OnRun</code> trigger, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>OnRun() </strong></span>
GenJnlLine.INIT;
GenJnlLine."Posting Date" := WORKDATE;
GenJnlLine.Description := 'Test Entry';
GenJnlLine."Document No." := 'PACKT';
GenJnlLine."Account No." := '6120';
GenJnlLine.Amount := 100;
GenJnlPostLine.RunWithCheck(GenJnlLine);</pre></div><p>If we execute this C/AL code, we will receive the following error message, which indicates that our transaction will result in an unbalanced chart of accounts:</p><div class="mediaobject"><img alt="The C/AL code" src="graphics/0365EN_03_45.jpg"/></div><p>We can fix <a class="indexterm" id="id422"/>this by creating a balance transaction for <code class="literal">-100</code> in the same <code class="literal">OnRun</code> trigger, as follows:</p><div class="informalexample"><pre class="programlisting">GenJnlLine.INIT;
GenJnlLine."Posting Date" := WORKDATE;
GenJnlLine.Description := 'Test Entry';
GenJnlLine."Document No." := 'PACKT';
GenJnlLine."Account No." := '6120';
GenJnlLine.Amount := -100;
GenJnlPostLine.RunWithCheck(GenJnlLine, TempJnlLineDim);</pre></div><p>After executing the codeunit, we can navigate on our document no. to see the G/L Entries we created:</p><div class="mediaobject"><img alt="The C/AL code" src="graphics/0365EN_03_46.jpg"/></div><p>This was a very <a class="indexterm" id="id423"/>simple example of how to integrate with financial management; let's create a more advanced example.</p></div><div class="section" title="Advanced entries"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec25"/>Advanced entries</h3></div></div></div><p>We will <a class="indexterm" id="id424"/>create a new customer ledger entry with dimensions. To do this, we should change one of the C/AL parts we created to the following code:</p><div class="informalexample"><pre class="programlisting">GenJnlLine.INIT;
GenJnlLine."Posting Date" := WORKDATE;
GenJnlLine.Description := 'Test Entry';
GenJnlLine."Document No." := 'PACKT2';
GenJnlLine."Account Type" := GenJnlLine."Account Type"::Customer;
GenJnlLine."Account No." := '10000';
GenJnlLine.Amount := 100;
GenJnlPostLine.RunWithCheck(GenJnlLine);</pre></div><p>But when we execute this C/AL code, we receive the following error message:</p><div class="mediaobject"><img alt="Advanced entries" src="graphics/0365EN_03_47.jpg"/></div><p>This means <a class="indexterm" id="id425"/>we need to implement dimensions. Let's add the following C/AL code to the routine:</p><div class="informalexample"><pre class="programlisting">...
GenJnlLine.Amount := 100;
GenJnlLine."Dimension Set ID" := 3;
GenJnlPostLine.RunWithCheck(GenJnlLine, TempJnlLineDim);</pre></div><p>This will use dimension set entry <code class="literal">3</code>, which contains the dimensions that are required for this transaction.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip22"/>Tip</h3><p>This article on MSDN at <a class="ulink" href="http://msdn.microsoft.com/en-us/library/jj552498(v=nav.71).aspx">http://msdn.microsoft.com/en-us/library/jj552498(v=nav.71).aspx</a> explains how dimension sets are used in the Microsoft Dynamics NAV 2013 architecture.</p></div></div><p>Now, when we navigate on <span class="strong"><strong>PACKT</strong></span>, we see that the system has created a <span class="strong"><strong>Customer Ledger</strong></span> entry and a <span class="strong"><strong>Detailed Cust. Ledg. Entry</strong></span>.</p><div class="mediaobject"><img alt="Advanced entries" src="graphics/0365EN_03_48.jpg"/></div></div></div><div class="section" title="Look, learn, and love"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec68"/>Look, learn, and love</h2></div></div></div><p>In Microsoft Dynamics NAV, there are many examples of how to integrate with financial management. The following is a list of interesting codeunits that create general journal lines:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">Sales-Post (80)</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Purch.-Post (90)</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Job Calculate WIP (1000)</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">CheckManagement (367)</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Sales-Post Prepayments (442)</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Inventory Posting To G/L (5802)</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Serv-Posting Journals Mgt. (5987)</code></li></ul></div><p>Go ahead and have a look inside these codeunits to learn how Microsoft does the integration.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec35000"/>Summary</h1></div></div></div><p>In this chapter, we looked at the financial heart of Microsoft Dynamics NAV. Understanding the flow of the entries is important as it is the way the posting groups are set up. It is important to regularly check whether the sub administrations are balanced with the general ledger.</p><p>The reporting possibilities offer great insight if the system is set up correctly. Be careful with changing the setup options on a running system.</p><p>In the next chapter, we will look at the opposite of this module; relationship management. While the financial management system is strict, relationship management system is flexible and expandable.</p></div></body></html>