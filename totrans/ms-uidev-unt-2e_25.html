<html><head></head><body>
<div><div><h1 class="chapter-number" id="_idParaDest-315"><a id="_idTextAnchor513" class="pcalibre pcalibre1 calibre6"/>20</h1>
<h1 id="_idParaDest-316" class="calibre5"><a id="_idTextAnchor514" class="pcalibre pcalibre1 calibre6"/>The New Input System</h1>
<p class="calibre3"><a id="_idTextAnchor515" class="pcalibre pcalibre1 calibre6"/>Unity’s <code>Update()</code> method to determine if a device received an input. This usually results in multiple if-else branches within your <code>Update()</code> method that control what happens for each input received.</p>
<p class="calibre3">The Input System divorces the handling of individual input devices from code by using an event-based programming methodology. Instead of having to create reference to each of your input devices within your code, you create code that reacts to specific actions. The Input System then controls which Interaction from which Input devices trigger these actions.</p>
<p class="calibre3">This separation of input handling and code allows you to make more customizable controls, more easily handle different Input Devices, and more easily handle controls from different consoles that have extremely different control schemes. Additionally, the modularity of the Input System allows you to easily copy your control schemes to other projects, since the information is all stored on an asset.</p>
<p class="calibre3">This chapter is meant to be an introduction to the Input System and will give you an overview of the key concepts so that you can start using the Input System within your projects.</p>
<p class="calibre3">In this chapter, I will discuss the following:</p>
<ul class="calibre16">
<li class="calibre14">How to install the Input System</li>
<li class="calibre14">The differences in polling vs subscribing</li>
<li class="calibre14">The basic elements involved with the Input System</li>
<li class="calibre14">How to write code that uses the Input System’s to control your game</li>
<li class="calibre14">How to convert a project that uses the old Input System (the Input Manager) to one that uses the new Input System</li>
<li class="calibre14">Two different ways to connect your Input System to your code</li>
</ul>
<p class="calibre3">Before we begin looking at how to work with the Input System, it needs to be imported into your project. Let’s look at how to do that.</p>
<h1 id="_idParaDest-317" class="calibre5"><a id="_idTextAnchor516" class="pcalibre pcalibre1 calibre6"/>Technical requirements</h1>
<p class="calibre3">You can find the asset files and codes of this chapter here: <a href="https://github.com/PacktPublishing/Mastering-UI-Development-with-Unity-2nd-Edition/tree/main/Chapter%2020" class="pcalibre pcalibre1 calibre6">https://github.com/PacktPublishing/Mastering-UI-Development-with-Unity-2nd-Edition/tree/main/Chapter%2020</a></p>
<h1 id="_idParaDest-318" class="calibre5"><a id="_idTextAnchor517" class="pcalibre pcalibre1 calibre6"/>Installing the Input System</h1>
<p class="calibre3">The Input System is<a id="_idIndexMarker1220" class="pcalibre pcalibre1 calibre6"/> no longer in preview and is officially part of Unity. However, it does not come pre-packaged in unity and must be installed. You can install the Input System into your Project via the Package Manager, by completing the following steps.</p>
<ol class="calibre13">
<li class="calibre14">Select <strong class="bold">Unity Registry</strong> from the dropdown menu.</li>
</ol>
<div><div><img alt="Figure 20.1: Changing the Package filter in the Package Manager" src="img/Figure_20.01_B18327.jpg" class="calibre666"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.1: Changing the Package filter in the Package Manager</p>
<ol class="calibre13">
<li value="2" class="calibre14">Search for the <strong class="bold">Input System</strong> in the list and select <strong class="bold">Install</strong>.</li>
</ol>
<div><div><img alt="Figure 20.2: Finding the Input System in the Package Manger" src="img/Figure_20.02_B18327.jpg" class="calibre667"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.2: Finding the Input System in the Package Manger</p>
<p class="calibre3">You will see the following pop up which you must agree to in order to proceed.</p>
<div><div><img alt="Figure 20.3: A Warning about changing input systems" src="img/Figure_20.03_B18327.jpg" class="calibre668"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.3: A Warning about changing input systems</p>
<p class="calibre3">The warning is <a id="_idIndexMarker1221" class="pcalibre pcalibre1 calibre6"/>indicating that any code you wrote using the old Input System will no longer function. This is a destructive action and may break your game.</p>
<p class="callout-heading">Note</p>
<p class="callout">I recommend you create a new project to explore the Input System as installing it may be destructive to your project. It will cause all code written using the Input Manager to cease functioning. Don’t install it in a pre-existing project until you are comfortable doing so.</p>
<p class="calibre3">Once you reopen your project, you may want to return to the Package Manager and install the various Samples provided by Unity with the Package. I recommend you install the Simple Demo and UI vs Game Input.</p>
<p class="calibre3">Since this is a new Input System, it does use a new methodology to access inputs than the old Input System. Let’s first discuss the differences in these methodologies before we begin looking<a id="_idIndexMarker1222" class="pcalibre pcalibre1 calibre6"/> at the various elements of the Input System.</p>
<h1 id="_idParaDest-319" class="calibre5"><a id="_idTextAnchor518" class="pcalibre pcalibre1 calibre6"/>Polling vs subscribing</h1>
<p class="calibre3">We discussed<a id="_idIndexMarker1223" class="pcalibre pcalibre1 calibre6"/> the Input Manager in <a href="B18327_08.xhtml#_idTextAnchor147" class="pcalibre pcalibre1 calibre6"><em class="italic">Chapter 8</em></a> and <a id="_idIndexMarker1224" class="pcalibre pcalibre1 calibre6"/>up until<a id="_idIndexMarker1225" class="pcalibre pcalibre1 calibre6"/> recently, it was the only way to track inputs from devices in a Unity-built game. When using the Input Manager, you assign specific Axes to different input actions. You then write a C# script that constantly checks to see if that action is performed.</p>
<div><div><img alt="Figure 20.4: C# script watching for specific inputs defined by the Input Manager" src="img/Figure_20.04_B18327.jpg" class="calibre669"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.4: C# script watching for specific inputs defined by the Input Manager</p>
<p class="calibre3">To accomplish this, your code would look something like the following pseudocode:</p>
<pre class="source-code">
void Update () {
     if (some input happened){
          do something
     }
}</pre> <p class="calibre3">This technique of requesting information at a regular interval, is <a id="_idIndexMarker1226" class="pcalibre pcalibre1 calibre6"/>called <strong class="bold">polling</strong>. You can use the polling pattern for accessing information from the Input System in a similar way that you could with the Input Manager. However, to make your code more modular, most of your code when using the Input <a id="_idIndexMarker1227" class="pcalibre pcalibre1 calibre6"/>System will use a <strong class="bold">publisher-subscriber </strong>(<strong class="bold">pub-sub</strong>) pattern.</p>
<p class="calibre3">Consider the following analogy: you really enjoy content from a specific YouTube content creator. You check their channel every day to see if they have released new content. However, you find this cumbersome and instead decide to subscribe to their channel. Now the YouTube channel will alert you whenever new content is posted, saving you the work. Imagine how much work you save yourself from if you had hundreds of YouTube channels you wanted to be updated on by subscribing to their channels<a id="_idIndexMarker1228" class="pcalibre pcalibre1 calibre6"/> instead <a id="_idIndexMarker1229" class="pcalibre pcalibre1 calibre6"/>of <a id="_idIndexMarker1230" class="pcalibre pcalibre1 calibre6"/>constantly checking in on them.</p>
<p class="calibre3">Let’s tie the analogy to coding. Instead of your C# script having to constantly check in on the various inputs in the <code>Update()</code> method, you can instead <strong class="bold">subscribe</strong> to specific events defined by the <strong class="bold">Input System</strong>. In more technical speak, you will write event subscriber methods that listen for specific events raised by the Input System.</p>
<div><div><img alt="Figure 20.5: C# script listening for specific events defined by the New Input System" src="img/Figure_20.05_B18327.jpg" class="calibre670"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.5: C# script listening for specific events defined by the New Input System</p>
<p class="calibre3">So, when using the New Input System, your code may look something like the following pseudocode:</p>
<pre class="source-code">
void OnEnable() {
     subscribe DoSomething() to the event
}
private DoSomething() {
     do something
}
void OnDisable() {
     unsubscribe DoSomething() from the event
}</pre> <p class="calibre3">The Input System will determine which events to call based on inputs you specify and your code will subscribe to those events, performing the appropriate functions whenever those events happen.</p>
<p class="calibre3">So, how do you tell the Input System which events to call based on which input? And what types <a id="_idIndexMarker1231" class="pcalibre pcalibre1 calibre6"/>of <a id="_idIndexMarker1232" class="pcalibre pcalibre1 calibre6"/>events can it call from those inputs? You <a id="_idIndexMarker1233" class="pcalibre pcalibre1 calibre6"/>do this through the use of Actions, Interactions, and Input Binding. Let’s explore these concepts now.</p>
<h1 id="_idParaDest-320" class="calibre5"><a id="_idTextAnchor519" class="pcalibre pcalibre1 calibre6"/>Input System elements</h1>
<p class="calibre3">In the Input<a id="_idIndexMarker1234" class="pcalibre pcalibre1 calibre6"/> Manager, you list various Axes and define what buttons can trigger these axes. In the Input System, you define a set of <strong class="bold">Actions</strong> and describe what <strong class="bold">Interactions</strong> the various <strong class="bold">Controls</strong> of the <strong class="bold">Input Device</strong> can trigger those Actions through <strong class="bold">Input Bindings</strong>.</p>
<p class="calibre3">For example, you could create the Input Binding that binds the Space Bar on a keyboard to a jump Action through a pressed Interaction, where the Input device would be the keyboard and the Controls would be all the keys on the keyboard.</p>
<div><div><img alt="Figure 20.6: An example of an Input Binding" src="img/Figure_20.06_B18327.jpg" class="calibre671"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.6: An example of an Input Binding</p>
<p class="calibre3">You can create<a id="_idIndexMarker1235" class="pcalibre pcalibre1 calibre6"/> these sets of <strong class="bold">Actions</strong> within what is known<a id="_idIndexMarker1236" class="pcalibre pcalibre1 calibre6"/> as an <strong class="bold">Action Map</strong>. Action Maps contain a list of Actions. The Actions contain the information about the Input Bindings. The general idea is to create Action Maps that contain groups of actions based on their purpose for example all character control Actions may go in one Action Map and all UI Actions may go in a separate one.</p>
<p class="calibre3">You can view your Action Maps, Actions, Bindings, and Interactions in the Action Editor. For example, here is<a id="_idIndexMarker1237" class="pcalibre pcalibre1 calibre6"/> the <code>Player</code> and <code>UI</code>.</p>
<div><div><img alt="Figure 20.7: The Action Editor" src="img/Figure_20.07_B18327.jpg" class="calibre672"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.7: The Action Editor</p>
<p class="calibre3">Within the <code>Player</code> Action<a id="_idIndexMarker1238" class="pcalibre pcalibre1 calibre6"/> Map, you can see the <code>Jump</code> Action, with the <code>Space [Keyboard] </code>Binding, and the <code>Press</code> Interaction.</p>
<p class="calibre3">To start creating your Actions and Action Maps, right click within an <code>Assets</code> folder and select <code>Inputs</code> within your <code>Assets</code> folder. When you do so, you should get something that looks like the following:</p>
<div><div><img alt="Figure 20.8: An Action Asset’s Inspector and icon representation" src="img/Figure_20.08_B18327.jpg" class="calibre673"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.8: An Action Asset’s Inspector and icon representation</p>
<p class="calibre3">You can either double click on the asset you just created or select <strong class="bold">Edit asset </strong>from its Inspector to view <a id="_idIndexMarker1239" class="pcalibre pcalibre1 calibre6"/>the Action Editor. The Action Editor will contain your list of Action Maps and Actions while displaying each of the Action’s properties.</p>
<div><div><img alt="Figure 20.9: The Action Editor of a newly created Action Asset" src="img/Figure_20.09_B18327.jpg" class="calibre674"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.9: The Action Editor of a newly created Action Asset</p>
<p class="calibre3">Selecting the <strong class="bold">+</strong> sign in the <strong class="bold">Action Maps</strong> section will create a new Action Map.</p>
<p class="calibre3">A new Action Map will automatically come with a <strong class="bold">New action</strong>, which you can rename.</p>
<div><div><img alt="Figure 20.10: An Action Map with its New action" src="img/Figure_20.10_B18327.jpg" class="calibre675"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.10: An Action Map with its New action</p>
<p class="calibre3">Selecting <strong class="bold">&lt;No Binding&gt;</strong> will allow you to create an Input Binding.</p>
<p class="calibre3">I will cover an example of how to select Binding and Interactions in the Examples section at the end of this <a id="_idIndexMarker1240" class="pcalibre pcalibre1 calibre6"/>chapter, but for now, let’s look at how you can hook these Actions to your code.</p>
<h1 id="_idParaDest-321" class="calibre5"><a id="_idTextAnchor520" class="pcalibre pcalibre1 calibre6"/>Connecting Actions to code</h1>
<p class="calibre3">There are multiple <a id="_idIndexMarker1241" class="pcalibre pcalibre1 calibre6"/>ways to work with the Input System’s <a id="_idIndexMarker1242" class="pcalibre pcalibre1 calibre6"/>Actions in your code. In this section, I will give a general overview of the most important topics that should allow you to get started working with the Input System.</p>
<p class="calibre3">To connect your Actions to your code, you will need to import the <code>InputSystem</code> with the following statement:</p>
<pre class="source-code">
using UnityEngine.InputSystem;</pre> <p class="calibre3">There are two ways in which I will discuss connecting Actions to your Code:</p>
<ul class="calibre16">
<li class="calibre14">Referencing the Action Asset</li>
<li class="calibre14">Using the <code>PlayerInput</code> component</li>
</ul>
<p class="callout-heading">Note</p>
<p class="callout">For more information about alternate ways you can connect Actions to your code, see the following Unity documentation:</p>
<p class="callout"><a href="https://docs.unity3d.com/Packages/com.unity.inputsystem@1.7/manual/Workflows.xhtml" class="pcalibre pcalibre1 calibre6">https://docs.unity3d.com/Packages/com.unity.inputsystem@1.7/manual/Workflows.xhtml</a></p>
<p class="calibre3">You can reference the Action Asset creating a variable of type <code>InputActionsAsset</code> like so:</p>
<pre class="source-code">
[SerializeField] private InputActionAsset actions;</pre> <p class="calibre3">You can then assign the value of <code>actions</code> in the Inspector.</p>
<p class="calibre3">And to reference the specific Action within a <code>InputActionAsset</code>, you could create a variable of type <code>InputAction</code>, like so:</p>
<pre class="source-code">
private InputAction playerAction;</pre> <p class="calibre3">You could then assign it by finding the specific Action Map and Action within the Action Asset, like so:</p>
<pre class="source-code">
playerMoveAction = actions.FindActionMap("Player").FindAction("Move");</pre> <p class="calibre3">Once you find the<a id="_idIndexMarker1243" class="pcalibre pcalibre1 calibre6"/> reference to the Action Asset, you<a id="_idIndexMarker1244" class="pcalibre pcalibre1 calibre6"/> will need to enable and disable the appropriate Action Maps. For Example, if you had an Action Map named <code>Player</code>, you could do the following:</p>
<pre class="source-code">
private void OnEnable()
{
    actions.FindActionMap("Player").Enable();
}
private void OnDisable()
{
    actions.FindActionMap("Player").Disable();
}</pre> <p class="calibre3">Once you have a reference to the <code>InputActionAsset</code>, you can have your methods subscribe to the various callbacks of the Action. Each Action has the following callbacks that you can subscribe to:</p>
<ul class="calibre16">
<li class="calibre14"><code>Performed</code>: The Action’s Interaction is complete</li>
<li class="calibre14"><code>Started</code>: The Action’s Interaction has started</li>
<li class="calibre14"><code>Waiting</code>: The Action is enabled and waiting for an Input to cause trigger an Interaction</li>
<li class="calibre14"><code>Canceled</code>: The Action’s Interaction has been canceled</li>
<li class="calibre14"><code>Disabled</code>: The Action cannot receive any input as it is disabled</li>
</ul>
<p class="calibre3">So, for example, you could subscribe to an Action named <code>Jump</code> on an Action Map named <code>Player</code> that is triggered by a button press with something like the following:</p>
<pre class="source-code">
actions.FindActionMap("Player").FindAction("Jump").performed += OnJump;</pre> <p class="calibre3">If you wish to poll<a id="_idIndexMarker1245" class="pcalibre pcalibre1 calibre6"/> the Actions rather than subscribe to <a id="_idIndexMarker1246" class="pcalibre pcalibre1 calibre6"/>the callback events, you use the <code>ReadValue&lt;TValue&gt;()</code> method like so:</p>
<pre class="source-code">
Vector2 moveVector = playerMoveAction.ReadValue&lt;Vector2&gt;();</pre> <p class="calibre3">If you’re not a big fan of writing code, you can instead use the <code>PlayerInput</code> component. The <code>PlayerInput</code> component will allow you to specify which methods in your C# scripts are called by the various Actions.</p>
<div><div><img alt="Figure 20.11: The default Player Input component" src="img/Figure_20.11_B18327.jpg" class="calibre676"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.11: The default Player Input component</p>
<p class="calibre3">Using this method vs directly referencing the Actions in your code is mostly up to preference. It takes less code, but it takes more Inspector work. As a programmer by trade, I personally prefer the method that references the Actions in code. I find it easier to debug, more customizable, and quicker to edit when there are multiple objects using Actions. However, when I am working on a project that has designers making changes in the Inspector, who don’t want to work in code, using the <code>PlayerInput</code> component is a good solution as it allows them to do things without me. You can also use a combination and it’s all based on your needs and preferences.</p>
<p class="callout-heading">Note</p>
<p class="callout">To learn more about the various ways you can access Actions with your code, see the following documentation:</p>
<p class="callout"><a href="https://docs.unity3d.com/Packages/com.unity.inputsystem@1.7/manual/Workflow-ActionsAsset.xhtml" class="pcalibre pcalibre1 calibre6">https://docs.unity3d.com/Packages/com.unity.inputsystem@1.7/manual/Workflow-ActionsAsset.xhtml</a></p>
<p class="calibre3">Now that we have<a id="_idIndexMarker1247" class="pcalibre pcalibre1 calibre6"/> a general idea of how the Unity <a id="_idIndexMarker1248" class="pcalibre pcalibre1 calibre6"/>Input System works, let’s look at some examples of how to work with it.</p>
<p class="calibre3">Examples</p>
<p class="calibre3">Now that we’ve <a id="_idIndexMarker1249" class="pcalibre pcalibre1 calibre6"/>reviewed the basics of getting started with the Input System, let’s look at some examples of how to implement it. We’ll look at one very basic example of a character controller. We’ll start with an example that uses the old Input Manager and then adjust it to use the Input System.</p>
<p class="callout-heading">Note</p>
<p class="callout">This is a super basic character controller. It is simplified to make the process of converting it to the Input System easier to understand.</p>
<p class="calibre3">The example we will use is just a cat that jumps and moves around.</p>
<div><div><img alt="Figure 20.12: The character controller example using the old Input System" src="img/Figure_20.12_B18327.jpg" class="calibre677"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.12: The character controller example using the old Input System</p>
<p class="calibre3">Before you begin these examples, complete the following steps:</p>
<ol class="calibre13">
<li class="calibre14">Create a new 2D Unity Project.</li>
<li class="calibre14">Import the <code>Chapter 20</code><code> – Example 1 - Start</code> Package provided by the book’s source code using <code>Chapter 20</code><code> – Example 1</code> to get a feel of how the cat moves around. It’s nothing fancy or particularly impressive, but the cat will jump with the space bar and move back and forth with the arrow keys and <em class="italic">A</em>- <em class="italic">D</em> keys.</p></li>
<li class="calibre14">Open the <code>InputManagerBasicCharacterController.cs</code> class and review the code. The key section of code is the <code>Update()</code> method:<pre class="source-code">
void Update()
{
    movement = Input.GetAxis("Horizontal");
    catRigidbody.velocity = new Vector2(speed * movement, catRigidbody.velocity.y);
    if (grounded &amp;&amp; Input.GetButtonDown("Jump"))
    {
        catRigidbody.AddForce(new Vector2(catRigidbody.velocity.x, jumpHeight));
    }
}</pre><p class="calibre3">Notice the use of <code>Input.GetAxis("Horizontal")</code> and <code>Input.GetButtonDown</code><strong class="source-inline">
("Jump")</strong> . These are defined within the Input Manager which you can find in <strong class="bold">Edit</strong> | <strong class="bold">Project Settings</strong> | <strong class="bold">Input Manager</strong>.</p></li> <li class="calibre14">Now that you’ve played the game. Install the Input System Package and restart when requested. See the <em class="italic">Installing the Input System</em> section for steps.<p class="calibre3">If you try to play the game now, you will see the following error in your console.</p><pre class="source-code">
InvalidOperationException: You are trying to read Input using the UnityEngine.Input class, but you have switched active Input handling to Input System package in Player Settings.
InputManagerBasicCharacterController.Update () (at Assets/Scripts/InputManagerBasicCharacterController.cs:20)</pre><p class="calibre3">This is because when we installed the Input System, the project stopped accepting inputs that use <code>UnityEngine.Input</code>. The cat will no longer move in response to our key presses.</p></li> </ol>
<p class="calibre3">Ok, now that we <a id="_idIndexMarker1251" class="pcalibre pcalibre1 calibre6"/>have our project started and set up, we can convert that code to something that can be used by the Input System! Let’s start by setting up our Actions.</p>
<h2 id="_idParaDest-322" class="calibre7"><a id="_idTextAnchor521" class="pcalibre pcalibre1 calibre6"/>Creating basic character controller Actions</h2>
<p class="calibre3">Before we start<a id="_idIndexMarker1252" class="pcalibre pcalibre1 calibre6"/> adjusting our code, we first have to set up our Action Map and Actions.</p>
<p class="calibre3">To set up your basic character controller Actions, complete the following steps:</p>
<ol class="calibre13">
<li class="calibre14">Create a new folder called <code>Inputs</code> within your <code>Assets</code> folder.</li>
<li class="calibre14">Right-click within the folder and select <strong class="bold">Create</strong> | <strong class="bold">Input Actions</strong>.</li>
<li class="calibre14">Rename the new Action Asset to <code>CatActions</code>.</li>
<li class="calibre14">Double-click <code>CatActions.inputActions</code> to open the Action Editor.</li>
<li class="calibre14">Check the <strong class="bold">Auto-Save</strong> box so that any changes you make will automatically save.</li>
</ol>
<div><div><img alt="Figure 20.13: Selecting Auto-Save" src="img/Figure_20.13_B18327.jpg" class="calibre678"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.13: Selecting Auto-Save</p>
<ol class="calibre13">
<li value="6" class="calibre14">Now we need to add an Action Map that will hold all the Actions for our character. Create a new Action Map by selecting the plus sign and then naming the Action<a id="_idIndexMarker1253" class="pcalibre pcalibre1 calibre6"/> Map <code>Player</code>. You should now see the following:</li>
</ol>
<div><div><img alt="Figure 20.14: The Player Action Map" src="img/Figure_20.14_B18327.jpg" class="calibre679"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.14: The Player Action Map</p>
<ol class="calibre13">
<li value="7" class="calibre14">Let’s create the <code>Jump</code> action by renaming <code>New action</code> to <code>Jump</code>. You can do so by double-clicking on the words <strong class="bold">New action</strong>. Notice that the <strong class="bold">Action Type</strong> is set to <strong class="bold">Button</strong>. This means the Jump Action will be triggered by button-like inputs.</li>
</ol>
<div><div><img alt="Figure 20.15: The Jump Action’s properties" src="img/Figure_20.15_B18327.jpg" class="calibre680"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.15: The Jump Action’s properties</p>
<ol class="calibre13">
<li value="8" class="calibre14">Click on the arrow next to the <code>Jump</code> Action to view all of its bindings. You should see <strong class="bold">&lt;</strong><strong class="bold">No Binding&gt;.</strong></li>
</ol>
<div><div><img alt="Figure 20.16: The Jump Action’s bindings" src="img/Figure_20.16_B18327.jpg" class="calibre681"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.16: The Jump Action’s bindings</p>
<ol class="calibre13">
<li value="9" class="calibre14">Click<a id="_idIndexMarker1254" class="pcalibre pcalibre1 calibre6"/> on <code>Space</code>, then select <strong class="bold">Space [Keyboard]</strong>. This will bind the spacebar on the keyboard to this Action. Notice it automatically names the binding for you.</li>
<li class="calibre14">Now let’s tell this binding what Interaction it can accept. Select the plus sign next to <strong class="bold">Interactions</strong> and select <strong class="bold">Press</strong> from the dropdown. Your Player Action Map should now look as follows:</li>
</ol>
<div><div><img alt="Figure 20.17: The Press Interaction on the Space [Keyboard] binding" src="img/Figure_20.17_B18327.jpg" class="calibre682"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.17: The Press Interaction on the Space [Keyboard] binding</p>
<ol class="calibre13">
<li value="11" class="calibre14">Now we want to add the Action that will be bound to the keys that were previously referenced by <code>"Horizontal" </code>in the Input Manager. Select the plus sign next to <code>Move</code>.</li>
<li class="calibre14">Set its <strong class="bold">Action Type</strong> to <strong class="bold">Value</strong> and its <strong class="bold">Control Type</strong> to <strong class="bold">Vector2</strong>.</li>
<li class="calibre14">Now we <a id="_idIndexMarker1255" class="pcalibre pcalibre1 calibre6"/>need to add the key bindings. Select the plus sign next to the <code>Move</code> Action and you’ll notice, since we set <code>Move</code> as a different Action Type than <code>Jump</code>, it has different <strong class="bold">Binding Options</strong>. Select <strong class="bold">Add Up\Down\Left\Right Composite</strong>. You should now see the following:</li>
</ol>
<div><div><img alt="Figure 20.18: The 2D vector bindings" src="img/Figure_20.18_B18327.jpg" class="calibre683"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.18: The 2D vector bindings</p>
<ol class="calibre13">
<li value="14" class="calibre14">Delete the <strong class="bold">Up</strong> and <strong class="bold">Down</strong> Bindings as well as the one marked <strong class="bold">&lt;No Binding&gt;</strong>, because we do not need<a id="_idIndexMarker1256" class="pcalibre pcalibre1 calibre6"/> them. You can do this by right-clicking on them and selecting <strong class="bold">Delete</strong>.</li>
<li class="calibre14">Select <code>Left Arrow</code> in the <strong class="bold">Path</strong> to find <strong class="bold">Left </strong><strong class="bold">Arrow [Keyboard]</strong>.</li>
<li class="calibre14">Select <code>Right Arrow</code> in the <strong class="bold">Path</strong> to find <strong class="bold">Right Arrow [Keyboard]</strong>. You should now have the following Actions and Bindings.
<div><div><img alt="Figure 20.19: The Left and Right Bindings" src="img/Figure_20.19_B18327.jpg" class="calibre684"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.19: The Left and Right Bindings</p>
<p class="calibre3">We have now bound our arrow keys to the move action.</p></li>
</ol>
<ol class="calibre13">
<li value="17" class="calibre14">Now we need to bind the <em class="italic">A</em> and <em class="italic">D</em> keys. Duplicate the <strong class="bold">Left: Left Arrow [Keyboard] </strong>and <strong class="bold">Right: Right Arrow [Keyboard]</strong> bindings by right clicking them and selecting <strong class="bold">Duplicate</strong>.</li>
<li class="calibre14">Select the duplicate <code>a keyboard</code> into the <strong class="bold">Path</strong> to find <strong class="bold">A [Keyboard]</strong>.</li>
<li class="calibre14">Select the duplicate <code>d keyboard</code> into the <strong class="bold">Path</strong> to find <strong class="bold">D [Keyboard]</strong>. You should now see the following<a id="_idIndexMarker1257" class="pcalibre pcalibre1 calibre6"/> Actions and Bindings:</li>
</ol>
<div><div><img alt="Figure 20.20: All the necessary Actions and Bindings" src="img/Figure_20.20._B18327.jpg" class="calibre685"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.20: All the necessary Actions and Bindings</p>
<p class="calibre3">Now that we’re done hooking up our Actions, we can start using them with our code! I’ll show you two ways <a id="_idIndexMarker1258" class="pcalibre pcalibre1 calibre6"/>to do this: with the <code>PlayerInput</code> Component and by referencing the Action in our script.</p>
<h2 id="_idParaDest-323" class="calibre7"><a id="_idTextAnchor522" class="pcalibre pcalibre1 calibre6"/>Creating a basic character controller with the PlayerInput Component</h2>
<p class="calibre3">Switching our<a id="_idIndexMarker1259" class="pcalibre pcalibre1 calibre6"/> code to use Actions and the <code>PlayerInput</code> component, requires a bit of code adjustment and some Inspector work.</p>
<p class="calibre3">To use Actions with the <code>PlayerInput</code> Component, complete the following steps:</p>
<ol class="calibre13">
<li class="calibre14">To preserve the previous example, I am going to duplicate the scene and call it <code>Chapter 20</code><code> – Example 2</code>; duplicate the <code>InputManagerBasicCharacterController.cs</code> script; and rename the duplicate to <code>PlayerInputBasicCharacterController.cs.</code> If you’d rather just work in the same scene with the same script, you can skip this step. However, if you do want to do this, make sure to also change the name of the script in the class definition and add the script as a component to the <code>Cat</code> in your new scene.</li>
<li class="calibre14">Let’s start by adjusting the script. We’ll be removing the code within the <code>Update()</code> method that checks for the Input Axes and instead use public methods that can be hooked up in the Inspector. Comment out all the code within the <code>Update()</code> method. Don’t delete it, b/c we’ll cut and paste some of it to other methods later.</li>
<li class="calibre14">Add the<a id="_idIndexMarker1260" class="pcalibre pcalibre1 calibre6"/> following statement to the top of your script:<pre class="source-code">
using UnityEngine.InputSystem;</pre></li> <li class="calibre14">Create a new method called <code>OnJump()</code>. This will be the method that is called when the <code>Jump</code> Action is triggered. It should look as follows:<pre class="source-code">
public void OnJump(InputAction.CallbackContext context) {
}</pre></li> <li class="calibre14">We want our <code>OnJump()</code> method to perform similarly to the following statement we have commented out in our <code>Update()</code> method.<pre class="source-code">
if (grounded &amp;&amp; Input.GetButtonDown("Jump"))
{
    catRigidbody.AddForce(new Vector2(catRigidbody.velocity.x, jumpHeight));
}</pre><p class="calibre3">Cut and paste it into the <code>OnJump()</code> method.</p></li> <li class="calibre14">Remove <code>&amp;&amp; Input.GetButtonDown("Jump")</code> from the <code>if</code> statement. Your <code>OnJump()</code> method should now appear as follows:<pre class="source-code">
public void OnJump(InputAction.CallbackContext context) {
        if (grounded) {
            catRigidbody.AddForce(new Vector2(catRigidbody.velocity.x, jumpHeight));
        }
}</pre></li> <li class="calibre14">Now let’s hook this method up in the Inspector. Select your <code>Cat</code> from the Hierarchy and add the <code>PlayerInput</code> Component. Your Cat’s Inspector should have the<a id="_idIndexMarker1261" class="pcalibre pcalibre1 calibre6"/> following components:</li>
</ol>
<div><div><img alt="Figure 20.21: Some of the components on Cat" src="img/Figure_20.21._B18327.jpg" class="calibre686"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.21: Some of the components on Cat</p>
<ol class="calibre13">
<li value="8" class="calibre14">Now let’s add our Actions to the <code>CatActions</code> from the Project folder into the <strong class="bold">Actions</strong> slot. Your component should now look as follows:
<div><div><img alt="Figure 20.22: Assigning CatActions to the PlayerInput component" src="img/Figure_20.22._B18327.jpg" class="calibre687"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.22: Assigning CatActions to the PlayerInput component</p>
<p class="calibre3">Notice it<a id="_idIndexMarker1262" class="pcalibre pcalibre1 calibre6"/> already found our <strong class="bold">Player</strong> Action Map and added it as the <strong class="bold">Default Map</strong>. If we had more Action Maps, there would be others in the dropdown we could choose from.</p></li>
</ol>
<ol class="calibre13">
<li value="9" class="calibre14">From the <strong class="bold">Behavior</strong> dropdown, select <strong class="bold">Invoke Unity Events</strong>. This will add an <strong class="bold">Events</strong> setting that can be expanded to reveal a list of <strong class="bold">Player</strong> Events. Expanding <strong class="bold">Player</strong> will show the two Actions we have defined within the Player Map along with some other useful Actions.</li>
</ol>
<div><div><img alt="Figure 20.23: The Various Player Action Events" src="img/Figure_20.23._B18327.jpg" class="calibre688"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.23: The Various Player Action Events</p>
<ol class="calibre13">
<li value="10" class="calibre14">We can hook <a id="_idIndexMarker1263" class="pcalibre pcalibre1 calibre6"/>up our <code>OnJump()</code> method to the <code>Cat</code> into the Object slot, and then selecting <strong class="bold">PlayerInputBasicCharacterController</strong> | <strong class="bold">OnJump</strong>. Your <strong class="bold">Jump</strong> Event should now appear as follows:
<div><div><img alt="Figure 20.24: The Player Jump Event calling our OnJump method" src="img/Figure_20.24._B18327.jpg" class="calibre689"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.24: The Player Jump Event calling our OnJump method</p>
<p class="calibre3">Play the game and you should see the cat jump when you press the spacebar.</p>
</li>
</ol><ol class="calibre13">
<li value="11" class="calibre14">Now let’s hook up the Move Action. Return to your code and create the following method:<pre class="source-code">
public void OnMove(InputAction.CallbackContext context) {¶}</pre></li> <li class="calibre14">Add the following variable declaration to your code:<pre class="source-code">
private Vector2 moveVector = new Vector2();</pre></li> <li class="calibre14">When we <a id="_idIndexMarker1264" class="pcalibre pcalibre1 calibre6"/>got the <code>movement</code> variable from the Input Axis, we used the following line:<pre class="source-code">
movement = Input.GetAxis("Horizontal");
moveVector = context.ReadValue&lt;Vector2&gt;();</pre><p class="calibre3">This will get the value of the Move Action whenever the <code>OnMove()</code> method is called.</pre></li> <li class="calibre14">Return to your <code>Update()</code> method and uncomment the remaining code. Your <code>Update()</code> method should appear as follows:<pre class="source-code">
void Update()
{
    movement = Input.GetAxis("Horizontal");
    catRigidbody.velocity = new Vector2(speed * movement, catRigidbody.velocity.y);
}</pre></li> <li class="calibre14">Delete the following line that uses the old Input System.<pre class="source-code">
Movement = Input.GetAxis("Horizontal");</pre></li> <li class="calibre14">Edit the remaining line to use the <code>moveVector</code> instead of the movement float.<pre class="source-code">
catRigidbody.velocity = new Vector2(speed * moveVector.x, catRigidbody.velocity.y);</pre></li> <li class="calibre14">Remove the <code>movement</code> float variable declaration since we no longer need it.</li>
<li class="calibre14">Return to your Inspector and add the <code>OnMove() </code>method to the <code>Cat</code> into the <a id="_idIndexMarker1265" class="pcalibre pcalibre1 calibre6"/>Object slot, and then selecting <strong class="bold">PlayerInputBasicCharacterController</strong> | <strong class="bold">OnMove</strong>. Your Move Event should now appear as follows:</li>
</ol>
<div><div><img alt="Figure 20.25: The Player Move Event calling our OnMove method" src="img/Figure_20.25._B18327.jpg" class="calibre690"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 20.25: The Player Move Event calling our OnMove method</p>
<p class="calibre3">Play the game and your cat should now be able to move and jump!</p>
<p class="calibre3">Personally, I’m not a fan of using the <code>PlayerInput</code> component. Since I am a programmer by trade, I prefer to spend most of my time in my code editor rather than the Unity Editor. I find debugging code that is hooked up in the inspector difficult to debug. When I do use this functionality, I try to make life easier for my future self (or my other programming coworkers) by adding comments to the code that states what components call what methods. This can make debugging and understanding the way the code works a little easier. Using a code editor like Jetbrains Rider can relieve some of this stress, as it will indicate where code is hooked up in the Inspector, but it does not always show all necessary information and you can’t count on your coworkers also having the <a id="_idIndexMarker1266" class="pcalibre pcalibre1 calibre6"/>Rider IDE. If you have a similar preference, I will show you in the next example how to do this in a code-centric way.</p>
<h2 id="_idParaDest-324" class="calibre7"><a id="_idTextAnchor523" class="pcalibre pcalibre1 calibre6"/>Creating a basic character controller by referencing Actions in your code</h2>
<p class="calibre3">To redo <a id="_idIndexMarker1267" class="pcalibre pcalibre1 calibre6"/>our previous example so that it references the Actions in code, complete the following steps:</p>
<ol class="calibre13">
<li class="calibre14">To preserve the previous example, I am going to duplicate the scene and call it <code>Chapter 20</code><code> – Example 3</code>; duplicate the <code>PlayerInputBasicCharacterController.cs</code> script; and rename the duplicate to <code>ActionReferenceBasicCharacterController.cs</code>. If you’d rather just work in the same scene with the same script, you can skip this step. However, if you do want to do this, make sure to also change the name of the script in the class definition and add the script as a component to the <code>Cat</code> in your new scene.</li>
<li class="calibre14">Delete the <code>Cat</code>’s Inspector. Notice if you try to play the game now, the cat will not move or jump, since we removed the component that tied the inputs to our code.</li>
<li class="calibre14">Open the <code>ActionReferenceBasicCharacterController.cs</code> script.</li>
<li class="calibre14">Comment out the <code>OnMove()</code> method. We will not be calling this via an Event in the Inspector, so we do not need the method. However, we will write code similar to it, so I’ll comment it out for now so I can copy and paste it into the correct place later.</li>
<li class="calibre14">The first thing we need to do is get a reference to the Action Asset that holds all of our Actions. Create the following variable declaration:<pre class="source-code">
[SerializeField] private InputActionAsset actions;</pre></li> <li class="calibre14">We can go ahead and hook this up in the Inspector by dragging the <code>CatActions</code> asset into the <strong class="bold">Actions</strong> slot.</li>
<li class="calibre14">Return to the script. Add an empty <code>OnEnable()</code> method and <code>OnDisable()</code> method to <a id="_idIndexMarker1268" class="pcalibre pcalibre1 calibre6"/>your script. We’ll add some code to them momentarily.<p class="calibre3">I prefer to put the <code>OnEnable()</code> method right under the <code>Awake()</code> method since it executes after it and the <code>OnDisable()</code> method at the bottom of the script since it will execute after all of our other methods.</p></li>
<li class="calibre14">Since we are referencing our Actions via code, we will need to enable and disable our Action Map. Add the following boldened lines of code to your <code>OnEnable()</code> and <code>OnDisable()</code> methods.<pre class="source-code">
private void OnEnable()
{
    actions.FindActionMap("Player").Enable();
}
private void OnDisable()
{
    actions.FindActionMap("Player").Disable();
}</pre></li> <li class="calibre14">Now let’s hook up our Jump Action. We will accomplish this by subscribing to the Jump Action’s <code>performed</code> event. Add the following code to your <code>OnEnable()</code> method.<pre class="source-code">
actions.FindActionMap("Player").FindAction("Jump").performed += OnJump;</pre><p class="calibre3">This should be enough to get the <code>OnJump()</code> method we already wrote working with your Action Map. Play the game and you can now see the cat jump when you press the space bar.</p></li> <li class="calibre14">While not entirely necessary for this example, I prefer to make a habit of always unsubscribing from any events I subscribe to in <code>OnDisable()</code>. Making a habit of doing it will save me from problems in the future when it is necessary. So, add the following line of code to the top of your <code>OneDisable()</code> method:<pre class="source-code">
actions.FindActionMap("Player").FindAction("Jump").performed -= OnJump;</pre></li> <li class="calibre14">Now let’s hook up our Move Action. To do this, we can create a reference to the <code>InputAction</code> that represents the Move Action to make it easily accessible via code. Add the <a id="_idIndexMarker1269" class="pcalibre pcalibre1 calibre6"/>following variable declaration to the top of your code:<pre class="source-code">
private InputAction playerMoveAction;</pre></li> <li class="calibre14">Now let’s initialize it. Add the following line of code to your <code>OnEnable()</code> method.<pre class="source-code">
playerMoveAction = actions.FindActionMap("Player").FindAction("Move");</pre></li> <li class="calibre14">Instead of subscribing to the Move Action, we’ll poll it in our <code>Update()</code> method. Cut and paste the following code from within your commented out <code>OnMove()</code> method to the top of your <code>Update()</code> method. You can delete the <code>OnMove()</code> method now.<pre class="source-code">
moveVector = context.ReadValue&lt;Vector2&gt;();</pre></li> <li class="calibre14">You will get an error on the <code>context</code> variable. It was a parameter for the <code>OnMove()</code> method and does not exist within the <code>Update()</code> method. Instead of reading the value of <code>context</code>, we will read the value of <code>playerMoveAction</code>. Replace <code>context</code> with <code>playerMoveAction</code> so that your <code>Update()</code> method appears as follows:<pre class="source-code">
void Update()
{
    moveVector = playerMoveAction.ReadValue&lt;Vector2&gt;();
    catRigidbody.velocity = new Vector2(speed * moveVector.x, catRigidbody.velocity.y);
}</pre><p class="calibre3">And that should be sufficient to get our cat moving with Actions and without the <code>PlayerInput</code> component. Play the game and watch the cat move around and jump when you press the appropriate keys.</p></li> </ol>
<p class="calibre3">I know that setting our specific project up to use the Input System rather than using the Input Manager was a lot more work and may not seem worth it. And for this tiny example, that is probably true. However, if we wanted to create a cross platform version of this project that accepted inputs from multiple types of devices, adding new Bindings to an Action within<a id="_idIndexMarker1270" class="pcalibre pcalibre1 calibre6"/> an Action Map is significantly less work than adding in a new line of code for each possible input configura<a id="_idTextAnchor524" class="pcalibre pcalibre1 calibre6"/>tion we want to work with.</p>
<h1 id="_idParaDest-325" class="calibre5"><a id="_idTextAnchor525" class="pcalibre pcalibre1 calibre6"/>Summary</h1>
<p class="calibre3">In this chapter, we covered how to use the New Input System to collect input for your game. This allows us to make an easily customizable input system that can make controlling our game via various input devices significantly easier in the long run. It may take a bit if set work to set up, but it can save you a lot of effort in the long run.</p>
<p class="calibre3">And so, we come to an end of the book! I have no more User Interface knowledge to impart to you.</p>
</div>
</div></body></html>