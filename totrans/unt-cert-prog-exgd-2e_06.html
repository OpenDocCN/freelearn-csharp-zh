<html><head></head><body>
		<div><h1 id="_idParaDest-118"><em class="italic"><a id="_idTextAnchor120"/>Chapter 6</em>: Purchasing In-Game Items and Advertisements</h1>
			<p>In this chapter, we will continue with building our shop scene by adding functionality such as introducing the player's in-game currency and looking at how to deduct and increase it. </p>
			<p>Monetization is when a game is free to download (typically titled <strong class="bold">free-to-play</strong>) and the developer encourages or offers the player to buy items, such as the latest weapon, extra art modification visuals, and more, with the player's real money (with a bank/debit card). Another way of creating profit from a free-to-play game is by offering adverts that are incorporated into the game. For example, if the player wants a new ship or an extra life, they can watch a 30-second advert at no real monetary cost to them, but as the developer, we can receive revenue when an advert is watched. Of course, a balance must be considered when a game is made, and some companies will use all sorts of addictive psychology to encourage the player to buy upgrades or watch as many adverts as possible. This could lead a single player to sometimes pay well into the thousands of their real money. It is up to you how you want to plan and make your own game outside of this book; but for this chapter, we will create our own shop that offers players the chance to watch an advert to gain extra in-game credits.</p>
			<p>We will cover the following topics in this chapter:</p>
			<ul>
				<li>Buying upgrades for our player's ship</li>
				<li>Buying items, watching adverts, and preparing to start a game</li>
				<li>Extending the <code>PlayerSpawner</code> script</li>
			</ul>
			<p>By the end of this chapter, we will understand the process of when to trigger an advert and how we can reward the player, while giving constant feedback. We will make use of the asset store and Unity's online dashboard system.</p>
			<p>Let's get started!</p>
			<h1 id="_idParaDest-119"><a id="_idTextAnchor121"/>The core exam skills covered in this chapter</h1>
			<p><em class="italic">We will cover programming core interactions in this chapter</em>:</p>
			<ul>
				<li>Implementing and configuring game object behavior and physics</li>
				<li>Implementing and configuring inputs and controls</li>
			</ul>
			<p><em class="italic">We will also cover developing application systems</em>:</p>
			<ul>
				<li>Interpreting scripts for the application interface flow, such as menu systems, UI navigation, and application settings</li>
				<li>Interpreting scripts for user-controlled customization, such as character creators, inventories, storefronts, and in-app purchases</li>
				<li>Analyzing scripts for user progression features, such as scoring, leveling, and in-game economies, utilizing technologies such as Unity Analytics and PlayerPrefs</li>
				<li>Analyzing scripts for two-dimensional overlays, such as <strong class="bold">Heads-Up Displays</strong> (<strong class="bold">HUDs</strong>), minimaps, and advertisements</li>
				<li>Identifying scripts for saving and retrieving application and user data</li>
			</ul>
			<p><em class="italic">We will also cover programming for scene and environment design</em>:</p>
			<ul>
				<li>Identifying methods for implementing game object instantiation, destruction, and management</li>
			</ul>
			<p><em class="italic">Finally, we will cover working in professional software development teams</em>:</p>
			<ul>
				<li>Recognizing techniques for structuring scripts for modularity, readability, and reusability</li>
			</ul>
			<h1 id="_idParaDest-120"><a id="_idTextAnchor122"/>Technical requirements</h1>
			<p>The project content for this chapter can be found at <a href="https://github.com/PacktPublishing/Unity-Certified-Programmer-Exam-Guide-Second-Edition/tree/main/Chapter_06">https://github.com/PacktPublishing/Unity-Certified-Programmer-Exam-Guide-Second-Edition/tree/main/Chapter_06</a>.</p>
			<p>You can download the entirety of each chapter's project files at <a href="https://github.com/PacktPublishing/Unity-Certified-Programmer-Exam-Guide-Second-Edition">https://github.com/PacktPublishing/Unity-Certified-Programmer-Exam-Guide-Second-Edition</a>.</p>
			<p>All of the content for this chapter is held in the chapter's <code>unitypackage</code> file. There is no <code>Complete</code> folder for this chapter.</p>
			<p>Check out the following video to see the <em class="italic">Code in Action</em>: <a href="https://bit.ly/3MASWFJ">https://bit.ly/3MASWFJ</a>.</p>
			<h1 id="_idParaDest-121"><a id="_idTextAnchor123"/>Buying upgrades for our player's ship</h1>
			<p>In this section, we will<a id="_idIndexMarker577"/> cover the process of buying upgrades for our player's ship. This includes the following:</p>
			<ul>
				<li>Credit balance</li>
				<li>Option to buy</li>
				<li>Letting the player know the item has been sold</li>
			</ul>
			<p>The following screenshot shows our shop scene with its selection grid and two purchased items marked as <strong class="bold">SOLD</strong>. Above the selection grid, to the left, is the user's current in-game bank balance and an image showing what the player's ship currently looks like with the two upgrades applied. Lastly, to the right is the option to buy the currently selected item, which is <strong class="bold">C. Bomb</strong>:</p>
			<div><div><img src="img/Figure_6.01_B18381.jpg" alt="Figure 6.1 – Our shop scene with currency, a sold sign, and an option to buy&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.1 – Our shop scene with currency, a sold sign, and an option to buy</p>
			<p>In this section, we will return to the script that is responsible for purchasing upgrades and applying them to the player's ship. In the <code>PlayerShipBuild</code> script, we will add global variables that will hold the player's weapon upgrades in an array, as well as game object buttons and the player's in-bank balance.</p>
			<p>We will then hook up each of these new variables to the text and game object buttons in our scene<a id="_idIndexMarker578"/> and from there, we will add our own methods to turn buttons on or off and to determine whether the player has enough in-game credits to make purchases.</p>
			<p>Let's start by entering these new variables into our shop scene by going to the <code>PlayerShipBuild</code> script in the <code>Assets/Script</code> folder:</p>
			<ol>
				<li>Enter the following variables to our <code>PlayerShipBuild</code> script:<pre>[SerializeField]
GameObject[] visualWeapons;
[SerializeField]
SOActorModel defaultPlayerShip;
GameObject playerShip;
GameObject buyButton;
GameObject bankObj;
int bank = 600;
bool purchaseMade = false;</pre></li>
			</ol>
			<p>We have mainly added game objects that hold the visualization of our shop scene, but we have also added a scriptable object that's used to give the player's ship its own property values, such as speed, health, what type of bullets are used, and more. We will make use of some of these variables in the next code block.</p>
			<ol>
				<li value="2">Next, we will update the <code>PlayerShipBuild</code> script by adding code to the <code>Start</code> function<a id="_idIndexMarker579"/> by getting a reference to the bank game object and the <strong class="bold">BUY?</strong> button in our shop scene:<pre>purchaseMade = false;
bankObj = GameObject.Find("bank");
bankObj.GetComponentInChildren&lt;TextMesh&gt;().text = bank.ToString();
buyButton = textBoxPanel.transform.Find("BUY ?").gameObject;
TurnOffPlayerShipVisuals();
PreparePlayerShipForUpgrade();</pre></li>
			</ol>
			<p>This code resets or assigns the variables to game objects in the <strong class="bold">Hierarchy</strong> window of the Unity Editor. I will explain these variables briefly here and go into more detail when we use them:</p>
			<ul>
				<li><code>purchaseMade</code> is a Boolean variable that will only accept a <code>true</code> or <code>false</code> value. We are setting it to <code>false</code> here as a form of reset.</li>
				<li><code>bankObj</code>: In the <code>bank</code>. We are assigning that game object of this variable for later.</li>
				<li>We then take the <code>bank</code> integer, which currently contains a value of <code>600</code>, and we cast (assign) it as a <code>string</code> value so that it displays the value in our shop scene under the three-dimensional model of the player's ship.</li>
				<li>The last variable is then assigned the <code>BUY ?</code> game object so that we can activate and deactivate the buy functionality whenever required in the <strong class="bold">Scene</strong> or <strong class="bold">Game</strong> window.</li>
				<li><code>TurnOffPlayerShipVisuals</code>: This method will reset the visuals of the player's ship.</li>
				<li><code>PreparePlayerShipForUpgrade</code>: This method creates a player's ship so that when it has all the upgrades applied, it can be sent into the game to be played.</li>
			</ul>
			<ol>
				<li value="3">Now that <a id="_idIndexMarker580"/>we have our variables made and assigned, we can move on to the conditions of the code. Scroll down in the script until you get to the following line:<pre>if (target.transform.Find("itemText"))</pre></li>
				<li>Within the <code>if</code> statement, we are going to check whether the item we are attempting to buy has not already sold out in the shop (the only reason for an item to be sold out is because we have already bought it) and that we can afford it:<pre>if (target.transform.Find("itemText"))
 { 
    TurnOffSelectionHighlights();
    Select();
    UpdateDescriptionBox();
 //NOT ALREADY SOLD
 if (target.transform.Find("itemText").GetComponent&lt;TextMesh&gt;().
    text != "SOLD")
 {
    //can afford
    Affordable();
    //can not afford
    LackOfCredits();
 }
 else if (target.transform.Find("itemText").GetComponent
    &lt;TextMesh&gt;().text == "SOLD")
 {
    SoldOut();
 }
}</pre></li>
			</ol>
			<p>We start by<a id="_idIndexMarker581"/> entering a comment to notify ourselves or any other programmer that at this point in the code, we are going to check whether the item we are attempting to buy is not already sold out. From here, we add an <code>if</code> statement condition that checks the <code>target</code> variable (the item we raycasted, as mentioned in the <em class="italic">Selecting game objects with raycasts</em> section of the previous chapter) to see whether it contains a <code>TextMesh</code> component holding a <code>string</code> (text) value that doesn't already hold the <code>"SOLD"</code> value. If it does, then we run the <code>SoldOut</code> method.</p>
			<p>If the item hasn't already sold out, then we run two methods—the first is <code>Affordable</code>, which means we're going to check whether we can buy the item with the current amount of credit we have. If we don't have enough credit, the <code>LackOfCredits</code> method is run.</p>
			<p>We have created three new methods, called <code>Affordable</code>, <code>LackOfCredits</code>, and <code>SoldOut</code>; let's now go through each one, starting with <code>Affordable</code>.</p>
			<ol>
				<li value="5">Outside of <a id="_idIndexMarker582"/>the <code>AttemptSelection</code> method, add the following code:<pre>  void Affordable()
  {
    if (bank &gt;=  System.Int32.Parse(target.transform.
       GetComponent&lt;ShopPiece&gt;().ShopSelection.cost))
    {
      Debug.Log("CAN BUY");
      buyButton.SetActive(true);
    }
  }</pre></li>
			</ol>
			<p>The <code>Affordable</code> method checks whether the <code>bank</code> integer (which currently contains the value <code>600</code>) is equal or greater than the value of the button that we have selected (<code>target</code>).</p>
			<p>Next is an <code>if</code> statement that checks whether the <code>bank</code> integer value is greater than or equal to the <code>string cost</code> value of the selected item. Because we can't compare the value of a <code>string</code> variable to an <code>int</code> variable, we need to convert the <code>string</code> variable to an <code>int</code> variable. To do this, we use <code>System.Int32.Parse()</code> and enter the <code>ShopSelection.cost</code> string value in the parse brackets.</p>
			<p>If we can buy the item, then we set <code>buyButton</code> to active, which is a button the player can press to buy the item. Above <code>buyButton.SetActive(true)</code> is a log to Unity's <strong class="bold">Console</strong> window to confirm that a purchase is being made for bug-checking purposes.</p>
			<ol>
				<li value="6">The second method we wrote earlier was the <code>LackOfCredits</code> method, which checks in a similar way by casting the <code>TextMesh</code> component value if it's less than<a id="_idIndexMarker583"/> the <code>bank</code> integer value. If it is, we send a <code>"CAN'T BUY"</code> message to Unity's <code>.Find</code> is much slower compared to something like <code>.GetComponent</code> used on its own. <code>.Find</code> has to go through each game object until it finds the matching string—if it even exists.</p><p class="callout">We could also compare performance versus flexibility as well—for example, <code>transform.GetChild</code> (<a href="https://docs.unity3d.com/ScriptReference/Transform.GetChild.html">https://docs.unity3d.com/ScriptReference/Transform.GetChild.html</a>) will get the child that is specific to the number given to it in its parameter, which is also faster than using <code>.Find</code>. However, if the game object's hierarchy has changed during development, this would cause an error as it is no longer able to find the game object. The same could be said for <code>.GetComponent</code>, which can cause errors if it doesn't exist in the code.</p></li>
				<li>The third is the <code>SoldOut</code> method, which is currently set to log to the Unity Editor <code>SOLD OUT</code>, but yet again, we could add other functionality to <a id="_idIndexMarker584"/>this at a later date, such as applying a sound effect or playing an animation:<pre>  void SoldOut()
  {
    Debug.Log("SOLD OUT");
  }</pre></li>
				<li>Make two empty methods. We will fill their content in later on in the chapter:<pre>void TurnOffPlayerShipVisuals()
{
}
void PreparePlayerShipForUpgrade()
{
}</pre></li>
				<li>Save the script and return to the Unity Editor.</li>
			</ol>
			<p>Reflecting on this section, we have coded in our variables and assigned them when the script begins with the <code>Start</code> function. We have also coded in a few methods that check the balance credit compared to the selected value.</p>
			<p>We can now move on to updating our player ship's visuals in the shop scene and we can also see what <a id="_idIndexMarker585"/>the player's ship looks like in the game.</p>
			<h2 id="_idParaDest-122"><a id="_idTextAnchor124"/>Updating visual representations of our player's ship</h2>
			<p>In this<a id="_idIndexMarker586"/> section, we are going to code in capability so that the player's ship visuals update when a purchase is made and create and update another ship behind the scenes so that it can be sent on to the next scene to play.</p>
			<p>In the <em class="italic">Selecting game objects with raycasts</em> section of the previous chapter, we dragged and dropped our <code>SelectionQuad</code> game objects from the <strong class="bold">Hierarchy</strong> window into the <strong class="bold">Inspector</strong> window.</p>
			<p>The following screenshot shows the majority of the <code>shop</code> game objects grayed out on the <strong class="bold">Inspector</strong> window so that we can focus on the new variable entries under <strong class="bold">Visual Weapons</strong>:</p>
			<div><div><img src="img/Figure_6.02_B18381.jpg" alt="Figure 6.2 – Visual Weapons displaying what will be attached to the player's ship&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.2 – Visual Weapons displaying what will be attached to the player's ship</p>
			<p>To update the housing of the potential player ship upgrades, we need to apply the following to the <code>Visual Weapons</code> game object array using the previous screenshot as reference:</p>
			<ol>
				<li value="1">Change the <code>3</code>.</li>
				<li>For the three empty game object fields, click on the circle on the right of the field, and in the dropdown, begin typing <code>energy +1</code> into the search bar.</li>
				<li>As soon as you see <strong class="bold">energy + 1</strong>, double-click it.</li>
				<li>Repeat this process for <code>c. Bomb</code>.</li>
				<li>Repeat this process for <code>b. Shot</code>.</li>
				<li>Lastly, update the <code>Player_Default</code> asset file via the small remote circle to the right of it. We will<a id="_idIndexMarker587"/> go into more detail about this when we put it into practice in code.</li>
				<li>Save the scene and return to the <code>PlayerShipBuild</code> script.</li>
				<li>We can now enter the content for our <code>TurnOffPlayerShipVisuals</code> method. This method is implemented in the <code>Start</code> function to simply reset the scene so that the only visual representation is the three-dimensional model of the player's ship: <pre> void TurnOffPlayerShipVisuals()
 {
   for (int i = 0; i &lt; visualWeapons.Length; i++)
 {
   visualWeapons[i].gameObject.SetActive(false);
 }
}</pre></li>
			</ol>
			<p>The code runs a <code>for</code> loop that goes through each of the game objects in the array of the <code>Visual Weapons</code> object that we dragged and dropped into the <strong class="bold">Inspector</strong> window.</p>
			<p>We have updated our player's ship model so that when we buy an item, it will update in the <strong class="bold">Scene</strong>/<strong class="bold">Game</strong> window by simply manipulating the activity of our game objects.</p>
			<p>We are <a id="_idIndexMarker588"/>now going to focus more on the player's ship code and the two other buttons on the selection grid—<strong class="bold">BUY?</strong> and <strong class="bold">WATCH AD</strong>.</p>
			<h2 id="_idParaDest-123"><a id="_idTextAnchor125"/>Preparing our player's ship to be used in the game</h2>
			<p>This section is<a id="_idIndexMarker589"/> aimed at preparing our player's ship so that it can be sent to the next scene to play. We will create a standard ship first that the player will not be able to see, apart from a visual representation of it (there are two ships in the scene but the player can only see one).</p>
			<p>So, if the player makes some purchases in our shop, we need to create a ship and add its visual and physical upgrades so that we can see it in action in the next scene.</p>
			<p>We need to return to the <code>PlayerShipBuild</code> script and add the content to our empty <code>PreparePlayerShipForUpgrade</code> method to help support making a player's ship with its new upgrades:</p>
			<pre>  void PreparePlayerShipForUpgrade()
  {
    playerShip = GameObject.Instantiate(defaultPlayerShip.    actor);
       
    playerShip.GetComponent&lt;Player&gt;().enabled = false;
    playerShip.transform.position = new Vector3(0,10000,0);
    playerShip.GetComponent&lt;IActorTemplate&gt;
       ().ActorStats(defaultPlayerShip);
  }</pre>
			<p>The method creates (<code>instantiates</code>) a <code>Player_Ship</code> game object from the <code>Resources</code> folder. We then turn off (<code>enabled</code> = <code>false</code>) its own script attachment; otherwise, we would be able to move and shoot with it in the shop scene.</p>
			<p>We then move the <code>Player_Ship</code> object completely out of the <strong class="bold">Scene</strong>/<strong class="bold">Game</strong> window view.</p>
			<p>Finally, we assign it the <code>defaultPlayerShip</code> asset file that we dragged and dropped into the scriptable object field in the <strong class="bold">Inspector</strong> window in the previous section.</p>
			<p>In this section, we revisited the <code>PlayerShipBuild</code> script and added more global variables and functionality to support the shop scene. Our game now has an in-game credit score and works out whether the player can afford a game item or not; the rest of the code in this section was for hiding game objects and preparing our player's ship to be carried over into the game scene.</p>
			<p>In the next section, we will carry on with the <code>PlayerShipBuild</code> script and look into actually starting<a id="_idIndexMarker590"/> a game to play with the player's ship. We will also look at how the player can buy in-game credits by watching adverts with the use of the Unity dashboard and Unity Monetization from the Asset store.</p>
			<h1 id="_idParaDest-124"><a id="_idTextAnchor126"/>Buying items, watching adverts, and preparing to start a game</h1>
			<p>In this <a id="_idIndexMarker591"/>section, we<a id="_idIndexMarker592"/> will look at adding three more buttons to our shop <a id="_idIndexMarker593"/>scene. The first is <code>BUY?</code> for when we want to purchase an item. The second is <code>Watch Ad</code>—as soon as the player presses this button, an advert will load; once it's finished, the player is rewarded with <code>300</code> credits. Lastly, we'll add the <code>START</code> button, which will take the player to the <code>testLevel</code> scene with the upgrades they have purchased (if any).</p>
			<p>We need to head back to the <code>PlayerShipBuild</code> script and scroll down to the <code>AttemptSelection</code> method, where we will add three <code>else if</code> statements to launch three different types of methods. The reason for this is that the three selections don't follow on from the scriptable object buttons; therefore, these items will never have outcomes such as <code>SOLD</code> or <code>itemText</code>.</p>
			<p>The following screenshot shows the complete <code>AttemptSelection</code> method with the focus drawn to the other three non-scriptable object buttons:</p>
			<div><div><img src="img/Figure_6.03_B18381.jpg" alt="Figure 6.3 – Our shop buttons with three alternative methods to load when pressed&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.3 – Our shop buttons with three alternative methods to load when pressed</p>
			<p>We are<a id="_idIndexMarker594"/> going to<a id="_idIndexMarker595"/> look<a id="_idIndexMarker596"/> at the <code>BUY?</code> button first as it relates to what we are covering in this section.</p>
			<h2 id="_idParaDest-125"><a id="_idTextAnchor127"/>Setting up the BUY? button</h2>
			<p>In this<a id="_idIndexMarker597"/> section, we will be hooking up the <strong class="bold">BUY?</strong> button so that it appears at the right time in the description panel. This button will only be displayed if the player hasn't already bought the item and if they have enough credits.</p>
			<p>The following screenshot shows our shop scene with the <strong class="bold">BUY?</strong> button highlighted:</p>
			<div><div><img src="img/Figure_6.04_B18381.jpg" alt="Figure 6.4 – BUY? button&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.4 – BUY? button</p>
			<p>Let's make a start by coding the <code>PlayerShipBuild</code> script:</p>
			<ol>
				<li value="1">Open the <code>PlayerShipBuild</code> script.</li>
				<li>Scroll down to the <code>AttemptSelection</code> method after the curly brace, as in the following snippet:<pre>if (target.transform.Find("itemText"))
        {
            //CODE WE HAVE ENTERED...
            //CODE WE HAVE ENTERED...
            //CODE WE HAVE ENTERED...
        }
            &lt;---- BEGIN CODING "ELSE IF" HERE</pre></li>
				<li>Add the following <code>else if</code> code, as indicated in the preceding code. We can also use the screenshot from the previous section as a reference:<pre>        else if(target.name == "BUY ?")
        {
          BuyItem();
        }</pre></li>
				<li>So, if the <a id="_idIndexMarker598"/>player clicks on the <code>target.name</code> equals the name of <code>BuyItem</code> method is called. Inside this method, the following code is executed: <pre>  void BuyItem()
  {
    Debug.Log("PURCHASED");
    purchaseMade = true;
    buyButton.SetActive(false);
    tmpSelection.SetActive(false);</pre></li>
			</ol>
			<p>We message the <code>purchaseMade</code> to <code>true</code>. This Boolean value is used later when we leave the shop scene to start the game. If <code>purchaseMade</code> is <code>true</code>, a set of procedures follows. The next line turns off the <code>buyButton</code> function as we no longer need to display the results. Finally, we remove the selection from the grid at the bottom of the screen as a refresh.</p>
			<p>Following on from the <code>BuyItem</code> method, we now turn our focus to the <code>visualWeapons</code> game object, which, if you remember from earlier in this chapter, covers the visual representation of what we have bought and what our player ship will look like when playing in a game.</p>
			<ol>
				<li value="5">Continuing on inside the <code>BuyItem</code> method, add the following code to name and make <a id="_idIndexMarker599"/>all cases of <code>visualWeapons</code> active:<pre>for (int i = 0; i &lt; visualWeapons.Length; i++)
 {
   if (visualWeapons[i].name ==
     tmpSelection.transform.parent.gameObject.
          GetComponent&lt;ShopPiece&gt;().ShopSelection.iconName)
      {
        visualWeapons[i].SetActive(true);
      }
 }</pre></li>
			</ol>
			<p>We run a <code>for</code> loop to count how many <code>visualWeapons</code> objects we have in the array. Within the <code>if</code> statement, we check each <code>visualWeapon</code> name from the array to see whether it matches with the selection made in the selection grid's name. If it does, then we turn that particular <code>visualWeapon</code> object on so that we can see it in the shop selection.</p>
			<ol>
				<li value="6">Continuing on in the <code>BuyItem</code> method, we add another method to send our upgrades to our player's ship, along with our <code>bank</code> credit, with the following code:<pre>UpgradeToShip(tmpSelection.transform.parent.gameObject.GetComponent
    &lt;ShopPiece&gt;().ShopSelection.iconName);
  bank = bank - System.Int32.Parse(tmpSelection.transform.parent.
     GetComponent&lt;ShopPiece&gt;().ShopSelection.cost);
 
 bankObj.transform.Find("bankText").GetComponent&lt;TextMesh&gt;().text 
     = bank.ToString();
 tmpSelection.transform.parent.transform.Find("itemText").
     GetComponent&lt;TextMesh&gt;().text = "SOLD";
}</pre></li>
			</ol>
			<p>We run another method, called <code>UpgradeToShip</code>. This method will load the game object<a id="_idIndexMarker600"/> of the item purchased to the player ship we play in our game; we will go into further detail about this method shortly.</p>
			<p>Next, we deduct from the <code>bank</code> value (using <code>System.Int32.Parse</code>, so it reads the <code>string</code> value as an <code>int</code> value) with the selection's <code>cost</code> scriptable object. We then represent the deduction by grabbing the reference from the bank's game object, called <code>bankText</code>, and updating its <code>text</code> value in the <code>TextMesh</code> component.</p>
			<p>Finally, we update the selection from the selection grid that the item has been sold. This is updated to the button's value text.</p>
			<p>That brings us to the end of the <code>BuyItem</code> method. But, as mentioned, we run the <code>UpgradeToShip</code> method, which loads the game object of that particular ship part and attaches it to a ship that is away from the screen.</p>
			<ol>
				<li value="7">Still, in the <code>PlayerShipBuild</code> script, let's add the <code>UpgradeToShip</code> method:<pre> void UpgradeToShip(string upgrade)
 {
 GameObject shipItem = GameObject.Instantiate(Resources.Load
    (upgrade)) as GameObject;
 shipItem.transform.SetParent(playerShip.transform);
 shipItem.transform.localPosition = Vector3.zero; 
 }</pre></li>
			</ol>
			<p>The <code>UpgradeToShip</code> method <a id="_idIndexMarker601"/>takes a <code>string</code> parameter titled <code>upgrade</code>. Earlier, we sent it the following line of code:</p>
			<pre>tmpSelection.transform.parent.gameObject.GetComponent
   &lt;ShopPiece&gt;().ShopSelection.iconName</pre>
			<p>This line of code came from the selection's scriptable object item name. This item's name (<code>ShopSelection.iconName</code>) is sent to <code>UpgradeToShip</code> as a <code>string</code> name (<code>upgrade</code>).</p>
			<p>Inside the <code>UpgradeToShip</code> method, we create (<code>instantiate</code>) a game object in the resources folder from the name of the shop's selection icon and store it in a game object variable, <code>shipItem</code>.</p>
			<p>We then attach this <code>shipItem</code> game object to our <code>playerShip</code> object. This is the <code>playerShip</code> object that is not in the <strong class="bold">Game</strong> window view but will be sent to the next scene—the game-playing scene.</p>
			<p>The <code>shipItem</code> game object's local position (its position compared to its parent game object, <code>playerShip</code>) is set to <code>0</code> (that is, its <em class="italic">x</em>, <em class="italic">y</em>, and <em class="italic">z</em> positions are set to <code>0</code>).</p>
			<ol>
				<li value="8">Save the script and return to the Unity Editor.</li>
				<li>Click on the <strong class="bold">Play</strong> button to begin play mode, and in the <strong class="bold">Game</strong> window, select the first item in the selection grid.</li>
			</ol>
			<p>We should now have the ability to buy this item. If we click on buy, the button will no longer say the value, but instead will display <strong class="bold">SOLD</strong>, and the <strong class="bold">BUY?</strong> button will disappear if we attempt to select the same item again.</p>
			<p>We have two <a id="_idIndexMarker602"/>buttons left to hook up and then we will have a fully functioning shop. Let's continue with the <strong class="bold">START</strong> button.</p>
			<h2 id="_idParaDest-126"><a id="_idTextAnchor128"/>Setting up the START button</h2>
			<p><strong class="bold">START</strong> is the <a id="_idIndexMarker603"/>button the player presses when they want to leave the shop scene and move on to playing the game. </p>
			<p>The following screenshot shows where the <strong class="bold">START</strong> button is located in the shop scene:</p>
			<div><div><img src="img/Figure_6.07_B18381.jpg" alt="Figure 6.5 – START button&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.5 – START button</p>
			<p>So, we can recall that in the previous section, we were coding in our <code>AttemptSelection</code> method, which runs when the player presses one of the buttons on the selection grid in the shop.</p>
			<p>At the bottom of this method are three <code>else if</code> statements. We have already set up one of the three buttons, the <code>else if</code> statement, which is the <code>AttemptSelection</code> method:</p>
			<div><div><img src="img/Figure_6.06_B18381.jpg" alt="Figure 6.6 – START button will load the StartGame() method&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.6 – START button will load the StartGame() method</p>
			<p>Next, we will be making sure that our player has purchased an item or upgrade from the shop (if anything) and load our first level:</p>
			<ol>
				<li value="1">So, at the bottom of the <code>AttemptSelection</code> method in our <code>PlayerBuild</code> script, enter the following <code>if</code> statement:<pre>        else if(target.name == "START")
        {
          StartGame();
        }</pre></li>
			</ol>
			<p>When our <code>target</code> game object selection carries the <code>START</code> game object name, we fall into the <code>else if</code> statement and run the <code>StartGame</code> method. This method is small and the majority of its code depends on whether a purchase has been made. </p>
			<ol>
				<li value="2">Continuing on<a id="_idIndexMarker605"/> in our <code>PlayerShipBuild</code> script, add the <code>StartGame</code> method:<pre>  void StartGame()
  { 
      if (purchaseMade)
  {
    playerShip.name = "UpgradedShip";
    if (playerShip.transform.Find("energy +1(Clone)"))
    {
       playerShip.GetComponent&lt;Player&gt;().Health = 2;
    } 
    DontDestroyOnLoad(playerShip);
   }
   UnityEngine.SceneManagement.SceneManager.LoadScene("testLevel");
  }</pre></li>
			</ol>
			<p>If <code>purchaseMade</code> is set to <code>true</code>, we fall into the <code>if</code> statement and name our <code>playerShip</code> game object <code>"UpgradedShip"</code>. We then check whether the <code>playerShip</code> object has made a purchase for more health (<code>"energy +1(Clone)"</code>). If the player has bought more health, we will set our <code>playerShip</code> object's <code>health</code> value to <code>2</code>. This means that our player can get hit twice before dying.</p>
			<p>The <code>DontDestroyOnLoad</code> function takes the argument of <code>playerShip</code>, which means when the next scene loads, the <code>playerShip</code> game object will be carried over to the next scene.</p>
			<p>Finally, we start our <code>testLevel</code> scene.</p>
			<ol>
				<li value="3">Save the script.</li>
			</ol>
			<p>So, after a purchase (or no purchase) is made, our shop scene will close and our <code>testLevel</code> will open with or without any purchases made. However we will not see the visual upgrades until we update our <code>PlayerSpawner</code> script later on in the chapter.</p>
			<p>Return to the<a id="_idIndexMarker606"/> Unity Editor and run <strong class="bold">Play</strong> mode to check whether the player ship upgrade is carried over.</p>
			<p>Let's now move on to the final <code>if else</code> statement—the <strong class="bold">WATCH AD</strong> button.</p>
			<h2 id="_idParaDest-127"><a id="_idTextAnchor129"/>Setting up the WATCH AD button</h2>
			<p>The last <a id="_idIndexMarker607"/>button we will be covering in this chapter is the <strong class="bold">WATCH AD</strong> button. In a lot of mobile devices' (Android's/iOS') free-to-play games (the game is free to play but makes money back with in-game purchases or adverts), the option for the player to enhance their experience with the game is to receive upgrades and modifications, gain in-game credits, and more if the player watches a 30-second advert. After watching the advert, the player is rewarded with credit. In this section, we are going to create this functionality with our code and Unity's online dashboard.</p>
			<p>The following screenshot shows the location of the <strong class="bold">WATCH AD</strong> button in the selection grid:</p>
			<div><div><img src="img/Figure_6.07_B183811.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.7 – WATCH AD button</p>
			<p>We need to<a id="_idIndexMarker608"/> turn on Unity's ad services in the Unity Editor and follow these steps:</p>
			<ol>
				<li value="1">As before, if the <strong class="bold">Services</strong> tab isn't available, we can find it under the Unity Editor <strong class="bold">Window</strong> tab | <strong class="bold">General</strong>, followed by <strong class="bold">Services</strong>, as in the following screenshot:</li>
			</ol>
			<div><div><img src="img/Figure_6.08_B18381.jpg" alt="Figure 6.8 – Services location&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.8 – Services location</p>
			<ol>
				<li value="2">Click<a id="_idIndexMarker609"/> on the <strong class="bold">Services</strong> tab and select <strong class="bold">Ads</strong>, as in the following screenshot:</li>
			</ol>
			<div><div><img src="img/Figure_6.09_B18381.jpg" alt="Figure 6.9 – Turning Ads ON&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.9 – Turning Ads ON</p>
			<p>In the previous screenshot, you may have a warning notification at the top of the <strong class="bold">Services</strong> window <a id="_idIndexMarker610"/>saying you don't have a project ID (marked with an <strong class="bold">*</strong> in the screenshot). If you don't have this warning, you can skip the next set of instructions and set up the Ads service.</p>
			<p>To fix the issue with no project ID set up, we need to attach ours by doing the following:</p>
			<ol>
				<li value="1">When we click the <strong class="bold">Ads</strong> section in the <strong class="bold">Services</strong> window, the <strong class="bold">Project Settings</strong> window appears. In the <strong class="bold">Project Settings</strong> window, <strong class="bold">Services</strong> would be expanded out from the list and <strong class="bold">Ads</strong> will be selected, as shown in the following screenshot:</li>
			</ol>
			<div><div><img src="img/Figure_6.10_B18381.jpg" alt="Figure 6.10 – Project Settings with no project ID&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.10 – Project Settings with no project ID</p>
			<ol>
				<li value="2">Click on <strong class="bold">Select organization</strong> under the <strong class="bold">Create a Unity Project ID</strong> heading.</li>
			</ol>
			<p>Your <a id="_idIndexMarker611"/>organization will be on the list. Click on it (this was created when you created your account with Unity. Mine is called retrophil).</p>
			<ol>
				<li value="3">Click the <strong class="bold">Create project ID</strong> button.</li>
			</ol>
			<p>It's likely the <strong class="bold">Console</strong> window will give off a few warnings, errors, and so on. Do not worry about these for now. Keep your attention on the <strong class="bold">Project Settings</strong> window.</p>
			<p>Next, you will be presented with the following update to the <strong class="bold">Project Settings</strong> window:</p>
			<div><div><img src="img/Figure_6.11_B18381.jpg" alt="Figure 6.11 – Project linked successfully&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.11 – Project linked successfully</p>
			<p>Let's continue<a id="_idIndexMarker612"/> setting up <strong class="bold">Ads</strong> in our project:</p>
			<ol>
				<li value="1">We are asked if our app is targeted at children under age 13. Our project isn't targeted for children in that range, so select <strong class="bold">No</strong> from the drop-down list.</li>
				<li>Click <strong class="bold">Save</strong>.</li>
			</ol>
			<p>Our project is now ready to have <strong class="bold">Ads</strong> turned on.</p>
			<ol>
				<li value="3">Click <strong class="bold">OFF</strong> to turn our <strong class="bold">Ads</strong> service <strong class="bold">ON</strong>, as shown in the following screenshot:</li>
			</ol>
			<div><div><img src="img/Figure_6.12_B18381.jpg" alt="Figure 6.12 – Ads Package&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.12 – Ads Package</p>
			<ol>
				<li value="4">Finally, we need to activate the <strong class="bold">Monetization</strong> service via <strong class="bold">Dashboard</strong>. To do that, click the <strong class="bold">Dashboard</strong> link in the <strong class="bold">Ads</strong> section. This will load the Unity Dashboard in a browser. In the <strong class="bold">Monetization</strong> section click <strong class="bold">Complete Activation</strong>, then <strong class="bold">Unity Ads</strong>. You will then be allocated your Game Ids. Return to the Unity Editor.</li>
			</ol>
			<p>By the time you're reading this book, it is likely there will be an update for the Ads Package; if<a id="_idIndexMarker613"/> possible, install 3.7.5 still as it's likely the later version will have a different/unfinished setup, meaning the following instructions will likely not relate or there might be unfinished methods. But if you want to (or have to) install the latest version, be sure to follow the Unity Ads documentation: <a href="https://docs.unity.com/ads/UnityAdsHome.html">https://docs.unity.com/ads/UnityAdsHome.html</a>.</p>
			<p>We are now at the point where Unity Ads is connected to our project. The <strong class="bold">Project Settings</strong> window also displays our Game Id for Android and iOS operating systems. These IDs are references for our game that the Google Play and Apple App Store will use to identify our game when it comes to sending adverts.</p>
			<p>Each game ID will be different, so your game ID will be different from mine. When it comes to entering your game ID code, make sure you refer to yours, not mine.</p>
			<p>We can now return to our <code>PlayerShipBuild</code> script and make a start with hooking up <a id="_idIndexMarker614"/>our <strong class="bold">WATCH AD</strong> button to display adverts.</p>
			<h3>Attaching Unity reward adverts to our script</h3>
			<p>In this <a id="_idIndexMarker615"/>section, we are going to take placement information and extra functionality from the <strong class="bold">Advertisement</strong> library to create our reward adverts:</p>
			<ol>
				<li value="1">In the Unity Editor, from the <code>Assets/Script</code> folder, then take the following steps.</li>
				<li>Open the <code>PlayerShipBuild</code> script and at the top of the code that we need, import two extra libraries alongside our <code>UnityEngine</code> library:<pre><code>using UnityEngine.Advertisements;</code></pre></li>
			</ol>
			<p><code>System.Collections</code> contain extra tools, such as <code>IEnumerator</code>, which is used for the <code>StartCoroutine</code> functions, which we will cover shortly.</p>
			<p>The other line of code imports Unity's <strong class="bold">Advertisement</strong> library, which we downloaded from our Ads Service, which will also be displayed in our Package Manager. Also, make sure you have Android selected as your platform in Build Settings. </p>
			<p class="callout-heading">What Is the Package Manager?</p>
			<p class="callout">Unity holds most of its add-ons/extra software and updates for components in the Package Manager. We can also check for updates for these packages. If you would like to know more about the Package Manager, check out the following link: <a href="https://docs.unity3d.com/Manual/Packages.html">https://docs.unity3d.com/Manual/Packages.html</a>.</p>
			<p>Next, we will add two interfaces to our <code>PlayerShipBuild</code> script as they are required for the Ads Services to work, <code>IUnityAdsInitializationListener</code> and <code>IUnityAdsListener</code>, and implement these in our class. These interfaces will give us callback (a callback is a method that runs when a process is done executing a specific task) methods to tell us what state our ads are in and when we can add code, such as rewards.</p>
			<p class="callout-heading">Further Information</p>
			<p class="callout">If you would like to know more about the Ads content, you can check out the Unity Documentation here: <a href="https://docs.unity.com/ads/UnityAPI.html">https://docs.unity.com/ads/UnityAPI.html</a>.</p>
			<p>Carrying on with the <code>PlayerShipBuild</code> script, we declare our class as follows:</p>
			<pre>public class PlayerShipBuild : MonoBehaviour, IUnityAdsListener, IUnityAdsInitializationListener</pre>
			<p>Our script will <a id="_idIndexMarker616"/>underline these interfaces with error lines because we haven't implemented their methods. We can do this now and fill them out correctly later.</p>
			<p>Instead of typing the required methods out, we can highlight one of the interfaces in Visual Studio and let it type out the methods for us:</p>
			<ol>
				<li value="1">Continuing with the <code>PlayerShipBuild</code> script, highlight one of the interfaces with your mouse.</li>
			</ol>
			<div><div><img src="img/Figure_6.13_B18381.jpg" alt="Figure 6.13 – Highlighted interface&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.13 – Highlighted interface</p>
			<ol>
				<li value="2">A dropdown will appear with what needs adding to our class. Click on <strong class="bold">Show potential fixes</strong>.</li>
			</ol>
			<div><div><img src="img/Figure_6.14_B18381.jpg" alt="Figure 6.14 – Show potential fixes dialog box&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.14 – Show potential fixes dialog box</p>
			<ol>
				<li value="3">We will then be presented with a list of methods (A). Click <code>PlayerShipBuild</code> class.</li>
				<li>If a box appears asking to confirm the changes, click <strong class="bold">Apply</strong>.</li>
				<li>Repeat this process for the other interface.</li>
				<li>Once done, scroll down to the bottom of the <code>PlayerShipBuild</code> script to see our extra methods.</li>
			</ol>
			<p>As mentioned, we will return to these methods and fill them out with regard to adding debug messages if an error occurs. The main method will be the <code>OnUnityAdsDidFinish</code> method, because that's where we will be rewarding the player with credit to their bank after watching an advert.</p>
			<p>We will now continue adding the variables that will hold the ids to distinguish what platform we are running on:</p>
			<ol>
				<li value="1">Scroll back up to the top of the <code>PlayerShipBuild</code> script and add the following global variables with the others:<pre>  [SerializeField] string androidGameId;
  [SerializeField] string iOSGameId;
  [SerializeField] bool testMode = true;
  string adId = null;</pre></li>
			</ol>
			<p><code>androidGameId</code> and <code>iOSGameId</code> will hold the game IDs that we saw earlier when setting up the Ads Service in the <strong class="bold">Project Settings</strong> folder.</p>
			<p><code>testMode</code> is set to <code>true</code>. On an actual device under test mode, you'll get a proper Unity video test ad. You can test skipping or watching it in full. When you disable test <a id="_idIndexMarker618"/>mode for release, live video ads from Unity Ads advertisers will appear.</p>
			<p><code>adId</code> will hold a string that will be an ID for what type of advert you want to load. We will go into this a bit more shortly.</p>
			<p>Seeing as we have made our new variables accessible from the <code>SerializeField</code> attribute, we can add our Android and iOS Game Ids to these variables next.</p>
			<ol>
				<li value="2">Before we add any more code, save your <code>PlayerShipBuild</code> script and return to the Editor.</li>
				<li>In your shop scene, expand out the <strong class="bold">ShopManager</strong> game object in the <strong class="bold">Hierarchy</strong> window.</li>
				<li>Expand out <strong class="bold">BuyingSelection</strong> as well.</li>
				<li>Select the <strong class="bold">shop</strong> game object.</li>
				<li>In the <strong class="bold">Inspector</strong> window, we can see blank spaces for our Ids.</li>
				<li>So, all we need to do is open our <strong class="bold">Project Settings</strong> window.</li>
				<li>Select <strong class="bold">Services</strong> then <strong class="bold">Ads</strong> from the list.</li>
				<li>Copy the <strong class="bold">Android</strong> ID and paste it into the <strong class="bold">Android Game Id</strong> field in the <strong class="bold">Inspector</strong> window.</li>
				<li>Copy the <strong class="bold">iOS</strong> ID and <a id="_idIndexMarker619"/>paste that into the <strong class="bold">IOS Game Id</strong> field in the <strong class="bold">Inspector</strong> window.</li>
			</ol>
			<div><div><img src="img/Figure_6.15_B18381.jpg" alt="Figure 6.15 – Copy Game id from Project Settings to Inspector&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.15 – Copy Game id from Project Settings to Inspector</p>
			<p>We now need to add a function in our <code>PlayerShipBuild</code> script, that checks which device (iPhone/Samsung) is running our game. When we know which device is running, we can add the correct game ID and reward id to our advertisement initializer:</p>
			<ol>
				<li value="1">So, we can add an <code>Awake</code> function and inside it, we will call a function that we haven't added yet:<pre>void Awake()
{
CheckPlatform();
}</pre></li>
				<li>Now, we can move on to declaring the <code>CheckPlatform</code> function; in the next line down from the <code>Awake</code> function, we can add the following:<pre>  void CheckPlatform()
  {
    string<a id="_idIndexMarker620"/> gameId = null;</pre></li>
			</ol>
			<p>We've declared our function name and added a <code>gameId</code> variable that defaults to null.</p>
			<ol>
				<li value="3">Next, we will use conditional compilation to differentiate between what platform we are playing our game on so we can hook up the correct ids:<pre>    #if UNITY_IOS
    {
      gameId = iOSGameId;
      adId = "Rewarded_iOS";
    }</pre></li>
			</ol>
			<p>So, if we are using an iPhone/iPad device, we will assign the iOS game id to the variable called <code>gameId</code>. We will also be assigning the iOS reward to <code>adId</code>:  </p>
			<pre><code>    </code>#elif UNITY_ANDROID
    {
      gameId = androidGameId;
      adId = "Rewarded_Android";
    }
    #endif</pre>
			<p>And, as you've <a id="_idIndexMarker621"/>probably guessed, we have an "else if" (it is spelled <code>elif</code>) that checks for an Android operating system (Samsung, Google Pixel devices, and so on).</p>
			<ol>
				<li value="4">Finally, we send the chosen <code>gameId</code> and its test mode condition and receive our Unity Ads callback:<pre>    Advertisement.Initialize(gameId, testMode, false, this);
  }</pre><p class="callout-heading">Further Information</p><p class="callout">If you would like to know more about conditional compilation, check out this link: <a href="https://docs.unity3d.com/Manual/PlatformDependentCompilation.html">https://docs.unity3d.com/Manual/PlatformDependentCompilation.html</a>.</p></li>
			</ol>
			<p>As you can imagine, when we load up our <code>SHOP</code> scene, our game checks to see whether it's being played through a portable device. If it is being played through a portable device, it will send the correct ids out to Unity. Next, we will need to load the advert so if the player does request an advert, we have it ready to show.</p>
			<p>The next step is to load our advert with a small function. First, we need to check to see whether the Advertisement has finished initializing:</p>
			<ol>
				<li value="1">To check and load an advert for our game scroll up to the <code>Start</code> function and enter the following:<pre>StartCoroutine(WaitForAd());</pre></li>
			</ol>
			<p>A coroutine will give us the ability to wait until the advert is initialized.</p>
			<ol>
				<li value="2">Outside<a id="_idIndexMarker622"/> of the <code>Start</code> function, enter the following code to check for when our advert can begin to load ready for the player:<pre>  IEnumerator WaitForAd()
  {
    while (!Advertisement.isInitialized)
    {
      yield return null;
    }
    LoadAd();
  }</pre></li>
			</ol>
			<p>The code will loop until our <code>Advertisement</code> is initialized.  Once it is initialized, the <code>LoadAd</code> method will run.</p>
			<p>The <code>LoadAd</code> method will add an event listener, which will callback to our methods when specific tasks have been completed (when an advert is ready to be viewed, if there was an error, if the advert has started playing) that we've implemented from our two interfaces. The other thing the <code>LoadAd</code> method will do is take whichever advert id has been sent to it and load an advert specifically for the platform.</p>
			<p>The next method is for our <code>PlayerShipBuild</code> script to load the advert ready.</p>
			<ol>
				<li value="3">Type the following:<pre>  void LoadAd()
      {
    Advertisement.AddListener(this);
    Advertisement.Load(adId);
  }</pre></li>
			</ol>
			<p>It's important to<a id="_idIndexMarker623"/> note, whenever a Listener is added, remember to remove it when it's no longer required. If a listener is made, and the object is destroyed, this can cause issues as the listener may still be active. Also, if another listener is added that is doing the same job, you would be doubling or tripling callbacks, which in our case would mean doubling and tripling players' shop credits.</p>
			<p>We can now move on to setting up the <code>WatchAdvert</code> function, which will be the beginning of our advert to trigger on mobile devices when the player presses the <strong class="bold">WATCH AD</strong> button:</p>
			<ol>
				<li value="1">Still in the <code>PlayerShipBuild</code> script, scroll down to the <code>AttemptSelection</code> method, where we already have the two <code>else if</code> statements, and enter the final <code>else if</code> statement to trigger an advert when the player presses the <strong class="bold">WATCH</strong> <strong class="bold">AD</strong> button in our shop scene:<pre>        else if (target.name == "WATCH AD")
        {
          WatchAdvert();
        }</pre></li>
			</ol>
			<p>If this button is pressed, we run a method called <code>WatchAdvert</code>. We will talk about this method next.</p>
			<ol>
				<li value="2">Scroll to some space outside of all the other methods/functions and enter the following method to set up an advert for the player:<pre>void WatchAdvert()
{
Advertisement.Show(adId);
}</pre></li>
			</ol>
			<p>The <code>WatchAdvert</code> method is very simple. It runs the static <code>Advertisement.Show</code> method and takes the reward id.</p>
			<ol>
				<li value="3">Our Advert is<a id="_idIndexMarker624"/> nearly hooked up. We can now go down to the bottom of the script and fill in our callback methods.</li>
			</ol>
			<p>The methods and their purposes, in no particular order, are as follows:</p>
			<p><code>OnInitializationComplete()</code></p>
			<p>This method will run when our advert service has been initialized.</p>
			<p><code>OnInitializationFailed(UnityAdsInitializationError error, string message)</code></p>
			<p>If the advert service initialization has failed.</p>
			<p><code>OnUnityAdsReady(string placementId)</code></p>
			<p>When a Unity advert is ready to play.</p>
			<p><code>OnUnityAdsDidError(string message)</code></p>
			<p>An error happened with loading the advert.</p>
			<p><code>OnUnityAdsDidStart(string placementId)</code></p>
			<p>The advert has started playing.</p>
			<p><code>OnUnityAdsDidFinish(string placementId, ShowResult showResult)</code></p>
			<p>The advert has finished playing.</p>
			<p>Each of these methods has a line of code that fires an exception error because we haven't filled the methods in. It doesn't mean anything is wrong, it works more as a reminder.</p>
			<ol>
				<li value="4">Delete all lines of code that have this code in the following methods:<pre>throw new System.NotImplementedException();</pre></li>
			</ol>
			<p>This will <a id="_idIndexMarker625"/>stop our errors. If you want to add a <code>Debug.Log()</code> to each of these methods, you can, so you know either of these methods fire. I will focus only on three of the methods, two of them for Initialization and one to add the reward to the shop's bank.</p>
			<ol>
				<li value="5">Scroll to the method called <code>OnInitializationComplete()</code> and within its curly braces, enter the following:<pre>Debug.Log("Unity Ads initialization complete.");</pre></li>
				<li>For the second method, direct yourself to <code>OnInitializationFailed(UnityAdsInitializationError error, string message)</code> and enter the following code within its curly braces:<pre>Debug.Log($"Unity Ads Initialization Failed: {error.ToString()} - {message}");</pre></li>
			</ol>
			<p>The <code>$</code> is used as an interpolation expression, which basically means whatever follows within curly braces will also be logged with the rest of the <code>string</code>. <code>error</code> will be the type of error, while <code>message</code> will carry a description of the error.</p>
			<p class="callout-heading">Information</p>
			<p class="callout">If you would like to know more about interpolation expressions, check out the following link: <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/tokens/interpolated">https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/tokens/interpolated</a>.</p>
			<p>The last method is our reward given to the player. Navigate to the <code>OnUnityAdsDidFinish(string placementId, ShowResult showResult)</code> method.</p>
			<p>We will have three possible outcomes for if an advert is viewed. The possibilities are as follows:</p>
			<p><code>Finished</code>: Full advert has been watched.</p>
			<p><code>Skipped</code>: The advert was skipped.</p>
			<p><code>Failed</code>: Advert failed to load.</p>
			<p>These states <a id="_idIndexMarker626"/>will come from the <code>showResult</code> variable. Let's enter the three possible <code>if</code> statements and then we can fill the rest of the method in:</p>
			<ol>
				<li value="1">Within the <code>OnUnityAdsDidFinish(string placementId, ShowResult showResult)</code> method's curly braces, enter the following:<pre>if (showResult == ShowResult.Finished)
  {
        // REWARD PLAYER
      }
  else if (showResult == ShowResult.Skipped)
  {
        // DO NOT REWARD PLAYER
      }
  else if (showResult == ShowResult.Failed)
  {
        Debug.LogWarning ("The ad did not finish due to an error.");
  }</pre></li>
				<li>For our game, we only need to add content to the <code>ShowResult.Finished</code> statement. Replace <code>// REWARD PLAYER</code> with the following code to reward the player with <code>300</code> credits to their bank:<pre>Debug.Log("Unity Ads Rewarded Ad Completed");
bank += 300;
bankObj.GetComponentInChildren&lt;TextMesh&gt;().text = bank.ToString();</pre></li>
			</ol>
			<p>The first<a id="_idIndexMarker627"/> line we entered is a simple log to say the advert has landed in the <code>Finished</code> state. Next, we add <code>300</code> credits to our existing bank. Finally, we send the value to the <code>bankObj</code> <code>TextMesh</code> <code>text</code> value.</p>
			<p>After the last <code>else if</code> in the <code>OnUnityAdsDidFinish</code> method, we finish by adding two lines of code. The first line loads another advert using the same reward id. The second line is a method that deselects all buttons in the shop (we covered this method in the last chapter).</p>
			<ol>
				<li value="3">So, still just outside the last <code>else if</code> curly brace, enter the following two lines:<pre>Advertisement.Load(placementId);
TurnOffSelectionHighlights();</pre></li>
			</ol>
			<p>We are now in a position to test our <strong class="bold">WATCH AD</strong> button in our shop scene to see whether our advert template will load:</p>
			<ol>
				<li value="1">Save the <code>PlayerShipBuild</code> script and return to the Unity Editor.</li>
				<li>Make sure your <strong class="bold">Build Settings</strong> are pointing to an Android build. Click the <strong class="bold">Play</strong> button in the Editor.</li>
				<li>In the <strong class="bold">Game</strong> window, click on the <strong class="bold">WATCH AD</strong> button. We should be presented with the following screen:</li>
			</ol>
			<div><div><img src="img/Figure_6.16_B18381.jpg" alt="Figure 6.16 – Unity's advert placeholder screen&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.16 – Unity's advert placeholder screen</p>
			<ol>
				<li value="4">Click on the <strong class="bold">Close</strong> button in the top-right corner.</li>
				<li>Hopefully, your on-screen credit should have gone from <code>600</code> to <code>900</code>.</li>
				<li>That is the end of adding the functionality for the <strong class="bold">WATCH AD</strong> button. Save the script.</li>
			</ol>
			<p>Our shop scene is complete and fully functioning with the ability to watch an advert to gain credits<a id="_idIndexMarker628"/> so that the player can purchase items to use in their game. We now need to expand the <code>PlayerSpawner</code> script to support new items that can potentially be added to the player ship.</p>
			<h1 id="_idParaDest-128"><a id="_idTextAnchor130"/>Extending the PlayerSpawner script</h1>
			<p>If an item is <a id="_idIndexMarker629"/>purchased from our shop scene, this will affect what happens to our game scene when our player's ship loads into the game. Our current <code>PlayerSpawner</code> script will not accommodate the <code>shop</code> scene ship, so we need to revisit this script to update its <code>CreatePlayer</code> method:</p>
			<ol>
				<li value="1">In the Unity Editor's <code>PlayerSpawner</code> script (<code>Assets/Script</code>).</li>
				<li>At the top of the <code>PlayerSpawner</code> script, with the other variables, add a <code>bool</code> value:<pre> bool upgradedShip = false;</pre></li>
			</ol>
			<p>The <code>upgradedShip</code> Boolean will switch to <code>true</code> if a modified player ship is found in the level.</p>
			<ol>
				<li value="3">Scroll down to the <code>Start</code> function in the <code>PlayerSpawner</code> script and add this as the last line with the <code>Start</code> function:<pre>GetComponentInChildren&lt;Player&gt;().enabled = true;
GameManager.Instance.CameraSetup();</pre></li>
			</ol>
			<p>Currently, our <code>PlayerShipBuild</code> script disables the <code>Player</code> script in the <code>shop</code> scene, to <a id="_idIndexMarker630"/>stop the player from shooting in the <code>shop</code>. When we start our <code>testLevel</code>, we need to turn the <code>Player</code> script back on so they can move and shoot We also add the camera setup from being close up to the shop's display from all the way back on it's z-axis for our <code>testLevel</code> as a temporary fix.</p>
			<ol>
				<li value="4">Replace the content of the <code>CreatePlayer</code> method with the following code to update detection of what ship is in our scene:<pre>    //been shopping
    if(GameObject.Find("UpgradedShip"))
    {
        upgradedShip = true;
    }</pre></li>
			</ol>
			<p>We first need to confirm that the <code>PlayerSpawner</code> script can see whether an upgrade has been purchased in the scene. If a purchase has been made, the modified player ship will carry over to the level scene. If this is the case, we set the <code>upgradedShip</code> variable to <code>true</code>.</p>
			<ol>
				<li value="5">Continuing on with the <code>PlayerSpawner</code> script, and still within the <code>CreatePlayer</code> method, we add an <code>if</code> statement, which instantiates the player:<pre>    //not shopped or died
    //default ship build
    if (!upgradedShip || GameManager.Instance.Died)
    {
        GameManager.Instance.Died = false;
        actorModel = Object.Instantiate(Resources.Load
          ("Player_Default")) 
              as SOActorModel;                                                                                         
        playerShip = GameObject.Instantiate(actorModel.    actor,
          this.transform.position, Quaternion.    Euler(270,180,0))
            as GameObject;
        playerShip.GetComponent&lt;IActorTemplate&gt;().
          ActorStats(actorModel);
    }</pre></li>
			</ol>
			<p>Continuing on<a id="_idIndexMarker631"/> inside the <code>CreatePlayer</code> method, we will now need to check whether there is a player ship in the scene or whether the player has died. If there hasn't been an upgrade or the player has died, we will create a default player ship with the following code.</p>
			<p>Inside the <code>if</code> statement, we create our default player ship by doing the following:</p>
			<ol>
				<li value="1">Set the <code>Died</code> property to <code>false</code> to stop the <code>if</code> statement repeating if the player has died.</li>
				<li>Instantiate the <code>Player_Default</code> scriptable object, which contains all the standard properties for our player's ship, and store it in a variable named <code>actorModel</code>.</li>
				<li>Next, we instantiate our player's ship, position it, and rotate it in the correct direction.</li>
				<li>Finally, in this <code>if</code> statement, we issue the <code>actorModel</code> variable containing all the properties that the player ship game object needs.</li>
			</ol>
			<p>However, if our player has been shopping and bought one or more upgrades, this will <a id="_idIndexMarker632"/>fall into the <code>else</code> condition, where we will find a game object called <code>UpgradedShip</code>. We will attach this game object to our <code>playerShip</code> game object variable.</p>
			<ol>
				<li value="5">Enter the following code to set a store reference to <code>playerShip</code>:<pre>    //apply the shop upgrades
    else
    {
        playerShip = GameObject.Find("UpgradedShip");
    }</pre></li>
			</ol>
			<p>With our <code>playerShip</code> game object stored as an instance, we can now set it up so that it's in the correct position and has the correct size, rotation, and so on.</p>
			<ol>
				<li value="6">Enter the following functions to set our <code>playerShip</code> object up for the start of a game:<pre>    playerShip.transform.rotation = Quaternion.Euler(0,180,0);
    playerShip.transform.localScale = new Vector3(60,60,60);
    playerShip.GetComponentInChildren&lt;ParticleSystem&gt;
      ().transform.localScale = new Vector3(25,25,25);
    playerShip.name = "Player";
    playerShip.transform.SetParent(this.transform);
    playerShip.transform.position = Vector3.zero;
  GameManager.Instance.CameraSetup();
  }
}</pre></li>
			</ol>
			<p>We then move on to the last bit of code for the <code>PlayerSpawner</code> script where our player's ship is set up ready to start. Take note that even if the player purchases an upgrade, this won't create any complications with regard to getting the reference of the player ship.</p>
			<ol>
				<li value="7">Set the rotation so the player's ship faces the correct way.</li>
				<li>Scale the player's ship correctly.</li>
				<li>Turn <a id="_idIndexMarker633"/>the <code>Player</code> script off so the player can't control the ship while it carries out its intro animation.</li>
				<li>Name the player's ship <code>Player</code>.</li>
				<li>Finally, set the player's ship as a child to the <code>playerSpawner</code> game object as it belongs to the <code>playerSpawner</code> game object.</li>
				<li>Go back to the <code>GameManager</code> script, scroll down to <code>void CameraSetup()</code> and change it's access modifier to <code>public</code>. So it reads <code>public void CameraSetup()</code>.</li>
				<li>Save the script.</li>
			</ol>
			<p>We have updated the player's ship so that it is created for a default ship or as a customized one from the shop scene. Also, we have made it aware of the <code>PlayerTransition</code> script so that when the player's ship is created, it won't get stuck in the screen boundaries or the player won't be in a position where they aren't able to control the ship until its introductory animation has finished.  </p>
			<p>Finally, we now need to create and add our <code>b. Shot</code> weapon asset to our game. The majority of the scripting has already been done; it just needs to be attached to the correct components.</p>
			<p>To give our <code>b. Shot</code> prefab weapon its behavior, we need to do the following:</p>
			<ol>
				<li value="1">In the <code>Assets/Resources</code> and select <code>b. Shot</code>.</li>
				<li>Now, in the <code>BShot Component</code> until it appears in the drop-down list, and then select it.</li>
			</ol>
			<p>We now need to apply our <code>bShotComponent</code> to the script.</p>
			<ol>
				<li value="3">Click the small, round remote circle next to the <code>player_BshotBullet</code>, as shown in the following screenshot:</li>
			</ol>
			<div><div><img src="img/Figure_6.17_B18381.jpg" alt="Figure 6.17 – B Shot Component script with player_BshotBullet game object&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.17 – B Shot Component script with player_BshotBullet game object</p>
			<p>Our <code>b. Shot</code> weapon <a id="_idIndexMarker634"/>will now fire. Next, we need to make the bullet travel, following a similar process as we did in <em class="italic">Chapter 2</em>, <em class="italic">Adding and Manipulating Objects</em>, where we made our first player bullet fire and travel across the screen. This means we can use the script we've already made and attach it to the <code>player_BshotBullet</code> prefab.</p>
			<p>To attach and customize the <code>player_BshotBullet</code> prefab, we need to do the following:</p>
			<ol>
				<li value="1">In the <code>Assets/Prefab/Player</code> and select <code>player_BshotBullet</code>.</li>
				<li>In the <code>PlayerBullet</code> until you see it in the drop-down list, and then select it.</li>
				<li>Back in the <code>Assets/ScriptableObject</code>.</li>
				<li>Right-click in the open space on the right side of the <strong class="bold">Project</strong> window and select <strong class="bold">Create</strong> | <strong class="bold">Create Actor</strong>.</li>
				<li>Name the new file in the <code>bShotBullet</code> and select it.</li>
				<li>Give it the following values in the <strong class="bold">Inspector</strong> window:</li>
			</ol>
			<div><div><img src="img/Figure_6.18_B18381.jpg" alt="Figure 6.18 – ShotBullet Scriptable Object and its properties&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.18 – ShotBullet Scriptable Object and its properties</p>
			<p>We are <a id="_idIndexMarker635"/>approaching the end of this chapter. Now is the time to check everything out to see how it all plays out for us:</p>
			<ol>
				<li value="1">Save all the open scripts.</li>
				<li>Save the <strong class="bold">Shop</strong> scene.</li>
				<li>Click on <strong class="bold">Play</strong> mode in the Unity Editor.</li>
				<li>Try and buy all three ship upgrades (you will need to watch a couple of the Unity notification advert displays to get them all).</li>
				<li>Click on the <strong class="bold">START</strong> button and you should see a screen such as the following one with our ship holding all three upgrades:</li>
			</ol>
			<div><div><img src="img/Figure_6.19_B18381.jpg" alt="Figure 6.19 – Our player ship with all the upgrades&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.19 – Our player ship with all the upgrades</p>
			<p>Our player is fully equipped! If the player gets hit, they will lose a shield and the front cover on the ship will disappear. If the ship fires with the firepower upgrade, it will wipe out all the enemies. The atom bomb currently isn't programmed to do anything.</p>
			<p>If you have come across any issues with this final section, you can check the official Unity guide, which also contains other information about adverts and rewards, if you are interested (<a href="https://unityads.unity3d.com/help/unity/integration-guide-unity">https://unityads.unity3d.com/help/unity/integration-guide-unity</a>). Or compare our script and scene with the <code>Complete</code> folder of <code>Chapter6</code> from the downloaded project files link at the beginning of this chapter.</p>
			<p>Congratulations, you have reached the end of this chapter and also the end of the shop scene! Hopefully, you found this beneficial and can appreciate how Unity is keen to encourage developers to look at alternative ways of <a id="_idIndexMarker636"/>making money from a game with adverts instead of simply selling the games they develop. We will now summarize what we covered in this chapter and look at how we will build our game even further.</p>
			<h1 id="_idParaDest-129"><a id="_idTextAnchor131"/>Summary</h1>
			<p>In this chapter, we created a scene that we can interact with to modify our player with in-app purchases and that we can also use to gain more in-game credits by watching adverts on an iPhone or Android phone to buy more items to further upgrade the player. We will look at building the game on mobile in the <a href="B18381_Appendix_Epub.xhtml#_idTextAnchor245"><em class="italic">Appendix</em></a> section of this book, as well as how to hide the <strong class="bold">AD</strong> button on PC/macOS platforms.</p>
			<p>Finally, we carried all the items we bought over into the game, because of which the player's gameplay has been altered thanks to the modifications.</p>
			<p>As mentioned a few times in this chapter, the scene had already been made for us in terms of the art. The reason for this was to allow you to experience raycasting objects and to understand that this is an alternative way of interacting in a scene. But what if the platform we are playing this game on is an iPad? An iPad is more of a square shape, compared to the letterbox shape of an iPhone or Android phone. If this is the case, our game camera would clip parts of our shop scene out. </p>
			<p>You could also think of a more efficient way of using things such as <code>.Find</code> in your coding. If this is a concern of yours, don't worry—we address these issues in <a href="B18381_09_Epub.xhtml#_idTextAnchor161"><em class="italic">Chapter 9</em></a>, <em class="italic">Creating a 2D Shop Interface and In-Game HUD</em>, where we implement Unity's own event system. For now, however, let's look at what we will cover in the next chapter.</p>
			<p>In the next chapter, we are going to link up all of our scenes to create what we refer to as a game loop. This will help us understand the actual game layout as a whole.</p>
		</div>
	</body></html>