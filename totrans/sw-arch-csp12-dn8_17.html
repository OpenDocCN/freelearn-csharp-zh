<html><head></head><body>
<div class="Basic-Text-Frame" id="_idContainer285">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">17</span></h1>
<h1 class="chapterTitle" id="_idParaDest-341"><span class="koboSpan" id="kobo.2.1">Presenting ASP.NET Core</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">In this chapter, you will learn how to implement a web application and a web-based presentation layer. </span><span class="koboSpan" id="kobo.3.2">More specifically, you will learn about ASP.NET Core and how to implement a web application presentation layer based on ASP.NET Core MVC.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.4.1">ASP.NET Core is a .NET framework for implementing web applications. </span><span class="koboSpan" id="kobo.4.2">The ASP.NET Core Web API was partially described in previous chapters, so this chapter will focus mainly on ASP.NET Core in general and on ASP.NET Core MVC. </span><span class="koboSpan" id="kobo.4.3">More specifically, this chapter will cover the following topics:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.5.1">Understanding the presentation layers of web applications</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.6.1">Understanding the basics of ASP.NET Core</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.7.1">Understanding how ASP.NET Core MVC creates the response HTML</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.8.1">Understanding the connection between ASP.NET Core MVC and design principles</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.9.1">We will review and provide further details on the structure of the ASP.NET Core framework, which we discussed in part in earlier chapters. </span><span class="koboSpan" id="kobo.9.2">Here, the main focus is on how to implement web-based presentation </span><a id="_idIndexMarker1176"/><span class="koboSpan" id="kobo.10.1">layers based on the so-called </span><strong class="keyWord"><span class="koboSpan" id="kobo.11.1">Model View Controller</span></strong><span class="koboSpan" id="kobo.12.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.13.1">MVC</span></strong><span class="koboSpan" id="kobo.14.1">) architectural pattern.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.15.1">We will also analyze how server-side HTML is created with ASP.NET Core MVC’s </span><strong class="keyWord"><span class="koboSpan" id="kobo.16.1">Razor</span></strong><span class="koboSpan" id="kobo.17.1"> template language.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.18.1">Each concept is explained using code examples, and </span><em class="chapterRef"><span class="koboSpan" id="kobo.19.1">Chapter 18</span></em><span class="koboSpan" id="kobo.20.1">, </span><em class="italic"><span class="koboSpan" id="kobo.21.1">Implementing Frontend Microservices with ASP.NET Core</span></em><span class="koboSpan" id="kobo.22.1">, is dedicated to the description of a frontend microservice implemented with ASP.NET Core MVC. </span><span class="koboSpan" id="kobo.22.2">For a complete practical example of how to put into practice the general principles discussed in this and the next chapter, please refer to the </span><em class="italic"><span class="koboSpan" id="kobo.23.1">A frontend microservice</span></em><span class="koboSpan" id="kobo.24.1"> section in </span><em class="italic"><span class="koboSpan" id="kobo.25.1">Chapter 21</span></em><span class="koboSpan" id="kobo.26.1">, </span><em class="italic"><span class="koboSpan" id="kobo.27.1">Case Study</span></em><span class="koboSpan" id="kobo.28.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-342"><span class="koboSpan" id="kobo.29.1">Technical requirements</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.30.1">This chapter requires the free Visual Studio 2022 Community edition, ideally with all the database tools installed.</span></p>
<h1 class="heading-1" id="_idParaDest-343"><span class="koboSpan" id="kobo.31.1">Understanding the presentation layers of web applications</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.32.1">This chapter discusses an architecture for implementing the presentation layers of web applications based on the ASP.NET Core framework. </span><span class="koboSpan" id="kobo.32.2">The presentation layers of web applications are based on </span><a id="_idIndexMarker1177"/><span class="koboSpan" id="kobo.33.1">three techniques:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.34.1">Mobile or desktop native applications that exchange data with servers through REST or SOAP services</span></strong><span class="koboSpan" id="kobo.35.1">: We will discuss desktop applications in </span><em class="chapterRef"><span class="koboSpan" id="kobo.36.1">Chapter 19</span></em><span class="koboSpan" id="kobo.37.1">, </span><em class="italic"><span class="koboSpan" id="kobo.38.1">Client Frameworks: Blazor</span></em><span class="koboSpan" id="kobo.39.1">.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.40.1">Single-Page Applications</span></strong><span class="koboSpan" id="kobo.41.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.42.1">SPAs</span></strong><span class="koboSpan" id="kobo.43.1">): These are HTML-based applications whose dynamic HTML is created on </span><a id="_idIndexMarker1178"/><span class="koboSpan" id="kobo.44.1">the client, either in JavaScript or with the help of WebAssembly (a kind of cross-browser assembly that can be used as a high-performance alternative to JavaScript). </span><span class="koboSpan" id="kobo.44.2">Like native applications, SPAs exchange data with the server through HTTP-based APIs, but they have the advantage of being independent of the device and its operating system, since they run in a browser. </span><em class="chapterRef"><span class="koboSpan" id="kobo.45.1">Chapter 19</span></em><span class="koboSpan" id="kobo.46.1">, </span><em class="italic"><span class="koboSpan" id="kobo.47.1">Client Frameworks: Blazor</span></em><span class="koboSpan" id="kobo.48.1">, describes the Blazor SPA framework, which is based on WebAssembly, since it is based itself on a .NET runtime compiled in WebAssembly.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.49.1">HTML pages created by the server whose content depends on the data to be shown to the user</span></strong><span class="koboSpan" id="kobo.50.1">: The ASP.NET Core MVC framework, which will be discussed in this chapter, is a framework for creating such dynamic HTML pages.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.51.1">The remainder of this chapter focuses on how to create HTML pages on the server side and, more specifically, on ASP.NET Core MVC.</span></p>
<h1 class="heading-1" id="_idParaDest-344"><span class="koboSpan" id="kobo.52.1">Understanding the basics of ASP.NET Core</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.53.1">ASP.NET Core is based on the</span><a id="_idIndexMarker1179"/><span class="koboSpan" id="kobo.54.1"> concept of the generic host, as explained in the </span><em class="italic"><span class="koboSpan" id="kobo.55.1">Using generic hosts</span></em><span class="koboSpan" id="kobo.56.1"> subsection of </span><em class="italic"><span class="koboSpan" id="kobo.57.1">Chapter 11</span></em><span class="koboSpan" id="kobo.58.1">, </span><em class="italic"><span class="koboSpan" id="kobo.59.1">Applying a Microservice Architecture to Your Enterprise Application</span></em><span class="koboSpan" id="kobo.60.1">. </span><span class="koboSpan" id="kobo.60.2">The basic architecture of ASP.NET Core was outlined in the </span><em class="italic"><span class="koboSpan" id="kobo.61.1">A short introduction to ASP.NET Core</span></em><span class="koboSpan" id="kobo.62.1"> subsection of </span><em class="italic"><span class="koboSpan" id="kobo.63.1">Chapter 15</span></em><span class="koboSpan" id="kobo.64.1">, </span><em class="italic"><span class="koboSpan" id="kobo.65.1">Applying Service-Oriented Architectures with .NET</span></em><span class="koboSpan" id="kobo.66.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.67.1">It is worth remembering that the host configuration consists mainly of adding services to the </span><strong class="keyWord"><span class="koboSpan" id="kobo.68.1">Dependency Injection</span></strong><span class="koboSpan" id="kobo.69.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.70.1">DI</span></strong><span class="koboSpan" id="kobo.71.1">) engine through</span><a id="_idIndexMarker1180"/><span class="koboSpan" id="kobo.72.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.73.1">Services</span></code><span class="koboSpan" id="kobo.74.1"> property of a host builder instance, whose type implements the </span><code class="inlineCode"><span class="koboSpan" id="kobo.75.1">IServiceCollection</span></code><span class="koboSpan" id="kobo.76.1"> interface:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.77.1">var</span></span><span class="koboSpan" id="kobo.78.1"> builder = WebApplication.CreateBuilder(args);
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.79.1">// Add services to the container.</span></span><span class="koboSpan" id="kobo.80.1">
builder.Services.AddTransient&lt;IMyService, MyService&gt;();
...
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.81.1">// Add services to the container through extension methods.</span></span><span class="koboSpan" id="kobo.82.1">
builder.Services.AddControllersWithViews();
builder.Services.AddAllQueries(</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.83.1">typeof</span></span><span class="koboSpan" id="kobo.84.1">(ManagePackagesController).Assembly);
...
</span><span class="koboSpan" id="kobo.84.2">...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.85.1">var</span></span><span class="koboSpan" id="kobo.86.1"> app = builder.Build();
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.87.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.88.1">IServiceCollection</span></code><span class="koboSpan" id="kobo.89.1"> interface implemented by </span><code class="inlineCode"><span class="koboSpan" id="kobo.90.1">builder.Services</span></code><span class="koboSpan" id="kobo.91.1"> defines all the services that can be injected into object constructors through DI.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.92.1">Services can be defined either by calling the various overloads of </span><code class="inlineCode"><span class="koboSpan" id="kobo.93.1">AddTransient</span></code><span class="koboSpan" id="kobo.94.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.95.1">AddSingleton</span></code><span class="koboSpan" id="kobo.96.1"> directly in </span><code class="inlineCode"><span class="koboSpan" id="kobo.97.1">Program.cs</span></code><span class="koboSpan" id="kobo.98.1">, or by grouping these calls in some </span><code class="inlineCode"><span class="koboSpan" id="kobo.99.1">IServiceCollection</span></code><span class="koboSpan" id="kobo.100.1"> extension methods, which are then called in </span><code class="inlineCode"><span class="koboSpan" id="kobo.101.1">Program.cs</span></code><span class="koboSpan" id="kobo.102.1">. </span><span class="koboSpan" id="kobo.102.2">The way services are handled in .NET is explained in detail in the </span><em class="italic"><span class="koboSpan" id="kobo.103.1">Using generic hosts </span></em><span class="koboSpan" id="kobo.104.1">section of </span><em class="italic"><span class="koboSpan" id="kobo.105.1">Chapter 11</span></em><span class="koboSpan" id="kobo.106.1">. </span><span class="koboSpan" id="kobo.106.2">Here, it is worth pointing out that, together with singleton and transient services, ASP.NET Core also supports another kind of service lifetime, session lifetime, which is the lifetime of a single web request served by the ASP.NET Core application. </span><span class="koboSpan" id="kobo.106.3">Session-scoped services are declared with </span><code class="inlineCode"><span class="koboSpan" id="kobo.107.1">AddScoped</span></code><span class="koboSpan" id="kobo.108.1"> overloads that are completely analogous to the overloads of </span><code class="inlineCode"><span class="koboSpan" id="kobo.109.1">AddTransient</span></code><span class="koboSpan" id="kobo.110.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.111.1">AddSingleton</span></code><span class="koboSpan" id="kobo.112.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.113.1">Session-scoped services are useful for storing data that are specific to a single request that must be used throughout the whole request by several application components. </span><span class="koboSpan" id="kobo.113.2">A typical example of a .NET session-scoped service is the Entity Framework Core </span><code class="inlineCode"><span class="koboSpan" id="kobo.114.1">DBContexts</span></code><span class="koboSpan" id="kobo.115.1">. </span><span class="koboSpan" id="kobo.115.2">In fact, all operations performed on the various aggregates involved in the request must use the same request-specific </span><code class="inlineCode"><span class="koboSpan" id="kobo.116.1">DBContext</span></code><span class="koboSpan" id="kobo.117.1"> so that all changes can be saved to the database in a single transaction, with a unique </span><code class="inlineCode"><span class="koboSpan" id="kobo.118.1">SaveChanges</span></code><span class="koboSpan" id="kobo.119.1"> operation.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.120.1">Practical applications of session-scoped </span><code class="inlineCode"><span class="koboSpan" id="kobo.121.1">DBContext</span></code><span class="koboSpan" id="kobo.122.1">s and other services are described in more detail in </span><em class="italic"><span class="koboSpan" id="kobo.123.1">Chapter 18</span></em><span class="koboSpan" id="kobo.124.1">, </span><em class="italic"><span class="koboSpan" id="kobo.125.1">Implementing Frontend Microservices with ASP.NET Core</span></em><span class="koboSpan" id="kobo.126.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.127.1">Usually, all applications define most of the application configuration through the host builder so that after the host is built with </span><code class="inlineCode"><span class="koboSpan" id="kobo.128.1">var app = builder.Build()</span></code><span class="koboSpan" id="kobo.129.1">, you need to call </span><code class="inlineCode"><span class="koboSpan" id="kobo.130.1">app.Run()</span></code><span class="koboSpan" id="kobo.131.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.132.1">await app.RunAsync()</span></code><span class="koboSpan" id="kobo.133.1"> to launch the application.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.134.1">The ASP.NET Core host instead</span><a id="_idIndexMarker1181"/><span class="koboSpan" id="kobo.135.1"> performs another configuration step after it has been built; it defines the so-called ASP.NET Core HTTP request processing pipeline, which will be described in more detail in the next subsection.</span></p>
<h2 class="heading-2" id="_idParaDest-345"><span class="koboSpan" id="kobo.136.1">ASP.NET Core middleware</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.137.1">ASP.NET Core contains an internal web server called Kestrel that has just the basic web server functionalities. </span><span class="koboSpan" id="kobo.137.2">So in simple applications such as IoT applications, or worker microservices, we can avoid the overhead of a fully optional complex web server like IIS, Apache, or NGINX.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.138.1">If ASP.NET Core is used to implement the </span><a id="_idIndexMarker1182"/><span class="koboSpan" id="kobo.139.1">application layer of a frontend microservice/application or a classic website, Kestrel can be interfaced with all major web servers that proxy their request to Kestrel.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.140.1">In version 8, by default, Kestrel supports all protocols up to and including version HTTP/3.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.141.1">In turn, Kestrel passes all requests to a set of configurable modules that you can assemble according to your needs. </span><span class="koboSpan" id="kobo.141.2">Each module takes care of a functionality that you may or may not need. </span><span class="koboSpan" id="kobo.141.3">Examples of such functionalities include authorization, authentication, static file processing, protocol negotiation, and CORS handling. </span><span class="koboSpan" id="kobo.141.4">Since most of the modules apply transformations to</span><a id="_idIndexMarker1183"/><span class="koboSpan" id="kobo.142.1"> the incoming request and the final response, these modules are usually referred to as </span><strong class="keyWord"><span class="koboSpan" id="kobo.143.1">middleware</span></strong><span class="koboSpan" id="kobo.144.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.145.1">You can put together all the </span><strong class="keyWord"><span class="koboSpan" id="kobo.146.1">middleware</span></strong><span class="koboSpan" id="kobo.147.1"> modules you need by inserting them into a common processing </span><a id="_idIndexMarker1184"/><span class="koboSpan" id="kobo.148.1">framework called the </span><strong class="keyWord"><span class="koboSpan" id="kobo.149.1">ASP.NET Core pipeline</span></strong><span class="koboSpan" id="kobo.150.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.151.1">More specifically, ASP.NET Core requests are processed by pushing a context object through a pipeline of ASP.NET Core modules, as shown in the following diagram:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.152.1"><img alt="" role="presentation" src="../Images/B19820_17_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.153.1">Figure 17.1: ASP.NET Core pipeline</span></p>
<p class="normal"><span class="koboSpan" id="kobo.154.1">The object that is inserted into the</span><a id="_idIndexMarker1185"/><span class="koboSpan" id="kobo.155.1"> pipeline is an </span><code class="inlineCode"><span class="koboSpan" id="kobo.156.1">HttpContext</span></code><span class="koboSpan" id="kobo.157.1"> instance that contains the data of the incoming request. </span><span class="koboSpan" id="kobo.157.2">More specifically, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.158.1">Request</span></code><span class="koboSpan" id="kobo.159.1"> property of </span><code class="inlineCode"><span class="koboSpan" id="kobo.160.1">HttpContext</span></code><span class="koboSpan" id="kobo.161.1"> contains an </span><code class="inlineCode"><span class="koboSpan" id="kobo.162.1">HttpRequest</span></code><span class="koboSpan" id="kobo.163.1"> object whose properties represent the incoming request in a structured way. </span><span class="koboSpan" id="kobo.163.2">There are properties for headers, cookies, the request path, parameters, form fields, and the request body.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.164.1">The various modules can contribute to the construction of the final response that is written in an </span><code class="inlineCode"><span class="koboSpan" id="kobo.165.1">HttpResponse</span></code><span class="koboSpan" id="kobo.166.1"> object, contained in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.167.1">Response</span></code><span class="koboSpan" id="kobo.168.1"> property of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.169.1">HttpContext</span></code><span class="koboSpan" id="kobo.170.1"> instance. </span><span class="koboSpan" id="kobo.170.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.171.1">HttpResponse</span></code><span class="koboSpan" id="kobo.172.1"> class is similar to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.173.1">HttpRequest</span></code><span class="koboSpan" id="kobo.174.1"> class, but its properties refer to the response being built.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.175.1">Some modules can build an intermediate data structure that is then used by other modules in the pipeline. </span><span class="koboSpan" id="kobo.175.2">In general, such intermediary data can be stored in custom entries of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.176.1">IDictionary&lt;object, object&gt;</span></code><span class="koboSpan" id="kobo.177.1">, which is contained in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.178.1">Items</span></code><span class="koboSpan" id="kobo.179.1"> property of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.180.1">HttpContext</span></code><span class="koboSpan" id="kobo.181.1"> object. </span><span class="koboSpan" id="kobo.181.2">However, there is a predefined property, </span><code class="inlineCode"><span class="koboSpan" id="kobo.182.1">User</span></code><span class="koboSpan" id="kobo.183.1">, that contains information about the currently logged-in user. </span><span class="koboSpan" id="kobo.183.2">The logged-in user is not computed automatically, so it must be computed by an authentication module. </span><span class="koboSpan" id="kobo.183.3">The </span><em class="italic"><span class="koboSpan" id="kobo.184.1">ASP.NET Core service authorization</span></em><span class="koboSpan" id="kobo.185.1"> subsection of </span><em class="italic"><span class="koboSpan" id="kobo.186.1">Chapter 15</span></em><span class="koboSpan" id="kobo.187.1">, </span><em class="italic"><span class="koboSpan" id="kobo.188.1">Applying Service-Oriented Architectures with .NET</span></em><span class="koboSpan" id="kobo.189.1">, explained how to add the standard module that performs JWT-based authentication into the ASP.NET Core pipeline.</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.190.1">HttpContext</span></code><span class="koboSpan" id="kobo.191.1"> also has a </span><code class="inlineCode"><span class="koboSpan" id="kobo.192.1">Connection</span></code><span class="koboSpan" id="kobo.193.1"> property that contains information on the underlying connection established with the client, as well as a </span><code class="inlineCode"><span class="koboSpan" id="kobo.194.1">WebSockets</span></code><span class="koboSpan" id="kobo.195.1"> property that contains information on possible WebSocket-based connections established with the clients.</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.196.1">HttpContext</span></code><span class="koboSpan" id="kobo.197.1"> also has a </span><code class="inlineCode"><span class="koboSpan" id="kobo.198.1">Features</span></code><span class="koboSpan" id="kobo.199.1"> property that contains </span><code class="inlineCode"><span class="koboSpan" id="kobo.200.1">IDictionary&lt;Type, object&gt;</span></code><span class="koboSpan" id="kobo.201.1">, which specifies the features supported by the web server that hosts the web application and by the pipeline. </span><span class="koboSpan" id="kobo.201.2">Features can be set using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.202.1">.Set&lt;TFeature&gt;(TFeature o)</span></code><span class="koboSpan" id="kobo.203.1"> method and retrieved using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.204.1">.Get&lt;TFeature&gt;()</span></code><span class="koboSpan" id="kobo.205.1"> method.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.206.1">Web server features are automatically added by the framework, while all other features are added by pipeline modules when they process </span><code class="inlineCode"><span class="koboSpan" id="kobo.207.1">HttpContext</span></code><span class="koboSpan" id="kobo.208.1">.</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.209.1">HttpContext</span></code><span class="koboSpan" id="kobo.210.1"> also gives us access to the DI engine through its </span><code class="inlineCode"><span class="koboSpan" id="kobo.211.1">RequestServices</span></code><span class="koboSpan" id="kobo.212.1"> property. </span><span class="koboSpan" id="kobo.212.2">You can get an instance of a </span><a id="_idIndexMarker1186"/><span class="koboSpan" id="kobo.213.1">type managed by the dependency engine by calling the </span><code class="inlineCode"><span class="koboSpan" id="kobo.214.1">.RequestServices.GetService(Type t)</span></code><span class="koboSpan" id="kobo.215.1"> method or, even better, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.216.1">.GetRequiredService&lt;TService&gt;()</span></code><span class="koboSpan" id="kobo.217.1"> extension method that is built on top of it. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.218.1">However, as we will see in the remainder of this chapter, all types managed by the DI engine are usually automatically injected into constructors, so these methods are only used when we’re building custom </span><strong class="keyWord"><span class="koboSpan" id="kobo.219.1">middleware</span></strong><span class="koboSpan" id="kobo.220.1"> or other customizations of the ASP.NET Core engine.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.221.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.222.1">HttpContext</span></code><span class="koboSpan" id="kobo.223.1"> instance that is created for processing a web request is not only available to modules but also to the application code, through DI. </span><span class="koboSpan" id="kobo.223.2">It is sufficient to insert an </span><code class="inlineCode"><span class="koboSpan" id="kobo.224.1">IHttpContextAccessor</span></code><span class="koboSpan" id="kobo.225.1"> parameter into the constructor of a class that is automatically dependency injected, and then access its </span><code class="inlineCode"><span class="koboSpan" id="kobo.226.1">HttpContext</span></code><span class="koboSpan" id="kobo.227.1"> property. </span><span class="koboSpan" id="kobo.227.2">All controllers that inherit from </span><code class="inlineCode"><span class="koboSpan" id="kobo.228.1">Controller</span></code><span class="koboSpan" id="kobo.229.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.230.1">ControllerBase</span></code><span class="koboSpan" id="kobo.231.1"> (see later in this section) expose an </span><code class="inlineCode"><span class="koboSpan" id="kobo.232.1">HttpContext</span></code><span class="koboSpan" id="kobo.233.1"> property that contains the request </span><code class="inlineCode"><span class="koboSpan" id="kobo.234.1">HttpContext</span></code><span class="koboSpan" id="kobo.235.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.236.1">A middleware module is any class with the following structure:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.237.1">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.238.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.239.1">CoreMiddleware</span></span><span class="koboSpan" id="kobo.240.1">
{
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.241.1">private</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.242.1">readonly</span></span><span class="koboSpan" id="kobo.243.1"> RequestDelegate _next;
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.244.1">public</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.245.1">CoreMiddleware</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.246.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.247.1">RequestDelegate next, ILoggerFactory</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.248.1">    loggerFactory</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.249.1">)</span></span><span class="koboSpan" id="kobo.250.1">
    {
        ...
        </span><span class="koboSpan" id="kobo.250.2">_next = next;
        ...
    </span><span class="koboSpan" id="kobo.250.3">}
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.251.1">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.252.1">async</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.253.1"> Task </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.254.1">InvokeAsync</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.255.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.256.1">HttpContext context</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.257.1">)</span></span><span class="koboSpan" id="kobo.258.1">
    {
        </span><span class="hljs-comment"><span class="koboSpan" id="kobo.259.1">/*</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.260.1">            Insert here the module specific code that processes the</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.261.1">            HttpContext instance before it is passed to the next</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.262.1">            module.</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.263.1">        */</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.264.1">await</span></span><span class="koboSpan" id="kobo.265.1"> _next.Invoke(context);
        </span><span class="hljs-comment"><span class="koboSpan" id="kobo.266.1">/*</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.267.1">            Insert here other module specific code that processes the</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.268.1">            HttpContext instance, after all modules that follow this</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.269.1">            module finished their processing.</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.270.1">        */</span></span><span class="koboSpan" id="kobo.271.1">
    }
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.272.1">It is also possible to pass </span><code class="inlineCode"><span class="koboSpan" id="kobo.273.1">InvokeAsync</span></code><span class="koboSpan" id="kobo.274.1"> directly as a lambda to </span><code class="inlineCode"><span class="koboSpan" id="kobo.275.1">app.Use</span></code><span class="koboSpan" id="kobo.276.1">, as shown here:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.277.1">app.Use(</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.278.1">async</span></span><span class="koboSpan" id="kobo.279.1"> (context, next) =&gt;
{
   ...
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.280.1">await</span></span><span class="koboSpan" id="kobo.281.1"> next(context);
});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.282.1">In general, each piece of middleware processes the </span><code class="inlineCode"><span class="koboSpan" id="kobo.283.1">HttpContext</span></code><span class="koboSpan" id="kobo.284.1"> instance that was passed by the previous module in the pipeline, and then it calls </span><code class="inlineCode"><span class="koboSpan" id="kobo.285.1">await _next.Invoke(context)</span></code><span class="koboSpan" id="kobo.286.1"> to invoke the modules in the remainder of the pipeline. </span><span class="koboSpan" id="kobo.286.2">When the other modules have finished their processing and the</span><a id="_idIndexMarker1187"/><span class="koboSpan" id="kobo.287.1"> response for the client has been prepared, each module can perform further post-processing of the response in the code that follows the </span><code class="inlineCode"><span class="koboSpan" id="kobo.288.1">_next.Invoke(context)</span></code><span class="koboSpan" id="kobo.289.1"> call.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.290.1">Modules are registered in the ASP.NET Core pipeline by calling the </span><code class="inlineCode"><span class="koboSpan" id="kobo.291.1">UseMiddleware&lt;T&gt;</span></code><span class="koboSpan" id="kobo.292.1"> method of the built host, as shown here:</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.293.1">var</span></span><span class="koboSpan" id="kobo.294.1"> app = builder.Build();
...
    </span><span class="koboSpan" id="kobo.294.2">app.UseMiddleware&lt;MyCustomModule&gt;
    ...
    </span><span class="koboSpan" id="kobo.294.3">app.Run();
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.295.1">Middleware modules are inserted into the pipeline in the same order when </span><code class="inlineCode"><span class="koboSpan" id="kobo.296.1">UseMiddleware</span></code><span class="koboSpan" id="kobo.297.1"> is called. </span><span class="koboSpan" id="kobo.297.2">Since each functionality that’s added to an application might require several modules and operations other than adding modules, you usually define an </span><code class="inlineCode"><span class="koboSpan" id="kobo.298.1">IApplicationBuilder</span></code><span class="koboSpan" id="kobo.299.1"> extension such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.300.1">UseMyFunctionality</span></code><span class="koboSpan" id="kobo.301.1">, as shown in the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.302.1">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.303.1">static</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.304.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.305.1">MyMiddlewareExtensions</span></span><span class="koboSpan" id="kobo.306.1">
{
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.307.1">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.308.1">static</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.309.1"> IApplicationBuilder </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.310.1">UseMyFunctionality</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.311.1">(</span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.312.1">this</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.313.1">    IApplicationBuilder builder,...</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.314.1">)</span></span><span class="koboSpan" id="kobo.315.1">
    {
        </span><span class="hljs-comment"><span class="koboSpan" id="kobo.316.1">//other code</span></span><span class="koboSpan" id="kobo.317.1">
        ...
        </span><span class="koboSpan" id="kobo.317.2">builder.UseMiddleware&lt;MyModule1&gt;();
        builder.UseMiddleware&lt;MyModule2&gt;();
        ...
        </span><span class="hljs-comment"><span class="koboSpan" id="kobo.318.1">//Other code</span></span><span class="koboSpan" id="kobo.319.1">
        ...
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.320.1">return</span></span><span class="koboSpan" id="kobo.321.1"> builder;
    }
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.322.1">After that, the whole functionality can be added to the application by calling </span><code class="inlineCode"><span class="koboSpan" id="kobo.323.1">app.UseMyFunctionality(...)</span></code><span class="koboSpan" id="kobo.324.1">. </span><span class="koboSpan" id="kobo.324.2">For instance, the ASP.NET Core MVC functionality can be added to the ASP.NET Core pipeline by calling </span><code class="inlineCode"><span class="koboSpan" id="kobo.325.1">app.UseEndpoints(....)</span></code><span class="koboSpan" id="kobo.326.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.327.1">Often, functionalities that are added with each </span><code class="inlineCode"><span class="koboSpan" id="kobo.328.1">app.Use...</span></code><span class="koboSpan" id="kobo.329.1"> require that some .NET types are added to the </span><a id="_idIndexMarker1188"/><span class="koboSpan" id="kobo.330.1">application DI engine. </span><span class="koboSpan" id="kobo.330.2">In these cases, we also define an </span><code class="inlineCode"><span class="koboSpan" id="kobo.331.1">IServiceCollection</span></code><span class="koboSpan" id="kobo.332.1"> extension named </span><code class="inlineCode"><span class="koboSpan" id="kobo.333.1">AddMyFunctionality</span></code><span class="koboSpan" id="kobo.334.1">, which must be called by </span><code class="inlineCode"><span class="koboSpan" id="kobo.335.1">builder.Services</span></code><span class="koboSpan" id="kobo.336.1"> in </span><code class="inlineCode"><span class="koboSpan" id="kobo.337.1">Program.cs</span></code><span class="koboSpan" id="kobo.338.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.339.1">For instance, ASP.NET Core MVC requires a call such as the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.340.1">builder.Services.AddControllersWithViews(o =&gt;
{
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.341.1">//set here MVC options by modifying the o option parameter</span></span><span class="koboSpan" id="kobo.342.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.343.1">If you don’t need to change the default MVC options, you can simply call </span><code class="inlineCode"><span class="koboSpan" id="kobo.344.1">builder.Services.AddControllersWithViews()</span></code><span class="koboSpan" id="kobo.345.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.346.1">The next subsection describes another important feature of the ASP.NET Core framework – namely, how to handle application configuration data.</span></p>
<h2 class="heading-2" id="_idParaDest-346"><span class="koboSpan" id="kobo.347.1">Loading configuration data and using it with the options framework</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.348.1">Understanding how ASP.NET Core</span><a id="_idIndexMarker1189"/><span class="koboSpan" id="kobo.349.1"> applications handle configuration is crucial for </span><a id="_idIndexMarker1190"/><span class="koboSpan" id="kobo.350.1">effective application setup. </span><span class="koboSpan" id="kobo.350.2">In the default .NET template where an ASP.NET Core application starts, it reads configuration information (such as a database connection string) from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.351.1">appsettings.json</span></code><span class="koboSpan" id="kobo.352.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.353.1">appsettings.[EnvironmentName].json</span></code><span class="koboSpan" id="kobo.354.1"> files, where </span><code class="inlineCode"><span class="koboSpan" id="kobo.355.1">EnvironmentName</span></code><span class="koboSpan" id="kobo.356.1"> is a string value that depends on where the application is deployed.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.357.1">Typical values for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.358.1">EnvironmentName</span></code><span class="koboSpan" id="kobo.359.1"> string are as follows:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.360.1">Production</span></code><span class="koboSpan" id="kobo.361.1"> is used for production deployment</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.362.1">Development</span></code><span class="koboSpan" id="kobo.363.1"> is used during development</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.364.1">Staging</span></code><span class="koboSpan" id="kobo.365.1"> is used when the application is tested in staging</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.366.1">The two JSON trees that were extracted from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.367.1">appsettings.json</span></code><span class="koboSpan" id="kobo.368.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.369.1">appsettings.[EnvironmentName].json</span></code><span class="koboSpan" id="kobo.370.1"> files are merged into a unique tree, where the values contained in </span><code class="inlineCode"><span class="koboSpan" id="kobo.371.1">[EnvironmentName].json</span></code><span class="koboSpan" id="kobo.372.1"> override the values contained in the corresponding paths of </span><code class="inlineCode"><span class="koboSpan" id="kobo.373.1">appsettings.json</span></code><span class="koboSpan" id="kobo.374.1">. </span><span class="koboSpan" id="kobo.374.2">This way, the </span><a id="_idIndexMarker1191"/><span class="koboSpan" id="kobo.375.1">application can be run with different configurations in different</span><a id="_idIndexMarker1192"/><span class="koboSpan" id="kobo.376.1"> deployment environments. </span><span class="koboSpan" id="kobo.376.2">In particular, you can use a different database connection string and, hence, a different database instance in each different environment.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.377.1"><img alt="" role="presentation" src="../Images/B19820_17_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.378.1">Figure 17.2: Configuration files merging</span></p>
<p class="normal"><span class="koboSpan" id="kobo.379.1">Configuration information can also be passed from other sources. </span><span class="koboSpan" id="kobo.379.2">Given a lack of space, we list here all the other possibilities without discussing them:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.380.1">XML files</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.381.1">.ini</span></code><span class="koboSpan" id="kobo.382.1"> files</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.383.1">Operating system environment variables. </span><span class="koboSpan" id="kobo.383.2">The variable name is the name of the setting prefixed by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.384.1">ASPNETCORE_</span></code><span class="koboSpan" id="kobo.385.1"> string, while the variable value is the setting value.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.386.1">Command-line arguments of a </span><code class="inlineCode"><span class="koboSpan" id="kobo.387.1">dotnet</span></code><span class="koboSpan" id="kobo.388.1"> command that invokes the application.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.389.1">An in-memory collection of key-value pairs</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.390.1">The JSON format is, in my opinion, the most practical and readable, but JSON, XML, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.391.1">.ini</span></code><span class="koboSpan" id="kobo.392.1"> are substantially equivalent, and choosing among them is just a matter of preference.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.393.1">In memory, collections of key-value pairs offer the possibility of taking data from a database, so they are useful options</span><a id="_idIndexMarker1193"/><span class="koboSpan" id="kobo.394.1"> for those parameters that need to be changed by an administrator while the</span><a id="_idIndexMarker1194"/><span class="koboSpan" id="kobo.395.1"> application is running.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.396.1">Finally, command-line arguments and environment variables are good options when the application can’t easily access disk storage – for instance, in the case of deployments running in a Kubernetes cluster. </span><span class="koboSpan" id="kobo.396.2">In fact, environment variables can be passed as parameters in the Kubernetes </span><code class="inlineCode"><span class="koboSpan" id="kobo.397.1">.yaml</span></code><span class="koboSpan" id="kobo.398.1"> files (see the </span><em class="italic"><span class="koboSpan" id="kobo.399.1">ReplicaSets and Deployments</span></em><span class="koboSpan" id="kobo.400.1"> section of </span><em class="italic"><span class="koboSpan" id="kobo.401.1">Chapter 20, Kubernetes</span></em><span class="koboSpan" id="kobo.402.1">). </span><span class="koboSpan" id="kobo.402.2">They are also an acceptable choice for passing sensitive data that it is not adequate to store in files in a plain format.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.403.1">From version 8 onward, ASP.NET Core allows you to set Kestrel HTTP and HTTPS listening ports as configuration variables. </span><span class="koboSpan" id="kobo.403.2">More specifically, </span><code class="inlineCode"><span class="koboSpan" id="kobo.404.1">HTTP_PORTS</span></code><span class="koboSpan" id="kobo.405.1"> contains a semicolon-separated list of all Kestrel HTTP listening ports, while </span><code class="inlineCode"><span class="koboSpan" id="kobo.406.1">HTTPS_PORTS</span></code><span class="koboSpan" id="kobo.407.1"> contains a semicolon-separated list of all HTTPs listening ports whose defaults are the usual HTTP and HTTPs ports, that is, </span><code class="inlineCode"><span class="koboSpan" id="kobo.408.1">80</span></code><span class="koboSpan" id="kobo.409.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.410.1">443</span></code><span class="koboSpan" id="kobo.411.1">, respectively.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.412.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.413.1">[EnvironmentName]</span></code><span class="koboSpan" id="kobo.414.1"> string itself is taken from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.415.1">ENVIRONMENT</span></code><span class="koboSpan" id="kobo.416.1"> configuration setting. </span><span class="koboSpan" id="kobo.416.2">Clearly, since it is needed to decide which configuration files to use, it cannot be contained in a configuration file, so it must be taken from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.417.1">ASPNETCORE_ENVIRONMENT</span></code><span class="koboSpan" id="kobo.418.1"> operating system environment variable, or from the arguments of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.419.1">dotnet</span></code><span class="koboSpan" id="kobo.420.1"> command used to launch the application.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.421.1">When the application is deployed to IIS instead of being launched as a standalone program, </span><code class="inlineCode"><span class="koboSpan" id="kobo.422.1">ASPNETCORE_ENVIRONMENT</span></code><span class="koboSpan" id="kobo.423.1"> can’t be passed on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.424.1">dotnet</span></code><span class="koboSpan" id="kobo.425.1"> command line.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.426.1">In this case, it can be set in the IIS application settings. </span><span class="koboSpan" id="kobo.426.2">This can be done after the applications have been deployed, by clicking on the Configuration Editor and then selecting the </span><code class="inlineCode"><span class="koboSpan" id="kobo.427.1">system.webServer/aspNetCore</span></code><span class="koboSpan" id="kobo.428.1"> section. </span><span class="koboSpan" id="kobo.428.2">In the</span><a id="_idIndexMarker1195"/><span class="koboSpan" id="kobo.429.1"> window that opens, select </span><code class="inlineCode"><span class="koboSpan" id="kobo.430.1">environmentVariables</span></code><span class="koboSpan" id="kobo.431.1">, and then</span><a id="_idIndexMarker1196"/><span class="koboSpan" id="kobo.432.1"> add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.433.1">ASPNETCORE_ENVIRONMENT</span></code><span class="koboSpan" id="kobo.434.1"> variable with its value.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.435.1"><img alt="" role="presentation" src="../Images/B19820_17_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.436.1">Figure 17.3: Changing ASPNETCORE_ENVIRONMENT in IIS</span></p>
<p class="normal"><span class="koboSpan" id="kobo.437.1">However, when the application is modified and deployed again, the setting is reset to its default value, which is </span><code class="inlineCode"><span class="koboSpan" id="kobo.438.1">Production</span></code><span class="koboSpan" id="kobo.439.1">, and it must be set again.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.440.1">A better choice is to modify the publish profile in Visual Studio, as follows:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.441.1">During Visual Studio deployment, Visual Studio’s </span><strong class="screenText"><span class="koboSpan" id="kobo.442.1">Publish</span></strong><span class="koboSpan" id="kobo.443.1"> wizard creates an XML publish profile. </span><span class="koboSpan" id="kobo.443.2">Once the preferred deployment type (Azure, Web Deploy, folder, and so on) has been chosen, and before publishing, you can edit the publish settings by choosing </span><strong class="screenText"><span class="koboSpan" id="kobo.444.1">Edit</span></strong><span class="koboSpan" id="kobo.445.1"> from the </span><strong class="screenText"><span class="koboSpan" id="kobo.446.1">More actions</span></strong><span class="koboSpan" id="kobo.447.1"> dropdown in the window that appears.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.448.1">Once you have your publish file properly set, in Visual Studio </span><strong class="screenText"><span class="koboSpan" id="kobo.449.1">Solution Explorer</span></strong><span class="koboSpan" id="kobo.450.1">, open the profile that you just prepared with the Visual Studio wizard. </span><span class="koboSpan" id="kobo.450.2">Profiles are saved in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.451.1">Properties/PublishProfiles/&lt;profile name&gt;.pubxml</span></code><span class="koboSpan" id="kobo.452.1"> path of the project folder.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.453.1">Then, edit the profile with a text editor, and add an XML property such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.454.1">&lt;EnvironmentName&gt;Staging&lt;/EnvironmentName&gt;</span></code><span class="koboSpan" id="kobo.455.1">. </span><span class="koboSpan" id="kobo.455.2">Since all the already defined publish profiles can be selected during the application’s publication, you can define a different publish profile for each of your environments, and then, you can select the one you need during each publication.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.456.1">The value you must set </span><code class="inlineCode"><span class="koboSpan" id="kobo.457.1">ASPNETCORE_ENVIRONMENT</span></code><span class="koboSpan" id="kobo.458.1"> to during deployment can also be specified in the Visual Studio ASP.NET Core project file (</span><code class="inlineCode"><span class="koboSpan" id="kobo.459.1">.csproj</span></code><span class="koboSpan" id="kobo.460.1">) of your application, by adding the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.461.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.462.1">PropertyGroup</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.463.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.464.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.465.1">EnvironmentName</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.466.1">&gt;</span></span><span class="koboSpan" id="kobo.467.1">Staging</span><span class="hljs-tag"><span class="koboSpan" id="kobo.468.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.469.1">EnvironmentName</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.470.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.471.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.472.1">PropertyGroup</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.473.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.474.1">This is the simplest way to do </span><code class="inlineCode"><span class="koboSpan" id="kobo.475.1">ASPNETCORE_ENVIRONMENT</span></code><span class="koboSpan" id="kobo.476.1">, but not the most modular, since we are forced to change the application</span><a id="_idIndexMarker1197"/><span class="koboSpan" id="kobo.477.1"> code before publishing to a different environment.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.478.1">Specifying the environment either in</span><a id="_idIndexMarker1198"/><span class="koboSpan" id="kobo.479.1"> the publish profile or the project file works only for deployment types based on direct communication between Visual Studio and the web server, as in other deployment types, Visual Studio cannot inform the web server on how to set </span><code class="inlineCode"><span class="koboSpan" id="kobo.480.1">ASPNETCORE_ENVIRONMENT</span></code><span class="koboSpan" id="kobo.481.1"> or on how to pass the environment when the application is launched. </span><span class="koboSpan" id="kobo.481.2">At the time of writing, the techniques described work just for Web Deploy or when publishing on Azure.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.482.1">During development in Visual Studio, the value to give to </span><code class="inlineCode"><span class="koboSpan" id="kobo.483.1">ASPNETCORE_ENVIRONMENT</span></code><span class="koboSpan" id="kobo.484.1"> when the application is run can be specified in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.485.1">Properties\launchSettings.json</span></code><span class="koboSpan" id="kobo.486.1"> file of the ASP.NET Core project. </span><span class="koboSpan" id="kobo.486.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.487.1">launchSettings.json</span></code><span class="koboSpan" id="kobo.488.1"> file contains several named groups of settings. </span><span class="koboSpan" id="kobo.488.2">These settings configure how to launch the web application when it is run from Visual Studio. </span><span class="koboSpan" id="kobo.488.3">You can choose to apply all the settings of a group by selecting the group name with the drop-down list next to Visual Studio’s run button:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.489.1"><img alt="" role="presentation" src="../Images/B19820_17_04.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.490.1">Figure 17.4: Choice of launch settings group</span></p>
<p class="normal"><span class="koboSpan" id="kobo.491.1">Your selection from this drop-down list will be visible on the run button, with the default selection being </span><strong class="keyWord"><span class="koboSpan" id="kobo.492.1">IIS Express</span></strong><span class="koboSpan" id="kobo.493.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.494.1">Consider a development environment setup, as illustrated in this typical </span><code class="inlineCode"><span class="koboSpan" id="kobo.495.1">launchSettings.json</span></code><span class="koboSpan" id="kobo.496.1"> file:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.497.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.498.1">"iisSettings"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.499.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.500.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.501.1">"windowsAuthentication"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.502.1">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.503.1">false</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.504.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.505.1">"anonymousAuthentication"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.506.1">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.507.1">true</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.508.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.509.1">"iisExpress"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.510.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.511.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.512.1">"applicationUrl"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.513.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.514.1">"http://localhost:2575"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.515.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.516.1">"sslPort"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.517.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.518.1">44393</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.519.1">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.520.1">},</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.521.1">"profiles"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.522.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.523.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.524.1">"IIS Express"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.525.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.526.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.527.1">"commandName"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.528.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.529.1">"IISExpress"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.530.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.531.1">"launchBrowser"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.532.1">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.533.1">true</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.534.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.535.1">"</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.536.1">environmentVariables"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.537.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.538.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.539.1">"ASPNETCORE_ENVIRONMENT"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.540.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.541.1">"Development"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.542.1">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.543.1">},</span></span><span class="koboSpan" id="kobo.544.1">
    ...
    </span><span class="koboSpan" id="kobo.544.2">...
    </span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.545.1">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.546.1">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.547.1">}</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.548.1">The named groups of settings are under the </span><code class="inlineCode"><span class="koboSpan" id="kobo.549.1">profiles</span></code><span class="koboSpan" id="kobo.550.1"> properties. </span><span class="koboSpan" id="kobo.550.2">There, you can choose where to host the application (</span><code class="inlineCode"><span class="koboSpan" id="kobo.551.1">IIS Express</span></code><span class="koboSpan" id="kobo.552.1">), where to launch the browser, and the values of some environment variables.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.553.1">The current</span><a id="_idIndexMarker1199"/><span class="koboSpan" id="kobo.554.1"> environment that’s been loaded from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.555.1">ASPNETCORE_ENVIRONMENT</span></code><span class="koboSpan" id="kobo.556.1"> operating system environment</span><a id="_idIndexMarker1200"/><span class="koboSpan" id="kobo.557.1"> variable is available in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.558.1">app.Environment</span></code><span class="koboSpan" id="kobo.559.1"> property during the ASP.NET Core pipeline definition.</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.560.1">app.Environment.IsEnvironment(string environmentName)</span></code><span class="koboSpan" id="kobo.561.1"> checks whether the current value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.562.1">ASPNETCORE_ENVIRONMENT</span></code><span class="koboSpan" id="kobo.563.1"> is </span><code class="inlineCode"><span class="koboSpan" id="kobo.564.1">environmentName</span></code><span class="koboSpan" id="kobo.565.1">. </span><span class="koboSpan" id="kobo.565.2">There are also specific shortcuts for testing development (</span><code class="inlineCode"><span class="koboSpan" id="kobo.566.1">.IsDevelopment()</span></code><span class="koboSpan" id="kobo.567.1">), production (</span><code class="inlineCode"><span class="koboSpan" id="kobo.568.1">.IsProduction()</span></code><span class="koboSpan" id="kobo.569.1">), and staging (</span><code class="inlineCode"><span class="koboSpan" id="kobo.570.1">.IsStaging()</span></code><span class="koboSpan" id="kobo.571.1">). </span><span class="koboSpan" id="kobo.571.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.572.1">app.Environment</span></code><span class="koboSpan" id="kobo.573.1"> property also contains the current root directory of the ASP.NET Core application (</span><code class="inlineCode"><span class="koboSpan" id="kobo.574.1">.WebRootPath</span></code><span class="koboSpan" id="kobo.575.1">) and the directory reserved for the static files (</span><code class="inlineCode"><span class="koboSpan" id="kobo.576.1">.ContentRootPath</span></code><span class="koboSpan" id="kobo.577.1">) that are served as is by the web server (CSS, JavaScript, images, and so on).</span></p>
<p class="normal"><span class="koboSpan" id="kobo.578.1">Both </span><code class="inlineCode"><span class="koboSpan" id="kobo.579.1">launchSettings.json</span></code><span class="koboSpan" id="kobo.580.1"> and all publish profiles can be accessed as children of the </span><strong class="keyWord"><span class="koboSpan" id="kobo.581.1">Properties</span></strong><span class="koboSpan" id="kobo.582.1"> node in Visual Studio Explorer, as shown in the following screenshot:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.583.1"><img alt="Graphical user interface, text  Description automatically generated" src="../Images/B19820_17_05.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.584.1">Figure 17.5: Launch settings file</span></p>
<p class="normal"><span class="koboSpan" id="kobo.585.1">Understanding how to map the merged configuration settings to .NET objects is key for effective data management in ASP.NET Core applications.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.586.1">Once </span><code class="inlineCode"><span class="koboSpan" id="kobo.587.1">appsettings.json</span></code><span class="koboSpan" id="kobo.588.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.589.1">appsettings.[EnvironmentName].json</span></code><span class="koboSpan" id="kobo.590.1"> have been loaded, the configuration tree resulting from</span><a id="_idIndexMarker1201"/><span class="koboSpan" id="kobo.591.1"> their merge can be mapped to the properties of .NET objects. </span><span class="koboSpan" id="kobo.591.2">For example, let’s </span><a id="_idIndexMarker1202"/><span class="koboSpan" id="kobo.592.1">suppose we have an </span><code class="inlineCode"><span class="koboSpan" id="kobo.593.1">Email</span></code><span class="koboSpan" id="kobo.594.1"> section of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.595.1">appsettings</span></code><span class="koboSpan" id="kobo.596.1"> file that contains all of the information needed to connect to an email server, as shown here:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.597.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.598.1">"ConnectionStrings"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.599.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.600.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.601.1">"DefaultConnection"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.602.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.603.1">"...."</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.604.1">},</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.605.1">"Logging"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.606.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.607.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.608.1">"LogLevel"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.609.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.610.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.611.1">"Default"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.612.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.613.1">"Warning"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.614.1">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.615.1">},</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.616.1">"Email"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.617.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.618.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.619.1">"FromName"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.620.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.621.1">"MyName"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.622.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.623.1">"FromAddress"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.624.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.625.1">"info@MyDomain.com"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.626.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.627.1">"LocalDomain"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.628.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.629.1">"smtps.MyDomain.com"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.630.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.631.1">"</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.632.1">MailServerAddress"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.633.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.634.1">"smtps.MyDomain.com"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.635.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.636.1">"MailServerPort"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.637.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.638.1">"465"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.639.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.640.1">"UserId"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.641.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.642.1">"info@MyDomain.com"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.643.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.644.1">"UserPassword"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.645.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.646.1">"mypassword"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.647.1">}</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.648.1">Then, the whole </span><code class="inlineCode"><span class="koboSpan" id="kobo.649.1">Email</span></code><span class="koboSpan" id="kobo.650.1"> section can be mapped to an instance of the following class:</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.651.1">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.652.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.653.1">EmailConfig</span></span><span class="koboSpan" id="kobo.654.1">
    {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.655.1">public</span></span><span class="koboSpan" id="kobo.656.1"> String FromName { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.657.1">get</span></span><span class="koboSpan" id="kobo.658.1">; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.659.1">set</span></span><span class="koboSpan" id="kobo.660.1">; }
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.661.1">public</span></span><span class="koboSpan" id="kobo.662.1"> String FromAddress { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.663.1">get</span></span><span class="koboSpan" id="kobo.664.1">; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.665.1">set</span></span><span class="koboSpan" id="kobo.666.1">; }
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.667.1">public</span></span><span class="koboSpan" id="kobo.668.1"> String LocalDomain { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.669.1">get</span></span><span class="koboSpan" id="kobo.670.1">; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.671.1">set</span></span><span class="koboSpan" id="kobo.672.1">; }
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.673.1">public</span></span><span class="koboSpan" id="kobo.674.1"> String MailServerAddress { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.675.1">get</span></span><span class="koboSpan" id="kobo.676.1">; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.677.1">set</span></span><span class="koboSpan" id="kobo.678.1">; }
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.679.1">public</span></span><span class="koboSpan" id="kobo.680.1"> String MailServerPort { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.681.1">get</span></span><span class="koboSpan" id="kobo.682.1">; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.683.1">set</span></span><span class="koboSpan" id="kobo.684.1">; }
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.685.1">public</span></span><span class="koboSpan" id="kobo.686.1"> String UserId { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.687.1">get</span></span><span class="koboSpan" id="kobo.688.1">; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.689.1">set</span></span><span class="koboSpan" id="kobo.690.1">; }
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.691.1">public</span></span><span class="koboSpan" id="kobo.692.1"> String UserPassword { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.693.1">get</span></span><span class="koboSpan" id="kobo.694.1">; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.695.1">set</span></span><span class="koboSpan" id="kobo.696.1">; }
    }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.697.1">The code that performs the mapping must be inserted in the host building stage, since the </span><code class="inlineCode"><span class="koboSpan" id="kobo.698.1">EmailConfig</span></code><span class="koboSpan" id="kobo.699.1"> instance will be available </span><a id="_idIndexMarker1203"/><span class="koboSpan" id="kobo.700.1">through DI. </span><span class="koboSpan" id="kobo.700.2">The code we need is shown here:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.701.1">Var builder = WebApplication.CreateBuilder(args);
....
</span><span class="koboSpan" id="kobo.701.2">builder.Services.Configure&lt;EmailConfig&gt;(Configuration.GetSection(</span><span class="hljs-string"><span class="koboSpan" id="kobo.702.1">"Email"</span></span><span class="koboSpan" id="kobo.703.1">));
    ..
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.704.1">Once we’ve configured the</span><a id="_idIndexMarker1204"/><span class="koboSpan" id="kobo.705.1"> preceding settings, classes that need </span><code class="inlineCode"><span class="koboSpan" id="kobo.706.1">EmailConfig</span></code><span class="koboSpan" id="kobo.707.1"> data must declare an </span><code class="inlineCode"><span class="koboSpan" id="kobo.708.1">IOptions&lt;EmailConfig&gt; options</span></code><span class="koboSpan" id="kobo.709.1"> constructor parameter that will be provided by the DI engine. </span><span class="koboSpan" id="kobo.709.2">An </span><code class="inlineCode"><span class="koboSpan" id="kobo.710.1">EmailConfig</span></code><span class="koboSpan" id="kobo.711.1"> instance is contained in </span><code class="inlineCode"><span class="koboSpan" id="kobo.712.1">options.Value</span></code><span class="koboSpan" id="kobo.713.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.714.1">It is worth mentioning that the option classes’ properties can be applied to the same validation attributes we will use for ViewModels (see the </span><em class="italic"><span class="koboSpan" id="kobo.715.1">Server-side and client-side validation</span></em><span class="koboSpan" id="kobo.716.1"> subsection).</span></p>
<p class="normal"><span class="koboSpan" id="kobo.717.1">The next subsection describes the basic ASP.NET Core pipeline modules needed by an ASP.NET Core MVC application.</span></p>
<h2 class="heading-2" id="_idParaDest-347"><span class="koboSpan" id="kobo.718.1">Defining the ASP.NET Core pipeline</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.719.1">Understanding the ASP.NET Core pipeline is key to customizing application behavior. </span><span class="koboSpan" id="kobo.719.2">When you create a new ASP.NET Core </span><a id="_idIndexMarker1205"/><span class="koboSpan" id="kobo.720.1">MVC project in Visual Studio, a standard pipeline is created in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.721.1">Program.cs</span></code><span class="koboSpan" id="kobo.722.1"> file. </span><span class="koboSpan" id="kobo.722.2">There, if needed, you can add further middleware or change the configuration of the existing middleware.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.723.1">The initial pipeline definition code handles errors and performs basic HTTPS configuration:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.724.1">if</span></span><span class="koboSpan" id="kobo.725.1"> (app.Environment.IsDevelopment())
{
   
   
}
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.726.1">else</span></span> <span class="hljs-comment"><span class="koboSpan" id="kobo.727.1">//this is not part of the project template, but it is worth adding it</span></span><span class="koboSpan" id="kobo.728.1">
{
    app.UseDeveloperExceptionPage();
}
app.UseHttpsRedirection();
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.729.1">If there are errors, and if the application is in a development environment, the module installed by </span><code class="inlineCode"><span class="koboSpan" id="kobo.730.1">UseDeveloperExceptionPage</span></code><span class="koboSpan" id="kobo.731.1"> adds a detailed error report to the response. </span><span class="koboSpan" id="kobo.731.2">This module is a valuable debugging tool.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.732.1">If an error occurs when the application is not in development mode, </span><code class="inlineCode"><span class="koboSpan" id="kobo.733.1">UseExceptionHandler</span></code><span class="koboSpan" id="kobo.734.1"> restores the request processing from the path it receives as an argument, that is, from </span><code class="inlineCode"><span class="koboSpan" id="kobo.735.1">/Home/Error</span></code><span class="koboSpan" id="kobo.736.1">. </span><span class="koboSpan" id="kobo.736.2">In other words, it simulates a new request with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.737.1">/Home/Error</span></code><span class="koboSpan" id="kobo.738.1"> path. </span><span class="koboSpan" id="kobo.738.2">This request is pushed into the standard MVC processing until it reaches the endpoint associated </span><a id="_idIndexMarker1206"/><span class="koboSpan" id="kobo.739.1">with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.740.1">/Home/Error</span></code><span class="koboSpan" id="kobo.741.1"> path, where the developer is expected to place the custom code that handles the error.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.742.1">When the application is not in development, </span><code class="inlineCode"><span class="koboSpan" id="kobo.743.1">UseHsts</span></code><span class="koboSpan" id="kobo.744.1"> adds the </span><code class="inlineCode"><span class="koboSpan" id="kobo.745.1">Strict-Transport-Security</span></code><span class="koboSpan" id="kobo.746.1"> header to the response, which informs the browser that the application must only be accessed with HTTPS. </span><span class="koboSpan" id="kobo.746.2">After this declaration, compliant browsers should automatically convert any HTTP request of the application into an HTTPS request for the time specified in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.747.1">Strict-Transport-Security</span></code><span class="koboSpan" id="kobo.748.1"> header. </span><span class="koboSpan" id="kobo.748.2">By default, </span><code class="inlineCode"><span class="koboSpan" id="kobo.749.1">UseHsts</span></code><span class="koboSpan" id="kobo.750.1"> specifies 30 days as the time in the header, but you can specify a different time and other header parameters by passing </span><code class="inlineCode"><span class="koboSpan" id="kobo.751.1">UseHsts</span></code><span class="koboSpan" id="kobo.752.1"> a lambda that configures an </span><code class="inlineCode"><span class="koboSpan" id="kobo.753.1">options</span></code><span class="koboSpan" id="kobo.754.1"> object:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.755.1">builder.Services.AddHsts(options =&gt;     {
    ...
    </span><span class="koboSpan" id="kobo.755.2">options.MaxAge = TimeSpan.FromDays(</span><span class="hljs-number"><span class="koboSpan" id="kobo.756.1">60</span></span><span class="koboSpan" id="kobo.757.1">);
    ...
</span><span class="koboSpan" id="kobo.757.2">});
</span></code></pre>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.758.1">UseHttpsRedirection</span></code><span class="koboSpan" id="kobo.759.1"> causes an automatic redirection to an HTTPS URL when an HTTP URL is received, in a way that forces a secure connection. </span><span class="koboSpan" id="kobo.759.2">Once the first HTTPS secure connection is established, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.760.1">Strict-Transport-Security</span></code><span class="koboSpan" id="kobo.761.1"> header prevents future redirections that might be used to perform man-in-the-middle attacks.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.762.1">The following code shows the remainder of the default pipeline:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.763.1">app.UseStaticFiles();
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.764.1">// not in the default template but needed in all countries of the European Union</span></span><span class="koboSpan" id="kobo.765.1">
app.UseCookiePolicy();
app.UseRouting();
app.UseAuthentication();
app.UseAuthorization();
...
</span></code></pre>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.766.1">UseStaticFiles</span></code><span class="koboSpan" id="kobo.767.1"> makes all files contained in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.768.1">wwwroot</span></code><span class="koboSpan" id="kobo.769.1"> folder of the project (typically CSS, JavaScript, images, and font files) accessible from the web through their actual path.</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.770.1">UseCookiePolicy</span></code><span class="koboSpan" id="kobo.771.1"> has been removed in the .NET 5-8 templates, but you can still add it manually. </span><span class="koboSpan" id="kobo.771.2">It ensures that cookies are processed by the ASP.NET Core pipeline, but only if the user has given consent for cookie usage. </span><span class="koboSpan" id="kobo.771.3">Consent to cookie usage is given through a consent cookie; that is, cookie processing is enabled only if this consent cookie is found among the request cookies. </span><span class="koboSpan" id="kobo.771.4">This </span><a id="_idIndexMarker1207"/><span class="koboSpan" id="kobo.772.1">cookie must be created by JavaScript when the user clicks a consent button. </span><span class="koboSpan" id="kobo.772.2">The whole string that contains both the consent cookie’s name and its contents can be retrieved from </span><code class="inlineCode"><span class="koboSpan" id="kobo.773.1">HttpContext.Features</span></code><span class="koboSpan" id="kobo.774.1">, as shown in the following snippet:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.775.1">var</span></span><span class="koboSpan" id="kobo.776.1"> consentFeature = context.Features.Get&lt;ITrackingConsentFeature&gt;();
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.777.1">var</span></span><span class="koboSpan" id="kobo.778.1"> showBanner = !consentFeature?.CanTrack ?? </span><span class="hljs-literal"><span class="koboSpan" id="kobo.779.1">false</span></span><span class="koboSpan" id="kobo.780.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.781.1">var</span></span><span class="koboSpan" id="kobo.782.1"> cookieString = consentFeature?.CreateConsentCookie();
</span></code></pre>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.783.1">CanTrack</span></code><span class="koboSpan" id="kobo.784.1"> is </span><code class="inlineCode"><span class="koboSpan" id="kobo.785.1">true</span></code><span class="koboSpan" id="kobo.786.1"> only if consent is required and has not been given yet. </span><span class="koboSpan" id="kobo.786.2">When the consent cookie is detected, </span><code class="inlineCode"><span class="koboSpan" id="kobo.787.1">CanTrack</span></code><span class="koboSpan" id="kobo.788.1"> is set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.789.1">false</span></code><span class="koboSpan" id="kobo.790.1">. </span><span class="koboSpan" id="kobo.790.2">This way, </span><code class="inlineCode"><span class="koboSpan" id="kobo.791.1">showBanner</span></code><span class="koboSpan" id="kobo.792.1"> is </span><code class="inlineCode"><span class="koboSpan" id="kobo.793.1">true</span></code><span class="koboSpan" id="kobo.794.1"> only if consent is required and has not been given yet. </span><span class="koboSpan" id="kobo.794.2">Therefore, it tells us whether to ask the user for consent.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.795.1">The options for the consent module are contained in a </span><code class="inlineCode"><span class="koboSpan" id="kobo.796.1">CookiePolicyOptions</span></code><span class="koboSpan" id="kobo.797.1"> instance that must be configured manually with the options framework. </span><span class="koboSpan" id="kobo.797.2">The following code snippet shows the default configuration code scaffolded by Visual Studio that configures </span><code class="inlineCode"><span class="koboSpan" id="kobo.798.1">CookiePolicyOptions</span></code><span class="koboSpan" id="kobo.799.1"> in the code, instead of using the configuration file:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.800.1">builder.Services.Configure&lt;CookiePolicyOptions&gt;(options =&gt;
{
    options.CheckConsentNeeded = context =&gt; </span><span class="hljs-literal"><span class="koboSpan" id="kobo.801.1">true</span></span><span class="koboSpan" id="kobo.802.1">;
});
</span></code></pre>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.803.1">UseAuthentication</span></code><span class="koboSpan" id="kobo.804.1"> enables authentication schemes and only appears if you select an authentication scheme when the project is created. </span><span class="koboSpan" id="kobo.804.2">More specifically, this middleware decodes the authorization tokens (authorization cookies, bearer tokens, etc.), and it uses the information it contains to build a </span><code class="inlineCode"><span class="koboSpan" id="kobo.805.1">ClaimsPrincipal</span></code><span class="koboSpan" id="kobo.806.1"> object that is placed in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.807.1">HttpContext.User</span></code><span class="koboSpan" id="kobo.808.1"> property.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.809.1">Specific authentication schemes can be enabled by configuring the options objects in the host building stage, as shown here:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.810.1">builder.Services.AddAuthentication(o =&gt;
{
    o.DefaultScheme =
    CookieAuthenticationDefaults.AuthenticationScheme;
})
.AddCookie(o =&gt;
{
    o.Cookie.Name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.811.1">"my_cookie"</span></span><span class="koboSpan" id="kobo.812.1">;
})
.AddJwtBearer(o =&gt;
{
    ...
</span><span class="koboSpan" id="kobo.812.2">});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.813.1">The preceding code specifies a custom authentication cookie name and adds JWT-based authentication for the REST services contained in the application. </span><span class="koboSpan" id="kobo.813.2">Both </span><code class="inlineCode"><span class="koboSpan" id="kobo.814.1">AddCookie</span></code><span class="koboSpan" id="kobo.815.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.816.1">AddJwtBearer</span></code><span class="koboSpan" id="kobo.817.1"> have overloads that accept the name of the authentication scheme before the action, which is where you can define the authentication scheme options. </span><span class="koboSpan" id="kobo.817.2">Since the authentication </span><a id="_idIndexMarker1208"/><span class="koboSpan" id="kobo.818.1">scheme name is necessary for referring to a specific authentication scheme, when it is not specified, a default name is used:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.819.1">The standard name contained in </span><code class="inlineCode"><span class="koboSpan" id="kobo.820.1">CookieAuthenticationDefaults.AuthenticationScheme</span></code><span class="koboSpan" id="kobo.821.1"> for cookie authentication</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.822.1">The standard name contained in </span><code class="inlineCode"><span class="koboSpan" id="kobo.823.1">JwtBearerDefaults.AuthenticationScheme</span></code><span class="koboSpan" id="kobo.824.1"> for JWT authentication</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.825.1">The name that’s passed into </span><code class="inlineCode"><span class="koboSpan" id="kobo.826.1">o.DefaultScheme</span></code><span class="koboSpan" id="kobo.827.1"> selects the authentication scheme, used to fill the </span><code class="inlineCode"><span class="koboSpan" id="kobo.828.1">User</span></code><span class="koboSpan" id="kobo.829.1"> property of </span><code class="inlineCode"><span class="koboSpan" id="kobo.830.1">HttpContext</span></code><span class="koboSpan" id="kobo.831.1">. </span><span class="koboSpan" id="kobo.831.2">Together with </span><code class="inlineCode"><span class="koboSpan" id="kobo.832.1">DefaultScheme</span></code><span class="koboSpan" id="kobo.833.1">, other properties also allow more advanced customizations.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.834.1">For more information about JWT authentication, please refer to the </span><em class="italic"><span class="koboSpan" id="kobo.835.1">ASP.NET Core service authorization</span></em><span class="koboSpan" id="kobo.836.1"> subsection of </span><em class="chapterRef"><span class="koboSpan" id="kobo.837.1">Chapter 15</span></em><span class="koboSpan" id="kobo.838.1">, </span><em class="italic"><span class="koboSpan" id="kobo.839.1">Applying Service-Oriented Architectures with .NET</span></em><span class="koboSpan" id="kobo.840.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.841.1">If you just specify </span><code class="inlineCode"><span class="koboSpan" id="kobo.842.1">builder.Services.AddAuthentication()</span></code><span class="koboSpan" id="kobo.843.1">, a cookie-based authentication with default parameters is assumed.</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.844.1">UseAuthorization</span></code><span class="koboSpan" id="kobo.845.1"> enables authorization based on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.846.1">Authorize</span></code><span class="koboSpan" id="kobo.847.1"> attribute. </span><span class="koboSpan" id="kobo.847.2">Options can be configured by adding </span><code class="inlineCode"><span class="koboSpan" id="kobo.848.1">builder.Services.AddAuthorization</span></code><span class="koboSpan" id="kobo.849.1"> to the host building stage. </span><span class="koboSpan" id="kobo.849.2">These options allow you to define the policies for claims-based authorization.</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.850.1">UseRouting</span></code><span class="koboSpan" id="kobo.851.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.852.1">UseEndpoints</span></code><span class="koboSpan" id="kobo.853.1"> handle </span><a id="_idIndexMarker1209"/><span class="koboSpan" id="kobo.854.1">the so-called ASP.NET Core endpoints. </span><span class="koboSpan" id="kobo.854.2">An endpoint is an abstraction of a handler that serves specific classes of URLs. </span><span class="koboSpan" id="kobo.854.3">These URLs are transformed into an </span><code class="inlineCode"><span class="koboSpan" id="kobo.855.1">Endpoint</span></code><span class="koboSpan" id="kobo.856.1"> instance with patterns. </span><span class="koboSpan" id="kobo.856.2">When a pattern matches a URL, an </span><code class="inlineCode"><span class="koboSpan" id="kobo.857.1">Endpoint</span></code><span class="koboSpan" id="kobo.858.1"> instance is created and filled with both the pattern’s name and the data that was extracted from the URL. </span><span class="koboSpan" id="kobo.858.2">This is a consequence of matching URL parts with named parts of the pattern. </span><span class="koboSpan" id="kobo.858.3">This can be seen in the following code snippet:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.859.1">Request path: /UnitedStates/NewYork
Pattern: Name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.860.1">"location"</span></span><span class="koboSpan" id="kobo.861.1">, match=</span><span class="hljs-string"><span class="koboSpan" id="kobo.862.1">"/{Country}/{Town}"</span></span><span class="koboSpan" id="kobo.863.1">
Endpoint: DisplayName=</span><span class="hljs-string"><span class="koboSpan" id="kobo.864.1">"Location"</span></span><span class="koboSpan" id="kobo.865.1">, Country=</span><span class="hljs-string"><span class="koboSpan" id="kobo.866.1">"UnitedStates"</span></span><span class="koboSpan" id="kobo.867.1">, Town=</span><span class="hljs-string"><span class="koboSpan" id="kobo.868.1">"NewYork"</span></span>
</code></pre>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.869.1">UseRouting</span></code><span class="koboSpan" id="kobo.870.1"> adds a module that processes the request path to get the request </span><code class="inlineCode"><span class="koboSpan" id="kobo.871.1">Endpoint</span></code><span class="koboSpan" id="kobo.872.1"> instance and adds it to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.873.1">HttpContext.Features</span></code><span class="koboSpan" id="kobo.874.1"> dictionary under the </span><code class="inlineCode"><span class="koboSpan" id="kobo.875.1">IEndpointFeature</span></code><span class="koboSpan" id="kobo.876.1"> type. </span><span class="koboSpan" id="kobo.876.2">The actual </span><code class="inlineCode"><span class="koboSpan" id="kobo.877.1">Endpoint</span></code><span class="koboSpan" id="kobo.878.1"> instance is contained in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.879.1">Endpoint</span></code><span class="koboSpan" id="kobo.880.1"> property of </span><code class="inlineCode"><span class="koboSpan" id="kobo.881.1">IEndpointFeature</span></code><span class="koboSpan" id="kobo.882.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.883.1">Each pattern also contains the handler that should process all the requests that match the pattern. </span><span class="koboSpan" id="kobo.883.2">This handler is passed to </span><code class="inlineCode"><span class="koboSpan" id="kobo.884.1">Endpoint</span></code><span class="koboSpan" id="kobo.885.1"> when it is created.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.886.1">On the other hand, </span><code class="inlineCode"><span class="koboSpan" id="kobo.887.1">UseEndpoints</span></code><span class="koboSpan" id="kobo.888.1"> adds the middleware that executes the route determined by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.889.1">UseRouting</span></code><span class="koboSpan" id="kobo.890.1"> logic. </span><span class="koboSpan" id="kobo.890.2">It is placed at the end of the pipeline, since its middleware produces the final response. </span><span class="koboSpan" id="kobo.890.3">Splitting the routing logic into two separate middleware modules enables authorization middleware to sit in between them and, based on the matched endpoint, to decide whether to pass the request to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.891.1">UseEndpoints</span></code><span class="koboSpan" id="kobo.892.1"> middleware for its normal execution, or whether to return a 401 (</span><code class="inlineCode"><span class="koboSpan" id="kobo.893.1">Unauthorized</span></code><span class="koboSpan" id="kobo.894.1">)/403 (</span><code class="inlineCode"><span class="koboSpan" id="kobo.895.1">Forbidden</span></code><span class="koboSpan" id="kobo.896.1">) response immediately.</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.897.1">UseAuthorization</span></code><span class="koboSpan" id="kobo.898.1"> must always be placed after both </span><code class="inlineCode"><span class="koboSpan" id="kobo.899.1">UseAuthentication</span></code><span class="koboSpan" id="kobo.900.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.901.1">UseRouting</span></code><span class="koboSpan" id="kobo.902.1"> because it needs both the </span><code class="inlineCode"><span class="koboSpan" id="kobo.903.1">HttpContext.User</span></code><span class="koboSpan" id="kobo.904.1"> that is filled by </span><code class="inlineCode"><span class="koboSpan" id="kobo.905.1">UseAuthentication</span></code><span class="koboSpan" id="kobo.906.1"> and the handler selected by </span><code class="inlineCode"><span class="koboSpan" id="kobo.907.1">UseRouting</span></code><span class="koboSpan" id="kobo.908.1">, in order to verify whether a user is authorized to access the selected request handler.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.909.1">As the following code snippet shows, patterns are processed in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.910.1">UseRouting</span></code><span class="koboSpan" id="kobo.911.1"> middleware, but they are listed in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.912.1">UseEndpoints</span></code><span class="koboSpan" id="kobo.913.1"> method. </span><span class="koboSpan" id="kobo.913.2">While it might appear strange that URL patterns are not </span><a id="_idIndexMarker1210"/><span class="koboSpan" id="kobo.914.1">defined directly in the middleware that uses them, this was done mainly for coherence with the previous ASP.NET Core versions. </span><span class="koboSpan" id="kobo.914.2">In fact, previous versions contained no method analogous to </span><code class="inlineCode"><span class="koboSpan" id="kobo.915.1">UseRouting</span></code><span class="koboSpan" id="kobo.916.1"> and, instead, some unique middleware at the end of the pipeline. </span><span class="koboSpan" id="kobo.916.2">In the new version, patterns are still defined at the end of the pipeline for coherence with previous versions, but now, </span><code class="inlineCode"><span class="koboSpan" id="kobo.917.1">UseEndpoints</span></code><span class="koboSpan" id="kobo.918.1"> just creates a data structure containing all patterns when the application starts. </span><span class="koboSpan" id="kobo.918.2">Then, this data structure is processed by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.919.1">UseRouting</span></code><span class="koboSpan" id="kobo.920.1"> middleware, as shown in the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.921.1">app.UseRouting();
app.UseAuthentication();
app.UseAuthorization();
app.MapControllerRoute(
    name: </span><span class="hljs-string"><span class="koboSpan" id="kobo.922.1">"default"</span></span><span class="koboSpan" id="kobo.923.1">,
    pattern: </span><span class="hljs-string"><span class="koboSpan" id="kobo.924.1">"{controller=Home}/{action=Index}/{id?}"</span></span><span class="koboSpan" id="kobo.925.1">);
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.926.1">Where </span><code class="inlineCode"><span class="koboSpan" id="kobo.927.1">app.MapControllerRoute</span></code><span class="koboSpan" id="kobo.928.1"> is a shortcut for:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.929.1">app.UseEndpoints(endpoints =&gt;
{
    endpoints.MapControllerRoute(
        name: </span><span class="hljs-string"><span class="koboSpan" id="kobo.930.1">"default"</span></span><span class="koboSpan" id="kobo.931.1">,
        pattern: </span><span class="hljs-string"><span class="koboSpan" id="kobo.932.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.933.1">{controller=Home}/{action=Index}/{id?}"</span></span><span class="koboSpan" id="kobo.934.1">);
   
   
});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.935.1">This shortcut was introduced with the 6.0 version of .NET.</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.936.1">MapControllerRoute</span></code><span class="koboSpan" id="kobo.937.1"> defines the patterns associated with the MVC engine, which will be described in the next subsection. </span><span class="koboSpan" id="kobo.937.2">Other methods define other types of patterns. </span><span class="koboSpan" id="kobo.937.3">A call such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.938.1">.MapHub&lt;MyHub&gt;("/chat")</span></code><span class="koboSpan" id="kobo.939.1"> maps paths to</span><a id="_idIndexMarker1211"/><span class="koboSpan" id="kobo.940.1"> hubs that handle </span><strong class="keyWord"><span class="koboSpan" id="kobo.941.1">SignalR</span></strong><span class="koboSpan" id="kobo.942.1">, an abstraction built on top of </span><code class="inlineCode"><span class="koboSpan" id="kobo.943.1">WebSocket</span></code><span class="koboSpan" id="kobo.944.1">, whereas </span><code class="inlineCode"><span class="koboSpan" id="kobo.945.1">.MapHealthChecks("/health")</span></code><span class="koboSpan" id="kobo.946.1"> maps paths to ASP.NET Core components that return application health data.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.947.1">You can also directly map a pattern to a custom handler with </span><code class="inlineCode"><span class="koboSpan" id="kobo.948.1">.MapGet</span></code><span class="koboSpan" id="kobo.949.1">, which intercepts GET requests, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.950.1">.MapPost</span></code><span class="koboSpan" id="kobo.951.1">, which intercepts POST requests. </span><span class="koboSpan" id="kobo.951.2">This is called </span><strong class="keyWord"><span class="koboSpan" id="kobo.952.1">route to code</span></strong><span class="koboSpan" id="kobo.953.1">. </span><span class="koboSpan" id="kobo.953.2">The following</span><a id="_idIndexMarker1212"/><span class="koboSpan" id="kobo.954.1"> is an example of </span><code class="inlineCode"><span class="koboSpan" id="kobo.955.1">MapGet</span></code><span class="koboSpan" id="kobo.956.1">:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.957.1">MapGet(</span><span class="hljs-string"><span class="koboSpan" id="kobo.958.1">"hello/{country}"</span></span><span class="koboSpan" id="kobo.959.1">, context =&gt;
    context.Response.WriteAsync(
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.960.1">$"Selected country is </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.961.1">{context.GetRouteValue(</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.962.1">"country"</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.963.1">)}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.964.1">"</span></span><span class="koboSpan" id="kobo.965.1">));
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.966.1">We can also write </span><code class="inlineCode"><span class="koboSpan" id="kobo.967.1">app.MapGet(...)</span></code><span class="koboSpan" id="kobo.968.1"> directly, since there are shortcuts for </span><code class="inlineCode"><span class="koboSpan" id="kobo.969.1">MapGet</span></code><span class="koboSpan" id="kobo.970.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.971.1">MapPost</span></code><span class="koboSpan" id="kobo.972.1">, and so on.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.973.1">All these shortcuts, together with the new features, have been named </span><strong class="keyWord"><span class="koboSpan" id="kobo.974.1">Minimal API</span></strong><span class="koboSpan" id="kobo.975.1">. </span><span class="koboSpan" id="kobo.975.2">They offer a lean approach for simpler applications, which is relevant for architects considering performance optimization and API design, particularly in IoT and microservices scenarios.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.976.1">Moreover, </span><code class="inlineCode"><span class="koboSpan" id="kobo.977.1">MapGet</span></code><span class="koboSpan" id="kobo.978.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.979.1">MapPost</span></code><span class="koboSpan" id="kobo.980.1">, and </span><a id="_idIndexMarker1213"/><span class="koboSpan" id="kobo.981.1">suchlike have been enhanced, and now they have overloads whose lambda returns the result directly to add to the response with no need to call </span><code class="inlineCode"><span class="koboSpan" id="kobo.982.1">context.Response.WriteAsync</span></code><span class="koboSpan" id="kobo.983.1">. </span><span class="koboSpan" id="kobo.983.2">If the result isn’t a string, it is automatically converted into JSON, and the response </span><code class="inlineCode"><span class="koboSpan" id="kobo.984.1">Content-Type</span></code><span class="koboSpan" id="kobo.985.1"> is set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.986.1">application/json</span></code><span class="koboSpan" id="kobo.987.1">. </span><span class="koboSpan" id="kobo.987.2">For more complex needs, Minimal APIs can use the static methods of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.988.1">Results</span></code><span class="koboSpan" id="kobo.989.1"> class that supports all return types supported by ASP.NET Core controllers. </span><span class="koboSpan" id="kobo.989.2">The following is an example of </span><code class="inlineCode"><span class="koboSpan" id="kobo.990.1">Results</span></code><span class="koboSpan" id="kobo.991.1"> class usage:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.992.1">app.MapGet(</span><span class="hljs-string"><span class="koboSpan" id="kobo.993.1">"/web-site-conditions"</span></span><span class="koboSpan" id="kobo.994.1">, () =&gt;
	Results.File(</span><span class="hljs-string"><span class="koboSpan" id="kobo.995.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.996.1">Contracts/WebSiteConditions.pdf"</span></span><span class="koboSpan" id="kobo.997.1">));
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.998.1">Patterns are processed in the order in which they are defined until a matching pattern is found. </span><span class="koboSpan" id="kobo.998.2">Since the authentication/authorization middleware is placed after the routing middleware, it can process the </span><code class="inlineCode"><span class="koboSpan" id="kobo.999.1">Endpoint</span></code><span class="koboSpan" id="kobo.1000.1"> request to verify whether the current user has the required authorizations to execute the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1001.1">Endpoint</span></code><span class="koboSpan" id="kobo.1002.1"> handler.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1003.1">Otherwise, a 401 (</span><code class="inlineCode"><span class="koboSpan" id="kobo.1004.1">Unauthorized</span></code><span class="koboSpan" id="kobo.1005.1">) or 403 (</span><code class="inlineCode"><span class="koboSpan" id="kobo.1006.1">Forbidden</span></code><span class="koboSpan" id="kobo.1007.1">) response is immediately returned. </span><span class="koboSpan" id="kobo.1007.2">Only requests that survive authentication and authorization have their handlers executed by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1008.1">UseEndpoints</span></code><span class="koboSpan" id="kobo.1009.1"> middleware.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1010.1">The Minimal API supports the automatic generation of the OpenAPI metadata we described in</span><em class="italic"><span class="koboSpan" id="kobo.1011.1"> Chapter 15</span></em><span class="koboSpan" id="kobo.1012.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1013.1">Applying Service-Oriented Architectures with .NET. </span></em><span class="koboSpan" id="kobo.1014.1">They also support </span><strong class="keyWord"><span class="koboSpan" id="kobo.1015.1">Ahead-of-Time</span></strong><span class="koboSpan" id="kobo.1016.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.1017.1">AOT</span></strong><span class="koboSpan" id="kobo.1018.1">) compilation during the application publication. </span><span class="koboSpan" id="kobo.1018.2">This way, applications are immediately compiled in the target CPU language, saving the time needed by a just-in-time compilation.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1019.1">Moreover, since AOT runs at publication time, it can perform better code optimizations, and in particular, it can trim DLL unused code. </span><span class="koboSpan" id="kobo.1019.2">In general, AOT is not supported by controller-based applications since they make greater use of reflection.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1020.1">Therefore, Minimal APIs are targeted to simple and fast applications, running on small devices such as IoT applications, where, on one hand, speed and reduced application size are fundamental, and on the</span><a id="_idIndexMarker1214"/><span class="koboSpan" id="kobo.1021.1"> other hand, the benefit of structuring code through controllers is negligible. </span><span class="koboSpan" id="kobo.1021.2">We will not describe Minimal APIs in great detail, since this book targets mainly business and enterprise applications.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1022.1">It is worth mentioning that in the last .NET version, a new </span><strong class="keyWord"><span class="koboSpan" id="kobo.1023.1">ASP.NET Core API</span></strong><span class="koboSpan" id="kobo.1024.1"> project was added that scaffolds an application based on the Minimal API.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1025.1">Like the ASP.NET Core RESTful API described in </span><em class="italic"><span class="koboSpan" id="kobo.1026.1">Chapter 15</span></em><span class="koboSpan" id="kobo.1027.1">, ASP.NET Core MVC also uses attributes placed on controllers or controller methods to specify authorization rules. </span><span class="koboSpan" id="kobo.1027.2">However, an instance of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1028.1">AuthorizeAttribute</span></code><span class="koboSpan" id="kobo.1029.1"> can also be added to a pattern to apply its authorization constraints to all the URLs matching that pattern, as shown in the following example:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1030.1">endpoints
 .MapHealthChecks(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1031.1">"/health"</span></span><span class="koboSpan" id="kobo.1032.1">)
 .RequireAuthorization(</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1033.1">new</span></span><span class="koboSpan" id="kobo.1034.1"> AuthorizeAttribute(){ Roles = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1035.1">"admin"</span></span><span class="koboSpan" id="kobo.1036.1">, });
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1037.1">The previous code makes the health check path available only to administrative users.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1038.1">It is also worth mentioning the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1039.1">.UseCors()</span></code><span class="koboSpan" id="kobo.1040.1"> middleware, which enables the application to handle CORS policies. </span><span class="koboSpan" id="kobo.1040.2">We will discuss it in the </span><em class="italic"><span class="koboSpan" id="kobo.1041.1">Communication with the server</span></em><span class="koboSpan" id="kobo.1042.1"> section in </span><em class="italic"><span class="koboSpan" id="kobo.1043.1">Chapter 19, Client Frameworks: Blazor</span></em><span class="koboSpan" id="kobo.1044.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1045.1">Having described the basic structure of the ASP.NET Core framework, we can now move on to more MVC-specific features. </span><span class="koboSpan" id="kobo.1045.2">The next subsection describes controllers and explains how they interact with the UI components, known as Views, through ViewModels.</span></p>
<h2 class="heading-2" id="_idParaDest-348"><span class="koboSpan" id="kobo.1046.1">Defining controllers and ViewModels</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1047.1">In ASP.NET Core MVC, controllers and </span><a id="_idIndexMarker1215"/><span class="koboSpan" id="kobo.1048.1">ViewModels are central to handling requests, presenting data, and handling</span><a id="_idIndexMarker1216"/><span class="koboSpan" id="kobo.1049.1"> the whole user-application interactions. </span><span class="koboSpan" id="kobo.1049.2">Let’s start by understanding how requests issued at specific paths are passed to controllers.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1050.1">The various </span><code class="inlineCode"><span class="koboSpan" id="kobo.1051.1">.MapControllerRoute</span></code><span class="koboSpan" id="kobo.1052.1"> calls associate URL patterns with controllers and their methods, where controllers are classes that inherit from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1053.1">Microsoft.AspNetCore.Mvc.Controller</span></code><span class="koboSpan" id="kobo.1054.1"> class. </span><span class="koboSpan" id="kobo.1054.2">Controllers are discovered by inspecting all of the application’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1055.1">.dll</span></code><span class="koboSpan" id="kobo.1056.1"> files and are added to the DI engine. </span><span class="koboSpan" id="kobo.1056.2">This job is performed by the call to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1057.1">builder.Services.AddControllersWithViews</span></code><span class="koboSpan" id="kobo.1058.1"> in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1059.1">Program.cs</span></code><span class="koboSpan" id="kobo.1060.1"> file.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1061.1">The pipeline module that’s added by </span><code class="inlineCode"><span class="koboSpan" id="kobo.1062.1">UseEndpoints</span></code><span class="koboSpan" id="kobo.1063.1"> takes the controller’s name from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1064.1">controller</span></code><span class="koboSpan" id="kobo.1065.1"> pattern variable, and the name of the controller method to invoke from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1066.1">action</span></code><span class="koboSpan" id="kobo.1067.1"> pattern variable. </span><span class="koboSpan" id="kobo.1067.2">Since, by </span><a id="_idIndexMarker1217"/><span class="koboSpan" id="kobo.1068.1">convention, all controller names are expected to end with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1069.1">Controller</span></code><span class="koboSpan" id="kobo.1070.1"> suffix, the actual controller type name is obtained from the name found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1071.1">controller</span></code><span class="koboSpan" id="kobo.1072.1"> variable by adding this suffix. </span><span class="koboSpan" id="kobo.1072.2">Hence, for instance, if the name found in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1073.1">controller</span></code><span class="koboSpan" id="kobo.1074.1"> is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1075.1">Home</span></code><span class="koboSpan" id="kobo.1076.1">, then </span><a id="_idIndexMarker1218"/><span class="koboSpan" id="kobo.1077.1">the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1078.1">UseEndpoints</span></code><span class="koboSpan" id="kobo.1079.1"> module tries to get an instance of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1080.1">HomeController</span></code><span class="koboSpan" id="kobo.1081.1"> type from the DI engine. </span><span class="koboSpan" id="kobo.1081.2">All of the controller public methods can be selected by the routing rules. </span><span class="koboSpan" id="kobo.1081.3">The use of a controller public method can be prevented by decorating it with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1082.1">[NonAction]</span></code><span class="koboSpan" id="kobo.1083.1"> attribute. </span><span class="koboSpan" id="kobo.1083.2">All controller methods available to the routing rules are called action methods.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1084.1">MVC controllers work like the API controllers that we described in the </span><em class="italic"><span class="koboSpan" id="kobo.1085.1">Implementing REST services with ASP.NET Core</span></em><span class="koboSpan" id="kobo.1086.1"> subsection in </span><em class="italic"><span class="koboSpan" id="kobo.1087.1">Chapter 15</span></em><span class="koboSpan" id="kobo.1088.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1089.1">Applying Service-Oriented Architectures with .NET</span></em><span class="koboSpan" id="kobo.1090.1">. </span><span class="koboSpan" id="kobo.1090.2">The only difference is that API controllers are expected to produce JSON or XML, while MVC controllers are expected to produce HTML. </span><span class="koboSpan" id="kobo.1090.3">For this reason, while API controllers inherit from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1091.1">ControllerBase</span></code><span class="koboSpan" id="kobo.1092.1"> class, MVC controllers inherit from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1093.1">Controller</span></code><span class="koboSpan" id="kobo.1094.1"> class, which, in turn, inherits from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1095.1">ControllerBase</span></code><span class="koboSpan" id="kobo.1096.1"> class and adds its methods, which are useful for HTML generation, such as invoking views, as described in the next subsection, and creating a redirect response.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1097.1">MVC controllers can also use a routing technique similar to one of the API controllers, that is, routing based on controllers and controller method attributes. </span><span class="koboSpan" id="kobo.1097.2">This behavior is enabled by calling the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1098.1">app.MapControllers()</span></code><span class="koboSpan" id="kobo.1099.1"> method in the pipeline definition code in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1100.1">Program.cs</span></code><span class="koboSpan" id="kobo.1101.1">. </span><span class="koboSpan" id="kobo.1101.2">If this call is placed before all other </span><code class="inlineCode"><span class="koboSpan" id="kobo.1102.1">app.MapControllerRoute</span></code><span class="koboSpan" id="kobo.1103.1"> calls, then the controller routes have priority over </span><code class="inlineCode"><span class="koboSpan" id="kobo.1104.1">MapControllerRoute</span></code><span class="koboSpan" id="kobo.1105.1"> patterns; otherwise, the opposite is true.</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1106.1">MapControllerRoute</span></code><span class="koboSpan" id="kobo.1107.1"> has the advantage of deciding in a single place the whole paths used by the whole application. </span><span class="koboSpan" id="kobo.1107.2">This way, you can optimize all application paths for a search engine, or simply for better user navigation, by changing a few lines of code in a single place. </span><span class="koboSpan" id="kobo.1107.3">For these reasons, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1108.1">MapControllerRoute</span></code><span class="koboSpan" id="kobo.1109.1"> is almost always used in MVC applications. </span><span class="koboSpan" id="kobo.1109.2">However, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1110.1">MapControllerRoute</span></code><span class="koboSpan" id="kobo.1111.1"> is rarely used with the REST API because the priority of the REST API is to avoid changes in the associations between paths and controllers, since they might prevent existing clients from working properly.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1112.1">All the attributes we have seen </span><a id="_idIndexMarker1219"/><span class="koboSpan" id="kobo.1113.1">for API controllers can also be used with MVC controllers and action methods (</span><code class="inlineCode"><span class="koboSpan" id="kobo.1114.1">HttpGet</span></code><span class="koboSpan" id="kobo.1115.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1116.1">HttpPost</span></code><span class="koboSpan" id="kobo.1117.1">, …, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1118.1">Authorize</span></code><span class="koboSpan" id="kobo.1119.1">, and so on). </span><span class="koboSpan" id="kobo.1119.2">Developers can write their own custom attributes </span><a id="_idIndexMarker1220"/><span class="koboSpan" id="kobo.1120.1">by inheriting from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1121.1">ActionFilter</span></code><span class="koboSpan" id="kobo.1122.1"> class or other derived classes. </span><span class="koboSpan" id="kobo.1122.2">I will not give details on this right now, but these details can be found in the official documentation, which is referred to in the </span><em class="italic"><span class="koboSpan" id="kobo.1123.1">Further reading</span></em><span class="koboSpan" id="kobo.1124.1"> section.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1125.1">When the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1126.1">UseEndpoints</span></code><span class="koboSpan" id="kobo.1127.1"> module invokes a controller, all of its constructor parameters are filled by the DI engine, since the controller instance itself is returned by the DI engine, and since DI automatically fills constructor parameters with DI in a recursive fashion.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1128.1">Action methods take both their input and services from their parameters, so it is crucial to understand how these parameters are filled by ASP.NET Core. </span><span class="koboSpan" id="kobo.1128.2">They are taken from the following sources:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1129.1">Request headers</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1130.1">Variables in the pattern matched by the current request</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1131.1">Query string parameters</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1132.1">Form parameters (in the case of POST requests)</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1133.1">The request body</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.1134.1">Dependency injection</span></strong><span class="koboSpan" id="kobo.1135.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.1136.1">DI</span></strong><span class="koboSpan" id="kobo.1137.1">), in case of services needed to process the request</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1138.1">While the parameters filled with DI are matched by type, all other parameters are matched by </span><em class="italic"><span class="koboSpan" id="kobo.1139.1">name</span></em><span class="koboSpan" id="kobo.1140.1"> while ignoring the letter casing. </span><span class="koboSpan" id="kobo.1140.2">That is, the action method parameter name must match the header, query string, form, or pattern variable. </span><span class="koboSpan" id="kobo.1140.3">In turn, pattern variables are filled by matching the pattern with the request path.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1141.1">When the parameter is a complex type, the behavior depends on the source.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1142.1">If the source is the request body, a </span><strong class="keyWord"><span class="koboSpan" id="kobo.1143.1">formatter</span></strong><span class="koboSpan" id="kobo.1144.1"> adequate for the request </span><code class="inlineCode"><span class="koboSpan" id="kobo.1145.1">Content-Type</span></code><span class="koboSpan" id="kobo.1146.1"> is selected. </span><strong class="keyWord"><span class="koboSpan" id="kobo.1147.1">Formatters</span></strong><span class="koboSpan" id="kobo.1148.1"> are software modules capable of building complex entities, starting from a text representation of them. </span><span class="koboSpan" id="kobo.1148.2">As a default, the request body is taken as a source for selected </span><code class="inlineCode"><span class="koboSpan" id="kobo.1149.1">Content-Types</span></code><span class="koboSpan" id="kobo.1150.1">, such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1151.1">application/json</span></code><span class="koboSpan" id="kobo.1152.1"> and binary MIME types, because each such MIME type requires a different deserialization algorithm that is specific to it.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1153.1">If the source is not the request body, an algorithm called model binding is used to fill all complex object public properties instead.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1154.1">The model binding algorithm searches for a match in each property (remember that just properties are mapped; fields are not), using the property name for the match. </span><span class="koboSpan" id="kobo.1154.2">In the case of nested complex</span><a id="_idIndexMarker1221"/><span class="koboSpan" id="kobo.1155.1"> types, a match is searched for each nested property’s path, and the name associated with the path is obtained by chaining all the property names in the path and separating them with</span><a id="_idIndexMarker1222"/><span class="koboSpan" id="kobo.1156.1"> dots. </span><span class="koboSpan" id="kobo.1156.2">For instance, a parameter whose name is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1157.1">Property1.Property2.Property3…Propertyn</span></code><span class="koboSpan" id="kobo.1158.1"> is mapped with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1159.1">Propertyn</span></code><span class="koboSpan" id="kobo.1160.1"> property that is in the following path of nested object properties: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1161.1">Property1</span></code><span class="koboSpan" id="kobo.1162.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1163.1">Property2</span></code><span class="koboSpan" id="kobo.1164.1">, ...., </span><code class="inlineCode"><span class="koboSpan" id="kobo.1165.1">Propertyn</span></code><span class="koboSpan" id="kobo.1166.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1167.1">The name that’s obtained this way must match a header name, pattern variable name, query string parameter name, and so on. </span><span class="koboSpan" id="kobo.1167.2">For instance, an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1168.1">OfficeAddress</span></code><span class="koboSpan" id="kobo.1169.1"> property containing a complex </span><code class="inlineCode"><span class="koboSpan" id="kobo.1170.1">Address</span></code><span class="koboSpan" id="kobo.1171.1"> object would generate names like </span><code class="inlineCode"><span class="koboSpan" id="kobo.1172.1">OfficeAddress.Country</span></code><span class="koboSpan" id="kobo.1173.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1174.1">OfficeAddress.Town</span></code><span class="koboSpan" id="kobo.1175.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1176.1">The model binding algorithm can also fill collections and dictionaries, but due to a lack of space, we can’t describe these cases. </span><span class="koboSpan" id="kobo.1176.2">However, the </span><em class="italic"><span class="koboSpan" id="kobo.1177.1">Further reading</span></em><span class="koboSpan" id="kobo.1178.1"> section contains a link to an excellent Phil Haack post that explains them in detail.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1179.1">By default, simple type parameters are matched with pattern variables and query string variables, while complex type parameters are matched with form parameters or the request body (depending on their MIME types). </span><span class="koboSpan" id="kobo.1179.2">However, the preceding defaults can be changed by prefixing the parameters with attributes, as detailed here:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1180.1">[FromForm]</span></code><span class="koboSpan" id="kobo.1181.1"> forces a match with form parameters</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1182.1">[FromBody]</span></code><span class="koboSpan" id="kobo.1183.1"> forces the extraction of data from the request body</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1184.1">[FromHeader]</span></code><span class="koboSpan" id="kobo.1185.1"> forces a match with a request header</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1186.1">[FromRoute]</span></code><span class="koboSpan" id="kobo.1187.1"> forces a match with pattern variables</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1188.1">[FromQuery]</span></code><span class="koboSpan" id="kobo.1189.1"> forces a match with a query string variable</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1190.1">[FromServices]</span></code><span class="koboSpan" id="kobo.1191.1"> forces the use of DI</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1192.1">It is worth pointing out that versions 7 and 8 of ASP.NET Core have an enhanced Minimal API to support basically the same parameter bindings of a controller’s action methods, as well as all the above parameter attributes.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1193.1">During the match, the string that was extracted from the selected source is converted into the type of the action method parameter, using the current thread culture. </span><span class="koboSpan" id="kobo.1193.2">If either a conversion fails or no match is found for an obligatory action method parameter, then the whole action method</span><a id="_idIndexMarker1223"/><span class="koboSpan" id="kobo.1194.1"> invocation process fails, and a 404 response is automatically returned. </span><span class="koboSpan" id="kobo.1194.2">For instance, in the following example, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1195.1">id</span></code><span class="koboSpan" id="kobo.1196.1"> parameter is matched with query string parameters or</span><a id="_idIndexMarker1224"/><span class="koboSpan" id="kobo.1197.1"> pattern variables, since it is a simple type, while </span><code class="inlineCode"><span class="koboSpan" id="kobo.1198.1">myclass</span></code><span class="koboSpan" id="kobo.1199.1"> properties and nested properties are matched with form parameters, since </span><code class="inlineCode"><span class="koboSpan" id="kobo.1200.1">MyClass</span></code><span class="koboSpan" id="kobo.1201.1"> is a complex type. </span><span class="koboSpan" id="kobo.1201.2">Finally, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1202.1">myservice</span></code><span class="koboSpan" id="kobo.1203.1"> is taken from DI, since it is prefixed with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1204.1">[FromServices]</span></code><span class="koboSpan" id="kobo.1205.1"> attribute:</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1206.1">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1207.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1208.1">HomeController</span></span><span class="koboSpan" id="kobo.1209.1"> : </span><span class="hljs-title"><span class="koboSpan" id="kobo.1210.1">Controller</span></span><span class="koboSpan" id="kobo.1211.1">
    {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1212.1">public</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1213.1"> IActionResult </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.1214.1">MyMethod</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1215.1">(</span></span>
<span class="hljs-params"> </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1216.1">int</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1217.1"> id,</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.1218.1">            MyClass myclass,</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.1219.1">            [FromServices] MyService myservice</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1220.1">)</span></span><span class="koboSpan" id="kobo.1221.1">
        {
            ...
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1222.1">If no match is found for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1223.1">id</span></code><span class="koboSpan" id="kobo.1224.1"> parameter, and if the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1225.1">id</span></code><span class="koboSpan" id="kobo.1226.1"> parameter is declared as obligatory in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1227.1">MapControllerRoute</span></code><span class="koboSpan" id="kobo.1228.1"> pattern, a 404 response is automatically returned, since pattern matching fails. </span><span class="koboSpan" id="kobo.1228.2">It is common to declare parameters as not optional when they must match not-nullable single types. </span><span class="koboSpan" id="kobo.1228.3">If, instead, no </span><code class="inlineCode"><span class="koboSpan" id="kobo.1229.1">MyService</span></code><span class="koboSpan" id="kobo.1230.1"> instance is found in the DI container, an exception is thrown because, in this case, the failure doesn’t depend on a wrong request but on a design error.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1231.1">MVC controllers return an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1232.1">IActionResult</span></code><span class="koboSpan" id="kobo.1233.1"> interface or a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1234.1">Task&lt;IActionResult&gt;</span></code><span class="koboSpan" id="kobo.1235.1"> result if they are declared as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1236.1">async</span></code><span class="koboSpan" id="kobo.1237.1">. </span><code class="inlineCode"><span class="koboSpan" id="kobo.1238.1">IActionResult</span></code><span class="koboSpan" id="kobo.1239.1"> defines the unique method with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1240.1">ExecuteResultAsync(ActionContext)</span></code><span class="koboSpan" id="kobo.1241.1"> signature, which, when invoked by the framework, produces the actual response.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1242.1">For each different </span><code class="inlineCode"><span class="koboSpan" id="kobo.1243.1">IActionResult</span></code><span class="koboSpan" id="kobo.1244.1">, MVC controllers have methods that return them. </span><span class="koboSpan" id="kobo.1244.2">The most commonly used </span><code class="inlineCode"><span class="koboSpan" id="kobo.1245.1">IActionResult</span></code><span class="koboSpan" id="kobo.1246.1"> is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1247.1">ViewResult</span></code><span class="koboSpan" id="kobo.1248.1">, which is returned by a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1249.1">View</span></code><span class="koboSpan" id="kobo.1250.1"> method:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1251.1">public</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1252.1"> IActionResult </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.1253.1">MyMethod</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1254.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1255.1">...</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1256.1">)</span></span><span class="koboSpan" id="kobo.1257.1">
{
   ...
   </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1258.1">return</span></span><span class="koboSpan" id="kobo.1259.1"> View(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1260.1">"myviewName"</span></span><span class="koboSpan" id="kobo.1261.1">, MyViewModel)
}
</span></code></pre>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1262.1">ViewResult</span></code><span class="koboSpan" id="kobo.1263.1"> is a very common way for a controller to create an HTML response. </span><span class="koboSpan" id="kobo.1263.2">More specifically, the controller interacts with business/data layers to produce an abstraction of the data that will be shown on the HTML page. </span><span class="koboSpan" id="kobo.1263.3">This abstraction is an object called a </span><strong class="keyWord"><span class="koboSpan" id="kobo.1264.1">ViewModel</span></strong><span class="koboSpan" id="kobo.1265.1">. </span><span class="koboSpan" id="kobo.1265.2">The ViewModel is passed as a</span><a id="_idIndexMarker1225"/><span class="koboSpan" id="kobo.1266.1"> second argument to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1267.1">View</span></code><span class="koboSpan" id="kobo.1268.1"> method, while the first argument is the name </span><a id="_idIndexMarker1226"/><span class="koboSpan" id="kobo.1269.1">of an HTML template, called </span><code class="inlineCode"><span class="koboSpan" id="kobo.1270.1">View</span></code><span class="koboSpan" id="kobo.1271.1">, that is </span><a id="_idIndexMarker1227"/><span class="koboSpan" id="kobo.1272.1">instantiated with the data contained in the ViewModel.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1273.1">Summing this up, the MVC controllers’ processing sequence is as follows:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1274.1">The controllers perform some processing to create the ViewModel, which is an abstraction of the data to show on the HTML page.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1275.1">Then, the controllers create </span><code class="inlineCode"><span class="koboSpan" id="kobo.1276.1">ViewResult</span></code><span class="koboSpan" id="kobo.1277.1"> by passing a View name and ViewModel to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1278.1">View</span></code><span class="koboSpan" id="kobo.1279.1"> method.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1280.1">The MVC framework invokes </span><code class="inlineCode"><span class="koboSpan" id="kobo.1281.1">ViewResult</span></code><span class="koboSpan" id="kobo.1282.1"> and causes the template contained in the View to be instantiated with the data contained in the ViewModel.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1283.1">The result of the template’s instantiation is written in the response with adequate headers.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1284.1">This way, the controller performs the conceptual job of HTML generation by building a ViewModel, while the View – that is, the template – takes care of all the presentation details.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1285.1">Views will be described in greater detail in the next subsection, while the Model (ViewModel) View Controller pattern will be discussed in more detail in the </span><em class="italic"><span class="koboSpan" id="kobo.1286.1">Understanding the connection between ASP.NET Core MVC and design principles</span></em><span class="koboSpan" id="kobo.1287.1"> section in this chapter. </span><span class="koboSpan" id="kobo.1287.2">Finally, a practical example will be provided in </span><em class="italic"><span class="koboSpan" id="kobo.1288.1">Chapter 18</span></em><span class="koboSpan" id="kobo.1289.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1290.1">Implementing Frontend Microservices with ASP.NET Core</span></em><span class="koboSpan" id="kobo.1291.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1292.1">Another common </span><code class="inlineCode"><span class="koboSpan" id="kobo.1293.1">IActionResult</span></code><span class="koboSpan" id="kobo.1294.1"> is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1295.1">RedirectResult</span></code><span class="koboSpan" id="kobo.1296.1">, which creates a redirect response, hence forcing the browser to move to a specific URL. </span><span class="koboSpan" id="kobo.1296.2">Redirects are often used once the user has successfully submitted a form that completes a previous operation. </span><span class="koboSpan" id="kobo.1296.3">In this case, it is common to redirect the user to a page where they can select another operation.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1297.1">The simplest way to return </span><code class="inlineCode"><span class="koboSpan" id="kobo.1298.1">RedirectResult</span></code><span class="koboSpan" id="kobo.1299.1"> is by passing a URL to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1300.1">Redirect</span></code><span class="koboSpan" id="kobo.1301.1"> method. </span><span class="koboSpan" id="kobo.1301.2">This is the advised way to perform a redirect to a URL that is outside the web application. </span><span class="koboSpan" id="kobo.1301.3">On the other hand, when the URL is within the web application, it is advisable to use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1302.1">RedirectToAction</span></code><span class="koboSpan" id="kobo.1303.1"> method, which accepts the controller’s name, the action method name, and the desired parameters for the target action method. </span><span class="koboSpan" id="kobo.1303.2">This method has several overloads, where each overload omits some of the above parameters. </span><span class="koboSpan" id="kobo.1303.3">In particular, the controller name can be omitted if the URL we define is handled by the same controller.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1304.1">The framework uses this data to compute a URL that causes the desired action method to be invoked with the parameters </span><a id="_idIndexMarker1228"/><span class="koboSpan" id="kobo.1305.1">provided. </span><span class="koboSpan" id="kobo.1305.2">This way, if the routing rules are changed during the application’s </span><a id="_idIndexMarker1229"/><span class="koboSpan" id="kobo.1306.1">development or maintenance, the new URL is automatically updated by the framework, with no need to modify all occurrences of the old URL in the code.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1307.1">The following code shows how to call </span><code class="inlineCode"><span class="koboSpan" id="kobo.1308.1">RedirectToAction</span></code><span class="koboSpan" id="kobo.1309.1">:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1310.1">return</span></span><span class="koboSpan" id="kobo.1311.1"> RedirectToAction(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1312.1">"MyActionName"</span></span><span class="koboSpan" id="kobo.1313.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1314.1">"MyControllerName"</span></span><span class="koboSpan" id="kobo.1315.1">,
         </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1316.1">new</span></span><span class="koboSpan" id="kobo.1317.1"> {par1Name=par1Value,..parNName=parNValue});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1318.1">Another useful </span><code class="inlineCode"><span class="koboSpan" id="kobo.1319.1">IActionResult</span></code><span class="koboSpan" id="kobo.1320.1"> is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1321.1">ContentResult</span></code><span class="koboSpan" id="kobo.1322.1">, which can be created by calling the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1323.1">Content</span></code><span class="koboSpan" id="kobo.1324.1"> method. </span><code class="inlineCode"><span class="koboSpan" id="kobo.1325.1">ContentResult</span></code><span class="koboSpan" id="kobo.1326.1"> allows you to write any string to the response and specify its MIME type, as shown in the following example:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1327.1">return</span></span><span class="koboSpan" id="kobo.1328.1"> Content(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1329.1">"this is plain text"</span></span><span class="koboSpan" id="kobo.1330.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1331.1">"text/plain"</span></span><span class="koboSpan" id="kobo.1332.1">);
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1333.1">Finally, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1334.1">File</span></code><span class="koboSpan" id="kobo.1335.1"> method returns </span><code class="inlineCode"><span class="koboSpan" id="kobo.1336.1">FileResult</span></code><span class="koboSpan" id="kobo.1337.1">, which writes binary data in the response. </span><span class="koboSpan" id="kobo.1337.2">There are several overloads of this method that allow the specification of a byte array, a stream, or the path of a file, plus the MIME type of the binary data.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1338.1">Now, let’s move on to describing how actual HTML is generated in Views.</span></p>
<h1 class="heading-1" id="_idParaDest-349"><span class="koboSpan" id="kobo.1339.1">Understanding how ASP.NET Core MVC creates the response HTML</span></h1>
<h2 class="heading-2" id="_idParaDest-350"><span class="koboSpan" id="kobo.1340.1">Razor Views</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1341.1">ASP.NET Core MVC uses a language called Razor </span><a id="_idIndexMarker1230"/><span class="koboSpan" id="kobo.1342.1">to define the HTML templates contained in the Views. </span><span class="koboSpan" id="kobo.1342.2">Razor views are files that are compiled into .NET classes </span><a id="_idIndexMarker1231"/><span class="koboSpan" id="kobo.1343.1">when they’re first used, when the application has been built, or when the application has been published. </span><span class="koboSpan" id="kobo.1343.2">By default, both pre compilation on each build and on publish are enabled, but you can also enable runtime compilation so that the Views can be modified once they have been deployed. </span><span class="koboSpan" id="kobo.1343.3">This option can be enabled by checking the </span><strong class="keyWord"><span class="koboSpan" id="kobo.1344.1">Enable Razor runtime compilation</span></strong><span class="koboSpan" id="kobo.1345.1"> checkbox when the project is created in Visual Studio. </span><span class="koboSpan" id="kobo.1345.2">You can also disable compilation on each build and on publish by adding the following code to the web application project file:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.1346.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1347.1">PropertyGroup</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1348.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1349.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1350.1">TargetFramework</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1351.1">&gt;</span></span><span class="koboSpan" id="kobo.1352.1"> net8.0 </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1353.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1354.1">TargetFramework</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1355.1">&gt;</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1356.1">&lt;!-- add code below --&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1357.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1358.1">RazorCompileOnBuild</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1359.1">&gt;</span></span><span class="koboSpan" id="kobo.1360.1">false</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1361.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1362.1">RazorCompileOnBuild</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1363.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1364.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1365.1">RazorCompileOnPublish</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1366.1">&gt;</span></span><span class="koboSpan" id="kobo.1367.1">false</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1368.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1369.1">RazorCompileOnPublish</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1370.1">&gt;</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1371.1">&lt;!-- end of code to add --&gt;</span></span><span class="koboSpan" id="kobo.1372.1">
    ...
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1373.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1374.1">PropertyGroup</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1375.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1376.1">Views can also be precompiled into Views libraries if you choose a Razor view library project in the window, which appears once you have chosen an ASP.NET Core project.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1377.1">Also, following the compilation, Views </span><a id="_idIndexMarker1232"/><span class="koboSpan" id="kobo.1378.1">remain associated with their paths, which become their full names. </span><span class="koboSpan" id="kobo.1378.2">Each controller has an associated folder under the </span><strong class="keyWord"><span class="koboSpan" id="kobo.1379.1">Views</span></strong><span class="koboSpan" id="kobo.1380.1"> folder with the same name as the controller, which is expected to contain all the Views used by that controller.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1381.1">The following screenshot shows the folder associated with a possible </span><code class="inlineCode"><span class="koboSpan" id="kobo.1382.1">HomeController</span></code><span class="koboSpan" id="kobo.1383.1"> and its Views:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1384.1"><img alt="Graphical user interface, text, application  Description automatically generated" src="../Images/B19820_17_06.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1385.1">Figure 17.6: View folders associated with controllers and the shared folder</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1386.1">The preceding screenshot also shows the </span><strong class="keyWord"><span class="koboSpan" id="kobo.1387.1">Shared</span></strong><span class="koboSpan" id="kobo.1388.1"> folder, which is expected to contain all the Views or partial views used by several controllers. </span><span class="koboSpan" id="kobo.1388.2">The controller refers to views in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1389.1">View</span></code><span class="koboSpan" id="kobo.1390.1"> method through their paths without the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1391.1">.cshtml</span></code><span class="koboSpan" id="kobo.1392.1"> extension. </span><span class="koboSpan" id="kobo.1392.2">If the path starts with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1393.1">/</span></code><span class="koboSpan" id="kobo.1394.1">, the path is interpreted as relative to the application root. </span><span class="koboSpan" id="kobo.1394.2">Otherwise, as a first attempt, the path is interpreted as </span><a id="_idIndexMarker1233"/><span class="koboSpan" id="kobo.1395.1">relative to the folder associated with the controller. </span><span class="koboSpan" id="kobo.1395.2">If no View is found there, the View is searched for in the </span><strong class="keyWord"><span class="koboSpan" id="kobo.1396.1">Shared</span></strong><span class="koboSpan" id="kobo.1397.1"> folder.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1398.1">Hence, for instance, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1399.1">Privacy.cshtml</span></code><span class="koboSpan" id="kobo.1400.1"> View file in the preceding screenshot can be referred to from within </span><code class="inlineCode"><span class="koboSpan" id="kobo.1401.1">HomeController</span></code><span class="koboSpan" id="kobo.1402.1"> as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1403.1">View("Privacy", MyViewModel)</span></code><span class="koboSpan" id="kobo.1404.1">. </span><span class="koboSpan" id="kobo.1404.2">If the name of the View is the same as the name of the action method, we can simply write </span><code class="inlineCode"><span class="koboSpan" id="kobo.1405.1">View(MyViewModel)</span></code><span class="koboSpan" id="kobo.1406.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1407.1">Razor views are a mix of HTML code with C# code, plus some Razor-specific statements. </span><span class="koboSpan" id="kobo.1407.2">They usually begin with a header that contains the type of ViewModel that the View is expected to receive:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1408.1">@model MyViewModel
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1409.1">This declaration may be omitted, but in this case, the view will not be specific to a specific type, and we will not be able to use the model property names in the Razor code.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1410.1">Each view may also contain some </span><code class="inlineCode"><span class="koboSpan" id="kobo.1411.1">using</span></code><span class="koboSpan" id="kobo.1412.1"> statements, whose effect is the same as the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1413.1">using</span></code><span class="koboSpan" id="kobo.1414.1"> statements of standard code files:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1415.1">@model MyViewModel
@using MyApplication.Models
</span></code></pre>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1416.1">@using</span></code><span class="koboSpan" id="kobo.1417.1"> statements declared in the special </span><code class="inlineCode"><span class="koboSpan" id="kobo.1418.1">_ViewImports.cshtml</span></code><span class="koboSpan" id="kobo.1419.1"> file – that is, in the root of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1420.1">Views</span></code><span class="koboSpan" id="kobo.1421.1"> folder – are automatically applied to all views.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1422.1">Each view can also require instances of types from the DI engine in its header, with the syntax shown here:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1423.1">@model MyViewModel
@using MyApplication.Models
@inject IViewLocalizer Localizer
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1424.1">The preceding code requires an instance of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1425.1">IViewLocalizer</span></code><span class="koboSpan" id="kobo.1426.1"> interface and places it in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1427.1">Localizer</span></code><span class="koboSpan" id="kobo.1428.1"> variable. </span><span class="koboSpan" id="kobo.1428.2">The remainder of the View is a mix of C# code, HTML, and Razor control flow statements. </span><span class="koboSpan" id="kobo.1428.3">Each area of a view can be either in HTML mode or C# mode. </span><span class="koboSpan" id="kobo.1428.4">The code in a View area that is in HTML mode is interpreted as HTML, while the code in a View area that is in C# mode is interpreted as C#.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1429.1">The topic that follows explains </span><a id="_idIndexMarker1234"/><span class="koboSpan" id="kobo.1430.1">the Razor flow of control statements.</span></p>
<h3 class="heading-3" id="_idParaDest-351"><span class="koboSpan" id="kobo.1431.1">Learning the Razor flow of control statements</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.1432.1">If you want to write some C# code in an HTML</span><a id="_idIndexMarker1235"/><span class="koboSpan" id="kobo.1433.1"> area, you can create a C# area with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1434.1">@{..}</span></code><span class="koboSpan" id="kobo.1435.1"> Razor flow of a control statement, as shown here:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1436.1">@{
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1437.1">//place C# code here</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1438.1">var</span></span><span class="koboSpan" id="kobo.1439.1"> myVar = </span><span class="hljs-number"><span class="koboSpan" id="kobo.1440.1">5</span></span><span class="koboSpan" id="kobo.1441.1">;
    ...
    </span><span class="koboSpan" id="kobo.1441.2">&lt;div&gt;
        &lt;!-- here you are </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1442.1">in</span></span><span class="koboSpan" id="kobo.1443.1"> HTML mode again --&gt;
        ...
    </span><span class="koboSpan" id="kobo.1443.2">&lt;/div&gt;
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1444.1">//after the HTML block you are still in C# mode</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1445.1">var</span></span><span class="koboSpan" id="kobo.1446.1"> x = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1447.1">"my string"</span></span><span class="koboSpan" id="kobo.1448.1">;
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1449.1">The preceding example shows that it is enough to write an HTML tag to create an HTML area inside the C# area and so on recursively. </span><span class="koboSpan" id="kobo.1449.2">As soon as the HTML tag closes, you are in C# mode again.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1450.1">If we need to create an HTML area but don’t want to enclose it in an HTML tag, we can use the fake </span><code class="inlineCode"><span class="koboSpan" id="kobo.1451.1">&lt;text&gt;</span></code><span class="koboSpan" id="kobo.1452.1"> tag provided by Razor syntax:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1453.1">&lt;text&gt;
&lt;!-- here you entered HTML mode without adding an enclosing
	HTML tag --&gt;
        ...
</span><span class="koboSpan" id="kobo.1453.2">&lt;/text&gt;
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1454.1">C# code produces no HTML, while HTML code is added to the response in the same order in which it appears. </span><span class="koboSpan" id="kobo.1454.2">You can add text computed with C# code while in HTML mode by prefixing any C# expression with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1455.1">@</span></code><span class="koboSpan" id="kobo.1456.1">. </span><span class="koboSpan" id="kobo.1456.2">If the expression is complex, in that it is composed of a chain of properties and method calls, it must be enclosed by parentheses. </span><span class="koboSpan" id="kobo.1456.3">The following code shows some examples:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1457.1">&lt;span&gt;Current date </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1458.1">is</span></span><span class="koboSpan" id="kobo.1459.1">: &lt;/span&gt;
&lt;span&gt;@DateTime.Today.ToString(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1460.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1461.1">d"</span></span><span class="koboSpan" id="kobo.1462.1">)&lt;/span&gt;
...
</span><span class="koboSpan" id="kobo.1462.2">&lt;p&gt;
  User name </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1463.1">is</span></span><span class="koboSpan" id="kobo.1464.1">: @(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1465.1">$"</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1466.1">{myName}</span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="koboSpan" id="kobo.1467.1">{mySurname}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1468.1">"</span></span><span class="koboSpan" id="kobo.1469.1">)
&lt;/p&gt;
...
</span><span class="koboSpan" id="kobo.1469.2">&lt;input type=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1470.1">"submit"</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1471.1">value</span></span><span class="koboSpan" id="kobo.1472.1">=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1473.1">"@myUserMessage"</span></span><span class="koboSpan" id="kobo.1474.1"> /&gt;
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1475.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1476.1">@</span></code><span class="koboSpan" id="kobo.1477.1"> itself can be escaped by entering it twice – </span><code class="inlineCode"><span class="koboSpan" id="kobo.1478.1">@@</span></code><span class="koboSpan" id="kobo.1479.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1480.1">Types are converted into strings using the current culture settings (see the </span><em class="italic"><span class="koboSpan" id="kobo.1481.1">Understanding the connection between ASP.NET Core MVC and design principles</span></em><span class="koboSpan" id="kobo.1482.1"> section for details on how to set the culture of each request). </span><span class="koboSpan" id="kobo.1482.2">Moreover, strings are automatically HTML-encoded to</span><a id="_idIndexMarker1236"/><span class="koboSpan" id="kobo.1483.1"> avoid the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1484.1">&lt;</span></code><span class="koboSpan" id="kobo.1485.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1486.1">&gt;</span></code><span class="koboSpan" id="kobo.1487.1"> symbols, which might interfere with the view HTML.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1488.1">HTML encoding can be prevented with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1489.1">@HTML.Raw</span></code><span class="koboSpan" id="kobo.1490.1"> function, as shown here:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1491.1">@HTML.Raw(myDynamicHtml)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1492.1">In an HTML area, alternative HTML can be selected with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1493.1">@if</span></code><span class="koboSpan" id="kobo.1494.1"> Razor statement:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1495.1">@if(myUser.IsRegistered)
{
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1496.1">//this is a C# code area</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1497.1">var</span></span><span class="koboSpan" id="kobo.1498.1"> x=</span><span class="hljs-number"><span class="koboSpan" id="kobo.1499.1">5</span></span><span class="koboSpan" id="kobo.1500.1">;
    ...
    </span><span class="koboSpan" id="kobo.1500.2">&lt;p&gt;
     &lt;!-- This </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1501.1">is</span></span><span class="koboSpan" id="kobo.1502.1"> an HTML area --&gt;
    &lt;/p&gt;
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1503.1">//this is a C# code area again</span></span><span class="koboSpan" id="kobo.1504.1">
}
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1505.1">else</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1506.1">if</span></span><span class="koboSpan" id="kobo.1507.1">(myUser.IsNew)
{
    ...
</span><span class="koboSpan" id="kobo.1507.2">}
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1508.1">else</span></span><span class="koboSpan" id="kobo.1509.1">
{
 ..
</span><span class="koboSpan" id="kobo.1509.2">}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1510.1">As shown in the preceding code, the beginning of each block of a Razor control flow statement is in C# mode and remains so until the first HTML open tag is encountered, and then, HTML mode starts. </span><span class="koboSpan" id="kobo.1510.2">C# mode is resumed after the corresponding HTML close tag.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1511.1">An HTML template can be </span><a id="_idIndexMarker1237"/><span class="koboSpan" id="kobo.1512.1">instantiated several times with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1513.1">for</span></code><span class="koboSpan" id="kobo.1514.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1515.1">foreach</span></code><span class="koboSpan" id="kobo.1516.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1517.1">while</span></code><span class="koboSpan" id="kobo.1518.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1519.1">do</span></code><span class="koboSpan" id="kobo.1520.1"> Razor statements, as shown in the following examples:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1521.1">@for(</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1522.1">int</span></span><span class="koboSpan" id="kobo.1523.1"> i=</span><span class="hljs-number"><span class="koboSpan" id="kobo.1524.1">0</span></span><span class="koboSpan" id="kobo.1525.1">; i&lt; </span><span class="hljs-number"><span class="koboSpan" id="kobo.1526.1">10</span></span><span class="koboSpan" id="kobo.1527.1">; i++)
{
}
@foreach(</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1528.1">var</span></span><span class="koboSpan" id="kobo.1529.1"> x </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1530.1">in</span></span><span class="koboSpan" id="kobo.1531.1"> myIEnumerable)
{
}
@while(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1532.1">true</span></span><span class="koboSpan" id="kobo.1533.1">)
{
   
}
@do
{
   
}
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1534.1">while</span></span><span class="koboSpan" id="kobo.1535.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1536.1">true</span></span><span class="koboSpan" id="kobo.1537.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1538.1">Razor views can contain comments that do not generate any code. </span><span class="koboSpan" id="kobo.1538.2">Any text included within </span><code class="inlineCode"><span class="koboSpan" id="kobo.1539.1">@*...*@</span></code><span class="koboSpan" id="kobo.1540.1"> is considered a comment and removed when the page is compiled. </span><span class="koboSpan" id="kobo.1540.2">With a good understanding of controllers and their operational mechanics, let’s now turn to how ASP.NET Core MVC generates HTML responses using Razor views.</span></p>
<h3 class="heading-3" id="_idParaDest-352"><span class="koboSpan" id="kobo.1541.1">Understanding Razor view properties</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.1542.1">Some standard variables are predefined in each</span><a id="_idIndexMarker1238"/><span class="koboSpan" id="kobo.1543.1"> view. </span><span class="koboSpan" id="kobo.1543.2">The most important variable is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1544.1">Model</span></code><span class="koboSpan" id="kobo.1545.1">, which contains the ViewModel that was passed to the view. </span><span class="koboSpan" id="kobo.1545.2">For instance, if we pass a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1546.1">Person</span></code><span class="koboSpan" id="kobo.1547.1"> model to a view, then </span><code class="inlineCode"><span class="koboSpan" id="kobo.1548.1">&lt;span&gt;@Model.Name&lt;/span&gt;</span></code><span class="koboSpan" id="kobo.1549.1"> displays the name of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1550.1">Person</span></code><span class="koboSpan" id="kobo.1551.1"> model that was passed to the view.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1552.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1553.1">ViewData</span></code><span class="koboSpan" id="kobo.1554.1"> variable contains </span><code class="inlineCode"><span class="koboSpan" id="kobo.1555.1">IDictionary&lt;string, object&gt;</span></code><span class="koboSpan" id="kobo.1556.1">, which is shared with the controller that invoked the view; that is, all controllers also have a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1557.1">ViewData</span></code><span class="koboSpan" id="kobo.1558.1"> property containing </span><code class="inlineCode"><span class="koboSpan" id="kobo.1559.1">IDictionary&lt;string, object&gt;</span></code><span class="koboSpan" id="kobo.1560.1">, and every entry that is set in the controller is also available in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1561.1">ViewData</span></code><span class="koboSpan" id="kobo.1562.1"> variable of the invoked view. </span><code class="inlineCode"><span class="koboSpan" id="kobo.1563.1">ViewData</span></code><span class="koboSpan" id="kobo.1564.1"> is an alternative to the ViewModel for a controller, allowing the passing of information to its invoked view. </span><span class="koboSpan" id="kobo.1564.2">It is worth mentioning that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1565.1">ViewData</span></code><span class="koboSpan" id="kobo.1566.1"> dictionary can also be accessed as a dynamic object through the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1567.1">ViewBag</span></code><span class="koboSpan" id="kobo.1568.1"> property. </span><span class="koboSpan" id="kobo.1568.2">This means that dynamic </span><code class="inlineCode"><span class="koboSpan" id="kobo.1569.1">ViewBag</span></code><span class="koboSpan" id="kobo.1570.1"> properties are mapped to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1571.1">ViewData</span></code><span class="koboSpan" id="kobo.1572.1"> string indices and that their values are mapped to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1573.1">ViewData</span></code><span class="koboSpan" id="kobo.1574.1"> entries corresponding to those indices. </span><span class="koboSpan" id="kobo.1574.2">Using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1575.1">ViewData</span></code><span class="koboSpan" id="kobo.1576.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1577.1">ViewBag</span></code><span class="koboSpan" id="kobo.1578.1"> is just a matter of preference; neither one has an advantage over the other.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1579.1">Often, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1580.1">ViewData</span></code><span class="koboSpan" id="kobo.1581.1"> is used to store collateral data such as the value-string pairs used to populate an HTML Select. </span><span class="koboSpan" id="kobo.1581.2">For instance, let’s suppose the ViewModel model contains </span><code class="inlineCode"><span class="koboSpan" id="kobo.1582.1">TownId</span></code><span class="koboSpan" id="kobo.1583.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1584.1">TownName</span></code><span class="koboSpan" id="kobo.1585.1"> properties that the user</span><a id="_idIndexMarker1239"/><span class="koboSpan" id="kobo.1586.1"> can change, by selecting a different town from an HTML Select. </span><span class="koboSpan" id="kobo.1586.2">In this case, the action method might fill the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1587.1">"AllTowns"</span></code><span class="koboSpan" id="kobo.1588.1"> entry of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1589.1">ViewData</span></code><span class="koboSpan" id="kobo.1590.1"> with all possible town ID and town name pairs:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1591.1">ViewData[=[</span><span class="hljs-string"><span class="koboSpan" id="kobo.1592.1">"AllTowns"</span></span><span class="koboSpan" id="kobo.1593.1">]= </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1594.1">await</span></span><span class="koboSpan" id="kobo.1595.1"> townsRepo.GetAll();
...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1596.1">return</span></span><span class="koboSpan" id="kobo.1597.1"> View(</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1598.1">new</span></span><span class="koboSpan" id="kobo.1599.1"> AddressViewModel{...});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1600.1">Both controllers and Views also contain a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1601.1">TempData</span></code><span class="koboSpan" id="kobo.1602.1"> dictionary, whose entries are remembered between two successive requests. </span><span class="koboSpan" id="kobo.1602.2">Due to a lack of space, we can’t discuss its properties and its usage, but the interested among you can refer to the official Microsoft documentation:</span></p>
<p class="normal"><a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/app-state?view=aspnetcore-8.0#tempdata"><span class="url"><span class="koboSpan" id="kobo.1603.1">https://learn.microsoft.com/en-us/aspnet/core/fundamentals/app-state?view=aspnetcore-8.0#tempdata</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.1604.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1605.1">User</span></code><span class="koboSpan" id="kobo.1606.1"> view variable contains the currently logged-in user, that is, the same instance contained in the current request’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1607.1">Http.Context.User</span></code><span class="koboSpan" id="kobo.1608.1"> property. </span><span class="koboSpan" id="kobo.1608.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1609.1">Url</span></code><span class="koboSpan" id="kobo.1610.1"> variable contains an instance of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1611.1">IUrlHelper</span></code><span class="koboSpan" id="kobo.1612.1"> interface, whose methods are utilities for computing the URLs of application pages. </span><span class="koboSpan" id="kobo.1612.2">For instance, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1613.1">Url.Action("action", "controller", new {par1=valueOfPar1,...})</span></code><span class="koboSpan" id="kobo.1614.1"> computes the URL that causes the action method, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1615.1">action</span></code><span class="koboSpan" id="kobo.1616.1">, of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1617.1">controller</span></code><span class="koboSpan" id="kobo.1618.1"> to be invoked, with all the parameters specified in the anonymous object passed as its parameters.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1619.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1620.1">Context</span></code><span class="koboSpan" id="kobo.1621.1"> variable contains the whole request’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1622.1">HttpContext</span></code><span class="koboSpan" id="kobo.1623.1">. </span><span class="koboSpan" id="kobo.1623.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1624.1">ViewContext</span></code><span class="koboSpan" id="kobo.1625.1"> variable contains data about the context of the view invocation, including metadata about the action method that invoked the view.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1626.1">The next topic describes how Razor views enhance HTML tag syntax.</span></p>
<h3 class="heading-3" id="_idParaDest-353"><span class="koboSpan" id="kobo.1627.1">Using Razor tag helpers</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.1628.1">Tag helpers in ASP.NET Core MVC are powerful tools for enhancing HTML tags with additional functionalities. </span><span class="koboSpan" id="kobo.1628.2">More specifically, a </span><a id="_idIndexMarker1240"/><span class="koboSpan" id="kobo.1629.1">tag helper either enhances existing HTML tags with new tag attributes or defines completely new tags.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1630.1">While Razor views are compiled, any tag is matched against existing tag helpers. </span><span class="koboSpan" id="kobo.1630.2">When a match is found, the source tag is replaced with HTML created by the tag helpers. </span><span class="koboSpan" id="kobo.1630.3">Several tag helpers may be defined for the same tag. </span><span class="koboSpan" id="kobo.1630.4">They are all executed in an order that can be configured with a priority attribute associated with each tag helper.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1631.1">All tag helpers defined for the same tag may cooperate while each tag instance is being processed. </span><span class="koboSpan" id="kobo.1631.2">This is because they are passed a shared data structure where each of them may apply a contribution. </span><span class="koboSpan" id="kobo.1631.3">Usually, the final tag helper that is invoked processes this shared data structure to produce the output HTML.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1632.1">Tag helpers are classes that inherit from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1633.1">TagHelper</span></code><span class="koboSpan" id="kobo.1634.1"> class. </span><span class="koboSpan" id="kobo.1634.2">This topic doesn’t discuss how to create new tag helpers, but it</span><a id="_idIndexMarker1241"/><span class="koboSpan" id="kobo.1635.1"> does introduce the main predefined tag helpers that come with ASP.NET Core MVC. </span><span class="koboSpan" id="kobo.1635.2">A complete guide on how to define tag helpers is available in the official documentation, which is referenced in the </span><em class="italic"><span class="koboSpan" id="kobo.1636.1">Further reading</span></em><span class="koboSpan" id="kobo.1637.1"> section.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1638.1">To use a tag helper, you must declare the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1639.1">.dll</span></code><span class="koboSpan" id="kobo.1640.1"> file that contains the tag helper with a declaration like the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1641.1">@addTagHelper *, Dll.Complete.Name
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1642.1">If you would like to use just one of the tag helpers defined in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1643.1">.dll</span></code><span class="koboSpan" id="kobo.1644.1"> file, you must replace </span><code class="inlineCode"><span class="koboSpan" id="kobo.1645.1">*</span></code><span class="koboSpan" id="kobo.1646.1"> with the tag name.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1647.1">The preceding declaration can be placed either in each view that uses the tag helpers defined in the library or, ultimately, in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1648.1">_ViewImports.cshtml</span></code><span class="koboSpan" id="kobo.1649.1"> file in the root of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1650.1">Views</span></code><span class="koboSpan" id="kobo.1651.1"> folder. </span><span class="koboSpan" id="kobo.1651.2">By default, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1652.1">_ViewImports.cshtml</span></code><span class="koboSpan" id="kobo.1653.1"> adds all predefined ASP.NET Core MVC tag helpers with the following declaration:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1654.1">@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1655.1">The anchor tag is enhanced with attributes that automatically compute the URL and invoke a specific action method with given parameters, as shown here:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1656.1">&lt;a asp-controller=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1657.1">"{controller name}"</span></span><span class="koboSpan" id="kobo.1658.1">
asp-action=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1659.1">"{action method name}"</span></span><span class="koboSpan" id="kobo.1660.1">
asp-route-{action method parameter1}=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1661.1">"value1"</span></span><span class="koboSpan" id="kobo.1662.1">
...
</span><span class="koboSpan" id="kobo.1662.2">asp-route-{action method parametern}=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1663.1">"valuen"</span></span><span class="koboSpan" id="kobo.1664.1">&gt;
    put anchor text here
&lt;/a&gt;
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1665.1">Below is an example of its usage:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1666.1">&lt;a asp-controller=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1667.1">"Home"</span></span><span class="koboSpan" id="kobo.1668.1"> asp-action=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1669.1">"Index"</span></span><span class="koboSpan" id="kobo.1670.1">&gt;
 Back Home
&lt;/a&gt;
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1671.1">The HTML created is:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1672.1">&lt;a href=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1673.1">"Home/Index"</span></span><span class="koboSpan" id="kobo.1674.1">&gt;
 Back Home
&lt;/a&gt;
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1675.1">It might appear that there is almost no advantage in using the tag helper. </span><span class="koboSpan" id="kobo.1675.2">However, this isn’t true! </span><span class="koboSpan" id="kobo.1675.3">The advantage is that </span><a id="_idIndexMarker1242"/><span class="koboSpan" id="kobo.1676.1">whenever the routing rules change, the tag helper automatically updates the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1677.1">href</span></code><span class="koboSpan" id="kobo.1678.1"> that it generates to conform to the new routing rules.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1679.1">A similar syntax is added to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1680.1">form</span></code><span class="koboSpan" id="kobo.1681.1"> tags:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1682.1">&lt;form asp-controller=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1683.1">"{controller name}"</span></span><span class="koboSpan" id="kobo.1684.1">
asp-action=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1685.1">"{action method name}"</span></span><span class="koboSpan" id="kobo.1686.1">
asp-route-{action method parameter1}=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1687.1">"value1"</span></span><span class="koboSpan" id="kobo.1688.1">
...
</span><span class="koboSpan" id="kobo.1688.2">asp-route-{action method parametern}=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1689.1">"valuen"</span></span><span class="koboSpan" id="kobo.1690.1">
...
</span><span class="koboSpan" id="kobo.1690.2">&gt;
...
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1691.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1692.1">script</span></code><span class="koboSpan" id="kobo.1693.1"> tag is enhanced with attributes that allow us to fall back to a different source if the download fails. </span><span class="koboSpan" id="kobo.1693.2">Typical usage is to download scripts from some cloud service to optimize the browser cache and to fall back to a local copy of the script if there is a failure. </span><span class="koboSpan" id="kobo.1693.3">The following code uses the fallback technique to download the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1694.1">bootstrap</span></code><span class="koboSpan" id="kobo.1695.1"> JavaScript file:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1696.1">&lt;script src=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1697.1">"https://stackpath.bootstrapcdn.com/</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1698.1"> bootstrap/4.3.1/js/bootstrap.bundle.min.js"</span></span><span class="koboSpan" id="kobo.1699.1">
 asp-fallback-src=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1700.1">"~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"</span></span><span class="koboSpan" id="kobo.1701.1">
 asp-fallback-test=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1702.1">"window.jQuery &amp;&amp; window.jQuery.fn &amp;&amp; window.jQuery.fn.modal"</span></span><span class="koboSpan" id="kobo.1703.1">
 crossorigin=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1704.1">"anonymous"</span></span><span class="koboSpan" id="kobo.1705.1">
 integrity=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1706.1">"sha384-xrRywqdh3PHs8keKZN+8zzc5TX0GRTLCcmivcbNJWm2rs5C8PRhcEn3czEjhAO9o"</span></span><span class="koboSpan" id="kobo.1707.1">&gt;
&lt;/script&gt;
</span></code></pre>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1708.1">asp-fallback-test</span></code><span class="koboSpan" id="kobo.1709.1"> contains a JavaScript test that verifies whether the download succeeded. </span><span class="koboSpan" id="kobo.1709.2">In the preceding example, the test verifies whether a JavaScript object has been created.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1710.1">All HTML tags that admit an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1711.1">src</span></code><span class="koboSpan" id="kobo.1712.1"> attribute, that is, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1713.1">img</span></code><span class="koboSpan" id="kobo.1714.1"> and the script tags, can be added as an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1715.1">asp-append-version</span></code><span class="koboSpan" id="kobo.1716.1"> attribute set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1717.1">true</span></code><span class="koboSpan" id="kobo.1718.1">. </span><span class="koboSpan" id="kobo.1718.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1719.1">asp-append-version</span></code><span class="koboSpan" id="kobo.1720.1"> attribute set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1721.1">true</span></code><span class="koboSpan" id="kobo.1722.1"> doesn’t change the</span><a id="_idIndexMarker1243"/><span class="koboSpan" id="kobo.1723.1"> syntax of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1724.1">img</span></code><span class="koboSpan" id="kobo.1725.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1726.1">script</span></code><span class="koboSpan" id="kobo.1727.1"> tags; it just adds a hash to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1728.1">src</span></code><span class="koboSpan" id="kobo.1729.1"> query string to prevent cashing each time the image or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1730.1">script</span></code><span class="koboSpan" id="kobo.1731.1"> file changes. </span><span class="koboSpan" id="kobo.1731.2">Here is an example:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.1732.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1733.1">img</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1734.1">src</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1735.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1736.1">"~/images/myImage.png"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1737.1">asp-append-version</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1738.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1739.1">"true"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1740.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1741.1">Which is rendered as:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.1742.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1743.1">img</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1744.1">src</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1745.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1746.1">"/images/myImage.png?v=kM_dqr9NVtnMdsM2MUgdskVVFD"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1747.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1748.1">The hash passed in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1749.1">v</span></code><span class="koboSpan" id="kobo.1750.1"> query parameter is computed from the content of the image file, so it changes whenever the image changes, thereby preventing the browser from rendering an old cached copy of the image.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1751.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1752.1">~/</span></code><span class="koboSpan" id="kobo.1753.1"> symbol is not a feature specific to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1754.1">img</span></code><span class="koboSpan" id="kobo.1755.1"> tag helper and, instead, a Razor native feature you can use in all links contained in any tag of a Razor file. </span><span class="koboSpan" id="kobo.1755.2">It stands for the application root. </span><span class="koboSpan" id="kobo.1755.3">It is not equivalent to the HTML </span><code class="inlineCode"><span class="koboSpan" id="kobo.1756.1">/</span></code><span class="koboSpan" id="kobo.1757.1"> symbol that stands for the root of the domain, because ASP.NET Core applications can also be placed in subfolders of the domain. </span><span class="koboSpan" id="kobo.1757.2">So </span><code class="inlineCode"><span class="koboSpan" id="kobo.1758.1">~/</span></code><span class="koboSpan" id="kobo.1759.1"> translates as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1760.1">/</span></code><span class="koboSpan" id="kobo.1761.1"> only when the application is placed in the domain root; otherwise, it translates as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1762.1">/{application subfolder name}/</span></code><span class="koboSpan" id="kobo.1763.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1764.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1765.1">environment</span></code><span class="koboSpan" id="kobo.1766.1"> tag can be used to select different HTML for different environments (development, staging, and production). </span><span class="koboSpan" id="kobo.1766.2">Its typical usage is selecting the debug versions of JavaScript files during development, as shown in this example:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.1767.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1768.1">environment</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1769.1">include</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1770.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1771.1">"Development"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1772.1">&gt;</span></span><span class="koboSpan" id="kobo.1773.1">
        @*development version of JavaScript files*@
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1774.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1775.1">environment</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1776.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1777.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1778.1">environment</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1779.1">exclude</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1780.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1781.1">"Development"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1782.1">&gt;</span></span><span class="koboSpan" id="kobo.1783.1">
        @*development version of JavaScript files *@
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1784.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1785.1">environment</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1786.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1787.1">There is also a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1788.1">cache</span></code><span class="koboSpan" id="kobo.1789.1"> tag, which caches its content in memory to optimize rendering speed:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.1790.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1791.1">cache</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1792.1">&gt;</span></span><span class="koboSpan" id="kobo.1793.1">
    @* heavy to compute content to cache *@
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1794.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1795.1">cache</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1796.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1797.1">By default, content is cached for 20 minutes, but the tag has attributes that must be defined when the cache expires, such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1798.1">expires-on="{datetime}"</span></code><span class="koboSpan" id="kobo.1799.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1800.1">expires-after="{timespan}"</span></code><span class="koboSpan" id="kobo.1801.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1802.1">expires-sliding="{timespan}"</span></code><span class="koboSpan" id="kobo.1803.1">. </span><span class="koboSpan" id="kobo.1803.2">Here, the difference between </span><code class="inlineCode"><span class="koboSpan" id="kobo.1804.1">expires-sliding</span></code><span class="koboSpan" id="kobo.1805.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1806.1">expires-after</span></code><span class="koboSpan" id="kobo.1807.1"> is that, in the second attribute, the expiration time count is reset each time the content is requested. </span><span class="koboSpan" id="kobo.1807.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1808.1">vary-by</span></code><span class="koboSpan" id="kobo.1809.1"> attribute causes the creation of a different</span><a id="_idIndexMarker1244"/><span class="koboSpan" id="kobo.1810.1"> cache entry for each different value passed to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1811.1">vary-by</span></code><span class="koboSpan" id="kobo.1812.1">. </span><span class="koboSpan" id="kobo.1812.2">There are also attributes such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1813.1">vary-by-header</span></code><span class="koboSpan" id="kobo.1814.1">, which creates a different entry for each different value assumed by the request header specified in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1815.1">vary-by-cookie</span></code><span class="koboSpan" id="kobo.1816.1"> attribute, and so on.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1817.1">All </span><code class="inlineCode"><span class="koboSpan" id="kobo.1818.1">input</span></code><span class="koboSpan" id="kobo.1819.1"> tags – that is, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1820.1">textarea</span></code><span class="koboSpan" id="kobo.1821.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1822.1">input</span></code><span class="koboSpan" id="kobo.1823.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1824.1">select</span></code><span class="koboSpan" id="kobo.1825.1"> – have an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1826.1">asp-for</span></code><span class="koboSpan" id="kobo.1827.1"> attribute that accepts a properties path rooted in the view’s ViewModel as their value. </span><span class="koboSpan" id="kobo.1827.2">For instance, if the view has a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1828.1">Person</span></code><span class="koboSpan" id="kobo.1829.1"> ViewModel, we may have something like this:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.1830.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1831.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1832.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1833.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1834.1">"text"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1835.1">asp-for</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1836.1">"</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1837.1">Address.Town</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1838.1">"/&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1839.1">The first thing the preceding code does is assign the value of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1840.1">Town</span></code><span class="koboSpan" id="kobo.1841.1"> nested property to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1842.1">value</span></code><span class="koboSpan" id="kobo.1843.1"> attribute of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1844.1">input</span></code><span class="koboSpan" id="kobo.1845.1"> tag. </span><span class="koboSpan" id="kobo.1845.2">In general, if the value is not a string, it is converted into a string using the current request culture.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1846.1">However, it also sets the name of the input field to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1847.1">Address.Town</span></code><span class="koboSpan" id="kobo.1848.1"> and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1849.1">id</span></code><span class="koboSpan" id="kobo.1850.1"> of the input field to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1851.1">Address_Town</span></code><span class="koboSpan" id="kobo.1852.1">. </span><span class="koboSpan" id="kobo.1852.2">This is because dots are not allowed in tag </span><code class="inlineCode"><span class="koboSpan" id="kobo.1853.1">ids</span></code><span class="koboSpan" id="kobo.1854.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1855.1">A prefix can be added to these standard names by specifying it in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1856.1">ViewData.TemplateInfo.HtmlFieldPrefix</span></code><span class="koboSpan" id="kobo.1857.1">. </span><span class="koboSpan" id="kobo.1857.2">For instance, if the previous property is set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1858.1">MyPerson</span></code><span class="koboSpan" id="kobo.1859.1">, the name becomes </span><code class="inlineCode"><span class="koboSpan" id="kobo.1860.1">MyPerson.Address.Town</span></code><span class="koboSpan" id="kobo.1861.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1862.1">If the form is submitted to an action method that has the same </span><code class="inlineCode"><span class="koboSpan" id="kobo.1863.1">Person</span></code><span class="koboSpan" id="kobo.1864.1"> class as one of its parameters, the name of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1865.1">Address.Town</span></code><span class="koboSpan" id="kobo.1866.1"> that’s given to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1867.1">input</span></code><span class="koboSpan" id="kobo.1868.1"> field will cause the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1869.1">Town</span></code><span class="koboSpan" id="kobo.1870.1"> property of this parameter to be filled with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1871.1">input</span></code><span class="koboSpan" id="kobo.1872.1"> field. </span><span class="koboSpan" id="kobo.1872.2">In general, the string contained in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1873.1">input</span></code><span class="koboSpan" id="kobo.1874.1"> field is converted into the type of property it has been matched with, using the current request culture. </span><span class="koboSpan" id="kobo.1874.2">Summing this up, the names of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1875.1">input</span></code><span class="koboSpan" id="kobo.1876.1"> fields are created in such a way that a complete </span><code class="inlineCode"><span class="koboSpan" id="kobo.1877.1">Person</span></code><span class="koboSpan" id="kobo.1878.1"> model can be recovered in the action method when the HTML page is posted.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1879.1">The same </span><code class="inlineCode"><span class="koboSpan" id="kobo.1880.1">asp-for</span></code><span class="koboSpan" id="kobo.1881.1"> attribute can be used in a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1882.1">label</span></code><span class="koboSpan" id="kobo.1883.1"> tag to cause the label to refer to the input field with the same </span><code class="inlineCode"><span class="koboSpan" id="kobo.1884.1">asp-for</span></code><span class="koboSpan" id="kobo.1885.1"> value.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1886.1">The following code is an example of an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1887.1">input/label</span></code><span class="koboSpan" id="kobo.1888.1"> pair:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.1889.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1890.1">label</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1891.1">asp-for</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1892.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1893.1">"Address.Town"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1894.1">&gt;</span></span><span class="koboSpan" id="kobo.1895.1">&lt;/label
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1896.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1897.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1898.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1899.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1900.1">"text"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1901.1">asp-for</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1902.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1903.1">"Address.Town"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1904.1">/&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1905.1">When no text is inserted into the label, the text shown in the label is taken from a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1906.1">Display</span></code><span class="koboSpan" id="kobo.1907.1"> attribute that decorates the property (</span><code class="inlineCode"><span class="koboSpan" id="kobo.1908.1">Town</span></code><span class="koboSpan" id="kobo.1909.1">, in this example), if any; otherwise, the name of the property is used.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1910.1">If </span><code class="inlineCode"><span class="koboSpan" id="kobo.1911.1">span</span></code><span class="koboSpan" id="kobo.1912.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1913.1">div</span></code><span class="koboSpan" id="kobo.1914.1"> contains an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1915.1">asp-validation-for="Address.Town"</span></code><span class="koboSpan" id="kobo.1916.1"> error attribute, then validation messages concerning the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1917.1">Address.Town</span></code><span class="koboSpan" id="kobo.1918.1"> input will be inserted automatically inside that tag. </span><span class="koboSpan" id="kobo.1918.2">The validation</span><a id="_idIndexMarker1245"/><span class="koboSpan" id="kobo.1919.1"> framework will be described in the </span><em class="italic"><span class="koboSpan" id="kobo.1920.1">Understanding the connection between ASP.NET Core MVC and design principles</span></em><span class="koboSpan" id="kobo.1921.1"> section.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1922.1">It is also possible to automatically create a validation error summary by adding the attribute that follows a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1923.1">div</span></code><span class="koboSpan" id="kobo.1924.1"> or a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1925.1">span</span></code><span class="koboSpan" id="kobo.1926.1">:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1927.1">asp-validation-summary="ValidationSummary.{All, ModelOnly}"
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1928.1">If the attribute is set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1929.1">ValidationSummary.ModelOnly</span></code><span class="koboSpan" id="kobo.1930.1">, only messages that are not associated with specific </span><code class="inlineCode"><span class="koboSpan" id="kobo.1931.1">input</span></code><span class="koboSpan" id="kobo.1932.1"> fields will be shown in the summary, while if the value is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1933.1">ValidationSummary.All</span></code><span class="koboSpan" id="kobo.1934.1">, all error messages will be shown.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1935.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1936.1">asp-items</span></code><span class="koboSpan" id="kobo.1937.1"> attribute can be applied to any </span><code class="inlineCode"><span class="koboSpan" id="kobo.1938.1">select</span></code><span class="koboSpan" id="kobo.1939.1"> tag to automatically generate all the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1940.1">select</span></code><span class="koboSpan" id="kobo.1941.1"> options. </span><span class="koboSpan" id="kobo.1941.2">It must be passed an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1942.1">IEnumerable&lt;SelectListItem&gt;</span></code><span class="koboSpan" id="kobo.1943.1">, where each </span><code class="inlineCode"><span class="koboSpan" id="kobo.1944.1">SelectListItem</span></code><span class="koboSpan" id="kobo.1945.1"> contains both the text and value of an option. </span><code class="inlineCode"><span class="koboSpan" id="kobo.1946.1">SelectListItem</span></code><span class="koboSpan" id="kobo.1947.1"> also contains an optional </span><code class="inlineCode"><span class="koboSpan" id="kobo.1948.1">Group</span></code><span class="koboSpan" id="kobo.1949.1"> property that you can use to organize the options shown in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1950.1">select</span></code><span class="koboSpan" id="kobo.1951.1"> into groups.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1952.1">Here is an example of how to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1953.1">asp-items</span></code><span class="koboSpan" id="kobo.1954.1">:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1955.1">...
</span><span class="koboSpan" id="kobo.1955.2">@{
 </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1956.1">var</span></span><span class="koboSpan" id="kobo.1957.1"> choices = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1958.1">new</span></span><span class="koboSpan" id="kobo.1959.1"> List&lt;SelectListItem&gt;
 {
   </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1960.1">new</span></span><span class="koboSpan" id="kobo.1961.1"> SelectListItem {Value=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1962.1">"value1"</span></span><span class="koboSpan" id="kobo.1963.1">, Text=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1964.1">"text1"</span></span><span class="koboSpan" id="kobo.1965.1">, Group=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1966.1">"group1"</span></span><span class="koboSpan" id="kobo.1967.1">},
   </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1968.1">new</span></span><span class="koboSpan" id="kobo.1969.1"> SelectListItem {Value=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1970.1">"value2"</span></span><span class="koboSpan" id="kobo.1971.1">, Text=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1972.1">"text2"</span></span><span class="koboSpan" id="kobo.1973.1">, Group=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1974.1">"group1"</span></span><span class="koboSpan" id="kobo.1975.1">}
   ...
   </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1976.1">new</span></span><span class="koboSpan" id="kobo.1977.1"> SelectListItem {..., Group=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1978.1">"group2"</span></span><span class="koboSpan" id="kobo.1979.1">}
   ...
 </span><span class="koboSpan" id="kobo.1979.2">}
}
&lt;</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1980.1">select</span></span><span class="koboSpan" id="kobo.1981.1"> asp-</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1982.1">for</span></span><span class="koboSpan" id="kobo.1983.1">=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1984.1">"MyProperty"</span></span><span class="koboSpan" id="kobo.1985.1">  asp-items=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1986.1">"choices"</span></span><span class="koboSpan" id="kobo.1987.1">&gt;
 &lt;option </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1988.1">value</span></span><span class="koboSpan" id="kobo.1989.1">=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1990.1">""</span></span><span class="koboSpan" id="kobo.1991.1">&gt;Select a </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1992.1">value</span></span><span class="koboSpan" id="kobo.1993.1">&lt;/option&gt;
&lt;/</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1994.1">select</span></span><span class="koboSpan" id="kobo.1995.1">&gt;
...
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1996.1">When added, option tags are placed before the ones generated by </span><code class="inlineCode"><span class="koboSpan" id="kobo.1997.1">asp-items</span></code><span class="koboSpan" id="kobo.1998.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1999.1">The next topic shows how to </span><a id="_idIndexMarker1246"/><span class="koboSpan" id="kobo.2000.1">reuse view code.</span></p>
<h2 class="heading-2" id="_idParaDest-354"><span class="koboSpan" id="kobo.2001.1">Reusing view code</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2002.1">ASP.NET Core MVC includes several techniques for reusing view code, with the most important being the layout page.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2003.1">In each web application, several pages</span><a id="_idIndexMarker1247"/><span class="koboSpan" id="kobo.2004.1"> share the same structure, for instance, the same main menu or the same left or right bar. </span><span class="koboSpan" id="kobo.2004.2">In ASP.NET Core, this common structure is factored out in views called layout pages/views.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2005.1"><img alt="" role="presentation" src="../Images/B19820_17_07.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2006.1">Figure 17.7: Using layout pages</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2007.1">Each view can specify the view to be used as its layout page with the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2008.1">@{
    Layout = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2009.1">"_MyLayout"</span></span><span class="koboSpan" id="kobo.2010.1">;
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2011.1">If no layout page is specified, a default layout page, defined in a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2012.1">_ViewStart.cshtml</span></code><span class="koboSpan" id="kobo.2013.1"> file located in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2014.1">Views</span></code><span class="koboSpan" id="kobo.2015.1"> folder, is used. </span><span class="koboSpan" id="kobo.2015.2">The default content of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2016.1">_ViewStart.cshtml</span></code><span class="koboSpan" id="kobo.2017.1"> is as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2018.1">@{
    Layout = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2019.1">"_Layout"</span></span><span class="koboSpan" id="kobo.2020.1">;
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2021.1">Therefore, the default layout page in the files scaffolded by Visual Studio is </span><code class="inlineCode"><span class="koboSpan" id="kobo.2022.1">_Layout.cshtml</span></code><span class="koboSpan" id="kobo.2023.1">, which is</span><a id="_idIndexMarker1248"/><span class="koboSpan" id="kobo.2024.1"> contained in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2025.1">Shared</span></code><span class="koboSpan" id="kobo.2026.1"> folder.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2027.1">The layout page contains the HTML that’s shared with all of its children pages, the HTML page headers, and the page references to CSS and JavaScript files. </span><span class="koboSpan" id="kobo.2027.2">The HTML produced by each view is placed inside its layout page, where the layout page calls the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2028.1">@RenderBody()</span></code><span class="koboSpan" id="kobo.2029.1"> method, as shown in the following example:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2030.1">...
</span><span class="koboSpan" id="kobo.2030.2">&lt;main role=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2031.1">"main"</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2032.1">class</span></span><span class="koboSpan" id="kobo.2033.1">=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2034.1">"pb-3"</span></span><span class="koboSpan" id="kobo.2035.1">&gt;
    ...
    </span><span class="koboSpan" id="kobo.2035.2">@RenderBody()
    ...
</span><span class="koboSpan" id="kobo.2035.3">&lt;/main&gt;
...
</span></code></pre>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.2036.1">ViewData</span></code><span class="koboSpan" id="kobo.2037.1"> of each </span><code class="inlineCode"><span class="koboSpan" id="kobo.2038.1">View</span></code><span class="koboSpan" id="kobo.2039.1"> is copied into </span><code class="inlineCode"><span class="koboSpan" id="kobo.2040.1">ViewData</span></code><span class="koboSpan" id="kobo.2041.1"> of its layout page, so </span><code class="inlineCode"><span class="koboSpan" id="kobo.2042.1">ViewData</span></code><span class="koboSpan" id="kobo.2043.1"> can be used to pass information to the view layout page. </span><span class="koboSpan" id="kobo.2043.2">Typically, it is used to pass the view title to the layout page, which then uses it to compose the page’s title header, as shown here:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2044.1">@*In the view *@
@{
    ViewData["Title"] = "Home Page"; 
}
@*In the layout view*@
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2045.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2046.1">head</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2047.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2048.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2049.1">meta</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2050.1">charset</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2051.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2052.1">"utf-8"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2053.1"> /&gt;</span></span><span class="koboSpan" id="kobo.2054.1">
    ...
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2055.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2056.1">title</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2057.1">&gt;</span></span><span class="koboSpan" id="kobo.2058.1">@ViewData["Title"] - My web application</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2059.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2060.1">title</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2061.1">&gt;</span></span><span class="koboSpan" id="kobo.2062.1">
    ...
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2063.1">While the main content produced by each view is placed in a single area of its layout page, each layout page can also define several sections placed in different areas, where each view can place further</span><a id="_idIndexMarker1249"/><span class="koboSpan" id="kobo.2064.1"> secondary content.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2065.1">For instance, suppose a layout page defines a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2066.1">Scripts</span></code><span class="koboSpan" id="kobo.2067.1"> section, as shown here:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2068.1">...
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2069.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2070.1">script</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2071.1">src</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2072.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2073.1">"~/js/site.js"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2074.1">asp-append-version</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2075.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2076.1">"true"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2077.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2078.1">script</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2079.1">&gt;</span></span><span class="koboSpan" id="kobo.2080.1">
@RenderSection("Scripts", required: false)
...
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2081.1">Then, the view can use the previously defined section to pass some view-specific JavaScript references, as shown here:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2082.1">.....
</span><span class="koboSpan" id="kobo.2082.2">@section scripts{
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2083.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2084.1">script</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2085.1">src</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2086.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2087.1">"~/js/pages/pageSpecificJavaScript.min.js"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2088.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2089.1">script</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2090.1">&gt;</span></span><span class="koboSpan" id="kobo.2091.1">
}
.....
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2092.1">If an action method is expected to return HTML to an AJAX call, it must produce an HTML fragment instead of a whole HTML page. </span><span class="koboSpan" id="kobo.2092.2">Therefore, in this case, no layout page must be used. </span><span class="koboSpan" id="kobo.2092.3">This is achieved by calling the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2093.1">PartialView</span></code><span class="koboSpan" id="kobo.2094.1"> method instead of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2095.1">View</span></code><span class="koboSpan" id="kobo.2096.1"> method in the controller action method. </span><code class="inlineCode"><span class="koboSpan" id="kobo.2097.1">PartialView</span></code><span class="koboSpan" id="kobo.2098.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2099.1">View</span></code><span class="koboSpan" id="kobo.2100.1"> have exactly the same overloads and parameters.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2101.1">Another way to reuse view code is to factor out a view fragment that’s common to several views into another view that is called by all previous views. </span><span class="koboSpan" id="kobo.2101.2">A view can call another view with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2102.1">partial</span></code><span class="koboSpan" id="kobo.2103.1"> tag, as shown here:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.2104.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2105.1">partial</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2106.1">name</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2107.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2108.1">"_viewname"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2109.1">for</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2110.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2111.1">"ModelProperty.NestedProperty"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2112.1">/&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2113.1">The preceding code invokes </span><code class="inlineCode"><span class="koboSpan" id="kobo.2114.1">_viewname</span></code><span class="koboSpan" id="kobo.2115.1"> and passes it to the object contained in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2116.1">Model.ModelProperty.NestedProperty</span></code><span class="koboSpan" id="kobo.2117.1"> as its </span><code class="inlineCode"><span class="koboSpan" id="kobo.2118.1">ViewModel</span></code><span class="koboSpan" id="kobo.2119.1">. </span><span class="koboSpan" id="kobo.2119.2">When a view is invoked by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2120.1">partial</span></code><span class="koboSpan" id="kobo.2121.1"> tag, no layout page is used, since the called view is expected to return an HTML fragment.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2122.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2123.1">ViewData.TemplateInfo.HtmlFieldPrefix</span></code><span class="koboSpan" id="kobo.2124.1"> property of the called view is set to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2125.1">ModelProperty.NestedProperty</span></code><span class="koboSpan" id="kobo.2126.1"> string. </span><span class="koboSpan" id="kobo.2126.2">This way, possible input fields rendered in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2127.1">_viewname.cshtml</span></code><span class="koboSpan" id="kobo.2128.1"> will have the same name as if they had been rendered directly by the calling view.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2129.1">Instead of specifying the ViewModel of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2130.1">_viewname</span></code><span class="koboSpan" id="kobo.2131.1"> through a property of the caller view (ViewModel), you can also directly pass an object that is contained in a variable or returned by a C# expression by replacing </span><code class="inlineCode"><span class="koboSpan" id="kobo.2132.1">for</span></code><span class="koboSpan" id="kobo.2133.1"> with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2134.1">model</span></code><span class="koboSpan" id="kobo.2135.1">, as shown in this example:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.2136.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2137.1">partial</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2138.1">name</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2139.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2140.1">"_viewname"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2141.1">model</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2142.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2143.1">"new MyModel{...})"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2144.1"> /&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2145.1">In this case, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2146.1">ViewData.TemplateInfo.HtmlFieldPrefix</span></code><span class="koboSpan" id="kobo.2147.1"> property of the called view keeps its default value, that is, the</span><a id="_idIndexMarker1250"/><span class="koboSpan" id="kobo.2148.1"> empty string.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2149.1">A view can also call something more complex than another view, that is, another controller method that, in turn, renders a view. </span><span class="koboSpan" id="kobo.2149.2">Controllers that are designed to be invoked by views are called </span><strong class="keyWord"><span class="koboSpan" id="kobo.2150.1">view components</span></strong><span class="koboSpan" id="kobo.2151.1">. </span><span class="koboSpan" id="kobo.2151.2">The</span><a id="_idIndexMarker1251"/><span class="koboSpan" id="kobo.2152.1"> following code is an example of component invocation:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2153.1">&lt;vc:[view-component-name] par1="par1 value" par2="parameter2 value"&gt; &lt;/vc:[view-component-name]&gt;
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2154.1">Parameter names must match the ones used in the view component method. </span><span class="koboSpan" id="kobo.2154.2">However, both the component’s name and parameter names must be translated into kebab case; that is, all the characters must be transformed into lowercase if all the characters in the original name were in uppercase, although the first letter of the name must be preceded by a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2155.1">-</span></code><span class="koboSpan" id="kobo.2156.1">. </span><span class="koboSpan" id="kobo.2156.2">For instance, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2157.1">MyParam</span></code><span class="koboSpan" id="kobo.2158.1"> must be transformed into </span><code class="inlineCode"><span class="koboSpan" id="kobo.2159.1">my-param</span></code><span class="koboSpan" id="kobo.2160.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2161.1">Actually, view components are either classes that derive from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2162.1">ViewComponent</span></code><span class="koboSpan" id="kobo.2163.1"> class, classes decorated with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2164.1">[ViewComponent]</span></code><span class="koboSpan" id="kobo.2165.1"> attribute, or classes whose names end with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2166.1">ViewComponent</span></code><span class="koboSpan" id="kobo.2167.1"> suffix. </span><span class="koboSpan" id="kobo.2167.2">When a component is invoked, the framework looks for either an </span><code class="inlineCode"><span class="koboSpan" id="kobo.2168.1">Invoke</span></code><span class="koboSpan" id="kobo.2169.1"> method or an </span><code class="inlineCode"><span class="koboSpan" id="kobo.2170.1">InvokeAsync</span></code><span class="koboSpan" id="kobo.2171.1"> method and passes it all the parameters that were defined in the component’s invocation. </span><code class="inlineCode"><span class="koboSpan" id="kobo.2172.1">InvokeAsync</span></code><span class="koboSpan" id="kobo.2173.1"> must be used if the method is defined as </span><code class="inlineCode"><span class="koboSpan" id="kobo.2174.1">async</span></code><span class="koboSpan" id="kobo.2175.1">; otherwise, we must use </span><code class="inlineCode"><span class="koboSpan" id="kobo.2176.1">Invoke</span></code><span class="koboSpan" id="kobo.2177.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2178.1">The following code is an example of a view component definition:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2179.1">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2180.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2181.1">MyTestViewComponent</span></span><span class="koboSpan" id="kobo.2182.1"> : </span><span class="hljs-title"><span class="koboSpan" id="kobo.2183.1">ViewComponent</span></span><span class="koboSpan" id="kobo.2184.1">
    {
       
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2185.1">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2186.1">async</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2187.1"> Task&lt;IViewComponentResult&gt; </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.2188.1">InvokeAsync</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2189.1">(</span></span>
<span class="hljs-params"> </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2190.1">int</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2191.1"> par1, </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2192.1">bool</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2193.1"> par2</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2194.1">)</span></span><span class="koboSpan" id="kobo.2195.1">
        {
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2196.1">var</span></span><span class="koboSpan" id="kobo.2197.1"> model= ....
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2198.1">return</span></span><span class="koboSpan" id="kobo.2199.1"> View(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2200.1">"ViewName"</span></span><span class="koboSpan" id="kobo.2201.1">, model);
        }
       
    }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2202.1">The previously defined component must be invoked with a call such as the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.2203.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2204.1">vc:my-test</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2205.1">par1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2206.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2207.1">"10"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2208.1">par2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2209.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2210.1">"true"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2211.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2212.1">vc:y-test</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2213.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2214.1">If the component is invoked by </span><a id="_idIndexMarker1252"/><span class="koboSpan" id="kobo.2215.1">a view of a controller called </span><code class="inlineCode"><span class="koboSpan" id="kobo.2216.1">MyController</span></code><span class="koboSpan" id="kobo.2217.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2218.1">ViewName</span></code><span class="koboSpan" id="kobo.2219.1"> is searched for in the following paths:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.2220.1">/Views/MyController/Components/MyTest/ViewName</span></code></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.2221.1">/Views/Shared/Components/MyTest/ViewName</span></code></li>
</ul>
<h1 class="heading-1" id="_idParaDest-355"><span class="koboSpan" id="kobo.2222.1">Understanding the connection between ASP.NET Core MVC and design principles</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2223.1">The whole ASP.NET Core framework is built on top of the design principles and patterns that we analyzed in </span><em class="chapterRef"><span class="koboSpan" id="kobo.2224.1">Chapter 11</span></em><span class="koboSpan" id="kobo.2225.1">, </span><em class="italic"><span class="koboSpan" id="kobo.2226.1">Applying a Microservice Architecture to Your Enterprise Application</span></em><span class="koboSpan" id="kobo.2227.1">, </span><em class="chapterRef"><span class="koboSpan" id="kobo.2228.1">Chapter 13</span></em><span class="koboSpan" id="kobo.2229.1">, </span><em class="italic"><span class="koboSpan" id="kobo.2230.1">Interacting with </span></em><em class="italic"><a id="_idIndexMarker1253"/></em><em class="italic"><span class="koboSpan" id="kobo.2231.1">Data in C# – Entity Framework Core</span></em><span class="koboSpan" id="kobo.2232.1">, </span><em class="chapterRef"><span class="koboSpan" id="kobo.2233.1">Chapter 6</span></em><span class="koboSpan" id="kobo.2234.1">, </span><em class="italic"><span class="koboSpan" id="kobo.2235.1">Design Patterns and .NET 8 Implementation</span></em><span class="koboSpan" id="kobo.2236.1">, </span><em class="chapterRef"><span class="koboSpan" id="kobo.2237.1">Chapter 7</span></em><span class="koboSpan" id="kobo.2238.1">, </span><em class="italic"><span class="koboSpan" id="kobo.2239.1">Understanding the Different Domains in Software Solutions</span></em><span class="koboSpan" id="kobo.2240.1">, and </span><em class="chapterRef"><span class="koboSpan" id="kobo.2241.1">Chapter 5</span></em><span class="koboSpan" id="kobo.2242.1">, </span><em class="italic"><span class="koboSpan" id="kobo.2243.1">Implementing </span></em><em class="italic"><a id="_idIndexMarker1254"/></em><em class="italic"><span class="koboSpan" id="kobo.2244.1">Code Reusability in C# 12</span></em><span class="koboSpan" id="kobo.2245.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2246.1">Moreover, all framework functionalities are provided through DI so that each of them can be replaced by a customized counterpart, without it affecting the remainder of the code. </span><span class="koboSpan" id="kobo.2246.2">Moreover, these providers are not added individually to the DI engine; instead, they are grouped into collection properties of option objects (see the </span><em class="italic"><span class="koboSpan" id="kobo.2247.1">Loading configuration data and using it with the options framework</span></em><span class="koboSpan" id="kobo.2248.1"> subsection) for improved maintainability, and to conform to the Separation of Concerns principle, which is a generalization of the Single Responsibility principle. </span><span class="koboSpan" id="kobo.2248.2">In fact, the order in which providers are added to their collection does matter, since they are processed in the same order as they are in the collection. </span><span class="koboSpan" id="kobo.2248.3">Moreover, the effect of a provider also depends on the other providers that belong to the same collection, so sometimes, it is not enough to replace a provider or add a new provider, but it is necessary to also remove/replace other providers to remove their side effects.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2249.1">Examples of providers grouped in collections include all model binders, validation providers, and data annotation providers.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2250.1">Moreover, configuration data, instead of being available from a unique dictionary created from a configuration file, is organized into option objects thanks to the options framework we described in the first section of this chapter. </span><span class="koboSpan" id="kobo.2250.2">This is also an application of the SOLID Interface Segregation principle.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2251.1">However, ASP.NET Core also applies other patterns that are specific instances of the general Separation of Concerns principle, which (as mentioned earlier) is a generalization of the Single </span><a id="_idIndexMarker1255"/><span class="koboSpan" id="kobo.2252.1">Responsibility principle. </span><span class="koboSpan" id="kobo.2252.2">They are as follows:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2253.1">The middleware modules </span><a id="_idIndexMarker1256"/><span class="koboSpan" id="kobo.2254.1">architecture (the ASP.NET Core pipeline)</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2255.1">Factoring out validation and globalization from the application code</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2256.1">The MVC pattern itself</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.2257.1">We will analyze each of these in the various subsections that follow.</span></p>
<h2 class="heading-2" id="_idParaDest-356"><span class="koboSpan" id="kobo.2258.1">Advantages of the ASP.NET Core pipeline</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2259.1">The ASP.NET Core pipeline architecture has two</span><a id="_idIndexMarker1257"/><span class="koboSpan" id="kobo.2260.1"> important advantages:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2261.1">All the different operations that are</span><a id="_idIndexMarker1258"/><span class="koboSpan" id="kobo.2262.1"> performed on the initial request are factored out into different modules, according to the Single Responsibility principle.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2263.1">The modules that perform these different operations don’t need to call each other because each module is invoked once and for all by the ASP.NET Core framework. </span><span class="koboSpan" id="kobo.2263.2">This way, the code for each module is not required to perform any action that is connected to responsibilities that have been assigned to other modules.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.2264.1">This ensures maximum independence of functionalities and simpler code. </span><span class="koboSpan" id="kobo.2264.2">For instance, once the authorization and authentication modules are active, no other module needs to worry about authorization anymore. </span><span class="koboSpan" id="kobo.2264.3">Each piece controller code can focus on application-specific business stuff.</span></p>
<h2 class="heading-2" id="_idParaDest-357"><span class="koboSpan" id="kobo.2265.1">Server-side and client-side validation</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2266.1">Validation logic has been completely factored out from the application code and has been confined to the definition</span><a id="_idIndexMarker1259"/><span class="koboSpan" id="kobo.2267.1"> of validation attributes. </span><span class="koboSpan" id="kobo.2267.2">The developer just needs to specify the validation rule to apply to each </span><a id="_idIndexMarker1260"/><span class="koboSpan" id="kobo.2268.1">model property, by decorating the property with an adequate validation attribute.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2269.1">Validation rules are checked automatically when action method parameters are instantiated. </span><span class="koboSpan" id="kobo.2269.2">Both errors and paths in the model (where they occurred) are then recorded in a dictionary that is contained in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2270.1">ModelState</span></code><span class="koboSpan" id="kobo.2271.1"> controller property. </span><span class="koboSpan" id="kobo.2271.2">The developer has the responsibility for verifying whether there are errors by checking </span><code class="inlineCode"><span class="koboSpan" id="kobo.2272.1">ModelState.IsValid</span></code><span class="koboSpan" id="kobo.2273.1">, in which case the developer must return the same ViewModel to the same view so that the user can correct any errors.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2274.1">Error messages are automatically shown in the view, with no action required from the developer. </span><span class="koboSpan" id="kobo.2274.2">The developer is only required to do the following:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2275.1">Add </span><code class="inlineCode"><span class="koboSpan" id="kobo.2276.1">span</span></code><span class="koboSpan" id="kobo.2277.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.2278.1">div</span></code><span class="koboSpan" id="kobo.2279.1"> with an </span><code class="inlineCode"><span class="koboSpan" id="kobo.2280.1">asp-validation-for</span></code><span class="koboSpan" id="kobo.2281.1"> attribute next to each input field, which will be automatically filled with the possible error.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2282.1">Add </span><code class="inlineCode"><span class="koboSpan" id="kobo.2283.1">div</span></code><span class="koboSpan" id="kobo.2284.1"> with an </span><code class="inlineCode"><span class="koboSpan" id="kobo.2285.1">asp-validation-summary</span></code><span class="koboSpan" id="kobo.2286.1"> attribute that will be automatically filled with the validation error summary. </span><span class="koboSpan" id="kobo.2286.2">See the </span><em class="italic"><span class="koboSpan" id="kobo.2287.1">Using Razor tag helpers</span></em><span class="koboSpan" id="kobo.2288.1"> section for more details.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.2289.1">It is sufficient to add some JavaScript references by invoking the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2290.1">_ValidationScriptsPartial.cshtml</span></code><span class="koboSpan" id="kobo.2291.1"> view with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2292.1">partial</span></code><span class="koboSpan" id="kobo.2293.1"> tag, enabling the same validation rules on the client side so that errors are shown to the user before the form is posted to the server. </span><span class="koboSpan" id="kobo.2293.2">Some predefined validation attributes are contained in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2294.1">S stem.ComponentModel.DataAnnotations</span></code><span class="koboSpan" id="kobo.2295.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2296.1">Microsoft.AspNetCore.Mvc</span></code><span class="koboSpan" id="kobo.2297.1"> namespaces and include the following attributes:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2298.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2299.1">Required</span></code><span class="koboSpan" id="kobo.2300.1"> attribute requires the user to specify a value for the property that it decorates. </span><span class="koboSpan" id="kobo.2300.2">An implicit </span><code class="inlineCode"><span class="koboSpan" id="kobo.2301.1">Required</span></code><span class="koboSpan" id="kobo.2302.1"> attribute is automatically applied to all non-nullable properties, such as all floats, integers, and decimals, since they can’t have a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2303.1">null</span></code><span class="koboSpan" id="kobo.2304.1"> value.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2305.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2306.1">Range</span></code><span class="koboSpan" id="kobo.2307.1"> attribute constrains numeric quantities within a range.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2308.1">They also include attributes that constrain string lengths.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.2309.1">Custom error messages can be inserted directly into the attributes, or attributes can refer to the property of the resource types containing them.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2310.1">The developer can define their custom attributes by providing the validation code, both in C# and in JavaScript for client-side validation. </span><span class="koboSpan" id="kobo.2310.2">The definition of custom validation attributes is discussed in this article: </span><a href="https://blogs.msdn.microsoft.com/mvpawardprogram/2017/01/03/asp-net-core-mvc/"><span class="url"><span class="koboSpan" id="kobo.2311.1">https://blogs.msdn.microsoft.com/mvpawardprogram/2017/01/03/asp-net-core-mvc/</span></span></a><span class="koboSpan" id="kobo.2312.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2313.1">Attribute-based validation </span><a id="_idIndexMarker1261"/><span class="koboSpan" id="kobo.2314.1">can be replaced by </span><a id="_idIndexMarker1262"/><span class="koboSpan" id="kobo.2315.1">other validation providers, such as the </span><strong class="keyWord"><span class="koboSpan" id="kobo.2316.1">FluentValidation</span></strong><span class="koboSpan" id="kobo.2317.1"> library that defines validation rules for each type using a fluent interface. </span><span class="koboSpan" id="kobo.2317.2">It is enough to change a provider in</span><a id="_idIndexMarker1263"/><span class="koboSpan" id="kobo.2318.1"> a collection contained in the MVC options object. </span><span class="koboSpan" id="kobo.2318.2">This can be configured through an action passed to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2319.1">builder.Services.AddControllersWithViews</span></code><span class="koboSpan" id="kobo.2320.1"> method.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2321.1">MVC options can be configured as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2322.1">builder.Services.AddControllersWithViews(o =&gt; {
    ...
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2323.1">// code that modifies o properties</span></span><span class="koboSpan" id="kobo.2324.1">
});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2325.1">The validation framework automatically checks whether numeric and date inputs are well formatted according to the selected culture.</span></p>
<h2 class="heading-2" id="_idParaDest-358"><span class="koboSpan" id="kobo.2326.1">ASP.NET Core globalization</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2327.1">In multicultural applications, pages must be served according to the language and cultural preferences of each user. </span><span class="koboSpan" id="kobo.2327.2">Typically, multicultural </span><a id="_idIndexMarker1264"/><span class="koboSpan" id="kobo.2328.1">applications can serve their content in a few languages, and they can handle dates and numeric formats in several more languages. </span><span class="koboSpan" id="kobo.2328.2">In fact, while the content in all supported languages must be produced manually, .NET has the native capability of formatting and parsing dates and numbers in all cultures.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2329.1">For instance, a web application might not support unique content for all English-based cultures (en), but it might support all known English-based cultures regarding number and date formats (en-US, en-GB, en-CA, and so on).</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2330.1">The culture used for numbers and dates in a .NET thread is contained in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2331.1">Thread.CurrentThread.CurrentCulture</span></code><span class="koboSpan" id="kobo.2332.1"> property. </span><span class="koboSpan" id="kobo.2332.2">Hence, by setting this property to </span><code class="inlineCode"><span class="koboSpan" id="kobo.2333.1">new CultureInfo("en-CA")</span></code><span class="koboSpan" id="kobo.2334.1">, numbers and dates will be formatted/parsed according to the Canadian format. </span><code class="inlineCode"><span class="koboSpan" id="kobo.2335.1">Thread.CurrentThread.CurrentUICulture</span></code><span class="koboSpan" id="kobo.2336.1">, instead, decides on the culture of the resource files; that is, it selects a culture-specific version of each resource file or view. </span><span class="koboSpan" id="kobo.2336.2">Accordingly, a multicultural application is required to set the two cultures associated with the request thread and organize multilingual content into language-dependent resource files and/or views.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2337.1">According to the Separation of Concerns principle, the whole logic used to set the request culture according to the user’s preferences is factored out into a specific module of the ASP.NET Core</span><a id="_idIndexMarker1265"/><span class="koboSpan" id="kobo.2338.1"> pipeline. </span><span class="koboSpan" id="kobo.2338.2">To configure this module, as a first step, we set the supported date/number cultures, as shown in the following example:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2339.1">var</span></span><span class="koboSpan" id="kobo.2340.1"> supportedCultures = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2341.1">new</span></span><span class="koboSpan" id="kobo.2342.1">[]
{
   </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2343.1">new</span></span><span class="koboSpan" id="kobo.2344.1"> CultureInfo(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2345.1">"en-AU"</span></span><span class="koboSpan" id="kobo.2346.1">),
   </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2347.1">new</span></span><span class="koboSpan" id="kobo.2348.1"> CultureInfo(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2349.1">"en-GB"</span></span><span class="koboSpan" id="kobo.2350.1">),
   </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2351.1">new</span></span><span class="koboSpan" id="kobo.2352.1"> CultureInfo(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2353.1">"en"</span></span><span class="koboSpan" id="kobo.2354.1">),
   </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2355.1">new</span></span><span class="koboSpan" id="kobo.2356.1"> CultureInfo(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2357.1">"es-MX"</span></span><span class="koboSpan" id="kobo.2358.1">),
   </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2359.1">new</span></span><span class="koboSpan" id="kobo.2360.1"> CultureInfo(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2361.1">"es"</span></span><span class="koboSpan" id="kobo.2362.1">),
   </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2363.1">new</span></span><span class="koboSpan" id="kobo.2364.1"> CultureInfo(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2365.1">"fr-CA"</span></span><span class="koboSpan" id="kobo.2366.1">),
   </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2367.1">new</span></span><span class="koboSpan" id="kobo.2368.1"> CultureInfo(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2369.1">"fr"</span></span><span class="koboSpan" id="kobo.2370.1">),
   </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2371.1">new</span></span><span class="koboSpan" id="kobo.2372.1"> CultureInfo(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2373.1">"it-CH"</span></span><span class="koboSpan" id="kobo.2374.1">),
   </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2375.1">new</span></span><span class="koboSpan" id="kobo.2376.1"> CultureInfo(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2377.1">"it"</span></span><span class="koboSpan" id="kobo.2378.1">)
};
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2379.1">Then, we set the languages supported for the content. </span><span class="koboSpan" id="kobo.2379.2">Usually, a version of the language that is not specific to any country is selected to keep the number of translations small enough, as shown here:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2380.1">var</span></span><span class="koboSpan" id="kobo.2381.1"> supportedUICultures = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2382.1">new</span></span><span class="koboSpan" id="kobo.2383.1">[]
{
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2384.1">new</span></span><span class="koboSpan" id="kobo.2385.1"> CultureInfo(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2386.1">"en"</span></span><span class="koboSpan" id="kobo.2387.1">),
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2388.1">new</span></span><span class="koboSpan" id="kobo.2389.1"> CultureInfo(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2390.1">"es"</span></span><span class="koboSpan" id="kobo.2391.1">),
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2392.1">new</span></span><span class="koboSpan" id="kobo.2393.1"> CultureInfo(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2394.1">"fr"</span></span><span class="koboSpan" id="kobo.2395.1">),
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2396.1">new</span></span><span class="koboSpan" id="kobo.2397.1"> CultureInfo(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2398.1">"it"</span></span><span class="koboSpan" id="kobo.2399.1">)
};
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2400.1">Then, we add the culture middleware to the pipeline, as shown here:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2401.1">app.UseRequestLocalization(</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2402.1">new</span></span><span class="koboSpan" id="kobo.2403.1"> RequestLocalizationOptions
{
     DefaultRequestCulture = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2404.1">new</span></span><span class="koboSpan" id="kobo.2405.1"> RequestCulture(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2406.1">"en"</span></span><span class="koboSpan" id="kobo.2407.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.2408.1">"en"</span></span><span class="koboSpan" id="kobo.2409.1">),
     </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2410.1">// Formatting numbers, dates, etc.</span></span><span class="koboSpan" id="kobo.2411.1">
     SupportedCultures = supportedCultures,
     </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2412.1">// UI strings that we have localized.</span></span><span class="koboSpan" id="kobo.2413.1">
     SupportedUICultures = supportedUICultures,
     FallBackToParentCultures = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2414.1">true</span></span><span class="koboSpan" id="kobo.2415.1">,
     FallBackToParentUICultures = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2416.1">true</span></span><span class="koboSpan" id="kobo.2417.1">
});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2418.1">If the culture requested by the </span><a id="_idIndexMarker1266"/><span class="koboSpan" id="kobo.2419.1">user is explicitly found among the ones listed in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2420.1">supportedCultures</span></code><span class="koboSpan" id="kobo.2421.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.2422.1">supportedUICultures</span></code><span class="koboSpan" id="kobo.2423.1">, it is used without modifications. </span><span class="koboSpan" id="kobo.2423.2">Otherwise, since </span><code class="inlineCode"><span class="koboSpan" id="kobo.2424.1">FallBackToParentCultures</span></code><span class="koboSpan" id="kobo.2425.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2426.1">FallBackToParentUICultures</span></code><span class="koboSpan" id="kobo.2427.1"> are </span><code class="inlineCode"><span class="koboSpan" id="kobo.2428.1">true</span></code><span class="koboSpan" id="kobo.2429.1">, the parent culture is tried; that is, for instance, if the required </span><code class="inlineCode"><span class="koboSpan" id="kobo.2430.1">fr-FR</span></code><span class="koboSpan" id="kobo.2431.1"> culture is not found among those listed, then the framework searches for its generic version, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2432.1">fr</span></code><span class="koboSpan" id="kobo.2433.1">. </span><span class="koboSpan" id="kobo.2433.2">If this attempt also fails, the framework uses the cultures specified in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2434.1">DefaultRequestCulture</span></code><span class="koboSpan" id="kobo.2435.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2436.1">By default, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2437.1">culture</span></code><span class="koboSpan" id="kobo.2438.1"> middleware searches the culture selected for the current user, with three providers that are tried in the order shown here:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2439.1">The middleware looks for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2440.1">culture</span></code><span class="koboSpan" id="kobo.2441.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2442.1">ui-culture</span></code><span class="koboSpan" id="kobo.2443.1"> query string parameters.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2444.1">If the previous step fails, the middleware looks for a cookie named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2445.1">.AspNetCore.Culture</span></code><span class="koboSpan" id="kobo.2446.1">, the value of which is expected to be as in this example: </span><code class="inlineCode"><span class="koboSpan" id="kobo.2447.1">c=en-US|uic=en</span></code><span class="koboSpan" id="kobo.2448.1">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2449.1">If both previous steps fail, the middleware looks for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2450.1">Accept-Language</span></code><span class="koboSpan" id="kobo.2451.1"> request header sent by the browser, which can be changed in the browser settings, and which is initially set to the operating system culture.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.2452.1">With the preceding strategy, the first time a user requests an application page, the browser culture is taken (the provider listed in </span><em class="italic"><span class="koboSpan" id="kobo.2453.1">step 3</span></em><span class="koboSpan" id="kobo.2454.1">). </span><span class="koboSpan" id="kobo.2454.2">Then, if the user clicks a language-change link with the right query string parameters, a new culture is selected by provider 1. </span><span class="koboSpan" id="kobo.2454.3">Usually, once a language link has been clicked, the server also generates a language cookie to remember the user’s choice through provider 2.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2455.1">The simplest way to provide content localization is to provide a different view for each language. </span><span class="koboSpan" id="kobo.2455.2">Hence, if we would like to localize the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2456.1">Home.cshtml</span></code><span class="koboSpan" id="kobo.2457.1"> view for different languages, we must provide views named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2458.1">Home.en.cshtml</span></code><span class="koboSpan" id="kobo.2459.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2460.1">Home.es.cshtml</span></code><span class="koboSpan" id="kobo.2461.1">, and so on. </span><span class="koboSpan" id="kobo.2461.2">If no view specific to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2462.1">ui-culture</span></code><span class="koboSpan" id="kobo.2463.1"> thread is found, the non-localized </span><code class="inlineCode"><span class="koboSpan" id="kobo.2464.1">Home.cshtml</span></code><span class="koboSpan" id="kobo.2465.1"> version of the view is chosen.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2466.1">View localization must be enabled by calling the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2467.1">AddViewLocalization</span></code><span class="koboSpan" id="kobo.2468.1"> method, as shown here:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2469.1">builder.Services.AddControllersWithViews()
    .AddViewLocalization(LanguageViewLocationExpanderFormat.Suffix)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2470.1">Another option is to store simple strings or HTML fragments in resource files specific to all supported languages. </span><span class="koboSpan" id="kobo.2470.2">The usage of resource files must be enabled by calling the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2471.1">AddLocalization</span></code><span class="koboSpan" id="kobo.2472.1"> method in</span><a id="_idIndexMarker1267"/><span class="koboSpan" id="kobo.2473.1"> the configure services section, as shown here:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2474.1">builder.Services.AddLocalization(options =&gt;
    options.ResourcesPath = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2475.1">"Resources"</span></span><span class="koboSpan" id="kobo.2476.1">);
</span></code></pre>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.2477.1">ResourcesPath</span></code><span class="koboSpan" id="kobo.2478.1"> is the root folder where all resource files will be placed. </span><span class="koboSpan" id="kobo.2478.2">If it is not specified, an empty string is assumed, and the resource files will be placed in the web application root. </span><span class="koboSpan" id="kobo.2478.3">Resource files for a specific view (say, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2479.1">/Views/Home/Index.cshtml</span></code><span class="koboSpan" id="kobo.2480.1"> view) must have a path like this:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.2481.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2482.1">ResourcesPath</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2483.1"> &gt;</span></span><span class="koboSpan" id="kobo.2484.1">/Views/Home/Index.</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2485.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2486.1">culture</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2487.1">name</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2488.1">&gt;</span></span><span class="koboSpan" id="kobo.2489.1">.resx
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2490.1">Hence, if </span><code class="inlineCode"><span class="koboSpan" id="kobo.2491.1">ResourcesPath</span></code><span class="koboSpan" id="kobo.2492.1"> is empty, resources must have the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2493.1">/Views/Home/Index.&lt;culture name&gt;.resx</span></code><span class="koboSpan" id="kobo.2494.1"> path; that is, they must be placed in the same folder as the view.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2495.1">Once the key-value pairs for all the resource files associated with a view have been added, localized HTML fragments can be added to the view, as follows:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2496.1">Inject </span><code class="inlineCode"><span class="koboSpan" id="kobo.2497.1">IViewLocalizer</span></code><span class="koboSpan" id="kobo.2498.1"> into the view with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2499.1">@inject IViewLocalizer Localizer</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2500.1">Where needed, replace the text in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2501.1">View</span></code><span class="koboSpan" id="kobo.2502.1"> with access to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2503.1">Localizer</span></code><span class="koboSpan" id="kobo.2504.1"> dictionary, such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.2505.1">Localizer</span></code><span class="koboSpan" id="kobo.2506.1">[“</span><code class="inlineCode"><span class="koboSpan" id="kobo.2507.1">myKey</span></code><span class="koboSpan" id="kobo.2508.1">”], where “</span><code class="inlineCode"><span class="koboSpan" id="kobo.2509.1">myKey</span></code><span class="koboSpan" id="kobo.2510.1">” is a key used in the resource files.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.2511.1">The following code shows an example of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2512.1">IViewLocalizer</span></code><span class="koboSpan" id="kobo.2513.1"> dictionary:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2514.1">@{
    ViewData["Title"] = Localizer["HomePageTitle"];
}
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2515.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2516.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2517.1">&gt;</span></span><span class="koboSpan" id="kobo.2518.1">@ViewData["MyTitle"]</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2519.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2520.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2521.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2522.1">If localization fails because the key is not found in the resource file, the key itself is returned. </span><span class="koboSpan" id="kobo.2522.2">Strings used in data annotation, such as validation attributes, are used as keys in resource files if data annotation localization is enabled, as shown here:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2523.1">builder.Services.AddControllersWithViews()
    .AddViewLocalization(LanguageViewLocationExpanderFormat.Suffix)
    .AddDataAnnotationsLocalization();
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2524.1">Resource files for data annotations applied to a class whose full name is, say, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2525.1">MyWebApplication.ViewModels.Account.RegisterViewModel</span></code><span class="koboSpan" id="kobo.2526.1"> must have the following path:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2527.1">{ResourcesPath}/ViewModels/Account/RegisterViewModel.{culture name}.resx
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2528.1">It is worth pointing out that the first segment of the namespace that corresponds to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2529.1">.dll</span></code><span class="koboSpan" id="kobo.2530.1"> application name is replaced with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2531.1">ResourcesPath</span></code><span class="koboSpan" id="kobo.2532.1">. </span><span class="koboSpan" id="kobo.2532.2">If </span><code class="inlineCode"><span class="koboSpan" id="kobo.2533.1">ResourcesPath</span></code><span class="koboSpan" id="kobo.2534.1"> is empty and you use the default namespaces created by Visual Studio, then the resource files must be placed in the same folder that contains the classes they are associated with.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2535.1">It is possible to localize strings and HTML fragments in controllers, or wherever dependencies can be injected, by </span><a id="_idIndexMarker1268"/><span class="koboSpan" id="kobo.2536.1">associating each group of resource files with a type, such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.2537.1">MyType</span></code><span class="koboSpan" id="kobo.2538.1">, and then injecting either </span><code class="inlineCode"><span class="koboSpan" id="kobo.2539.1">IHtmlLocalizer&lt;MyType&gt;</span></code><span class="koboSpan" id="kobo.2540.1"> for HTML fragments or </span><code class="inlineCode"><span class="koboSpan" id="kobo.2541.1">IStringLocalizer&lt;MyType&gt;</span></code><span class="koboSpan" id="kobo.2542.1"> for strings that need to be HTML-encoded.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2543.1">Their usage is identical to the usage of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2544.1">IViewLocalizer</span></code><span class="koboSpan" id="kobo.2545.1">. </span><span class="koboSpan" id="kobo.2545.2">The path of the resource files associated with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2546.1">MyType</span></code><span class="koboSpan" id="kobo.2547.1"> is computed, as in the case of data annotations. </span><span class="koboSpan" id="kobo.2547.2">If you would like to use a unique group of resource files for the whole application, a common choice is to use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2548.1">Startup</span></code><span class="koboSpan" id="kobo.2549.1"> class as the reference type (</span><code class="inlineCode"><span class="koboSpan" id="kobo.2550.1">IStringLocalizer&lt;Startup&gt;</span></code><span class="koboSpan" id="kobo.2551.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2552.1">IHtmlLocalizer&lt;Startup&gt;</span></code><span class="koboSpan" id="kobo.2553.1">). </span><span class="koboSpan" id="kobo.2553.2">Another common choice is to create various empty classes to use as reference types for various groups of resource files.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2554.1">Now that we’ve learned how to manage globalization in our ASP.NET Core projects, in the next subsection, we will describe the more important pattern used by ASP.NET Core MVC to enforce a </span><em class="italic"><span class="koboSpan" id="kobo.2555.1">separation of concerns</span></em><span class="koboSpan" id="kobo.2556.1">: the MVC pattern itself.</span></p>
<h2 class="heading-2" id="_idParaDest-359"><span class="koboSpan" id="kobo.2557.1">The MVC pattern</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2558.1">MVC is a pattern used to implement the</span><a id="_idIndexMarker1269"/><span class="koboSpan" id="kobo.2559.1"> presentation layers </span><a id="_idIndexMarker1270"/><span class="koboSpan" id="kobo.2560.1">of a web application. </span><span class="koboSpan" id="kobo.2560.2">The basic idea is to apply a </span><em class="italic"><span class="koboSpan" id="kobo.2561.1">Separation of Concerns</span></em><span class="koboSpan" id="kobo.2562.1"> between the logic of the presentation layer and its graphics. </span><span class="koboSpan" id="kobo.2562.2">Logic is taken care of by controllers, while graphics are factored out into views. </span><span class="koboSpan" id="kobo.2562.3">Controllers and views communicate through the model, which is often called the ViewModel to distinguish it from the models of the business and data layers. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.2563.1">It is worth pointing out that the original definition of the MVC pattern proposes directly the use of domain models instead of ViewModels, but then, most of the MVC web frameworks started using the concept of ViewModel because specifying the information to render in a view requires just a projection of the original domain model (just some model data possibly organized in a different way) and often additional data, such as, for instance, the items per page of a pager, and the items required by the type input selected.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2564.1">However, what is the logic of a presentation layer? </span><span class="koboSpan" id="kobo.2564.2">In </span><em class="italic"><span class="koboSpan" id="kobo.2565.1">Chapter 1</span></em><span class="koboSpan" id="kobo.2566.1">, </span><em class="italic"><span class="koboSpan" id="kobo.2567.1">Understanding the Importance of Software Architecture</span></em><span class="koboSpan" id="kobo.2568.1">, we saw that software requirements can be documented with use cases that describe the interaction between the user and the system.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2569.1">Roughly speaking, the logic </span><a id="_idIndexMarker1271"/><span class="koboSpan" id="kobo.2570.1">of the presentation layer consists of the management of use cases; hence, roughly, use cases are mapped to controllers, and every single operation of a use case is mapped to an action method of those controllers. </span><span class="koboSpan" id="kobo.2570.2">Hence, controllers take care of managing the protocol of interaction with the user and rely on the business layer for any business processing involved during each operation.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2571.1">Each action method receives data from the user, performs some business processing, and, depending on the results of this processing, decides what to show to the user and encodes it in the ViewModel. </span><span class="koboSpan" id="kobo.2571.2">Views receive ViewModels that describe what to show to the user and decide the graphics to use, that is, the HTML to use.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2572.1">What are the advantages of separating the logic and user interface into two different components? </span><span class="koboSpan" id="kobo.2572.2">The main advantages are listed here:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2573.1">Changes in graphics do not affect the remainder of the code, so you can experiment with various user interface elements to optimize the interaction with the user, without putting the reliability of the remainder of the code at risk.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2574.1">The application can be tested by instantiating controllers and passing the parameters, with no need to use testing tools that operate on the browser pages. </span><span class="koboSpan" id="kobo.2574.2">In this way, tests are easier to implement. </span><span class="koboSpan" id="kobo.2574.3">Moreover, they do not depend on the way graphics are implemented, so they do not need to be updated each time the graphics change.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2575.1">It is easier to split the job between developers who implement controllers and graphic designers who implement views. </span><span class="koboSpan" id="kobo.2575.2">Often, graphic designers have difficulties with Razor, so they might just furnish an example HTML page that developers transform into Razor views that operate on the actual data.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.2576.1">For an example of how to put into</span><a id="_idIndexMarker1272"/><span class="koboSpan" id="kobo.2577.1"> practice the general principles discussed above, please refer to the </span><em class="italic"><span class="koboSpan" id="kobo.2578.1">A frontend microservice</span></em><span class="koboSpan" id="kobo.2579.1"> section in </span><em class="italic"><span class="koboSpan" id="kobo.2580.1">Chapter 21</span></em><span class="koboSpan" id="kobo.2581.1">, </span><em class="italic"><span class="koboSpan" id="kobo.2582.1">Case Study</span></em><span class="koboSpan" id="kobo.2583.1">, but it is better to read </span><em class="italic"><span class="koboSpan" id="kobo.2584.1">Chapter 18</span></em><span class="koboSpan" id="kobo.2585.1">, </span><em class="italic"><span class="koboSpan" id="kobo.2586.1">Implementing Frontend Microservices with ASP.NET Core</span></em><span class="koboSpan" id="kobo.2587.1">, beforehand. </span><span class="koboSpan" id="kobo.2587.2">There, we’ll look </span><a id="_idIndexMarker1273"/><span class="koboSpan" id="kobo.2588.1">at how to create a frontend microservice with ASP.NET Core MVC.</span></p>
<h1 class="heading-1" id="_idParaDest-360"><span class="koboSpan" id="kobo.2589.1">Summary</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2590.1">In this chapter, we analyzed the ASP.NET Core pipeline and various modules that comprise an ASP.NET Core MVC application in detail, such as authentication/authorization, the options framework, and routing. </span><span class="koboSpan" id="kobo.2590.2">Then, we described how controllers and Views map requests to the response HTML. </span><span class="koboSpan" id="kobo.2590.3">We also analyzed all the improvements introduced in the latest versions.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2591.1">Finally, we analyzed all the design patterns implemented in the ASP.NET Core MVC framework and, in particular, the importance of the Separation of Concerns principle and how ASP.NET Core MVC implements it in the ASP.NET Core pipeline, as well as in its validation and globalization modules. </span><span class="koboSpan" id="kobo.2591.2">We focused in more detail on the importance of a Separation of Concerns between the presentation layer logic and graphics, as well as how the MVC pattern ensures it.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2592.1">You can find a full example of how to use ASP.NET Core MVC in the next chapter, which deals with frontend microservices and describes a complete frontend microservice, whose presentation layer uses ASP.NET Core MVC.</span></p>
<h1 class="heading-1" id="_idParaDest-361"><span class="koboSpan" id="kobo.2593.1">Questions</span></h1>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2594.1">Can you list all the middleware modules scaffolded by Visual Studio in an ASP.NET Core project?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2595.1">Does the ASP.NET Core pipeline module need to inherit from a base class or implement some interface?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2596.1">Is it true that a tag must have just one tag helper defined for it, as, otherwise, an exception is thrown?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2597.1">Do you remember how to test if validation errors have occurred in a controller?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2598.1">What is the instruction in a layout view for including the output of the main view?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2599.1">How are secondary sections of the main view invoked in a layout view?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2600.1">How does a controller invoke a view?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2601.1">By default, how many providers are installed in the globalization module?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2602.1">Are ViewModels the only way for controllers to communicate with their invoked views?</span></li>
</ol>
<h1 class="heading-1" id="_idParaDest-362"><span class="koboSpan" id="kobo.2603.1">Further reading</span></h1>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2604.1">More details on the ASP.NET Core and ASP.NET Core MVC framework are available in its official documentation at </span><a href="https://docs.microsoft.com/en-US/aspnet/core/"><span class="url"><span class="koboSpan" id="kobo.2605.1">https://docs.microsoft.com/en-US/aspnet/core/</span></span></a><span class="koboSpan" id="kobo.2606.1">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2607.1">More details on the Razor syntax can be found at </span><a href="https://docs.microsoft.com/en-us/aspnet/core/razor-pages/?tabs=visual-studio"><span class="url"><span class="koboSpan" id="kobo.2608.1">https://docs.microsoft.com/en-us/aspnet/core/razor-pages/?tabs=visual-studio</span></span></a><span class="koboSpan" id="kobo.2609.1">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2610.1">How to model bind collections and dictionaries is explained in this excellent Phil Haack post: </span><a href="http://haacked.com/archive/2008/10/23/model-binding-to-a-list.aspx"><span class="url"><span class="koboSpan" id="kobo.2611.1">http://haacked.com/archive/2008/10/23/model-binding-to-a-list.aspx</span></span></a><span class="koboSpan" id="kobo.2612.1">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2613.1">Documentation on the creation of custom tag helpers that were not discussed in this chapter can be found at </span><a href="https://docs.microsoft.com/en-US/aspnet/core/mvc/views/tag-helpers/authoring"><span class="url"><span class="koboSpan" id="kobo.2614.1">https://docs.microsoft.com/en-US/aspnet/core/mvc/views/tag-helpers/authoring</span></span></a><span class="koboSpan" id="kobo.2615.1">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2616.1">Documentation on the creation of custom controller attributes can be found at </span><a href="https://docs.microsoft.com/en-US/aspnet/core/mvc/controllers/filters"><span class="url"><span class="koboSpan" id="kobo.2617.1">https://docs.microsoft.com/en-US/aspnet/core/mvc/controllers/filters</span></span></a><span class="koboSpan" id="kobo.2618.1">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2619.1">The definition of custom validation attributes is discussed in this article: </span><a href="https://blogs.msdn.microsoft.com/mvpawardprogram/2017/01/03/asp-net-core-mvc/"><span class="url"><span class="koboSpan" id="kobo.2620.1">https://blogs.msdn.microsoft.com/mvpawardprogram/2017/01/03/asp-net-core-mvc/</span></span></a></li>
</ul>
<h1 class="heading-1"><span class="koboSpan" id="kobo.2621.1">Learn more on Discord</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2622.1">To join the Discord community for this book – where you can share feedback, ask questions to the authors, and learn about new releases – follow the QR code below:</span></p>
<p class="normal"><a href="https://packt.link/SoftwareArchitectureCSharp12Dotnet8"><span class="url"><span class="koboSpan" id="kobo.2623.1">https://packt.link/SoftwareArchitectureCSharp12Dotnet8</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.2624.1"><img alt="" role="presentation" src="../Images/QR_Code175081751210902046.png"/></span></p>
</div>
</body></html>