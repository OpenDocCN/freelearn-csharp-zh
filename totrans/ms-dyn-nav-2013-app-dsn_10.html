<html><head></head><body><div class="chapter" title="Chapter&#xA0;10.&#xA0;Application Design"><div class="titlepage"><div><div><h1 class="title"><a id="ch10"/>Chapter 10. Application Design</h1></div></div></div><p>In Microsoft Dynamics NAV, technology and functionality go hand in hand. It is impossible to design a good change or enhancement to the application without thorough knowledge of how the standard pieces fit together. With this knowledge now available, we can start designing our own applications.</p><p>In this book, we talked about application design for Microsoft Dynamics NAV. We discussed the design patterns, how it works, and why it works that way. We designed several small and large changes to the system both in detailed examples and on a conceptual level.</p><p>For this chapter, we <a class="indexterm" id="id1309"/>will fit all the pieces together that we have learned in this book and turn them into concepts for good application design.</p><p>We will also discuss how to approach a Microsoft Dynamics NAV implementation project and how to maintain the application. This requires a different approach depending on the level of customization the project contains.</p><div class="section" title="Application life cycle"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec67"/>Application life cycle</h1></div></div></div><p>Designing <a class="indexterm" id="id1310"/>an application is more than just analyzing processes and developing new objects. These phases are just the tip of the iceberg.</p><p>Once your<a class="indexterm" id="id1311"/> application has been designed and developed, it is most likely that one or more companies will start using it. When this happens, your software will start a new phase in its life cycle. Let's have a look at the life cycle of a Microsoft Dynamics NAV application:</p><div class="mediaobject"><img alt="Application life cycle" src="graphics/0365EN_10_01.jpg"/></div><p>The<a class="indexterm" id="id1312"/> <span class="strong"><strong>Development</strong></span> phase<a class="indexterm" id="id1313"/> of the application starts with the <a class="indexterm" id="id1314"/>
<span class="strong"><strong>Fit/Gap</strong></span> analysis, followed by the <a class="indexterm" id="id1315"/>
<span class="strong"><strong>Design</strong></span> and <span class="strong"><strong>Build</strong></span> steps <a class="indexterm" id="id1316"/>we did in the earlier chapters. When that is completed, the <span class="strong"><strong>Maintenance</strong></span> phase<a class="indexterm" id="id1317"/> of your application will start.</p><p>The <span class="strong"><strong>Maintenance</strong></span> phase<a class="indexterm" id="id1318"/> starts with the implementation and taking the software into <span class="strong"><strong>Production</strong></span>. The first time this will happen, it will be the Microsoft Dynamics NAV implementation in your company. Once this is done, your system will enter the real life cycle where constant improvements will be made to the application.</p><p>With the flexibility of the Microsoft Dynamics NAV product, this is a very special procedure where it is easy to encounter the many pitfalls there are along the way.</p><p>We will discuss some guidelines that are important to follow. There are six categories: Design to use, Maintain, Support, Upgrade, Perform, and Analyze.</p><div class="section" title="Design to use"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec196"/>Design to use</h2></div></div></div><p>Designing <a class="indexterm" id="id1319"/>software is not a goal, it's a way to support companies <a class="indexterm" id="id1320"/>doing their business. This makes usability one of the most important focus areas when designing your application.</p><p>The first thing that pops in mind when talking about usability is the user interface. Microsoft Dynamics NAV 2013 has two interfaces that are commonly used, the Windows Client and the new Web Client.</p><div class="section" title="Pages"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec211"/>Pages</h3></div></div></div><p>Page<a class="indexterm" id="id1321"/> objects <a class="indexterm" id="id1322"/>are used to define the user interface. They are very strict in how they are displayed. However, they have a lot of advantages<a class="indexterm" id="id1323"/>. Let's go through some of the design options:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Tabs</strong></span>: Pages <a class="indexterm" id="id1324"/>have vertical tabs that can be opened at the same time, making it less desirable to move fields to the first tab.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Embedded Lists</strong></span>: Another <a class="indexterm" id="id1325"/>advantage of pages is that the users always get to see an embedded list page first and then continue to the card, which opens in a new Windows control after selecting a record.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Importance</strong></span>: On <a class="indexterm" id="id1326"/>pages, it is possible to promote controls to be displayed when the tab is closed or made additional so the end users have to specifically make them visible. Use this functionality carefully when designing your application.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Personalization</strong></span>: If <a class="indexterm" id="id1327"/>not restricted, all pages can be personalized by the end users, even card pages. This makes it easier to customize pages during an implementation for a company, department, or end user. Personalization does not change the object definition and does not require a developer.</li></ul></div><p>Let's walk through the elements of a page as shown in the following screenshot taken from the example add-on solution in <a class="link" href="ch07.html" title="Chapter 7. Storage and Logistics">Chapter 7</a>, <span class="emphasis"><em>Storage and Logistics</em></span>:</p><div class="mediaobject"><img alt="Pages" src="graphics/0365EN_10_03.jpg"/></div><p>Let's have a look at the fields in more detail:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Actions</strong></span>: All transactions that can be performed on a <a class="indexterm" id="id1328"/>page are actions. Some actions are generated by the system while other actions are defined by the developer. Users can select which actions they want to emphasize, making it easier for them to get started with the application.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Fact Boxes</strong></span>: Each page can have an unlimited number of fact boxes<a class="indexterm" id="id1329"/> attached. Fact boxes can be used to show detailed information about a record. The <span class="strong"><strong>Route</strong></span> page in <a class="link" href="ch07.html" title="Chapter 7. Storage and Logistics">Chapter 7</a>, <span class="emphasis"><em>Storage and Logistics</em></span>, is a good example where we can see the route in Bing maps and the details of the stops.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Emphasis</strong></span>: A control <a class="indexterm" id="id1330"/>on a page can be emphasized to a limited combination of colors, bold, and italics.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Client extensibility</strong></span>: A control<a class="indexterm" id="id1331"/> on a page can be taken over by a <code class="literal">.net dll</code>. The .NET control will use the content of the <code class="literal">.dll</code> and render the information. We discussed Client extensibility in <a class="link" href="ch09.html" title="Chapter 9. Interfacing">Chapter 9</a>, <span class="emphasis"><em>Interfacing</em></span>.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Web Services</strong></span>: All pages can be<a class="indexterm" id="id1332"/> exposed as a web service. This makes it possible to create your own user interface in Visual Studio, Borland Delphi, or another development tool that can consume web services.</li></ul></div></div><div class="section" title="Role centers"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec212"/>Role centers</h3></div></div></div><p>When it comes<a class="indexterm" id="id1333"/> to usability in Microsoft Dynamics NAV 2013, the Role Centers<a class="indexterm" id="id1334"/> are the heart of the application. The Role Center is the place where the end users starts their working day and returns to regularly. Let's discuss the Role Centers we created in this book.</p><div class="section" title="Squash application"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec41"/>Squash application</h4></div></div></div><p>The Squash Court Role Center <a class="indexterm" id="id1335"/>was created in <a class="link" href="ch02.html" title="Chapter 2. A Sample Application">Chapter 2</a>, <span class="emphasis"><em>A Sample Application</em></span>, and looks like this:</p><div class="mediaobject"><img alt="Squash application" src="graphics/0365EN_10_04.jpg"/><div class="caption"><p>The purpose of the screenshot is to just familiarize with the different sections in an application</p></div></div><p>The <span class="strong"><strong>Application</strong></span> screen <a class="indexterm" id="id1336"/>has two sections, the <span class="strong"><strong>Menu</strong></span> section and the <span class="strong"><strong>Role Center</strong></span> section.</p><p>The <span class="strong"><strong>Menu</strong></span> section is created by merging actions from the Role Center with the main menu. By clicking on <span class="strong"><strong>Departments</strong></span> in the left-hand side corner, an end user can access the entire application depending on the security setup.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note70"/>Note</h3><p>More information about the home items can be found on the blog at <a class="ulink" href="https://markbrummel.wordpress.com/2014/07/02/tip-26-grouping-in-the-homeitems/">https://markbrummel.wordpress.com/2014/07/02/tip-26-grouping-in-the-homeitems/</a>.</p></div></div><p>The Role Center has a left and right part. The left part usually contains the activities and a shortcut to Microsoft Outlook. The right part contains shortlists to the <span class="strong"><strong>My List</strong></span> pages that show frequently used records and notes. An end user can customize the Role Center and move the parts around.</p></div><div class="section" title="Storage and Logistics"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec42"/>Storage and Logistics</h4></div></div></div><p>This application has four different Role Centers. We will<a class="indexterm" id="id1337"/> discuss the Storage Role Center (123.456.726). Other <a class="indexterm" id="id1338"/>Role Centers are Logistics Role Center (123.456.700), Manager Log. and St. Role Center (123.456.756) Income and Expenses Role Center (123.456.761).</p><div class="mediaobject"><img alt="Storage and Logistics" src="graphics/0365EN_10_05.jpg"/></div><p>On the <span class="strong"><strong>Activities Storage</strong></span> page, employees can directly go to the documents filtered on dates from the stacks. From the <span class="strong"><strong>Menu</strong></span> options, users can create new documents or open worksheets and journals.</p><p>We have designed two shortlist pages, <span class="strong"><strong>My Products</strong></span> and <span class="strong"><strong>My Regions</strong></span>. <span class="strong"><strong>My Products</strong></span> can be changed by the user by clicking on the small lightning button and select <span class="strong"><strong>Manage List</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img alt="Storage and Logistics" src="graphics/0365EN_10_06.jpg"/></div><p>The <span class="strong"><strong>My Region</strong></span> page is built <a class="indexterm" id="id1339"/>on the Region table. Users cannot change <a class="indexterm" id="id1340"/>this list. The page uses the <code class="literal">SourceTableTemporary</code> property and <code class="literal">ShowAsTree</code>. This allows users to expand and collapse warehouses.</p></div></div><div class="section" title="Reports"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec213"/>Reports</h3></div></div></div><p>The<a class="indexterm" id="id1341"/> reports<a class="indexterm" id="id1342"/> in the standard Microsoft Dynamics NAV application are typical ERP reports that show the required information and that's it.</p><p>Designing reports requires special skills and is not as easy as it seems. When changing a report layout from the standard application, it is best practice to leave the original report as it is and modify the saved copy.</p><p>We will discuss more about reports in the <span class="emphasis"><em>Design to analyze</em></span> section.</p></div></div><div class="section" title="Design to Maintain"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec197"/>Design to Maintain</h2></div></div></div><p>It seldom<a class="indexterm" id="id1343"/> happens that software is designed and developed, never to be changed. The objects created are usually changed many times in the lifetime of the application.</p><p>The <a class="indexterm" id="id1344"/>changes to an existing object may be done quite a while after the object's original development. At this time, even if the changes are done by the original developer, it will be difficult to remember how and why some changes are done.</p><p>Hence, it is important to develop in a unified way. This will make it easier for developers to read each other's code or to understand their own code after months or years.</p><p>Written external documentation is a no brainer at this point but we should realize that this is not always done and <a class="indexterm" id="id1345"/>focus on more obvious and easier ways. A well designed and built application should be self-documenting. This is done by following some simple guidelines.</p><div class="section" title="Naming"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec214"/>Naming</h3></div></div></div><p>While <a class="indexterm" id="id1346"/>creating new objects, it is important to follow the naming guidelines of the product. Field and variable names should explain themselves.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip52"/>Tip</h3><p>This MSDN article at <a class="ulink" href="http://msdn.microsoft.com/en-us/library/ee414213.aspx">http://msdn.microsoft.com/en-us/library/ee414213.aspx</a> describes more details on naming conventions in Microsoft Dynamics NAV.</p></div></div><div class="section" title="Singular and plural"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec43"/>Singular and plural</h4></div></div></div><p>Table names should <a class="indexterm" id="id1347"/>be singular. This will make the C/AL <code class="literal">TABLECAPTION</code> command return a usable value. Let's look at an example in the Item table (27):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>OnDelete()</strong></span>
...
ItemJnlLine.SETRANGE("Item No.","No.");
IF ItemJnlLine.FIND('-') THEN
  ERROR(Text023,TABLECAPTION,"No.",ItemJnlLine.TABLECAPTION);</pre></div><p>The preceding command will generate the following error message with the table caption singular:</p><div class="mediaobject"><img alt="Singular and plural" src="graphics/0365EN_10_07.jpg"/></div><p>List pages should be plural <a class="indexterm" id="id1348"/>as they contain more than one record while card pages are singular.</p></div><div class="section" title="Reserved words"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec44"/>Reserved words</h4></div></div></div><p>Reserved words <a class="indexterm" id="id1349"/>should not be used in objects as name for fields, variables, and functions.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note71"/>Note</h3><p>Microsoft has published a list of reserved words at <a class="ulink" href="http://msdn.microsoft.com/en-us/library/ee414230.aspx">http://msdn.microsoft.com/en-us/library/ee414230.aspx</a>.</p></div></div><p>One very important <a class="indexterm" id="id1350"/>reserved word, which is missing in that list is <span class="strong"><strong>Action</strong></span>. This is reserved for using <code class="literal">IF Page.RUNMODAL = ACTION::OK then</code>.</p></div><div class="section" title="Names and abbreviations"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec45"/>Names and abbreviations</h4></div></div></div><p>Using standard naming and abbreviations<a class="indexterm" id="id1351"/> is one of the strong points of the application that makes it easy to learn for new developers.</p><p>Here are some examples:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>&lt;&lt;Table name&gt;&gt; No.</strong></span>: This is the standard reference to a field in a table relation. If the field has a relation with the customer, the field is called <span class="strong"><strong>Customer No.</strong></span> and if the relation is with vendor, we use <span class="strong"><strong>Vendor No</strong></span>. In our example application, we have used <span class="strong"><strong>Product No.</strong></span>, <span class="strong"><strong>Squash Player No.</strong></span>, and so on.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Line No.</strong></span>: This fieldname is always used in the popular Header/Line and Journal constructions. This field always uses the auto split key property in pages.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Entry No.</strong></span>: This fieldname is always used for entry and register tables such as G/L Entry and Customer Ledger Entry.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Name and Description</strong></span>: This is the standard naming for persons or products.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Quantity/Qty.</strong></span>: This is the standard name and abbreviation to measure quantity.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>(LCY)</strong></span>: This is the abbreviation for Local Currency.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Duty Due %</strong></span>: When the field represents a percentage, this sign should be in the field name.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note72"/>Note</h3><p>A list of<a class="indexterm" id="id1352"/> naming conventions can be found on MSDN at <a class="ulink" href="http://msdn.microsoft.com/en-us/library/ee414213.aspx">http://msdn.microsoft.com/en-us/library/ee414213.aspx</a>.</p></div></div></li></ul></div></div></div><div class="section" title="Quantity versus quality"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec215"/>Quantity versus quality</h3></div></div></div><p>There is a <a class="indexterm" id="id1353"/>general rule that can be applied to <a class="indexterm" id="id1354"/>the quantity and quality of software that says that when more functionality is added to the product, it is difficult to maintain a certain level of quality.</p><div class="mediaobject"><img alt="Quantity versus quality" src="graphics/0365EN_10_08.jpg"/></div><p>To avoid this in your solution, make sure you don't just add all the requirements from your prospects into the product<a class="indexterm" id="id1355"/> in one release and instead use a release policy that ensures small pieces of functionality to be developed, tested, and implemented each time.</p><div class="section" title="Loosely coupled"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec46"/>Loosely coupled</h4></div></div></div><p>When<a class="indexterm" id="id1356"/> developing an add-on product, it is important to divide it into smaller parts. This will make it easier to have several developers work on the application and release parts of the application. Each part of the add-on has its own framework that interacts with other pieces of the add-on or the standard product.</p><p>This is exactly what we did in the storage and logistics example add-on application. The add-on has three main functional areas: Storage, Logistics, and Income and Expenses. These three areas share the same master data.</p><p>Each area interacts with other parts of the application using mini interfaces. Using this concept will also have great benefits when upgrading to newer versions, which we will discuss in the <span class="emphasis"><em>Design to upgrade</em></span> section.</p></div></div></div><div class="section" title="Design to support"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec198"/>Design to support</h2></div></div></div><p>There <a class="indexterm" id="id1357"/>are <a class="indexterm" id="id1358"/>different levels of providing support. First-level support is usually done by someone at the customer site that works in the IT department or someone that has a feeling for IT. The general first line support questions are about filters, missing data, and so on.</p><p>Second-level support is usually a small bug in the software or something missing in the setup or master data. Depending on the customer, this will be solved by the internal IT department or escalated to the partner.</p><p>As a developer, you <a class="indexterm" id="id1359"/>will most likely employ third-line support where something needs to be debugged or reverse engineered in order to find the bug.</p><p>So before a bug reaches the developer, other people have already spent time in analyzing the issue without success. The development of the software should be done in such a way that third-line support makes a minimum change or occurrence.</p><p>When the guidelines discussed in the <span class="emphasis"><em>Design to use</em></span> and <span class="emphasis"><em>Design to maintain</em></span> sections are used, it will already be easier for the second-level support to analyze the issue.</p><div class="section" title="Second-level support"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec216"/>Second-level support</h3></div></div></div><p>Most problems <a class="indexterm" id="id1360"/>in support occur in the second level. The first-level support engineers are often very familiar with the system and the third-level support engineers are often the original developers of the software.</p><p>Second-level support people need to be able to go in a database and analyze the issue without having to change their way of thinking.</p><p>Let's briefly summarize the general guidelines for this specific topic:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Shortcuts</strong></span>: Use standard shortcuts<a class="indexterm" id="id1361"/> as much as possible. For example, use <span class="emphasis"><em>F9</em></span> for posting and registering, and <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>F7</em></span> for ledger entries. Avoid using reserved shortcuts such as <span class="emphasis"><em>F8</em></span> (copy previous) and <span class="emphasis"><em>Alt</em></span><span class="strong"><strong> </strong></span>+ <span class="emphasis"><em>F3</em></span> (filter to this value).</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Screen Layout</strong></span>: Avoid screen layouts<a class="indexterm" id="id1362"/> that are too creative. Too much information on a screen is often an indication of a bad design and will be difficult to support. Typical examples are multiple subpages and hiding elements based on business logic subpages.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Variable Naming</strong></span>: As discussed in the <span class="emphasis"><em>Design to maintain</em></span> section, good naming will make a huge <a class="indexterm" id="id1363"/>difference when looking at someone else's design. This starts with trying to use Microsoft's naming conventions for the standard application.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>C/AL Placement</strong></span>: Microsoft Dynamics NAV is <a class="indexterm" id="id1364"/>very flexible when it comes to placing C/AL code in objects. Pages support using C/AL code to the extent that it is possible to write an entire posting routine there. C/AL coding should be done in tables or codeunits unless this is not possible.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Using Functions</strong></span>: When <a class="indexterm" id="id1365"/>your C/AL code exceeds the size of your screen, it is best practice to create a function. This will make the original code more readable for others. Use a name for your function that makes sense so the code will document itself. An example for this can be found in the codeunit Register Time Sheet (75000) we discussed in <a class="link" href="ch08.html" title="Chapter 8. Consulting">Chapter 8</a>, <span class="emphasis"><em>Consulting</em></span>.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Global versus Local Variables</strong></span>: Variables can be both global and local in C/AL. Microsoft <a class="indexterm" id="id1366"/>does not have strict guidelines on which to use when. The general rule when looking at the standard application is to use global variables unless the variable is only used in a function—then it can be local.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip53"/>Tip</h3><p>The compiler does not give a warning when using a local variable with the same name as the global variable. The system will always use the local variable first.</p></div></div></li></ul></div></div></div><div class="section" title="Design to upgrade"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec199"/>Design to upgrade</h2></div></div></div><p>It might <a class="indexterm" id="id1367"/>not <a class="indexterm" id="id1368"/>be the first thing to realize when designing your application but there will come a time when it needs to be upgraded to a newer version.</p><p>When upgrading your application, we can split this task into two parts. Part one is the part of the add-on that is written on top of the standard application, that is, new tables, pages, and codeunits that are loosely coupled with the standard application. This part is often easily upgraded. The other part is the changes done in the base application. These changes are often more difficult to move to a newer version.</p><div class="section" title="Has Microsoft changed my (referenced) object"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec217"/>Has Microsoft changed my (referenced) object</h3></div></div></div><p>Whether or not <a class="indexterm" id="id1369"/>Microsoft has changed your referenced objects is the question it comes down to when analyzing the upgrade task. If the object you modified has not been changed by Microsoft, the upgrade is easy. If Microsoft has changed the object slightly, we might need to analyze the changes to see whether we need to change something as well.</p><p>With each release, Microsoft tends to redesign a part of the application. If your solution is integrated with the part Microsoft has redesigned, it will be a bigger task to bring the add-on forward.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip54"/>Tip</h3><p>To see the design changes made by Microsoft in a new release, analyze the upgrade toolkit objects to see what it hits.</p></div></div><p>Here are a few examples of some common redesigns.</p><div class="section" title="CRM (Version 2.0)"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec47"/>CRM (Version 2.0)</h4></div></div></div><p>In Version 2.0, Navision introduced the current <a class="indexterm" id="id1370"/>CRM application we discussed in <a class="link" href="ch04.html" title="Chapter 4. Relationship Management">Chapter 4</a>, <span class="emphasis"><em>Relationship Management</em></span>. The most important change was to merge company contacts and persons into one table while implementing new functionality.</p></div><div class="section" title="Dimensions (Version 3.x)"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec48"/>Dimensions (Version 3.x)</h4></div></div></div><p>In Version 3.0, Navision<a class="indexterm" id="id1371"/> introduced the dimension solution that we know today. Before this, the current Global Dimensions 1 and 2 were called <span class="strong"><strong>Department Code</strong></span> and <span class="strong"><strong>Project Code</strong></span>.</p></div><div class="section" title="Bin code (Version 3.x)"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec49"/>Bin code (Version 3.x)</h4></div></div></div><p>With the introduction of WMS, the <a class="indexterm" id="id1372"/>usage of the Bin Code field changed. The Bin Code used to be a field in the Item Ledger Entry table (32) and moved to the Warehouse Entries.</p></div><div class="section" title="Inventory valuation (Version 3.x)"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec50"/>Inventory valuation (Version 3.x)</h4></div></div></div><p>No single <a class="indexterm" id="id1373"/>piece of code in Microsoft Dynamics NAV has changed as many times as the inventory valuation solution. Try to avoid changing this in your add-on application.</p></div><div class="section" title="Item tracking (Version 3.6 and 4.0)"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec51"/>Item tracking (Version 3.6 and 4.0)</h4></div></div></div><p>As with <a class="indexterm" id="id1374"/>inventory valuation, item tracking has been changed many times. Where older versions had Item Tracking Entries and Item Ledger Entries, they are merged into one table in newer versions as discussed in <a class="link" href="ch06.html" title="Chapter 6. Trade">Chapter 6</a>, <span class="emphasis"><em>Trade</em></span>.</p></div><div class="section" title="MenuSuite (Version 4.0)"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec52"/>MenuSuite (Version 4.0)</h4></div></div></div><p>Although<a class="indexterm" id="id1375"/> it is not a functional change, the introduction of MenuSuite in Version 4.0 caused a lot of work to upgrade to.</p><p>MenuSuite do not support C/AL code. This means that all Journals need to be changed for this version.</p></div><div class="section" title="Jobs (Version 5.0)"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec53"/>Jobs (Version 5.0)</h4></div></div></div><p>As discussed in <a class="link" href="ch07.html" title="Chapter 7. Storage and Logistics">Chapter 7</a>, <span class="emphasis"><em>Storage and Logistics</em></span>, the Jobs functionality has been changed in Version 5.0. The <a class="indexterm" id="id1376"/>budgeting in the previous version was done differently using Budget Entries and Phase, Task, and Step tables.</p><p>The Job Journal Line<a class="indexterm" id="id1377"/> and Job Ledger entries have not changed, but the new Job Task table has become a mandatory field when posting on a job.</p><p>When there is no other way, it is possible to take out the Job Objects and renumber them to be customized tables. This allows you to upgrade to a newer version with minimum impact. After the upgrade, a new project can be started to move to the new Job functionality completely.</p></div><div class="section" title="Dimensions (Version 2013)"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec54"/>Dimensions (Version 2013)</h4></div></div></div><p>Version 2013 <a class="indexterm" id="id1378"/>introduced a new design pattern for storing dimensions. Although the design is a much better one, it requires a lot of redesign to implement this new pattern.</p></div><div class="section" title="Item costing (almost all versions)"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec55"/>Item costing (almost all versions)</h4></div></div></div><p>The item costing<a class="indexterm" id="id1379"/> has been improved in almost every new version of Microsoft Dynamics NAV. Changes in item costing is difficult to upgrade to newer versions and almost always need to be redesigned.</p></div></div><div class="section" title="Documentation"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec218"/>Documentation</h3></div></div></div><p>While many parts <a class="indexterm" id="id1380"/>of the application will have no issue in the upgrade, it is useful to have external documentation when there is a need to redesign.</p><p>This documentation should contain information about the business reason for implementing the feature. With that information, it is possible to do a new fit/gap analysis.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip55"/>Tip</h3><p>External documentation such as Microsoft Word and Visio files can be linked to C/Side objects. This way it is easy to find the documentation when a developer needs it.</p></div></div></div><div class="section" title="Split operational and financial information"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec219"/>Split operational and financial information</h3></div></div></div><p>In the <a class="indexterm" id="id1381"/>Storage and Logistics application, we <a class="indexterm" id="id1382"/>chose a data and transaction model that can be easily upgraded to a newer version of Microsoft Dynamics NAV.</p><p>This is achieved by creating separate modules that move data to each other.</p></div></div><div class="section" title="Design to perform"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec200"/>Design to perform</h2></div></div></div><p>All good <a class="indexterm" id="id1383"/>applications are useless if the <a class="indexterm" id="id1384"/>performance is not adequate. Performance is very important to keep in mind when designing your application.</p><p>When talking about performance, there are two typical issues. The first issue is an application with an overall slow performance, and the latter is an application with good performance but where users block each other or create deadlocks.</p><p>Both issues have their own approach to be analyzed and solved. We will not talk in detail about this process but rather explain how to avoid these situations in general.</p><div class="section" title="OLTP versus OLAP"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec220"/>OLTP versus OLAP</h3></div></div></div><p>In any<a class="indexterm" id="id1385"/> ERP system, it is important to balance <a class="indexterm" id="id1386"/>
<span class="strong"><strong>Online Transaction Processing</strong></span> (<span class="strong"><strong>OLTP</strong></span>) with <a class="indexterm" id="id1387"/>
<span class="strong"><strong>Online Analytical Processing</strong></span> (<span class="strong"><strong>OLAP</strong></span>). This is especially important when working with Microsoft Dynamics NAV. The reason for this is its unique data and posting model, which creates the analytical data while processing the transaction.</p><p>Creating this analytical information in real time can have advantages, but when posting the transactions take too much time, it might not be worth it.</p><p>Examples of analytical information are dimension information and analysis view entries, but also VAT Entries and Value Entries. Although they give us important information about the business, we do not always need them instantly when processing the transaction.</p><p>Other examples of analytical information are secondary keys and <code class="literal">SumIndexFields</code>. All this information will be created when creating the master record. If a Ledger Entry table has 32 secondary keys and 15 <code class="literal">SumIndexFields</code>, it will take a considerable amount of time to write this information to the database.</p></div><div class="section" title="Fast transaction posting"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec221"/>Fast transaction posting</h3></div></div></div><p>Good performance <a class="indexterm" id="id1388"/>starts with fast transactions. There <a class="indexterm" id="id1389"/>are several ways to achieve this. The major ones being: cleanup unused indexes and application setup.</p><div class="section" title="Cleanup unused indexes"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec56"/>Cleanup unused indexes</h4></div></div></div><p>Each secondary <code class="literal">SumIndexFields</code> field in <a class="indexterm" id="id1390"/>the database needs to be maintained whether it is used or not. Microsoft Dynamics NAV allows end users to create their own schedule to maintain this.</p><p>Creating such an index schedule is quite a complex task and so should be done by experienced <a class="indexterm" id="id1391"/>functional developers.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note73"/>Note</h3><p>In versions prior to Microsoft Dynamics 5 SP 1, the overhead of unused <code class="literal">SumIndexFields</code> was substantially higher compared to newer versions.</p></div></div></div><div class="section" title="Application setup"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec57"/>Application setup</h4></div></div></div><p>It all starts <a class="indexterm" id="id1392"/>with a solid application setup. Some setup features in Microsoft Dynamics NAV will cause the system to create more analytical information when posting transactions.</p><p>An example is <span class="strong"><strong>Update On Posting</strong></span> for <span class="strong"><strong>Analysis</strong></span> Views. This feature will update the Analysis View Entries at the same time as the General Ledger Entries are created.</p><div class="mediaobject"><img alt="Application setup" src="graphics/0365EN_10_09.jpg"/></div><p>Other examples are the <span class="strong"><strong>Automatic Cost</strong></span> options in the inventory setup. When they are activated, the cost is adjusted each time an Item Ledger Entry is created.</p><div class="mediaobject"><img alt="Application setup" src="graphics/0365EN_10_10.jpg"/></div></div></div><div class="section" title="Job Queue"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec222"/>Job Queue</h3></div></div></div><p>Microsoft <a class="indexterm" id="id1393"/>Dynamics NAV is shipped with an excellent multithreaded Job Queue system. This process is called an Application Server and can execute C/AL code in report and codeunit objects.</p><p>Examples of <a class="indexterm" id="id1394"/>Job Queue tasks are creating the Analysis View Entries, Posting the Adjust Cost for Inventory Valuation or even Posting Sales, and Purchase documents.</p><div class="section" title="Background posting"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec58"/>Background posting</h4></div></div></div><p>Background posting<a class="indexterm" id="id1395"/> was introduced in Microsoft Dynamics NAV 2013 and allows you to post documents using a Job Queue. This means that the user who starts the posting routine does not need to wait until this process has been completed before starting a new task.</p></div></div><div class="section" title="Date compressing and cleanup"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec223"/>Date compressing and cleanup</h3></div></div></div><p>When the number<a class="indexterm" id="id1396"/> of records in a table exceeds normal proportions, it might be useful to start thinking about doing data maintenance. This is a<a class="indexterm" id="id1397"/> normal procedure in all ERP systems, and Microsoft Dynamics NAV has the capability to do that.</p><div class="section" title="Date compression"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec59"/>Date compression</h4></div></div></div><p>Most<a class="indexterm" id="id1398"/> Entry tables in Microsoft Dynamics NAV can be compressed by date. This means that all entries with the same values will be replaced by one new entry. The detailed information is lost afterwards.</p><div class="mediaobject"><img alt="Date compression" src="graphics/0365EN_10_11.jpg"/><div class="caption"><p>Data compression</p></div></div><p>Saving the detailed <a class="indexterm" id="id1399"/>information can be easily implemented by changing the compression report. The detailed information can be saved in a copy of the original table.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip56"/>Tip</h3><p>The total size of the database has minimal impact on the performance. More important is the size of the tables we are writing to during a transaction.</p></div></div></div><div class="section" title="Data cleanup"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec60"/>Data cleanup</h4></div></div></div><p>Microsoft Dynamics NAV <a class="indexterm" id="id1400"/>allows most data to be deleted when the fiscal year it was created is closed.</p><p>Examples <a class="indexterm" id="id1401"/>of data that can be deleted are Sales Shipments and Purchase Receipts. They can be either deleted or moved to copy tables.</p><p>Cleaning up data will prevent the transactions to be slower when your company uses Microsoft Dynamics<a class="indexterm" id="id1402"/> NAV for a longer time. Data cleanup generally starts after using the product for 5 years and when the database exceeds 100 gigabytes in size.</p></div></div><div class="section" title="Locks, blocks, and deadlocks"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec224"/>Locks, blocks, and deadlocks</h3></div></div></div><p>The<a class="indexterm" id="id1403"/> Microsoft Dynamics NAV product is very sensitive for blocking <a class="indexterm" id="id1404"/>and deadlocks. This has everything to do with the posting model, the inheritance of the Native database, and the numbering used in entry tables.</p><p>Blocks and Deadlocks<a class="indexterm" id="id1405"/> are caused primarily by Locks in the database. Locking is a mechanism databases use to ensure consistency of the data.</p><div class="section" title="Native server versus SQL Server"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec61"/>Native server versus SQL Server</h4></div></div></div><p>Originally, Microsoft Dynamics NAV had a proprietary (Native) database. This database did not support row-level locking, only table locking.</p><p>Microsoft Dynamics NAV 2013 no longer supports this database and only runs on SQL Server, which does support row-level locks. However, the current data and transaction model is designed for table locking.</p><p>The benefit<a class="indexterm" id="id1406"/> of row-level locking on SQL Server is best experienced in systems with many users creating documents in the same database. Most posting transactions in the database are isolated, meaning only one user at a time can post a document from anywhere in the application.</p><p>Locking is always done for a single company; unless tables are shared as explained in <a class="link" href="ch04.html" title="Chapter 4. Relationship Management">Chapter 4</a>, <span class="emphasis"><em>Relationship Management</em></span>, a user from company A cannot lock a user in company B.</p></div><div class="section" title="Locking principles"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec62"/>Locking principles</h4></div></div></div><p>In<a class="indexterm" id="id1407"/> Microsoft Dynamics NAV, locking starts with the <code class="literal">LOCKTABLE</code> command. Using this command will generate the T-SQL statements that are generated by the application to issue a <code class="literal">UPDLOCK</code> hint where without the statement, <code class="literal">READUNCOMMITED</code> is issued.</p><p>Let's create an example that shows how locking is done.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">For this example, we create a new codeunit Locking A (60000). The codeunit has a global variable Cust of type Record 18:<div class="informalexample"><pre class="programlisting">OnRun()
Cust.LOCKTABLE;
Cust.GET('10000');
IF CONFIRM('Maintain Lock in database') THEN;</pre></div></li><li class="listitem">We start this codeunit and leave the confirmation window open.<div class="mediaobject"><img alt="Locking principles" src="graphics/0365EN_10_12.jpg"/></div></li><li class="listitem">Now, we <a class="indexterm" id="id1408"/>go to the Windows client, open the <span class="strong"><strong>Customer Card</strong></span> for customer <span class="strong"><strong>10000</strong></span> and try to change the name. After 10 seconds, we will get the following message:<div class="mediaobject"><img alt="Locking principles" src="graphics/0365EN_10_13.jpg"/></div></li></ol></div><p>The reason for this error message to pop up is that the other user issued an exclusive lock on the record. If we move to customer <span class="strong"><strong>20000</strong></span>, which is the next record in the database, we can safely change the name. This record is not locked.</p></div><div class="section" title="Deadlocks"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec63"/>Deadlocks</h4></div></div></div><p>Let's take <a class="indexterm" id="id1409"/>this example one step further and simulate a deadlock. Deadlocks happen if users try to lock each other's record in a different order.</p><div class="mediaobject"><img alt="Deadlocks" src="graphics/0365EN_10_14.jpg"/></div><p>Let's see this<a class="indexterm" id="id1410"/> in more detail:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">User A reads and locks Customer 10000</li><li class="listitem" style="list-style-type: disc">User B reads and locks Customer 20000</li><li class="listitem" style="list-style-type: disc">User A tries to read and lock Customer 20000, a blocking event starts</li><li class="listitem" style="list-style-type: disc">When user B now tries to lock Customer 10000, a deadlock occurs</li></ul></div><p>To demonstrate a deadlock, we have created two Codeunits Deadlock A (60001) and Deadlock B (60002). We need two sessions on the same SQL Server database to do this. Start Deadlock A on one client:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>OnRun()</strong></span>
Cust.LOCKTABLE;
Cust.GET('10000');
IF CONFIRM('Start another client and run codeunit 60002') THEN
  LockOtherCust;

LockOtherCust()
Cust2.GET('20000');
IF CONFIRM('Maintain Lock') THEN;</pre></div><p>Start Deadlock B on the other:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>OnRun()</strong></span>
Cust.LOCKTABLE;
Cust.GET('20000');
IF CONFIRM('Select Yes on the other client') THEN
  LockOtherCust;

LockOtherCust()
Cust2.GET('10000');
IF CONFIRM('Did the deadlock happen?') THEN;</pre></div><p>Then, select <span class="strong"><strong>Yes</strong></span> on<a class="indexterm" id="id1411"/> both the confirmation boxes. One of the clients should now deadlock.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip57"/>Tip</h3><p>SQL Server checks for deadlocks every 5 seconds and kills the transaction that has the lowest roll back impact on the database. This is why users will experience deadlocks as slow sometimes and fast other times.</p></div></div><div class="mediaobject"><img alt="Deadlocks" src="graphics/0365EN_10_15.jpg"/></div><p>The error message is confusing since it lets us to believe we have locked the entire table, which is not true.</p><p>The <code class="literal">LockOtherCust</code> function<a class="indexterm" id="id1412"/> reads a record from the customer table with another variable. This new variable <code class="literal">Cust2</code> does not explicitly issues a <code class="literal">LOCKTABLE</code> command. This proves that <code class="literal">LOCKTABLE</code> is a transaction command that is valid for all variables of this type.</p></div><div class="section" title="Blocking and deadlocks in Microsoft Dynamics NAV"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec64"/>Blocking and deadlocks in Microsoft Dynamics NAV</h4></div></div></div><p>The <a class="indexterm" id="id1413"/>standard application has several built-in blocking events by design. This is to ensure the database integrity and to avoid deadlocks.</p><p>The two main isolating tables in Microsoft Dynamics NAV are the G/L Entry table (17) and the Item Ledger Entry table (32).</p><p>Codeunit 12 shows these lines of code before creating G/L Entries:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>StartPosting(GenJnlLine : Record "Gen. Journal Line")</strong></span>
WITH GenJnlLine DO BEGIN
  GlobalGLEntry.LOCKTABLE;
  IF GlobalGLEntry.FINDLAST THEN BEGIN</pre></div><p>Both Codeunit Sales-Post 80 and Purch.-Post 90 that we discussed earlier have optional isolation on the G/L Entry table.</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>LOCAL LockTables()</strong></span>
SalesLine.LOCKTABLE;
ItemChargeAssgntSales.LOCKTABLE;
PurchOrderLine.LOCKTABLE;
PurchOrderHeader.LOCKTABLE;
GetGLSetup;
IF NOT GLSetup.OptimGLEntLockForMultiuserEnv THEN BEGIN
  GLEntry.LOCKTABLE;
  IF GLEntry.FINDLAST THEN;
END;.</pre></div><p>In real life, this<a class="indexterm" id="id1414"/> means that no one in a company can post to the general ledger at the same time. The same applies to the item ledger.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note74"/>Note</h3><p>This blog entry at <a class="ulink" href="https://blogs.msdn.com/b/nav/archive/2012/10/17/g-l-entry-table-locking-redesign-in-microsoft-dynamics-nav-2013.aspx">https://blogs.msdn.com/b/nav/archive/2012/10/17/g-l-entry-table-locking-redesign-in-microsoft-dynamics-nav-2013.aspx</a> explains the usage of the optional G/L locking while posting documents.</p></div></div><p>This emphasizes the importance of fast transactions and generating analysis data in separate batches.</p></div></div><div class="section" title="Impact on development"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec225"/>Impact on development</h3></div></div></div><p>If we <a class="indexterm" id="id1415"/>summarize the impact of all this knowledge on your development, it emphasizes the importance of designing your own application structures that interface with the standard application.</p><p>When changing and implementing the standard application, try to reduce the overhead during posting as much as possible.</p><p>Create compression routines and allow end users to periodically clean up records. In the next section, we will talk about how to design to analyze and allow end users to generate analysis data in batches separate from the posting transactions.</p></div></div><div class="section" title="Design to analyze"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec201"/>Design to analyze</h2></div></div></div><p>Analysis in <a class="indexterm" id="id1416"/>Microsoft Dynamics NAV should <a class="indexterm" id="id1417"/>always be done on (ledger) entry records. There are many types of entry records that are either created during a transaction or in batches.</p><p>Avoid building <a class="indexterm" id="id1418"/>analysis on document tables. It <a class="indexterm" id="id1419"/>should always be possible to delete old data in the database without losing the essential information for data analysis.</p><div class="section" title="Report design"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec226"/>Report design</h3></div></div></div><p>Designing<a class="indexterm" id="id1420"/> a report in Microsoft Dynamics NAV starts with generating a Data Set. This is built using table relations and can get quite complex.</p><div class="mediaobject"><img alt="Report design" src="graphics/0365EN_10_16.jpg"/></div><p>When the Data Set is defined, the second step is to define the layout. Creating report layouts is beyond the scope of this book.</p><p>Reports with a large Data Set are complex to maintain and have a risk of being slow in performance since the database engine needs to read all the information before combining the information into a view.</p><p>This can be solved by preparing the data first and running the report afterwards. This approach is quite common in data warehousing. The preparation of the data can be done in scheduled batches running in the Job Queue.</p></div></div></div></div>
<div class="section" title="Version and object management"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec68"/>Version and object management</h1></div></div></div><p>When doing <a class="indexterm" id="id1421"/>software development, discussing <a class="indexterm" id="id1422"/>version management is <a class="indexterm" id="id1423"/>unavoidable. Microsoft Dynamics NAV is flexible in this and allows developers to make their own<a class="indexterm" id="id1424"/> decisions on this subject rather than forcing them to one way of versioning.</p><div class="section" title="What is a version"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec202"/>What is a version</h2></div></div></div><p>In <a class="indexterm" id="id1425"/>Microsoft Dynamics NAV, there <a class="indexterm" id="id1426"/>are two ways of determining what a version is. The first and easiest approach is to change the version of an object each time it changes. The initial released Version is 1.00 and each change increments to 1.01, 1.02, and so on. A big change will lead to Version 2.00.</p><p>Another more common approach in Microsoft Dynamics NAV is to group version numbers in releases of a group of objects together. When this is applied, the application gets a version number that is incremented each time we release. This means that an object with version number 1.01 can jump to 1.04 if it was not changed in releases 1.02 and 1.03.</p></div><div class="section" title="Version numbering"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec203"/>Version numbering</h2></div></div></div><p>There are rules in <a class="indexterm" id="id1427"/>Microsoft Dynamics NAV for version numbering,<a class="indexterm" id="id1428"/> although the rules have changed over the years.</p><p>The current version principle allows us to use letters and digits. The letters indicate the product and country code, the digits the version, subversion, and service pack number.</p><p>Let's look at an example object to clarify this. Codeunit Whse.-Printed (5779):</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>NAV</p>
</th><th style="text-align: left" valign="bottom">
<p>W1</p>
</th><th style="text-align: left" valign="bottom">
<p>3.</p>
</th><th style="text-align: left" valign="bottom">
<p>70.</p>
</th><th style="text-align: left" valign="bottom">
<p>01</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top">
<p>The last service pack this object was changed</p>
</td></tr><tr><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> </td><td colspan="2" style="text-align: center" valign="top">
<p>The last subversion this object was changed</p>
</td></tr><tr><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> </td><td colspan="3" style="text-align: center" valign="top">
<p>The last version this object was changed</p>
</td></tr><tr><td style="text-align: left" valign="top"> </td><td colspan="4" style="text-align: center" valign="top">
<p>The Localization Version</p>
</td></tr><tr><td colspan="5" style="text-align: center" valign="top">
<p>The Product Name</p>
</td></tr></tbody></table></div><p>If Microsoft change this object in Service pack 1 for 2013, the new version number would be NAVW17.00.01.</p><div class="section" title="Combining versions"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec227"/>Combining versions</h3></div></div></div><p>An object <a class="indexterm" id="id1429"/>can have multiple versions, but only one version for each product or country. A localized object gets version NAVW13.70.01, NAVNL6.00.01. This means that although the global product team has not changed the object, it has been changed by the Dutch localization team.</p></div></div><div class="section" title="Creating a version"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec204"/>Creating a version</h2></div></div></div><p>Versioning <a class="indexterm" id="id1430"/>in Microsoft Dynamics NAV is done manually. The <a class="indexterm" id="id1431"/>version number is an editable field in the Object table (2000000001) that can be freely changed. Developing a tool to do this is easy and has been done by many partners in the channel.</p><p>The Data and Transaction model of such a solution should look something like this:</p><div class="mediaobject"><img alt="Creating a version" src="graphics/0365EN_10_17.jpg"/></div><p>The process starts with a change request. This can be fixing a small bug or creating a new functionality. For this change request, objects need to be modified.</p><p>Each modified object is attached to the change request. We can release several change requests at the same time. All objects in the release will get the version number from the release, which can be automatically updated in the object table.</p><p>By saving the change request and release information in the database, we will also generate documentation that will help future developers to find information on why objects were changed.</p><div class="section" title="Tracking object changes"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec228"/>Tracking object changes</h3></div></div></div><p>Object changes <a class="indexterm" id="id1432"/>can be tracked using triggers in SQL Server. All the C/Side objects are stored in the Object table (2000000001).</p><p>To connect an object change to a change request, the developer should tell the system the request they are currently working on. This will enable us to have a failsafe tracking mechanism to perform version management.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note75"/>Note</h3><p>To view the complete solution for tracking object changes visit <a class="ulink" href="http://dynamicsuser.net/blogs/stryk/archive/2009/05/18/object-auditing.aspx">http://dynamicsuser.net/blogs/stryk/archive/2009/05/18/object-auditing.aspx</a>.</p></div></div></div><div class="section" title="Saving older versions"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec229"/>Saving older versions</h3></div></div></div><p>In order to<a class="indexterm" id="id1433"/> look at the changes, saving a copy of a version can be very useful. Besides the obvious possibility of saving the files on a disk, we can also use an external tool. One of these tools is Microsoft Team Foundation Server. This is a part of the Visual Studio family and from Version 2013, it is available in the cloud, making it very easy to set up and use in combination with Microsoft Dynamics NAV.</p><div class="mediaobject"><img alt="Saving older versions" src="graphics/0365EN_10_02.jpg"/></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note76"/>Note</h3><p>The video blog at <a class="ulink" href="https://www.youtube.com/user/SorenKlemmensen/video">https://www.youtube.com/user/SorenKlemmensen/video</a> demonstrates how to start using Visual Studio online combined with Microsoft Dynamics NAV.</p></div></div></div></div></div>
<div class="section" title="Development methodology"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec69"/>Development methodology</h1></div></div></div><p>To develop software, there are <a class="indexterm" id="id1434"/>many methodologies such as Prince2, Extreme Programming, or the Microsoft Solutions Framework.</p><p>Most of these <a class="indexterm" id="id1435"/>methodologies are suitable to be applied to Microsoft Dynamics NAV but they should be used properly. Because of the flexibility of the product, it is easy to leave out steps in the process that should be there.</p><p>In Microsoft Dynamics NAV, it is easy to quickly create and modify business software. This is by far the strongest selling point for the solution, but also the biggest pitfall.</p><div class="section" title="A sample approach"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec205"/>A sample approach</h2></div></div></div><p>When<a class="indexterm" id="id1436"/> an end user requests a change to the application, it is<a class="indexterm" id="id1437"/> tempting for most experienced developers to go into the application and create it, preferably in the production database without documentation. This is not the desired way of doing software development.</p><p>However, Microsoft Dynamics NAV is a very suitable design environment for prototyping and Rapid Application Design. All the example applications in this book are first built with prototyping and later finalized using testing.</p><p>If we design a suitable development methodology for Microsoft Dynamics NAV, we can see that the application life cycle perfectly fits our methodology.</p><p>When implementing Microsoft Dynamics NAV, it is very important to involve the end users in each step of the development process.</p><div class="mediaobject"><img alt="A sample approach" src="graphics/0365EN_10_18.jpg"/></div><div class="section" title="Fit/gap analysis"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec230"/>Fit/gap analysis</h3></div></div></div><p>At the fit/gap phase, usually <a class="indexterm" id="id1438"/>a quick specification is enough to describe what the user would like the system to do and a possible solution is generated in the application. This document should not count more than two or three pages. During the prototyping phase, it is very normal to come across advanced understanding. It would be a waste of valuable time to find this during the initial analysis with the risk of not finding them anyway.</p></div><div class="section" title="Prototyping"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec231"/>Prototyping</h3></div></div></div><p>With the<a class="indexterm" id="id1439"/> <span class="strong"><strong>Quick Spec</strong></span>, a <a class="indexterm" id="id1440"/>developer creates the solution as a draft without going into too much detail. This should be enough to show the end user what the solution will look like when it is finished. Very often, this will lead to new questions and ideas that should be carefully considered and put into the full<a class="indexterm" id="id1441"/> specification, or a new prototype should be built first.</p></div><div class="section" title="Development"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec232"/>Development</h3></div></div></div><p>Depending <a class="indexterm" id="id1442"/>on the amount of changes after the prototype, development can often start with the work done already. At this stage, all the details should be worked out and tested.</p><p>There is no complete checklist for developers to use when developing in Microsoft Dynamics NAV, but let's try to create one with the following fields:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Captions/Translations</strong></span>: Make sure all objects have the required captions and translations populated.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Table Relations</strong></span>: Make sure all Table Relations are in place, and check the Ledger Entry and Line tables as well since they are frequently forgotten.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Modify And Delete Triggers</strong></span>: What happens if a user modifies or deletes the record. Make sure that everything is nicely handled in the <code class="literal">OnModify</code> and On Delete C/AL triggers. <code class="literal">OnRename</code> should be automatically handled by C/Side. Renaming a table with many table relations may cause severe locking in the database. If users should not rename a record, this can be blocked by placing an <code class="literal">ERROR</code> command in the <code class="literal">OnRename</code> trigger.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>LookupPageID</strong></span> and <span class="strong"><strong>DrillDownPageID</strong></span>: Even when running the Windows client, it is important to assign a Lookup and Drilldown page ID. Lookup pages are used for table relations and Drilldown pages are used when drilling down from a SUM flow field.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>CardPageID</strong></span>: The Windows client always starts a list page when a user selects a menu item or a cue. Double-clicking a row will open the associated card page. This is controlled by the <span class="strong"><strong>CardPageID</strong></span> property on a list page.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Field Groups</strong></span>: To show records from a table relation when entering values, the Windows client does not directly use <span class="strong"><strong>LookupPageID</strong></span> but first shows a <span class="strong"><strong>DropDown</strong></span> list. The fields in this list are defined in the associated tables <span class="strong"><strong>Field Groups</strong></span>. Each table can only have one <span class="strong"><strong>Field Group</strong></span> called <span class="strong"><strong>DropDown</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img alt="Development" src="graphics/0365EN_10_19.jpg"/></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Actions</strong></span>: Actions should make sense to end users. Make sure you use logical names and avoid creating menu buttons and actions that are solely for super users and just confuse end users. Actions should be placed in the correct container. Only promote actions that will be frequently used by all end users.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Shortcuts</strong></span>: Always assign ampersand (&amp;) shortcuts and avoid double shortcuts. When using function keys such as <span class="emphasis"><em>F3</em></span> and <span class="emphasis"><em>F9</em></span>, follow the Microsoft standard conventions.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Compression</strong></span> and <span class="strong"><strong>Posting</strong></span>: If your solution will generate a potentially large amount of data, be sure to provide compression, posting, or cleaning up routines so end users can periodically maintain the data.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Permissions</strong></span>: Does your solution require additional permissions to be set up in the system? Make sure to document this when delivering the solution.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Unused Variables</strong></span>: Make sure you don't leave unused variables in the C/AL objects. Although they won't break the functionality, it will make future maintenance of the software more complex.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>FIND Commands</strong></span> and <span class="strong"><strong>Locking</strong></span>: Double check the usage of the correct find commands before you ship the software. Using the wrong commands and leaving locking to the database engine may cause extra performance overhead.</li></ul></div><p>More detailed<a class="indexterm" id="id1443"/> information about these features is explained in the book <span class="emphasis"><em>Programming Microsoft Dynamics NAV 2013</em></span>, <span class="emphasis"><em>David A. Studebaker</em></span>, <span class="emphasis"><em>Christopher D. Studebaker</em></span>, <span class="emphasis"><em>Packt Publishing</em></span>.</p><div class="section" title="Testing"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec65"/>Testing</h4></div></div></div><p>Testing is<a class="indexterm" id="id1444"/> probably one of the most important but undervalued tasks of application design.</p><p>Testing involves the following three conditions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Does the software meet the original requirements? If this is not the case, it does not make sense to continue testing.</li><li class="listitem" style="list-style-type: disc">Does it work as expected? This includes trying to deliberately break the solution. If the software is not monkey proof, things will certainly go wrong when using it. Here Murphy's Law is applicable, "What can go wrong, will go wrong."</li><li class="listitem" style="list-style-type: disc">Does it fit the rest of the application? Is the software usable and intuitive? A solution that is bug free but difficult to use will be expensive to maintain.</li></ul></div><p>Testing should be automated using the Testability Framework. This allows developers to rerun complete application tests each time they make a change.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note77"/>Note</h3><p>The blog at <a class="ulink" href="http://blogs.msdn.com/b/nav/archive/2012/11/07/application-test-toolset-for-microsoft-dynamics-nav-2013.aspx">http://blogs.msdn.com/b/nav/archive/2012/11/07/application-test-toolset-for-microsoft-dynamics-nav-2013.aspx</a> explains how to install and use the Testability Framework for Microsoft Dynamics NAV 2013.</p></div></div><p>The testing <a class="indexterm" id="id1445"/>should be also done manually, performed by someone who likes doing it and has the available time. If someone is asked to test the software who is buried in normal work, the chance of bugs slipping in is quite high.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note78"/>Note</h3><p>Testing using the Testability Framework is a mandatory part of the Certified for Microsoft Dynamics process.</p></div></div><p>The cost of fixing a bug increases as the software evolves. The sooner a bug is fixed, the better.</p><div class="mediaobject"><img alt="Testing" src="graphics/0365EN_10_20.jpg"/></div></div></div><div class="section" title="Implementation"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec233"/>Implementation</h3></div></div></div><p>When the<a class="indexterm" id="id1446"/> changes are developed and tested, the documentation should be finalized. This can be either a manual for end users or a technical reference for future developers and support engineers.</p><p>The end users <a class="indexterm" id="id1447"/>should be trained to use the software.</p></div><div class="section" title="Maintenance and support"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec234"/>Maintenance and support</h3></div></div></div><p>After the <a class="indexterm" id="id1448"/>software is implemented and users are trained, the solution goes into the maintenance and support stage. During this stage, the application manager needs to take care of the data generated by the solution, analyze it, and clean up the data periodically.</p><p>If the end users request a change on the solution, the cycle starts again.</p></div></div></div>
<div class="section" title="The project"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec70"/>The project</h1></div></div></div><p>Implementing<a class="indexterm" id="id1449"/> an ERP product like Microsoft Dynamics NAV is not just installing a software package and starting to use it. Each part of your company will have to make decisions how to integrate their work with the software. This very often leads to an interesting new look with respect to your company's way of work.</p><div class="section" title="Standard, customized, or both"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec206"/>Standard, customized, or both</h2></div></div></div><p>There are<a class="indexterm" id="id1450"/> several ways of implementing Dynamics NAV. It is highly important to make a decision <a class="indexterm" id="id1451"/>what kind of implementation you want and adjust the implementation accordingly.</p><div class="mediaobject"><img alt="Standard, customized, or both" src="graphics/0365EN_10_21.jpg"/></div><p>Compared to when it was introduced in 1995, Microsoft Dynamics NAV 2013 is a mature ERP package with all the built-in functionalities we discussed in this book. On top of this standard product, resellers have built horizontal and vertical solutions called add-on products. These two combined offer powerful solutions for companies that cannot work with the standard product but are flexible enough to use a vertical solution.</p><div class="section" title="Add-on products"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec235"/>Add-on products</h3></div></div></div><p>Vertical solutions<a class="indexterm" id="id1452"/> have started years ago as a customized solution for a company who decided to implement Microsoft Dynamics NAV. Together with the implementation partner, these companies have customized the product to meet their requirements.</p><p>Many of these add-on products are now grown up software solutions that fit a vertical industry.</p><p>When buying an add-on solution, it is good to ask the reseller some questions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">What is the release procedure? A solid add-on solution has a release procedure. Most resellers have periodical release every half year or maybe sooner. If a bug is found in the software, there should be a hot fix. Most resellers have releases they support. Make sure to know what versions are still supported.</li><li class="listitem" style="list-style-type: disc">How do I upgrade to a new version of the vertical solution? If a new version of the vertical solutions is released, there should be an upgrade procedure. This should be clearly documented and tested by the reseller.</li><li class="listitem" style="list-style-type: disc">Am I allowed to make changes to the software? Most add-on resellers do not recommend their customers to change the software. The reason for this is the increased complexity of bug fixing and upgrading.</li><li class="listitem" style="list-style-type: disc">What if I do change the software? If an add-on solution is customized anyway, it is basically downgraded from being a supported add-on solution to a customized database. For most resellers, it is difficult to support these customized solutions.</li></ul></div></div><div class="section" title="Customizing"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec236"/>Customizing</h3></div></div></div><p>Although <a class="indexterm" id="id1453"/>customizing an add-on solution is not always recommended, customizing Microsoft Dynamics NAV should not be considered a bad practice.</p><p>The impact of customization in Microsoft Dynamics NAV can make a difference that can be compared to a suit that is confection or tailored to fit. The benefits of having an ERP package that exactly fits the organization can be more important than the increased cost of ownership of the solution.</p></div><div class="section" title="Total cost of ownership"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec237"/>Total cost of ownership</h3></div></div></div><p>The<a class="indexterm" id="id1454"/> total cost of ownership of Microsoft Dynamics NAV depends highly on the level of customizations. A non-customized implementation with one or two good add-on products done by experienced consultants will have a low impact on your company and will be easy to maintain and support.</p><p>The higher the level of customizations, the more it will cost to keep the application running. This is not a bad thing per se. If your company has a unique way of doing business, it might need an ERP package that supports this uniqueness.</p></div><div class="section" title="The Road to Repeatability program"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec238"/>The Road to Repeatability program</h3></div></div></div><p>The <span class="strong"><strong>Road to Repeatability</strong></span> (<span class="strong"><strong>R2R</strong></span>) was<a class="indexterm" id="id1455"/> introduced by Microsoft to help partners to be more repeatable. Although the program is primarily marketing-focused, it illustrates the trend of reselling the same Microsoft Dynamics NAV package to multiple customers.</p></div></div><div class="section" title="Roadmap to success"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec207"/>Roadmap to success</h2></div></div></div><p>Designing<a class="indexterm" id="id1456"/> a solid application in Microsoft Dynamics NAV starts with a thorough knowledge of the standard application functionality and its design philosophy.</p><p>Secondly, we need to carefully analyze the business process we want to support and implement new functionality step by step to ensure good quality, as the solution grows bigger and mature.</p><p>Use data and posting models that are similar to Microsoft Dynamics NAV and try to maintain a similar user interface. This will make it easier for end users to adopt your solution and more likely for the software to be easy to maintain and support.</p><p>Last but not least, carry out good housekeeping in your database. Compress and clean up data periodically to guarantee a stable performance of the system now and in the future.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec71"/>Summary</h1></div></div></div><p>In this book, we have covered functional and technical design of both standard Microsoft Dynamics and how to extend the application to succeed.</p><p>This book is not finished. After the publication, we will periodically write articles, tips, and tricks based on the information in this book on <a class="ulink" href="http://www.brummelds.com">http://www.brummelds.com</a>.</p><p>Any questions or comments regarding the information published in this book can be posted and discussed there as well.</p></div></body></html>