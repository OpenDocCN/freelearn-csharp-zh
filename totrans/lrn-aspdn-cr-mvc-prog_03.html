<html><head></head><body><p>&#13;
<div>&#13;
<div>&#13;
<div>&#13;
<h1 class="title"><a id="ch03"/>&#13;
 Chapter 3. Controllers</h1>&#13;
</p>&#13;
</div>&#13;
</div>&#13;
<p>As discussed in the first chapter, all web applications receive requests from the server and produce a response, that is delivered back to the end user. A Controller does the job of receiving the request and producing the output based on the input data in ASP.NET MVC.</p>&#13;
<p>In this chapter, you'll be learning about the following topics:</p>&#13;
<p>&#13;
<ul class="itemizedlist">&#13;
<li class="listitem">Role of the Controller in ASP.NET MVC applications</li>&#13;
<li class="listitem">Routing introduction and concepts</li>&#13;
<li class="listitem">Creating your first ASP.NET 5 application</li>&#13;
<li class="listitem">Installation of the ASP.NET Core <code class="literal">NuGet</code>&#13;
 packages in your application</li>&#13;
<li class="listitem">Creation of your first Controller and <code class="literal">action</code>&#13;
 method, which returns a simple &#13;
<em>Hello World</em>&#13;
&#13;
</li>&#13;
<li class="listitem">Adding a View and making the changes that allow your Controller to use that View</li>&#13;
<li class="listitem">Adding a Model and passing that Model data to your View</li>&#13;
</ul>&#13;
</p>&#13;
<p>&#13;
<div>&#13;
<div>&#13;
<div>&#13;
<h1 class="title"><a id="ch03lvl1sec20"/>&#13;
 Role of the Controller in ASP.NET MVC applications</h1>&#13;
</p>&#13;
</div>&#13;
</div>&#13;
<p>At the high level, the Controller orchestrates between the Model and the View, and sends the output back to the user. This is also the place where authentication is usually done through action filters. Action filters will be discussed in detail in the &#13;
<em>Filters</em>&#13;
&#13;
 section of this chapter. The following figure illustrates the high-level flow of a request (with the steps) in ASP.Net MVC and shows us how the Controller fits into the big picture:</p>&#13;
<div><img src="img/Image00021.jpg" alt="Role of the Controller in ASP.NET MVC applications"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>The following is the sequence of events that will happen at high level when the user is accessing the ASP.NET Core application:</p>&#13;
<p>&#13;
<ol class="orderedlist arabic">&#13;
<li class="listitem" value="1">The user types the URL in the browser.</li>&#13;
<li class="listitem" value="2">Based on the pattern of the URL, the routing engine selects the appropriate Controller.</li>&#13;
<li class="listitem" value="3">The Controller talks to the Model to get any relevant data through its action methods. Action methods are methods within a <code class="literal">controller</code>&#13;
 class.</li>&#13;
<li class="listitem" value="4">The Controller then passes the data to the View to present it in a viewable format, typically as HTML elements.</li>&#13;
<li class="listitem" value="5">The View is finally delivered to the user, which he would be viewing in his browser.</li>&#13;
</ol>&#13;
<div>&#13;
</p>&#13;
<p>Before discussing the controller, let us discuss the fundamentals of routing concepts, as the routing engine only chooses the appropriate <code class="literal">controller</code>&#13;
 and <code class="literal">action</code>&#13;
 method at runtime.</p>&#13;
</div>&#13;
</div>&#13;

<p>&#13;
<div>&#13;
<div>&#13;
<div>&#13;
<h1 class="title"><a id="ch03lvl1sec21"/>&#13;
 Introduction to routing</h1>&#13;
</p>&#13;
</div>&#13;
</div>&#13;
<p>The routing engine is responsible for getting the incoming request and routing that request to the appropriate Controller based on the URL pattern. We can configure the routing engine so that it can choose the appropriate controller based on the relevant information.</p>&#13;
<p>By convention, ASP.NET MVC follows this pattern: &#13;
<strong>Controller/Action/Id</strong>&#13;
&#13;
 .</p>&#13;
<p>If the user types the URL <code class="literal">http://yourwebsite.com/Hello/Greeting/1</code>&#13;
 , the routing engine selects the <code class="literal">Hello controller</code>&#13;
 class and <code class="literal">Greeting action</code>&#13;
 method within the <code class="literal">HelloController</code>&#13;
 , and passes the <code class="literal">Id</code>&#13;
 value as <code class="literal">1</code>&#13;
 . You can give default values to some of the parameters and make some of the parameters optional.</p>&#13;
<p>The following is the sample configuration:</p>&#13;
<pre class="programlisting">The template: "{controller=Hello}/{action=Greeting}/{id?}");</pre>&#13;
<p>In the preceding configuration, we are giving three instructions to the routing engine:</p>&#13;
<p>&#13;
<ul class="itemizedlist">&#13;
<li class="listitem">Use the routing pattern <code class="literal">controller/action/id</code>&#13;
 .</li>&#13;
<li class="listitem">Use the default values <code class="literal">Hello</code>&#13;
 and <code class="literal">Greeting</code>&#13;
 for the <code class="literal">controller</code>&#13;
 and <code class="literal">action</code>&#13;
 respectively, if the values for <code class="literal">controller</code>&#13;
 or <code class="literal">action</code>&#13;
 are not supplied in the URL.</li>&#13;
<li class="listitem">Make the <code class="literal">Id</code>&#13;
 parameter optional so that the URL does not need to have this information. If the URL contains this <code class="literal">Id</code>&#13;
 information, it will use it. Otherwise, the <code class="literal">Id</code>&#13;
 information will not be passed to the <code class="literal">action</code>&#13;
 method.</li>&#13;
</ul>&#13;
</p>&#13;
<p>Let us discuss how the routing engine selects the <code class="literal">controller</code>&#13;
 classes, <code class="literal">action</code>&#13;
 methods, and <code class="literal">Id</code>&#13;
 values for different URLs:</p>&#13;
<pre class="programlisting">URL1:http://localhost/ 
Controller: Hello 
Action method: Greeting 
Id: no value is passed for the id parameter 
</pre>&#13;
<p>Reasoning: The <code class="literal">Hello</code>&#13;
 controller is passed as the default value as per the routing configuration, as no value is passed as the Controller in the URL.</p>&#13;
<p>The following <code class="literal">action</code>&#13;
 method will be picked up by the routing handler when the preceding URL is passed:</p>&#13;
<pre class="programlisting">public class HelloController : Controller { 
  public ActionResult Greeting(int id) { 
    return View(); 
  } 
}
 
URL2: http://localhost/Hello/Greeting2 
Controller: Hello 
Action method: Greeting2 
Id: no value is passed for the id parameter 
</pre>&#13;
<p>Reasoning: The <code class="literal">Hello</code>&#13;
 controller will be chosen as the URL contains <code class="literal">Hello</code>&#13;
 as the first parameter, and the <code class="literal">Greeting2</code>&#13;
 action method will be chosen as the URL contains <code class="literal">Greeting2</code>&#13;
 as the second parameter. Please note that the default value mentioned in the configuration would be picked only when no value is present in the URL. As the <code class="literal">id</code>&#13;
 parameter is optional and the URL does not contain the value for <code class="literal">id</code>&#13;
 , no value is passed to the <code class="literal">id</code>&#13;
 parameter.</p>&#13;
<p>The following action method <code class="literal">Greeting2</code>&#13;
 will be picked up by the routing handler when the preceding URL is passed:</p>&#13;
<pre class="programlisting">public class HelloController : Controller { 
  public ActionResult Greeting(int id) { 
    return View(); 
  } 
 
  public ActionResult Greeting2(int id) { 
    return View(); 
  } 
} 
 
URL3: http://localhost/Hello2/Greeting2 
Controller: Hello2 
Action method: Greeting2 
Id: no value is passed for the id parameter 
</pre>&#13;
<p>Reasoning: As <code class="literal">Hello2</code>&#13;
 is passed as the first parameter, the <code class="literal">Hello2</code>&#13;
 controller will be selected, and <code class="literal">Greeting2</code>&#13;
 is the action method selected since <code class="literal">Greeting2</code>&#13;
 is passed as the second parameter. As the <code class="literal">id</code>&#13;
 parameter is optional and no value is passed for the parameter <code class="literal">id</code>&#13;
 , no value will be passed for the <code class="literal">id</code>&#13;
 .</p>&#13;
<p>The following <code class="literal">action</code>&#13;
 method will be picked up by the routing handler when the preceding URL is passed:</p>&#13;
<pre class="programlisting">public class Hello2Controller : Controller { 
  public ActionResult Greeting2(int id) { 
    return View(); 
  } 
} 
URL4: http://localhost/Hello3/Greeting2/1 
Controller: Hello3 
Action method: Greeting2 
Id: 1 
</pre>&#13;
<p>Reasoning: <code class="literal">Hello3</code>&#13;
 is the controller selected as it is mentioned as the first parameter, <code class="literal">Greeting4</code>&#13;
 is the action method, and <code class="literal">1</code>&#13;
 is the value passed as the <code class="literal">id</code>&#13;
 .</p>&#13;
<p>The following <code class="literal">action</code>&#13;
 method will be picked up the routing handler when the preceding URL is passed:</p>&#13;
<pre class="programlisting">public class Hello3Controller : Controller { 
  public ActionResult Greeting2(int id) { 
    return View(); 
  } 
} 
</pre>&#13;
<p>We will discuss routing in detail in a later chapter.</p>&#13;
<p>Once the request reaches the controller, the controller will create a response by talking to the Model and may pass the data to View and the View will then be rendered to the end user.</p>&#13;
</div>&#13;

<p>&#13;
<div>&#13;
<div>&#13;
<div>&#13;
<h1 class="title"><a id="ch03lvl1sec22"/>&#13;
 Creating ASP.NET 5 application</h1>&#13;
</p>&#13;
</div>&#13;
</div>&#13;
<p>It's time to get our hands dirty. Let us create a simple ASP.NET 5 application. Fire up Visual Studio and follow these steps:</p>&#13;
<p>&#13;
<ol class="orderedlist arabic">&#13;
<li class="listitem" value="1">Create a project by selecting &#13;
<strong>File</strong>&#13;
&#13;
 | &#13;
<strong>New Project</strong>&#13;
&#13;
 in Visual Studio. The first option is for creating an earlier version of the ASP.NET Web application. The second option is for creating the ASP.NET Core application using the .NET Core framework. The third option is for creating the ASP.NET Core application using the .NET framework. The difference between the second and third option is that the .NET framework supports all the functionalities of existing .NET frameworks whereas .NET Core supports only the core functionalities. The advantage of using the .NET core library is that it can be deployed on any platform.<div><img src="img/Image00022.jpg" alt="Creating ASP.NET 5 application"/>&#13;
</p>&#13;
<p style="clear:both; height: 1em;"/>&#13;
</li>&#13;
<li class="listitem" value="2">Select the &#13;
<strong>Empty</strong>&#13;
&#13;
 template from the list of ASP.NET 5 templates. The second option is for creating the Web API application (for building the HTTP-based services) and the third option is for creating a web application containing some basic functionalities which you can run just from out of the box without you ever needing to write anything.<div><img src="img/Image00023.jpg" alt="Creating ASP.NET 5 application"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
</li>&#13;
<li class="listitem" value="3">Once you click &#13;
<strong>OK</strong>&#13;
&#13;
 in the window as shown in the preceding screenshot, (after selecting the Empty template option) a solution will be created as shown in the following screenshot:<div><img src="img/Image00024.jpg" alt="Creating ASP.NET 5 application"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
</li>&#13;
<li class="listitem" value="4">When you run the application (by pressing &#13;
<strong>F5</strong>&#13;
&#13;
 ) without any changes, you'll get the simple &#13;
<strong>Hello World!</strong>&#13;
&#13;
 text on your screen as shown in the following screenshot:<div><img src="img/Image00025.jpg" alt="Creating ASP.NET 5 application"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
</li>&#13;
</ol>&#13;
<p>&#13;
</p>&#13;
<p>We have not done any coding in this newly created application. So, have you thought about how it displays the text &#13;
<strong>Hello World!</strong>&#13;
&#13;
 ?</p>&#13;
<p>The answer lies in the <code class="literal">Startup.cs</code>&#13;
 file, which contains a class by the name of <code class="literal">Startup</code>&#13;
 . This class contains the <code class="literal">Main</code>&#13;
 method, which acts as the entry point for the web application. If you have used any of the previous versions of ASP.NET MVC, or even ASP.NET Web Forms, this would not be the case.</p>&#13;
<p>ASP.NET 5 runtime calls the <code class="literal">ConfigureServices</code>&#13;
 and <code class="literal">Configure</code>&#13;
 methods. For example, if you want to configure any service, you can add it here. Any custom configuration for your application can be added to this <code class="literal">Configure</code>&#13;
 method:</p>&#13;
<pre class="programlisting">public void ConfigureServices(IServiceCollection services) { 
 
} 
 
// This method gets called by the runtime. Use this method to  configure the HTTP request pipeline. 
public void Configure(IApplicationBuilder app) { 
  app.UseIISPlatformHandler(); 
  app.Run(async (context) =&gt; { 
    await context.Response.WriteAsync("Hello World!"); 
  }); 
 
} 
</pre>&#13;
<p>There are only a couple of statements in the <code class="literal">Configure</code>&#13;
 method. The first statement tells the run-time to use the <code class="literal">IISPlatformHandler</code>&#13;
 for handling all the incoming HTTP requests. Let us leave aside <code class="literal">async</code>&#13;
 , <code class="literal">await</code>&#13;
 , and <code class="literal">context</code>&#13;
 for the moment in the second statement, which we will discuss later. In essence, the second statement tells the run-time to return <code class="literal">Hello World!</code>&#13;
 for all the incoming requests irrespective of the incoming URL.</p>&#13;
<p>When you type the URL <code class="literal">http://localhost:50140/Hello</code>&#13;
  in your browser, it will still return the same &#13;
<strong>Hello World!</strong>&#13;
&#13;
 .</p>&#13;
<p>This is the reason we got the &#13;
<strong>Hello World!</strong>&#13;
&#13;
 when we ran the application.</p>&#13;
<p>As we have chosen the &#13;
<strong>Empty</strong>&#13;
&#13;
 template while creating the ASP.NET 5 application, no component will have been installed. Even MVC wouldn't be installed by default when you select the &#13;
<strong>Empty</strong>&#13;
&#13;
 template as we did.</p>&#13;
<p>You can confirm it by opening the <code class="literal">project.json</code>&#13;
 file, where you can see no ASP.NET MVC is mentioned in the list of dependencies:</p>&#13;
<pre class="programlisting">"dependencies": { 
  "Microsoft.AspNet.IISPlatformHandler": "1.0.0-rc1-final", 
  "Microsoft.AspNet.Server.Kestrel": "1.0.0-rc1-final" 
}, 
</pre>&#13;
<p>So first, let us install the ASP.Net Core package for our application.</p>&#13;
</div>&#13;

<p>&#13;
<div>&#13;
<div>&#13;
<div>&#13;
<h1 class="title"><a id="ch03lvl1sec23"/>&#13;
 Installing the ASP.NET Core NuGet package in your application</h1>&#13;
</p>&#13;
</div>&#13;
</div>&#13;
<p>Follow these steps to install the <code class="literal">NuGet</code>&#13;
 package of ASP.NET MVC:</p>&#13;
<p>&#13;
<ol class="orderedlist arabic">&#13;
<li class="listitem" value="1">Right click on the project, and select the &#13;
<strong>Manage NuGet Packages</strong>&#13;
&#13;
 option:<div><img src="img/Image00026.jpg" alt="Installing the ASP.NET Core NuGet package in your application"/>&#13;
</p>&#13;
<p style="clear:both; height: 1em;"/>&#13;
</li>&#13;
<li class="listitem" value="2">Select the &#13;
<strong>Include Prerelease</strong>&#13;
&#13;
 checkbox so that the &#13;
<strong>NuGet Package Manager</strong>&#13;
&#13;
 will list out all the prerelease packages. Search for <code class="literal">MVC</code>&#13;
 and you'll get the &#13;
<strong>Microsoft.AspNet.MVC</strong>&#13;
&#13;
 package, as shown in the following result, and click on the &#13;
<strong>Install</strong>&#13;
&#13;
 button on the right-hand side:<div><img src="img/Image00027.jpg" alt="Installing the ASP.NET Core NuGet package in your application"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
</li>&#13;
<li class="listitem" value="3">Review the changes:<div><img src="img/Image00028.jpg" alt="Installing the ASP.NET Core NuGet package in your application"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
</li>&#13;
<li class="listitem" value="4">Once you click on &#13;
<strong>Review Changes</strong>&#13;
&#13;
 , the following dialog box will appear where you need to accept the license terms:<div><img src="img/Image00029.jpg" alt="Installing the ASP.NET Core NuGet package in your application"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
</li>&#13;
</ol>&#13;
<p>&#13;
</p>&#13;
<p>The &#13;
<strong>NuGet Package Manager</strong>&#13;
&#13;
 will download and install the ASP.NET Core and will update the <code class="literal">project.json</code>&#13;
 file and the associated references.</p>&#13;
<p>Now, your <code class="literal">project.json</code>&#13;
 file will have updated dependencies. The second line <code class="literal">Microsoft.AspNet.Mvc</code>&#13;
 is added:</p>&#13;
<pre class="programlisting">"dependencies": { 
  "Microsoft.AspNet.IISPlatformHandler": "1.0.0-rc1-final", 
  "Microsoft.AspNet.Mvc": "6.0.0-rc1-final", 
  "Microsoft.AspNet.Server.Kestrel": "1.0.0-rc1-final" 
}, 
</pre>&#13;
<p>Alternatively, you can also update the <code class="literal">project.json</code>&#13;
 with the <code class="literal">NuGet</code>&#13;
 package along with the version information. The &#13;
<strong>NuGet Package Manager</strong>&#13;
&#13;
 will automatically download and install them.</p>&#13;
<p>ASP.NET Core is installed in our application. Now, we need to tell our application to use ASP.NET MVC.</p>&#13;
<p>This needs a couple of changes to the <code class="literal">Startup.cs</code>&#13;
 file:</p>&#13;
<p>&#13;
<ol class="orderedlist arabic">&#13;
<li class="listitem" value="1">Configure the application to add the MVC service. This can be done by adding the following line to the <code class="literal">ConfigureServices</code>&#13;
 method of the <code class="literal">Startup</code>&#13;
 class:<pre class="programlisting">      services.AddMvc(); 
</pre>&#13;
</li>&#13;
<li class="listitem" value="2">Configure the routing so that our correct controllers will be picked for the incoming requests based on the URL entered. The following code snippet needs to be updated in the <code class="literal">Configure</code>&#13;
 method of the <code class="literal">Startup.cs</code>&#13;
 file:app.UseMvc(routes =&gt; { <pre class="programlisting">app.UseMvc(routes =&gt; { 
  routes.MapRoute( 
    name: "default", 
    template: "{controller=Home}/{action=Index}/{id?}"); 
}); 
</pre>&#13;
</li>&#13;
</ol>&#13;
<div>&#13;
</p>&#13;
<p>In the preceding statement, we are configuring the routes for our application.</p>&#13;
<p>In this chapter and most of the chapters in this book, we will write codes manually or choose an &#13;
<strong>Empty</strong>&#13;
&#13;
 template instead of relying on scaffolding templates. For those who are new to the term &#13;
<strong>scaffolding</strong>&#13;
&#13;
 , scaffolding is a feature that generates all the necessary boilerplate code for you for the selected item (for example, the Controller) instead of you needing to write everything. Though I agree that scaffolding templates are useful and save time in generating the boilerplate code, they hide many of the details that beginners have to understand. Once you write code manually, you'll know all the intricacies of how each of the components is contributing to the big picture. Once you are strong in the fundamentals, you can use scaffolding templates to save you time in writing the boilerplate code.</p>&#13;
</div>&#13;

<p>&#13;
<div>&#13;
<div>&#13;
<div>&#13;
<h1 class="title"><a id="ch03lvl1sec24"/>&#13;
 Our first Controller</h1>&#13;
</p>&#13;
</div>&#13;
</div>&#13;
<p>Before creating the Controller, we need to remove the following <code class="literal">app.Run</code>&#13;
 statement as this will return <code class="literal">Hello World!</code>&#13;
 for all the incoming requests. As we want incoming requests to be handled by the controllers, we need to remove the following code from the <code class="literal">Configure</code>&#13;
 method of the <code class="literal">Startup</code>&#13;
 class:</p>&#13;
<pre class="programlisting">app.Run(async (context) =&gt; { 
  await context.Response.WriteAsync("Hello World!"); 
}); 
</pre>&#13;
<p>We have installed the ASP.NET Core in our application. So, we are geared up to creating our first ASP.NET Core controller. Create a folder with the name <code class="literal">Controllers</code>&#13;
 and add a new Controller by selecting from the context menu as shown in the following screenshot:</p>&#13;
<div><img src="img/Image00030.jpg" alt="Our first Controller"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>Once you select &#13;
<strong>Add</strong>&#13;
&#13;
 | &#13;
<strong>New Item</strong>&#13;
&#13;
 , you will be shown the following list of options. We are going to add an MVC controller class to our project:</p>&#13;
<div><img src="img/Image00031.jpg" alt="Our first Controller"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>A class will be created with the following content:</p>&#13;
<pre class="programlisting">public class HomeController : Controller { 
  // GET: /&lt;controller&gt;/ 
  public IActionResult Index() { 
    return View(); 
  } 
} 
</pre>&#13;
<p>All controllers, both MVC and Web API controllers, inherit from the <code class="literal">Controller</code>&#13;
 base class. In earlier versions of ASP.NET MVC, MVC controllers would inherit from the <code class="literal">Controller</code>&#13;
 class and Web API controllers would inherit from the <code class="literal">APIController</code>&#13;
 class.</p>&#13;
<p>In the preceding <code class="literal">HomeController</code>&#13;
 class, we have a single action method by <code class="literal">Index</code>&#13;
  that returns the corresponding View. When you run the application as it is, you'll get a &#13;
<strong>500 Internal Server Error</strong>&#13;
&#13;
 . The reason being is that no View has been created for the <code class="literal">Index</code>&#13;
 action of the <code class="literal">HomeController</code>&#13;
 and ASP.NET Core tries to search for that View. As the View is not available, it returns a &#13;
<strong>500 Internal Server Error</strong>&#13;
&#13;
 .</p>&#13;
<p>Instead of creating and returning that View, let us make a simple change to this action method. Let us return a string, <code class="literal">Hello World! I am learning MVC 6!</code>&#13;
 , and change the return type of <code class="literal">IActionResult</code>&#13;
 :</p>&#13;
<pre class="programlisting">public string Index() { 
  return "Hello World! I am learning MVC 6!"; 
} 
</pre>&#13;
<p>Run the application. You'll see the &#13;
<strong>Hello World! I am learning MVC 6!</strong>&#13;
&#13;
 in your browser as shown in the following screenshot. Please make sure that you remove the <code class="literal">app.Run</code>&#13;
 statement in the <code class="literal">Configure</code>&#13;
 method as mentioned earlier:</p>&#13;
<div><img src="img/Image00032.jpg" alt="Our first Controller"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>Voila! We have changed the ASP.NET Core application to render the custom content instead of the boring &#13;
<em>Hello World</em>&#13;
&#13;
 . What we have done may seem like a marginal improvement, but we have used controllers and action methods in our ASP.NET Core application, which has brought a lot of structure and flexibility to the web application development.</p>&#13;
<div><img src="img/Image00033.jpg" alt="Our first Controller"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>The following is the sequence of steps that occur when we run the application:</p>&#13;
<p>&#13;
<ol class="orderedlist arabic">&#13;
<li class="listitem" value="1">The application runs on the URL <code class="literal">http://localhost:50140</code>&#13;
 , where <code class="literal">50140</code>&#13;
 is the port number selected by IIS Express to run the application on my local system. This number may vary.</li>&#13;
<li class="listitem" value="2">As we have not passed any parameter, default values for the <code class="literal">Controller</code>&#13;
 and <code class="literal">action</code>&#13;
 method will be selected. In our case, <code class="literal">HomeController</code>&#13;
 will be chosen as the <code class="literal">Controller</code>&#13;
 and <code class="literal">Index</code>&#13;
 will be chosen as the <code class="literal">action</code>&#13;
 method in the <code class="literal">HomeController</code>&#13;
 . Since <code class="literal">ID</code>&#13;
 is the optional value and it is not passed, this <code class="literal">ID</code>&#13;
 parameter is ignored.</li>&#13;
<li class="listitem" value="3">After the <code class="literal">Controller</code>&#13;
 and <code class="literal">action</code>&#13;
 methods are selected by the routing engine, control is passed to the <code class="literal">action</code>&#13;
 method of the selected controller. In our case, it will be the <code class="literal">Index</code>&#13;
 action method of the <code class="literal">HomeController</code>&#13;
 .</li>&#13;
<li class="listitem" value="4">In the <code class="literal">Index</code>&#13;
 action method, we are returning a string, <code class="literal">Hello World! I am learning ASP.Net MVC 6!</code>&#13;
 . This text is returned from the controller, which would then return back to the user.</li>&#13;
</ol>&#13;
<div>&#13;
</p>&#13;
<p>&#13;
<div>&#13;
<div>&#13;
<div>&#13;
<h2 class="title"><a id="ch03lvl2sec19"/>&#13;
 IActionResult</h2>&#13;
</p>&#13;
</div>&#13;
</div>&#13;
<p>If you noticed, the default return type in the <code class="literal">action</code>&#13;
 method of the controller was <code class="literal">IActionResult</code>&#13;
 and then we changed the return type to the string in order to return the text <code class="literal">Hello World...</code>&#13;
 .</p>&#13;
<p>The <code class="literal">IActionResult</code>&#13;
  is the interface that we can use to return different types of <code class="literal">ActionResult</code>&#13;
 , ranging from a simple string to complex JSON data, so, we don't need to change the <code class="literal">return</code>&#13;
 type of the <code class="literal">action</code>&#13;
 method to return the string.</p>&#13;
<p>In the earlier example, I have changed the <code class="literal">return</code>&#13;
 type to the string to make things simple. Now, let us make a simple change to return the string by keeping the return type (<code class="literal">IActionResult</code>&#13;
 ) as it is:</p>&#13;
<pre class="programlisting">// GET: /&lt;controller&gt;/ 
public IActionResult Index() { 
  return Content("Hello World! I am learning MVC 6!"); 
} 
</pre>&#13;
<p>While returning the string, we are using the <code class="literal">virtual</code>&#13;
 method, called <code class="literal">Content</code>&#13;
  from the <code class="literal">Controller</code>&#13;
 class (the base controller from where <code class="literal">HomeController</code>&#13;
 is inherited from) in the preceding <code class="literal">action</code>&#13;
 method. The purpose of this <code class="literal">Content()</code>&#13;
 method is to convert the string to the type <code class="literal">IActionResult</code>&#13;
 .</p>&#13;
<p>Now, run the application. We should be getting the same result.</p>&#13;
<p>&#13;
<code class="literal">IActionResult</code>&#13;
 is capable of returning different data types:</p>&#13;
<p>&#13;
<ul class="itemizedlist">&#13;
<li class="listitem">&#13;
<code class="literal">ContentResult</code>&#13;
 : Can return a text result.</li>&#13;
<li class="listitem">&#13;
<code class="literal">EmptyResult</code>&#13;
 : Returns a <code class="literal">null</code>&#13;
 result.</li>&#13;
<li class="listitem">&#13;
<code class="literal">FileResult</code>&#13;
 : Returns a binary output to write to the response.</li>&#13;
<li class="listitem">&#13;
<code class="literal">HttpStatusCodeResult</code>&#13;
 : Provides a way to return.</li>&#13;
<li class="listitem">&#13;
<code class="literal">JavaScriptResult</code>&#13;
 : Returns a script that can be executed from the client side.</li>&#13;
<li class="listitem">&#13;
<code class="literal">JSonResult</code>&#13;
 : When you return a serialized JSON object.</li>&#13;
<li class="listitem">&#13;
<code class="literal">RedirectResult</code>&#13;
 : Redirects to another <code class="literal">action</code>&#13;
 method.</li>&#13;
<li class="listitem">&#13;
<code class="literal">RedirectToRouteResult</code>&#13;
 : Represents a result that performs a redirection by using a specified route values dictionary.</li>&#13;
</ul>&#13;
</p>&#13;
</div>&#13;
</div>&#13;

<p>&#13;
<div>&#13;
<div>&#13;
<div>&#13;
<h1 class="title"><a id="ch03lvl1sec25"/>&#13;
 Adding Views</h1>&#13;
</p>&#13;
</div>&#13;
</div>&#13;
<p>We were returning a simple string from the controller. Although that explains the concept of how the <code class="literal">Controller</code>&#13;
 and <code class="literal">action</code>&#13;
 method works, it is not of much practical use.</p>&#13;
<p>Let us create a new <code class="literal">action</code>&#13;
 method by the name, <code class="literal">Index2</code>&#13;
 :</p>&#13;
<pre class="programlisting">public IActionResult Index2() { 
  return View(); // View for this 'Index2' action method 
} 
</pre>&#13;
<p>Now, we have created the <code class="literal">action</code>&#13;
 method that returns a View. But we still have not added the View for the same. By convention, ASP.NET MVC would try to search for our View in the folder <code class="literal">Views\{ControllerName}\{ActionMethod.cshtml}</code>&#13;
 . With respect to the preceding example, it will try to search for <code class="literal">Views\Home\Index2.cshtml</code>&#13;
 . Please note that the name of the <code class="literal">controller</code>&#13;
 folder-is <code class="literal">Home</code>&#13;
 , not <code class="literal">HomeController</code>&#13;
 . Only the prefix is needed as per convention. As this folder structure and file are not available, you'll get a &#13;
<strong>500 Internal Server Error</strong>&#13;
&#13;
 when you try to access this action method through the URL <code class="literal">http://localhost:50140/Home/Index2</code>&#13;
 .</p>&#13;
<p>So, let us create a folder structure. Right-click on the solution, select &#13;
<strong>Add</strong>&#13;
&#13;
 | &#13;
<strong>New Folder</strong>&#13;
&#13;
 from the context menu, create a folder called <code class="literal">Views</code>&#13;
 , and then create a subfolder by the name <code class="literal">Home</code>&#13;
 within the <code class="literal">Views</code>&#13;
 folder:</p>&#13;
<div><img src="img/Image00034.jpg" alt="Adding Views"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>Right click on the <code class="literal">Home</code>&#13;
 folder, and select &#13;
<strong>Add</strong>&#13;
&#13;
 | &#13;
<strong>New Item</strong>&#13;
&#13;
 from the context menu. A dialog will appear as shown in the following screenshot. Give the name of the file as <code class="literal">Index2.cshtml</code>&#13;
 , as our <code class="literal">action</code>&#13;
 method name is <code class="literal">Index2</code>&#13;
 . <code class="literal">cshtml</code>&#13;
 is the razor view engine (this will be discussed in detail in the &#13;
<em>ViewEngines</em>&#13;
&#13;
 section of the &#13;
<em>Views</em>&#13;
&#13;
 chapter) extension used when you are using C#.</p>&#13;
<div><img src="img/Image00035.jpg" alt="Adding Views"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>A file by the name <code class="literal">Index2.cshtml</code>&#13;
 will be created when you click the &#13;
<strong>Add</strong>&#13;
&#13;
 button in the preceding screen with the following content:</p>&#13;
<div><img src="img/Image00036.jpg" alt="Adding Views"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>&#13;
<code class="literal">@*</code>&#13;
 is the comment syntax in the razor view engine. You can write any C# code within the <code class="literal">@{}</code>&#13;
 block.</p>&#13;
<p>Let us add a simple HTML block after the generated code:</p>&#13;
<pre class="programlisting">
&lt;html&gt; 
  &lt;body&gt; 
    Hello! This is &lt;b&gt;my first View&lt;/b&gt;  
  &lt;/body&gt; 
&lt;/html&gt; 
</pre>&#13;
<p>Now, when you run the application, you will get the following output:</p>&#13;
<div><img src="img/Image00037.jpg" alt="Adding Views"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>The following diagram explains the request flow and how we generate the response through the View:</p>&#13;
<div><img src="img/Image00038.jpg" alt="Adding Views"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
</div>&#13;

<h1>读累了记得休息一会哦~</h1>
<p> </p>
<p><strong>公众号：古德猫宁李</strong></p>
<ul>
<li>电子书搜索下载</li>
<li>书单分享</li>
<li>书友学习交流</li>

<p> </p>
</ul>
<p><strong>网站：</strong><a href="https://www.chenjin5.com">沉金书屋 https://www.chenjin5.com</a></p>
<ul>
<li>电子书搜索下载</li>
<li>电子书打包资源分享</li>
<li>学习资源分享</li>

</ul>

<p>&#13;
<div>&#13;
<div>&#13;
<div>&#13;
<h1 class="title"><a id="ch03lvl1sec26"/>&#13;
 Adding Models</h1>&#13;
</p>&#13;
</div>&#13;
</div>&#13;
<p>Models represent your business domain classes. Now, we are going to learn about how to use the Models in our controller. Create a <code class="literal">Models</code>&#13;
 folder and add a simple <code class="literal">Employee</code>&#13;
 class. This is a just a plain old C# class:</p>&#13;
<pre class="programlisting">
public class Employee { 
  public int EmployeeId { get; set; } 
  public string Name { get; set; } 
  public string Designation { get; set; } 
} 
</pre>&#13;
<p>Create a new <code class="literal">action</code>&#13;
 method, <code class="literal">Employee</code>&#13;
 , in our <code class="literal">HomeController</code>&#13;
 , and create an object of the <code class="literal">Employee</code>&#13;
 Model with some values, and pass the Model to the View. Our idea is to use the Model employee values in the View to present them to the user:</p>&#13;
<pre class="programlisting">using Chapter3.Models; 
public IActionResult Employee() { 
  //Sample Model - Usually this comes from database 
 Employee emp1 = new Employee { 
    EmployeeId = 1, 
    Name = "Jon Skeet", 
    Designation = " Software Architect" 
  }; 
  return View(emp1); 
} 
</pre>&#13;
<p>Now, we need to add the respective View for this <code class="literal">action</code>&#13;
 method. Add a new Razor view file in the <code class="literal">View\Home folder</code>&#13;
 .</p>&#13;
<p>Add the following code snippet. Whatever comes after the <code class="literal">@</code>&#13;
 symbol is considered as Razor code. In the following code, we are trying to access the properties of the <code class="literal">Model</code>&#13;
 object that is passed to our view. In our case, <code class="literal">Model</code>&#13;
 represents the <code class="literal">employee</code>&#13;
 object that we have constructed in our <code class="literal">action</code>&#13;
 method. You can access the object from View using the Model keyword:</p>&#13;
<pre class="programlisting">&lt;html&gt; 
  &lt;body&gt; 
 Employee Name : @Model.Name &lt;br/&gt; 
    Employee Designation: @Model.Designation &lt;br/&gt; 
  &lt;/body&gt; 
&lt;/html&gt; 
</pre>&#13;
<p>When you run the application and type the URL <code class="literal">http://localhost:50140/Home/Employee</code>&#13;
 , you'll see the following output:</p>&#13;
<div><img src="img/Image00039.jpg" alt="Adding Models"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
</div>&#13;

<p>&#13;
<div>&#13;
<div>&#13;
<div>&#13;
<h1 class="title"><a id="ch03lvl1sec27"/>&#13;
 Passing data from Controller to View</h1>&#13;
</p>&#13;
</div>&#13;
</div>&#13;
<p>We have just discussed how to pass the data from the Controller to the View using the <code class="literal">Model</code>&#13;
 object. While calling the View, we are passing the model data as a parameter. But there are times when you want to pass some temporary data to the View from the Controller. This temporary data may not deserve a <code class="literal">model</code>&#13;
 class. In such scenarios, we can use either <code class="literal">ViewBag</code>&#13;
 or <code class="literal">ViewData</code>&#13;
 .</p>&#13;
<p>&#13;
<code class="literal">ViewData</code>&#13;
 is the dictionary and <code class="literal">ViewBag</code>&#13;
 is the dynamic representation of the same value.</p>&#13;
<p>Let us add the company name and company location property using <code class="literal">ViewBag</code>&#13;
 and <code class="literal">ViewData</code>&#13;
 as shown in the following code snippet:</p>&#13;
<pre class="programlisting">public IActionResult Employee() { 
  //Sample Model - Usually this comes from database 
  Employee emp1 = new Employee { 
    EmployeeId = 1, 
    Name = "Jon Skeet", 
    Designation = " Software Architect" 
  }; 
 
  ViewBag.Company = "Google Inc"; 
  ViewData["CompanyLocation"] = "United States"; 
 
  return View(emp1); 
} 
</pre>&#13;
<p>Make the respective changes in the View file as well so that we can display the <code class="literal">Company</code>&#13;
 name and <code class="literal">Company location</code>&#13;
 values:</p>&#13;
<pre class="programlisting">&lt;html&gt; 
  &lt;body&gt; 
    Employee Name : @Model.Name &lt;br/&gt; 
    Employee Designation: @Model.Designation &lt;br/&gt; 
    Company : @ViewBag.Company &lt;br/&gt; 
    Company Location: @ViewData["CompanyLocation"] &lt;br /&gt; 
  &lt;/body&gt; 
&lt;/html&gt; 
</pre>&#13;
<p>Run the application after making the preceding changes:</p>&#13;
<div><img src="img/Image00040.jpg" alt="Passing data from Controller to View"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>&#13;
<code class="literal">ViewBag</code>&#13;
 and <code class="literal">ViewData</code>&#13;
 represent the same collection, even though the entries in the collection are accessed through different methods. <code class="literal">ViewBag</code>&#13;
 values are dynamic values and are executed at run-time, whereas the <code class="literal">ViewData</code>&#13;
 is accessed through the dictionary.</p>&#13;
<p>To test this, let us make a simple change to our <code class="literal">view</code>&#13;
 file:</p>&#13;
<pre class="programlisting">Employee Name : @Model.Name &lt;br/&gt; 
Employee Designation: @Model.Designation &lt;br/&gt; 
Company : @ViewData["Company"] &lt;br /&gt; 
Company Location : @ViewBag.CompanyLocation &lt;br /&gt; 
</pre>&#13;
<p>Even though I have stored the <code class="literal">Company</code>&#13;
 value using <code class="literal">ViewBag</code>&#13;
 in the <code class="literal">Controller</code>&#13;
 , I am accessing the same using <code class="literal">ViewData</code>&#13;
 . The same is the case for the <code class="literal">Company Location</code>&#13;
 value, we have stored the value using <code class="literal">ViewData</code>&#13;
 in the Controller, but we are accessing the value using <code class="literal">ViewBag</code>&#13;
 .</p>&#13;
<p>When you run the application after making the preceding changes, you'll see the same result as you have seen before.</p>&#13;
</div>&#13;

<p>&#13;
<div>&#13;
<div>&#13;
<div>&#13;
<h1 class="title"><a id="ch03lvl1sec28"/>&#13;
 Filters</h1>&#13;
</p>&#13;
</div>&#13;
</div>&#13;
<p>Filters in ASP.NET MVC enable you to run code before or after a particular stage in the execution pipeline. They can be configured globally per-controller or per-action.</p>&#13;
<p>There are different kinds of filters, and each filter is executed at a different stage in the pipeline. For example, action filters are executed when the <code class="literal">action</code>&#13;
 method is executed.</p>&#13;
<p>Let us use a simple example to see how an action filter (a type of filter) works.</p>&#13;
<p>I have created a simple controller, <code class="literal">DateController</code>&#13;
 , where I am just displaying the time. In this <code class="literal">action</code>&#13;
 method, I am using a predefined action filter by the name of <code class="literal">ResponseCache</code>&#13;
 , that caches the response for the duration specified in seconds. In the following code snippet, we have mentioned the duration as 600 seconds. So, the response will be cached for 10 minutes.</p>&#13;
<pre class="programlisting">public class DateController : Controller { 
  [ResponseCache(Duration = 600)] 
  public IActionResult Index() { 
    return Content(DateTime.Now.ToShortTimeString()); 
  } 
} 
</pre>&#13;
<p>When I run it for the first time, it displays the time as expected. But when you refresh the browser (which indirectly fires the request again), the time is not updated as the response is cached already by the application. In the following screenshot, even though the time is 7:43, the application is still showing as 7:40:</p>&#13;
<div><img src="img/Image00041.jpg" alt="Filters"/>&#13;
</div>&#13;
<p style="clear:both; height: 1em;"/>&#13;
<p>The following are the predefined types of filters available in ASP.NET Core.</p>&#13;
<p>&#13;
<div>&#13;
<div>&#13;
<div>&#13;
<h2 class="title"><a id="ch03lvl2sec20"/>&#13;
 Authorization filters</h2>&#13;
</p>&#13;
</div>&#13;
</div>&#13;
<p>These are used for authorization and are mainly intended to determine whether the current user is authorized for the request being made.</p>&#13;
</div>&#13;
<p>&#13;
<div>&#13;
<div>&#13;
<div>&#13;
<h2 class="title"><a id="ch03lvl2sec21"/>&#13;
 Resource filters</h2>&#13;
</p>&#13;
</div>&#13;
</div>&#13;
<p>These are the filters that handle the request after authorization and are the last one to handle the request before it leaves the filter pipeline. They are used to implement caching or by passing the filter pipeline.</p>&#13;
</div>&#13;
<p>&#13;
<div>&#13;
<div>&#13;
<div>&#13;
<h2 class="title"><a id="ch03lvl2sec22"/>&#13;
 Action filters</h2>&#13;
</p>&#13;
</div>&#13;
</div>&#13;
<p>These wrap calls to individual <code class="literal">action</code>&#13;
 method calls and can manipulate the arguments passed in the action as well as the action result returned from it.</p>&#13;
</div>&#13;
<p>&#13;
<div>&#13;
<div>&#13;
<div>&#13;
<h2 class="title"><a id="ch03lvl2sec23"/>&#13;
 Exception filters</h2>&#13;
</p>&#13;
</div>&#13;
</div>&#13;
<p>These are used to manage the unhandled exceptions in ASP.NET MVC.</p>&#13;
</div>&#13;
<p>&#13;
<div>&#13;
<div>&#13;
<div>&#13;
<h2 class="title"><a id="ch03lvl2sec24"/>&#13;
 Result filters</h2>&#13;
</p>&#13;
</div>&#13;
</div>&#13;
<p>This wrap the individual action results and they only run when the <code class="literal">action</code>&#13;
 method is executed successfully.</p>&#13;
</div>&#13;
</div>&#13;

<p>&#13;
<div>&#13;
<div>&#13;
<div>&#13;
<h1 class="title"><a id="ch03lvl1sec29"/>&#13;
 Summary</h1>&#13;
</p>&#13;
</div>&#13;
</div>&#13;
<p>In this chapter, we have built our first ASP.NET 5 application from scratch and we have installed ASP.NET Core in our ASP.NET 5 application. We have learned how the controller fits into the overall ASP.NET MVC application and learned how to build your first controller with the <code class="literal">action</code>&#13;
 methods. We also learned about how to use Model and View in our Controller. We have also discussed different ways to pass the data from the Controller to the View using <code class="literal">ViewBag</code>&#13;
 and <code class="literal">ViewData</code>&#13;
 . We have also learned about filters in ASP.NET MVC and how to make use of predefined filters in ASP.NET Core.</p>&#13;
</div>&#13;
</body></html>