<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Lights and Effects</h1>
                </header>
            
            <article>
                
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li>Directional Light with a cookie Texture to simulate a cloudy day</li>
<li>Creating and applying a cookie Texture to a spotlight</li>
<li>Adding a custom reflection map to a scene</li>
<li>Creating a laser aim with a projector</li>
<li>Enhancing the laser aim with a line renderer</li>
<li>Setting up an environment with Procedural Skybox and Directional Light</li>
<li>Reflecting surrounding objects with reflection probes</li>
<li>Using material emission to bake light from a glowing lamp onto scene objects</li>
<li>Lighting a scene with lightmaps and light probes</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p>Whether you're trying to make a better-looking game or you want to add interesting features, lights and effects can boost your project and help you deliver a higher quality product. Modern game engines, including Unity, use complex mathematics and physical modelling of how light from light sources interacts with objects in a <strong><span class="KeyWordPACKT">Scene</span></strong>.</p>
<p>For visually realistic virtual game <span class="KeyWordPACKT"><strong>Scenes</strong>,</span> the game engine must model sources of light, how light falls directly from those sources onto surfaces, and also how light then indirectly bounces from those surfaces to other objects in the scene, and again onto other objects and so on. For rich, complex <strong>Scene<span class="KeyWordPACKT">s</span></strong> containing many objects and light sources, it would be impossible to calculate everything from scratch every frame, so pre-computation needs to take place to model these light source and surface interactions.</p>
<p class="mce-root"/>
<p>In this chapter, we will look at the creative ways of using lights and effects, and also take a look at some of Unity's key <strong>L<span class="KeyWordPACKT">ighting</span></strong> features, such as <span class="ScreenTextPACKT"><span class="packt_screen">Procedural Skyboxes</span></span>, <span class="ScreenTextPACKT"><span class="packt_screen">Reflection</span></span> emissive <strong>M<span class="KeyWordPACKT">aterials</span></strong>, <span class="packt_screen">P<span class="ScreenTextPACKT">robes</span></span>, <span class="packt_screen">L<span class="ScreenTextPACKT">ight Probes</span></span>, custom <span class="packt_screen">R<span class="ScreenTextPACKT">eflection Sources</span></span>, and <strong>G<span class="KeyWordPACKT">lobal Illumination</span></strong> (<strong>GI</strong>).</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The big picture</h1>
                </header>
            
            <article>
                
<p>There are many ways of creating light sources in Unity. Here's a quick overview of the most common methods.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Lights</h1>
                </header>
            
            <article>
                
<p><span class="ScreenTextPACKT"><span class="packt_screen">Lights</span></span> are placed into the scene as GameObjects, featuring a <span class="ScreenTextPACKT"><span class="packt_screen">Light</span></span> component. They can function in <span class="packt_screen">Realtime</span>, <span class="ScreenTextPACKT"><span class="packt_screen">Baked</span></span>, or <span class="ScreenTextPACKT"><span class="packt_screen">Mixed</span></span> modes. Among the other properties, they can have their <span class="ScreenTextPACKT"><span class="packt_screen">Range</span></span>, <span class="ScreenTextPACKT"><span class="packt_screen">Color</span></span>, <span class="ScreenTextPACKT"><span class="packt_screen">Intensity</span></span>, and <span class="ScreenTextPACKT"><span class="packt_screen">Shadow Type</span></span> set by the user. There are four types of lights:</p>
<ul>
<li><strong><span class="KeyWordPACKT">Directional Light</span></strong>: This is normally used to simulate the sunlight</li>
<li><strong><span class="KeyWordPACKT">Spot Light</span></strong>: This works like a cone-shaped spot light</li>
<li><strong><span class="KeyWordPACKT">Point Light</span></strong>: This is a bulb-like, omnidirectional light</li>
<li><strong><span class="KeyWordPACKT">Area Light</span></strong>: This baked-only light type is emitted in all directions from a rectangle-shaped entity, allowing for a smooth, realistic shading</li>
</ul>
<p>The following screenshot illustrates different types of lights, with their scene panel icons:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/1cf7e68d-aa83-492f-a1a8-423f8e583a2c.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Environment lighting</h1>
                </header>
            
            <article>
                
<p>Unity's <span class="ScreenTextPACKT"><span class="packt_screen">Environment Lighting</span></span> is often achieved through the combination of a <span class="ScreenTextPACKT"><span class="packt_screen">Skybox</span></span> <strong>M<span class="KeyWordPACKT">aterial</span></strong> and sunlight defined by the scene's <strong><span class="KeyWordPACKT">Directional Light</span></strong>. Such a combination creates an ambient light that is integrated into the scene's environment, and which can be set as <span class="ScreenTextPACKT">real-time</span> or <span class="ScreenTextPACKT">baked</span> into <span class="KeyWordPACKT"><strong>Lightmaps</strong></span>.</p>
<p>Ambient lighting doesn't come from any locational source, as it exists evenly throughout the scene. Ambient light can be used to influence the overall brightness of a scene:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/af27aa4e-7612-4a3d-b7ae-06b79a62fe02.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Emissive materials</h1>
                </header>
            
            <article>
                
<p>When applied to static objects, materials featuring the <span class="ScreenTextPACKT"><span class="packt_screen">Emission</span></span> colors or maps will cast light over surfaces nearby, in both <strong><span class="KeyWordPACKT">Real-Time</span></strong> and <strong>Baked</strong> modes, as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/e935fb04-6498-4e0d-9853-ae197c5df3ea.png" style="width:42.17em;height:19.42em;"/></p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Projector</h1>
                </header>
            
            <article>
                
<p>As its name suggests, a <span class="ScreenTextPACKT"><span class="packt_screen">Projector</span></span> can be used to simulate projected lights and shadows, basically by projecting a material and its <strong><span class="KeyWordPACKT">Texture</span></strong> map onto the other objects:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/75b02737-7317-418c-924b-a50ed54ed431.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Lightmaps</h1>
                </header>
            
            <article>
                
<p>Lightmaps are basically <strong><span class="KeyWordPACKT">Texture</span></strong> maps generated from the <strong><span class="KeyWordPACKT">Scene's</span></strong> lighting information and applied to the scene's static objects in order to avoid the use of processing-intensive <strong><span class="KeyWordPACKT">Real-Time</span></strong> lighting.</p>
<p>Pre-computation of lighting in a <strong><span class="KeyWordPACKT">Scene</span></strong> is known as <span class="ScreenTextPACKT"><span class="packt_screen">Lightmap</span></span> <em><span class="ItalicsPACKT">Baking</span>. <span class="ItalicsPACKT">Static</span></em> <span>–</span> immovable <span>–</span> parts of the scene (lights and other objects) can have their lighting "baked" (pre-computed), before the game is run. Then, during <span class="KeyWordPACKT"><strong>Run-Time</strong>,</span> game performance is improved, since the pre-calculated <span class="ScreenTextPACKT"><span class="packt_screen">Lightmaps</span></span> can be used rather than having to re-calculate each frame at <strong><span class="KeyWordPACKT">Run-Time</span></strong> (although this does require more memory to store the pre-computations).</p>
<p class="mce-root"/>
<p>Unity offers two lightmappers, <span class="KeyWordPACKT">Enlighten</span>, and more recently the <span class="KeyWordPACKT">Progressive</span> lightmapper. Enlighten can work well for <span class="ScreenTextPACKT">Precomputed real-time Global Illumination</span> (ambient lighting). The <span class="KeyWordPACKT">Progressive</span> lightmapper is recommended for <span class="packt_screen">B</span><span class="ScreenTextPACKT"><span class="packt_screen">aked Lightmaps</span></span>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Light probes</h1>
                </header>
            
            <article>
                
<p><span class="ScreenTextPACKT">Light Probes</span> are a way of sampling the <strong><span class="KeyWordPACKT">Scene's</span></strong> illumination at specific points in order to have it applied onto dynamic objects without the use of <strong><span class="KeyWordPACKT">Real-Time</span></strong> lighting. <em><span class="ItalicsPACKT">Moving</span></em> (dynamic) objects can use <span class="ScreenTextPACKT"><span class="packt_screen">Light Probes</span></span> so that their lighting changes in relation to where the baked light sources are located in the <strong><span class="KeyWordPACKT">Scene</span></strong>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The Lighting settings window</h1>
                </header>
            
            <article>
                
<p>The <span class="ScreenTextPACKT"><span class="packt_screen">Lighting</span></span> window, (menu: <span class="ScreenTextPACKT"><span class="packt_screen">Window</span></span> | <span class="ScreenTextPACKT"><span class="packt_screen">Rendering</span></span> | <span class="ScreenTextPACKT"><span class="packt_screen">Lighting Settings</span></span>), is the hub for setting and adjusting the scene's illumination features, such as <span class="ScreenTextPACKT"><span class="packt_screen">Lightmaps</span></span>, <span class="ScreenTextPACKT"><span class="packt_screen">Global Illumination</span></span>, <span class="ScreenTextPACKT"><span class="packt_screen">Fog</span></span>, and much more:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/0a6dba89-0bc9-4b8a-ac62-cc7f2b5f3d22.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The Light Explorer panel</h1>
                </header>
            
            <article>
                
<p>When working with <span class="ScreenTextPACKT"><span class="packt_screen">Lights</span></span> and <span class="ScreenTextPACKT"><span class="packt_screen">Lighting</span></span>, a useful tool in Unity is the <span class="ScreenTextPACKT"><span class="packt_screen">Lighting Explorer</span></span> panel, which allows editing and viewing the properties of all of the lights in the current scene. The <span class="packt_screen"><span class="ScreenTextPACKT">Lighting</span> <span class="ScreenTextPACKT">Explorer</span></span> panel lists all <span class="ScreenTextPACKT"><span class="packt_screen">Lights</span></span> in a single panel, making it easy to work with each individually, or change the settings of several at the same time. It can be a great time-saving tool when working with <span class="KeyWordPACKT">scenes</span> involving lots of <span class="ScreenTextPACKT"><span class="packt_screen">Light</span></span> Game Objects.</p>
<p>To display the Light Explorer panel, choose the following menu: <span class="packt_screen">Window</span> | <span class="packt_screen">Rendering</span> | <span class="packt_screen">Light Explorer</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/5ac03c9f-1459-45f7-8197-ae1fdc54c015.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Cucoloris cookies</h1>
                </header>
            
            <article>
                
<p>Lights can have a cookie <strong><span class="KeyWordPACKT">Texture</span></strong> applied. <span class="ScreenTextPACKT"><span class="packt_screen">Cookies</span></span> are <strong><span class="KeyWordPACKT">Textures</span></strong> used to cast shadows or silhouettes in a <strong><span class="KeyWordPACKT">Scene</span></strong>. They are produced by using the cookie <span class="ScreenTextPACKT"><span class="packt_screen">Texture</span></span> as a mask between the light source and the surfaces being rendered. Their name, and usage, comes from the use of physical devices called cucoloris (nicknamed cookies) used in theatre and movie production, to give the shadow effects implying environments such as moving clouds, the bars of a prison window, or the sunlight broken up by a jungle leaf canopy.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Color space (Gamma and Linear)</h1>
                </header>
            
            <article>
                
<p>Unity now offers a choice of two <span class="ScreenTextPACKT"><span class="packt_screen">Color spaces</span></span>: <span class="ScreenTextPACKT"><span class="packt_screen">Gamma</span></span> (the default) and <span class="ScreenTextPACKT"><span class="packt_screen">Linear</span></span>. You can select your desired <span class="ScreenTextPACKT"><span class="packt_screen">Color Space</span></span> via the following menu: <span class="ScreenTextPACKT"><span class="packt_screen">Edit</span></span> | <span class="ScreenTextPACKT"><span class="packt_screen">Project Settings</span></span> | <span class="ScreenTextPACKT"><span class="packt_screen">Player</span></span>. While <span class="ScreenTextPACKT"><span class="packt_screen">Linear</span></span> space has significant advantages, it isn't supported by all hardware (especially mobile systems), so which you choose will depend on which platform you are deploying for.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Further resources</h1>
                </header>
            
            <article>
                
<p>This chapter aims to present you with some of Unity's lighting features, and offer a few tricks with lights and effects. As you work through the recipes in this chapter, you may wish to learn more about this chapter's topics from some of these sources:</p>
<ul>
<li>The Unity lighting manual entry: <a href="https://docs.unity3d.com/Manual/Lighting.html"><span class="URLPACKT">https://docs.unity3d.com/Manual/Lighting.html</span></a></li>
<li>Unity's <strong>Global Illumination</strong> (<strong>GI</strong>) pages:
<ul>
<li><a href="https://docs.unity3d.com/Manual/GIIntro.html"><span class="URLPACKT">https://docs.unity3d.com/Manual/GIIntro.html</span></a></li>
<li><a href="http://docs.unity3d.com/Manual/GlobalIllumination.html"><span class="URLPACKT">http://docs.unity3d.com/Manual/GlobalIllumination.html</span></a></li>
</ul>
</li>
<li>Unity's information about cookie <strong><span class="KeyWordPACKT">Textures</span></strong> can be found at their manual page: <a href="https://docs.unity3d.com/Manual/Cookies.html"><span class="URLPACKT">https://docs.unity3d.com/Manual/Cookies.html</span></a></li>
<li>Another source about Unity and cookie <strong><span class="KeyWordPACKT">Textures</span></strong> is the <em><span class="ItalicsPACKT">CgProgramming WikiBook</span></em> for Unity: <a href="https://en.wikibooks.org/wiki/Cg_Programming/Unity/Cookies"><span class="URLPACKT">https://en.wikibooks.org/wiki/Cg_Programming/Unity/Cookies</span></a></li>
<li>Unity manual about choosing a color space: <a href="https://unity3d.com/learn/tutorials/topics/graphics/choosing-color-space"><span class="URLPACKT">https://unity3d.com/learn/tutorials/topics/graphics/choosing-color-space</span></a></li>
<li>Unity manual about the <span class="ScreenTextPACKT"><span class="packt_screen">Lighting Explorer</span></span> panel: <a href="https://docs.unity3d.com/Manual/LightingExplorer.html"><span class="URLPACKT">https://docs.unity3d.com/Manual/LightingExplorer.html</span></a></li>
<li>About <span class="ScreenTextPACKT"><span class="packt_screen">Linear</span></span> and <span class="ScreenTextPACKT"><span class="packt_screen">Gamma</span></span> lighting workflows: <a href="https://docs.unity3d.com/Manual/LinearRendering-LinearOrGammaWorkflow.html"><span class="URLPACKT">https://docs.unity3d.com/Manual/LinearRendering-LinearOrGammaWorkflow.html</span></a></li>
<li><span class="ItalicsPACKT">LMHPoly</span> article on <span class="ItalicsPACKT">7 tips for better Unity Lighting</span>: <span class="URLPACKT"><a href="https://lmhpoly.com/7-tips-for-better-lighting-in-unity/">https://lmhpoly.com/7-tips-for-better-lighting-in-unity/</a></span></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Directional Light with cookie Texture to simulate a cloudy day</h1>
                </header>
            
            <article>
                
<p>As can be seen in many first-person shooters and survival horror games, lights and shadows can add a great deal of realism to a <strong>S<span class="KeyWordPACKT">cene</span></strong>, helping to create the right atmosphere for the game immensely. In this recipe, we will create a cloudy outdoor environment using cookie <strong><span class="KeyWordPACKT">Textures</span></strong>. <span class="ScreenTextPACKT"><span class="packt_screen">Cookie</span></span> <strong><span class="KeyWordPACKT">Textures</span></strong> work as masks for lights. It functions by adjusting the intensity of the light projection to the cookie texture's alpha channel. This allows for a silhouette effect (just think of the bat signal) or, as in this particular case, subtle variations that give a filtered quality to the lighting.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>If you don't have access to an image editor, or prefer to skip the <strong><span class="KeyWordPACKT">Texture</span></strong> map elaboration in order to focus on the implementation, we have provided the prepared cookie image file <span class="packt_screen">cloudCookie.tga</span>, inside the <kbd>07_01</kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To simulate a cloudy outdoor environment, follow these steps:</p>
<ol>
<li>In your image editor, create a new 512 x 512 pixel image.</li>
<li>Using black as the foreground color and white as the background color, apply the <span class="ScreenTextPACKT"><span class="packt_screen">Clouds</span></span> filter <span>–</span> in Photoshop, choose the following menu: <span class="ScreenTextPACKT"><span class="packt_screen">Filter | Render | Clouds</span></span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/2d798ed3-09b7-469e-944d-e3b5734a00b4.png"/></p>
<div class="packt_infobox">Learning about the <span class="ScreenTextPACKT">Alpha</span> channel is useful, but you could get the same result without it. Skip steps 3 to 7, save your image as <span class="ScreenTextPACKT">cloudCookie.png</span> and, when changing texture type in step 9, leave <span class="ScreenTextPACKT">Alpha</span> from Greyscale checked.</div>
<ol start="3">
<li>Select your entire image and copy it.</li>
<li>Open the Channels window (in Photoshop, this can be done choosing the following menu: <span class="ScreenTextPACKT"><span class="packt_screen">Window | Channels</span></span>.</li>
<li>There should be three channels: <span class="packt_screen"><span class="ScreenTextPACKT">Red</span></span>, <span class="packt_screen"><span class="ScreenTextPACKT">Green</span></span>, and <span class="packt_screen"><span class="ScreenTextPACKT">Blue</span></span>. Create a new channel. This will be the <span class="ScreenTextPACKT"><span class="packt_screen">Alpha</span></span> channel.</li>
<li>In the <span class="packt_screen"><span class="ScreenTextPACKT">Channels</span></span> window, select the <span class="ScreenTextPACKT"><span class="packt_screen">Alpha</span> 1</span> channel and paste your image into it:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/091ede6b-80fd-4f7f-adf1-a43d80bfedd7.png"/></p>
<ol start="7">
<li>Save your image file as <span class="ScreenTextPACKT"><span class="packt_screen">cloudCookie.PSD</span></span> or <span class="ScreenTextPACKT">TGA</span>.</li>
<li>Import your image file to Unity and select it in the <strong><span class="KeyWordPACKT">Project</span></strong> panel.</li>
<li>From the <strong><span class="KeyWordPACKT">Inspector</span></strong>, change its <span class="ScreenTextPACKT"><span class="packt_screen">Texture Type</span></span> to <span class="ScreenTextPACKT"><span class="packt_screen">Cookie</span></span> and its <span class="ScreenTextPACKT"><span class="packt_screen">Light Typ</span>e</span> to <span class="ScreenTextPACKT">Directional</span>. Then, click on <span class="ScreenTextPACKT"><span class="packt_screen">Apply</span></span>, as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/08ab0e68-3598-4d9d-8b16-8cab91722c8f.png"/></p>
<ol start="10">
<li>Let's add a light to our scene. Since we want to simulate sunlight, the best option is to create a <strong><span class="KeyWordPACKT">Directional Light</span></strong>. Choose the <span class="packt_screen">Hierarchy</span> menu: <span class="ScreenTextPACKT"><span class="packt_screen">Create | Light | Directional Light</span></span>.</li>
</ol>
<ol start="11">
<li>We will need a surface to actually see the lighting effect. You can either add a 3D <span class="ScreenTextPACKT">plane</span> to your scene (menu: <span class="ScreenTextPACKT"><span class="packt_screen">GameObject | 3D Object | Plane</span></span>), or create a 3D <span class="ScreenTextPACKT">Terrain</span> (menu: <span class="ScreenTextPACKT"><span class="packt_screen">GameObject | 3D Object | Terrain</span></span>).</li>
<li>In the <span class="KeyWordPACKT">Inspector</span>, reset the light's <span class="ScreenTextPACKT"><span class="packt_screen">Transform Position</span></span> to (<kbd>0, 0, 0</kbd>) and its <span class="ScreenTextPACKT"><span class="packt_screen">Rotation</span></span> to (<kbd>90, 0, 0</kbd>).</li>
<li>In the <span class="ScreenTextPACKT"><span class="packt_screen">Cookie</span></span> field, select the <span class="ScreenTextPACKT"><span class="packt_screen">cloudCookie</span></span> texture that you imported earlier. Change the <span class="ScreenTextPACKT"><span class="packt_screen">Cookie Size</span></span> field to 15, or a value that you feel is more appropriate for the <strong>S<span class="KeyWordPACKT">cene's</span></strong> dimensions. Set the <span class="ScreenTextPACKT"><span class="packt_screen">Shadow Type</span></span> as <span class="ScreenTextPACKT"><span class="packt_screen">No Shadows</span>:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/6dfecb4f-03ad-4dcc-b58b-53a72a383e52.png"/></p>
<ol start="14">
<li>Create a new C# script class named <span class="packt_screen">ShadowMover</span>, and add an instance object as a component to the <strong><span class="ScreenTextPACKT">Directional Light</span></strong>:</li>
</ol>
<pre class="SourceCode" style="padding-left: 60px"> public class ShadowMover : MonoBehaviour {<br/>         public float windSpeedX = 2;<br/>         public float windSpeedZ = 2;<br/> <br/>         private float lightCookieSize;<br/>         private Vector3 startPosition;<br/>         private float limitX;<br/>         private float limitZ;<br/>         private Vector3 windMovement;<br/> <br/>         void Start() {<br/>             startPosition = transform.position;<br/>             lightCookieSize = GetComponent&lt;Light&gt;().cookieSize;<br/>             limitX = Mathf.Abs(startPosition.x) + lightCookieSize;<br/>             limitZ = Mathf.Abs(startPosition.z) + lightCookieSize;<br/>             windMovement = new Vector3(windSpeedX, 0, windSpeedZ);<br/>         }<br/> <br/>         void Update() {<br/>             Vector3 position = transform.position + (Time.deltaTime <br/>             * windMovement);<br/>             position.x = WrapValue(position.x, limitX,     <br/>             startPosition.x);<br/>             position.z = WrapValue(position.z, limitZ,         <br/>             startPosition.z);<br/>             transform.position = position;<br/>         }<br/> <br/>         private float WrapValue(float n, float limit, float  <br/>         startValue) {<br/>             float absoluteValue = Mathf.Abs(n);<br/>             if (absoluteValue &gt; limit)<br/>                 return startValue;<br/>             else<br/>                 return n;<br/>         }<br/>     }</pre>
<ol start="15">
<li>Select the <span class="packt_screen"><span class="ScreenTextPACKT">Direc</span><span class="ScreenTextPACKT">tional Light</span></span>. In the Inspector, change the parameters <span class="ScreenTextPACKT"><span class="packt_screen">Wind Speed X</span></span> and <span class="ScreenTextPACKT">Wind Speed Z</span> to different values.</li>
<li>Play your scene. The shadows will now be moving.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The script class offers two public values for the X- and Z- speeds of movement (simulating wind).</p>
<p>When the scene starts, first, the initial position of the <span class="KeyWordPACKT">Directional Light</span> is stored. Then, the size of the cookie is read from the sibling Light component, and used to calculate maximum X and Z values. Finally, a <span class="ScreenTextPACKT"><span class="packt_screen">Vector3</span></span> is created, for the amount to move our light by in seconds, based on the X and Z window speeds (Y is zero, since we don't need to move the <span class="KeyWordPACKT">Directional Light</span> in the Y axis).</p>
<p>The <kbd><span class="CodeInTextPACKT">WrapValue(...)</span></kbd> method is defined, which returns a value. If the positive value of the first parameter exceeds the second parameter (the limit), then the third parameter (the initial value) is returned. Otherwise, the value of the first parameter is returned. This allows is to ensure that if a value (for example, our X or Z coordinate) goes beyond a limit, we can "wrap" it back to its start value.</p>
<p class="mce-root"/>
<p>The <kbd><span class="CodeInTextPACKT">Update()</span></kbd> method is executed in each frame. The next position for the light is calculated (current position plus the current frame's proportion of the wind speed per second vector). The X and Z values of this new position are set using our <kbd><span class="CodeInTextPACKT">WrapValue(...)</span></kbd> method, so we know that their limit values are not exceeded. Finally, the position of the light is set to this new position, <kbd><span class="CodeInTextPACKT">Vector3</span></kbd>.</p>
<div class="packt_infobox">The reason we are not enabling shadows is because the light angle for the X axis must be 90 degrees (or there will be a noticeable gap when the light resets to the original position). If you want dynamic shadows in your scene, please add a second <strong><span class="KeyWordPACKT">Directional Light</span></strong>.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating and applying a cookie texture to a spotlight</h1>
                </header>
            
            <article>
                
<p>Cookie Textures can work well with Unity <span class="KeyWordPACKT"><strong>Spotlight</strong>s</span> to simulate shadows coming from projectors, windows, and so on. An example of this would be for the bars of a prison window.</p>
<p>In this recipe, we'll create and apply a cookie <strong><span class="KeyWordPACKT">Texture</span></strong> suitable to use with Unity <span class="KeyWordPACKT"><strong>Spotlights</strong>:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/f1e123b2-093a-4a82-8397-0653e9e437d0.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>If you don't have access to an image editor, or prefer to skip the <strong><span class="KeyWordPACKT">Texture</span></strong> map elaboration in order to focus on the implementation, we have provided the prepared cookie image file called <span class="packt_screen">spotCookie.tif</span> inside the <kbd>07_02</kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To create and apply a cookie texture to a spotlight, follow these steps:</p>
<ol>
<li>In your image editor, create a new <span class="packt_screen"><span class="ScreenTextPACKT">512 x 512</span></span> greyscale pixel image.</li>
<li>Ensure that the border is completely black by setting the brush tool color to black and drawing around the four edges of the image. Then, draw some criss-crossed lines. Save your image, naming it <span class="ScreenTextPACKT"><span class="packt_screen">spotCookie</span>:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/a45d26bf-879e-4eaa-aede-eba662c5a63d.png"/></p>
<ol start="3">
<li>Import your image file to Unity and select it in the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel.</li>
</ol>
<ol start="4">
<li>From the Inspector, change its <span class="ScreenTextPACKT"><span class="packt_screen">Texture Type</span></span> to <span class="packt_screen">Cookie</span> and its <span class="ScreenTextPACKT"><span class="packt_screen">Light Type</span></span> to <span class="ScreenTextPACKT">Spotlight</span>, and set the <span class="packt_screen"><span class="ScreenTextPACKT">Alpha Source</span></span> to <span class="packt_screen">From Grayscale</span>. Then, click on <span class="packt_screen">Apply</span>, as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/944c9df7-c815-45f6-ab0b-051b460b5062.png"/></p>
<ol start="5">
<li>Create a <span class="KeyWordPACKT">scene</span> containing the following:
<ul>
<li>A flat <span class="ScreenTextPACKT"><span class="packt_screen">3D</span></span> <span class="packt_screen"><span class="ScreenTextPACKT">Terrain</span></span> or <span class="ScreenTextPACKT"><span class="packt_screen">Plane</span></span> as our ground</li>
<li><span class="ScreenTextPACKT">A <span class="packt_screen">3D</span> <span class="packt_screen">Cube</span></span> or <span class="ScreenTextPACKT"><span class="packt_screen">Plane</span></span>, stretched to act as a wall</li>
<li>Two or three other 3D objects in front of the wall</li>
</ul>
</li>
<li>Position the <strong><span class="KeyWordPACKT">Main Camera</span></strong> to be showing the 3D objects in front of the "wall".</li>
<li>Now, add a <span class="ScreenTextPACKT"><span class="packt_screen">Spotlight</span></span> to the scene by choosing the following menu: <span class="ScreenTextPACKT"><span class="packt_screen">Create | Light | Spotlight</span></span>.</li>
<li>Orient the <span class="ScreenTextPACKT"><span class="packt_screen">Spotlight</span></span> to be pointing in the direction of the <span class="KeyWordPACKT"><strong>Main Camera</strong> </span> <span>–</span> you'll probably have to rotate the Y value by 180 degrees.</li>
<li>Set <span class="ScreenTextPACKT"><span class="packt_screen">Shadow Type</span></span> to <span class="ScreenTextPACKT"><span class="packt_screen">No Shadows</span></span>, and drag your <span class="ScreenTextPACKT"><span class="packt_screen">spotCookie</span></span> <strong><span class="KeyWordPACKT">Texture</span></strong> from the <span class="KeyWordPACKT">Project</span> panel into the <span class="packt_screen"><span class="ScreenTextPACKT">Cookie</span></span> slot.</li>
<li>Play your <span class="packt_screen">S</span><span class="KeyWordPACKT"><span class="packt_screen">cene</span></span>. You should now see the spotlight casting shadows as if a light had been shone through a grid of planks of wood or metal.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>We created a greyscale <span class="KeyWordPACKT">Texture</span> for use with Unity <span class="ScreenTextPACKT"><span class="packt_screen">Spotlights</span></span> <span>–</span> that's completely black around the edges <span>–</span> so that light does not "bleed" around the edge of our <span class="packt_screen">Spotli<span class="ScreenTextPACKT">g</span>ht</span> emission. The black lines in the Texture are used by Unity to create shadows in the light emitted from the <span class="ScreenTextPACKT"><span class="packt_screen">Spotligh</span>,</span> creating the effect that there are some straight beams of wood or metal through which the <span class="ScreenTextPACKT"><span class="packt_screen">Spotlight</span></span> is being shone.</p>
<p class="mce-root"/>
<p>You can learn more about creating <span class="ScreenTextPACKT"><span class="packt_screen">Spotlight</span></span> cookies in Unity at the Unity tutorial page: <a href="http://docs.unity3d.com/Manual/HOWTO-LightCookie.html"><span class="URLPACKT">http://docs.unity3d.com/Manual/HOWTO-LightCookie.html</span></a>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding a custom Reflection map to a scene</h1>
                </header>
            
            <article>
                
<p>Unity's Standard Shader gets its reflection from the scene's Reflection Source, as configured in the scene section of the Lighting window. The level of reflectiveness for each Material is defined by its Metallic value or Specular value, depending on which Shader is being used. This approach can be a real time-saver, allowing you to quickly assign the same reflection map to every object in the scene. It also helps keep the overall look of the scene coherent and cohesive. In this recipe, we will learn how to take advantage of the <span class="packt_screen">Reflection Source</span> feature:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/10c82279-c87a-4a62-a0d6-d9cbcc483828.png" style="width:59.50em;height:28.25em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, we will prepare a <span class="ScreenTextPACKT">Reflection Cubemap</span>, which is basically the environment to be projected as a reflection onto the material. It can be made from either six or, as shown in this recipe, a single image file.</p>
<p>To help us with this recipe, we have provided a Unity package (<span class="packt_screen">batteryPrefab.unitypackage</span>), containing a prefab made of a 3D object and a basic <span class="KeyWordPACKT">Material</span> (using a TIFF as a Diffuse map), and also a JPG file to be used as the reflection map. All of these files are inside the <kbd>07_03</kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To add Reflectiveness and Specularity to a material, follow these steps:</p>
<ol>
<li>Import the <span class="packt_screen">batteryPrefab.unitypackage</span> <span class="ScreenTextPACKT">package in</span>to a new project. Then, select the <span class="ScreenTextPACKT">battery_prefab</span> object from the <span class="ScreenTextPACKT">Assets</span> folder, in the <strong><span class="KeyWordPACKT">Project</span></strong> panel.</li>
<li>From the <span class="KeyWordPACKT">Inspector</span>, expand the <strong><span class="KeyWordPACKT">Material</span></strong> component and observe the asset preview window. Thanks to the <span class="ScreenTextPACKT"><span class="packt_screen">Specular</span></span> map, the material already features a reflective look. However, it looks as if it is reflecting the scene's default <span class="ScreenTextPACKT"><span class="packt_screen">Skybox</span></span>, as shown in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/bb7e8060-e994-4381-a5f5-09fb4a21f8e5.png" style="width:49.92em;height:26.92em;"/></p>
<ol start="3">
<li>Import the <span class="ScreenTextPACKT"><span class="packt_screen">CustomReflection.jpg</span></span> image file. Ensure that this asset is selected in the <span class="KeyWordPACKT">Project</span> panel.</li>
<li>In the <span class="KeyWordPACKT">Inspector</span> for its <span class="ScreenTextPACKT"><span class="packt_screen">Import Settings</span></span>, set the following properties:
<ul>
<li><strong><span class="ScreenTextPACKT">Texture Type</span></strong>: Default</li>
<li><strong><span class="ScreenTextPACKT">Texture Shape</span></strong>: Cube</li>
<li><strong><span class="ScreenTextPACKT">Mapping</span></strong>: Latitude-Longitude Layout (Cylindrical)</li>
<li><strong><span class="ScreenTextPACKT">Convolution Type</span></strong>: None</li>
<li><strong><span class="ScreenTextPACKT">Fixup Edge Seams</span></strong>: Checked</li>
<li><strong><span class="ScreenTextPACKT">Filter Mode</span></strong>: Trilinear</li>
<li>Now, click on the <span class="ScreenTextPACKT"><span class="packt_screen">Apply</span></span> button, as follows:</li>
</ul>
</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/77e0476b-b1f9-434e-b874-07a5da933ff7.png"/></p>
<ol start="5">
<li>Let's replace the <span class="KeyWordPACKT">scene's</span> <span class="ScreenTextPACKT">Skybox</span> with our newly created <span class="ScreenTextPACKT">Cubemap</span> as the <span class="ScreenTextPACKT">Reflection</span> map for our scene (menu: <span class="ScreenTextPACKT"><span class="packt_screen">Window | Rendering | Lighting Settings</span></span>).</li>
</ol>
<ol start="6">
<li>Select the <strong>S<span class="KeyWordPACKT">cene</span></strong> section and use the drop-down menu to change the <span class="ScreenTextPACKT"><span class="packt_screen">Reflection</span></span> <span class="packt_screen">Source</span> to <span class="packt_screen">Custom</span>. Finally, assign the newly created <span class="packt_screen"><span class="ScreenTextPACKT">CustomReflection</span></span> texture as the <span class="ScreenTextPACKT">Cubemap</span>, as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/a3f86985-e065-4875-9955-64ecdf9782db.png"/></p>
<ol start="7">
<li>Check out the new reflections on the <span class="packt_screen"><span class="ScreenTextPACKT">battery_prefab</span></span> object.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The material's specular map provides a reflective look, including the intensity and smoothness of the reflection. However, the image you see in the refection itself is given by the <span class="ScreenTextPACKT"><span class="packt_screen">Cubemap</span></span> that we created.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p><span class="ScreenTextPACKT"><span class="packt_screen">Reflection Cubemaps</span></span> can be achieved in many ways and have different mapping properties.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Mapping coordinates</h1>
                </header>
            
            <article>
                
<p>The <span class="ScreenTextPACKT"><span class="packt_screen">Cylindrical</span></span> mapping that we applied was well-suited for the photograph that we used. However, depending on how the reflection image is generated, a <span class="ScreenTextPACKT"><span class="packt_screen">Cubic</span></span>- or <span class="ScreenTextPACKT"><span class="packt_screen">Spheremap</span></span>-based mapping can be more appropriate. Also, note that the <span class="ScreenTextPACKT"><span class="packt_screen">Fixup Edge</span> Seams</span> option will try to make the image seamless.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Sharp reflections</h1>
                </header>
            
            <article>
                
<p>You might have noticed that the reflection is somewhat blurry compared to the original image; this is because we have ticked the <span class="ScreenTextPACKT"><span class="packt_screen">Glossy Reflections</span></span> box. To get a sharper-looking reflection, deselect this option; in this case, you can also leave the <span class="ScreenTextPACKT"><span class="packt_screen">Filter Mode</span></span> option as <span class="packt_screen">default (<span class="ScreenTextPACKT">Bilinear</span></span>).</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Maximum size</h1>
                </header>
            
            <article>
                
<p>At 512 x 512 pixels, our reflection map will probably run fine on lower-end machines. However, if the quality of the reflection map is not very important in your game's context, and the original image dimensions are big (say, 4,096 x 4,096), you might want to change the texture's <span class="ScreenTextPACKT"><span class="packt_screen">Max Size</span></span> from the <span class="ScreenTextPACKT"><span class="packt_screen">Import Settings</span></span> menu to a lower number.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a laser aim with a projector</h1>
                </header>
            
            <article>
                
<p>Although using UI elements, such as a cross-hair, is a valid way to allow players to aim, replacing (or combining) it with a projected laser dot might be a more interesting approach. In this recipe, we will use a light <span class="KeyWordPACKT">projector</span> to implement this concept:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/8c056206-f8fc-4668-92e3-9449290e9aca.png" style="width:36.58em;height:13.08em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>To help us with this recipe, in the <kbd>07_04</kbd> folder, we've provided a Unity package (<span class="packt_screen">laserAssets.unitypackage</span>) containing a sample scene featuring a character holding a laser pointer, and also a texture map named <span class="ScreenTextPACKT"><span class="packt_screen">LineTexture</span></span>.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To create a laser dot aim with a Projector, follow these steps:</p>
<ol>
<li>Start a new 3D project.</li>
<li>We'll be importing the <span class="packt_screen"><span class="ScreenTextPACKT">Projectors</span></span> components from the <strong><span class="KeyWordPACKT">Unity Standard Assets</span></strong>. If you didn't install the <strong><span class="KeyWordPACKT">Standard Assets</span></strong> when you installed Unity, go the the <strong><span class="KeyWordPACKT">Asset Store</span></strong> and install the free <strong><span class="KeyWordPACKT">Standard Assets</span></strong> now.</li>
<li>Import <kbd><span class="ScreenTextPACKT">laserAssets.unitypackage</span></kbd> into a new project. Then, open the scene named <span class="ScreenTextPACKT"><span class="packt_screen">basic_scene_MsLaser</span></span>. This is a basic scene, featuring a player character in a maze, with standard arrow keys or WASD movement.</li>
<li>Import the <strong><span class="KeyWordPACKT">Projectors</span></strong> contents from the <span class="ScreenTextPACKT">Effects Unity Standard Assets</span> package folder:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/1b104465-fe16-4357-bf92-835121da42c0.png" style="width:36.50em;height:20.75em;"/></p>
<ol start="5">
<li>From the <strong><span class="KeyWordPACKT">Ins</span><span class="KeyWordPACKT">pector</span></strong>, locate the <span class="ScreenTextPACKT"><span class="packt_screen">ProjectorLight</span></span> shader (inside the <span class="ScreenTextPACKT"><span class="packt_screen">Assets | Standard Assets | Effects | Projectors | Shaders</span> folder</span>). Duplicate the file and name the new copy as <span class="ScreenTextPACKT"><span class="packt_screen">ProjectorLaser</span></span>.</li>
<li>Open <span class="ScreenTextPACKT"><span class="packt_screen">ProjectorLaser</span></span>. From the first line of the code, change Shader <kbd>"<span class="CodeInTextPACKT">Projector/Light</span>"</kbd> to Shader <kbd>"<span class="CodeInTextPACKT">Projector/Laser</span>"</kbd>. Then, locate <kbd><span class="CodeInTextPACKT">Blend DstColor One</span></kbd> and change it to <kbd><span class="CodeInTextPACKT">Blend One One</span></kbd>. Save and close the file:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/2b81dbb7-7f13-44a0-89ee-4983dc962b0b.png" style="width:26.33em;height:15.75em;"/></p>
<div class="packt_infobox">The reason for editing the shader for the laser was to make it stronger by changing its blend type to <span class="ScreenTextPACKT">Additive</span>. Shader programming is a complex subject, which is beyond the scope of this book. However, if you want to learn more about it, check out Unity's documentation on the subject, which is available at <a href="http://docs.unity3d.com/Manual/SL-Reference.html"><span class="URLPACKT">http://docs.unity3d.com/Manual/SL-Reference.html</span></a>, and also the book called <em><span class="ItalicsPACKT">Unity Shaders and Effects Cookbook</span></em>, published by <span class="KeyWordPACKT">Packt</span>.</div>
<ol start="7">
<li>Create a new <span class="KeyWordPACKT">material</span> called <span class="ScreenTextPACKT"><span class="packt_screen">m_laser</span></span>. In the <span class="KeyWordPACKT">Inspector</span>, change its <span class="ScreenTextPACKT"><span class="packt_screen">Shader</span></span> to <span class="ScreenTextPACKT"><span class="packt_screen">Projector/Laser</span></span>.</li>
<li>Locate the <span class="packt_screen"><span class="ScreenTextPACKT">Falloff Texture</span></span> in the <strong><span class="KeyWordPACKT">Project</span></strong> panel (inside <span class="ScreenTextPACKT"><span class="packt_screen">Effects | Projectors | Textures</span></span>).</li>
<li>Open it in your image editor and, except for the first and last columns column of pixels, which should be black, paint everything white. Save the changed image file as <span class="ScreenTextPACKT"><span class="packt_screen">Falloff_laser</span></span> and go back to Unity:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/975973c3-39ff-43e4-8bb6-78b4e70dce8b.png" style="width:18.67em;height:5.50em;"/></p>
<ol start="10">
<li>Select the <span class="ScreenTextPACKT"><span class="packt_screen">m_laser</span></span> asset in the <strong><span class="KeyWordPACKT">Project</span></strong> panel. In the <span class="KeyWordPACKT">Inspector,</span> set the <span class="ScreenTextPACKT"><span class="packt_screen">Main Color</span></span> to red (RGB: 255, 0, 0). Then, from the texture slots, drag <strong><span class="KeyWordPACKT">Texture</span></strong> <span class="ScreenTextPACKT"><span class="packt_screen">Light</span></span> into the <span class="ScreenTextPACKT">Cookie</span> slot, and <strong><span class="KeyWordPACKT">Texture</span></strong> <span class="ScreenTextPACKT"><span class="packt_screen">Falloff_laser</span></span> into the <span class="ScreenTextPACKT">Falloff</span> slot (these <strong><span class="KeyWordPACKT">Textures</span></strong> are inside your imported folder, <span class="ScreenTextPACKT"><span class="packt_screen">Effects | Projectors | Textures</span></span>):</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/1c593dac-3b31-443f-8def-b81718501e15.png" style="width:42.50em;height:14.75em;"/></p>
<ol start="11">
<li>From the <strong><span class="KeyWordPACKT">Hier</span><span class="KeyWordPACKT">archy</span></strong>, find and select the <span class="ScreenTextPACKT"><span class="packt_screen">pointerPrefab</span></span> object (<span class="ScreenTextPACKT"><span class="packt_screen">MsLaser | mixamorig:Hips | mixamorig:Spine | mixamorig:Spine1 | mixamorig:Spine2 | mixamorig:RightShoulder | mixamorig:RightArm | mixamorig:RightForeArm | mixamorig:RightHand | pointerPrefab</span></span>). Then, create a new child GameObject (menu: <span class="ScreenTextPACKT"><span class="packt_screen">Create | Create Empty Child</span></span>). Rename this new child <span class="ScreenTextPACKT"><span class="packt_screen">laserProjector</span></span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b5fd3c3e-d3cc-45b6-9685-a3c913efd00b.png" style="width:43.00em;height:22.58em;"/></p>
<ol start="12">
<li>Select the <span class="packt_screen"><span class="ScreenTextPACKT">laserPro</span><span class="ScreenTextPACKT">jector</span></span> object. Then, from the <strong><span class="KeyWordPACKT">Inspector</span></strong>, click the <span class="ScreenTextPACKT"><span class="packt_screen">Add Component</span></span> button and navigate to <span class="ScreenTextPACKT"><span class="packt_screen">Effects</span></span> | <span class="ScreenTextPACKT"><span class="packt_screen">Projector</span></span>. Then, from the new <span class="ScreenTextPACKT"><span class="packt_screen">Projector</span></span> component, set the <span class="ScreenTextPACKT"><span class="packt_screen">Orthographic</span></span> option as true and set <span class="ScreenTextPACKT"><span class="packt_screen">Orthographic Size</span></span> as <kbd>0.1</kbd>. Finally, select <span class="ScreenTextPACKT"><span class="packt_screen">m_laser</span></span> from the <span class="ScreenTextPACKT"><span class="packt_screen">Material</span></span> slot.</li>
<li>Run the <span class="KeyWordPACKT">scene</span>. You will be able to see the laser aim dot.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>In this recipe, the size of the aim dot has been exaggerated. Should you need a more realistic thickness for your laser pointer, change the <span class="ScreenTextPACKT"><span class="packt_screen">Orthographic Size</span></span> of the <strong><span class="KeyWordPACKT">Projector</span></strong> component to something smaller, like 0.025.</p>
<p>The laser aim effect was achieved by using a <span class="packt_screen">P<span class="KeyWordPACKT">rojector</span></span>. A <span class="packt_screen">P<span class="KeyWordPACKT">rojector</span></span> can be used to simulate light, shadows, and more, and is a component that projects a <span class="KeyWordPACKT"><span class="packt_screen">Material</span></span> (and its <span class="KeyWordPACKT"><span class="packt_screen">Texture</span></span>) onto other game objects. By attaching a <span class="KeyWordPACKT">projector</span> to the <span class="ScreenTextPACKT"><span class="packt_screen">laserPointer</span></span> object, we have ensured that it will face the right direction at all times. To get the desired, vibrant look, we edited the projector <span class="KeyWordPACKT"><span class="packt_screen">Material's</span></span> <span class="ScreenTextPACKT"><span class="packt_screen">Shader</span></span> code, making it brighter.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Here are some ways to enhance this recipe.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Limiting the range of the laser with Raycast hit to limit the far clip plane</h1>
                </header>
            
            <article>
                
<p>Our laser target should highlight the first object it hits <span>–</span> it shouldn't go through all of the objects ahead of it. The project's <span class="packt_screen"><span class="ScreenTextPACKT">far clip plane</span></span> defined the distance at which the projector stops. We can use a simple script to fire a Raycast, and use the distance to the first object it hits as a guide for setting this far clip plane:</p>
<pre class="SourceCode">using UnityEngine;<br/> <br/>     public class LaserAim : MonoBehaviour  {<br/>         private Projector projector;<br/>         private float margin = 0.5f;<br/> <br/>         void Start () {<br/>             projector = GetComponent&lt;Projector&gt; ();<br/>         }<br/> <br/>         void Update ()  {<br/>             RaycastHit hit;<br/>             Vector3 forward =         <br/>             transform.TransformDirection(Vector3.forward);<br/> <br/>             if (Physics.Raycast(transform.position, forward, out hit))<br/>                 projector.farClipPlane = hit.distance + margin;<br/>         }<br/>     }</pre>
<p>If the <span class="ScreenTextPACKT"><span class="packt_screen">Raycast</span></span> hits an object, we set the <strong><span class="KeyWordPACKT">Projector</span></strong> <span class="ScreenTextPACKT"><span class="packt_screen">far clip plane</span></span> to that distance, plus a little <span class="ScreenTextPACKT">margin</span> if 0.5 Unity units (for example, it might be a curved surface).</p>
<p>We scripted a way to prevent projections from going through objects, by setting its <span class="ScreenTextPACKT"><span class="packt_screen">far clip plane</span></span> on approximately the same level of the first object that is receiving the projection. The line of code that is responsible for this action is as follows:</p>
<pre>projector.farClipPlane = hit.distance + margin </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<p>Learn more about <span class="KeyWordPACKT">projectors</span> from the Unity manual page: <a href="https://docs.unity3d.com/Manual/class-Projector.html"><span class="URLPACKT">https://docs.unity3d.com/Manual/class-Projector.html</span></a>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Enhancing the laser aim with a Line Renderer</h1>
                </header>
            
            <article>
                
<p>Let's improve the previous recipe by displaying a laser beam from the character's laser gun to the projected laser target. We'll implement the laser beam through scripting a <span class="ScreenTextPACKT"><span class="packt_screen">Line Renderer</span>, which is</span> being redrawn each frame:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/12ea8a77-6e6f-4674-a686-7eb991393261.png" style="width:39.33em;height:12.67em;"/></p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>This recipe ­is based on the previous one, so make a copy of that project and work with its copy. You'll also need a <strong><span class="KeyWordPACKT">Texture</span></strong> for the beam color; one is provided in the <kbd>07_05</kbd> folder called <span class="ScreenTextPACKT"><span class="packt_screen">beam.psd</span></span>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To enhance the laser aim with a <span class="ScreenTextPACKT"><span class="packt_screen">Line Renderer</span></span>, follow these steps:</p>
<ol>
<li>Our <span class="packt_screen"><span class="ScreenTextPACKT">Line Renderer</span></span> will need a <strong><span class="KeyWordPACKT">Material</span></strong> to work with. Create a new <span class="KeyWordPACKT">Material</span> named <span class="packt_screen">m_beam</span>.</li>
<li>In the <strong><span class="KeyWordPACKT">Inspector</span></strong>, set the <span class="packt_screen"><span class="ScreenTextPACKT">Shader</span></span> of the <span class="ScreenTextPACKT"><span class="packt_screen">m_beam</span></span> to <span class="ScreenTextPACKT"><span class="packt_screen">Particles/Additive</span></span>. Also, set its <span class="ScreenTextPACKT">Tint Color</span> to red (<strong>RGB</strong>: <kbd>255;0;0</kbd>).</li>
<li>Import the <span class="ScreenTextPACKT">beam</span> image file. Then, set it as the <span class="ScreenTextPACKT"><span class="packt_screen">Particle</span> <strong>Texture</strong></span> for the <span class="ScreenTextPACKT"><span class="packt_screen">m_beam</span></span>, as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/e1d367f2-f940-403c-a420-42bee06ca636.png"/></p>
<ol start="4">
<li>Create a new C# script class named <span class="ScreenTextPACKT"><span class="packt_screen">LaserBeam</span></span>, and add an instance object as a component to the Game Object's <span class="ScreenTextPACKT">Laser Projector</span>:</li>
</ol>
<pre style="padding-left: 60px">public class LaserBeam : MonoBehaviour  {<br/>     public float lineWidth = 0.2f;<br/>     public Color regularColor = new Color (0.15f, 0, 0, 1);<br/>     public Material beamMaterial;<br/> <br/>     private Vector3 lineEnd;<br/>     private LineRenderer line;<br/> <br/>     void Start () {<br/>         line = gameObject.AddComponent&lt;LineRenderer&gt;();<br/>         line.material = beamMaterial;<br/>         line.material.SetColor("_TintColor", regularColor);<br/>         line.SetVertexCount(2);<br/>         line.SetWidth(lineWidth, lineWidth);<br/>     }<br/> <br/>     void Update () {<br/>         RaycastHit hit;<br/>         Vector3 forward = <br/>         transform.TransformDirection(Vector3.forward);<br/> <br/>         if (Physics.Raycast (transform.position, forward, out hit))<br/>             lineEnd =  hit.point;<br/>         else<br/>             lineEnd = transform.position + forward * 10f;<br/> <br/>         line.SetPosition(0, transform.position);<br/>         line.SetPosition(1, lineEnd);<br/>     }<br/> }</pre>
<ol start="5">
<li>Select the <span class="packt_screen">LaserProjector</span> Game Object. From the <span class="packt_screen">Inspector</span>, find the Laser Beam (Script) component and drag the <span class="packt_screen">m_beam</span> Material from the Project panel into the Beam Material.</li>
<li>Play the scene. The red laser beam should be shining in a line from the laser gun to the first object hit by the beam.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The laser aim effect was achieved by using a dynamic<span class="packt_screen"> <span class="ScreenTextPACKT">Line Renderer</span></span>, which created and updated each frame through code.</p>
<p>In this recipe, the width of the laser beam has been exaggerated. Should you need a more realistic thickness for your beam, change the <span class="ScreenTextPACKT"><span class="packt_screen">Line Width</span></span> field of the <span class="ScreenTextPACKT"><span class="packt_screen">Laser Beam (Script)</span></span> component to 0.05. Also, remember to make the beam more opaque by setting the <span class="ScreenTextPACKT"><span class="packt_screen">Regular Color</span></span> of the <span class="ScreenTextPACKT"><span class="packt_screen">Laser Beam</span></span> component brighter. You'll probably want to match the size of the laser aim <span class="KeyWordPACKT">Projector,</span> too, so set the <span class="ScreenTextPACKT"><span class="packt_screen">Orthographic Size</span></span> of the <strong><span class="KeyWordPACKT">Projector</span></strong> component to something smaller, such as 0.025.</p>
<p>Regarding the <span class="ScreenTextPACKT"><span class="packt_screen">Line Renderer</span></span>, we have opted to create it dynamically, via code, instead of manually adding the component to the game object.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Here are some ways to enhance this recipe.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Changing the beam color when the Fire key is held down</h1>
                </header>
            
            <article>
                
<p>It's always good to provide the player with audio or visual feedback when they do something. So, when the player presses the <em><span class="ItalicsPACKT">Fire</span></em> button (for example, the mouse button) let's change the color of the beam. Do the following:</p>
<ol>
<li>Add a new public variable for the fire beam color:</li>
</ol>
<pre class="SourceCode" style="padding-left: 60px">public Color firingColor = new Color (0.31f, 0, 0, 1);</pre>
<ol start="2">
<li>Add a new method to set up changing a color (using a Sine wave value):</li>
</ol>
<pre class="SourceCode" style="padding-left: 60px">private void SetupColor() {<br/>         float lerpSpeed = Mathf.Sin (Time.time * 10f);<br/>         lerpSpeed = Mathf.Abs(lerpSpeed);<br/>         Color lerpColor = Color.Lerp(regularColor, firingColor, <br/>         lerpSpeed);<br/>         line.material.SetColor("_TintColor", lerpColor);<br/>     }</pre>
<ol start="3">
<li>Add statements at the end of the <kbd><span class="CodeInTextPACKT">Update()</span></kbd> method to detect when the Fire button is pressed/released to trigger a color change:</li>
</ol>
<pre class="SourceCode" style="padding-left: 60px">void Update ()  {<br/>         // … (as before)<br/> <br/>         if(Input.GetButton("Fire1"))<br/>             SetupColor();<br/> <br/>         if(Input.GetButtonUp("Fire1"))<br/>             line.material.SetColor("_TintColor", regularColor);<br/>     }</pre>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up an environment with Procedural Skybox and Directional Light</h1>
                </header>
            
            <article>
                
<p>Besides the traditional <span class="ScreenTextPACKT">six-sided</span> and <span class="ScreenTextPACKT">Cubemap Skyboxes</span>, Unity also features a third type of skybox: the <span class="ScreenTextPACKT">Procedural Skybox</span>. Easy to create and set up, the <span class="ScreenTextPACKT">Procedural Skybox</span> can be used in conjunction with a <span class="KeyWordPACKT">Directional Light</span> to provide <span class="ScreenTextPACKT">Environment Lighting</span> in your scene. In this recipe, we will learn about the different parameters of the <span class="ScreenTextPACKT">Procedural Skybox:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/1ce3efd7-fb5a-4ba9-a8a6-839ab2563b02.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To set up <span class="ScreenTextPACKT"><span class="packt_screen">Environment Lighting</span></span> using the <span class="ScreenTextPACKT"><span class="packt_screen">Procedural Skybox</span></span> and <strong><span class="KeyWordPACKT">Directional Light</span></strong>, follow these steps:</p>
<ol>
<li>Create a new <strong>S<span class="KeyWordPACKT">cene</span></strong> inside a Unity project. Observe that a new <span class="KeyWordPACKT">scene</span> already includes two objects: the <span class="ScreenTextPACKT"><span class="packt_screen">Main Camera</span></span> and a <span class="ScreenTextPACKT"><span class="packt_screen">Directional Light</span></span>.</li>
<li>In the scene, create a <span class="ScreenTextPACKT"><span class="packt_screen">3D Plane</span></span> named <span class="ScreenTextPACKT"><span class="packt_screen">Plane-ground</span></span>; positioned at (<span class="ScreenTextPACKT">0, 0, 0</span>) and scaled to (<kbd><span class="ScreenTextPACKT">20, 20, 20</span></kbd>).</li>
<li>Add some <span class="ScreenTextPACKT"><span class="packt_screen">3D Cubes</span></span> to your scene, like so:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/db1ab526-ed1f-4ee3-8a1a-74d7626c56af.png"/></p>
<ol start="4">
<li>Create a new <strong><span class="KeyWordPACKT">Material</span></strong> asset file named <span class="ScreenTextPACKT"><span class="packt_screen">m_skybox</span></span>. In the <span class="KeyWordPACKT">Inspector</span>, change the <span class="ScreenTextPACKT"><span class="packt_screen">Shader</span></span> from <span class="packt_screen"><span class="ScreenTextPACKT">Standard</span></span> to <span class="ScreenTextPACKT">Skybox/Procedural</span>.</li>
<li>Open the <span class="KeyWordPACKT">Lighting</span> window (<span class="ScreenTextPACKT"><span class="packt_screen">Window | Rendering | Lighting Settings</span></span>), and access the <span class="KeyWordPACKT">scene</span> section. In the <span class="ScreenTextPACKT">Environment Lighting</span> subsection, populate the <span class="ScreenTextPACKT">Skybox</span> slot with the <span class="ScreenTextPACKT">m_skybox</span> <span class="KeyWordPACKT">Material</span>, and the <span class="ScreenTextPACKT">Sun</span> slot with the <span class="KeyWordPACKT">scene's</span> default <span class="KeyWordPACKT">Directional Light</span>. Ensure that the <span class="ScreenTextPACKT">real-time Global Illumination</span> option is checked (from <span class="ScreenTextPACKT"><span class="packt_screen">real-time Lighting</span></span>), and that the <span class="ScreenTextPACKT">Environment Ambient Mode</span> is set to <span class="ScreenTextPACKT">real-time</span>.</li>
<li>From the <strong><span class="KeyWordPACKT">Project</span></strong> panel, select <span class="ScreenTextPACKT"><span class="packt_screen">m_skybox</span></span>. Then, from the <span class="KeyWordPACKT">Inspector</span>, set the <span class="ScreenTextPACKT">Sun Size</span> as 0.05 and the <span class="ScreenTextPACKT">Atmosphere Thickness</span> as 1.4. Experiment by changing the <span class="ScreenTextPACKT">Sky Tint</span> color to RGB: <span class="ScreenTextPACKT">148; 128; 128</span>, and the <span class="ScreenTextPACKT">Ground</span> color to a value that resembles the scene cube floor's color (such as RGB: <span class="ScreenTextPACKT">202; 202; 202</span>). If you feel that the <span class="KeyWordPACKT">scene</span> is too bright, try bringing the <span class="ScreenTextPACKT">Exposure</span> level down to 0.85, as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/bbebd520-8302-4a77-a6bb-b01c3a73b3d9.png"/></p>
<p class="mce-root"/>
<ol start="7">
<li>Select the <span class="KeyWordPACKT">Directional Light</span> and change its <span class="ScreenTextPACKT">Rotation</span> to <span class="ScreenTextPACKT">5, 170, 0</span>. Also ensure that its <span class="ScreenTextPACKT">Light Mode</span> setting is <span class="ScreenTextPACKT">real-time</span> (not <span class="ScreenTextPACKT">baked</span> or <span class="ScreenTextPACKT">Mixed</span>).</li>
<li>Run the <span class="KeyWordPACKT">scene </span> <span>–</span> it should resemble a dawning environment.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Ultimately, the appearance of Unity's native Procedural Skyboxes depends on the five parameters that make them up:</p>
<ul>
<li>Sun size: The size of the bright yellow sun that is drawn onto the Skybox is located according to the Directional Light's Rotation on the X and Y axes.</li>
<li>Atmosphere Thickness: This simulates how dense the atmosphere is for this Skybox. Lower values (less than 1.0) are good for simulating the outer space settings. Moderate values (around 1.0) are suitable for earth-based environments. Values that are slightly above 1.0 can be useful when simulating air pollution and other dramatic settings. Exaggerated values (for example, more than 2.0) can help to illustrate extreme conditions or even alien settings.</li>
<li>Sky Tint: This is the color that is used to tint the Skybox. It is useful for fine-tuning or creating stylized environments.</li>
<li>Ground: This is the color of the ground. It can really affect the Global Illumination of the scene. So, choose a value that is close to the level's terrain and/or geometry (or a neutral one).</li>
<li>Exposure: This determines the amount of light that gets in the Skybox. The higher levels simulate overexposure, while the lower values simulate underexposure.</li>
</ul>
<p>It is important to note that the Skybox appearance will respond to the scene's Directional Light, playing the role of the sun. In this case, rotating the light around its X axis can create dawn and sunset scenarios, whereas rotating it around its Y axis will change the position of the sun, changing the cardinal points of the scene.</p>
<p>Also, regarding the Environment Lighting, note that although we have used the Skybox as the Ambient Source, we could have chosen a Gradient or a single color instead, in which case the scene's illumination wouldn't be attached to the Skybox's appearance.</p>
<p class="mce-root"/>
<p class="mce-root"/>
<p>Finally, also regarding the Environment Lighting, please note that we have set the Ambient GI to real-time. The reason for this was to allow the real-time changes in the GI, promoted by the rotating Directional Light. In case we didn't need these changes at runtime, we could have chosen the baked alternative.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Here are some ways to enhance this recipe.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting and rising the sun through scripted rotation of Directional Light</h1>
                </header>
            
            <article>
                
<p>Let's make things even more interesting by using code to change the rotation of the <span class="KeyWordPACKT">Directional Light. Th</span>is will give a dynamic rising/setting sun effect as our <span class="KeyWordPACKT">scene</span> runs.</p>
<p>Ceate a new C# script class named <span class="ScreenTextPACKT">RotateLight</span>, and add an instance object as a component to the <span class="KeyWordPACKT">Directional Light</span> Game Object:</p>
<pre class="SourceCode" style="padding-left: 60px">using UnityEngine;<br/>     using System.Collections;<br/>     public class RotateLight : MonoBehaviour {<br/>       public float speed = -1.0f;<br/>       void Update () {<br/>         transform.Rotate(Vector3.right * speed * Time.deltaTime);<br/>       }<br/>     }</pre>
<p>Now, when you run the <span class="KeyWordPACKT">scene,</span> you will see the sun rising/setting and the lighting colors changing accordingly.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding a sun flare</h1>
                </header>
            
            <article>
                
<p>Let's add a sun flare effect to our <span class="KeyWordPACKT">scene</span>.</p>
<p>For this step, you will need to import <span class="packt_screen">Unity's <span class="ScreenTextPACKT">Standard Assets</span></span> <span class="ScreenTextPACKT">Effects</span> package, which you should have installed when you installed Unity, but you can also add it to an individual project via the Unity <span class="KeyWordPACKT">Asset Store</span>.</p>
<ol>
<li>Import the <span class="ScreenTextPACKT">Light Flares</span> contents from the <span class="ScreenTextPACKT">Effects</span> Unity <span class="KeyWordPACKT">Standard Assets</span> package folder.</li>
</ol>
<ol start="2">
<li>Select the <span class="KeyWordPACKT"><span class="packt_screen">Directional</span> Light</span>. In the <span class="KeyWordPACKT"><span class="packt_screen">Inspector</span></span>, for the <span class="ScreenTextPACKT">Light</span> component, populate the <span class="ScreenTextPACKT">Flare</span> slot with the <span class="ScreenTextPACKT">sun</span> flare (from the p<span class="KeyWordPACKT">roject</span> panel, the <span class="ScreenTextPACKT"><span class="packt_screen">Effects | Light Flares | Flares</span></span> folder).</li>
<li>From the <span class="KeyWordPACKT">scene</span> section of the <span class="ScreenTextPACKT">Lighting</span> window, find the <span class="ScreenTextPACKT"><span class="packt_screen">Other Settings</span></span> subsection. Then, set <span class="packt_screen"><span class="ScreenTextPACKT">Flare Fade Speed</span></span> to <span class="packt_screen">1</span> and <span class="packt_screen"><span class="ScreenTextPACKT">Flare Strength</span></span> to <span class="packt_screen">0.46</span>, as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/977297a5-2005-4b84-a05b-e6021e33e58e.png"/></p>
<ol start="4">
<li>Play the <span class="KeyWordPACKT">scene</span>. A sun flare effect should have been applied to the <span class="KeyWordPACKT">scene's</span> lighting.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Reflecting surrounding objects with Reflection Probes</h1>
                </header>
            
            <article>
                
<p>If you want your <span class="KeyWordPACKT">scene's</span> environment to be reflected by Game Objects by featuring reflective <span class="KeyWordPACKT">Materials</span> (such as the ones with high <span class="ScreenTextPACKT">Metallic</span> or <span class="ScreenTextPACKT">Specular</span> levels), then you can achieve such an effect by using <span class="ScreenTextPACKT">Reflection Probes</span>. They allow for <span class="KeyWordPACKT">real-time</span>, <span class="ScreenTextPACKT">baked</span>, or even <span class="ScreenTextPACKT">Custom</span> reflections through the use of <span class="ScreenTextPACKT">Cubemaps</span>.</p>
<p><span class="KeyWordPACKT">real-time</span> reflections can be expensive in terms of processing; in which case, you should favor <span class="ScreenTextPACKT">baked</span> reflections, unless it's really necessary to display dynamic objects being reflected (mirror-like objects, for instance). Still, there are some ways <span class="ScreenTextPACKT">real-time</span> reflections can be optimized. In this recipe, we will test three different configurations for reflection probes:</p>
<ul>
<li><span class="KeyWordPACKT">real-time</span> reflections (<span class="ItalicsPACKT">constantly updated)</span></li>
<li><span class="KeyWordPACKT">real-time</span> reflections (<span class="ItalicsPACKT">updated on-demand</span> via scripting)</li>
<li><span class="ScreenTextPACKT">baked</span> reflections (from the <span class="KeyWordPACKT">editor</span>)</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, we have prepared a basic <span class="KeyWordPACKT">scene</span>, featuring three sets of reflective objects: one is constantly moving, one is static, and one moves whenever it is interacted with. The <kbd><span class="ScreenTextPACKT">reflectionProbes.unitypackage</span></kbd> package that is containing the scene can be found inside the <kbd>07_07</kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To reflect the surrounding objects using the <span class="ScreenTextPACKT">Reflection Probes</span>, follow these steps:</p>
<ol start="1">
<li>Import the Unity package <kbd><span class="ScreenTextPACKT">reflectionProbes.unitypackage</span></kbd>. Then, open the <span class="KeyWordPACKT">scene</span> named <span class="ScreenTextPACKT">reflective_objects</span>. This is a basic <span class="KeyWordPACKT">scene</span> featuring three sets of reflective objects.</li>
<li>Ensure that the Quality setting for the project has enabled real-time Reflection Probes. Do this by choosing menu: <span class="packt_screen">Edit | Project Settings | Quality</span>, and ensuring that the<span> real-time Reflection Probes option is checked for the quality setting you wish to use.</span></li>
<li>Play the <span class="KeyWordPACKT">scene</span>. Observe that one of the systems is dynamic, one is static, and one rotates randomly, whenever a key is pressed.</li>
<li>Stop the <span class="KeyWordPACKT">scene</span>.</li>
<li>First, let's create a constantly updated <span class="KeyWordPACKT">real-time</span> <span class="ScreenTextPACKT">Reflection Probe for the</span> scene (menu: <span class="ScreenTextPACKT">C<span class="packt_screen">reate | Light | Reflection Probe</span></span>). Name it <span class="ScreenTextPACKT">ReflectionProbe-real-time</span>.</li>
<li>Make <span class="ScreenTextPACKT">ReflectionProbe-real-time</span> a child of the Game Object <span class="ScreenTextPACKT">System 1 real-time | MainSphere</span>. Then, in the Inspector, set its <span class="ScreenTextPACKT">Transform Position</span> to (<span class="ScreenTextPACKT">0, 0, 0</span>):</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/a3b50102-891d-44f1-875d-145f4d30f154.png"/></p>
<p class="mce-root"/>
<ol start="7">
<li>In the <span class="KeyWordPACKT">Inspector,</span> find the <span class="ScreenTextPACKT">Reflection Probe</span> component. Set the <span class="ScreenTextPACKT">Type</span> as <span class="ScreenTextPACKT">real-time</span>, <span class="ScreenTextPACKT">Refresh Mode</span> as <span class="ScreenTextPACKT">Every Frame,</span> and <span class="ScreenTextPACKT">Time Slicing</span> as <span class="ScreenTextPACKT">No time slicing</span>, as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/c4253593-b2c5-44f6-8e20-c2af70874c7d.png"/></p>
<ol start="8">
<li>Play the <span class="KeyWordPACKT">scene</span>. The reflections on <span class="ScreenTextPACKT">System 1 real-time</span> will now be updated in <span class="KeyWordPACKT">real-time.</span> Stop the <span class="KeyWordPACKT">scene</span>.</li>
<li>Observe that the only object displaying the <span class="KeyWordPACKT">real-time</span> reflections is <span class="ScreenTextPACKT">System 1 real-time | MainSphere</span>. The reason for this is the <span class="ScreenTextPACKT">size</span> of the box of the <span class="ScreenTextPACKT">Reflection Probe</span>. From the <span class="ScreenTextPACKT">Reflection Probe</span> component, change its <span class="ScreenTextPACKT">size</span> to (<span class="ScreenTextPACKT">25, 10, 25</span>). Note that the small red spheres are now affected as well. However, it is important to note that all objects display the same reflection. Since our <span class="ScreenTextPACKT">Reflection Probe's</span> origin is placed at the same location as the <span class="ScreenTextPACKT">MainSphere</span>, all reflective objects will display reflections from that point of view:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/f3446e6a-e0d9-41b8-99e0-bc5164cb79b0.png"/></p>
<p class="mce-root"/>
<ol start="10">
<li>If you want to eliminate the reflection from the reflective objects within the <span class="ScreenTextPACKT">Reflection Probe</span>, such as the small red spheres, select the objects and, from the <span class="ScreenTextPACKT">Mesh Renderer</span> component, set <span class="ScreenTextPACKT">Reflection Probes</span> as <span class="ScreenTextPACKT">Off</span>, as shown in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/ebb2c12a-221a-4f57-83c0-ae8ae69c33ab.png"/></p>
<ol start="11">
<li>Add a new <span class="ScreenTextPACKT">Reflec</span><span class="ScreenTextPACKT">tion Probe</span> to the scene. This time, name it <span class="ScreenTextPACKT">ReflectionProbe-onDemand</span> and make it a child of the <span class="ScreenTextPACKT">System 2 On Demand | MainSphere</span> GameObject. Then, in the <span class="KeyWordPACKT">Inspector,</span> change its t<span class="ScreenTextPACKT">ransform position</span> to (<span class="ScreenTextPACKT">0,0,0</span>).</li>
<li>Now, go to the <span class="ScreenTextPACKT">Reflection Probe</span> component. Set <span class="ScreenTextPACKT">Type</span> as <span class="ScreenTextPACKT">real-time</span>, <span class="ScreenTextPACKT">Refresh Mode</span> as <span class="ScreenTextPACKT">Via scripting</span>, and <span class="ScreenTextPACKT">Time Slicing</span> as <span class="ScreenTextPACKT">Individual faces</span>, as shown in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/8920f18b-65a6-4d85-a52d-b83fb1ca4e72.png"/></p>
<ol start="13">
<li>Create a new C# script class named <span class="ScreenTextPACKT">UpdateProbe</span>, and add an instance object as a component to GameObject <span class="ScreenTextPACKT">ReflectionProbe-onDemand</span>:</li>
</ol>
<pre class="SourceCode" style="padding-left: 60px"> using UnityEngine;<br/> using System.Collections;<br/> <br/> public class UpdateProbe : MonoBehaviour {<br/>    private ReflectionProbe probe;<br/> <br/>    void Awake () {<br/>       probe = GetComponent&lt;ReflectionProbe&gt; ();<br/>       probe.RenderProbe();<br/>    }<br/> <br/>    public void RefreshProbe(){<br/>       probe.RenderProbe();<br/>    }<br/> }</pre>
<ol start="14">
<li>Now, find the script class named <span class="ScreenTextPACKT">RandomRotation</span>, which is attached to the <span class="ScreenTextPACKT">System 2 On Demand | Spheres</span> object, and replace it with the following:</li>
</ol>
<pre class="SourceCode" style="padding-left: 60px">using UnityEngine;<br/> <br/>public class RandomRotation : MonoBehaviour {<br/>   private GameObject probe;<br/>   private UpdateProbe updateProbe;<br/> <br/>   void Awake() {<br/>      probe = GameObject.Find("ReflectionProbe-onDemand");<br/>      updateProbe = probe.GetComponent&lt;UpdateProbe&gt;();<br/>   }<br/> <br/>   void Update () {<br/>      if (Input.anyKeyDown) {<br/>          Vector3 newRotation = transform.eulerAngles;<br/>          newRotation.y = Random.Range(0F, 360F);<br/>          transform.eulerAngles = newRotation;<br/>          updateProbe.RefreshProbe();<br/>      }<br/>   }<br/>}</pre>
<ol start="15">
<li>Save the script and test your <span class="KeyWordPACKT">scene</span>. Observe how the <span class="ScreenTextPACKT">Reflection Probe</span> is updated whenever a key is pressed.</li>
<li>Stop the <span class="KeyWordPACKT">scene</span>. Add a third <span class="ScreenTextPACKT">Reflection Probe</span> to the <span class="KeyWordPACKT">scene</span>. Name it <span class="ScreenTextPACKT">ReflectionProbe-custom</span> and make it a child of the <span class="ScreenTextPACKT">System 3 On Custom | MainSphere</span> GameObject. Then, from the <span class="KeyWordPACKT">Inspector</span>, change its <span class="ScreenTextPACKT">Transform Position</span> to (<span class="ScreenTextPACKT">0,0,0</span>).</li>
</ol>
<ol start="17">
<li>Go to the <span class="ScreenTextPACKT">Reflection Probe</span> component. Set <span class="ScreenTextPACKT">Type</span> as <span class="ScreenTextPACKT">Custom</span> and click on the <span class="ScreenTextPACKT">Bake</span> button, as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/6743b6f1-ab65-40a9-b4fd-1fd00639c0f7.png"/></p>
<ol start="18">
<li>A <span class="ScreenTextPACKT"><span class="packt_screen">Save File</span></span> dialog window will show up. Save the file as <span class="ScreenTextPACKT"><span class="packt_screen">ReflectionProbe-custom-reflectionHDR.exr</span></span>.</li>
</ol>
<ol start="19">
<li>Observe that the reflection map does not include the reflection of red spheres on it. To change this, you have two options: set the <span class="packt_screen"><span class="ScreenTextPACKT">System 3 On Custom | Spheres</span> GameObject</span> (and all its children) as <span class="ScreenTextPACKT"><span class="packt_screen">Reflection Probe Static</span>, like so</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/598c9a68-f0ae-4fb3-8ebc-769daec38cfd.png" style="width:37.67em;height:41.08em;"/></p>
<ol start="20">
<li>Or check the <span class="ScreenTextPACKT"><span class="packt_screen">Dynamic Objects</span></span> option <span class="ScreenTextPACKT"><span class="packt_screen">Reflection Probe</span></span> component of the <span class="ScreenTextPACKT"><span class="packt_screen">ReflectionProbe-custom</span></span> GameObject. Note that with this option, you will also see a reflection of the other two large spheres and their belt of red spheres in the reflection on the <span class="ScreenTextPACKT"><span class="packt_screen">MainSphere</span></span> of <span class="ScreenTextPACKT"><span class="packt_screen">System 3 Custom</span></span>.</li>
</ol>
<ol start="21">
<li>Select GameObject <span class="ScreenTextPACKT"><span class="packt_screen">ReflectionProbe-custom</span></span>, and click the <span class="ScreenTextPACKT"><span class="packt_screen">Bake</span></span> button again. You should now see the reflection of red spheres on it.</li>
<li>If you want your reflection <span class="ScreenTextPACKT"><span class="packt_screen">Cubemap</span></span> to be dynamically baked while you edit your scene, you can set the <span class="ScreenTextPACKT"><span class="packt_screen">Reflection Probe</span> Type</span> to <span class="ScreenTextPACKT">baked</span>, open the <span class="ScreenTextPACKT">Lighting</span> window (menu: <span class="ScreenTextPACKT"><span class="packt_screen">Window | Rendering | Lighting Settings</span></span>), access the <span class="KeyWordPACKT">scene</span> section, and check the <span class="ScreenTextPACKT"><span class="packt_screen">Auto Generate</span></span> option, as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/ec69e6fb-7c18-4432-ba07-5768ab822e07.png"/></p>
<div class="packt_infobox">This mode won't include dynamic objects in the reflection, so be sure to set <span class="ScreenTextPACKT"><span class="packt_screen">System 3 Custom | Spheres</span></span> and <span class="ScreenTextPACKT"><span class="packt_screen">System 3 Custom | MainSphere</span></span> as <span class="ScreenTextPACKT"><span class="packt_screen">Reflection Probe Static</span></span>.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The <span class="ScreenTextPACKT">Reflection Probes</span> element acts like omnidirectional cameras that render <span class="packt_screen"><span class="ScreenTextPACKT">Cubemaps</span></span> and applies them onto the objects within their constraints. When creating <span class="ScreenTextPACKT">Reflection Probes</span>, it's important to be aware of how the different types work:</p>
<ul>
<li><span class="packt_screen"><strong><span class="ScreenTextPACKT">Real-time Reflection Probes</span></strong></span>: <span class="packt_screen"><strong><span class="ScreenTextPACKT">Cubemaps</span></strong></span> are updated at runtime. The <span class="KeyWordPACKT">real-time</span> <span class="ScreenTextPACKT">Reflection Probes</span> have three different <span class="ScreenTextPACKT">Refresh Modes</span>: <span class="ScreenTextPACKT">On Awake</span> (<span class="ScreenTextPACKT">Cubemap</span> is baked once, right before the <span class="KeyWordPACKT">scene</span> starts); <span class="ScreenTextPACKT">Every frame</span> (<span class="ScreenTextPACKT">Cubemap</span> is constantly updated<span class="ScreenTextPACKT">); Via scripting</span> (<span class="ScreenTextPACKT">Cubemap</span> is updated whenever the <span class="ScreenTextPACKT">RenderProbe</span> function is used). Since <span class="ScreenTextPACKT">Cubemaps</span> feature six sides, the <span class="ScreenTextPACKT">Reflection Probes</span> features <span class="ScreenTextPACKT">Time Slicing</span>, so each side can be updated independently. There are three different types of <span class="ScreenTextPACKT">Time Slicing</span>: <span class="ScreenTextPACKT">All Faces at Once</span> (renders all faces at once and calculates mipmaps over 6 frames. It updates the probe in 9 frames); <span class="ScreenTextPACKT">Individual Faces</span> (each face is rendered over a number of frames. It updates the probe in 14 frames. The results can be a bit inaccurate, but it is the least expensive solution in terms of frame rate impact); <span class="ScreenTextPACKT">No Time Slicing</span> (the <span class="ScreenTextPACKT">Probe</span> is rendered and mipmaps are calculated in one frame. It provides high accuracy, but it also the most expensive in terms of frame rate).</li>
<li><span class="packt_screen">baked</span>: <span class="ScreenTextPACKT"><span class="packt_screen">Cubemaps</span></span> are baked when editing the screen. <span class="ScreenTextPACKT">Cubemaps</span> can be either manually or automatically updated, depending on whether the <span class="ScreenTextPACKT">Auto Generation</span> option is checked (it can be found at the <span class="KeyWordPACKT">Scene</span> section of the <span class="ScreenTextPACKT">Lighting Settings</span> window).</li>
<li><span class="ScreenTextPACKT"><span class="packt_screen">Custom</span></span>: The <span class="packt_screen"><span class="ScreenTextPACKT">Custom Reflection Probes</span></span> can be either manually baked from the <span class="KeyWordPACKT">scene</span> (and even include <span class="ScreenTextPACKT">Dynamic</span> objects), or created from a premade <span class="ScreenTextPACKT">Cubemap</span>.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>There are a number of additional settings that can be tweaked, such as Importance, <span class="ScreenTextPACKT">Intensity</span>, <span class="ScreenTextPACKT">Box Projection,</span> <span class="ScreenTextPACKT">Resolution</span>, <span class="ScreenTextPACKT">HDR (Hight Dynamic Range),</span> and so on. For a complete view on each of these settings, we strongly recommend that you read Unity's documentation on the subject, which is available at <a href="http://docs.unity3d.com/Manual/class-ReflectionProbe.html">http://docs.unity3d.com/Manual/class-ReflectionProbe.html</a>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using Material Emission to bake light from a glowing lamp onto scene objects</h1>
                </header>
            
            <article>
                
<p>As well as <span class="ScreenTextPACKT">Lights</span>, other objects can also emit light if their <span class="ScreenTextPACKT">Materials</span> have <span class="ScreenTextPACKT">Emmision</span> properties (such as a <span class="KeyWordPACKT">Texture</span>, and/or tint <span class="ScreenTextPACKT">color</span>). In this recipe we'll create a lamp that glows green via its <span class="ScreenTextPACKT">Emission</span> <span class="KeyWordPACKT">Texture</span>. The lamp and other 3D objects in the <span class="KeyWordPACKT">scene</span> will be baked in order to create a pre-computed <span class="ScreenTextPACKT">Lightmap</span> for the <span class="KeyWordPACKT">scene:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/72bc19b6-ed07-4243-8c82-8c248898838e.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, we have provided a 3D lamp model (<span class="ScreenTextPACKT"><span class="packt_screen">lamp</span></span>), as well as a green <span class="KeyWordPACKT">Texture</span> (<span class="ScreenTextPACKT">lamp_emission</span>) in the <span class="ScreenTextPACKT"><kbd>lamp.unitypackage</kbd> Unity package</span> in the <kbd>07_08</kbd> folder .</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To create a glowing lamp using <span class="KeyWordPACKT">Material Emission</span>, follow these steps:</p>
<ol>
<li>Create a new 3D Project. You should start with a basic <strong>scene</strong> containing a Main Camera and a Directional Light.</li>
<li>Import the Unity package <kbd><span class="ScreenTextPACKT">lamp.unitypackage</span></kbd> containing the 3D lamp model (<span class="ScreenTextPACKT">lamp</span>), as well as a green Texture (<span class="ScreenTextPACKT">lamp_emission</span>).</li>
<li>With the 3D model asset lamp selected in the <span class="KeyWordPACKT">Project</span> panel, in the Inspector, check its <span class="ScreenTextPACKT">Generate</span> <span class="ScreenTextPACKT">Lightmap UVs</span> option, and click on the <span class="ScreenTextPACKT">Apply</span> button to confirm the changes:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b9f09f3a-3ac6-475a-9b55-eb1c5a3aefb2.png"/></p>
<p class="mce-root"/>
<ol start="4">
<li>In the <span class="packt_screen"><span class="KeyWordPACKT">Pro</span><span class="KeyWordPACKT">ject</span></span> panel, select <span class="KeyWordPACKT">Material</span> <span class="ScreenTextPACKT"><span class="packt_screen">m_lamp</span></span>. Check the <span class="ScreenTextPACKT">Emission</span> option, and then assign <span class="KeyWordPACKT">Texture</span> <span class="ScreenTextPACKT"><span class="packt_screen">lamp_emission</span></span> to its <span class="packt_screen"><span class="ScreenTextPACKT">Emission Color</span></span> property. Set the <span class="ScreenTextPACKT">Global Illumination</span> drop-down menu to <span class="ScreenTextPACKT">baked</span>. This will make the lamp object emit a green light that will be baked into the <span class="ScreenTextPACKT">Lightmap:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/25a9c5cc-44c6-4b12-8fcd-87ce395edfe9.png"/></p>
<ol start="5">
<li>Also, for <strong><span class="KeyWordPACKT">Material</span></strong> <span class="ScreenTextPACKT"><span class="packt_screen">m_lamp</span></span>, click the <span class="ScreenTextPACKT"><span class="packt_screen">HDR color</span></span> box, and increase the intensity of this light emitting <span class="KeyWordPACKT">Material</span> to 1 or 2 (this is a value you may wish to play with and "tweak" in order to get your desired settings for a <span class="KeyWordPACKT">scene</span>):</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/3625d0fc-d38f-481b-a77e-ccc329e3a0e7.png"/></p>
<ol start="6">
<li>Add some 3D GameObjects to create a simple 3D scene containing a <span class="ScreenTextPACKT">3D Plane</span> (the ground) and three <span class="ScreenTextPACKT">3D cubes</span>. Position and scale the <span class="ScreenTextPACKT">3D cubes</span> so that there is large one at the back of the <span class="ScreenTextPACKT"><span class="packt_screen">3D Plane</span></span>, a medium sized one in the middle, and a small one in the front.</li>
<li>Now, drag an instance of the 3D <span class="packt_screen">lamp</span> model from the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel into the <span class="ScreenTextPACKT">scene</span>, placing it near the front-most <span class="ScreenTextPACKT">3D cube:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/f30a7637-0f32-4ad2-b990-d92d2f0b533c.png"/></p>
<ol start="8">
<li>You may need to adjust the <span class="packt_screen"><span class="KeyWordPACKT">Main Camera</span></span> position and rotation so that you can see the <span class="ScreenTextPACKT">lamp</span> and the three <span class="ScreenTextPACKT">3D cubes</span> sitting on the <span class="ScreenTextPACKT">3D Plane</span>.</li>
<li>Baked lighting only works for static objects, so, with the exception of the <span class="KeyWordPACKT"><span class="packt_screen">Main Camera</span></span>, select everything in the <span class="KeyWordPACKT"><span class="packt_screen">Hierarchy</span></span> and check the <span class="packt_screen"><span class="ScreenTextPACKT">Static</span></span> option at the top-right of the <span class="packt_screen"><span class="KeyWordPACKT">Inspector</span></span> panel:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/0dffc329-6fdc-4607-a0c6-19a9bddc41a1.png"/></p>
<ol start="10">
<li>Now, select the <span class="packt_screen"><span class="KeyWordPACKT">Directional Light</span></span> in the <span class="packt_screen"><span class="KeyWordPACKT">Hierarchy</span></span> and change its <span class="ScreenTextPACKT"><span class="packt_screen">Light Mode</span></span> drop-down menu property to <span class="ScreenTextPACKT">baked:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/558568d7-d39a-461a-bb3f-867941a07e66.png"/></p>
<ol start="11">
<li>We can now assign the <strong>Directional Light</strong> as an <span class="packt_screen"><span class="ScreenTextPACKT">Environmental Lighting Sun</span> source</span>. Open the <span class="ScreenTextPACKT"><span class="packt_screen">Lighting Settings</span></span> window (choose menu: <span class="ScreenTextPACKT"><span class="packt_screen">Window | Rendering | Lighting Settings</span></span>), and drag the <strong>Directional Light</strong> from the <strong><span class="KeyWordPACKT">Hierarchy</span></strong> into the <span class="ScreenTextPACKT">Sun</span> slot for the <span class="ScreenTextPACKT">scene <span class="packt_screen">Environment</span></span> properties. Also, set the <span class="ScreenTextPACKT"><span class="packt_screen">Environment Lighting Ambient Mode</span></span> drop-down menu to <span class="ScreenTextPACKT">baked</span>. In the <span class="ScreenTextPACKT"><span class="packt_screen">Debug Settings</span></span>, uncheck <span class="ScreenTextPACKT"><span class="packt_screen">Auto Generate</span></span> and click the <span class="packt_screen"><span class="ScreenTextPACKT">Generate Lighting</span></span> button to "bake" the <span class="packt_screen"><span class="ScreenTextPACKT">Ambient</span></span> light and green lamp emission light into the <span class="packt_screen">S<span class="ScreenTextPACKT">cene</span></span><span class="ScreenTextPACKT">:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/7d55fc5d-37d4-4cc4-992f-d8b15ae8ccb2.png"/></p>
<ol start="12">
<li>For a few seconds (depending on the speed of your computer and the complexity of the <span class="KeyWordPACKT">scene</span>), you'll see a progess bar of the <span class="ScreenTextPACKT"><span class="packt_screen">Lightmap</span></span> baking process at the bottom-right of the Unity Editor application window:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/8aae3ffc-2d07-4b23-a377-60ce4cd5b95a.png" style="width:22.67em;height:2.33em;"/></p>
<p class="mce-root"/>
<ol start="13">
<li>Play your <strong>S<span class="KeyWordPACKT">cene</span></strong>. You should see how the <strong>S<span class="KeyWordPACKT">cene</span></strong> objects are lit both by the <span class="KeyWordPACKT"><span class="packt_screen">Directional Light</span></span>, and by the green <span class="KeyWordPACKT">Texture</span> emitted from the lamp.</li>
<li>Change the rotation of the <span class="ScreenTextPACKT"><span class="packt_screen">Directional Light</span></span>, and try setting its <span class="packt_screen"><span class="ScreenTextPACKT">Light</span> <span class="ScreenTextPACKT">Intensity</span></span> and <span class="packt_screen"><span class="ScreenTextPACKT">Indirect</span> <span class="ScreenTextPACKT">Multiplier</span></span> to 0.5. Also, play with the <span class="ScreenTextPACKT">HDR</span> intensity of the <span class="KeyWordPACKT"><span class="packt_screen">Material</span></span> <span class="ScreenTextPACKT"><span class="packt_screen">m_lamp</span></span>, and re-bake the <span class="ScreenTextPACKT">Lightmap </span>to make the lamp emission more emphasized (and the <strong><span class="KeyWordPACKT">Directional Light</span></strong> play a lessor role).</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>You have added an emissive <strong><span class="KeyWordPACKT">Material</span></strong> to a GameObject (the lamp), and baked a <span class="packt_screen">Light<span class="ScreenTextPACKT">m</span>ap</span> based on the static objects in the <strong>S<span class="KeyWordPACKT">cene</span></strong> (which include the <span class="ScreenTextPACKT">lamp</span>, the <strong>Directional Light</strong>, and the <span class="ScreenTextPACKT">3D Plane</span> and <span class="ScreenTextPACKT">cubes</span>). The environment's <span class="ScreenTextPACKT"><span class="packt_screen">Global Illumination</span></span> ambient lighting is sourced from the <span class="ScreenTextPACKT"><span class="packt_screen">Directional Light</span></span> settings.</p>
<p><span class="ScreenTextPACKT"><span class="packt_screen">Lightmaps</span></span> are basically <span class="KeyWordPACKT"><span class="packt_screen">Texture</span></span> maps including <span class="KeyWordPACKT">scene</span> lights/shadows, global illumination, indirect illumination, and objects featuring the <span class="packt_screen"><span class="ScreenTextPACKT">Emissive</span> <span class="KeyWordPACKT">Materials</span></span>. They can be generated automatically or on demand by Unity's lighting engine. However, there are some points that you should pay attention to, such as the following:</p>
<ul>
<li>Set all the non-moving objects and lights to be baked as <span class="ScreenTextPACKT">Static</span></li>
<li>Set the game lights as <span class="packt_screen">B<span class="ScreenTextPACKT">aked</span></span></li>
<li>Set the scene's <span class="ScreenTextPACKT"><span class="packt_screen">Ambient GI</span></span> as <span class="packt_screen">B<span class="ScreenTextPACKT">aked</span></span></li>
<li>Set the <span class="packt_screen"><span class="ScreenTextPACKT">Global Illumination</span></span> option of the emissive materials as <span class="ScreenTextPACKT">baked</span></li>
<li><span class="ScreenTextPACKT"><span class="packt_screen">Generate Light UVs</span></span> for all 3D meshes (specially the imported ones)</li>
<li>Either build the <span class="ScreenTextPACKT"><span class="packt_screen">Lightmaps</span></span> manually from the <span class="ScreenTextPACKT"><span class="packt_screen">Lighting</span></span> <span class="packt_screen"><span class="ScreenTextPACKT">Settings</span></span> window, or check the <span class="packt_screen"><span class="ScreenTextPACKT">Auto</span></span> <span class="ScreenTextPACKT"><span class="packt_screen">Generate</span></span> option</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Lighting a simple scene with Lightmaps and Light Probes</h1>
                </header>
            
            <article>
                
<p><span class="packt_screen"><span class="ScreenTextPACKT">Lightmaps</span></span> are a great alternative to <span class="KeyWordPACKT">real-time</span> lighting, as they can provide the desired look to an environment without being processor-intensive. There is one downside, though <span>–</span> since there is no way of baking <span class="ScreenTextPACKT"><span class="packt_screen">Lightmaps</span></span> onto the <span class="ItalicsPACKT">dynamic</span> objects, the lighting of the important elements of the game (such as player characters themselves) can look artificial, failing to match the intensity of the surrounding area. The solution? <span class="ScreenTextPACKT"><span class="packt_screen">Light Probes</span></span>.</p>
<p class="mce-root"/>
<p><span class="ScreenTextPACKT"><span class="packt_screen">Light Probes</span></span> work by sampling the light intensity over the location that they are placed at. Dynamic objects, once <span class="ScreenTextPACKT"><span class="packt_screen">Light Probe</span></span>-enabled, will be lit according to the interpolation of the nearest probes around them:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/5e09c847-75d9-42bc-859a-3f5c5f281e9f.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, we have prepared a basic Unity package (<span class="packt_screen">rollerballLevel.unitypackage</span>), including a game environment containing emissive lamps (from the previous recipe!), and Game Objects, making a suitable level for a <span class="ScreenTextPACKT"><span class="packt_screen">RollerBall</span></span> game. The Game Objects are static, and the <span class="KeyWordPACKT">Directional Light</span> and <span class="packt_screen">Emissive</span> <span class="ScreenTextPACKT">Material</span> are set to <span class="ScreenTextPACKT">baked</span>, so the <span class="KeyWordPACKT">scene</span> has been set up as a <span class="ScreenTextPACKT">baked <span class="packt_screen">Lightmapped</span></span> <span class="KeyWordPACKT">scene</span>.</p>
<p>The <span class="packt_screen">rollerBallLevel.unitypackage</span> package, containing the <span class="KeyWordPACKT">scene</span>, can be found inside the <kbd>07_09</kbd> folder. You'll also find the two PNG images you need to create the RollerBall Material (<span class="ScreenTextPACKT"><span class="packt_screen">RollerBallAlbedo.png</span></span> and <span class="ScreenTextPACKT"><span class="packt_screen">RollerBallSpecularGloss.png</span></span>).</p>
<div class="packt_infobox">The geometry for this scene was created using <span class="ScreenTextPACKT">ProBuilder</span>, an extension developed by <span class="ScreenTextPACKT">ProCore</span>, which is now free as part of Unity 2018. <span class="ScreenTextPACKT">ProBuilder</span> is a fantastic level design tool that speeds up the design process considerably for both simple and complex level design. You can learn more at <span class="URLPACKT"><a href="http://www.procore3d.com">http://www.procore3d.com</a> and </span><span class="URLPACKT"><a href="https://blogs.unity3d.com/2018/02/15/probuilder-joins-unity-offering-integrated-in-editor-advanced-level-design/">https://blogs.unity3d.com/2018/02/15/probuilder-joins-unity-offering-integrated-in-editor-advanced-level-design/</a>.</span></div>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To reflect the surrounding objects using the <span class="ScreenTextPACKT">Reflection Probes</span>, follow these steps:</p>
<ol>
<li>Import <span class="packt_screen">rollerBallLevel.unitypackage</span> into a new project. Then, open the <span class="KeyWordPACKT">scene</span> named <span class="packt_screen">scene0_level_baked</span>. The scene features a basic environment, with a <span class="KeyWordPACKT">Directional Light</span> and some green emissive lamps.</li>
<li>Import <span class="KeyWordPACKT">Standard Assets</span> into your project. We need three packages, as follows:
<ul>
<li><span class="packt_screen">Cameras</span></li>
<li><span class="packt_screen">Characters</span> (we need the <span class="ScreenTextPACKT">RollerBall</span>, so you can uncheck <span class="packt_screen">FirstPersonCharacter</span> and <span class="packt_screen">ThirdPersonCharacter</span> when importing)</li>
<li><span class="packt_screen">Effects</span> (we just need the <span class="ScreenTextPACKT"><span class="packt_screen">Projectors</span></span> assets, so you can uncheck all other folders apart from that one when importing)</li>
</ul>
</li>
<li>Drag the <span class="ScreenTextPACKT"><span class="packt_screen">RollerBall</span></span> prefab from the <strong><span class="KeyWordPACKT">Project</span></strong> panel (<span class="ScreenTextPACKT"><span class="packt_screen">Standard Assets | Characters | RollerBall | Prefabs</span></span>) into the <span class="KeyWordPACKT">scene</span>.</li>
<li>Drag the <span class="packt_screen">FreeLookCameraRig</span> prefab from the <strong><span class="KeyWordPACKT">Project</span></strong> panel (<span class="packt_screen">S<span class="ScreenTextPACKT">tandard Assets | Cameras | Prefabs</span></span>) into the <span class="KeyWordPACKT">scene</span>. If this does not automatically target the <span class="packt_screen">RollerBall</span> character, then drag the <span class="packt_screen">RollerBall</span> Game Object from the <strong><span class="KeyWordPACKT">Hierarchy</span></strong> into the <span class="packt_screen"><span class="ScreenTextPACKT">Free Look Cam (Script)</span> <span class="ScreenTextPACKT">Target</span></span> slot in the <strong><span class="KeyWordPACKT">Inspector</span></strong>.</li>
<li>Let's add a little color to our <span class="packt_screen">RollerBal</span><span class="packt_screen">l</span> by creating and applying a new <strong><span class="KeyWordPACKT">Material</span></strong> for this GameObject. Create a new <span class="KeyWordPACKT"><span class="packt_screen">Material</span></span> <span class="packt_screen">m<span class="ScreenTextPACKT">_rollerballColor</span></span> with a <span class="ScreenTextPACKT"><span class="packt_screen">Specular</span></span> setup. Set the <span class="packt_screen">Albedo</span> <span class="ScreenTextPACKT"><span class="packt_screen">Texture</span></span> to <span class="packt_screen">RollerBallAlbedo</span> and its tint to <span class="ScreenTextPACKT">127/127/127</span>. Set the <span class="packt_screen">Specular</span> <span class="ScreenTextPACKT">Texture</span> to <span class="packt_screen">RollerBallSpecularGloss</span>.</li>
<li>Select Game Object <span class="packt_screen"><span class="ScreenTextPACKT">RollerBall</span></span> in the <strong><span class="KeyWordPACKT">Hierarchy</span></strong>. Apply <span class="KeyWordPACKT">the</span> <span class="packt_screen"><span class="ScreenTextPACKT">m_rollerballColor</span> </span><strong>Material</strong> to the <span class="packt_screen"><span class="ScreenTextPACKT">RollerBall</span></span> Game Object. This should now be a two-colored ball.</li>
</ol>
<ol start="7">
<li>We now need to ensure that the <span class="packt_screen"><span class="ScreenTextPACKT">RollerBall</span></span> GameObject will be dynamically affected by <span class="packt_screen"><span class="ScreenTextPACKT">Light Probes</span></span>, so with Game Object <span class="ScreenTextPACKT"><span class="packt_screen">RollerBall</span></span> still selected in the <span class="KeyWordPACKT"><span class="packt_screen">Hierarchy</span></span>, for the <span class="ScreenTextPACKT"><span class="packt_screen">Mesh Renderer</span></span> component for the <span class="ScreenTextPACKT"><span class="packt_screen">Light Probes</span></span> option, choose the <span class="ScreenTextPACKT"><span class="packt_screen">Blend Probes</span> option from the drop-down menu:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/d3b17fbc-c1d1-409a-b690-745e2db1ad2c.png"/></p>
<ol start="8">
<li>Now, we need to create the <span class="ScreenTextPACKT"><span class="packt_screen">Light Probes</span></span> for the <span class="KeyWordPACKT">scene</span>. Choose the <span class="KeyWordPACKT">Hierarchy</span> menu: <span class="packt_screen"><span class="ScreenTextPACKT">Create | Light | Light Probe</span> Group</span>. This will give you a basic group of eight Light Probes, arranged in pairs to form a cubic volume.</li>
</ol>
<div class="packt_infobox">It is important to note that even if you are working on a level that is flat, you shouldn't place all your probes on the same level, as <span class="ScreenTextPACKT">Light Probe Groups</span> will form a volume in order for the interpolation to be calculated correctly.</div>
<ol start="9">
<li>To facilitate the manipulation of the probes, type <strong><span class="KeyWordPACKT">Probe</span></strong> into the search field of the <span class="ScreenTextPACKT"><span class="packt_screen">Hierarchy</span></span> panel. This will isolate the newly created <span class="ScreenTextPACKT"><span class="packt_screen">Light Probe Group</span></span>, making it the only editable object on the scene:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/d1cc991c-8776-40d9-ba91-193396c50b6e.png"/></p>
<ol start="10">
<li>Change your viewport layout to <span class="packt_screen"><span class="ScreenTextPACKT">4 Split</span></span> by choosing <span class="ScreenTextPACKT"><span class="packt_screen">Window | Layouts | 4 Split</span></span>. Then, set viewports as <span class="ScreenTextPACKT"><span class="packt_screen">Top</span></span>, <span class="ScreenTextPACKT"><span class="packt_screen">Front</span></span>, <span class="ScreenTextPACKT"><span class="packt_screen">Right</span></span>, and <span class="ScreenTextPACKT"><span class="packt_screen">Persp</span></span>. Optionally, change <span class="ScreenTextPACKT"><span class="packt_screen">Top</span></span>, <span class="ScreenTextPACKT"><span class="packt_screen">Front</span>,</span> and <span class="packt_screen"><span class="ScreenTextPACKT">Right</span></span> views to <span class="packt_screen"><span class="ScreenTextPACKT">Wireframe</span></span> mode. Finally, make sure that they are set to <span class="KeyWordPACKT"><span class="packt_screen">Orthographic</span></span> view, as shown in the following screenshot. This will make it easier for you to position the <span class="ScreenTextPACKT"><span class="packt_screen">Light Probes</span>:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/d470e30f-9659-4ce5-9704-84340d157293.png"/></p>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<ol start="11">
<li>Position the initial <span class="ScreenTextPACKT"><span class="packt_screen">Light Probes</span></span> at the corners of the top room of the level. To move the <span class="packt_screen"><span class="ScreenTextPACKT">Probes</span></span> around, simply click and drag them, as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/333f2e3e-1ed4-47a6-a342-6d0b3eb9a8f6.png"/></p>
<ol start="12">
<li>Select the four probes to the left side of the tunnel's entrance. Then, duplicate them (use the <span class="KeyPACKT"><em>Ctrl/Cmd + D</em> keys</span>). Finally, drag the new probes slightly to the right, to a point that they are no longer over the shadow that is projected by the wall, as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/2ed9c4e6-67cb-4df5-b159-c45bb722c52f.png"/></p>
<p class="mce-root"/>
<ol start="13">
<li>Repeat the last step, this time duplicating the probes next to the tunnel's entrance and bringing them inward toward the group. To delete the selected probes, either use the respective button on the <span class="packt_screen"><span class="ScreenTextPACKT">Light Probe Group</span></span> component, or use the <em><span class="KeyPACKT">Ctrl/Cmd +</span> <span class="KeyPACKT">Backspace</span></em> keys:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/7704c28b-874e-4a22-b873-f34c77a2fc43.png"/></p>
<ol start="14">
<li>Duplicate and reposition the four probes that are nearest to the tunnel, repeating the operation five times and conforming each duplicate set to the shadow projected by the tunnel:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/8beb8aca-bcf0-4409-9a45-5b45aa6295dd.png"/></p>
<p class="mce-root"/>
<ol start="15">
<li>Use the <span class="packt_screen"><span class="ScreenTextPACKT">Add P</span><span class="ScreenTextPACKT">robe</span></span> button to place the three probes over well-lit areas of the <span class="KeyWordPACKT">scene:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/beaef73f-b81e-416b-967f-005384f857ab.png"/></p>
<ol start="16">
<li>Now, add <span class="packt_screen"><span class="ScreenTextPACKT">Light</span> <span class="ScreenTextPACKT">Probes</span></span> within the shadow that is projected by the L-shaped wall:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/6093f2df-5778-4305-9047-51375d48c138.png"/></p>
<ol start="17">
<li>Since the <span class="packt_screen"><span class="ScreenTextPACKT">Rolle</span><span class="ScreenTextPACKT">rball</span></span> is able to jump, place the higher probes even higher so that they will sample the lighting above the shadowed areas of the scene:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/6805e6ad-fca4-41f2-9abd-9cd5f466332a.png" style="width:31.33em;height:13.92em;"/></p>
<ol start="18">
<li>Placing too many <span class="ScreenTextPACKT"><span class="packt_screen">Light Probes</span></span> on a scene might be memory intensive. Try optimizing the <span class="packt_screen"><span class="ScreenTextPACKT">Light</span> <span class="ScreenTextPACKT">Probes Group</span></span> by removing the probes from the regions that the player won't have access to. Also, avoid overcrowding the regions of continuous lighting conditions by removing the probes that are too close to others in the same lighting condition:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/bc5888fa-5610-42cc-a2db-84aed4342886.png" style="width:33.75em;height:28.83em;"/></p>
<ol start="19">
<li>To check out which <span class="ScreenTextPACKT"><span class="packt_screen">Light Probes</span></span> are influencing the <span class="ScreenTextPACKT"><span class="packt_screen">Rollerball</span></span> at any place, move the <span class="ScreenTextPACKT"><span class="packt_screen">Rollerball</span></span> Game Object around the scene. A polyhedron will indicate which probes are being interpolated at that position, as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/99f89ca1-7468-4067-a51c-29e931c04614.png"/></p>
<ol start="20">
<li>From the bottom of the <span class="packt_screen"><span class="ScreenTextPACKT">Lighting</span> <span class="ScreenTextPACKT">Settings</span></span> window, click on the <span class="ScreenTextPACKT"><span class="packt_screen">Generate</span> <span class="packt_screen">Lighting</span></span> button and wait for the <span class="ScreenTextPACKT"><span class="packt_screen">Lightmaps</span></span> to be baked.</li>
<li>Test the scene. The <span class="ScreenTextPACKT"><span class="packt_screen">Rollerball</span></span> will be lit according to the <span class="ScreenTextPACKT"><span class="packt_screen">Light Probes</span>:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/f115318f-ebc8-4883-ae64-8b64b081a35d.png" style="width:43.58em;height:17.50em;"/></p>
<ol start="22">
<li>Keep adding probes until the level is completely covered.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p><span class="ScreenTextPACKT"><span class="packt_screen">Light Probes</span></span> work by sampling the scene's illumination at the point that they're placed at. A dynamic object that has Use <span class="ScreenTextPACKT"><span class="packt_screen">Light Probes</span></span> enabled has its lighting determined by the interpolation between the lighting values of the four <span class="ScreenTextPACKT"><span class="packt_screen">Light Probes</span>,</span> defining a volume around it (or, in case there are no probes suited to define a volume around the dynamic object, a triangulation between the nearest probes is used).</p>
<p>More information on this subject can be found in the Unity's documentation at <span class="URLPACKT"><a href="http://docs.unity3d.com/Manual/LightProbes.html">http://docs.unity3d.com/Manual/LightProbes.html</a>.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>In case you can spare some processing power, you can exchange the use of Light probes for a Mixed light.</p>
<p>Do the following:</p>
<ol>
<li>Delete the <span class="ScreenTextPACKT"><span class="packt_screen">Light Probe Group</span></span> from your scene.</li>
<li>Select the <strong><span class="KeyWordPACKT">Directional Light</span></strong> and, from the <span class="ScreenTextPACKT"><span class="packt_screen">Light</span></span> component, change <span class="ScreenTextPACKT"><span class="packt_screen">Baking</span></span> to <span class="ScreenTextPACKT">Mixed</span>.</li>
<li>Set <span class="ScreenTextPACKT"><span class="packt_screen">Shadow</span> Type</span> as <span class="ScreenTextPACKT"><span class="packt_screen">Soft Shadows</span></span> and <span class="ScreenTextPACKT"><span class="packt_screen">Strength</span></span> as 0.5, as shown in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/9e3fd18f-9612-4bfc-8122-87001918ac49.png" style="width:41.25em;height:17.58em;"/></p>
<ol start="4">
<li>Finally, click on the <span class="ScreenTextPACKT"><span class="packt_screen">Generate Lighting</span></span> button and wait for the <span class="ScreenTextPACKT"><span class="packt_screen">Lightmaps</span></span> to be baked. The <strong>R<span class="KeyWordPACKT">eal-Time</span></strong> light/shadows will be cast into/from the dynamic objects, such as <span class="ScreenTextPACKT"><span class="packt_screen">Rollerball</span></span>.</li>
</ol>


            </article>

            
        </section>
    </body></html>