<html><head></head><body>
		<div><h1 id="_idParaDest-221" class="chapter-number"><a id="_idTextAnchor330"/>11</h1>
			<h1 id="_idParaDest-222"><a id="_idTextAnchor331"/>Debugging WinUI Applications with Visual Studio</h1>
			<p>Good debugging skills are essential for developers. While .NET developers need to know how to use features including breakpoints and the <strong class="bold">Output</strong> and <strong class="bold">Immediate</strong> windows, WinUI project debugging adds another set of tools and techniques to master. There are issues that can arise in the UI layer with data binding, layout, and resources. You will learn how to use <strong class="bold">Live Visual Tree</strong> and <strong class="bold">Live Property Explorer</strong> and how to discover data binding errors with Visual Studio’s <strong class="bold">XAML Binding </strong><strong class="bold">Failures</strong> window.</p>
			<p>In this chapter, we will cover the following topics:</p>
			<ul>
				<li>How to debug WinUI applications and work with breakpoints in ViewModels and service classes</li>
				<li>How to debug data binding failures by leveraging the <strong class="bold">XAML Binding Failures</strong> window in Visual Studio and avoid common problems when binding to collections</li>
				<li>Explore the <strong class="bold">Live Visual Tree</strong> window in Visual Studio to find layout problems in your XAML</li>
				<li>Discover and use <strong class="bold">Live Property Explorer</strong> to get and set data in your XAML elements at runtime</li>
			</ul>
			<p>By the end of this chapter, you will be comfortable with debugging common problems typically encountered by WinUI developers while developing applications. You’ll be able to use these skills while building applications with other XAML frameworks, such as .NET MAUI, WPF, and UWP, too.</p>
			<h1 id="_idParaDest-223"><a id="_idTextAnchor332"/>Technical requirements</h1>
			<p>To follow along with the examples in this chapter, the following software is required:</p>
			<ul>
				<li>Windows 10 version 1809 (build 17763) or newer or Windows 11</li>
				<li>Visual Studio 2022 or later with the .NET Desktop Development workload configured for Windows App SDK development</li>
			</ul>
			<p>The source code for this chapter is available on GitHub at this URL: <a href="https://github.com/PacktPublishing/Learn-WinUI-3-Second-Edition/tree/master/Chapter11">https://github.com/PacktPublishing/Learn-WinUI-3-Second-Edition/tree/master/Chapter11</a>.</p>
			<h1 id="_idParaDest-224"><a id="_idTextAnchor333"/><a id="_idTextAnchor334"/>Debugging in Visual Studio</h1>
			<p>There are <a id="_idTextAnchor335"/>several fundamental areas of debugging WinUI applications that <a id="_idTextAnchor336"/>we will be covering in this section. Some of these techniques are applicable to debugging other types of .NET applications, whereas others are specific to XAML and WinUI development. Throughout the book, we’ve run our projects with Visual Studio, which is an example of a local debugging<a id="_idIndexMarker789"/> session. We will explore other ways to debug local applications as well as remote applications.</p>
			<p>Simple mistakes in XAML markup are not always apparent when we’re writing it, and this kind of problem is not detected by the compiler. In this section, we will see how to detect and avoid XAML markup issues and how to adhere to best practices.</p>
			<p>Let’s get started by taking a closer look at debugging local applications.<a id="_idTextAnchor337"/><a id="_idTextAnchor338"/></p>
			<h2 id="_idParaDest-225"><a id="_idTextAnchor339"/>Debugging local applications</h2>
			<p>Open the <strong class="bold">Ch11-MyMediaCollection</strong> project<a id="_idTextAnchor340"/> from GitHub and compile it to make sure you have<a id="_idIndexMarker790"/> downloaded all the referenced NuGet packages. This is the <a id="_idIndexMarker791"/>WinUI 3 project that we’ve been building throughout the previous chapters. Run the application to make sure everything works as expected.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">If you have experience in developing and debugging WPF or UWP applications, you’re probably familiar<a id="_idIndexMarker792"/> with <strong class="bold">XAML Designer</strong> in Visual Studio. There is no designer support for WinUI 3 applications at this time. It’s unclear if or when this feature will be added. There is some discussion on GitHub about this topic here: <a href="https://github.com/microsoft/microsoft-ui-xaml/issues/5917">https://github.com/microsoft/microsoft-ui-xaml/issues/5917</a>. As one of the comments in the issue suggests, you can try to work around this limitation by leveraging <strong class="bold">XAML Hot Reload</strong> in <a id="_idIndexMarker793"/>Visual Studio to make changes to the XAML file while debugging. While there are some limitations to this approach (see <a href="https://github.com/microsoft/microsoft-ui-xaml/issues/7043">https://github.com/microsoft/microsoft-ui-xaml/issues/7043</a>), most simple XAML changes will be reflected in the running app when saving. For more information about XAML Hot Reload, see the <a id="_idIndexMarker794"/>Microsoft Learn documentation: <a href="https://learn.microsoft.com/visualstudio/xaml-tools/xaml-hot-reload">https://learn.microsoft.com/visualstudio/xaml-tools/xaml-hot-reload</a>.</p>
			<p>For our <a id="_idTextAnchor341"/>first walk-through, let’s look at how to debug a local application installed on your PC.</p>
			<h3>Debugging a locally installed application</h3>
			<p>We have been runnin<a id="_idTextAnchor342"/>g and <a id="_idIndexMarker795"/>debugging our Visual Studio solutions <a id="_idIndexMarker796"/>throughout this book. Now we will see how you can debug an application that you have already installed in Windows.</p>
			<p>You have previously run several projects while reading this book. Unless you uninstalled them, each should appear as an installed app package that you can debug. Let’s start with the steps:</p>
			<ol>
				<li>Start by selecting <strong class="bold">Debug</strong> | <strong class="bold">Other Debug Targets</strong> | <strong class="bold">Debug Installed App Package</strong> in Visual Studio. The <strong class="bold">Debug Installed App Package</strong> window will appear:</li>
			</ol>
			<div><div><img src="img/B20908_11_01.jpg" alt="Figure 11.1 – The Debug Installed App Package window"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.1 – The Debug Installed App Package window</p>
			<p class="list-inset">This <a id="_idIndexMarker797"/>wind<a id="_idTextAnchor343"/>ow will show all the installed<a id="_idIndexMarker798"/> packages on your Windows PC. Some names will be familiar, such as <strong class="bold">Microsoft.WindowsTerminal</strong>, <strong class="bold">Fluent XAML Theme Editor</strong>, or <strong class="bold">Microsoft Defender</strong>. Others will only be listed by their application ID. You can select some of these other applications to debug, but without debug symbols, you won’t be able to hit any breakpoints or step through the code. Let’s find one of our applications.</p>
			<ol>
				<li value="2">If you have debugged the <code>MyMediaCollection</code>. The <strong class="bold">MyMediaCollection</strong> application will appear in the search results. If you do not see it, make sure you have run the application from Visual Studio at least once. This step is necessary to package and deploy the application to Windows.</li>
				<li>Select it and click <strong class="bold">Start</strong>. The application will run, and Visual Studio will start debugging.<p class="list-inset">If you don’t want<a id="_idIndexMarker799"/> to start debugging <a id="_idIndexMarker800"/>immediately, you can select the <strong class="bold">Do not launch, but debug my code when it starts</strong> checkbox. Now, Visual Studio <a id="_idTextAnchor344"/>will start debugging when you start the application from the <strong class="bold">Start</strong> menu or any other method.</p></li>
			</ol>
			<p>Another way to start debugging an installed local application is by attaching it to a running application:</p>
			<ol>
				<li>First, run the app from the <strong class="bold">Start</strong> menu, and in Visual Studio, go to <strong class="bold">Debug</strong> |<strong class="bold"> Attach </strong><strong class="bold">to Process</strong>.</li>
				<li>In the <code>ApplicationFrameHost.exe</code> process with the title that matches the application you want to debug. This is the process that hosts every packaged WinUI and UWP application on<a id="_idTextAnchor345"/> Windows:</li>
			</ol>
			<div><div><img src="img/B20908_11_02.jpg" alt="Figure 11.2 – Attaching to a running process to debug a packaged application"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.2 – Attaching to a running process to debug a packaged application</p>
			<ol>
				<li value="3">Click <strong class="bold">Attach</strong> <a id="_idTextAnchor346"/>and <a id="_idIndexMarker801"/>begin<a id="_idIndexMarker802"/> debugging as usual.</li>
			</ol>
			<p>These are different ways to start a debugging session on a local application, but what if you want to debug your application running on another machine? Let’s examine those op<a id="_idTextAnchor347"/><a id="_idTextAnchor348"/>tions next.</p>
			<h2 id="_idParaDest-226"><a id="_idTextAnchor349"/>Debugging remote applications</h2>
			<p>The<a id="_idTextAnchor350"/>re are many reasons <a id="_idIndexMarker803"/>why you might want to debug an application on a<a id="_idIndexMarker804"/> remote machine. Sometimes you can only reproduce an error on one device. Perhaps there is an issue that only occurs on a specific device type or screen size. If you were working with a UWP project, there are some devices, such as Xbox, where you have to use remote debugging.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Before starting any remote debugging session, ensure that the target device has <strong class="bold">developer mode</strong> enabled. For more information about activating developer mode, you can read t<a id="_idTextAnchor351"/>his Microsoft Docs article: <a href="https://learn.microsoft.com/windows/apps/get-started/enable-your-device-for-development">https://learn.microsoft.com/windows/apps/get-started/enable-your-device-for-development</a>.</p>
			<p>To debug a <a id="_idIndexMarker805"/>remote installed application, you will use Visual <a id="_idIndexMarker806"/>Studio’s <strong class="bold">Debug Installed App Package</strong> window <a id="_idTextAnchor352"/>again:</p>
			<ol>
				<li>Open the window from <strong class="bold">Debug</strong> | <strong class="bold">Other Debug Targets</strong> | <strong class="bold">Debug Installed </strong><strong class="bold">App Package</strong>.</li>
				<li>Change <strong class="bold">Connection Type</strong> to <strong class="bold">R<a id="_idTextAnchor353"/>emote Machine</strong>:</li>
			</ol>
			<div><div><img src="img/B20908_11_03.jpg" alt="Figure 11.3 – Debugging an application package on a remote machine"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.3 – Debugging an application package on a remote machine</p>
			<ol>
				<li value="3">Click <a id="_idIndexMarker807"/>the <strong class="bold">Change</strong> button in the <strong class="bold">Connection Type</strong> section to<a id="_idIndexMarker808"/> open the <strong class="bold">Remote </strong><strong class="bold">Connections</strong> window.</li>
				<li>Visual Studio will attempt to discover other Windows devices and list them in the <strong class="bold">Auto Detected</strong> section. If you see the device you want, select it to continu<a id="_idTextAnchor354"/>e. If the device you want to debug isn’t shown, enter its IP address in the <strong class="bold">Address</strong> field in the <strong class="bold">Manual Configuration</strong> section an<a id="_idTextAnchor355"/>d click <strong class="bold">Select</strong>:</li>
			</ol>
			<div><div><img src="img/B20908_11_04.jpg" alt="Figure 11.4 – Enter a manually configured remote connection for debugging"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.4 – Enter a manually configured remote connection for debugging</p>
			<ol>
				<li value="5">When you<a id="_idIndexMarker809"/> return to the previous window, you can select <a id="_idIndexMarker810"/>the application to debug from the list of installed app packages on the selected device.</li>
				<li>Click <strong class="bold">Start</strong> to begin debugging, just as we did with the locally installed application in the previous section.</li>
			</ol>
			<p>These<a id="_idIndexMarker811"/> techniques will allow you to connect to other <a id="_idIndexMarker812"/>Windows machines. For UWP applications, this includes other device types, such as Xbox, HoloLens, Surface Hub, and Windows IoT devices. Debugging options and resources can also be accessed from the <strong class="bold">Debug</strong> tab of the project’s <strong class="bold">Properties</strong> page. Select <strong class="bold">Open debug launch profiles UI</strong> to open the <strong class="bold">Launch </strong><strong class="bold">Profiles</strong> window:</p>
			<div><div><img src="img/B20908_11_05.jpg" alt="Figure 11.5 – The Launch Profiles window in Visual Studio"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.5 – The Launch Profiles window in Visual Studio</p>
			<p>Let’s shift gears and examine some common mistakes that can cause rendering issues in your<a id="_idTextAnchor356"/> application’s UI.</p>
			<h2 id="_idParaDest-227"><a id="_idTextAnchor357"/>Common XAML layout mistakes</h2>
			<p>There<a id="_idTextAnchor358"/> are many kinds of <a id="_idIndexMarker813"/>mistakes that XAML developers can make while coding the UI. Some of them won’t be caught by the compiler. If you have a syntax error or an invalid <code>x:Bind</code> expression, these will fail while compiling, but many other issues will not.</p>
			<p>The first source of common XAML layout mistakes we will explore is the <code>Grid</code> control.</p>
			<h3>Grid layout issues</h3>
			<p>Some mistakes <a id="_idIndexMarker814"/>related to the <code>Grid</code> control revolve around its rows and columns. Forgetting to set <code>Grid.Row</code> or <code>Grid.Column</code> on chi<a id="_idTextAnchor359"/>ld controls leads to overlapping or obscured elements at runtime. Similar issues can be seen when setting these values incorrectly or when working with <code>Grid.RowSpan</code> and <code>Grid.ColumnSpan</code>. One mistake that’s not always immediately apparent is setting <code>Grid.Row</code> or <code>Grid.Column</code> to a value that’s beyond the defined number of rows or columns.</p>
			<p>Open <code>Grid.Row</code> attribute from the <code>Border</code> control containing the <code>Button</code> controls at the bottom of the page. If you run the application, you will see the buttons move to the top of the page and overlap the controls in the header area.</p>
			<p>Now restore the <code>Grid.Row</code> attribute but change the value to <code>5</code>. If this were the last row in the grid, everything would look fine even though <code>Grid</code> only has four rows. Since <code>5</code> is greater than the number of available rows, the control is added to the last row in <code>Grid</code>. However, because we have <code>InfoBar</code> below the buttons in the fourth row, the buttons and the <code>InfoBar</code> overlap.</p>
			<h3>Problems when applying style</h3>
			<p><a id="_idTextAnchor360"/>XAML <code>Style</code> resources<a id="_idIndexMarker815"/> are another common source of unintentional UI changes. When creating <code>Style</code> in <code>Resource</code>, you should be aware of how it will be applied to controls within the scope of that <code>Resource</code>.</p>
			<p>Open <code>Page.Resources</code> section. This is where we created three <code>Style</code> elements for the current page. Each has a different <code>Target</code> type: <code>TextBlock</code>, <code>TextBox</code>, and <code>ComboBox</code>. However, they won’t be applied to every control of those types on the <code>Page</code> because we also gave each <code>Style</code> an <code>x:Key</code>. That means that <code>Style</code> will only be applied to elements of that type when the <code>Style</code> property is explici<a id="_idTextAnchor361"/>tly set to that named resource. These are referred to as <em class="italic">explicit styles</em>:</p>
			<pre class="source-code">
&lt;TextBlock Text="Name:" Style="{StaticResource
  AttributeTitleStyle}"/&gt;</pre>			<p>If you remove <code>x:Key</code> from <code>Style</code> in <code>Page.Resources</code>, that <em class="italic">implici<a id="_idTextAnchor362"/>t style</em> will apply to every control of the specified <code>Target</code> type on the <code>Page</code>, unless those controls have another explicit <code>Style</code> set. In a large application with styles declared at different scopes (<code>Application</code>, <code>Page</code>, or control), it can sometimes be difficult to determine which style has been applied to a control. We will see how to do this later in the chapter when discussing Visual Studio’s <strong class="bold">Live Property Explorer</strong> window. It’s a best practice to have implicit styles always inherit from an explicit style. This enables develop<a id="_idTextAnchor363"/>ers to inherit from a default style <a id="_idIndexMarker816"/>and reduces repeated implicit style attributes across elements.</p>
			<p>Next, we will look at a third-party extension that can help find common XAML problems through<a id="_idTextAnchor364"/><a id="_idTextAnchor365"/> <strong class="bold">static </strong><strong class="bold">code analysis</strong>.</p>
			<h2 id="_idParaDest-228">Improving your XAML with static <a id="_idTextAnchor366"/>code analysis</h2>
			<p>There <a id="_idTextAnchor367"/>is a free, open<a id="_idIndexMarker817"/> source extension for Visual Studio that, among <a id="_idIndexMarker818"/>other things, adds support for static code analysis to XAML files. <strong class="bold">Rapid XAML Toolkit</strong> (<a href="https://rapidxaml.dev/">https://rapidxaml.dev/</a>) provides XAML<a id="_idIndexMarker819"/> analyzers and code fixes for common issues and provides <a id="_idIndexMarker820"/>support for adding your own custom XAML analyzers.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">At the time of writing, Rapid XAML Toolkit for Visual Studio 2022 has not yet been released. It is being developed and should be available by the time you read this book. The current example illustrates how to use the extension currently available for Visual Studio 2019.</p>
			<p>Let’s install the tool in Visual Studio and see what kind of issues it can identify in a WinUI project:</p>
			<ol>
				<li>In Visual Studio, go to <strong class="bold">Extensions</strong> | <strong class="bold">Manage Extensions</strong>.</li>
				<li>The <code>rapid xaml</code>:</li>
			</ol>
			<div><div><img src="img/B20908_11_06.jpg" alt="Figure 11.6 – Installing Rapid XAM﻿L Toolkit"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.6 – Installing Rapid XAM<a id="_idTextAnchor369"/>L Toolkit</p>
			<ol>
				<li value="3">Click <strong class="bold">Download</strong> to queue the extension<a id="_idTextAnchor370"/> for installation. When the download completes, you can close the <strong class="bold">Manage Extensions</strong> window and restart Visual Studio to complete the installation.</li>
				<li>Now, when you view the <strong class="bold">Error List</strong> window in Visual Studio, there are a handful of warnings fr<a id="_idTextAnchor371"/>om Rapid XAML’s analyzers:</li>
			</ol>
			<div><div><img src="img/B20908_11_07.jpg" alt="Figure 11.7 – Viewing the new warnings from Rapid XAML Toolkit"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.7 – Viewing the new warnings from Rapid XAML Toolkit</p>
			<ol>
				<li value="5">Open <strong class="bold">ItemDetailPage.xaml</strong>, place your cursor over one of the green squiggles created by the code analyzer, and <a id="_idTextAnchor372"/>click the lightbulb icon:</li>
			</ol>
			<div><div><img src="img/B20908_11_08.jpg" alt="Figure 11.8 – View the quick fix for a code analyzer warning"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.8 – View the quick fix for a code analyzer warning</p>
			<p>Alternatively, you<a id="_idIndexMarker823"/> can right-click on the XAML and <a id="_idIndexMarker824"/>select <strong class="bold">Rapid XAML</strong> | <strong class="bold">Move hard-coded string to resource file.</strong> to fix all warni<a id="_idTextAnchor373"/>ngs of this type.</p>
			<p>This is a l<a id="_idTextAnchor374"/>ist <a id="_idTextAnchor375"/>of other analyzers that are provided by the toolkit:</p>
			<ul>
				<li><code>Grid.Row</code> value without a corresponding <code>RowDefinition</code></li>
				<li><code>Grid.Column</code> value without a corresponding <code>ColumnDefinition</code></li>
				<li><code>Grid.RowSpan</code> value without a corresponding <code>ColumnDefinition</code></li>
				<li><code>Grid.ColumnSpan</code> value without a corresponding <code>ColumnDefinition</code></li>
				<li><code>TextBox</code> does not have <code>InputScope</code> specified</li>
				<li><code>SelectedItem</code> binding should probably be <code>TwoWay</code></li>
				<li><strong class="bold">RXT200</strong>: The hardcoded string value that should be a resource</li>
				<li><code>Entry</code> does not have a <code>Keyboard</code> specified</li>
				<li><code>MaxLength</code> specified</li>
				<li><code>Image</code> lacks accessibility consideration</li>
				<li><code>ImageButton</code> lacks accessibility consideration</li>
				<li><code>Checked</code> and <code>Unchecked</code> events for a <code>CheckBox</code></li>
				<li><code>MediaPlayerElement</code> in place of <code>MediaElement</code><code><a id="_idTextAnchor376"/></code></li>
				<li><code>x:Uid</code> should begin with an uppercase character</li>
				<li><code>Name</code> should begin with an uppercase character</li>
				<li><strong class="bold">RXT999</strong>: Unknown<a id="_idIndexMarker825"/> error – something went wrong<a id="_idIndexMarker826"/> when parsing<a id="_idTextAnchor377"/> the XAML document</li>
			</ul>
			<p>Rapid XAML To<a id="_idTextAnchor378"/>olkit<a id="_idIndexMarker827"/> has many other features outside of analyzers and code fixes, and new features and analyzers are being added frequently. To see a list of upcoming features and fixes being considered, you can view the issues on GitHub: <a href="https://github.com/mrlacey/Rapid-XAML-Toolkit/issues">https://github.com/mrlacey/Rapid-XAML-Toolkit/issues</a>.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Community-driven projects like this are always looking for contributors. It’s a great way to get started with the open source community.</p>
			<p>Another related topic that can be a common source of developer angst is debugging data binding. Let’s see how we can avoid some common<a id="_idTextAnchor379"/> pitfalls in the next section.</p>
			<h1 id="_idParaDest-229">Pinpointi<a id="_idTextAnchor380"/>ng data binding failures</h1>
			<p>While debugging data binding problems is not as difficult in WinUI and UWP as it is in WPF (if you use <code>x:Bind</code>-compiled bindings), there are still some <em class="italic">gotchas</em> to avoid. In this section, we will look at what can go wrong in views and ViewModels and how you can <a id="_idTextAnchor381"/><a id="_idTextAnchor382"/>diagnose and fix the problems.</p>
			<h2 id="_idParaDest-230"><a id="_idTextAnchor383"/>Common mistakes in data binding</h2>
			<p>If you use <code>x:Bi<a id="_idTextAnchor384"/>nd</code>, the <a id="_idIndexMarker828"/>compiler will evaluate whether you’re binding to a valid source and can give you the peace of mind of knowing that your views and ViewModels are hooked up correctly, but there is still a lot that can go wrong. Let’s review a few of the most common mistakes.</p>
			<h3>Selecting the best binding mode</h3>
			<p>We have seen in previous chapters that the default mode for most controls wi<a id="_idTextAnchor385"/>th <code>x:Bind</code> is <code>OneTime</code>, while the default for <code>Binding</code> is <code>OneWay</code>. Defaulting to <code>OneTime</code> helps with performance as many read-only properties are only ever set when the view is first created. However, if you forget to change this for controls bound to data that changes as the user is interacting with the page, you may not immediately realize why the data in the UI isn’t updating.</p>
			<p>When you’re binding controls that need data to flow in both directions, remember to set <code>Mode</code> to <code>TwoWay</code>. We used this in the <code>ComboBox.SelectedItem</code> property to filter the collection by media type.</p>
			<h3>Triggering PropertyChanged notifications</h3>
			<p>By bindi<a id="_idTextAnchor386"/>ng to a <a id="_idIndexMarker829"/>ViewModel that properly implements <code>INotifyPropertyChanged</code> for all its public properties, issues related to <code>PropertyChanged</code> are not common. Using MVVM Toolkit makes it even simpler. Problems can still arise if ViewModel code outside of one of these properties updates the property’s value by setting the <code>private</code> backing variable. This will update the property’s value without notifying the view. If you are using MVVM Toolkit, it will call out this issue when it generates its code in the hidden partial class. You can avoid this by always using the <code>public</code> property to update the value. If there is a good reason for not updating the property directly, then a <code>PropertyChanged</code> event should be manually triggered for that property after updating the value. It is a best practice to use the <code>nameof</code> method in C# to ensure you use a property name that exists. Misspelled property names will be caught at compile time and highlighted in the editor. You can also use <code>CallerMemberNameAttribute</code> in .NET: <a href="https://learn.microsoft.com/dotnet/api/system.runtime.compilerservices.callermembernameattribute">https://learn.microsoft.com/dotnet/api/system.runtime.compilerservices.callermembernameattribute</a>. An exception will be raised if your application tries to raise a property change <a id="_idIndexMarker830"/>notification for a property that does not exist.</p>
			<h3>Working with ObservableCollection&lt;T&gt;</h3>
			<p><code>ObservableCollection&lt;T&gt;</code> serves an<a id="_idIndexMarker831"/> important role. Lists in the view will stay<a id="_idTextAnchor387"/> synchronized wit<a id="_idTextAnchor388"/>h the collections if they are used correctly. There are a few practices to avoid when using observable collections.</p>
			<p>Do not replace the entire value of an observable collection. The element on the view bound to the property will still be bound to the original collection. Any subsequent changes to the collection will not be reflected in <a id="_idTextAnchor389"/>the view. While you can work around this by triggering a <code>PropertyChanged</code> notification, this can have performance implications with larger collections. It can also be jarring to the user, as most controls will reset the current view to the beginning of the list. Set ViewModel properties that use <code>ObservableCollection&lt;T&gt;</code> to be read-only to avoid accidentally resetting the entire collection. The one exception to this is if you know the collection will be completely repopulated. Removing and re-adding a large number of items individually in a list can result in a poor user experience.</p>
			<p>Do not use LINQ to modify observable collections. LINQ expressions do not operate by calling the <code>Add</code> and <code>Remove</code> methods on the observable collections. They do not even return <code>ObservableCollection&lt;T&gt;</code>. If you use LINQ and convert the results back to <code>ObservableCollection&lt;T&gt;</code>, you will be back to replace the entire collection, which was just discussed.</p>
			<p>Here is an example using LINQ. This will <a id="_idIndexMarker832"/>cause the view to stop receiving <code>CollectionChanged</code> notifications because LINQ does not return an <code>ObservableCollection</code>:</p>
			<pre class="source-code">
_entryList = <strong class="bold">from</strong> entry <strong class="bold">in</strong> _entryList
             <strong class="bold">where</strong> entry.Lastname.StartsWith(<strong class="bold">"J"</strong>)
             <code>Lastname</code> starting with J. By using the <code>Remove</code> method and not changing the entire collection, the <code>CollectionChanged</code> events are preserved:</p>
			<pre class="source-code">
<strong class="bold">for</strong> (<strong class="bold">int</strong> i = _entryList.Count - 1; i &gt;= 0; i--)
{
    Entry entry = _entryList[i];
    <strong class="bold">if</strong> (!entry.Lastname.StartsWith(<strong class="bold">"J"</strong>))
    {
        _entryList.Remove(entry);
  <a id="_idTextAnchor390"/>  }
}</pre>			<p>Final<a id="_idTextAnchor391"/>ly, it’s best<a id="_idIndexMarker833"/> not to use observable collections for lists that do not change. The extra overhead they bring is not needed for static data. Bind <a id="_idIndexMarker834"/>to an <code>IList&lt;T&gt;</code>, <code>IEnumerable&lt;T&gt;</code>, or better yet, a traditional array of items instead. Check out this <em class="italic">C# 101</em> video to learn when to leverage arrays, lists, and collections in .NET: <a href="https://learn.microsoft.com/shows/csharp-101/csharp-arrays-list-and-collections">https://learn.microsoft.com/shows/csharp-101/csharp-arrays-list-and-collections</a>.</p>
			<h2 id="_idParaDest-231">Using the XAML Bindi<a id="_idTextAnchor392"/>ng Failures window</h2>
			<p>Visual Studio 2019 version 16.7 introduced the new <code>Binding</code>, not <code>x:Bind</code>, as those issues are checked and caught by the compiler. Clicking the red indicator will take you to the <strong class="bold">XAML Binding Failures</strong> window while debugging. Binding failures were always available in the <strong class="bold">Output</strong> window while debugging, but they could be difficult to find. The new, dedicated window provides sorting and searching. Similar failures are also grouped to make it ea<a id="_idTextAnchor393"/>sy to address related items together:</p>
			<div><div><img src="img/B20908_11_09.jpg" alt="Figure 11.9 – Checking the in-app toolbar﻿ for binding failures"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.9 – Checking the in-app toolbar<a id="_idTextAnchor394"/> for binding failures</p>
			<p>Let’s give it a try. Open the <strong class="bold">XamlDebugging</strong> solution from the GitHub repository for this chapter and <a id="_idIndexMarker836"/>follow along with these steps:</p>
			<ol>
				<li>Open <code>Window</code> contains a <code>StackPanel</code> with two <code>TextBox</code> child elements:<pre class="source-code">
&lt;StackPanel DataContext="Test" Background="LightGray"&gt;
    &lt;TextBox x:Name="Text1"
             Text="{Binding Path=SomeText,
               Mode=TwoWay}"/&gt;
    &lt;TextBox Text="{Binding ElementName=Text1,
      Path=Text, Mode=OneWay}"/&gt;
&lt;/StackPanel&gt;</pre><p class="list-inset"><code>DataContext</code> does not exist, so what do you think will be reported in the binding failures? Let’s find out!</p></li>				<li>Run the application and look at the in-app toolbar. There is an indication that we h<a id="_idTextAnchor395"/>ave one binding failure.</li>
				<li>Click the red indicator on the toolbar to open the <strong class="bold">XAML Bind<a id="_idTextAnchor396"/>ing Failures</strong> window in Visual Studio:</li>
			</ol>
			<div><div><img src="img/B20908_11_010.jpg" alt="Figure 11.10 – The XAML Binding Failures window"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.10 – The XAML Binding Failures window</p>
			<p class="list-inset">The <strong class="bold">Description</strong> text in the window tells us <strong class="bold">BindingExpression path error: ‘SomeText’ property not found on ‘Windows.Foundation.IReference`1&lt;String&gt;’</strong>. This is useful information. It would be more useful if there was something telling us directly that the data context itself is not valid. However, if you had a dozen controls using this data context, and all the bindings were failing, it would become clear that there is a problem with the data context and not the individual bindings.</p>
			<ol>
				<li value="4">Let’s make<a id="_idIndexMarker837"/> sure the other binding is working correctly. En<a id="_idTextAnchor397"/>ter some text into the first <code>TextBox</code>:</li>
			</ol>
			<div><div><img src="img/B20908_11_011.jpg" alt="Figure 11.11 – Binding Te﻿xtBoxes with ElementName"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.11 – Binding Te<a id="_idTextAnchor398"/>xtBoxes with ElementName</p>
			<p>The text you enter should be duplicated in the second <code>TextBox</code> as your type. Our binding to <code>ElementName</code> is working as expected.</p>
			<p>I will leave fixing the data source as an exercise for you. Add a valid data source to the code behind it and see whether the binding error is cleared up.</p>
			<p>Now, let’s explore a few other XAML debugging too<a id="_idTextAnchor399"/>ls available from the in-app toolbar.</p>
			<h1 id="_idParaDest-232">Debugging live data with Live Visual <a id="_idTextAnchor400"/>Tree and Live Property Explorer</h1>
			<p>While th<a id="_idTextAnchor401"/>e <strong class="bold">XAML Binding Failures</strong> window is new to Visual Studio, the in-app toolbar has been available to <a id="_idIndexMarker838"/>XAML developers since 2015. The toolbar floats over the active window in your application while you are debugging. There are several parts to the toolbar:</p>
			<ul>
				<li><strong class="bold">Go to Live Visual Tree</strong>: Opens the <strong class="bold">Live Visual </strong><strong class="bold">Tree</strong> window.</li>
				<li><strong class="bold">Show in XAML Live Preview</strong>: This opens the <strong class="bold">XAML Live Preview</strong> window in Visual Studio.</li>
				<li><strong class="bold">Select Element</strong>: Allows you to select an element in <strong class="bold">Live Visual Tree</strong> by clicking on it in the active window.</li>
				<li><strong class="bold">Display Layout Adorners</strong>: This will highlight the element in the UI that is currently selected in <strong class="bold">Live </strong><strong class="bold">Visual Tree</strong>.</li>
				<li><strong class="bold">Track Focused Element</strong>: While the <strong class="bold">Liv<a id="_idTextAnchor402"/>e Visual Tree</strong> window i<a id="_idTextAnchor403"/>s open, toggling this on will indicate in <strong class="bold">Live Visual Tree</strong> which element currently has focus on the UI.</li>
				<li><strong class="bold">Binding failures</strong>: Indicates the number of current binding failures and opens the <strong class="bold">XAML Binding Failures</strong> window when clicked.</li>
				<li><strong class="bold">Scan for Accessibility Issues</strong>: This opens the <strong class="bold">Accessibility Checker</strong> window and runs an accessibility check on the UI elements cu<a id="_idTextAnchor404"/>rrently visible.</li>
				<li><strong class="bold">Hot Reload</strong>: Indicates whether <strong class="bold">XAML Hot Reload</strong> is currently available. Clicking it will open the<a id="_idIndexMarker839"/> documentation on Microsoft Learn.</li>
			</ul>
			<p>Let’s explore a few of the most commonly used debugging tools. If you wish to get more informatio<a id="_idTextAnchor405"/>n on the remaining tools, you can visit this page about XAML tools on Microsoft Learn: <a href="https://learn.microsoft.com/visualstudio/xaml-tools/">https://learn.microsoft.com/visualstudio/xaml-tools/</a>. Or, view this <em class="italic">Visual Studio Toolbox</em> episode about using the XAML tools in Visual Studio: <a href="https://learn.microsoft.com/shows/visual-studio-toolbox/new-xaml-features-in-visual-studio">https://learn.microsoft.com/shows/visual-studio-toolbox/new-xaml-features-in-visual-studio</a>. We’ll start with XAML Hot Reloa<a id="_idTextAnchor408"/>d.</p>
			<h2 id="_idParaDest-233"><a id="_idTextAnchor409"/>Coding with XAML Hot Reload</h2>
			<p>XAML Hot Reload is a sim<a id="_idTextAnchor410"/>ple<a id="_idIndexMarker840"/> but powerful feature. Before Visual Studio 16.2, it w<a id="_idTextAnchor411"/>as known as <strong class="bold">XAML C# Edit &amp; Continue</strong>. Hot reload has been available to web developers for a while longer, and the name change for XAML helps to clear up some confusion for developers familiar with the concept in web development. The idea of hot reload is that you can make changes to your UI and the changes are reflected in the running application without having to stop debugging and recompile. Let’s try it with the <strong class="bold">XamlDebugging</strong> solution:</p>
			<ol>
				<li>Start by running the application again. Make sure that the <strong class="bold">Hot Reload</strong> indicator in the toolbar shows that it is enabled. It should only be disabled if you are runnin<a id="_idTextAnchor412"/>g an unsupported project type.</li>
				<li>Now let’s <a id="_idIndexMarker841"/>make<a id="_idTextAnchor413"/> a change to <code>Background</code> color of <code>StackPanel</code> to <code>LightGray</code>:<pre class="source-code">
&lt;StackPanel DataContext="Test"
            Background="LightGray"&gt;
    &lt;TextBox x:Name="Text1"
             Text="{Binding Path=SomeText,
               Mode=TwoWay}"/&gt;
    &lt;TextBox Text="{Binding ElementName=Text1,
      Path=Text, Mode=OneWay}"/&gt;
&lt;/StackPanel&gt;</pre></li>				<li>Save the f<a id="_idTextAnchor414"/>ile and look at the running application:</li>
			</ol>
			<div><div><img src="img/B20908_11_012.jpg" alt="Figure 11.12 – Changing the UI without restarting the application"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.12 – Changing the UI without restarting the application</p>
			<p>The background of the <a id="_idTextAnchor415"/>window is now light gray.</p>
			<p>This is a huge <a id="_idIndexMarker842"/>time-saver wh<a id="_idTextAnchor416"/>en building a new UI. For a list of known limitations, see this Microsoft Learn article: <a href="https://learn.microsoft.com/troubleshoot/developer/visualstudio/tools-utilities/xaml-hot-reload-troubleshooting#known-limitations">https://learn.microsoft.com/troubleshoot/developer/visualstudio/tools-utilities/xaml-hot-reload-troubleshooting#known-limitations</a>.</p>
			<p>Now let’s look at another powerful deb<a id="_idTextAnchor417"/><a id="_idTextAnchor418"/>ugging tool, the <strong class="bold">Live Visual </strong><strong class="bold">Tree</strong> window.</p>
			<h2 id="_idParaDest-234">Debugging with Live Visual Tree and Live Prop<a id="_idTextAnchor419"/>erty Explorer</h2>
			<p>The <strong class="bold">Live Visual Tre<a id="_idTextAnchor420"/>e</strong> window <a id="_idIndexMarker843"/>allows developers to <a id="_idTextAnchor421"/>explore the elements in the current window of an appli<a id="_idTextAnchor422"/>cation’s XAML <strong class="bold">visual tree</strong>. It is <a id="_idIndexMarker844"/>available to UWP and WinUI applications and other XAML frameworks. Let’s step through using <strong class="bold">Live Visual Tree</strong> and related XAML debugging tools:</p>
			<ol>
				<li>While debugging the <strong class="bold">XAMLDebugging</strong> project, open the <strong class="bold">Live Visual Tree</strong> window. The visual tree contains the hierarchy of controls in the window with the <strong class="bold">Show Just My XAML</strong> button selected by default<a id="_idTextAnchor423"/> in the <strong class="bold">Live Visual Tree</strong> window’s toolbar:</li>
			</ol>
			<div><div><img src="img/B20908_11_013.jpg" alt="Figure 11.13 – Viewing Live Visual Tree for the XamlDebugging p﻿roject (Show Just﻿ My XAML selected)"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.13 – Viewing Live Visual Tree for the XamlDebugging p<a id="_idTextAnchor424"/>roject (Show Just<a id="_idTextAnchor425"/> My XAML selected)</p>
			<ol>
				<li value="2"><a id="_idTextAnchor426"/>If you want to view<a id="_idIndexMarker845"/> the entire visual tree for your<a id="_idTextAnchor427"/> window, de-select <strong class="bold">Show Just My XAML<a id="_idTextAnchor428"/></strong> on the toolbar and the tree will refresh:</li>
			</ol>
			<div><div><img src="img/B20908_11_014.jpg" alt="Figure 11.14 – Viewing Live Visual Tree for the XamlDebugging project (all XAML)"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.14 – Viewing Live Visual Tree for the XamlDebugging project (all XAML)</p>
			<p class="list-inset">There’s a lot <a id="_idIndexMarker846"/>more going on here. With <code>TextBox</code> is made up of 17 child elements with a <code>Grid</code> at the root of its template. This is a great way to learn how the controls we use are composed. Working with and modifying these templates is beyond the scope of this chapter, but I encourage you to explore them on your own. <a href="B20908_07.xhtml#_idTextAnchor152"><em class="italic">Chapter 7</em></a>, <em class="italic">Fluent<a id="_idTextAnchor429"/> Design System for Windows<a id="_idTextAnchor430"/> Applications</em>, has additional information on using default styles and theme resources. This Mic<a id="_idTextAnchor431"/>rosoft Learn a<a id="_idTextAnchor432"/>rticle on control templates is another great place to start: <a href="https://learn.microsoft.com/windows/apps/design/style/xaml-control-templates">https://learn.microsoft.com/windows/apps/design/style/xaml-control-templates</a>. For now, let’s switch back to the <strong class="bold">Show Just My </strong><strong class="bold">XAML</strong> view.</p>
			<ol>
				<li value="3">From <strong class="bold">Live Visual Tree</strong>, right-click on a node to navigate to the XAML markup for the selected item by selecting <strong class="bold">View Source</strong>.</li>
				<li>Next, right-click a node and select <strong class="bold">Show Properties</strong> to show the <strong class="bold">Live Property Explorer</strong> window, where<a id="_idIndexMarker848"/> you can inspect the current properties of the selected element. You can see how the properties are grouped based on where they have been set. Here, some are set by <strong class="bold">Local</strong> changes and others are set based on the <strong class="bold">Style</strong> for a <strong class="bold">TextBox</strong>. If you had multiple levels of inherited explicit styles and an impl<a id="_idTextAnchor433"/>icit style, those would all be grouped here:</li>
			</ol>
			<div><div><img src="img/B20908_11_015.jpg" alt="Figure 11.15 – Viewing the Live Property Explorer window for the Text1 TextBox"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.15 – Viewing the Live Property Explorer window for the Text1 TextBox</p>
			<ol>
				<li value="5">Look <a id="_idIndexMarker849"/>at the <code>Binding</code> markup extension. Expand the <strong class="bold">Text</strong> prope<a id="_idTextAnchor434"/>rty node to view the details of the binding:</li>
			</ol>
			<div><div><img src="img/B20908_11_016.jpg" alt="Figure 11.16 – View the binding details for the Text property of Text1"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.16 – View the binding details for the Text property of Text1</p>
			<p class="list-inset">There is some very helpful information here. We can see the <strong class="bold">Path</strong> and <strong class="bold">Mode</strong> that were set in the XAML, the ones we did not set, and yet others that ar<a id="_idTextAnchor435"/>e read-only. <strong class="bold">IsB<a id="_idTextAnchor436"/>indingValid</strong> is <strong class="bold">False</strong> in this project, but it may be <strong class="bold">True</strong> if you fixed your <a id="_idTextAnchor437"/>data context from the previous section. When the binding is valid, <strong class="bold">Evalu<a id="_idTextAnchor438"/>atedValue</strong> will contain the current value for the <strong class="bold">Text</strong> property.</p>
			<ol>
				<li value="6">Select the second <code>TextBox</code> element in the tree and view the <strong class="bold">Live Property Explorer</strong> window. You can see that the default value for <strong class="bold">Background</strong> is <strong class="bold">SolidColorBrush</strong>.</li>
				<li>Expand the <strong class="bold">Ba<a id="_idTextAnchor439"/>ckground</strong> node to view the resource details:</li>
			</ol>
			<div><div><img src="img/B20908_11_017.jpg" alt="Figure 11.17 – Viewing the property details of Page.Background"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.17 – Viewing the property details of Page.Background</p>
			<ol>
				<li value="8">Try changing the <strong class="bold">Color</strong> property to white and see what happens in the XAML code and to the running application. The UI in the app should update, but the XAML file will remain unchanged.</li>
				<li>Next, try <a id="_idIndexMarker850"/>adding markup to <code>MainWindow</code> to set the <code>MaxWidth</code> property of the second <code>TextBox</code> to <code>100</code>. What happens in <code>MaxWidth</code> when you’re finished.</li>
				<li>Returning to <code>Grid</code> is more complex than <code>StackPanel</code>. <code>StackPanel</code> is preferred for layout if you are simply laying out a few elements horizontally or vertically. This unidirectional layout is what <code>StackPanel</code> was built to handle. As a rule of thumb, you should use the right control for the job and always keep performance in mind.</li>
				<li>Now select the active node from the tree in your XAML file and enable <strong class="bold">Select Element in the Running Application</strong> from the toolbar. The <strong class="bold">Track Focused Element</strong> button on the toolbar will highlight the current tree node in the application’s window at runtime. This option is also available from the in-app toolbar.</li>
				<li>To toggle the in-app toolbar on/off, you can use the <strong class="bold">Enable in-app Toolbar</strong> button <a id="_idTextAnchor444"/><a id="_idIndexMarker851"/>on the <strong class="bold">Live Visual </strong><strong class="bold">Tree</strong> toolbar<a id="_idTextAnchor445"/>.</li>
			</ol>
			<p>I encourage you<a id="_idTextAnchor446"/> to spend some time in <a id="_idTextAnchor447"/>these windows the next time you are debugging your application. Use them to help find issues with binding, resources, or custom control templates.</p>
			<p>Now let’s wrap <a id="_idTextAnchor448"/><a id="_idTextAnchor449"/>up the chapter and review what we’ve learned.</p>
			<h1 id="_idParaDest-235"><a id="_idTextAnchor450"/>Summary</h1>
			<p>In this chapter, we have covered some essential tools and techniques for debugging your XAML applications. We learned how to debug installed applications on a local or remote PC. If you are developing WPF or UWP applications, tools such as <strong class="bold">Live Visual Tree</strong>, <strong class="bold">Live Property Explorer</strong>, and <strong class="bold">Rapid XAML Toolkit</strong> will all work for those projects as well. Leveraging these tools will shorten the time you spend debugging and help you deliver higher-quality software.</p>
			<p>In the next chapter, we will explore the <code>WebView2</code> browser control. You will learn how to use <code>WebView2</code> to embed an ASP.NET Core Blazor <strong class="bold">single-page applicatio<a id="_idTextAnchor451"/><a id="_idTextAnchor452"/>n</strong> (<strong class="bold">SPA</strong>) inside a WinUI 3 desktop application.</p>
			<h1 id="_idParaDest-236"><a id="_idTextAnchor453"/>Questions</h1>
			<ol>
				<li>How can you debug a UWP application that is running on an Xbox?</li>
				<li>How can you debug an application that is currently running on your machine?</li>
				<li>How can you launch an application package installed on a remote machine for debugging?</li>
				<li>What feature in Visual Studio allows you to change XAML properties at runtime and see them reflected in the running application?</li>
				<li>Which window will show a hierarchy of the elements in the current window?</li>
				<li>What is the default binding mode for most control properties with <code>x:Bind</code>?</li>
				<li>Where can you view the runtime properties for the control currently selected in <strong class="bold">Live </strong><strong class="bold">Visual Tree</strong>?</li>
			</ol>
		</div>
	</body></html>