<html><head></head><body>
<div><div><h1 class="chapter-number" id="_idParaDest-287"><a id="_idTextAnchor481" class="pcalibre pcalibre1 calibre6"/>18</h1>
<h1 id="_idParaDest-288" class="calibre5"><a id="_idTextAnchor482" class="pcalibre pcalibre1 calibre6"/>Getting Started with UI Toolkit</h1>
<p class="calibre3"><a id="_idTextAnchor483" class="pcalibre pcalibre1 calibre6"/>Up to this point, the focus of this book has been on <strong class="bold">Unity UI</strong> (<strong class="bold">uGUI</strong>). However, Unity has been developing another system in which you can develop UI for your game: the <strong class="bold">UI Toolkit</strong>. It is based on the principles of web design and is meant to allow you to create UI in a more flexible and extensible way than the uGUI. It accomplishes this by divorcing the design and development of UI from scenes and GameObjects and instead creates UI via code and style sheets—just like in web design.</p>
<p class="calibre3">The UI Toolkit is an entirely different system, so beginning development with it may feel jarring at first if you are used to developing UI with uGUI. However, if you have experience with <code>.xhtml</code> and <code>.css</code> or developing Android or iOS interfaces using <code>XML</code>, this should all feel very familiar.</p>
<p class="calibre3">Since the UI Toolkit is an entirely different system using entirely different principles than the rest of the chapters in this book, to fully explain all that you could do with it would merit a whole other textbook devoted purely to it. Therefore, this chapter will give you the basic information you need to get started with using the system, but not fully discuss every aspect of it. I will give you additional resources throughout this chapter to review if you’d like to go even further with your study of the UI Toolkit.</p>
<p class="calibre3">In this chapter, I will discuss the following:</p>
<ul class="calibre16">
<li class="calibre14">An overview of the UI Toolkit and how to install it if it’s not already in your version of Unity</li>
<li class="calibre14">The various parts of the UI Toolkit that work together to create and style an interface</li>
<li class="calibre14">What are Visual Elements and how does the UI Toolkit Hierarchy work?</li>
<li class="calibre14">How to use the UI Builder to design and layout UI Toolkit interfaces</li>
<li class="calibre14">How to access UI Toolkit-built UI in C#</li>
<li class="calibre14">Creating a virtual pet that hangs out with you in your Unity Editor and encourages you</li>
<li class="calibre14">Using the UI Builder to create style sheets and animation transitions</li>
<li class="calibre14">Using web requests to randomly generate your UI’s images and text</li>
</ul>
<p class="callout-heading">Note</p>
<p class="callout">This chapter assumes you have a cursory knowledge of HTML and CSS. However, having more extensive experience with HTML and CSS will make adopting the UI Toolkit system significantly easier.</p>
<p class="calibre3">Before we jump into the inner workings of the UI Toolkit, let’s review its use cases and when you will use it.</p>
<h1 id="_idParaDest-289" class="calibre5"><a id="_idTextAnchor484" class="pcalibre pcalibre1 calibre6"/>Technical requirements</h1>
<p class="calibre3">You can find the relevant codes and asset files of this chapter here: <a href="https://github.com/PacktPublishing/Mastering-UI-Development-with-Unity-2nd-Edition/tree/main/Chapter%2018" class="pcalibre pcalibre1 calibre6">https://github.com/PacktPublishing/Mastering-UI-Development-with-Unity-2nd-Edition/tree/main/Chapter%2018</a></p>
<h1 id="_idParaDest-290" class="calibre5"><a id="_idTextAnchor485" class="pcalibre pcalibre1 calibre6"/>Overview of UI Toolkit</h1>
<p class="calibre3">As you may recall from <a href="B18327_05.xhtml#_idTextAnchor072" class="pcalibre pcalibre1 calibre6"><em class="italic">Chapter 5</em></a>, there are three total UI systems that can be used within Unity. Up to this point, the focus of this book has been on Unity UI (uGUI), which can be used to make<a id="_idIndexMarker1025" class="pcalibre pcalibre1 calibre6"/> in-game (aka runtime) UI. However, if you want to make UI that can be viewed in your Editor, you will have to use a different system. The two systems that can be used to create Editor <a id="_idIndexMarker1026" class="pcalibre pcalibre1 calibre6"/>UI are <strong class="bold">IMGUI</strong>, which we will discuss in the next chapter, and the UI Toolkit. However, while IMGUI can only be used to make Editor UI, the UI Toolkit can be used to make both runtime and Editor UI.</p>
<div><div><img alt="Figure 18.1: Comparing the three UI systems" src="img/B18327_18_01.jpg" class="calibre579"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.1: Comparing the three UI systems</p>
<p class="calibre3">Unity’s goal is to replace the uGUI system entirely with the new UI Toolkit. However, it is still in development and does not<a id="_idIndexMarker1027" class="pcalibre pcalibre1 calibre6"/> have all the functionalities that uGUI does. For example, the UI Toolkit cannot make UI that is positioned in the 3D world, like what we discussed in <a href="B18327_16.xhtml#_idTextAnchor447" class="pcalibre pcalibre1 calibre6"><em class="italic">Chapter 16</em></a>. It can only make UI that overlays on top of the screen. Additionally, it cannot use custom materials and shaders and is not easily referenced from MonoBehaviours.</p>
<p class="calibre3">So, when would you want to use the UI Toolkit? The UI Toolkit is extremely helpful if you want to create stylistic UI without dealing with the bloat that comes along with prefabs and prefab variants. You can change the design of UI through code instead of altering a GameObject’s Inspector properties. This makes UI more easily sharable across multiple projects and quickly customizable. Additionally, if you have experience with web development, you may be more comfortable with the workflow of the UI Toolkit.</p>
<p class="calibre3">Odds are, if you are working on an older project, you will need the information discussed in this book that concentrates on uGUI as it is still the most widely used UI system. However, if you are creating a new project and would like to consider using the UI Toolkit for your project, I recommend <a id="_idIndexMarker1028" class="pcalibre pcalibre1 calibre6"/>you review the following documentation to ensure your needs will be met by this system: <a href="https://docs.unity3d.com/Manual/UI-system-compare.xhtml" class="pcalibre pcalibre1 calibre6">https://docs.unity3d.com/Manual/UI-system-compare.xhtml</a></p>
<p class="calibre3">Now that we’ve reviewed when you can use the UI Toolkit, let’s get started with it by installing it in our project.</p>
<h1 id="_idParaDest-291" class="calibre5"><a id="_idTextAnchor486" class="pcalibre pcalibre1 calibre6"/>Installing the UI Toolkit package</h1>
<p class="calibre3">Depending on which version of Unity you are using, the necessary UI Toolkit packages may not be installed. The version <a id="_idIndexMarker1029" class="pcalibre pcalibre1 calibre6"/>of the UI Toolkit that allows you to develop Editor UI comes packaged with all relatively recent versions of Unity; however, the version that allows you to also make runtime UI only comes with the most recent versions.</p>
<p class="calibre3">You can determine if you already have all necessary versions of the UI Toolkit package installed by going to <strong class="bold">Window</strong> | <strong class="bold">UI Toolkit</strong>. If the <strong class="bold">UI Builder</strong> submenu is not present or the UI Toolkit menu item is completely missing, you will need to import the package.</p>
<div><div><img alt="Figure 18.2: Determining if you have the UI Toolkit package installed" src="img/B18327_18_02.jpg" class="calibre580"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.2: Determining if you have the UI Toolkit package installed</p>
<p class="calibre3">If you need to install the UI Toolkit, you can do so by importing the package from the <code>git</code> URL. To do so, complete<a id="_idIndexMarker1030" class="pcalibre pcalibre1 calibre6"/> the following steps:</p>
<ol class="calibre13">
<li class="calibre14">Open the package manager with <strong class="bold">Window</strong> | <strong class="bold">Package Manager</strong>.</li>
<li class="calibre14">Select the <strong class="bold">+</strong> button, then choose <strong class="bold">Add package from </strong><strong class="bold">git URL…</strong>.</li>
</ol>
<div><div><img alt="Figure 18.3: Adding a package via the git URL" src="img/B18327_18_03.jpg" class="calibre581"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.3: Adding a package via the git URL</p>
<ol class="calibre13">
<li value="3" class="calibre14">Type <code>com.unity.ui</code> into the text field that appears. Make sure not to add a space after the address. If you do, you will receive an error message.<p class="calibre3">After the import finishes, you should see the following toolkit in your package window.</p></li>
</ol>
<div><div><img alt="Figure 18.4: The UI Toolkit package" src="img/B18327_18_04.jpg" class="calibre582"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.4: The UI Toolkit package</p>
<ol class="calibre13">
<li value="4" class="calibre14">If you’d like to import the <a id="_idIndexMarker1031" class="pcalibre pcalibre1 calibre6"/>examples into your project, select the <strong class="bold">Import</strong> button to download them.</li>
<li class="calibre14">You may notice that the UI Toolkit description says that the UI Builder is not included in this package. So, you must import that package separately. To do so, select the <strong class="bold">+</strong> button, then choose <strong class="bold">Add package from git </strong><strong class="bold">URL…</strong> again.</li>
<li class="calibre14">This time, enter <code>com.unity.ui.builder</code> into the textbox that appears.<p class="calibre3">After the import finishes, you should see the following package.</p></li>
</ol>
<div><div><img alt="Figure 18.5: The UI Builder package" src="img/B18327_18_05.jpg" class="calibre583"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.5: The UI Builder package</p>
<ol class="calibre13">
<li value="7" class="calibre14">As with the other package, there <a id="_idIndexMarker1032" class="pcalibre pcalibre1 calibre6"/>are samples you can import into your project with the <strong class="bold">Import</strong> buttons.</li>
</ol>
<p class="calibre3">Now that we have the appropriate packages installed, let’s look at the various parts of the UI Toolkit system.</p>
<h1 id="_idParaDest-292" class="calibre5"><a id="_idTextAnchor487" class="pcalibre pcalibre1 calibre6"/>Parts of the UI Toolkit system</h1>
<p class="calibre3">The UI Toolkit uses a set of assets and a GameObject component to create UI. The primary assets used to <a id="_idIndexMarker1033" class="pcalibre pcalibre1 calibre6"/>create UI are as follows:</p>
<ul class="calibre16">
<li class="calibre14">UI Document (UXML)</li>
<li class="calibre14">Style Sheet (USS)</li>
<li class="calibre14">Panel Settings</li>
<li class="calibre14">Theme Style Sheet (TSS)</li>
</ul>
<div><div><img alt="Figure 18.6: Assets used when making UI Toolkit interfaces" src="img/B18327_18_06.jpg" class="calibre584"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.6: Assets used when making UI Toolkit interfaces</p>
<p class="calibre3">A <code>.uxml</code> extension). This file uses <strong class="bold">Unity Extensible Markup Language</strong> (<strong class="bold">UXML</strong>) to define<a id="_idIndexMarker1034" class="pcalibre pcalibre1 calibre6"/> the layout and structure of the UI. While UXML is a <a id="_idIndexMarker1035" class="pcalibre pcalibre1 calibre6"/>unity-specific markup<a id="_idIndexMarker1036" class="pcalibre pcalibre1 calibre6"/> language, it works similarly to other markup languages like HTML and XML. You can create UXML files by right-clicking in an Asset folder and selecting <strong class="bold">Create</strong> | <strong class="bold">UI Toolkit</strong> | <strong class="bold">UI Document</strong>, then naming the file appropriately.</p>
<p class="calibre3">A <code>.uss</code> extension). This file<a id="_idIndexMarker1037" class="pcalibre pcalibre1 calibre6"/> is used to designate<a id="_idIndexMarker1038" class="pcalibre pcalibre1 calibre6"/> style properties that can be referenced in a UXML file. This works very similarly to a CSS file when working with HTML. You can create USS files by right-clicking in an Asset folder and selecting <strong class="bold">Create</strong> | <strong class="bold">UI Toolkit</strong> | <strong class="bold">Style Sheet</strong>, then naming <a id="_idIndexMarker1039" class="pcalibre pcalibre1 calibre6"/>the file appropriately.</p>
<p class="calibre3">A <code>.asset</code> extension) defines<a id="_idIndexMarker1040" class="pcalibre pcalibre1 calibre6"/> the collection of properties that the UI will have.</p>
<div><div><img alt="Figure 18.7: A default Panel Settings asset’s properties" src="img/B18327_18_07.jpg" class="calibre585"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.7: A default Panel Settings asset’s properties</p>
<p class="calibre3">A <code>.tss</code> extension). It determines which Panel Settings will be used with which TSS and <a id="_idIndexMarker1042" class="pcalibre pcalibre1 calibre6"/>USS files, by maintaining a collection of them, as shown in the following figure.</p>
<div><div><img alt="Figure 18.8: The Inspector of a TSS file" src="img/B18327_18_08.jpg" class="calibre586"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.8: The Inspector of a TSS file</p>
<p class="calibre3">When you create a Panel <a id="_idIndexMarker1043" class="pcalibre pcalibre1 calibre6"/>Settings asset, a folder called <code>Unity Themes</code> is automatically <a id="_idIndexMarker1044" class="pcalibre pcalibre1 calibre6"/>created in the same folder. Within it, a single TSS file called <code>UnityDefaultRuntimeTheme.tss</code> will be created for you. However, you can create more TSS files by right-clicking in an Asset folder and selecting <strong class="bold">Create</strong> | <strong class="bold">UI Toolkit</strong> | <strong class="bold">TSS </strong><strong class="bold">Theme File</strong>.</p>
<p class="calibre3">The final piece of the UI Toolkit system is the <strong class="bold">UI Document</strong> component, shown in the following screenshot.</p>
<div><div><img alt="Figure 18.9: The UI Document component" src="img/B18327_18_09.jpg" class="calibre587"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.9: The UI Document component</p>
<p class="calibre3">This component is added to a GameObject in your scene and allows your UI created with the UI Toolkit to be rendered. It has three properties: <strong class="bold">Panel Settings</strong>, <strong class="bold">Source Asset</strong>, and <strong class="bold">Sort Order</strong>.</p>
<p class="calibre3">You assign a Panel Setting asset to the <strong class="bold">Panel Settings</strong> property to signify which settings the UI rendered by this component will have. The <strong class="bold">Source Asset</strong> property is where you assign the UI Document (UXML) file. The <strong class="bold">Sort Order</strong> property determines what order the UI defined by the UXML file will render relative to any other UXML files you are rendering in the <a id="_idIndexMarker1045" class="pcalibre pcalibre1 calibre6"/>scene that use the same Panel Settings. You can add this component to a GameObject by using <strong class="bold">Add Component</strong> in the <strong class="bold">Inspector</strong> and searching for <strong class="bold">UI Document</strong>.</p>
<p class="calibre3">Now that we know all the required assets and components, let’s review how to actually build these assets using the UI Builder.</p>
<h1 id="_idParaDest-293" class="calibre5"><a id="_idTextAnchor488" class="pcalibre pcalibre1 calibre6"/>Visual Elements and UI Hierarchy</h1>
<p class="calibre3">In the same way that a uGUI-built UI is comprised of multiple GameObjects, a UI Toolkit-built UI is comprised of <strong class="bold">Visual Elements</strong>. There are <a id="_idIndexMarker1046" class="pcalibre pcalibre1 calibre6"/>multiple UI elements available to you in the UI Toolkit system (buttons, labels, sliders, etc.), but the Visual Element is the base class for all of them, so they all derive many of their properties from it.</p>
<p class="calibre3">Just as GameObjects are organized in the Unity Editor Hierarchy, UI Toolkit organizes its Visual Elements in something<a id="_idIndexMarker1047" class="pcalibre pcalibre1 calibre6"/> called a <strong class="bold">UI Hierarchy</strong>. For example, let’s say I’d like to create a UI similar to the one displayed in <em class="italic">Figure 18</em><em class="italic">.10</em>.</p>
<div><div><img alt="Figure 18.10: Simple sample UI" src="img/B18327_18_10.jpg" class="calibre588"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.10: Simple sample UI</p>
<p class="calibre3">The Scene Hierarchy in the<a id="_idIndexMarker1048" class="pcalibre pcalibre1 calibre6"/> Editor, if it were built with uGUI, is quite similar to the UI Hierarchy, if it were<a id="_idIndexMarker1049" class="pcalibre pcalibre1 calibre6"/> created with UI Builder, as shown in <em class="italic">Figure 18</em><em class="italic">.11</em>.</p>
<div><div><img alt="Figure 18.11: Scene Hierarchy for uGUI versus UI Hierarchy for UI Toolkit" src="img/B18327_18_11.jpg" class="calibre589"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.11: Scene Hierarchy for uGUI versus UI Hierarchy for UI Toolkit</p>
<p class="calibre3">Except for some slight changes in naming and nesting, they are almost the same. Where you can consider the UI Document, represented by <code>Chapter18.uxml</code> in the UI Hierarchy acting with a similar<a id="_idIndexMarker1050" class="pcalibre pcalibre1 calibre6"/> function to the Canvas in the Scene Hierarchy.</p>
<p class="callout-heading">Note</p>
<p class="callout">The UI Hierarchy screenshot was obtained from the UI Builder tool, which we will discuss in the next section.</p>
<p class="calibre3">When working with uGUI, the<a id="_idIndexMarker1051" class="pcalibre pcalibre1 calibre6"/> alignment and position of each GameObject is based on the parent object it is nested under. This is true also for Visual Elements created with the UI Toolkit system. So, having a sense of how items should be nested is important for developing UI with the UI Toolkit system.</p>
<p class="callout-heading">Note</p>
<p class="callout">You can find the example UI that was developed for <em class="italic">Figure 18</em><em class="italic">.10</em> and <em class="italic">Figure 18</em><em class="italic">.11</em> within the Unity project provided in the code bundle. They can be found within the scene labeled <strong class="source-inline1">Chapter18.asset</strong>. In the Scene Hierarchy, the <strong class="source-inline1">Canvas</strong> GameObject holds the uGUI version and the the <strong class="source-inline1">UIDocument</strong> GameObject holds the UI Toolkit version.</p>
<p class="calibre3">Now that we’ve reviewed some basic concepts of the UI Toolkit system, let’s look at how we can actually build UI with it.</p>
<h1 id="_idParaDest-294" class="calibre5"><a id="_idTextAnchor489" class="pcalibre pcalibre1 calibre6"/>Creating UI with the UI Builder</h1>
<p class="calibre3">To create UI with the UI Toolkit, you <a id="_idIndexMarker1052" class="pcalibre pcalibre1 calibre6"/>have to create a UI Document to describe what Visual Elements you will render as well as their layout and other properties. There are<a id="_idIndexMarker1053" class="pcalibre pcalibre1 calibre6"/> two ways to create UI Documents within the UI Toolkit system:</p>
<ul class="calibre16">
<li class="calibre14">Write the code that will lay out the Visual Elements</li>
<li class="calibre14">Lay the elements in UI Builder and have it write the code for you</li>
</ul>
<p class="calibre3">You can also do a combination of both and bounce between editing your UI via code or the UI Builder.</p>
<p class="calibre3">To access the UI Builder, select <strong class="bold">Window</strong> | <strong class="bold">UI Toolkit</strong> | <strong class="bold">UI Builder</strong>.</p>
<div><div><img alt="Figure 18.12: The UI Builder window" src="img/B18327_18_12.jpg" class="calibre590"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.12: The UI Builder window</p>
<p class="calibre3">In this window, you can drag and drop various Visual Elements from the <strong class="bold">Library</strong> (bottom left) into the <strong class="bold">Viewport</strong> (center). You can resize and <a id="_idIndexMarker1054" class="pcalibre pcalibre1 calibre6"/>move the Visual Elements around in this Viewport, as well. You can change the parenting, thus changing how the Visual Element is aligned <a id="_idIndexMarker1055" class="pcalibre pcalibre1 calibre6"/>via the <strong class="bold">Hierarchy</strong> (left center). Additionally, you can also view the code file that is generated from your layout in the <strong class="bold">UXML Review</strong> Panel and the code files that represent your styles in the <strong class="bold">USS Preview</strong> Panel (both are in the bottom center). An example of walking through how to build a UI with the UI Builder is in the <em class="italic">Examples</em> section at the end of this chapter.</p>
<p class="calibre3">To be able to use the UI layout you’ve created with the UI Builder, you must save the UI Document as a .<code>uxml</code> file. Pressing <em class="italic">Ctrl</em> + <em class="italic">S</em> will save the file for you in a location of your choosing. I recommend you save them in a folder called <code>UI Toolkit</code> within <code>Assets</code>.</p>
<p class="calibre3">Now that we’ve reviewed how to create a UI Document, let’s review how to tie the document to your game’s scene.</p>
<p class="calibre3">You can rename any of your Visual Elements by double-clicking on them in the Hierarchy and typing a new name. When using the UI Builder, the names of the Visual Elements will act as variables if you need to<a id="_idIndexMarker1056" class="pcalibre pcalibre1 calibre6"/> reference them by C# code. So, it’s important to give the Visual Elements distinct <a id="_idIndexMarker1057" class="pcalibre pcalibre1 calibre6"/>names if you plan to access them via C# code (see the <em class="italic">Making the UI Interactable with Events</em> section for further information).</p>
<h1 id="_idParaDest-295" class="calibre5"><a id="_idTextAnchor490" class="pcalibre pcalibre1 calibre6"/>Using the UI Document component</h1>
<p class="calibre3">As mentioned in the <em class="italic">Parts of the UI Toolkit System</em> section of this chapter, the UI Document component <a id="_idIndexMarker1058" class="pcalibre pcalibre1 calibre6"/>must be added to a GameObject in your scene so that the UI you’ve created can be rendered. You can do this by either adding the UI Document component to an existing GameObject or selecting <strong class="bold">+</strong> | <strong class="bold">UI Toolkit</strong> | <strong class="bold">UI Document</strong>. This GameObject will have a <strong class="bold">Transform</strong> component and a <strong class="bold">UI </strong><strong class="bold">Document</strong> component.</p>
<div><div><img alt="Figure 18.13: The Inspector of a UIDocument GameObject" src="img/B18327_18_13.jpg" class="calibre591"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.13: The Inspector of a UIDocument GameObject</p>
<p class="calibre3">If you do not already have a folder called <code>UI Toolkit</code> within your projects’s <code>Assets</code> folder, one will automatically be created for you. Within it, you will find a <code>PanelSettings</code> asset, and a folder called <code>UnityThemes</code>. Within <code>UnityThemes</code>, you will find a TSS file called <code>UnityDefaultRuntimeTheme.tss</code>. Your <code>UIDocument</code> GameObject’s <code>PanelSettings</code> asset assigned to the <code>.umxl</code> file you<a id="_idIndexMarker1059" class="pcalibre pcalibre1 calibre6"/> created into the <strong class="bold">Source Asset</strong> property to view the UI you created in your scene.</p>
<p class="calibre3">Now that we know the basics of building and rendering our UI, let’s look at how to code the interactions of UI created with the UI Toolkit.</p>
<h1 id="_idParaDest-296" class="calibre5"><a id="_idTextAnchor491" class="pcalibre pcalibre1 calibre6"/>Making The UI interactable with C#</h1>
<p class="calibre3">The UI Builder and your<a id="_idIndexMarker1060" class="pcalibre pcalibre1 calibre6"/> UXML document only handle the visual properties of <a id="_idIndexMarker1061" class="pcalibre pcalibre1 calibre6"/>your UI. While you can assign some basic responses (like changing visuals on hover) through the use of style sheets, you will need to create C# scripts to handle any logic or events related to your UI.</p>
<h2 id="_idParaDest-297" class="calibre7"><a id="_idTextAnchor492" class="pcalibre pcalibre1 calibre6"/>The UIElements namespaces</h2>
<p class="calibre3">To be able to write code that interfaces with UI <a id="_idIndexMarker1062" class="pcalibre pcalibre1 calibre6"/>Documents, you must use the <code>UnityEngine.UIElements</code> namespace. If you are using the UI Toolkit to make editor<a id="_idIndexMarker1063" class="pcalibre pcalibre1 calibre6"/> UI, you may also need the <code>UnityEditor.UIElements</code> namespace.</p>
<p class="callout-heading">Note</p>
<p class="callout">For more information about the <strong class="source-inline1">UnityEngine.UIElements</strong> and <strong class="source-inline1">UnityEditor.UIElements</strong> namespaces, see the following resource: <a href="https://docs.unity3d.com/Packages/com.unity.ui@1.0/api/UnityEditor.UIElements.xhtml" class="pcalibre pcalibre1 calibre6">https://docs.unity3d.com/Packages/com.unity.ui@1.0/api/UnityEditor.UIElements.xhtml</a>.</p>
<h2 id="_idParaDest-298" class="calibre7"><a id="_idTextAnchor493" class="pcalibre pcalibre1 calibre6"/>Getting a reference to UI Documents variables</h2>
<p class="calibre3">Within your C# script, you can<a id="_idIndexMarker1064" class="pcalibre pcalibre1 calibre6"/> create a reference variable to a <code>UIDocument</code> type. You can assign this variable in the same way you would generally assign a variable of another class: assigning it in the <code>GetComponent</code>, passing a reference to it from another script, and so on.</p>
<p class="callout-heading">Note</p>
<p class="callout">While you can use <strong class="source-inline1">FindObjectOfType</strong>, this is not recommended for finding a reference to a <strong class="source-inline1">UIDocument</strong>, as you will very likely have multiple UI Documents in your scene.</p>
<p class="calibre3">After you get a reference to the <code>UIDocument</code> you want to work with, you can get a reference to the Visual <a id="_idIndexMarker1065" class="pcalibre pcalibre1 calibre6"/>Elements within it (e.g., the buttons, labels, etc.) by getting a reference to the root Visual Element on the UI Document, then <code>Querying</code> that element for the Visual Element <a id="_idIndexMarker1066" class="pcalibre pcalibre1 calibre6"/>type by its name.</p>
<p class="calibre3">For example, in the UI shown earlier in the chapter, I have renamed the <code>Label</code> to <code>DogLabel</code> and the <code>Button</code> to <code>CatButton</code>, as shown in the following figure:</p>
<div><div><img alt="Figure 18.14: New names for Label and Button" src="img/B18327_18_14.jpg" class="calibre592"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.14: New names for Label and Button</p>
<p class="calibre3">To create a reference to these variables in a C# script, I first created reference variables for the <code>UIDocument</code>, the <code>Label</code>, and the <code>Button</code>, with the following code:</p>
<pre class="source-code">
[SerializeField] private UIDocument uiDocument;
private Label dogLabel;
private Button catButton;</pre> <p class="calibre3">The <code>uiDocument</code> variable will be assigned in the Inspector. As with all <code>MonoBehaviour</code> scripts, this script needed to be attached to a GameObject in the scene. I attached this script to the <code>UIDocument</code> GameObject and then dragged the <code>UIDocument</code> GameObject into the <strong class="bold">Ui </strong><strong class="bold">Document</strong> property.</p>
<div><div><img alt="Figure 18.15: Assigning the UIDocument to the script" src="img/B18327_18_15.jpg" class="calibre593"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.15: Assigning the UIDocument to the script</p>
<p class="calibre3">It’s important to note that when<a id="_idIndexMarker1067" class="pcalibre pcalibre1 calibre6"/> you reference a <code>UIDocument</code> in C#, you are referencing the <code>UIDocument</code> component, not a UI Document <a id="_idIndexMarker1068" class="pcalibre pcalibre1 calibre6"/>source file.</p>
<p class="calibre3">To initialize <code>dogLabel</code> and <code>catButton</code>, I got a reference to the <code>rootVisualElement</code> on the <code>uiDocument</code>, then used the <code>Query</code> method to find each Visual Element.</p>
<pre class="source-code">
void Start(){
      var root = uiDocument.rootVisualElement;
      dogLabel = root.Q&lt;Label&gt;("DogLabel");
      catButton = root.Query&lt;Button&gt;("CatButton");
}</pre> <p class="calibre3">Notice how I used <code>root.Q</code> to find the <code>Label</code> and <code>root.Query</code> to find the <code>Button</code>. You can use either one, and I only did this so you can see that there are two different ways to do it. It is up to your preference which one you use.</p>
<h2 id="_idParaDest-299" class="calibre7"><a id="_idTextAnchor494" class="pcalibre pcalibre1 calibre6"/>Managing Visual Element events</h2>
<p class="calibre3">Since the UXML document does not manage events, you can find out if the UI defined in the UXML document is interacted with<a id="_idIndexMarker1069" class="pcalibre pcalibre1 calibre6"/> by either subscribing to an event or registering a callback method when the event is triggered.</p>
<p class="calibre3">For example, if I want to log a message in the Console when the <code>catButton</code> is clicked, I need to create a method that is subscribed to the <code>catButton</code>’s <code>clicked</code> event.</p>
<p class="calibre3">First, I add the following method to my script:</p>
<pre class="source-code">
private void OnCatButtonClicked() {
     Debug.Log("CatButtonClicked");
}</pre> <p class="calibre3">Then, I need to subscribe to the <code>catButton</code>’s <code>clicked</code> event, with the following in the <code>Start()</code> method.</p>
<pre class="source-code">
catButton.clicked += OnCatButtonClicked;</pre> <p class="calibre3">To avoid any errors with the event subscription when the GameObject is disabled or destroyed, I unsubscribe from the event in the <code>OnDisable()</code> method.</p>
<pre class="source-code">
private void OnDisable() {
     catButton.clicked -= OnCatButtonClicked;
}</pre> <p class="calibre3">This causes the <code>OnCatButtonClicked</code> message to display in the Console whenever you click the button.</p>
<h2 id="_idParaDest-300" class="calibre7"><a id="_idTextAnchor495" class="pcalibre pcalibre1 calibre6"/>Accessing Visual Element properties</h2>
<p class="calibre3">Similar to the way uGUI GameObjects can have<a id="_idIndexMarker1070" class="pcalibre pcalibre1 calibre6"/> their properties changed via C# code, a Visual Element can have its properties adjusted via C# code, as well. For example, changing the <code>OnCatButtonClicked()</code> method to the following will make the word <code>Text</code> change to <code>Meow!</code></p>
<pre class="source-code">
public Camera theCamera;
void Update()
{
    transform.LookAt(2 * transform.position - theCamera.transform.position);
}</pre> <p class="calibre3">The preceding code causes the UI to appear as follows:</p>
<div><div><img alt="Figure 18.16: The UI after the text changes via a button click" src="img/B18327_18_16.jpg" class="calibre594"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.16: The UI after the text changes via a button click</p>
<p class="calibre3">There is a lot more I <a id="_idIndexMarker1071" class="pcalibre pcalibre1 calibre6"/>could say about working with the UI Toolkit, but as I said at the beginning of this chapter, I could only give a general overview—otherwise, I’d have to write a whole separate book just on the UI Toolkit! However, I believe I’ve given enough of an overview of the important concepts so that you can dive into working with the examples in the next section.</p>
<h1 id="_idParaDest-301" class="calibre5"><a id="_idTextAnchor496" class="pcalibre pcalibre1 calibre6"/>Examples</h1>
<p class="calibre3">Now that we have the basic building blocks we need to get started with actually creating some UI with UI Toolkit. I didn’t dive deep into style sheets or the properties of the various Visual Elements, but I’ll show some examples that will expand upon that here. If after completing these examples, you want to learn more, see the <em class="italic">Resources</em> section for a bunch of examples and documentation.</p>
<p class="calibre3">When using the UI Toolkit to<a id="_idIndexMarker1072" class="pcalibre pcalibre1 calibre6"/> develop UI, there are two main parts to the work:</p>
<ul class="calibre16">
<li class="calibre14">Laying out the UI with the UI Builder (or by editing the UXML document)</li>
<li class="calibre14">Writing C# code to add functionality to the UI</li>
</ul>
<p class="calibre3">So, each of these examples will be broken into two parts: one for building the UI and the other for writing the functionality.</p>
<p class="calibre3">Because the UI Toolkit <a id="_idIndexMarker1073" class="pcalibre pcalibre1 calibre6"/>can be used for both Editor and runtime UI, I’ll show you one example of both. Let’s start with the Editor example!</p>
<h2 id="_idParaDest-302" class="calibre7"><a id="_idTextAnchor497" class="pcalibre pcalibre1 calibre6"/>Using the UI Toolkit to make an Editor virtual pet</h2>
<p class="calibre3">While the primary focus of this book is on runtime UI, I would be remiss to show you how to use the UI Toolkit to make some Editor UI, since that’s one of its main benefits. Editor UI is usually used for tools to<a id="_idIndexMarker1074" class="pcalibre pcalibre1 calibre6"/> facilitate development, improve productivity, streamline your workflow, and so on. Originally, I planned to show you how to make some generic Editor tools that you could expand to improve your workflow. However, I decided instead to make an Editor tool that can improve your mood. Self-care is essential to productivity, after all! While this example might not have any practical purposes in the traditional sense, it’s fun and it shows you how to use lots of Editor UI features, so it’s a win-win.</p>
<p class="calibre3">This example covers how to make a virtual pet that hangs out with you in a window in your Editor and compliments you when you click on it. This also demonstrates how to create animated sprite sheets within the Unity Editor.</p>
<div><div><img alt="Figure 18.17: The Editor virtual pet created in this example" src="img/B18327_18_17.jpg" class="calibre595"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.17: The Editor virtual pet created in this example</p>
<p class="calibre3">The cat sprite used in this example is derived from the public domain art asset provided here: <a href="https://opengameart.org/content/a-cat" class="pcalibre pcalibre1 calibre6">https://opengameart.org/content/a-cat</a>.</p>
<p class="callout-heading">Note</p>
<p class="callout">For this example, since we are making an Editor Tool that is not related to any of the work we’ve done so far, you might want to create a new Unity project to complete this work in. If you do, you will need to reimport any 2D UI packages.</p>
<p class="calibre3">Let’s start with laying out<a id="_idIndexMarker1075" class="pcalibre pcalibre1 calibre6"/> the UI with the UI Builder!</p>
<h3 class="calibre9">Using the UI Builder to make our Editor Window’s UI</h3>
<p class="calibre3">To create the virtual pet shown in <em class="italic">Figure 18</em><em class="italic">.17</em>, complete the following steps:</p>
<ol class="calibre13">
<li class="calibre14">When writing code for your <a id="_idIndexMarker1076" class="pcalibre pcalibre1 calibre6"/>Editor, you should put all your editor code within an <code>Editor</code> folder. This signifies to Unity that any code within it is only to be used for the Editor and not at runtime. Create a folder in <code>Assets</code> called <code>Editor</code> and a folder within it called <code>Resource</code>.</li>
<li class="calibre14">Drag the <code>idleCat.png</code> sprite sheet found in the book’s source files into your newly created <code>Assets/Editor/Resources</code> folder.</li>
<li class="calibre14">Set its <strong class="bold">Import Settings</strong> so that its <strong class="bold">Texture Type</strong> is <strong class="bold">Sprite (2D and UI)</strong> and <strong class="bold">Sprite Mode</strong> is <strong class="bold">Multiple</strong>.</li>
<li class="calibre14">Open the <strong class="bold">Sprite Editor</strong> and you’ll notice that the images are extremely blurry. We need to edit the import settings further to fix this.</li>
</ol>
<div><div><img alt="Figure 18.18: The blurry sprite sheet" src="img/B18327_18_18.jpg" class="calibre596"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.18: The blurry sprite sheet</p>
<ol class="calibre13">
<li value="5" class="calibre14">Return to the sprite’s <code>64</code> and <strong class="bold">Compression</strong> to <strong class="bold">None</strong>. Also, change the <strong class="bold">Filter Mode</strong> to <strong class="bold">Point (</strong><strong class="bold">no filter)</strong>.</li>
<li class="calibre14">Select <strong class="bold">Apply</strong> and the sprites<a id="_idIndexMarker1077" class="pcalibre pcalibre1 calibre6"/> should now be crisp pixel art cats.</li>
<li class="calibre14">Now, return to the <code>16</code> x <code>16</code>.</li>
</ol>
<div><div><img alt="Figure 18.19: The sliced sprite sheet" src="img/B18327_18_19.jpg" class="calibre597"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.19: The sliced sprite sheet</p>
<ol class="calibre13">
<li value="8" class="calibre14">Select the <strong class="bold">Slice</strong> button to <a id="_idIndexMarker1078" class="pcalibre pcalibre1 calibre6"/>confirm the changes, then select <strong class="bold">Apply</strong> to commit the changes. You can now close the <strong class="bold">Sprite Editor</strong>.</li>
<li class="calibre14">Now that we have our sprite imported properly, we’re ready to build out the Editor UI in the UI Builder. Open the UI Builder with <strong class="bold">Window</strong> | <strong class="bold">UI Toolkit</strong> | <strong class="bold">UI Builder</strong>.</li>
<li class="calibre14">Select the <code>&lt;unsaved file&gt;.uxml</code> UI Document in the <strong class="bold">Hierarchy</strong> to bring up its properties in the <strong class="bold">Inspector</strong>.</li>
</ol>
<div><div><img alt="Figure 18.20: The UXML file’s Inspector" src="img/B18327_18_20.jpg" class="calibre598"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.20: The UXML file’s Inspector</p>
<ol class="calibre13">
<li value="11" class="calibre14">Now change <code>100</code> x <code>100</code>.</li>
<li class="calibre14">Save the UI Document by<a id="_idIndexMarker1079" class="pcalibre pcalibre1 calibre6"/> selecting <code>Assets/Editor/Resources</code> folder and name the file <code>IdleCat.uxml</code> (the <code>.uxml</code> extension is automatically added for you).</li>
<li class="calibre14">Now, let’s add the cat to the <strong class="bold">Viewport</strong>. Because we want to make the cat clickable, the easiest way to achieve this is to use a Button. Drag the icon from the <strong class="bold">Controls Panel</strong> to the <strong class="bold">Viewport</strong>. Note once you do so the Button will be positioned at the top of the container.</li>
</ol>
<div><div><img alt="Figure 18.21: Adding a Button" src="img/B18327_18_21.jpg" class="calibre599"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.21: Adding a Button</p>
<ol class="calibre13">
<li value="14" class="calibre14">Select the <code>Button</code> in the <strong class="bold">Hierarchy</strong> to open its Inspector.</li>
<li class="calibre14">Expand the <strong class="bold">Background</strong> property<a id="_idIndexMarker1080" class="pcalibre pcalibre1 calibre6"/> so that you can change the look of the button.</li>
<li class="calibre14">Select <strong class="bold">Sprite</strong> from the dropdown menu next to the <strong class="bold">Image</strong> property. This will allow you to select images of <strong class="bold">Sprite</strong> type.</li>
</ol>
<div><div><img alt="Figure 18.22: Changing the Background Image type to Sprite" src="img/B18327_18_22.jpg" class="calibre600"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.22: Changing the Background Image type to Sprite</p>
<ol class="calibre13">
<li value="17" class="calibre14">Select the circle in the <code>idleCat_0</code>. You should see the following in your <strong class="bold">Viewport</strong> once you do so:</li>
</ol>
<div><div><img alt="Figure 18.23: The Button with the cat image applied" src="img/B18327_18_23.jpg" class="calibre601"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.23: The Button with the cat image applied</p>
<ol class="calibre13">
<li value="18" class="calibre14">Let’s get that text out <a id="_idIndexMarker1081" class="pcalibre pcalibre1 calibre6"/>of the way. At the top of the <code>Button</code> from the <strong class="bold">Text</strong> property.</li>
</ol>
<div><div><img alt="Figure 18.24: Removing the Text from the button" src="img/B18327_18_24.jpg" class="calibre602"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.24: Removing the Text from the button</p>
<ol class="calibre13">
<li value="19" class="calibre14">Now, let’s make it the <a id="_idIndexMarker1082" class="pcalibre pcalibre1 calibre6"/>appropriate dimensions. Expand the <code>auto</code> x <code>auto</code> to <code>64</code> x <code>64</code>.</li>
</ol>
<div><div><img alt="Figure 18.25: Changing the button size" src="img/B18327_18_25.jpg" class="calibre603"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.25: Changing the button size</p>
<ol class="calibre13">
<li value="20" class="calibre14">Visual Elements always initialize in the UI Document root container at the top-left corner. If you want to be able to position them within the container, you have to create a high-level Visual Element that acts as the “shell” in which all the other items can be positioned within. So, to make this <code>Button</code> centered within the window, we will need to add a Visual Element to contain it. Drag <code>VisualElement</code> from the <strong class="bold">Library</strong> into the <strong class="bold">Hierarchy</strong>.</li>
</ol>
<div><div><img alt="Figure 18.26: Adding a Visual Element to the Hierarchy" src="img/B18327_18_26.jpg" class="calibre604"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.26: Adding a Visual Element to the Hierarchy</p>
<ol class="calibre13">
<li value="21" class="calibre14">Within the <code>Button</code> onto the <code>VisualElement</code>. This will<a id="_idIndexMarker1083" class="pcalibre pcalibre1 calibre6"/> cause the <code>Button</code> to be a child of the <code>VisualElement</code>.</li>
</ol>
<div><div><img alt="Figure 18.27: Making the Button a child of VisualElement" src="img/B18327_18_27.jpg" class="calibre605"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.27: Making the Button a child of VisualElement</p>
<ol class="calibre13">
<li value="22" class="calibre14">Select <code>VisualElement</code> from the <strong class="bold">Hierarchy</strong> to open its <strong class="bold">Inspector</strong>.</li>
<li class="calibre14">You may notice that the <code>VisualElement</code> does not fully fit within the root container. Expand<a id="_idIndexMarker1084" class="pcalibre pcalibre1 calibre6"/> the <code>1</code>. This will cause the <code>VisualElement</code> to fill the whole root container.</li>
</ol>
<div><div><img alt="Figure 18.28: Updating the Grow property" src="img/B18327_18_28.jpg" class="calibre606"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.28: Updating the Grow property</p>
<ol class="calibre13">
<li value="24" class="calibre14">Now, let’s center the cat within the <code>VisualElement</code>. Expand the <code>VisualElement</code> and center for both the <strong class="bold">Align Items</strong> and <strong class="bold">Justify </strong><strong class="bold">Content</strong> properties.</li>
</ol>
<div><div><img alt="Figure 18.29: Adjusting the Align properties of the VisualElement" src="img/B18327_18_29.jpg" class="calibre607"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.29: Adjusting the Align properties of the VisualElement</p>
<ol class="calibre13">
<li value="25" class="calibre14">Let’s change the background color of the <code>VisualElement</code>. In the <code>BE8D8D</code> by selecting the color block and typing <code>BE8D8D</code> into the <strong class="bold">Hexidecimal</strong> property.</li>
</ol>
<div><div><img alt="Figure 18.30: Adjusting the VisualElement’s background color" src="img/B18327_18_30.jpg" class="calibre608"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.30: Adjusting the VisualElement’s background color</p>
<ol class="calibre13">
<li value="26" class="calibre14">Now, it’s easy to see there’s some background and border around our cat <code>Button</code> that we don’t want. To remove this, select the <code>Button</code> and change its background color so that the alpha is <code>0</code>.</li>
</ol>
<div><div><img alt="Figure 18.31: Removing the Button’s background color" src="img/B18327_18_31.jpg" class="calibre609"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.31: Removing the Button’s background color</p>
<ol class="calibre13">
<li value="27" class="calibre14">There is still a border around the <code>Button</code> that we don’t want. Expand the <code>0</code>. You should now have the following:</li>
</ol>
<div><div><img alt="Figure 18.32: The final UI look" src="img/B18327_18_32.jpg" class="calibre610"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.32: The final UI look</p>
<ol class="calibre13">
<li value="28" class="calibre14">We’re almost done with the UI Builder. The last thing we need to do is rename <code>Button</code> so that it will be easily accessible in our C# code. Double-click on <code>Button</code> in the <code>CatButton</code>.</li>
<li class="calibre14">Save your work by pressing <em class="italic">Ctrl</em> + <em class="italic">S</em> and we’re done! You should have the following:</li>
</ol>
<div><div><img alt="Figure 18.33: The IdleCat.uxml Hierarchy with appropriate names" src="img/B18327_18_33.jpg" class="calibre611"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.33: The IdleCat.uxml Hierarchy with appropriate names</p>
<p class="callout-heading">Note</p>
<p class="callout">If a <strong class="source-inline1">UIDocument</strong> GameObject was added to your currently open scene, you may see a warning about a Panel Setting missing in your <strong class="bold">Console</strong>. You can just delete this GameObject and dismiss the error message.</p>
<p class="calibre3">Now that our UI is fully laid out, we <a id="_idIndexMarker1086" class="pcalibre pcalibre1 calibre6"/>can write the code to start adding in the functionality!</p>
<h3 class="calibre9">Writing C# code to make our Editor Window and add functionality</h3>
<p class="calibre3">To get our cat to appear as a window in our <a id="_idIndexMarker1087" class="pcalibre pcalibre1 calibre6"/>Unity Editor and have functionality, we need to write some C# Editor code. There are a few things we want the cat to do:</p>
<ul class="calibre16">
<li class="calibre14">Appear in a floating window when you use a <strong class="bold">Tools</strong> menu or use pre-defined hotkeys</li>
<li class="calibre14">Say “meow” when you hover over it</li>
<li class="calibre14">Compliment you in the <strong class="bold">Console</strong> when you click on it</li>
<li class="calibre14">Sit with a looping idle animation</li>
<li class="calibre14">Play a standing animation when you click on it (aka pet it)</li>
</ul>
<p class="calibre3">We can achieve all of this in one C# script. To have your virtual pet appear in a window within your Unity Editor, complete the following steps:</p>
<ol class="calibre13">
<li class="calibre14">Within your <code>Editor</code> folder, create a C# script called <code>IdleCat.cs</code> and open it.</li>
<li class="calibre14">The first thing we need to do is change our script from a <code>MonoBehaviour</code> to an <code>EditorWindow</code>. Change the class definition to the following:<pre class="source-code">
public class IdleCat : EditorWindow {</pre><p class="calibre3">This will automatically add the <code>UnityEditor</code> namespace.</p></li> <li class="calibre14">We will have the window appear by selecting <code>IdleCat.cs</code> script:<pre class="source-code">
[MenuItem("Tools/I'm Lonely _%#K")]
 public static void ShowIdleCat() {
     EditorWindow window = GetWindow&lt;IdleCat&gt;();
     window.titleContent = new GUIContent("Kitty");
}</pre><p class="calibre3">In the preceding code, the <code>[MenuItem("Tools/I'm Lonely _%#K")]</code> line creates the <code>ShowIdleCat()</code> method when it is selected. <code>_%#K</code> signifies that this can also be achieved with the <em class="italic">Ctrl</em> + <em class="italic">Shift</em> + <em class="italic">K</em> shortcut.</p><p class="calibre3">The following lines instantiate the window and set its title to <strong class="bold">Kitty</strong>:</p><pre class="source-code">EditorWindow window = GetWindow&lt;IdleCat&gt;();
window.titleContent = new GUIContent("Kitty");</pre><p class="calibre3">Save your code and you <a id="_idIndexMarker1088" class="pcalibre pcalibre1 calibre6"/>should see the menu item in your Editor. Clicking it or typing <em class="italic">Ctrl</em> + <em class="italic">Shift</em> + <em class="italic">K</em> should bring up a window named <strong class="bold">Kitty</strong>.</p></li> </ol>
<div><div><img alt="Figure 18.34: The Tools menu and the Kitty window" src="img/B18327_18_34.jpg" class="calibre612"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.34: The Tools menu and the Kitty window</p>
<ol class="calibre13">
<li value="4" class="calibre14">Your window may be a<a id="_idIndexMarker1089" class="pcalibre pcalibre1 calibre6"/> different size than mine. Don’t worry. Let’s set the size via code. Add the following two lines of code to your <code>ShowIdleCat()</code> method:<pre class="source-code">
window.maxSize = new Vector2(100, 100);
window.minSize = window.maxSize;</pre><p class="calibre3">This will not automatically change the size of your currently open window, because this function only runs when you use the menu item or the shortcut keys. You can now resize your window by doing one of those actions now. You do not need to close the window. You can do this while it is still open.</p><p class="calibre3">One thing to note is that Editor Windows can be docked throughout the Unity Editor. So, the size of your window can change based on where the user docks it.</p></li> <li class="calibre14">Now, we need to reference the <a id="_idIndexMarker1090" class="pcalibre pcalibre1 calibre6"/>UI Document we created with the UI Builder in this script. Since this is an Editor script, it can’t be attached to a GameObject. That means we can’t assign the variable via drag and drop or using <code>GetComponent</code>. Instead, we will have to load it via from our <code>Editor/Resources</code> folder.<p class="calibre3">When working with Editor UI, the <code>CreateGUI()</code> method is an Event Function used to initialize the UI.</p><p class="calibre3">Write the following code, making sure to add the <code>UnityEngine.UIElements</code> namespace to the top of the script:</p><pre class="source-code">
private void CreateGUI() {
     var root = rootVisualElement;
     var quickToolVisualTree = Resources.Load&lt;VisualTreeAsset&gt;("IdleCat");
     quickToolVisualTree.CloneTree(root);
}</pre><p class="calibre3">This code block does a few things. First, it gets the <code>rootVisualElement</code> of the Editor Window we have created. Then, it finds the <code>IdleCat.uxml</code> file by searching for a <code>VisualTreeAsset</code> named <code>IdleCat</code> within the <code>Editor/Resources</code> folder. Then, it clones the <code>IdleCat.uxml</code> UI Document and places it within the window’s root.</p><p class="calibre3">If you return to the Editor, you should now see your Kitty on the pink background in your open window.</p></li> </ol>
<div><div><img alt="Figure 18.35: The window with the appropriate size and UI Document" src="img/B18327_18_35.jpg" class="calibre613"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.35: The window with the appropriate size and UI Document</p>
<ol class="calibre13">
<li value="6" class="calibre14">Now, we need to get access to the button. Add the following variable declaration to your <a id="_idIndexMarker1091" class="pcalibre pcalibre1 calibre6"/>script:<pre class="source-code">
private Button catButton;</pre></li> <li class="calibre14">To assign the <code>catButton</code>, we need to <code>Query</code> the <code>root</code> object. Add the following line to your <code>CreateGUI()</code> method:<pre class="source-code">
catButton = root.Q&lt;Button&gt;("CatButton");</pre></li> <li class="calibre14">Next, let’s have the tooltip appear when we hover over the button. Add the following line of code to the <code>CreateGUI()</code> method:<pre class="source-code">
catButton.tooltip = "meow";</pre><p class="calibre3">After you save the script, you should be able to immediately see these changes reflected in your Editor. (Note that my screenshot tool doesn’t capture the mouse cursor, so it is not shown in the following figure.)</p></li> </ol>
<div><div><img alt="Figure 18.36: The meow tooltip" src="img/B18327_18_36.jpg" class="calibre614"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.36: The meow tooltip</p>
<ol class="calibre13">
<li value="9" class="calibre14">Now, we can have the cat compliment you when you click on it. First, let’s create a new method called <code>OnCatButtonClicked()</code> that shows the <code>"You're doing great!"</code> message in the Console. Add the following code to your script:<pre class="source-code">
private void OnCatButtonClicked()
{
    Debug.Log("You're doing great!");
}</pre></li> <li class="calibre14">We need to have the <code>OnCatButtonClicked()</code> method subscribe and unsubscribe to the click<a id="_idIndexMarker1092" class="pcalibre pcalibre1 calibre6"/> event on <code>catButton</code>. Add the following line to your <code>CreateGUI()</code> method:<pre class="source-code">
catButton.clicked += OnCatButtonClicked;</pre><p class="calibre3">Also, create the following <code>OnDisable()</code> method:</p><pre class="source-code">private void OnDisable()
{
    catButton.clicked -= OnCatButtonClicked;
}</pre><p class="calibre3">Once you save, you can already see the cat compliment you in the Console when you click on it.</p></li> </ol>
<p class="calibre3"> </p>
<div><div><img alt="Figure 18.37: The complimenting cat" src="img/B18327_18_37.jpg" class="calibre615"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.37: The complimenting cat</p>
<ol class="calibre13">
<li value="11" class="calibre14">Our last two goals for our virtual pet involve animating it. This takes a bit of effort. We can’t use a Unity animation to achieve it because we’re in the Editor. So, we have to write code<a id="_idIndexMarker1093" class="pcalibre pcalibre1 calibre6"/> that will swap out the background on our <code>catButton</code> with the appropriate image via code on some kind of timer.<p class="calibre3">One way to do this is with <strong class="bold">coroutines</strong>, but <a id="_idIndexMarker1094" class="pcalibre pcalibre1 calibre6"/>unfortunately, coroutines do not work by default in the Editor. However, we can use coroutines in our Editor by importing the Editor Coroutines package from Unity.</p><p class="calibre3">To do that, select <strong class="bold">Window</strong> | <strong class="bold">Package Manager</strong> to open the <strong class="bold">Package Manager</strong>.</p></li>
<li class="calibre14"> Select <strong class="bold">Package: Unity Registry</strong> from the dropdown to view all available Unity packages.</li>
</ol>
<div><div><img alt="Figure 18.38: Changing which packages appear in the Package Manager" src="img/B18327_18_38.jpg" class="calibre616"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.38: Changing which packages appear in the Package Manager</p>
<ol class="calibre13">
<li value="13" class="calibre14">Now, scroll until you see <strong class="bold">Editor Coroutines</strong>. It will likely be locked. If it is, select <strong class="bold">Unlock</strong>.</li>
</ol>
<div><div><img alt="Figure 18.39: Unlocking the Editor Coroutines package" src="img/B18327_18_39.jpg" class="calibre617"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.39: Unlocking the Editor Coroutines package</p>
<ol class="calibre13">
<li value="14" class="calibre14">Now that you’ve unlocked<a id="_idIndexMarker1095" class="pcalibre pcalibre1 calibre6"/> the Editor Coroutines package, you can add the following namespace to the top of your <code>IdleCat.cs</code> script:<pre class="source-code">
using Unity.EditorCoroutines.Editor;</pre><p class="calibre3">Now, we can use <code>EditorCoroutines</code> in our code! They work pretty similarly to regular coroutines. But, before we write our first Editor coroutine to control our animations, let’s get access to the images we’ll want to use in our animation and write some helper functions.</p></li> <li class="calibre14">I want the cat to have two animations: an idle animation and a petting animation (which will be triggered by the mouse click). I’ll store the images for these animations in two separate Lists. To use them as background images, I’ll need to store them in lists of <code>StyleBackgrounds</code>. Add the following to your class:<pre class="source-code">
private List&lt;StyleBackground&gt; idleBackgrounds = new List&lt;StyleBackground&gt;();
private List&lt;StyleBackground&gt; pettingBackgrounds = new List&lt;StyleBackground&gt;();</pre></li> <li class="calibre14">Before we can store the appropriate sprites in those Lists, we need to get a reference to all of the sprites from the sprite sheet. We’ll do this similarly to how we found the UI Document file earlier. Add the following line of code to your <code>CreateGUI()</code> method:<pre class="source-code">
Sprite[] allSprites = Resources.LoadAll&lt;Sprite&gt;("idleCat");</pre><p class="calibre3">This will look in the <code>Editor/Resources</code> folder and store all of the sprites with the name <code>idleCat</code> to the <code>allSprites</code> array.</p></li> <li class="calibre14">The following frames will <a id="_idIndexMarker1096" class="pcalibre pcalibre1 calibre6"/>represent the specific animations:
<div><div><img alt="Figure 18.40: Which sprites go to which animation" src="img/B18327_18_40.jpg" class="calibre618"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.40: Which sprites go to which animation</p>
<p class="calibre3">Now, we need to loop through the <code>allSprites</code> array and divvy those sprites up into the correct list. We can do so by adding the following code to the <code>CreateGUI()</code> method:</p>
<pre class="source-code">
for (int i = 0; i &lt;= allSprites.Length - 1; i++)
{
    StyleBackground backgroundImage = new StyleBackground(allSprites[i]);
    if (i &lt; 11)
    {
        pettingBackgrounds.Add(backgroundImage);
    }
    if (i &gt;= 10)
    {
        idleBackgrounds.Add(backgroundImage);
    }
}</pre> </li>
</ol><ol class="calibre13">
<li value="18" class="calibre14">Before we can write the methods that swap out the background with the correct image, we need to add a variable that will keep track of which frame of which animation the button is currently displaying. Add the following variable initialization to your class:<pre class="source-code">
private int animationIndex = 0;</pre></li> <li class="calibre14">OK, now we need to <a id="_idIndexMarker1097" class="pcalibre pcalibre1 calibre6"/>write methods that will increase the <code>animationIndex</code> and set the <code>catButton</code>’s <code>backgroundImage</code> to the appropriate sprite. Add the following method to your class to control the animation for the idle animation:<pre class="source-code">
private void IdleAnimation()
{
    animationIndex++;
    if (animationIndex &gt;= idleBackgrounds.Count)
    {
        animationIndex = 0;
    }
    
    catButton.style.backgroundImage = idleBackgrounds[animationIndex];
}</pre><p class="calibre3">Notice that when the index is out of range, it loops back around to <code>0</code>.</p></li> <li class="calibre14">Add a similar method to control the petting animation:<pre class="source-code">
private void PettingAnimation()
{
    animationIndex++;
    if (animationIndex &gt;= pettingBackgrounds.Count)
    {
        animationIndex = 0;
    }
    
    catButton.style.backgroundImage = pettingBackgrounds[animationIndex];
}</pre></li> </ol>
<p class="callout-heading">Note</p>
<p class="callout">The <strong class="source-inline1">IdleAnimation()</strong> and <strong class="source-inline1">PettingAnimation()</strong> methods have some reusable code and could be refactored for brevity; however, for clarity, I will keep it the way it is.</p>
<ol class="calibre13">
<li value="21" class="calibre14">Now, we’re ready to use an <code>EditorCortoutine</code> to call these methods and get the animations playing. Let’s start by creating the following Editor coroutine:<pre class="source-code">
IEnumerator NextAnimationFrame()
{
    var waitForOneSecond = new EditorWaitForSeconds(1f);
    
    while (true)
    {
        yield return waitForOneSecond;
        IdleAnimation();
    }
}</pre><p class="calibre3">This will create an infinite loop that runs the <code>IdleAnimation()</code> method every second.</p></li> <li class="calibre14">We need to start the Editor coroutine that we wrote in the previous step. Add the following code to your <code>CreateGUI()</code> method:<pre class="source-code">
EditorCoroutineUtility.StartCoroutine(NextAnimationFrame(), this);</pre></li> <li class="calibre14">If you return to your Editor, you should be able to see the cat flicking its tail while it loops through its<a id="_idIndexMarker1098" class="pcalibre pcalibre1 calibre6"/> idle animation. Now, we need to write some code that will make the petting animation play when you click on the cat. To do this, we need another variable. Add the following to your class:<pre class="source-code">
private bool idle = true;</pre><p class="calibre3">This variable will keep track of whether or not the cat should be idling.</p></li> <li class="calibre14">Add the following to the <code>OnCatButtonClicked()</code> method to signify cat should no longer be idle once it is clicked:<pre class="source-code">
idle = false;</pre></li> <li class="calibre14">Update the <code>NextAnimationFrame()</code> Editor coroutine so that it switches between the idle and petting animations based on the <code>idle</code> variable. The code in bold is new:<pre class="source-code">
IEnumerator NextAnimationFrame()
{
    var waitForOneSecond = new EditorWaitForSeconds(1f);
    while (true)
    {
        yield return waitForOneSecond;
        if (idle)
        {
            IdleAnimation();
        }
        else
        {
            PettingAnimation();
        }
    }
}</pre></li> <li class="calibre14">Currently, if you click on the cat, it will enter the petting animation, but it will keep looping through that animation indefinitely. We need it to go back to the idle animation once the petting animation completes. Update the <code>PettingAnimation()</code> method to include <code>idle = true</code> inside the <code>if </code>statement. This will reset the <code>idle</code> variable to <code>true</code> when the animation is complete.</li>
<li class="calibre14">We’ve officially completed everything we set out to do, but there is one problem with our code. If <a id="_idIndexMarker1099" class="pcalibre pcalibre1 calibre6"/>you put a <code>Debug.Log</code> in the coroutine’s <code>while</code> loop and then close the <code>Debug.Log</code> keeps printing in the Console! We need to stop that coroutine’s <code>while</code> loop when the window closes. To do that, add another variable to your class:<pre class="source-code">
private bool windowOpen = true;</pre></li> <li class="calibre14">Change the <code>while</code> loop within the <code>NextAnimationFrame()</code> coroutine to the following:<pre class="source-code">
while (windowOpen) {</pre></li> <li class="calibre14">Now, we just need to set <code>windowOpen</code> to <code>false</code> when the window closes. So, add the following to the <code>OnDisable()</code> method:<pre class="source-code">
windowOpen = false;</pre></li> </ol>
<p class="calibre3">That’s it! You should now have a little kitty friend that hangs out with you while you work. Click on her whenever you need a little pick-me-up.</p>
<p class="calibre3">Using the UI Toolkit to make a menu with style sheets and animation transitions</p>
<p class="calibre3">We’ll look at how to use the UI Builder to <a id="_idIndexMarker1100" class="pcalibre pcalibre1 calibre6"/>create a basic menu that uses style sheets and transition animations, then we’ll hook up buttons within the menu to access web data and randomly generate content in this example.</p>
<p class="calibre3">Since the last example was a virtual pet meant to bring you happiness, I decided to stick with the theme of “self-care” for this example, as well. The following figure is a screenshot of the UI we will make <a id="_idIndexMarker1101" class="pcalibre pcalibre1 calibre6"/>with a randomly generated image of a cat and a quote retrieved from the web.</p>
<div><div><img alt="Figure 18.41: The UI menu with randomly generated content" src="img/B18327_18_41.jpg" class="calibre619"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.41: The UI menu with randomly generated content</p>
<p class="calibre3">Pressing the <strong class="bold">Charm Me</strong> button will randomly generate a cat picture and pressing the <strong class="bold">Inspire Me</strong> button will randomly generate an inspirational quote. Additionally, the buttons change color when hovered over and clicked on while animating to a slightly bigger shape.</p>
<p class="calibre3">As with the previous example, we will start by laying out the UI with the UI Builder.</p>
<h3 class="calibre9">Using the UI Builder to lay out a menu, make style sheets, and make animation transitions</h3>
<p class="calibre3"> To create the UI shown in <em class="italic">Figure 18</em><em class="italic">.41</em>, complete the following steps:</p>
<ol class="calibre13">
<li class="calibre14">Create a new<a id="_idIndexMarker1102" class="pcalibre pcalibre1 calibre6"/> scene called <code>Chapter18-Examples</code>.</li>
<li class="calibre14">Right-click in the Scene Hierarchy and select <code>Assets</code> folder called <code>UI Toolkit</code>. It will contain a <code>PanelSettings</code> asset and a <code>Unity </code><code>Themes</code> folder.</p></li>
<li class="calibre14">Within the <code>UI Toolkit</code> folder, right-click and select <code>InspirationalMenu.uxml</code>.</li>
<li class="calibre14">Drag the new UXML file into the <code>UIDocument</code> GameObject.</li>
<li class="calibre14">Just so that we have the same Game view resolution, set your Game scene view to <strong class="bold">840x630</strong>.</li>
</ol>
<div><div><img alt="Figure 18.42: Setting your Game view resolution" src="img/B18327_18_42.jpg" class="calibre620"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.42: Setting your Game view resolution</p>
<ol class="calibre13">
<li value="6" class="calibre14">Double-click on the <code>InspirationalMenu.uxml</code> file to <a id="_idIndexMarker1105" class="pcalibre pcalibre1 calibre6"/>open the UI Builder.</li>
<li class="calibre14">Select <code>InspirationalMenu.uxml</code> from the <strong class="bold">Hierarchy</strong> to view its <strong class="bold">Inspector</strong>.</li>
<li class="calibre14">Change<a id="_idIndexMarker1106" class="pcalibre pcalibre1 calibre6"/> the <strong class="bold">Canvas Size</strong> to <strong class="bold">Match Game View</strong>. This will cause the container in the <strong class="bold">Viewport</strong> to be the<a id="_idIndexMarker1107" class="pcalibre pcalibre1 calibre6"/> same size as your Game view.</li>
</ol>
<div><div><img alt="Figure 18.43: Setting the Canvas Size to Match Game View" src="img/B18327_18_43.jpg" class="calibre621"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.43: Setting the Canvas Size to Match Game View</p>
<ol class="calibre13">
<li value="9" class="calibre14">Drag a <strong class="bold">Button</strong> from the <strong class="bold">Controls</strong> window<a id="_idIndexMarker1108" class="pcalibre pcalibre1 calibre6"/> into the <strong class="bold">Viewport</strong>. It should stretch all the way across the container.</li>
<li class="calibre14">The <code>Button</code> should have <a id="_idIndexMarker1109" class="pcalibre pcalibre1 calibre6"/>a blue outline around it and a handle in its bottom-right corner. Select that handle to resize the button to a <a id="_idIndexMarker1110" class="pcalibre pcalibre1 calibre6"/>pleasing “button-like” size. It’s up to you what size.</li>
</ol>
<div><div><img alt="Figure 18.44: The Button element resized in the Viewport" src="img/B18327_18_44.jpg" class="calibre622"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.44: The Button element resized in the Viewport</p>
<ol class="calibre13">
<li value="11" class="calibre14">Change the text on <code>Button</code> to <code>Charm Me</code> by adjusting the <strong class="bold">Text</strong> property.</li>
</ol>
<div><div><img alt="Figure 18.45: How to change the text that displays on the button" src="img/B18327_18_45.jpg" class="calibre623"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.45: How to change the text that displays on the button</p>
<ol class="calibre13">
<li value="12" class="calibre14">Expand the <code>22</code>, and the <strong class="bold">Alignment</strong> to center vertically and horizontally. Drag the<a id="_idIndexMarker1112" class="pcalibre pcalibre1 calibre6"/> handle of <a id="_idIndexMarker1113" class="pcalibre pcalibre1 calibre6"/>the button to make it a bit bigger or smaller as needed to fit the new text size.</li>
</ol>
<div><div><img alt="Figure 18.46: The Text settings of Button" src="img/B18327_18_46.jpg" class="calibre624"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.46: The Text settings of Button</p>
<ol class="calibre13">
<li value="13" class="calibre14">Expand the <code>FF9BC8</code>.</li>
</ol>
<div><div><img alt="Figure 18.47: Changing the background color of the button" src="img/B18327_18_47.jpg" class="calibre625"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.47: Changing the background color of the button</p>
<ol class="calibre13">
<li value="14" class="calibre14">Expand the <code>5</code>, and<a id="_idIndexMarker1116" class="pcalibre pcalibre1 calibre6"/> the <code>10</code>.</li>
</ol>
<div><div><img alt="Figure 18.48: Adjusting the Border properties" src="img/B18327_18_48.jpg" class="calibre626"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.48: Adjusting the Border properties</p>
<ol class="calibre13">
<li value="15" class="calibre14">If you go to your <strong class="bold">Game</strong> view, you’ll notice that the colors aren’t exactly the same as they are in the UI Builder.
<div><div><img alt="Figure 18.49: The difference between the UI Builder Viewport and Editor Game View" src="img/B18327_18_49.jpg" class="calibre627"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.49: The difference between the UI Builder Viewport and Editor Game View</p>
<p class="calibre3">To make sure what <a id="_idIndexMarker1117" class="pcalibre pcalibre1 calibre6"/>you are seeing in the<a id="_idIndexMarker1118" class="pcalibre pcalibre1 calibre6"/> UI Builder matches your <strong class="bold">Game</strong> view, select <strong class="bold">Unity Default Runtime Theme</strong> from the dropdown in the top-right corner of the UI Builder <a id="_idIndexMarker1119" class="pcalibre pcalibre1 calibre6"/>Viewport.</p>
<div><div><img alt="Figure 18.50: Setting the Viewport to Unity Default Runtime Theme" src="img/B18327_18_50.jpg" class="calibre628"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.50: Setting the Viewport to Unity Default Runtime Theme</p></li>
</ol>
<ol class="calibre13">
<li value="16" class="calibre14">Change the color of the <code>Button</code>’s <strong class="bold">Text</strong> to white.</li>
</ol>
<div><div><img alt="Figure 18.51: Changing the Text color" src="img/B18327_18_51.jpg" class="calibre629"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.51: Changing the Text color</p>
<ol class="calibre13">
<li value="17" class="calibre14">Now, let’s create a <a id="_idIndexMarker1120" class="pcalibre pcalibre1 calibre6"/>Panel that will hold the <code>Button</code>. We will create <a id="_idIndexMarker1121" class="pcalibre pcalibre1 calibre6"/>the second<a id="_idIndexMarker1122" class="pcalibre pcalibre1 calibre6"/> button momentarily. Drag a <strong class="bold">VisualElement</strong> from the <strong class="bold">Containers</strong> <strong class="bold">Library</strong> to the <strong class="bold">Viewport</strong>.</li>
<li class="calibre14">In the same way that you resized the <code>Button</code>, resize the <code>ViusalElement</code> to a reasonable Panel size.</li>
</ol>
<div><div><img alt="Figure 18.52: Resizing the VisualElement" src="img/B18327_18_52.jpg" class="calibre630"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.52: Resizing the VisualElement</p>
<ol class="calibre13">
<li value="19" class="calibre14"> Set the background <a id="_idIndexMarker1123" class="pcalibre pcalibre1 calibre6"/>color of the <code>VisualElement</code> to <code>FFEFEF</code>.</li>
<li class="calibre14">Set the <code>5</code> and a <code>6</code>. You should see the following in your Viewport:</li>
</ol>
<div><div><img alt="Figure 18.53: The Panel with its new settings" src="img/B18327_18_53.jpg" class="calibre631"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.53: The Panel with its new settings</p>
<ol class="calibre13">
<li value="21" class="calibre14">Now, let’s<a id="_idIndexMarker1126" class="pcalibre pcalibre1 calibre6"/> make the <code>Button</code> a child <a id="_idIndexMarker1127" class="pcalibre pcalibre1 calibre6"/>of the <code>VisualElement</code> Panel. In the <code>Button</code> onto <code>VisualElement</code>.</li>
</ol>
<div><div><img alt="Figure 18.54: Parenting the Button to the VisualElement" src="img/B18327_18_54.jpg" class="calibre632"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.54: Parenting the Button to the VisualElement</p>
<ol class="calibre13">
<li value="22" class="calibre14">I want to have two <a id="_idIndexMarker1129" class="pcalibre pcalibre1 calibre6"/>sections of the Panel: the left section that holds the buttons and the right section that holds the image of the cat <a id="_idIndexMarker1130" class="pcalibre pcalibre1 calibre6"/>and the inspirational <a id="_idIndexMarker1131" class="pcalibre pcalibre1 calibre6"/>quote. Add a <code>VisualElement</code> as a child of the <code>VisualElement</code> that represents the Panel. You’ll notice that it automatically stacks under the <code>Button</code> in the Viewport.</li>
</ol>
<div><div><img alt="Figure 18.55: Adding in a new VisualElement" src="img/B18327_18_55.jpg" class="calibre633"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.55: Adding in a new VisualElement</p>
<ol class="calibre13">
<li value="23" class="calibre14">Make the <code>Button</code> a child of<a id="_idIndexMarker1132" class="pcalibre pcalibre1 calibre6"/> the new <code>VisualElement</code>.</li>
<li class="calibre14">Now, resize the <code>VisualElement</code> so<a id="_idIndexMarker1133" class="pcalibre pcalibre1 calibre6"/> that it<a id="_idIndexMarker1134" class="pcalibre pcalibre1 calibre6"/> takes up a portion of the left side of the Panel by clicking and dragging its blue handle. You should have something that looks like the following:</li>
</ol>
<div><div><img alt="Figure 18.56: Resizing the VisualElement" src="img/B18327_18_56.jpg" class="calibre634"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.56: Resizing the VisualElement</p>
<ol class="calibre13">
<li value="25" class="calibre14">Now, add<a id="_idIndexMarker1135" class="pcalibre pcalibre1 calibre6"/> another <code>VisualElement</code> as a<a id="_idIndexMarker1136" class="pcalibre pcalibre1 calibre6"/> child of the<a id="_idIndexMarker1137" class="pcalibre pcalibre1 calibre6"/> highest-level <code>VisualElement</code>. You will see something like the following:</li>
</ol>
<div><div><img alt="Figure 18.57: Adding another VisualElement to the Hierarchy" src="img/B18327_18_57.jpg" class="calibre635"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.57: Adding another VisualElement to the Hierarchy</p>
<ol class="calibre13">
<li value="26" class="calibre14">Select the top-most <code>VisualElement</code> and change the <code>VisualElement</code> or in<a id="_idIndexMarker1140" class="pcalibre pcalibre1 calibre6"/> the Inspector.
<div><div><img alt="Figure 18.58: Setting the Flex Direction to row" src="img/B18327_18_58.jpg" class="calibre636"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.58: Setting the Flex Direction to row</p>
<p class="calibre3">Doing this will cause its two <code>VisualElement</code> children to line up left to right rather than top to bottom.</p></li>
</ol>
<ol class="calibre13">
<li value="27" class="calibre14">Select the bottom-most <code>VisualElement</code> from the Hierarchy. In its <code>1</code>. This will <a id="_idIndexMarker1142" class="pcalibre pcalibre1 calibre6"/>cause the <code>VisualElement</code> to fill up the available space within its parent.</li>
<li class="calibre14">Now, we want to make<a id="_idIndexMarker1143" class="pcalibre pcalibre1 calibre6"/> the Panel centered on the screen. To do this, we need to create another <code>VisualElement</code> that will hold it so that we can center it within its parent. Add another <code>VisualElement</code> to the Hierarchy.</li>
<li class="calibre14">Drag the <code>VisualElement</code> that represents the Panel in the Hierarchy so that it is a child of the new <code>VisualElement</code>. In the following figure, the elements encircled by the red rectangle in the Hierarchy are the elements that represent the Panel and its children.</li>
</ol>
<div><div><img alt="Figure 18.59: The Hierarchy of our current layout" src="img/B18327_18_59.jpg" class="calibre637"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.59: The Hierarchy of our current layout</p>
<ol class="calibre13">
<li value="30" class="calibre14">Select the top-most <code>VisualElement</code> in the Hierarchy. You’ll see it doesn’t fill the entire root container. Set its <code>1</code> so it will fill the available space.</li>
<li class="calibre14">Expand the <strong class="bold">Align</strong> property and select center for both the <strong class="bold">Align Items</strong> and <strong class="bold">Justify Content</strong> properties. The <a id="_idIndexMarker1144" class="pcalibre pcalibre1 calibre6"/>Panel should <a id="_idIndexMarker1145" class="pcalibre pcalibre1 calibre6"/>now be centered in the container.</li>
<li class="calibre14">With the top-most <code>VisualElement</code> still selected, change the background image by expanding<a id="_idIndexMarker1146" class="pcalibre pcalibre1 calibre6"/> the <code>pinkBackground</code> to the <strong class="bold">Image</strong>. You should see the following at this point:</li>
</ol>
<div><div><img alt="Figure 18.60: Setting the background image on the background" src="img/B18327_18_60.jpg" class="calibre638"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.60: Setting the background image on the background</p>
<ol class="calibre13">
<li value="33" class="calibre14">Let’s add the second button to the Panel. Drag a <code>Button</code>. You should see something like the <a id="_idIndexMarker1147" class="pcalibre pcalibre1 calibre6"/>following:</li>
</ol>
<div><div><img alt="Figure 18.61: Adding a new Button" src="img/B18327_18_61.jpg" class="calibre639"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.61: Adding a new Button</p>
<ol class="calibre13">
<li value="34" class="calibre14">Instead of manually setting all the properties of the new <code>Button</code> to match the other, we can use a style sheet applied <a id="_idIndexMarker1148" class="pcalibre pcalibre1 calibre6"/>to both. This will make sure they both always have the same properties. Select the first <code>Button</code> (the one with the properties we want) and <a id="_idIndexMarker1149" class="pcalibre pcalibre1 calibre6"/>expand its <code>button-class</code> into the textbox and then press the <strong class="bold">Extract Inlined Styles to New </strong><strong class="bold">Class</strong> button.</p></li>
</ol>
<div><div><img alt="Figure 18.62: Creating a style sheet with Extract Inlined Styles to New Class" src="img/B18327_18_62.jpg" class="calibre640"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.62: Creating a style sheet with Extract Inlined Styles to New Class</p>
<ol class="calibre13">
<li value="35" class="calibre14">Select <strong class="bold">Add to New USS</strong> from the <a id="_idIndexMarker1150" class="pcalibre pcalibre1 calibre6"/>popup that appears.</li>
<li class="calibre14">Save the file in <code>Asset/UI Toolkit</code> as <code>ButtonStyle.uss</code>.</li>
<li class="calibre14">The <code>ButtonStyle.uss</code> style<a id="_idIndexMarker1151" class="pcalibre pcalibre1 calibre6"/> sheet should appear in <a id="_idIndexMarker1152" class="pcalibre pcalibre1 calibre6"/>the <strong class="bold">StyleSheets</strong> Panel now.
<div><div><img alt="Figure 18.63: The new style sheet" src="img/B18327_18_63.jpg" class="calibre641"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.63: The new style sheet</p>
<p class="calibre3">You can now apply this style to the unstyled button by dragging <code>ButtonStyle.uss</code> from the <code>Button</code>. Now, the two Buttons will have the same properties.</p>
<div><div><img alt="Figure 18.64: The two buttons with the same style sheet" src="img/B18327_18_64.jpg" class="calibre642"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.64: The two buttons with the same style sheet</p>
</li>
</ol><ol class="calibre13">
<li value="38" class="calibre14">Change the text on<a id="_idIndexMarker1153" class="pcalibre pcalibre1 calibre6"/> the bottom <code>Button</code> to <code>Inspire Me</code>.</li>
<li class="calibre14">Now, let’s align these<a id="_idIndexMarker1154" class="pcalibre pcalibre1 calibre6"/> buttons in their <code>VisualElement</code> parent. Select their <code>VIsualElement</code> parent and set its <code>VisualElement</code> in the Viewport or from the <strong class="bold">Align</strong> property in the Inspector.<p class="calibre3">Your UI Builder should look like the following:</p></li>
</ol>
<div><div><img alt="Figure 18.65: The Buttons centered in their VisualElement parent" src="img/B18327_18_65.jpg" class="calibre643"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.65: The Buttons centered in their VisualElement parent</p>
<ol class="calibre13">
<li value="40" class="calibre14">Now, let’s add in the<a id="_idIndexMarker1156" class="pcalibre pcalibre1 calibre6"/> holders for the cat pictures and the <a id="_idIndexMarker1157" class="pcalibre pcalibre1 calibre6"/>quotes that will be generated from the internet. Add a <code>VisualElement</code> so that it is a child of the bottom-most <code>VisualElement</code>.</li>
<li class="calibre14">Resize it so that it is smaller than its <code>VisualElement</code> parent.</li>
<li class="calibre14">Expand the <strong class="bold">Position</strong> property <a id="_idIndexMarker1158" class="pcalibre pcalibre1 calibre6"/>on its Inspector and change the position from <strong class="bold">Relative</strong> to <strong class="bold">Absolute</strong>. This will allow you to position it manually by either entering the numbers or dragging it into position in the Viewport. Position it like so:</li>
</ol>
<div><div><img alt="Figure 18.66: Manually positioning the VIsualElement" src="img/B18327_18_66.jpg" class="calibre644"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.66: Manually positioning the VIsualElement</p>
<ol class="calibre13">
<li value="43" class="calibre14">Add a <code>Label</code> as a sibling<a id="_idIndexMarker1159" class="pcalibre pcalibre1 calibre6"/> of the <code>VisualElement</code> we just <a id="_idIndexMarker1160" class="pcalibre pcalibre1 calibre6"/>created.</li>
<li class="calibre14">Change its <strong class="bold">Position</strong> property to <strong class="bold">Absolute</strong>, then <a id="_idIndexMarker1161" class="pcalibre pcalibre1 calibre6"/>scale and position it as follows.</li>
</ol>
<div><div><img alt="Figure 18.67: Adding a Label to the UI" src="img/B18327_18_67.jpg" class="calibre645"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.67: Adding a Label to the UI</p>
<ol class="calibre13">
<li value="45" class="calibre14">Change the <code>FF9BC8</code>.</li>
</ol>
<div><div><img alt="Figure 18.68: The Text property of the Label" src="img/B18327_18_68.jpg" class="calibre646"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.68: The Text property of the Label</p>
<ol class="calibre13">
<li value="46" class="calibre14">Delete the text so that there is nothing <a id="_idIndexMarker1162" class="pcalibre pcalibre1 calibre6"/>displayed there.</li>
<li class="calibre14">Currently, when you click on the<a id="_idIndexMarker1163" class="pcalibre pcalibre1 calibre6"/> buttons, there is not<a id="_idIndexMarker1164" class="pcalibre pcalibre1 calibre6"/> much of a reaction. This makes it difficult for the user to tell if they are clicking the buttons. So, let’s give the buttons hover and active states.</li>
<li class="calibre14">Select the <code>.button-class</code> in the <strong class="bold">StyleSheets</strong> Panel. Right-click on it and select <strong class="bold">Duplicate</strong>.</li>
<li class="calibre14">Right-click on the duplicate and rename it to <code>.button-class:hover</code>. This naming convention indicates that this style will be applied to the button’s hover state.</li>
<li class="calibre14">Duplicate it again and rename the new duplicate to <code>.button-class:active</code>. This naming convention indicates that this style will be applied to the button’s click state.</li>
<li class="calibre14">Select the <code>.button-class:hover</code> style. In the Inspector, change the <code>E96FA6</code> and change its size to <code>200</code> x <code>90</code>.</li>
<li class="calibre14">Select the <code>.button-class:active</code> style. In the Inspector, change the <code>C35D8B</code> and <a id="_idIndexMarker1165" class="pcalibre pcalibre1 calibre6"/>change its size to <code>200</code> x <code>90</code>.</li>
<li class="calibre14">You can now preview the changes <a id="_idIndexMarker1166" class="pcalibre pcalibre1 calibre6"/>you made by either playing<a id="_idIndexMarker1167" class="pcalibre pcalibre1 calibre6"/> your game or by using the <strong class="bold">Viewport</strong> <strong class="bold">Preview</strong>. This will show you the hover and active state changes.
<div><div><img alt="Figure 18.69: Using Preview in the Viewport to see the Buttons style changes" src="img/B18327_18_69.jpg" class="calibre647"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.69: Using Preview in the Viewport to see the Buttons style changes</p>
<p class="calibre3">The buttons now get darker and larger when you hover and click on them.</p></li>
</ol>
<ol class="calibre13">
<li value="54" class="calibre14">These style changes on the buttons are fine, but the transition from its standard state to the others is a bit drastic. We can add transition animations to the <code>.button-class</code> style, so when it transitions to the other styles, it will animate more smoothly.<p class="calibre3">Select the <code>.button-class</code> style from the <code>0.5</code> and the <code>EaseIn</code>. This indicates that when the button changes width, it <a id="_idIndexMarker1168" class="pcalibre pcalibre1 calibre6"/>will do so over 0.5 seconds and will ease into it.</p></li>
</ol>
<div><div><img alt="Figure 18.70: The width transition animation" src="img/B18327_18_70.jpg" class="calibre648"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.70: The width transition animation</p>
<ol class="calibre13">
<li value="55" class="calibre14">Select the <code>0.5</code>, and <strong class="bold">EaseIn</strong>. Your <strong class="bold">Transition Animations</strong> should now look like the following. This will ensure that when the width and height of the buttons change, it will do so smoothly over 0.5 seconds.
<div><div><img alt="Figure 18.71: The Buttons’ transition animations" src="img/B18327_18_71.jpg" class="calibre649"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.71: The Buttons’ transition animations</p>
<p class="calibre3">Play the Preview to watch the buttons grow gradually as you hover over them.</p></li>
</ol>
<ol class="calibre13">
<li value="56" class="calibre14">The last thing we need to do<a id="_idIndexMarker1171" class="pcalibre pcalibre1 calibre6"/> in the <a id="_idIndexMarker1172" class="pcalibre pcalibre1 calibre6"/>UI Builder is give variable names for each of these Visual Elements <a id="_idIndexMarker1173" class="pcalibre pcalibre1 calibre6"/>so that we can find them via code. Change the names of the various Visual Elements to the following:</li>
</ol>
<div><div><img alt="Figure 18.72: Renaming the Visual Elements we’ll want to access via code" src="img/B18327_18_72.jpg" class="calibre650"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.72: Renaming the Visual Elements we’ll want to access via code</p>
<p class="calibre3">Whew. That was a lot of steps! But <a id="_idIndexMarker1174" class="pcalibre pcalibre1 calibre6"/>we are officially done with the UI Builder. We can<a id="_idIndexMarker1175" class="pcalibre pcalibre1 calibre6"/> now work on<a id="_idIndexMarker1176" class="pcalibre pcalibre1 calibre6"/> our C# scripts to get the functionality we want.</p>
<h3 class="calibre9">Using C# code to set VisualElement and Label properties with web data</h3>
<p class="calibre3">Currently, our Buttons do not do anything<a id="_idIndexMarker1177" class="pcalibre pcalibre1 calibre6"/> but animate when we hover over them or click them. We now need to hook them up to some functionality. Our goals for the two Buttons when clicked are as follows:</p>
<ul class="calibre16">
<li class="calibre14"><code>CharmButton</code>: This should get cute cat pictures from the internet and replace the background of the <code>CatPic</code> Visual Element with the cute cat picture.</li>
<li class="calibre14"><code>InspireButton</code>: This should get inspirational quotes from the web, format the text, and place it in the <code>InspirationalQuote</code> Label.</li>
</ul>
<p class="calibre3">Honestly, what we’ve done up to this point for this example was all I wanted to cover when I initially started planning it. However, I got a bit excited about randomly generating the <code>VisualElements</code> properties and I possibly made the example a bit too complicated. We engineers love to over-engineer, after all. This example uses concepts of web requests and JSON manipulation. Since web development is not a focus of this book, I won’t belabor the code that performs these functions. I want the focus of this example to be on the UI-specific code, not the web requests. I will explain what each section of code does, but I will not necessarily explain it line-by-line.</p>
<p class="calibre3">Before we get to the actual code, I do want to give a brief rundown of the two sources we will be getting our data from. We will use the following resources to get cat pictures and inspirational quotes, respectively:</p>
<ul class="calibre16">
<li class="calibre14"><a href="https://placekitten.com/" class="pcalibre pcalibre1 calibre6">https://placekitten.com/</a></li>
<li class="calibre14"><a href="https://zenquotes.io/" class="pcalibre pcalibre1 calibre6">https://zenquotes.io/</a></li>
</ul>
<p class="calibre3">The Place Kitten website allows <a id="_idIndexMarker1178" class="pcalibre pcalibre1 calibre6"/>you to get a picture of a kitten with a specific dimension by simply adding the dimension to the end of the URL. For example, <a href="https://placekitten.com/300/300" class="pcalibre pcalibre1 calibre6">https://placekitten.com/300/300</a> displays an image of a kitten that is 300 x 300. This website is great for adding placeholder images when you are developing websites and just need something to fill a specific place. Plus, it’s cute!</p>
<p class="calibre3">The Zen Quotes website hosts an API that allows you to get inspirational quotes. An API is a collection of functions that let you interact with its data. What types of functions the API has will depend on the use of the API and the design paradigm the engineers chose to create it. But generally, an API will have the ability to GET data. Zen Quotes allows you to GET inspirational quotes. You can GET a single quote or a whole set of them. Visit their site to see what other options it has for retrieving data from its database. Zen Quotes returns the data you request from it in JSON format. JSON is a format standardization that provides information. It will look like the following when you get it:</p>
<pre class="source-code">
{"string":"HelloWorld","boolean":false,"number":123,"array":[1,2,3],"object":{"prop1":"a","prob2":"b"}}</pre> <p class="calibre3">But it can be formatted to look like the following:</p>
<pre class="source-code">
{
  "string": "HelloWorld",
  "boolean": false,
  "number": 123,
  "array": [
    1,
    2,
    3
  ],
  "object": {
    "prop1": "a",
    "prob2": "b"
  }
}</pre> <p class="calibre3">I won’t get into the specifics of what the preceding code means, but I will point out the important details of the example <a id="_idIndexMarker1179" class="pcalibre pcalibre1 calibre6"/>we cover. If you’d like to learn more about JSON format, see the following resource: <a href="https://www.w3schools.com/js/js_json_intro.asp" class="pcalibre pcalibre1 calibre6">https://www.w3schools.com/js/js_json_intro.asp</a></p>
<p class="calibre3">To finish out this example and have the buttons generate cat pictures and inspirational quotes, complete the following steps:</p>
<ol class="calibre13">
<li class="calibre14">Create a new C# script in your <code>Scripts</code> folder and call it <code>InspriationalPanel.cs</code>.</li>
<li class="calibre14">Let’s start with getting a reference to the <code>UIDocument</code> we created in the previous section. Add the following code to your class, making sure to import the <code>UnityEngine.UIElements</code> namespace:<pre class="source-code">
private UIDocument uiDocument;
void Start()
{
    uiDocument = GetComponent&lt;UIDocument&gt;();
}</pre><p class="calibre3">This code should look familiar after our Editor code example; the main difference is we got the reference to the <code>UIDocument</code> by using <code>GetComponent</code>. So, we’ll need to put this script on the same GameObject that contains our UI Document component.</p></li> <li class="calibre14">Go ahead and drag this script onto our <code>UIDocument</code> GameObject.</li>
<li class="calibre14">Now, create an instance variable for the root Visual Element on the UI Documents with the following code in the <code>Start()</code> method:<pre class="source-code">
var root = uiDocument.rootVisualElement;</pre></li> <li class="calibre14">Now let’s hook up our charm button. Add the following variable declaration:<pre class="source-code">
private Button charmButton;</pre></li> <li class="calibre14">Add the following code to the <code>Start()</code> method to initialize it:<pre class="source-code">
charmButton = root.Q&lt;Button&gt;("CharmButton");</pre></li> <li class="calibre14">We need a method that will run when the <code>charmButton</code> is clicked. Update your code to appear <a id="_idIndexMarker1180" class="pcalibre pcalibre1 calibre6"/>as follows. The new code is bold. This should all look familiar after our previous example:<pre class="source-code">
public class InspriationalPanel : MonoBehaviour
{
    private UIDocument uiDocument;
    private Button charmButton;
    void Start()
    {
        uiDocument = GetComponent&lt;UIDocument&gt;();
        var root = uiDocument.rootVisualElement;
        charmButton = root.Q&lt;Button&gt;("CharmButton");
        charmButton.clicked += OnCharmClicked;
    }
    private void OnCharmClicked()
    {
        // Handle charm button click
    }
    private void OnDisable()
    {
        charmButton.clicked -= OnCharmClicked;
    }
}</pre><p class="calibre3">I wanted to add the preceding large block of code because it can essentially act as a template for how you will code buttons with the UI Toolkit.</p></li> <li class="calibre14">Now, we need a reference to the Visual Element called <code>CatPic</code> so that we can change its background. Add the following code to the <code>Start()</code> method:<pre class="source-code">
VisualElement catPic = root.Q&lt;VisualElement&gt;("CatPic");</pre></li> <li class="calibre14">You may notice that I didn’t make <code>catPic</code> a class variable but instead made it an instance variable within the <code>Start()</code> method. This is because the thing we will need to reference the<a id="_idIndexMarker1181" class="pcalibre pcalibre1 calibre6"/> most in this code is the <code>CatPic</code>’s style, not the <code>CatPic</code> itself. So, add the following variable to your class:<pre class="source-code">
private IStyle catPicStyle;</pre></li> <li class="calibre14">Now, add the following to the <code>Start()</code> method:<pre class="source-code">
catPicStyle = catPic.style;</pre></li> <li class="calibre14">To get the image for the <code>catPic</code> background, we’ll use <a href="https://placekitten.com/" class="pcalibre pcalibre1 calibre6">https://placekitten.com/</a>. We’ll randomly pick a width and height between 150 and 300, then get a picture from <a href="http://placekitten.com" class="pcalibre pcalibre1 calibre6">placekitten.com</a> that fits those dimensions. To do so, we will need to use a coroutine since web requests require coroutines. Start by creating the following method:<pre class="source-code">
IEnumerator GetCatPic()
{
    // Implement coroutine logic here
}</pre></li> </ol>
<p class="callout-heading">Note</p>
<p class="callout">This method is going to show an error in your IDE until you put in the web request.</p>
<p class="calibre3">Make sure to add the following namespace to your code so it recognizes what an <code>IEnumerator</code> is:</p>
<pre class="source-code">
using System.Collections;</pre> <ol class="calibre13">
<li value="12" class="calibre14">Now, let’s randomly generate the width and height of the image we will request. Add the following to your <code>GetCatPic()</code> coroutine to get random numbers and then change the <code>catPic</code>’s dimensions to match it:<pre class="source-code">
int randomWidth = Random.Range(150, 300);
int randomHeight = Random.Range(150, 300);
catPicStyle.width = randomWidth;
catPicStyle.height = randomHeight;</pre></li> <li class="calibre14">Remember, the format of the URL for a placekitten image is <code>https://placekitten.com/300/300</code>. So, we need to create a string that replaces the two <code>300</code> values with <code>randomWidth</code> and <code>randomHeight</code>. Add the following line of code to your <code>GetCatPic()</code> coroutine:<pre class="source-code">
string uri = "https://placekitten.com/" + randomWidth + "/" + randomHeight;</pre></li> <li class="calibre14">Now, let’s send a web<a id="_idIndexMarker1182" class="pcalibre pcalibre1 calibre6"/> request to the <code>uri</code>. Add the following code to your <code>GetCatPic()</code> coroutine:<pre class="source-code">
UnityWebRequest request = UnityWebRequestTexture.GetTexture(uri);
yield return request.SendWebRequest();
if (reque<a id="_idTextAnchor498" class="pcalibre pcalibre1 calibre6"/>st.result != UnityWebRequest.Result.Success){
     Debug.Log(request.error);
} else {
     // Do stuff here with returned data
}</pre><p class="calibre3">The preceding code tries to get a texture from a website. The <code>if</code> prints an error if the request fails. Make sure to import the following namespace so your script understands what a <code>UnityWebRequest</code> is:</p><pre class="source-code">using UnityEngine.Networking;</pre></li> <li class="calibre14">Now, let’s replace the <code>// Do stuff here with returned data</code> part with the following code:<pre class="source-code">
Texture2D myTexture = ((DownloadHandlerTexture)request.downloadHandler).texture;
Debug.Log("Texture Acquired");
catPicStyle.backgroundImage = new StyleBackground(myTexture);</pre><p class="calibre3">This code will take the picture returned by the web request and store it as a <code>Texture2D</code>. It then sets the background image of <code>catPicStyle</code> to that <code>Texture2D</code> image.</p></li> <li class="calibre14">Now, we need to have our button to actually call the <code>GetCatPic()</code> coroutine. Update the <code>OnCharmClicked()</code> method to call the <code>GetCatPic()</code> coroutine:<pre class="source-code">
private void OnCharmClicked()
{
    StartCoroutine(GetCatPic());
}</pre><p class="calibre3">If you play the game, you<a id="_idIndexMarker1183" class="pcalibre pcalibre1 calibre6"/> can now click the <strong class="bold">Charm Me</strong> button to get random cat pictures.</p></li> </ol>
<div><div><img alt="Figure 18.73: Random cat pictures appearing in our UI" src="img/B18327_18_73.jpg" class="calibre651"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.73: Random cat pictures appearing in our UI</p>
<ol class="calibre13">
<li value="17" class="calibre14">You may notice a little funkiness with the image if you click the button a second time. Because the <code>GetCatPic()</code> method contains a web request, it takes a moment to fetch the image and then turn it into a texture, so whatever image is currently in its place will resize, becoming distorted, before the new image loads in.<p class="calibre3">Instead of letting this happen, let’s remove the original image while the new image loads in. Add the following code as the first line of your <code>GetCatPic()</code> coroutine:</p><pre class="source-code">
catPicStyle.backgroundImage = null;</pre></li> <li class="calibre14">Now, let’s set up the functionality of the <strong class="bold">Inspire Me</strong> button. Add the following variable declarations to your class:<pre class="source-code">
private Button inspireButton;
private Label inspirationalQuote;</pre></li> <li class="calibre14">Add the following <a id="_idIndexMarker1184" class="pcalibre pcalibre1 calibre6"/>method that will be called when the <code>inspireButton</code> is clicked:<pre class="source-code">
private void OnInspireClicked()
{
    // Implement functionality for when the inspireButton is clicked
}</pre></li> <li class="calibre14">Add the following code to the <code>Start()</code> method. This should all look familiar to you by now:<pre class="source-code">
inspireButton = root.Q&lt;Button&gt;("InspireButton");
inspireButton.clicked += OnInspireClicked;
inspirationalQuote = root.Q&lt;Label&gt;("InspirationalQuote");</pre></li> <li class="calibre14">Now, let’s move on to filling in the data for the inspirational quote. We will use the <a href="https://zenquotes.io/api/random" class="pcalibre pcalibre1 calibre6">https://zenquotes.io/api/random</a> request to retrieve a random quote. If you navigate to that URL in your web browser, you can see how the data it returns is formatted. Add the following code to your <code>InspriationalPanel.cs</code> script:<pre class="source-code">
IEnumerator GetInspiringQuote() {
     UnityWebRequest request = UnityWebRequest.Get("https://zenquotes.io/api/random");
     yield return request.SendWebRequest();
     if (request.result != UnityWebRequest.Result.Success) {
          Debug.Log(request.error);
     } else {
          Debug.Log("Quote Acquired");
          string response = request.downloadHandler.text;
          Debug.Log(response.ToString());
          // more code will go here
     }
}</pre><p class="calibre3">You’ll notice this is structured similarly to the web request we used to get our cat image. Before we<a id="_idIndexMarker1185" class="pcalibre pcalibre1 calibre6"/> proceed, let’s explore how the data is returned.</p></li> <li class="calibre14">Update your <code>OnInspireClicked()</code> method with the following code:<pre class="source-code">
private void OnInspireClicked()
{
    StartCoroutine(GetInspiringQuote());
}</pre></li> <li class="calibre14">Play the game and click the <strong class="bold">Inspire Me</strong> button. You will see something like the following in the console:
<div><div><img alt="Figure 18.74: The API request response" src="img/B18327_18_74.jpg" class="calibre652"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.74: The API request response</p>
<p class="calibre3">As you can see, we can’t exactly put the full result into our Label’s text field. We need to format this into something usable and get only the information we want. To do this most<a id="_idIndexMarker1186" class="pcalibre pcalibre1 calibre6"/> simply, we’ll need another package.</p>
<p class="calibre3">Open the Package Manager with <strong class="bold">Window</strong> | <strong class="bold">Package Manager</strong>.</p></li>
</ol>
<ol class="calibre13">
<li value="24" class="calibre14">Select the plus sign and select <strong class="bold">Add package from </strong><strong class="bold">git URL…</strong>.</li>
<li class="calibre14">Type <code>com.unity.nuget.newtonsoft-json</code> into the textbox and select <strong class="bold">Add</strong>. After some loading, you should see <strong class="bold">Newtonsoft Json</strong> in your packages list. This will allow you to easily manipulate JSON data.</li>
<li class="calibre14">Return to your script and add the following namespace:<pre class="source-code">
using Newtonsoft.Json.Linq;</pre><p class="calibre3">If <code>Newtonsoft</code> is not recognized by your IDE, close the IDE and Unity and reopen it.</p></li> <li class="calibre14">Now, we can parse the data we receive from our API call and get just the information we want. The data that is returned by the API call starts with <code>[</code>. This means that the data we are receiving is coming to us in an array format. So, we need to convert the data to an array. Replace <code>// more code will go here</code> with the following:<pre class="source-code">
JArray jArray = JArray.Parse(response);</pre></li> <li class="calibre14">We only want the strings assigned to the <code>"q"</code> property and the <code>"a"</code> property, as these represent the quote and the author respectively. To get this data, we need our data to be in an object format. The array that is returned to us only has a single array item, so use the following code to convert the array item to an object:<pre class="source-code">
JObject jObject = JObject.Parse(jArray[0].ToString());</pre></li> <li class="calibre14">Now, we can get the strings we want. Add the following lines to get the quote and the author:<pre class="source-code">
string quote = (string)jObject["q"];
string author = (string)jObject["a"];</pre></li> <li class="calibre14">The last thing to do is change the label’s text to the information we want and make sure it’s formatted <a id="_idIndexMarker1187" class="pcalibre pcalibre1 calibre6"/>correctly. I want the quote to appear in quotes. Then, on the next line, I want to see something like <code>~ Author's Name</code>. The following line of code will do that:<pre class="source-code">
inspirationalQuote.text = "\"" + quote + "\" \n~" + author;</pre><p class="calibre3">Play the game and you should now be able to get pictures of kittens and inspirational quotes!</p></li> </ol>
<div><div><img alt="Figure 18.75: The final version of our example" src="img/B18327_18_75.jpg" class="calibre653"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 18.75: The final version of our example</p>
<p class="calibre3">Because zenquotes is an API, the developers have put a limit of 5 calls per 30 seconds. So, that means if you try clicking the button more than 5 times in 30 seconds, you will get an error message.</p>
<p class="calibre3">You could expand on this<a id="_idIndexMarker1188" class="pcalibre pcalibre1 calibre6"/> example by getting a set of the data at the start and storing it locally. This could reduce some of the load times of the images and reduce the number of API calls needed.</p>
<p class="calibre3">That’s all for the examples that I will cover for the UI Toolkit. As I said previously, this is a big topic and a whole new way of thinking about developing UI. I wasn’t able to cover even half of what I would have liked to. If you enjoy working with the UI Toolkit, I recommend viewing the resources section for suggested further reading and tutorials.</p>
<h1 id="_idParaDest-303" class="calibre5"><a id="_idTextAnchor499" class="pcalibre pcalibre1 calibre6"/>Resources</h1>
<p class="calibre3">If you’re looking for more documentation, I recommend the following resources provided by Unity:</p>
<ul class="calibre16">
<li class="calibre14"><a href="https://unity.com/resources/user-interface-design-and-implementation-in-unity" class="pcalibre pcalibre1 calibre6">https://unity.com/resources/user-interface-design-and-implementation-in-unity</a></li>
<li class="calibre14"><a href="https://docs.unity3d.com/Manual/UIE-Transitioning-From-UGUI.xhtml" class="pcalibre pcalibre1 calibre6">https://docs.unity3d.com/Manual/UIE-Transitioning-From-UGUI.xhtml</a></li>
</ul>
<p class="calibre3">If you’re interested in tutorials, here are some great resources. It’s important to note that most of the tutorials at this point are for using the UI Toolkit for Editor UI since the runtime support is still new:</p>
<ul class="calibre16">
<li class="calibre14"><a href="https://docs.unity3d.com/Manual/UIE-examples.xhtml" class="pcalibre pcalibre1 calibre6">https://docs.unity3d.com/Manual/UIE-examples.xhtml</a></li>
<li class="calibre14"><a href="https://docs.unity3d.com/2021.2/Documentation/Manual/UIE-HowTo-CreateRuntimeUI.xhtml" class="pcalibre pcalibre1 calibre6">https://docs.unity3d.com/2021.2/Documentation/Manual/UIE-HowTo-CreateRuntimeUI.xhtml</a></li>
<li class="calibre14"><a href="https://docs.unity3d.com/2023.3/Documentation/Manual/UIE-simple-ui-toolkit-workflow.xhtml" class="pcalibre pcalibre1 calibre6">https://docs.unity3d.com/2023.3/Documentation/Manual/UIE-simple-ui-toolkit-workflow.xhtml</a></li>
<li class="calibre14"><a href="https://learn.unity.com/tutorial/ui-toolkit-first-steps#61df0f23edbc2a2bf49579a2" class="pcalibre pcalibre1 calibre6">https://learn.unity.com/tutorial/ui-toolkit-first-steps#61df0f23edbc2a2bf49579a2</a></li>
<li class="calibre14"><a href="https://docs.unity3d.com/Manual/UIE-HowTo-CreateCustomInspector.xhtml" class="pcalibre pcalibre1 calibre6">https://docs.unity3d.com/Manual/UIE-HowTo-CreateCustomInspector.xhtml</a></li>
<li class="calibre14"><a href="https://docs.unity3d.com/Manual/UIE-HowTo-CreateEditorWindow.xhtml" class="pcalibre pcalibre1 calibre6">https://docs.unity3d.com/Manual/UIE-HowTo-CreateEditorWindow.xhtml</a></li>
<li class="calibre14"><a href="https://youtu.be/J2KNj3bw0Bw?feature=shared" class="pcalibre pcalibre1 calibre6">https://youtu.be/J2KNj3bw0Bw?feature=shared</a></li>
</ul>
<p class="calibre3">Lastly, Unity has provided some excellent pre-made projects that use the UI Toolkit. You can find these projects on the asset store here:</p>
<ul class="calibre16">
<li class="calibre14"><a href="https://assetstore.unity.com/packages/essentials/tutorial-projects/quizu-a-ui-toolkit-sample-268492" class="pcalibre pcalibre1 calibre6">https://assetstore.unity.com/packages/essentials/tutorial-projects/quizu-a-ui-toolkit-sample-268492</a></li>
<li class="calibre14"><a href="https://assetstore.unity.com/packages/essentials/tutorial-projects/ui-toolkit-sample-dragon-crashers-231178" class="pcalibre pcalibre1 calibre6">https://assetstore.unity.com/packages/essentials/tutorial-projects/ui-toolkit-sample-dragon-crashers-231178</a></li>
</ul>
<h1 id="_idParaDest-304" class="calibre5"><a id="_idTextAnchor500" class="pcalibre pcalibre1 calibre6"/>Summary</h1>
<p class="calibre3">The UI Toolkit is still in development, but Unity is actively working on it as a system to replace the current uGUI system (that the rest of this book has focused on up to this point). It uses the concepts of web development to develop UI and can provide a cleaner, more performant UI than uGUI. However, since it is still in development, it doesn’t do everything uGUI does … yet. While you might not be able to fully transition over to the UI Toolkit system for your UI needs, it is helpful to have an idea of how it works, since one day, it will be your only option.</p>
<p class="calibre3">To help introduce the concepts of the UI Toolkit to you, we discussed the general concepts of the system as well as how to use it to make UI in the Editor and Runtime UI.</p>
<p class="calibre3">In the next chapter, we will discuss yet another UI system used within Unity: IMGUI.</p>
</div>
</div></body></html>