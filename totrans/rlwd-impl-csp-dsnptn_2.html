<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer019">
<h1 class="chapter-number" id="_idParaDest-37"><a id="_idTextAnchor036"/>2</h1>
<h1 id="_idParaDest-38"><a id="_idTextAnchor037"/>Prepping for Practical Real-World Applications of Patterns in C#</h1>
<h1 id="_idParaDest-39"><a id="_idTextAnchor038"/>Becoming a prepper</h1>
<p>You may think that because I was born in Oklahoma and live in Texas, I could be one of those crazy people who runs around in the woods preparing for the imminent end of the world. Hey, letâ€™s try to keep my personal life out of this! However, when I tell you that I want you to become a prepper, it has nothing to do with a conspiracy theory or end-of-times rhetoric. Instead, it has to do with a fundamental transformation that is likely to be happening in your professional life. Unlike the radical political transformations that concern most real-world preppers, ours are hopefully fully beneficial, with the aim to make us better at our craft. This chapter is geared toward preparing you to use patterns. Relying on patterns to improve your code doesnâ€™t make sense if the code youâ€™re working with doesnâ€™t conform to the following conditions:</p>
<ul>
<li>Sports a high level of organization </li>
<li>Structured for modification with minimal risk </li>
<li>Testable</li>
<li>Measurable</li>
</ul>
<p>So, you need to prepare. Think of it as though you were sanding down rough spots on a piece of wood before painting it. The patterns are the paint; if you apply the paint before sanding, all the rough spots are going to stand out.</p>
<p>Consider this chapter an explanation of why the code at your company is the way it is. If you work at Microsoft, Google, Apple, Meta, Twitter, or Amazon, your code is likely in good shape. You need to understand that a high-quality code base doesnâ€™t happen by accident, nor is it immune to the same chaotic forces that plague the physical universe. Entropy isnâ€™t limited to the concerns of thermodynamics in some distant stellar nebulae. Itâ€™s happening all the time in your code and you must learn to recognize it and work diligently to fix it or fend it off.</p>
<p>If you work at one of the other 99.99% of the companies in the world that creates software as a normal part of doing business, there might be some unrecognized opportunities for improvement. Letâ€™s look at what weâ€™re covering in this chapter:</p>
<ul>
<li>Spaghetti &lt; lasagna &lt; ravioli â€“ software evolution explained with pasta</li>
<li>The foundational principle â€“ writing clean code</li>
<li>Creating maintainable systems using SOLID principles</li>
<li>Measuring quality</li>
</ul>
<p>When you reach the end of the chapter, youâ€™ll be able to do the following:</p>
<ul>
<li>Identify some common metaphors for poorly constructed code, as well as exemplary code.</li>
<li>Articulate the importance of good basic coding habits as the key to the success of your project and applying code. Patterns make your code better, but only if itâ€™s clean code.</li>
<li>Apply SOLID principles to your code and your design process.</li>
<li>Identify the most common software metrics so we can understand when our code is more likely good than bad.</li>
</ul>
<h1 id="_idParaDest-40"><a id="_idTextAnchor039"/>Technical requirements</h1>
<p>This chapter presents some code samples. They are geared toward demonstrating some of the concepts weâ€™re going to be covering. Iâ€™m not sure they are exciting enough to make you want to recreate the projects yourself, but you are welcome to do so. Should you decide to try any of this out, youâ€™ll need the following:</p>
<ul>
<li>A computer running the Windows operating system. Iâ€™m using Windows 10.</li>
<li>A supported IDE such as Visual Studio 2022, JetBrains Rider, or Visual Studio Code with C# extensions.</li>
<li>.NET Core 6 SDK.</li>
</ul>
<h1 id="_idParaDest-41"><a id="_idTextAnchor040"/>Spaghetti &lt; lasagna &lt; ravioli â€“ software evolution explained with pasta</h1>
<p>The first part of any prepping<a id="_idIndexMarker052"/> journey involves securing your food supply. Real-world preppers love pasta because itâ€™s portable and keeps without refrigeration. So, letâ€™s start with pasta.</p>
<p>The title of <a href="B18605_01.xhtml#_idTextAnchor016"><em class="italic">Chapter 1</em></a> was <em class="italic">Why Is There a Big Ball of Mud on Your Plate of Spaghetti?</em> I never mentioned spaghetti. I didnâ€™t need to. Itâ€™s such an obvious descriptive metaphor for a chaotic mess that it likely needs little further discussion. Spaghetti code is actually mentioned in the original publication of the <em class="italic">Big Ball of Mud</em> antipattern. What a lot of developers donâ€™t see is that spaghetti code is a symptom. It isnâ€™t the disease itself. The real diseases are the antipatterns. It is possible to have multiple infections ransacking your body at the same time.  It is equally as possible for your code to be similarly and simultaneously inflicted with multiple antipatterns. You can gauge your codeâ€™s health by deciding where your code lies on the pasta spectrum..</p>
<h2 id="_idParaDest-42"><a id="_idTextAnchor041"/>Spaghetti code</h2>
<p>Spaghetti code is characterized as chaotic, poorly<a id="_idIndexMarker053"/> organized, hard to follow, and impossible to maintain. The more spaghetti you have, the worse it is. As soon as spaghetti appears, it tends to spread rapidly. Weâ€™ve also compared code architecture to a physical buildingâ€™s architecture in the previous chapter. There is a well-known principle from the field of criminology called <em class="italic">the broken windows theory</em>. The theory postulates that outward<a id="_idIndexMarker054"/> signs of crime, anti-social behavior, civil disobedience, or visible urban decay encourage further crime, particularly vandalism. A building with one broken window will soon have all its windows broken because itâ€™s clear that you can get away with throwing rocks with no repercussions. Who doesnâ€™t enjoy breaking Windows? Microsoft does it all the time.</p>
<p>Your code is the same way. If you allow just one broken window, your code is no longer clean. You need to correct the situation immediately or it wonâ€™t be long before all you have in your code repository is a Big Ball of Mud on your plate of spaghetti.</p>
<p>Maybe running fast and loose<a id="_idIndexMarker055"/> has paid off so far. Maybe it allowed you to get your software to market ahead of any competitors. Maybe your bosses and stakeholders are impressed with the velocity and small turnaround time on your initial releases. All that feels pretty good. Whatâ€™s really happening is that youâ€™re being rewarded for throwing rocks at your own windows. Youâ€™re sacrificing long-term profit for short-term gain.</p>
<p>You need to get out of the spaghetti production business entirely.</p>
<h2 id="_idParaDest-43"><a id="_idTextAnchor042"/>Lasagna code</h2>
<p>The logical step up from spaghetti code<a id="_idIndexMarker056"/> is lasagna. Most characterizations of lasagna code say that it is the object-oriented version of spaghetti. I donâ€™t necessarily agree. Lasagna itself consists of many of the same ingredients found in spaghetti. Itâ€™s still noodles, tomato sauce, spices, and often meat or vegetables. The difference is in how itâ€™s organized. Instead of hundreds of intertwined chaotic structures of noodles that can only be tamed by twirling them on a spoon, lasagna uses big noodles that serve as boundaries between discrete layers. Many of the layers are composed of the same stuff as the other layers.</p>
<p>In software, layered code fixes the spaghetti code into many small classes. Using lasagna as a metaphor for software cropped up around 1982, as the industry was beginning to move to a new hardware architecture. We were moving<a id="_idIndexMarker057"/> away from big-iron monolithic mainframes to something called <strong class="bold">client-server</strong>. The mainframes of the day required a financial commitment similar to that of the GDP of several small European countries combined. Client-server systems, on the other hand, were affordable for a reasonably well-funded small business. The systems consisted of a powerful server, servicing multiple clients, taking the form of less powerful computers. Does this sound familiar? Itâ€™s the same model used by the internet. The difference is that networking technology is now universal, exponentially<a id="_idIndexMarker058"/> better, faster, and more reliable. Spoiler alert: <strong class="bold">cloud computing</strong> is not a new concept. Itâ€™s just a marketing term for work done on other peopleâ€™s computers.</p>
<p>Itâ€™s worth noting that the 1980s also brought us the first forays into object-oriented programming. I doubt Java was even a glimmer in James Goslingâ€™s eye then, and the inventor of C#, Anders Hejlsberg, was still in college. However, Bjarne Stroustrup began working on <strong class="bold">C++</strong> in 1979 while working at AT&amp;T Bell Labs. He based C++ on the C language. C is a strictly procedural language designed to control telecommunications switching networks. Stroustrup reimagined this language by bolting on object orientation by way of classes.</p>
<p>C++ was released to the world in 1985 when Stroustrup published a textbook on the language. Those<a id="_idIndexMarker059"/> of you who were not yet born now understand that the 80s brought us more than just hairbands, Madonna wannabes, <em class="italic">The Karate Kid</em>, and Valley girls. It brought a whole new way of thinking about and designing software. It was a mere coincidence that we looked fabulous while doing it.</p>
<p>The hardware shift toward client-server necessitated a change in software design practices, as we considered what pieces should run on servers<a id="_idIndexMarker060"/> and which on clients. We started seeing something that we call <strong class="bold">separation of concerns</strong> today. When done well, separation of concerns is a really good idea. When done poorly, it creates lasagna.</p>
<p>Lasagna doesnâ€™t usually begin as lasagna. A software developer thoughtfully lays out a layered architecture that separates<a id="_idIndexMarker061"/> components of the overall system into layers called <em class="italic">tiers</em>. Hereâ€™s an example of a common four-tier architecture design:</p>
<div>
<div class="IMG---Figure" id="_idContainer014">
<img alt="Figure 2.1 â€“ A common four-tiered architecture " height="320" src="image/B18605_Figure_2.1.jpg" width="589"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.1 â€“ A common four-tiered architecture</p>
<p>This is exactly the kind of architecture we see in modern mobile applications. The presentation layer is the app you downloaded from the app store, which runs on your phone, while the remaining tiers run invisibly in the cloud.</p>
<p>Since the separation exists at the hardware level, it makes sense to think about making software in a set of layers that mirrors the systems running the program. The presentation layer is the <strong class="bold">view</strong>, or the part of the program interacting with the users. The business rules layer implements the logic that drives what the presentation layer displays. It draws information from the persistence layer, which is responsible for storing and retrieving data. Some of this might be stored as files, or in memory, but some data will undoubtedly be at the lowest level in a database. All communication between the layers should move through each layer above it or below it, depending on the direction of flow for the data. As these layers become more and more complicated, it is easy for functionality to start bleeding out of the intended layer into other layers.</p>
<p>Imagine you need a quick fix<a id="_idIndexMarker062"/> for the way something is displayed in the UI. Maybe you want to show something in one way to an administrative user, and another way to a regular user. The right way to effect this change might be to alter a rule in the business rule layer, but itâ€™s easier and faster to slap something directly into the UI. Youâ€™ve just broken a window. Itâ€™s no big deal; you tell yourself youâ€™ll fix it later. </p>
<p>In other scenarios, lasagna can be the result of an overcorrection. Take a programmer who writes spaghetti code in a procedural language such as C, then give them an object-oriented language such as C++ or C#. Now, add a book on patterns. The natural inclination of the programmer will likely be the same as yours the first time you realized that you could use different fonts in <em class="italic">PowerPoint</em>. One font is good; therefore,, all 25 on your computer must be better! Naturally, you start creating presentations that try to use as many fonts as possible. Patterns are an amazing tool. They are meant to guide you toward clean architecture the way fonts, used sparingly, should add emphasis, clarity, and aesthetics to a presentation. Patterns arenâ€™t meant to be a prison.Â Â </p>
<p>The lasagna problem isnâ€™t limited to large, multi-service programs. Youâ€™ll see it in smaller ones too, in the form of layers of inheritance. Inheritance is a foundational feature of object-oriented programming. If a language doesnâ€™t support inheritance, itâ€™s not in the club, and it canâ€™t call itself object-oriented. Consider what the <strong class="source-inline">NginxLogLine</strong> class from the project in <a href="B18605_01.xhtml#_idTextAnchor016"><em class="italic">Chapter 1</em></a>, <em class="italic">Thereâ€™s a Big Ball of Mud on Your Plate of Spaghetti</em>, might look like after a few iterations of requirements gathering, coding, and releases. The use case Iâ€™m presenting here is pure fiction and doesnâ€™t actually relate to the release history of NGINXâ€™s log structure. I need a believable series of complications to help make my example work.</p>
<p>Letâ€™s say the code in <a href="B18605_01.xhtml#_idTextAnchor016"><em class="italic">Chapter 1</em></a> represents<a id="_idIndexMarker063"/> the first release. The client was thrilled and started coming up with new requirements, as the software was exposed to different business users in the real world. A shortlist of new requirements might be the following:</p>
<ul>
<li>It was noted by some of the IT professionals using the program that while it works perfectly with the latest version of the web server software, it breaks when working with older versions because the log structure has changed several times over the last few years. We need to support the last major revisionâ€™s log format, as well as the most current.</li>
<li>Users based in Asia noted that the text formatting in their log files is not supported because their text files are encoded using double-byte formats. We need to support international text formats.</li>
<li>Another important IT group canâ€™t even use your software because they donâ€™t use NGINX exclusively. They also use Apache and they noted they have the same constraints. The log formats have changed over time, so they have several formats to consider, and they too need support for single- and double-byte text implementations.</li>
</ul>
<p>Let me reiterate my earlier disclaimer. While I do know my way around a web server log, I am by no means a web server log aficionado. As a reminder, this is a fictitious cautionary tale. Any resemblance of our requirements to actual software requirements is purely coincidental. I further promise under the penalty of perjury that no cute and fluffy animals will be harmed in the equally fictitious production of said software. My lawyer wants me to add more, but my editor wants me to get on with it already and I learned early that my editor is always right.</p>
<p>Next, letâ€™s suppose since there was zero inheritance used in the original code that maybe it was because we were new to C# and didnâ€™t fully understand how to use inheritance. Now, suppose we bought a book from a publisher other than Packt. It was written by a university professor who has never published software in a commercial setting. This is common. Theyâ€™ve never heard a pointy-haired boss who wielded godlike power over their livelihood tell them to clean up the prototype and ship it next week. At no point have they faced a deadline unrealistically dictated by a marketing department. In short, this book would be by an author who doesnâ€™t work in the real world of software development.</p>
<p>This kind of author may have presented a muddy, overly academic picture of C#â€™s inheritance model, along<a id="_idIndexMarker064"/> with the academically perfect way to structure your code. They are basing their estimation on the available academic literature reviews, also written by university professors who have never actually worked in the field. Your young, sharp, supple, but impressionable mind might be persuaded by all the authorâ€™s academic credentials to make something similar to what follows:</p>
<div>
<div class="IMG---Figure" id="_idContainer015">
<img alt="Figure 2.2 â€“ The UML equivalent of a dumpster fire next to a train wreck (this is an example of too much inheritance) " height="1157" src="image/B18605_Figure_2.2.jpg" width="1641"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.2 â€“ The UML equivalent of a dumpster fire next to a train wreck (this is an example of too much inheritance)</p>
<p>This is a poorly<a id="_idIndexMarker065"/> constructed inheritance chain represented using the <strong class="bold">Unified Modeling Language</strong> (<strong class="bold">UML</strong>). If youâ€™ve never seen a UML class diagram before, you should jump to <a href="B18605_Appendix_2.xhtml#_idTextAnchor204"><em class="italic">Appendix 2</em></a> at the end of the book. It has an overview of how to draw and interpret these diagrams.</p>
<p>The inheritance chain represented in the diagram goes deeper than is necessary, The design goal can be accomplished more cleanly by using tools such as interfaces and techniques such as composition. Youâ€™re also staring at the beginning of class proliferation.</p>
<p>Class proliferation happens when you find yourself needing to add more and more classes to support new requirements. This sets us up for a classic stovepipe design.</p>
<p>Too many layers of inheritance, especially when functionality that belongs in one class slowly bleeds into other classes over time, will yield lasagna.</p>
<p>If only we had yet another<a id="_idIndexMarker066"/> pasta metaphor that is delicious and satisfying, but less deleterious to the work-life balance of whoever has to maintain what weâ€™ve created thus farâ€¦</p>
<h2 id="_idParaDest-44"><a id="_idTextAnchor043"/>Ravioli â€“ the ultimate in pasta code</h2>
<p>While everybody loves<a id="_idIndexMarker067"/> spaghetti and lasagna, you donâ€™t want them showing up in your code. Ravioli, on the other hand, is something we aspire toward.</p>
<p>When we make ravioli, it is again comprised of the same set of ingredients used to make spaghetti and lasagna. Again, the difference is in the configuration of the materials. The noodles now form a full boundary around the deliciousness inside. The meat or cheese within the noodle is fully encapsulated, with the content only ever being exposed when it is consumed. Thereâ€™s probably also a delicious sauce on the outside that brings the whole dish together into something thatâ€™s not chaotic and not unnecessarily dense.Â Â </p>
<p>It is also worth noting that the level of effort needed to shape and stuff the noodles is a lot more work than simply boiling a handful of straight noodles. Making ravioli, as with good object-oriented code, requires patience and work. The idea of ravioli is the epitome of pasta object-oriented design if you remember the foundational pillars used to previously describe object-oriented design:</p>
<ul>
<li>Encapsulation is used to limit<a id="_idIndexMarker068"/> access to an objectâ€™s state.</li>
<li>Abstraction<a id="_idIndexMarker069"/> refers to a class modeling a real-world object with only the level of detail needed by the software. If we were to write software that needed a <strong class="source-inline">Person</strong> class to model a human being, the <strong class="source-inline">Person</strong> class would be modeled differently in a medical records application than it would in a phone book application.</li>
<li>Inheritance allows common<a id="_idIndexMarker070"/> structures between classes to be shared in a parent class, negating the need to copy the same code repeatedly between classes.</li>
<li>Polymorphism<a id="_idIndexMarker071"/> allows a class designer to defer implementing abstracted details to concrete classes. For example, an abstract <strong class="source-inline">Vehicle</strong> class might have a <strong class="source-inline">Go()</strong> method. The <strong class="source-inline">Go()</strong> method would work very differently for concrete classes such as a car versus a boat, a skateboard, a submarine, or an airplane. Polymorphism allows us to create the appropriate implementation at the concrete level but define it at the abstract level.</li>
</ul>
<p>We need to talk a little more about<a id="_idIndexMarker072"/> encapsulation with specific regard to C#. In well-designed object-oriented code, objects are encapsulated. This means the objectâ€™s state is closely guarded. Only the instance should be allowed to alter its own internal state.Â Â </p>
<p>By contrast, poorly constructed code allows for objects to directly change the state of other objects. Auto-implemented properties in C# make this very easy by making properties no better than fields. If every property is public, and there are no rules, as is the case with auto-implemented properties, any object can change the state of any other object. We can compound the problem with a long inheritance chain, where every property at every level is public, internal, or protected. When this is the case, any object at any level can impose state changes up or down the inheritance chain. This makes it difficult to track what is changing each objectâ€™s state and under what circumstances. State changes bleeding between layers is the very definition of lasagna. </p>
<p>If your code is similar to ravioli, each instance of each object stands alone as a fully encapsulated class with limited inheritance. It is the master of its own state, and it meticulously and entirely controls that state. Since these objects bear all these hallmarks, you can easily leverage composition to build complex objects instead of relying solely on inheritance to define the behavior of an object. </p>
<p>Composition is a technique focusing<a id="_idIndexMarker073"/> on building objects out of other objects. Composition works best when we use interfaces to define how these objects fit together. An interface defines the structure of an object. Think of it as a mechanical socket such as a light socket. You can plug any bulb into that socket, provided it fits. What makes it fit is the definition presented by the dimensions of the socket. Interfaces in C# can define a set<a id="_idIndexMarker074"/> of properties and methods that an object is expected to have. Any object that fits the specification can be used just as a bulb fitting into a socket would.</p>
<p> Imagine a set of classes designed to model an automobile. There are lots of different kinds of cars. There are sports cars, family sedans, minivans, and my personal favorite, the Jeep. All of these cars are very different.  We could try to come up with an inheritance chain to tie them all together in a familial hierarchy. I suspect though, that if you limited your design to strictly inheritance, youâ€™d wind up with hundreds of classes. The resulting code would be a messy, muddy plate of pasta.</p>
<p>A better idea is to use<a id="_idIndexMarker075"/> composition. We can keep our abstract car model, but instead of making subclasses, we can add interfaces to define the characteristics of the car. For example, we can make an interface for each component that defines a car. For example, we can make an interface that defines an engine.</p>
<p>We can also create an interface<a id="_idIndexMarker076"/> that defines the transmission. There is a huge difference between the transmission of a family sedan, a high-end sports car, and a 4x4 off-road vehicle. However, it is possible to define a common set of properties and methods. Any transmission object I can model will slot into my car object, provided it follows the required interface.</p>
<p>If I were to sum up the job<a id="_idIndexMarker077"/> of an object-oriented developer, and I were only allowed one sentence, I would say that our job is to always ensure that no object should ever be allowed to fall into an invalid state. Iâ€™ll expand on this idea in the next section.</p>
<h1 id="_idParaDest-45"><a id="_idTextAnchor044"/>The foundational principle â€“ writing clean code</h1>
<p>The main point of presenting<a id="_idIndexMarker078"/><a id="_idIndexMarker079"/> the topics in this chapter is to set a boundary. You can master all the patterns in this book and more, but if your software is poorly written, overly clever, haphazardly structured, or hard to maintain, then all the patterns in the world canâ€™t help you. Letâ€™s set some boundaries. Iâ€™m going to suggest some guidelines for creating â€œclean code.â€ You are welcome to argue the minutiae. It doesnâ€™t bother me one bit if we differ in opinion over tabs versus spaces as long as you have a method to your particular flavor of madness. Letâ€™s paint some broad strokes that hopefully everyone can agree with.</p>
<p>Clean code<a id="_idIndexMarker080"/> has the following characteristics:</p>
<ul>
<li>Easily readable by human beings with limited cognitive load</li>
<li>Consistent in style</li>
<li>Documented with<a id="_idIndexMarker081"/> an appropriate level of commentary</li>
</ul>
<h2 id="_idParaDest-46"><a id="_idTextAnchor045"/>You should write code that is readable by humans </h2>
<p>I feel as though this isnâ€™t as obvious<a id="_idIndexMarker082"/> as it should be. We write code to be compiled and executed by machines who donâ€™t care for the expressiveness we use when we write our code. Writing code is writing language. Human languages are expressive and so are humans. We can take our written languages and create a business email indicating stock shortages, a medical report outlining potential patient outcomes following a diagnosis of dermatomyositis, a masterâ€™s thesis on molecular biology, a long-form romance novel, or even a haiku. Your computer languages are also expressive with their limited vocabulary. C# has 79 keywords. With those 79 keywords, you can create everything from a short program to download your email to an entire operating system. Itâ€™s a powerful and expressive language. As long as you use valid syntax, the compiler will be happy. You need to focus your efforts on making your code readable to other people. Iâ€™ve always believed the golden rule applies here: <em class="italic">do unto others as you would have others do unto you.</em> You should treat everyone with the same level of respect youâ€™d like to be treated to yourself. You should write code that requires minimal effort by others to scan and understand.</p>
<p>This starts with the way you name classes, variables, methods, and the other elements used to create your software. If the names represent the intent for how those elements are used, youâ€™ve taken a step toward creating code that is more readable and more maintainable. Some staples of best practice include the following:</p>
<ul>
<li>Name your elements so that their intended use is intuitive. <strong class="source-inline">this.pn</strong> is not intuitive. You can likely think of a dozen things it might be. If weâ€™d used <strong class="source-inline">this.phoneNumber</strong>, you wouldnâ€™t have to guess.</li>
<li>Create names that are searchable. <strong class="source-inline">MAX_FILES_PER_UPLOAD</strong> defined as a constant makes it easy to find in your code, especially if youâ€™re using an IDE that indexes your code.</li>
<li>Leave outdated encodings to the old-timers. You likely donâ€™t do things like this unless you are very (how can we say it nicely?) seasoned. A long time ago, in this very galaxy, we learned to create variable names using codes. I donâ€™t mean programming code; I mean codes as in Hungarian notation. This was before we had type-checking IDEs. It reminds me of Garrison Keelerâ€™s <em class="italic">Lake Wobegon</em> podcasts where he spun tales of a simpler time. We wrote in simple console editors such as <em class="italic">vi</em> and <em class="italic">emacs</em> and we liked it that way. We might as well have been using <em class="italic">Notepad</em> with our fingers tied together. Back then, we didnâ€™t have <em class="italic">Roslyn</em> looking over our shoulders and pointing out our missteps. We needed a way to tell which data type was used in our variables, so weâ€™d call a variable <strong class="source-inline">intAge</strong> or maybe <strong class="source-inline">iAge</strong>. As I said, you probably donâ€™t do this anymore unless you were taught this way. If you were taught this way, kindly knock it off. Thank you.</li>
<li>Donâ€™t bother with member<a id="_idIndexMarker083"/> prefixes or suffixes. It used to be common to prefix member variables with <strong class="source-inline">m_</strong>, for example. As with encodings, this kind of thing isnâ€™t needed because we have good IDEs, and your classes should be short and discrete in function so that prefixes are not needed. Besides, after a while, people tend to ignore them as noise while scanning your code and they cease to be significant. Iâ€™ve seen university professors teach it this way for a long time. I might have been one of them. Iâ€™m not proud of it, but that was a long time ago and Iâ€™ve moved on since then. The exception that I still observe is the common custom of naming private fields with an initial underscore. I think most people do that so they can name the field something obvious that matches the property name where they intend to expose the field. </li>
<li>Use parts of speech in your code. Your objects are nouns. They represent people, places, and things. Name them as such. <strong class="source-inline">Person</strong> makes for a good abstract class name, which might be extended in <strong class="source-inline">Student</strong> and <strong class="source-inline">Professor</strong>. Class names that contain verbs as part of the name, such as a class named <strong class="source-inline">ParseLogLines</strong>, become confusing as class names. Naming the class <strong class="source-inline">LogLineParser</strong> is clearer because it sounds like a thing rather than an action. Within classes, the methods are your verbs, so name them that way. <strong class="source-inline">ParseLogLines</strong> totally works as a method name. If you pay attention to these details, your code will wind up reading as a normal sentence would, albeit with odd but understandable punctuation.</li>
<li><strong class="bold">Donâ€™t Repeat Yourself</strong> (<strong class="bold">DRY</strong>). By this, I mean donâ€™t write the same<a id="_idIndexMarker084"/> code twice. Also, donâ€™t duplicate anything, and never repeat something youâ€™ve already written. Dang it, sorry about that. I see this most often when people<a id="_idIndexMarker085"/> are in a hurry. Theyâ€™ve got some code in another project or another part of their current project but itâ€™s not written in a way that is conducive to reuse, so they copy and paste it into different programs or different parts of the same program. This is a broken window. Soon, your code will not be DRY; itâ€™ll be wetter than an octopusâ€™ belly button, and that kind of thing will be everywhere.</li>
<li>Get rid of dead code. This is a huge pet peeve for me. Once I was working as a Java developer. I know, I was young and I needed the money. I was pretty new to the job and we had a database function that wasnâ€™t writing to the database as expected. Iâ€™d change the method around and run the tests. Same result. Eventually, I decided to make a silly, ridiculous big change. Nothing. I was working on a method called <strong class="source-inline">WriteInventoryPartToDatabase</strong>. OK, that seems well named. It seemed to be an obvious place to look for the problem. After an hour or so, I realized the method I was working on was <em class="italic">old code</em> and that the actual method I needed had been moved to another class. The developer who moved the method kept the old method in place <em class="italic">just in case</em> and never cleaned it up later. OK, people. This is why revision control systems exist. You can always go back. Donâ€™t be lazy. If you delete or remove something, donâ€™t just change it in the calling method. Get rid of the dead parts or someone else will potentially spend a lot of time on a red herring.</li>
<li>Format your code for human consumption. Something such as this should be an anathema to your very being:<p class="source-code">var l = 1;</p><p class="source-code">var O = 0;</p><p class="source-code">if (O == l) {</p><p class="source-code">Â Â O++;</p><p class="source-code">} else {</p><p class="source-code">Â Â l = O * (l + 1);</p><p class="source-code">}</p></li>
</ul>
<p>Our IDEs have gotten<a id="_idIndexMarker086"/> pretty good at defaulting to fonts that help us detect the differences between zeros and capital Os, and lowercase Ls and 1s. Options such as turning on font ligatures help even more. Ligatures are improved fonts that show you a more expressive set of characters. For example, look at the way <strong class="source-inline">!=</strong> is rendered in <em class="italic">CaskaydiaCove Nerd </em>Font from <a href="http://nerfonts.com">nerfonts.com</a>. It appears as <strong class="source-inline">â‰ </strong>, which is the way your high school math teacher presented it:</p>
<div>
<div class="IMG---Figure" id="_idContainer016">
<img alt="Figure 2.3 â€“ An IDE with font ligatures turned on displaying !=  " height="367" src="image/B18605_Figure_2.3.jpg" width="1003"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.3 â€“ An IDE with font ligatures turned on displaying != </p>
<p>You can turn these on in your IDE. In Visual Studio, you just set the font to one that supports ligatures:</p>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"> </p>
<div>
<div class="IMG---Figure" id="_idContainer017">
<img alt="Figure 2.4 â€“ In Visual Studio, simply set the font in the Options window to one that supports ligatures, such as CaskaydiaCove Nerd Font Mono, which you can find free at nerdfonts.com " height="422" src="image/B18605_Figure_2.4.jpg" width="747"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.4 â€“ In Visual Studio, simply set the font in the Options window to one that supports ligatures, such as CaskaydiaCove Nerd Font Mono, which you can find free at nerdfonts.com</p>
<p>In <em class="italic">JetBrains Rider</em>, you have<a id="_idIndexMarker087"/> an actual setting:</p>
<div>
<div class="IMG---Figure" id="_idContainer018">
<img alt="Figure 2.5 â€“ JetBrains Rider IDE settings for fonts allow you to specifically turn ligatures on and off " height="267" src="image/B18605_Figure_2.5.jpg" width="512"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.5 â€“ JetBrains Rider IDE settings for fonts allow you to specifically turn ligatures on and off</p>
<p>If you prefer <em class="italic">Visual Studio Code</em>, youâ€™ll need to edit your <strong class="source-inline">settings.json</strong> file:</p>
<pre class="source-code">"editor.fontFamily": "CaskaydiaCove Nerd Font, monospace",
"editor.fontLigatures": true,</pre>
<p>The IDEâ€™s normal coloring helps too, except when youâ€™re reading a book printed in grayscale ğŸ˜Š. </p>
<p>The previous bullet points<a id="_idIndexMarker088"/> are guidelines for writing code for human consumption. These tips will help you as we move into the next section.</p>
<h2 id="_idParaDest-47"><a id="_idTextAnchor046"/>Establishing and enforcing style and consistency</h2>
<p>You should be using a set of conventions<a id="_idIndexMarker089"/> for consistently naming elements<a id="_idIndexMarker090"/> of your code, as well as applying a consistent coding<a id="_idIndexMarker091"/> style. If you do this well, you wonâ€™t be able<a id="_idIndexMarker092"/> to tell where your code ends and someone elseâ€™s starts. Iâ€™m not going to dedicate time to recommending coding conventions, as these are well established in the industry. Some such conventions are baked into the IDEs, such as curly braces always dropping to a new line, For the rest, you can use an automation tool such as JetBrainsâ€™ <em class="italic">ReSharper</em>, <em class="italic">Prettier</em> for <em class="italic">Visual Studio Code</em>, or the open source project called <em class="italic">StyleCop</em>. All of these have tools <a id="_idIndexMarker093"/>that allow you to add style enforcement to the IDE, as well<a id="_idIndexMarker094"/> as the ability to run a check when you commit your code to a <strong class="bold">Continuous Integration</strong> (<strong class="bold">CI</strong>) server. Mavericks who arenâ€™t using the proper styling will fail their builds, giving everyone else on the team the opportunity to help them see the error of their ways.</p>
<h2 id="_idParaDest-48"><a id="_idTextAnchor047"/>Limiting cognitive load</h2>
<p>The problem isnâ€™t that the poorly written code<a id="_idIndexMarker095"/> is unintelligible. The problem<a id="_idIndexMarker096"/> is that itâ€™s unscannable. One thing Iâ€™ve noticed over the years is that, regrettably, I no longer read entire paragraphs in prose anymore. Granted, itâ€™s rare that I read books with zero code in them. Over the years, my brain has adapted to reading code, so I scan. If youâ€™ve also been reading code for a while, you probably do it too even if you donâ€™t realize it. Remember this and work toward making your code scannable. If you can just look at it and think <em class="italic">OK, got it. Next?</em>, then itâ€™s easy to scan and understand. The opposite<a id="_idIndexMarker097"/> is having to stare at some code for seconds or minutes in order<a id="_idIndexMarker098"/> to decode it in your brain. It takes a noticeable and uncomfortable amount of time to figure out what it means and what it does. Psychologists refer to this as <strong class="bold">cognitive load</strong>.</p>
<p>Try this instead:</p>
<pre class="source-code">var lastIndexedValue = 1;
var oldValue = 0;
if(oldValue == lastIndexedValue)
{
Â Â oldValue++;
} 
else 
{
 lastIndexedValue = oldValue * (lastIndexedValue++);
}</pre>
<p>Thatâ€™s better. No more thinking. Save that for when you really need it.</p>
<h2 id="_idParaDest-49"><a id="_idTextAnchor048"/>Terse is worse</h2>
<p>Speaking of cognitive load, I know a lot of developers who<a id="_idIndexMarker099"/> love terse syntax. Let me show you what I mean. I found a perfect<a id="_idIndexMarker100"/> example on Stack Overflow at <a href="https://stackoverflow.com/questions/7103979/nested-ternary-operators/7104091#7104091">https://stackoverflow.com/questions/7103979/nested-ternary-operators/7104091#7104091</a>:</p>
<pre class="source-code">_viewModel.PhoneDefault = user == null ? "" :
Â Â (string.IsNullOrEmpty(user.PhoneDay) ?
Â Â Â Â (string.IsNullOrEmpty(user.PhoneEvening) ?
Â Â Â Â Â Â (string.IsNullOrEmpty(user.Mobile) ? "" : 
Â Â Â Â Â Â Â Â user.Mobile) :
Â Â Â Â Â Â user.PhoneEvening) :
Â Â Â Â Â user.PhoneDay);</pre>
<p>Itâ€™s so terse that itâ€™s impossible<a id="_idIndexMarker101"/> to scan. Youâ€™re going to have to hunker down for a good few minutes to even figure out what it does. Some developers think writing code in this way makes them appear smarter than everyone else. It doesnâ€™t. This would be similar to an English writer who is overtly sycophantic and obsequious toward their quasi-internalized sesquipedalian. Did you get all that, or did your eyes scan back across the sentence a few times? I could have simply said, â€œ<em class="italic">This would be the same as an English writer who goes out of their way to give in to the obsessive use of long words.</em>â€ Good writers can write to be understood by a university-educated audience, which is to say, their peers. Great writers can write the same content to be understood by a group of talented sixth graders. This takes as much concentrated effort as writing tersely, but you can do the same thing with your code and everybody charged with maintenance will thank you for it.</p>
<p>Letâ€™s refactor it:</p>
<pre class="source-code">if(user == null)
{
Â Â _viewModel.PhoneDefault = string.Empty;
}
if(!string.IsNullOrEmpty(user.PhoneDay))
{
Â Â _viewModel.PhoneDefault = user.PhoneDay;
}
if(!string.IsNullOrEmpty(user.PhoneEvening))
{
Â Â _viewModel.PhoneDefault = user.PhoneEvening;
}
if(!string.IsNullOrEmpty(user.Mobile))
{
Â Â _viewModel.PhoneDefault = user.Mobile;
}</pre>
<p>Bam! Welcome to the least sexy code<a id="_idIndexMarker102"/> ever written. If you post it to Reddit, the best you can hope for is the occasional <em class="italic">meh</em> amidst a litany of trollish comments, not all of which are limited to your code. That said, now you can scan it, and the rules governing setting the default phone number are fairly obvious. This is true because while the terse code was bad, we did at least use obvious object and property names to indicate proper intent.</p>
<h2 id="_idParaDest-50"><a id="_idTextAnchor049"/>Comment but donâ€™t go overboard</h2>
<p>Commenting<a id="_idIndexMarker103"/> on your code is good. Iâ€™ve read academic articles that present solid arguments for as much as one-third of your lines of code being devoted to comments. The problem with this is the practice is dangerously close to writing documentation, and the only thing programmers hate more than writing documentation is directly interacting with users. Good news â€“ if you write clean code using the ideas Iâ€™ve stressed so far, you can get away with fewer comments because your code will already be easy to read.</p>
<p>I think a happy medium is represented by a comment containing a brief restatement of the requirements. If your requirements are documented in an online system as they should be, you could even link to the requirement.</p>
<p>I also comment on anything that isnâ€™t obvious, such as my motivations for writing something a certain way. This is a useful comment: <em class="italic">Iâ€™m doing it this way because our suppliers require data to be in this format.</em> This way, my team doesnâ€™t come in behind me, see something they think needs refactoring, but wind up breaking code that conforms to customer requirements.</p>
<p>Comments go bad when there are too many of them. Commenting every line is silly unless youâ€™re writing a book, or teaching a class for beginners who are learning to read code for the first time.</p>
<h1 id="_idParaDest-51"><a id="_idTextAnchor050"/>Creating maintainable systems using SOLID principles</h1>
<p>SOLID is a reference<a id="_idIndexMarker104"/> to the top<a id="_idIndexMarker105"/> five principles of <strong class="bold">Object-Oriented Design</strong> (<strong class="bold">OOD</strong>):</p>
<ul>
<li>The Single Responsibility principle</li>
<li>The Open-Closed principle</li>
<li>The Liskov Substitution principle</li>
<li>The Interface Segregation principle</li>
<li>The Dependency Inversion principle</li>
</ul>
<p>Following these principles will allow you to create systems that are robust, extensible, and maintainable. Honoring these principles prepares you well for working with patterns because many patterns are built on or reference these principles.</p>
<h2 id="_idParaDest-52"><a id="_idTextAnchor051"/>The Single Responsibility principle</h2>
<p>Every method should<a id="_idIndexMarker106"/> do one thing. Every class should represent<a id="_idIndexMarker107"/> one thing. We call this idea the <strong class="bold">Single Responsibility Principle</strong> (<strong class="bold">SRP</strong>). If you have a method inside an object that does many things without invoking outside methods, your method is doing too much and runs the risk of becoming<a id="_idIndexMarker108"/> an example of the antipattern known as <em class="italic">the god function</em>. These are big, messy piles of inedible pasta. Once, I got a desperate text from a colleague. Her program was crashing. She couldnâ€™t figure out why. I looked. The entire program was in one file that when printed out was over 20 pages long. There were nine functions in the whole program. I closed the project, deferring the review for a time when I could sit down and go through it in earnest. I highly suspected she was ignoring the SRP.</p>
<p>Letâ€™s look at an example of a method that does too much:</p>
<pre class="source-code">public void doesTooMuch()
Â Â Â Â {
Â Â Â Â Â Â StreamReader sr = new StreamReader("C:\\Sample.txt");
Â Â Â Â Â Â var line = sr.ReadLine();</pre>
<p>Weâ€™ve started a function<a id="_idIndexMarker109"/> thatâ€™s clearly going<a id="_idIndexMarker110"/> to do too much. We begin by opening a text file on our computerâ€™s hard drive and reading in the first line. Next, letâ€™s read through each line in the file, and send each line of text to a fictitious online service that translates the text into another language.</p>
<p>To be valid, the sentence needs the text to be trimmed, all uppercase, and there can be no semicolons in there because the serviceâ€™s author got hacked by SQL injection once, and he vowed never again:</p>
<pre class="source-code">Â Â Â Â Â Â while (line != null)
Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Console.WriteLine(line);
Â Â Â Â Â Â Â Â var processedLine = line.Trim();
Â Â Â Â Â Â Â Â processedLine = line.ToUpper();
Â Â Â Â Â Â Â Â processedLine.Replace(";", ""); // no sql injection</pre>
<p>OK, the text is ready. Letâ€™s transmit it:</p>
<pre class="source-code">Â Â Â Â Â Â Â Â var url = "https://fake-translation-
Â Â Â Â Â Â Â Â Â Â Â Â service.com/translate";
Â Â Â Â Â Â Â Â var httpRequest = 
Â Â Â Â Â Â Â Â Â Â Â Â (HttpWebRequest)WebRequest.Create(url);
Â Â Â Â Â Â Â Â httpRequest.Method = "POST";
Â Â Â Â Â Â Â Â var data = "{\"input\":\"" + processedLine + "\"}";
Â Â Â Â Â Â Â Â using (var streamWriter = new 
Â Â Â Â Â Â Â Â StreamWriter(httpRequest.GetRequestStream()))
Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â streamWriter.Write(data);
Â Â Â Â Â Â Â Â }</pre>
<p>Weâ€™ve transmitted <a id="_idIndexMarker111"/>the data; letâ€™s parse out the response<a id="_idIndexMarker112"/> and print it to the console:</p>
<pre class="source-code">Â Â Â Â Â Â Â Â var httpResponse = 
Â Â Â Â Â Â Â Â Â Â Â Â (HttpWebResponse)httpRequest.GetResponse();
Â Â Â Â Â Â Â Â using (var streamReader = new 
Â Â Â Â Â Â Â Â StreamReader(httpResponse.GetResponseStream()))
Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â var result = streamReader.ReadToEnd();
Â Â Â Â Â Â Â Â Â Â Console.WriteLine("Translates to " + result);
Â Â Â Â Â Â Â Â }
Â </pre>
<p>Read the next line, rinse, and repeat until we reach the end of the file:Â Â Â Â Â Â Â </p>
<pre class="source-code">Â Â Â Â Â Â Â Â line = sr.ReadLine();
Â Â Â Â Â Â }</pre>
<p>If you open it, you should close it, so letâ€™s clean up after ourselves:</p>
<pre class="source-code">Â Â Â Â Â Â sr.Close();
Â Â Â Â }</pre>
<p>Can you see the problem here? We have one method performing many operations:</p>
<ol>
<li>We open a file.</li>
<li>We process each line.</li>
<li>We transmit to the service.</li>
<li>We process the results.</li>
</ol>
<p>Each of these should<a id="_idIndexMarker113"/> be separated into its own method. When you do this, you can<a id="_idIndexMarker114"/> reuse the methods in other contexts to solve other problems. Reading a file is generic. Itâ€™s the kind of thing youâ€™d do often. So is sanitizing your input string. So is posting to a <strong class="source-inline">RESTful</strong> endpoint. You canâ€™t reuse the <strong class="source-inline">doesTooMuch()</strong> method. Itâ€™s too specific to a single point of implementation. In <a href="B18605_03.xhtml#_idTextAnchor063"><em class="italic">Chapter 3</em></a>, <em class="italic">Getting Creative with Creational Patterns</em>, weâ€™re going to take off the training wheels and start learning patterns. Patterns are utterly incompatible with god methods of this kind.</p>
<h2 id="_idParaDest-53"><a id="_idTextAnchor052"/>The Open-Closed Principle</h2>
<p>Classes should<a id="_idIndexMarker115"/> be open for extension but<a id="_idIndexMarker116"/> closed for modification. This is called the <strong class="bold">Open-Closed Principle</strong> (<strong class="bold">OCP</strong>). This is especially true of software thatâ€™s already in production. Youâ€™ve got a set of well-written, fully tested production classes. Messing around with the wiring introduces the risk of breaking something. When new code can be written as an extension to what you already have, the risk is limited to the extension.</p>
<p>Letâ€™s look at an example by looking at code that violates the OCP. Weâ€™re going to make a simple utility designed to add up the areas of a set of geometric shapes. For our initial release, weâ€™ll support circles and squares. Iâ€™ll represent the <strong class="source-inline">Circle</strong> library this way:</p>
<pre class="source-code">Â Â public class Circle
Â Â {
Â Â Â Â public double Area { get; }
Â Â Â Â public Circle(double radius)
Â Â Â Â {
Â Â Â Â Â Â Area = Math.PI * (radius * radius);
Â Â Â Â }
Â Â }</pre>
<p>Iâ€™ve set this up with an <strong class="source-inline">Area</strong> property that is read-only. There is no reason to allow someone to set the property<a id="_idIndexMarker117"/> directly. Instead, I use the constructor<a id="_idIndexMarker118"/> to force you to define the radius of the circle on instantiation. This prevents you from setting <strong class="source-inline">Area</strong> to whatever the heck you feel like, which might result in the object entering an invalid state.</p>
<p>When you instantiate, you pass in the radius, which is all we need to find the area of the circle. Good old <em class="italic">Ï€Â â€¢ rÂ²,</em> or the constant pi times the radius squared. The area is set automatically.</p>
<p>We can do something similar with a square. We only need to know the length of one side:</p>
<pre class="source-code">Â Â public class Square
Â Â {
Â Â Â Â public double Area { get; }
Â Â Â Â public Square(double lengthOfOneSide)
Â Â Â Â {
Â Â Â Â Â Â Area = lengthOfOneSide * lengthOfOneSide;
Â Â Â Â }
Â Â }</pre>
<p>As before, we present an <strong class="source-inline">area</strong> property as read-only and use the constructor to set the area automatically upon instantiation by multiplying the <strong class="source-inline">lengthOfOneSide</strong> argument by itself.</p>
<p>Now, I have two classes to represent my shapes and each has an <strong class="source-inline">area</strong> property set automatically on instantiation. All I need is a class to glue them together:</p>
<pre class="source-code">public class AreaCalculator
Â Â {
Â Â Â Â private double _area { get; set; }
Â Â Â Â public double Area { get { return _area; } }
Â Â Â Â public void AddShape(Square square)
Â Â Â Â {
Â Â Â Â Â Â _area += square.Area;
Â Â Â Â }
Â Â Â Â public void AddShape(Circle circle)
Â Â Â Â {
Â Â Â Â Â Â _area += circle.Area;
Â Â Â Â }
}</pre>
<p>Here, we have a class called <strong class="source-inline">AreaCalcuator</strong> with an <strong class="source-inline">area</strong> property. On<a id="_idIndexMarker119"/> this one, I chose to create<a id="_idIndexMarker120"/> a backing variable to make it easy to keep a running total. Each time you add either a square or a circle using the twice-overloaded <strong class="source-inline">AddShape</strong> method, it takes the area computed on instantiation and adds it to the total.</p>
<p>I can test its function with code as follows:</p>
<pre class="source-code">var areaCalculator1 = new AreaCalculator();
areaCalculator1.AddShape(new Square(5d));
areaCalculator1.AddShape(new Square(25.3452d));
areaCalculator1.AddShape(new Circle(2342.093d));
Console.WriteLine("The total area of the shapes is " + areaCalculator1.Area);</pre>
<p>This looks pretty good! Ship it already! All is well until our delighted customer returns with a request to support more shapes. Itâ€™s not hard, is it? Maybe all they want is a rectangle. All I need to do is make a <strong class="source-inline">Rectangle</strong> class, then modify the <strong class="source-inline">AreaCalculator</strong> class with another constructor.</p>
<p>If I do this, I am violating<a id="_idIndexMarker121"/> the OCP because I have to change the <strong class="source-inline">AreaCalculator</strong> class directly<a id="_idIndexMarker122"/> every time we get a new shape requirement. I should design it so that you can pass in anything with an <strong class="source-inline">area</strong> property on it, then I would never have to alter <strong class="source-inline">AreaCalculator</strong> ever again. Letâ€™s fix it.</p>
<p>Iâ€™ll make an interface to define my requirement for an <strong class="source-inline">Area</strong> property:</p>
<pre class="source-code">public interface IShapeWithArea
{
Â Â public double Area { get; }
}</pre>
<p>Now, letâ€™s modify the shape classes to implement the interface. This is easy since both already have the <strong class="source-inline">area</strong> property exposed in a way that satisfies the requirements of the interface.</p>
<p>First, letâ€™s do the circle:</p>
<pre class="source-code">public class OCPCircle : IShapeWithArea
Â Â {
Â Â Â Â public double Area { get; }
Â Â Â Â public OCPCircle(double radius)
Â Â Â Â {
Â Â Â Â Â Â Area = Math.PI * (radius * radius);
Â Â Â Â }
Â Â }</pre>
<p>I renamed the class <strong class="source-inline">OCPCircle</strong> so that I wouldnâ€™t get them mixed up. Now, letâ€™s do the square:</p>
<pre class="source-code">public class OCPSquare : IShapeWithArea
Â Â {
Â Â Â Â public double Area { get; }
Â Â Â Â public OCPSquare(double lengthOfSide) { Area = 
Â Â Â Â Â Â Â Â lengthOfSide * lengthOfSide; }
Â Â }</pre>
<p>Next, Iâ€™ll modify the <strong class="source-inline">AreaCalculator</strong> class<a id="_idIndexMarker123"/> to use the interface as its type<a id="_idIndexMarker124"/> on the <strong class="source-inline">AddShape</strong> method:</p>
<pre class="source-code">public class OCPAreaCalculator
Â Â {
Â Â Â Â private double _area { get; set; }
Â Â Â Â public double Area { get { return _area; } }
Â Â Â Â public void AddShape(IShapeWithArea shape)
Â Â Â Â {
Â Â Â Â Â Â _area += shape.Area;
Â Â Â Â }
Â Â }</pre>
<p>Awesome! Now, we never need to alter this method in this class again. It is open for extension and closed for modification. To honor any new requirement for any shape, I need only add a new class that implements the <strong class="source-inline">IShapeWithArea</strong> interface.</p>
<p>Iâ€™ll go ahead and add a rectangle class that implements the same <strong class="source-inline">IShapeWithArea</strong> interface:</p>
<pre class="source-code">public class OCPRectangle : IShapeWithArea
Â Â {
Â Â Â Â public double Area { get; }
Â Â Â Â public OCPRectangle(double width, double height)
Â Â Â Â {
Â Â Â Â Â Â Area = width * height;
Â Â Â Â }
Â Â }</pre>
<p>It doesnâ€™t matter<a id="_idIndexMarker125"/> what the clients ask for next. Adding support<a id="_idIndexMarker126"/> for a hexagon, rhombus, or dodecagon is a simple matter of Googling the area formula for that shape and making a new class that implements our interface.</p>
<h2 id="_idParaDest-54"><a id="_idTextAnchor053"/>The Liskov Substitution principle</h2>
<p>In 1988, Barbara Liskov delivered<a id="_idIndexMarker127"/> a keynote speech at a conference<a id="_idIndexMarker128"/> titled <em class="italic">Data Abstraction and Hierarchy</em>, wherein she introduced what came to be called the <strong class="bold">Liskov Substitution Principle </strong>(<strong class="bold">LSP</strong>).</p>
<p>The principle states that any object of a subtype should be a suitable and working substitute for its superclass. This really relies on inheritance more than anything else. Using the strategy I just showed you, which is to rely more on interfaces than inheritance, youâ€™ll not likely run afoul of the LSP. By now, youâ€™ve no doubt surmised that I enjoy breaking rules (ask anyone), so letâ€™s break this one.</p>
<p>The requirements Iâ€™m working toward are similar but not identical to the last example. Here, I have a requirement to compute the area of rectangles â€“ just rectangles. To make this work, pretend that I didnâ€™t show you the best solution already in the last example:</p>
<pre class="source-code">public class Rectangle
{
Â Â public double Width { get; set; }
Â Â public double Height { get; set; }
Â Â public double Area { get { return Width * Height; } }
}</pre>
<p>I was a little less cautious this time. I used normal auto-implemented properties for the width and height rather than a constructor. If Iâ€™m breaking rules, I may as well let my hair down entirely. The <strong class="source-inline">Area</strong> property is suitably encapsulated, so you canâ€™t get up to anything too nefarious here.</p>
<p>Now, letâ€™s make a class to handle<a id="_idIndexMarker129"/> adding up areas of rectangles<a id="_idIndexMarker130"/> in a very similar fashion to our last example for the OCP:</p>
<pre class="source-code">public class RectangleAreaCalculator
{
Â Â public double Area { get; set; }
Â Â public void AddShape(Rectangle rectangle)
Â Â {
Â Â Â Â Area += rectangle.Area;
Â Â }
}</pre>
<p>Thatâ€™s pretty straightforward. Not even an hour after you create this, the ubiquitous pointy-haired boss tells you about a requirements change. You need to support a square too.</p>
<p>No problem, you think. A square IS A rectangle. Obviously, we can do this with inheritance. Perhaps we donâ€™t need any change at all, but the pointy-haired boss must be appeased. I highlighted the IS A term earlier because this phrase characterizes inheritance, and it happens to be true. A square IS A rectangle. We make the class. Since weâ€™re using inheritance, we need to make a quick change to the <strong class="source-inline">Rectangle</strong> class so that it can support inheritance. Weâ€™ll make the properties virtual so that we can override them in the subclass if we need to:</p>
<pre class="source-code">public class Rectangle
Â Â {
Â Â Â Â public virtual double Width { get; set; }
Â Â Â Â public virtual double Height { get; set; }
Â Â Â Â public virtual double Area { get { return Width * Height; } }
Â Â }</pre>
<p>The thing about the square<a id="_idIndexMarker131"/> is that it is rectangular, but we only<a id="_idIndexMarker132"/> need the length of one side to compute the area. The parent class, <strong class="source-inline">Rectangle</strong>, requires the length of two sides. Suddenly, things are starting to look a little ugly. Letâ€™s think while we type:</p>
<pre class="source-code">public class Square : Rectangle
{
Â Â private double _lengthOfSide;
Â Â public override double Width { 
Â Â Â Â get { return _lengthOfSide; } 
Â Â Â Â set { _lengthOfSide = value; } 
Â Â }
Â Â public override double Height { 
Â Â Â Â get { return _lengthOfSide; } 
Â Â Â Â set { _lengthOfSide = value; } 
Â Â }
Â Â public override double Area { 
Â Â Â Â get { return Width * Height; } 
Â Â }
}</pre>
<p>I had this great idea! We could fix it so that we have a backing variable. Any time you modify the width or height, the <strong class="source-inline">accessor</strong> method simply changes the backing variable, which is referenced by the getter on the <strong class="source-inline">Area</strong> property. Since both the width and height are set to the same thing, multiplying width times height will give us the area of the square. It doesnâ€™t mess up the whole rectangle class needing both values. I would now like you to visit YouTube and search for <em class="italic">Guinness beer commercial brilliant</em>. Pick any video with the cartoonish-looking guys. Iâ€™ll wait. Brilliant! This calls for celebration, perhaps even a libation. Will it work? Of course it will. Iâ€™ll ship it and feel extra special today, as though I got away with something naughty because I was clever. In fact, right now might be a good time to go do my taxes.</p>
<p>Meanwhile, in a totally different department, the newbie<a id="_idIndexMarker133"/> developer recently hired<a id="_idIndexMarker134"/> by the pointy-haired boss wrestles with a similar requirement. Naturally, we want to reuse as much as we can. The newbie takes your code but does something totally unexpected. The requirements make it necessary to change the numbers for the width and height. Never mind why. Do you know what happened to the last newbie that questioned the veracity of the pointy-haired bossâ€™ technical direction? Theyâ€™re in a basement cubicle without air conditioning somewhere hot and humid, working on ways to speed up bubble sort algorithms using Z80 assembly language on punched cards. Their breakroom is devoid of a latte machine. They donâ€™t even get Herman Miller chairs. Itâ€™s downright barbaric. You donâ€™t want that to be you, right?</p>
<p>Hereâ€™s the newbieâ€™s code:</p>
<pre class="source-code">public class LiskovAreaCalculator
{
Â Â public double Area { get; set; }
Â Â public void AddShape(Rectangle rectangle)
Â Â {
Â Â Â Â rectangle.Width = 10;
Â Â Â Â rectangle.Height = 20;
Â Â Â Â if (rectangle.Area != 200)
Â Â Â Â {
Â Â Â Â Â Â throw new Exception("Bad area!");
Â Â Â Â } 
Â Â Â Â else
Â Â Â Â {
Â Â Â Â Â Â Area = rectangle.Width * rectangle.Height;
Â Â Â Â }
Â Â }
}</pre>
<p>Brilliant? Maybe, but probably not. Some requirement<a id="_idIndexMarker135"/> is forcing the newbie<a id="_idIndexMarker136"/> to change the values of width and height independently within the superclass. This is not a problem for the <strong class="source-inline">Rectangle</strong> superclass, which is designed for this kind of thing. However, this will absolutely break the square implementation when you try to substitute the square for the rectangle, despite the obvious IS A relationship between a square and a rectangle. </p>
<p>If youâ€™re familiar with the Darwin Awards, youâ€™ll know that every winner utters the same phrase before embarking upon whatever it is that won them the award. In Texas, or pretty much any southern state, it happens as follows: <em class="italic">Hey, yâ€™all? Hold my beer and watch this.</em> </p>
<p>Iâ€™m going to show you an example of Liskov substitution.</p>
<pre class="source-code">var test1 = new LiskovAreaCalculator();
var testRectangle = new Rectangle();
testRectangle.Width = 5d;
testRectangle.Height = 6d;
test1.AddShape(testRectangle);
// Don't forget the answer won't be 30 on purpose. 
//It prints 200.
// That's not the problem.
Console.WriteLine("Area of test rectangle is " + testRectangle.Area);</pre>
<p>So far, so good. Everything works. This next part is where it breaks:</p>
<pre class="source-code">var testSquare = new Square();
testSquare.Width = 5d;
test1.AddShape(testSquare);
Console.WriteLine("Area of test square is " + testRectangle.Area);</pre>
<p>If we pass<a id="_idIndexMarker137"/> a square to <strong class="source-inline">AddShape</strong>, we get an answer<a id="_idIndexMarker138"/> that isnâ€™t 200. It comes out as 400, which causes the error to be thrown.</p>
<p>Because our intrepid newbie needed to change the <strong class="source-inline">base</strong> class to modify the values independently, we broke the LSP, which says we must be able to substitute the subclass, <strong class="source-inline">Square</strong>, for the superclass, <strong class="source-inline">Rectangle</strong>. While our sneaky overrides in the <strong class="source-inline">Square</strong> class seem clever, it doesnâ€™t work for every case. You might say weâ€™re trying to fit a square peg in a round hole. Then again, you might think better of it, ask for that beer back, and stare admiringly at the rugged simplicity of the earlier OCP solution with the interface, which is likely the best solution to this problem.</p>
<p>Youâ€™ve now seen an example of broken Liskov substitution. No doubt you want to see it done well. I will be happy to oblige you in later chapters, which are chock-full of references to the LSP.</p>
<h2 id="_idParaDest-55"><a id="_idTextAnchor054"/>The Interface Segregation principle</h2>
<p>No class should be forced <a id="_idIndexMarker139"/>to implement an interface<a id="_idIndexMarker140"/> that it doesnâ€™t use, nor should it depend on a method it doesnâ€™t use. Donâ€™t you hate it when this happens? Youâ€™re forced to use something you donâ€™t need or want? This is undoubtedly how the newbie who blew it with the Liskov substitution problem felt. However, weâ€™re coders, not psychologists, so letâ€™s press on and expand upon the idea of railing against being forced to use things we donâ€™t need via the <strong class="bold">Interface Segregation Principle</strong> (<strong class="bold">ISP</strong>).</p>
<p>Letâ€™s say we get a new requirement that has us working with two- and three-dimensional shapes, where we need the area for two-dimensional shapes and the volume for three-dimensional shapes. Naturally, we want to stick with something that works, and the interface idea in the section on the OCP seemed to work so well that it proved useful in the Liskov scenario too.</p>
<p>This time, the pointy-haired boss doesnâ€™t give us a newbie â€“ he gives us a seasoned veteran. Unfortunately, this seasoned veteran has a case of psychogenic blindness as a result of the <em class="italic">not invented by me</em> syndrome. This is to say that when he looks at any solution he didnâ€™t invent<a id="_idIndexMarker141"/> personally, he instantly<a id="_idIndexMarker142"/> assumes said solution is flawed, and he expresses his disdain for the solution using colorful language commonly heard emanating from maritime professionals. In short, he cusses as though he were a sailor when he describes code that he didnâ€™t write, even though the person who did write that code is probably a few cubes away. Since awkwardness means nothing to this guy, given heâ€™s the smartest guy in the room, he decides he doesnâ€™t need anything that weâ€™ve written so far and he strikes out on his own.</p>
<p>Heâ€™s in a hurry and this work is beneath him anyway. He wants to get back to solving the traveling salesman problem and the n-body problem simultaneously with a runtime of O(log n). Your silly project is in the way. He half-heartedly types the following:</p>
<pre class="source-code">public interface IPollutedShape
{
Â Â public double Width { get; set; }
Â Â public double Height { get; set; }
Â Â public double Depth { get; set; }
}</pre>
<p>OK, he wouldnâ€™t call it <strong class="source-inline">IPollutedShape</strong>. I did that for you. I spent 3 years working in technical pre-sales and I learned something that stuck with me. Never let the truth or any sense of realism get in the way of a good story.</p>
<p>You can see the problem without the implementation, right? If I made a <strong class="source-inline">cube</strong> or <strong class="source-inline">cuboid</strong> class that extends this interface, itâ€™s fine. Theyâ€™re both three-dimensional shapes and we need three dimensions to calculate volume.</p>
<p>However, if we use the same interface with a two-dimensional shape, weâ€™d be forced to have a <strong class="source-inline">Depth</strong> property, which has no place in such a class:</p>
<pre class="source-code">public class PollutedSquare : IPollutedShape
{
Â Â public double Width { get; set; }
Â Â public double Height { get; set; }
Â Â public double Depth { get; set; } //this is useless!
Â Â public double getArea()
Â Â {
Â Â Â Â return Width * Height;
Â Â }
}</pre>
<p>Yuck! Weâ€™ve got this extra property<a id="_idIndexMarker143"/> just sitting there doing<a id="_idIndexMarker144"/> nothing! It reminds me of that time my aunt Linda had spinach in her teeth. Whatever, we saved time by only making one interface. Our cocky super-coder can get back to picking up Sir Isaac Newtonâ€™s slack.</p>
<p>We have now violated the ISP by forcing the use of a property or method that we donâ€™t need. That other guy isnâ€™t paying attention. Someone asked about how it is to be a graduate student at Carnegie Mellon, and thereâ€™s nothing he loves more than talking about his time in graduate school back when he was dumbing down his best work just so that his professors could understand his assignments. This is perfect. Letâ€™s fix it while heâ€™s not looking.</p>
<p>Obviously, we need two interfaces. Unlike inheritance, where you can only have one superclass, you can implement multiple interfaces on one class. With C#, thereâ€™s an even cleaner way. Letâ€™s make the interface for the two-dimensional shapes:</p>
<pre class="source-code">public interface ITwoDeeShape
{
Â Â public double Width { get; set; }
Â Â public double Height { get; set; }
}</pre>
<p>Then, we do this:</p>
<pre class="source-code">public class SquareISP : ITwoDeeShape
{
Â Â public double Width { get; set; }
Â Â public double Height { get; set; }
Â Â public double getArea() { return Width * Height; }
}</pre>
<p>That was easy. A three-dimensional shape<a id="_idIndexMarker145"/> uses all the same parts<a id="_idIndexMarker146"/> as a two-dimensional shape but adds depth. Letâ€™s do this:</p>
<pre class="source-code">public interface IThreeDeeShape : ITwoDeeShape
{
Â Â public double Depth { get; set; }
}</pre>
<p>C# allows inheritance in interfaces. I used the properties defined in the interface for two-dimensional shapes and extended it to require a property representing depth. Now, letâ€™s type out the <strong class="source-inline">cube</strong> class for the win:</p>
<pre class="source-code">public class CubeISP : IThreeDeeShape
{
Â Â public double Width { get; set; }
Â Â public double Height { get; set; }
Â Â public double Depth { get; set; }
Â Â public double getVolume()
Â Â {
Â Â Â Â return Width * Height * Depth;
Â Â }
}</pre>
<p>Ta-da! We honor the ISP by only enforcing exactly what is needed and no more. Thereâ€™s nothing wrong with stacking<a id="_idIndexMarker147"/> multiple interfaces if thatâ€™s your thing. You can<a id="_idIndexMarker148"/> also use inheritance in your interfaces, as I did.</p>
<h2 id="_idParaDest-56"><a id="_idTextAnchor055"/>The Dependency Inversion principle</h2>
<p>When you first learn how<a id="_idIndexMarker149"/> to design an inheritance hierarchy, you<a id="_idIndexMarker150"/> learn that high-level objects establish a base, while low-level objects form dependencies on that base. The <strong class="bold">Dependency Inversion Principle</strong> (<strong class="bold">DIP</strong>) flips this upside down<a id="_idIndexMarker151"/> and forms the basis of a very important practice called <strong class="bold">decoupling</strong>. We saw the power of decoupling in the OCP example earlier. We learned how to use an interface to prevent a strong coupling between two concrete classes.</p>
<p>I am offering a note of caution. Dependency<a id="_idIndexMarker152"/> inversion on the surface sounds similar to <strong class="bold">Dependency Injection</strong> (<strong class="bold">DI</strong>). It also sounds similar to <strong class="bold">Inversion of Control</strong> (<strong class="bold">IoC</strong>). These are not identical concepts. Given<a id="_idIndexMarker153"/> that we just talked about Liskov substitution, you should understand that they are not interchangeable. The reasons are subtle but they are there. I donâ€™t want to stray<a id="_idIndexMarker154"/> too far off-topic, so Iâ€™ll leave you a link in the <em class="italic">Further reading</em> section at the end of this chapter where Martin Fowler explains the subtle differences between the three seemingly synonymous words. Letâ€™s move our focus back to the DIP. This principle states two points:</p>
<p><em class="italic">A. High-level classes or modules should not depend on low-level classes or modules and both should depend on abstractions.</em></p>
<p><em class="italic">B. Abstractions should not depend on implementation details but instead details should depend upon abstractions.</em></p>
<p>To me, this sounds comparable to something a Shaolin monk might say in a kung fu movie right before ripping off his shirt and serenely engaging in mortal combat. Letâ€™s see whether we can bring it to the street. Consider how you might design a lamp using OOP principles. One way might look as follows:</p>
<pre class="source-code">public class CoupledLamp
{
Â Â public bool IsLit { get; set; } = false;
}</pre>
<p>Thereâ€™s a lamp. We need a button to turn it on and off:</p>
<pre class="source-code">public class CoupledButton
{
Â Â public CoupledLamp Lamp { get; set; }
Â Â public void ToggleLamp()
Â Â {
Â Â Â Â if (Lamp.IsLit)
Â Â Â Â {
Â Â Â Â Â Â Console.WriteLine("The lamp is off");
Â Â Â Â }
Â Â Â Â else
Â Â Â Â {
Â Â Â Â Â Â Console.WriteLine("The lamp is on");
Â Â Â Â }
Â Â Â Â Lamp.IsLit = !Lamp.IsLit;
Â Â }
}</pre>
<p>This lamp will work. When<a id="_idIndexMarker155"/> you trigger the <strong class="source-inline">ToggleLamp</strong> method<a id="_idIndexMarker156"/> inside the button, the lamp will turn on or off as expected. However, it violates the DIP. The notion that a lamp is a high-level object while the button is a low-level object feels intuitive. Thereâ€™s just something wrong with putting a lamp inside of a button. Youâ€™d think it should be the other way around, just as it is in real life. Your gut feeling here results in violating both tenets of the DIP. The high-level object is inside the low-level object, and everything is a concrete class with nary an abstraction in sight. How do we fix it?</p>
<p>We can use composition. Remember that composition entails building, or composing, an object out of component objects. This could be something similar to the following:</p>
<pre class="source-code">public class ComposedButton
{
Â Â private bool _isOn = false;
Â Â public bool Toggle()
Â Â {
Â Â Â Â _isOn = !_isOn;
Â Â Â Â return _isOn;
Â Â }
}</pre>
<p>Hereâ€™s our button with<a id="_idIndexMarker157"/> no lamp in it. Instead, the button<a id="_idIndexMarker158"/> should be in the lamp. To put it another way, we should compose a lamp using a button:</p>
<pre class="source-code">public class ComposedLamp
{
Â Â private bool _isLit;
Â Â public ComposedButton Button { get; }
Â Â public ComposedLamp(ComposedButton button)
Â Â {
Â Â Â Â Button = button;
Â Â }
Â Â public void ToggleLamp()
Â Â {
Â Â Â Â _isLit = Button.Toggle();
Â Â Â Â if (_isLit)
Â Â Â Â {
Â Â Â Â Â Â Console.WriteLine("The lamp is on");
Â Â Â Â }
Â Â Â Â else
Â Â Â Â {
Â Â Â Â Â Â Console.WriteLine("The lamp is off");
Â Â Â Â }
Â Â }
}</pre>
<p>We inverted the dependency. The button<a id="_idIndexMarker159"/> is inside the lamp and the low-level<a id="_idIndexMarker160"/> object directly depends on the high-level object. Weâ€™ve satisfied the first tenet of the DIP. We still have more work to do before we reach Shaolin-level mastery. The button and the lamp are still tightly coupled via concrete <a id="_idIndexMarker161"/>object implementations. What if we want to use something other than the button to turn the lamp on? Maybe<a id="_idIndexMarker162"/> a motion detector. Maybe one of those fancy <strong class="bold">Internet of Things</strong> (<strong class="bold">IoT</strong>) microcontrollers that everybodyâ€™s talking about. Effectively, this is still a button, but itâ€™s much fancier and its object representation would be more complex than our button. We need an abstraction for the button that allows us to plug in any object that works as a button would. Letâ€™s make an interface that describes what the lamp needs:</p>
<pre class="source-code">public interface IToggleServer
{
Â Â bool ToggleOnOff();
}</pre>
<p>Then, we make the button extend the interface:</p>
<pre class="source-code">public class DIPButton : IToggleServer
{
Â Â private bool _enabled = false;
Â Â public bool Enabled { get { return _enabled; } }Â Â 
Â Â public bool ToggleOnOff() 
Â Â {
Â Â Â Â _enabled = !_enabled;
Â Â Â Â return _enabled;
Â Â }
}</pre>
<p>Now, we rewire the lamp:</p>
<pre class="source-code">public class DIPLamp
{
Â Â public IToggleServer DipoleSwitch { get; set; }
Â Â public DIPLamp(IToggleServer dipoleSwitch) 
Â Â Â Â { DipoleSwitch = dipoleSwitch; }
Â Â public void ToggleLamp()
Â Â {
Â Â Â Â if (DipoleSwitch.ToggleOnOff())
Â Â Â Â {
Â Â Â Â Â Â Console.WriteLine("The lamp is on");
Â Â Â Â }
Â Â Â Â else
Â Â Â Â {
Â Â Â Â Â Â Console.WriteLine("The lamp is off");
Â Â Â Â }
Â Â }
}</pre>
<p>As usual, I changed the names<a id="_idIndexMarker163"/> a little bit so that we can keep our examples straight. I changed the name of the member variable that formerly held our concrete button to something more generic, namely <strong class="source-inline">DipoleSwitch</strong>, which I figured could describe just about anything that fulfills a binary on-and-off function.</p>
<p>We now have a lamp with high-level and low-level objects in the proper orientation. We could argue that theyâ€™re correct now and that we started with them inverted the wrong way. Kind of like in the southern United States when someone offers you sweet tea or unsweetened tea. Thereâ€™s no such thing as unsweetened tea. It isnâ€™t as if you put the sweetness in and then took it out. It was unsweetened when it was made. The wording is weird, but we say it that way anyway. Thatâ€™s how our lamp started when it was inside the button class. It works, and everybody knows what you meant, but itâ€™s still wrong.</p>
<p>We also removed the concrete button object and swapped it for an interface. We could have used an abstract class to satisfy the second tenet, but I still believe we should tend toward interfaces, as they are more flexible.</p>
<p>We have, in the process<a id="_idIndexMarker164"/> of learning about the DIP, learned<a id="_idIndexMarker165"/> what it means to decouple. Decoupling is a strategy rather than a pattern and it has many uses at many different levels of your software projects. </p>
<h1 id="_idParaDest-57"><a id="_idTextAnchor056"/>Measuring quality beyond the development organization</h1>
<p>Weâ€™ve spent a lot of time<a id="_idIndexMarker166"/> in this chapter talking about quality code from the perspective of software engineering. Software is never developed in a bubble. It is always developed in concert with business professionals working to solve business problems. That means a great many people on your project might not be developers or engineers. All of our discussions so far have revolved around specific engineering practices. However, you need to realize that these views wonâ€™t be shared by your business-oriented colleagues.</p>
<p>For them, <em class="italic">quality</em> is often defined as <em class="italic">conformance to requirements</em>. That<a id="_idIndexMarker167"/> means quality code is code that meets its requirements. I would argue that this is a far too basic definition. The corporate quality movements of the 80s and 90s, such as the lean manufacturing and zero defects ideals espoused by Deming, have been coopted into our field by well-meaning managers. They want to focus 100 percent on the customer. They have trouble relating to what we do because they donâ€™t understand anything about software beyond the superficial layer the users see. Your non-engineer colleagues will have trouble talking to you about quality because you are speaking different languages.</p>
<p>To get everybody on the same page, letâ€™s consider some questions:</p>
<ul>
<li>What does the term <em class="italic">quality code</em> mean to you?</li>
<li>What does it mean to your boss?</li>
<li>What does it mean to your bossâ€™s boss?</li>
<li>What does it mean to your end users?</li>
<li>What does it mean to your suppliers, that is, the business professionals who supply the raw process inputs that drive your work?</li>
</ul>
<p>After youâ€™ve done this exercise, youâ€™ve likely explored a wide gamut of perspectives. </p>
<h2 id="_idParaDest-58"><a id="_idTextAnchor057"/>Code reviews</h2>
<p>In an age where<a id="_idIndexMarker168"/> everything is expected to be available in an instant, it becomes increasingly difficult to stress refactoring as a regular exercise. Itâ€™s very easy to solve a bug report as quickly as possible, do something sloppily, then move on to the next bug. Runners have the <em class="italic">runnerâ€™s high</em>, referring to a release of endorphins at some point during the run. Personally, I wouldnâ€™t know. I only run when chased. I think coders have a similar dependence on the dopamine released when we move an issue from <em class="italic">In Progress</em> to <em class="italic">Done</em>. Equally, if you have a project manager who reports up the chain of command, itâ€™s tempting to always present progress in terms of the number of issues worked through, rather than using actual quality metrics and tending to the health of your code base.</p>
<p>The best practice is to conduct code reviews. </p>
<p>Code reviews<a id="_idIndexMarker169"/> are perhaps the most important practice for maintaining a healthy code base, which leads to happy developers. Youâ€™ll experience fewer shipped bugs, fewer outages, and higher retention rates at a time when organizations are engaged in stiff competition to retain their development talent. Code reviews are an easy and inexpensive way to invest in your individual contributors. The developers under review, often by a senior teammate, will learn better techniques and more patterns. The senior developers can help their junior counterparts identify areas where they might benefit from training, at the beginning of the course, by assigning them a good book on patterns. Hopefully, you presently find yourself in a position to recommend one.</p>
<p>A lot of this book assumes very little about your level of experience in the field of software development. Following that principle, you may currently be wondering what a code review entails. A bad one is where someone glances at your code and after a minute or two says, â€œ<em class="italic">Meh. Looks good to me</em>.â€ They sign off on it and go back to what they were working on. Code reviews need to be scheduled as a meeting. If the code review is an interruption to someone elseâ€™s work, it will not yield results, and it will not be effective.</p>
<p>When conducting a code review, there are two key areas to consider: overall design and functionality.</p>
<h2 id="_idParaDest-59"><a id="_idTextAnchor058"/>Overall design</h2>
<p>This is ultimately a book designed<a id="_idIndexMarker170"/> to help you improve your understanding and practice of software design. It stands to reason that Iâ€™d bring this up in a review. Some questions I invariably ask consist of the following:</p>
<ul>
<li>How does the new code fit into the overall architecture of the production code?</li>
<li>Does the code follow SOLID principles, domain-driven design, behavior-driven design, or other paradigms followed by the team?</li>
<li>Are formatting and style conventions being honored? Do the names of things follow the guidelines we established earlier? Do they make sense? Are they easy to read? Are they self-describing?</li>
<li>Is the code readable per the first half of this chapter?</li>
<li>What patterns are used and are they appropriate?</li>
<li>Is the code in the right place? We donâ€™t want lasagna!</li>
<li>Can the new code be reused in other places? This might necessitate moving it.</li>
<li>Could the new code replace something we already have? If your addition has 100 lines of code that can replace 1,000, thatâ€™s a huge win!</li>
<li>What can I take out of the current code now that we have this new addition? I consider it a big deal when I get to remove code. If only this could apply to the US tax code as well!</li>
<li>Is the code too clever? Clever code requires effort through the cognitive load required to understand it. Look for opportunities to make your code scannable.</li>
<li>Aside from being readable, is it rife with features that were not asked for or specified? Is it loaded with code<a id="_idIndexMarker171"/> for use cases that are very unlikely to ever be needed? This is called <strong class="bold">You Ainâ€™t Gonna Need It</strong> (<strong class="bold">YAGNI</strong>).</li>
</ul>
<p>Use of the word â€œainâ€™tâ€ will likely<a id="_idIndexMarker172"/> anger my editors, my wife, my boss, my pastor, and my sixth-grade English teacher, but there it is. Deal with it, yâ€™all. Having reviewed the overall design, the review can shift to functionality.</p>
<h2 id="_idParaDest-60"><a id="_idTextAnchor059"/>Functionality</h2>
<p>The reviewâ€™s focus should entail making<a id="_idIndexMarker173"/> sure the code does what it is supposed to do. It should also ask questions about how we know the code is done beyond the warm feeling we got when we changed the issue status from <em class="italic">In Progress</em>:</p>
<ul>
<li>Can someone from another group who doesnâ€™t know the code look at this code and understand it?</li>
<li>Are the automated unit and regression tests passing consistently? What? You donâ€™t have tests? You need tests!</li>
<li>Is there documentation for the new features? How will the end users know how to use these new features, or even know that theyâ€™re there?</li>
<li>Are exceptions communicated well enough to give a full account of what went wrong to the technical team without blaming or unnecessarily confusing the user? </li>
<li>Does this new code introduce holes in your security?</li>
<li>Does anything violate regulatory constraints for your industry?</li>
<li>Did you benchmark performance? Can we make anything faster?</li>
<li>Is there any risk involved with rolling this to production right now?</li>
</ul>
<p>What have you not thought of?</p>
<p>This oneâ€™s tough. You canâ€™t do it by yourself. You need code reviews<a id="_idIndexMarker174"/> with another developer. While this is not an exhaustive checklist, these questions should get you moving in the right direction. </p>
<h1 id="_idParaDest-61"><a id="_idTextAnchor060"/>Summary</h1>
<p>This chapter was all about preparing you to transform the way that you work and the way you that think about creating software. Learning patterns is a big deal. They usually encourage big changes to the quality and maintainability of your projects.</p>
<p>We started with some common metaphors that describe the typical devolution of software projects, namely spaghetti code and lasagna code. Spaghetti code is represented by a chaotic structure. Lasagna code is represented as a tiered structure with a leaky state and functionality between layers. Ravioli code represents the best code, as it uses the same ingredients as spaghetti and lasagna, but the contents of ravioli are fully encapsulated.</p>
<p>We introduced a few topics that usually fill entire books on their own. SOLID principles are the guiding star for most serious coding organizations, but I rarely see them taught. Beginner- and intermediate-level coders are usually so focused on languages and syntax that they donâ€™t develop the muscles needed to plan and execute an architecture.</p>
<p>If this is you, the five principles of SOLID design are an excellent starting point and should be understood before diving into patterns.</p>
<p>We ended with a few pointers on performing code reviews.</p>
<p>You are now ready for an adventure. Youâ€™ve got all your prepper gear and youâ€™re ready for anything I might throw at you. In the next chapter, weâ€™ll begin learning about patterns, starting with creation patterns.</p>
<h1 id="_idParaDest-62"><a id="_idTextAnchor061"/>Further reading</h1>
<ul>
<li>Martin, R. C., &amp; Martin, M. (2006.)Â <em class="italic">Agile principles, patterns, and practices in C#</em> (Robert C. Martin.) Prentice Hall PTR.</li>
<li>Martin, R. C. (2009.)Â <em class="italic">Clean code: a handbook of agile software craftsmanship.</em> Pearson Education.</li>
<li>Schubert, B (2013.) <em class="italic">DIP in the Wild [Blog post.]</em> Retrieved from <a href="https://martinfowler.com/articles/dipInTheWild.xhtml#YouMeanDependencyInversionRight.">https://martinfowler.com/articles/dipInTheWild.xhtml#YouMeanDependencyInversionRight.</a></li>
</ul>
</div>
<div>
<div id="_idContainer020">
</div>
</div>
<div>
<div id="_idContainer021">
<img alt="" height="701" src="image/part-2-getting-started.jpg" width="868"/>
</div>
</div>
</div>


<div id="sbo-rt-content"><div class="Content" id="_idContainer022">
<h1 id="_idParaDest-63"><a id="_idTextAnchor062"/>Part 2: Patterns You Need in the Real World</h1>
<p>These chapters explain the most useful and popular patterns created by the Gang of Four. Weâ€™re strictly focused on the patterns that appear all the time in real-world projects â€“ patterns you should definitely know to advance your craft, and your career, to the next level. In each case, we will provide a generic UML diagram, followed by a real-world application. The generic pattern diagram will be re-drawn to fit the problem and we will then write the coded solution as instructed by our diagram.</p>
<p>This part covers the following chapters:</p>
<ul>
<li><a href="B18605_03.xhtml#_idTextAnchor063"><em class="italic">Chapter 3</em></a>, <em class="italic">Getting Creative with Creational Patterns</em> </li>
<li><a href="B18605_04.xhtml#_idTextAnchor078"><em class="italic">Chapter 4</em></a>, <em class="italic">Fortify Your Code with Structural Patterns</em></li>
<li><a href="B18605_05.xhtml#_idTextAnchor089"><em class="italic">Chapter 5</em></a>, <em class="italic">Wrangling Problem Code by Applying Behavioral Patterns</em></li>
</ul>
</div>
</div>
</body></html>