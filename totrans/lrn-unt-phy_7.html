<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;7.&#xA0;Optimizing Application's Performance Using Physics in Unity3D"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07" class="calibre1"/>Chapter 7. Optimizing Application's Performance Using Physics in Unity3D</h1></div></div></div><p class="calibre8">In this chapter, you will learn how to optimize your game or application during development with Unity3D. There are several factors that need to be kept in mind to run the app or game smoothly. We will handle optimization using Physics best practices. Although, this <a id="id302" class="calibre1"/>chapter will cover Physics tricks <a id="id303" class="calibre1"/>primary to handle the performance optimization, you will learn other Unity3D tricks for performance handling as bonus topics.</p><p class="calibre8">We will cover the following topics:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Developing an optimized application and game</li><li class="listitem">Checking performance</li><li class="listitem">Moving the static collider</li><li class="listitem">Mesh Colliders</li><li class="listitem">The complex collider shape</li><li class="listitem">Rigidbodies</li><li class="listitem">Joints</li><li class="listitem">The Cloth component</li><li class="listitem">Optimized graphics</li><li class="listitem">Low timestep</li><li class="listitem">Pros of performance optimization</li></ul></div></div>

<div class="book" title="Chapter&#xA0;7.&#xA0;Optimizing Application's Performance Using Physics in Unity3D">
<div class="book" title="Developing an optimized application and game"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch07lvl1sec28" class="calibre1"/>Developing an optimized application and game</h1></div></div></div><p class="calibre8">Performance<a id="id304" class="calibre1"/> is a critical factor for games and applications, and for a fast-paced action game, it becomes the key point. For those features where fast Physics combined with fully animated characters and a 3D world are required, performance optimization is the most important factor. Any game or application <a id="id305" class="calibre1"/>needs 60 frames per seconds of performance, and so we will need to optimize our game for target devices to achieve that.</p></div></div>

<div class="book" title="Chapter&#xA0;7.&#xA0;Optimizing Application's Performance Using Physics in Unity3D">
<div class="book" title="Developing an optimized application and game">
<div class="book" title="Checking performance"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch07lvl2sec28" class="calibre1"/>Checking performance</h2></div></div></div><p class="calibre8">
<span class="strong"><strong class="calibre9">Unity Profiler</strong></span> is the first thing that we should use to check the performance of a game or application. Profiler is a great tool that comes with Unity Pro, using which we determine where <a id="id306" class="calibre1"/>any<a id="id307" class="calibre1"/> frame rate issues are coming from.</p><p class="calibre8">Profiler<a id="id308" class="calibre1"/> uses a graph to show the CPU usage while we play the game. Profiler is divided in categorizes such as <span class="strong"><strong class="calibre9">Rendering</strong></span>, <span class="strong"><strong class="calibre9">Scripts</strong></span>, <span class="strong"><strong class="calibre9">Physics</strong></span>, <span class="strong"><strong class="calibre9">Garbage</strong></span> <span class="strong"><strong class="calibre9">Collector</strong></span>, <span class="strong"><strong class="calibre9">VSync</strong></span>, and others. This is how it looks:</p><div class="mediaobject"><img src="../images/00097.jpeg" alt="Checking performance" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre8">Now, let's see how we handle optimization during the Physics implementation.</p></div></div></div>

<div class="book" title="Chapter&#xA0;7.&#xA0;Optimizing Application's Performance Using Physics in Unity3D">
<div class="book" title="Developing an optimized application and game">
<div class="book" title="Moving static colliders"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch07lvl2sec29" class="calibre1"/>Moving static colliders</h2></div></div></div><p class="calibre8">To make less expensive performance, we should avoid moving static colliders. You learned in previous<a id="id309" class="calibre1"/> chapters that a static collider is a game object with a collider component on it; however, it does not have a Rigidbody component. Moving static colliders is one of the top causes of performance issues in Unity games and it is expensive. If we need to create them with codes, we should add the collider and Physic Materials <span class="strong"><em class="calibre10">after</em></span> its positioning.</p></div></div></div>

<div class="book" title="Chapter&#xA0;7.&#xA0;Optimizing Application's Performance Using Physics in Unity3D">
<div class="book" title="Developing an optimized application and game">
<div class="book" title="Mesh Colliders"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch07lvl2sec30" class="calibre1"/>Mesh Colliders</h2></div></div></div><p class="calibre8">
<span class="strong"><strong class="calibre9">Mesh Colliders</strong></span>
<a id="id310" class="calibre1"/> are slow compared to the <a id="id311" class="calibre1"/>primitive Box/Sphere Collider. A sphere has many more vertices than a cube but the uniform distance from the center makes the calculation <a id="id312" class="calibre1"/>much easier in comparison to the many individual triangles. Mesh colliders have a much higher performance overhead than primitive colliders.</p></div></div></div>

<div class="book" title="Chapter&#xA0;7.&#xA0;Optimizing Application's Performance Using Physics in Unity3D">
<div class="book" title="Developing an optimized application and game">
<div class="book" title="The complex collider shape"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch07lvl2sec31" class="calibre1"/>The complex collider shape</h2></div></div></div><p class="calibre8">To get better performance for more complex shapes, we should combine primitive colliders. Let's have a look at an example. If we have a parent object with a Box Collider and <a id="id313" class="calibre1"/>Rigidbody component, we should add child objects with just a Box Collider. The collision for an entire object will have one multipart object. Rather than having several objects linked together, we can add more child objects with Rigidbodies and colliders and use joints to connect them to the parent object. As shown in the following screenshot, we used a Capsule Collider for the complex object:</p><div class="mediaobject"><img src="../images/00098.jpeg" alt="The complex collider shape" class="calibre11"/></div><p class="calibre12"> </p></div></div></div>

<div class="book" title="Chapter&#xA0;7.&#xA0;Optimizing Application's Performance Using Physics in Unity3D">
<div class="book" title="Developing an optimized application and game">
<div class="book" title="Rigidbodies"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_6"><a id="ch07lvl2sec32" class="calibre1"/>Rigidbodies</h2></div></div></div><p class="calibre8">Less use of Rigidbodies and materials saves performance. Again, the use of interpolation and <a id="id314" class="calibre1"/>extrapolation on Rigidbodies is discouraged all together. The total amount of Physics calculation depends on the number of nonsleeping Rigidbodies and colliders in the scene and the complexity of the colliders. We should handle performance by reducing calculation as much as possible.</p></div></div></div>

<div class="book" title="Chapter&#xA0;7.&#xA0;Optimizing Application's Performance Using Physics in Unity3D">
<div class="book" title="Developing an optimized application and game">
<div class="book" title="Joints"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_7"><a id="ch07lvl2sec33" class="calibre1"/>Joints</h2></div></div></div><p class="calibre8">We cannot use multiple basic joints on one game object as it is not supported, but we can use <a id="id315" class="calibre1"/>multiple configurable joints, which helps a lot in performance optimization. Rather than having a network of joint objects, we should use configurable joints wherever possible to avoid unnecessary memory consumption.</p></div></div></div>

<div class="book" title="Chapter&#xA0;7.&#xA0;Optimizing Application's Performance Using Physics in Unity3D">
<div class="book" title="Developing an optimized application and game">
<div class="book" title="The Cloth component"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_8"><a id="ch07lvl2sec34" class="calibre1"/>The Cloth component</h2></div></div></div><p class="calibre8">The use<a id="id316" class="calibre1"/> of multiple Cloth components in one game is very expensive so should minimize the use of multiple Cloth components.</p></div></div></div>

<div class="book" title="Chapter&#xA0;7.&#xA0;Optimizing Application's Performance Using Physics in Unity3D">
<div class="book" title="Developing an optimized application and game">
<div class="book" title="Lower timestep"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_9"><a id="ch07lvl2sec35" class="calibre1"/>Lower timestep</h2></div></div></div><p class="calibre8">A lower frame rate gives breathing room and helps in memory optimization. I personally find<a id="id317" class="calibre1"/> a 0.03 fixed timestep with a maximum of about 0.05 to be good for better performance. We can reduce the time spent on Physics updates by adjusting the fixed timestep setting. Increasing the timestep will reduce the CPU overhead but sometimes, the accuracy of Physics gets affected.</p></div></div></div>

<div class="book" title="Chapter&#xA0;7.&#xA0;Optimizing Application's Performance Using Physics in Unity3D">
<div class="book" title="Developing an optimized application and game">
<div class="book" title="Precalculation"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_10"><a id="ch07lvl2sec36" class="calibre1"/>Precalculation</h2></div></div></div><p class="calibre8">Precalculation<a id="id318" class="calibre1"/> during development can be very important to achieve high performance and make certain effects possible. Taking the approach of calculating as much as possible at the start of execution can have a great impact on performance.</p><p class="calibre8">Apart from Physics-based performance optimizations, there are other factors too that we should use to optimize our game or app. Let's have a few examples.</p></div></div></div>

<div class="book" title="Chapter&#xA0;7.&#xA0;Optimizing Application's Performance Using Physics in Unity3D">
<div class="book" title="Developing an optimized application and game">
<div class="book" title="Optimizing graphics"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_11"><a id="ch07lvl2sec37" class="calibre1"/>Optimizing graphics</h2></div></div></div><p class="calibre8">Performance optimization depends upon how fast we can render by GPU, which is mostly <a id="id319" class="calibre1"/>limited by the number of pixels rendered and by the memory bandwidth. The CPU performance is also limited by the amount of draw calls processed. We can use GPU Profiler to find out how much time and how many draw calls are in the scene. To save rendering time, we should remove as many draw calls as possible.</p><p class="calibre8">As shown in the following screenshot, by clicking on <span class="strong"><strong class="calibre9">Stats</strong></span>, we can see the <span class="strong"><strong class="calibre9">Statistics</strong></span> window:</p><div class="mediaobject"><img src="../images/00099.jpeg" alt="Optimizing graphics" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre8">To <a id="id320" class="calibre1"/>improve CPU performance, we should take into account the following points:</p><div class="book"><ul class="itemizedlist"><li class="listitem">For high performance, don't use more than a few hundred draw calls per frame while draw call counts vary for older devices</li><li class="listitem">By combining nearby objects into single meshes, we can reduce draw calls</li><li class="listitem">By using automatically Unity's draw call batching, we can reduce draw calls</li><li class="listitem">Using fewer different materials enables better batching of meshes</li><li class="listitem">By <a id="id321" class="calibre1"/>using a textures atlas where possible, we can reduce draw calls</li></ul></div><p class="calibre8">To improve GPU performance, we should note the following points:</p><div class="book"><ul class="itemizedlist"><li class="listitem">By reducing the texture quality in the <span class="strong"><strong class="calibre9">Quality</strong></span> settings, we can make the game run faster; we limit memory bandwidth by applying this</li><li class="listitem">We can reduce shader complexity using mobile GPUs and <a id="id322" class="calibre1"/>avoid alpha-testing <a id="id323" class="calibre1"/>shader.</li><li class="listitem">Use texture compression or 16-bit textures</li><li class="listitem">Reduce the texture size</li></ul></div></div></div></div>

<div class="book" title="Chapter&#xA0;7.&#xA0;Optimizing Application's Performance Using Physics in Unity3D">
<div class="book" title="Developing an optimized application and game">
<div class="book" title="Script call optimization for an iOS build"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_12"><a id="ch07lvl2sec38" class="calibre1"/>Script call optimization for an iOS build</h2></div></div></div><p class="calibre8">To make a big impact on project completion, from the initial phase of project, we should use slow <a id="id324" class="calibre1"/>but safe option of <span class="strong"><strong class="calibre9">Script Call Optimization</strong></span>. Using this unhandled exception will crash the Unity build but if handled, we can get a higher performance at the end of the project. To apply this, navigate to the <span class="strong"><strong class="calibre9">Player</strong></span> setting and select <span class="strong"><strong class="calibre9">iOS</strong></span> as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00100.jpeg" alt="Script call optimization for an iOS build" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre8">There are some simple rules for handling performance such as:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Pixel lights are too expensive, so we should avoid them to get high performance</li><li class="listitem">Keep <a id="id325" class="calibre1"/>your draw call count low because graphics rendering is CPU expensive</li><li class="listitem">We should mark the objects that don't move as static</li><li class="listitem">For moving objects, try to keep the vertex count below 300</li><li class="listitem">We should avoid instantiating or destroying objects in runtime as the memory is slow</li><li class="listitem">Avoid alpha because it rejects pixels on iOS devices and it is slow; use alpha blend instead</li></ul></div></div></div></div>
<div class="book" title="Pros of performance optimization"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec29" class="calibre1"/>Pros of performance optimization</h1></div></div></div><p class="calibre8">For a<a id="id326" class="calibre1"/> successful game or application, the most important and required key point is good performance. Smooth game play attracts players; similarly, a better and fast user experience allows to capture a large audience.</p><p class="calibre8">A great game or application but with a slow speed or that crashes often never succeeds. Thus, the most important advantage of performance optimization is that using it, we provide fast and smooth gameplay and better user experience, and avoid lags or crashes.</p></div>
<div class="book" title="Summary"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec30" class="calibre1"/>Summary</h1></div></div></div><p class="calibre8">In this chapter, you learned the different ways to handle performance. You learned about different Physics components and the ways they can be used for better performance. You learned how to use a single collider for a complex object, that we should not use multiple cloth components in one game, and that we can optimize graphics by reducing the number of draw calls.</p><p class="calibre8">This book is all about learning Physics with Unity3D. We saw that Unity has a powerful Physics engine. You learned about the different Physics components provided by Unity3D to make a developer's life easier. You learned how to use Physics when creating animations. Now, you are set to learn about networking and multiplayer game and application using Unity3D.</p></div></body></html>