<html><head></head><body>
  <div id="_idContainer091">
   <h1 class="chapter-number" id="_idParaDest-116">
    <a id="_idTextAnchor117">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     7
    </span>
   </h1>
   <h1 id="_idParaDest-117">
    <a id="_idTextAnchor118">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Adding Capabilities to Applications
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.3.1">
     ASP.NET Core 9 provides different features and tools that enable us to develop powerful web-based solutions.
    </span>
    <span class="koboSpan" id="kobo.3.2">
     However, we often need more specialized features in order to provide a better end-to-end experience.
    </span>
    <span class="koboSpan" id="kobo.3.3">
     In this chapter, we will learn good practices related to web applications such as adding caching, using asynchronous mechanisms, resilience mechanisms, and logging.
    </span>
    <span class="koboSpan" id="kobo.3.4">
     We will explore essential best practices for developing applications with ASP.NET Core 9, covering the correct use of asynchronous mechanisms, HTTP requests, and application instrumentation
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.4.1">
      through logs.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.5.1">
     We will focus on the following topics in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.6.1">
      this chapter:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.7.1">
      Working with ASP.NET Core 9
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.8.1">
       best practices
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.9.1">
      Improving performance with a cache strategy and making the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.10.1">
       application resilient
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.11.1">
      Understanding and implementing logging
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.12.1">
       and monitoring
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-118">
    <a id="_idTextAnchor119">
    </a>
    <span class="koboSpan" id="kobo.13.1">
     Technical requirements
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.14.1">
     To support the learning of this chapter, the following tools must be present in your
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.15.1">
      development environment:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.16.1">
       Docker
      </span>
     </strong>
     <span class="koboSpan" id="kobo.17.1">
      : Docker Engine must be installed on your operating system and have a SQL Server container running.
     </span>
     <span class="koboSpan" id="kobo.17.2">
      You can find more details about Docker and the SQL Server container in
     </span>
     <a href="B21788_05.xhtml#_idTextAnchor078">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.18.1">
         Chapter 5
        </span>
       </em>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.19.1">
       .
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.20.1">
       Postman
      </span>
     </strong>
     <span class="koboSpan" id="kobo.21.1">
      : This tool will be used to execute requests to APIs of the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.22.1">
       developed application.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.23.1">
       Redis Insight
      </span>
     </strong>
     <span class="koboSpan" id="kobo.24.1">
      : This tool is used to connect to a Redis Server
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.25.1">
       database (
      </span>
     </span>
     <a href="https://redis.io/insight/">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.26.1">
        https://redis.io/insight/
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.27.1">
       ).
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.28.1">
     The code examples used in this chapter can be found in the book’s GitHub
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.29.1">
      repository:
     </span>
    </span>
    <a href="https://github.com/PacktPublishing/ASP.NET-Core-9.0-Essentials/tree/main/Chapter07">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.30.1">
       https://github.com/PacktPublishing/ASP.NET-Core-9.0-Essentials/tree/main/Chapter07
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.31.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-119">
    <a id="_idTextAnchor120">
    </a>
    <span class="koboSpan" id="kobo.32.1">
     Working with ASP.NET Core 9 best practices
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.33.1">
     So far, we have already learned about several features and benefits of ASP.NET Core 9 in creating quality web systems.
    </span>
    <span class="koboSpan" id="kobo.33.2">
     Of course, just like any other software development technology, there is no restriction on the way we will handle our code.
    </span>
    <span class="koboSpan" id="kobo.33.3">
     In this way, we have the freedom to create solutions and new standards with the aim of meeting a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.34.1">
      specific need.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.35.1">
     However, relying on good practices can not only expand our capacity to develop quality applications but also avoid wasting several hours to achieve
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.36.1">
      a goal.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.37.1">
     In this case, we will address some good practices necessary to bring greater quality to our applications, starting with the correct use of
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.38.1">
       HTTP requests
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.39.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-120">
    <a id="_idTextAnchor121">
    </a>
    <span class="koboSpan" id="kobo.40.1">
     HTTP request best practices
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.41.1">
     The HTTP request
    </span>
    <a id="_idIndexMarker535">
    </a>
    <span class="koboSpan" id="kobo.42.1">
     is a fundamental component when working with web
    </span>
    <a id="_idIndexMarker536">
    </a>
    <span class="koboSpan" id="kobo.43.1">
     applications.
    </span>
    <span class="koboSpan" id="kobo.43.2">
     Proper handling of HTTP requests can significantly impact the performance and reliability of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.44.1">
      your application.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.45.1">
     We have already learned about the types of HTTP verbs and status codes in
    </span>
    <a href="B21788_03.xhtml#_idTextAnchor044">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.46.1">
        Chapter 3
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.47.1">
     .
    </span>
    <span class="koboSpan" id="kobo.47.2">
     However, each HTTP method provided by the application must be treated appropriately, to avoid inconsistencies in the application and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.48.1">
      avoid vulnerabilities.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.49.1">
     Furthermore, the way HTTP requests are made directly impacts the experience of users or consumers of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.50.1">
      your solution.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.51.1">
     Let’s understand some good practices related to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.52.1">
      HTTP requests.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.53.1">
     Validate and sanitize input
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.54.1">
     Always validate and
    </span>
    <a id="_idIndexMarker537">
    </a>
    <span class="koboSpan" id="kobo.55.1">
     sanitize input to prevent
    </span>
    <a id="_idIndexMarker538">
    </a>
    <span class="koboSpan" id="kobo.56.1">
     security vulnerabilities such as
    </span>
    <a id="_idIndexMarker539">
    </a>
    <span class="koboSpan" id="kobo.57.1">
     SQL injection and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.58.1">
      cross-site
     </span>
    </strong>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.59.1">
       scripting
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.60.1">
      (
     </span>
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.61.1">
       XSS
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.62.1">
      ).
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.63.1">
     XSS
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.64.1">
     XSS is a
    </span>
    <a id="_idIndexMarker540">
    </a>
    <span class="koboSpan" id="kobo.65.1">
     security vulnerability where the attacker injects scripts into web pages.
    </span>
    <span class="koboSpan" id="kobo.65.2">
     To know
    </span>
    <a id="_idIndexMarker541">
    </a>
    <span class="koboSpan" id="kobo.66.1">
     more, go
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.67.1">
      to
     </span>
    </span>
    <a href="https://learn.microsoft.com/en-us/aspnet/core/security/cross-site-scripting?view=aspnetcore-9.0">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.68.1">
       https://learn.microsoft.com/en-us/aspnet/core/security/cross-site-scripting?view=aspnetcore-9.0
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.69.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.70.1">
     Consider
    </span>
    <a id="_idIndexMarker542">
    </a>
    <span class="koboSpan" id="kobo.71.1">
     a scenario where a user submits a form with a username.
    </span>
    <span class="koboSpan" id="kobo.71.2">
     To prevent
    </span>
    <a id="_idIndexMarker543">
    </a>
    <span class="koboSpan" id="kobo.72.1">
     harmful data from being processed, you
    </span>
    <a id="_idIndexMarker544">
    </a>
    <span class="koboSpan" id="kobo.73.1">
     should validate the input to ensure it meets the expected criteria and sanitize it to remove any
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.74.1">
      malicious content:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.75.1">
public IActionResult Submit(string username)
{
    </span><strong class="bold"><span class="koboSpan" id="kobo.76.1">if (string.IsNullOrEmpty(username))</span></strong><span class="koboSpan" id="kobo.77.1">
    {
        return BadRequest("Username is required.");
    }
    username = </span><strong class="bold"><span class="koboSpan" id="kobo.78.1">HttpUtility.HtmlEncode(username);</span></strong><span class="koboSpan" id="kobo.79.1">
    // Proceed with processing the username
    return Ok();
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.80.1">
     The preceding code demonstrates a simple validation of the username parameter,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.81.1">
      if(string.IsNullOrEmpty)
     </span>
    </strong>
    <span class="koboSpan" id="kobo.82.1">
     , avoiding using it incorrectly.
    </span>
    <span class="koboSpan" id="kobo.82.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.83.1">
      HttpUtility.HtmlEncode(username)
     </span>
    </strong>
    <span class="koboSpan" id="kobo.84.1">
     method is used to convert characters such as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.85.1">
      &lt;
     </span>
    </strong>
    <span class="koboSpan" id="kobo.86.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.87.1">
      &gt;
     </span>
    </strong>
    <span class="koboSpan" id="kobo.88.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.89.1">
      &amp;
     </span>
    </strong>
    <span class="koboSpan" id="kobo.90.1">
     , and so on into an
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.91.1">
      HTML-encoded format.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.92.1">
     Use asynchronous methods
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.93.1">
     During the execution flow
    </span>
    <a id="_idIndexMarker545">
    </a>
    <span class="koboSpan" id="kobo.94.1">
     of an HTTP request, we must avoid making the processing actions synchronous.
    </span>
    <span class="koboSpan" id="kobo.94.2">
     Otherwise, this could degrade the user experience and cause some problems for the application, such as
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.95.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.96.1">
       Thread blocking
      </span>
     </strong>
     <span class="koboSpan" id="kobo.97.1">
      : Synchronous
     </span>
     <a id="_idIndexMarker546">
     </a>
     <span class="koboSpan" id="kobo.98.1">
      methods block the thread while waiting for I/O operations (such as database queries, file access, or network requests) to complete.
     </span>
     <span class="koboSpan" id="kobo.98.2">
      In an ASP.NET Core application, the thread pool is a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.99.1">
       limited resource.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.100.1">
       Thread pool exhaustion
      </span>
     </strong>
     <span class="koboSpan" id="kobo.101.1">
      : When an
     </span>
     <a id="_idIndexMarker547">
     </a>
     <span class="koboSpan" id="kobo.102.1">
      application heavily relies on synchronous methods, the thread pool can become exhausted, especially under high load, which occurs when all available threads are blocked and no new threads are available to handle
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.103.1">
       incoming requests.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.104.1">
     It is a recommendation and good practice to use asynchronous methods to improve performance and scalability.
    </span>
    <span class="koboSpan" id="kobo.104.2">
     For example, when using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.105.1">
      HttpClient
     </span>
    </strong>
    <span class="koboSpan" id="kobo.106.1">
     object to make a request in an API, use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.107.1">
      HttpClient.SendAsync
     </span>
    </strong>
    <span class="koboSpan" id="kobo.108.1">
     method instead
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.109.1">
      of
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.110.1">
       HttpClient.Send
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.111.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.112.1">
     Asynchronous programming
    </span>
    <a id="_idIndexMarker548">
    </a>
    <span class="koboSpan" id="kobo.113.1">
     allows your application to handle multiple tasks simultaneously without waiting for each task to complete before starting the next one.
    </span>
    <span class="koboSpan" id="kobo.113.2">
     This is similar to how a chef in a busy kitchen might prepare multiple dishes at once, rather than finishing one dish before
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.114.1">
      starting another.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.115.1">
     We will cover the use of asynchronous programming in more detail in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.116.1">
      Asynchronous requests and I/O optimization
     </span>
    </em>
    <span class="koboSpan" id="kobo.117.1">
     section.
    </span>
    <span class="koboSpan" id="kobo.117.2">
     Now, let’s understand another good practice in relation to HTTP requests, regarding caching
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.118.1">
      and compression.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.119.1">
     Caching and compression
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.120.1">
     Requests via
    </span>
    <a id="_idIndexMarker549">
    </a>
    <span class="koboSpan" id="kobo.121.1">
     the HTTP protocol have some attributes, including headers and body.
    </span>
    <span class="koboSpan" id="kobo.121.2">
     During communication between an application and the backend, this information is transmitted, and the headers are used both by the client (in this case, the browser) and by
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.122.1">
      the backend.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.123.1">
     There are several types of
    </span>
    <a id="_idIndexMarker550">
    </a>
    <span class="koboSpan" id="kobo.124.1">
     HTTP headers, including those associated with caching
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.125.1">
      and
     </span>
    </span>
    <span class="No-Break">
     <a id="_idIndexMarker551">
     </a>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.126.1">
      compression.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.127.1">
     By utilizing caching and response compression, we can reduce bandwidth usage and improve load times.
    </span>
    <span class="koboSpan" id="kobo.127.2">
     Browsers also identify these headers, avoiding unnecessary requests to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.128.1">
      the server.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.129.1">
     Caching and dating
    </span>
    <a id="_idIndexMarker552">
    </a>
    <span class="koboSpan" id="kobo.130.1">
     compression
    </span>
    <a id="_idIndexMarker553">
    </a>
    <span class="koboSpan" id="kobo.131.1">
     work similarly to how a library
    </span>
    <a id="_idIndexMarker554">
    </a>
    <span class="koboSpan" id="kobo.132.1">
     might
    </span>
    <a id="_idIndexMarker555">
    </a>
    <span class="koboSpan" id="kobo.133.1">
     keep frequently borrowed books readily accessible or how a vacuum-sealed package takes up less space.
    </span>
    <span class="koboSpan" id="kobo.133.2">
     These practices reduce the load on your server and speed up responses to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.134.1">
      user requests.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.135.1">
     Let’s analyze the following code snippet extracted from a
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.136.1">
       Program.cs
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.137.1">
      class:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.138.1">
// Add services to the container. </span><span class="koboSpan" id="kobo.138.2">builder.Services.AddResponseCaching();
</span><strong class="bold"><span class="koboSpan" id="kobo.139.1">app.UseResponseCaching();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.140.1">app.Use(async (context, next)</span></strong><span class="koboSpan" id="kobo.141.1"> =&gt; {
  context.Response.GetTypedHeaders().CacheControl =
    new Microsoft.Net.Http.Headers.CacheControlHeaderValue
    {
      Public = true, MaxAge = TimeSpan.FromMinutes(10)
    };
    await next();
});</span></pre>
   <p>
    <span class="koboSpan" id="kobo.142.1">
     Let’s
    </span>
    <a id="_idIndexMarker556">
    </a>
    <span class="koboSpan" id="kobo.143.1">
     understand the preceding code.
    </span>
    <span class="koboSpan" id="kobo.143.2">
     When you add
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.144.1">
      app.UseResponseCaching
     </span>
    </strong>
    <span class="koboSpan" id="kobo.145.1">
     to the application’s
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.146.1">
      middleware
     </span>
    </strong>
    <span class="koboSpan" id="kobo.147.1">
     pipeline, it performs the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.148.1">
      following functions:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.149.1">
       Checks for
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.150.1">
        Cache-Control headers
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.151.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <span class="koboSpan" id="kobo.152.1">
        The middleware
       </span>
       <a id="_idIndexMarker557">
       </a>
       <span class="koboSpan" id="kobo.153.1">
        checks whether the incoming request can be cached based on the presence of
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.154.1">
         Cache-Control headers
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.155.1">
        If a valid Cache-Control header is found and it allows caching, the middleware proceeds to handle
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.156.1">
         the request
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.157.1">
       Stores responses in
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.158.1">
        the cache
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.159.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <span class="koboSpan" id="kobo.160.1">
        If the response to the request can be cached, the middleware stores the response in
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.161.1">
         the cache
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.162.1">
        Subsequent requests that match the cache criteria will be served directly from the cache, bypassing the need to generate the
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.163.1">
         response again
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.164.1">
       Serves
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.165.1">
        cached responses
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.166.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <span class="koboSpan" id="kobo.167.1">
        For requests that match previously cached responses, the middleware serves the
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.168.1">
         cached response
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.169.1">
        This reduces the processing time and load on the server, as the response is retrieved directly from
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.170.1">
         the cache
        </span>
       </span>
      </li>
     </ul>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.171.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.172.1">
      app.Use(async (context, next)
     </span>
    </strong>
    <span class="koboSpan" id="kobo.173.1">
     method adds the necessary parameters for the Cache-Control header
    </span>
    <a id="_idIndexMarker558">
    </a>
    <span class="koboSpan" id="kobo.174.1">
     to the middleware pipeline, such as the cache duration time.
    </span>
    <span class="koboSpan" id="kobo.174.2">
     This is necessary so that the client can know how the response should
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.175.1">
      be cached.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.176.1">
     The cache is
    </span>
    <a id="_idIndexMarker559">
    </a>
    <span class="koboSpan" id="kobo.177.1">
     managed in the application’s memory and, therefore, it is not
    </span>
    <a id="_idIndexMarker560">
    </a>
    <span class="koboSpan" id="kobo.178.1">
     interesting to keep the cache for a large
    </span>
    <a id="_idIndexMarker561">
    </a>
    <span class="koboSpan" id="kobo.179.1">
     amount of time in memory, which could cause problems.
    </span>
    <span class="koboSpan" id="kobo.179.2">
     However, it is good practice to use it.
    </span>
    <span class="koboSpan" id="kobo.179.3">
     We will go into more detail about cache usage in the next section,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.180.1">
      Improving performance with a cache strategy and making the
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.181.1">
       application resilient
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.182.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.183.1">
     To further improve response performance, we can perform compression automatically with a few lines
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.184.1">
      of code.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.185.1">
     For this purpose, we must add the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.186.1">
      Microsoft.AspNetCore.ResponseCompression
     </span>
    </strong>
    <span class="koboSpan" id="kobo.187.1">
     NuGet package to the project.
    </span>
    <span class="koboSpan" id="kobo.187.2">
     You can do this by typing the following command in your application’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.188.1">
      project directory:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.189.1">
dotnet add package Microsoft.AspNetCore.ResponseCompression</span></pre>
   <p>
    <span class="koboSpan" id="kobo.190.1">
     In any case, it is important that you understand how to use this functionality in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.191.1">
      your applications.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.192.1">
     After adding the
    </span>
    <a id="_idIndexMarker562">
    </a>
    <span class="koboSpan" id="kobo.193.1">
     NuGet package, we must add the compression
    </span>
    <a id="_idIndexMarker563">
    </a>
    <span class="koboSpan" id="kobo.194.1">
     services to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.195.1">
      Program.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.196.1">
     file.
    </span>
    <span class="koboSpan" id="kobo.196.2">
     When doing so, we have the following modified file taking into account caching
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.197.1">
      and compression:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.198.1">
var builder = WebApplication.CreateBuilder(args);
// Add services to the container.
</span><strong class="bold"><span class="koboSpan" id="kobo.199.1">builder.Services.AddResponseCompression(options =&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.200.1">{</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.201.1">    options.EnableForHttps = true;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.202.1">    // Enable compression for HTTPS requests</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.203.1">    options.Providers.Add&lt;GzipCompressionProvider&gt;();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.204.1">    // Add Gzip compression</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.205.1">    options.Providers.Add&lt;BrotliCompressionProvider&gt;();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.206.1">    // Add Brotli compression</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.207.1">});</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.208.1">builder.Services.Configure&lt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.209.1">  GzipCompressionProviderOptions&gt;(options =&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.210.1">{</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.211.1">    options.Level = System.IO.Compression</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.212.1">      .CompressionLevel.Fastest;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.213.1">    // Set compression level for Gzip</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.214.1">});</span></strong><span class="koboSpan" id="kobo.215.1">
builder.Services.AddResponseCaching();
var app = builder.Build();
// Configure the HTTP request pipeline.
</span><span class="koboSpan" id="kobo.215.2">if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Home/Error");
    app.UseHsts();
}
app.UseHttpsRedirection();
app.UseStaticFiles();
app.UseRouting();
</span><strong class="bold"><span class="koboSpan" id="kobo.216.1">app.UseResponseCompression(); </span></strong><span class="koboSpan" id="kobo.217.1">// Use response compression middleware
app.UseResponseCaching(); // Use response caching middleware
app.Use(async (context, next) =&gt;
{
  context.Response.GetTypedHeaders().CacheControl =
    new Microsoft.Net.Http.Headers.CacheControlHeaderValue
  {
    Public = true,
    MaxAge = TimeSpan.FromMinutes(10)
  };
  await next();
});
app.UseAuthorization();
app.MapRazorPages();
app.MapControllers();
app.Run();</span></pre>
   <p>
    <span class="koboSpan" id="kobo.218.1">
     The
    </span>
    <a id="_idIndexMarker564">
    </a>
    <span class="koboSpan" id="kobo.219.1">
     preceding code
    </span>
    <a id="_idIndexMarker565">
    </a>
    <span class="koboSpan" id="kobo.220.1">
     can be explained
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.221.1">
      as
     </span>
    </span>
    <span class="No-Break">
     <a id="_idIndexMarker566">
     </a>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.222.1">
      follows:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.223.1">
       Add response
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.224.1">
        compression middleware
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.225.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <span class="koboSpan" id="kobo.226.1">
        The
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.227.1">
         builder.Services.AddResponseCompression
        </span>
       </strong>
       <span class="koboSpan" id="kobo.228.1">
        method is used to add response
       </span>
       <a id="_idIndexMarker567">
       </a>
       <span class="koboSpan" id="kobo.229.1">
        compression services to the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.230.1">
         Dependency Injection
        </span>
       </strong>
       <span class="koboSpan" id="kobo.231.1">
        (
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.232.1">
          DI
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.233.1">
         ) container.
        </span>
       </span>
      </li>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.234.1">
         options.EnableForHttps
        </span>
       </strong>
       <span class="koboSpan" id="kobo.235.1">
        is set to
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.236.1">
         true
        </span>
       </strong>
       <span class="koboSpan" id="kobo.237.1">
        to enable compression for
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.238.1">
         HTTPS responses.
        </span>
       </span>
      </li>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.239.1">
         options.Providers.Add&lt;GzipCompressionProvider&gt;()
        </span>
       </strong>
       <span class="koboSpan" id="kobo.240.1">
        and
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.241.1">
         options.Providers.Add&lt;BrotliCompressionProvider&gt;()
        </span>
       </strong>
       <span class="koboSpan" id="kobo.242.1">
        are used to add support
       </span>
       <a id="_idIndexMarker568">
       </a>
       <span class="koboSpan" id="kobo.243.1">
        for
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.244.1">
         Gzip
        </span>
       </strong>
       <span class="koboSpan" id="kobo.245.1">
        and
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.246.1">
         Brotli
        </span>
       </strong>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.247.1">
         compression
        </span>
       </span>
       <span class="No-Break">
        <a id="_idIndexMarker569">
        </a>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.248.1">
         providers.
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.249.1">
       Configure
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.250.1">
        compression options
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.251.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.252.1">
          builder.Services.Configure&lt;GzipCompressionProvider
         </span>
        </strong>
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.253.1">
         Options&gt;(options =&gt; options.Level = System.IO.Compression.CompressionLevel.Fastest)
        </span>
       </strong>
       <span class="koboSpan" id="kobo.254.1">
        is used to configure the compression level for Gzip.
       </span>
       <span class="koboSpan" id="kobo.254.2">
        You can adjust the compression level based on your needs (
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.255.1">
         Optimal
        </span>
       </strong>
       <span class="koboSpan" id="kobo.256.1">
        ,
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.257.1">
         Fastest
        </span>
       </strong>
       <span class="koboSpan" id="kobo.258.1">
        ,
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.259.1">
         or
        </span>
       </span>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.260.1">
          NoCompression
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.261.1">
         ).
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.262.1">
        Use middleware
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.263.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.264.1">
         app.UseResponseCompression()
        </span>
       </strong>
       <span class="koboSpan" id="kobo.265.1">
        adds the response compression middleware
       </span>
       <a id="_idIndexMarker570">
       </a>
       <span class="koboSpan" id="kobo.266.1">
        to the
       </span>
       <a id="_idIndexMarker571">
       </a>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.267.1">
         request pipeline.
        </span>
       </span>
      </li>
     </ul>
    </li>
   </ul>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.268.1">
     The order of middleware is important
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.269.1">
     When combining response caching and compression, the order of the middleware is important.
    </span>
    <span class="koboSpan" id="kobo.269.2">
     Make sure compression middleware is included before caching middleware.
    </span>
    <span class="koboSpan" id="kobo.269.3">
     This way, responses are compressed before being cached, ensuring that cached responses are already compressed and ready to be
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.270.1">
      served efficiently.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.271.1">
     With these practices, you can reduce the size of responses, leading to better performance and faster loading times
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.272.1">
      for users.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.273.1">
     The time has come to understand asynchronous requests in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.274.1">
      more detail.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-121">
    <a id="_idTextAnchor122">
    </a>
    <span class="koboSpan" id="kobo.275.1">
     Asynchronous requests and I/O optimization
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.276.1">
     Asynchronous programming
    </span>
    <a id="_idIndexMarker572">
    </a>
    <span class="koboSpan" id="kobo.277.1">
     is a fundamental aspect of modern web development, enabling non-blocking operations that improve application responsiveness
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.278.1">
      and scalability.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.279.1">
     The great complexity of asynchronous programming is abstracted by the resources available in C#, making applications and functionalities even more powerful.
    </span>
    <span class="koboSpan" id="kobo.279.2">
     But to better understand the importance of this asynchronous process, let’s analyze the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.280.1">
      following example.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.281.1">
     Imagine you are waiting in line at a coffee shop.
    </span>
    <span class="koboSpan" id="kobo.281.2">
     If the barista had to wait for each cup of coffee to finish brewing before starting the next one, the line would move very slowly.
    </span>
    <span class="koboSpan" id="kobo.281.3">
     Instead, the barista starts preparing the next drink while the previous one is being prepared.
    </span>
    <span class="koboSpan" id="kobo.281.4">
     Similarly, asynchronous programming allows your application to start other tasks while waiting for a previous task
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.282.1">
      to complete.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.283.1">
     Web applications can respond to a large number of requests from users at a given time.
    </span>
    <span class="koboSpan" id="kobo.283.2">
     ASP.NET Core 9 is optimized enough to manage requests and memory efficiently.
    </span>
    <span class="koboSpan" id="kobo.283.3">
     However, if you choose to use a synchronous approach, which is also possible, some problems may be caused.
    </span>
    <span class="koboSpan" id="kobo.283.4">
     Let’s see how we can develop
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.284.1">
      asynchronous methods.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.285.1">
     Use async and await keywords
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.286.1">
     In C#, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.287.1">
      async
     </span>
    </strong>
    <span class="koboSpan" id="kobo.288.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.289.1">
      await
     </span>
    </strong>
    <span class="koboSpan" id="kobo.290.1">
     keywords let you
    </span>
    <a id="_idIndexMarker573">
    </a>
    <span class="koboSpan" id="kobo.291.1">
     write asynchronous code that is
    </span>
    <a id="_idIndexMarker574">
    </a>
    <span class="koboSpan" id="kobo.292.1">
     easier to read
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.293.1">
      and maintain.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.294.1">
     For example, in the context of an ASP.NET Core application, using
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.295.1">
      async
     </span>
    </strong>
    <span class="koboSpan" id="kobo.296.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.297.1">
      await
     </span>
    </strong>
    <span class="koboSpan" id="kobo.298.1">
     allows your server to handle more requests simultaneously by not blocking threads during I/O operations, as demonstrated in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.299.1">
      following code:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.300.1">
public </span><strong class="bold"><span class="koboSpan" id="kobo.301.1">async Task&lt;IActionResult&gt;</span></strong><span class="koboSpan" id="kobo.302.1"> GetDataAsync()
{
    var data = </span><strong class="bold"><span class="koboSpan" id="kobo.303.1">await</span></strong><span class="koboSpan" id="kobo.304.1"> _dataService.</span><strong class="bold"><span class="koboSpan" id="kobo.305.1">GetDataAsync()</span></strong><span class="koboSpan" id="kobo.306.1">;
    return Ok(data);
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.307.1">
     Let’s look at the details highlighted in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.308.1">
      the code:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.309.1">
       async
      </span>
     </strong>
     <span class="koboSpan" id="kobo.310.1">
      : This is the keyword used to indicate that the method is asynchronous.
     </span>
     <span class="koboSpan" id="kobo.310.2">
      When declaring an asynchronous method, it is mandatory to use at least one
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.311.1">
       await
      </span>
     </strong>
     <span class="koboSpan" id="kobo.312.1">
      keyword to perform asynchronous operations in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.313.1">
       method body.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.314.1">
       Task&lt;IActionResult&gt;
      </span>
     </strong>
     <span class="koboSpan" id="kobo.315.1">
      : This specifies that the method returns a task that will eventually be completed with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.316.1">
       IActionResult
      </span>
     </strong>
     <span class="koboSpan" id="kobo.317.1">
      .
     </span>
     <span class="koboSpan" id="kobo.317.2">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.318.1">
       Task
      </span>
     </strong>
     <span class="koboSpan" id="kobo.319.1">
      type represents an asynchronous operation in C#.
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.320.1">
       IActionResult
      </span>
     </strong>
     <span class="koboSpan" id="kobo.321.1">
      is a common return type in ASP.NET Core MVC that represents the result of an action method.
     </span>
     <span class="koboSpan" id="kobo.321.2">
      The return type could be any type of class or structure, for example, returning an integer such
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.322.1">
       as
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.323.1">
        Task&lt;int&gt;
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.324.1">
       .
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.325.1">
       await
      </span>
     </strong>
     <span class="koboSpan" id="kobo.326.1">
      : The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.327.1">
       await
      </span>
     </strong>
     <span class="koboSpan" id="kobo.328.1">
      keyword is used to asynchronously wait for the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.329.1">
       GetDataAsync
      </span>
     </strong>
     <span class="koboSpan" id="kobo.330.1">
      method to complete.
     </span>
     <span class="koboSpan" id="kobo.330.2">
      This means that the method will return a task and execution will be paused until the task is completed, without blocking
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.331.1">
       the thread.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.332.1">
       _dataService.GetDataAsync()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.333.1">
      : This line calls an asynchronous
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.334.1">
       GetDataAsync
      </span>
     </strong>
     <span class="koboSpan" id="kobo.335.1">
      method on the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.336.1">
       _dataService
      </span>
     </strong>
     <span class="koboSpan" id="kobo.337.1">
      object.
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.338.1">
       _dataService
      </span>
     </strong>
     <span class="koboSpan" id="kobo.339.1">
      is presumably an instance of a service class that handles
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.340.1">
       data retrieval.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.341.1">
     C# has several asynchronous methods and you can identify them by using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.342.1">
      async
     </span>
    </strong>
    <span class="koboSpan" id="kobo.343.1">
     suffix, added to the name of the methods as
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.344.1">
      a convention.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.345.1">
     Asynchronous programming
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.346.1">
     Asynchronous programming in C# has several other details and ways of application, and it is not possible to consider them as part of this book.
    </span>
    <span class="koboSpan" id="kobo.346.2">
     However, to continue your learning, I suggest
    </span>
    <a id="_idIndexMarker575">
    </a>
    <span class="koboSpan" id="kobo.347.1">
     this great content from Microsoft
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.348.1">
      Learn:
     </span>
    </span>
    <a href="https://learn.microsoft.com/en-us/dotnet/csharp/asynchronous-programming/">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.349.1">
       https://learn.microsoft.com/en-us/dotnet/csharp/asynchronous-programming/
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.350.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.351.1">
     With some simple changes, using the features available in ASP.NET Core 9, we have the ability to implement asynchronous requests with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.352.1">
      some keywords.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.353.1">
     These resources can be used in conjunction, for example, with Entity
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.354.1">
      Framework Core.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.355.1">
     We can implement asynchronous data access using Entity Framework Core with methods such as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.356.1">
      ToListAsync()
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.357.1">
      and
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.358.1">
       SaveChangesAsync()
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.359.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.360.1">
     The asynchronous data access lets your application perform other operations while waiting for data from the database, as exemplified in the following code, where an asynchronous query is made to obtain all records from the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.361.1">
      Customers
     </span>
    </strong>
    <span class="koboSpan" id="kobo.362.1">
     table through
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.363.1">
      Entity Framework:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.364.1">
public async Task&lt;List&lt;Customer&gt;&gt; GetCustomersAsync()
{
    return await _dbContext.Customers.ToListAsync();
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.365.1">
     Consider the use of asynchronous programming in the design of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.366.1">
      your applications.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.367.1">
     Although the ASP.NET Core 9 platform provides us with several mechanisms to create robust applications, it is important to keep in mind that the use of best practices for HTTP requests, compression, and information caching, in addition to the asynchronous programming model, must be taken into consideration in all applications developed.
    </span>
    <span class="koboSpan" id="kobo.367.2">
     This guarantees the best experience for users and integrated systems, in addition to ensuring that applications can be optimized enough to support large
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.368.1">
      demands correctly.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.369.1">
     In the next section, we will see in more detail the use of caching strategies and how to make
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.370.1">
      applications resilient.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-122">
    <a id="_idTextAnchor123">
    </a>
    <span class="koboSpan" id="kobo.371.1">
     Improving performance with a cache strategy and making the application resilient
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.372.1">
     In the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.373.1">
      HTTP request best practices
     </span>
    </em>
    <span class="koboSpan" id="kobo.374.1">
     subsection of the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.375.1">
      Working with ASP.NET Core 9 best practices
     </span>
    </em>
    <span class="koboSpan" id="kobo.376.1">
     section, we learned about some mechanisms capable of bringing several improvements to our applications.
    </span>
    <span class="koboSpan" id="kobo.376.2">
     Some approaches were discussed, including a brief introduction to the use
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.377.1">
      of caching.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.378.1">
     To expand our knowledge and add techniques to our robust application development model, we will explore the use of caching strategies and how to make our applications resilient, a fundamental requirement for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.379.1">
      modern solutions.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.380.1">
     Let’s start with first understanding the different types of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.381.1">
      caching strategies.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-123">
    <a id="_idTextAnchor124">
    </a>
    <span class="koboSpan" id="kobo.382.1">
     Caching strategies
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.383.1">
     Caching
    </span>
    <a id="_idIndexMarker576">
    </a>
    <span class="koboSpan" id="kobo.384.1">
     is a powerful technique to improve application performance by storing frequently accessed data in a temporary storage location.
    </span>
    <span class="koboSpan" id="kobo.384.2">
     This reduces the need to retrieve data from the original
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.385.1">
      source repeatedly.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.386.1">
     In the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.387.1">
      Caching and compression
     </span>
    </em>
    <span class="koboSpan" id="kobo.388.1">
     subsection, a code was demonstrated that enabled the application to manage a cache, adding functionality to ASP.NET Core 9 middleware, used during request processing.
    </span>
    <span class="koboSpan" id="kobo.388.2">
     For this case, the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.389.1">
      in-memory
     </span>
    </strong>
    <span class="koboSpan" id="kobo.390.1">
     cache strategy
    </span>
    <a id="_idIndexMarker577">
    </a>
    <span class="koboSpan" id="kobo.391.1">
     was used, which stores data in memory for quick access.
    </span>
    <span class="koboSpan" id="kobo.391.2">
     This is suitable for small to medium-sized datasets that are
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.392.1">
      frequently accessed.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.393.1">
     However, for more robust applications, another strategy called
    </span>
    <a id="_idIndexMarker578">
    </a>
    <span class="koboSpan" id="kobo.394.1">
     the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.395.1">
      distributed cache
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.396.1">
      is necessary.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.397.1">
     A distributed cache
    </span>
    <a id="_idIndexMarker579">
    </a>
    <span class="koboSpan" id="kobo.398.1">
     uses some type of resource specialized in distributed caching, such
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.399.1">
      as Redis.
     </span>
    </span>
   </p>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.400.1">
      Redis
     </span>
    </strong>
    <span class="koboSpan" id="kobo.401.1">
     is a powerful technology for large datasets or when running in a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.402.1">
      distributed environment.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.403.1">
     What is Redis?
    </span>
   </p>
   <p class="callout">
    <strong class="bold">
     <span class="koboSpan" id="kobo.404.1">
      Remote DIctionary Server
     </span>
    </strong>
    <span class="koboSpan" id="kobo.405.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.406.1">
      Redis
     </span>
    </strong>
    <span class="koboSpan" id="kobo.407.1">
     ) is an
    </span>
    <a id="_idIndexMarker580">
    </a>
    <span class="koboSpan" id="kobo.408.1">
     open source, in-memory data structure store.
    </span>
    <span class="koboSpan" id="kobo.408.2">
     It is known for its high performance, flexibility, and support for diverse
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.409.1">
      data structures.
     </span>
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.410.1">
     Redis stores data in memory, which makes it extremely fast compared to disk-based databases, and also supports data persistence on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.411.1">
      disk periodically.
     </span>
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.412.1">
     Redis’ persistence model is key/value, supporting data structures such as strings, hashes, lists, sets, sorted sets, bitmaps, HyperLogLogs, and geospatial indexes.
    </span>
    <span class="koboSpan" id="kobo.412.2">
     This flexibility allows for diverse
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.413.1">
      use cases.
     </span>
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.414.1">
     Redis is a resource widely used
    </span>
    <a id="_idIndexMarker581">
    </a>
    <span class="koboSpan" id="kobo.415.1">
     by several applications; if you want to know more, go to this
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.416.1">
      link:
     </span>
    </span>
    <a href="https://redis.io/">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.417.1">
       https://redis.io/
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.418.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.419.1">
     Several modern applications, hosted mainly in cloud environments, use Redis as a solution for distributed caching, in addition to being fully integrated with ASP.NET
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.420.1">
      Core 9.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.421.1">
     So that we can better understand how Redis works when integrated with ASP.NET Core 9, let’s implement
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.422.1">
      an application.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.423.1">
     It is important to take into account the requirements mentioned in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.424.1">
      Technical requirements
     </span>
    </em>
    <span class="koboSpan" id="kobo.425.1">
     section.
    </span>
    <span class="koboSpan" id="kobo.425.2">
     Let’s learn how to integrate Redis into
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.426.1">
      our application.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-124">
    <a id="_idTextAnchor125">
    </a>
    <span class="koboSpan" id="kobo.427.1">
     Integrating Redis in our application
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.428.1">
     We will start by creating
    </span>
    <a id="_idIndexMarker582">
    </a>
    <span class="koboSpan" id="kobo.429.1">
     an application.
    </span>
    <span class="koboSpan" id="kobo.429.2">
     Therefore, open the terminal in a directory of your choice and perform the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.430.1">
      following steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.431.1">
      Create a new ASP.NET Core 9 project by running the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.432.1">
       following commands:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.433.1">dotnet new webapi -n DistributedCacheExample</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.434.1">cd DistributedCacheExample</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.435.1">
      Add the Redis
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.436.1">
       cache package:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.437.1">dotnet add package Microsoft.Extensions.Caching.StackExchangeRedis</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.438.1">
      Now, run the following command to open Visual Studio Code in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.439.1">
       application directory:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.440.1">Code .</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.441.1">
      Open the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.442.1">
       appsettings.json
      </span>
     </strong>
     <span class="koboSpan" id="kobo.443.1">
      file and
     </span>
     <a id="_idIndexMarker583">
     </a>
     <span class="koboSpan" id="kobo.444.1">
      change the content to the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.445.1">
       following code:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.446.1">
{
  "ConnectionStrings": {
    "Redis": "localhost:6379"
  }
}</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.447.1">
       The preceding JSON defines a connection string for the Redis server that we will
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.448.1">
        create later.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.449.1">
      Open the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.450.1">
       Program.cs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.451.1">
      file and change all its contents with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.452.1">
       following code:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.453.1">
using Microsoft.Extensions.Caching.Distributed;
var builder = WebApplication.CreateBuilder(args);
// Add services to the container.
</span><span class="koboSpan" id="kobo.453.2">builder.Services.AddControllers();
builder.Services.AddEndpointsApiExplorer();
builder.Services.AddSwaggerGen();
// Configure Redis distributed cache
</span><strong class="bold"><span class="koboSpan" id="kobo.454.1">builder.Services.AddStackExchangeRedisCache(options =&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.455.1">{</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.456.1">  options.Configuration = builder</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.457.1">    .Configuration.GetConnectionString("Redis");</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.458.1">  options.InstanceName = "myPrefix_";</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.459.1">});</span></strong><span class="koboSpan" id="kobo.460.1">
var app = builder.Build();
// Configure the HTTP request pipeline.
</span><span class="koboSpan" id="kobo.460.2">if (app.Environment.IsDevelopment())
{
    app.UseSwagger();
    app.UseSwaggerUI();
}
app.UseAuthorization();
app.MapControllers();
app.Run();</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.461.1">
       You should already
      </span>
      <a id="_idIndexMarker584">
      </a>
      <span class="koboSpan" id="kobo.462.1">
       be used to most of the code described previously.
      </span>
      <span class="koboSpan" id="kobo.462.2">
       The
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.463.1">
        builder.Services.AddStackExchangeRedisCache
       </span>
      </strong>
      <span class="koboSpan" id="kobo.464.1">
       method adds the default required objects, as part of the added library
      </span>
      <strong class="bold">
       <span class="koboSpan" id="kobo.465.1">
        Microsoft.Extensions.Caching.StackExchangeRedis
       </span>
      </strong>
      <span class="koboSpan" id="kobo.466.1">
       , to manage the cache when configuring the
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.467.1">
        DI container.
       </span>
      </span>
     </p>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.468.1">
     We have two
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.469.1">
      main configurations:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.470.1">
       options.Configuration
      </span>
     </strong>
     <span class="koboSpan" id="kobo.471.1">
      : This is where the connection address to the Redis server
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.472.1">
       is provided
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.473.1">
       options.InstanceName
      </span>
     </strong>
     <span class="koboSpan" id="kobo.474.1">
      : This is an optional parameter that defines a prefix for the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.475.1">
       cache keys
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.476.1">
     The foundation of
    </span>
    <a id="_idIndexMarker585">
    </a>
    <span class="koboSpan" id="kobo.477.1">
     the application has been configured, and now it’s time to implement a controller that will interact
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.478.1">
      with Redis.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-125">
    <a id="_idTextAnchor126">
    </a>
    <span class="koboSpan" id="kobo.479.1">
     Working with cache in the controller class
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.480.1">
     To do this, still in Visual Studio Code, follow the following steps
    </span>
    <a id="_idIndexMarker586">
    </a>
    <span class="koboSpan" id="kobo.481.1">
     to create
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.482.1">
      the controller:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.483.1">
      If it does not exist, in the root of the project, create a folder
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.484.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.485.1">
        Controllers
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.486.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.487.1">
      Add a class called
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.488.1">
       CacheController
      </span>
     </strong>
     <span class="koboSpan" id="kobo.489.1">
      in the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.490.1">
        Controller
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.491.1">
       folder
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.492.1">
      Modify all content of the previously created class with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.493.1">
       following code:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.494.1">
using Microsoft.AspNetCore.Mvc;
using </span><strong class="bold"><span class="koboSpan" id="kobo.495.1">Microsoft.Extensions.Caching.Distributed;</span></strong><span class="koboSpan" id="kobo.496.1">
using System.Text.Json;
using System.Text;
namespace DistributedCacheExample.Controllers;
    [ApiController]
    [Route("api/[controller]")]
    public class CacheController : ControllerBase
    {
       </span><strong class="bold"><span class="koboSpan" id="kobo.497.1"> private readonly IDistributedCache _cache;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.498.1">        public CacheController(IDistributedCache</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.499.1">          cache)</span></strong><span class="koboSpan" id="kobo.500.1">
        {
            _cache = cache;
        }
        [HttpGet("{key}")]
        public async Task&lt;IActionResult&gt;
          Get(string key)
        {
            </span><strong class="bold"><span class="koboSpan" id="kobo.501.1">var cachedData = await _cache</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.502.1">              .GetStringAsync(key);</span></strong><span class="koboSpan" id="kobo.503.1">
            if (string.IsNullOrEmpty(cachedData))
            {
                return NotFound();
            }
            var data = JsonSerializer
              .Deserialize&lt;MyData&gt;(cachedData);
            return Ok(data);
        }
        [HttpPost]
        public async Task&lt;IActionResult&gt;
          Post([FromBody] MyData data)
        {
            var cacheKey = data.Key;
            var serializedData = JsonSerializer
              .Serialize(data);
            </span><strong class="bold"><span class="koboSpan" id="kobo.504.1">var options = new</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.505.1">              DistributedCacheEntryOptions()</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.506.1">              .SetSlidingExpiration(TimeSpan</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.507.1">              .FromMinutes(5))</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.508.1">              .SetAbsoluteExpiration(TimeSpan</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.509.1">              .FromHours(1));</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.510.1">            await _cache.SetStringAsync(cacheKey,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.511.1">              serializedData, options);</span></strong><span class="koboSpan" id="kobo.512.1">
            return CreatedAtAction(nameof(Get),
             new { key = cacheKey }, data);
        }
    }
    </span><strong class="bold"><span class="koboSpan" id="kobo.513.1">public class MyData</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.514.1">    {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.515.1">        public string Key { get; set; }</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.516.1">        public string Value { get; set; }</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.517.1">    }</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.518.1">
       The preceding
      </span>
      <a id="_idIndexMarker587">
      </a>
      <span class="koboSpan" id="kobo.519.1">
       code creates an API called
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.520.1">
        Cache
       </span>
      </strong>
      <span class="koboSpan" id="kobo.521.1">
       containing
      </span>
      <strong class="bold">
       <span class="koboSpan" id="kobo.522.1">
        GET
       </span>
      </strong>
      <span class="koboSpan" id="kobo.523.1">
       and
      </span>
      <strong class="bold">
       <span class="koboSpan" id="kobo.524.1">
        POST
       </span>
      </strong>
      <span class="koboSpan" id="kobo.525.1">
       methods.
      </span>
      <span class="koboSpan" id="kobo.525.2">
       Let’s
      </span>
      <a id="_idIndexMarker588">
      </a>
      <span class="koboSpan" id="kobo.526.1">
       analyze the important points of the code
      </span>
      <a id="_idIndexMarker589">
      </a>
      <span class="koboSpan" id="kobo.527.1">
       in
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.528.1">
        more detail:
       </span>
      </span>
     </p>
     <ul>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.529.1">
         Microsoft.Extensions.Caching.Distributed
        </span>
       </strong>
       <span class="koboSpan" id="kobo.530.1">
        : This is a namespace that references the NuGet package containing the dependencies necessary for handling the cache in the
       </span>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.531.1">
          CacheController
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.532.1">
         class.
        </span>
       </span>
      </li>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.533.1">
         private readonly IDistributedCache _cache
        </span>
       </strong>
       <span class="koboSpan" id="kobo.534.1">
        : This is a private property of the class that abstracts a cache
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.535.1">
         handling object.
        </span>
       </span>
      </li>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.536.1">
         public CacheController(IDistributedCache cache)
        </span>
       </strong>
       <span class="koboSpan" id="kobo.537.1">
        : As a dependency, the class constructor has the
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.538.1">
         IDistributedCache
        </span>
       </strong>
       <span class="koboSpan" id="kobo.539.1">
        interface that will be injected by DI and assigns the instance to the class’s
       </span>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.540.1">
          _cache
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.541.1">
         property.
        </span>
       </span>
      </li>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.542.1">
         var cachedData = await _cache.GetStringAsync(key)
        </span>
       </strong>
       <span class="koboSpan" id="kobo.543.1">
        : During the execution of the
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.544.1">
         Get
        </span>
       </strong>
       <span class="koboSpan" id="kobo.545.1">
        method, the _
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.546.1">
         cache
        </span>
       </strong>
       <span class="koboSpan" id="kobo.547.1">
        object, which abstracts a connection to the Redis server, will search for a string using the key and return it in the request; otherwise, it will return a
       </span>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.548.1">
          NotFound()
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.549.1">
         status.
        </span>
       </span>
      </li>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.550.1">
         Post
        </span>
       </strong>
       <span class="koboSpan" id="kobo.551.1">
        method: The
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.552.1">
         Post
        </span>
       </strong>
       <span class="koboSpan" id="kobo.553.1">
        method receives as a parameter an object of the
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.554.1">
         MyData
        </span>
       </strong>
       <span class="koboSpan" id="kobo.555.1">
        type, a class created at the end of the file.
       </span>
       <span class="koboSpan" id="kobo.555.2">
        When obtaining the
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.556.1">
         MyData
        </span>
       </strong>
       <span class="koboSpan" id="kobo.557.1">
        object, the
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.558.1">
         Key
        </span>
       </strong>
       <span class="koboSpan" id="kobo.559.1">
        property will be used as the cache key,
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.560.1">
         var cacheKey = data.Key
        </span>
       </strong>
       <span class="koboSpan" id="kobo.561.1">
        .
       </span>
       <span class="koboSpan" id="kobo.561.2">
        Then, the
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.562.1">
         MyData
        </span>
       </strong>
       <span class="koboSpan" id="kobo.563.1">
        object is serialized into JSON,
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.564.1">
         JsonSerializer.Serialize(data)
        </span>
       </strong>
       <span class="koboSpan" id="kobo.565.1">
        .
       </span>
       <span class="koboSpan" id="kobo.565.2">
        Subsequently, an object of the
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.566.1">
         DistributedCacheEntryOptions
        </span>
       </strong>
       <span class="koboSpan" id="kobo.567.1">
        type is created, where expiration parameters for information in the cache are specified.
       </span>
       <span class="koboSpan" id="kobo.567.2">
        Finally, the cache persisted in Redis by running
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.568.1">
         await_cache.SetStringAsync(cacheKey,
        </span>
       </strong>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.569.1">
          serializedData, options)
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.570.1">
         .
        </span>
       </span>
      </li>
     </ul>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.571.1">
     SetSlidingExpiration and SetAbsoluteExpiration
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.572.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.573.1">
      .SetSlidingExpiration(TimeSpan.FromMinutes(5))
     </span>
    </strong>
    <span class="koboSpan" id="kobo.574.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.575.1">
      .SetAbsoluteExpiration(TimeSpan.FromHours(1))
     </span>
    </strong>
    <span class="koboSpan" id="kobo.576.1">
     methods are used to configure cache entry expiration options in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.577.1">
      DistributedCacheEntryOptions
     </span>
    </strong>
    <span class="koboSpan" id="kobo.578.1">
     .
    </span>
    <span class="koboSpan" id="kobo.578.2">
     These methods help manage how long the cached data should be kept in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.579.1">
      the cache.
     </span>
    </span>
   </p>
   <p class="callout">
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.580.1">
      SlidingExpiration
     </span>
    </strong>
    <span class="koboSpan" id="kobo.581.1">
     specifies the amount of time a cache entry can be inactive (not accessed) before it is removed from the cache.
    </span>
    <span class="koboSpan" id="kobo.581.2">
     The expiration time is reset every time the cache entry
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.582.1">
      is accessed.
     </span>
    </span>
   </p>
   <p class="callout">
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.583.1">
      AbsoluteExpiration
     </span>
    </strong>
    <span class="koboSpan" id="kobo.584.1">
     specifies the maximum time a cache entry should be kept in the cache, regardless of how often it is accessed.
    </span>
    <span class="koboSpan" id="kobo.584.2">
     The cache entry will be removed from the cache after the specified time has elapsed, no matter how many times it has
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.585.1">
      been accessed.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.586.1">
     With the application
    </span>
    <a id="_idIndexMarker590">
    </a>
    <span class="koboSpan" id="kobo.587.1">
     developed, we must create a Redis server, and for this, we will use Docker to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.588.1">
      run it:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.589.1">
      In the application directory, open the terminal and run the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.590.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.591.1">docker run --name redis -d -p 6379:6379 redis</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.592.1">
       If this is your first time running Redis on your machine, wait for it to download and then the server
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.593.1">
        will start.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.594.1">
      Still in the application terminal, use the following command to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.595.1">
       run it:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.596.1">dotnet run</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.597.1">
      After running the application, open Postman and create a new request by accessing the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.598.1">
       File
      </span>
     </strong>
     <span class="koboSpan" id="kobo.599.1">
      |
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.600.1">
       New
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.601.1">
        Tab
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.602.1">
       menu.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.603.1">
      Then, define the request type as
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.604.1">
       GET
      </span>
     </strong>
     <span class="koboSpan" id="kobo.605.1">
      , and in the URL field, enter the URL made available in the terminal after executing the application with the suffix
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.606.1">
       /api/Cache/DataInCache
      </span>
     </strong>
     <span class="koboSpan" id="kobo.607.1">
      .
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.608.1">
        Figure 7
       </span>
      </em>
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.609.1">
       .1
      </span>
     </em>
     <span class="koboSpan" id="kobo.610.1">
      demonstrates an example of the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.611.1">
       request configuration:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer085">
     <span class="koboSpan" id="kobo.612.1">
      <img alt="Figure 7.1 – Configuring the API request on Postman" src="image/B21788_07_1.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.613.1">
     Figure 7.1 – Configuring the API request on Postman
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.614.1">
     API URL port
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.615.1">
     The number
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.616.1">
      5277
     </span>
    </strong>
    <span class="koboSpan" id="kobo.617.1">
     added to the URL shown in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.618.1">
       Figure 7
      </span>
     </em>
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.619.1">
      .1
     </span>
    </em>
    <span class="koboSpan" id="kobo.620.1">
     represents the API execution port.
    </span>
    <span class="koboSpan" id="kobo.620.2">
     This value may vary from environment to environment.
    </span>
    <span class="koboSpan" id="kobo.620.3">
     Make sure to enter the execution port available in your terminal after executing the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.621.1">
      docker
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.622.1">
       run
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.623.1">
      command.
     </span>
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.624.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.625.1">
       DataInCache
      </span>
     </strong>
     <span class="koboSpan" id="kobo.626.1">
      value
     </span>
     <a id="_idIndexMarker591">
     </a>
     <span class="koboSpan" id="kobo.627.1">
      represents the key we want to get the cached value from.
     </span>
     <span class="koboSpan" id="kobo.627.2">
      However, when clicking on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.628.1">
       Send
      </span>
     </strong>
     <span class="koboSpan" id="kobo.629.1">
      button in Postman, we have the following return (
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.630.1">
        Figure 7
       </span>
      </em>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.631.1">
        .2
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.632.1">
       ):
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer086">
     <span class="koboSpan" id="kobo.633.1">
      <img alt="Figure 7.2 – Requesting data in cache" src="image/B21788_07_2.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.634.1">
     Figure 7.2 – Requesting data in cache
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.635.1">
     As shown in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.636.1">
       Figure 7
      </span>
     </em>
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.637.1">
      .2
     </span>
    </em>
    <span class="koboSpan" id="kobo.638.1">
     , the HTTP status and JSON return in the response body represent the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.639.1">
      404
     </span>
    </strong>
    <span class="koboSpan" id="kobo.640.1">
     not
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.641.1">
      found state.
     </span>
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.642.1">
     The API return is correct, as the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.643.1">
      GET
     </span>
    </strong>
    <span class="koboSpan" id="kobo.644.1">
     method tries to obtain a value from the cache, and if not found, an HTTP status of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.645.1">
      404
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.646.1">
      is returned.
     </span>
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.647.1">
      Still in Postman, open a new tab (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.648.1">
       File
      </span>
     </strong>
     <span class="koboSpan" id="kobo.649.1">
      |
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.650.1">
       New Tab
      </span>
     </strong>
     <span class="koboSpan" id="kobo.651.1">
      ), set the request type as
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.652.1">
       POST
      </span>
     </strong>
     <span class="koboSpan" id="kobo.653.1">
      , and define the API URL with the following
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.654.1">
       suffix:
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.655.1">
        /api/Cache
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.656.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.657.1">
      Then, click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.658.1">
       Body
      </span>
     </strong>
     <span class="koboSpan" id="kobo.659.1">
      , select
     </span>
     <a id="_idIndexMarker592">
     </a>
     <span class="koboSpan" id="kobo.660.1">
      the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.661.1">
       raw
      </span>
     </strong>
     <span class="koboSpan" id="kobo.662.1">
      option, and add the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.663.1">
       following JSON:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.664.1">
{
  "key": "DataInCache",
  "value": "Value in cache"
}</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.665.1">
       The entire configuration of this request is demonstrated in
      </span>
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.666.1">
         Figure 7
        </span>
       </em>
      </span>
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.667.1">
         .3
        </span>
       </em>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.668.1">
        :
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer087">
     <span class="koboSpan" id="kobo.669.1">
      <img alt="Figure 7.3 – Post request configuration" src="image/B21788_07_3.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.670.1">
     Figure 7.3 – Post request configuration
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.671.1">
     The
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.672.1">
      POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.673.1">
     request, demonstrated in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.674.1">
       Figure 7
      </span>
     </em>
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.675.1">
      .3
     </span>
    </em>
    <span class="koboSpan" id="kobo.676.1">
     , will make a call to the API’s
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.677.1">
      POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.678.1">
     method, which will add the value defined in the request body to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.679.1">
      Redis cache.
     </span>
    </span>
   </p>
   <ol>
    <li value="8">
     <span class="koboSpan" id="kobo.680.1">
      Click the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.681.1">
       Send
      </span>
     </strong>
     <span class="koboSpan" id="kobo.682.1">
      button to make the request and you should receive the HTTP
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.683.1">
       201
      </span>
     </strong>
     <span class="koboSpan" id="kobo.684.1">
      status code in return, indicating that the information was created in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.685.1">
       the cache.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.686.1">
      If you want to confirm the cached value, in Postman, open the previous tab containing the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.687.1">
       GET
      </span>
     </strong>
     <span class="koboSpan" id="kobo.688.1">
      request and you should receive the HTTP
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.689.1">
       200
      </span>
     </strong>
     <span class="koboSpan" id="kobo.690.1">
      status code in return, along with the
     </span>
     <a id="_idIndexMarker593">
     </a>
     <span class="koboSpan" id="kobo.691.1">
      JSON object that represents the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.692.1">
       cached data.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.693.1">
     Another way to check the values available in the Redis cache is to use a UI tool such as Redis Insight, mentioned in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.694.1">
      Technical requirements
     </span>
    </em>
    <span class="koboSpan" id="kobo.695.1">
     section, which we’ll
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.696.1">
      configure now.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-126">
    <a id="_idTextAnchor127">
    </a>
    <span class="koboSpan" id="kobo.697.1">
     Configuring Redis Insight
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.698.1">
     Let’s configure
    </span>
    <a id="_idIndexMarker594">
    </a>
    <span class="koboSpan" id="kobo.699.1">
     Redis Insight to connect to the Redis server running on Docker by following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.700.1">
      these steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.701.1">
      On the application’s main screen, click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.702.1">
       Add connection details manually
      </span>
     </strong>
     <span class="koboSpan" id="kobo.703.1">
      option, as shown in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.704.1">
        Figure 7
       </span>
      </em>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.705.1">
        .4
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.706.1">
       :
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer088">
     <span class="koboSpan" id="kobo.707.1">
      <img alt="Figure 7.4 – Configuring the Redis connection" src="image/B21788_07_4.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.708.1">
     Figure 7.4 – Configuring the Redis connection
    </span>
   </p>
   <ol>
    <li value="2">
     <span class="koboSpan" id="kobo.709.1">
      On the next screen, we must add the connection parameters to the Redis server.
     </span>
     <span class="koboSpan" id="kobo.709.2">
      As this server is running through Docker, the default parameters will be used, already available on
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.710.1">
       the screen:
      </span>
     </span>
     <ul>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.711.1">
         Host
        </span>
       </strong>
       <span class="koboSpan" id="kobo.712.1">
        : This defines the Redis
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.713.1">
         server address.
        </span>
       </span>
      </li>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.714.1">
         Port
        </span>
       </strong>
       <span class="koboSpan" id="kobo.715.1">
        : This defines the server
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.716.1">
         execution port.
        </span>
       </span>
      </li>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.717.1">
         Other parameters
        </span>
       </strong>
       <span class="koboSpan" id="kobo.718.1">
        : Not important at this time.
       </span>
       <span class="koboSpan" id="kobo.718.2">
        However, in productive environments, the host address, port, user, and password may be different
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.719.1">
         and necessary.
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <span class="koboSpan" id="kobo.720.1">
      For our example, just keep the default values and click the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.721.1">
       + Add Redis
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.722.1">
        database
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.723.1">
       button.
      </span>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.724.1">
       Once the connection
      </span>
      <a id="_idIndexMarker595">
      </a>
      <span class="koboSpan" id="kobo.725.1">
       is created, the list of servers connected to Redis Insights will be displayed, as shown in
      </span>
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.726.1">
         Figure 7
        </span>
       </em>
      </span>
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.727.1">
         .5
        </span>
       </em>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.728.1">
        :
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer089">
     <span class="koboSpan" id="kobo.729.1">
      <img alt="Figure 7.5 – Connected Redis cache in the Redis Insight tool" src="image/B21788_07_5.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.730.1">
     Figure 7.5 – Connected Redis cache in the Redis Insight tool
    </span>
   </p>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.731.1">
      Click on the created connection displayed in the list of connections.
     </span>
     <span class="koboSpan" id="kobo.731.2">
      Then, click on the magnifying glass icon, as highlighted in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.732.1">
        Figure 7
       </span>
      </em>
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.733.1">
       .6
      </span>
     </em>
     <span class="koboSpan" id="kobo.734.1">
      , to view the data available in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.735.1">
       the cache:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer090">
     <span class="koboSpan" id="kobo.736.1">
      <img alt="Figure 7.6 – List of data in the cache" src="image/B21788_07_6.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.737.1">
     Figure 7.6 – List of data in the cache
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.738.1">
     If you cannot view any information when clicking the magnifying glass icon, it means that the previously added key has expired.
    </span>
    <span class="koboSpan" id="kobo.738.2">
     In this case, just make another
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.739.1">
      POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.740.1">
     request to add another key and view it in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.741.1">
      Redis Insight.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.742.1">
     This is a simple example created so that we can learn how to communicate with the cache and add information to memory.
    </span>
    <span class="koboSpan" id="kobo.742.2">
     In this case, we are using Redis, a powerful distributed data management resource, as a server for the information that will be kept
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.743.1">
      in memory.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.744.1">
     In real scenarios, this approach can be used in conjunction with a database.
    </span>
    <span class="koboSpan" id="kobo.744.2">
     This way, before executing a request to the database, the existence of information in the cache will be checked.
    </span>
    <span class="koboSpan" id="kobo.744.3">
     If it exists, it will not be necessary to make a call to the database,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.745.1">
      optimizing processes.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.746.1">
     As we learned, caching is a powerful solution for making our applications more performant
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.747.1">
      and available.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.748.1">
     Now that we have learned how to quickly retrieve information from a cache server, we will understand how to make our applications more resilient in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.749.1">
      next topic.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-127">
    <a id="_idTextAnchor128">
    </a>
    <span class="koboSpan" id="kobo.750.1">
     Resilience mechanisms
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.751.1">
     To build robust applications, it is essential to implement resilience mechanisms that deal with transient failures and ensure
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.752.1">
      continuous availability.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.753.1">
     Think of resilience mechanisms
    </span>
    <a id="_idIndexMarker596">
    </a>
    <span class="koboSpan" id="kobo.754.1">
     as safety nets that catch us if something goes wrong.
    </span>
    <span class="koboSpan" id="kobo.754.2">
     They help your application recover from unexpected crashes and maintain a smooth
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.755.1">
      user experience.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.756.1">
     The most common resilience strategies are
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.757.1">
      as follows:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.758.1">
       Retry pattern
      </span>
     </strong>
     <span class="koboSpan" id="kobo.759.1">
      : Automatically retries
     </span>
     <a id="_idIndexMarker597">
     </a>
     <span class="koboSpan" id="kobo.760.1">
      a failed operation a specified number of times before giving up.
     </span>
     <span class="koboSpan" id="kobo.760.2">
      This is useful for dealing with
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.761.1">
       transient faults.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.762.1">
       Circuit breaker pattern
      </span>
     </strong>
     <span class="koboSpan" id="kobo.763.1">
      : Prevents an
     </span>
     <a id="_idIndexMarker598">
     </a>
     <span class="koboSpan" id="kobo.764.1">
      application from performing an operation that is likely to fail.
     </span>
     <span class="koboSpan" id="kobo.764.2">
      It stops the flow of requests to a service when a failure is detected, allowing the system
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.765.1">
       to recover.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.766.1">
     In order to have
    </span>
    <a id="_idIndexMarker599">
    </a>
    <span class="koboSpan" id="kobo.767.1">
     the ability to implement these patterns in our applications, we will use a library
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.768.1">
      called
     </span>
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.769.1">
       Polly
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.770.1">
      .
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.771.1">
     Polly
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.772.1">
     Polly is a
    </span>
    <a id="_idIndexMarker600">
    </a>
    <span class="koboSpan" id="kobo.773.1">
     library that is part of the .NET Foundation used to add various resilience features to applications.
    </span>
    <span class="koboSpan" id="kobo.773.2">
     It is constantly updated by the open source community and used in various applications in production environments.
    </span>
    <span class="koboSpan" id="kobo.773.3">
     To learn
    </span>
    <a id="_idIndexMarker601">
    </a>
    <span class="koboSpan" id="kobo.774.1">
     more about Polly, go
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.775.1">
      to
     </span>
    </span>
    <a href="https://github.com/App-vNext/Polly">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.776.1">
       https://github.com/App-vNext/Polly
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.777.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.778.1">
     To use Polly in our applications, we just need to add it to the project through the following command executed in the application’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.779.1">
      project directory:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.780.1">
dotnet add package Polly.Core</span></pre>
   <p>
    <span class="koboSpan" id="kobo.781.1">
     Let’s analyze the
    </span>
    <a id="_idIndexMarker602">
    </a>
    <span class="koboSpan" id="kobo.782.1">
     implementation of the
    </span>
    <a id="_idIndexMarker603">
    </a>
    <span class="koboSpan" id="kobo.783.1">
     retry strategy in the following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.784.1">
      code example:
     </span>
    </span>
   </p>
   <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.785.1">var retryPolicy = Policy.Handle&lt;Exception&gt;().RetryAsync(3);</span></strong><span class="koboSpan" id="kobo.786.1">
public async Task&lt;IActionResult&gt; GetDataWithRetryAsync()
{
    return await </span><strong class="bold"><span class="koboSpan" id="kobo.787.1">retryPolicy.ExecuteAsync</span></strong><span class="koboSpan" id="kobo.788.1">(async () =&gt;
    {
        var data = await _dataService.GetDataAsync();
        return Ok(data);
    });
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.789.1">
     As we can see in the preceding code, the implementation process is quite simple and integrates with the ASP.NET Core 9 development model.
    </span>
    <span class="koboSpan" id="kobo.789.2">
     In this example, the objective is to obtain data from a service in a resilient way.
    </span>
    <span class="koboSpan" id="kobo.789.3">
     Let’s analyze the main points of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.790.1">
      the implementation:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.791.1">
       var retryPolicy = Policy.Handle&lt;Exception&gt;().RetryAsync(3)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.792.1">
      aims to create a retry policy.
     </span>
     <span class="koboSpan" id="kobo.792.2">
      In this case, the policy is related to an exception.
     </span>
     <span class="koboSpan" id="kobo.792.3">
      During execution, if an exception is identified, the request will be made again.
     </span>
     <span class="koboSpan" id="kobo.792.4">
      Trials were configured to run a maximum of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.793.1">
       three times.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.794.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.795.1">
       return await retryPolicy.ExecuteAsync
      </span>
     </strong>
     <span class="koboSpan" id="kobo.796.1">
      command is a method that executes an action using the previously configured retry policy.
     </span>
     <span class="koboSpan" id="kobo.796.2">
      All code executing the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.797.1">
       GetDataAsync
      </span>
     </strong>
     <span class="koboSpan" id="kobo.798.1">
      method request is defined within the scope of the policy that automatically manages the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.799.1">
       retry mechanism.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.800.1">
     It is very common to use the retry strategy when consuming external APIs.
    </span>
    <span class="koboSpan" id="kobo.800.2">
     There may be intermittences or momentary unavailability and, in this case,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.801.1">
      retry
     </span>
    </strong>
    <span class="koboSpan" id="kobo.802.1">
     helps to guarantee greater resilience in cases of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.803.1">
      momentary unavailability.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.804.1">
     Let’s look at an
    </span>
    <a id="_idIndexMarker604">
    </a>
    <span class="koboSpan" id="kobo.805.1">
     example of
    </span>
    <a id="_idIndexMarker605">
    </a>
    <span class="koboSpan" id="kobo.806.1">
     implementing the circuit
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.807.1">
      breaker strategy:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.808.1">
var circuitBreakerPolicy = Policy.Handle&lt;Exception&gt;()
  .</span><strong class="bold"><span class="koboSpan" id="kobo.809.1">CircuitBreakerAsync</span></strong><span class="koboSpan" id="kobo.810.1">(
    3, // Number of consecutive faults before breaking the circuit
    TimeSpan.FromMinutes(1) // Duration of the circuit break
);
public async Task&lt;IActionResult&gt;
  GetDataWithCircuitBreakerAsync()
{
    return await </span><strong class="bold"><span class="koboSpan" id="kobo.811.1">circuitBreakerPolicy</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.812.1">      </span></strong><span class="koboSpan" id="kobo.813.1">.ExecuteAsync(async () =&gt;
    {
        var data = await _dataService.GetDataAsync();
        return Ok(data);
    });
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.814.1">
     Let’s look at the details of the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.815.1">
      preceding code:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.816.1">
       CircuitBreakerAsync
      </span>
     </strong>
     <span class="koboSpan" id="kobo.817.1">
      : This method creates an asynchronous circuit
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.818.1">
       breaker policy.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.819.1">
      The circuit
     </span>
     <a id="_idIndexMarker606">
     </a>
     <span class="koboSpan" id="kobo.820.1">
      breaker will open (break the circuit) after three consecutive
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.821.1">
       exceptions (faults).
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.822.1">
       TimeSpan.FromMinutes(1)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.823.1">
      : Once the circuit is open, it will remain open for one minute.
     </span>
     <span class="koboSpan" id="kobo.823.2">
      During this time, any attempt to perform the action will immediately throw
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.824.1">
       BrokenCircuitException
      </span>
     </strong>
     <span class="koboSpan" id="kobo.825.1">
      without performing
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.826.1">
       the action.
      </span>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.827.1">
       The circuit breaker has the
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.828.1">
        following states:
       </span>
      </span>
     </p>
     <ul>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.829.1">
         Closed
        </span>
       </strong>
       <span class="koboSpan" id="kobo.830.1">
        : The normal
       </span>
       <a id="_idIndexMarker607">
       </a>
       <span class="koboSpan" id="kobo.831.1">
        state where all calls
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.832.1">
         are allowed.
        </span>
       </span>
      </li>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.833.1">
         Open
        </span>
       </strong>
       <span class="koboSpan" id="kobo.834.1">
        : The
       </span>
       <a id="_idIndexMarker608">
       </a>
       <span class="koboSpan" id="kobo.835.1">
        state in which calls are blocked after a specified number of
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.836.1">
         consecutive failures.
        </span>
       </span>
      </li>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.837.1">
         Half-open
        </span>
       </strong>
       <span class="koboSpan" id="kobo.838.1">
        : After the
       </span>
       <a id="_idIndexMarker609">
       </a>
       <span class="koboSpan" id="kobo.839.1">
        open period, the circuit breaker allows a limited number of test calls to verify that the underlying problem has been resolved.
       </span>
       <span class="koboSpan" id="kobo.839.2">
        If these calls are successful, the circuit returns to the closed state.
       </span>
       <span class="koboSpan" id="kobo.839.3">
        If they fail, the circuit returns to the
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.840.1">
         open state.
        </span>
       </span>
      </li>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.841.1">
         circuitBreakerPolicy.ExecuteAsync
        </span>
       </strong>
       <span class="koboSpan" id="kobo.842.1">
        : This method executes the given asynchronous delegate (the code block inside) under the control of the circuit
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.843.1">
         breaker policy.
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.844.1">
        If the
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.845.1">
         _dataService.GetDataAsync()
        </span>
       </strong>
       <span class="koboSpan" id="kobo.846.1">
        call succeeds, the method returns the data wrapped in an
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.847.1">
         OkObjectResult
        </span>
       </strong>
       <span class="koboSpan" id="kobo.848.1">
        (HTTP
       </span>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.849.1">
          200
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.850.1">
         response).
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.851.1">
        If the
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.852.1">
         _dataService.GetDataAsync()
        </span>
       </strong>
       <span class="koboSpan" id="kobo.853.1">
        call throws an exception, the circuit breaker policy
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.854.1">
         handles it:
        </span>
       </span>
       <ul>
        <li>
         <span class="koboSpan" id="kobo.855.1">
          If
         </span>
         <a id="_idIndexMarker610">
         </a>
         <span class="koboSpan" id="kobo.856.1">
          fewer than three exceptions have occurred consecutively, the circuit breaker remains closed, and the exception
         </span>
         <span class="No-Break">
          <span class="koboSpan" id="kobo.857.1">
           is propagated.
          </span>
         </span>
        </li>
        <li>
         <span class="koboSpan" id="kobo.858.1">
          After three consecutive exceptions, the circuit breaker opens for one minute.
         </span>
         <span class="koboSpan" id="kobo.858.2">
          Any further calls within this period will immediately
         </span>
         <span class="No-Break">
          <span class="koboSpan" id="kobo.859.1">
           throw
          </span>
         </span>
         <span class="No-Break">
          <strong class="source-inline">
           <span class="koboSpan" id="kobo.860.1">
            BrokenCircuitException
           </span>
          </strong>
         </span>
         <span class="No-Break">
          <span class="koboSpan" id="kobo.861.1">
           .
          </span>
         </span>
        </li>
       </ul>
      </li>
     </ul>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.862.1">
     The circuit breaker
    </span>
    <a id="_idIndexMarker611">
    </a>
    <span class="koboSpan" id="kobo.863.1">
     policy helps prevent repeated failures from overloading the system by interrupting the circuit after three consecutive failures and keeping it open for one minute.
    </span>
    <span class="koboSpan" id="kobo.863.2">
     During this period, any attempt to call the data service will result in an immediate exception without attempting to execute the service call.
    </span>
    <span class="koboSpan" id="kobo.863.3">
     This allows the system to recover and prevents cascading failures in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.864.1">
      dependent systems.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.865.1">
     The circuit breaker
    </span>
    <a id="_idIndexMarker612">
    </a>
    <span class="koboSpan" id="kobo.866.1">
     and retry strategies are powerful resilience strategies that, despite
    </span>
    <a id="_idIndexMarker613">
    </a>
    <span class="koboSpan" id="kobo.867.1">
     appearing similar, have different objectives, as
    </span>
    <a id="_idIndexMarker614">
    </a>
    <span class="koboSpan" id="kobo.868.1">
     shown in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.869.1">
       Table 7.1
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.870.1">
      :
     </span>
    </span>
   </p>
   <table class="No-Table-Style _idGenTablePara-1" id="table001-3">
    <colgroup>
     <col/>
     <col/>
     <col/>
    </colgroup>
    <tbody>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.871.1">
           Aspect
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.872.1">
           Circuit Breaker
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.873.1">
           Retry
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.874.1">
          Purpose
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.875.1">
         Prevent overwhelming a
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.876.1">
          failing service
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.877.1">
         Handle transient faults
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.878.1">
          by retrying
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.879.1">
          Behavior
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.880.1">
         Stops requests after a certain number of failures and opens the circuit for a
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.881.1">
          specified time
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.882.1">
         Retries the operation a specified number of times with a delay
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.883.1">
          between retries
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.884.1">
          States
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.885.1">
         Closed,
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.886.1">
          open, half-open
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.887.1">
         No states,
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.888.1">
          just retries
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.889.1">
          Failure Handling
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.890.1">
         Fails fast once the circuit
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.891.1">
          is open
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.892.1">
         Retries multiple times
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.893.1">
          before failing
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.894.1">
         When
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.895.1">
          to Use
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.896.1">
         When repeated failures need to be avoided to protect
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.897.1">
          a system
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.898.1">
         When temporary faults are expected to be resolved
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.899.1">
          with retries
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.900.1">
          Complexity
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.901.1">
         Higher, with state transitions
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.902.1">
          and monitoring
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.903.1">
         Lower, with simple
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.904.1">
          retry logic
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.905.1">
         Feedback
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.906.1">
          to Users
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.907.1">
         Immediate failure feedback when the circuit
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.908.1">
          is open
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.909.1">
         Delayed feedback after all
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.910.1">
          retries fail
         </span>
        </span>
       </p>
      </td>
     </tr>
    </tbody>
   </table>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.911.1">
     Table 7.1 –The circuit breaker and retry objectives
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.912.1">
     In practice, these patterns are often used together to provide a robust fault-handling mechanism.
    </span>
    <span class="koboSpan" id="kobo.912.2">
     For example, you can use a retry policy to handle transient failures, and if the attempts consistently fail, the circuit breaker can be used to prevent retries and allow the system
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.913.1">
      to recover.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.914.1">
     Polly offers several other
    </span>
    <a id="_idIndexMarker615">
    </a>
    <span class="koboSpan" id="kobo.915.1">
     resilience mechanisms that can be combined to make applications even
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.916.1">
      more powerful.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.917.1">
     The use of these strategies greatly contributes to the creation of robust solutions prepared for large-scale execution models, especially in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.918.1">
      cloud environments.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.919.1">
     In any case, even by adding several mechanisms to avoid failures, they may arise.
    </span>
    <span class="koboSpan" id="kobo.919.2">
     In this case, we must be able to obtain sufficient information to make corrections and keep applications free from non-conformities.
    </span>
    <span class="koboSpan" id="kobo.919.3">
     For this, it is important to add logs in applications, and ASP.NET Core 9 provides a powerful mechanism for this, which we will learn about in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.920.1">
      next section.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-128">
    <a id="_idTextAnchor129">
    </a>
    <span class="koboSpan" id="kobo.921.1">
     Understanding and implementing logging and monitoring
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.922.1">
     Having optimized performance and resilience, we now turn to logging and monitoring, essential practices for maintaining and troubleshooting your ASP.NET Core
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.923.1">
      9 applications.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-129">
    <a id="_idTextAnchor130">
    </a>
    <span class="koboSpan" id="kobo.924.1">
     Introduction to logging and monitoring
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.925.1">
     Logging
    </span>
    <a id="_idIndexMarker616">
    </a>
    <span class="koboSpan" id="kobo.926.1">
     and monitoring are
    </span>
    <a id="_idIndexMarker617">
    </a>
    <span class="koboSpan" id="kobo.927.1">
     crucial to understanding your application’s behavior, diagnosing problems, and ensuring it runs smoothly.
    </span>
    <span class="koboSpan" id="kobo.927.2">
     Logs provide visibility into application processes and help detect
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.928.1">
      anomalies early.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.929.1">
     Think of logging like keeping a diary and monitoring like installing surveillance cameras in your home.
    </span>
    <span class="koboSpan" id="kobo.929.2">
     The diary helps you remember past events, while the cameras let you see what’s happening in real time, maintaining safety
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.930.1">
      and order.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.931.1">
     Logging with ILogger
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.932.1">
     .NET provides abstractions that allow ASP.NET Core 9 applications to handle different logging
    </span>
    <a id="_idIndexMarker618">
    </a>
    <span class="koboSpan" id="kobo.933.1">
     strategies.
    </span>
    <span class="koboSpan" id="kobo.933.2">
     The
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.934.1">
      ILogger
     </span>
    </strong>
    <span class="koboSpan" id="kobo.935.1">
     and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.936.1">
      ILoggerFactory
     </span>
    </strong>
    <span class="koboSpan" id="kobo.937.1">
     interfaces, provided
    </span>
    <a id="_idIndexMarker619">
    </a>
    <span class="koboSpan" id="kobo.938.1">
     by the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.939.1">
      Microsoft.Extensions.Logging
     </span>
    </strong>
    <span class="koboSpan" id="kobo.940.1">
     namespace, are
    </span>
    <a id="_idIndexMarker620">
    </a>
    <span class="koboSpan" id="kobo.941.1">
     essential for implementing logging in your applications, allowing you to capture and record information about the operation of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.942.1">
      the application.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.943.1">
     Logging provides insights into the behavior of your application and is essential for debugging
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.944.1">
      and monitoring.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.945.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.946.1">
      ILogger
     </span>
    </strong>
    <span class="koboSpan" id="kobo.947.1">
     interface
    </span>
    <a id="_idIndexMarker621">
    </a>
    <span class="koboSpan" id="kobo.948.1">
     in ASP.NET Core allows you to log information at various levels of details as described in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.949.1">
      following points:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.950.1">
       Trace
      </span>
     </strong>
     <span class="koboSpan" id="kobo.951.1">
      : Detailed information, typically of interest only when
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.952.1">
       diagnosing problems
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.953.1">
       Debug
      </span>
     </strong>
     <span class="koboSpan" id="kobo.954.1">
      : Information useful for debugging
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.955.1">
       the application
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.956.1">
       Information
      </span>
     </strong>
     <span class="koboSpan" id="kobo.957.1">
      : Informational messages that highlight the progress of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.958.1">
       the application
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.959.1">
       Warning
      </span>
     </strong>
     <span class="koboSpan" id="kobo.960.1">
      : Potentially harmful situations that are
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.961.1">
       not errors
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.962.1">
       Error
      </span>
     </strong>
     <span class="koboSpan" id="kobo.963.1">
      : Errors that prevent the application from performing
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.964.1">
       a function
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.965.1">
       Critical
      </span>
     </strong>
     <span class="koboSpan" id="kobo.966.1">
      : Critical errors causing complete failure of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.967.1">
       the application
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.968.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.969.1">
      ILogger
     </span>
    </strong>
    <span class="koboSpan" id="kobo.970.1">
     interface provides some
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.971.1">
      useful methods:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.972.1">
        Log methods
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.973.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.974.1">
         Log&lt;TState&gt;(LogLevel logLevel, EventId eventId, TState state, Exception exception, Func&lt;TState, Exception, string&gt; formatter)
        </span>
       </strong>
       <span class="koboSpan" id="kobo.975.1">
        : The core
       </span>
       <a id="_idIndexMarker622">
       </a>
       <span class="koboSpan" id="kobo.976.1">
        method to log messages.
       </span>
       <span class="koboSpan" id="kobo.976.2">
        It allows you to specify the log level, event ID, state, exception, and a
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.977.1">
         formatter function.
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.978.1">
        Convenience methods
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.979.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.980.1">
         LogTrace(string message, params object[] args)
        </span>
       </strong>
       <span class="koboSpan" id="kobo.981.1">
        : Logs a
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.982.1">
         trace
        </span>
       </span>
       <span class="No-Break">
        <a id="_idIndexMarker623">
        </a>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.983.1">
         message.
        </span>
       </span>
      </li>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.984.1">
         LogDebug(string message, params object[] args)
        </span>
       </strong>
       <span class="koboSpan" id="kobo.985.1">
        : Logs a
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.986.1">
         debug message.
        </span>
       </span>
      </li>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.987.1">
         LogInformation(string message, params object[] args)
        </span>
       </strong>
       <span class="koboSpan" id="kobo.988.1">
        : Logs an
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.989.1">
         informational message.
        </span>
       </span>
      </li>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.990.1">
         LogWarning(string message, params object[] args)
        </span>
       </strong>
       <span class="koboSpan" id="kobo.991.1">
        : Logs a
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.992.1">
         warning message.
        </span>
       </span>
      </li>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.993.1">
         LogError(string message, params object[] args)
        </span>
       </strong>
       <span class="koboSpan" id="kobo.994.1">
        : Logs an
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.995.1">
         error message.
        </span>
       </span>
      </li>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.996.1">
         LogCritical(string message, params object[] args)
        </span>
       </strong>
       <span class="koboSpan" id="kobo.997.1">
        : Logs a
       </span>
       <a id="_idIndexMarker624">
       </a>
       <span class="koboSpan" id="kobo.998.1">
        critical
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.999.1">
         error message.
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1000.1">
        Scope Method
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1001.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1002.1">
         BeginScope&lt;TState&gt;(TState state)
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1003.1">
        : This method starts a logical operation
       </span>
       <a id="_idIndexMarker625">
       </a>
       <span class="koboSpan" id="kobo.1004.1">
        scope.
       </span>
       <span class="koboSpan" id="kobo.1004.2">
        It returns an
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1005.1">
         IDisposable
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1006.1">
        interface that ends the scope on disposal.
       </span>
       <span class="koboSpan" id="kobo.1006.2">
        Scopes are useful for correlating a set of operations with a
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1007.1">
         common context.
        </span>
       </span>
      </li>
     </ul>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.1008.1">
     The following is an
    </span>
    <a id="_idIndexMarker626">
    </a>
    <span class="koboSpan" id="kobo.1009.1">
     example of using the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1010.1">
       ILogger
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1011.1">
      interface:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1012.1">
public class MyService
{
    private </span><strong class="bold"><span class="koboSpan" id="kobo.1013.1">readonly ILogger&lt;MyService&gt; _logger;</span></strong><span class="koboSpan" id="kobo.1014.1">
    public </span><strong class="bold"><span class="koboSpan" id="kobo.1015.1">MyService(ILogger&lt;MyService&gt; logger)</span></strong><span class="koboSpan" id="kobo.1016.1">
    {
        _logger = logger;
    }
    public void DoWork()
    {
        </span><strong class="bold"><span class="koboSpan" id="kobo.1017.1">_logger.LogInformation("Starting work.");</span></strong><span class="koboSpan" id="kobo.1018.1">
        try
        {
            // Perform some work here
        }
        catch (Exception ex)
        {
            </span><strong class="bold"><span class="koboSpan" id="kobo.1019.1">_logger.LogError(ex, "An error occurred while doing work.");</span></strong><span class="koboSpan" id="kobo.1020.1">
        }
        _logger.LogInformation("Finished work.");
    }
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1021.1">
     The previous code uses several
    </span>
    <a id="_idIndexMarker627">
    </a>
    <span class="koboSpan" id="kobo.1022.1">
     methods provided by the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1023.1">
       ILogger
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1024.1">
      interface:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1025.1">
       ILogger&lt;MyService&gt; _logger
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1026.1">
      : This declares a private
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1027.1">
       readonly
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1028.1">
      field,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1029.1">
       _logger
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1030.1">
      , of the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1031.1">
       ILogger&lt;MyService&gt;
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1032.1">
      type.
     </span>
     <span class="koboSpan" id="kobo.1032.2">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1033.1">
       ILogger&lt;T&gt;
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1034.1">
      interface is part of the .NET logging infrastructure, where
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1035.1">
       T
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1036.1">
      is the type that is being logged.
     </span>
     <span class="koboSpan" id="kobo.1036.2">
      By specifying
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1037.1">
       MyService
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1038.1">
      , the logger is associated with this class, which helps in identifying where the log messages are
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1039.1">
       coming from.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1040.1">
       MyService(ILogger&lt;MyService&gt; logger)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1041.1">
      : The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1042.1">
       ILogger&lt;MyService&gt;
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1043.1">
      instance is typically provided via dependency injection.
     </span>
     <span class="koboSpan" id="kobo.1043.2">
      This allows the logging infrastructure to be configured and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1044.1">
       managed centrally.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1045.1">
       _logger.LogInformation("Starting work.")
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1046.1">
      : Log the information type with the string
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1047.1">
        Starting work
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1048.1">
       .
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1049.1">
       _logger.LogError(ex, "An error occurred while doing work.")
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1050.1">
      : Log the information type
     </span>
     <a id="_idIndexMarker628">
     </a>
     <span class="koboSpan" id="kobo.1051.1">
      with the string
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1052.1">
       An error occurred while
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1053.1">
        doing work
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1054.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.1055.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1056.1">
      ILogger
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1057.1">
     interface offers a powerful abstraction for logging your application’s execution data in a technology-agnostic manner, facilitating maintenance
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1058.1">
      and extensibility.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1059.1">
     Another powerful abstraction mechanism available in .NET
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1060.1">
      is
     </span>
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.1061.1">
       ILoggerFactory
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1062.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1063.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1064.1">
      ILoggerFactory
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1065.1">
     interface
    </span>
    <a id="_idIndexMarker629">
    </a>
    <span class="koboSpan" id="kobo.1066.1">
     is responsible for creating
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1067.1">
      ILogger
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1068.1">
     instances.
    </span>
    <span class="koboSpan" id="kobo.1068.2">
     It is generally used to create loggers for specific categories or to configure logging providers
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1069.1">
      and settings.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1070.1">
     The main methods
    </span>
    <a id="_idIndexMarker630">
    </a>
    <span class="koboSpan" id="kobo.1071.1">
     are
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1072.1">
      as follows:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1073.1">
       CreateLogger(string categoryname)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1074.1">
      : Creates an
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1075.1">
       ILogger
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1076.1">
      instance for the specified category.
     </span>
     <span class="koboSpan" id="kobo.1076.2">
      The category is usually the name of the class or component that the logger is
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1077.1">
       associated with.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1078.1">
       AddProvider (ILoggerProvider provider)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1079.1">
      : Adds
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1080.1">
       ILoggerProvider
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1081.1">
      to the factory.
     </span>
     <span class="koboSpan" id="kobo.1081.2">
      This method is used to configure where and how log messages are sent, such as to the console, a file, or a remote
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1082.1">
       log service.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1083.1">
       To discard()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1084.1">
      : Discards the logger factory and all loggers it created.
     </span>
     <span class="koboSpan" id="kobo.1084.2">
      Typically used to release any resources held by
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1085.1">
       log providers.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.1086.1">
     We can use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1087.1">
      ILoggerFactory
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1088.1">
     interface as in the following example
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1089.1">
      of code:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1090.1">
public class MyService
{
    private readonly ILogger _logger;
    </span><strong class="bold"><span class="koboSpan" id="kobo.1091.1">public MyService(ILoggerFactory loggerFactory)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1092.1">    {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1093.1">        _logger = loggerFactory.CreateLogger&lt;MyService&gt;();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1094.1">    }</span></strong><span class="koboSpan" id="kobo.1095.1">
    public void DoWork()
    {
        _logger.LogInformation("Starting work.");
        try
        {
            // Perform some work here
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "An error occurred while doing work.");
        }
        _logger.LogInformation("Finished work.");
    }
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1096.1">
     The big difference between using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1097.1">
      ILoggerFactory
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1098.1">
     interface
    </span>
    <a id="_idIndexMarker631">
    </a>
    <span class="koboSpan" id="kobo.1099.1">
     and the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1100.1">
      ILogger
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1101.1">
     interface
    </span>
    <a id="_idIndexMarker632">
    </a>
    <span class="koboSpan" id="kobo.1102.1">
     is the creation of a new category of logs that will be used to group the application’s log messages.
    </span>
    <span class="koboSpan" id="kobo.1102.2">
     The constructor receives an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1103.1">
      ILoggerFactory
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1104.1">
     instance via dependency injection and then an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1105.1">
      ILogger
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1106.1">
     instance is created for the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1107.1">
      MyService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1108.1">
     class.
    </span>
    <span class="koboSpan" id="kobo.1108.2">
     In this case, all log messages of this class will be grouped by the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1109.1">
       MyService
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1110.1">
      category.
     </span>
    </span>
   </p>
   <p>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1111.1">
      ILoggerFactory
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1112.1">
     allows for centralized configuration of logging settings.
    </span>
    <span class="koboSpan" id="kobo.1112.2">
     This means you can set up logging providers, filters, and other settings in one place, typically during application startup, and apply these configurations across all loggers created by the factory.
    </span>
    <span class="koboSpan" id="kobo.1112.3">
     You can also dynamically create loggers for different categories or components within your application.
    </span>
    <span class="koboSpan" id="kobo.1112.4">
     This is useful for associating log messages with specific parts of the application, making it easier to filter and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1113.1">
      analyze logs.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1114.1">
     Logs work with providers, which are different sources where the logs will be made available.
    </span>
    <span class="koboSpan" id="kobo.1114.2">
     An application may contain different types of providers for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1115.1">
      each purpose.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1116.1">
     Each provider is centrally configured during application startup.
    </span>
    <span class="koboSpan" id="kobo.1116.2">
     This way, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1117.1">
      ILogger
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1118.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1119.1">
      ILoggerFactory
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1120.1">
     abstractions will use
    </span>
    <a id="_idIndexMarker633">
    </a>
    <span class="koboSpan" id="kobo.1121.1">
     the configured providers for submitting
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1122.1">
      the
     </span>
    </span>
    <span class="No-Break">
     <a id="_idIndexMarker634">
     </a>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1123.1">
      logs.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1124.1">
     There are several types of providers that can be used in ASP.NET Core 9, such as providers for writing to the console, adding debug information, and even providers for writing logs to external services such as Azure Application Insights and Elasticsearch,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1125.1">
      among others.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1126.1">
     Let’s look at an example of log settings in the following code from a
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1127.1">
       Program.cs
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <strong class="bold">
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1128.1">
      class:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1129.1">
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Hosting;
using Microsoft.Extensions.Logging;
var builder = WebApplication.CreateBuilder(args);
// Add services to the container.
</span><span class="koboSpan" id="kobo.1129.2">builder.Services.AddControllers();
</span><strong class="bold"><span class="koboSpan" id="kobo.1130.1">// Configure logging</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1131.1">builder.Logging.ClearProviders();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1132.1">// Optional: clear default providers</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1133.1">builder.Logging.AddConsole(); // Add console logging</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1134.1">builder.Logging.AddDebug(); // Add debug logging</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1135.1">builder.Logging.AddEventSourceLogger();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1136.1">// Add event source logging</span></strong><span class="koboSpan" id="kobo.1137.1">
var app = builder.Build();
// Configure the HTTP request pipeline.
</span><span class="koboSpan" id="kobo.1137.2">if (app.Environment.IsDevelopment())
{
    app.UseDeveloperExceptionPage();
}
else
{
    app.UseExceptionHandler("/Home/Error");
    app.UseHsts();
}
app.UseHttpsRedirection();
app.UseStaticFiles();
app.UseRouting();
app.UseAuthorization();
app.MapControllers();
app.Run();</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1138.1">
     As we can see in the preceding code example, different providers were added for writing logs.
    </span>
    <span class="koboSpan" id="kobo.1138.2">
     This means that when using a method such as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1139.1">
      _logger.LogInformation
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1140.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1141.1">
      _logger.LogError
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1142.1">
     , these logs will be distributed to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1143.1">
      configured providers.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1144.1">
     Logs
    </span>
    <a id="_idIndexMarker635">
    </a>
    <span class="koboSpan" id="kobo.1145.1">
     are a powerful tool, essential in any application, helping to detect failures and even
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1146.1">
      optimize systems.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1147.1">
     In
    </span>
    <a href="B21788_08.xhtml#_idTextAnchor132">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1148.1">
        Chapter 8
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.1149.1">
     , we will explore the use of logs in conjunction
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1150.1">
      with middleware.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-130">
    <a id="_idTextAnchor131">
    </a>
    <span class="koboSpan" id="kobo.1151.1">
     Summary
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1152.1">
     During this chapter, we learned about implementing best practices in ASP.NET Core 9, working correctly with HTTP requests, adding comprehension to responses, and understanding the use of caching to bring better performance and resilience to applications.
    </span>
    <span class="koboSpan" id="kobo.1152.2">
     We also understood the concepts related to asynchronous requests and how we can use this approach in ASP.NET Core applications through the use of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1153.1">
      async
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1154.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1155.1">
      await
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1156.1">
     keywords.
    </span>
    <span class="koboSpan" id="kobo.1156.2">
     Finally, we learned about the importance of using application monitoring, taking advantage of internal mechanisms that abstract writing and logs, such as the use of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1157.1">
      ILogger
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1158.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1159.1">
      ILoggerFactory
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1160.1">
     classes, allowing us to have enough inputs to fix inconsistencies in applications and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1161.1">
      optimize them.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1162.1">
     In the next chapter, we will learn how to expand the request pipeline of ASP.NET Core 9 applications through the use
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1163.1">
      of middleware.
     </span>
    </span>
   </p>
  </div>
 </body></html>