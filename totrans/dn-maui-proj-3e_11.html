<html><head></head><body>
<div><h1 class="chapter-number" id="_idParaDest-175"><a id="_idTextAnchor895"/>11</h1>
<h1 id="_idParaDest-176"><a id="_idTextAnchor896"/>Building a Calculator Using .NET MAUI Blazor</h1>
<p>In this chapter, we will explore a .NET <code>BlazorWebView</code>. We will also communicate between Blazor and .NET MAUI.</p>
<p>In this chapter, we are going to cover the following topics:</p>
<ul>
<li>What is Blazor?</li>
<li>Exploring the differences between .NET MAUI projects and .NET MAUI Blazor projects</li>
<li>Using HTML and CSS to define a UI</li>
<li>Using XAML controls with HTML in a WebView</li>
<li>Writing C# code that will integrate with XAML controls and HTML controls</li>
<li>Working with the main .NET MAUI window to resize it to its contents</li>
</ul>
<h1 id="_idParaDest-177"><a id="_idTextAnchor897"/>Technical requirements</h1>
<p>You will need to have Visual Studio for Mac or PC installed, as well as the .NET MAUI components. See <em class="italic">Chapter 1</em>, <em class="italic">Introduction to .NET MAUI</em>, for more details on how to set up your environment. The source code for this chapter is available in this bookâ€™s GitHub repository: <a href="https://github.com/">https://github.com/</a>PacktPublishing/MAUI-Projects-3rd-Edition.</p>
<h1 id="_idParaDest-178"><a id="_idTextAnchor898"/>Project overview</h1>
<p>In this chapter, you<a id="_idIndexMarker1183"/> will discover .NET Blazor and how to use it with .NET MAUI to develop a UI for an app. We will explore the different options available for hosting a Blazor app within a .NET MAUI app. Communication between the two apps is a crucial part of the interoperability and this chapterâ€™s project will <a id="_idIndexMarker1184"/>show you how to send data from .NET MAUI to Blazor and vice versa.</p>
<h1 id="_idParaDest-179"><a id="_idTextAnchor899"/>What is Blazor?</h1>
<p>.NET Blazor is a <a id="_idIndexMarker1185"/>web framework built on top of .NET. Blazor applications run in the browser by<a id="_idIndexMarker1186"/> using <strong class="bold">WebAssembly</strong> (<strong class="bold">WASM</strong>), or on a server using SignalR. Blazor is one part of the whole ASP.NET ecosystem, and it leverages Razor pages for developing the UI. Blazor uses HTML and CSS to render a rich UI. Blazor uses a component-based UI, where each component is a Razor markup page. Within a Razor page, you can mix and match HTML, CSS, and C# code. There are three deployment models for a Blazor app:</p>
<ul>
<li><strong class="bold">Blazor Server</strong>: In a Blazor<a id="_idIndexMarker1187"/> Server deployment, the <a id="_idIndexMarker1188"/>application code runs on the server in an ASP.NET Core app, and it communicates with the UI running in a browser via SignalR.</li>
<li><strong class="bold">Blazor WebAssembly</strong>: For Blazor<a id="_idIndexMarker1189"/> WebAssembly, the entire app runs in the browser via WASM. It is an open web standard that makes it possible to run .NET code safely in the browser. WASM provides interoperability with JavaScript.</li>
<li><strong class="bold">Blazor Hybrid</strong>: Blazor Hybrid is a<a id="_idIndexMarker1190"/> blend of native .NET and<a id="_idIndexMarker1191"/> web technologies. Blazor Hybrid apps can be hosted in .NET MAUI, <strong class="bold">WPF</strong>, and <strong class="bold">Windows Forms</strong> applications. Since the hosts are all .NET, the Blazor runtime runs natively within the same .NET process and renders the Razor page web UI into a WebView control.</li>
</ul>
<p>Now that we have some general knowledge of Blazor, letâ€™s look at the app we will build in this chapter!</p>
<h1 id="_idParaDest-180"><a id="_idTextAnchor900"/>Creating the calculator app</h1>
<p>In this chapter, we are<a id="_idIndexMarker1192"/> going to build a calculator app. The UI for the calculator is built using Razor pages in Blazor, but the actual mechanics of the calculator reside in the .NET MAUI app.</p>
<h2 id="_idParaDest-181"><a id="_idTextAnchor901"/>Setting up the project</h2>
<p>This project, like all the<a id="_idIndexMarker1193"/> rest, is a <strong class="bold">File</strong> | <strong class="bold">New</strong> | <strong class="bold">Project...</strong>-style project. This means that we will not be importing any code at all. So, this first section is all about creating the project and setting up the basic project <a id="_idTextAnchor902"/><a id="_idTextAnchor903"/>structure.</p>
<h3>Creating the n<a id="_idTextAnchor904"/>ew project</h3>
<p>The first step is to<a id="_idIndexMarker1194"/> create a new .NET MAUI project. Follow these steps:</p>
<ol>
<li>Open Visual Studio 2022 and select <strong class="bold">Create a </strong><strong class="bold">new project</strong>:</li>
</ol>
<div><div><img alt="Figure 11.1 â€“ Visual ï»¿Studio 2022" src="img/B19214_11_1.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.1 â€“ Visual <a id="_idTextAnchor905"/>Studio 2022</p>
<p class="list-inset">This will<a id="_idIndexMarker1195"/> open the <strong class="bold">Create a new </strong><strong class="bold">project</strong> wizard.</p>
<ol>
<li value="2">In the search field, type in <code>blazor</code> and select the <strong class="bold">.NET MAUI Blazor App</strong> item from the list:</li>
</ol>
<div><div><img alt="Figure 11.2 â€“ Create a nï»¿ew project" src="img/B19214_11_2.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.2 â€“ Create a n<a id="_idTextAnchor906"/>ew project</p>
<ol>
<li value="3">Click <strong class="bold">Next</strong>.</li>
<li>Enter <code>Calculator</code> as the<a id="_idIndexMarker1196"/> name of the app, as shown in the following screenshot:</li>
</ol>
<div><div><img alt="Figure 11.3 â€“ Configure your new project" src="img/B19214_11_3.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.3 â€“ Configure your new project</p>
<ol>
<li value="5">Click <strong class="bold">Next</strong>.<p class="list-inset">The last step will <a id="_idIndexMarker1197"/>prompt you for the version of .NET Core to <a id="_idIndexMarker1198"/>support. At the time of writing, .NET 6 is available as <strong class="bold">Long-Term Support</strong> (<strong class="bold">LTS</strong>), and .NET 7 is available<a id="_idIndexMarker1199"/> as <strong class="bold">Standard Term Support</strong>. For this book, we will assume that you will be using .NET 7:</p></li>
</ol>
<div><div><img alt="Figure 11.4 â€“ Additional information" src="img/B19214_11_4.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.4 â€“ Additional information</p>
<ol>
<li value="6">Finalize the setup by clicking <strong class="bold">Create</strong> and wait for Visual Studio to create the project.</li>
</ol>
<p>Thatâ€™s it fo<a id="_idIndexMarker1200"/>r proj<a id="_idTextAnchor907"/><a id="_idTextAnchor908"/><a id="_idTextAnchor909"/>ect creation.</p>
<p>Letâ€™s continue by reviewing the structure of the app.</p>
<h3>Exploring a .NET MAUI Blazor Hybrid project</h3>
<p>If you run the <a id="_idIndexMarker1201"/>project, you will see an <a id="_idIndexMarker1202"/>app, as shown in <em class="italic">Figure 11</em><em class="italic">.5</em>. It does not resemble the .NET MAUI app template and has a distinctive web feel to it. Poke around the app a little bit to see how all the visual elements work together. Then, close the application, return to Visual Studio, and continue exploring the project:</p>
<div><div><img alt="Figure 11.5 â€“ Running the .NET MAUI Blazor template project" src="img/B19214_11_5.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.5 â€“ Running the .NET MAUI Blazor template project</p>
<p>The structure of <a id="_idIndexMarker1203"/>the .NET MAUI Blazor app is a mashup of a .NET MAUI app and a Blazor app. If you look at the <code>Platforms</code> and <code>Resources</code> folders and the <code>App.xaml</code>, <code>MainPage.xaml</code>, and <code>MauiProgram.cs</code> files that are normally present in the .NET MAUI template. The <code>wwwroot</code>, <code>Data</code>, <code>Pages</code>, and <code>Shared</code> folders all support the Blazor app. Additionally, youâ€™ll find <code>_Imports.razor</code> and <code>Main.razor</code> at the root of the project:</p>
<div><div><img alt="Figure 11.6 â€“ Solution Explorer view of a .NET MAUI Blazor project" src="img/B19214_11_6.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.6 â€“ Solution Explorer view of a .NET MAUI Blazor project</p>
<p>If you need a refresher on how a .NET MAUI app is structured and works, refer to <em class="italic">Chapter 1</em>. Ignoring how a Blazor app works for the moment, letâ€™s take a look at how a Blazor app is hosted by .NET MAUI.</p>
<p>Since all .NET MAUI <a id="_idIndexMarker1204"/>programs start with the <code>MauiProgram.cs</code> file, that seems like a good place to start. Open the <code>MauiProgram.cs</code> file and inspect its contents. The following snippet highlights the differences for a .NET MAUI Blazor app:</p>
<pre class="source-code">
<strong class="bold">builder.Services.AddMauiBlazorWebView();</strong>
#if DEBUG
Â Â Â Â <strong class="bold">builder.Services.AddBlazorWebViewDeveloperTools();</strong>
Â Â Â Â builder.Logging.AddDebug();
#endif</pre> <p>The first highlighted line enables the hosting services for the Blazor app, specifically the WebView controller. The second highlighted line enables the developer tools (<em class="italic">F12</em>) within the WebView control, but only in a debug configuration.</p>
<p><code>App.xaml</code> and <code>App.xaml.cs</code> are essentially the same as in a .NET MAUI template project, but <code>MainPage.xaml</code> is not. Open <a id="_idIndexMarker1205"/>the <code>MainPage.xaml</code> file to inspect its contents, as<a id="_idIndexMarker1206"/> shown here:</p>
<pre class="source-code">
&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;ContentPage
Â Â Â Â 
Â Â Â Â 
Â Â Â Â 
Â Â Â Â x:Class="Calculator.MainPage"
Â Â Â Â BackgroundColor="{DynamicResource PageBackgroundColor}"&gt;
<strong class="bold">Â Â Â Â &lt;BlazorWebView x:Name="blazorWebView" HostPage="wwwroot/index.html"&gt;</strong>
<strong class="bold">Â Â Â Â Â Â &lt;BlazorWebView.RootComponents&gt;</strong>
<strong class="bold">Â Â Â Â Â Â Â Â &lt;RootComponent Selector="#app" ComponentType="{x:Type local:Main}" /&gt;</strong>
<strong class="bold">Â Â Â Â Â Â &lt;/BlazorWebView.RootComponents&gt;</strong>
<strong class="bold">Â Â Â Â &lt;/BlazorWebView&gt;</strong>
&lt;/ContentPage&gt;</pre> <p><code>MainPage</code> has a single control, <code>BlazorWebView</code>. This is a wrapper around the native controls to host web pages in apps. The <code>HostPage</code> attribute points to the starting page â€“ in this case, <code>wwwroot/index.html</code>. The <code>BlazorWebView.RootComponents</code> element identifies the starting points for the Blazor application and the location where they are hosted on the page. In this case, <code>RootComponent</code> <code>Main</code> is rooted in the element with an ID of <code>app</code>.</p>
<p>To see where the <code>app</code> element is located, open the <code>index.html</code> file in the <code>wwwroot</code> folder and<a id="_idIndexMarker1207"/> inspect its contents, as <a id="_idIndexMarker1208"/>shown here:</p>
<pre class="source-code">
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
Â Â &lt;meta charset="utf-8" /&gt;
Â Â &lt;meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" /&gt;
Â Â &lt;title&gt;Calculator&lt;/title&gt;
Â Â &lt;base href="/" /&gt;
Â Â &lt;link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" /&gt;
Â Â <strong class="bold">&lt;link href="css/app.css" rel="stylesheet" /&gt;</strong>
Â Â <strong class="bold">&lt;link href="Calculator.styles.css" rel="stylesheet" /&gt;</strong>
&lt;/head&gt;
&lt;body&gt;
Â Â &lt;div class="status-bar-safe-area"&gt;&lt;/div&gt;
Â Â <strong class="bold">&lt;div id="app"&gt;Loading...&lt;/div&gt;</strong>
Â Â &lt;div id="blazor-error-ui"&gt;
Â Â Â Â An unhandled error has occurred.
Â Â Â Â &lt;a href="" class="reload"&gt;Reload&lt;/a&gt;
Â Â Â Â &lt;a class="dismiss"&gt;ğŸ—™&lt;/a&gt;
Â Â &lt;/div&gt;
Â Â <strong class="bold">&lt;script src="img/blazor.webview.js" autostart="false"&gt;&lt;/script&gt;</strong>
&lt;/body&gt;
&lt;/html&gt;</pre> <p>The key parts of the file are highlighted in the preceding code. First, the <code>div</code> element with <code>id</code> set to <code>app</code> is where the <code>Main</code> component is rooted, or loaded. In the header of the page, the stylesheets are identified. The first stylesheet, <code>app.css</code>, is located in the <code>wwwroot/css</code> folder of the project. The second stylesheet, <code>Calculator.Styles.css</code>, is created during the build process from isolated CSS files. <code>_framework/blazor.webview.js</code> file is imported and is responsible for doing all the heavy lifting of getting your Blazor components rendered at the right location on the page.</p>
<p>The final piece for us to review before we move on to creating the rest of the application is the Blazor components. <code>Main.razor</code> is a routing file that directs the Blazor runtime to the <a id="_idIndexMarker1210"/>starting<a id="_idIndexMarker1211"/> component, <code>MainLayout.razor</code>, as shown in the following code:</p>
<pre class="source-code">
&lt;Router AppAssembly="@typeof(Main).Assembly"&gt;
Â Â &lt;Found Context="routeData"&gt;
Â Â Â Â <strong class="bold">&lt;RouteView RouteData="@routeData" DefaultLayout="@typeof(MainLayout)" /&gt;</strong>
Â Â Â Â &lt;FocusOnNavigate RouteData="@routeData" Selector="h1" /&gt;
Â Â &lt;/Found&gt;
Â Â &lt;NotFound&gt;
Â Â Â Â &lt;LayoutView Layout="@typeof(MainLayout)"&gt;
Â Â Â Â Â Â &lt;p role="alert"&gt;Sorry, there's nothing at this address.&lt;/p&gt;
Â Â Â Â &lt;/LayoutView&gt;
Â Â &lt;/NotFound&gt;
&lt;/Router&gt;</pre> <p>The <code>MainLayout.razor</code> file defines the basic layout of the page, with a navigation bar on the left, and the main body consuming the remainder of the page, as shown in the following code:</p>
<pre class="source-code">
@inherits LayoutComponentBase
&lt;div class="page"&gt;
Â Â &lt;div class="sidebar"&gt;
Â Â Â Â <strong class="bold">&lt;NavMenu /&gt;</strong>
Â Â &lt;/div&gt;
Â Â &lt;main&gt;
Â Â Â Â &lt;div class="top-row px-4"&gt;
Â Â Â Â Â Â &lt;a href="https://docs.microsoft.com/aspnet/" target="_blank"&gt;About&lt;/a&gt;
Â Â Â Â &lt;/div&gt;
Â Â Â Â &lt;article class="content px-4"&gt;
Â Â Â Â Â Â <strong class="bold">@Body</strong>
Â Â Â Â &lt;/article&gt;
Â Â &lt;/main&gt;
&lt;/div&gt;</pre> <p>The <code>@Body</code> content is provided <a id="_idIndexMarker1212"/>by the <a id="_idIndexMarker1213"/>page that satisfies the route. For the first page, that would be <code>/</code>. If you look at the files in the <code>Pages</code> folder, the <code>Index.razor</code> file has a <code>@page</code> directive with an argument of <code>/</code>. So, by default, that is the page that would be displayed. The <code>@page</code> directive is a Razor construct that allows the route to be satisfied without using a controller. The <code>NavLink</code> entries in the <code>Shared/NavMenu.razor</code> file reference the route using the <code>href</code> attribute. That value is looked up in the list of <code>@page</code> directives to find a match. If no match is found, then the content in the <code>&lt;NotFound&gt;</code> element in the <code>Main.razor</code> file is rendered.</p>
<p>Open the <code>Pages/Counter.razor</code> page to see how a Razor page works:</p>
<pre class="source-code">
@page "/counter"
&lt;h1&gt;Counter&lt;/h1&gt;
&lt;p role="status"&gt;Current count: @currentCount&lt;/p&gt;
&lt;button class="btn btn-primary" @onclick="IncrementCount"&gt;Click me&lt;/button&gt;
@code {
Â Â Â Â private int currentCount = 0;
Â Â Â Â private void IncrementCount()
Â Â Â Â {
Â Â Â Â Â Â currentCount++;
Â Â Â Â }
}</pre> <p>After the <code>@page</code> directive, the page is made up of HTML mixed with some Razor directives. Then, thereâ€™s the <code>@code</code> directive, which contains the C# code for the page. The HTML <code>button</code> element has its click event mapped to the C# <code>IncrementCount</code> method<a id="_idIndexMarker1214"/> using <a id="_idIndexMarker1215"/>the <code>@</code><code>onclick</code> directive.</p>
<p class="callout-heading">Learn more</p>
<p class="callout">To learn more about Razor pages, take a look at the official documentation at <a href="https://learn.microsoft.com/en-us/aspnet/core/blazor/?view=aspnetcore-7.0">https://learn.microsoft.com/en-us/aspnet/core/blazor/?view=aspnetcore-7.0</a>.</p>
<p>Now, letâ€™s start creating the project.</p>
<h3>Preparing the project</h3>
<p>.NET MAUI and Blazor <a id="_idIndexMarker1216"/>integrate seamlessly â€“ so seamlessly that it is sometimes hard to differentiate what is executing where. That makes it very easy to render data in both XAML and HTML.</p>
<p>Letâ€™s get started by preparing the project for the calculator. We will start by removing much of the template code we wonâ€™t be using. Follow these steps to prepare the template:</p>
<ol>
<li>In Visual Studio, using <code>Data</code> folder.</li>
<li>In the <code>Pages</code> folder, delete <code>Index.razor</code>, <code>Counter.Razor</code>, and <code>FetchData.razor</code>.</li>
<li>In the <code>Shared</code> folder, delete <code>NavMenu.razor</code>, <code>NavMenu.razor.css</code>, and <code>SurveyPrompt.razor</code>.</li>
<li>Right-click on the <code>Pages</code> folder, then select <strong class="bold">Add</strong> |<strong class="bold"> Razor Componentâ€¦</strong>, as shown in the <a id="_idIndexMarker1217"/>following screenshot:</li>
</ol>
<div><div><img alt="Figure 11.7 â€“ Adding a new Razor component" src="img/B19214_11_7.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.7 â€“ Adding a new Razor component</p>
<ol>
<li value="5">In the <code>Keypad.razor</code> and click <strong class="bold">Add</strong>:</li>
</ol>
<div><div><img alt="Figure 11.8 â€“ Razor ï»¿component" src="img/B19214_11_8.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.8 â€“ Razor component</p>
<ol>
<li value="6">In the<a id="_idIndexMarker1218"/> new <code>Keypad.razor</code> file, add the following highlighted lines:<pre class="source-code">
<strong class="bold">@page "/"</strong>
&lt;h3&gt;Keypad&lt;/h3&gt;
<strong class="bold">&lt;div&gt;Keypad goes here&lt;/div&gt;</strong>
@code {
}</pre></li> <li>Open the <code>MainLayout.razor</code> file in the <code>Shared</code> folder and remove the following highlighted sections:<pre class="source-code">
@inherits LayoutComponentBase
&lt;div class="page"&gt;
<strong class="bold">Â Â Â Â &lt;div class="sidebar"&gt;</strong>
<strong class="bold">Â Â Â Â Â Â &lt;NavMenu /&gt;</strong>
<strong class="bold">Â Â Â Â &lt;/div&gt;</strong>
Â Â Â Â &lt;main&gt;
<strong class="bold">Â Â Â Â Â Â &lt;div class="top-row px-4"&gt;</strong>
<strong class="bold">Â Â Â Â Â Â Â Â &lt;a href="https://docs.microsoft.com/aspnet/" target="_blank"&gt;About&lt;/a&gt;</strong>
<strong class="bold">Â Â Â Â Â Â &lt;/div&gt;</strong>
Â Â Â Â Â Â &lt;article class="content px-4"&gt;
Â Â Â Â Â Â Â Â @Body
Â Â Â Â Â Â &lt;/article&gt;
Â Â Â Â &lt;/main&gt;
&lt;/div&gt;</pre></li> <li>Open <code>MauiProgram.cs</code> and <a id="_idIndexMarker1219"/>remove the highlighted lines of code:<pre class="source-code">
<strong class="bold">using Calculator.Data;</strong>
using Microsoft.Extensions.Logging;
namespace Calculator
{
Â Â Â Â public static class MauiProgram
Â Â Â Â {
Â Â Â Â Â Â public static MauiApp CreateMauiApp()
Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â var builder = MauiApp.CreateBuilder();
Â Â Â Â Â Â Â Â builder
Â Â Â Â Â Â Â Â Â Â .UseMauiApp&lt;App&gt;()
Â Â Â Â Â Â Â Â Â Â .ConfigureFonts(fonts =&gt;
Â Â Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â fonts.AddFont("OpenSans-Regular.ttf", "OpenSansRegular");
Â Â Â Â Â Â Â Â Â Â });
Â Â Â Â Â Â Â Â builder.Services.AddMauiBlazorWebView();
#if DEBUG
Â Â Â Â Â Â builder.Services.AddBlazorWebViewDeveloperTools();
Â Â Â Â Â Â builder.Logging.AddDebug();
#endif
<strong class="bold">Â Â Â Â Â Â builder.Services.AddSingleton&lt;WeatherForecastService&gt;();</strong>
Â Â Â Â Â Â return builder.Build();
Â Â Â Â Â Â }
Â Â Â Â }
}</pre></li> <li>Now, run the <a id="_idIndexMarker1220"/>project to see the effects of the changes, as shown in <em class="italic">Figure 11</em><em class="italic">.9</em>:</li>
</ol>
<div><div><img alt="Figure 11.9 â€“ Running the blank calculator app on Windows" src="img/B19214_11_9.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.9 â€“ Running the blank calculator app on Windows</p>
<p>Now that the <a id="_idIndexMarker1221"/>project is ready to be an app, letâ€™s start with the Keypad view.</p>
<h2 id="_idParaDest-182"><a id="_idTextAnchor910"/>Creating the Keypad view</h2>
<p>The Keypad view is the <a id="_idIndexMarker1222"/>basic functionality of the calculator. It has buttons for each digit, 0 through 9, the decimal separator, <em class="italic">.</em>, clear, <em class="italic">C</em>, clear everything, <em class="italic">CE</em>, and, finally, addition, <em class="italic">+</em>, subtraction, <em class="italic">-</em>, multiplication, <em class="italic">x</em>, division, <em class="italic">/</em>, <em class="italic">=</em> to get the result, and <em class="italic">&lt;</em> to erase the last character. The view has three basic components to it â€“ HTML and CSS for styling and the C# code. Each of the following sections will guide you through adding each of these components for the view, starting with the HTML.</p>
<h3>Adding the HTML</h3>
<p>Razor files and .NET MAUI XAML<a id="_idIndexMarker1223"/> files do not have a <a id="_idIndexMarker1224"/>designer for you to visualize your changes. You have to run your app to see the changes you have made, which usually involves building, deploying, and then navigating to the view in your app. .NET has a time-saving feature called Hot Reload. It works by applying the changes you make to your Razor, XAML, CSS, and C# files to the running application without you having to stop and restart the app. Try <a id="_idIndexMarker1225"/>using <strong class="bold">Hot Reload</strong> while you go through the next set of steps. To apply the changes, use the <strong class="bold">Hot Reload</strong> button in the <strong class="bold">Debug</strong> toolbar. Itâ€™s easy to find â€“ itâ€™s the flames icon:</p>
<div><div><img alt="Figure 11.10 â€“ The Hot Reload toolbar button" src="img/B19214_11_10.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.10 â€“ The Hot Reload toolbar button</p>
<p>If at any point you receive a â€œRude Editâ€ dialog like the following, it just means that the change cannot <a id="_idIndexMarker1226"/>be <a id="_idIndexMarker1227"/>applied by Hot Reload, so you need to stop, rebuild, and restart debugging:</p>
<div><div><img alt="Figure 11.11 â€“ Hot Reload ï»¿dialog" src="img/B19214_11_11.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.11 â€“ Hot Reload dialog</p>
<p>Hot Reload is constantly getting better, so there will be fewer and fewer of these cases in the future.</p>
<p>To add the HTML that will provide you with the UI to interact with the keypad, follow these steps:</p>
<ol>
<li>Start the app by using the debugger or pressing <em class="italic">F5</em>.</li>
<li>If you want to see your app in Visual Studio, you can open the <strong class="bold">XAML Live Preview</strong> pane. To open the <strong class="bold">XAML Live Preview</strong> pane, use the Visual Studio menu and select <strong class="bold">Debug</strong> | <strong class="bold">Windows</strong> | <strong class="bold">XAML Live Preview</strong>. I usually pin it open so that it is always available.</li>
<li>Open the <code>Keypad.razor</code> file in the <code>Pages</code> folder.</li>
<li>Remove the <a id="_idIndexMarker1228"/>highlighted content<a id="_idIndexMarker1229"/> shown in the following code block:<pre class="source-code">
@page "/"
<strong class="bold">&lt;h3&gt;Keypad&lt;/h3&gt;</strong>
<strong class="bold">&lt;div&gt;Keypad goes here&lt;/div&gt;</strong>
@code {
}</pre></li> <li>Add the following HTML after <code>@page</code> but before the <code>@</code><code>code</code> directive:<pre class="source-code">
&lt;div class="keypad"&gt;
Â Â &lt;div class="keypad-body"&gt;
Â Â Â Â &lt;div class="keypad-screen"&gt;
Â Â Â Â Â Â &lt;div class="keypad-typed"&gt;&lt;/div&gt;
Â Â Â Â &lt;/div&gt;
Â Â Â Â &lt;div class="keypad-row"&gt;
Â Â Â Â Â Â &lt;div class="keypad-button wide command"&gt;C&lt;/div&gt;
Â Â Â Â Â Â &lt;div class="keypad-button command"&gt;CE&lt;/div&gt;
Â Â Â Â Â Â &lt;div class="keypad-button operator"&gt;/&lt;/div&gt;
Â Â Â Â &lt;/div&gt;
Â Â Â Â &lt;div class="keypad-row"&gt;
Â Â Â Â Â Â &lt;div class="keypad-button"&gt;7&lt;/div&gt;
Â Â Â Â Â Â &lt;div class="keypad-button"&gt;8&lt;/div&gt;
Â Â Â Â Â Â &lt;div class="keypad-button"&gt;9&lt;/div&gt;
Â Â Â Â Â Â &lt;div class="keypad-button operator"&gt;X&lt;/div&gt;
Â Â Â Â &lt;/div&gt;
Â Â Â Â &lt;div class="keypad-row"&gt;
Â Â Â Â Â Â &lt;div class="keypad-button"&gt;4&lt;/div&gt;
Â Â Â Â Â Â &lt;div class="keypad-button"&gt;5&lt;/div&gt;
Â Â Â Â Â Â &lt;div class="keypad-button"&gt;6&lt;/div&gt;
Â Â Â Â Â Â &lt;div class="keypad-button operator"&gt;âˆ’&lt;/div&gt;
Â Â Â Â &lt;/div&gt;
Â Â Â Â &lt;div class="keypad-row"&gt;
Â Â Â Â Â Â &lt;div class="keypad-button"&gt;1&lt;/div&gt;
Â Â Â Â Â Â &lt;div class="keypad-button"&gt;2&lt;/div&gt;
Â Â Â Â Â Â &lt;div class="keypad-button"&gt;3&lt;/div&gt;
Â Â Â Â Â Â &lt;div class="keypad-button operator"&gt;+&lt;/div&gt;
Â Â Â Â &lt;/div&gt;
Â Â Â Â &lt;div class="keypad-row"&gt;
Â Â Â Â Â Â &lt;div class="keypad-button"&gt;.&lt;/div&gt;
Â Â Â Â Â Â &lt;div class="keypad-button"&gt;0&lt;/div&gt;
Â Â Â Â Â Â &lt;div class="keypad-button"&gt;&amp;lt;&lt;/div&gt;
Â Â Â Â Â Â &lt;div class="keypad-button operator"&gt;=&lt;/div&gt;
Â Â Â Â &lt;/div&gt;
Â Â &lt;/div&gt;
&lt;/div&gt;</pre><p class="list-inset">Donâ€™t forget to press the <code>div</code> and not <code>table</code> since it is easier to style <code>div</code> elements than <code>table</code> elements. The keypad is arranged in rows of four buttons, except for the top two rows. The top row is the display where the expression or result is shown. The second row only has three buttons. The class names have already been added to the HTML elements, but since they donâ€™t exist yet, they <a id="_idIndexMarker1230"/>donâ€™t <a id="_idIndexMarker1231"/>alter the appearance.</p></li> </ol>
<p>The keypad doesnâ€™t quite look like a keypad yet, but it will once we add some style to it.</p>
<h3>Adding style to the HTML</h3>
<p>CSS has been<a id="_idIndexMarker1232"/> around for a very long time <a id="_idIndexMarker1233"/>and is the best way to make your HTML look its best. Follow these steps to add the styles we used in the previous section:</p>
<ol>
<li>Make sure your app is still running and use <code>Keypad.razor.css</code> in the <code>Pages</code> folder. Click the <strong class="bold">Show All Templates</strong> button if Visual Studio doesnâ€™t display them by default:</li>
</ol>
<div><div><img alt="Figure 11.12 â€“ Adding a new CSS file" src="img/B19214_11_12.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.12 â€“ Adding a new CSS file</p>
<p class="list-inset">If you<a id="_idIndexMarker1234"/> look<a id="_idIndexMarker1235"/> in <code>Pages</code> folder, you will notice that your new file <a id="_idTextAnchor911"/>is now under the <code>Keypad.razor</code> file:</p>
<div><div><img alt=" Figure 11.13 â€“ A Razor page with an isolated CSS file" src="img/B19214_11_13.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"> Figure 11.13 â€“ A Razor page with an isolated CSS file</p>
<p class="list-inset">Visual Studio automatically recognized that you wanted to add an <code>Keypad.razor</code> file.</p>
<ol>
<li value="2">Add the <code>keypad</code> style to the <code>Keypad.razor.css</code> file:<pre class="source-code">
.keypad {
Â Â Â Â width: 300px;
Â Â Â Â margin: auto;
Â Â Â Â margin-top: -1.1em;
}</pre><p class="list-inset">This style will set the width of the element to <code>300px</code>, with automatic margins, except for the top, which is at <code>-1.1em</code>. <code>-1.1em</code> moves the top edge of the keypad right <a id="_idIndexMarker1236"/>up against the top of <a id="_idIndexMarker1237"/>the web view control.</p></li> <li>Now, add the <code>keypad-body</code> style using the following code:<pre class="source-code">
.keypad-body {
Â Â Â Â border: solid 1px #3A4655;
}</pre><p class="list-inset">This style just gives the entire element a border one pixel wide in a dark gray color.</p></li> <li>We will save the <code>keypad-screen</code> and <code>keypad-typed</code> styles for last, so add the <code>keypad-row</code> style shown in the following code:<pre class="source-code">
.keypad-row {
Â Â Â Â width: 100%;
Â Â Â Â background: #3C4857;
}</pre><p class="list-inset">This style sets the element width to 100% of its parent, which would be <code>keypad-body</code>, and sets the background to a pleasing dark gray color.</p></li> <li>The next style to add is <code>keypad-button</code>. Use the following code to add the style:<pre class="source-code">
.keypad-button {
Â Â Â Â width: 25%;
Â Â Â Â background: #425062;
Â Â Â Â color: #fff;
Â Â Â Â padding: 20px;
Â Â Â Â display: inline-block;
Â Â Â Â font-size: 25px;
Â Â Â Â text-align: center;
Â Â Â Â vertical-align: middle;
Â Â Â Â margin-right: -4px;
Â Â Â Â border-right: solid 2px #3C4857;
Â Â Â Â border-bottom: solid 2px #3C4857;
Â Â Â Â transition: all 0.2s ease-in-out;
}</pre><p class="list-inset">This style is the base<a id="_idIndexMarker1238"/> for all the buttons<a id="_idIndexMarker1239"/> on the keypad, hence it has the most attributes. Elements that have this style applied have a border on the right and bottom that is 2 pixels wide and uses the same color as the background of the row. The <code>background</code> attribute of the button is a bit darker than the border color, which provides a bit of depth. The text is aligned in the center both vertically and horizontally and uses a 25-pixel font size. The width is set to 25% since there are four buttons in a row, mostly. The <code>transition</code> attribute imposes a 200-millisecond transition using <code>ease-in-out</code>, which accelerates from the start to the middle and then decelerates from the middle to the end. <code>transition</code> is applied to all attributes, so any time an attribute of this style changes, it will slowly change from the starting value to the end value.</p></li> <li>If the button is an action button, such as an operator, then an additional style is applied, called <code>operator</code>. The definition of this style is slightly different from the rest of the styles that have been created so far. Instead of just being named <code>operator</code>, this style is named <code>keypad-button.operator</code>. In CSS, <code>.</code> is a selector; it is used to locate which attributes to apply. In this case, we want all elements that have both the <code>keypad-button</code> class and the <code>operator</code> class applied. To add the <code>keypad-button.operator</code> class, use the following code:<pre class="source-code">
.keypad-button.operator {
Â Â Â Â color: #AEB3BA;
Â Â Â Â background: #404D5E;
}</pre><p class="list-inset">These buttons will<a id="_idIndexMarker1240"/> appear with a slightly <a id="_idIndexMarker1241"/>darker background with slightly less white text.</p></li> <li>The clear (<em class="italic">C</em>) and clear everything (<em class="italic">CE</em>) buttons also have their own class, as follows:<pre class="source-code">
.keypad-button.command {
Â Â Â Â color: #D95D4E;
Â Â Â Â background: #404D5E;
}</pre><p class="list-inset">These buttons will appear with slightly darker backgrounds with red text.</p></li> <li>Now, for the desktop, we can add hover highlighting by using the <code>:hover</code> pseudo selector. Add the hover styles using the following code:<pre class="source-code">
.keypad-button:hover {
Â Â Â Â background: #E0B612;
}
.keypad-button.command:hover,
.keypad-button.operator:hover {
Â Â Â Â background: #E0B612;
Â Â Â Â color: #fff;
}</pre><p class="list-inset">The background is altered to an orange color. The change isnâ€™t immediate due to the <code>transition</code> attribute on the <code>keypad-button</code> style, so it will transition from dark gray to orange in two-tenths of a second.</p></li> <li>The last button-related style is wide, or <code>keypad-button.wide</code>. This style makes the button twice as wide as a normal button. To add this style, use the following code:<pre class="source-code">
.keypad-button.wide {
Â Â Â Â width: 50%;
}</pre></li> <li>The final two<a id="_idIndexMarker1242"/> styles, <code>keypad-screen</code> and <code>keypad-typed</code>, are <a id="_idIndexMarker1243"/>for displaying the expression and the result. Use the following code to add the remaining two styles:<pre class="source-code">
.keypad-screen {
Â Â Â Â background: #3A4655;
Â Â Â Â width: 100%;
Â Â Â Â height: 75px;
Â Â Â Â padding: 20px;
}
.keypad-typed {
Â Â Â Â font-size: 45px;
Â Â Â Â text-align: right;
Â Â Â Â color: #fff;
}</pre></li> </ol>
<p>Now, the keypad looks like a real calculator keypad; refer to <em class="italic">Figure 11</em><em class="italic">.14</em> for an example. Were you able to keep adding styles and seeing the changes in your app without having to restart? Remember to click the <strong class="bold">Hot Reload</strong> button or set the <strong class="bold">Hot Reload on File Save</strong> option under the <strong class="bold">Hot Reload</strong> button menu; Visual Studio will attempt to apply the changes as soon as you save the file. Next, we will add the code to enable <a id="_idIndexMarker1244"/>the <a id="_idIndexMarker1245"/>buttons to work:</p>
<div><div><img alt="Figure 11.14 â€“ HTML keypad with style" src="img/B19214_11_14.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.14 â€“ HTML keypad with style</p>
<h3>Wiring up the controls</h3>
<p>In most web pages, you<a id="_idIndexMarker1246"/> would use <code>Keypad.razor</code> file, follow these steps:</p>
<ol>
<li>Within the <code>@code</code> directive block, add the following:<pre class="source-code">
string inputDisplay = string.Empty;
bool clearInputBeforeAppend = false;</pre><p class="list-inset">This declares a field named <code>inputDisplay</code> as a <code>string</code> element and initializes it to the empty string. It also declares a <code>bool</code> element and initializes it to <code>false</code>. <code>clearInputBeforeAppend</code> is a flag to keep <code>inputDisplay</code> clean. After a result is displayed, when the user taps a button, <code>inputDisplay</code> should be cleared before the character is added to the screen.</p></li> <li>Update the element with the <code>keypad-typed</code> class, as in the following code:<pre class="source-code">
&lt;div class="keypad-typed"&gt;@inputDisplay&lt;/div&gt;</pre><p class="list-inset">This will render the contents of the <code>inputDisplay</code> variable into the <code>div</code> element. Note the use of <code>@</code> to reference the C# field.</p></li> <li>To help with <a id="_idIndexMarker1248"/>validating the input, add the following:<pre class="source-code">
readonly char[] symbols = { '/', 'X', '+', '-', '.' };</pre></li> <li>When any of the numbers (0 through 9) or the operator buttons are tapped, <code>inputDisplay</code> will be updated by appending a character to the display. Add the <code>AppendInput</code> method using the following code:<pre class="source-code">
void AppendInput(string inputValue)
{
Â Â Â Â double numValue;
Â Â Â Â if (clearInputBeforeAppend)
Â Â Â Â {
Â Â Â Â Â Â Â Â inputDisplay = string.Empty;
Â Â Â Â }
Â Â Â Â if (string.IsNullOrEmpty(inputDisplay) &amp;&amp; inputValue.IndexOfAny(symbols) != -1)
Â Â Â Â {
Â Â Â Â Â Â Â Â return;
Â Â Â Â }
Â Â Â Â if (!double.TryParse(inputValue, out numValue) &amp;&amp; !string.IsNullOrEmpty(inputDisplay) &amp;&amp; $"{inputDisplay[^1]}".IndexOfAny(symbols) != -1)
Â Â Â Â {
Â Â Â Â Â Â Â Â return;
Â Â Â Â }
Â Â Â Â if (inputDisplay.Trim() == "0" &amp;&amp; inputValue == "0")
Â Â Â Â {
Â Â Â Â Â Â Â Â return;
Â Â Â Â }
Â Â Â Â clearInputBeforeAppend = false;
Â Â Â Â inputDisplay += inputValue;
}</pre><p class="list-inset">Letâ€™s review the<a id="_idIndexMarker1249"/> code. The first check is to see whether <code>inputDisplay</code> needs to be cleared; if so, itâ€™s cleared. Then, a check for operators is made. The next check is more complex as it doesnâ€™t allow multiple operators in a row. This check uses the <code>Range</code> syntax of <code>^1</code> to indicate the last character. String interpolation is used to convert the last character back into a string, so <code>IndexOfAny</code> can be used to find that character in the array of symbols. Multiple leading 0s are checked and rejected if found. If all the checks pass, the input is appended to <code>inputDisplay</code>, and the <code>clearInputBeforeAppend</code> flag is reset to <code>false</code>.</p></li> <li>When the user presses the <code>Undo</code> method using the following code:<pre class="source-code">
void Undo()
{
Â Â Â Â if (!clearInputBeforeAppend &amp;&amp; inputDisplay.Length &gt; 0)
Â Â Â Â {
Â Â Â Â Â Â Â Â inputDisplay = inputDisplay[0..^1];
Â Â Â Â Â Â Â Â return;
Â Â Â Â }
}</pre><p class="list-inset">This method uses the <code>Range</code> syntax again, and the capability of strings being able to be indexed as arrays. It uses the array syntax to get the elements from index 0 to the next to last index and returns it.</p></li> <li>When the user presses the <code>ClearInput</code> method<a id="_idIndexMarker1250"/> using the following code:<pre class="source-code">
void ClearInput()
{
Â Â Â Â inputDisplay = string.Empty;
}</pre></li> <li>When the user presses the <code>ClearAll</code> method:<pre class="source-code">
void ClearAll()
{
Â Â Â Â ClearInput();
}</pre></li> <li>Finally, the <code>EvaluateExpression</code> method:<pre class="source-code">
void EvaluateExpression()
{
Â Â Â Â var expression = inputDisplay;
Â Â Â Â clearInputBeforeAppend = true;
}</pre><p class="list-inset">This method doesnâ€™t evaluate the expression thatâ€™s entered yet; that will happen in the <em class="italic">Creating the Compute </em><em class="italic">service</em> section.</p></li> </ol>
<p>The next step in the <code>Keypad.razor</code> file is to hook the methods that were just defined so that they are called when the user taps or clicks on that element. Like in standard HTML, events are hooked up via attributes on the element that reference code, either inline or methods. The attributes in Razor pages use a page directive with the event name. For example, the DOM event for handling taps or clicks is <code>click</code>, so the Razor event name would be <code>@onclick</code>. That attribute is then assigned to a delegate, which could be any method. The full attribute might look like <code>@onclick="DoSomething"</code>, where <code>DoSomething</code> is a C# method defined in the pageâ€™s <code>@</code><code>code</code> directive.</p>
<p>The <code>AppendInput</code> method accepts a single string argument, so the delegate cannot be just <code>AppendInput</code> â€“ it has to be wrapped in an expression so that the parameter can be passed along. Expressions <a id="_idIndexMarker1251"/>in Razor pages are contained in the <code>@(â€¦)</code> directive. All calls to <code>AppendInput</code> from an event directive would look like <code>@onclick="@(AppendInput("0"))"</code>.</p>
<p>Use the highlighted lines in the following code to update the HTML in the <code>Keypad.razor</code> file:</p>
<pre class="source-code">
&lt;div class="keypad"&gt;
Â Â Â Â &lt;div class="keypad-body"&gt;
Â Â Â Â Â Â Â Â &lt;div class="keypad-screen"&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;div class="keypad-typed"&gt;@inputDisplay&lt;/div&gt;
Â Â Â Â Â Â Â Â &lt;/div&gt;
Â Â Â Â Â Â Â Â &lt;div class="keypad-row"&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;div class="keypad-button wide command" <strong class="bold">@onclick="ClearInput"</strong>&gt;C&lt;/div&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;div class="keypad-button command" <strong class="bold">@onclick="ClearAll"</strong>&gt;CE&lt;/div&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;div class="keypad-button operator" <strong class="bold">@onclick="@(()=&gt;AppendInput("/"))"</strong>&gt;/&lt;/div&gt;
Â Â Â Â Â Â Â Â &lt;/div&gt;
Â Â Â Â Â Â Â Â &lt;div class="keypad-row"&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;div class="keypad-button" <strong class="bold">@onclick="@(()=&gt;AppendInput("7"))"</strong>&gt;7&lt;/div&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;div class="keypad-button" <strong class="bold">@onclick="@(()=&gt;AppendInput("8"))"</strong>&gt;8&lt;/div&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;div class="keypad-button" <strong class="bold">@onclick="@(()=&gt;AppendInput("9"))"</strong>&gt;9&lt;/div&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;div class="keypad-button operator" <strong class="bold">@onclick="@(()=&gt;AppendInput("X"))"</strong>&gt;X&lt;/div&gt;
Â Â Â Â Â Â Â Â &lt;/div&gt;
Â Â Â Â Â Â Â Â &lt;div class="keypad-row"&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;div class="keypad-button" <strong class="bold">@onclick="@(()=&gt;AppendInput("4"))"</strong>&gt;4&lt;/div&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;div class="keypad-button" <strong class="bold">@onclick="@(()=&gt;AppendInput("5"))"</strong>&gt;5&lt;/div&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;div class="keypad-button" <strong class="bold">@onclick="@(()=&gt;AppendInput("6"))"</strong>&gt;6&lt;/div&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;div class="keypad-button operator" <strong class="bold">@onclick="@(()=&gt;AppendInput("-"))"</strong>&gt;âˆ’&lt;/div&gt;
Â Â Â Â Â Â Â Â &lt;/div&gt;
Â Â Â Â Â Â Â Â &lt;div class="keypad-row"&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;div class="keypad-button" <strong class="bold">@onclick="@(()=&gt;AppendInput("1"))"</strong>&gt;1&lt;/div&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;div class="keypad-button" <strong class="bold">@onclick="@(()=&gt;AppendInput("2"))"</strong>&gt;2&lt;/div&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;div class="keypad-button" <strong class="bold">@onclick="@(()=&gt;AppendInput("3"))"</strong>&gt;3&lt;/div&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;div class="keypad-button operator" <strong class="bold">@onclick="@(()=&gt;AppendInput("+"))"</strong>&gt;+&lt;/div&gt;
Â Â Â Â Â Â Â Â &lt;/div&gt;
Â Â Â Â Â Â Â Â &lt;div class="keypad-row"&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;div class="keypad-button" <strong class="bold">@onclick="@(()=&gt;AppendInput("."))"</strong>&gt;.&lt;/div&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;div class="keypad-button" <strong class="bold">@onclick="@(()=&gt;AppendInput("0"))"</strong>&gt;0&lt;/div&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;div class="keypad-button" <strong class="bold">@onclick="Undo"</strong>&gt;&amp;lt;&lt;/div&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;div class="keypad-button operator" <strong class="bold">@onclick="EvaluateExpression"</strong>&gt;=&lt;/div&gt;
Â Â Â Â Â Â Â Â &lt;/div&gt;
Â Â Â Â &lt;/div&gt;
&lt;/div&gt;</pre> <p class="callout-heading">More about Razor event handling</p>
<p class="callout">To learn more about Razor event handling, visit https://learn.microsoft.com/en-us/aspnet/core/blazor/components/event-handling?view=aspnetcore-7.0.</p>
<p>The keypad is nearly complete. At this point, you should be able to enter a full expression to <a id="_idIndexMarker1252"/>evaluate and then clear the display. In the next section, you will create a service to evaluate the expression.</p>
<h2 id="_idParaDest-183"><a id="_idTextAnchor912"/>Creating the Compute service</h2>
<p>The <code>Compute</code> service <a id="_idIndexMarker1253"/>evaluates the expression and<a id="_idIndexMarker1254"/> returns the result. To illustrate how .NET MAUI and the Blazor application can interact with one another, this service will be injected from the .NET MAUI dependency injection container into the Blazor page. To implement the <code>Compute</code> service, follow these steps:</p>
<ol>
<li>Create a new folder in the root of the project named <code>Services</code>.</li>
<li>In the <code>Services</code> folder, add a new C# class file named <code>Compute</code>.</li>
<li>Modify the <code>Compute.cs</code> file so that it matches the following code:<pre class="source-code">
namespace Calculator.Services;
internal class Compute
{
Â Â Â Â public string Evaluate(string expression)
Â Â Â Â {
Â Â Â Â Â Â Â Â System.Data.DataTable dataTable = new System.Data.DataTable();
Â Â Â Â Â Â Â Â var finalResult = dataTable.Compute(expression, string.Empty);
Â Â Â Â Â Â Â Â return finalResult.ToString();
Â Â Â Â }
}</pre><p class="list-inset">This code might be shorter than you expected. Instead of writing a lot of code to parse the<a id="_idIndexMarker1255"/> expression and build an expression tree to evaluate, there is already a built-in way of evaluating simple expressions: <code>DataTable</code>. The <code>DataTable.Compute</code> method can evaluate all the expressions that can be built from the calculator.</p></li> <li>Open the <code>MauiProgram.cs</code> file and add the following highlighted line of code to register the class with dependency injection:<pre class="source-code">
#if DEBUG
Â Â Â Â builder.Services.AddBlazorWebViewDeveloperTools();
Â Â Â Â builder.Logging.AddDebug();
#endif
Â Â Â Â <strong class="bold">builder.Services.AddSingleton&lt;Compute&gt;();</strong>
Â Â Â Â return builder.Build();</pre></li> <li>To allow the <code>Keypad.razor</code> page to use the <code>Compute</code> type, it needs to be declared with Razor. Open the <code>_Imports.razor</code> file and add the following highlighted line of code to the end of the file:<pre class="source-code">
@using Calculator.Services</pre><p class="list-inset">Without this line, you could still use the type, but you would have to fully qualify it as <code>Calculator.Services.Compute</code>. This is the Razor equivalent of <code>global</code> <code>using</code> directives in C# files.</p></li> <li>Now, open the <code>Keypad.razor</code> file and add the following line of code after the <code>@</code><code>page</code> directive:<pre class="source-code">
@inject Compute compute</pre><p class="list-inset">The <code>@inject</code> directive will use the .NET MAUI dependency injection container to resolve the<a id="_idIndexMarker1256"/> type provided as the first parameter<a id="_idIndexMarker1257"/> and assign it to the variable defined in the second parameter.</p></li> <li>In the <code>EvaluateExpression</code> method, the <code>compute</code> variable can be used to evaluate the expression contained in <code>inputDisplay</code>, as shown in the following highlighted code:<pre class="source-code">
void EvaluateExpression()
{
Â Â Â Â var expression = inputDisplay;
<strong class="bold">Â Â Â Â var result = compute.Evaluate(inputDisplay.Replace('X', '*'));</strong>
<strong class="bold">Â Â Â Â inputDisplay = result;</strong>
Â Â Â Â clearInputBeforeAppend = true;
}</pre><p class="list-inset">Here, the <code>Evaluate</code> method is called with <code>inputDisplay</code> as the parameter. <code>inputDisplay</code> is first modified to replace all the <code>X</code> values in the string with <code>*</code> as that is what the <code>DataTable</code> expects for multiplication. The result is then assigned to <code>inputDisplay</code>.</p></li> </ol>
<p>At this point, the calculator app can accept input of a combination of numbers and operators and evaluate the result, displaying it to the user. The user can also clear out the display. In the<a id="_idIndexMarker1258"/> next section, we will explore more <a id="_idIndexMarker1259"/>interoperability by giving the calculator memory.</p>
<h2 id="_idParaDest-184"><a id="_idTextAnchor913"/>Adding memory functions</h2>
<p>Most calculators <a id="_idIndexMarker1260"/>can store previous calculations. In this <a id="_idIndexMarker1261"/>section, you will add a list of previous calculations to the calculator app and recall previous calculations to the <code>inputDisplay</code> parameter of the keypad.</p>
<p>The code will use .NET MAUI controls to render right next to <code>WebViewControl</code>. A new class, <code>Calculations</code>, will be used to manage the listing.</p>
<p>To add the memory functions to the calculator app, follow these steps:</p>
<ol>
<li>Create a new folder named <code>ViewModels</code>.</li>
<li>Add a new class named <code>Calculations</code> in the <code>ViewModels</code> folder and modify the file so that it matches the following code:<pre class="source-code">
using System.Collections.ObjectModel;
namespace Calculator.ViewModels;
public class Calculations : ObservableCollection&lt;Calculation&gt;
{
}
public class Calculation : Tuple&lt;string, string&gt;
{
Â Â Â Â public Calculation(string expression, string result) : base(expression, result) { }
Â Â Â Â public string Expression =&gt; this.Item1;
Â Â Â Â public string Result =&gt; this.Item2;
}</pre><p class="list-inset">This code adds two classes â€“ <code>Calculations</code>, which is just shorthand for <code>Observable Collection&lt;Calculation&gt;</code>, and <code>Calculation</code>, which is <code>Tuple&lt;string, string&gt;</code> and defines two properties to reference <code>Item1</code> as <code>Expression</code> and <code>Item2</code> as <code>Result</code>.</p></li> <li>Add a reference to the <code>CommunityToolkit.Mvvm</code> NuGet package.</li>
<li>Add a new class named <code>MainPageViewModel</code> to the <code>ViewModels</code> folder and modify<a id="_idIndexMarker1262"/> the file, as shown in the<a id="_idIndexMarker1263"/> following code:<pre class="source-code">
using CommunityToolkit.Mvvm.Input;
using CommunityToolkit.Mvvm.Messaging;
namespace Calculator.ViewModels;
public partial class MainPageViewModel
{
Â Â Â Â IMessenger messenger;
Â Â Â Â public MainPageViewModel(Calculations results, IMessenger messenger)
Â Â Â Â {
Â Â Â Â Â Â Â Â Results = results;
Â Â Â Â Â Â Â Â this.messenger = messenger;
Â Â Â Â }
Â Â Â Â public Calculations Results { get; init; }
Â Â Â Â [RelayCommand]
Â Â Â Â public void Recall(Calculation sender)
Â Â Â Â {
Â Â Â Â Â Â Â Â messenger.Send(sender);
Â Â Â Â }
}</pre><p class="list-inset">The <code>MainViewModel</code> class uses two features of <code>CommunityToolkit</code>: <code>RelayCommand</code> and <code>IMessenger</code>. As in the other chapters, <code>RelayCommand</code> is used to bind methods to XAML actions. <code>IMessenger</code> is an interface for sending messages between parts of your application. It is helpful when you donâ€™t want to take a hard dependency between two classes, especially if it creates a circular reference. <code>CommunityToolkit</code> provides a default implementation of <code>IMessenger</code> called <code>WeakReferenceMessenger</code>.</p></li> <li>Open <code>MauiProgram.cs</code> and <a id="_idIndexMarker1264"/>add the<a id="_idIndexMarker1265"/> following <code>using</code> declarations to the top of the file:<pre class="source-code">
using Calculator.ViewModels;
using CommunityToolkit.Mvvm.Messaging;</pre></li> <li>In the <code>CreateMauiApp</code> method make the following highlighted changes:<pre class="source-code">
builder.Services.AddSingleton&lt;Compute&gt;();
<strong class="bold">builder.Services.AddSingleton&lt;Calculations&gt;();</strong>
<strong class="bold">builder.Services.AddSingleton&lt;MainPage&gt;();</strong>
<strong class="bold">builder.Services.AddSingleton&lt;MainPageViewModel&gt;();</strong>
<strong class="bold">builder.Services.AddSingleton&lt;IMessenger&gt;(WeakReferenceMessenger.Default);</strong>
return builder.Build();</pre><p class="list-inset">This adds <code>MainPage</code>, <code>MainPageViewModel</code>, and the default instance of <code>WeakReferenceMessenger</code> to the dependency injection container. The next few steps will enable <code>MainPage</code> to be initialized via dependency injection.</p></li> <li>Open <code>MainView.xaml.cs</code> and make<a id="_idIndexMarker1266"/> the following highlighted changes:<pre class="source-code">
<strong class="bold">using Calculator.ViewModels;</strong>
namespace Calculator;
public partial class MainPage : ContentPage
{
Â Â Â Â public MainPage(<strong class="bold">MainPageViewModel vm</strong>)
Â Â Â Â {
Â Â Â Â Â Â Â Â InitializeComponent();
Â Â Â Â Â Â Â Â <strong class="bold">BindingContext = vm;</strong>
Â Â Â Â }
}</pre><p class="list-inset">As in other<a id="_idIndexMarker1267"/> chapters, the constructor for the view is updated to accept the view model as a parameter, and it is assigned as <code>BindingContext</code>.</p></li> <li>Open <code>App.xaml.cs</code>, modify the constructor, and add the <code>OnHandlerChanging</code> event handler, as shown in the following code:<pre class="source-code">
public App()
{
Â Â Â Â InitializeComponent();
}
protected override void OnHandlerChanging(HandlerChangingEventArgs args)
{
Â Â Â Â base.OnHandlerChanging(args);
Â Â Â Â MainPage = args.NewHandler.MauiContext.Services.GetService&lt;MainPage&gt;();
}</pre><p class="list-inset">Since a .NET MAUI Blazor app does not use <code>Shell</code> by default, the views cannot be initialized via dependency injection the same way as is done with <code>Shell</code>. Instead, the instance of <code>MainPage</code> is obtained after <code>Handler</code> has been set. The <code>OnHandlerChanging</code> event is used to get the reference to the new <code>Handler</code>, which then provides <code>MauiContext</code> to the dependency injection container.</p></li> <li>Open <code>_Imports.razor</code> and<a id="_idIndexMarker1268"/> add the following<a id="_idIndexMarker1269"/> lines to the end of the file:<pre class="source-code">
@using Calculator.ViewModels
@using CommunityToolkit.Mvvm.Messaging</pre></li> <li>Open <code>Keypad.razor</code> and add the following highlighted lines:<pre class="source-code">
@inject Compute compute
<strong class="bold">@inject Calculations calculations</strong>
<strong class="bold">@inject IMessenger messenger</strong>
&lt;div class="keypad"&gt;</pre><p class="list-inset">This will inject the <code>Calculations</code> instance as <code>calculations</code> and <code>WeakReference</code><strong class="source-inline">
Messenger</strong> as <code>messenger</code> from the .NET MAUI dependency injection container.</p></li> <li>Modify the <code>ClearAll</code> and <code>EvaluateExpression</code> methods and add an <code>OnAfter</code><strong class="source-inline">
RenderAsync</strong> method, as <a id="_idIndexMarker1270"/>shown in the following code:<pre class="source-code">
void ClearAll()
{
Â Â Â Â ClearInput();
Â Â Â Â <strong class="bold">calculations.Clear();</strong>
}
void EvaluateExpression()
{
Â Â Â Â var expression = inputDisplay;
Â Â Â Â var result = compute.Evaluate(inputDisplay.Replace('X', '*'));
Â Â Â Â <strong class="bold">calculations.Add(new(expression, result));</strong>
Â Â Â Â inputDisplay = result;
Â Â Â Â clearInputBeforeAppend = true;
}
<strong class="bold">protected override Task OnAfterRenderAsync(bool firstRender)</strong>
<strong class="bold">{</strong>
<strong class="bold">Â Â Â Â if (firstRender)</strong>
<strong class="bold">Â Â Â Â {</strong>
<strong class="bold">Â Â Â Â Â Â Â Â messenger.Register&lt;Calculation&gt;(this, (sender, er) =&gt;</strong>
<strong class="bold">Â Â Â Â Â Â Â Â {</strong>
<strong class="bold">Â Â Â Â Â Â Â Â Â Â Â Â inputDisplay = er.Expression;</strong>
<strong class="bold">Â Â Â Â Â Â Â Â Â Â Â Â clearInputBeforeAppend = true;</strong>
<strong class="bold">Â Â Â Â Â Â Â Â Â Â Â Â StateHasChanged();</strong>
<strong class="bold">Â Â Â Â Â Â Â Â });</strong>
<strong class="bold">Â Â Â Â }</strong>
<strong class="bold">Â Â Â Â return base.OnAfterRenderAsync(firstRender);</strong>
<code>ClearAll</code> will just clear the collection, and <code>EvaluateExpression</code> will add the new <code>Calulation</code> to the collection. <code>OnAfterRenderAsync</code> is used to <code>register</code> this class to receive messages for any <code>Calculation</code> objects. When a message is received, <code>inputDisplay</code> is set to the <code>Expression</code> value of <code>Calculation</code>, and <code>StateHasChanged</code> is called to force the UI to refresh with the updated value.</p></li> <li>Open the <code>Shared/MainLayout.razor.css</code> file and add the following line to the <code>page</code> class:<pre class="source-code">
background-color: black;</pre><p class="list-inset">This is<a id="_idIndexMarker1271"/> simply for <a id="_idIndexMarker1272"/>aesthetics and makes the areas surrounding the calculator black.</p></li> <li>Open the <code>MainPage.xaml</code> file and modify it so that it matches the following code:<pre class="source-code">
&lt;ContentPage
Â Â Â Â 
Â Â Â Â 
Â Â Â Â 
Â Â Â Â 
Â Â Â Â x:Class="Calculator.MainPage"
Â Â Â Â x:DataType="viewModels:MainPageViewModel"&gt;
Â Â Â Â &lt;Grid BackgroundColor="Black"&gt;
Â Â Â Â Â Â &lt;Grid.RowDefinitions&gt;
Â Â Â Â Â Â Â Â &lt;RowDefinition Height="1*" /&gt;
Â Â Â Â Â Â Â Â &lt;RowDefinition Height="1*" /&gt;
Â Â Â Â Â Â &lt;/Grid.RowDefinitions&gt;
Â Â Â Â Â Â &lt;ScrollView Grid.Row="0" BackgroundColor="Bisque" WidthRequest="400" VerticalScrollBarVisibility="Always"&gt;
Â Â Â Â Â Â Â Â &lt;CollectionView ItemsSource="{Binding Results}" ItemsUpdatingScrollMode="KeepLastItemInView"&gt;
Â Â Â Â Â Â Â Â Â Â &lt;CollectionView.ItemTemplate&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;DataTemplate x:DataType="viewModels:ExpressionResult"&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;SwipeView&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;SwipeView.LeftItems&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;SwipeItems Mode="Execute"&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;SwipeItem
Text="Recall"Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â BackgroundColor="LightPink"Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:MainPageViewModel}}, Path=RecallCommand}"Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â CommandParameter="{Binding}"/&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;/SwipeItems&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;/SwipeView.LeftItems&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;VerticalStackLayout&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;HorizontalStackLayout Padding="10" HorizontalOptions="EndAndExpand"&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;Label Text="{Binding Expression}" FontSize="Large" TextColor="Black" HorizontalTextAlignment="End" HorizontalOptions="EndAndExpand"/&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;Label Text="=" TextColor="Blue" FontSize="Large" HorizontalTextAlignment="End" HorizontalOptions="EndAndExpand"/&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;Label Text="{Binding Result}" FontSize="Large" TextColor="Black" HorizontalTextAlignment="End" HorizontalOptions="EndAndExpand"/&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;/HorizontalStackLayout&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;Line Stroke="LightSlateGray" X2="400" /&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;Line Stroke="Black" X2="400" /&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;/VerticalStackLayout&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;/SwipeView&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;/DataTemplate&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;/CollectionView.ItemTemplate&gt;
Â Â Â Â Â Â Â Â Â Â &lt;/CollectionView&gt;
Â Â Â Â Â Â &lt;/ScrollView&gt;
Â Â Â Â Â Â &lt;BlazorWebView Grid.Row="1" x:Name="blazorWebView" HostPage="wwwroot/index.html" HeightRequest="540"&gt;
Â Â Â Â Â Â Â Â &lt;BlazorWebView.RootComponents&gt;
Â Â Â Â Â Â Â Â Â Â &lt;RootComponent Selector="#app" ComponentType="{x:Type local:Main}" /&gt;
Â Â Â Â Â Â Â Â &lt;/BlazorWebView.RootComponents&gt;
Â Â Â Â Â Â &lt;/BlazorWebView&gt;
Â Â Â Â &lt;/Grid&gt;
&lt;/ContentPage&gt;</pre><p class="list-inset">A <code>Grid</code> element with<a id="_idIndexMarker1273"/> two rows defined is used to <a id="_idIndexMarker1274"/>contain the new display for previous calculations and the original <code>BlazorWebView</code> control. The calculations are rendered using <code>ScrollView</code>, which contains <code>CollectionView</code>. The <code>CollectionView.ItemTemplate</code> property contains <code>DataTemplate</code> for each <code>Calculation</code>. The <code>SwipeView</code> control allows the user to swipe in either the up, down, left, or right direction to expose additional commands. Each direction has an element to define those actions. For <code>Calculation</code> items, when the user swipes right, it exposes a <code>Recall</code> item, which is bound to the <code>Recall</code> command of <code>MainPageViewModel</code>. The display for <code>Calculation</code> uses a combination of horizontal and vertical <code>StackLayout</code> controls to stack <code>Expression</code> on top of <code>Result</code> with <code>=</code>, all aligned to the left.</p></li> </ol>
<p>That completes the<a id="_idIndexMarker1275"/> main functionality of our calculator app. The next section deals with some aesthetics of the main window when running on a desktop such as Windows or macOS.</p>
<h2 id="_idParaDest-185"><a id="_idTextAnchor914"/>Resizing the main window</h2>
<p>The calculator <a id="_idIndexMarker1276"/>app is defined to be a fixed size. Most of the projects in this book have allowed the controls to grow or shrink with changes to the window size. For our calculator app, the main window should be fixed so that it appears in the best way possible. To fix the window size when the app launches, open the <code>App.xaml.cs</code> file and add the following method to the <code>App</code> class:</p>
<pre class="source-code">
protected override Window CreateWindow(IActivationState activationState)
{
Â Â Â Â var window = base.CreateWindow(activationState);
Â Â Â Â if (OperatingSystem.IsWindows() || OperatingSystem.IsMacCatalyst())
Â Â Â Â {
Â Â Â Â Â Â Â Â window.Created += Window_Created;
Â Â Â Â }
Â Â Â Â return window;
}
private async void Window_Created(object sender, EventArgs e)
{
Â Â Â Â const int defaultWidth = 450;
Â Â Â Â const int defaultHeight = 800;
Â Â Â Â var window = (Window)sender;
Â Â Â Â window.Width = defaultWidth;
Â Â Â Â window.Height = defaultHeight;
Â Â Â Â window.X = -defaultWidth;
Â Â Â Â window.Y = -defaultHeight;
Â Â Â Â await window.Dispatcher.DispatchAsync(() =&gt; { });
Â Â Â Â var displayInfo = DeviceDisplay.Current.MainDisplayInfo;
Â Â Â Â window.X = (displayInfo.Width / displayInfo.Density - window.Width) / 2;
Â Â Â Â window.Y = (displayInfo.Height / displayInfo.Density - window.Height) / 2;
Â Â Â Â window.Created -= Window_Created;
}</pre> <p>The <code>CreateWindow</code> method is <a id="_idIndexMarker1277"/>overridden so that the <code>Window.Created</code> event can have a custom handler attached to it if the app is running on Windows or macOS. The work of resizing the window is done in the <code>Window_Created</code> method. It uses the <code>defaultHeight</code> and <code>defaultWidth</code> constants to set the new windowsâ€™ height, width, and location on the screen. The method then waits for all threads to have finished before altering the <code>X</code> and <code>Y</code> properties of the window again, but this time accounting for the screen pixel density. Finally, it detaches<a id="_idIndexMarker1278"/> the event handler</p>
<div><div><img alt="Figure 11.1ï»¿5 â€“ The completed calculator project" src="img/B19214_11_15.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.15 â€“ The completed calculator project</p>
<h1 id="_idParaDest-186"><a id="_idTextAnchor915"/>Summary</h1>
<p>Excellent work! In this chapter, you completed a project that used the .NET MAUI Blazor template. You created a UI using HTML, updated it with C# code, and then implemented a service that was managed by .NET MAUI and injected it into a Razor page. Then, you used <code>CollectionView</code> to display a list of the previous calculations. Within <code>CollectionView</code> <code>ItemTemplate</code>, the <code>SwipeView</code> control was used to recall a previous calculation to the keypad for additional editing and reevaluation.</p>
<p>To extend this project even further, consider the following:</p>
<ul>
<li>Add an additional swipe action to delete a calculation from the collection</li>
<li>Add an additional keypad layout for scientific calculations</li>
</ul>
<p>In the next â€“ and final â€“ chapter, you will discover the world of AI as you build an object recognition app.</p>
</div>
</body></html>