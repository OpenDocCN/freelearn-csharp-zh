<html><head></head><body>
		<div><h1 id="_idParaDest-210"><em class="italic"><a id="_idTextAnchor215"/>Chapter 12</em>: Responsive User Interfaces</h1>
			<p>In this chapter, you will learn to write responsive user interfaces. You will write responsive <strong class="bold">Windows Forms</strong> (<strong class="bold">WinForms</strong>), <strong class="bold">Windows Presentation Foundation</strong> (<strong class="bold">WPF</strong>), ASP.NET, .NET MAUI, and WinUI applications. Using background worker threads, you will see how you can update and work with the <strong class="bold">User Interface</strong> (<strong class="bold">UI</strong>) in real time by running long-running tasks in the background.</p>
			<p>In this chapter, we will be working through the following topics:</p>
			<ul>
				<li><strong class="bold">Building a responsive UI with WinForms</strong>: In this section, you will write a simple WinForms application that remains responsive to user interaction while performing multiple tasks.</li>
				<li><strong class="bold">Building a responsive UI with WPF</strong>: In this section, you will be writing a simple WPF application that remains responsive to user interaction while performing multiple tasks.</li>
				<li><strong class="bold">Building a responsive UI with ASP.NET</strong>: In this section, you will be writing a simple ASP.NET application that remains responsive to user interaction while performing multiple tasks.</li>
				<li><strong class="bold">Building a responsive UI with .NET MAUI</strong>: In this section, you will be writing a simple Xamarin.Forms application that remains responsive to user interaction while performing multiple tasks. You will then migrate the projects from Xamarin.Forms to .NET MAUI by updating the library references.</li>
				<li><strong class="bold">Building a responsive UI with WinUI</strong>: In this section, you will be writing a simple WinUI application that remains responsive to user interaction while performing multiple tasks.</li>
			</ul>
			<p>By working through this chapter, you will gain the skills to do the following:</p>
			<ul>
				<li>Use background worker threads to keep UIs responsive</li>
				<li>Use wait screens to provide updates when users are required to wait</li>
				<li>Use AJAX, WebSockets, SignalR, and gRPC/gRPC-Web to send and receive data and transfer assets</li>
				<li>Write responsive desktop, web, and mobile UIs<p class="callout-heading">Note</p><p class="callout">For clarification, when speaking about responsive UIs in this chapter, we are not talking about the layout of the UI adapting to the device size or screen real estate. Instead, we are focused on making busy UIs responsive to user input instead of blocking the user from working during task execution.</p></li>
			</ul>
			<h1 id="_idParaDest-211"><a id="_idTextAnchor216"/>Technical requirements</h1>
			<ul>
				<li>Visual Studio 2022 or later.</li>
				<li>This chapter source code is available at <a href="https://github.com/PacktPublishing/High-Performance-Programming-in-CSharp-and-.NET/tree/master/CH12">https://github.com/PacktPublishing/High-Performance-Programming-in-CSharp-and-.NET/tree/master/CH12</a>.</li>
			</ul>
			<h1 id="_idParaDest-212"><a id="_idTextAnchor217"/>Building a responsive UI with WinForms</h1>
			<p>In this section, we will be building<a id="_idIndexMarker1123"/> a very simple WinForms application that is <strong class="bold">Dots Per Inch</strong> (<strong class="bold">DPI</strong>)-aware and enables the user to continue<a id="_idIndexMarker1124"/> working during long-running<a id="_idIndexMarker1125"/> operations. The application has a splash screen with a progress bar and an updated label that provides visual feedback to the user that the application is busy loading. Once the loading progress has been completed, the splash screen closes, and the main window is displayed.</p>
			<p>On the main window, there is a label that gets updated every time you click on the increment count button, a paged table that you can navigate through using the buttons provided, and a progress indicator for a long-running task that also has a cancel button.</p>
			<p>While the long-running task is executing, you can move the window around, increment the label by clicking the increment<a id="_idIndexMarker1126"/> count button, and you can page through<a id="_idIndexMarker1127"/> the data. If you choose to, you can also cancel the long-running task.</p>
			<p>When the long-running task is completed, canceled, or encounters an error, the task progress panel is hidden.</p>
			<h2 id="_idParaDest-213"><a id="_idTextAnchor218"/>Enabling DPI awareness and long file path awareness</h2>
			<p>In this section, we will configure<a id="_idIndexMarker1128"/> a WinForms application so that it looks good<a id="_idIndexMarker1129"/> on high-DPI screens<a id="_idIndexMarker1130"/> and normal-DPI large<a id="_idIndexMarker1131"/> screens. We also configure it to be aware of long file paths. Follow these steps:</p>
			<ol>
				<li>Start a new .NET 6 WinForms application and call it <code>CH12_ResponsiveWinForms</code>.</li>
				<li>Add a new <em class="italic">application manifest</em> file.</li>
				<li>Open the <code>app.manifest</code> file and update the <code>compatibility</code> section as follows:<pre>&lt;compatibility xmlns=”urn:schemas-microsoft-
    com:compatibility.v1”&gt;
    &lt;application&gt;
      &lt;supportedOS 
        Id=”{e2011457-1546-43c5-a5fe-008deee3d3f0}” /&gt;
      &lt;supportedOS 
        Id=”{35138b9a-5d96-4fbd-8e2d-a2440225f93a}” /&gt;
      &lt;supportedOS 
        Id=”{4a2f28e3-53b9-4441-ba9c-d69d4a4a6e38}” /&gt;
      &lt;supportedOS 
        Id=”{1f676c76-80e1-4239-95bb-83d0f6d0da78}” /&gt;
      &lt;supportedOS 
        Id=”{8e0f7a12-bfb3-4fe8-b9a5-48fd50a15a9a}” /&gt;
    &lt;/application&gt;
  &lt;/compatibility&gt;</pre></li>
			</ol>
			<p>This XML code enables DPI awareness<a id="_idIndexMarker1132"/> in WinForms applications<a id="_idIndexMarker1133"/> from Windows Vista upward.</p>
			<ol>
				<li value="4">Uncomment<a id="_idIndexMarker1134"/> the following <code>application</code> section:<pre>&lt;application xmlns=”urn:schemas-microsoft-com:asm.v3”&gt;
     &lt;windowsSettings&gt;
          &lt;dpiAware xmlns=””&gt;
             True
         &lt;/dpiAware&gt;
          &lt;longPathAware xmlns=””&gt;
             True
         &lt;/longPathAware&gt;
        &lt;/windowsSettings&gt;
&lt;/application&gt;</pre></li>
			</ol>
			<p>This code informs<a id="_idIndexMarker1135"/> the compiler that the application is aware of long paths and DPI settings. With these settings in place, the application will now scale for different screen DPI settings and will be able to handle long paths that are 256 characters long.</p>
			<p>In the next section, we will add a splash screen with loading progress feedback.</p>
			<h2 id="_idParaDest-214"><a id="_idTextAnchor219"/>Adding a splash screen that updates with loading progress</h2>
			<p>Applications can load very quickly, or they<a id="_idIndexMarker1136"/> can load quite slowly. When they<a id="_idIndexMarker1137"/> are loading, the user is unaware of what the application is doing. You may choose<a id="_idIndexMarker1138"/> to display a splash screen as part of your application branding. If your application loads fast, then you may need to add a delay for a short period such as 3 seconds to enable the user to see the splash screen. Otherwise, all the user may see is a quick screen flicker.</p>
			<p>If the application has some heavy loading operations that take time to process, the user can think there is an issue and that the program has crashed. So, it is good practice to provide a splash screen that provides visual feedback to the user. This way, the user knows that the application is busy processing and has not crashed. When users see such feedback, they are more patient and will wait until the application has loaded.</p>
			<p>In this section, we add a splash screen with visual feedback. The main window simulates several loading operations with a delay to the UI. Then, the splash screen is closed and the main window is displayed. We will now start adding the necessary code:</p>
			<ol>
				<li value="1">Add a new form called <code>SplashScreenForm</code>, and change its <strong class="bold">FormBorderStyle</strong> property to <strong class="bold">None</strong> and its <strong class="bold">StartPosition</strong> property to <strong class="bold">CentreScreen</strong>. Change the <strong class="bold">BackColor</strong> property to <strong class="bold">ActiveCaptionText</strong>.</li>
				<li>Add a <code>LoadingProgressBar</code> to the form and dock it to the bottom of the form.</li>
				<li>Add a label to <code>LoadingProgressLabel</code> and dock it to the bottom of the form so that it appears just above the progress bar. Set the <strong class="bold">Text</strong> property to <strong class="bold">Loading. Please wait…</strong> and <strong class="bold">Font</strong> | <strong class="bold">Size</strong> to <strong class="bold">12</strong>. Change the <strong class="bold">ForeColor</strong> property to <strong class="bold">HighlightWhite</strong>. Set <strong class="bold">Margin</strong> | <strong class="bold">All</strong> and <strong class="bold">Padding</strong> | <strong class="bold">All</strong> to <strong class="bold">8</strong>.</li>
				<li>Add another label to <code>TitleLabel</code> with the <strong class="bold">Text</strong> property set to <strong class="bold">Responsive WinForms Example</strong>, <strong class="bold">ForeColor</strong> set to <strong class="bold">HighlightText</strong>, <strong class="bold">Font</strong> | <strong class="bold">Size</strong> set to <strong class="bold">32</strong>, and <strong class="bold">Location</strong> set to <strong class="bold">29, 126</strong>.</li>
				<li>Rename <code>MainForm</code> and open the form. Double-click on WindowsForm. This will open the code window.</li>
				<li>Add the<a id="_idIndexMarker1139"/> following<a id="_idIndexMarker1140"/> <code>using</code> statements<a id="_idIndexMarker1141"/> to the <code>MainForm</code> class:<pre>using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Threading;
using System.Windows.Forms;</pre></li>
			</ol>
			<p>These <code>using</code> statements provide all that we need for our splash screen’s code to function.</p>
			<ol>
				<li value="7">Add the following member variables to the <code>MainForm</code> class:<pre>private int _clickCounter;
    private int _operationNumber;
        private int _offset = 0;
    private int _pageSize = 10;
    private int _currentPage = 1;</pre></li>
			</ol>
			<p>These member variables will be referenced by the various methods in our <code>MainForm</code> class to provide paging, in-memory data storage, and store the click count and operation number of the operation being processed.</p>
			<ol>
				<li value="8">Update the <code>MainForm_Load</code> method as follows:<pre>private void MainForm_Load(object sender, EventArgs e)
{
    SplashScreenForm splashScreen = new 
        SplashScreenForm();
     splashScreen.Show(this);
    for (int x = 1; x &lt;= 100; x++)
    {
         Thread.Sleep(500);
        splashScreen.UpdateProgress(x, $”Progress 
           Update: Performing load operation {x}
               of 100...”);
         Application.DoEvents();
     }
    splashScreen.Close();
}</pre></li>
			</ol>
			<p>This code creates<a id="_idIndexMarker1142"/> our splash screen<a id="_idIndexMarker1143"/> and then iterates 100 times, simulating<a id="_idIndexMarker1144"/> many loading operations. Each iteration causes the UI thread to sleep for half a second, updates the splash screen progress, and releases the thread so that other threads can do their work by calling <code>Application.DoEvents()</code>.</p>
			<ol>
				<li value="9">Open <strong class="bold">SplashScreenForm</strong> and view its code. Add the following method:<pre>public void UpdateProgress(int value, string message)
{
        LoadingProgressBar.Value = value;
        LoadingProgressLabel.Text = message;
        Invalidate();
}</pre></li>
			</ol>
			<p>This code takes input from the <code>MainForm</code> class and updates the splash screen’s label and progress bar, providing feedback to the user that the application is loading and making progress.</p>
			<p>We have now completed<a id="_idIndexMarker1145"/> the progress bar. If you<a id="_idIndexMarker1146"/> run the code, you will see<a id="_idIndexMarker1147"/> the following splash screen:</p>
			<div><div><img src="img/Figure_12.01_B16617.jpg" alt="Figure 12.1 – The WinForms splash screen&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.1 – The WinForms splash screen</p>
			<p>Now that our splash screen is working, let’s add our label and button that displays an incremental count of button clicks.</p>
			<h2 id="_idParaDest-215"><a id="_idTextAnchor220"/>Adding the increment count button and label</h2>
			<p>To demonstrate non-blocking<a id="_idIndexMarker1148"/> of the UI when a long operation<a id="_idIndexMarker1149"/> is executing, we will have<a id="_idIndexMarker1150"/> a label that is updated <a id="_idIndexMarker1151"/>with text every time a user clicks a button. We will need to perform the following tasks in our code:</p>
			<ol>
				<li value="1">Add a label called <code>ClickCounterLabel</code> to <code>MainForm</code> and dock it to the top. Set its text to an empty string and its text properties to <strong class="bold">Segoe UI</strong> and <strong class="bold">36pt</strong>, with <strong class="bold">TextAlign</strong> set to <strong class="bold">MiddleCenter</strong>.</li>
				<li>Add a button<a id="_idIndexMarker1152"/> called <code>IncrementCountButton</code> to the form<a id="_idIndexMarker1153"/> and dock<a id="_idIndexMarker1154"/> it to the top<a id="_idIndexMarker1155"/> of the form. Set its text to <strong class="bold">&amp;Increment Text</strong>. </li>
				<li><em class="italic">Double-click</em> on the button to generate its click event. Update the code of the click event with the following code:<pre>private void IncrementCountButton_Click(object sender, 
    EventArgs e)
    {
        _clickCounter++;
        ClickCounterLabel.Text = $”You have clicked 
            the button {_clickCounter} times.”;
}</pre></li>
			</ol>
			<p>Each time the user clicks the button, the _<code>clickCounter</code> variable is incremented by one. The <code>ClickCounterLabel</code> text is then updated, informing the user of how many times they have clicked the button.</p>
			<p>The next thing we will be doing is adding a table with paged navigation. We shall be doing that in the following section.</p>
			<h2 id="_idParaDest-216"><a id="_idTextAnchor221"/>Adding a table with paged data</h2>
			<p>In this section, we will be adding<a id="_idIndexMarker1156"/> a table with paged<a id="_idIndexMarker1157"/> navigation. This will demonstrate<a id="_idIndexMarker1158"/> that the user can still interact with the page through data in a WinForms application, even when long operations are running<a id="_idIndexMarker1159"/> in the background. Let’s begin:</p>
			<ol>
				<li value="1">Add <code>DataTable</code>, and set its <strong class="bold">Dock</strong> property to <strong class="bold">Fill</strong>.</li>
				<li>Add <code>DataPagingPanel</code>, with its <strong class="bold">Dock</strong> property set to <strong class="bold">Bottom</strong>.</li>
				<li>Add a button to <code>FirstButton</code>, with the text set to <strong class="bold">|&lt;&lt;</strong>. <em class="italic">Double-click</em> the button<a id="_idIndexMarker1160"/> to generate the click<a id="_idIndexMarker1161"/> event. Then, return to the design window.</li>
				<li>Add a button to <code>PreviousButton</code> with the text set to <strong class="bold">&lt;&lt;</strong>. <em class="italic">Double-click</em> the button to generate the click event. Then, return to the design window.</li>
				<li>Add a textbox called <code>PageTextBox</code> to <strong class="bold">FlowLayoutPanel</strong>.</li>
				<li>Add a button called <code>NextButton</code> to <strong class="bold">FlowLayoutPanel</strong>, with the text set to <strong class="bold">&gt;&gt;</strong>. <em class="italic">Double-click</em> the button to generate its click event. Then, return to the design window.</li>
				<li>Add a button called <code>LastButton</code> to <strong class="bold">FlowLayoutPanel</strong>, with the text set to <strong class="bold">&gt;&gt;|</strong>. <em class="italic">Double-click</em> the button to generate its click event. This time, stay in the code view, as we have completed what we need to do on the UI for this section.</li>
				<li>Add the <code>BuildCollection</code> method:<pre>private void BuildCollection()
{
    _products = new();
    for (int x = 1; x &lt;= 100; x++)
    {
        _products.Add(new Product { Id = x, Name = 
            $”Product {x}” });
}
}</pre></li>
			</ol>
			<p>This method builds a collection of <code>100</code> products.</p>
			<ol>
				<li value="9">Add the call to the <code>BuildCollection</code> method to the <code>MainForm_Load</code> method before the <code>SplashScreenForm</code> instantiation line.</li>
				<li>After the line<a id="_idIndexMarker1162"/> that closes the splash screen, add the following<a id="_idIndexMarker1163"/> two lines of<a id="_idIndexMarker1164"/> code:<pre>DataTable.DataSource = PagedProducts();
PageTextBox.Text = $”Page {_currentPage} of 
    {PageCount()}”;</pre></li>
			</ol>
			<p>This code sets the data source for our <code>PagedProducts</code> method.</p>
			<ol>
				<li value="11">Add the <code>PagedProducts</code> method:<pre>private List&lt;Product&gt; PagedProducts()
    {
        return _products.GetRange(_offset, _pageSize);
}</pre></li>
			</ol>
			<p>This method returns a range from the <code>_products</code> collection. The <code>_offset</code> variable stores the index value that forms the starting point of the returned collection, and the <code>_pageSize</code> variable stores the number of records to be returned for a page.</p>
			<ol>
				<li value="12">Add the <code>PageCount</code> method:<pre>private int PageCount()
    {
     return _products.Count / _pageSize;
}</pre></li>
			</ol>
			<p>This method obtains the number of products contained within the <code>_products</code> collection, divides that number by the <code>_pageSize</code> variable, and then returns the result. The result<a id="_idIndexMarker1165"/> is the number of data pages<a id="_idIndexMarker1166"/> that we can navigate<a id="_idIndexMarker1167"/> through.</p>
			<ol>
				<li value="13">Update the <code>FirstButton_Click</code> method as follows:<pre>private void FirstButton_Click(object sender, 
    EventArgs e)
    {
        if (_currentPage &gt; 1)
        {
            _offset = 0;
            _currentPage = 1;
            PageTextBox.Text = $”Page {_currentPage} 
                of {PageCount()}”;
            DataTable.DataSource = PagedProducts();
     }
}</pre></li>
			</ol>
			<p>This code moves to the first page in the dataset and updates the UI accordingly.</p>
			<ol>
				<li value="14">Update the <code>PreviousButton_Click</code> method with the following code:<pre>    private void PreviousButton_Click(object sender, 
        EventArgs e)
    {
        if (_currentPage &gt; 1)
        {
            _offset -= _pageSize;
            _currentPage--;
            PageTextBox.Text = $”Page {_currentPage} 
                 of {PageCount()}”;
            DataTable.DataSource = PagedProducts();
     }
}</pre></li>
			</ol>
			<p>This code<a id="_idIndexMarker1168"/> moves to the previous<a id="_idIndexMarker1169"/> page in the dataset and updates<a id="_idIndexMarker1170"/> the UI accordingly.</p>
			<ol>
				<li value="15">Add the <code>NextButton_Click</code> method code:<pre>private void NextButton_Click(object sender,
    EventArgs e)
    {
        if (_currentPage &lt; PageCount())
        {
            _offset += _pageSize;
            _currentPage++;
            PageTextBox.Text = $”Page {_currentPage} 
                of {PageCount()}”;
            DataTable.DataSource = PagedProducts();
     }
}</pre></li>
			</ol>
			<p>This code moves to the next page of the dataset and updates the UI accordingly.</p>
			<ol>
				<li value="16">Add the <code>LastButton_Click</code> method code:<pre>private void LastButton_Click(object sender,
    EventArgs e)
    {
        if (_currentPage &lt; PageCount())
        {
            _offset = _products.Count - _pageSize;
            _currentPage = PageCount();
            PageTextBox.Text = $”Page {_currentPage} 
                of {PageCount()}”;
            DataTable.DataSource = PagedProducts();
     }
}</pre></li>
			</ol>
			<p>This method<a id="_idIndexMarker1171"/> moves to the last page<a id="_idIndexMarker1172"/> of the dataset and updates the UI<a id="_idIndexMarker1173"/> accordingly.</p>
			<ol>
				<li value="17">Finally, add the <code>Product</code> class:<pre>internal class Product
{
    public int Id { get; set; }
    public string Name { get; set; }
    public string Description { get; set; } = “It is a 
      long established fact that a reader will be 
        distracted by the readable content of a page 
          when looking at its layout.”;
    public float Price { get; set; } = 9.99F;
    public int Units { get; set; } = 100;
}</pre></li>
			</ol>
			<p>This class is the <code>Product</code> class that our <code>MainForm</code> uses to build its list of products within its <code>BuildCollection</code> method.</p>
			<p>We have now built<a id="_idIndexMarker1174"/> our paged data table, and we have our increment button<a id="_idIndexMarker1175"/> and label in place. The final thing<a id="_idIndexMarker1176"/> to do with our form is to add our long-running task, to show that user interactions are still possible without being blocked by long-running tasks. This will be the topic of our next section. </p>
			<h2 id="_idParaDest-217"><a id="_idTextAnchor222"/>Running long-running tasks in the background</h2>
			<p>In this section, we are going<a id="_idIndexMarker1177"/> to upgrade our UI to show the progress<a id="_idIndexMarker1178"/> of a long-running task that is running in the background. The user will be able to cancel the long-running task at any time. When the task is completed, whatever state it is in, the long-running task update progress controls will be hidden from the user. Let’s start adding the code:</p>
			<ol>
				<li value="1">Add a <code>LongRunningOperationCancelButton</code> and set its text to <code>&amp;Cancel long running operation</code>.</li>
				<li>Add a <code>StatusBar</code>.</li>
				<li>Add a <code>TaskProgressBar</code>.</li>
				<li>Add a <code>StatusLabel</code> and make sure its text property is empty.</li>
				<li>Add a <code>CollectionBuilderBackgroundWorker</code>.</li>
				<li>Add a <code>LongRunningProcessBackgroundWorker</code>.</li>
				<li>In the <code>MainForm</code> class, add the following three lines to the constructor:<pre>LongRunningProcessBackgroundWorker.DoWork += 
    LongRunningProcessBackgroundWorker_DoWork;
LongRunningProcessBackgroundWorker.ProgressChanged += 
    LongRunningProcessBackgroundWorker_ProgressChanged;
LongRunningProcessBackgroundWorker
    .RunWorkerCompleted += LongRunning
        ProcessBackgroundWorker_RunWorkerCompleted;</pre></li>
			</ol>
			<p>This code adds<a id="_idIndexMarker1179"/> the handlers for our <code>BackgroundWorker</code>, which will be responsible for executing<a id="_idIndexMarker1180"/> the long-running task.</p>
			<ol>
				<li value="8">Add the following method call to the last line of the <code>MainForm_Load</code> method before the closing brace: <code>LongRunningProcess();</code>.</li>
				<li>Add the following <code>LongRunningProcess</code> method:<pre>private void LongRunningProcess()
    {    
        if (LongRunningProcessBackgroundWorker.IsBusy 
            != true)
        {                
         LongRunningProcessBackgroundWorker
             .RunWorkerAsync();
     }
    }</pre></li>
			</ol>
			<p>If <code>LongRunningProcessBackgroundWorker</code> is not busy, then the <code>RunWorkerAsync</code> method<a id="_idIndexMarker1181"/> called <code>LongRunningProcessBackground Worker_DoWork</code> is run.</p>
			<ol>
				<li value="10">Add <code>LongRunningProcessBackgroundWorker_DoWork</code> to the<a id="_idIndexMarker1182"/> <code>MainForm</code> class:<pre>private void LongRunningProcessBackgroundWorker_DoWork
    (object sender, DoWorkEventArgs e)
    {
        BackgroundWorker worker = sender as 
            BackgroundWorker;
    for (int i = 1; i &lt;= 100; i++)
        {
            if (worker.CancellationPending == true)
            {
                e.Cancel = true;
                break;
           }
            else
            {
                _operationNumber = i;
                System.Threading.Thread.Sleep(100);
                worker.ReportProgress((i / 100)
                    * 100);
         }
     }
}</pre></li>
			</ol>
			<p>We are casting<a id="_idIndexMarker1183"/> the sender as <code>BackgroundWorker</code> and assigning it to our local worker variable. Then, we iterate 100 times. Each time<a id="_idIndexMarker1184"/> we iterate, we set the <code>_operationNumber</code> variable to the loop count variable value, sleep for 100 milliseconds, and then call the <code>ReportProgress</code> method of the worker passing in the percentage of work done.</p>
			<ol>
				<li value="11">Add the <code>LongRunningProcessBackgroundWorker_ProgressChanged</code> method to the <code>MainForm</code> class:<pre>private void LongRunningProcessBackgroundWorker
    _ProgressChanged(object sender, ProgressChanged
        EventArgs e)
    {
        StatusLabel.Text 
        = ($”Progress: {_operationNumber}%”);
    TaskProgressBar.Value = _operationNumber;
        if (_operationNumber == 100)
    {
            Thread.Sleep(100);
            LongRunningOperationCancelButton
            .Visible = false;
        StatusBar.Visible = false;
    }
}</pre></li>
			</ol>
			<p>This code updates the UI<a id="_idIndexMarker1185"/> with the progress of the long-running task. If all the operations have been completed, the task cancel button and status bar are hidden from the user.</p>
			<ol>
				<li value="12">Add the <code>LongRunningProcessBackgroundWorker_RunWorkerCompleted</code> method <a id="_idIndexMarker1186"/>to the <code>MainForm</code> class:<pre>private void LongRunningProcessBackgroundWorker
    _RunWorkerCompleted(object sender, 
        RunWorkerCompletedEventArgs e)
    {
        if (e.Cancelled == true)
            StatusLabel.Text = “Canceled!”;
     else if (e.Error != null)
            StatusLabel.Text = “Error: “ + 
                e.Error.Message;
     else
            StatusLabel.Text = “Done!”;
}</pre></li>
			</ol>
			<p>When the long-running task is completed, this method executes <code>StatusLabel.Text</code> to the outcome of the method, with the outcomes being either <code>Cancelled</code>, <code>Error</code>, or <code>Done</code>.</p>
			<ol>
				<li value="13">Our final piece of code to write before we complete and run our WinForms application is to add code to the <code>LongRunningOperationButton_Click</code> method to <code>MainClass</code>, as follows:<pre>private void LongRunningOperationCancelButton
    _Click(object sender, EventArgs e)
{
    if (LongRunningProcessBackgroundWorker
        .WorkerSupportsCancellation == true)
{
        LongRunningProcessBackgroundWorker
            .CancelAsync();
        LongRunningOperationCancelButton.Visible = 
            false;
        StatusBar.Visible = false;
     }
}</pre></li>
			</ol>
			<p>This code checks<a id="_idIndexMarker1187"/> to see whether the task<a id="_idIndexMarker1188"/> supports cancellation. If it does, then the task is canceled, and the cancel button and status bar are hidden from the user.</p>
			<ol>
				<li value="14">Run the code. You should see the splash screen shown in <em class="italic">Figure 12.1</em>. Then, you should see the main window resembling what is shown in <em class="italic">Figure 12.2</em>. Move the window about and click on the increment count button. Also, click the paging buttons to move between data pages of the dataset, and cancel the task. You should see that the window is completely responsive to your input, as follows:</li>
			</ol>
			<div><div><img src="img/Figure_12.02_B16617.jpg" alt="Figure 12.2 – The Windows Forms main application window&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.2 – The Windows Forms main application window</p>
			<p>As you can see, we have written<a id="_idIndexMarker1189"/> a WinForms application that has<a id="_idIndexMarker1190"/> a lot going on. We have a splash screen that provides visual feedback to the user so that they do not think that the application has crashed in any way, and we have a UI that remains responsive to user input during a long-running task.</p>
			<p>Now that we have a working WinForms application, let’s turn our attention to WPF. In the next section, we will apply what we have learned with our WinForms application to a WPF application.</p>
			<h1 id="_idParaDest-218"><a id="_idTextAnchor223"/>Building a responsive UI with WPF</h1>
			<p>In this section, we are going to build<a id="_idIndexMarker1191"/> the same kind of interface as we did<a id="_idIndexMarker1192"/> for the WinForms application, but this time, it will be using WPF. We will now start writing our code:</p>
			<ol>
				<li value="1">Create a new WPF application called <code>CH12_ResponsiveWPF</code> and make sure to select <strong class="bold">.NET 6.0</strong> as the target framework.</li>
				<li>Add the <code>Product</code> class to the project. It is the same code that we used in our WinForms application.</li>
				<li>Add a new Window called <code>SplashWindow</code>.</li>
				<li>Modify the <strong class="bold">SplashWindow</strong> XAML as follows:<pre>&lt;Window x:Class=”CH12_ResponsiveWPF.SplashWindow”    
       xmlns=””
       xmlns:x=””
       xmlns:d=””
       xmlns:mc=””
       xmlns:local=”clr-namespace:CH12_ResponsiveWPF”
       mc:Ignorable=”d” 
       Background=”White”        
       Foreground=”White” 
       WindowStyle=”None”
       WindowStartupLocation=”CenterScreen”
       Title=”SplashWindow” Height=”450” Width=”800”&gt;
    &lt;StackPanel HorizontalAlignment=”Center” 
        VerticalAlignment=”Center”&gt;
        &lt;Label TextBlock.FontSize=”32” 
            Content=”Responsive WPF Example” /&gt;
        &lt;Label x:Name=”LoadingProgressLabel” 
            TextBlock.FontSize=”12” 
                Content=”Loading...” /&gt;
        &lt;ProgressBar x:Name=”LoadingProgressBar” 
            Minimum=”0” Maximum=”100” /&gt;
    &lt;/StackPanel&gt;
&lt;/Window&gt;</pre></li>
			</ol>
			<p>The XAML we have just updated<a id="_idIndexMarker1193"/> declares a stack panel with two labels<a id="_idIndexMarker1194"/> and a progress bar. The first label displays the title, and the second label displays loading progress along with the progress bar.</p>
			<ol>
				<li value="5">Add the following method to the <code>SplashWindow</code> class:<pre>public void UpdateProgress(int value, string message)
{
    LoadingProgressBar.Value = value;
    LoadingProgressLabel.Content = message;
    InvalidateVisual();
}</pre></li>
			</ol>
			<p>This code will be called by the <code>MainWindow</code> class and is responsible for updating the progress indicators on <strong class="bold">SplashWindow</strong>.</p>
			<ol>
				<li value="6">Open the <code>MainWindow.xaml</code> file and replace the existing XAML with the following:<pre>&lt;StackPanel HorizontalAlignment=”Stretch” 
    VerticalAlignment=”Stretch” Background=”Red”&gt;
    &lt;Label x:Name=”CounterLabel” FontSize=”32” 
        Foreground=”Yellow” Margin=”8” Padding=”8” /&gt;
        &lt;Button x:Name=”IncrementCounterButton” 
        Content=”Increment Counter” 
        Click=”IncrementCounterButton_Click” 
        HorizontalAlignment=”Center” Padding=”8” 
        Margin=”0, 0, 0 , 8” /&gt;
        &lt;DataGrid x:Name=”DataTable” /&gt;
        &lt;StackPanel Orientation=”Horizontal” 
            HorizontalAlignment=”Center” Margin=”0, 4, 
                0, 4”&gt;
            &lt;Button x:Name=”FirstButton” 
            Content=”|&amp;lt;&amp;lt;” 
          Click=”FirstButton_Click” Margin=”4” 
          Padding=”8” /&gt;
            &lt;Button x:Name=”PreviousButton” 
            Content=”&amp;lt;&amp;lt;” 
            Click=”PreviousButton_Click” Margin=”4” 
            Padding=”8” /&gt;
            &lt;Label x:Name=”PageLabel” 
            Background=”White” Foreground=”Black” 
            Width=”110” Height=”32” 
            VerticalContentAlignment=”Center” /&gt;
            &lt;Button x:Name=”NextButton” 
            Content=”&amp;gt;&amp;gt;” 
            Click=”NextButton_Click” Margin=”4” 
            Padding=”8” /&gt;
            &lt;Button x:Name=”LastButton” 
            Content=”&amp;gt;&amp;gt;|” 
            Click=”LastButton_Click” Margin=”4” 
            Padding=”8” /&gt;
        &lt;/StackPanel&gt;
        &lt;StackPanel x:Name=”StatusPanel” 
        VerticalAlignment=”Bottom” 
        Orientation=”Horizontal” Background=”Yellow”&gt;
            &lt;Label x:Name=”StatusLabel” 
            Content=”Progress Update: ...” /&gt;
            &lt;ProgressBar x:Name=”TaskProgressBar” 
            Minimum=”0” Maximum=”100” Width=”500” /&gt;
            &lt;Button x:Name=”CancelTaskButton” 
            Content=”Cancel Task” 
            Click=”CancelTaskButton_Click” /&gt;
        &lt;/StackPanel&gt;
    &lt;/StackPanel&gt;</pre></li>
			</ol>
			<p>This XAML provides<a id="_idIndexMarker1195"/> a status panel that will show the progress<a id="_idIndexMarker1196"/> of any background tasks, an increment label and an increment button, a data grid, and a navigation panel for paging through different pages of data.</p>
			<ol>
				<li value="7">Add the following <code>using</code> statements to the <code>MainWindow.xaml.cs</code> file:<pre>using System;
using System.Collections;
using System.Collections.Generic;
using System.ComponentModel;
using System.Threading;
using System.Windows;
using System.Windows.Threading;</pre></li>
			</ol>
			<p>These <code>using</code> statements are needed for our WPF window to function without error.</p>
			<ol>
				<li value="8">Add the following<a id="_idIndexMarker1197"/> member variables to<a id="_idIndexMarker1198"/> the <code>MainWindow</code> class:<pre>private int _clickCounter;
private int _operationNumber;
private List&lt;Product&gt; _products;
private int _offset = 0;
private int _pageSize = 10;
private int _currentPage = 1;
BackgroundWorker _worker;</pre></li>
			</ol>
			<p>Here, we have the same variables that we had with our WinForms application, except we also declare a background worker.</p>
			<ol>
				<li value="9">Update the <code>MainWindow</code> constructor<a id="_idIndexMarker1199"/> with the following<a id="_idIndexMarker1200"/> code:<pre>public MainWindow()
{
    InitializeComponent();
    BuildCollection();
    SplashWindow splashWindow = new SplashWindow();
    splashWindow.Show();
    for (int x = 1; x &lt;= 100; x++)
    {
        Thread.Sleep(100);
        splashWindow.UpdateProgress(x, $”Progress 
            Update: Performing load operation {x} of 
                100...”);
        DoEvents();
}
    splashWindow.Close();
    DataTable.ItemsSource = PagedData();
    PageLabel.Content = $”Page {_currentPage} of 
        {PageCount()}”;
     _worker = new BackgroundWorker();
    _worker.WorkerReportsProgress = true;
    _worker.WorkerSupportsCancellation = true;
    _worker.DoWork += Worker_DoWork;
    _worker.ProgressChanged += Worker_ProgressChanged;
    _worker.RunWorkerCompleted +=
         Worker_RunWorkerCompleted;
    _worker.RunWorkerAsync();
}</pre></li>
			</ol>
			<p>This code is pretty<a id="_idIndexMarker1201"/> much the same as our WinForms load method. The only real difference<a id="_idIndexMarker1202"/> is that all our initialization code is in the constructor.</p>
			<ol>
				<li value="10">Add the <code>Worker_DoWork</code> method:<pre>private void Worker_DoWork(object sender, 
    DoWorkEventArgs e)
{
    BackgroundWorker worker = sender as 
        BackgroundWorker;
for (int i = 1; i &lt;= 100; i++)
    {
        if (worker.CancellationPending == true)
        {
            e.Cancel = true;
            break;
     }
        else
        {
            _operationNumber = i;
            System.Threading.Thread.Sleep(100);
             worker.ReportProgress((i / 100) * 100);
        }
     }
}</pre></li>
			</ol>
			<p>This code simulates<a id="_idIndexMarker1203"/> the work of 100 operations with a small delay<a id="_idIndexMarker1204"/> for each operation.</p>
			<ol>
				<li value="11">Add the <code>Worker_ProgressChanged</code> method code:<pre>private void Worker_ProgressChanged(object sender, 
    ProgressChangedEventArgs e)
{
    StatusLabel.Content = ($”Progress: 
        {_operationNumber}%”);
    TaskProgressBar.Value = _operationNumber;
}</pre></li>
			</ol>
			<p>This code updates<a id="_idIndexMarker1205"/> the progress indicators<a id="_idIndexMarker1206"/> for the long-running task.</p>
			<ol>
				<li value="12">Add the <code>Worker_RunWorkerCompleted</code> method:<pre>private void Worker_RunWorkerCompleted(object sender, 
    RunWorkerCompletedEventArgs e)
{
    if (e.Cancelled == true)
        StatusLabel.Content = “Cancelled!”;
    else if (e.Error != null)
        StatusLabel.Content = “Error: “ + e.Error.
          Message;
    else
        StatusLabel.Content = “Done!”;
Thread.Sleep(1500);
    StatusPanel.Visibility = Visibility.Collapsed;
}</pre></li>
			</ol>
			<p>This method reports the result of the long-running task and then hides the status panel from the end user.</p>
			<ol>
				<li value="13">Add the <code>PagedData</code> method:<pre>private IEnumerable PagedData()
{
    return _products.GetRange(_offset, _pageSize);
}</pre></li>
			</ol>
			<p>This method returns<a id="_idIndexMarker1207"/> a page of data whose index starts at <code>_offset</code>, with the number<a id="_idIndexMarker1208"/> of returned rows defined by <code>_pageSize</code>.</p>
			<ol>
				<li value="14">Add the <code>DoEvents</code> method:<pre>public static void DoEvents()
{
    Application.Current.Dispatcher
         .Invoke(DispatcherPriority.Render, 
             new Action(delegate { 
                // Your operation goes here.
            }));
}</pre></li>
			</ol>
			<p>This code performs like the WinForms <code>Application.DoEvents()</code> code. You can place your non-UI blocking code here, and update the UI.</p>
			<ol>
				<li value="15">Add the <code>BuildCollection</code> method:<pre>private void BuildCollection()
{
    _products = new();
    for (int x = 1; x &lt;= 100; x++)
    {
        _products.Add(new Product { Id = x, Name = 
            $”Product {x}” });
     }
}</pre></li>
			</ol>
			<p>The <code>BuildCollection</code> method builds<a id="_idIndexMarker1209"/> our dataset<a id="_idIndexMarker1210"/> of 100 products.</p>
			<ol>
				<li value="16">Add the <code>PageCount</code> method:<pre>private int PageCount()
{
    return _products.Count / _pageSize;
}</pre></li>
			</ol>
			<p>The <code>PageCount</code> method works out how many pages of data there are based on the dataset size, divided by the page size, and then returns the result.</p>
			<ol>
				<li value="17">Add the <code>FirstButton_Click</code> method:<pre>private void FirstButton_Click(object sender, 
    RoutedEventArgs e)
{
    if (_currentPage &gt; 1)
    {
        _offset = 0;
        _currentPage = 1;
        PageLabel.Content = $”Page {_currentPage} of 
            {PageCount()}”;
        DataTable.ItemsSource = PagedData();
    }
}</pre></li>
			</ol>
			<p>When executed, this method navigates<a id="_idIndexMarker1211"/> to the first record in our dataset and upgrades the UI<a id="_idIndexMarker1212"/> accordingly.</p>
			<ol>
				<li value="18">Add the <code>PreviousButton_Click</code> method:<pre>private void PreviousButton_Click(object sender, 
    RoutedEventArgs e)
{
    if (_currentPage &gt; 1)
    {
        _offset -= _pageSize;
        _currentPage--;
        PageLabel.Content = $”Page {_currentPage} of 
            {PageCount()}”;
        DataTable.ItemsSource = PagedData();
}
}</pre></li>
			</ol>
			<p>This method will move to the previous page of the dataset and update the UI accordingly.</p>
			<ol>
				<li value="19">Add the <code>NextButton_Click</code> code:<pre>private void NextButton_Click(object sender, 
    RoutedEventArgs e)
{
    if (_currentPage &lt; PageCount())
    {
        _offset += _pageSize;
        _currentPage++;
        PageLabel.Content = $”Page {_currentPage} of 
            {PageCount()}”;
        DataTable.ItemsSource = PagedData();
     }
}</pre></li>
			</ol>
			<p>This method moves<a id="_idIndexMarker1213"/> to the next page of the dataset and updates<a id="_idIndexMarker1214"/> the UI accordingly.</p>
			<ol>
				<li value="20">Add the <code>LastButton_Click</code> method:<pre>private void LastButton_Click(object sender, 
    RoutedEventArgs e)
{
    if (_currentPage &lt; PageCount())
    {
        _offset = _products.Count - _pageSize;
        _currentPage = PageCount();
        PageLabel.Content = $”Page {_currentPage} of 
            {PageCount()}”;
        DataTable.ItemsSource = PagedData();
}
}</pre></li>
			</ol>
			<p>This method moves to the last dataset page and updates the UI accordingly.</p>
			<ol>
				<li value="21">Add the <code>IncrementCounterButton_Click</code> method:<pre>private void IncrementCounterButton_Click(object 
    sender, RoutedEventArgs e)
{
    _clickCounter++;
    CounterLabel.Content = $”You have clicked the 
        button {_clickCounter} times.”;
}</pre></li>
			</ol>
			<p>Each time you click <code>IncrementCounterButton</code>, this method<a id="_idIndexMarker1215"/> will increment the <code>_clickCounter</code> variable<a id="_idIndexMarker1216"/> and report on the screen how many times you have clicked the button.</p>
			<ol>
				<li value="22">Add the final WPF method called <code>CancelTaskButton_Click</code>:<pre>private void CancelTaskButton_Click(object sender, 
    RoutedEventArgs e)
{
    if (_worker.WorkerSupportsCancellation == true)
        _worker.CancelAsync();
}</pre></li>
			</ol>
			<p>This method cancels the long-running task if it supports cancellation.</p>
			<ol>
				<li value="23">Run the WPF application. You will find that you are presented with the splash screen showing the loading progress, as displayed here: </li>
			</ol>
			<div><div><img src="img/Figure_12.03_B16617.jpg" alt="Figure 12.3 – The WPF application’s splash screen&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.3 – The WPF application’s splash screen</p>
			<p>When the loading completes, the splash<a id="_idIndexMarker1217"/> screen closes and you are presented<a id="_idIndexMarker1218"/> with the main window. While a long-running task is in progress, you can move the window about, click on the increment counter button, navigate through the paged data, and cancel the long-running task.</p>
			<p>As you can see from the following screenshot, we have everything in place that provides visual feedback of progress to end users and a UI that remains responsive to user input during a long-running task:</p>
			<div><div><img src="img/Figure_12.04_B16617.jpg" alt="Figure 12.4 – The WPF application’s main window&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.4 – The WPF application’s main window</p>
			<p>In the next<a id="_idIndexMarker1219"/> section, we will<a id="_idIndexMarker1220"/> look at how to keep ASP.NET UI responsive to user input.</p>
			<h1 id="_idParaDest-219"><a id="_idTextAnchor224"/>Building a responsive UI with ASP.NET</h1>
			<p>In this section, we will be looking<a id="_idIndexMarker1221"/> at ways to assist ASP.NET applications<a id="_idIndexMarker1222"/> in being quick and responsive. We will start by looking at memory and distributed caching. Then, we will look at how you can update a section of a page using AJAX. Next, we will move on to write a real-time chat application with SignalR. We will then take a look at using WebSockets in our ASP.NET applications.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">We will not be covering gRPC-Web in this chapter, as we have already covered that topic with example code in <a href="B16617_09_Final_SB_Epub.xhtml#_idTextAnchor168"><em class="italic">Chapter 9</em></a>, <em class="italic">Enhancing the Performance of Networked Applications</em>, in which we looked at gRPC for non-web applications and gRPC-Web for web applications. In this chapter, we also implemented a simple Blazor web application using gRPC-Web, so you can refer to this chapter for gRPC/gRPC-Web.</p>
			<p>Let’s begin looking<a id="_idIndexMarker1223"/> at a responsive ASP.NET application by focusing on caching. There<a id="_idIndexMarker1224"/> are two kinds of caching we will be looking at. These are <strong class="bold">memory caching</strong> and <strong class="bold">distributed caching</strong>. In the next section, we will implement memory caching.</p>
			<h2 id="_idParaDest-220"><a id="_idTextAnchor225"/>Implementing memory caching</h2>
			<p>Web applications load resources<a id="_idIndexMarker1225"/> over the network we all know<a id="_idIndexMarker1226"/> as the internet. Accessing, downloading, and rendering resources from the internet takes varying degrees of time. Time can vary due to network traffic, the quality of the network, and computer system resources. Is there a way in which we can speed this process up? Well, yes. We can implement caching. But what exactly is caching?</p>
			<p><strong class="bold">Caching</strong> is the local storage of frequently accessed<a id="_idIndexMarker1227"/> resources for faster access and processing.</p>
			<p>In this section, you will see how we can easily implement in-memory caching in ASP.NET. To implement in-memory caching, follow these steps:</p>
			<ol>
				<li value="1">Start a new ASP.NET Core web app (<code>Model-View-Controller</code>) project and call it <code>CH12_ResponsiveASPNET</code>.</li>
				<li>Add the <code>Microsoft.Extensions.Caching.Memory</code> NuGet package. If Visual Studio cannot install it, run the following command in the Package Manager:<pre><strong class="bold">Install-Package Microsoft.Extensions.Caching.Memory -</strong>
<strong class="bold">    Version 6.0.0-preview.7.21377.19 </strong></pre></li>
				<li>In the <code>HomeController</code> class, add the statement <code>using Microsoft.Extensions.Caching.Memory</code>.</li>
				<li>Add the following member variables:<pre>private readonly ILogger&lt;HomeController&gt; _logger;
private IMemoryCache _memoryCache;</pre></li>
			</ol>
			<p>This code declares the variables that will store our logger and memory cache objects.</p>
			<ol>
				<li value="5">Update<a id="_idIndexMarker1228"/> the <code>HomeController</code> constructor, as shown<a id="_idIndexMarker1229"/> next:<pre>public HomeController(ILogger&lt;HomeController&gt; logger, 
    IMemoryCache memoryCache)
{
  _logger = logger;
    _memoryCache = memoryCache;
}</pre></li>
			</ol>
			<p>In this code, the logger and memory cache objects that we will be using are injected into our class, and we pass in variables to set our member variables.</p>
			<ol>
				<li value="6">Add the <code>GetMemoryCacheTime</code> method:<pre>private DateTime GetMemoryCacheTime()
{
    DateTime currentTime;
    bool alreadyExists = _memoryCache.TryGetValue
        (“CachedTime”, out currentTime);
    if (!alreadyExists)
    {
    currentTime = DateTime.UtcNow.ToLocalTime();
    _memoryCache.Set(
    “CachedTime”,
    currentTime,  MemoryCacheEntryExtensions
        .SetSlidingExpiration(
         new MemoryCacheEntryOptions() {  
             SlidingExpiration
                 = TimeSpan.FromMinutes(5) },
            TimeSpan.FromMinutes(5)
     ));
    }
    return currentTime;
}</pre></li>
			</ol>
			<p>Here, we are checking<a id="_idIndexMarker1230"/> whether our <code>CachedTime</code> variable exists<a id="_idIndexMarker1231"/> in the memory cache. If it does exist, then the out variable called <code>currentTime</code> is set and the cached time is returned. Otherwise, we get the current time and store it in the memory cache with a sliding expiration value, and then we return the cached time.</p>
			<ol>
				<li value="7">Update the <code>Index</code> method with this code:<pre>[HttpGet]
public string Index()
{
DateTime memoryCacheTime = GetMemoryCacheTime();
return $”Current Time: {DateTime.UtcNow.ToLocalTime()}
    \nMemory Cache Time: {memoryCacheTime}”;
}</pre></li>
			</ol>
			<p>The <code>Index</code> controller method returns a string. This string that is returned is the cached time.</p>
			<ol>
				<li value="8">Run the project <a id="_idIndexMarker1232"/>and navigate to <code>https://localhost:5001/Home</code>. You should see something<a id="_idIndexMarker1233"/> like the following output:</li>
			</ol>
			<p><strong class="bold">Current Time: 12/07/221 20:18:25</strong></p>
			<p><strong class="bold">Memory Cache Time: 12/07/2021 20:18:25</strong></p>
			<p>As you can see, the time did not exist in the cache, and so was added to the cache before it was returned.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The setting of port numbers is dependent on the availability of ports. Whatever port you choose, it will not work if it is in use by another program.</p>
			<ol>
				<li value="9">Now, refresh the page, and you should see different values for the current time and the memory cache time:</li>
			</ol>
			<p><strong class="bold">Current Time: 12/07/2021 20:21:21</strong></p>
			<p><strong class="bold">Memory Cache Time: 12/07/2021 20:18:25</strong></p>
			<p>You can clearly see that the memory cache time is older than the current time. This shows that we have stored the time in the in-memory cache and retrieved it successfully.</p>
			<p>Implementing in-memory caching is really easy in ASP.NET, and you can enhance the page load and render time by storing and retrieving data from the in-memory cache. Now that we have looked at the in-memory cache, we will turn our attention to distributed cache.</p>
			<h2 id="_idParaDest-221"><a id="_idTextAnchor226"/>Implementing distributed caching</h2>
			<p>In this section, we will be using the same ASP.NET web project<a id="_idIndexMarker1234"/> and controller to implement <a id="_idIndexMarker1235"/>distributed caching. What do we mean by distributed caching? Distributed caching<a id="_idIndexMarker1236"/> extends the concept of local caching to include caching over several computers. Such caching enables the scaling of transactional data. You would mainly use distributed caching to store application data that resides in a database, and data related to web sessions. In this section, we use Redis for our caching. Redis is an in-memory data structure store, used as a distributed, in-memory key-value database, cache, and message broker, with optional durability. To implement distributed caching, perform the following:</p>
			<ol>
				<li value="1">Add the <code>Microsoft.Extensions.Caching.Redis</code> NuGet package to the web package. You can use the following command:<pre><strong class="bold">Install-Package Microsoft.Extensions.Caching.Redis -</strong>
<strong class="bold">    Version 2.2.0</strong></pre></li>
				<li>In the <code>HomeController</code> class, add the <code>using Microsoft.Extensions.Caching.Distributed</code> statement.</li>
				<li>Add the following member variable:<pre>private IDistributedCache _distributedCache;</pre></li>
			</ol>
			<p>This variable will hold our distributed cache object that gets injected via the constructor.</p>
			<ol>
				<li value="4">Now, update the constructor code:<pre>public HomeController(ILogger&lt;HomeController&gt; logger, 
    IMemoryCache memoryCache, IDistributedCache 
        distributedCache)
{
    _logger = logger;
    _memoryCache = memoryCache;
    _distributedCache = distributedCache;
}</pre></li>
			</ol>
			<p>We are injecting the distributed<a id="_idIndexMarker1237"/> cache object and setting<a id="_idIndexMarker1238"/> our member variable.</p>
			<ol>
				<li value="5">To use our distributed cache, we will need to encode and decode Base64 strings. Add the following two methods:<pre>private static string Base64Encode(string text)
{
    byte[] bytes = Encoding.UTF8.GetBytes(text);
    return Convert.ToBase64String(bytes);
}
public static string Base64Decode(string text)
{
    byte[] bytes = Convert.FromBase64String(text);
    return Encoding.UTF8.GetString(bytes);
}</pre></li>
			</ol>
			<p>In these two methods, we are encoding a string as a Base64 encoded string, and we are also decoding strings from Base64 to UTF8.</p>
			<ol>
				<li value="6">Add the <code>GetDistriutedCacheString</code> method:<pre>private string GetDistributedCacheString()
{
  string data = _distributedCache.GetString
      (“StringValue”);
  if (data == null)
  {
     data = Base64Encode($”Hello, World! 
          {DateTime.UtcNow.ToLocalTime()}”);
     _distributedCache.Set(“StringValue”,
     Convert.FromBase64String(data),
    new DistributedCacheEntryOptions()
    {
             AbsoluteExpiration 
             = DateTime.UtcNow.AddMinutes(10),
    });
    data = Base64Decode(data);
  }
return data;
}</pre></li>
			</ol>
			<p>In this code, we obtain<a id="_idIndexMarker1239"/> string data from the cache. If it exists, then<a id="_idIndexMarker1240"/> we return it. If it does not exist, then we save the Base64 encoded version of the string to the cache with an absolute expiry being set and then return the Base64 decoded version of the string as a UTF encoded string.</p>
			<ol>
				<li value="7">Update the <code>HomeController.Index</code> method, as shown here:<pre>[HttpGet]
public string Index()
{
DateTime memoryCacheTime = GetMemoryCacheTime();
string data = GetDistributedCacheString();
return $”Current Time: {DateTime.UtcNow.ToLocalTime()}
    \nMemory Cache Time: {memoryCacheTime}
        \nDistributed Cache String: {data}”;
}</pre></li>
			</ol>
			<p>This code obtains in-memory cache<a id="_idIndexMarker1241"/> and distributed cache stored data and outputs it to the user, showing<a id="_idIndexMarker1242"/> the current time, the in-memory cached time, and the data stored in the distributed cache.</p>
			<ol>
				<li value="8">Run the program and navigate to <code>https://localhost:5001</code>. You should see the following output:<pre><strong class="bold">Current Time: 12/07/2021 21:05:59</strong>
<strong class="bold">Memory Cache Time: 12/07/2021 21:05:59</strong>
<strong class="bold">Distributed Cache String: Hello, World! 12/07/2021 </strong>
<strong class="bold">21:05:59</strong></pre></li>
			</ol>
			<p>We can see that the memory cached time and distributed cache string have both just been added to the cache because they are the same as the current time. Now, refresh your browser. You should see that both cached values are older than the current time as shown:</p>
			<pre><strong class="bold">Current Time: 12/07/2021 21:08:13</strong>
<strong class="bold">Memory Cache Time: 12/07/2021 21:05:59</strong>
<strong class="bold">Distributed Cache String: Hello, World! 12/07/2021 </strong>
<strong class="bold">21:05:59</strong>
<strong class="bold">It is plain to see that both cached values already </strong>
<strong class="bold">existed in the cache, since they are older than the </strong>
<strong class="bold">current time.</strong></pre>
			<p>In this and the previous section, you have seen how easy it is to add in-memory and distributed caching to our application. Both forms of caching can be really useful in improving the<a id="_idIndexMarker1243"/> performance of your ASP.NET web<a id="_idIndexMarker1244"/> applications. In the next section, we will look at how to update a small section of the currently displayed page using AJAX.</p>
			<h2 id="_idParaDest-222"><a id="_idTextAnchor227"/>Using AJAX to update part of the currently displayed page</h2>
			<p>In this section, we will use AJAX to update a part of a page<a id="_idIndexMarker1245"/> that is currently being displayed. This saves us from having<a id="_idIndexMarker1246"/> to load the whole page. Let’s start writing our AJAX example:</p>
			<ol>
				<li value="1">Right-click on the <code>Controllers</code> folder. From the context menu, select <strong class="bold">Add</strong> | <strong class="bold">Controller…</strong>. Then, select <strong class="bold">MVC Controller – Empty</strong>.</li>
				<li>Call the new controller <code>AjaxController</code> and open the class.</li>
				<li>Update the controller by adding the following method:<pre>[Route(“Ajax/Demo”)]
public IActionResult AjaxDemo()
{
    return new JsonResult(“Ajax Demo Result”);
}</pre></li>
			</ol>
			<p>This method when called will return a JSON result, which in our case is a simple string.</p>
			<ol>
				<li value="4"><em class="italic">Right-click</em> on the <code>Index</code> method and select <code>index.cshtml</code>.</li>
				<li>Update the <code>Views/Ajax/index.cshtml</code> file with the following HTML and JavaScript code:<pre>&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta name=”viewport” content=”width=device-
            width” /&gt;
        &lt;title&gt;Ajax Example&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;fieldset&gt;
            &lt;legend&gt;Ajax Demonstration&lt;/legend&gt;
            &lt;<strong class="bold">form</strong>&gt;
                &lt;input type=”button” value=”Ajax 
                Demonstration” id=”ajaxDemonstration
                Button” /&gt;
                &lt;br /&gt;
                &lt;span id=”ajaxDemoResult”&gt;&lt;/span&gt;
            &lt;/<strong class="bold">form</strong>&gt;
        &lt;/fieldset&gt;
        &lt;script
             src=”https://code.jquery.com/jquery-
                 3.6.0.slim.min.js”
            integrity=”sha256-u7e5khyithlIdTpu22P
                HhENmPcRdFiHRjhAuHcs05RI=”
            crossorigin=”anonymous”
        &gt;
                
        &lt;/script&gt;
        &lt;script&gt;
            $(document).ready(function( ) {
                $(‘#ajaxDemonstrationButton’)
                    .click(function() {
                    $.ajax({
                        type: ‘GET’,
                        url: ‘/Ajax/Demo’,
                        success: function (result) {
                          $(‘#ajaxDemoResult’)
                            .html(result);
                        }
                    });
                });
            });            
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre></li>
			</ol>
			<p>We have an HTML form. That form<a id="_idIndexMarker1247"/> has a button that, when pressed, will execute JavaScript<a id="_idIndexMarker1248"/> that will retrieve AJAX data by executing our <code>AjaxDemo</code> action method. This will result in our JSON string being displayed on the page.</p>
			<ol>
				<li value="6">Run the project and navigate to <code>http://localhost:5001/Ajax</code>. You should see the following:</li>
			</ol>
			<div><div><img src="img/Figure_12.05_B16617.jpg" alt="Figure 12.5 – The AJAX demo before AJAX is retrieved&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.5 – The AJAX demo before AJAX is retrieved</p>
			<p>As you can see, our page<a id="_idIndexMarker1249"/> is loaded without our JSON<a id="_idIndexMarker1250"/> string. Now, click the <strong class="bold">Ajax Demonstration</strong> button. You now see the following:</p>
			<div><div><img src="img/Figure_12.06_B16617.jpg" alt="Figure 12.6 – The AJAX demo displaying the JSON string retrieved using AJAX&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.6 – The AJAX demo displaying the JSON string retrieved using AJAX</p>
			<p>After clicking the button, we can see that the AJAX action retrieved our JSON string and displayed it on the page without a complete page load.</p>
			<p>We have seen how to update<a id="_idIndexMarker1251"/> a portion of a page using AJAX, and before<a id="_idIndexMarker1252"/> that, we saw how to implement in-memory and distributed caching. In the next section, we will look at how to implement WebSockets.</p>
			<h2 id="_idParaDest-223"><a id="_idTextAnchor228"/>Implementing WebSockets</h2>
			<p>In this section, we will be implementing <strong class="bold">WebSockets</strong>. You may have heard of WebSockets, but<a id="_idIndexMarker1253"/> what are they? A WebSocket<a id="_idIndexMarker1254"/> is a full-duplex communication protocol for communication<a id="_idIndexMarker1255"/> over a single TCP connection. To find out more about the WebSocket specification, you can look up the IETF RFC 6455 from 2011 (<a href="https://www.rfc-editor.org/rfc/rfc6455.txt">https://www.rfc-editor.org/rfc/rfc6455.txt</a>).</p>
			<p>What do we use WebSockets for? Well, we can use them to open a single two-way interactive session between browsers and servers. That way, we can negate server polling, send messages to a server, and receive responses via events. Thus, making our applications event-driven.</p>
			<p>In our WebSockets demonstration, we will click<a id="_idIndexMarker1256"/> a button. It will open a WebSocket, send<a id="_idIndexMarker1257"/> a message, receive a response, and then close the connection. The communication between our browser and the server will be output to our web page. So, let’s get started with writing our WebSocket example:</p>
			<ol>
				<li value="1">Add a new controller called <code>WebSocketsController</code>.</li>
				<li>Right-click the <code>Index</code> method and select <strong class="bold">Add View</strong>.</li>
				<li>Update the <code>Views/WebSockets/Index.cshtml</code> file as follows:<pre>&lt;script type = “text/javascript”&gt; 
    function WebSocketExample (){
        var socket = new WebSocket(“wss://
            javascript.info/article/websocket/
                demo/hello”);
        var messages = document.getElementById
            (‘messages’)
        var innerHTML = messages.innerHTML;
        socket.onopen = function(e) {
            innerHTML += ‘&lt;p&gt;[open] Connection 
                established&lt;/p&gt;’;
            messages.innerHTML += innerHTML;
            innerHTML += ‘&lt;p&gt;Sending to server&lt;/p&gt;’;
            messages.innerHTML += innerHTML;
            socket.send(‘WebSocket message!’);
        };
        socket.onmessage = function(event) {
            innerHTML += `&lt;p&gt;[message] Data received 
                from server: ${event.data}&lt;/p&gt;`;
        };
        socket.onclose = function(event) {  
            if (event.wasClean) {
                innerHTML += `&lt;p&gt;[close] Connection 
                closed cleanly, code=${event.code} 
                reason=${event.reason}&lt;/p&gt;`;
            messages.innerHTML = innerHTML;
            } else {
         // e.g. server process killed or network down
         // event.code is usually 1006 in this case
        innerHTML += ‘&lt;p&gt;[close] Connection died&lt;/p&gt;’;
                messages.innerHTML = innerHTML;
            }
        };
        socket.onerror = function(error) {
            innerHTML += `&lt;p&gt;[error] 
                ${error.message}&lt;/p&gt;`;
            messages.innerHTML = innerHTML;
        };
    }
&lt;/script&gt; 
&lt;p&gt;Click the following button to see the function in 
    action&lt;/p&gt;  
&lt;input type = “button” onclick = “WebSocketExample()” 
    value = “Display”&gt;  
&lt;p id=”messages” onload=”WebSocketExample()”&gt;&lt;/p&gt;</pre></li>
			</ol>
			<p>When a WebSocket is opened via the button<a id="_idIndexMarker1258"/> click, the <code>messages</code> paragraph is updated with messages, and then a message<a id="_idIndexMarker1259"/> is sent to the server. When the server responds, the messages paragraph is then updated to inform the user that the server has responded. If an error occurs, then a message is displayed to the user. The WebSocket is then closed and a message is displayed on the page.</p>
			<ol>
				<li value="4">Run the code and navigate to <code>http://localhost:5001/WebSockets</code>. Click on the button, and you should end up with the following:</li>
			</ol>
			<div><div><img src="img/Figure_12.07_B16617.jpg" alt="Figure 12.7 – The end result of clicking on the button and executing our WebSocket example&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.7 – The end result of clicking on the button and executing our WebSocket example</p>
			<p>There is not that much code to WebSockets. In this<a id="_idIndexMarker1260"/> example, we have sent a simple message and received a response. All our <a id="_idIndexMarker1261"/>code to do this exists in the <code>CSHTML</code> file of our view. In the next section, we will look at writing a real-time chat program using SignalR.</p>
			<h2 id="_idParaDest-224"><a id="_idTextAnchor229"/>Implementing a real-time chat application using SignalR</h2>
			<p>In this section, we will learn<a id="_idIndexMarker1262"/> how to write real-time functionality<a id="_idIndexMarker1263"/> in an ASP.NET web application<a id="_idIndexMarker1264"/> using SignalR. We will demonstrate SignalR in action by writing a simple chat application. We will now begin writing the application:</p>
			<ol>
				<li value="1"><em class="italic">Right-click</em> the project and select <strong class="bold">Add</strong> | <strong class="bold">Client-Side Library</strong> from the context menu, and fill in the details as shown in <em class="italic">Figure 12.8</em>. Then, click the <strong class="bold">Install</strong> button:</li>
			</ol>
			<div><div><img src="img/Figure_12.08_B16617.jpg" alt="Figure 12.8 – The Add Client-Side Library configured to install SignalR&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.8 – The Add Client-Side Library configured to install SignalR</p>
			<ol>
				<li value="2">Copy the <code>wwwroot/lib/microsoft/signalr</code> library<a id="_idIndexMarker1265"/> and paste it into<a id="_idIndexMarker1266"/> the <code>wwwroot/js</code> folder.</li>
				<li>Add a new controller<a id="_idIndexMarker1267"/> called <code>SignalRController</code>.</li>
				<li>Add a folder called <code>Hubs</code> under the main project root.</li>
				<li>Add a class to the <code>Hubs</code> folder called <code>ChatHub</code>. Then, update the <code>ChatHub</code> class, as shown here:<pre>public class ChatHub : Hub
{
     public async Task SendMessage(
         string user, string message
     )
     {
             await Clients.All
             .SendAsync(
                 “ReceiveMessage”, user, message
             );
     }
}</pre></li>
			</ol>
			<p>We have<a id="_idIndexMarker1268"/> our SignalR hub class<a id="_idIndexMarker1269"/> in place, and our <code>SendMessage</code> method sends<a id="_idIndexMarker1270"/> a message to the specified user asynchronously.</p>
			<ol>
				<li value="6"><em class="italic">Right-click</em> on the <code>Index</code> method in the <code>SignalRController</code> class and select <strong class="bold">Add View</strong> from the context menu.</li>
				<li>In the <code>Views/SignalR/Index.cshtml</code> file, replace the existing contents with the following code:<pre>@page
&lt;div class=”container”&gt;
&lt;div class=”row”&gt;&amp;nbsp;&lt;/div&gt;
     &lt;div class=”row”&gt;
         &lt;div class=”col-2”&gt;User&lt;/div&gt;
           &lt;div class=”col-4”&gt;
             &lt;input type=”text” 
                 id=”userInput” /&gt;
         &lt;/div&gt;
     &lt;/div&gt;
     &lt;div class=”row”&gt;
         &lt;div class=”col-2”&gt;Message&lt;/div&gt;
           &lt;div class=”col-4”&gt;
             &lt;input type=”text” 
                 id=”messageInput” /&gt;
         &lt;/div&gt;
     &lt;/div&gt;
     &lt;div class=”row”&gt;&amp;nbsp;&lt;/div&gt;
     &lt;div class=”row”&gt;
         &lt;div class=”col-6”&gt;
              &lt;input type=”button” 
             id=”sendButton” value=”Send Message” /&gt;
          &lt;/div&gt;
     &lt;/div&gt;
&lt;/div&gt;
&lt;div class=”row”&gt;
&lt;div class=”col-12”&gt;
             &lt;hr /&gt;
     &lt;/div&gt;
&lt;/div&gt;
&lt;div class=”row”&gt;
&lt;div class=”col-6”&gt;
             &lt;ul id=”messagesList”&gt;&lt;/ul&gt;
     &lt;/div&gt;
&lt;/div&gt;
&lt;<strong class="bold">script</strong> src=”~/js/signalr/dist/browser/signalr.js”&gt;
    &lt;/<strong class="bold">script</strong>&gt;
&lt;<strong class="bold">script</strong> src=”~/js/chat.js”&gt;&lt;/<strong class="bold">script</strong>&gt;</pre></li>
			</ol>
			<p>We have put together<a id="_idIndexMarker1271"/> a chat UI. The script <a id="_idIndexMarker1272"/>uses SignalR. All we need<a id="_idIndexMarker1273"/> to do now is add our JavaScript that makes our UI interactive.</p>
			<ol>
				<li value="8">In the <code>wwwroot/js</code> folder, add a file called <code>chat.js</code> with the following code:<pre>“use strict”;
var connection = new signalR.HubConnectionBuilder()
    .withUrl(“/chatHub”).build();
document.getElementById(“sendButton”).disabled = true;
connection.on(“ReceiveMessage”, function (user, 
    message) {
        var li = document.createElement(“li”);
     document.getElementById(“messagesList”)
         .appendChild(li);
     li.textContent = `${user} says ${message}`;
});
connection.start().then(function () {
        document.getElementById(“sendButton”)
         .disabled = false;
}).catch(function (err) {
    return console.error(err.toString());
});
document.getElementById(“sendButton”)
     .addEventListener(“click”, function (event) {
         var user = document
             .getElementById(“userInput”).value;
             var message = document
             .getElementById(“messageInput”).value;
         connection.invoke(
             “SendMessage”, user, message
         ).catch(function (err) {
                 return console.error(err.toString());
             });
             event.preventDefault();
     });</pre></li>
			</ol>
			<p>We have added JavaScript<a id="_idIndexMarker1274"/> that makes our UI<a id="_idIndexMarker1275"/> interactive. This code<a id="_idIndexMarker1276"/> manages the sending of chat messages between users.</p>
			<ol>
				<li value="9">In the <code>Program</code> class, add the following services:<pre>services.AddRazorPages();
services.AddSignalR();</pre></li>
			</ol>
			<p>This code adds SignalR to our available services so that we can pass SignalR requests to SignalR.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">If using the new minimal template, the code is <code>builder.Services.AddRazorPages(); builder.Services.AddSignalR();</code>.</p>
			<ol>
				<li value="10">Update<a id="_idIndexMarker1277"/> the <code>Program</code> class<a id="_idIndexMarker1278"/> to include the mapped<a id="_idIndexMarker1279"/> route to our <code>ChatHub</code>:<pre>app.MapHub&lt;ChatHub&gt;(“/chatHub”);</pre></li>
			</ol>
			<p>We have included the route to our <code>ChatHub</code> so that our chat application knows how to handle incoming requests.</p>
			<ol>
				<li value="11">Run the code and navigate to <code>https://localhost:5001/SignalR</code>. You will need two browser instances side by side. Enter usernames and messages in each browser and click on the <strong class="bold">Send Message</strong> button. Each time you enter text, it will appear on the receiver’s chat page, as you can see here:</li>
			</ol>
			<div><div><img src="img/Figure_12.09_B16617.jpg" alt="Figure 12.9 – Our SignalR application in action&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.9 – Our SignalR application in action</p>
			<p>It was fairly straightforward<a id="_idIndexMarker1280"/> setting up and running<a id="_idIndexMarker1281"/> our SignalR. As you<a id="_idIndexMarker1282"/> can see, SignalR is an excellent choice for real-time communication, and I am sure you will be able to take this knowledge<a id="_idIndexMarker1283"/> further in the web applications<a id="_idIndexMarker1284"/> you write. That concludes<a id="_idIndexMarker1285"/> our work on ASP.NET in this chapter. So, let’s now move on to look at .NET MAUI in the next section.</p>
			<h1 id="_idParaDest-225"><a id="_idTextAnchor230"/>Building responsive UIs with .NET MAUI</h1>
			<p>Microsoft .NET MAUI<a id="_idIndexMarker1286"/> is the new version of Xamarin.Forms. There have been some significant<a id="_idIndexMarker1287"/> changes between Xamarin.Forms version 5.0 and .NET MAUI (Xamarin.Forms version 6.0). The biggest change in MAUI has been to combine the Android, iOS, and macOS projects into a main project. While the code specific to Windows still resides in its own project, Microsoft is working to include the Windows code in the main project. This will lead to us having one single project for writing cross-platform applications using C# and XAML. Let’s have a look at some of the other improvements to building cross-platform applications using .NET MAUI.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">If you are using an early version of MAUI, to run the Windows project, you will need to set the Windows project as the startup project and deploy the project. Once the project is deployed, you can run the application from the Windows start menu.</p>
			<h2 id="_idParaDest-226"><a id="_idTextAnchor231"/>Layouts</h2>
			<p>Another significant<a id="_idIndexMarker1288"/> change made in .NET MAUI is that<a id="_idIndexMarker1289"/> the original layouts used by Xamarin.Forms projects have been moved to <code>Microsoft.Maui.Controls.Compatibility</code> namespace. By default, MAUI will use new layouts. These layouts are based on a new <code>LayoutManager</code> that has been written for performance, consistency, and maintainability. The new layouts are <code>Grid</code>, <code>FlexLayout</code>, and <code>StackLayout</code> (<code>HorizontalStackLayout</code> and <code>VerticalStackLayout</code>). Microsoft encourages you to select the stack layout that best suits your needs. You are also encouraged to replace legacy layouts with new layouts.</p>
			<p>The default spacing values for the new<a id="_idIndexMarker1290"/> layouts have been standardized to the value of 0. Having these values as 0 sets the expectation that you will set your own preferred values to meet your design requirements. It is best to set these values in your global styles as follows:</p>
			<pre class="source-code">&lt;ResourceDictionary&gt;</pre>
			<pre class="source-code">    &lt;Style TargetType=”StackLayout”&gt;</pre>
			<pre class="source-code">        &lt;Setter Property=”Spacing” Value=”8”/&gt;</pre>
			<pre class="source-code">    &lt;/Style&gt;</pre>
			<pre class="source-code">    &lt;Style TargetType=”Grid”&gt;</pre>
			<pre class="source-code">        &lt;Setter Property=”ColumnSpacing” Value=”8”/&gt;</pre>
			<pre class="source-code">        &lt;Setter Property=”RowSpacing” Value=”8”/&gt;</pre>
			<pre class="source-code">    &lt;/Style&gt;</pre>
			<pre class="source-code">&lt;/ResourceDictionary&gt;</pre>
			<p>Let’s move<a id="_idIndexMarker1291"/> on to look at accessibility improvements.</p>
			<h2 id="_idParaDest-227"><a id="_idTextAnchor232"/>Accessibility</h2>
			<p>Microsoft regularly meets with developers<a id="_idIndexMarker1292"/> who are heavily invested in making applications that meet the highest accessibility rating. This led Microsoft to remove the <code>TabIndex</code> and <code>IsTabStop</code> properties, as they ended up being confusing and not meeting accessibility needs. For better accessibility, you can improve a screen reader’s ability to know the order of reading a UI by implementing a thoughtful design. If you need to take control over the order of UI components, Microsoft recommends that you use the <code>SemanticOrderView</code> component.</p>
			<h3>SetSemanticFocus and Announce</h3>
			<p>Screen readers are an essential<a id="_idIndexMarker1293"/> part of an application that is accessible and friendly. To aid<a id="_idIndexMarker1294"/> these applications’ performance in being able to read the correct components, there is a new <code>SemanticExtensions</code> class. As part of this class, there is a new method called <code>SetSematicFocus</code>. This method enables the setting of a screen reader’s focus to a specific element. </p>
			<p class="callout-heading">Note</p>
			<p class="callout">At the time of writing, <code>SetSemanticFocus</code> and <code>Announce</code> are only available for iOS, Android, and Mac Catalyst.</p>
			<p>Here is a XAML example of setting semantic focus:</p>
			<pre class="source-code">&lt;VerticalStackLayout&gt;</pre>
			<pre class="source-code">    &lt;Label</pre>
			<pre class="source-code">        Text=”SemanticExtensions:”</pre>
			<pre class="source-code">        TextColor=”Black”</pre>
			<pre class="source-code">        FontAttributes=”Bold”</pre>
			<pre class="source-code">        FontSize=”14”</pre>
			<pre class="source-code">        Margin=”0,8”/&gt;</pre>
			<pre class="source-code">    &lt;Button</pre>
			<pre class="source-code">        Text=”Semantic focus is applied to the label that </pre>
			<pre class="source-code">            follows upon the button being pressed.”</pre>
			<pre class="source-code">        FontSize=”12”</pre>
			<pre class="source-code">        Clicked=”LabelFocusButton_Clicked”/&gt;</pre>
			<pre class="source-code">    &lt;Label</pre>
			<pre class="source-code">        x:Name=”SomeLabel”</pre>
			<pre class="source-code">        Text=”Hello, I am able to receive semantic focus!”</pre>
			<pre class="source-code">        FontSize=”12”/&gt;</pre>
			<pre class="source-code">&lt;/VerticalStackLayout&gt;</pre>
			<p>In this XAML, we have an instruction<a id="_idIndexMarker1295"/> label and a button for the user to press. When<a id="_idIndexMarker1296"/> the button is pressed, the click event will set the semantic focus to <code>semanticFocusLabel</code>. Here is the click event code:</p>
			<pre class="source-code">private void LabelFocusButton_Clicked(object sender, </pre>
			<pre class="source-code">    EventArgs e)</pre>
			<pre class="source-code">{</pre>
			<pre class="source-code">    SomeLabel.SetSemanticFocus();</pre>
			<pre class="source-code">}</pre>
			<p>The following code enables the screen reader to make an announcement:</p>
			<pre class="source-code">SemanticScreenReader.Announce(</pre>
			<pre class="source-code">    “Make your applications accessible to MAUI users!”</pre>
			<pre class="source-code">);</pre>
			<p>Another accessibility addition is automatic font scaling.</p>
			<h3>Font scaling</h3>
			<p>By default, all components<a id="_idIndexMarker1297"/> now have automatic font scaling, and it is enabled by default. That means that when your users change their text scaling on the various platforms, your application’s text will scale to their chosen settings automatically. You can turn automatic font scaling off for control with the following markup: <code>FontAutoScalingEnabled=”False”</code>. Changing the attribute to <code>True</code> or removing it will turn font auto-scaling back on. </p>
			<h2 id="_idParaDest-228"><a id="_idTextAnchor233"/>BlazorWebView</h2>
			<p>Using BlazorWebView, you can host Blazor websites<a id="_idIndexMarker1298"/> in your Microsoft MAUI applications. This enables<a id="_idIndexMarker1299"/> your Blazor website to make use of native platform functionality and various user controls. You can add <code>BlazorWebView</code> to a XAML page and point it to the root of your Blazor application:</p>
			<pre class="source-code">&lt;BlazorWebView HostPage=”wwwroot/index.html”</pre>
			<pre class="source-code">               Services=”{StaticResource Services}”&gt;</pre>
			<pre class="source-code">     &lt;BlazorWebView.RootComponent&gt;</pre>
			<pre class="source-code">         &lt;RootComponent Selector=”#app”</pre>
			<pre class="source-code">                ComponentType=”{x:Type local:Main}” /&gt;</pre>
			<pre class="source-code">     &lt;/BlazorWebView.RootComponent&gt;</pre>
			<pre class="source-code">&lt;/BlazorWebView&gt;</pre>
			<p>As you can see from the XAML, the root<a id="_idIndexMarker1300"/> of our Blazor application is <code>wwwroot/index.html</code>. In the next section, we will take<a id="_idIndexMarker1301"/> a look at WinUI 3.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">As of June 20, 2022, MAUI is generally available, but to develop MAUI applications, you will need to install a .NET 2022 preview.</p>
			<h1 id="_idParaDest-229"><a id="_idTextAnchor234"/>Building a responsive UI with MAUI</h1>
			<p>In this section, we will build<a id="_idIndexMarker1302"/> a simple responsive UI using MAUI. Until MAUI is included with<a id="_idIndexMarker1303"/> Visual Studio 2022, you will need to ensure you use Visual Studio 2022 Preview:</p>
			<ol>
				<li value="1">Start a new .NET MAUI app and call it <code>CH12_ResponsiveMAUI</code>.</li>
				<li>Add a new folder called <code>Api</code>.</li>
				<li>In the <code>Api</code> folder, add a class called <code>PropertyChangedNotifier</code> and replace its contents with the following code:<pre>namespace CH12_ResponsiveMAUI.Api
{
    using System.ComponentModel;
    using System.Runtime.CompilerServices;
 
    public class PropertyChangeNotifier : 
        INotifyPropertyChanged
    {
        public event PropertyChangedEventHandler 
            PropertyChanged;
 
        protected void OnPropertyChanged
            ([CallerMemberName] string propertyName = 
               null)
        {
            PropertyChanged?.Invoke(this, new 
                PropertyChangedEventArgs
                   (propertyName));
        }
    }
}</pre></li>
			</ol>
			<p>This code is a base<a id="_idIndexMarker1304"/> class that implements<a id="_idIndexMarker1305"/> the <code>INotifyPropertyChanged</code> interface.</p>
			<ol>
				<li value="4">Add a new folder called <code>Data</code>.</li>
				<li>Add a new class to the <code>Data</code> folder called <code>BaseEntity</code> with the following properties:<pre>public int Id { get; set; }
public DateTime CreatedDate { get; set; }
public DateTime ModifiedDate { get; set; }</pre></li>
			</ol>
			<p>These are base properties for our entities that will inherit this class.</p>
			<ol>
				<li value="6">Add a new interface to the <code>Data</code> folder called <code>IRepository</code> and replace the class with the following code:<pre>public interface IRepository&lt;T&gt; where T : BaseEntity
{
        T GetById(int id);
        T FirstOrDefault(Func&lt;T, bool&gt; query);
        void Add(T entity);
        void Update(T entity);
        void Remove(T entity);
        List&lt;T&gt; GetAll();
        List&lt;T&gt; Filter(Func&lt;T, bool&gt; query);
        int Count();
        int FilteredCount(Func&lt;T, bool&gt; query);
}</pre></li>
			</ol>
			<p>This interface will be implemented by all our repositories.</p>
			<ol>
				<li value="7">Add a class called <code>BaseRepository</code> to the <code>Data</code> folder<a id="_idIndexMarker1306"/> and update the class<a id="_idIndexMarker1307"/> with the following code:<pre>public class BaseRepository&lt;T&gt; : IRepository&lt;T&gt; where 
    T : BaseEntity
{
        protected ICollection&lt;T&gt; Context;
        public BaseRepository(ICollection&lt;T&gt; context)
        {
            if (context == null)
                throw new ArgumentNullException
                    (“context”);
            Context = context;
        }
}</pre></li>
			</ol>
			<p>This class is a generic base repository<a id="_idIndexMarker1308"/> that implements the <code>IRepository</code> interface. The context<a id="_idIndexMarker1309"/> for storing data is of type <code>ICollection</code>, and we set <code>Context</code> to the collection passed in as a parameter.</p>
			<ol>
				<li value="8">Add the <code>Add</code> method:<pre>public void Add(T entity)
{
Context.Add(entity);
}</pre></li>
			</ol>
			<p>This code adds an entity to our collection.</p>
			<ol>
				<li value="9">Add the <code>Count</code> method:<pre>public int Count()
{
if (Context != null)
     return Context.Count;
return 0;
}</pre></li>
			</ol>
			<p>This code returns the count of all the entities in our collection.</p>
			<ol>
				<li value="10">Add the <code>Filter</code> method:<pre> public List&lt;T&gt; Filter(Func&lt;T, bool&gt; query)
{
return Context.Where(query).ToList();
}</pre></li>
			</ol>
			<p>This code takes a query and returns a filtered list of items.</p>
			<ol>
				<li value="11">Add the <code>FilteredCount</code> method:<pre>public int FilteredCount(Func&lt;T, bool&gt; query)
{
    return Context.Where(query).Count();
}</pre></li>
			</ol>
			<p>This code<a id="_idIndexMarker1310"/> returns the items<a id="_idIndexMarker1311"/> in our filtered list.</p>
			<ol>
				<li value="12">Add the <code>FirstOrDefault</code> method:<pre>public T FirstOrDefault(Func&lt;T, bool&gt; query)
{
    return Context.Where(query).FirstOrDefault();
}</pre></li>
			</ol>
			<p>This method returns the first record to match our query. If there is no match, then the default value is returned instead.</p>
			<ol>
				<li value="13">Add the <code>GetAll</code> method:<pre>public List&lt;T&gt; GetAll()
{
return Context.ToList();
}</pre></li>
			</ol>
			<p>The method returns all the items in our list.</p>
			<ol>
				<li value="14">Add the <code>GetById</code> method:<pre>public T GetById(int id)
{
return Context.Where(t =&gt; t.Id == id)
    .FirstOrDefault();
}</pre></li>
			</ol>
			<p>This method gets<a id="_idIndexMarker1312"/> an item from the list, as identified<a id="_idIndexMarker1313"/> by its ID number.</p>
			<ol>
				<li value="15">Add the <code>Remove</code> method:<pre>public void Remove(T entity)
{
Context.Remove(entity);
}</pre></li>
			</ol>
			<p>This method removes an entity from the collection.</p>
			<ol>
				<li value="16">Add the <code>Update</code> method:<pre>public void Update(T entity)
{
T item = Context.FirstOrDefault(t =&gt; t.Id == 
    entity.Id);
int index = Context.ToList().IndexOf(item);
if (index != -1)
    Context.ToList()[index] = entity;
}</pre></li>
			</ol>
			<p>This method updates an entity in the collection.</p>
			<ol>
				<li value="17">Add a new class to the <code>Data</code> folder and call it <code>PeopleRepository</code>. Then, update the class definition as follows:<pre>internal class PeopleRepository : BaseRepository
    &lt;Person&gt;
{
public PeopleRepository(ICollection&lt;Person&gt; context) : 
    base(context)
{
}
}</pre></li>
			</ol>
			<p>This class creates a new repository of type <code>Person</code>.</p>
			<ol>
				<li value="18">Add a new<a id="_idIndexMarker1314"/> folder with a class called <code>Person</code>. Then, update<a id="_idIndexMarker1315"/> the class as follows:<pre>public class Person : BaseEntity
{
     public string FirstName { get; set; }
                 public string LastName { get; set; }
        }</pre></li>
			</ol>
			<p>This class inherits our <code>BaseEntity</code> class and adds the properties <code>FirstName</code> and <code>LastName</code>.</p>
			<ol>
				<li value="19">Add a new folder called <code>ViewModels</code> and a new class called <code>ViewModelBase</code>. Update the class definition as shown:<pre>public class ViewModelBase&lt;T&gt; : PropertyChangeNotifier
{
bool _isRefreshing;
public ObservableCollection&lt;T&gt; Entities { get; private 
   set; } = new ObservableCollection&lt;T&gt;();
public bool IsRefreshing
{
         get { return _isRefreshing; }
         set
                  {
                        _isRefreshing = value;
                        OnPropertyChanged();
                    }
            }
}</pre></li>
			</ol>
			<p>This class is the base<a id="_idIndexMarker1316"/> view model class for all our view<a id="_idIndexMarker1317"/> models. It can be cast to any type, and it implements <code>PropertyChangeNotifer</code>.</p>
			<ol>
				<li value="20">Add <code>PeopleViewModel</code>:<pre>    public class PeopleViewModel : 
        ViewModelBase&lt;Person&gt;
    {
        public PeopleViewModel()
        {
            SeedPeopleRepository();
        }
 
        private void SeedPeopleRepository()
        {
            Entities.Add(new Person { Id = 1, 
            FirstName = “Person”, LastName = “One”, 
            CreatedDate = DateTime.Now, ModifiedDate = 
            DateTime.Now });
            Entities.Add(new Person { Id = 2, 
            FirstName = “Person”, LastName = “Two”, 
            CreatedDate = DateTime.Now, ModifiedDate = 
            DateTime.Now });
            Entities.Add(new Person { Id = 3, 
            FirstName = “Person”, LastName = “Three”, 
            CreatedDate = DateTime.Now, ModifiedDate = 
            DateTime.Now });
            Entities.Add(new Person { Id = 4, 
            FirstName = “Person”, LastName = “Four”, 
            CreatedDate = DateTime.Now, ModifiedDate = 
            DateTime.Now });
            Entities.Add(new Person { Id = 5, 
            FirstName = “Person”, LastName = “Five”, 
            CreatedDate = DateTime.Now, ModifiedDate = 
            DateTime.Now });
            Entities.Add(new Person { Id = 6, 
            FirstName = “Person”, LastName = “Six”, 
            CreatedDate = DateTime.Now, ModifiedDate = 
            DateTime.Now });
            Entities.Add(new Person { Id = 7, 
            FirstName = “Person”, LastName = “Seven”, 
            CreatedDate = DateTime.Now, ModifiedDate = 
            DateTime.Now });
            Entities.Add(new Person { Id = 8, 
            FirstName = “Person”, LastName = “Eight”, 
            CreatedDate = DateTime.Now, ModifiedDate = 
            DateTime.Now });
            Entities.Add(new Person { Id = 9, 
            FirstName = “Person”, LastName = “Nine”, 
            CreatedDate = DateTime.Now, ModifiedDate = 
            DateTime.Now });
            Entities.Add(new Person { Id = 10, 
            FirstName = “Person”, LastName = “Ten”, 
            CreatedDate = DateTime.Now, ModifiedDate = 
            DateTime.Now });
            Entities.Add(new Person { Id = 11, 
            FirstName = “Person”, LastName = “Eleven”, 
            CreatedDate = DateTime.Now, ModifiedDate = 
            DateTime.Now });
            Entities.Add(new Person { Id = 12, 
            FirstName = “Person”, LastName = “Twelve”, 
            CreatedDate = DateTime.Now, ModifiedDate = 
            DateTime.Now });
            Entities.Add(new Person { Id = 13, 
            FirstName = “Person”, LastName = 
            “Thirteen”, CreatedDate = DateTime.Now, 
            ModifiedDate = DateTime.Now });
            Entities.Add(new Person { Id = 14, 
            FirstName = “Person”, LastName = 
            “Fourteen”, CreatedDate = DateTime.Now, 
            ModifiedDate = DateTime.Now });
            Entities.Add(new Person { Id = 15, 
            FirstName = “Person”, LastName = 
            “Fifteen”, CreatedDate = DateTime.Now, 
            ModifiedDate = DateTime.Now });
            Entities.Add(new Person { Id = 16, 
            FirstName = “Person”, LastName = 
            “Sixteen”, CreatedDate = DateTime.Now, 
            ModifiedDate = DateTime.Now });
            Entities.Add(new Person { Id = 17, 
            FirstName = “Person”, LastName = 
            “Seventeen”, CreatedDate = DateTime.Now, 
            ModifiedDate = DateTime.Now });
            Entities.Add(new Person { Id = 18, 
            FirstName = “Person”, LastName = 
            “Eighteen”, CreatedDate = DateTime.Now, 
            ModifiedDate = DateTime.Now });
            Entities.Add(new Person { Id = 19, 
            FirstName = “Person”, LastName = 
            “Ninetenn”, CreatedDate = DateTime.Now, 
            ModifiedDate = DateTime.Now });
            Entities.Add(new Person { Id = 20, 
            FirstName = “Person”, LastName = “Twenty”, 
            CreatedDate = DateTime.Now, ModifiedDate = 
            DateTime.Now });
        }
    }</pre></li>
			</ol>
			<p>This code seeds our collection with people.</p>
			<ol>
				<li value="21">Add a new page<a id="_idIndexMarker1318"/> to the root of the<a id="_idIndexMarker1319"/> project called <code>SplashPage</code>:<pre>public partial class SplashPage : ContentPage, 
    INotifyPropertyChanged
{
    Timer _timer;
    double _progress;
    public event PropertyChangedEventHandler 
        PropertyChanged;
    public SplashPage()
    {
        InitializeComponent();
        _timer = new Timer(new TimerCallback((s) =&gt; 
            ReportProgress()), null, TimeSpan.Zero, 
                TimeSpan.FromSeconds(3));
    }
    ~SplashPage() =&gt; _timer.Dispose();
}</pre></li>
			</ol>
			<p>Our <code>SplashPage</code> is a loading page that will display progress to the user in the form of a progress<a id="_idIndexMarker1320"/> bar and label. The class<a id="_idIndexMarker1321"/> inherits from the <code>Content</code> page and implements the <code>INotifyPropertyChanged</code> event. We have a timer whose callback is a method for reporting loading progress.</p>
			<ol>
				<li value="22">Add the <code>ReportProgress</code> method:<pre>    private void ReportProgress()
    {
        _timer.Dispose();
 
        Task.Run(() =&gt;
        {
            // Run code here
 
            for (int i = 0; i &lt;= 100; i++)
            {
                Thread.Sleep(250);
                _progress = (double)i / 100;
                SafeInvokeInMainThread
                    (UpdateProgress);
            }
            SafeInvokeInMainThread(LoadMainPage);
        });
    }</pre></li>
			</ol>
			<p>This method stops the timer and runs the code to update the application loading progress status. It uses a safe<a id="_idIndexMarker1322"/> invoke method that will update<a id="_idIndexMarker1323"/> the splash screen.</p>
			<ol>
				<li value="23">Add the <code>LoadMainPage</code> method:<pre>private void LoadMainPage()
{
Application.Current.MainPage = new AppShell(new 
    BaseEntity() { Id = 1, CreatedDate = DateTime.Now, 
        ModifiedDate = DateTime.Now });
Shell.Current.GoToAsync(“//main”);
}</pre></li>
			</ol>
			<p>This method sets the application’s <code>MainPage</code> to <code>AppShell</code> and passes in a parameter of type <code>BaseEntity</code>.</p>
			<ol>
				<li value="24">Add the <code>SaveInvokeInMaInThread</code> method:<pre>private void SafeInvokeInMainThread(Action action)
{
        if (DeviceInfo.Platform == 
            DevicePlatform.WinUI)
        {
            Application.Current.Dispatcher
                .Dispatch(action);
        }
        else
        {
            MainThread.BeginInvokeOnMainThread
                (action);
        }
}</pre></li>
			</ol>
			<p>This code performs a safe invocation<a id="_idIndexMarker1324"/> on the main thread to update<a id="_idIndexMarker1325"/> the UI. The method checks the device the application is running on before calling the correct method for the device.</p>
			<ol>
				<li value="25">Add the <code>UpdateProgress</code> method:<pre>private void UpdateProgress()
    {
        LoadingProgressBar.ProgressTo(_progress, 500, 
            Easing.Linear);
        LoadingProgressLabel.Text = $”Progress Update:
             Performing load operation {(int)
                 (_progress * 100)} of 100...”;
}</pre></li>
			</ol>
			<p>This method updates the progress bar and the label.</p>
			<ol>
				<li value="26">Update the <code>SplashPage</code> XAML, as shown here:<pre>&lt;?xml version=”1.0” encoding=”utf-8” ?&gt;
&lt;ContentPage xmlns=”
      http://schemas.microsoft.com/dotnet/2021/maui”
      xmlns:x=”http://schemas.microsoft.com/winfx/
          2009/xaml”
      x:Class=”CH12_ResponsiveMAUI.SplashPage”
      Title=”SplashPage”&gt;
    &lt;VerticalStackLayout VerticalOptions=”Center”&gt;
        &lt;StackLayout HorizontalOptions=”Center” 
            VerticalOptions=”Center”&gt;
            &lt;Label FontSize=”32” Text=”Responsive 
                MAUI Example” /&gt;
            &lt;Label x:Name=”LoadingProgressLabel” 
                FontSize=”12” Text=”Loading...” /&gt;
            &lt;ProgressBar x:Name=”LoadingProgressBar” 
                Progress=”0” /&gt;
        &lt;/StackLayout&gt;
    &lt;/VerticalStackLayout&gt;
&lt;/ContentPage&gt;</pre></li>
			</ol>
			<p>This markup contains<a id="_idIndexMarker1326"/> our UI definition that will be updated<a id="_idIndexMarker1327"/> by the code when it runs.</p>
			<ol>
				<li value="27">Update <code>MainPage</code> by replacing the current XAML with the following XAML:<pre>&lt;?xml version=”1.0” encoding=”utf-8” ?&gt;
&lt;ContentPage xmlns=
    “http://schemas.microsoft.com/dotnet/2021/maui”
    xmlns:x=”http://schemas.microsoft.com/winfx/
        2009/xaml”
    x:Class=”CH12_ResponsiveMAUI.MainPage”&gt;
 
  &lt;ScrollView&gt;
      &lt;HorizontalStackLayout
          Spacing=”25”
          Padding=”30,0”
          VerticalOptions=”Center”&gt;
 
          &lt;StackLayout Margin=”20” 
              HorizontalOptions=”Start”&gt;
              &lt;CollectionView x:Name=
              “collectionView” ItemsSource=”{Binding 
                Entities}”&gt;
                  &lt;CollectionView.ItemTemplate&gt;
                      &lt;DataTemplate&gt;
                          &lt;Grid Padding=”10”&gt;
                              &lt;Grid.RowDefinitions&gt;
                                  &lt;RowDefinition 
                                  Height=”Auto” /&gt;
                              &lt;/Grid.RowDefinitions&gt;
                              &lt;Grid.ColumnDefinitions&gt;
                                  &lt;ColumnDefinition 
                                   Width=”Auto” /&gt;
                                    &lt;ColumnDefinition 
                                     Width=”Auto” /&gt;
                                    &lt;ColumnDefinition 
                                     Width=”Auto” /&gt;
                                    &lt;ColumnDefinition 
                                     Width=”Auto” /&gt;
                                    &lt;ColumnDefinition 
                                     Width=”Auto” /&gt;
                             &lt;/Grid.ColumnDefinitions&gt;
                             &lt;Label Grid.Column=”1” 
                             Text=”{Binding Id}” 
                             FontAttributes=”Bold” /&gt;
                             &lt;Label Grid.Column=”2” 
                             Text=”{Binding 
                             FirstName}” 
                             FontAttributes=”Bold” /&gt;
                             &lt;Label Grid.Column=”3” 
                             Text=”{Binding LastName}” 
                             FontAttributes=”Bold” /&gt;
                             &lt;Label Grid.Column=”4” 
                             Text=”{Binding 
                             CreatedDate}” 
                             FontAttributes=”Bold” /&gt;
                             &lt;Label Grid.Column=”5” 
                             Text=”{Binding 
                             ModifiedDate}” 
                             FontAttributes=”Bold” /&gt;
                            &lt;/Grid&gt;
                        &lt;/DataTemplate&gt;
                    &lt;/CollectionView.ItemTemplate&gt;
                &lt;/CollectionView&gt;
            &lt;/StackLayout&gt;
 
            &lt;StackLayout HorizontalOptions=”End”&gt;
                &lt;Image
                Source=”dotnet_bot.png”
                SemanticProperties.Description=”Cute 
                    dot net bot waving hi to you!”
                HeightRequest=”200”
                HorizontalOptions=”Center” /&gt;
 
                &lt;Label
                Text=”Hello, World!”
                SemanticProperties.HeadingLevel=
                    “Level1”
                FontSize=”32”
                HorizontalOptions=”Center” /&gt;
 
                &lt;Label
                Text=”Welcome to .NET Multi-platform 
                    App UI”
                SemanticProperties.HeadingLevel=
                    “Level2”
                SemanticProperties.Description=
                   “Welcome to dot net Multi platform 
                       App U I”
                FontSize=”18”
                HorizontalOptions=”Center” /&gt;
 
                &lt;Button
                x:Name=”CounterBtn”
                Text=”Click me”
                SemanticProperties.Hint=”Counts the 
                    number of times you click”
                Clicked=”OnCounterClicked”
                HorizontalOptions=”Center” /&gt;
            &lt;/StackLayout&gt;
 
        &lt;/HorizontalStackLayout&gt;
    &lt;/ScrollView&gt;
 
&lt;/ContentPage&gt;</pre></li>
			</ol>
			<p>This code updates<a id="_idIndexMarker1328"/> the original source<a id="_idIndexMarker1329"/> by adding a table of people.</p>
			<ol>
				<li value="28">Add a <code>PeopleRepository</code> class variable and update the constructor of the <code>MainPage</code> class, as shown here:<pre>    PeopleRepository _peopleRepository;
 
    public MainPage()
    {
        InitializeComponent();
        BindingContext = new PeopleViewModel();
}</pre></li>
			</ol>
			<p>This code modifies our <code>MainPage</code> by setting its <code>BindingContext</code> to <code>PeopleViewModel</code>.</p>
			<ol>
				<li value="29">Run the <a id="_idIndexMarker1330"/>code, and you should see the following<a id="_idIndexMarker1331"/> screen:</li>
			</ol>
			<div><div><img src="img/Figure_12.10_B16617.jpg" alt="Figure 12.10 – The splash page&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.10 – The splash page</p>
			<p>The following screen is what you’ll see next:</p>
			<div><div><img src="img/Figure_12.11_B16617.jpg" alt="Figure 12.11 – The main form with a table in a scroll view with a button that responds to clicks&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.11 – The main form with a table in a scroll view with a button that responds to clicks</p>
			<p>We have managed<a id="_idIndexMarker1332"/> to build a responsive splash screen that also populates<a id="_idIndexMarker1333"/> a table and responds to button clicks. That concludes our look at MAUI. We will now move on to WinUI 3.</p>
			<h1 id="_idParaDest-230"><a id="_idTextAnchor235"/>Building a responsive UI with WinUI 3</h1>
			<p>In this section, we will look<a id="_idIndexMarker1334"/> at how to provide user feedback<a id="_idIndexMarker1335"/> using the <code>ProgressRing</code> component while performing a long-running operation in WinUI 3 applications. When your users trigger a long-running operation that holds up the UI, it is a good idea to provide user feedback until the operation completes. Let’s write a simple application that simulates a long-running operation using the following steps:</p>
			<ol>
				<li value="1">Start a new WinUI3 application and call it <code>CH12_ResponsiveWinUI3</code>.</li>
				<li>Open <code>MainWindow.xaml</code> and replace the existing XAML between the Window tags with the following XAML:<pre>&lt;StackPanel VerticalAlignment=”Center” 
    HorizontalAlignment=”Center”&gt;
    &lt;ProgressRing x:Name=”ProgressRingIndicator1” 
        IsActive=”{x:Bind IsWorking, Mode=OneWay}” 
          Visibility=”{x:Bind IsWorking, Mode=OneWay}” 
             /&gt;
    &lt;Button x:Name=”DoWorkButton” Content=”Do Work” 
       Click=”DoWorkButton_Click” /&gt;
    &lt;TextBlock x:Name=”MessageTextBlock” /&gt;
&lt;/StackPanel&gt;</pre></li>
			</ol>
			<p>We have used <code>OneWay</code> binding to bind our the <code>ProgressRing</code> class' <code>IsActive</code> and <code>Visibility</code> properties to the <code>IsWorking</code> property.</p>
			<ol>
				<li value="3">In the code<a id="_idIndexMarker1336"/> behind the class, implement<a id="_idIndexMarker1337"/> the <code>INotifyPropertyChanged</code> interface.</li>
				<li>Add the following members to the class:<pre>private DispatcherTimer _dispatcherTimer;
public event PropertyChangedEventHandler 
    PropertyChanged;
private bool _isWorking;</pre></li>
			</ol>
			<p><code>_dispatcherTimer</code> will be used to simulate a long-running operation. The <code>PropertyChanged</code> event will be used to notify <code>ProgressRing</code> that the <code>IsWorking</code> property has changed, and the <code>_isWorking</code> variable will be updated to let <code>ProgressRing</code> know to either show or hide itself.</p>
			<ol>
				<li value="5">Add a method to raise the <code>PropertyChanged</code> event if it is not <code>null</code>:<pre>private void NotifyPropertyChanged(string property)
{
if (PropertyChanged != null)
{
PropertyChanged(this, 
    new PropertyChangedEventArgs(property));
}
}</pre></li>
			</ol>
			<p>When we set the <code>IsWorking</code> property, we call this method so that the <code>PropertyChanged</code> event is raised.</p>
			<ol>
				<li value="6">Add the following three lines to the constructor:<pre>_dispatcherTimer = new DispatcherTimer();
_dispatcherTimer.Interval = TimeSpan.FromSeconds(10);
_dispatcherTimer.Tick += DispatcherTimer_Tick;</pre></li>
			</ol>
			<p>These three lines<a id="_idIndexMarker1338"/> instantiate our <code>DispatcherTimer</code>, set its interval<a id="_idIndexMarker1339"/> to <code>10</code> seconds, and add the <code>Tick</code> event handler.</p>
			<ol>
				<li value="7">We will now add the <code>DispatcherTimer_Tick</code> event handler:<pre>private void DispatcherTimer_Tick(object sender, 
    object e)
{
_dispatcherTimer.Stop();
_dispatcherTimer.Tick -= DispatcherTimer_Tick;
IsWorking = false;
MessageTextBlock.Text = “Work completed.”;
}</pre></li>
			</ol>
			<p>We stop the timer and remove the event handler to stop it from firing again and being held in memory. Then, we set the <code>IsWorking</code> property to <code>false</code>, which results in <code>ProgressRing</code> being hidden and made inactive. Then, we add a message to <code>MessageTextBlock</code>.</p>
			<ol>
				<li value="8">Now, add the <code>IsWorking</code> property:<pre>public bool IsWorking
{
get { return _isWorking; }
set
     {
             _isWorking = value;
           NotifyPropertyChanged(“IsWorking”);
}
}</pre></li>
				<li>When setting<a id="_idIndexMarker1340"/> our property, we call the <code>NotifyPropertyChanged</code> method<a id="_idIndexMarker1341"/> that raises the <code>PropertyChanged</code> event to let <code>ProgressRing</code> know that the property has changed.</li>
				<li>Now, add the code for the button click:<pre>private void DoWorkButton_Click(object sender, 
    RoutedEventArgs e)
{
DoWorkButton.Visibility = Visibility.Collapsed;
IsWorking = true;
_dispatcherTimer.Start();
}</pre></li>
			</ol>
			<p>We collapse our button, as it is no longer needed. Set the <code>IsWorking</code> property to <code>true</code>, and start our <code>DispatcherTimer</code>.</p>
			<ol>
				<li value="11">Run the code. You should see a single button that says <code>ProgressRing</code> for 10 seconds. Then, <code>ProgressRing</code> should disappear and be replaced with the text <strong class="bold">Work completed</strong>.</li>
			</ol>
			<p>Now that we have<a id="_idIndexMarker1342"/> concluded our look at responsive UIs, let’s summarize<a id="_idIndexMarker1343"/> what we have learned.</p>
			<h1 id="_idParaDest-231"><a id="_idTextAnchor236"/>Summary</h1>
			<p>In this chapter, you learned how to work with various UI frameworks to make UIs responsive. First, we looked at WinForms. With WinForms, we enabled DPI and long file path awareness. We also ensured that despite running long background tasks, we could page through data in a table and perform other UI operations, and we also added a splash screen that updates with the loading progress.</p>
			<p>With WPF, we managed to produce a window that has a long-running task that can be canceled with progress indication. It also has a paged data table and button that, when clicked, updates the click count label.</p>
			<p>Then, we looked at memory caching and distributed caching in ASP.NET. We also used AJAX to update part of the currently displayed page and looked at WebSockets and SignalR. We implemented a real-time ASP.NET chat application using SignalR.</p>
			<p>We then went on to look at MAUI. In particular, we looked at layouts, accessibility, and <code>BlazorWebView</code>. Finally, we looked at WinUI 3 and how to provide user feedback when a long-running process is taking place.</p>
			<p>In the next chapter, we will be looking at distributed systems. But first, try answering the questions in the next section, and then do some further reading to enhance your knowledge of responsive UIs.</p>
			<h1 id="_idParaDest-232"><a id="_idTextAnchor237"/>Questions</h1>
			<ol>
				<li value="1">How can you make a WinForms application scale properly on high-DPI screens or normal-DPI large screens?</li>
				<li>How do you cope with long file paths on Windows?</li>
				<li>How can you keep users engaged when your application takes a long time to start?</li>
				<li>How can you keep an application responsive to user input when you have a long-running process in operation?</li>
				<li>What caching methods can you use to speed up access to resources?</li>
				<li>How can you load only part of a web page?</li>
				<li>Name two frameworks for performing network data transfer and real-time networked communication?</li>
				<li>Name three accessibility methods available in MAUI.</li>
				<li>How do you include an existing Blazor web application in an MAUI project?</li>
				<li>When your application is already loaded, and a user kicks off a long-running operation, what controls can you use to provide user feedback so that users don’t think your WinUI 3 application has crashed?</li>
			</ol>
			<h1 id="_idParaDest-233"><a id="_idTextAnchor238"/>Further reading</h1>
			<ul>
				<li><em class="italic">Which is best? WebSockets or SignalR</em>: <a href="https://dotnetplaybook.com/which-is-best-websockets-or-signalr/ ">https://dotnetplaybook.com/which-is-best-websockets-or-signalr/</a></li>
				<li><em class="italic">Why is SignalR/messagepack 2 times faster than gRPC/protobuf?</em>: <a href="https://github.com/grpc/grpc-dotnet/issues/812 ">https://github.com/grpc/grpc-dotnet/issues/812</a></li>
				<li><em class="italic">Tutorial: Get started with ASP.NET Core SignalR</em>: <a href="https://docs.microsoft.com/aspnet/core/tutorials/signalr?view=aspnetcore-5.0&amp;tabs=visual-studio ">https://docs.microsoft.com/aspnet/core/tutorials/signalr?view=aspnetcore-5.0&amp;tabs=visual-studio</a></li>
				<li><em class="italic">WebSocket</em>: <a href="https://javascript.info/websocket">https://javascript.info/websocket</a></li>
				<li><em class="italic">Migrate your app from Xamarin.Forms</em>: https://docs.microsoft.com/dotnet/maui/get-started/migrate</li>
				<li><em class="italic">Xamarin.Forms Made Easy</em>: <a href="https://winstongubantes.blogspot.com/2018/09/backgrounding-with-xamarinforms-easy-way.html">https://winstongubantes.blogspot.com/2018/09/backgrounding-with-xamarinforms-easy-way.html</a></li>
				<li><em class="italic">Xamarin – Working with threads</em>: <a href="https://lukealderton.com/blog/posts/2016/october/xamarin-forms-working-with-threads/ ">https://lukealderton.com/blog/posts/2016/october/xamarin-forms-working-with-threads/</a></li>
				<li>Creating Android emulators on Windows: <a href="https://docs.microsoft.com/xamarin/android/get-started/installation/android-emulator/device-manager?tabs=windows&amp;pivots=windows">https://docs.microsoft.com/xamarin/android/get-started/installation/android-emulator/device-manager?tabs=windows&amp;pivots=windows</a></li>
				<li>Installing the Microsoft OpenJDK: <a href="https://docs.microsoft.com/xamarin/android/get-started/installation/openjdk ">https://docs.microsoft.com/xamarin/android/get-started/installation/openjdk</a></li>
				<li><em class="italic">Single-project MSIX Packaging Tools for VS 2022</em>: https://marketplace.visualstudio.com/items?itemName=ProjectReunion.MicrosoftSingleProjectMSIXPackagingToolsDev17</li>
				<li><em class="italic">Improving rendering performance with Blazor component virtualization</em>: <a href="https://www.daveabrock.com/2020/10/20/blazor-component-virtualization/#:~:text=Improve%20rendering%20performance%20with%20Blazor%20component%20virtualization%20Use,the%20entire%20HTML%20tree%20loads%20from%20the%20server">https://www.daveabrock.com/2020/10/20/blazor-component-virtualization/#:~:text=Improve%20rendering%20performance%20with%20Blazor%20component%20virtualization%20Use,the%20entire%20HTML%20tree%20loads%20from%20the%20server</a>.</li>
				<li><em class="italic">How to Reuse Xamarin.Forms Custom Renderers in .NET MAUI</em>: <a href="https://www.syncfusion.com/blogs/post/how-to-reuse-xamarin-forms-custom-renderers-in-net-maui.aspx">https://www.syncfusion.com/blogs/post/how-to-reuse-xamarin-forms-custom-renderers-in-net-maui.aspx</a></li>
				<li><em class="italic">Announcing .NET MAUI Preview 7</em>: <a href="https://devblogs.microsoft.com/dotnet/announcing-net-maui-preview-7/">https://devblogs.microsoft.com/dotnet/announcing-net-maui-preview-7/</a> </li>
				<li><em class="italic">.NET Multi-platform App UI</em>: <a href="https://dotnet.microsoft.com/en-us/apps/maui">https://dotnet.microsoft.com/en-us/apps/maui</a></li>
			</ul>
		</div>
	</body></html>