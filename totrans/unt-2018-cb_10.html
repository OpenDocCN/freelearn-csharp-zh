<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">3D Animation</h1>
                </header>
            
            <article>
                
<p>In this chapter, we will cover the following:</p>
<ul>
<li>Configuring a character's Avatar and idle animation</li>
<li>Moving your character with root motion and Blend Trees</li>
<li>Mixing animations with Layers and Masks</li>
<li>Organizing States into Sub-State Machines</li>
<li>Transforming the Character Controller via script</li>
<li>Adding rigid props to animated characters</li>
<li>Using Animation Events to throw an object</li>
<li>Applying Ragdoll physics to a character</li>
<li>Rotating the character's torso to aim a weapon</li>
<li>Creating geometry with Probuilder</li>
<li>Creating a game with the 3D Gamekit</li>
<li>Importing third-party 3D models and animations from Mixamo</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p>The <strong><span class="KeyWordPACKT">Mecanim</span></strong> animation system has revolutionized how characters are animated and controlled within Unity. In this chapter, we will learn how to take advantage of its flexibility, power, and friendly and highly visual interface.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The big picture</h1>
                </header>
            
            <article>
                
<p>Controlling a playable character with the <strong><span class="KeyWordPACKT">Mecanim</span></strong> system might look like a complex task, but it is actually very straightforward:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/34f06f4e-109a-415a-8a94-972a3bbab6ea.png"/></p>
<p>By the end of the chapter, you will have gained a basic understanding of the <span class="KeyWordPACKT">Mecanim</span> system. For a more complete overview of the subject, consider taking a look at Jamie Dean's <em><span class="ItalicsPACKT">Unity Character Animation with Mecanim</span></em>, also published by <span class="KeyWordPACKT">Packt Publishing</span>.</p>
<div class="packt_infobox">All the recipes will make use of <span class="KeyWordPACKT">Mixamo</span> motion packs. <span class="KeyWordPACKT">Mixamo</span> is a complete solution for character production, rigging, and animation. In fact, the character used was designed with <span class="KeyWordPACKT">Mixamo's</span> character creation software called Fuse and rigged with the <span class="KeyWordPACKT">Mixamo</span> <span class="ScreenTextPACKT"><span class="packt_screen">Auto-Rigger</span></span>. You can find out more about <span class="KeyWordPACKT">Mixamo</span> and their products at Unity's <span class="ScreenTextPACKT"><span class="packt_screen">Asset Store</span></span> or the Mixamo website:<br/>
<a href="https://assetstore.unity.com/packages/3d/animations/melee-axe-pack-35320"><span class="URLPACKT">https://assetstore.unity.com/packages/3d/animations/melee-axe-pack-35320</span></a><br/>
<a href="https://www.mixamo.com/"><span class="URLPACKT">https://www.mixamo.com/</span></a></div>
<p>Please note that although <span class="KeyWordPACKT">Mixamo</span> offers <strong>Mecanim</strong>-ready characters and animation clips, for the recipes in this chapter, <span>we will use</span><span> </span><span>unprepared animation clips. The reason for this is to make you more confident when dealing with assets obtained by other methods and sources.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring a character's Avatar and idle animation</h1>
                </header>
            
            <article>
                
<p>One feature that makes <strong><span class="KeyWordPACKT">Mecanim</span></strong> so flexible and powerful is the ability to quickly reassign <span class="KeyWordPACKT"><span class="packt_screen">Animation Clips</span></span> from one character to another. This is made possible through the use of <strong><span class="KeyWordPACKT">Avatars</span></strong>, which are basically a layer between your character's original rig and Unity's <strong><span class="KeyWordPACKT">Animator</span></strong> system.</p>
<p>In this recipe, we will learn how to configure an <strong><span class="KeyWordPACKT">Avatar</span></strong> skeleton on a rigged character.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, you will need the <span class="ScreenTextPACKT"><span class="packt_screen">MsLaser@T-Pose.fbx</span></span> and <span class="ScreenTextPACKT"><span class="packt_screen">Swat@rifle_aiming_idle.fbx</span></span> files, which are provided in the <kbd>09_03</kbd><span> </span><span>folder</span><span>.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To configure an Avatar skeleton, follow these steps:</p>
<ol>
<li>Import the <span class="ScreenTextPACKT"><span class="packt_screen">MsLaser@T-Pose.fbx</span></span> and <span class="ScreenTextPACKT"><span class="packt_screen">Swat@rifle_aiming_idle.fbx</span></span> files into your project.</li>
<li>Select the <span class="packt_screen"><span class="ScreenTextPACKT">MsLaser@T-Pose</span> model</span> from the <span class="KeyWordPACKT"><span class="packt_screen">Project</span> panel</span>.</li>
<li>In the <span class="ScreenTextPACKT"><span class="packt_screen">Inspector</span></span>, under <span class="ScreenTextPACKT"><span class="packt_screen">MsLaser@T-Pose</span></span> Import Settings, activate the <span class="ScreenTextPACKT"><span class="packt_screen">Rig</span></span> section. Change <span class="ScreenTextPACKT"><span class="packt_screen">Animation Type</span></span> to <span class="ScreenTextPACKT"><span class="packt_screen">Humanoid</span></span>. Then, leave <span class="ScreenTextPACKT"><span class="packt_screen">Avatar Definition</span></span> as <span class="ScreenTextPACKT"><span class="packt_screen">Create From this Model</span></span>. Now, click <span class="ScreenTextPACKT"><span class="packt_screen">Apply</span></span> to apply these settings. Finally, click on the <span class="ScreenTextPACKT"><span class="packt_screen">Configure...</span></span> button:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/87582a63-d224-4996-92ad-46f949695cdb.png"/></p>
<ol start="4">
<li>The <span class="KeyWordPACKT"><span class="packt_screen">Inspector</span></span> will show the newly created <strong><span class="ScreenTextPACKT">Avatar</span></strong>. Observe how Unity correctly mapped the bones of our character to its structure, assigning, for instance, the <span class="ScreenTextPACKT"><span class="packt_screen">mixamoRig:LeftForeArm</span></span> bone as the <span class="packt_screen"><span class="ScreenTextPACKT">Avatar's</span> <span class="ScreenTextPACKT">Lower Arm</span></span>. We could, of course, reassign bones if needed. For now, just click on the <span class="ScreenTextPACKT"><span class="packt_screen">Done</span></span> button to close the view:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/bd882499-ea2a-46e9-95a9-8669556fc202.png"/></p>
<ol start="5">
<li>Now that we have our <strong><span class="ScreenTextPACKT">Avatar</span></strong> ready, let's configure our animation for the <span class="ScreenTextPACKT"><span class="packt_screen">Idle</span></span> state. From the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel, select the <span class="ScreenTextPACKT"><span class="packt_screen">Swat@rifle_aiming_idle</span></span> file.</li>
<li>Select the <span class="ScreenTextPACKT"><span class="packt_screen">Rig</span></span> section, change <span class="ScreenTextPACKT"><span class="packt_screen">Animation Type</span></span> to <span class="ScreenTextPACKT"><span class="packt_screen">Humanoid</span>,</span> and leave <span class="packt_screen"><span class="ScreenTextPACKT">Avatar</span> <span class="ScreenTextPACKT">Definition</span></span> as <span class="ScreenTextPACKT"><span class="packt_screen">Create From this Model</span></span>. Confirm by clicking on <span class="ScreenTextPACKT"><span class="packt_screen">Apply</span></span>.</li>
</ol>
<ol start="7">
<li>Select the <span class="ScreenTextPACKT"><span class="packt_screen">Animations</span></span> section (to the right of the <span class="ScreenTextPACKT">Rig</span>). The <span class="ScreenTextPACKT"><span class="packt_screen">rifle_aiming_idle</span></span> clip should be selected. Drag <span class="ScreenTextPACKT"><span class="packt_screen">MsLaser@T-Pose</span></span> to the <span class="ScreenTextPACKT"><span class="packt_screen">Preview</span></span> area at the bottom of the <strong><span class="KeyWordPACKT">Inspector</span></strong>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/3a193af9-5bb5-4d3b-a0db-f27766a6f40a.png"/></p>
<ol start="8">
<li>With <span class="packt_screen"><span class="ScreenTextPACKT">rifle</span><span class="ScreenTextPACKT">_aiming_idle</span></span> selected from the <span class="packt_screen"><span class="ScreenTextPACKT">Clips</span></span> list, check the <span class="ScreenTextPACKT"><span class="packt_screen">Loop Time</span></span> and <span class="ScreenTextPACKT"><span class="packt_screen">Loop Pose</span></span> options. Also, click on the <span class="ScreenTextPACKT"><span class="packt_screen">Clamp Range</span></span> button to adjust the timeline to the actual time of the <strong><span class="KeyWordPACKT">Animation Clip</span></strong>. Then, under <span class="ScreenTextPACKT"><span class="packt_screen">Root Transform Rotation</span></span>, check <span class="ScreenTextPACKT"><span class="packt_screen">Bake Into Pose</span></span> and select <span class="ScreenTextPACKT"><span class="packt_screen">Based Upon | Original</span></span>. Under <span class="ScreenTextPACKT"><span class="packt_screen">Root Transform Position (Y)</span></span>, check <span class="ScreenTextPACKT"><span class="packt_screen">Bake Into Pose</span></span> and select <span class="ScreenTextPACKT"><span class="packt_screen">Based upon Original</span></span>. Under <span class="ScreenTextPACKT"><span class="packt_screen">Root Transform Position (XZ)</span></span>, leave <span class="ScreenTextPACKT"><span class="packt_screen">Bake Into Pose</span></span> unchecked and select <span class="ScreenTextPACKT"><span class="packt_screen">Based Upon (at Start) | Center of Mass</span></span>. Finally, click on <span class="ScreenTextPACKT"><span class="packt_screen">Apply</span></span> to confirm the changes:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/bcae7636-51cf-4628-a618-905a08048cff.png"/></p>
<ol start="9">
<li>In order to access <strong><span class="KeyWordPACKT">Animation Clips</span></strong> and play them, we need to create a <span class="ScreenTextPACKT"><span class="packt_screen">Controller</span></span>. Do this by choosing <span class="KeyWordPACKT">Project</span> panel menu: <span class="ScreenTextPACKT"><span class="packt_screen">Create | Animator Controller</span></span>. Name it <span class="ScreenTextPACKT"><span class="packt_screen">MainCharacter</span>.</span></li>
<li>Double-click on the <span class="ScreenTextPACKT"><span class="packt_screen">Animator Controller</span></span> to open the <strong><span class="KeyWordPACKT">Animator</span></strong> panel.</li>
<li>From the <strong><span class="KeyWordPACKT">Animator</span></strong> panel, right-click on the grid to open a context menu. Then, select the <span class="ScreenTextPACKT"><span class="packt_screen">Create State | Empty</span></span> option. A new box named <span class="ScreenTextPACKT"><span class="packt_screen">New State</span></span> will appear. It will be in orange, indicating that it is the default state:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b5d8d019-5a2f-466b-ba7e-d62e86df030f.png" style="width:34.83em;height:9.50em;"/></p>
<ol start="12">
<li>Select <span class="packt_screen"><span class="ScreenTextPACKT">New Stat</span><span class="ScreenTextPACKT">e</span></span> and, in the <span class="ScreenTextPACKT"><span class="packt_screen">Inspector</span></span>, change its name to <span class="ScreenTextPACKT"><span class="packt_screen">Idle</span></span>. Also, in the <span class="ScreenTextPACKT"><span class="packt_screen">Motion</span></span> field, choose <span class="ScreenTextPACKT"><span class="packt_screen">rifle_aiming_idle</span></span> by either selecting it from the list or dragging it from the <span class="KeyWordPACKT"><span class="packt_screen">Proje</span><span class="packt_screen"><span class="packt_screen">c</span>t</span></span> panel:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/ed89f835-c4a4-4670-b3f3-881e6eee7baf.png" style="width:39.92em;height:10.92em;"/></p>
<ol start="13">
<li>Drag the <span class="ScreenTextPACKT"><span class="packt_screen">MsLaser@T-Pose</span></span> model from the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel into the <span class="KeyWordPACKT"><span class="packt_screen">Hierarchy</span></span> and place it in the <span class="KeyWordPACKT"><span class="packt_screen">Scene</span></span>.</li>
<li>Select <span class="ScreenTextPACKT"><span class="packt_screen">MsLaser@T-Pose</span></span> from the <span class="KeyWordPACKT"><span class="packt_screen">Hierarchy</span></span> and observe its <strong><span class="ScreenTextPACKT">Animator</span></strong> component in the <span class="KeyWordPACKT"><span class="packt_screen">Inspector</span></span>. Then, assign the newly created <span class="ScreenTextPACKT"><span class="packt_screen">MainCharacter</span></span> controller to its <span class="ScreenTextPACKT"><span class="packt_screen">Controller</span></span> field:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/8e06a3e2-4293-4a2f-b575-47216ae51927.png" style="width:37.50em;height:15.67em;"/></p>
<ol start="15">
<li>Play your <strong><span class="KeyWordPACKT">Sc</span><span class="KeyWordPACKT">ene</span></strong> to see the character correctly animated.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Preparing our character for animation took many steps. First, we created its <span class="ScreenTextPACKT"><span class="packt_screen">Avatar</span></span>, based on the character model's original bone structure. Then, we set up the <strong><span class="KeyWordPACKT">Animation Clip</span></strong> (which, as the character mesh, is stored in an <span class="ScreenTextPACKT"><span class="packt_screen">.fbx</span></span> file), using its own <span class="ScreenTextPACKT"><span class="packt_screen">Avatar</span></span>.</p>
<p>After this, we adjusted the <span class="ScreenTextPACKT"><span class="packt_screen">Animation Clip</span></span>, clamping its size and making it a loop. We also baked its <span class="packt_screen"><span class="ScreenTextPACKT">Root Transform</span> <span class="ScreenTextPACKT">Rotation</span></span> to follow the original file's orientation. Finally, an <span class="ScreenTextPACKT"><span class="packt_screen">Animator Controller</span></span> was created, and the edited <strong><span class="ScreenTextPACKT">Animation Clip</span></strong> was made into its default <span class="ScreenTextPACKT"><span class="packt_screen">Animation State</span></span>.</p>
<p>The concept of the <span class="ScreenTextPACKT"><span class="packt_screen">Avatar</span></span> is what makes Mecanim so flexible. Once you have an <strong><span class="KeyWordPACKT">Animator Controller</span></strong>, you can apply it to other humanoid characters, as long as they have an <span class="ScreenTextPACKT"><span class="packt_screen">Avatar</span></span> body mask.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Here are some ways to go further with this recipe.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Use Controller with another 3D character Avatar</h1>
                </header>
            
            <article>
                
<p>Let's swap <span class="ScreenTextPACKT"><span class="packt_screen">MsLaser</span></span> for a <span class="ScreenTextPACKT"><span class="packt_screen">Mascot 3D</span></span> character. Do the following:</p>
<ol>
<li>Import the provided model, <span class="ScreenTextPACKT"><span class="packt_screen">mascot.fbx</span></span>.</li>
<li>The apply steps 3 and 4 for this character to create its <span class="packt_screen">Avatar</span>.</li>
<li>Drag an instance of the model into the <strong><span class="KeyWordPACKT">Scene</span></strong>.</li>
<li>In the Inspector for its <span class="ScreenTextPACKT"><span class="packt_screen">Animator Component</span></span>, set the <span class="ScreenTextPACKT"><span class="packt_screen">Controller</span></span> to the <span class="ScreenTextPACKT"><span class="packt_screen">MainCharacter Animator Controller</span></span> you created in this recipe.</li>
<li>Run the <span class="KeyWordPACKT"><span class="packt_screen">Scene</span>;</span> you should see the mascot playing the <span class="ScreenTextPACKT"><span class="packt_screen">rifle_aiming_idle</span></span> animation clip.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<p>To read more information about the Animator Controller, check out Unity's documentation at <a href="http://docs.unity3d.com/Manual/class-AnimatorController.html"><span class="URLPACKT">http://docs.unity3d.com/Manual/class-AnimatorController.html</span></a>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Moving your character with root motion and Blend Trees</h1>
                </header>
            
            <article>
                
<p>The Mecanim animation system is capable of applying <span class="ScreenTextPACKT"><span class="packt_screen">Root Motion</span></span> to characters. In other words, it actually moves the character according to the animation clip, as opposed to arbitrarily translating the character model while playing an in-place animation cycle. This makes most of the Mixamo animation clips perfect for use with Mecanim.</p>
<p>Another feature of the animation system is <span class="ScreenTextPACKT"><span class="packt_screen">Blend Trees</span></span>, which can blend <span class="ScreenTextPACKT"><span class="packt_screen">Animation Clips</span></span> smoothly and easily. In this recipe, we will take advantage of these features to make our character walk/run forward and backward, and also strafe right and left at different speeds.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, we have prepared a Unity package named <span class="ScreenTextPACKT"><span class="packt_screen">Character_02</span></span>, containing a character and featuring a basic <strong><span class="KeyWordPACKT">Animator Controller</span></strong>. The package can be found inside the <kbd>09_02</kbd> folder, along with the FBX files for the animation clips you need.</p>
<div class="packt_infobox">There are two ways to import animations in Unity. One approach involves having each animation as a separate file, named in the form <kbd>modelName@animation</kbd>, such as <kbd>MsLazer@idle</kbd>, <kbd>MsLazer@jumping</kbd>, and so on. The other approach is when a model has several animations all in a single take, in which case you can break the take into separate named animation clips in the Unity editor, specifying the start and end frame for each clip. In this chapter, we'll use the first approach, since it's more straightforward. Learn more from the Unity documentation at <a href="https://docs.unity3d.com/Manual/Splittinganimations.html">https://docs.unity3d.com/Manual/Splittinganimations.html</a>.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To apply <span class="ScreenTextPACKT"><span class="packt_screen">Root Motion</span></span> to your character using <span class="ScreenTextPACKT"><span class="packt_screen">Blend Trees</span></span>, follow these steps:</p>
<ol>
<li>Import <span class="ScreenTextPACKT"><span class="packt_screen">Character_02.unityPackage</span></span> into a new project. Also, import the following FBX files:
<ul>
<li><span class="ScreenTextPACKT"><span class="packt_screen">Swat@rifle_run</span></span></li>
<li><span class="ScreenTextPACKT"><span class="packt_screen">Swat@run_backward</span></span></li>
<li><span class="ScreenTextPACKT"><span class="packt_screen">Swat@strafe</span></span></li>
<li><span class="ScreenTextPACKT"><span class="packt_screen">Swat@strafe_2</span></span></li>
<li><span class="ScreenTextPACKT"><span class="packt_screen">Swat@strafe_left</span></span></li>
<li><span class="ScreenTextPACKT"><span class="packt_screen">Swat@strafe_right</span></span></li>
<li><span class="ScreenTextPACKT"><span class="packt_screen">Swat@walking</span></span></li>
<li><span class="ScreenTextPACKT"><span class="packt_screen">S<span class="packt_screen">w</span></span><span class="packt_screen">at@walking_backward</span></span></li>
</ul>
</li>
<li>We need to configure our <span class="ScreenTextPACKT"><span class="packt_screen">Animation Clips</span></span>. From the <span class="KeyWordPACKT">Project</span> panel, select <span class="ScreenTextPACKT"><span class="packt_screen">Swat@rifle_run</span></span>.</li>
<li>Activate the <span class="ScreenTextPACKT"><span class="packt_screen">Rig</span></span> section. Change <span class="ScreenTextPACKT"><span class="packt_screen">Animation Type</span></span> to <span class="ScreenTextPACKT"><span class="packt_screen">Humanoid</span></span> and <span class="ScreenTextPACKT"><span class="packt_screen">Avatar Definition</span></span> to <span class="ScreenTextPACKT"><span class="packt_screen">Create From this Model</span></span>. Confirm by clicking on <span class="ScreenTextPACKT"><span class="packt_screen">Apply</span>:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/488103ca-0a42-4c68-bce1-3285395ed716.png" style="width:41.58em;height:14.25em;"/></p>
<ol start="4">
<li>Now, activate the <span class="ScreenTextPACKT"><span class="packt_screen">Animations</span></span> section (to the right of <span class="ScreenTextPACKT"><span class="packt_screen">Rig</span></span>). Clip <span class="ScreenTextPACKT"><span class="packt_screen">rifle_run</span></span> should be selected. The <span class="ScreenTextPACKT"><span class="packt_screen">Preview</span></span> area (at the bottom of the <strong><span class="KeyWordPACKT">Inspector</span></strong>) will display the message <span class="packt_screen">No model is available</span> for preview. Drag <span class="ScreenTextPACKT"><span class="packt_screen">MsLaser@T-Pose</span></span> onto the <span class="ScreenTextPACKT"><span class="packt_screen">Preview</span></span> area.</li>
<li>With asset <span class="ScreenTextPACKT"><span class="packt_screen">Swat@rifle_run</span></span> still selected in the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel, in the <strong><span class="KeyWordPACKT">Inspector</span></strong> check the <span class="ScreenTextPACKT"><span class="packt_screen">Loop Time</span></span> and <span class="ScreenTextPACKT"><span class="packt_screen">Loop Pose</span></span> options. Also, click on the <span class="ScreenTextPACKT"><span class="packt_screen">Clamp Range</span></span> button to adjust the timeline to the actual time of the animation clip. Click on <span class="ScreenTextPACKT"><span class="packt_screen">Apply</span></span> to confirm these changes:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/c27e89d8-2cbf-401a-9dbf-4d61af337893.png" style="width:37.58em;height:9.00em;"/></p>
<p class="mce-root"/>
<p class="mce-root"/>
<ol start="6">
<li>Then, under <span class="ScreenTextPACKT"><span class="packt_screen">Root Transform Rotation</span></span>, check <span class="ScreenTextPACKT"><span class="packt_screen">Bake Into Pose</span></span> and select <span class="ScreenTextPACKT"><span class="packt_screen">Based Upon | Original</span></span>. Under <span class="ScreenTextPACKT"><span class="packt_screen">Root Transform Position (Y)</span></span>, check <span class="ScreenTextPACKT"><span class="packt_screen">Bake Into Pose</span></span> and select <span class="ScreenTextPACKT"><span class="packt_screen">Based Upon (at Start) | Original</span></span>. Under <span class="ScreenTextPACKT"><span class="packt_screen">Root Transform Position (XZ)</span></span>, leave <span class="ScreenTextPACKT"><span class="packt_screen">Bake Into Pose</span></span> unchecked and select <span class="ScreenTextPACKT"><span class="packt_screen">Based Upon (at Start) | Center of Mass</span></span>. Finally, click on <span class="ScreenTextPACKT"><span class="packt_screen">Apply</span></span> to confirm the changes:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/8ace8f4c-4f86-46e2-9add-64cda34e9120.png"/></p>
<ol start="7">
<li>Repeat steps 3 to 6 for each one of the following animation clips: <span class="ScreenTextPACKT"><span class="packt_screen">Swat@run_backward</span>, <span class="packt_screen">Swat@strafe</span>, <span class="packt_screen">Swat@strafe_2</span>, <span class="packt_screen">Swat@strafe_left</span>, <span class="packt_screen">Swat@strafe_right</span>, <span class="packt_screen">Swat@walking</span>, and <span class="packt_screen">Swat@walking_backward</span>.</span></li>
<li>Add a <span class="ScreenTextPACKT">3D Plane</span> to the <strong><span class="KeyWordPACKT">Scene</span></strong>, choose menu: <span class="ScreenTextPACKT"><span class="packt_screen">Create | 3D Object | Plane</span></span>.</li>
<li>Drag an instance of the <span class="ScreenTextPACKT"><span class="packt_screen">MsLaser</span></span> prefab into the <strong><span class="KeyWordPACKT">Scene</span></strong> and position it on the <span class="ScreenTextPACKT"><span class="packt_screen">3D Plane</span></span>.</li>
<li>From the <span class="ScreenTextPACKT"><span class="packt_screen">Hierarchy</span></span> panel, select the <span class="ScreenTextPACKT"><span class="packt_screen">MsLase</span><span class="packt_screen">r</span></span> GameObject. In the <span class="KeyWordPACKT"><strong>Inspector</strong>,</span> add a <span class="ScreenTextPACKT"><span class="packt_screen">Character Controller</span></span> component to it (click <span class="ScreenTextPACKT"><span class="packt_screen">Add Component</span></span> and choose <span class="ScreenTextPACKT"><span class="packt_screen">Component | Physics | Character Controller</span></span>). Then, set its <span class="ScreenTextPACKT"><span class="packt_screen">Skin Width</span></span> to 0.0001 and its <span class="ScreenTextPACKT"><span class="packt_screen">Center</span></span> as (0, 0.9, 0); also, change its <span class="ScreenTextPACKT"><span class="packt_screen">Radius</span></span> to 0.34 and its <span class="ScreenTextPACKT"><span class="packt_screen">Height</span></span> to 1.79:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/1a6ab6f6-580e-4e68-8958-da19d36f1304.png"/></p>
<ol start="11">
<li>In the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel, double-click the <span class="ScreenTextPACKT"><span class="packt_screen">MainCharacter</span></span> controller asset file; it should open in the <strong><span class="KeyWordPACKT">Animator</span></strong> panel.</li>
<li>In the top-left corner of the <strong><span class="KeyWordPACKT">Animator</span></strong> panel, select the <span class="ScreenTextPACKT"><span class="packt_screen">Parameters</span></span> section and use the <span class="packt_screen">+</span> sign to create three new <span class="ScreenTextPACKT"><span class="packt_screen">Parameters (Float)</span></span> named <span class="ScreenTextPACKT"><span class="packt_screen">xSpeed</span></span>, <span class="ScreenTextPACKT"><span class="packt_screen">zSpeed</span></span>, and <span class="ScreenTextPACKT"><span class="packt_screen">Speed</span>:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/3a925c86-f9db-4cf0-9aef-ee082e67a429.png" style="width:37.58em;height:8.33em;"/></p>
<ol start="13">
<li>We do have an Idle state for our character, but we need new ones. Right-click on the grid area and, from the context menu, navigate to <span class="packt_screen"><span class="ScreenTextPACKT">Create State | From New Blend</span> <span class="ScreenTextPACKT">Tree</span></span>. In the <span class="KeyWordPACKT"><strong>Inspector</strong>,</span> change its name from the <span class="ScreenTextPACKT"><span class="packt_screen">Default Blend Tree</span></span> to <span class="ScreenTextPACKT"><span class="packt_screen">Move</span>:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/cd6c1355-cc9f-4db0-9de3-b7abe36e0b27.png" style="width:54.25em;height:7.67em;"/></p>
<ol start="14">
<li>Double-click on the <span class="ScreenTextPACKT"><span class="packt_screen">Move</span></span> state. You will see the empty blend tree that you have created. Select it and in the <strong>Inspector</strong>, rename it <span class="ScreenTextPACKT"><span class="packt_screen">Move</span></span>. Then, change its <span class="ScreenTextPACKT"><span class="packt_screen">Blend Type</span></span> to <span class="ScreenTextPACKT"><span class="packt_screen">2D Freeform Directional</span></span>, also setting <span class="ScreenTextPACKT"><span class="packt_screen">xSpeed</span></span> and <span class="ScreenTextPACKT"><span class="packt_screen">zSpeed</span></span> in the <span class="ScreenTextPACKT"><span class="packt_screen">Parameters</span></span> tab. Finally, using the <span class="packt_screen">+</span> sign from the bottom of the <span class="ScreenTextPACKT"><span class="packt_screen">Motion</span></span> list, add nine new <span class="packt_screen"><span class="ScreenTextPACKT">Motion</span> <span class="ScreenTextPACKT">Fields</span></span><span class="ScreenTextPACKT">:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/cbbc374c-8258-446b-9403-c95be58d4d9f.png" style="width:41.75em;height:20.50em;"/></p>
<ol start="15">
<li>Now, populate the <span class="ScreenTextPACKT"><span class="packt_screen">Motion</span></span> list with the following motion clips and respective Pos X and Pos Y values: <span class="packt_screen">R</span><span class="ScreenTextPACKT"><span class="packt_screen">un_backwards</span></span>, 0, -1; <span class="ScreenTextPACKT"><span class="packt_screen">Walking_backwards</span></span>, 0,-0.5; <span class="ScreenTextPACKT"><span class="packt_screen">Rifle_aiming_idle</span></span>, 0, 0; <span class="ScreenTextPACKT"><span class="packt_screen">Walking</span></span>, 0, 0.5; <span class="ScreenTextPACKT"><span class="packt_screen">Rifle_run</span></span>, 0, 1; <span class="ScreenTextPACKT"><span class="packt_screen">Strafe</span></span>, -1, 0; <span class="ScreenTextPACKT"><span class="packt_screen">Strafe_left</span></span>, -0.5, 0; <span class="ScreenTextPACKT"><span class="packt_screen">Strafe_right</span>,</span> 0.5, 0; <span class="ScreenTextPACKT"><span class="packt_screen">Strafe_2</span>,</span> 1, 0. You can populate the <span class="ScreenTextPACKT"><span class="packt_screen">Motion</span></span> list by selecting it from the list or, if there is more than one clip with the same name, you can drag it from the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel onto the slot by expanding the appropriate model icon:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/5dbc5888-9733-4f2a-9468-3fe3fb2b7a9f.png" style="width:39.50em;height:17.67em;"/></p>
<ol start="16">
<li>To return to the <span class="packt_screen"><span class="ScreenTextPACKT">Base</span> <span class="ScreenTextPACKT">Layer</span></span>, either double-click on the grid background of the <strong><span class="KeyWordPACKT">Animator</span></strong> panel, or click the <span class="ScreenTextPACKT"><span class="packt_screen">Base Layer</span></span> button in the information bar along the top of the <strong><span class="KeyWordPACKT">Animator</span></strong> panel:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/186b5ece-e528-41b5-a05b-fbd2765ee2ac.png" style="width:21.83em;height:6.83em;"/></p>
<ol start="17">
<li>Since we have the <span class="ScreenTextPACKT"><span class="packt_screen">rifle_aiming_idle</span></span> Motion clip in our <span class="ScreenTextPACKT"><span class="packt_screen">Move</span></span> blend tree, we can get rid of the original <span class="ScreenTextPACKT"><span class="packt_screen">Idle</span></span> state. Right-click on the <span class="ScreenTextPACKT"><span class="packt_screen">Idle</span></span> state box and, from the menu, select <span class="packt_screen"><span class="ScreenTextPACKT">Delete</span>.</span> The <span class="ScreenTextPACKT"><span class="packt_screen">Move</span></span> blend state will become the new default state, turning orange.</li>
<li>Now, we must create the script-class that will actually transform the player's input into those variables that are created to control the animation. Create a new C# script-class named <span class="ScreenTextPACKT"><span class="packt_screen">BasicController</span></span>, and add an instance-object as a component of the <span class="ScreenTextPACKT"><span class="packt_screen">MsLazer</span></span> GameObject:</li>
</ol>
<pre class="SourceCode" style="padding-left: 60px">    using UnityEngine;<br/>     using System.Collections;<br/> <br/>     public class BasicController: MonoBehaviour {<br/>       private Animator anim;<br/>       private CharacterController controller;<br/>       public float transitionTime = .25f;<br/>       private float speedLimit = 1.0f;<br/>       public bool moveDiagonally = true;<br/>       public bool mouseRotate = true;<br/>       public bool keyboardRotate = false;<br/> <br/>       void Start () {<br/>         controller = GetComponent&lt;CharacterController&gt;();<br/>         anim = GetComponent&lt;Animator&gt;();<br/>       }<br/> <br/>       void Update () {<br/>         if(controller.isGrounded){<br/>           if (Input.GetKey (KeyCode.RightShift) ||Input.GetKey (KeyCode.LeftShift))<br/>             speedLimit = 0.5f;<br/>           else<br/>             speedLimit = 1.0f;<br/> <br/>           float h = Input.GetAxis("Horizontal");<br/>           float v = Input.GetAxis("Vertical");<br/>           float xSpeed = h * speedLimit;<br/>           float zSpeed = v * speedLimit;<br/>           float speed = Mathf.Sqrt(h*h+v*v);<br/> <br/>           if(v!=0 &amp;&amp; !moveDiagonally)<br/>             xSpeed = 0;<br/> <br/>           if(v!=0 &amp;&amp; keyboardRotate)<br/>             this.transform.Rotate(Vector3.up * h, Space.World);<br/> <br/>           if(mouseRotate)<br/>             this.transform.Rotate(Vector3.up * (Input.GetAxis("Mouse X")) * Mathf.Sign(v), <br/>                                                                             Space.World);<br/> <br/>           anim.SetFloat("zSpeed", zSpeed, transitionTime, Time.deltaTime);<br/>           anim.SetFloat("xSpeed", xSpeed, transitionTime, Time.deltaTime);<br/>           anim.SetFloat("Speed", speed, transitionTime, Time.deltaTime);<br/>         }<br/>       }<br/>     }</pre>
<ol start="19">
<li>Play your <strong><span class="KeyWordPACKT">Scene</span></strong> and test the game. You should be able to control your character with the arrow keys (or <em><span class="KeyPACKT">WASD</span></em> keys). Keeping the <em><span class="KeyPACKT">Shift</span></em> key pressed will slow it down.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Whenever the <span class="ScreenTextPACKT"><span class="packt_screen">BasicController</span></span> script detects any directional keys in use, it sets the <span class="ScreenTextPACKT"><span class="packt_screen">Speed</span></span> variable of the <span class="ScreenTextPACKT"><span class="packt_screen">Animator</span></span> state to a value higher than 0, changing the <span class="ScreenTextPACKT"><span class="packt_screen">Animator</span></span> state from <span class="ScreenTextPACKT"><span class="packt_screen">Idle</span></span> to <span class="ScreenTextPACKT"><span class="packt_screen">Move</span></span>. The <span class="ScreenTextPACKT"><span class="packt_screen">Move</span></span> state, in turn, blends the motion clips that it was populated with, according to the input values for <span class="ScreenTextPACKT"><span class="packt_screen">xSpeed</span></span> (obtained from <span class="ScreenTextPACKT"><span class="packt_screen">Horizontal Axis</span></span> input, typically the <em><span class="KeyPACKT">A</span></em> and <em><span class="KeyPACKT">D</span></em> keys) and <span class="ScreenTextPACKT"><span class="packt_screen">zSpeed</span></span> (obtained from <span class="ScreenTextPACKT"><span class="packt_screen">Vertical Axis</span></span> input, typically the <em><span class="KeyPACKT">W</span></em> and <em><span class="ItalicsPACKT">S</span></em> keys). Since <strong><span class="KeyWordPACKT">Mecanim</span></strong> is capable of applying root motion to the characters, our character will actually move in the resulting direction.</p>
<p>For instance, if the <em><span class="KeyPACKT">W</span></em> and <em><span class="KeyPACKT">D</span></em> keys are pressed, the <span class="ScreenTextPACKT"><span class="packt_screen">xSpeed</span></span> and <span class="ScreenTextPACKT"><span class="packt_screen">zSpeed</span></span> values will rise to 1.0. From the <strong><span class="KeyWordPACKT">Inspector</span></strong>, it is possible to see that such a combination will result in a blend between the motion clips called <span class="ScreenTextPACKT"><span class="packt_screen">rifle_run</span></span> and <span class="ScreenTextPACKT"><span class="packt_screen">strafe_2</span></span>, making the character run diagonally (to the front and right):</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/ed26ed0d-90e1-4ac6-8eeb-82a2367f27ab.png" style="width:37.42em;height:30.67em;"/></p>
<p>Our <span class="ScreenTextPACKT"><span class="packt_screen">BasicController</span></span> includes three checkboxes for more options: <span class="ScreenTextPACKT"><span class="packt_screen">Move Diagonally</span>, which is</span> set as true by default and allows for blends between forward/backward and left/right clips; <span class="ScreenTextPACKT"><span class="packt_screen">Mouse Rotate</span>, which is</span> set as true by default and allows for rotating the character with the mouse, changing their direction while moving; and <span class="ScreenTextPACKT"><span class="packt_screen">Keyboard Rotate</span>, which is</span> set as false by default and allows for rotating the character through simultaneous use of the left/right and forward/backward directional keys.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Here are some sources of further information about these topics.</p>
<p>Our blend tree used the <span class="ScreenTextPACKT"><span class="packt_screen">2D Freeform Directional Blend Type</span></span>. However, if we only <span>had</span><span> </span><span>four</span> <span class="ScreenTextPACKT"><span class="packt_screen">Animation Clips</span></span> <span>(forward, backward, left, and right),</span> <span class="ScreenTextPACKT"><span class="packt_screen">2D Simple Directional</span></span> <span>would have been a better option. </span></p>
<p>Learn more about <span class="ScreenTextPACKT"><span class="packt_screen">Blend Trees</span></span> and 2D blending from Unity's Documentation:</p>
<ul>
<li><a href="http://docs.unity3d.com/Manual/BlendTree-2DBlending.html"><span class="URLPACKT">http://docs.unity3d.com/Manual/BlendTree-2DBlending.html</span></a></li>
</ul>
<p>Also, if you want to learn more about the <strong><span class="KeyWordPACKT">Mecanim</span></strong> Animation System, there are some links that you might want to check out, such as Unity's documentation:</p>
<ul>
<li><a href="http://docs.unity3d.com/Manual/AnimationOverview.html"><span class="URLPACKT">http://docs.unity3d.com/Manual/AnimationOverview.html</span></a></li>
</ul>
<p><strong><span class="KeyWordPACKT">Mecanim</span></strong> Example Scenes are available from the Unity <strong><span class="KeyWordPACKT">Asset Store</span></strong>:</p>
<ul>
<li><a href="https://www.assetstore.unity3d.com/en/#!/content/5328"><span class="URLPACKT">https://www.assetstore.unity3d.com/en/#!/content/5328</span></a></li>
</ul>
<p><strong><span class="KeyWordPACKT">Mecanim</span></strong> Video Tutorial are available here:</p>
<ul>
<li><a href="http://unity3d.com/pt/learn/tutorials/topics/animation"><span class="URLPACKT">http://unity3d.com/pt/learn/tutorials/topics/animation</span></a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Mixing animations with Layers and Masks</h1>
                </header>
            
            <article>
                
<p>Mixing animations is a great way of adding complexity to your animated characters without requiring a vast number of animated clips. Using <span class="packt_screen"><span class="ScreenTextPACKT">Layers</span></span> and <span class="ScreenTextPACKT"><span class="packt_screen">Masks</span></span>, we can combine different animations by playing specific clips for specific body parts of the character.</p>
<p>In this recipe, we will apply this technique to our animated character, triggering animation clips for firing a rifle and throwing a grenade with the character's upper body. We will do this while keeping the lower body moving or idle, according to the player's input.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, we have prepared a Unity Package named <span class="ScreenTextPACKT"><span class="packt_screen">Mixing</span></span>, containing a basic <strong><span class="KeyWordPACKT">Scene</span></strong> that features an animated character. We have also provided the FBX animation clips <span class="ScreenTextPACKT"><span class="packt_screen">Swat@firing_rifle.fbx</span></span> and <span class="ScreenTextPACKT"><span class="packt_screen">Swat@toss_grenade.fbx</span></span>. These files can be found in the <kbd>09_03</kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To mix animations using layers and masks, follow these steps:</p>
<ol>
<li>Create a new 3D project and import the <span class="ScreenTextPACKT"><span class="packt_screen">Mixing</span></span> Unity Package, as well as the FBX files <span class="KeyWordPACKT"><span class="packt_screen">Swat@firing_rifle.fbx</span></span> and <span class="KeyWordPACKT"><span class="packt_screen">Swat@toss_grenade.fbx</span></span>.</li>
<li>Then, from the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel, open the <span class="ScreenTextPACKT"><span class="packt_screen">mecanimPlayground</span></span> level.</li>
<li>We need to configure the <strong><span class="ScreenTextPACKT">Animation Clips</span></strong>. Select the <span class="packt_screen"><span class="ScreenTextPACKT">Swat@firing_rifle</span></span> asset in the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel.</li>
<li>Select the <span class="ScreenTextPACKT"><span class="packt_screen">Rig</span></span> section. Change <span class="ScreenTextPACKT"><span class="packt_screen">Animation Type</span></span> to <span class="ScreenTextPACKT"><span class="packt_screen">Humanoid</span></span>, and <span class="ScreenTextPACKT"><span class="packt_screen">Avatar Definition</span></span> to <span class="ScreenTextPACKT"><span class="packt_screen">Create From this Model</span></span>. Confirm this by clicking on <span class="ScreenTextPACKT"><span class="packt_screen">Apply</span>:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/52d3eac7-bc86-4f67-9bf6-76ab65010dcf.png"/></p>
<ol start="5">
<li>Now, activate the <strong><span class="ScreenTextPACKT">Animations</span></strong> section. The <kbd><span class="ScreenTextPACKT">firing_rifle</span></kbd> clip should be selected; click on the <strong><span class="ScreenTextPACKT">Clamp Range</span></strong> button to adjust the timeline and check the <span class="ScreenTextPACKT"><strong>Loop Time</strong></span> and <strong><span class="ScreenTextPACKT">Loop</span> <span class="ScreenTextPACKT">Pose</span></strong> options. Under <strong><span class="ScreenTextPACKT">Root Transform Rotation</span></strong>, check <span class="ScreenTextPACKT">Bake Into Pose</span> and select <span class="ScreenTextPACKT">Based <strong>Upon</strong> | <strong>Original</strong></span>. Under <span class="ScreenTextPACKT"><strong>Root Transform Position</strong> (<strong>Y</strong>)</span>, check <strong><span class="ScreenTextPACKT">Bake Into Pose</span></strong> and select <span class="ScreenTextPACKT"><strong>Based Upon</strong> (at Start) | Original</span>. Under <span class="ScreenTextPACKT"><strong>Root Transform Position</strong> (<strong>XZ</strong>)</span>, leave <span class="ScreenTextPACKT"><strong>Bake</strong> Into Pose</span> unchecked. Click on <strong><span class="ScreenTextPACKT">Apply</span></strong> to confirm the changes:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/cce6703a-9c38-4747-98c5-dd67a9a68993.png" style="width:27.08em;height:27.17em;"/></p>
<ol start="6">
<li>Select the <kbd><span class="ScreenTextPACKT">Swa</span><span class="ScreenTextPACKT">t@toss_grenade</span></kbd> animation clip. Select the <span class="ScreenTextPACKT">Rig</span> section. Then, change <strong><span class="ScreenTextPACKT">Animation Type</span></strong> to <span class="ScreenTextPACKT">Humanoid</span> and <span class="ScreenTextPACKT">Avatar Definition</span> to <span class="ScreenTextPACKT"><strong>Create From</strong> this Model</span>. Confirm it by clicking on <span class="ScreenTextPACKT">Apply</span>.
<ol>
<li>Now, activate the <strong><span class="ScreenTextPACKT">Animations</span></strong> section. The <kbd><span class="ScreenTextPACKT">toss_grenade</span></kbd> animation clip should be selected. Click the <span class="ScreenTextPACKT">Clamp Range</span> button to adjust the timeline, and leave the <strong><span class="ScreenTextPACKT">Loop Time</span></strong> and <strong><span class="ScreenTextPACKT">Loop Pose</span></strong> options unchecked. Under <span class="ScreenTextPACKT">Root <strong>Transform Rotation</strong></span><strong>,</strong> check <span class="ScreenTextPACKT"><strong>Bake</strong> Into <strong>Pose</strong></span> and select <span class="ScreenTextPACKT"><strong>Based Upon</strong> | <strong>Original</strong></span><strong>.</strong> Under <span class="ScreenTextPACKT"><strong>Root Transform Position</strong> (<strong>Y</strong>)</span>, check <span class="ScreenTextPACKT"><strong>Bake</strong> Into <strong>Pose</strong></span> and select <span class="ScreenTextPACKT">Based Upon (at Start) | Original</span>. Under <span class="ScreenTextPACKT">Root Transform Position (XZ)</span>, leave <span class="ScreenTextPACKT">Bake Into Pose</span> unchecked. Click on <span class="ScreenTextPACKT">Apply</span> to confirm the changes.</li>
</ol>
</li>
</ol>
<ol start="7">
<li>Let's create a <span class="ScreenTextPACKT">Mask</span>. From the <span class="KeyWordPACKT">Project</span> panel, click on the <span class="ScreenTextPACKT">Create</span> button and add an <span class="ScreenTextPACKT">Avatar Mask</span> to the project. Name it <span class="ScreenTextPACKT">BodyMask</span>.</li>
<li>Select the <strong><span class="ScreenTextPACKT">BodyMask</span></strong> tab and, in the <strong><span class="KeyWordPACKT">Inspector</span>,</strong> expand the <span class="ScreenTextPACKT">Humanoid</span> section. Green body sections and IK spots are selected (all are by default), and red are unselected. Deselect the character's two legs, the circle base the feet are standing on, and the two feet IK spots (they should turn red):</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/30adaa9d-857e-4ea0-9d68-23a2da9ad5d8.png"/></p>
<ol start="10">
<li>In the <strong><span class="KeyWordPACKT">Project</span></strong> panel, double-click the <kbd><span class="ScreenTextPACKT">MainCharacter</span></kbd> controller asset file; it should open up in the <span class="KeyWordPACKT">Animator</span> panel.</li>
<li>In the <span class="ScreenTextPACKT">Animator</span> panel, create a new layer by clicking on the <strong>+</strong> sign in the top-left <strong><span class="ScreenTextPACKT">Layers</span></strong> tab, above the <span class="ScreenTextPACKT">Base Layer</span>.</li>
</ol>
<ol start="12">
<li>Name the new <kbd>layer<span class="ScreenTextPACKT">UpperBody</span></kbd> and click on the gear icon for the settings. Then, change its <strong><span class="ScreenTextPACKT">Weight</span></strong> to 1 and select the <strong><span class="ScreenTextPACKT">BodyMask</span></strong> in the <span class="ScreenTextPACKT">Mask</span> slot. Also, change <span class="ScreenTextPACKT">Blending</span> to <span class="ScreenTextPACKT">Additive:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/ded015b1-998f-40a3-a9d6-857ff9a70480.png" style="width:49.67em;height:12.42em;"/></p>
<ol start="13">
<li>Now, in the <span class="KeyWordPACKT">A</span><span class="KeyWordPACKT">nimator</span> panel, with the <kbd><span class="ScreenTextPACKT">UpperBody</span></kbd> layer selected, create three new empty states (by right-clicking on the grid area and navigating to <span class="ScreenTextPACKT">Create State | Empty</span> from the menu). Name the default (orange) state null, and the other two<span class="ScreenTextPACKT">Fire</span> and <span class="ScreenTextPACKT">Grenade</span>.</li>
<li>Now, access the <strong><span class="ScreenTextPACKT">Parameters</span></strong> tab and add two new parameters of type Bool, <span class="ScreenTextPACKT">Fire</span> and <span class="ScreenTextPACKT">Grenade:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/f8a63d47-4f4b-4b17-81bd-bb78231970d9.png" style="width:47.50em;height:14.00em;"/></p>
<ol start="15">
<li>Select the <span class="ScreenTextPACKT">Fire</span> state and, in the <strong><span class="KeyWordPACKT">Inspector</span>,</strong> add the <span class="ScreenTextPACKT">firing_rifle</span> <span class="ScreenTextPACKT">Animation Clip</span> to the <span class="ScreenTextPACKT">Motion</span> field:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/22cb9520-f6ca-4ca4-9d3b-955f2a07f1e7.png"/></p>
<ol start="16">
<li>Now, select the <strong><span class="ScreenTextPACKT">Grenade</span></strong> state and, in the <strong><span class="KeyWordPACKT">Inspector,</span></strong> add <span class="ScreenTextPACKT">the <kbd>toss_grenade</kbd></span> animation clip to the <span class="ScreenTextPACKT">Motion</span> field.</li>
<li>Right-click on the <span class="ScreenTextPACKT">null</span> state box and, from the menu, select <span class="ScreenTextPACKT"><strong>Make Transition</strong></span>. Then, drag the white arrow onto the <span class="ScreenTextPACKT">Fire</span> box.</li>
<li>Select the arrow (it will turn blue). From the <strong><span class="KeyWordPACKT">Inspector</span>,</strong> uncheck the <span class="ScreenTextPACKT">Has <strong>Exit Time</strong></span> option. Then, access the <span class="ScreenTextPACKT">Conditions</span> list, click on the <strong>+</strong> sign to add a new condition, and set it as <span class="ScreenTextPACKT">Fire</span> and <span class="ScreenTextPACKT">true:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/a17149d4-7bab-45fe-8293-c5ac548a4ba4.png"/></p>
<ol start="19">
<li>Now, make a <strong><span class="ScreenTextPACKT">Transition</span></strong> from <span class="ScreenTextPACKT">null</span> to <span class="ScreenTextPACKT">Grenade</span>. Select the arrow (it will turn blue). From the <strong><span class="KeyWordPACKT">Inspector</span>,</strong> uncheck the <span class="ScreenTextPACKT">Has <strong>Exit Time</strong></span> option. Then, access the <span class="ScreenTextPACKT">Conditions</span> list, click on the <strong>+</strong> sign to add a new condition, and set it as <span class="ScreenTextPACKT">Grenade</span> and <span class="ScreenTextPACKT">true</span>.</li>
<li>Now, create transitions from <span class="ScreenTextPACKT">Fire</span> to <span class="ScreenTextPACKT">null</span>, and from <strong><span class="ScreenTextPACKT">Grenade</span></strong> to <span class="ScreenTextPACKT">null</span>. Then, select the arrow that goes from <span class="ScreenTextPACKT">Fire</span> to <span class="ScreenTextPACKT">null</span> and, in the <span class="ScreenTextPACKT">Conditions</span> box, select the <span class="ScreenTextPACKT">Fire</span> and <span class="ScreenTextPACKT">false</span> options. Leave the <span class="ScreenTextPACKT">Has <strong>Exit Time</strong></span> option checked.</li>
<li>Finally, select the <strong><span class="ScreenTextPACKT">Transition</span></strong> arrow that goes from <strong><span class="ScreenTextPACKT">Grenade</span></strong> to <span class="ScreenTextPACKT">null</span>. In the <strong><span class="ScreenTextPACKT">Conditions</span></strong> box, select the options <strong><span class="ScreenTextPACKT">Grenade</span></strong>, <span class="ScreenTextPACKT">false</span>. Leave the <span class="ScreenTextPACKT">Has <strong>Exit Time</strong></span> option checked. See the screenshot for these setting choices:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/e1b92465-bee4-4eb4-a3e7-2aae698b6284.png"/></p>
<ol start="22">
<li>Open the <kbd><span class="ScreenTextPACKT">BasicController</span></kbd> C# script-class in your code editor (in Project folder <kbd><span class="ScreenTextPACKT">Scripts</span></kbd>). Immediately before the end of the <kbd><span class="CodeInTextPACKT">Update()</span></kbd> function, add the following code:</li>
</ol>
<pre class="SourceCode" style="padding-left: 60px">if(Input.GetKeyDown(KeyCode.F)){<br/>    anim.SetBool("Grenade", true);<br/>} else {<br/>    anim.SetBool("Grenade", false);<br/>}<br/> <br/>if(Input.GetButtonDown("Fire1")){<br/>    anim.SetBool("Fire", true);<br/>}<br/> <br/>if(Input.GetButtonUp("Fire1")){<br/>    anim.SetBool("Fire", false);<br/>}</pre>
<ol start="23">
<li>Save the script and play your <span class="KeyWordPACKT">Scene</span>. You will be able to trigger the <kbd><span class="ScreenTextPACKT">firing_rifle</span></kbd> and <kbd><span class="ScreenTextPACKT">toss_grenade</span></kbd> animations by clicking on the fire button and pressing the <em><span class="KeyPACKT">F</span></em> key. Observe how the character's legs still respond to the <span class="ScreenTextPACKT">Move</span> animation state, so that the character can keep walking backward while throwing the grenade.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Once the <span class="ScreenTextPACKT">Avatar</span> mask is created, it can be used as a way of filtering the body parts that would actually play the animation states of a particular layer. In our case, we have constrained our <kbd><span class="ScreenTextPACKT">fire_rifle</span></kbd> and <kbd><span class="ScreenTextPACKT">toss_grenade</span></kbd> animation clips to the upper body of our character, leaving the lower body free to play movement-related animation clips such as walking, running, and strafing.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Here are some ways to go further with this recipe.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Override versus Additive blending</h1>
                </header>
            
            <article>
                
<p>You might have noticed that the <kbd><span class="ScreenTextPACKT">UpperBody</span></kbd> layer has a parameter named <span class="ScreenTextPACKT">Blending</span>, which we have set to <span class="ScreenTextPACKT">Additive</span>. This means that animation states in this layer will be added to the ones from the lower layers.</p>
<p>If changed to <span class="ScreenTextPACKT">Override</span>, the animation from this would override animation states from the lower layers when played. In our case, <span class="ScreenTextPACKT">Additive</span> helps in keeping the aim stable when firing while running.</p>
<p>For more information on <span class="ScreenTextPACKT">Animation Layers</span> and <span class="ScreenTextPACKT">Avatar Body Masks</span>, check out Unity's documentation:</p>
<ul>
<li class="SourceCode"><a href="http://docs.unity3d.com/Manual/AnimationLayers.html" target="_blank"><span class="URLPACKT"><span>http://docs.unity3d.com/Manual/AnimationLayers.html</span></span></a></li>
<li class="SourceCode"><a href="http://docs.unity3d.com/Manual/class-AvatarMask.html" target="_blank"><span class="URLPACKT"><span>http://docs.unity3d.com/Manual/class-AvatarMask.html</span></span></a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Organizing States into Sub-state Machines</h1>
                </header>
            
            <article>
                
<p>Whenever content in the <strong><span class="KeyWordPACKT">Animator</span></strong> panel gets too cluttered, you can always consider organizing your <strong><span class="ScreenTextPACKT">Animation States</span></strong> into <strong><span class="ScreenTextPACKT">Sub-State Machines</span></strong>. In this recipe, we will use this technique to organize animation states for turning the character. Also, since the animation clips <span>provided</span><span> </span><span>do not include</span> <span class="ScreenTextPACKT">Root Motion</span><span>, we will use the opportunity to illustrate how to overcome the lack of</span> <span class="ScreenTextPACKT">Root Motion</span> <span>via a script, using it to turn the character 45 degrees to the left and right:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/9cee99f8-ed72-4175-9b9f-b6d9ea875bdc.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, we have prepared a Unity Package named <strong><span class="ScreenTextPACKT">Turning</span>,</strong> containing a basic scene that features an animated character. We have also provided the FBX animation clips <kbd><span class="ScreenTextPACKT">Swat@turn_right_45_degrees.fbx</span></kbd> and <kbd><span class="ScreenTextPACKT">Swat@turn_left.fbx</span>.</kbd> These files can be found in the <kbd>09_04</kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To organize <span class="ScreenTextPACKT">States</span> into <span class="ScreenTextPACKT">Sub-State Machines,</span> please follow these steps:</p>
<ol>
<li>Create a new 3D project and import the <span class="ScreenTextPACKT">Mixing</span> Unity Package, as well as the FBX files <kbd><span class="ScreenTextPACKT">Swat@turn_right_45_degrees.fbx</span></kbd> and <kbd><span class="ScreenTextPACKT">Swat@turn_left.fbx</span>.</kbd></li>
<li>Then, from the <strong><span class="KeyWordPACKT">Project</span></strong> panel, open the <kbd><span class="ScreenTextPACKT">mecanimPlayground</span></kbd> level.</li>
<li>We need to configure the <span class="ScreenTextPACKT"><strong>Animation</strong> Clips</span>. Select the <kbd><span class="ScreenTextPACKT">Swat@turn_left</span></kbd> asset in the <strong><span class="KeyWordPACKT">Project</span></strong> panel.</li>
<li>Choose the <span class="ScreenTextPACKT">Rig</span> section. Change <strong><span class="ScreenTextPACKT">Animation Type</span></strong> to <strong><span class="ScreenTextPACKT">Humanoid</span></strong> and <span class="ScreenTextPACKT"><strong>Avatar Definition</strong></span> to <span class="ScreenTextPACKT">Create From this Model</span>. Confirm by clicking on <strong><span class="ScreenTextPACKT">Apply</span>.</strong></li>
<li>Now, choose the <strong><span class="ScreenTextPACKT">Animations</span></strong> section. The <kbd><span class="ScreenTextPACKT">turn_left</span></kbd> clip should be selected. Click the <strong><span class="ScreenTextPACKT">Clamp Range</span></strong> button to adjust the timeline and check the <strong><span class="ScreenTextPACKT">Loop Time</span></strong> option. <strong>Under <span class="ScreenTextPACKT">Root Transform Rotation</span></strong>, check <span class="ScreenTextPACKT"><strong>Bake Into Pose</strong></span> and navigate to <span class="ScreenTextPACKT">Based Upon | Original</span>. <strong>Under</strong> <span class="ScreenTextPACKT"><strong>Root Transform Position</strong> (<strong>Y</strong>)</span>, check <strong><span class="ScreenTextPACKT">Bake Into Pose</span></strong> and select <span class="ScreenTextPACKT"><strong>Based Upon (at Start)</strong> | <strong>Original</strong></span>. <strong>Under <span class="ScreenTextPACKT">Root Transform Position (XZ)</span></strong>, leave <strong><span class="ScreenTextPACKT">Bake Into Pose</span></strong> unchecked. Click on <strong><span class="ScreenTextPACKT">Apply</span></strong> to confirm the changes:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/8addff17-b81f-46bb-8c34-f1b8248584f1.png" style="width:32.83em;height:23.00em;"/></p>
<p class="mce-root"/>
<ol start="6">
<li>Repeat steps 4 and 5 for <kbd><span class="ScreenTextPACKT">Swat@turning_right_45_degrees</span>.</kbd></li>
<li>In the <strong><span class="KeyWordPACKT">Project</span></strong> panel, double-click the <kbd><span class="ScreenTextPACKT">MainCharacter</span></kbd> controller asset file; it should open in the <strong><span class="KeyWordPACKT">Animator</span></strong> panel.</li>
<li>From the top-left corner of the <strong><span class="KeyWordPACKT">Animator</span></strong> panel, select the <strong><span class="ScreenTextPACKT">Parameters</span></strong> section and use the <strong>+</strong> sign to create the two new <span class="ScreenTextPACKT">Parameters (Boolean)</span> named <kbd><span class="ScreenTextPACKT">TurnLeft</span></kbd> and <kbd><span class="ScreenTextPACKT">TurnRight</span>.</kbd></li>
<li>Right-click on the grid area. From the context menu, select <span class="ScreenTextPACKT">Create <kbd>Sub-State</kbd></span> <span class="ScreenTextPACKT">Machine</span>. In the <span class="KeyWordPACKT">Inspector</span>, rename it <span class="ScreenTextPACKT">Turn:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/37266a4b-8c2c-40b8-afaf-b99db355ce5a.png"/></p>
<ol start="10">
<li>Double-click on the <strong><span class="ScreenTextPACKT">Turn Sub-State Machine</span></strong>. Right-click on the grid area, select <span class="ScreenTextPACKT"><strong>Create State</strong> | <strong>Empty</strong></span><strong>,</strong> and add a new state. Rename it to <strong><span class="ScreenTextPACKT">Turn Left</span>.</strong> Then, add another state named <strong><span class="ScreenTextPACKT">Turn Right</span></strong>.</li>
<li>From the <strong>Inspector,</strong> populate <span class="ScreenTextPACKT">Turn Left</span> with the <kbd><span class="ScreenTextPACKT">turn_left</span></kbd> motion clip. Then, populate <strong><span class="ScreenTextPACKT">Turn Right</span></strong> with <kbd><span class="ScreenTextPACKT">turning_right_45_degrees</span></kbd>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/fce897ee-abff-43dc-81b3-a7f3e2271627.png"/></p>
<ol start="12">
<li>In the <strong><span class="KeyWordPACKT">Ani</span><span class="KeyWordPACKT">mator</span></strong> panel, return to the <strong><span class="ScreenTextPACKT">Base Layer</span></strong> (click <span class="ScreenTextPACKT">Base Layer</span> in the information bar along the top of this panel).</li>
</ol>
<p class="mce-root"/>
<ol start="13">
<li>Create two <strong>Transitions</strong> from <span class="ScreenTextPACKT"><strong>State Move</strong>,</span> one into the <strong><span class="ScreenTextPACKT">Turn Left</span></strong> sub-state, and one into the <span class="ScreenTextPACKT"><strong>Turn Right</strong><span> sub-state:</span></span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/0836a058-4b84-4a1e-842d-f8d9564ff3d8.png" style="width:27.75em;height:10.33em;"/></p>
<ol start="14">
<li>Create two return <strong><span class="KeyWordPACKT">Transitions,</span></strong> from the <span class="KeyWordPACKT">Turn Left</span> back to <span class="KeyWordPACKT">Move</span> sub-state, and from the <span class="KeyWordPACKT">Turn Right</span> sub-state back to <span class="KeyWordPACKT">Move</span>. Do this by entering the <span class="KeyWordPACKT">Turn</span> sub-state, dragging the <strong><span class="KeyWordPACKT">Transition</span></strong> arrows from <span class="KeyWordPACKT">Turn Left</span> and <span class="KeyWordPACKT">Turn Right</span> into <span class="KeyWordPACKT">(Up) <strong>Base Layer</strong></span>, and choosing <strong><span class="KeyWordPACKT">State Move</span>.</strong></li>
<li>Select the <strong><span class="ScreenTextPACKT">Transition</span></strong> arrow that goes from <span class="ScreenTextPACKT">Turn Right</span> to <span class="ScreenTextPACKT">(Up) Base Layer</span>. It will turn blue. From the <strong><span class="KeyWordPACKT">Inspector</span>,</strong> uncheck the <strong><span class="ScreenTextPACKT">Has Exit Time</span></strong> option. Then, access the <span class="ScreenTextPACKT">Conditions</span> list, click the <strong>+</strong> sign to add a new condition, and set it as <strong><span class="ScreenTextPACKT">TurnRight</span></strong> and <strong><span class="ScreenTextPACKT">false:</span></strong></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/3ab1a0d5-0246-4185-af0b-0342c434d943.png"/></p>
<ol start="16">
<li>Select the arrow that goes from <span class="ScreenTextPACKT">(Up) Base Layer</span> to <span class="ScreenTextPACKT">Turn Right</span>. From the <strong><span class="KeyWordPACKT">Inspector</span>,</strong> uncheck the <span class="ScreenTextPACKT">Has Exit Time</span> option. Then, access the <span class="ScreenTextPACKT">Conditions</span> list, click the + sign to add a new condition, and set it as <strong><span class="ScreenTextPACKT">TurnRight</span></strong> and <strong><span class="ScreenTextPACKT">true</span>.</strong></li>
<li>Repeat steps 14 and 15 with the arrows that go between <span class="ScreenTextPACKT">(Up) Base Layer</span> <span class="ScreenTextPACKT">and Turn Left</span>, using <span class="ScreenTextPACKT">TurnLeft</span> as a condition this time.</li>
</ol>
<ol start="18">
<li>Open the <kbd><span class="ScreenTextPACKT">BasicController</span></kbd> C# script-class in your code editor (<span class="packt_screen">folder <span class="ScreenTextPACKT">Project</span></span> <span class="ScreenTextPACKT">| <span class="packt_screen">Scripts</span></span>). Immediately after the <kbd><span class="CodeInTextPACKT">if(controller.isGrounded)</span></kbd> line, add this:</li>
</ol>
<pre class="SourceCode" style="padding-left: 60px">if(Input.GetKey(KeyCode.Q)){<br/>    anim.SetBool("TurnLeft", true);<br/>    transform.Rotate(Vector3.up * (Time.deltaTime * -45.0f),  Space.World);<br/>} else {<br/>    anim.SetBool("TurnLeft", false);<br/>}<br/> <br/>if(Input.GetKey(KeyCode.E)){<br/>    anim.SetBool("TurnRight", true);<br/>    transform.Rotate(Vector3.up * (Time.deltaTime * 45.0f), Space.World);<br/>} else {<br/>    anim.SetBool("TurnRight", false);<br/>}</pre>
<ol start="19">
<li>Save your script-class. Then, select the <kbd><span class="ScreenTextPACKT">MsLaser</span></kbd> character and, from the <strong><span class="KeyWordPACKT">Inspector</span>,</strong> select the <strong><span class="ScreenTextPACKT">Basic Controller</span></strong> component. Leave the <span class="ScreenTextPACKT">Move Diagonally</span> and <span class="ScreenTextPACKT">Mouse Rotate</span> options unchecked. Also, leave the <span class="ScreenTextPACKT">Keyboard Rotate</span> option checked.</li>
<li>Play the <strong><span class="KeyWordPACKT">Scene</span>.</strong> You will be able to turn left and right by using the <em><span class="KeyPACKT">Q</span></em> and <em><span class="ItalicsPACKT">E</span></em> keys respectively.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>As should be clear from the recipe, <span class="ScreenTextPACKT">Sub-State Machines</span> work in a similar way to groups or folders, allowing you to encapsulate a series of state machines into a single entity for easier reference. <span class="ScreenTextPACKT">States</span> from the <span class="ScreenTextPACKT">Sub-State Machines</span> can be <span class="ScreenTextPACKT">Transitioned</span> from external states, in our case the <span class="ScreenTextPACKT">Move</span> state, or even from different sub-state machines.</p>
<p>Regarding character rotation, we have overcome the lack of root motion by using the <span class="CodeInTextPACKT"><kbd>transform.Rotate(Vector3.up</kbd> *</span> <kbd>(Time.deltaTime * -45.0f)</kbd><span class="CodeInTextPACKT">, Space.World)</span> command to make the character actually turn around when the Q and E keys are held down.</p>
<p>This command was used in conjunction with <span class="CodeInTextPACKT"><kbd>animator.SetBool("TurnLeft", true)</kbd>,</span> which triggers the right animation clip:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/9ab32fd2-834a-415a-8000-2d3b36734e9b.png" style="width:34.92em;height:19.33em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Transforming the Character Controller via scripts</h1>
                </header>
            
            <article>
                
<p>Applying <span class="ScreenTextPACKT">Root Motion</span> to your character might be a very practical and accurate way to animate it. However, every now and then, you might need to manually control one or two aspects of the character's movement. Perhaps you only have an in-place animation to work with, or maybe you want the character's movement to be affected by other variables. In these cases, you will need to override <strong><span class="ScreenTextPACKT">Root Motion</span></strong> via a script.</p>
<p>To illustrate this issue, this recipe makes use of an animation clip for jumping, which originally moves the character only in the Y-axis. In order to make her move forward or backward while jumping, we will learn how to access the character's velocity to inform the jump direction via a script.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, we have prepared a Unity Package named <span class="ScreenTextPACKT">Jumping</span>, containing a basic scene that features an animated character. We have also provided the FBX animation clip <kbd><span class="ScreenTextPACKT">Swat@rifle_jump</span>.</kbd> These files can be found in the <kbd>09_05</kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To apply <span class="ScreenTextPACKT">Root Motion</span> via a script, please follow these steps:</p>
<ol>
<li>Create a new 3D project and import the <span class="ScreenTextPACKT">Jumping</span> Unity Package, as well as the FBX <kbd><span class="ScreenTextPACKT">Swat@rifle_jump.fbx</span></kbd> file.</li>
<li>Then, from the <span class="KeyWordPACKT">Project</span> panel, open the <kbd><span class="ScreenTextPACKT">mecanimPlayground</span></kbd> level.</li>
<li>We need to configure the <span class="ScreenTextPACKT"><strong>Animation</strong> Clips</span>. Select the <kbd><span class="ScreenTextPACKT">Swat@rifle_jump</span></kbd> asset in the <strong><span class="KeyWordPACKT">Project</span></strong> panel.</li>
<li>Select the <span class="ScreenTextPACKT">Rig</span> section. Change <span class="ScreenTextPACKT">Animation Type</span> to <span class="ScreenTextPACKT">Humanoid</span> and <span class="ScreenTextPACKT">Avatar Definition</span> to <span class="ScreenTextPACKT">Create From this Model</span>. Confirm this by clicking on <span class="ScreenTextPACKT">Apply</span>.</li>
<li>Now, activate the <strong><span class="ScreenTextPACKT">Animations</span></strong> section. The <kbd><span class="ScreenTextPACKT">rifle_jump</span></kbd> clip should be selected. Click the <span class="ScreenTextPACKT">Clamp Range</span> button to adjust the timeline, and check the <span class="ScreenTextPACKT">Loop Time</span> and <span class="ScreenTextPACKT">Loop</span> <span class="KeyWordPACKT">Pose</span> options. Under <span class="ScreenTextPACKT">Root Transform Rotation</span>, check <span class="ScreenTextPACKT">Bake Into Pose</span> and select <span class="ScreenTextPACKT">Based Upon | Original</span>. Under <span class="ScreenTextPACKT">Root Transform Position (Y)</span>, leave <span class="ScreenTextPACKT">Bake into Pose</span> unchecked and select <span class="ScreenTextPACKT"><strong>Based</strong> Upon (at Start) | Original</span>. Under <span class="ScreenTextPACKT">Root Transform</span> <span class="ScreenTextPACKT">Position (XZ)</span>, leave <span class="ScreenTextPACKT">Bake Into Pose</span> unchecked. Click on <strong><span class="ScreenTextPACKT">Apply</span></strong> to confirm the changes:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/96b4285f-1037-4c73-9b2e-60de1a85b657.png" style="width:35.08em;height:20.67em;"/></p>
<ol start="6">
<li>In the <strong><span class="KeyWordPACKT">Pro</span><span class="KeyWordPACKT">ject</span></strong> panel, double-click the <kbd><span class="ScreenTextPACKT">MainCharacter</span></kbd> controller asset file; it should open up in the <span class="KeyWordPACKT">Animator</span> panel.</li>
</ol>
<ol start="7">
<li>From the top-left corner of the <span class="KeyWordPACKT">Animator</span> panel, select the <span class="ScreenTextPACKT">Parameters</span> section and use the <strong>+</strong> sign to create a new <span class="ScreenTextPACKT"><strong>Trigger</strong> parameter</span> named <span class="ScreenTextPACKT">Jump:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/39a6240f-a419-4a9a-8d00-0fea4a227ed0.png"/></p>
<ol start="8">
<li>Add a new <span class="ScreenTextPACKT">State</span> named <span class="ScreenTextPACKT">Jump</span>. Do this by right-clicking the grid area and choosing <span class="ScreenTextPACKT"><span class="packt_screen">Create State | Empty</span></span>, then changing its name in the <span class="KeyWordPACKT">Inspector</span>.</li>
<li>Select the <strong><span class="ScreenTextPACKT">Jump</span></strong> state. Then, from the <strong><span class="KeyWordPACKT">Inspector</span>,</strong> populate it with the <kbd><span class="ScreenTextPACKT">rifle_jump</span></kbd> motion clip:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/57ca2d32-4d46-4642-94d1-e635b194fe82.png"/></p>
<ol start="10">
<li>Create a <strong><span class="KeyWordPACKT">Transit</span><span class="KeyWordPACKT">ion</span></strong> from <span class="ScreenTextPACKT">Any State</span> to <span class="ScreenTextPACKT">Jump</span> (using the <span class="ScreenTextPACKT">Make</span> <span class="ScreenTextPACKT">Transition</span> right-mouse-click menu). Select the <strong>Transition,</strong> uncheck <span class="ScreenTextPACKT">Has Exit Time</span>, and add a <span class="ScreenTextPACKT">Condition</span> for Trigger <span class="ScreenTextPACKT">Jump:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/4f122a2c-759a-4219-8faa-b1c5429ac82f.png"/></p>
<p class="mce-root"/>
<ol start="11">
<li class="CDPAlignLeft CDPAlign">Now, create a <strong><span class="KeyWordPACKT">Transition</span></strong> from <span class="ScreenTextPACKT">Jump</span> to <span class="ScreenTextPACKT">Move</span>. Ensure the <span class="ScreenTextPACKT">Has Exit Time</span> option is checked:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/c110b9e8-cb8c-440d-8a5f-6c872a95cf74.png"/></p>
<ol start="12">
<li>Open the <kbd><span class="ScreenTextPACKT">BasicController</span></kbd> C# script-class in your code editor (folder <span class="ScreenTextPACKT">Project | Scripts</span>).</li>
<li>Right before the <kbd><span class="CodeInTextPACKT">Start()</span></kbd> function, add the following code:</li>
</ol>
<pre class="SourceCode" style="padding-left: 60px">public float jumpHeight = 3f;<br/>private float verticalSpeed = 0f;<br/>private float xVelocity = 0f;<br/>private float zVelocity = 0f;</pre>
<ol start="14">
<li>Immediately after <span class="CodeInTextPACKT">the <kbd>if(controller.isGrounded)</kbd></span> line, add this:</li>
</ol>
<pre class="SourceCode" style="padding-left: 60px">if (Input.GetKey (KeyCode.Space)) {<br/>   anim.SetTrigger("Jump");<br/>   verticalSpeed = jumpHeight;<br/>}</pre>
<ol start="15">
<li>Finally, add a new function at the end of the code for this script-class. So it is inserted immediately before the final brace  (<kbd><span class="CodeInTextPACKT">}</span></kbd>) of the code:</li>
</ol>
<pre class="SourceCode" style="padding-left: 60px">      void OnAnimatorMove(){<br/>         Vector3 deltaPosition = anim.deltaPosition;<br/>         if (controller.isGrounded) {<br/>           xVelocity = controller.velocity.x;<br/>           zVelocity = controller.velocity.z;<br/>         } else {<br/>           deltaPosition.x = xVelocity * Time.deltaTime;<br/>           deltaPosition.z = zVelocity * Time.deltaTime;<br/>           anim.SetBool ("Jump", false);<br/>         }<br/>         deltaPosition.y = verticalSpeed * Time.deltaTime;<br/>         controller.Move (deltaPosition);<br/>         verticalSpeed += Physics.gravity.y * Time.deltaTime;<br/>         if ((controller.collisionFlags &amp; CollisionFlags.Below)  != 0) {<br/>           verticalSpeed = 0;<br/>         }<br/>       }</pre>
<ol start="16">
<li>Save your script and play the <span class="KeyWordPACKT">Scene</span>. You will be able to jump around using the s<span class="KeyPACKT">pacebar</span>. Observe how the character's velocity affects the direction of the jump.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Observe that once this function is added to the script, the <span class="ScreenTextPACKT">Apply Root Motion</span> field in the <span class="ScreenTextPACKT">Animator</span> component changes from a checked box to <span class="ScreenTextPACKT">Handled by Script:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/5e23a15e-9164-4c63-a06a-aee63fa715fb.png" style="width:31.33em;height:10.08em;"/></p>
<p>The reason is that in order to override the animation clip's original movement, we have placed a series of commands<span> </span><span>inside Unity's</span><span> </span><span class="CodeInTextPACKT">OnAnimatorMove()</span><span> </span><span>function</span><span> to move our character controller while jumping. The </span><kbd><span class="CodeInTextPACKT">controller.Move (deltaPosition)</span></kbd><span> </span><span>line of code </span><span>basically replaces the jump's direction from the original animation with the</span> <span class="ScreenTextPACKT">deltaPosition</span> <span>3D Vector, which is made up of the character's velocity at the instant before the jump (x and z-axis) and the calculation between the</span> <span class="ScreenTextPACKT">jumpHeight</span> <span>variable and gravity over time (y-axis).</span></p>
<p>The Transition from Any State to Animation State Jump has the condition that the Jump Transition has fired (become true). In the code, we activate the Trigger Jump in the Animator Controller with the <kbd> SetTrigger("Jump")</kbd><span> </span><span>statement</span><span>. Triggers are like Bool Parameters, but when set become True for one instance, then automatically return to false again. This means there is no need to write extra code to set the Trigger to False.</span></p>
<p><span>Triggers are perfect for events that happen, and then you want things to return to normal afterwards. The Transition from the Jump</span><span> </span><span>Animation State</span><span> back to Move does not need any condition, so after the Jump animation has played, the character returns to the Move state.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding rigid props to animated characters</h1>
                </header>
            
            <article>
                
<p>If you haven't included a sufficient number of props for your character when modeling and animating it, you might want to give her the chance to collect new ones at runtime. In this recipe, we will learn how to instantiate a GameObject and assign it to a character while respecting the animation hierarchy.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, we have prepared a Unity Package named <span class="ScreenTextPACKT">Props</span>, containing a basic <span class="KeyWordPACKT">Scene</span> that features an animated character and a prefab named <span class="ScreenTextPACKT">badge</span>. There is also a <span class="KeyWordPACKT">Texture</span> named <kbd><span class="ScreenTextPACKT">texture_pickupBadge.png</span>.</kbd> The files can be found in the <kbd>09_06</kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To add a rigid prop at runtime to an animated character, follow these steps:</p>
<ol>
<li>Create a new 3D project and import the <span class="ScreenTextPACKT">Props Unity Package</span> and the <kbd><span class="ScreenTextPACKT">texture_pickupBadge.png</span></kbd> <span class="KeyWordPACKT">Texture</span>.</li>
<li>Then, from the <strong><span class="KeyWordPACKT">Project</span></strong> panel, open the <kbd><span class="ScreenTextPACKT">mecanimPlayground</span></kbd> level.</li>
<li>From the <strong><span class="KeyWordPACKT">Project</span></strong> panel, add the <span class="ScreenTextPACKT">badge</span> prop to the scene by dragging it into the <span class="KeyWordPACKT">Hierarchy</span>.</li>
</ol>
<ol start="4">
<li>Make the <span class="ScreenTextPACKT">badge</span> a child of the <kbd><span class="ScreenTextPACKT">mixamorig:Spine2</span></kbd> Transform (use the <span class="KeyWordPACKT">Hierarchy</span> tree to navigate to <span class="ScreenTextPACKT">MsLaser | <kbd>mixamorig:Hips</kbd> | <kbd>mixamorig:Spine</kbd> | <kbd>mixamorig:Spine1</kbd> | <kbd>mixamorig:Spine2</kbd></span><kbd>).</kbd> Then, make the badge object visible above the character's chest by changing its <span class="ScreenTextPACKT">Transform Position</span> to (-0.08, 0, 0.15) and <span class="ScreenTextPACKT">Rotation</span> to (0.29, 0.14, -13.29):</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/26e4046a-4723-4896-babb-388487b518bd.png"/></p>
<ol start="5">
<li>Make a note of the <strong><span class="ScreenTextPACKT">Position</span></strong> and <strong><span class="ScreenTextPACKT">Rotation</span></strong> values, and delete the <span class="ScreenTextPACKT">badge</span> object from the scene.</li>
<li>Add a <span class="ScreenTextPACKT">3D Cube</span> named <span class="ScreenTextPACKT">Cube-pickup</span> to the <span class="KeyWordPACKT">Scene</span> by choosing <span class="ScreenTextPACKT"><strong>Create</strong> | <strong>3D Object</strong> | <strong>Cube</strong></span><strong>.</strong> In the <strong>Inspector,</strong> set its <strong><span class="ScreenTextPACKT">Transform Position</span></strong> to (0, 0.5, 2) and check the <span class="ScreenTextPACKT">Is Trigger</span> option for the <span class="ScreenTextPACKT">Box Collider</span> component.</li>
<li>Drag the <kbd><span class="ScreenTextPACKT">texture_pickupBadge.png</span></kbd> <span class="KeyWordPACKT">Texture</span> from the <strong><span class="KeyWordPACKT">Project</span></strong> panel onto the <span class="ScreenTextPACKT">Cube-pickup</span> GameObject. You should see the <span class="ScreenTextPACKT">Pickup Badge</span> text written on all sides of the Cube.</li>
<li>In the <strong><span class="KeyWordPACKT">Project</span></strong> panel, create a new C# script-class named <strong><span class="ScreenTextPACKT">AddProp</span></strong> containing the following code, and add an instance-object as a component to the Cube-pickup GameObject:</li>
</ol>
<pre class="SourceCode" style="padding-left: 60px">    using UnityEngine;<br/>     using System.Collections;<br/> <br/>     public class PropManager : MonoBehaviour  {<br/>         public GameObject prop;<br/>         public Transform targetBone;<br/>         public Vector3 positionOffset;<br/>         public Vector3 rotationOffset;<br/>         public bool destroyTrigger = true;<br/> <br/>         void OnTriggerEnter(Collider collision) {<br/>             bool addPropCondition = targetBone.IsChildOf(collision.transform) &amp; !AlreadyHalreadyHasChildObject();<br/> <br/>             if (addPropCondition)<br/>                 AddProp();<br/>         }<br/> <br/>         private void AddProp() {<br/>             GameObject newprop;<br/>             newprop = Instantiate(prop, targetBone.position,  <br/>             targetBone.rotation) as GameObject;<br/>             newprop.name = prop.name;<br/>             newprop.transform.parent = targetBone;<br/>             newprop.transform.localPosition += positionOffset;<br/>             newprop.transform.localEulerAngles += rotationOffset;<br/> <br/>             if(destroyTrigger)<br/>                 Destroy(gameObject);<br/>         }<br/> <br/>         private bool AlreadyHalreadyHasChildObject() {<br/>             string propName = prop.name;<br/> <br/>             foreach(Transform child in targetBone){<br/>                 if (child.name == propName)<br/>                     return true;<br/>             }<br/> <br/>             return false;<br/>         }<br/>     }</pre>
<ol start="9">
<li>Select the Cube-pickup GameObject and look at the properties of the <strong><span class="ScreenTextPACKT">Prop Manager (Script)</span></strong> component in the Inspector. Populate the public variables as follows:
<ul>
<li><span class="ScreenTextPACKT">Prop</span>: the badge prefab</li>
<li><span class="ScreenTextPACKT">Target Bone</span>: the <kbd><span class="ScreenTextPACKT">mixamorig:Spine2</span></kbd> transform inside the <kbd><span class="ScreenTextPACKT">MsLaser</span></kbd> <strong><span class="KeyWordPACKT">Hierarchy</span></strong> GameObject</li>
<li><span class="ScreenTextPACKT">Position Offset</span>: (-0.08, 0, 0.15)</li>
<li><span class="ScreenTextPACKT">Rotation Offset</span>: (0.29, 0.14, -13.29)</li>
<li><span class="ScreenTextPACKT">Destroy Trigger</span>: checked (true)</li>
</ul>
</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/afb575be-e9ad-4684-97f4-65b7497a1cc2.png"/></p>
<ol start="10">
<li>Run the <strong><span class="KeyWordPACKT">Scene</span>.</strong> Using the <span class="KeyPACKT">WASD</span> keyboard control scheme, direct the character to the the Cube-pickup GameObject. Colliding with it will add a badge to the character the first time. If public variable <span class="ScreenTextPACKT"><strong>Destroy Trigger</strong> was checked,</span> then the <span class="packt_screen">Cube-pickup</span> GameObject should be removed from the <span class="KeyWordPACKT">Scene</span> after the first collision:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/ae7f53cf-d82d-4c19-bf28-9c13a6f77ee6.png" style="width:39.92em;height:23.25em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Once it's been triggered by the character, the scripted instance-object attached to the Cube-pickup GameObject instantiates the assigned prefab, making it a child of the bones that they have been "placed into." The <strong><span class="ScreenTextPACKT">Position Offset</span></strong> and <strong><span class="ScreenTextPACKT">Rotation Offset</span></strong> can be used to fine-tune the exact position of the prop relative to its parent <span class="KeyWordPACKT">Transform</span>. As the props become parented by the bones of the animated character, they will follow and respect the parent character GameObejct's hierarchy and animation.</p>
<p>The <kbd><span class="CodeInTextPACKT">AlreadyHalreadyHasChildObject()</span></kbd> method checks for preexisting props of the same name before actually instantiating a new one, so we don't attempt to instantiate the prop more than once as a new child of the target bone.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Here are some ways to go further with this recipe.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Removing props with a script</h1>
                </header>
            
            <article>
                
<p>You can make a similar script to remove props. In this case, the <kbd><span class="CodeInTextPACKT">OnTriggerEnter(...)</span></kbd> method would invoke the following <kbd><span class="CodeInTextPACKT">RemoveProp()</span></kbd> method:</p>
<pre class="SourceCode">    private void RemoveProp() {<br/>         string propName = prop.name;<br/> <br/>         foreach(Transform child in targetBone){<br/>             if (child.name == propName)<br/>                 Destroy (child.gameObject);<br/>         }<br/>     }</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting Active if there's only one type of Prop</h1>
                </header>
            
            <article>
                
<p>If there will only be one prop, then rather than having the code Instantiate a new GameObject, you could have the prop always in the <span class="KeyWordPACKT">Hierarchy</span> but initially not active, and then when the pickup <span class="ScreenTextPACKT">Trigger</span> object is hit, you change the prop GameObject to be active.</p>
<p>Although less flexible, it's a much simpler script. Do the following:</p>
<ol>
<li>Drag the <span class="ScreenTextPACKT">badge</span> <strong>Prefab</strong> and make it a child of the <kbd><span class="ScreenTextPACKT">mixamorig:Spine2</span></kbd> <span class="KeyWordPACKT">Transform</span>, then set <strong><span class="ScreenTextPACKT">Position</span></strong> and <strong><span class="ScreenTextPACKT">Rotation</span></strong> as you did in Step 4 of the previous recipe.</li>
<li>In the <strong><span class="KeyWordPACKT">Inspector</span>,</strong> uncheck the <span class="ScreenTextPACKT">Active</span> checkbox for the whole <span class="ScreenTextPACKT">badge</span> GameObject at the top.</li>
<li>Replace the content of the C# script-manager with the following code:</li>
</ol>
<pre class="SourceCode" style="padding-left: 60px">using UnityEngine;<br/> <br/> public class PropManager : MonoBehaviour {<br/>      public GameObject propObject;<br/> <br/>     void OnTriggerEnter(Collider hit) {<br/>         if (hit.CompareTag("Player")) {<br/>             propObject.SetActive(true);<br/>             Destroy(gameObject);<br/>         }<br/>     }<br/> }</pre>
<ol start="4">
<li>With the Cube-pickup GameObject selected in the <strong><span class="KeyWordPACKT">Hierarchy</span>,</strong> in the <span class="KeyWordPACKT">Inspector</span> drag the badge child of <span class="ScreenTextPACKT">mixamorig:Spine2</span> into the public slot for the <span class="ScreenTextPACKT">Prop Object</span> variable of the <span class="ScreenTextPACKT">Prop Manager (Script)</span> component.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using Animation Events to throw an object</h1>
                </header>
            
            <article>
                
<p>Now that your animated character is ready, you might want to coordinate some of her actions with her animation states. In this recipe, we will show this by making the character throw an object whenever the appropriate animation clip reaches a particular tie point in the animation. To do so, we will make use of <span class="ScreenTextPACKT"><strong>Animation</strong> Events</span>, which basically trigger a function from the animation clip's timeline. This feature, introduced in the <span class="KeyWordPACKT">Mecanism</span> system, should feel familiar to those experienced with the <span class="ScreenTextPACKT">Add Event</span> feature of the classic <strong><span class="KeyWordPACKT">Animation</span></strong> panel:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/523ca6f8-ee07-4f39-bf52-d5eec4e64100.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, we have prepared a Unity Package named <strong><span class="ScreenTextPACKT">Throwing</span>,</strong> containing a basic scene that features an animated character and a <strong>prefab</strong> named <strong><span class="ScreenTextPACKT">EasterEgg</span>.</strong> The files can be found in the <kbd>09_07</kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To make an animated character throw an object, follow these steps:</p>
<ol>
<li>Create a new 3D project and import the <span class="ScreenTextPACKT">Props</span> Unity Package and the <kbd><span class="ScreenTextPACKT">EasterEgg</span></kbd> <span class="KeyWordPACKT">Texture</span>.</li>
<li>Open the <kbd><span class="ScreenTextPACKT">mecanimPlayground</span></kbd> level.</li>
<li>Play the level and press <em><span class="KeyPACKT">F</span></em> on your keyboard. The character will move as if she is throwing something with her right hand.</li>
</ol>
<ol start="4">
<li>Create a new C# script-class named <kbd><span class="ScreenTextPACKT">ThrowObject</span>,</kbd> and add an instance-object as a component to the character's <span class="ScreenTextPACKT"><kbd>MsLaser</kbd> </span>GameObject:</li>
</ol>
<pre class="SourceCode">    using UnityEngine;<br/>     using System.Collections;<br/> <br/>     public class ThrowObject : MonoBehaviour {<br/>       public GameObject prop;<br/>       private GameObject proj;<br/>       public Vector3 posOffset;<br/>       public Vector3 force;<br/>       public Transform hand;<br/>       public float compensationYAngle = 0f;<br/> <br/>       public void Prepare () {<br/> <br/>         proj = Instantiate(prop, hand.position, hand.rotation) as GameObject;<br/>         if(proj.GetComponent&lt;Rigidbody&gt;())<br/>           Destroy(proj.GetComponent&lt;Rigidbody&gt;());<br/>         proj.GetComponent&lt;SphereCollider&gt;().enabled = false;<br/>         proj.name = "projectile";<br/>         proj.transform.parent = hand;<br/>         proj.transform.localPosition = posOffset;<br/>         proj.transform.localEulerAngles = Vector3.zero;<br/>       }<br/> <br/>       public void Throw () {<br/> <br/>         Vector3 dir = transform.rotation.eulerAngles;<br/>         dir.y += compensationYAngle;<br/>         proj.transform.rotation = Quaternion.Euler(dir);<br/>         proj.transform.parent = null;<br/>         proj.GetComponent&lt;SphereCollider&gt;().enabled = true;<br/>         Rigidbody rig = proj.AddComponent&lt;Rigidbody&gt;();<br/>         Collider projCollider = proj.GetComponent&lt;Collider&gt; ();<br/>         Collider col = GetComponent&lt;Collider&gt; ();<br/>         Physics.IgnoreCollision(projCollider, col);<br/>         rig.AddRelativeForce(force);<br/>       }<br/>     }</pre>
<ol start="5">
<li>In the <strong>Hie<span class="KeyWordPACKT">rarchy</span>,</strong> ensure the <strong><span class="ScreenTextPACKT">MsLaser</span></strong> GameObject is selected. In the <strong><span class="KeyWordPACKT">Inspector,</span></strong> examine its <strong><span class="ScreenTextPACKT">Throw Object (Script)</span></strong> component. Populate the following:
<ul>
<li><span class="ScreenTextPACKT">Prop</span>: The <kbd><span class="ScreenTextPACKT">EasterEgg</span></kbd> prefab</li>
<li><span class="ScreenTextPACKT">Hand</span>: <kbd><span class="ScreenTextPACKT">mixamorig:RightHand</span></kbd></li>
<li><span class="ScreenTextPACKT">Pos Offset</span>: Set to (0; 0.07, 0.04)</li>
<li><span class="ScreenTextPACKT">Force</span>: Set to (0; 200, 500)</li>
</ul>
</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/eb4b94fa-7b65-42ee-9df4-7f0f625775ec.png"/></p>
<ol start="6">
<li>From the <strong><span class="KeyWordPACKT">Pro</span><span class="KeyWordPACKT">ject</span></strong> panel, select the <kbd><span class="ScreenTextPACKT">Swat@toss_grenade</span></kbd> asset file. In the <strong><span class="KeyWordPACKT">Inspector</span>,</strong> select the <strong><span class="ScreenTextPACKT">Animation</span></strong> section, scroll down to the <strong><span class="ScreenTextPACKT">Events</span></strong> section, and expand it.</li>
</ol>
<ol start="7">
<li>Explore the <strong>Animation</strong> preview panel and see how, as you drag the preview playhead along the preview <strong><span class="ScreenTextPACKT">Timeline</span>,</strong> the playhead also moves correspondingly in the <strong>Events</strong> timeline. At the bottom of the <strong><span class="KeyWordPACKT">Preview</span></strong> panel, the time, percentage, and <span class="ScreenTextPACKT">Frame</span> properties are displayed. When you click the add event button, a new <span class="ScreenTextPACKT"><strong>Animation Event</strong></span> will be added in the <strong><span class="ScreenTextPACKT">Events Timeline</span></strong> at the current playhead position, so ensure you have the playhead at the correct frame before creating a new <span class="ScreenTextPACKT"><strong>Animation</strong> Event:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/1ddda731-39e9-48fd-bb67-63378d4d8d4a.png"/></p>
<div class="packt_infobox">You may view the contents of this panel by focussing on the avatar animation itself when moving the playhead, and visually choosing the appropriate frame when the character is the desired position for the event. Or, you may already know the time/percentage/frame number at which you wish the <span class="ScreenTextPACKT">Animation Event</span> to be created, and so be focussing on the numerical values at the bottom of the Preview panel.</div>
<ol start="9">
<li>Create two <strong><span class="ScreenTextPACKT">Animation Events</span></strong> in the <span class="ScreenTextPACKT">Events</span> section as follows:
<ul>
<li>017.9%: Set <span class="ScreenTextPACKT">Function</span> to <span class="ScreenTextPACKT">Prepare</span></li>
<li>057.1%: Set <span class="ScreenTextPACKT">Function</span> to <span class="ScreenTextPACKT">Throw</span></li>
<li>Then, click the <span class="ScreenTextPACKT">Apply</span> button:</li>
</ul>
</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/0a763495-1ff1-435a-af2c-ceb19953071d.png"/></p>
<ol start="10">
<li>Play your <strong><span class="KeyWordPACKT">Scene</span>.</strong> Your character will now be able to throw an <strong><span class="ScreenTextPACKT">Easter</span> <span class="ScreenTextPACKT">Egg</span></strong> when you press the <span class="KeyPACKT">F </span>key.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Once the <kbd><span class="ScreenTextPACKT">toss_grenade</span></kbd> animation reaches the points to which we have set our <strong><span class="ScreenTextPACKT">Events</span>,</strong> the <kbd><span class="CodeInTextPACKT">Prepare()</span></kbd> and <kbd><span class="CodeInTextPACKT">Throw()</span></kbd> methods are invoked.</p>
<p>The <span class="CodeInTextPACKT"><kbd>Prepare()</kbd> method</span> instantiates a prefab, now named projectile, in the character's hand (<span class="ScreenTextPACKT">Projectile Offset</span> values are used to fine-tune its position), also making it respect the character's hierarchy. Also, it disables the prefab's collider and destroys its <span class="ScreenTextPACKT">Rigidbody</span> component, provided it has one.</p>
<p>The <span class="CodeInTextPACKT"><kbd>Throw()</kbd> method</span> enables the projectile's collider and adds a <span class="ScreenTextPACKT">Rigidbody</span> component to it, making it independent from the character's hand. Finally, it adds a relative force to the projectile's <span class="ScreenTextPACKT">Rigidbody</span> component, so it will behave as if thrown by the character. The <span class="ScreenTextPACKT">Compensation YAngle</span> can be used to adjust the direction of the grenade, if necessary.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Applying Ragdoll physics to a character</h1>
                </header>
            
            <article>
                
<p>Action games often make use of <span class="ScreenTextPACKT">Ragdoll</span> physics to simulate the character's body's reaction to being affected by a hit or explosion. In this recipe, we will learn how to set up and activate <span class="ScreenTextPACKT">Ragdoll</span> physics for our character whenever she touches a spiky object. We will also use the opportunity to reset the character's position and animations a number of seconds after that event has occurred:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/fce4514f-6356-4231-9ce9-28555981a8d5.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, we have prepared a Unity Package named <span class="ScreenTextPACKT">Ragdoll</span>, containing a basic scene that features an animated character, and a prefab already placed in the scene named <span class="ScreenTextPACKT">Spawnpoint</span>. The files can be found in the <kbd>09_08</kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To apply <span class="ScreenTextPACKT">Ragdoll</span> physics to your character, follow these steps:</p>
<ol start="1">
<li>Create a new 3D project and import the <span class="ScreenTextPACKT">Ragdoll</span> Unity Package.</li>
<li>Open the <kbd><span class="ScreenTextPACKT">mecanimPlayground</span></kbd> level.</li>
<li>You will see the animated <span class="ScreenTextPACKT">MsLaser</span> character and a disc, Spawnpoint.</li>
<li>First, let's create and set up our <span class="ScreenTextPACKT">Ragdoll</span>. Create a new <span class="ScreenTextPACKT">3D Ragdoll</span> by choosing <span class="ScreenTextPACKT"><strong>Create</strong> | <strong>3D Object</strong> | <strong>Ragdoll....</strong></span> The <strong><span class="ScreenTextPACKT">Ragdoll</span></strong> wizard should pop up.</li>
<li>Assign the transforms as follows:
<ul>
<li><span class="ScreenTextPACKT">Pelvis: <kbd>mixamorig:Hips</kbd></span></li>
<li><span class="ScreenTextPACKT">Left Hips: <kbd>mixamorig:LeftUpLeg</kbd></span></li>
<li><span class="ScreenTextPACKT">Left Knee: <kbd>mixamorig:LeftLeg</kbd></span></li>
<li><span class="ScreenTextPACKT">Left Foot: <kbd>mixamorig:LeftFoot</kbd></span></li>
<li><span class="ScreenTextPACKT">Right Hips: <kbd>mixamorig:RightUpLeg</kbd></span></li>
<li><span class="ScreenTextPACKT">Right Knee: <kbd>mixamorig:RightLeg</kbd></span></li>
<li><span class="ScreenTextPACKT">Right Foot: <kbd>mixamorig:RightFoot</kbd></span></li>
<li><span class="ScreenTextPACKT">Left Arm: <kbd>mixamorig:LeftArm</kbd></span></li>
<li><span class="ScreenTextPACKT">Left Elbow: <kbd>mixamorig:LeftForeArm</kbd></span></li>
<li><span class="ScreenTextPACKT">Right Arm: <kbd>mixamorig:RightArm</kbd></span></li>
<li><span class="ScreenTextPACKT">Right Elbow: <kbd>mixamorig:RightForeArm</kbd></span></li>
<li><span class="ScreenTextPACKT">Middle Spine: <kbd>mixamorig:Spine1</kbd></span></li>
<li><span class="ScreenTextPACKT">Head: mixamorig:Head</span></li>
<li><span class="ScreenTextPACKT">Total Mass: 20</span></li>
<li><span class="ScreenTextPACKT">Strength: 50</span></li>
</ul>
</li>
<li>See the screenshot for these settings:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/37968fc7-da9b-49cb-9c97-c3c97c67378e.png" style="width:29.58em;height:22.92em;"/></p>
<ol start="7">
<li>Select the <strong><span class="ScreenTextPACKT">MsLaser</span></strong> GameObject in the <span class="KeyWordPACKT">Hierarchy</span>. In the <strong><span class="KeyWordPACKT">Inspector,</span></strong> set its <strong><span class="ScreenTextPACKT">Tag</span></strong> to <strong><span class="ScreenTextPACKT">Player</span>.</strong></li>
<li>Create a new C# script-class named <kbd><span class="ScreenTextPACKT">RagdollCharacter</span></kbd> and add an instance-object as a component to the <strong><span class="ScreenTextPACKT">MsLaser</span></strong> GameObject:</li>
</ol>
<pre class="SourceCode">    using UnityEngine;<br/>     using System.Collections;<br/> <br/>     public class RagdollCharacter : MonoBehaviour {<br/>         private Transform spawnPoint;<br/> <br/>         void Start () {<br/>             spawnPoint = GameObject.Find("Spawnpoint").transform;<br/>             DeactivateRagdoll();<br/>         }<br/> <br/>         public void ActivateRagdoll() {<br/>             gameObject.GetComponent&lt;CharacterController&gt; ().enabled = false;<br/>             SetActiveRagdoll(true);<br/>             StartCoroutine (Restore ());<br/>         }<br/> <br/>         public void DeactivateRagdoll() {<br/>             SetActiveRagdoll(false);<br/>             RespawnPlayer();<br/>             gameObject.GetComponent&lt;CharacterController&gt;().enabled = true;<br/>         }<br/> <br/>         IEnumerator Restore() {<br/>             yield return new WaitForSeconds(5);<br/>             DeactivateRagdoll();<br/>         }<br/> <br/>         public void SetActiveRagdoll(bool isActive) {<br/>             gameObject.GetComponent&lt;CharacterController&gt; ().enabled = !isActive;<br/>             gameObject.GetComponent&lt;BasicController&gt; ().enabled = !isActive;<br/>             gameObject.GetComponent&lt;Animator&gt; ().enabled = !isActive;<br/> <br/>             foreach (Rigidbody bone in GetComponentsInChildren&lt;Rigidbody&gt;()) {<br/>                 bone.isKinematic = !isActive;<br/>                 bone.detectCollisions = isActive;<br/>             }<br/> <br/>             foreach (CharacterJoint joint in GetComponentsInChildren&lt;CharacterJoint&gt;()) {<br/>                 joint.enableProjection = isActive;<br/>             }<br/> <br/>             foreach (Collider col in GetComponentsInChildren&lt;Collider&gt;()) {<br/>                 col.enabled = isActive;<br/>             }<br/>         }<br/> <br/>         private void RespawnPlayer() {<br/>             transform.position = spawnPoint.position;<br/>             transform.rotation = spawnPoint.rotation;<br/>         }<br/>     }</pre>
<ol start="9">
<li>This recipe needs something to collide with; create a GameObject named <span class="ScreenTextPACKT">death-object</span>. You could create a simple <span class="ScreenTextPACKT">3D Cube</span> (menu: <span class="ScreenTextPACKT"><strong>Create</strong> | 3D <strong>Object</strong> | <strong>Cube</strong></span><strong>).</strong> However, any 3D object with a <span class="ScreenTextPACKT">Physics Collider</span> will be fine for the player's character to interact with.</li>
</ol>
<div class="packt_infobox">It's more fun to have a visually interesting 3D model to interact with. When creating the screenshots for this recipe, we used the high-quality, low-poly, free <span class="ScreenTextPACKT">Stilized Crystal</span> assets from <span class="ScreenTextPACKT">LowlyPoly</span> in the Unity <span class="KeyWordPACKT">Asset Store</span> as example objects you might use to cause a <span class="ScreenTextPACKT">Ragdoll</span> collision in a game:<br/>
<a href="https://assetstore.unity.com/packages/3d/props/stylized-crystal-77275" target="_blank"><span class="URLPACKT">https://assetstore.unity.com/packages/3d/props/stylized-crystal-77275</span></a></div>
<div class="CDPAlignCenter CDPAlign"><img src="assets/f53c0851-5482-4096-ab7b-fbbd077c6bc7.png" style="width:50.83em;height:19.17em;"/></div>
<ol start="10">
<li>Create a new C# script-class named <kbd><span class="ScreenTextPACKT">DeadlyObject</span>,</kbd> and attach an instance-object as a component to the <span class="ScreenTextPACKT">death-object</span> GameObject:</li>
</ol>
<pre class="SourceCode">    using UnityEngine;<br/> <br/>     public class DeadlyObject : MonoBehaviour {<br/>         public float range = 2f;<br/>         public float force = 2f;<br/>         public float up = 4f;<br/> <br/>         void OnTriggerEnter(Collider hit) {<br/>             if (hit.CompareTag("Player")) {<br/>                 RagdollCharacter ragdollCharacter = hit.gameObject.GetComponent&lt;RagdollCharacter&gt;();<br/>                 ExplodePlayer(ragdollCharacter);<br/>                 Destroy(gameObject);<br/>             }<br/>         }<br/> <br/>         private void ExplodePlayer(RagdollCharacter ragdollCharacter) {<br/>             ragdollCharacter.ActivateRagdoll();<br/>             Vector3 explosionPos = transform.position;<br/>             Collider[] colliders = Physics.OverlapSphere(explosionPos, range);<br/> <br/>             foreach (Collider collider in colliders) {<br/>                 if (collider.GetComponent&lt;Rigidbody&gt;())<br/>                     collider.GetComponent&lt;Rigidbody&gt;().AddExplosionForce(force, explosionPos, range, up);<br/>             }<br/>         }<br/>     }</pre>
<ol start="11">
<li>Play the <strong>Scene.</strong> Using the <span class="KeyPACKT">WASD</span> keyboard control scheme, direct the character to the <span class="ScreenTextPACKT">death-object</span> GameObject. Colliding with it will activate the character's <span class="ScreenTextPACKT">Ragdoll</span> physics and apply an explosion to it. As a result, the character will be thrown a considerable distance away and will no longer be in control of its body's movement, akin to a <span class="ScreenTextPACKT">Ragdoll</span>.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Unity's <span class="ScreenTextPACKT">Ragdoll Wizard</span> assigns the <span class="ScreenTextPACKT">Collider</span>, <span class="ScreenTextPACKT">Rigidbody</span>, and <span class="ScreenTextPACKT">Character Joint</span><span> </span><span>components</span><span> </span><span>to selected transforms</span><span>. In conjunction, those components make</span> <span class="ScreenTextPACKT">Ragdoll</span> <span>physics possible. However, they must be disabled whenever we want our character to be animated and controlled by the player. In our case, we switch those components on and off using the</span> <kbd><span class="ScreenTextPACKT">RagdollCharacter</span></kbd> <span>script and its two functions:</span> <kbd><span class="CodeInTextPACKT">ActivateRagdoll()</span></kbd> <span>and</span> <span class="CodeInTextPACKT"><kbd>DeactivateRagdoll().</kbd> T</span><span>he latter includes instructions to respawn our character in the appropriate place.</span></p>
<p>For testing purposes, we have also created the <kbd><span class="ScreenTextPACKT">DeadlyObject</span></kbd> script, which calls the <kbd><span class="ScreenTextPACKT">RagdollCharacter</span></kbd> script's function named <kbd><span class="CodeInTextPACKT">ActivateRagdoll()</span>.</kbd> It also applies an explosion to our ragdoll character, throwing it outside the <span>range of the </span><span>explosion.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Here are some ways to go further with this recipe.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using a new player GameObject rather than deactivating and moving to a respawn point</h1>
                </header>
            
            <article>
                
<p>Instead of resetting the character's transform settings, you could have destroyed its GameObject and instantiated a new one over the respawn point using Tags. For an example of how to do this, check out Unity's documentation: <a href="http://docs.unity3d.com/ScriptReference/GameObject.FindGameObjectsWithTag.html" target="_blank"><span class="URLPACKT">http://docs.unity3d.com/ScriptReference/GameObject.FindGameObjectsWithTag.html</span></a></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Rotating the character's torso to aim a weapon</h1>
                </header>
            
            <article>
                
<p>When playing a <span class="ScreenTextPACKT">Third-Person Character</span>, you might want her to aim her weapon at a target that is not directly in front of her, without making her change direction. In this case, you will need to apply what is called a <span class="KeyWordPACKT">Procedural Animation</span>, which does not rely on pre-made animation clips, but rather on the processing of other data, such as player input, to animate the character. In this recipe, we will use this technique to rotate the character's spine by moving the mouse, allowing for adjustments in the character's aim. We will also use this opportunity to cast a ray from the character's weapon and display a crosshair over the nearest target. Please note that this approach will only work with cameras standing behind the third-person controlled characters:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/7b4e1c26-5a69-4201-8fe2-9a08f21ccc56.png" style="width:30.08em;height:10.67em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, we have prepared a Unity Package named <kbd><span class="ScreenTextPACKT">AimPointer</span>,</kbd> containing a basic scene that features an animated character. The package, which also includes the <kbd><span class="ScreenTextPACKT">crossAim</span></kbd> sprite to be used as a crosshair for aiming, can be found inside the <kbd>09_09</kbd> folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To rotate the character's torso to aim a weapon, do the following:</p>
<ol>
<li>Create a new project and import the <kbd><span class="ScreenTextPACKT">AimPointer</span></kbd> Unity Package.</li>
<li>Open the <kbd><span class="ScreenTextPACKT">mecanimPlayground</span></kbd> level. In the <strong><span class="KeyWordPACKT">Inspector</span></strong> and <strong><span class="KeyWordPACKT">Scene</span></strong> panels, you will see an animated character named <strong><span class="ScreenTextPACKT">MsLaser</span></strong> holding the <strong><span class="ScreenTextPACKT">pointerPrefab</span></strong> object.</li>
<li>Create a new C# script-class named <kbd><span class="ScreenTextPACKT">MouseAim</span>,</kbd> and add an instance-object as a component to the <strong><span class="ScreenTextPACKT">MsLaser</span></strong> GameObject:</li>
</ol>
<pre class="SourceCode" style="padding-left: 60px">    using UnityEngine;<br/>     using System.Collections;<br/> <br/>     public class MouseAim: MonoBehaviour  {<br/>         public Transform spine;<br/>         public Transform weapon;<br/>         public GameObject crosshairImage;<br/>         public Vector2 xLimit = new Vector2(-30f, 30f);<br/>         public Vector2 yLimit= new Vector2(-30f, 30f);<br/>         private float xAxis = 0f;<br/>         private float yAxis = 0f;<br/> <br/>         public void LateUpdate() {<br/>             RotateSpine();<br/>             ShowCrosshairIfRaycastHit();<br/>         }<br/> <br/>         private void RotateSpine() {<br/>             yAxis += Input.GetAxis("Mouse X");<br/>             yAxis = Mathf.Clamp(yAxis, yLimit.x, yLimit.y);<br/>             xAxis -= Input.GetAxis("Mouse Y");<br/>             xAxis = Mathf.Clamp(xAxis, xLimit.x, xLimit.y);<br/>             Vector3 newSpineRotation = new Vector3(xAxis, yAxis, spine.localEulerAngles.z);<br/>             spine.localEulerAngles = newSpineRotation;<br/>         }<br/> <br/>         private void ShowCrosshairIfRaycastHit() {<br/>             Vector3 weaponForwardDirection = weapon.TransformDirection(Vector3.forward);<br/>             RaycastHit hit;<br/>             Vector3 fromPosition = weapon.position + Vector3.one;<br/>             if (Physics.Raycast (fromPosition, weaponForwardDirection, out hit)) {<br/>                 Vector3 hitLocation =  Camera.main.WorldToScreenPoint(hit.point);<br/>                 DisplayPointerImage(hitLocation);<br/>             } else<br/>                 crosshairImage.SetActive(false);<br/>         }<br/> <br/>         private void DisplayPointerImage(Vector3 hitLocation) {<br/>             crosshairImage.transform.position = hitLocation;<br/>             crosshairImage.SetActive(true);<br/>         }<br/>     }</pre>
<ol start="4">
<li>In the <strong><span class="KeyWordPACKT">Hierarchy,</span></strong> create a new UI Image named <span class="ScreenTextPACKT">Image-crosshair</span> by choosing <span class="ScreenTextPACKT"><strong>Create</strong> | <strong>UI</strong> | <strong>Image</strong></span><strong>.</strong></li>
<li>In the <strong><span class="KeyWordPACKT">Inspector</span></strong> for the <span class="ScreenTextPACKT">Rect Transform</span> component, set its <span class="ScreenTextPACKT">Width</span> and <span class="ScreenTextPACKT">Height</span> to <span class="ScreenTextPACKT">16</span> and populate the <strong><span class="ScreenTextPACKT">Source Image</span></strong> field with the <kbd><span class="ScreenTextPACKT">crossAim</span></kbd> sprite:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/86d601c1-1cc0-4eb1-b0a2-e38e039819f3.png"/></p>
<ol start="6">
<li>Select the <strong><span class="ScreenTextPACKT">MsLaser</span></strong> GameObject in the <strong><span class="KeyWordPACKT">Hierarchy</span>,</strong> and in the <strong><span class="KeyWordPACKT">Inspector</span></strong> for the <span class="ScreenTextPACKT">Mouse Aim</span> component, populate the following:
<ul>
<li><span class="ScreenTextPACKT">Spine: <kbd>mixamorig:Spine</kbd></span> (in <span class="ScreenTextPACKT"><strong>MsLaser</strong> | <strong>mixamorigHips</strong></span><strong>)</strong></li>
<li><span class="ScreenTextPACKT">Weapon: <kbd>pointerPrefab</kbd></span> (in <strong><span class="ScreenTextPACKT">MsLaser|Hips|Spine|Spine1|Spine2|RightShoulder|Arm|ForeArm|Hand</span></strong>)</li>
<li><span class="ScreenTextPACKT">Crosshair</span>: <span class="ScreenTextPACKT">Image-crosshair</span> GameObject</li>
</ul>
</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/1d04192a-a3c9-4549-8a1f-993225b39756.png"/></p>
<ol start="7">
<li>Play the <span class="KeyWordPACKT">Scene</span>. You will now be able to rotate the character's torso by moving the mouse. Even better, the <span class="ScreenTextPACKT">Image-crosshair UI</span> image will be displayed at the top of the object that is being aimed at by the pointer.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>You might have noticed that all the code invoked for rotating the character's spine is inside the <kbd><span class="CodeInTextPACKT">LateUpdate()</span></kbd> method, as opposed to the more common <kbd><span class="CodeInTextPACKT">Update()</span></kbd> method. The reason for this is to make sure that all the transform manipulation will be executed after the original animation clip is played, overriding it.</p>
<p>Regarding the spine rotation, our script adds the horizontal and vertical speed of the mouse to the <span class="ScreenTextPACKT">xAxis</span> and <span class="ScreenTextPACKT">yAxis</span> float variables. These variables are then constrained within the specified limits, avoiding distortions to the character's model. Finally, the spine object transform rotations for the x and y axes are set to <span class="ScreenTextPACKT">xAxis</span> and <span class="ScreenTextPACKT">yAxis</span> respectively. The z axis is preserved from the original <span class="ScreenTextPACKT">Animation Clip</span>.</p>
<p>Additionally, our script uses a <span class="ScreenTextPACKT">Raycast</span> command to detect whether there is an object's collider in the direction of the weapon's aim, in which case, a crosshair will be drawn on the screen.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Here are some ways to go further with this recipe.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Generic solution for Cameras other than the Main Camera</h1>
                </header>
            
            <article>
                
<p>Since this recipe's script was tailored for cameras standing behind third-person-controlled characters, we have included a more generic solution to the problem - in fact, a similar approach to the one presented in <em>Unity 4.x Cookbook, Packt Publishing</em>.</p>
<p>An alternate script named <kbd><span class="ScreenTextPACKT">MouseAimLookAt</span>,</kbd> which can be found inside the <kbd>09_09</kbd> folder, starts by converting our bi-dimensional mouse cursor screen's coordinates to three-dimensional world space coordinates (stored in a point variable). Then, it rotates the character's torso towards the point location, using the <kbd><span class="CodeInTextPACKT">LookAt()</span></kbd> command to do so. Additionally, it makes sure that the spine does not extrapolate <span class="ScreenTextPACKT">minY</span> and <span class="ScreenTextPACKT">maxY</span> angles, which would otherwise causing distortions to the character model.</p>
<p>Also, we have included a <span class="ScreenTextPACKT">Compensation <kbd>YAngle</kbd></span> variable, which makes it possible for us to fine-tune the character's alignment with the mouse cursor. Another addition is the option to freeze the X-axis rotation, in case you just want the character to rotate their torso laterally but not look up or down. Again, this script uses a <strong><span class="ScreenTextPACKT">Raycast</span></strong> command to detect objects in front of the weapon, drawing a crosshair on the screen when they are present.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating geometry with Probuilder</h1>
                </header>
            
            <article>
                
<p>A recent addition to the 3D Unity tools is <strong><span class="KeyWordPACKT">Probuilder</span>,</strong> which allows you to create and manipulate geometry inside the Unity Editor. Much more powerful than the existing <strong>Terrain</strong> editor, <strong>Probuilder</strong> allows you to create 3D Primitives and then manipulate them, such as by extruding or moving <span class="KeyWordPACKT">Vertices</span>, <span class="KeyWordPACKT">Edges,</span> or <span class="KeyWordPACKT">Faces</span>, and then painting with colors or texturing with <span class="KeyWordPACKT">Materials</span>.</p>
<p>In this recipe, we'll create some geometry that might be useful for an original game, or to add to a 3D Gamekit Scene (such as the Scene worked with in the following recipe).</p>
<p>If you've not used a 3D modeling package before (such as<span> </span><span class="ScreenTextPACKT">Blender,</span><span> </span><span class="ScreenTextPACKT">3D Studio Max,</span><span> </span>or<span> </span><span class="ScreenTextPACKT">Maya</span>), then it is well worth exploring the different features of<span> </span><strong><span class="ScreenTextPACKT">Probuilder</span>.</strong> You'll learn key concepts, including the following:</p>
<ul>
<li><span class="KeyWordPACKT">Vertex</span>: Point where lines touch—a corner where edges touch</li>
<li><span class="KeyWordPACKT">Edges</span>: Straight line between two vertices</li>
<li><span class="KeyWordPACKT">Faces</span>: Flat 2D surfaces, usually a rectangle or triangular</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>This recipe uses the free Unity Asset Store and Package Manager packages.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To create geometry with Probuilder, follow these steps:</p>
<ol>
<li>Create a new Unity 3D project.</li>
<li>Use the <strong>Package Manager</strong> to install the <strong><span class="KeyWordPACKT">Probuilder</span></strong> package.</li>
</ol>
<ol start="3">
<li>Display the <strong>Probuilder</strong> panel with <span class="ScreenTextPACKT"><strong>Tools</strong> | <strong>Probuilder</strong> | <strong>Window</strong></span><strong>.</strong></li>
<li>Dock the panel (next to the <strong>Hierarchy</strong> works well). Choose <strong><span class="ScreenTextPACKT">Text Mode</span></strong> or <span class="ScreenTextPACKT"><strong>Icon Mode</strong>,</span> as you prefer, via the right mouse button's context menu.</li>
<li>Create a new <strong><span class="KeyWordPACKT">Probuilder</span></strong> <span class="ScreenTextPACKT">Plane</span> by clicking <strong><span class="ScreenTextPACKT">New Shape</span></strong> and choosing <strong><span class="ScreenTextPACKT">Plane</span></strong> from the <strong><span class="ScreenTextPACKT">Shape Tool</span></strong> window. Accept the default options and click the green <strong><span class="ScreenTextPACKT">Build Plane</span></strong> button.</li>
<li>With the new <strong><span class="KeyWordPACKT">Probuilder</span></strong> <span class="ScreenTextPACKT">Plane</span> selected in the <span class="KeyWordPACKT">Hierarchy</span>, you'll see the object selected in the <span class="KeyWordPACKT">Scene</span> panel and its properties in the <span class="KeyWordPACKT">Inspector</span>. We can see in the Inspector that, as well as its Transform, Mesh, and Mesh Renderer components, there are two special <span class="KeyWordPACKT">Probuilder</span> components, <kbd>Pb_mesh_nnnnn</kbd> and <kbd>Pb_Object</kbd> (Script).</li>
</ol>
<div class="packt_infobox"><kbd>Pb_mesh_nnnnn</kbd> is a special component that stores the data for the 3D object mesh of this GameObject; this data can be edited in the <strong>Scene</strong> panel at <span class="KeyWordPACKT">design time</span>. At <span class="KeyWordPACKT">runtime,</span> a Unity Mesh is created based on this data.</div>
<p class="CDPAlignCenter CDPAlign"><img src="assets/bda71a43-8db9-43a3-97c7-b7d85f1181e7.png"/></p>
<ol start="7">
<li>Note that when a <strong><span class="KeyWordPACKT">Probuilder</span></strong> GameObject is selected, there is a small <strong><span class="KeyWordPACKT">Probuilder</span></strong> tool icon bar displayed in the <span class="KeyWordPACKT">Scene</span> panel, allowing the <span class="ScreenTextPACKT">Object, Vertex, Edge, and Face detection modes:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/abae42b2-3862-4823-97c3-c76646b7b950.png" style="width:23.33em;height:5.08em;"/></p>
<ol start="8">
<li>Let's make a depression in the middle of our <span class="ScreenTextPACKT">Plane</span>. Choose Face selection (the rightmost of the four <strong>Probuilder</strong> section icons), and using the <span class="KeyPACKT">Shift </span>key for multiple section, select the four inner faces (selected faces turn Yellow). Then, use the Y-axis arrow to move these four selected faces downwards:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/8d0411fb-5bb8-47ed-81e3-10a4772de6fb.png"/></p>
<ol start="9">
<li>Let's <span class="ScreenTextPACKT">Vertex Pa</span><span class="ScreenTextPACKT">int</span> some color on the object. This is easier to do carefully when there are more faces. First, in the <span class="KeyWordPACKT">Probuilder</span> panel, click the <span class="ScreenTextPACKT">Subdivide</span> tool.</li>
<li>Now, click <span class="KeyWordPACKT">Probuilder</span> <span class="ScreenTextPACKT">Vertex Colors +.</span> The <strong><span class="KeyWordPACKT">Probuilder</span></strong> <span class="ScreenTextPACKT">Vertex Painter</span> pop-up panel should be displayed. Click the red color and choose a darker red. Then, click the white square above your color to choose this dark red brush color. Make the brush size big (2 or 3), and paint all over the <span class="ScreenTextPACKT">Plane</span> to make it all dark red. Now, click the white square in the <span class="ScreenTextPACKT">Vertex Painter</span> panel to choose the yellow brush, and make the brush size smaller (say 1.5). Now, click on just the nine vertices in the middle of the depressed region of the <span class="ScreenTextPACKT">Plane</span>. Now, you should have a dark red <span class="ScreenTextPACKT">Plane</span> with yellow in the lower parts of it:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/373b51c4-9452-4f43-8ba9-9d5ba284879a.png" style="width:29.83em;height:11.58em;"/></p>
<ol start="11">
<li>Save your <span class="KeyWordPACKT">Sc</span><span class="KeyWordPACKT">ene. S</span>ince the <strong><span class="ScreenTextPACKT">Probuilder</span></strong> Mesh data is stored in the <span class="KeyWordPACKT">Scene</span> data, you'll lose all your Probuilder work if you forget to save your <span class="KeyWordPACKT">Scene</span>.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>You've added the <span class="KeyWordPACKT">Probuilder</span> package to a new 3D project and used the <strong><span class="KeyWordPACKT">Probuilder</span></strong> tools panel to add a <strong><span class="KeyWordPACKT">Probuilder</span></strong> mesh object to the <span class="KeyWordPACKT">Scene</span>. You've used the face selection tool to allow you to select and then move some of the faces to create a depression. You then subdivided the object to give you more faces to work with for final detailed working. Finally, you learned to <span class="ScreenTextPACKT">Vertex Paint</span> with difference colors and brush sizes.</p>
<p><strong><span class="KeyWordPACKT">Probuilder</span></strong> offers many more features, including creating object by drawing a line-by-line polygon and Texturing surfaces rather than just simple <span class="ScreenTextPACKT"><span class="packt_screen">Vertex Painting</span></span>. Learn more about <span class="KeyWordPACKT"><strong>Probuilder</strong> here</span>:</p>
<ul>
<li class="SourceCode">Unity Technology <strong><span class="KeyWordPACKT">Probuilder</span></strong> documentation manual: <a href="https://docs.unity3d.com/Packages/com.unity.probuilder@3.0/manual/index.html"><span class="URLPACKT"><span>https://docs.unity3d.com/Packages/com.unity.probuilder@3.0/manual/index.html</span></span></a></li>
<li class="SourceCode">Unity Technology <strong><span class="KeyWordPACKT">Probuilder</span></strong> videos: <a href="https://www.youtube.com/user/Unity3D/search?query=Probuilder"><span class="URLPACKT">https://www.youtube.com/user/Unity3D/search?query=Probuilder</span></a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a game with the 3D Gamekit</h1>
                </header>
            
            <article>
                
<p>A collection of Unity 3D tools has been combined to become the Unity 3D <strong><span class="KeyWordPACKT">GameKit</span></strong>. In this recipe, we'll create a new <strong><span class="KeyWordPACKT">Scene</span></strong> and make use of some of the kit's Prefabs and Scripts to illustrate how characters can interact with objects such as doors and pickups:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/c41cfef5-dfc9-4a95-b2d9-fdb64a8c96aa.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>This recipe uses the free <strong>Unity <span class="KeyWordPACKT">Asset Store</span></strong> and <strong><span class="KeyWordPACKT">Package Manager</span></strong> packages.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To create a game with the 3D <span class="KeyWordPACKT">Gamekit</span>, follow these steps:</p>
<ol>
<li>Create a new <span class="packt_screen">Unity 3D</span> project.</li>
<li>Use the <span class="KeyWordPACKT"><span class="packt_screen">Package Manager</span></span> to install the following packages (required by the 3D GameKit):
<ul>
<li><span class="ScreenTextPACKT"><span class="packt_screen">Cinemachine</span></span></li>
<li><span class="ScreenTextPACKT"><span class="packt_screen">Post Processing</span></span> (agree to the <span class="ScreenTextPACKT">Quality Settings</span> pop-up diaglog)</li>
<li><span class="ScreenTextPACKT"><span class="packt_screen">Probuilder</span></span></li>
</ul>
</li>
<li>Import the <strong>3D <span class="KeyWordPACKT">GameKit</span></strong> (free from Unity Technologies) from the <span class="ScreenTextPACKT"><span class="packt_screen">Asset Store</span>:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/a82197e1-10a8-46fe-87bf-ee8e0f187c4a.png" style="width:32.08em;height:5.08em;"/></p>
<ol start="4">
<li>Agree to the <span class="ScreenTextPACKT"><span class="packt_screen">Quality Setting</span><span class="packt_screen">s</span></span> pop-up diaglog. After a few minutes (in which it is setting up a project with lots of assets), you'll see a new folder in the <span class="packt_screen">Project</span> panel named <span class="ScreenTextPACKT"><span class="packt_screen">3DGamekit</span></span>.</li>
<li>Close and then reopen the Unity Editor.</li>
<li>First, open the example <strong><span class="KeyWordPACKT">Scene</span></strong> provided and explore the 3D world by controlling the 3D <span class="ScreenTextPACKT"><span class="packt_screen">Ellen</span></span> character.</li>
</ol>
<div class="packt_infobox">Movement is standard <em><span class="KeyPACKT">WASD-SPACE</span></em>/arrow keys. <span class="KeyWordPACKT">Camera</span> control is via the mouse pointer. Click the left mouse button to use a weapon.</div>
<ol start="7">
<li>Create a new 3D <strong><span class="KeyWordPACKT">GameKit</span></strong> Scene by choosing <span class="ScreenTextPACKT"><span class="packt_screen">Kit Tools | Create New Scene</span></span>. You'll then be asked to name the <strong><span class="KeyWordPACKT">Scene</span></strong>, and a new <strong><span class="KeyWordPACKT">Scene</span></strong> asset file will be created in your <span class="ScreenTextPACKT"><span class="packt_screen">Project | Assets</span></span> folder. You'll see there are quite a few special GameObjects in the <span class="KeyWordPACKT"><span class="packt_screen">Hierarchy</span></span> of your new <strong><span class="KeyWordPACKT">Scene</span></strong>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/d0ce5460-ef14-4600-b9e9-6682ec9d54e2.png"/></p>
<ol start="8">
<li>As you can see, the new <strong><span class="KeyWordPACKT">Scene</span></strong> starts off containing an animated 3D character <span class="packt_screen">(<span class="ScreenTextPACKT">Ellen</span>)</span> on a ProBuilder <span class="ScreenTextPACKT"><span class="packt_screen">3D Plane</span></span> that forms the ground she is standing on.</li>
<li>Add a small door in the <span class="KeyWordPACKT"><span class="packt_screen">Scene</span></span>. Drag a clone of the <span class="packt_screen"><span class="ScreenTextPACKT">DoorSmall</span> Prefab</span> from the <span class="KeyWordPACKT">Project</span> panel (<span class="ScreenTextPACKT"><span class="packt_screen">Assets | 3DGamekit | Prefabs | Interactables</span></span>) into the middle of the <span class="ScreenTextPACKT">3D Plane</span> <strong><span class="KeyWordPACKT">Scene</span></strong>.</li>
<li>Add a <span class="ScreenTextPACKT"><span class="packt_screen">Crystal</span></span> in the <strong><span class="KeyWordPACKT">Scene</span></strong>, on the opposite side of the door from where the <span class="ScreenTextPACKT"><span class="packt_screen">Ellen</span></span> character starts. Drag a clone of the <span class="packt_screen"><span class="ScreenTextPACKT">Crystal</span> Prefab</span> from the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel (<span class="ScreenTextPACKT"><span class="packt_screen">Assets | 3DGamekit | Prefabs | Interactables</span></span>) into the <strong><span class="KeyWordPACKT">Scene</span></strong> behind the door.</li>
<li>Now, add some walls on either side of the door, so the door must be opened in order for <span class="ScreenTextPACKT"><span class="packt_screen">Ellen</span></span> to reach the <span class="packt_screen"><span class="ScreenTextPACKT">Crystal</span></span>. Drag two clones of Prefab <span class="ScreenTextPACKT"><span class="packt_screen">Wall2x</span></span> from the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel (<span class="KeyWordPACKT"><span class="packt_screen">Assets | 3DGamekit | Prefabs | Interactables</span></span>) into the <span class="KeyWordPACKT"><strong>Scene</strong>:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/1224aa6b-91a4-4692-9184-2f984cc1f317.png"/></p>
<ol start="12">
<li>We now need to connect the <span class="ScreenTextPACKT"><span class="packt_screen">PressurePad</span></span> to the <span class="ScreenTextPACKT"><span class="packt_screen">Door</span></span>, so when <span class="ScreenTextPACKT"><span class="packt_screen">Ellen</span></span> steps on the <span class="ScreenTextPACKT"><span class="packt_screen">PressurePad</span></span> it sends a message to open the door. This is very straightforward, since the <span class="ScreenTextPACKT">Door</span> has a <span class="ScreenTextPACKT"><span class="packt_screen">GameCommandReceiver</span></span> component, which can be linked to the <span class="ScreenTextPACKT"><span class="packt_screen">PressurePad</span>'s</span> <span class="ScreenTextPACKT">Send on <span class="packt_screen">Trigger Enter (Script)</span></span> component. Select the <span class="ScreenTextPACKT"><span class="packt_screen">PressurePad</span></span> GameObject in the <span class="KeyWordPACKT"><span class="packt_screen">Hierarchy</span></span> and drag <span class="packt_screen"><span class="ScreenTextPACKT">DoorSmall</span></span> into the public <span class="ScreenTextPACKT"><span class="packt_screen">Interactive Object</span></span> slot of its <span class="ScreenTextPACKT"><span class="packt_screen">Send on Trigger Enter (Script)</span></span> component:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/04421538-cb59-41b5-ba19-7f99f4658a55.png"/></p>
<ol start="13">
<li>Run the <strong><span class="KeyWordPACKT">Scene</span></strong>. When <span class="ScreenTextPACKT"><span class="packt_screen">Ellen</span></span> steps onto the <span class="ScreenTextPACKT"><span class="packt_screen">PressurePad</span>,</span> the <span class="ScreenTextPACKT"><span class="packt_screen">Door</span></span> should open.</li>
<li>We now need to make the <span class="ScreenTextPACKT"><span class="packt_screen">Crystal</span></span> collidable by adding a <span class="ScreenTextPACKT"><span class="packt_screen">Box Collider</span></span>. Add a <span class="ScreenTextPACKT"><span class="packt_screen">Box Collider</span></span> component to GameObject <span class="ScreenTextPACKT"><span class="packt_screen">Crystal</span></span> and check its <span class="ScreenTextPACKT"><span class="packt_screen">On Trigger</span></span> option.</li>
<li>The <strong><span class="KeyWordPACKT">3D Gamekit</span></strong> has inventory features. Let's make the <span class="ScreenTextPACKT"><span class="packt_screen">Crystal</span></span> collectable by the player by adding an <span class="ScreenTextPACKT"><span class="packt_screen">Inventory Item (Script)</span></span> component. In the <span class="KeyWordPACKT"><strong>Inspector</strong>,</span> click <span class="ScreenTextPACKT"><span class="packt_screen">Add Component</span></span>, then type <span class="ScreenTextPACKT"><span class="packt_screen">inven</span></span> and choose the <span class="ScreenTextPACKT"><span class="packt_screen">Inventory Item</span></span> scripted component. For that component, type <span class="ScreenTextPACKT"><span class="packt_screen">Crystal</span></span> as the name of the <span class="ScreenTextPACKT"><span class="packt_screen">Inventory Key</span>:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/cd5e7d90-f9fa-4f87-824d-9544e5c5d6cb.png"/></p>
<div class="packt_infobox">The <span class="ScreenTextPACKT"><span class="packt_screen">Inventory Key</span></span> names must match between the <span class="ScreenTextPACKT"><span class="packt_screen">Inventory Object</span></span> and the <span class="ScreenTextPACKT">Inventory</span> slot.</div>
<ol start="16">
<li>Now, we can add an <span class="ScreenTextPACKT"><span class="packt_screen">Inventory Controller (Script)</span></span> component to <span class="ScreenTextPACKT"><span class="packt_screen">Ellen</span></span>, with a slot for a <span class="ScreenTextPACKT"><span class="packt_screen">Crystal</span></span>. In the <span class="KeyWordPACKT"><span class="packt_screen">Hierarchy</span>,</span> select the<span class="packt_screen"> <span class="ScreenTextPACKT">Ellen</span></span> GameObject. In the <span class="KeyWordPACKT"><strong>Inspector</strong>,</span> click <span class="ScreenTextPACKT"><span class="packt_screen">Add Component</span></span>, then type <span class="ScreenTextPACKT"><span class="packt_screen">inven</span></span> and choose the <span class="ScreenTextPACKT"><span class="packt_screen">Inventory Item</span></span> scripted component.</li>
<li>In the <span class="KeyWordPACKT"><strong>Inspector</strong>,</span> we now need to configure the properties of the <span class="packt_screen"><span class="ScreenTextPACKT">Inventory Controller</span> <span class="ScreenTextPACKT">(Script)</span></span> component as follows:
<ul>
<li>Change the <span class="ScreenTextPACKT"><span class="packt_screen">Size</span></span> from <kbd>0</kbd> to <kbd>1</kbd></li>
<li>For its <span class="ScreenTextPACKT"><span class="packt_screen">Key</span>,</span> type <span class="ScreenTextPACKT"><span class="packt_screen">Crystal</span></span></li>
<li>For the <span class="ScreenTextPACKT"><span class="packt_screen">On Add()</span></span> events, click the plus sign, <span class="ScreenTextPACKT">+</span>, to create a new event.</li>
<li>Drag <span class="ScreenTextPACKT"><span class="packt_screen">Ellen</span></span> into the <span class="ScreenTextPACKT"><span class="packt_screen">Object</span></span> slot for the new event (below <span class="ScreenTextPACKT"><span class="packt_screen">Runtime Only</span></span>).</li>
<li>Change the function from <span class="ScreenTextPACKT"><span class="packt_screen">No Function</span></span> to <span class="ScreenTextPACKT">I<span class="packt_screen">nventoryController Add Item</span></span>.</li>
<li>Finally, type the name of this item in the <span class="ScreenTextPACKT"><span class="packt_screen">Inventory</span></span> as <span class="ScreenTextPACKT"><span class="packt_screen">Crystal</span>:</span></li>
</ul>
</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/6e3770da-70b6-4b32-8fda-ec00df5d6dad.png" style="width:38.83em;height:17.33em;"/></p>
<ol start="18">
<li>Run the <strong><span class="KeyWordPACKT">Scene</span></strong>. <span class="ScreenTextPACKT"><span class="packt_screen">Ellen</span></span> can now open the <span class="ScreenTextPACKT"><span class="packt_screen">Door</span></span> via the <strong><span class="ScreenTextPACKT">PressurePad</span></strong> and walk into the <span class="ScreenTextPACKT"><span class="packt_screen">Crystal</span></span>, which is added to her inventory.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>We have dipped our toes into the wide range of features of the <strong><span class="KeyWordPACKT">3D GameKit</span></strong>. Hopefully, this recipe gave you an idea of how to work with the provided <strong>Prefabs,</strong> and how <strong><span class="KeyWordPACKT">3D Gamekit</span></strong> components could be added to custom GameObjects.</p>
<p>Check out these links to learn more:</p>
<ul>
<li>The 3DGamekit reference guide: <a href="https://unity3d.com/learn/tutorials/projects/3d-game-kit/introduction-3d-reference-guide?playlist=51061"><span class="URLPACKT">https://unity3d.com/learn/tutorials/projects/3d-game-kit/introduction-3d-reference-guide?playlist=51061</span></a></li>
<li class="SourceCode">The Unity 3DGamekit walkthrough pages: <a href="https://unity3d.com/learn/tutorials/projects/3d-game-kit/introduction-walkthrough?playlist=51061"><span class="URLPACKT"><span>https://unity3d.com/learn/tutorials/projects/3d-game-kit/introduction-walkthrough?playlist=51061</span></span></a></li>
<li class="SourceCode">Download the 3DGameKit, including a sample Scene, from the Asset Store: <a href="https://assetstore.unity.com/packages/essentials/tutorial-projects/3d-game-kit-beta-115747?_ga=2.127077645.1823824032.1533576706-1834737598.1481552646"><span class="URLPACKT">https://assetstore.unity.com/packages/essentials/tutorial-projects/3d-game-kit-beta-115747?_ga=2.127077645.1823824032.1533576706-1834737598.1481552646</span></a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Importing third-party 3D models and animations from Mixamo</h1>
                </header>
            
            <article>
                
<p>While there are many <strong>3D models</strong> and animations available and ready to use in Unity from the <span class="KeyWordPACKT"><span class="packt_screen">Asset Store</span></span>, there are many more sources of 3D assets from third-party organisations. <span class="ScreenTextPACKT"><span class="packt_screen">Mixamo</span></span> (now part of <span class="ScreenTextPACKT"><span class="packt_screen">Adobe</span></span>) offers a fantastic range of characters and animations via their web-based system.</p>
<p class="CDPAlignLeft CDPAlign">In this recipe, we'll select and download a character and some animations, formatting them for use with Unity and controlling the animations with an <span class="packt_screen"><span class="ScreenTextPACKT">Animation Controller</span> <span class="ScreenTextPACKT">State Chart</span></span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/f4718f36-a89d-4b84-854d-a9457d4759cf.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>This recipe uses the free <span class="ScreenTextPACKT"><span class="packt_screen">Adobe Mixamo</span></span> system, so you'll need to sign up for an account with them if you don't have one already.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To import third-party <strong>3D models</strong> and animations from <span class="ScreenTextPACKT"><span class="packt_screen">Mixamo</span></span>, follow these steps:</p>
<ol>
<li>Open a w<span class="ScreenTextPACKT">eb browser</span> and visit <span class="URLPACKT"><a href="http://Mixamo.com">Mixamo.com</a>.</span></li>
<li>Sign up/log in with your <span class="ScreenTextPACKT"><span class="packt_screen">Mixamo/Adobe</span></span> account.</li>
<li>Select the <span class="ScreenTextPACKT"><span class="packt_screen">Characters</span></span> section (from navigation bar at top-left of web page)</li>
<li>Select your character, such as <span class="ScreenTextPACKT"><span class="packt_screen">Lola B Styperek</span></span>. You'll see this character appear in the right-hand preview panel.</li>
<li>Download your character, choosing <span class="ScreenTextPACKT"><span class="packt_screen">FBX For Unity (.fbx)</span></span> and <span class="packt_screen"><span class="ScreenTextPACKT">T-pose</span></span><span class="ScreenTextPACKT">:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/397a60b1-597c-4d9b-af3f-d5f1e83f9158.png"/></p>
<ol start="6">
<li>Create a new 3D Unity project, and in the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel create a folder named <kbd><span class="ScreenTextPACKT">Models</span></kbd>.</li>
<li>Import the downloaded FBX file into the <kbd><span class="ScreenTextPACKT">Models</span></kbd> folder.</li>
<li>Select the asset file in the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel, and in the <strong><span class="KeyWordPACKT">Inspector</span></strong> select the <span class="ScreenTextPACKT"><span class="packt_screen">Materials</span></span> section.</li>
<li>Click the <span class="ScreenTextPACKT"><span class="packt_screen">Extract Textures...</span></span> button and extract the model's <span class="ScreenTextPACKT"><span class="packt_screen">Textures</span></span> into your <kbd>Models</kbd> folder. If asked to fix an issue with a <span class="ScreenTextPACKT"><span class="packt_screen">Material</span> using a <span class="packt_screen">Texture</span> as a <span class="packt_screen">Normal Map</span></span>, choose <span class="ScreenTextPACKT"><span class="packt_screen">Fix Now</span>:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/77520cdc-deb0-4abd-8235-2fd285ef3ccd.png"/></p>
<ol start="10">
<li>Drag the clone of the character from the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel into the <span class="KeyWordPACKT"><strong>Scene</strong></span><span class="KeyWordPACKT">:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/68886c91-6df0-4d83-a425-af2e3c470839.png"/></p>
<ol start="11">
<li>We need an <span class="ScreenTextPACKT"><span class="packt_screen">Animator Controller</span></span> to manage animations. Create a new <strong><span class="ScreenTextPACKT">Animator</span></strong> <span class="ScreenTextPACKT"><span class="packt_screen">Controller</span></span> file in the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel named <span class="ScreenTextPACKT"><span class="packt_screen">Lola-Animator-Controller</span></span>.</li>
<li>Select <span class="ScreenTextPACKT"><span class="packt_screen">Lola B Styperek</span></span> in the <span class="KeyWordPACKT"><span class="packt_screen">Hierarchy</span></span>. In the <strong>Inspector</strong>, you'll see a <span class="ScreenTextPACKT"><span class="packt_screen">Controller</span></span> slot for the <strong><span class="ScreenTextPACKT">Animator</span></strong> component. Drag the <span class="ScreenTextPACKT"><span class="packt_screen">Lola-Animator-Controller</span></span> file from the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel into the <span class="ScreenTextPACKT"><span class="packt_screen">Animator | Controller</span></span> slot.</li>
<li>Now, let's animate this model. Go back to the <a href="http://Mixamo.com"><span class="URLPACKT">Mixamo.com</span></a> webpage and select an animation, such as <span class="ScreenTextPACKT"><span class="packt_screen">Golf Drive</span></span>. Click the <span class="ScreenTextPACKT"><span class="packt_screen">Download</span></span> button and choose these options:
<ul>
<li><span class="ScreenTextPACKT"><span class="packt_screen">Format: FBX for Unity (.fbx)</span></span></li>
<li><span class="ScreenTextPACKT"><span class="packt_screen">Frames per second: 3</span>0</span></li>
<li><span class="ScreenTextPACKT"><span class="packt_screen">Skin: Without skin</span></span></li>
<li><span class="ScreenTextPACKT"><span class="packt_screen">Keyframe reduction: none</span></span></li>
</ul>
</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/3aa7162c-1935-448b-9c91-9cca66f9a239.png" style="width:32.58em;height:13.17em;"/></p>
<ol start="14">
<li>Import the <span class="ScreenTextPACKT"><span class="packt_screen">Animation Clip</span></span> FBX file (<span class="ScreenTextPACKT"><span class="packt_screen">lola_b_styperek@Golf Drive.fbx</span> in this case</span>) into the <span class="ScreenTextPACKT"><span class="packt_screen">Animation</span></span> folder of your Unity project.</li>
<li>Double-click the <span class="ScreenTextPACKT"><span class="packt_screen">Lola-Animator-Controller</span> file</span> to open the <span class="ScreenTextPACKT"><span class="packt_screen">Animator</span></span> (state machine) editor panel.</li>
<li>Drag the <span class="ScreenTextPACKT"><span class="packt_screen">Golf Drive Animation Clip</span></span> into the <strong><span class="KeyWordPACKT">Animator</span></strong> panel; it should appear as an orange state, with a <span class="packt_screen"><span class="ScreenTextPACKT">Transition</span></span> from <span class="packt_screen"><span class="ScreenTextPACKT">Entry</span></span> to it (that is, this one state becomes the default state):</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/1b2d65df-90ed-454c-a685-aedddadfbdaf.png"/></p>
<ol start="17">
<li>Run the <strong><span class="KeyWordPACKT">Sce</span><span class="KeyWordPACKT">ne</span></strong>. You should now see <span class="ScreenTextPACKT"><span class="packt_screen">Lola</span></span> practicing her golf swing. If you have the character selected in the <span class="KeyWordPACKT"><span class="packt_screen">Hierarchy</span></span> and can view the <strong><span class="KeyWordPACKT">Animator</span></strong> panel, you'll see that the <span class="ScreenTextPACKT"><span class="packt_screen">Golf Swing Animation Clip (State)</span></span> is playing:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/6727d629-0207-4e43-874e-80cba29a5418.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Mixamo exports 3D rigged character models and <strong><span class="KeyWordPACKT">Animation Clips</span></strong> in FBX format. The <strong><span class="KeyWordPACKT">Materials</span></strong> for models are embedded in the FBX file, so we had to extract them once the model was imported into Unity.</p>
<p>Unity controls the animation of models with an <span class="ScreenTextPACKT"><span class="packt_screen">Animator Controller</span></span>, so we had to create one for our character model and then drag in the <span class="ScreenTextPACKT"><span class="packt_screen">Animation Clip</span></span> we wished to use to animate our model.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Here are some ways to go further with this recipe.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Looping the animation</h1>
                </header>
            
            <article>
                
<p>Select the <span class="ScreenTextPACKT"><span class="packt_screen">Animation Clip</span></span> in the <span class="KeyWordPACKT"><span class="packt_screen">Project</span></span> panel, and in the <strong><span class="KeyWordPACKT">Inspector</span></strong> check its <span class="ScreenTextPACKT"><span class="packt_screen">Loop Time</span></span> option, then click the <span class="ScreenTextPACKT"><span class="packt_screen">Apply</span></span><span> </span><span>button to make the </span><span>change to this asset file. When you run the</span> <span class="KeyWordPACKT"><strong>Scene</strong>,</span> <span class="ScreenTextPACKT"><span class="packt_screen">Lola</span></span> <span>will now repeat the animation</span> indefinitely<span>.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Scripting events to control when Animation Clips are played</h1>
                </header>
            
            <article>
                
<p>Additional <span class="ScreenTextPACKT"><span class="packt_screen">Animation Clips</span></span> can be added to the <span class="ScreenTextPACKT"><span class="packt_screen">State Chart</span></span> in the character's <span class="ScreenTextPACKT"><span class="packt_screen">Animator Controller</span></span>. You can then define variables and <span class="ScreenTextPACKT"><span class="packt_screen">Triggers</span></span>, to define when <span class="packt_screen"><span class="ScreenTextPACKT">Animations</span> <span class="ScreenTextPACKT">Transition</span></span> from one clip to another. Many of the recipes in this chapter illustrate ways to allow scripts to influence the <span class="ScreenTextPACKT"><span class="packt_screen">Transition</span></span> from one <span class="ScreenTextPACKT"><span class="packt_screen">Animation Clip</span> <span class="packt_screen">(State)</span></span> to another.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Information sources about importing models and animations into Unity</h1>
                </header>
            
            <article>
                
<p>Learn more about model and animation importing from the following:</p>
<ul>
<li class="SourceCode">Unity docs on importing <strong>3D Models</strong>: <a href="https://docs.unity3d.com/Manual/HOWTO-importObject.html"><span class="URLPACKT"><span>https://docs.unity3d.com/Manual/HOWTO-importObject.html</span></span></a></li>
<li class="SourceCode">Unity docs about the <strong>Model Import Settings</strong> window: <a href="https://docs.unity3d.com/Manual/class-FBXImporter.html"><span class="URLPACKT"><span>https://docs.unity3d.com/Manual/class-FBXImporter.html</span></span></a></li>
<li class="SourceCode">Unity docs about the <strong>Model</strong> tab: <a href="https://docs.unity3d.com/Manual/FBXImporter-Model.html"><span class="URLPACKT"><span>https://docs.unity3d.com/Manual/FBXImporter-Model.html</span></span></a></li>
<li class="SourceCode">Unity docs about <strong>Model</strong> file formats: <a href="https://docs.unity3d.com/Manual/3D-formats.html"><span class="URLPACKT"><span>https://docs.unity3d.com/Manual/3D-formats.html</span></span></a></li>
<li class="SourceCode">Samples of <strong>Mixamo</strong> free assets in the <strong>Asset Store</strong>:
<ul>
<li class="SourceCode"><a href="https://assetstore.unity.com/packages/3d/animations/melee-axe-pack-35320"><span class="URLPACKT"><span>https://assetstore.unity.com/packages/3d/animations/melee-axe-pack-35320</span></span></a></li>
<li class="SourceCode"><a href="https://assetstore.unity.com/packages/3d/animations/magic-pack-36269"><span class="URLPACKT"><span>https://assetstore.unity.com/packages/3d/animations/magic-pack-36269</span></span></a></li>
</ul>
</li>
</ul>


            </article>

            
        </section>
    </body></html>