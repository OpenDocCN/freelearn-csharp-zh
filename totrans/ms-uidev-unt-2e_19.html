<html><head></head><body>
<div><div><h1 class="chapter-number" id="_idParaDest-252"><a id="_idTextAnchor435" class="pcalibre pcalibre1 calibre6"/>15</h1>
<h1 id="_idParaDest-253" class="calibre5"><a id="_idTextAnchor436" class="pcalibre pcalibre1 calibre6"/>Particles in the UI</h1>
<p class="calibre3">Particle effects are a fun and attractive way to add “juice” to your game. The Particle system within the Unity Engine provides you with the tools needed to make all sorts of interesting effects like sparkles, smoke, fire, and so on. This chapter will discuss how you can use particle effects within your UI.</p>
<p class="calibre3">In this chapter, we will discuss the following topics:</p>
<ul class="calibre16">
<li class="calibre14">Methods for displaying particle effects in your UI</li>
<li class="calibre14">Adding flying stars to our loot box animation</li>
</ul>
<p class="calibre3"><a id="_idTextAnchor437" class="pcalibre pcalibre1 calibre6"/>This book is about UI, not particle effects. Due to the complex nature of particle effects, I will not be covering all the settings involved and the various intricacies of using particle effects. I will walk you through the steps to create a single particle effect but will not dive further into the process of creating particle effects.</p>
<h1 id="_idParaDest-254" class="calibre5"><a id="_idTextAnchor438" class="pcalibre pcalibre1 calibre6"/>Technical requirements</h1>
<p class="calibre3">You can find the relevant codes and asset files of this chapter here: <a href="https://github.com/PacktPublishing/Mastering-UI-Development-with-Unity-2nd-Edition/tree/main/Chapter%2015" class="pcalibre pcalibre1 calibre6">https://github.com/PacktPublishing/Mastering-UI-Development-with-Unity-2nd-Edition/tree/main/Chapter%2015</a></p>
<h1 id="_idParaDest-255" class="calibre5"><a id="_idTextAnchor439" class="pcalibre pcalibre1 calibre6"/>Particles in the UI</h1>
<p class="calibre3">Using particles in UI is a<a id="_idIndexMarker944" class="pcalibre pcalibre1 calibre6"/> hot topic. It seems like nearly every mobile game with loot boxes uses particles, but there is no standardized way to implement them. The problem with trying to use particles in the UI is that particles render behind UI on Canvases that have their <strong class="bold">Render Mode</strong> set to <strong class="bold">Screen Space - </strong><strong class="bold">Overlay</strong>.</p>
<div><div><img alt="Figure 15.1: Particles rendering behind a Canvas" src="img/Figure_15.1_B18327.jpg" class="calibre532"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.1: Particles rendering behind a Canvas</p>
<p class="calibre3">The preceding screenshot shows two UI Canvases from our working examples and a particle system (the white dots). The pink background is on the <code>Background Canvas</code>, which renders with <code>HUD Canvas</code>, which renders with <code>HUD Canvas</code>. However, I want the<a id="_idIndexMarker945" class="pcalibre pcalibre1 calibre6"/> particles to be displayed also in front of the <code>HUD Canvas</code>.</p>
<p class="calibre3">There are a few solutions to this problem. My two preferred solutions are either of the following:</p>
<ul class="calibre16">
<li class="calibre14">Change the <code>HUD Canvas</code> to <strong class="bold">Screen Space - Camera</strong> and adjust the sorting order of it and the particles to make the particles appear in front</li>
<li class="calibre14">Use a second Camera and a Render Texture to display the particles on a Raw Image in the Canvas</li>
</ul>
<p class="calibre3">There are benefits and downfalls to both methods. The first method is by far the easiest. It allows you to view particles in front of your UI with only one or two modifications to your scene. However, using <strong class="bold">Screen Space - Camera</strong> for your UI’s <strong class="bold">Render Mode</strong> may not be practical for your project. If you edit the properties of the Camera in your game, the properties of the UI will be changed. Additionally, changing the <strong class="bold">Render Mode</strong> of your Canvas after you have already set everything up can cause your UI to stop displaying the way you initially intended.</p>
<p class="calibre3">The second method isn’t terribly complicated to implement but does require more work than the first. Its main benefit is that you can render particles in front of UI on Canvases that render with <strong class="bold">Screen Space - Overlay</strong>. Its main downfall, other than needing more work to set up, is that you may have to make some complicated decisions about what your two cameras are going to render, and may slightly affect performance. An example covering this method is discussed in the <em class="italic">Examples</em> section of this chapter.</p>
<p class="calibre3">There are other solutions to this problem, each more complicated (or costly) than the next, and what you choose to do depends on your project. Some projects forego particles entirely and pre-render their particles as sprite sheets using software, such as After Effects. Some projects use assets available in the Asset Store, and others handle everything entirely with<a id="_idIndexMarker946" class="pcalibre pcalibre1 calibre6"/> scripts and shaders. Although I can’t foresee any reason why the second solution I proposed will not work for your project, it’s certainly possible that your project has a fringe case I am not considering. Hopefully, if that is the case, you will be able to modify my solution with minimal effort to work on your project.</p>
<p class="calibre3">My best advice to you would be to decide early whether you will use particles in your UI. If you know you are going to use them, plan ahead with your UI layouts and camera setups. Also, if you want to use the first method, do it.</p>
<p class="calibre3">It’s really too bad that there is no standard method for this implemented by Unity. I assume that one day there will be a pre-built UI Particle object that will make the process both simple and performant.<a id="_idTextAnchor440" class="pcalibre pcalibre1 calibre6"/></p>
<h1 id="_idParaDest-256" class="calibre5"><a id="_idTextAnchor441" class="pcalibre pcalibre1 calibre6"/>Examples</h1>
<p class="calibre3">For the examples in this chapter, we will add to the animations created in <a href="B18327_14.xhtml#_idTextAnchor409" class="pcalibre pcalibre1 calibre6"><em class="italic">Chapter 14</em></a> to add a particle effect that occurs when the loot box opens<a id="_idTextAnchor442" class="pcalibre pcalibre1 calibre6"/><a id="_idTextAnchor443" class="pcalibre pcalibre1 calibre6"/>.</p>
<h2 id="_idParaDest-257" class="calibre7"><a id="_idTextAnchor444" class="pcalibre pcalibre1 calibre6"/>Creating a Particle System that displays in the UI</h2>
<p class="calibre3">Let’s create a particle system that <a id="_idIndexMarker947" class="pcalibre pcalibre1 calibre6"/>will pop when the chest opens up. As stated earlier in this chapter, my two preferred ways of displaying particles in front of UI are to either use <strong class="bold">Screen Space - Camera</strong> as the Canvas <strong class="bold">Render Mode</strong> or to use a Render Texture. Since the second option is more complicated, it merits an example. You’ll notice that our Canvases all have their <strong class="bold">Render Modes</strong> set to <strong class="bold">Screen Space - Overlay,</strong> so using a <strong class="bold">Render Texture</strong> is the best method for the way the project is currently set up.</p>
<p class="calibre3">We will create a particle system that is rendered to a texture via a second camera and then have that texture displayed on a <strong class="bold">Raw Image</strong> within the UI.</p>
<p class="calibre3">To create a particle system, complete <a id="_idIndexMarker948" class="pcalibre pcalibre1 calibre6"/>the following steps. We will work on displaying it in the UI in the next section:</p>
<ol class="calibre13">
<li class="calibre14">The first thing we will need to do is create a material that will be used for the particle. Create a new folder in the <code>Assets</code> folder named <code>Textures </code><code>and Materials</code>.</li>
<li class="calibre14">Right-click within the new folder and select <code>StarsMaterial</code>.</li>
<li class="calibre14">Set the <code>StarsMaterial</code> <strong class="bold">Shader</strong> to <strong class="bold">Unlit/Transparent</strong>.</li>
<li class="calibre14">Drag the <code>starIcon</code> sprite into its texture slot.</li>
<li class="calibre14">To display the particles in front of the UI objects, we will need a second Camera. Duplicate the <code>Main Camera</code> using <em class="italic">Ctrl</em> + <em class="italic">D</em> and rename the duplicate <code>UI </code><code>Particles Camera</code>.</li>
<li class="calibre14">You can only have one Audio Listener in the scene, so delete the <strong class="bold">Audio Listener</strong> component on the new camera.</li>
<li class="calibre14">Remove the <strong class="bold">Animator</strong> and <strong class="bold">Chest Anim </strong><strong class="bold">Controls</strong> components.</li>
<li class="calibre14">You also won’t want any code later to think this might possibly be the <code>Main Camera</code>, so change the tag from <code>MainCamera</code> to <code>Untagged</code>.</li>
<li class="calibre14">This camera will be used only to display the particle pop we’re going to make, so we might as well make the particle system a child of this camera by right-clicking on the <code>UI Particles Camera</code> and selecting <strong class="bold">Effects</strong> | <strong class="bold">Particle System</strong>.</li>
</ol>
<div><div><img alt="Figure 15.2: Creating a Particle System as a child of UI Particles Camera" src="img/Figure_15.2_B18327.jpg" class="calibre533"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.2: Creating a Particle System as a child of UI Particles Camera</p>
<p class="callout-heading">Note</p>
<p class="callout">Since this book isn’t about Particle Systems but about UI, we will not spend time going over every property of Particle Systems. Luckily, most are somewhat self-explanatory, and fiddling with the various properties lets you see what they can do. Therefore, rather than going through each property of the Particle System, I will simply provide screenshots of the necessary properties.</p>
<ol class="calibre13">
<li value="10" class="calibre14">Scroll down to the bottom<a id="_idIndexMarker949" class="pcalibre pcalibre1 calibre6"/> of the <strong class="bold">Particle System</strong> component and expand the <strong class="bold">Renderer</strong> property by clicking on it.</li>
<li class="calibre14">Assign the <code>StarsMaterial</code> material to the <strong class="bold">Material</strong> property. This will now make stars appear in your particle effect.</li>
</ol>
<div><div><img alt="Figure 15.3: Adding StarsMaterial material to the Renderer Material property" src="img/Figure_15.3_B18327.jpg" class="calibre534"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.3: Adding StarsMaterial material to the Renderer Material property</p>
<ol class="calibre13">
<li value="12" class="calibre14">Change the<a id="_idIndexMarker950" class="pcalibre pcalibre1 calibre6"/> Transform <code>-90</code>. The particles should now shoot upward.</li>
</ol>
<div><div><img alt="Figure 15.4: Changing the Transform Rotation" src="img/Figure_15.4_B18327.jpg" class="calibre535"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.4: Changing the Transform Rotation</p>
<ol class="calibre13">
<li value="13" class="calibre14">Change the <code>10</code>.</li>
<li class="calibre14">Change the <strong class="bold">Duration</strong>, <strong class="bold">Start Lifetime</strong>, and <strong class="bold">Start Speed</strong> properties of the Particle System as <a id="_idIndexMarker951" class="pcalibre pcalibre1 calibre6"/>follows:</li>
</ol>
<div><div><img alt="Figure 15.5: Updating some of the Particle System settings" src="img/Figure_15.5_B18327.jpg" class="calibre536"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.5: Updating some of the Particle System settings</p>
<ol class="calibre13">
<li value="15" class="calibre14">Select the dropdown on <code>0</code> and <code>0.5</code>.</li>
<li class="calibre14">Select the dropdown on <code>-45</code> and <code>45</code>.</li>
</ol>
<div><div><img alt="Figure 15.6: Updating Start Size and Start Rotation" src="img/Figure_15.6_B18327.jpg" class="calibre537"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.6: Updating Start Size and Start Rotation</p>
<ol class="calibre13">
<li value="17" class="calibre14">Change <code>1</code> and <code>0.5</code>.</li>
</ol>
<div><div><img alt="Figure 15.7: Updating the settings of the particle system" src="img/Figure_15.7_B18327.jpg" class="calibre538"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.7: Updating the settings of the particle system</p>
<ol class="calibre13">
<li value="18" class="calibre14">Expand the <strong class="bold">Emission</strong> property and add a <strong class="bold">Burst</strong> with the plus sign.</li>
</ol>
<div><div><img alt="Figure 15.8: Adding a burst" src="img/Figure_15.8_B18327.jpg" class="calibre539"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.8: Adding a burst</p>
<ol class="calibre13">
<li value="19" class="calibre14">Expand the <strong class="bold">Shape</strong> property <a id="_idIndexMarker952" class="pcalibre pcalibre1 calibre6"/>and select the <strong class="bold">Hemisphere</strong> from the <strong class="bold">Shape</strong> dropdown.</li>
</ol>
<div><div><img alt="Figure 15.9: Changing the shape" src="img/Figure_15.9_B18327.jpg" class="calibre540"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.9: Changing the shape</p>
<ol class="calibre13">
<li value="20" class="calibre14">Select the <strong class="bold">Size over </strong><strong class="bold">Lifetime</strong> property.</li>
</ol>
<div><div><img alt="Figure 15.10: The Size over Lifetime property" src="img/Figure_15.10_B18327.jpg" class="calibre541"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.10: The Size over Lifetime property</p>
<ol class="calibre13">
<li value="21" class="calibre14">Select the <strong class="bold">Rotation by </strong><strong class="bold">Speed</strong> property.
<div><div><img alt="Figure 15.11: The Rotation by Speed property" src="img/Figure_15.11_B18327.jpg" class="calibre542"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.11: The Rotation by Speed property</p>
<p class="calibre3">And now, we’re done with the properties of the Particle System. Eventually, we will select <strong class="bold">Looping</strong> and <strong class="bold">Play on Awake</strong>, but for now, we will leave them deselected so that we<a id="_idIndexMarker953" class="pcalibre pcalibre1 calibre6"/> can see the particle system constantly playing when the game is playing.</p>
</li>
</ol> <ol class="calibre13">
<li value="22" class="calibre14">We want to make sure that <code>UI Particles Camera</code> displays only <code>Particle System</code> and <code>Main Camera</code> displays everything but <code>Particle System</code>. We will accomplish this with <strong class="bold">Layers</strong>.<p class="calibre3">Select the <strong class="bold">Layers</strong> dropdown menu and select <strong class="bold">Add Layer…</strong>.</p></li>
<li class="calibre14">Add a new <code>UI Particles</code>.</li>
<li class="calibre14">Assign <code>UI Particles</code> to the <code>Particle System</code>.</li>
<li class="calibre14">Now, we need to specify to each of the cameras what they will be displaying using their <code>UI Particles Camera</code> to only display <code>Main Camera</code> to exclude <strong class="bold">UI Particles</strong>.</p></li>
<li class="calibre14">Now, let’s have <code>UI Particles Camera</code> render to a texture. Within the <code>Textures and Materials</code> folder, right-click and select <code>StarPopRenderTexture</code>.</li>
<li class="calibre14">Change its <code>512 </code><code>x 512</code>.</li>
<li class="calibre14">Assign the <code>StarPopRenderTexture</code> texture to the <code>UI Particles Camera</code>’s <strong class="bold">Camera</strong> component.</li>
</ol>
<div><div><img alt="Figure 15.12: Assigning the Target Texture" src="img/Figure_15.12_B18327.jpg" class="calibre543"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.12: Assigning the Target Texture</p>
<ol class="calibre13">
<li value="29" class="calibre14">The only thing left to<a id="_idIndexMarker954" class="pcalibre pcalibre1 calibre6"/> do is have the render texture display in the UI.<p class="calibre3">Create a new UI Canvas with <code>Particle Canvas</code>.</p></li>
<li class="calibre14">With <code>Particle Canvas</code> selected, select <code>Particle Renderer</code>.</li>
<li class="calibre14">Change the <code>Particle Renderer</code> to <code>512</code> and <code>512</code>, respectively, to match the properties of <code>StarPopRenderTexture</code>.</li>
<li class="calibre14">Assign <code>StarPopRenderTexture</code> to the <code>Particle Renderer</code>.</li>
</ol>
<div><div><img alt="Figure 15.13: The Render Texture assigned to the Texture property" src="img/Figure_15.13_B18327.jpg" class="calibre544"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.13: The Render Texture assigned to the Texture property</p>
<ol class="calibre13">
<li value="33" class="calibre14">We don’t want this image to block our mouse clicks, so deselect <strong class="bold">Raycast Target</strong> from the <strong class="bold">Raw </strong><strong class="bold">Image</strong> component.</li>
<li class="calibre14">Now, we just need to make sure that <code>Particle Canvas</code> displays in front of the other two Canvases. Set the <code>2</code> on <code>Particle Canvas</code>’s <strong class="bold">Canvas</strong> component.</li>
<li class="calibre14">Play the game now, and <a id="_idIndexMarker956" class="pcalibre pcalibre1 calibre6"/>you should now see the particles displaying the scene.</li>
<li class="calibre14">We set the Particle System to be constantly playing, so deselect <strong class="bold">Looping</strong> and <strong class="bold">Play on Awake</strong> to reset the values to what they should be.</li>
</ol>
<p class="calibre3">That’s it for setting up a particle system that displays in a UI.</p>
<h3 class="calibre9">Timing the Particle System to play in our loot box animation</h3>
<p class="calibre3">Now that the particle system is set to display in front of the UI, we can set up the logic to have the animation trigger in the correct order. To do that, go through the following steps:</p>
<ol class="calibre13">
<li class="calibre14">We want the particle system to <a id="_idIndexMarker957" class="pcalibre pcalibre1 calibre6"/>play when the chest opens, so we have to write some code to control its behavior. Create a new script called <code>PlayParticles</code> in the <code>Assets/Scripts</code> folder.</li>
<li class="calibre14">Edit the <code>PlayParticles</code> class to have the following code:<pre class="source-code">
public ParticleSystem stars;
void PlayTheParticles() {
    if (!stars.isPlaying) {
        stars.Play();
    }
}</pre></li> <li class="calibre14">All this code does is check whether the particle system is currently playing with the <code>PlayTheParticles()</code> function. If it is not playing, it plays when the function runs.</li>
<li class="calibre14">We’ll have this function triggered via an Animation Event on the <code>Chest</code>. So, add the script to the <code>Chest</code> as a component.</li>
<li class="calibre14">Assign <code>Particle System</code> from the <strong class="bold">Hierarchy</strong> to the <strong class="bold">Stars</strong> slot.</li>
<li class="calibre14">Add the <code>PlayTheParticles</code> function as an Animation Event on the very first frame of the <code>ChestOpening</code> animation.</li>
</ol>
<div><div><img alt="Figure 15.14: The particle Animation Event" src="img/Figure_15.14_B18327.jpg" class="calibre545"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.14: The particle Animation Event</p>
<p class="calibre3">Playing the game now should result in all animations playing at the appropriate times and the particle system <a id="_idIndexMarker958" class="pcalibre pcalibre1 calibre6"/>displaying when the chest opens. And that concludes the loot box animation tutorial!<a id="_idTextAnchor445" class="pcalibre pcalibre1 calibre6"/></p>
<h1 id="_idParaDest-258" class="calibre5"><a id="_idTextAnchor446" class="pcalibre pcalibre1 calibre6"/>Summary</h1>
<p class="calibre3">At first glance, it would appear that you cannot use Unity particles within Unity UI that is set to Screen Space - Overlay. However, there are a few simple tricks that let you implement particle effects in the UI and have the particles render in front of them.</p>
<p class="calibre3">In the next chapter, we will discuss how to use the World Space Canvas Render Mode to have UI elements appear directly in your Unity scene rather than on the screen.</p>
</div>
</div></body></html>