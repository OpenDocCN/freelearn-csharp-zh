<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Enhancing your UI</h1></div></div></div><p>In this chapter, we will learn how to enhance our UI experience by using more advanced features, which are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Draggable panels and animations</li><li class="listitem" style="list-style-type: disc">The drag-and-drop system</li><li class="listitem" style="list-style-type: disc">Automatic content alignment</li><li class="listitem" style="list-style-type: disc">Clipping</li><li class="listitem" style="list-style-type: disc">Scrollable text</li><li class="listitem" style="list-style-type: disc">The localization system</li></ul></div><p>Let's start by talking about NGUI components and their overall behavior.</p><div><div><div><div><h1 class="title"><a id="ch03lvl1sec22"/>NGUI components</h1></div></div></div><p>In <a class="link" href="ch02.html" title="Chapter 2. Creating Widgets">Chapter 2</a>, <em>Creating Widgets</em>, we added the <strong>UIStretch</strong> and <strong>UIAnchor</strong> components to our widgets, and also the <strong>Load Level On Click</strong> component. There are many more components, and the purpose of this chapter is to discuss these components. We will use the most important ones in this chapter. It is possible to add a component to any kind of widget—considering it is logical of course.</p><p>This component-oriented structure makes NGUI extremely flexible and modular. We will start by making our main menu a draggable window.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec23"/>The draggable panel</h1></div></div></div><p>We <a id="id121" class="indexterm"/>will <a id="id122" class="indexterm"/>now learn how to turn our menu into a draggable window. Let's add the correct component to it and study its parameters, which are as follows:</p><div><ol class="orderedlist arabic"><li class="listitem">Select the <strong>Panel</strong> GameObject.</li><li class="listitem">Rename it as <code class="literal">MainMenu</code>.</li><li class="listitem">Attach the <strong>Draggable Panel</strong> component to it by navigating to <strong>Component</strong> | <strong>NGUI</strong> | <strong>Interaction</strong>.</li></ol></div><p>The <strong>MainMenu</strong> GameObject now has a <strong>UIDraggable Panel</strong> component<a id="id123" class="indexterm"/> attached to it.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec39"/>Parameters</h2></div></div></div><p>The following <a id="id124" class="indexterm"/>are the 13 parameters for setting values in the <strong>UIDraggable Panel</strong>:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Drag Effect</strong>: This is the effect used while dragging the panel to have a smoother drag.</li><li class="listitem" style="list-style-type: disc"><strong>Restrict Within Panel</strong>: This uses the parent panel to restrain the draggable panel within its clipping bounds.</li><li class="listitem" style="list-style-type: disc"><strong>Disable Drag If Fits</strong>: If the content fits the parent panel's clipping bounds, dragging will be disabled.</li><li class="listitem" style="list-style-type: disc"><strong>Smooth Drag Start</strong>: This avoids a "jump" effect on drag start.</li><li class="listitem" style="list-style-type: disc"><strong>Reposition Clipping</strong>: This repositions the <strong>Clipping</strong> to the <strong>Top Left Corner</strong> immediately.</li><li class="listitem" style="list-style-type: disc"><strong>IOS Drag Emulation</strong>: Dragging movement speed is reduced when overpassing the clipping edges.</li><li class="listitem" style="list-style-type: disc"><strong>Scroll Wheel Factor</strong>: If you want the scroll wheel to drag the panel on the y axis, set this value to greater than 0.</li><li class="listitem" style="list-style-type: disc"><strong>Momentum Amount</strong>: This is the effect applied when the panel is dropped. The panel will keep moving after releasing the scroll wheel.</li><li class="listitem" style="list-style-type: disc"><strong>Horizontal Scroll Bar</strong>: This lets you drag a scroll bar to define it as the panel's horizontal scroll bar.</li><li class="listitem" style="list-style-type: disc"><strong>Vertical Scroll Bar</strong>: This lets you drag another scroll bar to define it as the panel's vertical scroll bar.</li><li class="listitem" style="list-style-type: disc"><strong>Show Scroll Bars</strong>: This allows you to show scroll bars always, show them only if necessary, or show them while dragging.</li><li class="listitem" style="list-style-type: disc"><strong>Scale</strong>: This defines which axis the panel should drag on: <code class="literal">0</code> means no dragging, <code class="literal">1</code> allows full dragging on this axis.</li><li class="listitem" style="list-style-type: disc"><strong>Relative Position On Reset</strong>: This is the offset relative to the mouse's position. It is useful if you want an offset from the mouse's position while dragging.</li></ul></div><p>Now that we have seen the component's parameters, let's use them to drag our main menu.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec40"/>Dragging the MainMenu</h2></div></div></div><p>We have <a id="id125" class="indexterm"/>added the <strong>UIDraggable Panel</strong> component that sets this <strong>UIPanel</strong> as a <strong>Draggable Panel</strong>. Now, we must mark our <strong>MainMenu</strong> as the GameObject that holds the draggable content.</p><p>We will also add a <strong>Box Collider</strong> component to define where the user must click to drag the panel:</p><div><ol class="orderedlist arabic"><li class="listitem">Select our <strong>MainMenu</strong> GameObject and perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Set the <strong>Clipping</strong> parameter of <strong>UIPanel</strong> to <strong>Alpha Clip</strong>.</li><li class="listitem">Set the <strong>Size</strong> field in <strong>Clipping</strong> to <code class="literal">1920</code> x <code class="literal">1080</code>.</li><li class="listitem">Uncheck the <strong>IOS Drag Emulation</strong> Boolean.</li></ol></div></li><li class="listitem">Add the <strong>Drag Panel Contents</strong> component to it.</li><li class="listitem">Add the <strong>Box Collider</strong> component to it and perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Check the <strong>Is Trigger</strong> Boolean—we don't need collisions, just a trigger to receive Raycasts from the <strong>UICamera</strong>.</li><li class="listitem">Set its <strong>Center</strong> coordinates to {<code class="literal">0</code>, <code class="literal">395</code>, <code class="literal">0</code>}.</li><li class="listitem">Set its <strong>Size</strong> coordinates to {<code class="literal">1300</code>, <code class="literal">62</code>, <code class="literal">1</code>}.</li></ol></div></li></ol></div><p>Click on the play button. By clicking on the window's title, you can drag the main menu. But still, it isn't configured correctly; you can only move it on the x axis.</p><p>Let's change an important parameter of the <strong>UIDraggable Panel</strong> component of <strong>MainMenu</strong> to allow dragging on the x axis by performing the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Select our <strong>MainMenu</strong> GameObject.</li><li class="listitem">Set <strong>Scale</strong> in <strong>UIDraggable Panel</strong> to {<code class="literal">1</code>, <code class="literal">1</code>, <code class="literal">0</code>}.</li></ol></div><p>And that's it! Our <strong>MainMenu</strong> is now draggable on both the axes. If you drag it outside the screen, it will move back inside when dropped. We had to define a clipping of the screen's size for this <strong>Restrict Within Panel</strong> function to work.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec24"/>The drag-and-drop system</h1></div></div></div><p>We <a id="id126" class="indexterm"/>will now create our own <strong>drag-and-drop</strong> system that<a id="id127" class="indexterm"/> will enable the user to select a power. They will be able to drag one of the two available powers inside a selection box as shown in the following screenshot:</p><div><img src="img/8667OT_03_01.jpg" alt="The drag-and-drop system"/></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec41"/>Powers selection</h2></div></div></div><p>Let's <a id="id128" class="indexterm"/>create a drag-and-drop system to select which of the two powers the player can choose: a <strong>Bomb</strong> power, which will explode or a <strong>Time</strong> power, which will slow down time for a few seconds.</p><div><div><div><div><h3 class="title"><a id="ch03lvl3sec10"/>Draggable items container</h3></div></div></div><p>Let's start <a id="id129" class="indexterm"/>by creating a nice box for our powers and a draggable items container by performing the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Select our <strong>MainMenu</strong> GameObject and perform the given steps:<div><ol class="orderedlist arabic"><li class="listitem">Create a new empty child GameObject by pressing <em>Alt</em> + <em>Shift</em> + <em>N</em>.</li><li class="listitem">Rename it as <code class="literal">Powers</code>.</li></ol></div></li><li class="listitem">Select the <strong>Background</strong> and <strong>Label</strong> GameObjects from <strong>Sound</strong>:<div><ol class="orderedlist arabic"><li class="listitem">Duplicate them.</li><li class="listitem">Drag these new duplicates inside our <strong>Powers</strong> GameObject.</li></ol></div></li><li class="listitem">Select the <strong>Background</strong> GameObject in <strong>Powers</strong> and perform these steps:<div><ol class="orderedlist arabic"><li class="listitem">Set its <strong>Dimensions</strong> to <code class="literal">320</code> x <code class="literal">420</code>.</li><li class="listitem">Set the <strong>Pixel Offset</strong> in <strong>UIAnchor</strong> to {<code class="literal">0</code>, <code class="literal">-100</code>}.</li></ol></div></li><li class="listitem">Select the <strong>Label</strong> GameObject in <strong>Powers</strong>:<div><ol class="orderedlist arabic"><li class="listitem">Rename it as <code class="literal">TitleLabel</code>.</li><li class="listitem">Change its text to <code class="literal">[AAFFFF]Powers</code>.</li></ol></div></li><li class="listitem">Select<a id="id130" class="indexterm"/> the <strong>Label</strong> GameObject, which is a child of <strong>Title</strong>, and perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Duplicate it.</li><li class="listitem">Rename this new duplicate as <code class="literal">SelectedLabel</code>.</li><li class="listitem">Drag it inside our <strong>Powers</strong> GameObject.</li><li class="listitem">Drag our <strong>Background</strong> GameObject in <strong>Powers</strong> to the <strong>Container</strong> field in its <strong>UIAnchor</strong>.</li><li class="listitem">Set its <strong>Side</strong> parameter in <strong>UIAnchor</strong> to <strong>Top</strong>.</li><li class="listitem">Set its <strong>Pixel Offset</strong> in <strong>UIAnchor</strong> to {<code class="literal">0</code>, <code class="literal">-95</code>}.</li><li class="listitem">Change its <strong>Font</strong> to <code class="literal">SciFi Font – Normal</code>.</li><li class="listitem">Change its text to <code class="literal">[AAFFFF]Selected</code>.</li></ol></div></li><li class="listitem">Select our <strong>SelectedLabel</strong> GameObject in <strong>Powers</strong> and perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Duplicate it.</li><li class="listitem">Rename this new duplicate as <code class="literal">AvailableLabel</code>.</li><li class="listitem">Change its text to <code class="literal">[AAFFFF]Available</code>.</li><li class="listitem">Set its <strong>Pixel Offset</strong> in <strong>UIAnchor</strong> to {<code class="literal">0</code>, <code class="literal">-295</code>}.</li></ol></div></li><li class="listitem">Select our <strong>SelectedLabel GameObject</strong> in <strong>Powers</strong> and perform these steps:<div><ol class="orderedlist arabic"><li class="listitem">Duplicate it.</li><li class="listitem">Rename this new duplicate it as <code class="literal">InstructionsLabel</code>.</li><li class="listitem">Change text to <code class="literal">[55AA99]Drag Power Here</code>—one word per line.</li><li class="listitem">Set its <strong>Overflow</strong> parameter to <strong>Shrink Content</strong>.</li><li class="listitem">Set its <strong>Depth</strong> to <code class="literal">4</code>.</li><li class="listitem">Set its <strong>Dimensions</strong> to <code class="literal">128</code> x <code class="literal">45</code>.</li><li class="listitem">Set its <strong>Pixel Offset</strong> in <strong>UIAnchor</strong> to {<code class="literal">0</code>, <code class="literal">-175</code>}.</li></ol></div></li><li class="listitem">Select our <strong>Background</strong> sprite GameObject in <strong>Powers</strong> and perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Duplicate it.</li><li class="listitem">Rename this new duplicate as <code class="literal">PowersContainer</code>.</li><li class="listitem">Set its <strong>Dimensions</strong> to <code class="literal">215</code> x <code class="literal">90</code>.</li><li class="listitem">Set its <strong>Color Tint</strong> to {<code class="literal">100</code>, <code class="literal">100</code>, <code class="literal">100</code>, <code class="literal">255</code>}.</li><li class="listitem">Set its <strong>Depth</strong> to <code class="literal">3</code>.</li><li class="listitem">Drag our <strong>AvailableLabel</strong> GameObject from <strong>Powers</strong> to the <strong>Container</strong> field in its <strong>UIAnchor</strong>.</li><li class="listitem">Set its <strong>Pixel Offset</strong> in <strong>UIAnchor</strong> to {<code class="literal">0</code>, <code class="literal">-60</code>}.</li></ol></div></li></ol></div><p>Ok, we now <a id="id131" class="indexterm"/>have our powers box with the correct labels and a background.</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec11"/>Draggable items</h3></div></div></div><p>Now that we <a id="id132" class="indexterm"/>have the PowersContainer, let's create the following two draggable items:</p><div><img src="img/8667OT_03_02.jpg" alt="Draggable items"/></div><p>Follow the ensuing steps to create them:</p><div><ol class="orderedlist arabic"><li class="listitem">Select our <strong>PowersContainer</strong> GameObject in <strong>Powers</strong>.</li><li class="listitem">Create a new child GameObject with <em>Alt</em> + <em>Shift</em> + <em>N</em> and rename it as <code class="literal">Bomb</code>.</li><li class="listitem">Attach a <strong>Collider</strong> object to it by navigating to <strong>NGUI</strong> | <strong>Attach</strong>. It will be used to detect the mouse and receive the correct messages for the drag-and-drop system by performing the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Check the <strong>Is Trigger</strong> Boolean.</li><li class="listitem">Set its <strong>Size</strong> field of new <strong>Box Collider</strong> to {<code class="literal">90</code>, <code class="literal">90</code>, <code class="literal">1</code>}.</li></ol></div></li><li class="listitem">Attach a <strong>Drag Object</strong> component to it by navigating to <strong>Component</strong> | <strong>NGUI</strong> | <strong>Interaction</strong>:<div><ol class="orderedlist arabic"><li class="listitem">Drag our <strong>Bomb</strong> from <strong>PowersContainer</strong> in its <strong>Target</strong> field.</li><li class="listitem">Set its <strong>Scale</strong> to {<code class="literal">1</code>, <code class="literal">1</code>, <code class="literal">0</code>}.</li><li class="listitem">Set the <strong>Momentum Amount</strong> to <code class="literal">0</code>.</li></ol></div></li><li class="listitem">Select and duplicate the <strong>Background</strong> sprite GameObject in <strong>Powers</strong>. Then perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Drag it inside our new <strong>Bomb</strong> GameObject.</li><li class="listitem">Set its <strong>Depth</strong> to <code class="literal">5</code>.</li><li class="listitem">Set its <strong>Dimensions</strong> to <code class="literal">90</code> x <code class="literal">90</code>.</li><li class="listitem">Remove its <strong>UIAnchor</strong> component.</li><li class="listitem">Reset its <strong>Transform</strong> position values to {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>}.</li></ol></div></li><li class="listitem">Select<a id="id133" class="indexterm"/> and duplicate the <strong>AvailableLabel</strong> GameObject in <strong>Powers</strong>. Then perform these steps:<div><ol class="orderedlist arabic"><li class="listitem">Rename that new duplicate as <code class="literal">Label</code>.</li><li class="listitem">Drag it inside our new <strong>Bomb</strong> GameObject.</li><li class="listitem">Change its text to <code class="literal">[AAFFFF]Bomb</code>.</li><li class="listitem">Set its <strong>Depth</strong> to <code class="literal">6</code>.</li><li class="listitem">Remove its <strong>UIAnchor</strong> component.</li><li class="listitem">Reset its <strong>Transform</strong> position values to {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>}.</li></ol></div></li><li class="listitem">Select our <strong>Bomb</strong> GameObject.</li><li class="listitem">Attach a <strong>Button Color</strong> component to it by navigating to <strong>Component</strong> | <strong>NGUI</strong> | <strong>Interaction</strong> and perform these steps:<div><ol class="orderedlist arabic"><li class="listitem">Drag our <strong>Background</strong> GameObject from <strong>Bomb</strong> to the <strong>Target</strong> field.</li><li class="listitem">Set its <strong>Pressed</strong><code class="literal"> </code>color to {<code class="literal">0</code>, <code class="literal">255</code>, <code class="literal">0</code>, <code class="literal">150</code>}.</li></ol></div></li><li class="listitem">Create a new <code class="literal">DragItem.cs</code> C# script and attach this script to the <strong>Button Color</strong> component.</li></ol></div><p>We have one draggable Bomb power with a <code class="literal">DragItem.cs </code>script attached to it. Let's create the second Time power by performing the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Select and duplicate our <strong>Bomb</strong> GameObject in <strong>PowersContainer</strong>.</li><li class="listitem">Rename that new duplicate as <code class="literal">Time</code>.</li><li class="listitem">Select our new <strong>Label</strong> GameObject, which is a child of <strong>Time</strong>.</li><li class="listitem">Change its text to <code class="literal">[AAFFFF]Time</code>.</li></ol></div><p>Ok, we now have our two draggable Powers, and they are on top of each other. Let's correct this using Anchors and a Grid component, which will automatically align our items. We can do this using the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Select our <strong>PowersContainer</strong> GameObject.</li><li class="listitem">Create a new child by pressing <em>Alt</em> + <em>Shift</em> + <em>N</em> and rename this new child as <code class="literal">Grid</code>.</li><li class="listitem">Attach a <strong>Grid</strong> component to it by navigating to <strong>Component</strong> | <strong>NGUI</strong> | <strong>Interaction</strong>.</li><li class="listitem">Drag both our <strong>Bomb</strong> and <strong>Time</strong> GameObjects in our new <strong>Grid</strong> GameObject.</li><li class="listitem">Select our <strong>Grid</strong> GameObject and perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Set its <strong>Cell Width</strong> to <code class="literal">105</code>.</li><li class="listitem">Check the <strong>Sorted</strong> Boolean.</li><li class="listitem">Check the <strong>Reposition Now</strong> Boolean to update the table.</li><li class="listitem">Set its <strong>Transform</strong> position to {<code class="literal">-52</code>, <code class="literal">0</code>, <code class="literal">0</code>}.</li></ol></div></li></ol></div><p>The UIGrid component <a id="id134" class="indexterm"/>automatically aligns its children. We now have our two draggable powers aligned. If you click on play, you'll see that you can drag them around as shown in the following screenshot:</p><div><img src="img/8667OT_03_03.jpg" alt="Draggable items"/></div></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec12"/>The drop surface</h3></div></div></div><p>We will<a id="id135" class="indexterm"/> create a new <strong>Surface</strong> GameObject with a <code class="literal">DropSurface.cs</code> script and a <strong>Box Collider</strong> component to define where the draggable items can be dropped.</p><p>When the user drops an object with a <strong>DragItem</strong> component on the <strong>Surface</strong> GameObject, the <strong>DragItem</strong> component will be destroyed, and a "dropped version" of the object will be instantiated as a child of the <strong>Surface</strong> GameObject.</p><p>First, let's create and configure the <strong>Surface</strong> GameObject by performing the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Select and duplicate our <strong>Background</strong> GameObject from <strong>Powers</strong> and rename this new duplicate as <code class="literal">Surface</code>.</li><li class="listitem">Select our new <strong>Surface</strong> GameObject from <strong>Powers</strong> and perform these steps:<div><ol class="orderedlist arabic"><li class="listitem">Change its <strong>Sprite</strong> to <strong>Highlight</strong>.</li><li class="listitem">Change its <strong>Color Tint</strong> to {<code class="literal">0</code>, <code class="literal">25</code>, <code class="literal">5</code>, <code class="literal">255</code>}.</li><li class="listitem">Set its <strong>Depth</strong> to <code class="literal">3</code>.</li><li class="listitem">Set its <strong>Dimensions</strong> to <code class="literal">130</code> x <code class="literal">130</code>.</li><li class="listitem">Drag our <strong>SelectedLabel</strong> GameObject from <strong>Powers</strong> to the <strong>Container</strong> field in its <strong>UIAnchor</strong>.</li><li class="listitem">Set its <strong>Pixel Offset</strong> to {<code class="literal">0</code>, <code class="literal">-80</code>}.</li></ol></div></li><li class="listitem">Attach<a id="id136" class="indexterm"/> a <strong>Collider</strong> object to it by navigating to <strong>NGUI</strong> | <strong>Attach</strong> | <strong>Collider</strong>. It will detect <strong>DragItems</strong>. Then perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Check its <strong>Is Trigger</strong> Boolean.</li><li class="listitem">Set its <strong>Size</strong> to {<code class="literal">130</code>, <code class="literal">130</code>, <code class="literal">1</code>}.</li></ol></div></li><li class="listitem">Create and attach a new <code class="literal">DropSurface.cs</code> C# script to it.</li></ol></div><p>Good, our surface is now ready to detect our items.</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec13"/>Prefab instantiated on drop</h3></div></div></div><p>Now, we<a id="id137" class="indexterm"/> need to create two prefabs for our powers that will be instantiated as children of the <strong>Surface</strong> GameObject when a <strong>DragItem</strong> component is dropped on it. They will look as follows:</p><div><img src="img/8667OT_03_04.jpg" alt="Prefab instantiated on drop"/></div><p>Let's create these prefabs by performing the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Select the <strong>Bomb</strong> GameObject from <strong>Grid</strong> and the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Duplicate it.</li><li class="listitem">Rename it as <code class="literal">SelectedBomb</code>.</li></ol></div></li><li class="listitem">Select our new <strong>SelectedBomb</strong> GameObject from <strong>Grid</strong>. Then perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Change its <strong>Normal</strong> color tint to <strong>R</strong>: <code class="literal">0</code>, <strong>G</strong>: <code class="literal">145</code>, <strong>B</strong>: <code class="literal">60</code>, and <strong>A</strong>: <code class="literal">255</code>.</li><li class="listitem">Remove its <strong>Box Collider</strong> component.</li><li class="listitem">Remove its <strong>Drag Item</strong> component.</li></ol></div></li><li class="listitem">Create and attach a new <code class="literal">Power.cs</code> C# script to it.</li><li class="listitem">Select the <strong>Background</strong> sprite GameObject from <strong>SelectedBomb</strong>. Then perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Change the <strong>Sprite</strong> to <strong>Light</strong>.</li><li class="listitem">Set its <strong>Depth</strong> to <code class="literal">4</code>.</li><li class="listitem">Set its <strong>Dimensions</strong> to <code class="literal">120</code> x <code class="literal">120</code>.</li></ol></div></li><li class="listitem">Select the <strong>Label</strong> GameObject from <strong>SelectedBomb</strong> and set its <strong>Depth</strong> to <code class="literal">5</code>.</li><li class="listitem">Drag our <strong>SelectedBomb</strong> GameObject into a folder of your choice in your <strong>Project</strong> view to create a prefab from it.</li><li class="listitem">Once our <strong>SelectedBomb</strong> is a prefab (blue in the scene's <strong>Hierarchy</strong>), you may delete it from the scene.</li></ol></div><p>We now<a id="id138" class="indexterm"/> have our <strong>SelectedBomb</strong> prefab. Let's declare a variable in our <code class="literal">DragItem.cs</code> script that will store the prefab to instantiate on drop. We can do this by following the ensuing steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Select our <strong>Bomb</strong> GameObject from <strong>Grid</strong>.</li><li class="listitem">Open the <code class="literal">DragItem.cs</code> script attached to it and add this public variable using the following code:<div><pre class="programlisting">public Object CreateOnDrop;</pre></div></li><li class="listitem">Save the script and go back to Unity.</li><li class="listitem">Select our <strong>Bomb</strong> GameObject from <strong>Grid</strong> and drag our <strong>SelectedBomb</strong> prefab from the Project view in the <strong>Create On Drop</strong> field in its <strong>Drag Item</strong>.</li></ol></div><p>Now let's do the same for our <strong>Time</strong> power in the following manner:</p><div><ol class="orderedlist arabic"><li class="listitem">Select our <strong>SelectedBomb</strong> prefab in the <strong>Project</strong> view and perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Duplicate it with <em>Ctrl</em> + <em>D</em>.</li><li class="listitem">Rename the new duplicate prefab as <code class="literal">SelectedTime</code>.</li></ol></div></li><li class="listitem">Select its <strong>Label</strong> child GameObject and change its text to <code class="literal">[AAFFFF]Time</code>.</li><li class="listitem">Select our <strong>Time</strong> GameObject from <strong>Grid</strong> in the scene's <strong>Hierarchy</strong>.</li><li class="listitem">Drag our <strong>SelectedTime</strong> prefab from the <strong>Project</strong> view in the <strong>Create On Drop</strong> field in its <strong>Drag Item</strong>.</li></ol></div><p>We can now add an <code class="literal">OnDrop()</code> method to our <code class="literal">DropSurface.cs</code> script to handle dropped objects in the following manner:</p><div><ol class="orderedlist arabic"><li class="listitem">Select our <strong>Surface</strong> GameObject from <strong>Powers</strong>.</li><li class="listitem">Open its attached <code class="literal">DropSurface.cs</code> script.</li></ol></div><p>The <code class="literal">OnDrop()</code> event has one argument: the <code class="literal">dropped</code> GameObject. Let's add this method to our script<a id="id139" class="indexterm"/> to handle the drop by using the following code snippet:</p><div><pre class="programlisting">//Called when an object is dropped on DropSurface
public void OnDrop(GameObject dropped)
{
  //Get the DragItem from the dropped object
  DragItem dragItem = dropped.GetComponent&lt;DragItem&gt;();
  //If it has none, don't go further
  if(dragItem == null) return;
  //Instantiate the defined CreateOnDrop Object
  GameObject newPower = NGUITools.AddChild(this.gameObject, dragItem.CreateOnDrop as GameObject);
  //Destroy the dropped Object
  Destroy(dropped);
}</pre></div><p>Save the script and click on the play button. When you drop a power on the <strong>Surface</strong> GameObject, nothing happens! Why?</p><p>That's because the <code class="literal">OnDrop()</code> event depends on the Raycast from <code class="literal">Camera</code>, and at the moment of the drop, our dragged power's <strong>Box Collider</strong> component is in the way of the mouse cursor and the <strong>Surface</strong> GameObject.</p><p>We just have to disable the collider of <strong>Power</strong> while it is dragged. We can do this in the following manner:</p><div><ol class="orderedlist arabic"><li class="listitem">Select our <strong>Bomb</strong> GameObject from <strong>Grid</strong>.</li><li class="listitem">Open its attached <code class="literal">DragItem.cs</code> script.</li></ol></div><p>We will use the <code class="literal">OnPress()</code> event to do this. The <code class="literal">OnPress()</code> method will take the object's <code class="literal">pressed</code> state as an argument in the following manner:</p><div><pre class="programlisting">//Method called when the Item is Pressed or Released
void OnPress(bool pressed)
{
  //Invert the collider's state
  collider.enabled = !pressed;
}</pre></div><p>Save the script and click on play. You can now drag-and-drop the powers on the surface!</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec14"/>Handling an invalid drop</h3></div></div></div><p>Now, let's <a id="id140" class="indexterm"/>make sure power is repositioned to its default position if the user drops it outside the <strong>Surface</strong> GameObject.</p><p>To achieve this, we can check the camera's last hit when the <code class="literal">OnPress(false)</code> event occurs. Open our <code class="literal">DragItem.cs</code> and add the following lines after <code class="literal">collider.enabled = !pressed</code>:</p><div><pre class="programlisting">//If the Item is released
if(!pressed)
{
  //Get the last hit collider
  Collider col = UICamera.lastHit.collider;
  //If there is no collider, or no DropSurface behind the Power
  if(col == null || col.GetComponent&lt;DropSurface&gt;() == null)
  {
    //Get the grid in parent objects
    UIGrid grid = NGUITools.FindInParents&lt;UIGrid&gt;(gameObject);
    //If a grid is found, order it to Reposition now
    if(grid != null) grid.Reposition();
  }
}</pre></div><p>Save and click on play. If you drop a Power anywhere but on the <strong>Surface</strong> GameObject, our items will be repositioned automatically. Great!</p><p>A slight problem: you can drop both of them on the surface, and then you're stuck. Let's explore the solution in the following sections.</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec15"/>Replacing the current item</h3></div></div></div><p>We will <a id="id141" class="indexterm"/>now ensure that you can only have one power on the surface. If you drag a second one while the DropSurface is already occupied, the current power will be replaced by the new one and the drag item component will reappear in the <strong>PowersContainer</strong> GameObject.</p><p>We will need to know which power is currently dropped on the surface and which original drag Item component must be instantiated in <strong>Grid</strong> in <strong>PowersContainer</strong>:</p><div><ol class="orderedlist arabic"><li class="listitem">Select our <strong>SelectedBomb</strong> prefab in the <strong>Project</strong> view.</li><li class="listitem">Open its attached <code class="literal">Power.cs</code> script.</li></ol></div><p>This script will be used to contain information about the dropped item. Let's declare a new <code class="literal">enum</code> to distinguish which type of power, and an <code class="literal">Object</code> variable to set which prefab will be instantiated to make the draggable item in power reappear when replaced:</p><div><pre class="programlisting">//Declare an enum to define type of Power
public enum Type 
{
  None,
  Time,
  Bomb
}
//Declare a Type variable to choose it in Inspector
public Type type;
//Object variable to define the DragItem to recreate
public Object createOnDestroy;</pre></div><p>Now, we need<a id="id142" class="indexterm"/> to go back to Unity and create prefabs for our <code class="literal">Bomb</code> and <code class="literal">Time</code> draggable items before we assign them to the <code class="literal">createOnDestroy</code> variables:</p><div><ol class="orderedlist arabic"><li class="listitem">Select our <strong>Bomb</strong> GameObject from <strong>Powers</strong> in the <strong>Hierarchy</strong> of <strong>Scene</strong> and drag it into a folder of your choice in your <strong>Project</strong> view to create a prefab from it.</li><li class="listitem">Select our <strong>SelectedBomb</strong> Prefab in the <strong>Project</strong> view and perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Set its <strong>Power</strong> component's <strong>Type</strong> variable to <strong>Bomb</strong>.</li><li class="listitem">Drag our new <strong>Bomb</strong> Prefab from the Project view to the <strong>Power</strong> component's <strong>Create On Destroy</strong> field.</li></ol></div></li></ol></div><p>We assigned the <strong>Type</strong> parameter of <strong>SelectedBomb</strong> to <strong>Bomb</strong>, and it now has an assigned prefab that we will instantiate to recreate the draggable item when it gets replaced.</p><div><div><h3 class="title"><a id="note10"/>Note</h3><p>Repeat steps 1 and 2, replacing the word <code class="literal">Bomb</code> with <code class="literal">Time</code> to do the same for our Time power GameObject and prefab.</p></div></div><p>Now, we have to code a system that will register which type of power is currently selected. We'll use the <code class="literal">GameManager.cs</code> script in the following manner to store it:</p><div><ol class="orderedlist arabic"><li class="listitem">Open our <code class="literal">GameManager.cs</code> script and declare this new static variable:<div><pre class="programlisting">//This static variable will contain the selected power
public static Power.Type SelectedPower = Power.Type.None;</pre></div></li><li class="listitem">Add this new static method to set our <code class="literal">SelectedPower</code> from other scripts:<div><pre class="programlisting">//This static method changes the SelectedPower value
public static void SetPower(Power.Type newPower)
{
  SelectedPower = newPower;
}</pre></div></li></ol></div><p>Ok, we now have a method to register the currently selected power. It is time to modify our <code class="literal">DropSurface.cs</code> script:</p><div><ol class="orderedlist arabic"><li class="listitem">Select our <strong>Surface</strong> GameObject from <strong>Powers</strong> and open the <code class="literal">DropSurface.cs</code> script.</li><li class="listitem">Declare a new <code class="literal">GameObject</code> variable to store our <strong>Grid</strong> GameObject:<div><pre class="programlisting">public GameObject dragItemsContainer;</pre></div></li><li class="listitem">Save the script, select our <strong>Surface</strong> GameObject from <strong>Powers</strong> in the <strong>Hierarchy</strong> view. Drag our <strong>Grid</strong> GameObject from <strong>PowersContainer</strong> in its <strong>DropSurface</strong> component's <strong>Drag Items Container</strong> field.</li></ol></div><p>Now, go <a id="id143" class="indexterm"/>back to our <code class="literal">DropSurface.cs</code> script. We will add these following lines to handle the fact that the user cannot drop two powers on the surface; it will replace the previous one and recreate its original <code class="literal">Drag Item</code>. In the <code class="literal">OnDrop()</code> method, just below the <code class="literal">if(dragItem == null) return</code> line, add the following:</p><div><pre class="programlisting">RecreateDragItem();</pre></div><p>Now, add a new <code class="literal">RecreateDragItem()</code> method<a id="id144" class="indexterm"/> to the file:</p><div><pre class="programlisting">void RecreateDragItem()
{
  //If there's already a Power selected
  if(GameManager.SelectedPower != Power.Type.None)
  {
    //Get the selected power's Power.cs script
    Power selectedPowerScript = transform.GetChild(0).GetComponent&lt;Power&gt;();
    //Add the Drag Item to the grid
    NGUITools.AddChild(dragItemsContainer, selectedPowerScript.createOnDestroy as GameObject);
    //Destroy the currently selected Power
    Destroy(selectedPowerScript.gameObject);
  }
}</pre></div><p>Ok, we now have to inform the <code class="literal">GameManager.cs</code> script that the selected Power has changed. We can do this by calling our <code class="literal">SetPower()</code> static method.</p><p>Add the following line in the <code class="literal">OnDrop()</code> method just before the <code class="literal">Destroy(dropped)</code> line:</p><div><pre class="programlisting">//Set the new selected power in the GameManager
GameManager.SetPower(newPower.GetComponent&lt;Power&gt;().type);</pre></div><p>Save all the scripts and click on the play button. You can drop the first Power on the <strong>Surface</strong> GameObject and then drop the second one. The first power is now replaced and will reappear in the <strong>Available</strong> power container.</p><p>Unfortunately, we cannot simply remove the power. Let's correct this in the following sections.</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec16"/>Removing the current item</h3></div></div></div><p>We want <a id="id145" class="indexterm"/>to remove the selected power by clicking on it. In our <code class="literal">DropSurface.cs</code> script, add this new <code class="literal">OnClick()</code> method that will be called when the user clicks on the surface:</p><div><pre class="programlisting">void OnClick()
{
  //Recreate the DragItem now
  RecreateDragItem();
  //Reset SelectedPower to None
  GameManager.SetPower(Power.Type.None);
  //Force reposition of the grid
  dragItemsContainer.GetComponent&lt;UIGrid&gt;().Reposition();
}</pre></div><p>Now click on play. You can now remove the selected power by right- or left-clicking on it.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec25"/>Animations with NGUI</h1></div></div></div><p>One great<a id="id146" class="indexterm"/> aspect of NGUI is that you can use Unity's animation system <a id="id147" class="indexterm"/>on any kind of widget. There also are some Tween components that let you modify most values over time, such as dimensions, color, and scale. For example, you can change an object's color from color A to color B in 5 seconds.</p><p>We have a nice main menu. But we actually have our options that are constantly displayed. That is not very user friendly.</p><p>We will use animations and tweens to hide our options and show them only when the user clicks on the <strong>Options</strong> button. With options hidden, our menu will look as shown in the following screenshot:</p><div><img src="img/8667OT_03_05.jpg" alt="Animations with NGUI"/></div><p>But first, let's make our powers' apparition smoother.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec42"/>Smooth powers apparition</h2></div></div></div><p>Let's <a id="id148" class="indexterm"/>add <strong>Scale Tweens</strong>
<a id="id149" class="indexterm"/> on our prefabs to make them appear smoothly by performing the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">In the Project view, select our <strong>SelectedBomb</strong> prefab.</li><li class="listitem">Attach a <strong>Scale Tween</strong> component by navigating to <strong>Component</strong> | <strong>NGUI</strong> | <strong>Tween</strong> and perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Set its <strong>From</strong> parameter to {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>,}.</li><li class="listitem">Set its <strong>Duration</strong> to <code class="literal">0.2</code>.</li></ol></div></li><li class="listitem">Right-click on the <strong>Tween Scale</strong> component and then click on <strong>Copy Component</strong>.</li><li class="listitem">Select our <strong>SelectedTime</strong>, <strong>Bomb</strong>, and <strong>Time</strong> prefabs.</li><li class="listitem">In the <strong>Inspector</strong> view, right-click on any existing component name and click on <strong>Paste Component As New</strong>.</li></ol></div><p>Now, as soon as these widgets are created, they scale from 0 to 1 in 0.2 seconds, which makes them appear smoothly.</p><p>We can now see how we'll hide and show options using a button.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec43"/>Clipping to hide options</h2></div></div></div><p>First, <a id="id150" class="indexterm"/>we have to hide our option boxes. To do that, we will use <strong>Panel</strong> <strong>Clipping</strong>
<a id="id151" class="indexterm"/> and increase their width when we need to show them. Let's set up the Clipping option:</p><div><ol class="orderedlist arabic"><li class="listitem">Select our <strong>Window</strong> GameObject from <strong>MainMenu</strong> and set its <strong>Dimensions</strong> to <code class="literal">515</code> x <code class="literal">850</code>.</li><li class="listitem">Select the <strong>MainMenu</strong> GameObject and perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Set its <strong>Depth</strong> in <strong>UIPanel</strong> to <code class="literal">-1</code>.</li><li class="listitem">Create a new child for <strong>MainMenu</strong> with <em>Alt</em> + <em>Shift</em> + <em>N</em>.</li><li class="listitem">Rename this new child as <code class="literal">Container</code>.</li></ol></div></li><li class="listitem">Select our new <strong>Container</strong> GameObject.</li><li class="listitem">Attach a <strong>Panel</strong> component to it by navigating to <strong>Component</strong> | <strong>NGUI</strong> | <strong>UI</strong>. Then perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Set its <strong>Depth</strong> to <code class="literal">0</code>.</li><li class="listitem">Set its <strong>Clipping</strong> parameter to <strong>Alpha Clip</strong>.</li><li class="listitem">Set its <strong>Size</strong> to <code class="literal">515</code> x <code class="literal">1080</code>.</li></ol></div></li><li class="listitem">Fold all the children of <strong>MainMenu</strong> using the arrow next to each of them.</li><li class="listitem">Select every child of <strong>MainMenu</strong>, except the new <strong>Container</strong> child, and drag them all inside our new <strong>Container</strong> GameObject.</li></ol></div><p>Good, our options are now hidden. Your <strong>Hierarchy</strong> should look as shown in the following screenshot:</p><div><img src="img/8667OT_03_06.jpg" alt="Clipping to hide options"/></div><p>Let's add<a id="id152" class="indexterm"/> an <strong>Options</strong> button that will show or hide these options:</p><div><ol class="orderedlist arabic"><li class="listitem">Select and duplicate our <strong>Play</strong><code class="literal"> </code>GameObject from <strong>Buttons</strong> and rename this new duplicate as <code class="literal">Options</code>.</li><li class="listitem">Select our new <strong>Options</strong> GameObject from <strong>Buttons</strong> and perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Set its <strong>Side</strong> parameter in <strong>UIAnchor</strong> to <strong>Bottom</strong>.</li><li class="listitem">Reset its <strong>Pixel Offset</strong> in <strong>UIAnchor</strong> to {<code class="literal">0</code>, <code class="literal">0</code>}.</li><li class="listitem">Set its <strong>Size</strong> in <strong>Box Collider</strong> to {<code class="literal">140</code>, <code class="literal">40</code>, <code class="literal">0</code>}.</li><li class="listitem">Remove its <strong>Load Level On Click</strong> component.</li></ol></div></li><li class="listitem">Select our <strong>Background</strong> GameObject from <strong>Options</strong> and set its <strong>Dimensions</strong> to <code class="literal">140</code> x <code class="literal">40</code>.</li><li class="listitem">Select our <strong>Label</strong> GameObject from <strong>Options</strong>:<div><ol class="orderedlist arabic"><li class="listitem">Change its text to <code class="literal">Options</code>.</li><li class="listitem">Set its <strong>Overflow</strong> parameter to <strong>Shrink Content</strong>.</li><li class="listitem">Set its <strong>Dimensions</strong> to <code class="literal">90</code> x <code class="literal">25</code>.</li></ol></div></li></ol></div><p>Ok, so now we have an <strong>Options</strong> button. Next, we want it to enlarge our <strong>Window</strong> and the Panel Clipping <code class="literal">width</code> of <strong>Container</strong> when clicked. We can do this using code, but we will use tweens and animations in the following manner to see how they work:</p><div><ol class="orderedlist arabic"><li class="listitem">Select our <strong>Window</strong> GameObject in <strong>Container</strong>.</li><li class="listitem">Attach a <strong>Tween Width</strong> component to it by navigating to <strong>Component</strong> | <strong>NGUI</strong> | <strong>Tween</strong>. Then perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Set its <strong>From</strong> parameter to <code class="literal">515</code>.</li><li class="listitem">Set its <strong>To</strong> parameter to <code class="literal">1300</code>.</li><li class="listitem">Set <strong>Duration</strong> to <code class="literal">0.5</code>.</li><li class="listitem">Reset <strong>Dimensions</strong> to <code class="literal">515</code> x <code class="literal">850</code>.</li><li class="listitem">Disable the <strong>Tween Width</strong> component to prevent it from tweening at start.</li></ol></div></li></ol></div><p>We have <a id="id153" class="indexterm"/>a <strong>Tween</strong> component that will resize the <code class="literal">width</code> of <strong>Window</strong> when activated. Let's use the <strong>UIPlay Tween</strong> component to start it when the <strong>Options</strong> button is clicked on:</p><div><ol class="orderedlist arabic"><li class="listitem">Select our <strong>Options</strong> button GameObject.</li><li class="listitem">Attach a <strong>Play Tween</strong> component by navigating to <strong>Component</strong> | <strong>NGUI</strong> | <strong>Interaction</strong>. Then perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Drag our <strong>Window</strong> GameObject from <strong>Container</strong> in the <strong>Tween Target</strong> field.</li><li class="listitem">Set the <strong>Play</strong> direction to <strong>Toggle</strong>.</li></ol></div></li></ol></div><p>Click on play. You will see that the window resizes as needed when <strong>Options</strong> is clicked. However, the <strong>Clipping</strong> parameter doesn't. Let's correct this using a Unity animation:</p><div><ol class="orderedlist arabic"><li class="listitem">Select our <strong>Container</strong> GameObject from <strong>MainMenu</strong>.</li><li class="listitem">Open the <strong>Animation</strong> window by navigating to <strong>Window</strong> | <strong>Animation</strong>.</li><li class="listitem">Click the red record button.</li><li class="listitem">Save the animation as <code class="literal">ShowOptions.anim</code> and perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Re-enter <code class="literal">515</code> for the clipping <strong>X Size</strong> from <strong>UIPanel</strong> to add a key.</li><li class="listitem">Move the time cursor in the <strong>Animation</strong> window to <code class="literal">0:30</code>.</li><li class="listitem">Enter <code class="literal">1300</code> for the clipping <strong>X Size</strong> from <strong>UIPanel</strong> to add a key.</li><li class="listitem">Click on the red record button again to finish.</li></ol></div></li><li class="listitem">Uncheck its <strong>Play Automatically</strong> Boolean in the <strong>Animation</strong> component.</li></ol></div><p>We have our animation ready. Now, let's link the button to the animation in the following manner:</p><div><ol class="orderedlist arabic"><li class="listitem">Select our <strong>Options</strong> GameObject from <strong>Buttons</strong>.</li><li class="listitem">Attach a Play Animation component to it by navigating to <strong>Component</strong> | <strong>NGUI</strong> | <strong>Interaction</strong>. Then perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Drag our <strong>Container</strong> GameObject from <strong>MainMenu</strong> in the <strong>Target</strong> field.</li><li class="listitem">For the <strong>Clip Name</strong> parameter, type in <code class="literal">ShowOptions</code>.</li><li class="listitem">Set the <strong>Play</strong> direction to <strong>Toggle</strong>.</li></ol></div></li></ol></div><p>Click on play. Our window and clipping both resize perfectly in both directions when the <strong>Options</strong> button is clicked.</p><p>But you can see that our <strong>Options</strong> widgets aren't visible until you actually drag the main menu around;<a id="id154" class="indexterm"/> that's because the clipping is not refreshed after the animation.</p><div><ol class="orderedlist arabic"><li class="listitem">To solve this, we can simply force a <strong>Drag at the end of the Animation</strong> option.</li><li class="listitem">Select our <strong>MainMenu</strong> GameObject and perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Create and add a new <code class="literal">UpdatePanel.cs</code> script to it.</li><li class="listitem">Open our new <code class="literal">UpdatePanel.cs</code> script.</li></ol></div></li><li class="listitem">Now, add this new <code class="literal">UpdateNow()</code> method to the script that will force a drag of (0, 0, 0) value on our <strong>MainMenu</strong>:<div><pre class="programlisting">public void UpdateNow()
{
  //Force a drag of {0, 0, 0} to update Panel
  GetComponent&lt;UIDraggablePanel&gt;().MoveRelative(Vector3.zero);
}</pre></div></li><li class="listitem">Save the script and then perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Select our <strong>Options</strong> GameObject in <strong>Buttons</strong>.</li><li class="listitem">Drag our <strong>MainMenu</strong> GameObject in the <strong>Notify</strong> field of the <strong>UIPlay Animation</strong> component.</li><li class="listitem">Choose our new <code class="literal">UpdatePanel.UpdateNow</code> method for the <strong>Method</strong> field.</li></ol></div></li><li class="listitem">Click on the play button. The <strong>Options</strong> boxes now appear after the animation!</li></ol></div><p>Great! We have used NGUI's <strong>Tween</strong> and <strong>Play Animations</strong> components to enhance our UI and make it nicer and more user friendly.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec26"/>Scrollable text</h1></div></div></div><p>Let's add a <a id="id155" class="indexterm"/>welcome <a id="id156" class="indexterm"/>textbox with instructions for the user. This text will be scrollable using the mouse wheel or a simple click-and-drag. It will look as shown in the following screenshot:</p><div><img src="img/8667OT_03_07.jpg" alt="Scrollable text"/></div><p>At the start, it will scroll<a id="id157" class="indexterm"/> automatically. Let's create it now:</p><div><ol class="orderedlist arabic"><li class="listitem">Select our <strong>Nickname</strong> container GameObject, duplicate it by pressing <em>Ctrl</em> + <em>D</em>.</li><li class="listitem">Rename this new duplicate as <code class="literal">Help</code>.</li><li class="listitem">Select this <strong>Help</strong> GameObject and perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Drag our <strong>Title</strong> GameObject in the <strong>Container</strong> field in its <strong>UIAnchor</strong>.</li><li class="listitem">Set its <strong>Side</strong> parameter in <strong>UIAnchor</strong> to <strong>Bottom</strong>.</li><li class="listitem">Set its <strong>Pixel Offset</strong> in <strong>UIAnchor</strong> to {<code class="literal">0</code>, <code class="literal">-50</code>}.</li></ol></div></li><li class="listitem">Attach a Panel component by navigating to <strong>Component</strong> | <strong>NGUI</strong> | <strong>UI</strong>:<div><ol class="orderedlist arabic"><li class="listitem">Set its <strong>Depth</strong> to <code class="literal">1</code>.</li><li class="listitem">Set its <strong>Clipping</strong> parameter to <strong>Alpha Clip</strong>.</li><li class="listitem">Set its <strong>Clipping Size</strong> to <code class="literal">440</code> x <code class="literal">85</code>.</li></ol></div></li><li class="listitem">Attach a <strong>Collider</strong> object to it by navigating to <strong>NGUI</strong> | <strong>Attach</strong> and set its <strong>Size</strong> to {<code class="literal">440</code>, <code class="literal">85</code>, <code class="literal">0</code>}.</li><li class="listitem">Delete the <strong>Input</strong> GameObject from <strong>Help</strong>.</li><li class="listitem">Select our <strong>Label</strong> GameObject from <strong>Help</strong> and perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Change its <strong>Font</strong> to <strong>SciFi Font – Normal</strong>.</li><li class="listitem">Remove its <strong>UIAnchor</strong> component.</li><li class="listitem">Set its text to:<div><pre class="programlisting">Welcome!
[HIT RETURN KEY]
[HIT RETURN KEY]
You can Select one of two [AAFFFF]Powers[FFFFFF]:
[AAFFAA]Bomb[FFFFFF]: Explodes all enemies at once
[AAFFAA]Time[FFFFFF]: Reduces Time speed for 10 seconds</pre></div></li></ol></div></li><li class="listitem">Attach a <strong>Tween Position</strong> component to it by navigating to <strong>Component</strong> | <strong>NGUI</strong> | <strong>Interaction</strong>. Then perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Set its <strong>From</strong> parameter to {<code class="literal">0</code>, <code class="literal">-50</code>, <code class="literal">0</code>}.</li><li class="listitem">Set its <strong>To</strong> parameter to {<code class="literal">0</code>, <code class="literal">20</code>, <code class="literal">0</code>}.</li><li class="listitem">Set its <strong>Duration</strong> value to <code class="literal">1.5</code>.</li><li class="listitem">Set its <strong>Start Delay</strong> value to <code class="literal">3</code>.</li></ol></div></li><li class="listitem">Set its <strong>Transform</strong> position to {<code class="literal">0</code>, <code class="literal">-50</code>, <code class="literal">0</code>}.</li><li class="listitem">Select the <strong>Background</strong> GameObject from <strong>Help</strong> and perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Set its <strong>Dimensions</strong> to <code class="literal">440</code> x <code class="literal">85</code>.</li><li class="listitem">Set its <strong>Color Tint</strong> to {<code class="literal">150</code>, <code class="literal">255</code>, <code class="literal">255</code>, <code class="literal">255</code>}.</li></ol></div></li></ol></div><p>Click on the<a id="id158" class="indexterm"/> play button. We now have a welcome text that scrolls automatically by changing its Y coordinate inside a clipped Panel. Let's enable the scroll wheel and mouse drag on this scrollable text:</p><div><ol class="orderedlist arabic"><li class="listitem">Select our <strong>Help</strong> GameObject.</li><li class="listitem">Attach a <strong>Drag Object</strong> component to it by navigating to <strong>Component</strong> | <strong>NGUI</strong> | <strong>Interaction</strong>. Then perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Drag our <strong>Label</strong> GameObject from <strong>Help</strong> to the <strong>Target</strong> field.</li><li class="listitem">Set the <strong>Scale</strong> to {<code class="literal">0</code>, <code class="literal">1</code>, <code class="literal">0</code>} to limit to vertical scrolling.</li><li class="listitem">Set the <strong>Scroll Wheel Factor</strong> value to <code class="literal">1</code>.</li><li class="listitem">Check the <strong>Restrict Within Panel</strong> Boolean.</li></ol></div></li></ol></div><p>Click on play. You can now drag the text label manually with either a left-click and drag or the mouse wheel. The <strong>Box Collider</strong> component on the <strong>Help</strong> GameObject detects mouse events, and the <strong>UIDrag Object</strong> reacts accordingly by changing the Y position of our <strong>Label</strong>.</p><p>We had to add a <strong>UIPanel</strong> component to the <strong>Help</strong> GameObject in order to restrict movement within the clipping's bounds.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec27"/>Localization system</h1></div></div></div><p>Now<a id="id159" class="indexterm"/> that we have a complete UI, let's configure the <strong>localization</strong> <strong>system</strong> and<a id="id160" class="indexterm"/> add a pop-up list to change our UI's language.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec44"/>Localization files</h2></div></div></div><p>All our localized text strings must be contained in a <code class="literal">.txt</code> file for each language. For the purpose of this book, we will have English and French, and we will need the <code class="literal">English.txt</code> file and the <code class="literal">French.txt</code> file.</p><p>Let's create<a id="id161" class="indexterm"/> them right now in the following manner:</p><div><ol class="orderedlist arabic"><li class="listitem">Access your project's Assets folder with your file explorer and create a new folder named <code class="literal">Localization</code>.</li><li class="listitem">Inside this new folder, create a new text document named <code class="literal">English.txt</code>.</li><li class="listitem">Duplicate this new <code class="literal">English.txt</code> file and rename it as <code class="literal">French.txt</code>.</li><li class="listitem">Open them both in your favorite IDE or text editor.</li></ol></div><p>Ok, now our localization files are ready to be used with the localization system.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec45"/>Localization component</h2></div></div></div><p>We can <a id="id162" class="indexterm"/>now configure the localization system to work with our UI. We need to have the localization component attached to a GameObject in the scene:</p><div><ol class="orderedlist arabic"><li class="listitem">Select our <strong>GameManager</strong> GameObject and attach a <strong>Localization</strong> component to it by navigating to <strong>Component</strong> | <strong>NGUI</strong> | <strong>Internal</strong>.</li><li class="listitem">In the <strong>Project</strong> view, navigate to Assets | Localization and drag our <code class="literal">English.txt</code> and <code class="literal">French.txt</code> files in the languages array.</li></ol></div><p>The <strong>Starting Language</strong> is set to <strong>English</strong>, and we also have <strong>French</strong> available in the array.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec46"/>Language selection box</h2></div></div></div><p>The next step<a id="id163" class="indexterm"/> is to create a <strong>language selection box</strong> as shown in the following screenshot:</p><div><img src="img/8667OT_03_08.jpg" alt="Language selection box"/></div><p>If we want to see what we're doing, we should first disable the Clipping of our <strong>Container</strong> by setting the <strong>Clipping</strong>
<code class="literal"> </code>parameter in its <strong>UIPanel</strong> to <strong>None</strong>.</p><p>Once the Clipping is disabled, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Select the <strong>Popup</strong> GameObject from <strong>Difficulty</strong>:<div><ol class="orderedlist arabic"><li class="listitem">Check its <strong>Localized</strong> Boolean in <strong>UIPopup List</strong>.</li><li class="listitem">Rename its child <strong>Label</strong> GameObject as <code class="literal">CurrentDifficulty</code>.</li></ol></div></li><li class="listitem">Select and duplicate our <strong>Difficulty</strong> GameObject in <strong>Container</strong>.</li><li class="listitem">Rename the new duplicate as <code class="literal">Language</code>.</li><li class="listitem">Select our new <strong>Background</strong> GameObject in <strong>Language</strong> and set its <strong>Pixel Offset</strong> in <strong>UIAnchor</strong> to {<code class="literal">420</code>, -<code class="literal">90</code>}.<div><div><h3 class="title"><a id="note11"/>Note</h3><p>Sometimes, anchors don't update themselves. You may need to deactivate and then activate the <strong>Language</strong> GameObject for the Label's <strong>UIAnchor</strong> to update.</p></div></div></li><li class="listitem">Select <a id="id164" class="indexterm"/>our <strong>Label</strong> GameObject from <strong>Language</strong> and change its text to <code class="literal">[AAFFFF]Language</code>.</li><li class="listitem">Select our <strong>Popup</strong> GameObject from <code class="literal">Language</code> and perform the following steps:<div><ol class="orderedlist arabic"><li class="listitem">Change the <strong>Options</strong> text value to have the following two options:<div><pre class="programlisting">English
French</pre></div></li><li class="listitem">Set its <strong>Position</strong> to <strong>Below</strong>.</li><li class="listitem">Check the <strong>Localized</strong> Boolean.</li></ol></div></li><li class="listitem">Attach a <strong>Language Selection</strong> component by navigating to <strong>Component</strong> | <strong>NGUI</strong> | <strong>Interaction</strong>.</li><li class="listitem">Rename the <strong>Label</strong>, which is a child of <strong>Popup</strong>, as <code class="literal">CurrentLanguage</code>.</li></ol></div><p>We can now reactivate <strong>Clipping</strong> in <strong>Container</strong> by setting the <strong>Clipping</strong> parameter in its <strong>UIPanel</strong> to <strong>Alpha Clip</strong>. The clipping <strong>Size</strong> has been saved.</p><p>That's it, our localization system is in place, and when the pop-up list changes value, the <code class="literal">Language Selection.cs</code> script automatically changes the localization's <strong>Current Language</strong> value.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec47"/>Localizing a Label</h2></div></div></div><p>We are now<a id="id165" class="indexterm"/> ready to localize our first Label using the <strong>UILocalize</strong> component and a <code class="literal">Key</code> that will define which string to use from our <code class="literal">.txt</code> files. Perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Select our <strong>Label</strong> GameObject from <strong>Title</strong>.</li><li class="listitem">Attach a <strong>Localize</strong> component to it by navigating to <strong>Component</strong> | <strong>NGUI</strong> | <strong>UI</strong>.</li><li class="listitem">Set its <code class="literal">Key</code> parameter by typing <code class="literal">MainMenu</code>.</li><li class="listitem">Switch to our <code class="literal">English.txt</code> localization file and add the following line:<div><pre class="programlisting">MainMenu = [AAFFFF]Main Menu</pre></div></li><li class="listitem">Switch to our <code class="literal">French.txt</code> localization file and add the following line:<div><pre class="programlisting">MainMenu = [AAFFFF]Menu Principal</pre></div></li></ol></div><p>Save both the <code class="literal">.txt</code> files and click on the play button. If you access options and change the language to <strong>French</strong>, our window's title changes from <strong>Main Menu</strong> to <strong>Menu Principal</strong>. <a id="id166" class="indexterm"/>That's because the <strong>UILocalize</strong> component updates the <strong>UILabel</strong> component it's attached to using the string present after the <code class="literal">=</code> in our <code class="literal">.txt</code> localization file. If you exit the play mode, the language will be saved and the UI will be initialized with the last selected language.</p><p>Now, we must add a <strong>UILocalize</strong> component with its specific <code class="literal">Key</code> to every <strong>Label</strong> in the scene, then add a localization string for each of them in both of our <code class="literal">.txt</code> files.</p><p>Don't be afraid; it isn't that long, and it will train you to use the Localization System:</p><div><ol class="orderedlist arabic"><li class="listitem">In the <strong>Hierarchy</strong> view, type <code class="literal">Label</code> inside the search box.</li><li class="listitem">Select all the <strong>Label</strong> GameObjects matching the search by pressing <em>Ctrl</em> + <em>A</em> and attach a <strong>Localize</strong> component to the selection by navigating to <strong>Component</strong> | <strong>NGUI</strong> | <strong>UI</strong>.</li><li class="listitem">Select our <strong>Label</strong> GameObject from <strong>Title</strong> and remove its second <strong>UILocalize</strong> component as it already had one!</li></ol></div><p>Now, all of our <strong>Label</strong> GameObjects have a <strong>UILocalize</strong> component attached to them. One by one, select them and set their <code class="literal">Key</code> parameter based on their text set in the <strong>UILabel</strong> component.</p><p>You must ignore the Labels of <strong>Popup List</strong>; they don't need a <strong>UILocalize</strong> component since we checked their <strong>Localized</strong> Booleans. Simply add localization strings for their <strong>Options</strong> with the same names: <strong>Normal</strong>, <strong>Hard</strong>, <strong>English</strong>, and <strong>French</strong>.</p><div><div><h3 class="title"><a id="note12"/>Note</h3><p>Don't forget to apply the same operations to labels included in our four different powers prefabs: <strong>Time</strong>, <strong>Bomb</strong>, <strong>SelectedTime</strong>, and <strong>SelectedBomb</strong>. New lines (return) are replaced by <code class="literal">\n</code> in the localization files. Colors work identically.</p></div></div><p>When you're done with setting their <code class="literal">Key</code> parameters, switch to our <code class="literal">English.txt</code> file and add every key you need, plus <code class="literal">=</code> followed by the corresponding localized text.</p><p>Now, copy all of these keys declarations and paste them in our <code class="literal">French.txt</code> file and then replace the English words with French words or any other language you choose.</p><p>By the time you're finished, our entire UI will be localized!</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec28"/>Summary</h1></div></div></div><p>In this chapter, we first learned how to set up a draggable panel. Then, we created and configured a drag-and-drop system to select which power we want using the <strong>UIDrag Object</strong> component and the custom code.</p><p>Remember to use the <strong>UIGrid</strong> component often to automatically align objects—they are very powerful when used wisely with <strong>UIAnchor</strong> and <strong>UIStretch</strong> components.</p><p>Using Unity's animations and NGUI's Tweens are no longer a secret for us—we used them to create a smooth apparition for these powers, and we combined them with Clipping to hide/show our Options menu.</p><p>Finally, we created scrollable text and learned how to use the Localization System to set up multiple languages.</p><p>We can now take a look at using C# with NGUI in the next chapter and see what we can accomplish using code.</p></div></body></html>