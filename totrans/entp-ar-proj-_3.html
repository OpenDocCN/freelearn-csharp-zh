<html><head></head><body>
        

                            
                    <h1 class="header-title">AR for Manufacturing with ARCore</h1>
                
            
            
                
<p>In this chapter, we will create our first AR project using Google's ARCore tool. The main goal of this chapter is to introduce you to one of the latest and fastest-growing AR tools, ARCore. By the end of this chapter, you will have gained the necessary skills to create your own ARCore projects easily in Android Studio. At the same time, we present one of the uses of AR in manufacturing, that is, prototyping.</p>
<p>By the end of this chapter, you will have created a prototype viewer app where users will place 3D designs of industrial pieces, machines, and so on over flat surfaces, navigate around and through them, and manipulate them (move, rotate, and scale) with their fingers. With this knowledge, you will also be able to improve the current project and adapt it to your needs in this field.</p>
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li>Using AR for manufacturing</li>
<li>Exploring ARCore</li>
<li>Creating a prototype AR viewer</li>
</ul>


            

            
        
    

        

                            
                    <h1 class="header-title">Technical requirements</h1>
                
            
            
                
<p>The technical requirements for this chapter are as follows:</p>
<ul>
<li>Android Studio (3.5.2 version for Windows in this book).</li>
<li>Java Development Kit (1.8.0 in this book).</li>
<li>Sceneform plugin (installed from inside Android Studio. 1.13.0 in this book).</li>
<li>An ARCore supporting mobile device (see the list here: <a href="https://developers.google.com/ar/discover/supported-devices">https://developers.google.com/ar/discover/supported-devices</a>). The project has been tested on a Samsung Galaxy A5 (2017) and a Pocophone F1.</li>
</ul>
<p>To install the Android Studio, the system requirements for Windows are as follows:</p>
<ul>
<li>4 GB RAM minimum, 8 GB RAM recommended</li>
<li>2 GB of available disk space minimum, 4 GB recommended</li>
<li>1280x800 minimum screen resolution</li>
</ul>
<p>For more details on other operating systems, you can find the official requirements at the end of this page: <a href="https://developer.android.com/studio">https://developer.android.com/studio</a>.</p>
<p>The code files for this chapter can be found here: <a href="https://github.com/PacktPublishing/Enterprise-Augmented-Reality-Projects/tree/master/Chapter03">https://github.com/PacktPublishing/Enterprise-Augmented-Reality-Projects/tree/master/Chapter03</a>.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Using AR for manufacturing</h1>
                
            
            
                
<p>Industry 4.0, also known as the 4th industrial revolution, makes reference to the inclusion of digitalization and interconnectivity tools inside factories, covering production processes to maintenance and training. Although the term has been around for some years now, in the last couple of years, this industry 4.0 concept has taken on a new dimension thanks to the exponential growth (in quality and quantity) of technologies such as <strong>Augmented Reality</strong> (<strong>AR</strong>) and <strong>Virtual Reality</strong> (<strong>VR</strong>), <strong>Internet of Things</strong> (<strong>IoT</strong>), <strong>Big Data Analytics</strong> (<strong>BDA</strong>), <strong>Additive Manufacturing</strong> (<strong>AM</strong>), <strong>Cyber-Physical Systems</strong> (<strong>CPS</strong>), and <strong>Artificial Intelligence</strong> (<strong>AI</strong>).</p>
<p>The visual component of AR makes it the natural interface for users who can receive real-time information about processes, access remote systems for extra data, and control processes and machines, all with a mobile device or smart glasses.</p>
<p>AR in manufacturing has many uses in areas such as prototyping, production, and training. In this chapter, we will cover prototyping and, more specifically, where AR can help reduce costs in prototyping by visualizing a design in the real world. This allows designers, workers, and potential customers to manipulate a model in its three dimensions, scale it, interact with individual parts, and even walk through them together. ARCore is one of the examples of an AR tool that we can use for that.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Exploring ARCore</h1>
                
            
            
                
<p>In preview since 2017, the first version of ARCore was launched in February 2018 and was Google's platform for creating augmented reality applications for Android and iOS. It makes use of different capabilities, such as motion tracking, to estimate the position and orientation of the mobile device regarding the real world along with environmental location, to find and track horizontal surfaces such as the ground, tablets, or walls, and light estimation, to place 3D elements realistically into the real world. A more detailed explanation of these features can be found at <a href="https://developers.google.com/ar/discover/concepts">https://developers.google.com/ar/discover/concepts</a>. Targeted at Android 7.0 and above, not all devices in the market support this technology, although the number has increased greatly since the first SDK version. You can consult the currently supported device list here: <a href="https://developers.google.com/ar/discover/supported-devices">https://developers.google.com/ar/discover/supported-devices</a>.<a href="https://developers.google.com/ar/discover/supported-devices"/></p>
<p>ARCore apps can be developed on different platforms such as Android Studio, Xcode for iOS, Unity3D, and Unreal Engine. When using Android Studio, developers can integrate Sceneform, a 3D engine that helps integrate 3D environments and models in an easier way than the OpenGL library. We will be using this plugin in our project to display 3D models.</p>
<p>When developing an app using ARCore, make sure you disclose it in your app: <a href="https://developers.google.com/ar/distribute/privacy-requirements">https://developers.google.com/ar/distribute/privacy-requirements</a>.</p>
<p>For this project, we will develop a prototype viewing app that will show three different engine models. The engine models that we will be using for this project have been taken from<em> </em><a href="https://sketchfab.com/3d-models/rocket-engines-6fba4dbbb9444e99ba68425bcb3a7f70">https://sketchfab.com/3d-models/rocket-engines-6fba4dbbb9444e99ba68425bcb3a7f70</a>.</p>
<p>Now that we have seen the basics of ARCore, let's start developing the app.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Creating a prototype AR viewer</h1>
                
            
            
                
<p>In this section, we are going to develop our AR viewer for prototyping. First, we are going to install all the required software tools—JDK and Android Studio—and then we'll create our Android application, learn how to enable and use ARCore in it, and how to use the Sceneform plugin to display the 3D elements.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Installing the Java Development Kit (JDK)</h1>
                
            
            
                
<p>Android Studio requires that we install JDK. It's usually located in <kbd>C:\Program Files\Java\jdk_version</kbd>. If you don't have it installed, follow these steps:</p>
<ol>
<li>Go to <a href="http://www.oracle.com">www.oracle.com</a> and download the latest Java SE Development Kit.</li>
<li>Once downloaded, run the installation file and let it install the JDK and JRE in their default folders.</li>
</ol>
<p>If, during Android Studio's installation, it complains about not finding the JDK, you can solve this problem by going to Start menu|Computer|System Properties|Advanced System Properties, opening the Advanced|Environment Variables tab, and creating a <kbd>JAVA_HOME</kbd> system variable pointing to the JDK folder.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Installing Android Studio</h1>
                
            
            
                
<p class="mce-root">Once the JDK is installed, we are going to do the same with Android Studio since it will be our main platform for developing our AR app:</p>
<ol>
<li>Download Android Studio from Android's developer page: <a href="https://developer.android.com/studio">https://developer.android.com/studio</a>.</li>
<li>Install the studio with the default values and when you're finished, run it:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1076 image-border" src="img/dccd2716-4de1-42c2-a482-5fc641eb5408.png" style="width:26.50em;height:20.50em;"/></p>
<p>Launching Android Studio when the installation finishes</p>
<ol start="3">
<li>The first time you open it after installation, the Android Studio setup wizard will launch to help you configure the last steps of the studio and download the Android SDK components:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1783 image-border" src="img/a9aeb208-996e-44bd-999b-8c1e8a1abaf0.png" style="width:61.00em;height:32.58em;"/></p>
<p>The setup wizard will appear the first time Android Studio is installed</p>
<ol start="4">
<li>Once finished, the Welcome window will be launched:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1957 image-border" src="img/e3b800d1-fcdb-4c3e-a672-d6d70ad8843e.png" style="width:45.25em;height:34.92em;"/></p>
<p>Android Studio Welcome window</p>
<p>Now that we have the software ready, we can start developing our app.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Creating the application</h1>
                
            
            
                
<p>Now that we have the software installed, we are going to start creating our AR app. The first thing we have to do is launch a new Android Studio project and add the required libraries to it. Follow these steps to do so:</p>
<ol>
<li>Click on Start a new Android Studio project.</li>
<li>Choose to create an Empty Activity:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1785 image-border" src="img/7388c166-3608-46fc-8db5-514f5c76921e.png" style="width:74.83em;height:55.00em;"/></p>
<p>Choosing an activity type</p>
<ol start="3">
<li>Give the project a Name, Package name, and Location. Set the Minimum API level to at least API 24: Android 7.0 (Nougat) since it's the first that supports ARCore. Click on the Finish button to start the project:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1786 image-border" src="img/b0db9ea2-4afd-4e9e-a30f-5e44b9530eae.png" style="width:55.50em;height:45.33em;"/></p>
<p>Configuration parameters for the new project</p>
<p>The next thing we need to do is enable ARCore in our project.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Enabling ARCore</h1>
                
            
            
                
<p>In an AR project, ARCore can be set as optional or required. The former can work as a regular app on devices that don't support ARCore, while the latter will only appear in the Google Play Store to devices that support ARCore. Our app is a full AR application, so we will select the second option. To achieve this we have to modify some of the project files. Let's get started:</p>
<ol>
<li>In the project window, unfold <kbd>app</kbd> and inside the <kbd>manifests</kbd> folder, open the <kbd>AndroidManifest.xml</kbd> file, as shown in the following screenshot. If you want to open the manifest externally you can find the file in <kbd>app/src/main</kbd> folder:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="img/b89406c3-d05e-495e-985b-c7b44a6cdcd8.png"/></p>
<p>AndroidManifest.xml in the project</p>
<ol start="2">
<li>Add the following lines before the <kbd>&lt;application&gt;</kbd> tag:</li>
</ol>
<pre style="padding-left: 60px">&lt;uses-permission android:name="android.permission.CAMERA" /&gt;<br/>&lt;uses-feature android:name="android.hardware.camera.ar" /&gt; </pre>
<p style="padding-left: 60px">The first line is necessary in both cases (ARCore is optional and required) since it's the one giving permission to open the camera. The second line indicates the use of ARCore and is the one ensuring that only devices that support ARCore will have access to the app.</p>
<ol start="3">
<li>Now, add the following line inside <kbd>&lt;application&gt;</kbd>:</li>
</ol>
<pre style="padding-left: 60px">&lt;application<br/>    ...<br/>    &lt;meta-data android:name="com.google.ar.core" android:value="required" /&gt;<br/>&lt;/application&gt;</pre>
<p style="padding-left: 60px">This line sets ARCore as required and will make the Google Play Store download and install ARCore (if it's not already installed) when the app is installed.</p>
<ol start="4">
<li>Open your project's <kbd>build.gradle</kbd> file:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1082 image-border" src="img/8a447dba-b8ea-48b6-b835-237a067a6f82.png" style="width:24.67em;height:23.00em;"/></p>
<p>The project's build.gradle file in the Project window</p>
<ol start="5">
<li>Make sure it includes Google's Maven repository (it should be there; if not, add it):</li>
</ol>
<pre style="padding-left: 60px">allprojects {<br/>    repositories {<br/>        google()</pre>
<ol start="6">
<li>Open your app's<strong> </strong><kbd>build.gradle</kbd> file:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1083 image-border" src="img/7edbb9cd-aa8a-48af-9952-a804e085db24.png" style="width:24.92em;height:23.92em;"/></p>
<p>The app's build.gradle file in the Project window</p>
<ol start="7">
<li>Now, add the latest ARCore library as a dependency (1.13.0, in this book):</li>
</ol>
<pre style="padding-left: 60px">dependencies {<br/>    ...<br/>    implementation 'com.google.ar:core:1.13.0'<br/>    ...<br/>}</pre>
<ol start="8">
<li>Synchronize Gradle in order for these changes to be effective by clicking on Sync Now, which can be found at the top right of the screen:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1958 image-border" src="img/24125073-9e11-45de-91c4-3ed7d109c492.png" style="width:67.75em;height:43.67em;"/></p>
<p>Sync Now option to sync the project</p>
<p>If you intend to create an app that works both with and without AR, the steps to follow to enable ARCore will differ from the ones shown here. Please refer to <a href="https://developers.google.com/ar/develop/java/enable-arcore">https://developers.google.com/ar/develop/java/enable-arcore</a> to see what changes you have to make. Also, take into account that you will have to check whether the mobile running the app supports ARCore. You can do this by looking at your code.</p>
<p>Now that we have ARCore enabled, let's introduce Sceneform.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Adding Sceneform to the project</h1>
                
            
            
                
<p>As we mentioned at the beginning of this chapter, Sceneform is an Android Studio plugin that will help us display 3D models in an easier and faster way than OpenGL.</p>
<p>Sceneform also provides ARFragment and other UX resources that will automatically handle the AR session after asking for the camera permission and checking if ARCore is installed and updated, without us having to include these verifications in our code.</p>
<p>At the time of writing this book, the Sceneform Tools were still in Beta mode. If you encounter any problems when following these steps, please head to their GitHub page (<a href="https://github.com/google-ar/sceneform-android-sdk">https://github.com/google-ar/sceneform-android-sdk</a>) for more information.</p>
<p>To import Sceneform into your project, follow these steps:</p>
<ol>
<li>Open File|Settings.</li>
<li>In the Plugins tab, search for <kbd>Google Sceneform Tools (Beta)</kbd>. At the time of writing this book, the current version is v1.13.0:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1551 image-border" src="img/3abcc81e-c5ce-4d32-b22c-a0d1f10a5573.png" style="width:78.42em;height:44.17em;"/></p>
<p>Google Sceneform Tools plugin</p>
<ol start="3">
<li>Install it and press Restart IDE on the top right to activate the changes:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1552 image-border" src="img/97935c7d-81a0-4f0b-b0c8-b2da612c421b.png" style="width:59.92em;height:12.00em;"/></p>
<p>Restart IDE button</p>
<ol start="4">
<li>Once installed, open your app's <kbd>build.gradle</kbd> file and add the following compile options <em>inside </em>the <kbd>android</kbd> section. If we don't, when building our <kbd>ModelRenderable</kbd>, errors will appear. This is only necessary if <kbd>minSdkVersion &lt; 26</kbd> and we set the minimum to <kbd>24</kbd> (Android 7.0) when creating the project:</li>
</ol>
<pre style="padding-left: 60px">android {<br/>    ...<br/>    compileOptions {<br/>        sourceCompatibility JavaVersion.VERSION_1_8<br/>        targetCompatibility JavaVersion.VERSION_1_8<br/>    }<br/>}</pre>
<ol start="5">
<li>In the same file, inside the <kbd>dependencies</kbd> brackets, we are going to add the following <kbd>implementation</kbd> line to include Sceneform in our project:</li>
</ol>
<pre style="padding-left: 60px">dependencies {<br/>    ...<br/>    implementation 'com.google.ar.sceneform.ux:sceneform-ux:1.13.0'<br/>    ...<br/>}</pre>
<ol start="6">
<li>Your app's <kbd>build.gradle</kbd> file should now look similar to this:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1788 image-border" src="img/fcc17b1f-d0f4-4132-ac62-174b5937f5b4.png" style="width:65.42em;height:54.50em;"/></p>
<p>The app's build.gradle file with the new lines added to it</p>
<ol start="7">
<li>Now, to use ARFragment in your app, open the <kbd>activity_main.xml</kbd> file in the <kbd>res/layout</kbd> folder and select Text mode at the bottom tabs of the view. By doing this, you can modify the elements in the text:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1789 image-border" src="img/74f58d58-f2a9-4e2d-bfd3-93701e610be5.png" style="width:112.75em;height:40.08em;"/></p>
<p>The activity_main.xml file's text view and visual preview</p>
<ol start="8">
<li>Remove the <kbd>TextView</kbd> block and add the following:</li>
</ol>
<pre style="padding-left: 30px">&lt;fragment android:name="com.google.ar.sceneform.ux.ArFragment"<br/>    android:id="@+id/ux_fragment"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="match_parent" /&gt;</pre>
<p>Sceneform is now ready to be used. Let's import our 3D model into the project.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Adding 3D models to the project</h1>
                
            
            
                
<p>3D models, also called renderables, can be added in different ways:</p>
<ul>
<li>Created from basic shapes (sphere, cube, and so on) and materials and combined programmatically to generate more complex objects.</li>
<li>Created from standard Android widgets via ViewRenderable. They are rendered as interactive flat cards in the scene.</li>
<li>Imported from other programs as 3D assets. The supported formats include OBJ, FBX, and glTF (and glb). Animations are only supported in FBX.</li>
</ul>
<p>We are going to use the first option and import a <kbd>.obj</kbd> file using Sceneform.</p>
<p>To import a model into our project, we have to create an external folder to contain the model (this folder won't be compiled into the final app) and then import the model into the project using Sceneform. Follow these steps to do so:</p>
<ol>
<li>Create a <kbd>sampledata</kbd> folder in your project by right-clicking on the <kbd>app</kbd> folder of your project and selecting New|Sample Data Directory.</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1544 image-border" src="img/2d173a00-28b2-4826-aca6-6763150e94b2.png" style="width:69.58em;height:15.50em;"/></p>
<p>Adding a Sample Data Directory to the project</p>
<p>If the <kbd>sampledata</kbd> folder doesn't appear automatically on your project, you can also create it manually from the file explorer, inside the <kbd>app</kbd> folder of your project. Call it <kbd>sampledata</kbd> and it will appear in Android Studio.</p>
<ol start="2">
<li>From the resources pack provided for this project, copy the <kbd>engine</kbd> folder into the <kbd>sampledata</kbd> folder:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1088 image-border" src="img/2c973174-7c2b-4bab-97b1-8162f71ff8f0.png" style="width:19.92em;height:14.83em;"/></p>
<p>The newly added engine folder containing the model and its resources</p>
<p style="padding-left: 60px">Now, we will import the <kbd>.obj</kbd> file through Sceneform to include the 3D model as an asset.</p>
<ol start="3">
<li>Right-click the <kbd>engine.obj</kbd> file and select Import Sceneform Asset:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1089 image-border" src="img/d6d187b6-0635-4ecd-8508-b68e111d9264.png" style="width:23.67em;height:9.42em;"/></p>
<p>Selecting Import Sceneform Asset for our .obj file</p>
<ol start="4">
<li>Leave the default values as they are. This will create a Sceneform asset (<kbd>.sfa</kbd>) file inside <kbd>sampledata</kbd> and a Sceneform binary asset (<kbd>.sfb</kbd>) inside the <kbd>assets</kbd> folder:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1090 image-border" src="img/fae1677b-446e-4c9c-8a96-3f81e7973398.png" style="width:33.67em;height:22.42em;"/></p>
<p>Default import values for the model</p>
<p style="padding-left: 60px">During the importing process, the following lines will automatically be added to the end of your app's <kbd>build.gradle</kbd> by Sceneform:</p>
<pre style="padding-left: 60px">sceneform.asset('sampledata/engine/engine.obj',<br/>        'default',<br/>        'sampledata/engine/engine.sfa',<br/>        'src/main/assets/engine')</pre>
<ol start="5">
<li>Leave Gradle syncing. When it finishes, two windows will open: a text file with the model's description and its 3D preview:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1790 image-border" src="img/1205c2d5-e07d-43a0-8da5-bb01ca037249.png" style="width:98.17em;height:50.58em;"/></p>
<p>Our newly imported model's text view and preview</p>
<p>The final step will be to merge all the elements into the AR scene.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Forming the AR scene</h1>
                
            
            
                
<p>Now that we have ARCore and Sceneform enabled and our 3D model included in the project, let's add the code that will make the model appear on the screen when a flat surface is detected and the user taps on the screen. Let's get started:</p>
<ol>
<li>Open your <kbd>MainActivity.java</kbd> file from <kbd>app/java/com.banana.arprototype</kbd> and add the following imports:</li>
</ol>
<pre style="padding-left: 60px">import android.net.Uri;<br/>import android.view.Gravity;<br/>import android.view.MotionEvent;<br/>import android.widget.Toast;<br/>import com.google.ar.core.Anchor;<br/>import com.google.ar.core.HitResult;<br/>import com.google.ar.core.Plane;<br/>import com.google.ar.sceneform.AnchorNode;<br/>import com.google.ar.sceneform.rendering.ModelRenderable;<br/>import com.google.ar.sceneform.ux.ArFragment;<br/>import com.google.ar.sceneform.ux.TransformableNode;</pre>
<ol start="2">
<li>Inside our class, create the following variables to control the AR scene and the 3D model:</li>
</ol>
<pre style="padding-left: 60px">private ArFragment arFragment;<br/>private ModelRenderable modelRenderable;</pre>
<ol start="3">
<li>Now, inside the <kbd>OnCreate()</kbd> method, add the <kbd>ARFragment</kbd> initialization:</li>
</ol>
<pre style="padding-left: 60px">protected void onCreate(Bundle savedInstanceState) {<br/>    ...<br/>    arFragment = (ArFragment) getSupportFragmentManager().findFragmentById(R.id.ux_fragment);</pre>
<ol start="4">
<li>Still inside the <kbd>OnCreate()</kbd> method, build the model in the scene using <kbd>ModelRenderable</kbd>, as shown in the following code:</li>
</ol>
<pre style="padding-left: 60px">ModelRenderable.builder()<br/>        .setSource(this, Uri.parse("engine.sfb"))<br/>        .build()<br/>        .thenAccept(renderable -&gt; modelRenderable = renderable)<br/>        .exceptionally(<br/>                throwable -&gt; {<br/>                    Toast toast = Toast.makeText(this, "Unable to <br/>                    load the model", Toast.LENGTH_LONG);<br/>                    toast.setGravity(Gravity.CENTER, 0, 0);<br/>                    toast.show();<br/>                    return null;<br/>                });</pre>
<p style="padding-left: 60px">Here, we call the model from the <kbd>assets</kbd> folder using <kbd>Uri.parse</kbd>. It will launch an error message if it's unable to load it.</p>
<ol start="5">
<li>Finally, still in the <kbd>OnCreate()</kbd> method, we will place the model when the user taps the screen after a planar surface has been detected:</li>
</ol>
<pre style="padding-left: 60px">arFragment.setOnTapArPlaneListener(<br/> (HitResult hitResult, Plane plane, MotionEvent motionEvent) -&gt; {<br/> if (modelRenderable == null) <br/> return;<br/><br/> Anchor anchor = hitResult.createAnchor();<br/> AnchorNode anchorNode = new AnchorNode(anchor);<br/> anchorNode.setParent(arFragment.getArSceneView().getScene());<br/><br/> TransformableNode model = new TransformableNode(arFragment.getTransformationSystem());<br/> model.setParent(anchorNode);<br/> model.setRenderable(modelRenderable);<br/> model.select();<br/> });</pre>
<p style="padding-left: 60px">Here, when the user taps on a plane and the model renderable has been successfully loaded, an anchor is created to keep the model in place. Then, a new node for the model is created and attached to it.</p>
<ol start="6">
<li>Now, you can run the app either in an Android emulator or on an actual device. To run it in an emulator, the device must meet some requirements, and you will have to download ARCore from the Play Store manually on it (take a look at the <em>Prepare your device or emulator</em> section at <a href="https://developers.google.com/ar/develop/java/quickstart">https://developers.google.com/ar/develop/java/quickstart</a>). Here, we will directly run the app in our device by clicking on the play icon and then selecting our connected device:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1791 image-border" src="img/682f9f26-75a7-4c5e-a687-fb679e564bf6.png" style="width:44.50em;height:19.83em;"/></p>
<p>Running the app in a physical device</p>
<ol start="7">
<li>With this, the app will be installed on the mobile device. As we mentioned previously, the first time the app is run, it will check whether the latest ARCore version has been installed:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1792 image-border" src="img/e62dc7fa-a0e8-462d-89d2-a42e8e146783.png" style="width:40.92em;height:5.75em;"/></p>
<p>ARCore checking for the latest version of ARCore</p>
<ol start="8">
<li>You will have to install it through Google Play:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1094 image-border" src="img/b57b02ba-80b0-45be-b266-13a8fc0db1d4.png" style="width:31.67em;height:21.67em;"/></p>
<p>Installing the ARCore app</p>
<ol start="9">
<li>Once this initial step has been completed, you will be able to finish launching the app. Move the phone/tablet until a flat surface is detected:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1545 image-border" src="img/0a2e5991-d2bf-49e6-8763-ad40600294ba.png" style="width:150.42em;height:89.58em;"/></p>
<p>The white dots form the plane surface where we can place the 3D objects</p>
<ol start="10">
<li>Tap on the screen to anchor your model:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1546 image-border" src="img/58d69432-1376-41f7-b26a-8b9ee96c9116.png" style="width:18.17em;height:35.42em;"/> </p>
<p>The engine will appear standing in front of the camera</p>
<ol start="11">
<li>You can also resize, rotate, and move the model with your fingers while moving around it to see it from different angles. If you tap again, a new engine will appear:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1547 image-border" src="img/b51e550a-f4c0-4bdf-bb3f-20f96c1c3f0e.png" style="width:21.83em;height:41.08em;"/></p>
<p>Tapping multiple times causes multiple instances</p>
<p>Play around with the app and get comfortable with using it. You will see that, depending on the capacity of the device, the recognition of a flat surface will be faster/slower. You will also see that if you rotate the device (portrait/landscape), the model will disappear because the anchor is lost. Therefore, now that we have the basic setup, we are going to make some changes to improve the overall performance and give the user the option to add more models to the current scene.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Improving the basic app</h1>
                
            
            
                
<p>Once we have the basic app ready, there are some things we can do to improve the overall working of the app:</p>
<ul>
<li>Make the screen orientation fixed. If we leave it in auto-rotation mode, rotating the screen will cause the phone to lose the anchor and the model will disappear from the screen.</li>
<li>So far, we have seen that, for each screen tap, a new model appears. Since we are using the app for prototyping, the idea is that only one model is shown. </li>
<li>We will also change the rotation and size of the model so that it's displayed better in the scene.</li>
</ul>
<p>Let's change the code to add these features. For that, follow these steps:</p>
<ol>
<li> Force the screen orientation so that it's in portrait mode by adding <kbd>AndroidManifest.xml</kbd> inside <kbd>&lt;application&gt;</kbd> and <kbd>&lt;activity&gt;</kbd>:</li>
</ol>
<pre style="padding-left: 60px">&lt;activity android:name=".MainActivity" android:screenOrientation="portrait"&gt;</pre>
<p style="padding-left: 60px">This way, the screen will always be in portrait mode and won't autorotate and lose the anchor, even if the user rotates the phone by mistake.</p>
<ol start="2">
<li>If you are using a tablet or prefer to see the scene in landscape mode, change this to the following: </li>
</ol>
<pre style="padding-left: 60px">&lt;activity android:name=".MainActivity" android:screenOrientation="landscape"&gt;</pre>
<ol start="3">
<li>To display only one model for each tap on the screen, open <kbd>MainActivity.java</kbd> and create the following variables after the <kbd>ArFragment</kbd> and <kbd>ModelRenderable</kbd> variables:</li>
</ol>
<pre style="padding-left: 60px">private Anchor anchor;<br/>private AnchorNode anchorNode;<br/>private TransformableNode model;</pre>
<ol start="4">
<li>Then, inside <kbd>setOnTapArPlaneListener()</kbd>, add the following lines after the <kbd>modelRenderable = null</kbd> check and before creating a new anchor, so that the previous one is released:</li>
</ol>
<pre style="padding-left: 60px">protected void onCreate(Bundle savedInstanceState) {<br/>    ...<br/>    arFragment.setOnTapArPlaneListener(<br/>            (HitResult hitResult, Plane plane, MotionEvent motionEvent) -&gt; {<br/>                if (modelRenderable == null)<br/>                    return;<br/><br/>                //Remove previous anchor<br/>                if (anchor != null)<br/>                {<br/>                    arFragment.getArSceneView().getScene().removeChild(anchorNode);<br/>                    anchor.detach();<br/>                    anchorNode.setParent(null);<br/>                    anchorNode = null;<br/>                }</pre>
<p style="padding-left: 60px">This way, when the users tap on different places of the screen, the model will <em>move</em> from one place to the next one, instead of appearing duplicated in each one.</p>
<ol start="5">
<li>Now, remove the definition part of the <kbd>Anchor</kbd>, <kbd>AnchorNode</kbd>, and <kbd>TransformableNode</kbd> from the lines that follow, so that they make reference to the global variables:</li>
</ol>
<pre style="padding-left: 60px">anchor = hitResult.createAnchor();<br/>anchorNode = new AnchorNode(anchor);<br/>...<br/>model = new TransformableNode(arFragment.getTransformationSystem());</pre>
<ol start="6">
<li>Finally, to rotate and scale the model, start by adding the following imports to the <kbd>MainActivity.java</kbd> file:</li>
</ol>
<pre style="padding-left: 60px">import com.google.ar.sceneform.math.Quaternion;<br/>import com.google.ar.sceneform.math.Vector3;</pre>
<ol start="7">
<li>Inside the <kbd>arFragment.setOnTapArPlaneListener()</kbd> method, add the following code before <kbd>setParent()</kbd>:</li>
</ol>
<pre style="padding-left: 60px">model.setLocalScale(new Vector3(0.55f, 0.55f, 0.55f));<br/>model.setLocalRotation(Quaternion.eulerAngles(new Vector3(-90,45,0)));</pre>
<p style="padding-left: 60px">With this, the model will appear lying down on one side so that we can see the inside of it. This can be seen in the following image:</p>
<div><img class="aligncenter size-full wp-image-1548 image-border" src="img/80820c00-bd54-4bbf-9372-534ba7bdd36e.png" style="width:18.33em;height:31.17em;"/></div>
<p>The engine in a rotated state</p>
<p>Now that we have improved on the basics, let's add two more prototypes and a simple UI so that we can switch between them. Follow these steps to do so:</p>
<ol>
<li>From the <kbd>resources</kbd> folder of this project, copy the <kbd>engine2</kbd> and <kbd>engine3</kbd> folders into the <kbd>sampledata</kbd> folder.</li>
<li>Right-click on each of the <kbd>.obj</kbd> files and select Import Sceneform Asset to create the <kbd>.sfa</kbd> and <kbd>.sfb</kbd> files. Your <kbd>sampledata</kbd> folder should now look like this:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1095 image-border" src="img/ea6e7892-2f95-4e26-a83c-e8b67e00882a.png" style="width:14.83em;height:27.08em;"/></p>
<p>The sampledata folder with the new models</p>
<p style="padding-left: 60px">Your <kbd>assets</kbd> folder should have the three binary files for the models:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1096 image-border" src="img/8fc0368c-684f-466e-960a-0616fd143a9b.png" style="width:12.58em;height:6.92em;"/></p>
<p>The assets folder with the three binary files</p>
<p class="mce-root"/>
<ol start="3">
<li>From the <kbd>resources</kbd> folder of this project, copy the three images corresponding to each of the engines into the <kbd>res</kbd>|<kbd>drawable</kbd> folder:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1099 image-border" src="img/08d372a7-7f26-4007-98e4-0768928cf26b.png" style="width:18.33em;height:17.33em;"/></p>
<p>The res|drawable folder containing the new images</p>
<ol start="4">
<li>Open the <kbd>activity_main.xml</kbd> file located in res|layout in Text mode and add the following code:</li>
</ol>
<pre style="padding-left: 60px">&lt;LinearLayout<br/>    android:orientation="horizontal"<br/>    android:paddingLeft="4dp"<br/>    android:paddingTop="15dp"<br/>    android:paddingRight="4dp"<br/>    android:paddingBottom="1dp"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="wrap_content"<br/>    app:layout_constraintBottom_toBottomOf="@+id/ux_fragment"&gt;</pre>
<p style="padding-left: 60px">Here, we're using <kbd>layout_constraintBottom_toBottomOf</kbd> to anchor it to the bottom of the screen.</p>
<ol start="5">
<li>If you are in landscape mode, you will probably want to locate the buttons on the right-hand side of the screen so that you have more space to play around. Make the following changes to the preceding code to do so:</li>
</ol>
<pre style="padding-left: 60px">&lt;LinearLayout<br/>    android:orientation="vertical"<br/>    ...<br/>    android:layout_width="wrap_content"<br/>    android:layout_height="match_parent"<br/>    app:layout_constraintRight_toRightOf="@+id/ux_fragment"&gt;</pre>
<ol start="6">
<li>Now, add the three buttons:</li>
</ol>
<pre style="padding-left: 60px">&lt;ImageButton<br/>    android:id="@+id/engine1_button"<br/>    android:layout_width="wrap_content"<br/> android:layout_height="wrap_content"<br/> android:layout_margin="10dp"<br/>    android:src="img/engine1"<br/>    android:background="#7cc53a"<br/>    android:layout_weight="1.0"/&gt;<br/><br/>&lt;ImageButton<br/>    android:id="@+id/engine2_button"<br/>    android:layout_width="wrap_content"<br/>    android:layout_height="wrap_content"<br/>    android:layout_margin="10dp"<br/>    android:src="img/engine2"<br/>    android:background="#40000000"<br/>    android:layout_weight="1.0" /&gt;<br/><br/>&lt;ImageButton<br/>    android:id="@+id/engine3_button"<br/>    android:layout_width="wrap_content"<br/>    android:layout_height="wrap_content"<br/>    android:layout_margin="10dp"<br/>    android:src="img/engine3"<br/>    android:background="#40000000"<br/>    android:layout_weight="1.0" /&gt;</pre>
<p style="padding-left: 60px">The first button has a green background (selected), while the other two have a semi-transparent background. Each of them has its corresponding image from <kbd>res</kbd>|<kbd>drawable</kbd>.</p>
<ol start="7">
<li>Finally, add the closing tag for <kbd>LinearLayout</kbd>:</li>
</ol>
<pre style="padding-left: 60px">&lt;/LinearLayout&gt;</pre>
<ol start="8">
<li>The preview should look similar to the following:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1793 image-border" src="img/736db7c1-8415-4c63-90c8-ae8fa9fdc617.png" style="width:84.50em;height:58.50em;"/></p>
<p>The activity_main.xml file's code on the left and the preview on the right in Portrait mode</p>
<ol start="9">
<li>By default, the Preview is in Portrait mode. To change it to Landscape click on the rotating phone icon and select Landscape:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1794 image-border" src="img/2f6f608d-a904-4bd1-94c8-ea6a3a7f5953.png" style="width:83.25em;height:58.25em;"/></p>
<p>The activity_main.xml file's code on the left and the preview on the right in Landscape mode</p>
<ol start="10">
<li>Open the <kbd>MainActivity.java</kbd> file again and add the following libraries:</li>
</ol>
<pre style="padding-left: 60px">import android.widget.ImageButton;<br/>import android.view.View;</pre>
<ol start="11">
<li>Add three new <kbd>modelRenderables</kbd> below the preceding code:</li>
</ol>
<pre style="padding-left: 60px">private ModelRenderable modelRenderable2;<br/>private ModelRenderable modelRenderable3;<br/>private ModelRenderable currentRenderable;</pre>
<p style="padding-left: 60px">We will use <kbd>currentRenderable</kbd> to find out which renderable is active every moment.</p>
<ol start="12">
<li>Now, add three new image buttons at the end of the variables:</li>
</ol>
<pre style="padding-left: 60px">private ImageButton button1;<br/>private ImageButton button2;<br/>private ImageButton button3;</pre>
<ol start="13">
<li>Copy <kbd>ModelRenderable.builder()</kbd> and paste it <em>twice</em> to build the two new models.</li>
<li>Change their <kbd>Uri.parse</kbd> calls to <kbd>engine2.sfb</kbd> and <kbd>engine3.sfb</kbd>, respectively.</li>
<li>In the <kbd>.thenAccept</kbd> call, change the name of the <kbd>renderables</kbd> to the corresponding ones. The resulting code should look like this:</li>
</ol>
<pre style="padding-left: 60px">ModelRenderable.builder()<br/>        .setSource(this, Uri.parse("engine2.sfb"))<br/>        .build()<br/>        .thenAccept(renderable -&gt; modelRenderable2 = renderable)<br/>        .exceptionally(<br/>                throwable -&gt; {<br/>                    Toast toast = Toast.makeText(this, "Unable to load andy renderable", Toast.LENGTH_LONG);<br/>                    toast.setGravity(Gravity.CENTER, 0, 0);<br/>                    toast.show();<br/>                    return null;<br/>                });<br/><br/>ModelRenderable.builder()<br/>        .setSource(this, Uri.parse("engine3.sfb"))<br/>        .build()<br/>        .thenAccept(renderable -&gt; modelRenderable3 = renderable)<br/>        .exceptionally(<br/>                throwable -&gt; {<br/>                    Toast toast = Toast.makeText(this, "Unable to load andy renderable", Toast.LENGTH_LONG);<br/>                    toast.setGravity(Gravity.CENTER, 0, 0);<br/>                    toast.show();<br/>                    return null;<br/>                });</pre>
<ol start="16">
<li>In the first <kbd>ModelRenderable.builder()</kbd>, modify the <kbd>.thenAccept</kbd> call:</li>
</ol>
<pre style="padding-left: 60px">.thenAccept(renderable -&gt; currentRenderable = modelRenderable = renderable)</pre>
<p style="padding-left: 60px">Here, we're assigning <kbd>currentRenderable</kbd> to the first <kbd>renderable</kbd>. This way, the initial model that appears on the screen will be the first engine (remember that we have the first button highlighted as the selected one).</p>
<ol start="17">
<li>Finally, in the <kbd>setOnTapArListener()</kbd> method, change <kbd>modelRenderable</kbd> to <kbd>currentRenderable</kbd>:</li>
</ol>
<pre style="padding-left: 60px">if (currentRenderable == null)<br/>    return;<br/>...<br/>model.setRenderable(currentRenderable);</pre>
<ol start="18">
<li>To add the button's activities, we are going to make our <kbd>MainActivity</kbd> implement <kbd>OnClickListener</kbd>:</li>
</ol>
<pre style="padding-left: 60px">public class MainActivity extends AppCompatActivity implements View.OnClickListener</pre>
<ol start="19">
<li>This way, we can simplify our buttons initialization like so, at the bottom of the <kbd>onCreate()</kbd> method:</li>
</ol>
<pre style="padding-left: 60px">button1 = findViewById(R.id.engine1_button);<br/>button2 = findViewById(R.id.engine2_button);<br/>button3 = findViewById(R.id.engine3_button);<br/><br/>button1.setOnClickListener(this);<br/>button2.setOnClickListener(this);<br/>button3.setOnClickListener(this);</pre>
<p style="padding-left: 60px">The first three lines initialize our buttons and the next three make a call (the same call in all three cases) when the user clicks on them.</p>
<ol start="20">
<li>To receive these clicks, create the <kbd>onClick()</kbd> method: </li>
</ol>
<pre style="padding-left: 60px">@Override<br/>public void onClick(View view)<br/>{<br/>    switch (view.getId()) {<br/>        case R.id.engine1_button:<br/>            currentRenderable = modelRenderable;<br/>            button1.setBackgroundColor(0xFFA4FF50);<br/>            button2.setBackgroundColor(0x40000000);<br/>            button3.setBackgroundColor(0x40000000);<br/>            break;<br/>        case R.id.engine2_button:<br/>            currentRenderable = modelRenderable2;<br/>            button1.setBackgroundColor(0x40000000);<br/>            button2.setBackgroundColor(0xFFA4FF50);<br/>            button3.setBackgroundColor(0x40000000);<br/>            break;<br/>        case R.id.engine3_button:<br/>            currentRenderable = modelRenderable3;<br/>            button1.setBackgroundColor(0x40000000);<br/>            button2.setBackgroundColor(0x40000000);<br/>            button3.setBackgroundColor(0xFFA4FF50);<br/>            break;<br/>    }<br/>    model.setRenderable(currentRenderable);<br/>}</pre>
<p style="padding-left: 60px">This method will assign a different <kbd>modelRenderable</kbd> to the <kbd>currentRenderable</kbd> and highlight its corresponding button, depending on which button has been pressed, after the <kbd>onCreate()</kbd>. The last line swaps the current visible model to the newly selected one.</p>
<ol start="21">
<li>Run the app and try the three different engines. Just select one of the engines and place it on the floor or a desk. The following image shows the yellow engine on the floor:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1549 image-border" src="img/fca9bca2-f08a-4ff0-9df2-198ac0192f22.png" style="width:14.00em;height:28.33em;"/> </p>
<p>Engine 2 is in view in the scene</p>
<ol start="22">
<li>To change the engine, just press another button and the current model will change. You can also find another spot and click on it to make it appear:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1550 image-border" src="img/71b4f55c-cbd9-49e5-9071-7b3df104781e.png" style="width:19.67em;height:39.00em;"/></p>
<p>Engine 3 appearing on the surface</p>
<p>In this section, you have learned how to create a simple interface to change the models that appear in AR. With this, you now have the basic skills to go further and build more complex apps so that you can show and manipulate your own prototypes.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Summary</h1>
                
            
            
                
<p>In this chapter, we have made an introduction to AR using Google's ARCore to create a prototype viewer app. We learned how to integrate the capabilities of ARCore and the Sceneform library to make the task of generating an AR scene easier and we have included our own external 3D models. We also created a basic UI that allows us to switch between different models.</p>
<p>Now, you have the skills to create your own application with ARCore. You can improve the current project by adding your own prototype, or prototype pieces, make the model break down into smaller pieces when the user presses a button, or change the color of the model with another button. This chapter has given you the basis to explore the possibilities of AR that's displayed on flat surfaces.</p>
<p>You also have a better knowledge of how AR can be useful in the manufacturing field and you can explore the further possibilities it offers beyond the example that's been provided here.</p>
<p>In the chapters that follow, we will explore other AR tools and technologies. Some of them will be related to ARCore, such as WebAR, while others will be completely different, such as Augmented Class!, EasyAR, and Vuforia.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Further reading</h1>
                
            
            
                
<p>If you want to go further with the project we completed in this chapter, we recommend that you explore the following options:</p>
<p class="mce-root"/>
<ul>
<li>AR images: Instead of placing objects on surfaces, you can attach them to physical images (pictures, planes, and so on). You can find a starting point on how this works at <a href="https://developers.google.com/ar/develop/java/augmented-images/">https://developers.google.com/ar/develop/java/augmented-images/</a>.</li>
<li>Explore the available samples using Sceneform, you will only have to download and open them with Android Studio: <a href="https://developers.google.com/ar/develop/java/sceneform/samples">https://developers.google.com/ar/develop/java/sceneform/samples</a>.</li>
<li>In <a href="54a1260e-a741-4eb5-9c98-01350fcba94b.xhtml">Chapter 2</a>, <em>Introduction to Unity for AR Development</em>, we introduced Unity 3D. ARCore can be used inside the Unity platform, which also makes the process of adding 3D models easier. It also accepts a greater number of extensions. You can find more information about how to get started here: <a href="https://developers.google.com/ar/develop/unity/quickstart-android">https://developers.google.com/ar/develop/unity/quickstart-android</a>.</li>
</ul>


            

            
        
    </body></html>