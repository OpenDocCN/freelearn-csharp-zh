<html><head></head><body>
<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch02" class="calibre1"/>Chapter 2. Hello, Platforms!</h1></div></div></div><p class="calibre8">If you are familiar with developing applications using Visual Studio on Windows, then using Xamarin Studio should be very straightforward. Xamarin uses the same concept of a <strong class="calibre2">solution</strong> <a id="id43" class="calibre1"/>containing one or more<a id="id44" class="calibre1"/> <strong class="calibre2">projects</strong>, and it has created several new project types for iOS and Android applications. There are also several project templates to jump-start your development of common applications.</p><p class="calibre8">Xamarin Studio <a id="id45" class="calibre1"/>supports several out-of-the-box project types, including standard <code class="literal">.NET</code> class libraries and console applications. You cannot natively develop Windows applications on a Mac with Xamarin Studio, but you can certainly develop the shared code portion of your application in Xamarin Studio. We'll focus on sharing code in the later chapters, but keep in mind that Xamarin enables you to share a common C# backend between most platforms that support C#.</p><p class="calibre8">In this chapter, we will cover:</p><div><ul class="itemizedlist"><li class="listitem">Creating a "Hello World" application for iOS</li><li class="listitem">Apple's MVC pattern</li><li class="listitem">Xcode and storyboards</li><li class="listitem">Creating a "Hello World" application for Android</li><li class="listitem">Android activities</li><li class="listitem">Xamarin's Android designer</li></ul></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_1"><a id="ch02lvl1sec16" class="calibre1"/>Building your first iOS application</h1></div></div></div><p class="calibre8">Launch Xamarin<a id="id46" class="calibre1"/> Studio and start a new solution. Just like in Visual Studio, there are lots of project types that can be created from the <strong class="calibre2">New Solution</strong> dialog. Xamarin Studio, formerly <strong class="calibre2">MonoDevelop</strong>, supports the development of many different types<a id="id47" class="calibre1"/> of projects such as C# console applications targeting the Mono runtime, NUnit test projects, and even other languages besides C#, such as VB or C++.</p><p class="calibre8">Xamarin Studio supports the following project types for iOS:</p><div><ul class="itemizedlist"><li class="listitem"><strong class="calibre2">iPhone or iPad project</strong>: These categories of projects use storyboards to lay out the UI and<a id="id48" class="calibre1"/> target either the iPad or iPhone only.</li><li class="listitem"><strong class="calibre2">Universal project</strong>: This <a id="id49" class="calibre1"/>category supports both iPhone and iPad in the same iOS application. This is the preferred project type<a id="id50" class="calibre1"/> if you need to target both types of devices.</li><li class="listitem"><strong class="calibre2">Single View Application</strong>: This is the basic project type that sets up an iOS storyboard along<a id="id51" class="calibre1"/> with a single view and controller.</li><li class="listitem"><strong class="calibre2">Tabbed Application</strong>: This is <a id="id52" class="calibre1"/>a project type that automatically sets up <strong class="calibre2">UITabViewController</strong> for<a id="id53" class="calibre1"/> applications with a tab layout.</li><li class="listitem"><strong class="calibre2">WebView Application</strong>: This project type is for creating <em class="calibre12">hybrid</em> applications that are partially HTML and partially native. The application is set up to take advantage of the <a id="id54" class="calibre1"/>Razor templating features of Xamarin Studio.</li><li class="listitem"><strong class="calibre2">iOS binding project</strong>: This is an<a id="id55" class="calibre1"/> iOS project that can create C# bindings for an Objective-C library.</li><li class="listitem"><strong class="calibre2">iOS unit test project</strong>: This is<a id="id56" class="calibre1"/> a special iOS application project that can run NUnit tests.</li><li class="listitem"><strong class="calibre2">iOS library project</strong>: This is a<a id="id57" class="calibre1"/> class library used within other iOS application projects.</li></ul></div><p class="calibre8">To get started, navigate<a id="id58" class="calibre1"/> to <strong class="calibre2">iOS</strong> | <strong class="calibre2">iPhone</strong>, and create <strong class="calibre2">Single View Application</strong> in the directory of your choice, as shown in the following screenshot:</p><div><img src="img/00011.jpeg" alt="Building your first iOS application" class="calibre9"/></div><p class="calibre10"> </p><p class="calibre8">You'll notice<a id="id59" class="calibre1"/> that several files and folders are automatically created from the project template. These files are as follows:</p><div><ul class="itemizedlist"><li class="listitem"><code class="literal">Components</code>: This folder will contain any components added from the Xamarin Component<a id="id60" class="calibre1"/> Store. See <a class="calibre1" title="Chapter 9. Third-party Libraries" href="part0070_split_000.html#page">Chapter 9</a>, <em class="calibre12">Third-party Libraries</em>, for more information about the Xamarin Component Store.</li><li class="listitem"><code class="literal">Resources</code>: This directory<a id="id61" class="calibre1"/> will contain any images or plain files that you want to be copied directly to your application bundle. Note that this will contain a black splash screen image, by default. This ensures that your iOS application runs full screen on the iPhone 5.</li><li class="listitem"><code class="literal">AppDelegate.cs</code>: This is Apple's main class<a id="id62" class="calibre1"/> that handles application-level events in your app.</li><li class="listitem"><code class="literal">Entitlements.plist</code>: This is a settings file Apple uses to declare permissions for<a id="id63" class="calibre1"/> certain iOS features such as push notifications and iCloud. You will generally only have to use it for advanced iOS features.</li><li class="listitem"><code class="literal">*ViewController.cs</code>: This is the controller that represents the first screen in your app. It will have<a id="id64" class="calibre1"/> the same name as your project.</li><li class="listitem"><code class="literal">Info.plist</code>: This is Apple's version of a <code class="literal">manifest</code> file that can declare various settings for <a id="id65" class="calibre1"/>your application such as the app title, icon, splash screens, and other common settings.</li><li class="listitem"><code class="literal">Main.cs</code>: This file <a id="id66" class="calibre1"/>contains the standard entry point for a C# program: <code class="literal">static void Main()</code>. It's most likely that you will not need to modify this file.</li><li class="listitem"><code class="literal">MainStoryboard.storyboard</code>: This is the storyboard definition file for your application. It will <a id="id67" class="calibre1"/>contain the layouts for the views in your app, list of controllers, and the transitions used to navigate throughout your app.</li></ul></div><p class="calibre8">Now, let's run the<a id="id68" class="calibre1"/> application to see what we get by default from the project template. Click on the large play button in the top-left corner of Xamarin Studio. You will be greeted by the simulator running your first iOS application, as shown in the following screenshot:</p><div><img src="img/00012.jpeg" alt="Building your first iOS application" class="calibre9"/></div><p class="calibre10"> </p><p class="calibre8">So far, your app is just a plain white screen, which is not very exciting or useful. Let's get a little more background on iOS development before moving forward.</p><p class="calibre8">Depending on <a id="id69" class="calibre1"/>your application's minimum iOS target, you can also run the application on different versions of the iOS simulator. Apple also provides simulators for iPad and all the different iOS devices currently in the market. It is also important to know that these are simulators and not emulators. An emulator will run an encapsulated version of the mobile OS (just as Android does). Emulators generally exhibit slower performance but give you a closer replica of the real OS. Apple's simulators run in native Mac applications and are not true operating systems. The benefit is that they are very fast in comparison to Android emulators.</p></div></div>
<div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec17" class="calibre1"/>Understanding Apple's MVC pattern</h1></div></div></div><p class="calibre8">Before getting<a id="id70" class="calibre1"/> too far with iOS development, it is really important to get a foundation with Apple's design pattern to develop on iOS. You<a id="id71" class="calibre1"/> might have used the <strong class="calibre2">Model View Controller</strong> (<strong class="calibre2">MVC</strong>) pattern with other technologies such as <a id="id72" class="calibre1"/><strong class="calibre2">ASP.NET</strong>, but Apple implements this paradigm in a slightly different way.</p><p class="calibre8">The MVC design pattern includes the following:</p><div><ul class="itemizedlist"><li class="listitem"><strong class="calibre2">Model</strong>: This is the<a id="id73" class="calibre1"/> backend business <a id="id74" class="calibre1"/>logic that drives the application. This can be any code that, for example, makes web requests to a server or saves data to a local<a id="id75" class="calibre1"/> <strong class="calibre2">SQLite</strong> database.</li><li class="listitem"><strong class="calibre2">View</strong>: This is the actual <a id="id76" class="calibre1"/>user interface seen on the screen. In iOS terms, this is any class that derives from <code class="literal">UIView</code>. Examples are toolbars, buttons, and anything else the user would see on the screen and interact with.</li><li class="listitem"><strong class="calibre2">Controller</strong>: This is the<a id="id77" class="calibre1"/> workhorse of the MVC pattern. The controller interacts with the Model layer and updates the View layer with the results. Similar to the View layer, any controller class will derive from <code class="literal">UIViewController</code>. This is where a good portion of the code in iOS applications resides.</li></ul></div><p class="calibre8">The following figure shows you the MVC design pattern:</p><div><img src="img/00013.jpeg" alt="Understanding Apple's MVC pattern" class="calibre9"/></div><p class="calibre10"> </p><p class="calibre8">To understand this pattern better, let's walk you through the following example of a common scenario:</p><div><ol class="orderedlist"><li class="listitem" value="1">We have an iOS application with a search box that needs to query a website for a list of jobs.</li><li class="listitem" value="2">The user <a id="id78" class="calibre1"/>will enter some text into the <code class="literal">UITextField</code> textbox and click on the <code class="literal">UIButton</code> button to start the search. This is the View layer.</li><li class="listitem" value="3">Some code will respond to the button by interacting with the view, display a <code class="literal">UIActivityIndicatorView</code> spinner, and call a method in another class to perform the search. This is the Controller layer.</li><li class="listitem" value="4">A web request will be made in the called class and a list of jobs will be returned asynchronously. This is the Model layer.</li><li class="listitem" value="5">The controller will then update the view with the list of jobs and hide the spinner.</li></ol><div></div><div><h3 class="title2"><a id="note02" class="calibre1"/>Note</h3><p class="calibre8">For more<a id="id79" class="calibre1"/> information on Apple's MVC pattern, see the documentation site at <a class="calibre1" href="https://developer.apple.com/library/mac/documentation/general/conceptual/devpedia-cocoacore/MVC.html">https://developer.apple.com/library/mac/documentation/general/conceptual/devpedia-cocoacore/MVC.html</a>.</p></div><p class="calibre8">A point to note is that you are free to do anything you want in the Model layer of your application. This is where we can use plain C# classes that can be reused on other platforms such as Android. This includes any functionality using<a id="id80" class="calibre1"/> the C# <strong class="calibre2">Base Class Libraries</strong> (<strong class="calibre2">BCL</strong>), such as working with web services or a database. We'll dive deeper into cross-platform architecture and code-sharing concepts later in the book.</p></div>
<div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec18" class="calibre1"/>Using the iOS designer</h1></div></div></div><p class="calibre8">Since our plain<a id="id81" class="calibre1"/> white application is quite boring, let's modify the View layer of our application with some controls. To do this, we will modify the <code class="literal">MainStoryboard.storyboard</code> file in your project in Xamarin Studio. Optionally, you can open the storyboard file in Xcode, which was previously the method of editing storyboard files before the designer was available in Xamarin Studio. Using Xcode can still be useful if there is a feature in iOS storyboards that isn't available yet in the Xamarin designer or if you need to edit an older iOS format such as <code class="literal">XIB</code> files. However, Xcode is not quite as good of <a id="id82" class="calibre1"/>an experience, since custom controls in Xcode render as a plain white square. Xamarin's designer actually runs your drawing code in custom controls, so that you get an accurate view of what your application will look like at runtime.</p><div><img src="img/00014.jpeg" alt="Using the iOS designer" class="calibre9"/></div><p class="calibre10"> </p><p class="calibre8">Let's add some controls to our app by performing the following steps:</p><div><ol class="orderedlist"><li class="listitem" value="1">Open the project you created earlier in this chapter in Xamarin Studio.</li><li class="listitem" value="2">Double-click on the <code class="literal">MainStoryboard.storyboard</code> file.</li><li class="listitem" value="3">The iOS designer will open, and you will see the layout for the single controller in your application.</li><li class="listitem" value="4">In the <strong class="calibre2">Document Outline</strong> tab on the right-hand side, you'll see that your controller contains a single view in its layout hierarchy.</li><li class="listitem" value="5">In the top-left corner, you'll notice a toolbox that contains several types of objects that you can drag and drop onto your controller's view.</li><li class="listitem" value="6">In the search box, search for <code class="literal">UILabel</code> and drag the label onto your view at a location of your choice.</li><li class="listitem" value="7">Double-click on the label to edit the text of the label to anything you wish. You can also<a id="id83" class="calibre1"/> fill out this value from the <strong class="calibre2">Properties</strong> tab in the bottom-right corner.</li><li class="listitem" value="8">Likewise, search for <code class="literal">UIButton</code> and drag the button onto your view somewhere above or below the label. You can edit the text on the button using the <strong class="calibre2">Properties</strong> tab. Double-clicking on the button will add a click event handler as you might be familiar in Visual Studio when developing for other platforms.</li><li class="listitem" value="9">Run the application.</li></ol><div></div><p class="calibre8">Your application should start looking a lot more like a real application, as shown in the following screenshot:</p><div><img src="img/00015.jpeg" alt="Using the iOS designer" class="calibre9"/></div><p class="calibre10"> </p><p class="calibre8">Now you might be wondering about adding user interaction options to the app at this point. In Xcode's iOS designer, you can make an <a id="id84" class="calibre1"/><strong class="calibre2">outlet</strong> that will make each view visible from C#. An outlet is <a id="id85" class="calibre1"/>a reference to a view in a storyboard or <code class="literal">XIB</code> file that will be filled out with an instance of the view at runtime. You can compare this concept to naming a control in other technologies such as ASP.NET MVC, WebForms, or <a id="id86" class="calibre1"/><strong class="calibre2">Windows Presentation Foundation</strong> (<strong class="calibre2">WPF</strong>). Luckily, Xamarin's iOS designer is a bit simpler than setting up an outlet in Xcode. You merely fill out the <strong class="calibre2">Name</strong> field in the <strong class="calibre2">Properties</strong> tab, and Xamarin Studio will generate a property in <a id="id87" class="calibre1"/><strong class="calibre2">partial class</strong>, which gives you access to the label and button from your controller. Additionally, you can wire an <strong class="calibre2">action</strong> <a id="id88" class="calibre1"/>from a storyboard file, which is a method that will be called when an event occurs. Xamarin Studio exposes iOS actions as partial methods to be implemented in your classes.</p><p class="calibre8">Let's add some interactions to the app as follows:</p><div><ol class="orderedlist"><li class="listitem" value="1">Switch back to Xamarin Studio.</li><li class="listitem" value="2">Double-click on the <code class="literal">MainStoryboard.storyboard</code> file again.</li><li class="listitem" value="3">Select the label you created earlier and go to the <strong class="calibre2">Properties</strong> pane and make sure that you have the <strong class="calibre2">Widget</strong> tab selected.</li><li class="listitem" value="4">Enter the name <code class="literal">label</code> in the <strong class="calibre2">Name</strong> field.</li><li class="listitem" value="5">Repeat this process for the button, and enter the name <code class="literal">button</code> into its <strong class="calibre2">Name</strong> field.</li></ol><div></div><p class="calibre8">Xamarin has improved this experience greatly from what the experience used to be in Xcode. Xcode has a strange interface for those used to Visual Studio. The method used to create an outlet involved clicking and dragging from the control onto an Objective-C header file. Merely filling out a <strong class="calibre2">Name</strong> field is much simpler and much more intuitive for developers that have a C# background.</p><p class="calibre8">Now that we have<a id="id89" class="calibre1"/> two outlets defined, two new properties will be available from your controller. Expand the <code class="literal">*ViewController.cs</code> file in your solution and open the <code class="literal">*ViewController.designer.cs</code> file. You will see your properties defined as follows:</p><div><pre class="programlisting">[Outlet]
[GeneratedCode ("iOS Designer", "1.0")]
MonoTouch.UIKit.UILabel label { get; set; }

[Outlet]
[GeneratedCode ("iOS Designer", "1.0")]
MonoTouch.UIKit.UIButton button { get; set; }</pre></div><p class="calibre8">It is not a good idea to modify this file since Xamarin Studio can rebuild it if you make further changes in the designer or Xcode. Nevertheless, it is a good practice to learn how things are actually working behind the scenes.</p><p class="calibre8">Open your <code class="literal">*ViewController.cs</code> file, and let's enter the following code in your controller's <code class="literal">ViewDidLoad</code> method:</p><div><pre class="programlisting">public override void ViewDidLoad() 
{
  base.ViewDidLoad();

  int count = 0;
  button.TouchUpInside += (sender, e) =&gt; 
    label.Text = string.Format("Count: {0}", ++count);
}</pre></div><p class="calibre8">When the <code class="literal">ViewDidLoad</code> method is called, your controller's view is loaded for the first time. This happens once in the lifetime of your controller. We subscribed to the <code class="literal">TouchUpInside</code> event, which is fired when the button is clicked; iOS does not have a click event, which might be what you are used to on Windows platforms. We also used C#'s convenient lambda expression syntax to update the label when the event is fired. A lambda expression is shorthand for an anonymous method, which is a feature that has been part of C# since .NET 4.0.</p><p class="calibre8">Run your application, and <a id="id90" class="calibre1"/>you will be able to interact with your button and increment the value displayed in the label, as shown in the following screenshot:</p><div><img src="img/00016.jpeg" alt="Using the iOS designer" class="calibre9"/></div><p class="calibre10"> </p><p class="calibre8">Next, we need to make a transition from one controller to another. To do this, iOS has a concept called<a id="id91" class="calibre1"/> <strong class="calibre2">segue</strong>, which is basically some kind of animation that switches from one controller to the next. There are several types of segues, but the most common segue slides transition to a new controller from the right or bottom of the screen.</p><p class="calibre8">Now, let's add a second controller to the application as follows:</p><div><ol class="orderedlist"><li class="listitem" value="1">Return to your project in Xamarin Studio.</li><li class="listitem" value="2">Double-click on the <code class="literal">MainStoryboard.storyboard</code> file.</li><li class="listitem" value="3">Drag a new controller from the object library that is usually in the bottom-left corner next to the first controller.</li><li class="listitem" value="4">Click on the controller to select it.</li><li class="listitem" value="5">Select the <a id="id92" class="calibre1"/><strong class="calibre2">Properties</strong> pane and make sure you are on the <strong class="calibre2">Widget</strong> tab.</li><li class="listitem" value="6">Enter a name such as <code class="literal">SecondController</code> for the controller into the <strong class="calibre2">Class</strong> field.</li><li class="listitem" value="7">Now let's add a segue for the transition from the first controller to this one. Hold the <em class="calibre12">Ctrl</em> key while clicking on the button from the original controller to your new controller. A blue line will appear followed by a small pop-up menu.</li><li class="listitem" value="8">Select <strong class="calibre2">modal</strong> from the pop-up menu.</li><li class="listitem" value="9">Run the application from Xamarin Studio.</li></ol><div></div><p class="calibre8">Since we set up a modal segue from the first controller's button, your second controller will appear while clicking on it. However, there isn't a way to exit the new controller yet. If you return to Xamarin Studio, you'll notice that a <code class="literal">SecondController.cs</code> file and a <code class="literal">SecondController.designer.cs</code> file have been automatically created for you.</p><p class="calibre8">Let's add a button to <code class="literal">SecondController</code> as follows:</p><div><ol class="orderedlist"><li class="listitem" value="1">Return to Xamarin Studio.</li><li class="listitem" value="2">Double-click on the <code class="literal">MainStoryboard.storyboard</code> file.</li><li class="listitem" value="3">Drag a button from the object library onto the second controller.</li><li class="listitem" value="4">Navigate to the <strong class="calibre2">Properties</strong> pane and <strong class="calibre2">Widget</strong> tab.</li><li class="listitem" value="5">Set the <strong class="calibre2">Name</strong> of the button to <code class="literal">close</code>.</li><li class="listitem" value="6">Set the <strong class="calibre2">Title</strong> of the button to <code class="literal">Close</code>.</li></ol><div></div><p class="calibre8">Open the <code class="literal">SecondController.cs</code> file and add the following method:</p><div><pre class="programlisting">public override void ViewDidLoad()
{
    base.ViewDidLoad();
    close.TouchUpInside += (sender, e) =&gt;       
      DismissViewController(true, null);
}</pre></div><p class="calibre8">If you compile and run your application, clicking on the button will increment the value on the label and display the modal second controller. You can then close the second controller by tapping on the <strong class="calibre2">Close</strong> button. Notice the neat sliding animation; iOS automatically applies these kinds of transition effects and are very easy to customize on iOS:</p><div><img src="img/00017.jpeg" alt="Using the iOS designer" class="calibre9"/></div><p class="calibre10"> </p><p class="calibre8">Since we have <a id="id93" class="calibre1"/>gone over the basics of laying out controls in Xamarin's iOS designer and interacting with outlets in C#, let's go over the standard lifecycle of an iOS application. The primary location for handling application-level events is in the <code class="literal">AppDelegate</code> class.</p><p class="calibre8">If you open your<a id="id94" class="calibre1"/> <code class="literal">AppDelegate.cs</code> file, you can override the following methods:</p><div><ul class="itemizedlist"><li class="listitem"><code class="literal">FinishedLaunching</code>: This is <a id="id95" class="calibre1"/>the first entry point for the application, which should return <code class="literal">true</code>.</li><li class="listitem"><code class="literal">DidEnterBackground</code>: This means that the user clicked on the home button on their device or another app, such<a id="id96" class="calibre1"/> as a phone call, came to the foreground. You should perform any action needed to save the user's progress or state of the UI as the iOS might close your application to save memory once pushed to the background. While your application is in the background, the user could be navigating through the home screen<a id="id97" class="calibre1"/> or opening other apps. Your application is effectively paused in memory until resumed by the user.</li><li class="listitem"><code class="literal">WillEnterForeground</code>: This means that the user has reopened your application from the <a id="id98" class="calibre1"/>background. You might need to perform other actions here such as refreshing the data on the screen and so on.</li><li class="listitem"><code class="literal">OnResignActivation</code>: This happens if the operating system displays a system popup on top <a id="id99" class="calibre1"/>of your application. Examples of this are calendar reminders or the menu the user can swipe down from the top of the screen.</li><li class="listitem"><code class="literal">OnActivated</code>: This happens<a id="id100" class="calibre1"/> immediately after the <code class="literal">OnResignActivation</code> method is executed as the user returns to your app.</li><li class="listitem"><code class="literal">ReceiveMemoryWarning</code>: This is a warning from the operating system to free up the memory in your <a id="id101" class="calibre1"/>application. It is not commonly needed with Xamarin because of the C#'s garbage collector, but if there are any heavy objects such as images throughout your app, this is a good place to dispose them. If enough memory cannot be freed, the operating system can terminate your application.</li><li class="listitem"><code class="literal">HandleOpenUrl</code>: This is called if you implement<a id="id102" class="calibre1"/> a <strong class="calibre2">URL scheme</strong>, which is the iOS equivalent <a id="id103" class="calibre1"/>of file extension associations on a desktop platform. If you register your app to open different types of files or URLs, this method will be called.</li></ul></div><p class="calibre8">Likewise, in your <code class="literal">*ViewController.cs</code> file, you can<a id="id104" class="calibre1"/> override the following methods on your controller:</p><div><ul class="itemizedlist"><li class="listitem"><code class="literal">ViewDidLoad</code>: This occurs when the view associated with your controller is loaded. It will <a id="id105" class="calibre1"/>occur only once on devices running iOS 6 or higher.</li><li class="listitem"><code class="literal">ViewWillAppear</code>: This occurs prior to your view appearing on the screen. If there are any views<a id="id106" class="calibre1"/> that need to be refreshed while navigating throughout your app, this is generally the best place to do it.</li><li class="listitem"><code class="literal">ViewDidAppear</code>: This occurs after the completion of any transition animations and your <a id="id107" class="calibre1"/>view is displayed on the screen. In some uncommon situations, you might need to perform actions here instead of in <code class="literal">ViewWillAppear</code>.</li><li class="listitem"><code class="literal">ViewWillDisappear</code>: This method is called prior to your view being hidden. You might need to<a id="id108" class="calibre1"/> perform some cleanup operations here.</li><li class="listitem"><code class="literal">ViewDidDisappear</code>: This occurs after any transition animations are completed for<a id="id109" class="calibre1"/> displaying a different controller on the screen. Just like the methods for appearing, this occurs after <code class="literal">ViewWillDisappear</code>.</li></ul></div><p class="calibre8">There are several more methods available to override, but many are deprecated for recent versions of iOS. Familiarize yourself with Apple's documentation site at <a class="calibre1" href="http://developer.apple.com/library/ios">http://developer.apple.com/library/ios</a>. It is very helpful to read the documentation on each <a id="id110" class="calibre1"/>class and method when trying to understand how Apple's APIs work. Learning how to read (not necessarily code) Objective-C is also a useful skill to learn so that you are able to convert Objective-C examples to C# when developing iOS applications.</p></div>
<div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec19" class="calibre1"/>Building your first Android application</h1></div></div></div><p class="calibre8">Setting up an<a id="id111" class="calibre1"/> Android application in Xamarin Studio is just as easy as it is for iOS and is very similar to the experiences in Visual Studio. Xamarin<a id="id112" class="calibre1"/> Studio includes several project templates that are specific for Android to jump-start your development.</p><p class="calibre8">Xamarin Studio includes the following project templates:</p><div><ul class="itemizedlist"><li class="listitem"><strong class="calibre2">Android application</strong>: A standard Android application that targets the newest Android SDKs installed on your <a id="id113" class="calibre1"/>machine.</li><li class="listitem"><strong class="calibre2">Android Honeycomb application</strong>: A project that<a id="id114" class="calibre1"/> targets Android Honeycomb, which is <a id="id115" class="calibre1"/><strong class="calibre2">API</strong> (<strong class="calibre2">Application Programming Interface</strong>) level 12 and higher.</li><li class="listitem"><strong class="calibre2">Android Ice Cream Sandwich application</strong>: A project that targets Android Ice Cream Sandwich, which is<a id="id116" class="calibre1"/> API level 15 and above.</li><li class="listitem"><strong class="calibre2">Android library project</strong>: A class library that can only be referenced by Android application <a id="id117" class="calibre1"/>projects.</li><li class="listitem"><strong class="calibre2">Android Java bindings library</strong>: A project for <a id="id118" class="calibre1"/>setting up a Java library to be called from C#.</li><li class="listitem"><strong class="calibre2">Android OpenGL application</strong>: A <a id="id119" class="calibre1"/>project template to use low-level OpenGL for 3D or 2D rendering.</li><li class="listitem"><strong class="calibre2">Android WebView application</strong>: A project template for a hybrid app using HTML for certain<a id="id120" class="calibre1"/> parts. Support for Razor templating is available.</li><li class="listitem"><strong class="calibre2">Android unit test project</strong>: A project <a id="id121" class="calibre1"/>for running NUnit tests on Android.</li></ul></div><p class="calibre8">Launch Xamarin Studio and <a id="id122" class="calibre1"/>start a new solution. From the <strong class="calibre2">New Solution</strong> dialog, create a new <strong class="calibre2">Android Application</strong> under the <strong class="calibre2">Android </strong>section.</p><p class="calibre8">You will end up with a solution looking something similar to what is shown in the following screenshot:</p><div><img src="img/00018.jpeg" alt="Building your first Android application" class="calibre9"/></div><p class="calibre10"> </p><p class="calibre8">You'll see that<a id="id123" class="calibre1"/> the following files and folders specific to Android have been created for you:</p><div><ul class="itemizedlist"><li class="listitem">The <code class="literal">Components</code> folder: This is the same as for iOS projects; the place where components from the Xamarin Component Store can be added.</li><li class="listitem">The <code class="literal">Assets</code> folder: This directory will contain files with a <code class="literal">build</code> action of <code class="literal">AndroidAsset</code>. This folder will contain raw files to be bundled with an Android application.</li><li class="listitem">The <code class="literal">Properties/AndroidManifest.xml</code> file: This file contains standard declarations about your Android applications, such as the application name, ID, and permissions.</li><li class="listitem">The <code class="literal">Resources</code> folder: Resources are images, layouts, strings, and so on that can be loaded via Android's resource system. Each file will have an ID generated in <code class="literal">Resources.designer.cs</code> that you can use to load the resource.</li><li class="listitem">The <code class="literal">Resources/drawable</code> folder: Any images used by your application are generally placed here.</li><li class="listitem">The <code class="literal">Resources/layout</code> folder: This contains any <code class="literal">*.axml</code> (Android XML) files that <a id="id124" class="calibre1"/>Android uses to declare UIs. Layouts can be used for an entire<a id="id125" class="calibre1"/> <strong class="calibre2">activity</strong>, <strong class="calibre2">fragment</strong>, <strong class="calibre2">dialog</strong>, or <strong class="calibre2">child control</strong> to<a id="id126" class="calibre1"/> be displayed<a id="id127" class="calibre1"/> on the screen.</li><li class="listitem">The <code class="literal">Resources/values</code> folder: This contains XML files to declare key-value pairs for strings (and other types) throughout an application. This is how localization for multiple languages is normally set up on Android.</li><li class="listitem">The <code class="literal">MainActivity.cs</code> file: This is the <code class="literal">MainLauncher</code> action and the first activity<strong class="calibre2"> </strong>of your Android application. There is no <code class="literal">static void Main</code> function in Android apps; execution begins on the activity that has <code class="literal">MainLauncher</code> set to <code class="literal">true</code>.</li></ul></div><p class="calibre8">Now let's perform<a id="id128" class="calibre1"/> the following steps to run the application:</p><div><ol class="orderedlist"><li class="listitem" value="1">Click on the play button to compile and run the application.</li><li class="listitem" value="2">A <strong class="calibre2">Select Device</strong> dialog will appear.</li><li class="listitem" value="3">Select the emulator of your choice and click on <strong class="calibre2">Start Emulator</strong>. If you have set up the x86 emulator in <a class="calibre1" title="Chapter 1. Setting Up Xamarin" href="part0014_split_000.html#page">Chapter 1</a>, <em class="calibre12">Setting Up Xamarin</em>, I would recommend that you use it.</li><li class="listitem" value="4">Wait a few seconds for the emulator to start. Once it starts, it is a good idea to leave it running as long as you are working on an Android project. This will save you a good deal of time waiting.</li><li class="listitem" value="5">You should see the emulator now enabled in the list of devices; select it, and click on <strong class="calibre2">OK</strong>.</li><li class="listitem" value="6">The very first time you deploy to an emulator or device, Xamarin Studio will have to install a few things such as the Mono shared runtime and Android platform tools.</li><li class="listitem" value="7">Switch over to the Android emulator and your application will appear.</li></ol><div></div><p class="calibre8">When all is done, you have deployed your first Android application, complete with a single button. Your app will look like what is shown in the following screenshot:</p><div><img src="img/00019.jpeg" alt="Building your first Android application" class="calibre9"/></div><p class="calibre10"> </p></div>
<div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec20" class="calibre1"/>Android activities</h1></div></div></div><p class="calibre8">The Android operating<a id="id129" class="calibre1"/> system is very focused on the concept of an activity. An activity is a task or unit of work that users can perform on their screen. For example, users would perform a<a id="id130" class="calibre1"/> phone<strong class="calibre2"> activity</strong> to dial a number and carry out a second activity that involves interacting with their address book to locate the number. Each Android application is a collection of one or more activities that users can launch and press the hardware's back key on their device to exit or cancel. The user's history is kept in the <a id="id131" class="calibre1"/>Android <strong class="calibre2">back stack</strong>, which you can manipulate from code in special cases. When a new activity starts, the previous one is paused and maintained in memory for later use, unless the operating system is running low on memory.</p><p class="calibre8">Activities are loosely coupled with each other; in some ways, you can think of them as having completely separate states from one another in memory. Static values will persist the life of the application as in .NET applications, but the common practice is to pass a state through<a id="id132" class="calibre1"/> an Android <strong class="calibre2">bundle</strong>. An Android bundle is a set of key-value pairs used to pass data from one Android object to another. This is useful to pass an identifier for an item displayed in a list to edit that item in a new activity.</p><p class="calibre8">Activities have the following<a id="id133" class="calibre1"/> lifecycle callback methods that you can override:</p><div><ul class="itemizedlist"><li class="listitem"><code class="literal">OnCreate</code>: This is the first method called when your activity is created. Set up your views<a id="id134" class="calibre1"/> and perform other loading logic here. Most importantly, you will call <code class="literal">SetContentView</code> here to set up your activity's view.</li><li class="listitem"><code class="literal">OnResume</code>: This is called when your activity's view is visible on the screen. It is called if your <a id="id135" class="calibre1"/>activity is displayed for the first time, and when the user returns to it from another activity.</li><li class="listitem"><code class="literal">OnPause</code>: This is called to notify that the user has left your activity. It can happen prior to<a id="id136" class="calibre1"/> navigating to a new activity within your app, locking the screen, or hitting the home button. Assume that the user might not return, so you need to save any changes the user made here.</li><li class="listitem"><code class="literal">OnStart</code>: This occurs immediately before <code class="literal">OnResume</code> when the activity's view is about to<a id="id137" class="calibre1"/> be displayed on the screen. It occurs when an activity starts and when a user returns to it from another activity.</li><li class="listitem"><code class="literal">OnStop</code>: This<a id="id138" class="calibre1"/> occurs immediately after <code class="literal">OnPause</code> when the activity's view is no longer displayed on the screen.</li><li class="listitem"><code class="literal">OnRestart</code>: This<a id="id139" class="calibre1"/> method occurs when the user returns to your activity from a previous activity.</li><li class="listitem"><code class="literal">OnActivityResult</code>: This method is used to communicate with other activities in other <a id="id140" class="calibre1"/>applications on Android. It is used in conjunction with <code class="literal">StartActvityForResult</code>; for example, you will use this to interact with the Facebook application to log in a user.</li><li class="listitem"><code class="literal">OnDestroy</code>: This is <a id="id141" class="calibre1"/>called when your activity is about to be freed from memory. Perform any additional cleanup that could help the operating system here, such as disposing of any other heavyweight objects the activity was using.</li></ul></div><p class="calibre8">A flowchart of the <a id="id142" class="calibre1"/>Android lifecycle is as follows:</p><div><img src="img/00020.jpeg" alt="Android activities" class="calibre9"/></div><p class="calibre10"> </p><p class="calibre8">Unlike iOS, Android does not enforce any design patterns upon its developers. However, it is not possible to get away without understanding the Android activity lifecycle to some degree. Many concepts with activities are parallel to controllers on iOS; for example, <code class="literal">OnStart</code> is equivalent to <code class="literal">ViewWillAppear</code> and <code class="literal">OnResume</code> is equivalent to <code class="literal">ViewDidAppear</code>.</p><p class="calibre8">Other methods<a id="id143" class="calibre1"/> for working with activities are as follows:</p><div><ul class="itemizedlist"><li class="listitem"><code class="literal">StartActivity(Type type)</code>: This method starts a new activity within your <a id="id144" class="calibre1"/>application and passes no extra information to the activity.</li><li class="listitem"><code class="literal">StartActivity(Intent intent)</code>: This is an overload method to start a new activity <a id="id145" class="calibre1"/>with <code class="literal">Intent</code>. This gives you the ability to pass<a id="id146" class="calibre1"/> additional information to the new activity, and you can also launch activities in other applications.</li><li class="listitem"><code class="literal">StartActivityForResult</code>: This method starts a new activity with the anticipation<a id="id147" class="calibre1"/> of receiving <code class="literal">OnActivityResult</code> when the activity's operation is completed.</li><li class="listitem"><code class="literal">Finish</code>: This will close the current activity and invoke <code class="literal">OnDestroy</code> when it is completely <a id="id148" class="calibre1"/>closed and no longer displayed on the screen. Depending on what is currently on the back stack, the user will return to a previous activity or the home screen.</li><li class="listitem"><code class="literal">SetContentView</code>: This method sets the primary view to be displayed for an activity. It should be<a id="id149" class="calibre1"/> called within the <code class="literal">OnCreate</code> method prior to the activity being displayed on the screen.</li><li class="listitem"><code class="literal">FindViewById</code>: This is<a id="id150" class="calibre1"/> a method to locate the view displayed in your activity. It has a generic version to return a view of the appropriate type.</li></ul></div><p class="calibre8">You can think of <code class="literal">intent</code> as an object that describes the transition from one activity to another. You can pass additional data through intents as well as modify how the activity is displayed and the user's navigation history.</p><p class="calibre8">In addition to activities, Android has the concept of a fragment. You can think of a fragment to be a miniature activity that is displayed inside a parent activity. Fragments are useful for reusing different pieces of a UI throughout your apps and can also help you implement split screen navigation on tablets.</p></div>
<div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec21" class="calibre1"/>Xamarin's Android designer</h1></div></div></div><p class="calibre8">The default<a id="id151" class="calibre1"/> template for Android projects has a little more built-in functionality than iOS. Android user interface layouts are defined in XML files that are readable by humans and editable. However, Xamarin Studio has provided an excellent <a id="id152" class="calibre1"/>design tool that allows you to drag and drop controls to define your Android layouts. Let's add some more features to your application and start using the Android designer.</p><p class="calibre8">Return to Xamarin<a id="id153" class="calibre1"/> Studio and carry out the following steps to add features to your app:</p><div><ol class="orderedlist"><li class="listitem" value="1">Open the Android project you created earlier in this chapter in Xamarin Studio.</li><li class="listitem" value="2">Navigate to <strong class="calibre2">Resources</strong> | <strong class="calibre2">layout</strong> in your project and open <code class="literal">Main.axml</code>.</li><li class="listitem" value="3">You will see the Android designer open in Xamarin Studio.</li><li class="listitem" value="4">Drag <strong class="calibre2">TextView</strong> from the <strong class="calibre2">Toolbox</strong> section on the right to the layout just above the button labeled <strong class="calibre2">Hello World, Click Me!</strong></li><li class="listitem" value="5">Type some default text such as <code class="literal">Count: 0</code> into the label.</li><li class="listitem" value="6">In the <strong class="calibre2">Properties</strong> pane on the right, you'll see the <strong class="calibre2">id</strong> value is set to <code class="literal">@+id/textView1</code>. Let's change it to <code class="literal">@+id/myText</code>, in order to be consistent with the button.</li><li class="listitem" value="7">While we're here, go ahead and change the text on the button to something more appropriate such as <code class="literal">Add</code>.</li><li class="listitem" value="8">Click on the play button to compile and run the application. If you still have the Android emulator, you can simply switch to it. Otherwise, you will have to start it again.</li></ol><div></div><p class="calibre8">Your Android application will now look identical to the changes you made in the designer as follows:</p><div><img src="img/00021.jpeg" alt="Xamarin's Android designer" class="calibre9"/></div><p class="calibre10"> </p><p class="calibre8">Now, let's interact with the new label from the code. Switch back to Xamarin Studio and open <code class="literal">MainActivity.cs</code>. Let's modify the activity to interact with the <strong class="calibre2">TextView</strong> field instead of the button. We use the <code class="literal">FindViewById</code> method to retrieve a view by the ID we set up in the layout file. Xamarin Studio has also auto-generated a static class named <code class="literal">Resource</code> to reference your identifiers.</p><p class="calibre8">So let's<a id="id154" class="calibre1"/> retrieve the instance of the <strong class="calibre2">TextView</strong> field by placing this code in <code class="literal">OnCreate</code> as follows:</p><div><pre class="programlisting">TextView text = FindViewById&lt;TextView&gt;(Resource.Id.myText);</pre></div><p class="calibre8">The <code class="literal">Resource</code> class is a static class that the Xamarin designer will populate for you. For future reference, you might have to build your Android project for new IDs and other resources to show up in your C# files in Xamarin Studio.</p><p class="calibre8">Next, let's update the <code class="literal">Click</code> event on the button:</p><div><pre class="programlisting">button.Click += delegate
{
    text.Text = string.Format("Count: {0}", ++count);
};</pre></div><p class="calibre8">This will rewire the button to update the text in <strong class="calibre2">TextView</strong> instead of on the button itself. Now if we run the<a id="id155" class="calibre1"/> application, we'll get an Android app that functions identically to the iOS one in the previous chapter. The Android app will look like what is shown in the following screenshot:</p><div><img src="img/00022.jpeg" alt="Xamarin's Android designer" class="calibre9"/></div><p class="calibre10"> </p><p class="calibre8">Since we added some of our own views to our layout, let's add a second activity to build on our understanding of activities in Android.</p><p class="calibre8">Return to Xamarin Studio and <a id="id156" class="calibre1"/>perform the following steps:</p><div><ol class="orderedlist"><li class="listitem" value="1">If needed, open the Android project you created earlier in the chapter in Xamarin Studio.</li><li class="listitem" value="2">Create a new Android activity in the project under the <strong class="calibre2">Android</strong> section. Name it <code class="literal">SecondActivity.cs</code>.</li><li class="listitem" value="3">Navigate to <strong class="calibre2">Resources</strong> | <strong class="calibre2">layouts</strong>, and create a new Android layout named <code class="literal">Second.axml</code>.</li><li class="listitem" value="4">Open <code class="literal">SecondActivity.cs </code>and add the following code to <code class="literal">OnCreate</code>:<div><pre class="programlisting">SetContentView(Resource.Layout.Second);</pre></div></li><li class="listitem" value="5">Open <code class="literal">MainActivity.cs</code> and add the following line of code to the <code class="literal">Click</code> event of your button:<div><pre class="programlisting">StartActivity(typeof(SecondActivity));</pre></div></li><li class="listitem" value="6">Open <code class="literal">Second.axml</code> and drag a button into the view. Set its text to <code class="literal">Finish</code>, for example, and set its ID to <code class="literal">@+id/finish</code>.</li><li class="listitem" value="7">Finally, open <code class="literal">SecondActivity.cs</code> and add the following lines to its <code class="literal">OnCreate</code> method:<div><pre class="programlisting">var finish = FindViewById&lt;Button&gt;(Resource.Id.finish);
finish.Click += (sender, e) =&gt; Finish();</pre></div></li><li class="listitem" value="8">Build and run your application.</li></ol><div></div><p class="calibre8">Your application's <a id="id157" class="calibre1"/>button will now launch a new activity in addition to incrementing the count on the label. Once <code class="literal">SecondActivity</code> is visible, you can click on its button to finish the activity and return to the first activity. Down the road, if you need to pass information from one activity to another, you will need to create an <code class="literal">Intent</code> object to pass to <code class="literal">StartActivity</code>. The second activity of your app is shown in the following screenshot:</p><div><img src="img/00023.jpeg" alt="Xamarin's Android designer" class="calibre9"/></div><p class="calibre10"> </p></div>
<div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec22" class="calibre1"/>Summary</h1></div></div></div><p class="calibre8">In this chapter, we created our first iOS application in Xamarin Studio. We covered Apple's MVC design pattern to better understand the relationship between <code class="literal">UIViewController</code> and <code class="literal">UIView</code> and also covered how to use the iOS designer in Xamarin Studio to edit storyboard files. Next, we created our first Android application in Xamarin Studio and learned the activity lifecycle in Android. We also used Xamarin's Android designer to make changes to Android XML layouts.</p><p class="calibre8">From the topics covered in this chapter, you should be fairly confident in developing simple apps for iOS and Android using Xamarin's tools. You should have a basic understanding of the native SDKs and design patterns to accomplish tasks on iOS and Android.</p><p class="calibre8">In the next chapter, we'll cover various techniques used to share code across platforms with Xamarin Studio. We'll go over different ways of architecting your cross-platform application and how to set up Xamarin Studio projects and solutions.</p></div></body></html>