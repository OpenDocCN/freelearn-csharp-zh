# 5

# 一个乌托邦式的完美 IT 系统

记得在*第四章*中关于由计算机、人类和狗组成的完美信息系统笑话吗？其中有些真理，因为人类一直在变化（他们的思想、他们的做事方式、他们在商业中遵循的规则、他们想购买的东西等等），而计算机则乐于重复、稳定、定义明确的任务。当然，这两者并不兼容，因此需要狗来防止人类把计算机工作搞得一团糟。

但谁首先创造了计算机？当然是人类。所以，这个笑话并不是说人类应该完全不接触计算机，而是创造它们，然后让它们在不做任何改变的情况下完成工作。当然，这只有在第一次尝试通过某种奇迹变得完美的情况下才可能实现。

在本章中，我们将涵盖以下主题：

+   理想系统的概念

+   理想系统中的数据管理

+   理想系统中的规则管理

+   理想系统中的流程管理

+   我们能接近这个乌托邦式系统有多近？

本章将描述一个类似于 100%理想信息系统的东西，它能够适应不断变化的商业变化，同时在速度、鲁棒性和能源效率方面仍然表现出色。这样的系统是由多米尼克·沃基耶在他的基础书籍《可持续信息系统 - 使用 SOA 重铸 SI》中想象的。构成理想信息系统的三个主要实体是**主数据管理**（**MDM**）、**业务规则管理系统**（**BRMS**）和**业务流程建模**（我们将在稍后详细解释）。接下来的几节将逐一解释它们，本章将以分析如何在现实中创建这个乌托邦式系统以及什么会阻止它为结尾。

# 理想 IT 系统的概念

在我们详细说明这样一个理想系统的不同部分之前，我将进一步解释这样一个模型的有用性。当我们对想要达到的目标有了更清晰的认识时，我们将详细说明概念的不同部分，并尝试使它们更加具体。

## 理想结构的用途

“理想”或“乌托邦”是工程师们通常有一种奇怪关系的术语。尽管他们的大部分思考都是在假设的情境中进行的，以在理论上取得进步，但他们知道实践总是与理论有很大距离，并且根据他们在理论与实践之间的掌握程度，工程师们很容易陷入许多陷阱：

+   仅停留在理论层面可能会让他们的思考从未应用于现实世界，最终导致时间的浪费以及无法真正了解他们工作的价值。

+   缺乏足够的理论基础来在他们的领域取得进步；仅仅停留在工作的实践中可能会帮助完善某些领域，但很少带来强大、改变领域的革命性想法。

+   最糟糕的是：在两者之间切换，但从未真正建立连接，使实践从理论中受益并从实践中证实理论。这种将两者结合在一起的能力，在我看来，是构成最佳工程结构的关键，无论是公司还是甚至国家，只要它们在最高水平上教授和组织这种能力。

正因如此，在这本书中有一个位置，否则它非常偏向于实践，并从许多现实世界的信息系统中获得了丰富的经验回报，但也有一些理论和理想化的思考。

## 设计的起源

我们将要描述的理想系统的结构，最初是在多米尼克·沃基耶的《可持续信息系统 - 使用 SOA 重整信息系统》中提出的，他是法国最著名的架构师之一，也是 PRAXEME 方法的倡导者。我有幸在 10 多年前接受了培训，其解释非常清晰，我立即购买了他的书籍，这些书籍很快成为我在信息系统工业化咨询工作中的参考之一。

这个想法背后的原则是，了解许多信息系统，可以描述一种元系统，它将包含所有必要的功能，只需几个通用的模块，这些模块可以定制以实现与业务相关的方面。这三个模块中的每一个都将非常通用，与任何特定的业务都没有关系，这也解释了为什么整个系统中内容如此之少。这三个领域如下：

+   存储数据并使其可用（简而言之，这正是数据库所做的事情）

+   执行业务规则以做出决策（这将涉及使用数据的软件应用程序）

+   通过协调许多小任务来实现复杂过程（尽管非常近似，但这正是使应用程序协同工作的关键）

多米尼克·沃基耶确实能够将任何业务功能指认为这些三个不同技术功能的组合。在与许多小型和大型公司的工业信息系统合作后，他认为这三个模块结合起来将能够处理任何给定业务领域的所有可想象的特征。尽管现在这种结构还没有被广泛使用，但它可能只是对未来几十年将要工业化和良好控制的工业信息系统的一个非常期待的预览。至少，从我的谦逊观点来看，这是这样一个具有前瞻性结构的最佳候选人。

## 使用愿景来定义目标

我们为什么要讨论这样一个如此未来派且我们没有任何证据证明其能够在实践中应用的架构呢？这会不会导致过度思考或过度设计？如果你自己问自己这些问题，你完全有理由这样做，而且这一章节并不是要推动你为你的下一个信息系统架构使用这个工具。

就像任何模式或架构工具一样，它主要存在是为了给你一些想法，如果其中的一些部分适合你的系统，那么它帮助你前进并加速思考将会是非常好的。

但是，拥有一个“理想”或“乌托邦”的愿景也可以帮助你给你的实现提供一个全局的导向。记住敏捷开发的隐喻，我们不是射箭，而是带着箭走向目标，当达到目标时用手将箭射出？好吧，为了做到这一点，我们同意我们需要知道目标是什么样的，以便找到并达到它。有时候，目标形状可能很难想象。当然，一个以业务为导向的思维方式会给你最好的想法，你应该保持功能性的关注。但如果业务想法相当模糊呢？也许一个“柔软”的、可适应的信息系统会允许你在事情变得稍微清晰一些的时候开始工作。开始构建系统甚至可以帮助企业主更好地思考他们想要什么。而且如果你有一个可以非常快速适应他们构建业务想法的理想系统，那么这可能就是你需要的项目类型。

当然，完全通用的成本（在性能上，以及初始设置的时间上）将会更高，但如果你的情况是这样的，通过简单地定制信息系统的参数来适应不断变化的企业目标的能力可能会在很大程度上克服这些缺点。而且一旦企业愿景确定，就没有什么可以阻止你重新实现一些现在稳定的部分，用特定的、优化的代码来替换，如果需要的话。

既然愿景已经清晰，我们将深入探讨构成这个理想 IT 系统的三个部分，即数据管理模块、规则管理模块，以及最后的流程管理模块。

# 理想系统中的数据管理

**MDM** 是理想系统的第一部分。在讨论数据是如何处理和使用的之前，解释数据将采取什么形式以及如何管理它是合乎逻辑的。这就是为什么我们将在讨论 BRMS 和 BPM 之前解释一个乌托邦系统中的 MDM 概念。

## 数据是信息系统的血液

数据是任何信息系统中最重要的组成部分。有些人甚至可能认为它们完全是关于数据的，因为“数据”这个术语在过去十年中被炒作得如此之高。

虽然很难想象一个没有至少一个数据库来存储数据的信息系统，因为这意味着没有任何关于任何商业事件的知识留存。可以想象一些完全短暂且未存储的信息片段，但由这些特定案例组成的整个系统听起来几乎无法理解。

这意味着数据应该首先得到关注，这正是理想通用信息系统第一个模块的主题。这个特性被称为 MDM。在这个情况下，“主”一词指的是系统中最重要的数据，那些被系统中的大多数参与者使用的数据。但在这种乌托邦式的系统特定情况下，每一份数据都会被视为如此，并放置在一个单独的模块中，该模块负责“MDM”这一职责。

## 数据作为 21 世纪的石油——真的吗？

在我们更深入探讨这样一个模块可能是什么样子之前，关于数据的重要性有一个小的补充说明：你可能听说过关于数据的“21 世纪石油”这个表达。这是为了强调数据已经成为商业组织如此重要的一部分，它可以与 20 世纪带来巨大工业进步的石油相提并论。

许多工业公司使用数据来跟踪他们的机器，优化生产，并将其与销售和股票联系起来，简而言之，通过“数字孪生”虚拟化工业流程以更好地控制它。但对于某些行业来说，数据甚至可能是原材料本身，如今许多数字原生公司纯粹通过数据收集、精炼和转售来赚钱，尤其是针对广告活动。

石油开采，自 20 世纪以来就已经发生，极大地加速了几乎所有领域的工业生产（重工业、铁路、化肥、农业机械等），同时也催生了众多公司自身进行石油的勘探和生产。这种比较是公平的，尽管在保持一些重要差异的同时需要谨慎。

首先，数据的类似物——石油裂化精炼塔——尚未发明，或者至少尚未以标准形式出现。当然，一些商业智能工具和大数据方法在某些情况下可以提供帮助，但数据项目失败率（据估计在 70%到 80%之间，取决于研究）表明，我们距离石油精炼厂的工业化还有很长的路要走。到目前为止，数据对于大多数公司来说仍然部分地处于未开发状态，就像 19 世纪末土地所有者对土地的态度一样：污染。当然，数据中存在价值，但它完全未被开发，且没有标准的方法来提取这种价值。

我们也不要忘记，数据仍然基于实际的石油：数据中心消耗了大量的能源（很快，地球上 8%的能源将被用于数字用途，这超过了航空旅行，并将很快达到汽车运输）。尽管一些数据中心所有者假装使用可再生能源（但只是购买补偿活动，这并不会减少全球石油消耗），但大多数数据中心仍然严重依赖石油作为能源。此外，服务器的生产、网络硬件的使用以及它们的运营功能都是能源的大消费者，最终也是石油的大消费者。

因此，我们必须牢记，数据确实可能成为下一个世纪的石油，但我们目前正处于这种状况。本章中描述的数据管理方法可以帮助你达到这一目标，特别是通过使用治理来提高数据质量，这仍然是阻碍数据利用的首要原因。

## 一个真正的“无所不知”的系统

我不会在本章中过多地详细阐述，因为 MDM 将在本书后面的专门章节中讨论，并且将结合一个真实案例进行解释，这有望使一切变得更容易。现在，我只会提出将 MDM 与“无所不知”的系统进行比较。确实，一个制作精良的 MDM 不仅会知道实体当前的状态，还会知道每个实体的整个故事，并记住它们的不同状态和修改，从摇篮（创建）到坟墓（存档或删除）。正因为如此，**持久性**是 MDM 模块的主要责任。

然而，还有一些其他的责任：

+   **研究的便捷性**：这与坚持一致，因为如果不提供数据，那么保留数据就没有太多意义。这个特定的责任可能在其实施过程中被委托出去，通常当 MDM 应用程序使用索引引擎时（全文搜索是一个复杂的问题，它证明了将责任分解成几个更原子的责任并委托给专门的模块是合理的）。

+   **报告/商业智能的来源**：就像数据搜索一样，报告是 MDM 模块可以委托给其他实现的重要责任，例如数据湖。

+   **处理实体多个版本的能力**：正如之前所解释的，一个真正的 MDM 应该知道数据实体的**每一个**版本，而不仅仅是它的“最新”状态（引号用来强调这个“最新”概念在许多系统中都是一个痛点，尤其是在分布式系统中，因为它依赖于数据的一致性，以及因此事务、乐观/悲观锁等等）。

+   **管理属性值验证的能力**：尽管这可能与 BRMS 共享责任，我们将在本章后面讨论 BRMS，但 MDM 本身可以执行少量验证以确保其基本一致性。这不应与数据正确性混淆，数据正确性取决于其目的（单一数据可以适用于商业用途但不适用于另一个用途），并且可以根据数据版本以及业务规则的变化而很好地变化。

+   **业务规则**：一些入门级业务规则，仅使用 MDM 系统内部的数据，也可以添加到 MDM 中，尽管如前所述，它们大多数都与验证有关。

+   **历史处理**：除了存储数据的连续版本外，MDM 还必须能够根据目标时间轻松检索这些版本，浏览历史记录，找出谁对数据进行了哪种类型的更改，等等。

如果这还不清楚，请不要担心——本书后面提供的关于一个 MDM 存储个人数据的例子将帮助您理解所有这些责任是如何被使用和实施的。

## 与 CQRS 的关系

如果你对数据架构感兴趣，你可能已经将存储数据版本化修改和搜索其不同状态之间的关注点分离识别为**命令和查询责任分离**（**CQRS**）的原则。我们确实在谈论相同的原则，即使 CQRS 远远超出了仅仅分离这两个责任，并提出了如何使它们一起工作的技术方法。

CQRS 是一个太大的主题，无法在本书中与其他所有主题一起处理，但它非常适合 MDM 模块的责任分离，我强烈建议你在创建 MDM 实现时使用这种方法。本书接下来几部分将要涵盖的例子将使用 CQRS 方法，尽管这是一个非常有限和简化的实现。再次强调，这是一个版本选择，因为添加完整的 Kafka 引擎会使我们难以专注于应用程序本身，并且会使我们远离本书的主题。

## 数据质量的需求

回到石油的比喻，里面含有沙子是一个真正的问题，因为石油必须被足够净化才能进入工厂。否则，不仅输出产品的质量不会很好，而且这还可能损坏这个极其昂贵的工业设备，即精炼塔。这就是为什么轻质原油是最好类型的石油之一，也是为什么来自沥青砂的天然气之所以如此昂贵进行精炼（除了对我们环境的灾难性影响）的原因。

在信息技术领域，数据与清洁数据之间有着强烈的等价性，因为清洁的数据是一个伟大的产品，它将允许对商业活动进行精确的报告，对可能出现的问题进行快速洞察，并总体上更好地控制公司。与行业内任何人讨论这个问题，每个人都会同意数据质量的重要性……然而，据估计，数据科学家的工作中超过一半的时间是用来清理数据的。我见过一些公司，这个比例危险地增加到了大约 80%。我说“危险”，有多个原因：

+   首先，为这样的低智商任务支付高薪是一种金钱的浪费

+   这通常也是一种浪费时间的行为，因为优秀的数据科学家通常会在接下来的 6 个月内离开工作，如果他们不得不花更多的时间在清理和组装数据上而不是“让它说话”

+   最后，它揭示了管道中的问题，因为发送这些脏数据的 IT 系统设计不正确，这意味着这些报告问题可能不是唯一的

为什么每个人都同意数据清洁的重要性，但情况仍然如此糟糕？好吧，恰好数据管理通常不是关于技术部分（这相当简单，因为我们现在有这么多工具）而是关于组织部分：谁负责哪些数据？谁有权利收集和更新它？哪个团队决定如何切割数据以及哪些数据进入这个或那个服务责任？所有这些问题都是所谓的数据治理的一部分，尽管它非常重要，但许多公司并没有处理这个问题，尽管他们拥有所有存储数据的工具。再次，这是与往常一样的根本原因：技术从未解决过组织问题，但编辑们非常擅长让你相信这一点……而且，作为一个公司老板，你非常希望它是真的！但是，不，你将不得不做一些不有趣的工作，比如数据分类，找到数据所有者和数据管理员，实施定期的会议来跟进决定的数据流程，等等。现在创建你的 MDM 模块正是做这件事的正确时机，因为它的成功很大程度上取决于这些行动。

## 设计一个通用的“参考”

几乎总是会有一个内部标识符来指代存储组织主要实体的软件应用程序，例如产品。大多数时候，人们会根据技术名称来称呼它——例如，“产品数据库”或“产品 Excel 文件”——但这是一种坏习惯，因为它将功能概念与技术、软件概念耦合在一起。这不仅可能分别发展（“产品文件”变成了“产品数据库”），而且它们应该尽可能多地这样做，因此应该保持分离。

从这个角度来看，“产品列表”已经有所改进，但我的最爱（因为它与我母语法语中的一个等效词非常接近）是将其称为“产品参照物”。这个名字承载着这样一个重要概念：它假定数据内部具有参考地位，同时也可以将其视为空间中的参照物，这回到了信息系统地图的概念，就像我们会有一个地理地图，其中包含参照物内的坐标。

重要提示

命名可能会更糟糕，正如我在*第三章*中提到的轶事，我的一个客户将文章的参照物简单地称为“Serge 的文件”。这导致了很多混淆，因为它隐藏了保持此文件最新状态的极端重要性，而这甚至不是 Serge 的正式工作！

大多数情况下，所谓的“参照物”都是针对单一类型的实体（产品、销售、客户等）。本章所描述的理想化系统的想法是，对于任何类型的实体都使用单一款软件。在本书的其余部分，我们不会深入探讨这个理想化系统，而将保持一种更标准的方法，即针对特定的业务领域实现一个参照物。这也使我们能够为每种情况采用最佳技术（“最好的面包”方法），而不是“一刀切”的方法，尽管在理论上很有趣，但在现实世界中却极其复杂。

## MDM 的实施选择

无论喜欢与否，Excel 仍然是你可以拥有的最简单的 MDM（主数据管理），在许多小型公司中，使用 Excel 进行良好的组织流程已经可以走得很远，前提是你已经消除了良好组织的重要缺陷（例如，一个集中式文件，不同用户有权限而不是到处都是副本，严格的数据质量组织等）。

当然，将需要一定程度的复杂性，这将导致专门的实现。这听起来很疯狂，但针对 MDM 的软件应用非常少。微软基于 SQL Server 提供了一项名为 Master Data Services 的解决方案，但它的使用听起来非常有限，至少在我的知识领域内是这样。在与微软讨论后，该产品确实已被放弃，其继任者是名为**Profisee**的合作伙伴产品，它与**Microsoft Purview**合作以提供数据治理功能([`learn.microsoft.com/en-us/azure/architecture/reference-architectures/data/profisee-master-data-management-purview`](https://learn.microsoft.com/en-us/azure/architecture/reference-architectures/data/profisee-master-data-management-purview))。Semarchy ([`www.semarchy.com`](https://www.semarchy.com))听起来是集成 MDM 的一种新颖且有趣的方法，但我还没有尝试足够多，无法推荐它。

我看到一些公司使用无头 CMS 系统，如 Strapi、Sanity、Cockpit、Prisma 等，来创建可以作为入门级 MDM 的后端。但这通常缺乏良好的数据版本控制系统，并且治理的实施仍然是集成商的工作。总的来说，这是一个非常基于技术的方案，如前所述，MDM 远不止是简单地存储数据。

这就是现成方法的概况，诚然这并不走得很远。我至今所见到的每一个 MDM 的正确实现都是一个专门的开发。一些商业应用程序，如 ERP，有时对产品或客户有良好的参考，但大多数都缺乏业务上的对齐。

小贴士

可能听起来逻辑上 ERP 可能不与业务对齐，因为它试图适用于许多业务领域。尽管如此，当你看到前五的 ERP 系统为顾客和供应商提出两个不同的领域，忽略了大多数现有公司可能的数据重复问题时，这表明问题不仅仅是商业的多样性，还有这些 ERP 公司的非常方法，他们认为建模业务是 100%客户的责任，而它应该是基于书面、向前兼容的标准共享责任。但这将违反供应商锁定，这不符合他们的利益，这就是为什么唯一的前进方式是客户选择一个接受业务实体表示标准的实现，包括在（罕见的）它们不存在的情况下开发这些标准。

剩余的——并且代表了运行中的大多数 MDM 系统——是专门的应用程序与数据库（有时是索引引擎，甚至是一个数据湖，如前所述）相结合。它们是由内部 IT 或外部软件公司为特定的业务用途定制的开发。如果你从全球的角度来看，许多公司的需求非常相似，那么这将是时间和金钱的巨大浪费。然而，由于软件行业缺乏使用的业务标准，目前这只是一个现状。

现在是理想系统的第二部分：在讨论数据之后，我们需要讨论业务规则。

# 理想系统中的规则管理

业务规则是应用于数据上的谓词，以帮助实施对业务必要的现实世界决策。例如，你可能声明，只要客户没有检查他们的银行坐标，就不能向他们发送产品。这是一个业务规则，因为它可以不带有任何软件实现的迹象来表述：这可以通过工厂中的人手动检查，通过电话与会计确认规则是否得到遵守，然后再将包裹发送给客户。

## 规则作为信息系统中的神经系统

如果数据是信息系统的血液，那么业务规则就是其神经和肌肉网络：它们利用血液以特定方式实现某些活动。在我们的比喻中，一个业务规则可能是“如果你感觉手指有灼热感，手臂必须缩回。”这个规则在我们的脊髓反射系统中得到实现，它使用手指中的传感器通过神经发送信息/数据，导致相关手臂的肌肉无法被控制。

在 IT 领域，业务规则的实现主要是所谓的应用程序。这通常是业务规则包含的地方。在我们的例子中，ERP 系统中必须有一些代码，它会警告包装准备系统客户尚未通过已验证的支付方式条件。包装系统的反应可能是这个订单将不会处理，或者可能是它将提前处理，但实际的物理包装将在发货前保留。实际的实现是每个模块的责任，但业务规则保持不变：“只要我们没有验证我们可以收到付款，就不会有客户交付订单”，

业务规则还包含你将在信息系统中执行的所有计算，从最复杂的到最平凡的。让我回到这一点，因为关于责任正确划分的某些事情需要说：**任何客户端（GUI 或调用 API 的应用程序）都不应该处理业务规则，这些规则始终必须在服务器端实现**。这肯定是你所知道的事情，听起来也很合理：毕竟，显然这些重要的功能推理必须集中化，以确保它们以相同的方式应用于所有地方。但看看任何客户端几分钟，你会发现有很多在本地做出的功能决策，有时甚至是最合理的。例如，考虑从毛额和增值税率计算净额。当然，增值税率在应用程序的生命周期中不会经常变化，计算方式本身也非常稳定，因此应该没有大问题，可以信任客户端进行这种计算，而且我们通过避免往返服务器而获得更好的性能。

好吧，但你总是可以想象业务规则会发生变化的方式。正如已经想象的那样，增值税率可能会变化。此外，如果我们谈论多行订单的净额计算，你必须在一个实体中处理多个增值税率。问题归结为风险管理：如果你知道你永远不会遇到这些特定情况，那没问题。如果你怀疑它们将来出现的可能性，你应该首先向你的产品所有者询问。如果他们对此不确定，你将不得不比较不同方法的开销：

+   您可以在所有客户端中硬编码业务规则并希望它不会演变。如果它们不多，并且您可以轻松升级它们，那就没问题。

+   您可以通过将利率作为您使用的应用程序的参数（当它们支持时）来为可能的变化做准备；这样在调整时已经更好、更容易，而且无需巨大的前期成本。

+   如果您预计在未来几年内业务规则将发生变化，并且您知道调整软件将会很复杂，那么您可能应该将规则放在服务器端、集中式的应用程序中。当然，它可能会稍微慢一些，但客户端缓存可以帮助，并且您将具备未来适应性。

+   如果您处于一个将发生大量业务变化的情况，并且许多业务规则需要处理，那么您将达到一个投资于一个专门用于管理您的业务规则的集中式软件是有意义的点。

## BRMS 作为处理业务规则的专用工具

现在，让我们集中关注最后一个假设，即您需要所谓的 **BRMS**。再次强调，这并不是您在每一个信息系统中都需要的功能模块，最简单的系统也不需要这样的安装努力。但请注意，大多数信息系统的起点都很简单，但会变得更加复杂。真正的困难在于，一旦您进入生产阶段，用 BRMS 定制替换现有规则将会更加困难，因为如果它们没有在 API 合同下统一，所有调用都必须更改。这就是为什么这个乌托邦式的信息系统是有意义的：它展示了如果您对您的信息系统认真负责，并且不想对其打任何赌，您应该做什么（并且不会隐藏投资的规模）。如果您从一开始就知道它将会增长，您的活动将会变得工业化，那么您应该从一些一开始可能看起来过于复杂和昂贵的工具开始，但它们将在未来带来巨大的回报。如果您对此不确信，只需阅读所有那些因为未投资于他们的信息系统而失败的初创公司的经验回报，尽管他们的想法得到了客户的认可，他们的定价合理，并且他们拥有市场：这是初创公司失败最常见的原因之一，也是大公司（后者通常不提供任何反馈）。

## 业务规则的常见实现

你会如何实施一个 BRMS？可能会让你微笑，但同样，Excel 通常是 BRMS 最简单的实现方式，大多数时候人们并不知道这一点。一个会计肯定会告诉你（如果你问的话），他们没有使用任何 BRMS 来完成工作。但与此同时，他们会吹嘘一个手工制作的 Excel 工作簿，其中包含了他们在日常工作中以及每月结算期间所需的所有计算（以及相应的业务规则，无论是监管还是公司层面的）。如果不是 BRMS，那又是什么呢？事实上，由于“真正的”专用 BRMS 相对较少使用，对于大多数小型公司来说，业务规则实际上都包含在 Excel 文件中。

在大型公司中，有更多的业务线应用，例如 ERP，或者当公司有内部软件开发能力时，甚至定制软件。在这种情况下，集成到应用中的业务规则比例上升，但这并不一定是最好的。为什么许多以业务为导向的人尽管存在缺点，却仍然喜欢 Excel 电子表格？简单来说，因为他们可以完全控制它，并且不需要依赖 IT 部门进行更改、添加功能等。在某个应用中开始实施业务规则，耦合问题立即显现：

+   是否可以在不重新编译、测试和重新部署应用的情况下更改规则？

+   如果规则可以定制，是否可以通过功能操作员来定制，或者你需要 IT 部门来实施更改（或者最好是在最佳情况下，对他们进行培训）？

+   我们如何处理必须在特定日期和时间更改的规则（例如，许多与会计相关的或业务范围内的报告规则在午夜 1 月 1 日）？

+   是否可以有两个业务规则的同时版本，或者我们是否必须停止软件在年底，以确保在新的一年规则更改之前没有任何操作（不要笑：这种情况经常发生……）？

尽管存在这些潜在问题，但在专用业务应用中实施业务规则已经是一个很大的进步，尤其是如果这是在服务器端完成的，最好是作为实现一个良好文档化的、以合同为先的 API。这种解决方案比 Excel 电子表格更不容易出错，因为规则的不同实现可能会在整个组织中传播，导致混乱。它还倾向于提供业务规则的第一级治理，因为不同的服务负责“他们”的软件应用，以及其中实施（或定制）的业务规则。

然而，这些实现并不能代表我们乌托邦式系统中的 BRMS，即一个包含公司所有业务规则的独特系统。而且，如果你想走上一条未来证明的信息系统之路，你可能会更倾向于使用像 Drools（一个开源包，由 Red Hat 的 JBoss Rules 实现）或 IBM Operational Decision Manager 这样的软件。这些软件通常会提供以下功能：

+   业务规则的执行，这提供了所谓的决策引擎（**DMN**代表**决策模型和符号**，是 BPMN 的伴随标准）。如果你想了解更多关于 BRMS 这个重要部分的信息，我推荐 Drools 提供的优秀文档页面，可在[`www.drools.org/learn/dmn.html`](https://www.drools.org/learn/dmn.html)找到。

+   这些业务规则的存储定义，听起来很显然，但当你加上存储整个业务规则版本历史的要求时，情况就不同了。

+   决策表的使用、事件和动作之间的链接，以及在最复杂的情况下，将混合许多不同规则以找到额外结论的推理引擎（一个过于简化的例子是“所有采购都需要发票”和“发票必须在标题中包含买方的地址”，到“所有采购都需要买方的地址”）。

+   其中一些提供了图形编辑器，让非技术人员能够自行调整规则。尽管编辑器声称任何人都可以使用，但它们仍然相当技术性，需要一些培训。

+   与此同时，沙盒对于人们在将业务规则调整投入生产之前进行测试非常有用。

+   根据所需的性能和调用变化的程度，缓存机制可以是一个很好的 BRMS 补充。

小贴士

Open Policy Agent 是一个专注于授权规则的 BRMS。我们将在*第十二章*中展示其用法。

最后，在讨论数据和业务规则之后，我们将添加第三个也是最后一个模块，以完成我们的理想 IT 系统。

# 理想系统中的流程管理

我们理想中的系统可以处理数据，并使用业务规则对其做出决策，但是什么让它运转呢？在*第四章*中，我们强调了一切都是时间的问题，但没有任何东西具有将数据和规则置于受控、基于时间的运动中的角色。这将是由流程引擎来扮演的角色。

## 流程作为信息系统的大脑

回到我们的人体比喻，你可能已经猜到，业务流程管理（BPM）作为协调包含业务规则的应用程序动作的模块，可以与大脑的控制塔相联系。正如我们的大脑协调每个肌肉的动作，同时接收来自我们五感的信号，以实现诸如接球、键盘打字或穿衣等复杂的结果，流程描述了信息系统每个部分必须完成的复杂任务，以实现全局目标，而 BPM 引擎协调这些任务，有效地调用负责的模块（或者更确切地说，API，这些 API 本身由技术模块实现；还记得我们在*第三章*中解释的重要观点吗）。

如果理想的信息系统由一个 MDM 和一个 BRMS 组成，包含每个业务领域的所有数据和所有业务规则，那么 BPM 就是使一切协同工作的模块，通过互操作所有功能。

## BPM 的实现

在谈论技术实现（这现在应该是一种本能）之前，我们必须尝试找到一个我们特征的可接受标准。幸运的是，一个无可争议的标准已经存在，我们之前已经讨论过：BPMN。所以，如果你在寻找一种执行流程的演变方式，其中引擎可以完全与设计解耦，你必须使用 BPMN。我已经在一个特定的编辑器的 GUI 上测试了编辑 BPMN 2.0，并在另一个编辑器的执行引擎上执行，它运行良好，这表明了该标准的成熟度。

当然，并非所有信息系统都需要我们讨论的这种复杂性，但它们在某个时候都会使用一个中央协调系统，即使大部分可以手动操作，流程可能甚至没有在 BPMN 中设计，而只是信息系统参与者头脑中知道（再次强调，这并不意味着一切都是基于计算机的）。而且你知道吗？当我们根本不需要任何复杂性时，我们会找到我们老朋友 Excel！

小贴士

到目前为止，我知道你一定认为我是一个绝对的 Excel 粉丝。然而，我并不是，我也亲眼见证了由于使用 Excel 处理共享数据、没有控制其在组织中的传播以及更多问题而导致的巨大功能问题。我完全清楚它如何通过让几乎每个人都能拥有信息系统的一小部分信息来阻止人们共同工作。但与此同时，我也不赞成忘记电子表格为 IT 和业务专家带来的所有贡献。而且，现在大多数信息系统如此不成熟也不是我的错！所以，如果你必须使用一个粗糙的工具来完成工作……那就这样吧！Excel 将长期成为信息系统的“瑞士军刀”。拥有一个完整的工具箱会更好，但如果你只能拥有一个工具，那就拿这把刀而不是拔钳或一些其他奇特且高度专业化的工具。回到软件上，现在对于 MDM、BRMS 和 BPM，比 Excel 电子表格更好的替代方案已经存在。然而，如果你意识到 Excel 的缺点并控制它们，其多功能性和易用性将使你在信息系统的许多部分中加快速度。特别是，尽管 MDM 和 BPM 在 Excel 之外要好得多，但我经常通过在 Excel 中放入复杂的计算并将电子表格插入 API 中，建立了一些“低质量的 BRMS”，并取得了巨大的商业成功。是的，这有点像是一种黑客行为，但只要它隐藏在 API 后面，这种临时、快速和简陋的实施就没有问题……而且业务用户非常喜欢它！

# 我们能有多接近这个乌托邦式的系统？

到目前为止，我们已经描述了理想信息系统的内容，这是由 Dominique Vauquier 在他的开创性著作中描述的。这种 MDM + BRMS + BPM 的组装也可以在其他一些来源中找到，例如，SHIFT 项目在其向更环保的 IT 行业数字化转型的方法中描述的“可持续信息系统”，或者**敏捷链管理系统**（**ACMS**）方法。

当然，这是一个理想化的愿景，所以问题不是将其用作实际信息系统都应该基于的蓝图，而是在设计新的信息系统或改进现有信息系统时，我们能够接近它有多近。

## 优先考虑上下文

各种上下文元素可能会促进本章讨论的方法的使用：

+   **全新的信息系统**：如果你足够幸运，可以从一个新创建的组织从头开始，那么遗产就不会阻碍你，这是一个可以使理想信息系统得以实现的巨大因素。

+   **复杂程度**：当然，这还远远不够，因为正如之前所述，只有当它得到商业的证明时，这样的理想系统才有其存在的空间。如果你的信息系统必须高度可进化，因为商业规则和市场经常变化，数据结构不明确，并且必须快速适应流程，那么这又是另一个可以促进之前所述架构采用的因素。

+   **投资批准**：再次强调，这个因素也不够，因为商业可能需要这样一个高度复杂的信息系统，但投资者可能没有意识到这一点。对于许多首席执行官来说，IT 只是一个成本中心。但如果你理解信息系统已经成为大多数工业活动的支柱，那么你又有了一个积极的因素。

+   **实施能力**：一切看似顺利，但不要低估实施这样一个信息系统所面临的困难。这种方法与大多数专业人士所知的方法大相径庭，以至于你很难找到能够部署它的人。你将不得不说服他们，培训他们，并让他们适应你的方式，而现有的反馈和经验回报非常有限。

诚然，这些因素有很多，而且你很可能现在没有它们。对于像我这样年龄的人来说，甚至有可能我们永远看不到这种完美的协调，使得这种乌托邦式的结构成为最常用的一个。但它确实存在——其优势是显而易见的，而且行业变化的加速和数字化转型将毫无疑问地使其成为一个越来越被观察到的选项。技术监控也显示，在过去 3 到 5 年中，MDM 的主题已经取得进展，一些先进的公司已经实施了它们，并伴随着一个内部开发者平台，带来了非常有趣的结果。简而言之，我们正处于趋势的初期，但波浪增长的可能性很高。

## 接近目标，敏捷的方式

这样的理想信息系统目前还不是主流，并且在未来也不会成为标准，这并不意味着它们没有兴趣。这就像一个在敏捷团队工作的人，他不想知道最终软件的愿景是什么，声称他们只对当前冲刺中将要完成的事情感兴趣！

同时也存在一个理想——一个愿景——来提供方向，指引我们的旅程。还记得箭的隐喻吗？我们必须知道目标的样子才能定位并达到它；否则，我们只是在漫无目的地四处走动，希望得到最好的结果。总之，请不要因为这一概念不是立即实用的就放弃它：了解它可以帮助你在未来在信息系统不同的方向之间做出选择，因为你将感觉更接近这个长期、理想的方向，这将为你带来更大的价值。可能性是，你永远无法达到理想状态，但希望，所采取的方向将为你的信息系统带来更多的价值和灵活性。如今信息系统的情况如此糟糕，拥有一些高于平均水平的东西在所有工业流程数字化时代已经是一个巨大的优势。

# 摘要

在本章中，我们展示了可能是一个理想的信息系统。我们讨论了在软件工业部署中可能出现的所有问题，特别是关于它们的演变，因此展示不仅限于点解决方案，还展示了如何全局性地解决这些问题。当然，这一方法的大部分仍然是乌托邦式的，但这一练习有趣之处在于它表明，如果构建得非常好，只有三个模块就可以满足任何商业需求。数据、业务规则和业务流程之间的分离是即使在您工作的信息系统远非理想的情况下也应该记住的事情。

本章相当概念化，但这本书的第一部分就此结束，这部分旨在涵盖大量的理论背景。本书的下一部分将涵盖更多关于架构的实用方法，为了完全阐述理论与实践（这是本书的主要前提），第三部分将提供源代码，展示如何实现我们讨论过的良好架构的概念和方法。特别是，这里解释的三个主要模块将在一个具有有限功能范围的示例应用程序中展示，但具有所有成长为完整信息系统的必要复杂性：

+   MDM 将基于 NoSQL 数据库，后端服务器使用 ASP.NET，并公开 API 设计的合同优先

+   将使用一个独立的 BRMS 进行授权管理

+   将采用 BPM 方法来展示如何使流程可调整，使用低代码实现

总结来说，在接下来的七个章节中，我们将通过使用适用于所需用例各部分的示例，运用经过实战检验的方法来设计示例应用程序。在接下来的五个章节中，我们将分模块实现这个示例应用程序。最后，最后三个章节将讨论部署和调整这个示例应用程序，就像它在生产环境中一样。随着时间的推移，需要做出调整以保持其与功能业务需求的一致性。

# 进一步阅读

*一个可持续的信息系统 - 使用 SOA 对信息系统进行渐进式翻新*，作者：皮埃尔·博内/让-米歇尔·德塔弗尼耶 - 多米尼克·瓦奎尔 - 赫尔墨斯 / 拉瓦锡 - 2007 年 11 月 - ISBN-13: 978-2746218291

# 第二部分：架构框架和方法

在第一部分，它相当理论化，因此即使没有技术背景的读者也能理解之后，本书的第二部分*第二部分*变得更加实用，并解释了如何将某些原则应用于信息系统的架构层面，以使其更加完善。这就是我们将讨论如何设计与业务良好对齐的低耦合服务的方法。将涵盖通用软件原则，但也会涉及更广泛的方法，例如授权管理和业务规则的外部化。在业务/IT 对齐的信息系统中管理数据的正确方法也将被详细阐述。

本部分包括以下章节：

+   *第六章*，*SOLID 原则，从代码到系统*

+   *第七章*，*C4 和其他方法*

+   *第八章*，*面向服务的架构和 API*

+   *第九章*，*探索领域驱动设计和语义*

+   *第十章*，*主数据管理*

+   *第十一章*，*业务流程和低代码*

+   *第十二章*，*业务规则的外部化*

+   *第十三章*，*授权的外部化*
