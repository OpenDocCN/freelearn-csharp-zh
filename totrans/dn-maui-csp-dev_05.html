<html><head></head><body>
		<div id="_idContainer066">
			<h1 id="_idParaDest-88" class="chapter-number"><a id="_idTextAnchor092"/>5</h1>
			<h1 id="_idParaDest-89"><a id="_idTextAnchor093"/>Advanced Controls</h1>
			<p>In the previous chapter, we looked at a number of controls and how to handle their events and commands. In this chapter, we’ll look at moving the logic into <strong class="source-inline">ViewModel</strong> using commands and messaging. We’ll then go on to cover Styles, which let you provide a uniform appearance to your controls with <span class="No-Break">little effort.</span></p>
			<p>One key feature of a well-designed user experience is that when something is going to take more than a second or so, you let the user know that the app is working on it so that it doesn’t look like your <span class="No-Break">app froze.</span></p>
			<p>In this chapter, we will cover the <span class="No-Break">following topics:</span></p>
			<ul>
				<li>Keeping the user informed <span class="No-Break">of activity</span></li>
				<li>Moving event handling <span class="No-Break">to </span><span class="No-Break"><strong class="source-inline">ViewModel</strong></span></li>
				<li>Sending and <span class="No-Break">receiving messages</span></li>
				<li><span class="No-Break">Displaying collections</span></li>
				<li><span class="No-Break">Styles</span></li>
			</ul>
			<h1 id="_idParaDest-90"><a id="_idTextAnchor094"/>Technical requirements</h1>
			<p>For this chapter, you will need Visual Studio. You can find the source code for this chapter here: <a href="https://github.com/PacktPublishing/.NET-MAUI-for-C-Sharp-Developers/tree/MVVMAndControls">https://github.com/PacktPublishing/.NET-MAUI-for-C-Sharp-Developers/tree/MVVMAndControls</a>. If you want to follow along, continue with the project you were working on in <a href="B19723_04.xhtml#_idTextAnchor054"><span class="No-Break"><em class="italic">Chapter 4</em></span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-91"><a id="_idTextAnchor095"/>Keeping the user informed of activity</h1>
			<p>There are two ways to let the user know<a id="_idIndexMarker200"/> that your application is working on <span class="No-Break">something time-consuming:</span></p>
			<ul>
				<li><span class="No-Break"><strong class="source-inline">ActivityIndicator</strong></span></li>
				<li><span class="No-Break"><strong class="source-inline">ProgressBar</strong></span></li>
			</ul>
			<p><strong class="source-inline">ActivityIndicator</strong> essentially says, “I’m working on it, but I don’t know how long it will take,” whereas <strong class="source-inline">ProgressBar</strong> says, “I’m working on it, and I’m about halfway done.” Let’s explore each of these in a bit <span class="No-Break">more detail.</span></p>
			<h2 id="_idParaDest-92"><a id="_idTextAnchor096"/>ActivityIndicator</h2>
			<p>We’ll start<a id="_idIndexMarker201"/> by adding <strong class="source-inline">ActivityIndicator</strong> to the login page below <span class="No-Break">the Buttons:</span></p>
			<pre class="source-code">
&lt;ActivityIndicator
    Color="Blue"
    IsRunning="{Binding ActivityIndicatorIsRunning}" /&gt;</pre>
			<p>Notice that the <strong class="source-inline">IsRunning</strong> property is bound to the <strong class="source-inline">ActivityIndicatorIsRunning</strong> property. That property is in <strong class="source-inline">LoginViewModel</strong> (you’ll remember that we set that file as the <span class="No-Break">binding context):</span></p>
			<pre class="source-code">
[ObservableProperty] private bool activityIndicatorIsRunning   = true;</pre>
			<p>I’ve set its default value to <strong class="source-inline">true</strong>, so the activity indicator will be running when the page comes up. Let’s shut it off after creating <span class="No-Break">the account:</span></p>
			<pre class="source-code">
private async void OnCreate(object sender, EventArgs e)
{
  CancellationTokenSource =
    new CancellationTokenSource();
  var message = "Your account was created";
  var dismissalText = "Click Here to Close the SnackBar";
  TimeSpan duration = TimeSpan.FromSeconds(10);
  Action  = async () =&gt;
    await DisplayAlert(
      "Snackbar Dismissed!",
      "The user has dismissed the snackbar",
      "OK");
  var snackbarOptions = new SnackbarOptions
  {
    BackgroundColor = Colors.Red,
    TextColor = Colors.Yellow,
    ActionButtonTextColor = Colors.Black,
    CornerRadius = new CornerRadius(20),
    Font = Microsoft.Maui.Font.SystemFontOfSize(14),
    ActionButtonFont = Microsoft.Maui.Font
      .SystemFontOfSize(14)
  };
  var snackbar = Snackbar.Make(
    message,
    action,
    dismissalText,
    duration,
    snackbarOptions);
  await snackbar.Show(cancellationTokenSource.Token);
  vm.ActivityIndicatorIsRunning = false;
}</pre>
			<p>Nothing has changed in the create<a id="_idIndexMarker202"/> page code except the addition of the final line. Here we reach into <strong class="source-inline">ViewModel</strong> and set the <strong class="source-inline">ActivityIndicatorIsRunning</strong> property to <strong class="source-inline">false</strong>. That should stop <strong class="source-inline">ActivityIndicator</strong> whose <strong class="source-inline">IsRunning</strong> property is bound <span class="No-Break">to </span><span class="No-Break"><strong class="source-inline">showActivityIndicator</strong></span><span class="No-Break">.</span></p>
			<p>The result looks like <span class="No-Break"><em class="italic">Figure 5</em></span><span class="No-Break"><em class="italic">.1</em></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer060" class="IMG---Figure">
					<img src="image/Figure_5.1_B19723.jpg" alt="Figure 5.1 – ActivityIndicator&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.1 – ActivityIndicator</p>
			<p class="callout-heading">Working or hung?</p>
			<p class="callout">Note that under some circumstances, your program<a id="_idIndexMarker203"/> might hang, yet the activity indicator will continue spinning. This can cause enormous confusion and frustration for your user. One way to escape that problem is to set a timer, and if the task doesn’t complete in <em class="italic">n</em> seconds, you stop the indicator and, for example, display an error dialog. Of course, if everything is hung, you won’t be able to do that, but typically, the indicator will have frozen <span class="No-Break">as well.</span></p>
			<p><strong class="source-inline">ActivityIndicator</strong> is great, but it only<a id="_idIndexMarker204"/> tells the user that something is happening, not how far it has progressed in its task. That is what <strong class="source-inline">ProgressBar</strong> <span class="No-Break">is for.</span></p>
			<h2 id="_idParaDest-93"><a id="_idTextAnchor097"/>ProgressBar</h2>
			<p><strong class="source-inline">ProgressBar</strong> divides a task into fractional<a id="_idIndexMarker205"/> parts (for example, percentages) and displays what part (fraction, percentage, and so on) has been completed. We’ve all seen progress bars: ideally, they move smoothly across the screen; in fact, they often move in fits and starts as the task they are <span class="No-Break">tracking completes.</span></p>
			<p>We’re going to create a progress bar, but we are going to fake an action. That is, we’ll progress the bar based on time rather than actual progress in a task. Nonetheless, the workings of <strong class="source-inline">ProgressBar</strong> will <span class="No-Break">become evident.</span></p>
			<p>To get started, let’s comment out <strong class="source-inline">ActivityIndicator</strong> in <strong class="source-inline">LoginPage.xaml</strong>, and replace it <span class="No-Break">with </span><span class="No-Break"><strong class="source-inline">ProgressBar</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
&lt;!--&lt;ActivityIndicator
    Color="Blue"
    IsRunning="{Binding ActivityIndicatorIsRunning}" /&gt;--&gt;
&lt;ProgressBar
    ProgressColor="Blue"
    x:Name="LoginProgressBar" /&gt;</pre>
			<p>Here we have declared <strong class="source-inline">ProgressBar</strong> with only two properties: its color and its name. The name allows us to refer to the bar in the code-behind. We would, of course, normally update <strong class="source-inline">ProgressBar</strong> based on data in the <strong class="source-inline">ViewModel</strong>, but for now, as we have done before, we’ll do that work in the <span class="No-Break">code-behind (</span><span class="No-Break"><strong class="source-inline">LoginPage.xaml.cs</strong></span><span class="No-Break">).</span></p>
			<p>Here is the code that will start and advance the progress bar based on the user clicking the <span class="No-Break"><strong class="bold">Submit</strong></span><span class="No-Break"> button:</span></p>
			<pre class="source-code">
private async void OnSubmit(object sender, EventArgs e)
{
  for (double i = 0.0; i &lt; 1.0; i += 0.1)  [1]
  {
    await LoginProgressBar.ProgressTo(i, 500,
      Easing.Linear); [2]
  }
  await DisplayAlert(  [3]
    "Submit",
    $"You entered {vm.Name} and {vm.Password}",
    "OK");
}</pre>
			<p>[1] We will set the value of <strong class="source-inline">ProgressBar</strong> based on the value of the counter variable (<strong class="source-inline">i</strong>) in the <strong class="source-inline">for</strong> loop. The <strong class="source-inline">ProgressBar</strong> values range from <strong class="source-inline">0</strong> to <strong class="source-inline">1</strong>, with the percentage or fraction of progress measured as values between those two numbers. Here, we initialize the counter variable to <strong class="source-inline">0.0</strong>, and until it reaches the <strong class="source-inline">1.0</strong> value, we increment <span class="No-Break">by one-tenth.</span></p>
			<p>[2] Within the <strong class="source-inline">for</strong> loop, we call <strong class="source-inline">ProgressTo</strong> on <strong class="source-inline">ProgressBar</strong>. That method takes <span class="No-Break">three values:</span></p>
			<ol>
				<li>The value we want to <span class="No-Break">progress to</span></li>
				<li>The amount of time to get there, <span class="No-Break">in milliseconds</span></li>
				<li>The easing (see the <span class="No-Break">following section)</span></li>
			</ol>
			<p>[3] The action we’ll take when the progress <span class="No-Break">bar completes.</span></p>
			<p>Another related<a id="_idIndexMarker206"/> feature is <em class="italic">Easing</em>, which refers to how quickly an action goes from start to full speed. Let’s take a look at that in a bit <span class="No-Break">more depth.</span></p>
			<h3>Easing</h3>
			<p><em class="italic">Easing</em> refers to the pattern<a id="_idIndexMarker207"/> of how an item<a id="_idIndexMarker208"/> moves. For example, a train does not go from standing still in the station to racing along at 75 miles per hour all at once; it <em class="italic">eases</em> into the final speed. If you drew a graph of the acceleration, it would look like a sine wave, and two of the enumerated values of easing are, in fact, <strong class="source-inline">SineIn</strong> (for the pattern of starting up) and <strong class="source-inline">SineOut</strong> (for the pattern of coming back into <span class="No-Break">the station).</span></p>
			<p>In our case, however, we want the progress bar to move smoothly and at a constant speed, which is what <span class="No-Break"><strong class="source-inline">easing.Linear</strong></span><span class="No-Break"> does.</span></p>
			<p>The net effect is that the progress bar will be animated across its entire course. We know that we are moving from <strong class="source-inline">0</strong> to <strong class="source-inline">1</strong> in tenths, and we know that we are taking half a second (500 milliseconds) to go each one-tenth of the way; thus, we know that the entire trip from <strong class="source-inline">0.0</strong> (nothing showing on the bar) to <strong class="source-inline">1.0</strong> (the bar fully filled with color) will take <span class="No-Break">five seconds.</span></p>
			<p>At the conclusion of our <strong class="source-inline">for</strong> loop, the dialog will pop up, giving a nice simulation of the completion of the task that the progress bar was tracking. A snapshot of that progress is shown in <span class="No-Break"><em class="italic">Figure 5</em></span><span class="No-Break"><em class="italic">.2</em></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer061" class="IMG---Figure">
					<img src="image/Figure_5.2_B19723.jpg" alt="Figure 5.2 – The progress bar is about 75% of the way toward completion&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.2 – The progress bar is about 75% of the way toward completion</p>
			<p>For convenience<a id="_idIndexMarker209"/> and to keep things<a id="_idIndexMarker210"/> simple, we’ve been using the code-behind for event handling. Of course, as noted in <a href="B19723_03.xhtml#_idTextAnchor036"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>, there are good reasons to use<a id="_idIndexMarker211"/> commands rather than events and to handle<a id="_idIndexMarker212"/> them in <strong class="source-inline">ViewModel</strong>. Let’s look at <span class="No-Break">that next.</span></p>
			<h1 id="_idParaDest-94"><a id="_idTextAnchor098"/>Moving event handling to ViewModel</h1>
			<p>Suppose that when<a id="_idIndexMarker213"/> a Button<a id="_idIndexMarker214"/> is pressed, we want<a id="_idIndexMarker215"/> to handle that fact in the <strong class="source-inline">ViewModel</strong>, as is preferred by the <strong class="bold">Model-View-ViewModel</strong> (<strong class="bold">MVVM</strong>) pattern. However, one of the things we want to do, in response to that Button press, is to show <span class="No-Break">a </span><span class="No-Break"><strong class="source-inline">ProgressBar</strong></span><span class="No-Break">.</span></p>
			<p>Handling<a id="_idIndexMarker216"/> things in <strong class="source-inline">ViewModel</strong> gets tricky when we want to interact with the <strong class="bold">user interface</strong> (<strong class="bold">UI</strong>). However, it can be done in a number of ways. Let’s modify the <strong class="bold">Submit</strong> button, remove its <strong class="source-inline">Clicked</strong> event and add <span class="No-Break">a command:</span></p>
			<pre class="source-code">
&lt;Button
    BackgroundColor="Gray"
    Command="{Binding SubmitCommand}"
    Margin="5"
    Text="Submit" /&gt;</pre>
			<p>We’ll create <strong class="source-inline">RelayCommand</strong> in <strong class="source-inline">ViewModel</strong> to handle the <span class="No-Break"><strong class="source-inline">Submit</strong></span><span class="No-Break"> Command:</span></p>
			<pre class="source-code">
[RelayCommand]
private async void Submit()
{
  for (var i = 0.0; i &lt; 1.0; i += 0.1)
  {
    await LoginPage.LoginProgressBar.ProgressTo(i, 500,
      Easing.Linear); [1]
  }
  await Application.Current.MainPage.DisplayAlert(
     [2]
    "Submit",
    $"You entered {Name} and {Password}",
    "OK");
}</pre>
			<p>[1] Access <strong class="source-inline">LoginProgressBar</strong> on <strong class="source-inline">LoginPage</strong> (more later on how to do that) and call <strong class="source-inline">ProgressTo</strong> as we <span class="No-Break">saw earlier.</span></p>
			<p>[2] Access <strong class="source-inline">MainPage</strong> through<a id="_idIndexMarker217"/> the <strong class="source-inline">Application</strong> object<a id="_idIndexMarker218"/> and <span class="No-Break">call </span><span class="No-Break"><strong class="source-inline">DisplayAlert</strong></span><span class="No-Break">.</span></p>
			<p>So, how are we going to access the <strong class="source-inline">LoginProgressBar</strong> in the UI? We need a static member of <strong class="source-inline">LoginPage</strong> to accomplish<a id="_idIndexMarker219"/> this. We’ll pull the declaration of <strong class="source-inline">LoginProgressBar</strong> out of the <strong class="bold">Extensible Application Markup Language</strong> (<strong class="bold">XAML</strong>) and move it into <span class="No-Break">the code-behind:</span></p>
			<pre class="source-code">
public static ProgressBar LoginProgressBar;</pre>
			<p>We need to be sure to initialize this in the constructor <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">LoginPage</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
public LoginPage()
{
  LoginProgressBar = new ProgressBar();</pre>
			<p>We’re going to need to refer to <strong class="source-inline">StackLayout</strong> if we want to add that to <strong class="source-inline">ProgressBar</strong>, so let’s name it <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
&lt;VerticalStackLayout x:Name="LoginStackLayout"&gt;</pre>
			<p>Now we’re ready to add <strong class="source-inline">ProgressBar</strong> to the children of <strong class="source-inline">StackLayout</strong>. Here’s the <span class="No-Break">complete constructor:</span></p>
			<pre class="source-code">
public LoginPage()
{
  LoginProgressBar = new ProgressBar();
  InitializeComponent();  [1]
  LoginStackLayout.Children.Add(LoginProgressBar); [2]
  BindingContext = vm;
}</pre>
			<p>[1] Notice that <strong class="source-inline">InitializeComponent</strong> comes before adding <strong class="source-inline">ProgressBar</strong> to the children of <strong class="source-inline">StackLayout</strong>. Until this is called, <strong class="source-inline">LoginStackLayout</strong> will <span class="No-Break">be null.</span></p>
			<p>[2] By calling <strong class="source-inline">Add</strong> here, <strong class="source-inline">LoginProgressBar</strong> is added to <strong class="source-inline">LoginStackLayout</strong> below<a id="_idIndexMarker220"/> the controls<a id="_idIndexMarker221"/> created in <span class="No-Break">the XAML.</span></p>
			<p>Huh? Let’s take it step <span class="No-Break">by step.</span></p>
			<h2 id="_idParaDest-95"><a id="_idTextAnchor099"/>Breaking it down</h2>
			<p>Here is the order of what happens when you run this, enter your username and password, and <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Submit</strong></span><span class="No-Break">:</span></p>
			<ol>
				<li><strong class="source-inline">ProgressBar</strong> is added to the page in the <span class="No-Break">page constructor.</span></li>
				<li>When you click on <strong class="bold">Submit</strong>, <strong class="source-inline">SubmitCommand</strong> is sent <span class="No-Break">to </span><span class="No-Break"><strong class="source-inline">ViewModel</strong></span><span class="No-Break">.</span></li>
				<li><strong class="source-inline">ViewModel</strong> handles that in <span class="No-Break"><strong class="source-inline">Submit</strong></span><span class="No-Break">, </span><span class="No-Break"><strong class="source-inline">RelayCommand</strong></span><span class="No-Break">.</span></li>
				<li>In <strong class="source-inline">RelayCommand</strong>, it updates the (<span class="No-Break">static) </span><span class="No-Break"><strong class="source-inline">LoginProgressBar</strong></span><span class="No-Break">.</span></li>
				<li>It then calls <strong class="source-inline">DialogBox</strong> through <strong class="source-inline">MainPage</strong>, which it has access to through the <span class="No-Break"><strong class="source-inline">Application</strong></span><span class="No-Break"> object.</span></li>
			</ol>
			<p>This works beautifully but is a bit labored. The use of <strong class="source-inline">Application.Current.MainPage</strong> is not unusual, but<a id="_idIndexMarker222"/> the hoops we jumped<a id="_idIndexMarker223"/> through to access <strong class="source-inline">ProgressBar</strong> are. The solution to that is to use <strong class="source-inline">Messaging</strong>, which is <span class="No-Break">covered next.</span></p>
			<p class="callout-heading">Visibility</p>
			<p class="callout">It is generally considered best practice for <strong class="source-inline">ViewModel</strong> not to see aspects of the view (as it does here). In the next example, we will isolate the VM from <span class="No-Break">the view.</span></p>
			<h1 id="_idParaDest-96"><a id="_idTextAnchor100"/>Sending and receiving messages</h1>
			<p>Rather than reaching<a id="_idIndexMarker224"/> into <strong class="source-inline">View</strong>, we can have <strong class="source-inline">ViewModel</strong> signal <strong class="source-inline">View</strong> when it is time<a id="_idIndexMarker225"/> to display the dialog or other <span class="No-Break"><strong class="source-inline">View</strong></span><span class="No-Break">-dependent element.</span></p>
			<p>For example, suppose we want to show <strong class="source-inline">Snackbar</strong> when the user clicks on the <strong class="bold">Create</strong> button. Rather than using an event handler, we can use <strong class="source-inline">Command</strong> (which is preferred because it puts the logic into <strong class="source-inline">ViewModel</strong>). <strong class="source-inline">ViewModel</strong> might then massage data or otherwise do whatever it needs to do, and then signal <strong class="source-inline">View</strong> to display <strong class="source-inline">Snackbar</strong> by sending out a message to <span class="No-Break">that effect.</span></p>
			<p>The idea is that <strong class="source-inline">ViewModel</strong> publishes a message such as “anyone who has subscribed to this message, show a <strong class="source-inline">Snackbar</strong>” and the page subscribes to that message and so shows <strong class="source-inline">Snackbar</strong> when the message <span class="No-Break">is received.</span></p>
			<p>In some circumstances, there may be more than one <strong class="bold">Subscriber</strong>. For that matter, in some circumstances, more than one <strong class="bold">Publisher</strong> can send the same message, as shown in <span class="No-Break"><em class="italic">Figure 5</em></span><span class="No-Break"><em class="italic">.3</em></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer062" class="IMG---Figure">
					<img src="image/Figure_5.3_B19723.jpg" alt="Figure 5.3 – Publish and Subscribe&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.3 – Publish and Subscribe</p>
			<p class="callout-heading">Messaging center</p>
			<p class="callout">.NET MAUI has a built-in messaging system, but it has been deprecated in favor of <strong class="source-inline">WeakReferenceMessenger</strong> provided in the .NET Community Toolkit MVVM, which we will <span class="No-Break">cover next.</span></p>
			<h2 id="_idParaDest-97"><a id="_idTextAnchor101"/>Getting started with WeakReferenceMessenger</h2>
			<p>To set this up, first create<a id="_idIndexMarker226"/> a class that will serve as the message. You can create this class anywhere that both <strong class="source-inline">View</strong> and <strong class="source-inline">ViewModel</strong> can see it. For convenience, I’ll put it above the <span class="No-Break"><strong class="source-inline">LoginPage</strong></span><span class="No-Break"> class:</span></p>
			<pre class="source-code">
public partial class ConstructMessage {}</pre>
			<p>Next, in the <strong class="source-inline">LoginPage</strong> constructor, we need to register to receive such a message. Once you receive the message you might call a method, or alternatively, you’ll use a Lambda expression to do <span class="No-Break">the work.</span></p>
			<p>To register to receive the message, use the <strong class="source-inline">WeakReferenceMessenger's Register</strong> method. Here is the code to <span class="No-Break">do so:</span></p>
			<pre class="source-code">
    WeakReferenceMessenger.Default.Register
      &lt;ConstructMessage&gt; (this, async ( m,e) =&gt;
    {
             // …
     });</pre>
			<p>What goes between the opening and closing braces is whatever you want to do when you receive that message. I’ve moved the code we were using in the event handler <span class="No-Break">to here:</span></p>
			<pre class="source-code">
    WeakReferenceMessenger.Default.Register
      &lt;ConstructMessage&gt; (this, async ( m,e) =&gt;
    {
      CancellationTokenSource =
        new CancellationTokenSource();
      var message = "Your account was created";
      var dismissalText = "Click Here to Close the
        SnackBar";
      TimeSpan duration = TimeSpan.FromSeconds(10);
      Action = async () =&gt;
        await DisplayAlert(
          "Snackbar Dismissed!",
          message,
          "OK");
      var snackbarOptions = new SnackbarOptions
      {
        BackgroundColor = Colors.Red,
        TextColor = Colors.Yellow,
        ActionButtonTextColor = Colors.Black,
        CornerRadius = new CornerRadius(20),
        Font = Microsoft.Maui.Font.SystemFontOfSize(14),
        ActionButtonFont = Microsoft.Maui.Font
          .SystemFontOfSize(14)
      };
      var snackbar = Snackbar.Make(
        message,
        action,
        dismissalText,
        duration,
        snackbarOptions);
      await snackbar.Show(cancellationTokenSource.Token);
      vm.ActivityIndicatorIsRunning = false;
    });</pre>
			<p>Now, all we need<a id="_idIndexMarker227"/> to do is revise <strong class="source-inline">LoginPage.xaml</strong> so that the <strong class="bold">Create Account</strong> button calls a command in <strong class="source-inline">ViewModel</strong>, rather than an event handler in <span class="No-Break">the code-behind:</span></p>
			<pre class="source-code">
&lt;Button
    BackgroundColor="Gray"
    Command="{Binding CreateCommand}"
    Margin="5"
    Text="Create Account" /&gt;</pre>
			<p>This will invoke the Create relay method in <span class="No-Break">the </span><span class="No-Break"><strong class="bold">ViewModel</strong></span></p>
			<pre class="source-code">
[RelayCommand]
private void Create()
{
  WeakReferenceMessenger.Default.Send(new CreateMessage());
}</pre>
			<p><strong class="source-inline">ViewModel</strong> calls the <strong class="source-inline">Send</strong> method, sending in an instance of <strong class="source-inline">ConstructMessage</strong> as a signal to any registered listeners to take some action. The <strong class="source-inline">Create</strong> method might, before sending that message, do other work that is best done in <strong class="source-inline">ViewModel</strong> rather <span class="No-Break">than code-behind.</span></p>
			<p>This is a much cleaner way of <em class="italic">decoupling</em> <strong class="source-inline">ViewModel</strong> and <strong class="source-inline">View</strong> when we need to have logic in <strong class="source-inline">ViewModel</strong> take an action that can only be taken <span class="No-Break">by </span><span class="No-Break"><strong class="source-inline">View</strong></span><span class="No-Break">.</span></p>
			<p><strong class="source-inline">WeakReferenceMessenger</strong> can also be used to communicate from one <strong class="source-inline">ViewModel</strong> <span class="No-Break">to another.</span></p>
			<p>Finally, it is called <strong class="source-inline">WeakReferenceMessenger</strong> in distinction from stet <strong class="source-inline">StrongReferenceMessenger</strong>. The advantage of <strong class="source-inline">WeakReferenceMessenger</strong>, and the reason it is generally what is chosen, is that it manages<a id="_idIndexMarker228"/> its own memory and cleanup, so you don’t <span class="No-Break">have to.</span></p>
			<h1 id="_idParaDest-98"><a id="_idTextAnchor102"/>Creating the page in C#</h1>
			<p>Before moving on, and to reinforce<a id="_idIndexMarker229"/> the fact that <a id="_idIndexMarker230"/>anything you can do in XAML you can do in C#, here is the version of <strong class="source-inline">LoginPage</strong> that we will be using in Forget Me Not (ForgetMeNotDemo) written in C# (in the repo, this page is <span class="No-Break">called </span><span class="No-Break"><strong class="source-inline">LoginCS</strong></span><span class="No-Break">):</span></p>
			<pre class="source-code">
using CommunityToolkit.Maui.Markup;
using static CommunityToolkit.Maui.Markup.GridRowsColumns;
namespace ForgetMeNot.View
{
    class LoginCS : ContentPage
    {
        public LoginCS(LoginViewModel viewModel)  [1]
        {
            BindingContext = viewModel;
            var activity = new ActivityIndicator() [2]
            {
                HeightRequest = 50,
                Color = Color.FromRgb(0, 0, 0xF),
            };
            activity.IsEnabled = viewModel
              .ShowActivityIndicator; [3]
            Content = new VerticalStackLayout()
            {
                Children = [4]
                {
                    activity,
                    new Grid()  [5]
                    {
                        RowDefinitions = GridRowsColumns
                          .Rows.Define(
                            (Row.Username,Auto),
                            (Row.Password,Auto),
                            (Row.Buttons, Auto)
                            ),
                        ColumnDefinitions = GridRowsColumns
                          .Columns.Define(
                            (Column.Submit,Star),
                            (Column.Create, Star),
                            (Column.Forgot, Star)
                            ),
                        Children =
                        {
                            new Label()
                                .Text("User name")
                                .Row(Row.Username)
                                   .Column(0), [6]
                            new Entry()
                                .Placeholder("User name")
                                .Bind(Entry.TextProperty,
                                   nameof(LoginViewModel
                                     .LoginName))
                                .Row(Row.Username)
                                  .Column(1)
                                .ColumnSpan(2),
                            new Label()
                                .Text("Password")
                                .Row(Row.Password)
                                  .Column(0),
                            new Entry {IsPassword = true}
                                .Placeholder("Password")
                                .Bind(Entry.TextProperty,
                                 nameof(LoginViewModel
                                 .Password))
                                .Row(Row.Password)
                                  .Column(1)
                                .ColumnSpan(2),
                            new Button()
                                .Text("Submit")
                                .Row(Row.Buttons)
                                  .Column(Column.Submit)
                                .BindCommand(nameof
                                  (LoginViewModel
                                    .DoLoginCommand)),
                            new Button()
                                .Text("Create Account")
                                .Row(Row.Buttons)
                                  .Column(Column.Create)
                                .BindCommand(nameof
                                  (LoginViewModel
                                 .DoCreateAccountCommand)),
                            new Button()
                                .Text("Forgot Password")
                                .Row(Row.Buttons)
                                   .Column(Column.Forgot)
                                .BindCommand(nameof
                                (LoginViewModel
                                .ForgotPasswordCommand))
                        }
                    }
                }
            };
        }
    }
    enum Row
    {
        Username,
        Password,
        Buttons
    }
    enum Column
    {
        Submit,
        Create,
        Forgot
    }
}</pre>
			<p>[1] We start by declaring the class and giving it <strong class="source-inline">LoginViewModel</strong>. This is done by <em class="italic">dependency injection</em>, a topic covered in detail in <a href="B19723_09.xhtml#_idTextAnchor160"><span class="No-Break"><em class="italic">Chapter 9</em></span></a><span class="No-Break">.</span></p>
			<p>[2] <strong class="source-inline">ActivityIndicator</strong> is instantiated; it will be added to the <span class="No-Break">page later.</span></p>
			<p>[3] The <strong class="source-inline">IsEnabled</strong> property of <strong class="source-inline">ActivityIndicator</strong> is bound to a property <span class="No-Break">in </span><span class="No-Break"><strong class="source-inline">ViewModel</strong></span><span class="No-Break">.</span></p>
			<p>[4] We add to <strong class="source-inline">StackLayout</strong> by adding to its <span class="No-Break"><strong class="source-inline">Children</strong></span><span class="No-Break"> collection.</span></p>
			<p>[5] We haven’t covered <strong class="source-inline">Grid</strong> yet, but you can see that it is a layout that has rows and columns. We’ll look at it in greater depth in the <span class="No-Break">next chapter.</span></p>
			<p>[6] In <strong class="source-inline">Grid</strong>, each individual row and column can be given a name from <strong class="source-inline">enumeration</strong> or can<a id="_idIndexMarker231"/> be referred to by its <span class="No-Break">zero-based index.</span></p>
			<p>The key takeaway <a id="_idIndexMarker232"/>from this section is that you can certainly create all the controls<a id="_idIndexMarker233"/> and their commands and properties in C# as well as in XAML. I will continue to dip into C#, but I’m afraid it will drive you crazy to show each type in both, so again, for layout and controls, we’ll focus predominantly on XAML – the standard approach for .<span class="No-Break">NET MAUI.</span></p>
			<h1 id="_idParaDest-99"><a id="_idTextAnchor103"/>Displaying collections</h1>
			<p>It is common to have a collection<a id="_idIndexMarker234"/> of data and to want to display it in a list, allowing the user to select one or more items and then do some work with those items. There are a couple of ways to do this in .NET MAUI, but the most common (and best) is to <span class="No-Break">use </span><span class="No-Break"><strong class="source-inline">CollectionView</strong></span><span class="No-Break">.</span></p>
			<p>To see this at work, examine <strong class="source-inline">Preferences.xaml</strong> along with its code-behind <strong class="source-inline">Preferences.xaml.cs</strong> and <strong class="source-inline">ViewModel</strong>, <strong class="source-inline">PreferencesViewModel.cs</strong>. We will use this page extensively as we build Forget Me Not, but let’s <span class="No-Break">start slowly.</span></p>
			<p>Our goal is to create<a id="_idIndexMarker235"/> a list of the user’s preferences (shirt size, music genre, and so on). For that, we’ll use <strong class="source-inline">CollectionView</strong>, and we’ll, of course, need a collection to view. The page, when completed, will look much <span class="No-Break">like this:</span></p>
			<div>
				<div id="_idContainer063" class="IMG---Figure">
					<img src="image/Figure_5.4_B19723.jpg" alt="Figure 5.4 – The Preferences page&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.4 – The Preferences page</p>
			<p>Rather than each line being a unique<a id="_idIndexMarker236"/> object, we’ll create one type that we can show repeatedly. In the <strong class="source-inline">Model</strong> folder, create a <span class="No-Break"><strong class="source-inline">Preference</strong></span><span class="No-Break"> class:</span></p>
			<pre class="source-code">
namespace ForgetMeNotDemo.Model;
[ObservableObject]
public partial class Preference
{
    [ObservableProperty] private string preferencePrompt;
    [ObservableProperty] private string preferenceValue;
}</pre>
			<p class="callout-heading">Partial classes</p>
			<p class="callout">In .NET MAUI virtually all classes are <em class="italic">partial</em> to support the Community <span class="No-Break">Toolkit code.</span></p>
			<p><strong class="source-inline">Preference</strong> has only two properties, both strings. The <strong class="source-inline">PreferencePrompt</strong> string will hold the text on the left of the page, and the <strong class="source-inline">PreferenceValue</strong> string will hold the user’s preference on the <span class="No-Break">right side.</span></p>
			<p>The first thing we need is a collection of these <strong class="source-inline">Preference</strong> objects. To get that, we’re going to build a <strong class="source-inline">Service</strong>, whose job, eventually, will be to interact with the API and get us our list of <strong class="source-inline">Preference</strong> objects. Perform the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>Create a new folder <span class="No-Break">named </span><span class="No-Break"><strong class="source-inline">Services</strong></span><span class="No-Break">.</span></li>
				<li>In <strong class="source-inline">Services</strong>, create a <span class="No-Break"><strong class="source-inline">PreferenceService</strong></span><span class="No-Break"> class.</span></li>
				<li>Inside that file add a <span class="No-Break"><strong class="source-inline">GetPreferences</strong></span><span class="No-Break"> method.</span></li>
			</ol>
			<p>Here’s <span class="No-Break">the code:</span></p>
			<pre class="source-code">
public class PreferenceService
{
  public async Task&lt;List&lt;Preference&gt;&gt; GetPreferences()
  {
    return await GetPreferencesMock();
  }
  private async Task&lt;List&lt;Preference&gt;&gt; GetPreferencesMock(
  {
    return null;
  }
}</pre>
			<p><strong class="source-inline">ViewModel</strong> will call <strong class="source-inline">GetPreferences</strong> on the service and get back<a id="_idIndexMarker237"/> a list of the <strong class="source-inline">Preference</strong> objects. We’ll turn to how <strong class="source-inline">PreferenceService</strong> gets those objects in just <span class="No-Break">a bit.</span></p>
			<p>Back in <strong class="source-inline">PreferencesViewModel</strong>, do <span class="No-Break">the following:</span></p>
			<pre class="source-code">
[ObservableObject]
public partial class PreferencesViewModel
{
  [ObservableProperty] private List&lt;Preference&gt;
    preferences;
  private readonly PreferenceService service; [1]
  public PreferencesViewModel()
  {
    service = new(); [2]
  }
  public async Task Init()
  {
    Preferences = await service.GetPreferences(); [3]
  }
}</pre>
			<p>[1] Declare an instance <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">PreferenceService</strong></span></p>
			<p>[2] Initialize it in <span class="No-Break">the constructor</span></p>
			<p>[3] In the <strong class="source-inline">Init</strong> method, fill the <strong class="source-inline">Preferences</strong> collection<a id="_idIndexMarker238"/> with what you get back from <span class="No-Break">the service</span></p>
			<p class="callout-heading">Dependency injection</p>
			<p class="callout">In <a href="B19723_09.xhtml#_idTextAnchor160"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, we will review dependency injection. At that point, we’ll pass<a id="_idIndexMarker239"/> in a <strong class="source-inline">PreferenceService</strong> interface and let the <strong class="source-inline">InversionOfControl</strong> container supply the service for us. If that didn’t make sense to you, no problem; it will all become clear in <a href="B19723_09.xhtml#_idTextAnchor160"><span class="No-Break"><em class="italic">Chapter 9</em></span></a><span class="No-Break">.</span></p>
			<p>So, who instantiates <strong class="source-inline">ViewModel</strong> and calls <strong class="source-inline">Init</strong>? For that, we turn to the code-behind of the <span class="No-Break"><strong class="source-inline">PreferencesPage</strong></span><span class="No-Break"> class:</span></p>
			<pre class="source-code">
public partial class PreferencesPage : ContentPage
{
  private PreferencesViewModel vm;
  public Preferences()
  {
    vm = new PreferencesViewModel();
    BindingContext = vm;
    InitializeComponent();
 }
  protected override async void OnAppearing()
  {
    base.OnAppearing();
    await vm.Init();
  }</pre>
			<p class="callout-heading">Naming the ViewModel vm</p>
			<p class="callout">I’m not big on using acronyms<a id="_idIndexMarker240"/> in code, and would normally have named the local instance of <strong class="source-inline">ViewModel</strong>. But using <em class="italic">vm</em> is such a convention in .NET MAUI (going back to <strong class="source-inline">Xamarin.Forms</strong>) that I <span class="No-Break">indulge myself.</span></p>
			<p>In .NET MAUI, the two life cycle events<a id="_idIndexMarker241"/> you will often want control over are when the page is first being shown (<strong class="source-inline">OnAppearing</strong>) and when it is being shut down (<strong class="source-inline">OnDisappearing</strong>). Let’s explore <span class="No-Break">this next.</span></p>
			<h2 id="_idParaDest-100"><a id="_idTextAnchor104"/>Overriding OnAppearing</h2>
			<p>Every time a page<a id="_idIndexMarker242"/> appears, its <strong class="source-inline">OnAppearing</strong> method is called. We override<a id="_idIndexMarker243"/> that method so that we can call <strong class="source-inline">vm.Init()</strong>. We do this because <strong class="source-inline">Init</strong> is asynchronous, and while we can make <strong class="source-inline">OnAppearing</strong> asynchronous using the <strong class="source-inline">async</strong> keyword, we can’t do that with <span class="No-Break">the constructor.</span></p>
			<p><strong class="source-inline">OnInit()</strong>, in turn, calls <strong class="source-inline">GetPreferences</strong> on the service and gets back a collection of the <span class="No-Break"><strong class="source-inline">Preference</strong></span><span class="No-Break"> objects.</span></p>
			<h2 id="_idParaDest-101"><a id="_idTextAnchor105"/>Understanding how the service works</h2>
			<p>In time, our <strong class="source-inline">PreferenceService's</strong> <strong class="source-inline">GetPreferences</strong> method will call into our API to get the list<a id="_idIndexMarker244"/> of preferences from our database, which will be stored in the cloud. For now, it will call <strong class="source-inline">GetPreferencesMock</strong>, which will handcraft the list and return it <span class="No-Break">to us.</span></p>
			<p>Here’s an excerpt from <span class="No-Break">the file:</span></p>
			<pre class="source-code">
public class PreferenceService
{
  public async Task&lt;List&lt;Preference&gt;&gt; GetPreferences()
  {
    return await GetPreferencesMock();
  }
  private async Task&lt;List&lt;Preference&gt;&gt; GetPreferencesMock()
  {
    List&lt;Preference&gt; preferences = new()
    {
      new Preference()
      {
        PreferencePrompt = "Shirt Size",
        PreferenceValue = ""
      },
      new Preference()
      {
        PreferencePrompt = "Favorite Music Genre",
        PreferenceValue = ""
      },
      new Preference()
      {
        PreferencePrompt = "Favorite Color",
        PreferenceValue = ""
      },
      new Preference()
      {
        PreferencePrompt = "Favorite Food",
        PreferenceValue = ""
      },
      new Preference()
      {
        PreferencePrompt = "Favorite Movie",
        PreferenceValue = ""
      },
//…
    };
    return preferences;
  }
}</pre>
			<p>The result is a collection<a id="_idIndexMarker245"/> of <strong class="source-inline">Preference</strong> objects. Let’s look at how to display <span class="No-Break">that collection.</span></p>
			<h2 id="_idParaDest-102"><a id="_idTextAnchor106"/>Displaying the collection of Preference objects</h2>
			<p>Now that we have<a id="_idIndexMarker246"/> a collection<a id="_idIndexMarker247"/> of <strong class="source-inline">Preference</strong> objects in <strong class="source-inline">ViewModel</strong>, we can create <span class="No-Break">our page:</span></p>
			<pre class="source-code">
&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;ContentPage xmlns="http://schemas.microsoft.com/
  dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/
                winfx/2009/xaml"
             x:Class="ForgetMeNotDemo.View.PreferencesPage"
             Title="Preferences"&gt;
    &lt;ScrollView&gt;
        &lt;VerticalStackLayout&gt;
            &lt;Label
                Margin="5"
                Padding="5"
                HorizontalOptions="Center"
                LineBreakMode="WordWrap"  [1]
                Text="Please fill in as many p<a id="_idTextAnchor107"/>references as
                you care to. &amp;#10; &amp;#10;The fields are
                'free form,' fill in anything you like.
                Remember, the more information you provide
                to your buddies the better they will be
                able to match to what you like. Each of the
                categories can be edited for your
                needs.&amp;#10; &amp;#10; Save as frequently as you
                like, and to edit, just change the value
                you entered and press save." /&gt;
            &lt;Button
                Margin="30,20,0,0"
                Clicked="SavePreferences"   [2]
                Command="{Binding SavePreferencesCommand}"
                 [3]
                Text="Save" /&gt;
            &lt;CollectionView
                Margin="20,20,10,10"
                ItemsSource="{Binding Preferences}" [4]
                SelectionMode="None"&gt;       [5]
                &lt;CollectionView.ItemTemplate&gt;  [6]
                    &lt;DataTemplate&gt;
                        &lt;Grid ColumnDefinitions="*,2*"&gt;
                            &lt;Entry  [7]
                                Grid.Column="0"
                                FontSize="10"
                                HorizontalOptions="Start"
                                HorizontalTextAlignment=
                                  "Start"
                                Text="{Binding
                                PreferencePrompt,
                                   Mode=TwoWay}" [8]
                                TextColor="{OnPlatform
                                  Black,  [9]
                                  iOS=White}" /&gt;
                            &lt;Entry
                                Grid.Column="1"
                                FontSize="10"
                                HeightRequest="32"
                                HorizontalOptions="Start"
                                HorizontalTextAlignment=
                                  "Start"
                                Text="{Binding
                                 PreferenceValue,
                                   Mode=TwoWay}"
                                TextColor="{OnPlatform
                                   Black,
                                     iOS=White}"
                                WidthRequest="350" /&gt;
                        &lt;/Grid&gt;
                    &lt;/DataTemplate&gt;
                &lt;/CollectionView.ItemTemplate&gt;
            &lt;/CollectionView&gt;
            &lt;Button
                Margin="30,20,0,0"
                Clicked="SavePreferences"
                Command="{Binding SavePreferencesCommand}"
                Text="Save" /&gt;
        &lt;/VerticalStackLayout&gt;
    &lt;/ScrollView&gt;
&lt;/ContentPage&gt;</pre>
			<p>There is much to see in this listing. Let’s take things one <span class="No-Break">by one:</span></p>
			<p>[1] <strong class="source-inline">Label</strong> has multiple lines; we’ve seen this before. We set <strong class="source-inline">LineBreakMode</strong> to <strong class="source-inline">WordWrap</strong> so that we break the lines between words. Notice the use of <strong class="source-inline">&amp;#10;</strong>, which forces a <span class="No-Break">line break.</span></p>
			<p>[2] The <strong class="bold">Save</strong> button is very unusual as it has a click event handler as well as a command! The click event handler will handle showing <span class="No-Break">the toast.</span></p>
			<p>[3] The command will be handled in <strong class="source-inline">ViewModel</strong> and will call the <strong class="source-inline">Save</strong> method in the service (which we will not implement <span class="No-Break">just yet).</span></p>
			<p>[4] The <strong class="source-inline">ItemsSource</strong> property points to the collection that <strong class="source-inline">CollectionView</strong> will display. In our case, that is the <strong class="source-inline">Preferences</strong> collection <span class="No-Break">in </span><span class="No-Break"><strong class="source-inline">ViewModel</strong></span><span class="No-Break">.</span></p>
			<p>[5] <strong class="source-inline">SelectionMode</strong> is set to <strong class="source-inline">None</strong>, as we won’t be selecting items in this display. We will be editing items and then pressing <strong class="bold">Save</strong> to save <span class="No-Break">the changes.</span></p>
			<p>[6] An item template says, “here is how I want you to display each item in the collection, one <span class="No-Break">by one.”</span></p>
			<p>[7] Interestingly, we are using <strong class="source-inline">Entry</strong> for the prompt. This allows the user to change the prompt, which is what we want. We can’t anticipate every category, so we create a number of them, but we let the user tweak the list <span class="No-Break">as needed.</span></p>
			<p>[8] Not only will we be displaying<a id="_idIndexMarker248"/> the value of the prompt<a id="_idIndexMarker249"/> from the database, but we’ll want to write back whatever the user enters as well. Thus, we mark the text as two-way (that is, data &gt; View and View &gt; <span class="No-Break">data)</span></p>
			<p>[9] We’ve not seen <strong class="source-inline">onPlatform</strong> before. This says, “always use this value except, on this platform, use this other value.” Here we are saying that the text<a id="_idIndexMarker250"/> color is <strong class="source-inline">Black</strong>, except<a id="_idIndexMarker251"/> on <strong class="source-inline">Ios</strong>, where it <span class="No-Break">is </span><span class="No-Break"><strong class="source-inline">White</strong></span><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-103"><a id="_idTextAnchor108"/>The code-behind</h2>
			<p>You’ll remember<a id="_idIndexMarker252"/> that we are not only handling the command in <strong class="source-inline">ViewModel</strong> but we’re also handling the <strong class="source-inline">Clicked</strong> event in the code-behind. Here is the rest <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">PreferencesPage.xaml.cs</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
    public void SavePreferences(object sender, EventArgs e)
    {
        ShowToast();
    }
    private async Task ShowToast()
    {
        var cancellationTokenSource = new
           CancellationTokenSource();
        var message = "Your preferences were saved";
        ToastDuration duration = ToastDuration.Short;
        var fontSize = 14;
        var toast = Toast.Make(message, duration,
          fontSize);
        await toast.Show(cancellationTokenSource.Token);
    }</pre>
			<p>The event handler just calls the <strong class="source-inline">ShowToast</strong> method, which then does its thing, as <span class="No-Break">described earlier.</span></p>
			<p>This way, when the list of preferences is saved, the toast notifies the user that all <span class="No-Break">went well.</span></p>
			<p class="callout-heading">Did it all go well?</p>
			<p class="callout">In the code shown, we just assume that it all went well. To do this properly, we’d want <strong class="source-inline">ViewModel</strong> to wait for confirmation from the API that the operation was completed successfully, and then it would send a message to the code-behind, which would then, and only then, display <span class="No-Break">the toast.</span></p>
			<p>Before we go any<a id="_idIndexMarker253"/> further, open <strong class="source-inline">AppShell.xaml</strong> and change the startup <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
    &lt;ShellContent
        Title="Home"
        ContentTemplate="{DataTemplate
          view1:PreferencesPage}"
        Route="PreferencesPage" /&gt;</pre>
			<p>Once we get to <a href="B19723_07.xhtml#_idTextAnchor129"><span class="No-Break"><em class="italic">Chapter 7</em></span></a>, we can stop this silliness and just navigate to the page <span class="No-Break">we want.</span></p>
			<p>The effect of all of this is shown in <span class="No-Break"><em class="italic">Figure 5</em></span><span class="No-Break"><em class="italic">.5</em></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer064" class="IMG---Figure">
					<img src="image/Figure_5.5_B19723.jpg" alt="Figure 5.5 – The Preferences page&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.5 – The Preferences page</p>
			<p>A few quick things to note in <span class="No-Break"><em class="italic">Figure 5</em></span><em class="italic">.5</em>. The fields on the left have been underlined, indicating that they are entry objects, not labels, and thus can be modified. The top arrow points to the fact that the fields are free-form, and the user can enter whatever they want, and the lower arrow points to <span class="No-Break">the toast.</span></p>
			<p>So far, we’ve been setting<a id="_idIndexMarker254"/> numerous properties on our UI controls. Often, we’ve had to repeat the same properties on various instances of the same type of control. There is a better way: styles, which we’ll <span class="No-Break">cover next.</span></p>
			<h1 id="_idParaDest-104"><a id="_idTextAnchor109"/>Styles</h1>
			<p><strong class="bold">Styles</strong> allow you to provide a uniform look to your controls<a id="_idIndexMarker255"/> by putting all the details in <span class="No-Break">one place.</span></p>
			<p>You create a style for a control type (for example, <strong class="source-inline">Button</strong>), and that style is applied to all controls of that type (refer to the <em class="italic">Explicit versus implicit styles</em> section). You can also base a style on an existing style, extending or modifying <span class="No-Break">the original.</span></p>
			<p>Styles can be stored on the page that uses the control, or they can be stored at the application level. In either case, they are created inside <strong class="source-inline">ResourceDictionary</strong>, typically declared at the top of the file. To make them available at the application level, just put them <span class="No-Break">in </span><span class="No-Break"><strong class="source-inline">App.xaml</strong></span><span class="No-Break">.</span></p>
			<p class="callout-heading">Where to put your styles</p>
			<p class="callout">If you are only going to use the styles on objects on a single page, it makes sense to put the styles in the resources of that page. If you want to be able to reuse these styles on multiple pages, then you will want them <span class="No-Break">in </span><span class="No-Break"><strong class="source-inline">App.xaml</strong></span><span class="No-Break">.</span></p>
			<p>As an example, let’s return to the <strong class="bold">Login</strong> page and create <strong class="source-inline">ResourceDictionary</strong> and our first styles. Place this code at the very top of the file, just below the <span class="No-Break"><strong class="source-inline">ContentPage</strong></span><span class="No-Break"> element:</span></p>
			<pre class="source-code">
    &lt;ContentPage.Resources&gt;
        &lt;Style TargetType="Label"&gt;
            &lt;Setter Property="FontSize" Value="Medium"/&gt;
            &lt;Setter Property="HorizontalOptions"
               Value="Start"/&gt;
            &lt;Setter Property="Margin" Value="10"/&gt;
            &lt;Setter Property="VerticalOptions"
               Value="Center"/&gt;
            &lt;Setter Property="VerticalTextAlignment"
              Value="Center"/&gt;
        &lt;/Style&gt;
    &lt;/ContentPage.Resources&gt;</pre>
			<p>You can see that we have created a style for the labels on the page. In that style, we have set a number of properties with their values. This will be applied to every <strong class="source-inline">Label</strong> because this is an implicit style, as <span class="No-Break">described next.</span></p>
			<p>The key to the use of styles is that they greatly simplify the controls they are applied to. For example, the labels now look <span class="No-Break">like this:</span></p>
			<pre class="source-code">
&lt;Label
    Text="User Name" /&gt;</pre>
			<p>They are no longer cluttered with all the style information that has been centralized in <strong class="source-inline">ResourceDictionary</strong>. This not only makes for cleaner XAML, but if you later decide to change one of these values, you do so in one place rather than throughout the page. Thus, the same clean code guideline that applies to C# (don’t repeat yourself) applies <span class="No-Break">to styles.</span></p>
			<p>There are two types<a id="_idIndexMarker256"/> of styles: implicit and explicit. <strong class="bold">Implicit styles</strong> are applied to every control of <strong class="source-inline">TargetType</strong>, as we saw earlier. <strong class="bold">Explicit styles</strong> can be applied to controls individually. Let us explore this in more <span class="No-Break">detail next.</span></p>
			<h2 id="_idParaDest-105"><a id="_idTextAnchor110"/>Explicit versus implicit styles</h2>
			<p>To make a style<a id="_idIndexMarker257"/> explicit, you<a id="_idIndexMarker258"/> give it a key, as <span class="No-Break">shown</span><span class="No-Break"><a id="_idIndexMarker259"/></span><span class="No-Break"> here:</span></p>
			<pre class="source-code">
&lt;Style TargetType="Label" x:Key="LargeLabel"&gt;
    &lt;Setter Property="FontSize" Value="Large" /&gt;
    &lt;Setter Property="HorizontalOptions" Value="Start" /&gt;
    &lt;Setter Property="Margin" Value="10" /&gt;
    &lt;Setter Property="VerticalOptions" Value="Center" /&gt;
    &lt;Setter Property="VerticalTextAlignment" Value="Center"
      /&gt;
&lt;/Style&gt;
&lt;Style TargetType="Label" x:Key="SmallLabel"&gt;
    &lt;Setter Property="FontSize" Value="Small" /&gt;
    &lt;Setter Property="HorizontalOptions" Value="Start" /&gt;
    &lt;Setter Property="Margin" Value="10" /&gt;
    &lt;Setter Property="VerticalOptions" Value="Center" /&gt;
    &lt;Setter Property="VerticalTextAlignment" Value="Center"
      /&gt;
&lt;/Style&gt;</pre>
			<p>You can now pick which of these styles you want to apply to <strong class="source-inline">Label</strong> based on <span class="No-Break">that key:</span></p>
			<pre class="source-code">
&lt;Label
    Text="User Name"
    Style="{StaticResource LargeLabel}"/&gt;
&lt;Label
    Text="Password"
    Style="{StaticResource SmallLabel}"/&gt;</pre>
			<p>The<a id="_idIndexMarker260"/> result<a id="_idIndexMarker261"/> is shown<a id="_idIndexMarker262"/> in <span class="No-Break"><em class="italic">Figure 5</em></span><span class="No-Break"><em class="italic">.6</em></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer065" class="IMG---Figure">
					<img src="image/Figure_5.6_B19723.jpg" alt="Figure 5.6 – Explicit styles applied&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.6 – Explicit styles applied</p>
			<p class="callout-heading">Overriding the style in the control</p>
			<p class="callout">If you have a style<a id="_idIndexMarker263"/> that you want to use on all of your (for example) labels, but you have one <strong class="source-inline">Label</strong> that needs one or two properties to be different, one way to handle that is just to make the change in that <strong class="source-inline">Label</strong>. Properties assigned directly to the control override those of the style. On the other hand, if you have sets of controls that need nearly the same properties but differ in some ways, then you want to use style inheritance, which is <span class="No-Break">covered next.</span></p>
			<h2 id="_idParaDest-106"><a id="_idTextAnchor111"/>Style inheritance or BasedOn</h2>
			<p>The construct for <strong class="source-inline">LargeLabel</strong> and <strong class="source-inline">SmallLabel</strong> has a lot of duplication. You<a id="_idIndexMarker264"/> can refactor<a id="_idIndexMarker265"/> this to use a base style and then just add the changes in your explicit styles. Here’s <span class="No-Break">an example:</span></p>
			<pre class="source-code">
&lt;Style TargetType="Label"&gt;  [1]
    &lt;Setter Property="FontSize" Value="Medium" /&gt;
    &lt;Setter Property="HorizontalOptions" Value="Start" /&gt;
    &lt;Setter Property="Margin" Value="10" /&gt;
    &lt;Setter Property="VerticalOptions" Value="Center" /&gt;
    &lt;Setter Property="VerticalTextAlignment"
      Value="Center" /&gt;
&lt;/Style&gt;
&lt;Style TargetType="Label" x:Key="BaseExplicitLabel"&gt; [2]
    &lt;Setter Property="FontSize" Value="Medium" /&gt;
    &lt;Setter Property="HorizontalOptions" Value="Start" /&gt;
    &lt;Setter Property="Margin" Value="10" /&gt;
    &lt;Setter Property="VerticalOptions" Value="Center" /&gt;
    &lt;Setter Property="VerticalTextAlignment"
      Value="Center" /&gt;
&lt;/Style&gt;
&lt;Style
    TargetType="Label"
    x:Key="LargeLabel"
    BasedOn="{StaticResource BaseExplicitLabel}"&gt; [3]
    &lt;Setter Property="FontSize" Value="Large" /&gt;
&lt;/Style&gt;
&lt;Style
    TargetType="Label"
    x:Key="SmallLabel"
    BasedOn="{StaticResource BaseExplicitLabel}"&gt;
    &lt;Setter Property="FontSize" Value="Small" /&gt;
&lt;/Style&gt;
            &lt;Label
                Style="{StaticResource LargeLabel}" [4]
                Text="User Name" /&gt;</pre>
			<p>[1] An implicit <span class="No-Break">label style</span></p>
			<p>[2] A style created to be the base style for <span class="No-Break">other styles</span></p>
			<p>[3] A derived style that uses properties from the <span class="No-Break">base style</span></p>
			<p>[4] Using<a id="_idIndexMarker266"/> the <span class="No-Break">derived</span><span class="No-Break"><a id="_idIndexMarker267"/></span><span class="No-Break"> style</span></p>
			<p class="callout-heading">Derived styles</p>
			<p class="callout">Note that derived styles<a id="_idIndexMarker268"/> can add new properties (as was done here), they can override values in the base style, or both. Notice also that we refactored the styles, but did not have to refactor <strong class="source-inline">Label</strong> that <span class="No-Break">uses it.</span></p>
			<h1 id="_idParaDest-107"><a id="_idTextAnchor112"/>Summary</h1>
			<p>In this chapter, we dove deeper into some of the more advanced aspects of .NET MAUI controls. We looked at the <strong class="source-inline">Activity</strong> element as well as <strong class="source-inline">ProgressBar</strong>. We went on to look at moving command handling into <strong class="source-inline">ViewModel</strong> and using messages to communicate between <strong class="source-inline">ViewModel</strong> <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">View</strong></span><span class="No-Break">.</span></p>
			<p>We ended the chapter by looking at styles and how they can be used to provide a uniform appearance to the UI and how we can refactor duplication out of similar styles by using style <span class="No-Break">inheritance (</span><span class="No-Break"><strong class="source-inline">BasedOn</strong></span><span class="No-Break">).</span></p>
			<p>In the next chapter, we’ll look at how we lay out <strong class="source-inline">controls</strong> on the page, moving beyond the simple <strong class="source-inline">StackLayouts</strong> we’ve been using <span class="No-Break">so far.</span></p>
			<h1 id="_idParaDest-108"><a id="_idTextAnchor113"/>Quiz</h1>
			<ol>
				<li>What is the difference between <strong class="source-inline">ActivityIndicator</strong> <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">ProgressBar</strong></span><span class="No-Break">?</span></li>
				<li>What is the difference between an event and <span class="No-Break">a command?</span></li>
				<li>What <span class="No-Break">is </span><span class="No-Break"><strong class="source-inline">WeakReferenceManager</strong></span><span class="No-Break">?</span></li>
				<li>Why would you use <span class="No-Break">a style?</span></li>
				<li>How do you refactor common properties <span class="No-Break">in styles?</span></li>
			</ol>
			<h1 id="_idParaDest-109"><a id="_idTextAnchor114"/>You try it</h1>
			<p>Create a small form that pretends to gather information on the user to create a profile (name, age, address, and so on). Add an image you can tap on and two buttons: one to accept the entered info and one to <span class="No-Break">cancel it.</span></p>
			<p>If the user taps on the image, put up a dialog box with a message, but handle the tap itself <span class="No-Break">in </span><span class="No-Break"><strong class="source-inline">ViewModel</strong></span><span class="No-Break">.</span></p>
			<p>Handle the button clicks in <strong class="source-inline">ViewModel</strong>. On clicking <strong class="bold">Cancel</strong>, put up a toast acknowledging the cancellation. On clicking <strong class="bold">OK</strong>, use <strong class="source-inline">Snackbar</strong> to show what info they have saved, <span class="No-Break">nicely formatted.</span></p>
		</div>
	</body></html>