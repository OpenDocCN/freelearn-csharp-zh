<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch03"/>Chapter 3. 2D Animation</h1></div></div></div><p>In this chapter, we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Flipping a sprite horizontally</li><li class="listitem" style="list-style-type: disc">Animating body parts for character movement events</li><li class="listitem" style="list-style-type: disc">Creating a 3-frame animation clip to make a platform continually animate</li><li class="listitem" style="list-style-type: disc">Making a platform start falling once stepped-on using a Trigger to move animation from one state to another</li><li class="listitem" style="list-style-type: disc">Creating animation clips from sprite sheet sequences</li></ul></div><div><div><div><div><h1 class="title"><a id="ch03lvl1sec37"/>Introduction</h1></div></div></div><p>Unity 5 builds on the introduction of powerful 2D<a class="indexterm" id="id267"/> features in the Mecanim animation system and the 2D physics system that were introduced in Unity 4.6 late 2014. In this chapter, we present a range of recipes to introduce the basics of 2D animation in Unity 5, and help you understand the relationships between the different animation elements.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec95"/>The big picture</h2></div></div></div><p>In Unity 2D animations can be created in several different ways – one way is to create many images, each <a class="indexterm" id="id268"/>slightly different, which frame-by-frame give the appearance of movement. A second way to create animations is by defining keyframe positions for individual parts of an object (for example, the arms, legs, feet, head, eyes, and so on), and getting Unity to calculate all the in-between positions when the game in running.</p><div><img alt="The big picture" src="img/1362OT_03_21.jpg"/></div><p>Both sources of animations become <strong>Animation Clips</strong> in the Animation panel. Each <strong>Animation Clip</strong> then <a class="indexterm" id="id269"/>becomes a <strong>State</strong> in the <strong>Animator Controller State Machine</strong>. We then define under what conditions a GameObject will <strong>Transition</strong> from one animation state (clip) to another.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec38"/>Flipping a sprite horizontally</h1></div></div></div><p>Perhaps the <a class="indexterm" id="id270"/>simplest 2D animation is a simple flip, from facing left to facing right, or facing up to facing down, and so on. In this recipe we'll add a cute bug sprite to the scene, and write a short script to flip its horizontal direction when the <em>Left</em> and <em>Right</em> arrow keys are pressed.</p><div><img alt="Flipping a sprite horizontally" src="img/1362OT_03_04.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec96"/>Getting ready</h2></div></div></div><p>For this recipe, we have prepared the image you need in a folder named <code class="literal">Sprites</code> in folder <code class="literal">1362_03_01</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec97"/>How to do it...</h2></div></div></div><p>To flip an object horizontally with arrow key presses, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new Unity 2D project.</li><li class="listitem">Import the provided image <code class="literal">EnemyBug.png</code>.</li><li class="listitem">Drag an instance of the red <strong>Enemy Bug</strong> image from the <strong>Project | Sprites</strong> folder into the scene. Position this GameObject at (<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>) and scale to (<code class="literal">2</code>, <code class="literal">2</code>, <code class="literal">2</code>).</li><li class="listitem">Add an instance of C# script class <code class="literal">BugFlip</code> as a component to your <strong>Enemy Bug</strong> GameObject:<div><pre class="programlisting">using UnityEngine;
using System.Collections;

public class BugFlip : MonoBehaviour {
  private bool facingRight = true;

  void Update() {
    if (Input.GetKeyDown(KeyCode.LeftArrow) &amp;&amp; facingRight)
      Flip ();
    if (Input.GetKeyDown(KeyCode.RightArrow) &amp;&amp; !facingRight)
      Flip();
  }

  void Flip (){
    // Switch the way the player is labelled as facing.
    facingRight = !facingRight;

    // Multiply the player's x local scale by -1.
    Vector3 theScale = transform.localScale;
    theScale.x *= -1;
    transform.localScale = theScale;
  }
}</pre></div></li><li class="listitem">When you run your scene, pressing the <em>Left</em> and <em>Right</em> arrow keys should make the bug face left or right correspondingly.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec98"/>How it works...</h2></div></div></div><p>The C# class defines<a class="indexterm" id="id271"/> a Boolean variable <code class="literal">facingRight</code>, which stores a <code class="literal">true</code>/<code class="literal">false</code> value corresponding to whether or not the bug is facing right or not. Since our bug sprite is initially facing right, then we set the initial value of <code class="literal">facingRight</code> to true to match this.</p><p>Method <code class="literal">Update()</code>, every frame, checks to see if the <em>Left</em> or <em>Right</em> arrow keys have been pressed. If the <em>Left</em> arrow key is pressed and the bug is facing right, then method <code class="literal">Flip()</code> is called, likewise if the <em>Right</em> arrow key is pressed and the bug is facing left (that is, facing right is false), again method <code class="literal">Flip()</code> is called.</p><p>Method <code class="literal">Flip()</code> performs two actions, the first simply reverses the true/false value in variable <code class="literal">facingRight</code>. The second action changes the <strong>+</strong>/<strong>-</strong> sign of the X-value of the <code class="literal">localScale</code> property of the transform. Reversing the sign of the <code class="literal">localScale</code> results in the 2D flip that we<a class="indexterm" id="id272"/> desire. Look inside the <code class="literal">PlayerControl</code> script for the <strong>BeanMan</strong> character in the next recipe – you'll see exactly the same <code class="literal">Flip()</code> method being used.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec39"/>Animating body parts for character movement events</h1></div></div></div><p>In this recipe, we'll<a class="indexterm" id="id273"/> learn to animate the hat of the Unity bean-man character in response to a jump event.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec99"/>Getting ready</h2></div></div></div><p>For this recipe, we have prepared the files you need in folder <code class="literal">1362_03_02</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec100"/>How to do it...</h2></div></div></div><p>To animate body parts for character movement events, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new Unity 2D project.</li><li class="listitem">Import the provided package <code class="literal">BeanManAssets</code>, by choosing menu: <strong>Assets</strong> | <strong>Import Package</strong> | <strong>Custom Package …</strong>, and then click the <strong>Import</strong> button to import all these assets into your <strong>Project</strong> panel.</li><li class="listitem">Increase the size of the <strong>Main Camera</strong> to <code class="literal">10</code>.</li><li class="listitem">Let's setup the 2D gravity setting for this project – we'll use the same setting as from Unity's 2D platform tutorial, a setting of Y= <code class="literal">-30</code>. Set 2D gravity to this value by choosing menu: <strong>Edit</strong> | <strong>Project Settings</strong> | <strong>Physics 2D</strong>, and then at the top change the Y value to <code class="literal">-30</code>.</li><li class="listitem">Drag an instance of the BeanMan <strong>character2D</strong> from the <strong>Project</strong> | <strong>Prefabs</strong> folder into the scene. Position this GameObject at (<code class="literal">0</code>, <code class="literal">3</code>, <code class="literal">0</code>).</li><li class="listitem">Drag an instance of the sprite <strong>platformWallBlocks</strong> from the <strong>Project</strong> | <strong>Sprites</strong> folder into the scene. Position this GameObject at (<code class="literal">0</code>, <code class="literal">-4</code>, <code class="literal">0</code>).</li><li class="listitem">Add a <strong>Box Collider 2D</strong> component to GameObject <strong>platformWallBlocks</strong> by choosing menu: <strong>Add Component</strong> | <strong>Physics 2D</strong> | <strong>Box Collider 2D</strong>.</li><li class="listitem">We now have a stationary platform that the player can land upon, and walk left and right on. Create a new <strong>Layer</strong> named <strong>Ground</strong>, and assign GameObject<strong> platformWallBlocks</strong> to this new layer, as shown in the following screenshot. Pressing the <em>Space</em> key when the character is on the platform will now make him jump.<div><img alt="How to do it..." src="img/1362OT_03_05.jpg"/></div></li><li class="listitem">Currently the<a class="indexterm" id="id274"/> BeanMan character is animated (arms and legs moving) when we make him jump. Let's remove the Animation clips and Animator controller and create our own from scratch. Delete folders Clips and Controllers from <strong>Project</strong> | <strong>Assets</strong> | <strong>PotatoMan2DAssets</strong> | <strong>Character2D</strong> | <strong>Animation</strong>, as shown:<div><img alt="How to do it..." src="img/1362OT_03_22.jpg"/></div></li><li class="listitem">Let's create an Animation clip (and its associated Animator controller) for our hero character. In the Hierarchy panel select GameObject <strong>hero</strong>. Ensuring GameObject <strong>character2D</strong> is selected in the <strong>Hierarchy</strong>, open the <strong>Animation</strong> panel, and ensure it is in <strong>Dope Sheet</strong> view (this is the default).</li><li class="listitem">Click the empty dropdown menu in the <strong>Animation</strong> panel (next to the greyed out word <code class="literal">Samples</code>), and choose menu item <strong>[Create New Clip]</strong>:<div><img alt="How to do it..." src="img/1362OT_03_06.jpg"/></div></li><li class="listitem">Save the new clip in the<strong> Character2D</strong> | <strong>Animation</strong> folder, naming it as <strong>character-beanman-idle</strong>. You've now created an Animation clip for the 'idle' character state (which is not animated).<div><div><h3 class="title"><a id="note28"/>Note</h3><p>Your final game may end up with tens, or even hundreds, of animation clips. Make things easy to search by prefixing the names of clips with object type, name, and then description of the animation clip.</p></div></div></li><li class="listitem">Looking at the <strong>Character2D</strong> | <strong>Animation</strong> folder in the Project panel you should now see<a class="indexterm" id="id275"/> both the Animation clip you have just created (<strong>character-beanman-idle</strong>) and also a new Animator controller, which has defaulted to the name of your GameObject <strong>character2D</strong>:<div><img alt="How to do it..." src="img/1362OT_03_23.jpg"/></div></li><li class="listitem">Ensuring GameObject <strong>character2D</strong> is selected in the <strong>Hierarchy</strong>, open the <strong>Animator</strong> panel and you'll see the State Machine for controlling the animation of our character. Since we only have one Animation clip (<strong>character-beanman-idle</strong>) then upon entry the State Machine immediately enters this state.<div><img alt="How to do it..." src="img/1362OT_03_24.jpg"/></div></li><li class="listitem">Run your scene – since the character is always in the 'idle' state, we see no animation yet when we make it jump.</li><li class="listitem">Now we'll create a 'jump' Animation clip which animates the hat. Click the empty dropdown menu in the <strong>Animation</strong> panel (next to the greyed out word 'Samples'), and <a class="indexterm" id="id276"/>create a new clip in your <strong>Animation</strong> folder, naming it <strong>character-beanman-jump</strong>.</li><li class="listitem">Click button <strong>Add Property</strong>, and chose <strong>Transform</strong> | <strong>Position</strong> of the <strong>hat</strong> child object, by clicking its '<strong>+</strong>' plus-sign button. We are now recording changes to the (X, Y, Z) position of GameObject <strong>hat</strong> in this animation clip:<div><img alt="How to do it..." src="img/1362OT_03_25.jpg"/></div></li><li class="listitem">You should now see 2 'keyframes' at 0.0 and at 1.0. These are indicated by diamonds in the <strong>Timeline</strong> area in the right-hand-section of the <strong>Animation</strong> panel.</li><li class="listitem">Click to select the first keyframe (at time 0.0). Now in the <strong>Scene</strong> panel move the hat up and left a little, away from the head. You should see that all three X, Y, Z values have a red background in the <strong>Inspector</strong> – this is to inform you that the values of the <strong>Transform</strong> component are being recorded in the animation clip:<div><img alt="How to do it..." src="img/1362OT_03_26.jpg"/></div></li><li class="listitem">Since 1 second is perhaps too long for our jump animation, drag the second keyframe<a class="indexterm" id="id277"/> diamond to the left to a time of 0.5.</li><li class="listitem">We now need to define when the character should Transition from the 'idle' state to the 'jump' state. In the <strong>Animator</strong> panel select state <strong>character-beanman-idle</strong>, and create a transition to the state <strong>character-beanman-jump</strong> by right-mouse-clicking and choosing menu Make Transition, then drag the transition arrow to state <strong>character-beanman-jump</strong>, as shown:<div><img alt="How to do it..." src="img/1362OT_03_27.jpg"/></div></li><li class="listitem">Now let's add a Trigger parameter named 'Jump', by clicking on the add parameter plus-sign "<strong>+</strong>" button at the top-left of the <strong>Animator</strong> panel, choosing<a class="indexterm" id="id278"/> <strong>Trigger</strong>, and typing the name <strong>Jump</strong>:<div><img alt="How to do it..." src="img/1362OT_03_28.jpg"/></div></li><li class="listitem">We can now define the properties for when our character should <strong>Transition</strong> from idle to jump. Click the Transition arrow to select it, and set the following 4 properties in the <strong>Inspector</strong> panel:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Has Exit Time</strong>: uncheck</li><li class="listitem" style="list-style-type: disc"><strong>Transition Duration</strong>: <code class="literal">0.01</code></li><li class="listitem" style="list-style-type: disc"><strong>Interruption State</strong>: <code class="literal">Current State</code></li><li class="listitem" style="list-style-type: disc"><strong>Conditions</strong>: Add <code class="literal">Jump</code> (click plus-sign '<code class="literal">+</code>' button at bottom)</li></ul></div><div><img alt="How to do it..." src="img/1362OT_03_29.jpg"/></div></li><li class="listitem">Save and run your scene. Once the character has landed on the platform and you press the <em>SPACE</em> key to jump, you'll now see the character's hat jump away from his head, and slowly move back. Since we haven't added any transition to ever leave the Jump state, this Animation clip will loop, so the hat keeps on moving even when the jump is completed.</li><li class="listitem">In the Animator <a class="indexterm" id="id279"/>panel select state <strong>character-beanman-jump</strong> and add a new Transition back to state <strong>character-beanman-idle</strong>. Select this Transition arrow and in the Inspector panel sets its properties as follows:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Has Exit Time</strong>: (leave as checked)</li><li class="listitem" style="list-style-type: disc"><strong>Exit time</strong>: <code class="literal">0.5</code> (this needs to be the same time value as the second keyfame of our Jump animation clip)</li><li class="listitem" style="list-style-type: disc"><strong>Transition Duration</strong>: <code class="literal">0.01</code></li><li class="listitem" style="list-style-type: disc"><strong>Interruption State</strong>: <code class="literal">Current State</code></li></ul></div></li><li class="listitem">Save and run your scene. Now when you jump the hat should animate once, after which the character immediately returns to its Idle state.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec101"/>How it works...</h2></div></div></div><p>You have added an Animation controller State Machine to GameObject <strong>character2D</strong>. The two Animation clips you created (idle and jump) appear as States in the Animator panel. You created a Transition from Idle to Jump when the 'Jump' Trigger parameter is received by the State Machine. You created a second Transition, which transitions back to the Idle state after waiting 0.5 seconds (the same duration between the 2 keyframes in our Jump Animation clip).</p><p>Note that the key to everything working for the bean-man character is that when we make the character jump with the <em>SPACE</em> key, then code in the <code class="literal">PlayerControl</code> C# scripted component of GameObject<strong> character2D</strong>, as well as making the sprite move upwards on screen, also sends a <code class="literal">SetTrigger(…)</code> message to the Animator controller component, for the <strong>Trigger</strong> named <strong>Jump</strong>.</p><div><div><h3 class="title"><a id="note29"/>Note</h3><p>The difference between a <strong>Boolean</strong> Parameter and a <strong>Trigger</strong> is that a <strong>Trigger</strong> is temporality set to <code class="literal">True</code> and once the <code class="literal">SetTrigger(…)</code> event has been 'consumed' by a state transition it automatically returns to being <code class="literal">False</code>. So Triggers are useful for actions we wish to do once and then revert to a previous state. A <strong>Boolean</strong> Parameter is a variable, which can have its value set to true/or <code class="literal">False</code> at different times during the game, and so different Transitions can be created to fire depending on the value of the variable at any time. Note that <strong>Boolean</strong> parameters have to have their values explicitly set back to <code class="literal">False</code> with a <code class="literal">SetBool(…)</code>.</p></div></div><p>The following screenshot highlights the line of code that sends the <code class="literal">SetTrigger(…)</code> message:</p><div><img alt="How it works..." src="img/1362OT_03_30.jpg"/></div><p>
<strong>State Machines</strong> for animations of a range of motions (running/walking/jumping/falling/dying and so on.) will have more states and transitions. The Unity-provided<a class="indexterm" id="id280"/> bean-man character has a more complex <strong>State Machine</strong>, and more complex animations (of hands and feet, and eyes and hat and so on, for each <strong>Animation</strong> clip), which you may find useful to explore.</p><p>Learn more about the <a class="indexterm" id="id281"/>Animation view on the Unity Manual web pages at <a class="ulink" href="http://docs.unity3d.com/Manual/AnimationEditorGuide.html">http://docs.unity3d.com/Manual/AnimationEditorGuide.html</a>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec40"/>Creating a 3-frame animation clip to make a platform continually animate</h1></div></div></div><p>In this recipe, we'll make<a class="indexterm" id="id282"/> a wooden-looking platform continually animate, moving upwards and downwards. This can be achieved with a single, 3-frame, animation clip (starting at top, position at bottom, top position again).</p><div><img alt="Creating a 3-frame animation clip to make a platform continually animate" src="img/1362OT_03_02.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec102"/>Getting ready</h2></div></div></div><p>This recipe builds on the previous one, so make a copy of that project, and work on the copy for this recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec103"/>How to do it...</h2></div></div></div><p>To create a continually<a class="indexterm" id="id283"/> moving animated platform, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Drag an instance of the sprite <strong>platformWoodBlocks</strong> from the <strong>Project | Sprites</strong> folder into the scene. Position this GameObject at (<code class="literal">-4</code>, <code class="literal">-5</code>, <code class="literal">0</code>), so that these wood blocks are neatly to left, and slightly below, the wall blocks platform.</li><li class="listitem">Add a Box Collider 2D component to GameObject <strong>platformWoodBlocks</strong> so that the player's character can stand on this platform too. Choose menu: <strong>Add Component</strong> | <strong>Physics 2D</strong> | <strong>Box Collider 2D</strong>.</li><li class="listitem">Create a new folder named <code class="literal">Animations</code>, in which to store the animation clip and controller we'll create next.</li><li class="listitem">Ensuring GameObject <strong>platformWoodBlocks</strong> is still selected in the <strong>Hierarchy</strong>, open an <strong>Animation</strong> panel, and ensure it is in <strong>Dope Sheet</strong> view (this is the default).</li><li class="listitem">Click the empty dropdown menu in the <strong>Animation</strong> panel (next to the greyed out word 'Samples'), and choose menu item <strong>[Create New Clip]</strong>.</li><li class="listitem">Save the new clip in your <strong>Animations</strong> folder, naming it '<strong>platform-wood-moving-up-down</strong>'.</li><li class="listitem">Click button <strong>Add Curve</strong>, and chose <strong>Transform</strong> and the click the '<strong>+</strong>' plus-sign by <strong>Position</strong>. We are now recording changes to the (X, Y, Z) position of GameObject <strong>platformWoodBlocks</strong> in this animation clip.</li><li class="listitem">You should now see 2 'keyframes' at 0.0 and at 1.0. These are indicated by diamonds in the <strong>Timeline</strong> area in the right-hand-section of the <strong>Animation</strong> panel.</li><li class="listitem">We need 3 keyframes, with the new one at <strong>2:00</strong> seconds. Click at <strong>2:00</strong> in the Timeline along the top of the <strong>Animation</strong> panel, so that the red line for the current playhead time is at time 2:00. Then click diamond+ button to create a new keyframe at the current playhead time:<div><img alt="How to do it..." src="img/1362OT_03_08.jpg"/></div></li><li class="listitem">The first and third keyframes are fine – they record the current height of the wood platform at Y= <code class="literal">-5</code>. We need to make the middle keyframe record the height <a class="indexterm" id="id284"/>of the platform at the top of its motion, and Unity in-betweening will do all the rest of the animation work for us. Select the middle keyframe (at time 1:00), by clicking on either diamond at time 1:00 (they should both turn blue, and the red playhead vertical line should move to 1:00, to indicate the middle keyframe is being edited).</li><li class="listitem">Now in the <strong>Inspector</strong> change the Y position of the platform to 0. You should see that all three X, Y, Z values have a red background in the <strong>Inspector</strong> – this is to inform you that the values of the <strong>Transform</strong> component are being recorded in the animation clip.</li><li class="listitem">Save and run your scene. The wooden platform should now be animating continuously, moving smoothly up and down the positions we setup.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec104"/>How it works...</h2></div></div></div><p>You have added an animation to GameObject <strong>platformWoodBlocks</strong>. This animation contains three keyframes. A keyframe represents the values of properties of the object at a point in time. The first keyframe stores a Y-value of -4, the second keyframe a Y-value of 0, and the final keyframe -4 again. Unity calculates all the in-between values for us, and the result is a smooth animation of the Y-position of the platform.</p><div><div><h3 class="title"><a id="note30"/>Note</h3><p>Note: If we wanted to duplicate the moving platform, first we'd need to create a new, empty GameObject named movingBlockParent, and then parent platformWoodBlocks to this GameObject. Duplicating GameObject movingBlockParent would then allow us to create more moving blocks in our scene. If we simply duplicated platformWoodBlocks directly, then when the scene runs each duplicate would be animated back to the location of the original animation frames (that is, all copies would be positioned and moving in the original location).</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec41"/>Making a platform start falling once stepped-on using a Trigger to move animation from one state to another</h1></div></div></div><p>In many cases we don't wish an animation to begin until some condition has been met, or some event occurred. In these cases a good way to organize the Animator Controller is to have two animation states (clips) and a Trigger on the Transition between the clips. We use code to detect when <a class="indexterm" id="id285"/>we wish the animation to start playing, and at that time we send the Trigger message to the Animation Controller, causing the transition to start.</p><p>In this recipe we'll <a class="indexterm" id="id286"/>create a water platform block in our 2D platform game; such blocks will begin to slowly fall down the screen as soon as they have been stepped on, and so the player must keep on moving otherwise they'll fall down the screen with the blocks too! It looks as shown in the following screenshot:</p><div><img alt="Making a platform start falling once stepped-on using a Trigger to move animation from one state to another" src="img/1362OT_03_01.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec105"/>Getting ready</h2></div></div></div><p>This recipe builds on the previous one, so make a copy of that project, and work on the copy for this recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec106"/>How to do it...</h2></div></div></div><p>To construct an animation that only plays once a Trigger has been received, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">In the <strong>Hierarchy</strong> create an <strong>Empty</strong> GameObject named <strong>water-block-container</strong>, positioned at (<code class="literal">2.5</code>, <code class="literal">-4, 0</code>). This empty GameObject will allow us to make duplicates of animated Water Blocks that will animate relative to their parent GameObject position.</li><li class="listitem">Drag an instance of the sprite <strong>Water Block</strong> from the <strong>Project</strong> | <strong>Sprites</strong> folder into the scene and child it to GameObject <strong>water-block-container</strong>. Ensure the position of your new child GameObject <strong>Water Block</strong> is (<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>), so that it appears neatly to right of the wall blocks platform, as shown in the following screenshot:<div><img alt="How to do it..." src="img/1362OT_03_09.jpg"/></div></li><li class="listitem">Add a <strong>Box Collider 2D</strong> component to child GameObject <strong>Water Block</strong>, and set the layer of this GameObject to <strong>Ground</strong>, so that the player's character can stand and jump <a class="indexterm" id="id287"/>on this water block platform.</li><li class="listitem">Ensuring<a class="indexterm" id="id288"/> child GameObject <strong>Water Block</strong> is selected in the <strong>Hierarchy</strong>, open an <strong>Animation</strong> panel, then create a new clip named <strong>platform-water-up</strong>. saving it in your <code class="literal">Animations</code> folder.</li><li class="listitem">Click button <strong>Add Curve</strong>, and chose <strong>Transform</strong> and <strong>Position</strong>.</li><li class="listitem">Delete the second keyframe at time <strong>1:00</strong>. You have now completed the creation of the water block up animation clip.</li><li class="listitem">Create a second Animation clip, named <strong>platform-water-down</strong>. Again, click button <strong>Add Curve</strong>, and chose <strong>Transform</strong> and <strong>Position</strong>, and delete the second keyframe at time <strong>1:00</strong>.</li><li class="listitem">With the first keyframe at time <strong>0:00</strong> selected, set the Y-value of the GameObjects Transform Position to <code class="literal">-5</code>. You have now completed the creation of the water block down animation clip, so you can click the red record button to stop recording.</li><li class="listitem">You may have noticed that as well as the up/down <strong>Animation Clips</strong> that you created, another file was created in your <code class="literal">Animations</code> folder, an <strong>Animator Controller</strong> named <strong>Water Block</strong>. Select this file and open the <strong>Animator</strong> panel, to see and edit the State Machine diagram:<div><img alt="How to do it..." src="img/1362OT_03_10.jpg"/></div></li><li class="listitem">Currently, although we created 2 animation clips (states), only the <strong>Up</strong> state is ever active. This is because when the scene begins (Entry) the object will immediately go in state <strong>platform-water-up</strong>, but since there are no transition arrows from this state to <strong>platform-water-down</strong>, then at present the <strong>Water Block</strong> GameObject will always be in its <strong>Up</strong> state.</li><li class="listitem">Ensure<a class="indexterm" id="id289"/> state <strong>platform-water-up</strong> is selected (it will have a blue border around it), and create a Transition (arrow) to state <strong>platform-water-down</strong>, by choosing <strong>Make Transition</strong> from the <strong>mouse-right-click</strong> menu.</li><li class="listitem">If you run the scene now, the default <strong>Transition</strong> settings are that after 0.9 seconds the <strong>Water Blocks</strong> will transition into their <strong>Down</strong> state. We don't want this – we only want them to animate downwards after the player has walked onto<a class="indexterm" id="id290"/> them. So create a <strong>Trigger</strong> named <strong>Fall</strong>, by choosing the <strong>Parameters</strong> tab in the <strong>Animator</strong> panel, clicking the plus '<strong>+</strong>' button and selecting <strong>Trigger</strong>, and then selecting <strong>Fall</strong>.</li><li class="listitem">Do the following to create our Trigger:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">In the <strong>Animator</strong> panel select the <strong>Transition</strong></li><li class="listitem" style="list-style-type: disc">In the <strong>Inspector</strong> panel uncheck the <strong>Has Exit Time</strong> option</li><li class="listitem" style="list-style-type: disc">In the <strong>Inspector</strong> panel drag the Transition end time to <strong>2:00</strong> seconds (so the Water Block slowly Transitions to its Down state over a period of 2 seconds)</li><li class="listitem" style="list-style-type: disc">In the <strong>Inspector</strong> panel click the plus '<strong>+</strong>' button to add a <strong>Condition</strong>, which should automatically suggest the only possible condition parameter, which is our <strong>Trigger Fall</strong>.</li></ul></div><div><img alt="How to do it..." src="img/1362OT_03_12.jpg"/></div></li><li class="listitem">We now<a class="indexterm" id="id291"/> need to add a collider trigger just above the Water Block, and add C# script behavior to send the <strong>Animator Controller Trigger</strong> when the player enters<a class="indexterm" id="id292"/> the collider. Ensuring child GameObject <strong>Water Block</strong> is selected, add a (second) <strong>2D Box Collider</strong>, with a Y-Offset of <strong>1</strong>, and tick its <strong>Is Trigger</strong> checkbox:<div><img alt="How to do it..." src="img/1362OT_03_13.jpg"/></div></li><li class="listitem">Add an instance of C# script class <code class="literal">WaterBlock</code> as a component to your <strong>Water Block</strong> child GameObject:<div><pre class="programlisting">using UnityEngine;
using System.Collections;

public class WaterBlock : MonoBehaviour {
  private Animator animatorController;

  void Start(){
    animatorController = GetComponent&lt;Animator&gt;();
  }

  void OnTriggerEnter2D(Collider2D hit){
    if(hit.CompareTag("Player")){
      animatorController.SetTrigger("Fall");
    }
  }
}</pre></div></li><li class="listitem">Make 6 more copies of GameObject <strong>water-block-container</strong>, with X positions increasing by 1 each time, that is, <code class="literal">3.5</code>, <code class="literal">4.5</code>, <code class="literal">5.5</code>, and so on.</li><li class="listitem">Run the scene, and as the player's character runs across each water block they will start falling down, so he had better keep running!</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec107"/>How it works...</h2></div></div></div><p>You created a two-state <a class="indexterm" id="id293"/><strong>Animator Controller</strong> state machine. Each state was an <strong>Animation Clip</strong>. You created a <strong>Transition</strong> from the <strong>Water Block</strong> Up state to its Down state that will take place when the Animator Controller received a Fall Trigger message. You created a <strong>Box Collider 2D</strong> with a <strong>Trigger</strong>, so that <a class="indexterm" id="id294"/>scripted component WaterBlock could be detected when the player (tagged <strong>Player</strong>) enters its collider, and at that point send the <strong>Fall</strong> Trigger message to make the <strong>Water Block</strong> GameObject start gently Transitioning into its Down state further down the screen.</p><p>Learn more about the <a class="indexterm" id="id295"/>Animator Controllers on the Unity Manual web pages at <a class="ulink" href="http://docs.unity3d.com/Manual/class-AnimatorController.html">http://docs.unity3d.com/Manual/class-AnimatorController.html</a>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec42"/>Creating animation clips from sprite sheet sequences</h1></div></div></div><p>The traditional method of animation involved hand-drawing many images, each slightly different, which<a class="indexterm" id="id296"/> displayed quickly frame-by-frame to<a class="indexterm" id="id297"/> give the appearance of movement. For computer game animation, the term Sprite Sheet is given to the image file that contains one or more sequences of sprite frames. Unity provides tools to breakup individual sprite images in large sprite sheet files, so that individual frames, or sub-sequences of frames can be used to create Animation Clips that can become States in Animator Controller State Machines. In this recipe, we'll import and break up an open source monster sprite sheet into three animation clips for Idle, Attack, and Death that looks as shown:</p><div><img alt="Creating animation clips from sprite sheet sequences" src="img/1362OT_03_17.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec108"/>Getting ready</h2></div></div></div><p>For all the<a class="indexterm" id="id298"/> recipes in this chapter, we have<a class="indexterm" id="id299"/> prepared the sprite images you need in folder <code class="literal">1362_03_05</code>. Many thanks to Rosswet Mobile for making these sprites available as Open Source at: <a class="ulink" href="http://www.rosswet.com/wp/?p=156">http://www.rosswet.com/wp/?p=156</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec109"/>How to do it...</h2></div></div></div><p>To create an animation from a sprite sheet of frame-by-frame animation images, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new Unity 2D project.</li><li class="listitem">Import the provided image <code class="literal">monster1</code>.</li><li class="listitem">With image <code class="literal">monster1</code> selected in the <strong>Project</strong> panel, change its <strong>Sprite</strong> mode to <strong>Multiple</strong> in the <strong>Inspector</strong>, then open the <strong>Sprite Editor</strong> panel by clicking button <strong>Sprite Editor</strong>.</li><li class="listitem">In the <strong>Sprite Editor</strong> open the <strong>Slice</strong> dropdown dialog, set the <strong>Type</strong> to <strong>Grid</strong>, set the grid <strong>Pixel Size</strong> to <strong>64x64</strong>, and then click the <strong>Slice</strong> button. Finally, click the <strong>Apply</strong> button in the bar at the top right of the <strong>Sprite Editor</strong> panel):<div><img alt="How to do it..." src="img/1362OT_03_18.jpg"/></div></li><li class="listitem">In the <strong>Project</strong> panel you can now click the expand triangle button center-right on the<a class="indexterm" id="id300"/> sprite, and you'll see all the different child frames for this sprite.<div><img alt="How to do it..." src="img/1362OT_03_19.jpg"/></div></li><li class="listitem">Create a folder named <code class="literal">Animations</code>.</li><li class="listitem">In your new folder, create an <strong>Animator Controller</strong> named <strong>monster-animator</strong>.</li><li class="listitem">In the <a class="indexterm" id="id301"/>scene create a new <strong>Empty</strong> GameObject named <strong>monster1</strong> (at position <code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>), and drag your <strong>monster-animator</strong> into this GameObject.</li><li class="listitem">With GameObject <strong>monster1</strong> selected in the <strong>Hierarchy</strong>, open up the <strong>Animation</strong> panel, and create a new <strong>Animation Clip</strong> named <strong>Idle</strong>.</li><li class="listitem">Select image <code class="literal">monster1</code> in the <strong>Project</strong> panel (in its expanded view), and select and drag the first 5 frames (frames 0-4) into the <strong>Animation</strong> panel. Change the sample rate to 12 (since this animation was created to run at 12-frames per second).<div><img alt="How to do it..." src="img/1362OT_03_20.jpg"/></div></li><li class="listitem">If you look at the State Chart for <strong>monster-animator</strong>, you'll see it has a default state (clip) named monster-idle.</li><li class="listitem">When you run your scene you should now see the <strong>monster1</strong> GameObject animating in its monster-idle state. You may wish to make the Main Camera size a bit smaller, since these are quite small sprites.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec110"/>How it works...</h2></div></div></div><p>Unity's Sprite Editor knows about sprite sheets, and once the correct grid size has been entered it<a class="indexterm" id="id302"/> treats the items in each grid square inside the sprite sheet image as an individual image, or frame, of the animation. You <a class="indexterm" id="id303"/>selected sub-sequences of sprite animation frames and added them into several <strong>Animation Clips</strong>. You had added an <strong>Animation Controller</strong> to your GameObject, and so each <strong>Animation Clip</strong> appears as a state in the <strong>Animation Controller State Machine</strong>.</p><p>You can now repeat the process, creating an <strong>Animation Clip</strong> monster-attack with frames 8-12, and a third clip monster-death with frames 15-21. You would then create Triggers and <strong>Transitions</strong> to make the monster GameObject transition into the appropriate <strong>states</strong> as the game is played.</p><p>Learn more about<a class="indexterm" id="id304"/> the Unity Sprite Editor from the Unity video tutorials at <a class="ulink" href="https://unity3d.com/learn/tutorials/modules/beginner/2d/sprite-editor">https://unity3d.com/learn/tutorials/modules/beginner/2d/sprite-editor</a>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec43"/>Conclusion</h1></div></div></div><p>In this chapter, we have introduced recipes demonstrating the animation system for 2D game elements. The bean-man 2D character is from the Unity 2D Platformer, which you can download yourself from the Unity asset store. That project is a good place to see lots more examples of 2D game and animation techniques (<a class="ulink" href="http://www.assetstore.unity3d.com/en/#!/content/11228">www.assetstore.unity3d.com/en/#!/content/11228</a>).</p><div><img alt="Conclusion" src="img/1362OT_03_03.jpg"/></div><p>Here are some links for useful resources and sources of information to explore these topics further:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Unity 2D <a class="indexterm" id="id305"/>Platformer (where the BeanMan character came from):<p>
<a class="ulink" href="https://www.assetstore.unity3d.com/en/#!/content/11228">https://www.assetstore.unity3d.com/en/#!/content/11228</a>
</p></li><li class="listitem" style="list-style-type: disc">The platform sprites are from Daniel Cook's Planet Cute game resources:<p>
<a class="ulink" href="http://www.lostgarden.com/2007/05/dancs-miraculously-flexible-game.html">http://www.lostgarden.com/2007/05/dancs-miraculously-flexible-game.html</a>
</p></li><li class="listitem" style="list-style-type: disc">Creating a <a class="indexterm" id="id306"/>basic 2D platformer game:<p>
<a class="ulink" href="https://www.unity3d.com/learn/tutorials/modules/beginner/live-training-archive/creating-a-basic-platformer-game">https://www.unity3d.com/learn/tutorials/modules/beginner/live-training-archive/creating-a-basic-platformer-game</a>
</p></li><li class="listitem" style="list-style-type: disc">Hat Catch 2D game tutorial:<p>
<a class="ulink" href="https://www.unity3d.com/learn/tutorials/modules/beginner/live-training-archive/2d-catch-game-pt1">https://www.unity3d.com/learn/tutorials/modules/beginner/live-training-archive/2d-catch-game-pt1</a>
</p></li><li class="listitem" style="list-style-type: disc">Unity games from a 2D perspective video:<p>
<a class="ulink" href="https://www.unity3d.com/learn/tutorials/modules/beginner/live-training-archive/introduction-to-unity-via-2d">https://www.unity3d.com/learn/tutorials/modules/beginner/live-training-archive/introduction-to-unity-via-2d</a>
</p></li><li class="listitem" style="list-style-type: disc">A fantastic set of modular 2D characters with a free Creative Commons license from 'Kenny'. These assets would be perfect for animating body parts in a similar way to the bean-man example in this chapter and in the Unity 2D platformer demo:<p>
<a class="ulink" href="http://kenney.nl/assets/modular-characters">http://kenney.nl/assets/modular-characters</a>
</p></li></ul></div></div></body></html>