<html><head></head><body><div><div><div><h1 class="chapterNumber">13</h1>
    <h1 id="_idParaDest-740" class="chapterTitle">Building Websites Using ASP.NET Core</h1>
    <p class="normal">This chapter is about building websites with a modern HTTP architecture on the server side using ASP.NET Core.</p>
    <p class="normal">ASP.NET Core is a free, open-source, and cross-platform web framework developed by Microsoft for building modern, cloud-based, and internet-connected applications. It is a significant redesign of the previous ASP.NET framework, focusing on flexibility, modularity, and performance.</p>
    <p class="normal">ASP.NET Core provides a unified programming model for building web <strong class="keyWord">user interface</strong> (<strong class="keyWord">UI</strong>) and web APIs, which means you can use the same framework for both server-side and client-side logic.</p>
    <p class="normal">ASP.NET Core is optimized for high performance and can handle a significant number of requests per second. It has a lightweight, modular architecture that allows developers to include only the necessary components, reducing the overall footprint.</p>
    <p class="normal">You will learn about building simple websites using the Blazor static <strong class="keyWord">Server-Side Rendering</strong> (<strong class="keyWord">SSR</strong>) feature introduced with ASP.NET Core 8.</p>
    <p class="normal">This chapter covers the following topics:</p>
    <ul>
      <li class="bulletList">Exploring ASP.NET Core</li>
      <li class="bulletList">History of Blazor</li>
      <li class="bulletList">Exploring Blazor static SSR</li>
      <li class="bulletList">Using Entity Framework Core with ASP.NET Core</li>
    </ul>
    <h1 id="_idParaDest-741" class="heading-1">Exploring ASP.NET Core</h1>
    <p class="normal">Before we <a id="_idIndexMarker1946"/>explore an example ASP.NET Core project, let’s review its architecture.</p>
    <h2 id="_idParaDest-742" class="heading-2">Architecture of ASP.NET Core</h2>
    <p class="normal">The architecture <a id="_idIndexMarker1947"/>of ASP.NET Core is composed of several key components:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Middleware</strong>: Middleware components are used to handle requests and <a id="_idIndexMarker1948"/>responses. They are chained together in a pipeline, where each piece of middleware processes the request and passes it to the next component in the chain. In an optional online section for this chapter, you can learn how to customize this pipeline.</li>
      <li class="bulletList"><strong class="keyWord">Routing</strong>: The <a id="_idIndexMarker1949"/>routing component is responsible for mapping incoming requests to appropriate endpoints and Blazor components.</li>
      <li class="bulletList"><strong class="keyWord">Dependency Injection (DI) container</strong>: This <a id="_idIndexMarker1950"/>is built-in and used for managing service object lifetimes and dependencies.</li>
      <li class="bulletList"><strong class="keyWord">Configuration</strong>: ASP.NET Core uses a flexible configuration system that supports <a id="_idIndexMarker1951"/>various sources like JSON files, environment variables, and command-line arguments.</li>
      <li class="bulletList"><strong class="keyWord">Logging</strong>: The <a id="_idIndexMarker1952"/>framework has a logging API that supports various logging providers, allowing you to capture and store log data in a consistent manner.</li>
    </ul>
    <p class="normal">Now we will create an empty ASP.NET Core project and explore how to enable it to serve simple web pages.</p>
    <h2 id="_idParaDest-743" class="heading-2">Creating an empty ASP.NET Core project</h2>
    <p class="normal">We will create an ASP.NET Core project that will show a list of suppliers from the <code class="inlineCode">Northwind</code> database.</p>
    <p class="normal">The <code class="inlineCode">dotnet</code> tool has many project templates that do a lot of work for you, but it can be <a id="_idIndexMarker1953"/>difficult to know which works best for a given situation, so we will start with the empty website project template and then add features step by step so that you can understand all the pieces:</p>
    <ol>
      <li class="numberedList" value="1">Use your preferred code editor to open the <code class="inlineCode">ModernWeb</code> solution and then add a new project, as defined in the following list:<ul>
          <li class="bulletList level-2"><strong class="keyWord">Project template</strong>: <strong class="screenText">ASP.NET Core Empty [C#]</strong> / <code class="inlineCode">web</code>. For Rider, select the project template named <strong class="screenText">ASP.NET Core Web Application</strong>, and then set <strong class="screenText">Type</strong> to <strong class="screenText">Empty</strong>.</li>
          <li class="bulletList level-2"><strong class="keyWord">Project file and folder</strong>: <code class="inlineCode">Northwind.Web</code>.</li>
          <li class="bulletList level-2"><strong class="keyWord">Solution file and folder</strong>: <code class="inlineCode">ModernWeb</code>.</li>
          <li class="bulletList level-2">For Visual Studio, leave all other options as their defaults.</li>
        </ul>
        <p class="normal">For example:</p>
        <ul>
          <li class="bulletList level-3"><strong class="screenText">Framework</strong>: .NET 9.0<strong class="screenText"> (</strong>Standard Term<strong class="screenText"> </strong>Support)</li>
          <li class="bulletList level-3"><strong class="screenText">Configure for HTTPS</strong>: Selected</li>
          <li class="bulletList level-3"><strong class="screenText">Enable Docker</strong>: Cleared</li>
          <li class="bulletList level-3"><strong class="screenText">Do not use top-level statements</strong>: Cleared</li>
        </ul>
        <ul>
          <li class="bulletList level-2">For VS Code and the <code class="inlineCode">dotnet new web</code> command, the defaults are the options we want. In future projects, if you want to change from top-level statements to the old <code class="inlineCode">Program</code> class style, then specify the switch <code class="inlineCode">--use-program-main</code>.</li>
        </ul>
      </li>
    </ol>
    <div><p class="normal">Summaries of Visual Studio and <code class="inlineCode">dotnet new</code> options when creating new projects can be found in the GitHub repository at the following link: <a href="https://github.com/markjprice/cs13net9/blob/main/docs/ch01-project-options.md">https://github.com/markjprice/cs13net9/blob/main/docs/ch01-project-options.md</a>.</p>
    </div>
    <ol>
      <li class="numberedList" value="2">Build the <code class="inlineCode">Northwind.Web</code> project.</li>
      <li class="numberedList">In <code class="inlineCode">Northwind.Web.csproj</code>, note that the project is like a class library except that <a id="_idIndexMarker1954"/>the SDK is <code class="inlineCode">Microsoft.NET.Sdk.Web</code>, as shown highlighted in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code">&lt;Project <strong class="hljs-slc">Sdk=</strong><strong class="hljs-string-slc">"Microsoft.NET.Sdk.Web"</strong>&gt;
  &lt;PropertyGroup&gt;
    &lt;TargetFramework&gt;net9.0&lt;/TargetFramework&gt;
    &lt;Nullable&gt;enable&lt;/Nullable&gt;
    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
  &lt;/PropertyGroup&gt;
&lt;/Project&gt;
</code></pre>
      </li>
      <li class="numberedList">Add an element to import the <code class="inlineCode">System.Console</code> class globally and statically, as shown in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code">&lt;ItemGroup Label="To simplify use of WriteLine."&gt;
  &lt;Using Include="System.Console" Static="true" /&gt;
&lt;/ItemGroup&gt;
</code></pre>
      </li>
      <li class="numberedList">If you are using Visual Studio, in <strong class="screenText">Solution Explorer</strong>, toggle <strong class="screenText">Show All Files</strong>. If you are using Rider, then move the cursor over the <strong class="screenText">Solution</strong> pane, and then click the “eyeball” icon.</li>
      <li class="numberedList">Expand the <code class="inlineCode">obj</code> folder, expand the <code class="inlineCode">Debug</code> folder, expand the <code class="inlineCode">net9.0</code> folder, and select the <code class="inlineCode">Northwind.Web.GlobalUsings.g.cs</code> file. Note how the implicitly imported namespaces include all the ones for a console app or class library, as well as some ASP.NET Core ones, such as <code class="inlineCode">Microsoft.AspNetCore.Builder</code>, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">// &lt;autogenerated /&gt;
global using global::Microsoft.AspNetCore.Builder;
global using global::Microsoft.AspNetCore.Hosting;
global using global::Microsoft.AspNetCore.Http;
global using global::Microsoft.AspNetCore.Routing;
global using global::Microsoft.Extensions.Configuration;
global using global::Microsoft.Extensions.DependencyInjection;
global using global::Microsoft.Extensions.Hosting;
global using global::Microsoft.Extensions.Logging;
global using global::System;
global using global::System.Collections.Generic;
global using global::System.IO;
global using global::System.Linq;
global using global::System.Net.Http;
global using global::System.Net.Http.Json;
global using global::System.Threading;
global using global::System.Threading.Tasks;
global using static global::System.Console;
</code></pre>
      </li>
      <li class="numberedList">Close <a id="_idIndexMarker1955"/>the file and collapse the <code class="inlineCode">obj</code> folder.</li>
      <li class="numberedList">In the <code class="inlineCode">Northwind.Web</code> project/folder, expand the folder named <code class="inlineCode">Properties</code>, open the file named <code class="inlineCode">launchSettings.json</code>, and note the profiles named <code class="inlineCode">http</code> and <code class="inlineCode">https</code>. They have randomly assigned port numbers that you will change in the next step so, for now, just note their locations, as shown highlighted in the following configuration:
        <pre class="programlisting code-one"><code class="hljs-code">{
  "$schema": "http://json.schemastore.org/launchsettings.json",
  "iisSettings": {
    "windowsAuthentication": false,
    "anonymousAuthentication": true,
    "iisExpress": {
      "applicationUrl": "http://localhost:14842",
      "sslPort": 44352
    }
  },
  "profiles": {
    "<strong class="hljs-string-slc">http</strong>": {
      "commandName": "Project",
      "dotnetRunMessages": true,
      "launchBrowser": true,
      <strong class="hljs-string-slc">"applicationUrl"</strong><strong class="hljs-slc">: </strong><strong class="hljs-string-slc">"http://localhost:5122"</strong>,
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    },
    "<strong class="hljs-string-slc">https</strong>": {
      "commandName": "Project",
      "dotnetRunMessages": true,
      "launchBrowser": true,
      <strong class="hljs-string-slc">"applicationUrl"</strong><strong class="hljs-slc">: </strong><strong class="hljs-string-slc">"https://localhost:7155;http://localhost:5122"</strong>,
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    },
    "IIS Express": {
      "commandName": "IISExpress",
      "launchBrowser": true,
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    }
  }
}
</code></pre>
      </li>
    </ol>
    <div><p class="normal">The <code class="inlineCode">launchSettings.json</code> file is only for use during development. It has no effect on <a id="_idIndexMarker1956"/>the build process. It is not deployed with the compiled website project, so it has no effect on the production runtime. It is only processed by code editors like Visual Studio and Rider to set up environment variables and define URLs for the web server to listen on when the project is started by a code editor.</p>
    </div>
    <ol>
      <li class="numberedList" value="9">For the <code class="inlineCode">https</code> profile, for its <code class="inlineCode">applicationUrl</code>, change the assigned port numbers for <code class="inlineCode">http</code> to <code class="inlineCode">5130</code> and <code class="inlineCode">https</code> to <code class="inlineCode">5131</code>, and swap the order so <code class="inlineCode">http</code> is first in the list and will be used by default, as shown highlighted in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code">"applicationUrl": "<strong class="hljs-string-slc">http://localhost:5130;https://localhost:5131</strong>",
</code></pre>
      </li>
    </ol>
    <div><p class="normal">The <code class="inlineCode">http</code> and <code class="inlineCode">https</code> launch profiles have a <code class="inlineCode">commandName</code> of <code class="inlineCode">Project</code>, meaning they use the web server configured in the project to host the website, which is Kestrel by default. There is also a profile and settings for <strong class="keyWord">IIS</strong>, which is a Windows-only web server. In this book, we will only use Kestrel as the web server since it is cross-platform. To declutter your <code class="inlineCode">launchSettings.json</code> file, you could even delete the <code class="inlineCode">iisSettings</code> and <code class="inlineCode">IIS Express</code> sections.</p>
    </div>
    <ol>
      <li class="numberedList" value="10">Save <a id="_idIndexMarker1957"/>the changes to <code class="inlineCode">launchSettings.json</code> and close the file.</li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, note the following:<ul>
          <li class="bulletList level-2">An ASP.NET Core project is like a top-level console app, with a hidden <code class="inlineCode">&lt;Main&gt;$</code> method as its entry point that has an argument passed using the name <code class="inlineCode">args</code>.</li>
          <li class="bulletList level-2">It calls <code class="inlineCode">WebApplication.CreateBuilder</code>, which creates a host for the website using defaults for a web host that is then built.</li>
          <li class="bulletList level-2">The website will respond to all HTTP <code class="inlineCode">GET</code> requests to the root path of the website with this plain text: <code class="inlineCode">Hello World!</code>.</li>
          <li class="bulletList level-2">The call to the <code class="inlineCode">Run</code> method is a blocking call, so the hidden <code class="inlineCode">&lt;Main&gt;$</code> method does not return until the web server stops running.</li>
        </ul>
      </li>
    </ol>
    <p class="normal-one">The contents of <code class="inlineCode">Program.cs</code> are shown in the following code:</p>
    <pre class="programlisting code-one"><code class="hljs-code">var builder = WebApplication.CreateBuilder(args);
var app = builder.Build();
app.MapGet("/", () =&gt; "Hello World!");
app.Run();
</code></pre>
    <ol>
      <li class="numberedList" value="12">After the existing call to <code class="inlineCode">MapGet</code>, add two calls to define an endpoint that returns an anonymous C# object as JSON, and an endpoint that returns <a id="_idIndexMarker1958"/>a web page, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">app.MapGet("/data", () =&gt; Results.Json(new
{
  firstName = "John",
  lastName = "Doe",
  age = 30
}));
app.MapGet("/welcome", () =&gt; Results.Content(
  content: $"""
  &lt;!doctype html&gt;
  &lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;title&gt;Welcome to Northwind Web!&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Welcome to Northwind Web!&lt;/h1&gt;
  &lt;/body&gt;
  &lt;/html&gt;
  """,
  contentType: "text/html"));
</code></pre>
      </li>
    </ol>
    <div><p class="normal">As well as <code class="inlineCode">Json</code> and <code class="inlineCode">Content</code>, the <code class="inlineCode">Results</code> class has many more methods, like <code class="inlineCode">BadRequest</code>, <code class="inlineCode">Bytes</code>, <code class="inlineCode">Created</code>, <code class="inlineCode">File</code>, <code class="inlineCode">NoContent</code>, <code class="inlineCode">NotFound</code>, <code class="inlineCode">Ok</code>, <code class="inlineCode">Problem</code>, <code class="inlineCode">Redirect</code>, and so on. You can learn more at the following link: <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.results">https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.results</a>.</p>
    </div>
    <ol>
      <li class="numberedList" value="13">At the bottom of <code class="inlineCode">Program.cs</code>, add a comment to explain the <code class="inlineCode">Run</code> method and a statement to write a message to the console after <code class="inlineCode">Run</code> and, therefore, after the web server has stopped, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><strong class="hljs-comment-slc">// Start the web server, host the website, and wait for requests.</strong>
app.Run(); <strong class="hljs-comment-slc">// This is a thread-blocking call.</strong>
<strong class="hljs-slc">WriteLine(</strong><strong class="hljs-string-slc">"This executes after the web server has stopped!"</strong><strong class="hljs-slc">);</strong>
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-744" class="heading-2">Testing and securing the website</h2>
    <p class="normal">We will now test the functionality of the ASP.NET Core Empty website project. We will <a id="_idIndexMarker1959"/>also enable the encryption of all <a id="_idIndexMarker1960"/>traffic between the browser and web server for privacy by switching from HTTP to HTTPS. HTTPS is the secure encrypted version of HTTP.</p>
    <ul>
      <li class="bulletList">For Visual Studio:<ol class="numberedList level-2" style="list-style-type: decimal;">
          <li class="numberedList level-2" value="1">In the toolbar, make sure that the <strong class="screenText">https</strong> profile is selected (rather than <strong class="screenText">http</strong>, <strong class="screenText">IIS Express</strong>, or <strong class="screenText">WSL</strong>), and then change <strong class="screenText">Web Browser</strong> to <strong class="screenText">Google Chrome</strong>, as shown in <em class="italic">Figure 13.1</em>:</li>
        </ol>
        <figure class="mediaobject"><img src="img/B22322_13_01.png" alt="" width="746" height="285"/></figure>
        <p class="packt_figref">Figure 13.1: Selecting the https profile with its Kestrel web server in Visual Studio</p>
      </li>
    </ul>
    <ol class="numberedList level-2" style="list-style-type: decimal;">
      <li class="numberedList level-2" value="2">Navigate to <strong class="screenText">Debug</strong> |<strong class="screenText"> Start Without Debugging…</strong>.</li>
      <li class="numberedList level-2">In Windows, if you see a <strong class="screenText">Windows Security Alert</strong> saying <strong class="screenText">Windows Defender Firewall has blocked some features of this app</strong>, then click the <strong class="screenText">Allow access</strong> button.</li>
      <li class="numberedList level-2">The first time you start a secure website, you might be notified that your project is configured to use SSL, and to avoid warnings in the browser, you can choose to trust the self-signed certificate that ASP.NET Core has generated. Click <strong class="screenText">Yes</strong>. When you see the <strong class="screenText">Security Warning</strong> dialog box, click <strong class="screenText">Yes</strong> again.</li>
    </ol>
    <ul>
      <li class="bulletList">For VS Code, enter the command to start the project with the <code class="inlineCode">https</code> profile, like this: <code class="inlineCode">dotnet run --launch-profile https</code>. Then start Chrome.</li>
      <li class="bulletList">For Rider:<ol class="numberedList level-2" style="list-style-type: decimal;">
          <li class="numberedList level-2" value="1">Navigate to <strong class="screenText">Run</strong> | <strong class="screenText">Edit Configurations…</strong>.</li>
          <li class="numberedList level-2">In the <strong class="screenText">Run/Debug Configurations</strong> dialog box, select <strong class="screenText">Northwind.Web: https</strong>.</li>
          <li class="numberedList level-2">At the bottom of the dialog box, to the right of the <strong class="screenText">After launch</strong> check box, select <strong class="screenText">Chrome</strong> and then click <strong class="screenText">OK</strong>.</li>
          <li class="numberedList level-2">Navigate to <strong class="screenText">Run</strong> | <strong class="screenText">Run ‘Northwind.Web: https’</strong>.</li>
        </ol>
      </li>
    </ul>
    <ol>
      <li class="numberedList" value="1">In either <a id="_idIndexMarker1961"/>Visual Studio’s command <a id="_idIndexMarker1962"/>prompt window or VS Code’s terminal, note the following, as shown in the following output:<ul>
          <li class="bulletList level-2">The web server has started listening on the ports we assigned for HTTP and HTTPS.</li>
          <li class="bulletList level-2">You can press <em class="keystroke">Ctrl</em> +<em class="italic"> </em><em class="keystroke">C</em> to shut down the Kestrel web server.</li>
          <li class="bulletList level-2">The hosting environment is <code class="inlineCode">Development</code>.</li>
        </ul>
        <pre class="programlisting con-one"><code class="hljs-con">info: Microsoft.Hosting.Lifetime[14]
  Now listening on: http://localhost:5130
info: Microsoft.Hosting.Lifetime[14]
  Now listening on: https://localhost:5131
info: Microsoft.Hosting.Lifetime[0]
  Application started. Press Ctrl+C to shut down.
info: Microsoft.Hosting.Lifetime[0]
  Hosting environment: Development
info: Microsoft.Hosting.Lifetime[0]
  Content root path: C:\cs13net9\ModernWeb\Northwind.Web
</code></pre>
      </li>
    </ol>
    <div><p class="normal">Visual Studio will also start your chosen browser automatically and navigate to the first URL. If you are using VS Code, you will have to start Chrome manually.</p>
    </div>
    <ol>
      <li class="numberedList" value="2">Leave the <a id="_idIndexMarker1963"/>Kestrel web server <a id="_idIndexMarker1964"/>running in the command prompt or terminal.</li>
      <li class="numberedList">In Chrome, show <strong class="screenText">Developer Tools</strong>, and click the <strong class="screenText">Network</strong> tab.</li>
      <li class="numberedList">Request the home page for the website project:<ul>
          <li class="bulletList level-2">If you are using Visual Studio and Chrome launched automatically with the URL already entered for you, then click the <strong class="screenText">Reload this page</strong> button or press <em class="keystroke">F5</em>.</li>
          <li class="bulletList level-2">If you are using VS Code and the command prompt or terminal, then in the Chrome address bar, manually enter the address <code class="inlineCode">http://localhost:5130/</code>.</li>
        </ul>
      </li>
      <li class="numberedList">In the <strong class="screenText">Network</strong> tab, click <strong class="screenText">localhost</strong>, and note the response is <strong class="screenText">Hello World!</strong> in plain text from the cross-platform Kestrel web server, as shown in <em class="italic">Figure 13.2</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B22322_13_02.png" alt="" width="812" height="307"/></figure>
    <p class="packt_figref">Figure 13.2: Plain text response from the website project</p>
    <div><p class="normal">Browsers like Chrome might also request a <code class="inlineCode">favicon.ico</code> file to show in their browser window or tab, but this file does not exist in our project, so it shows as a <code class="inlineCode">404 Not Found</code> error. If this annoys you, then you can generate a <code class="inlineCode">favicon.ico</code> file for free at the following link and put it in the project folder: <a href="https://favicon.io/">https://favicon.io/</a>. On a web page, you can also specify one in the meta tags, for example, a blank one using Base64 encoding, as shown in the following markup:</p>
      <p class="normal"><code class="inlineCode">&lt;link rel="icon" href="data:;base64,iVBORw0KGgo="&gt;</code></p>
    </div>
    <ol>
      <li class="numberedList" value="6">Enter the address <code class="inlineCode">https://localhost:5131/</code> and note that if you are not using <a id="_idIndexMarker1965"/>Visual Studio or if <a id="_idIndexMarker1966"/>you clicked <strong class="screenText">No</strong> when prompted to trust the SSL certificate, then the response is a privacy error. You will see this error when you have not configured a certificate that the browser can trust to encrypt and decrypt HTTPS traffic (if you do not see this error, it is because you have already configured a certificate). In a production environment, you would want to pay a company such as Verisign for an SSL certificate because they provide liability protection and technical support. During development, you can tell your OS to trust a temporary development certificate provided by ASP.NET Core.</li>
    </ol>
    <div><p class="normal">Visual Studio will also start your chosen browser automatically and navigate to the first URL. If you are using VS Code, you will have to start Chrome manually.</p>
    </div>
    <ol>
      <li class="numberedList" value="7">Enter the address <code class="inlineCode">https://localhost:5131/data</code> and note that some JSON is returned.</li>
      <li class="numberedList">Enter the address <code class="inlineCode">https://localhost:5131/welcome</code> and note that a web page is returned.</li>
      <li class="numberedList">At the command prompt or terminal, press <em class="keystroke">Ctrl</em><em class="italic"> </em>+ <em class="keystroke">C</em> to shut down the web server, and note the message that is written, as shown highlighted in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">info: Microsoft.Hosting.Lifetime[0]
      Application is shutting down...
<strong class="hljs-con-slc">This executes after the web server has stopped!</strong>
C:\cs13net9\ModernWeb\Northwind.Web\bin\Debug\net9.0\Northwind.Web.exe (process 19888) exited with code 0.
</code></pre>
      </li>
      <li class="numberedList">If you <a id="_idIndexMarker1967"/>need to trust a local <a id="_idIndexMarker1968"/>self-signed SSL certificate, then at the command line or terminal, enter the following command: <code class="inlineCode">dotnet dev-certs https --trust</code>.</li>
      <li class="numberedList">Note the message <strong class="screenText">Trusting the HTTPS development certificate was requested</strong>. You might be prompted to enter your password, and a valid HTTPS certificate may already be present.</li>
    </ol>
    <h2 id="_idParaDest-745" class="heading-2">Enabling stronger security and redirecting to a secure connection</h2>
    <p class="normal">It is <a id="_idIndexMarker1969"/>good practice to enable stricter <a id="_idIndexMarker1970"/>security and automatically redirect requests for HTTP to HTTPS.</p>
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: An <a id="_idIndexMarker1971"/>optional but recommended security enhancement is <strong class="keyWord">HTTP Strict Transport Security</strong> (<strong class="keyWord">HSTS</strong>), which you should always enable. If a website specifies it and a browser supports it, then it forces all communication over HTTPS and prevents the visitor from using untrusted or invalid certificates.</p>
    </div>
    <p class="normal">Let’s do that now:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, after the statement that builds the <code class="inlineCode">app</code>, add a region and an <code class="inlineCode">if</code> statement to enable HSTS when <em class="italic">not</em> in development, and redirect HTTP requests to HTTPS, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">var builder = WebApplication.CreateBuilder(args);
var app = builder.Build();
<strong class="hljs-meta-slc">#</strong><strong class="hljs-keyword-slc">region</strong><strong class="hljs-meta-slc"> Configure the HTTP pipeline and routes</strong>
<strong class="hljs-keyword-slc">if</strong><strong class="hljs-slc"> (!app.Environment.IsDevelopment())</strong>
<strong class="hljs-slc">{</strong>
<strong class="hljs-slc">  app.UseHsts();</strong>
<strong class="hljs-slc">}</strong>
<strong class="hljs-slc">app.UseHttpsRedirection();</strong>
app.MapGet("/", () =&gt; "Hello World!");
// Other MapGet calls.
<strong class="hljs-meta-slc">#</strong><strong class="hljs-keyword-slc">endregion</strong>
// Start the web server, host the website, and wait for requests.
app.Run(); // This is a thread-blocking call.
WriteLine("This executes after the web server has stopped!");
</code></pre>
      </li>
      <li class="numberedList">Start <a id="_idIndexMarker1972"/>the <code class="inlineCode">Northwind.Web</code> website project without debugging using the <code class="inlineCode">https</code> launch profile.</li>
      <li class="numberedList">If Chrome <a id="_idIndexMarker1973"/>is still running, close and restart it.</li>
      <li class="numberedList">In Chrome, show <strong class="screenText">Developer Tools</strong>, and click the <strong class="screenText">Network</strong> tab.</li>
      <li class="numberedList">Enter the address <code class="inlineCode">http://localhost:5130/</code>, and note how the server responds with a <strong class="screenText">307 Temporary Redirect</strong> to <code class="inlineCode">https://localhost:5131/</code>, and that the certificate is valid and trusted, as shown in <em class="italic">Figure 13.3</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B22322_13_03.png" alt="" width="812" height="307"/></figure>
    <p class="packt_figref">Figure 13.3: The connection is now secured using a valid certificate and a 307 redirect</p>
    <ol>
      <li class="numberedList" value="6">Close <a id="_idIndexMarker1974"/>Chrome and shut <a id="_idIndexMarker1975"/>down the web server.</li>
    </ol>
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: Remember to shut down the Kestrel web server by switching to the command prompt or terminal and pressing <em class="keystroke">Ctrl</em> + <em class="keystroke">C</em> whenever you have finished testing a website.</p>
    </div>
    <h2 id="_idParaDest-746" class="heading-2">Controlling the hosting environment</h2>
    <p class="normal">In ASP.NET Core 5 and earlier, the project template sets a rule to say that while in <a id="_idIndexMarker1976"/>development mode, any unhandled exceptions will be shown in the browser window for the developer to see the details of the exception, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">if (app.Environment.IsDevelopment())
{
  app.UseDeveloperExceptionPage();
}
</code></pre>
    <p class="normal">With ASP.NET Core 6 and later, this code is configured by default by the <code class="inlineCode">WebApplication</code> builder and therefore executed automatically so it is no longer needed in the project template <code class="inlineCode">Program.cs</code> source code.</p>
    <p class="normal">How does ASP.NET Core know when we are running in development mode so that the <code class="inlineCode">IsDevelopment</code> method returns <code class="inlineCode">true</code>, and this extra code executes to set up the developer exception page? Let’s find out.</p>
    <p class="normal">ASP.NET Core can read from settings files and environment variables to determine what hosting environment to use, for example, <code class="inlineCode">DOTNET_ENVIRONMENT</code> or <code class="inlineCode">ASPNETCORE_ENVIRONMENT</code>.</p>
    <p class="normal">You can <a id="_idIndexMarker1977"/>override these settings during local development:</p>
    <ol>
      <li class="numberedList" value="1">In the <code class="inlineCode">Northwind.Web</code> folder, expand the folder named <code class="inlineCode">Properties</code>, and open the file named <code class="inlineCode">launchSettings.json</code>. Note that the <code class="inlineCode">https</code> launch profile sets the environment variable for the hosting environment to <code class="inlineCode">Development</code>, as shown highlighted in the following configuration:
        <pre class="programlisting code-one"><code class="hljs-code">"https": {
  "commandName": "Project",
  "dotnetRunMessages": true,
  "launchBrowser": true,
  "applicationUrl": "https://localhost:5131;http://localhost:5130",
<strong class="hljs-slc">  </strong><strong class="hljs-string-slc">"environmentVariables"</strong><strong class="hljs-slc">: {</strong>
<strong class="hljs-slc">    </strong><strong class="hljs-string-slc">"ASPNETCORE_ENVIRONMENT"</strong><strong class="hljs-slc">: </strong><strong class="hljs-string-slc">"Development"</strong>
<strong class="hljs-slc">  }</strong>
},
</code></pre>
      </li>
      <li class="numberedList">Change the <code class="inlineCode">ASPNETCORE_ENVIRONMENT</code> environment variable from <code class="inlineCode">Development</code> to <code class="inlineCode">Production</code>.</li>
      <li class="numberedList">If you are using Visual Studio, optionally, change <code class="inlineCode">launchBrowser</code> to <code class="inlineCode">false</code> to prevent Visual Studio from automatically launching a browser. This setting is ignored when you start a website project using <code class="inlineCode">dotnet run</code> or Rider.</li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, modify the first <code class="inlineCode">MapGet</code> statement to return the name of the environment instead of <code class="inlineCode">Hello World</code>, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">app.MapGet("/", () =&gt;
  <strong class="hljs-string-slc">$"Environment is </strong><strong class="hljs-subst-slc">{app.Environment.EnvironmentName}</strong><strong class="hljs-string-slc">"</strong>);
</code></pre>
      </li>
      <li class="numberedList">Start the website project using the <code class="inlineCode">https</code> launch profile and note that the hosting environment is <code class="inlineCode">Production</code>, as shown in the following output:
        <pre class="programlisting con-one"><code class="hljs-con">info: Microsoft.Hosting.Lifetime[0]
  Hosting environment: Production
</code></pre>
      </li>
      <li class="numberedList">In Chrome, note that the plain text is <code class="inlineCode">Environment is Production</code>.</li>
      <li class="numberedList">Shut <a id="_idIndexMarker1978"/>down the web server.</li>
      <li class="numberedList">In <code class="inlineCode">launchSettings.json</code>, change the environment variable back to <code class="inlineCode">Development</code>, and save the changes to the file.</li>
    </ol>
    <div><p class="normal"><strong class="keyWord">More Information</strong>: You can learn more about environments at the following link: <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/environments">https://learn.microsoft.com/en-us/aspnet/core/fundamentals/environments</a>.</p>
    </div>
    <h2 id="_idParaDest-747" class="heading-2">Enabling a website to serve static content</h2>
    <p class="normal">A website that only ever returns a single plain text message isn’t very useful!</p>
    <p class="normal">At a <a id="_idIndexMarker1979"/>minimum, it ought to return static HTML pages, CSS that the web pages will use for styling, and any other static resources, such as images and videos.</p>
    <p class="normal">By convention, these files should be stored in a directory named <code class="inlineCode">wwwroot</code> to keep them separate from the dynamically executing parts of your website project.</p>
    <h2 id="_idParaDest-748" class="heading-2">Creating a folder for static files and a web page</h2>
    <p class="normal">You <a id="_idIndexMarker1980"/>will now create a folder for <a id="_idIndexMarker1981"/>your static website resources and a basic index page that uses Bootstrap for styling:</p>
    <ol>
      <li class="numberedList" value="1">In the <code class="inlineCode">Northwind.Web</code> project/folder, create a folder named <code class="inlineCode">wwwroot</code>. Note that Visual Studio recognizes it as a special type of folder by giving it a globe icon, <img src="img/global_icon.png" alt="" width="22" height="21"/>.</li>
      <li class="numberedList">In the <code class="inlineCode">wwwroot</code> folder, add a new file named <code class="inlineCode">index.html</code>. (In Visual Studio, the project item template is named <strong class="screenText">HTML Page</strong>.)</li>
      <li class="numberedList">In <code class="inlineCode">index.html</code>, modify its markup to link to CDN-hosted Bootstrap for styling, and <a id="_idIndexMarker1982"/>use modern <a id="_idIndexMarker1983"/>good practices such as setting the viewport, as shown in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code">&lt;!doctype html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;!-- Required meta tags --&gt;
  &lt;meta charset="utf-8" /&gt;
  &lt;meta name="viewport" content=
    "width=device-width, initial-scale=1, shrink-to-fit=no" /&gt;
  &lt;!-- Bootstrap CSS --&gt;
  &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"&gt;
  &lt;title&gt;Welcome ASP.NET Core!&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div class="container"&gt;
    &lt;div class="jumbotron"&gt;
      &lt;h1 class="display-3"&gt;Welcome to Northwind B2B&lt;/h1&gt;
      &lt;p class="lead"&gt;We supply products to our customers.&lt;/p&gt;
      &lt;hr /&gt;
      &lt;h2&gt;This is a static HTML page.&lt;/h2&gt;
      &lt;p&gt;Our customers include restaurants, hotels, and cruise lines.&lt;/p&gt;
      &lt;p&gt;
        &lt;a class="btn btn-primary"
          href="https://www.asp.net/"&gt;Learn more&lt;/a&gt;
      &lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
        <div><p class="normal"><strong class="keyWord">Good Practice</strong>: Check out the latest version at the following link: <a href="https://getbootstrap.com/docs/versions/">https://getbootstrap.com/docs/versions/</a>. Click the latest version to go to its <strong class="screenText">Get started with Bootstrap</strong> page. Scroll down the page to step 2 to find the latest <code class="inlineCode">&lt;link&gt;</code> element (and later in this chapter, the <code class="inlineCode">&lt;script&gt;</code> element), which you can then copy and paste.</p>
        </div>
      </li>
    </ol>
    <div><p class="normal">Bootstrap is the world’s most popular framework for building responsive, mobile-first websites. You can read an online-only section introducing some of Bootstrap’s most important features at the following link: <a href="https://github.com/markjprice/cs13net9/blob/main/docs/ch13-bootstrap.md">https://github.com/markjprice/cs13net9/blob/main/docs/ch13-bootstrap.md</a>.</p>
    </div>
    <ol>
      <li class="numberedList" value="4">In <a id="_idIndexMarker1984"/>the <code class="inlineCode">wwwroot</code> folder, add <a id="_idIndexMarker1985"/>a file named <code class="inlineCode">site.css</code> and modify its content, as shown in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code">h1 {
   color: darkcyan;
   font-style: italic;
}
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">wwwroot</code> folder, add a file named <code class="inlineCode">categories.jpeg</code>. You can download it from the following link: <a href="https://github.com/markjprice/cs13net9/blob/main/code/images/Categories/categories.jpeg">https://github.com/markjprice/cs13net9/blob/main/code/images/Categories/categories.jpeg</a>.</li>
      <li class="numberedList">In the <code class="inlineCode">wwwroot</code> folder, add a file named <code class="inlineCode">about.html</code> and modify its content, as shown in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code">&lt;!doctype html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta charset="utf-8" /&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" /&gt;
  &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"&gt;
  &lt;link href="site.css" rel="stylesheet" /&gt;
  &lt;title&gt;About Northwind Web&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div class="container"&gt;
    &lt;div class="jumbotron"&gt;
      &lt;h1 class="display-3"&gt;About Northwind Web&lt;/h1&gt;
      &lt;p class="lead"&gt;We supply products to our customers.&lt;/p&gt;
      &lt;img src="img/categories.jpeg" /&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
      </li>
    </ol>
    <h2 id="_idParaDest-749" class="heading-2">Enabling static and default files</h2>
    <p class="normal">If you were to start the website now and enter <code class="inlineCode">http://localhost:5130/index.html</code> or <code class="inlineCode">https://localhost:5131/index.html</code> in the address <a id="_idIndexMarker1986"/>box, the website would return a <code class="inlineCode">404 Not Found</code> error saying no web page was found. To enable the website to return static files such as <code class="inlineCode">index.html</code>, we must explicitly configure that feature.</p>
    <p class="normal">Even if we enable static files stored in <code class="inlineCode">wwwroot</code>, if you were to start the website and enter <code class="inlineCode">http://localhost:5130/</code> or <code class="inlineCode">https://localhost:5131/</code> in the address box, the website would still return a <code class="inlineCode">404 Not Found</code> error because the web server does not know what to return by default if no named file is requested.</p>
    <p class="normal">You will now enable static files, explicitly configure default files like <code class="inlineCode">index.html</code>, and change the URL path registered that returns the plain text response:</p>
    <ol>
      <li class="numberedList" value="1">In <code class="inlineCode">Program.cs</code>, add statements after enabling HTTPS redirection to enable static files and default files. Also, modify the statement that maps a <code class="inlineCode">GET</code> request to return the plain text response containing the environment name to <a id="_idIndexMarker1987"/>only respond to the URL path <code class="inlineCode">/env</code>, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><strong class="hljs-slc">app.UseDefaultFiles(); </strong><strong class="hljs-comment-slc">// index.html, default.html, and so on.</strong>
<strong class="hljs-slc">app.MapStaticAssets(); </strong><strong class="hljs-comment-slc">// .NET 9 or later.</strong>
<strong class="hljs-comment-slc">// app.UseStaticFiles();</strong><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc">// .NET 8 or earlier.</strong>
app.MapGet("/<strong class="hljs-string-slc">env</strong>", () =&gt;
  $"Environment is {app.Environment.EnvironmentName}");
</code></pre>
        <div><p class="normal">ASP.NET Core 9 introduced the <code class="inlineCode">MapStaticAssets</code> method that automatically compresses the static files, which reduces bandwidth requirements. For ASP.NET Core 8 and earlier, you must call the <code class="inlineCode">UseStaticFiles</code> method instead. You <a id="_idIndexMarker1988"/>can learn more at the following link: <a href="https://learn.microsoft.com/en-us/aspnet/core/release-notes/aspnetcore-9.0#optimizing-static-web-asset-delivery">https://learn.microsoft.com/en-us/aspnet/core/release-notes/aspnetcore-9.0#optimizing-static-web-asset-delivery</a>.</p>
        </div>
      </li>
    </ol>
    <div><p class="normal"><strong class="keyWord">Warning!</strong> The call to <code class="inlineCode">UseDefaultFiles</code> must come before the call to <code class="inlineCode">MapStaticAssets</code> or <code class="inlineCode">UseStaticFiles</code>, or it will not work! You will learn more about the ordering of middleware and endpoint routing in an online section linked at the end of this chapter.</p>
    </div>
    <ol>
      <li class="numberedList" value="2">Start the website.</li>
      <li class="numberedList">Start Chrome and show <strong class="screenText">Developer Tools</strong>.</li>
      <li class="numberedList">In Chrome, enter <code class="inlineCode">http://localhost:5130/</code>. Note that you are redirected to the HTTPS address on port <code class="inlineCode">5131</code>, and the <code class="inlineCode">index.html</code> file is now returned over that secure connection because it is one of the possible default files for this website and it was the first match found in the <code class="inlineCode">wwwroot</code> folder.</li>
    </ol>
    <div><p class="normal"><strong class="keyWord">Warning!</strong> If you still see the environment name as plain text, make sure that you mapped the relative path <code class="inlineCode">/env</code> to that endpoint instead of just <code class="inlineCode">/</code>, otherwise that will override the default request for the <code class="inlineCode">index.html</code> file.</p>
    </div>
    <ol>
      <li class="numberedList" value="5">In Chrome, enter <code class="inlineCode">http://localhost:5131/about.html</code> and note that the web <a id="_idIndexMarker1989"/>page is returned, and it requests the <code class="inlineCode">site.css</code> file, which applies additional styles.</li>
      <li class="numberedList">In <strong class="screenText">Developer Tools</strong>, note the request for the Bootstrap stylesheet.</li>
      <li class="numberedList">In Chrome, enter <code class="inlineCode">http://localhost:5130/env</code> and note that it returns the plain text environment name as before.</li>
      <li class="numberedList">Close Chrome and shut down the web server.</li>
    </ol>
    <h2 id="_idParaDest-750" class="heading-2">Understanding MapStaticAssets</h2>
    <p class="normal">Introduced in .NET 9, <code class="inlineCode">MapStaticAssets</code> works by integrating build and publish-time <a id="_idIndexMarker1990"/>processes to gather data about all the static resources in an application. This data is then used by the runtime library to serve these files efficiently to the browser.</p>
    <p class="normal">While <code class="inlineCode">MapStaticAssets</code> can often directly replace <code class="inlineCode">UseStaticFiles</code>, it is specifically optimized for serving assets known to the app at build and publish time. For assets served from other locations, such as disk or embedded resources, <code class="inlineCode">UseStaticFiles</code> should still be used.</p>
    <p class="normal"><code class="inlineCode">MapStaticAssets</code> provides <a id="_idIndexMarker1991"/>the following benefits compared to <code class="inlineCode">UseStaticFiles</code>:</p>
    <ul>
      <li class="bulletList">Build time compression for all the assets in the app:<ul>
          <li class="bulletList level-2"><code class="inlineCode">gzip</code> during development and <code class="inlineCode">gzip</code> + <code class="inlineCode">brotli</code> during publishing.</li>
          <li class="bulletList level-2">All assets are compressed with the goal of reducing the size of the assets to the minimum.</li>
        </ul>
      </li>
      <li class="bulletList">The ETags for each resource are the Base64-encoded string of the SHA-256 hash <a id="_idIndexMarker1992"/>of the content. This ensures that the browser only redownloads a file if its contents have changed.</li>
    </ul>
    <p class="normal">As an example, <em class="italic">Table 13.1</em> shows the original and compressed sizes using the Fluent UI <a id="_idIndexMarker1993"/>Blazor components library, with a total of 478 KB uncompressed to 84 KB compressed:</p>
    <table id="table001-12" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">File</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Original</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Compressed</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">% Reduction</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">fluent.js</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">384</p>
          </td>
          <td class="table-cell">
            <p class="normal">73</p>
          </td>
          <td class="table-cell">
            <p class="normal">80.99%</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">fluent.css</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">94</p>
          </td>
          <td class="table-cell">
            <p class="normal">11</p>
          </td>
          <td class="table-cell">
            <p class="normal">88.30%</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Total</p>
          </td>
          <td class="table-cell">
            <p class="normal">478</p>
          </td>
          <td class="table-cell">
            <p class="normal">84</p>
          </td>
          <td class="table-cell">
            <p class="normal">82.43%</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 13.1: How MapStaticAssets compresses Fluent UI Blazor components</p>
    <p class="normal">If all web pages are static (that is, they only get changed manually by a web editor), then our website programming work is complete. But almost all websites need dynamic content, which means a web page that is generated at runtime by executing code.</p>
    <p class="normal">The easiest <a id="_idIndexMarker1994"/>way to do that is to use a feature of ASP.NET Core named Blazor static<strong class="keyWord"> </strong>SSR. But before that, let’s <a id="_idIndexMarker1995"/>understand why you might see additional requests in tools like <strong class="keyWord">Developer Tools</strong> that you don’t expect.</p>
    <h2 id="_idParaDest-751" class="heading-2">Understanding browser requests during development</h2>
    <p class="normal">In <strong class="screenText">Developer Tools</strong>, we can <a id="_idIndexMarker1996"/>see all the requests made by the browser. Some will be requests that you expect, for example:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">localhost</code>: This is the request for the home page in the website project. For our current project, the address will be <code class="inlineCode">http://localhost:5130/</code> or <code class="inlineCode">https://localhost:5131/</code>.</li>
      <li class="bulletList"><code class="inlineCode">bootstrap.min.css</code>: This is the request for Bootstrap’s styles. We added a reference to this on the home page, so the browser then made this request for the stylesheet.</li>
    </ul>
    <p class="normal">Some of <a id="_idIndexMarker1997"/>the requests are made only during development and are determined by the code editor that you use. You can usually ignore them if you see them in <strong class="keyWord">Developer Tools</strong>. For example:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">browserLink</code> and <code class="inlineCode">aspnetcore-browser-refresh.js</code>: These are requests made by Visual Studio to connect the browser to Visual Studio for debugging and Hot Reload. For example, <code class="inlineCode">https://localhost:5131/_vs/browserLink</code> and <code class="inlineCode">https://localhost:5131/_framework/aspnetcore-browser-refresh.js</code>.</li>
      <li class="bulletList"><code class="inlineCode">negotiate?requestUrl</code>, <code class="inlineCode">connect?transport</code>, <code class="inlineCode">abort?Transport</code>, and so on: These are additional requests used to connect Visual Studio with the browser.</li>
      <li class="bulletList"><code class="inlineCode">Northwind.Web/</code>: This is a secure WebSockets request related to SignalR used to connect Visual Studio with the browser: <code class="inlineCode">wss://localhost:44396/Northwind.Web/</code>.</li>
    </ul>
    <p class="normal">Now that you have seen how to set up a basic website with support for static files like HTML web pages and CSS, let’s make it more interesting by adding support for dynamically generated static web pages (once the web page arrives at the browser client, it is static).</p>
    <p class="normal">ASP.NET Core has multiple technologies for dynamically generating static web pages, including Razor Pages and <strong class="keyWord">Model View Controller</strong> (<strong class="keyWord">MVC</strong>) Razor views. The most modern technology for dynamic web pages is Blazor static SSR pages. But let’s first review Blazor and why it was created.</p>
    <h1 id="_idParaDest-752" class="heading-1">History of Blazor</h1>
    <p class="normal">Blazor lets <a id="_idIndexMarker1998"/>you build interactive web UI components using C# instead of JavaScript. Blazor is supported on all modern browsers.</p>
    <h2 id="_idParaDest-753" class="heading-2">JavaScript and friends</h2>
    <p class="normal">Traditionally, any code that needs to be executed in a web browser must be written <a id="_idIndexMarker1999"/>using the JavaScript programming language or a higher-level <a id="_idIndexMarker2000"/>technology that <strong class="keyWord">transpiles</strong> (transforms or compiles) into JavaScript. This is because all browsers have supported JavaScript for over two decades, so it is the lowest common denominator for implementing business logic in the client.</p>
    <p class="normal">JavaScript does have some issues, however. Although it has superficial similarities to C-style languages like C# and Java, it is actually very different once you dig beneath the surface. It is a dynamically typed pseudo-functional language that uses prototypes instead of class inheritance for object reuse. It might look human, but you will get a surprise when it’s revealed to be a Skrull.</p>
    <p class="normal">It’d be great if we could use the same language and libraries in a browser as we do on the server.</p>
    <div><p class="normal">Even Blazor cannot replace JavaScript completely. For example, some parts of the browser are only accessible to JavaScript. Blazor provides an interop service so that your C# code can call JavaScript code, and vice versa. You will see this in the online-only <em class="italic">Interop with JavaScript</em> section in <em class="chapterRef">Chapter 14</em>, <em class="chapterRef">Building Interactive Web Components Using Blazor</em>.</p>
    </div>
    <h2 id="_idParaDest-754" class="heading-2">Silverlight – C# and .NET using a plugin</h2>
    <p class="normal">Microsoft <a id="_idIndexMarker2001"/>made a previous attempt at achieving this goal with a technology <a id="_idIndexMarker2002"/>named Silverlight. When Silverlight 2 was released in 2008, a C# and .NET developer could use their skills to build libraries and visual components that were executed in the web browser by the Silverlight plugin.</p>
    <p class="normal">By 2011 and Silverlight 5, Apple’s success with the iPhone and Steve Jobs’ hatred of browser <a id="_idIndexMarker2003"/>plugins like Flash eventually led to Microsoft abandoning <a id="_idIndexMarker2004"/>Silverlight since, like Flash, Silverlight is banned from iPhones and iPads.</p>
    <h2 id="_idParaDest-755" class="heading-2">WebAssembly – a target for Blazor</h2>
    <p class="normal">Another development in web browsers has given Microsoft the opportunity to make another <a id="_idIndexMarker2005"/>attempt. In 2017, the <strong class="keyWord">WebAssembly Consensus</strong> was completed, and all major browsers now support it: Chromium (Chrome, Edge, Opera, and Brave), Firefox, and WebKit (Safari).</p>
    <p class="normal"><strong class="keyWord">WebAssembly</strong> (<strong class="keyWord">Wasm</strong>) is a binary <a id="_idIndexMarker2006"/>instruction format <a id="_idIndexMarker2007"/>for a virtual machine that provides a way to run code written in multiple languages on the web at near-native speed. Wasm is designed as a portable target for the compilation of high-level languages like C#.</p>
    <h2 id="_idParaDest-756" class="heading-2">Blazor hosting models in .NET 7 and earlier</h2>
    <p class="normal">Blazor <a id="_idIndexMarker2008"/>is a single programming or app model. For .NET 7 and earlier, a developer had to choose one hosting model for each project:</p>
    <ul>
      <li class="bulletList">A <strong class="keyWord">Blazor Server</strong> project runs on the server side, so the C# code has full access to <a id="_idIndexMarker2009"/>all resources that your business logic might need without needing to supply credentials to authenticate. It uses SignalR to communicate UI updates to the client side. The server must keep a live SignalR connection to each client and track the current state of every client. This means that Blazor Server does not scale well if you need to support lots of clients. It first shipped as part of ASP.NET Core 3 in September 2019.</li>
      <li class="bulletList">A <strong class="keyWord">Blazor Wasm</strong> project runs on the client side, so the C# code only has <a id="_idIndexMarker2010"/>access to resources in the browser. It must make HTTP calls (which might require authentication) before it can access resources on the server. It first shipped as an extension to ASP.NET Core 3.1 in May 2020 and was versioned 3.2 because it was a current release and therefore not covered by ASP.NET Core 3.1’s Long-Term Support. The Blazor Wasm 3.2 version used the Mono runtime and Mono libraries. .NET 5 and later use the Mono runtime and the .NET libraries.</li>
      <li class="bulletList">A <strong class="keyWord">.NET MAUI Blazor app</strong>, aka <strong class="keyWord">Blazor Hybrid</strong>, project renders its web UI to <a id="_idIndexMarker2011"/>a web view control using a local interop <a id="_idIndexMarker2012"/>channel and is hosted in a .NET MAUI app. It is conceptually like an Electron app.</li>
    </ul>
    <h2 id="_idParaDest-757" class="heading-2">Unification of Blazor hosting models in .NET 8</h2>
    <p class="normal">With .NET 8, the <a id="_idIndexMarker2013"/>Blazor team has created a unified hosting model where each individual component can be set to execute using a different rendering model:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">SSR</strong>: Executes code on the server side like Razor <a id="_idIndexMarker2014"/>Pages and MVC do. The complete response is then sent to the browser to display to the visitor and there is no further interaction between the server and client until the browser makes a new HTTP request. As far as the browser is concerned, the web page is static just like any other HTML file.</li>
      <li class="bulletList"><strong class="keyWord">Streaming rendering</strong>: Executes code on the server side. HTML markup <a id="_idIndexMarker2015"/>can be returned and displayed in the browser, and while the connection is still open, any asynchronous operations can continue to execute. When all asynchronous operations are complete, the final markup is sent by the server to update the contents of the page. This improves the experience for the visitor because they see some content like a “Loading…” message while waiting for the rest.</li>
      <li class="bulletList"><strong class="keyWord">Interactive server rendering</strong>: Executes code on the server side during live <a id="_idIndexMarker2016"/>interactions, which means the code has full and easy access to server-side resources like databases. This can simplify implementing functionality. Interactive requests are made using SignalR, which is more efficient than a full request. A permanent connection is needed between the browser and server, which limits scalability. This is a good choice for intranet websites where there are a limited number of clients and high bandwidth networking.</li>
      <li class="bulletList"><strong class="keyWord">Interactive Wasm rendering</strong>: Executes code on the client side, which <a id="_idIndexMarker2017"/>means the code only has access to resources within the browser. This can complicate the implementation because a callback to the server must be made whenever new data is required. A good choice for public websites where there are potentially a large number of clients and low bandwidth connections for some of them.</li>
      <li class="bulletList"><strong class="keyWord">Interactive automatic rendering</strong>: Starts by rendering on the server for faster <a id="_idIndexMarker2018"/>initial display, downloads Wasm components in the background, and then switches to Wasm for subsequent interactivity.</li>
    </ul>
    <p class="normal">This unified model means that, with careful planning, a developer can write Blazor components once and then choose to run them on the web server side, or the web client side, or dynamically switch. This gives the best of all worlds.</p>
    <h2 id="_idParaDest-758" class="heading-2">Understanding Blazor components</h2>
    <p class="normal">It is important <a id="_idIndexMarker2019"/>to understand that Blazor is used to create <strong class="keyWord">UI components</strong>. Components <a id="_idIndexMarker2020"/>define how to render the UI and react to user events, and can be composed, nested, and compiled into a Razor class library for packaging and distribution.</p>
    <p class="normal">For example, to provide a UI for star ratings of products on a commerce site, you might create a component named <code class="inlineCode">Rating.razor</code>, as shown in the following markup:</p>
    <pre class="programlisting code"><code class="hljs-code">&lt;div&gt;
@for (int i = 0; i &lt; Maximum; i++)
{
  if (i &lt; Value)
  {
    &lt;span class="oi oi-star-filled" /&gt;
  }
  else
  {
    &lt;span class="oi oi-star-empty" /&gt;
  }
}
&lt;/div&gt;
@code {
  [Parameter]
  public byte Maximum { get; set; }
  [Parameter]
  public byte Value { get; set; }
}
</code></pre>
    <p class="normal">You could <a id="_idIndexMarker2021"/>then use the component on a web page, as shown in the following markup:</p>
    <pre class="programlisting code"><code class="hljs-code">&lt;h1&gt;Review&lt;/h1&gt;
&lt;Rating id="rating" Maximum="5" Value="3" /&gt;
&lt;textarea id="comment" /&gt;
</code></pre>
    <p class="normal">The markup for creating an instance of a component looks like an HTML tag, where the name of the tag is the component type. Components can be embedded in a web page using an element, for example, <code class="inlineCode">&lt;Rating Value="5" /&gt;</code>, or they can be routed to, like a mapped endpoint.</p>
    <p class="normal">Instead of a single file with both markup and an <code class="inlineCode">@code</code> block, the code can be stored in a separate code-behind file named <code class="inlineCode">Rating.razor.cs</code>. The class in this file must be <code class="inlineCode">partial</code> and have the same name as the component.</p>
    <p class="normal">There are <a id="_idIndexMarker2022"/>many built-in Blazor components, including ones to set elements like <code class="inlineCode">&lt;title&gt;</code> in the <code class="inlineCode">&lt;head&gt;</code> section of a web page, and plenty of third parties who will sell you components for common purposes.</p>
    <h2 id="_idParaDest-759" class="heading-2">What is the difference between Blazor and Razor?</h2>
    <p class="normal">You might wonder why Blazor components use <code class="inlineCode">.razor</code> as their file extension. Razor <a id="_idIndexMarker2023"/>is a template markup syntax that allows the mixing of <a id="_idIndexMarker2024"/>HTML and C#. Older technologies that support Razor syntax use the <code class="inlineCode">.cshtml</code> file extension to indicate the mix of C# and HTML.</p>
    <p class="normal">Razor syntax is used for:</p>
    <ul>
      <li class="bulletList">ASP.NET Core MVC <strong class="keyWord">views</strong> and <strong class="keyWord">partial views</strong> that use the <code class="inlineCode">.cshtml</code> file extension. The business logic is separated into a controller class that treats the view as a template to push the view model to, which then outputs it to a web page.</li>
      <li class="bulletList"><strong class="keyWord">Razor Pages</strong> that use the <code class="inlineCode">.cshtml</code> file extension. The business logic can be embedded or separated into a file that uses the <code class="inlineCode">.cshtml.cs</code> file extension. The output is a web page.</li>
      <li class="bulletList"><strong class="keyWord">Blazor components</strong> that use the <code class="inlineCode">.razor</code> file extension. The output is rendered as part of a web page, although layouts can be used to wrap a component so it outputs as a web page, and the <code class="inlineCode">@page</code> directive can be used to assign a route that defines the URL path to retrieve the component as a page.</li>
    </ul>
    <p class="normal">Now that you understand the background of Blazor, let’s see something more practical: how to add Blazor support to an existing ASP.NET Core project.</p>
    <h1 id="_idParaDest-760" class="heading-1">Exploring Blazor static SSR</h1>
    <p class="normal">ASP.NET <a id="_idIndexMarker2025"/>Core Blazor static SSR allows a developer to easily mix C# code statements with HTML markup to make the generated web page dynamic.</p>
    <h2 id="_idParaDest-761" class="heading-2">Enabling Blazor static SSR</h2>
    <p class="normal">Here is <a id="_idIndexMarker2026"/>a summary of the tasks that you must complete to enable Blazor and its static SSR capability in an existing ASP.NET Core project:</p>
    <ol>
      <li class="numberedList" value="1">Create a <code class="inlineCode">Components</code> folder to contain your Blazor components.</li>
      <li class="numberedList">Create a <code class="inlineCode">Components\Pages</code> folder to contain your Blazor page components.</li>
      <li class="numberedList">In the <code class="inlineCode">Components</code> folder, create three <code class="inlineCode">.razor</code> files:<ul>
          <li class="bulletList level-2"><code class="inlineCode">_Imports.razor</code>: This file imports namespaces for all <code class="inlineCode">.razor</code> files so that you do not need to import them at the top of every <code class="inlineCode">.razor</code> file. At a minimum, you will want to import the namespace for Blazor routing and your local project Blazor components.</li>
          <li class="bulletList level-2"><code class="inlineCode">App.razor</code>: This file contains HTML for the web page that will contain all your Blazor components. It also needs to reference your Blazor <code class="inlineCode">Routes</code> component somewhere in the <code class="inlineCode">&lt;body&gt;</code> of the web page.</li>
          <li class="bulletList level-2"><code class="inlineCode">Routes.razor</code>: This file defines a <code class="inlineCode">&lt;Router&gt;</code> component that scans the current assembly for page components and their registered routes.</li>
        </ul>
      </li>
      <li class="numberedList">In <code class="inlineCode">Components\Pages</code>, create an <code class="inlineCode">Index.razor</code> file, a Blazor page component that will be your home page shown by default by the Blazor router. It will need a directive at the top of the file to define a route for the root path: <code class="inlineCode">@page "/"</code>.</li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, you must call <code class="inlineCode">AddRazorComponents()</code> to register Blazor aka Razor components (<code class="inlineCode">*.razor</code>) files with ASP.NET Core’s dependency services collection, and then call <code class="inlineCode">MapRazorComponents&lt;App&gt;()</code> to map endpoints for all the found Blazor routes. You must also call <code class="inlineCode">UseAntiforgery()</code> because Blazor components automatically check for anti-forgery tokens; therefore, the HTTP pipeline must enable middleware to support them.</li>
    </ol>
    <p class="normal">You will <a id="_idIndexMarker2027"/>now add and enable the Blazor static SSR service, and then copy and change the static HTML page into a Blazor static SSR file:</p>
    <ol>
      <li class="numberedList" value="1">In the <code class="inlineCode">Northwind.Web</code> project folder, create a folder named <code class="inlineCode">Components</code>.</li>
      <li class="numberedList">In the <code class="inlineCode">Components</code> folder, create a folder named <code class="inlineCode">Pages</code>.</li>
      <li class="numberedList">In the <code class="inlineCode">Components</code> folder, create a file named <code class="inlineCode">_Imports.razor</code>.</li>
      <li class="numberedList">In <code class="inlineCode">_Imports.razor</code>, add statements to import the namespaces for Blazor components routing, and for your <code class="inlineCode">Northwind.Web</code> project and its components, as shown in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code">@using Microsoft.AspNetCore.Components.Routing
@using Northwind.Web
@using Northwind.Web.Components
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">Components</code> folder, create a file named <code class="inlineCode">Routes.razor</code>.</li>
      <li class="numberedList">In <code class="inlineCode">Routes.razor</code>, add statements to define a router that scans the current assembly for Blazor page components that have been registered with a route, as shown in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code">&lt;Router AppAssembly="typeof(Program).Assembly"&gt;
  &lt;Found Context="routeData"&gt;
    &lt;RouteView RouteData="routeData" /&gt;
  &lt;/Found&gt;
&lt;/Router&gt;
</code></pre>
      </li>
      <li class="numberedList">Copy the <code class="inlineCode">index.html</code> file into the <code class="inlineCode">Components\Pages</code> folder. (In Visual Studio or Rider, hold down <em class="keystroke">Ctrl</em> while dragging and dropping.)</li>
      <li class="numberedList">For the file in the <code class="inlineCode">Components\Pages</code> folder (not the original file), rename the file extension from <code class="inlineCode">index.html</code> to <code class="inlineCode">Index.razor</code>. Make sure the “I” is uppercase. (Blazor components must start with an uppercase letter or you will get a compiler error!)</li>
      <li class="numberedList">In the <code class="inlineCode">Components</code> folder, create a file named <code class="inlineCode">App.razor</code>.</li>
      <li class="numberedList">In <code class="inlineCode">App.razor</code>, cut and paste the root markup, including head and body elements from <code class="inlineCode">Index.razor</code>, and then add elements to insert a page title <a id="_idIndexMarker2028"/>using <code class="inlineCode">&lt;HeadOutlet /&gt;</code> and for your <code class="inlineCode">&lt;Routes&gt;</code> component, as shown in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code">&lt;!doctype html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;!-- Required meta tags --&gt;
  &lt;meta charset="utf-8" /&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" /&gt;
  &lt;!-- Bootstrap CSS --&gt;
  &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"&gt;
  <strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">HeadOutlet</strong><strong class="hljs-tag-slc"> /&gt;</strong>
&lt;/head&gt;
&lt;body&gt;
<strong class="hljs-slc">  </strong><strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">Routes</strong><strong class="hljs-tag-slc"> /&gt;</strong>
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Index.razor</code>, add the <code class="inlineCode">@page</code> directive to the top of the file and set its route to <code class="inlineCode">/</code>, add a <code class="inlineCode">&lt;PageTitle&gt;</code> component to set the web page <code class="inlineCode">&lt;title&gt;</code>, remove the <code class="inlineCode">&lt;h2&gt;</code> element that says that this is a static HTML page, and note the result, as shown in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code"><strong class="hljs-slc">@page "/"</strong>
&lt;PageTitle&gt;Welcome to Northwind B2B&lt;/PageTitle&gt;
&lt;div class="container"&gt;
  &lt;div class="jumbotron"&gt;
    &lt;h1 class="display-3"&gt;Welcome to Northwind B2B&lt;/h1&gt;
    &lt;p class="lead"&gt;We supply products to our customers.&lt;/p&gt;
    &lt;hr /&gt;
    &lt;p&gt;Our customers include restaurants, hotels, and cruise lines.&lt;/p&gt;
    &lt;p&gt;
      &lt;a class="btn btn-primary"
         href="https://www.asp.net/"&gt;Learn more&lt;/a&gt;
    &lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>
      </li>
    </ol>
    <div><p class="normal"><strong class="keyWord">Warning!</strong> If you have installed ReSharper for Visual Studio, or you use Rider, then they might give warnings like “Cannot resolve symbol” in your Razor Pages, Razor views, and Blazor components. This does not always mean there is an actual problem. If the file compiles, then you can ignore their errors. Sometimes these tools get confused and needlessly worry developers.</p>
    </div>
    <ol>
      <li class="numberedList" value="12">In <code class="inlineCode">Program.cs</code>, after the statement that creates the <code class="inlineCode">builder</code>, add a statement <a id="_idIndexMarker2029"/>to add ASP.NET Core Blazor components and their related services, and optionally define a <code class="inlineCode">#region</code>, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><strong class="hljs-meta-slc">#</strong><strong class="hljs-keyword-slc">region</strong><strong class="hljs-meta-slc"> Configure the web server host and services.</strong>
var builder = WebApplication.CreateBuilder(args);
<strong class="hljs-slc">builder.Services.AddRazorComponents();</strong>
var app = builder.Build();
<strong class="hljs-meta-slc">#</strong><strong class="hljs-keyword-slc">endregion</strong>
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, after calling the method to use HTTPS redirection, add a statement to use anti-forgery middleware, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">app.UseHttpsRedirection();
<strong class="hljs-slc">app.UseAntiforgery()</strong><strong class="hljs-comment-slc">;</strong>
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, at the top of the file, add a statement to import your project <a id="_idIndexMarker2030"/>components, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><strong class="hljs-slc">using Northwind.Web.Components; // To use App.</strong>
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, before the statement that maps an HTTP <code class="inlineCode">GET</code> request for the path <code class="inlineCode">/env</code>, add a statement to call the <code class="inlineCode">MapRazorComponents</code> method, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code"><strong class="hljs-slc">app.MapRazorComponents&lt;App&gt;();</strong>
app.MapGet("/env", () =&gt;
  $"Environment is {app.Environment.EnvironmentName}");
</code></pre>
      </li>
      <li class="numberedList">Start the website project using the <code class="inlineCode">https</code> launch profile.</li>
      <li class="numberedList">In Chrome, enter <code class="inlineCode">https://localhost:5131/</code> and note that the element that says this is a static HTML page is gone. If it is still there, then you might have to empty the browser cache. View <strong class="screenText">Developer Tools</strong>, click and hold on the <strong class="screenText">Reload this page</strong> button, and then select <strong class="screenText">Empty cache and hard reload</strong>, as shown in <em class="italic">Figure 13.4</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B22322_13_04.png" alt="" width="812" height="141"/></figure>
    <p class="packt_figref">Figure 13.4: View Developer Tools, then click and hold the Reload this page button to see more commands</p>
    <h2 id="_idParaDest-762" class="heading-2">Adding code to a Blazor static SSR page</h2>
    <p class="normal">In the <a id="_idIndexMarker2031"/>HTML markup of a web page, Razor syntax is indicated by the <code class="inlineCode">@</code> symbol. Blazor static SSR pages can be described as follows:</p>
    <ul>
      <li class="bulletList">Blazor static SSR pages require the <code class="inlineCode">@page</code> directive at the top of the file with a route specified as a string value like <code class="inlineCode">"/"</code> or <code class="inlineCode">"/customers"</code>.</li>
    </ul>
    <div><p class="normal"><strong class="keyWord">Warning!</strong> <em class="italic">Blazor static SSR pages</em> are different from <em class="italic">Razor Pages</em> and <em class="italic">Razor views</em> (used in ASP.NET Core MVC) but they share the same Razor syntax. Blazor components have the <code class="inlineCode">.razor</code> file extension. <em class="italic">Razor Pages</em> and <em class="italic">Razor views</em> have the <code class="inlineCode">.cshtml</code> file extension. <em class="italic">Razor Pages</em> must have the <code class="inlineCode">@page</code> directive. <em class="italic">Razor views</em> must <strong class="keyWord">not</strong> use the <code class="inlineCode">@page</code> directive.</p>
    </div>
    <ul>
      <li class="bulletList">Blazor static SSR pages can optionally have an <code class="inlineCode">@code</code> section that defines properties for storing data values, like in a class definition. You can then get the property values in the HTML.</li>
      <li class="bulletList">Blazor static SSR pages’ markup can have comments using <code class="inlineCode">@*</code> and <code class="inlineCode">*@</code>, as shown in the following code: <code class="inlineCode">@* This is a comment. *@</code>.</li>
    </ul>
    <p class="normal">Let’s now add some dynamic content to the Blazor static SSR page using an <code class="inlineCode">@code</code> block:</p>
    <ol>
      <li class="numberedList" value="1">In the <code class="inlineCode">Components/Pages</code> folder, in <code class="inlineCode">Index.cshtml</code>, after the <code class="inlineCode">@page</code> directive, add an <code class="inlineCode">@code</code> statement block to define a property to store the name of the current day as a <code class="inlineCode">string</code> value, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">@page "/"
@code
{
  public string? DayName { get; set; }
    = DateTime.Now.ToString("dddd");
}
</code></pre>
      </li>
      <li class="numberedList">In the second HTML paragraph, <code class="inlineCode">&lt;p&gt;</code>, render the day name, as shown highlighted in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code">&lt;p&gt;<strong class="hljs-slc">It's @DayName!</strong> Our customers include restaurants, hotels, and cruise lines.&lt;/p&gt;
</code></pre>
      </li>
      <li class="numberedList">Start the <a id="_idIndexMarker2032"/>website project using the <code class="inlineCode">https</code> profile.</li>
      <li class="numberedList">In Chrome, if necessary, enter <code class="inlineCode">https://localhost:5131/</code>, and note that the current day name is output on the page, as shown in <em class="italic">Figure 13.5</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B22322_13_05.png" alt="" width="812" height="245"/></figure>
    <p class="packt_figref">Figure 13.5: Welcome to the Northwind page showing the current day</p>
    <ol>
      <li class="numberedList" value="5">In Chrome, enter <code class="inlineCode">https://localhost:5131/index.html</code>, which exactly matches the static filename, and note that it returns the static HTML page as before.</li>
      <li class="numberedList">In Chrome, enter <code class="inlineCode">https://localhost:5131/env</code>, which exactly matches the endpoint route that returns plain text, and note that it returns the plain text<strong class="screenText"> </strong>as before.</li>
      <li class="numberedList">Close Chrome and shut down the web server.</li>
    </ol>
    <h2 id="_idParaDest-763" class="heading-2">Using shared layouts with Blazor static SSR pages</h2>
    <p class="normal">Most <a id="_idIndexMarker2033"/>websites have more than one page. The boilerplate markup for the body of the web page that is currently in <code class="inlineCode">Index.razor</code> is minimal. Usually, there will be common markup in the body that needs to be visible on every page. If each page had to duplicate that markup, then it would become a pain to manage. So, ASP.NET Core has a feature named <strong class="keyWord">layouts</strong>.</p>
    <p class="normal">To use layouts, we must create a Razor file to define the default layout for all Blazor components and specify it in the <code class="inlineCode">Routes</code> component. By convention, we store it in a <code class="inlineCode">Layout</code> folder. The name of this file can be anything, as we will specify it, but <code class="inlineCode">MainLayout.razor</code> is good practice.</p>
    <p class="normal">Typically, your main layout will include a navigation menu with links to all the other Blazor <a id="_idIndexMarker2034"/>page components. The naming convention for this file is <code class="inlineCode">NavMenu.razor</code>.</p>
    <p class="normal">Let’s see layouts in action:</p>
    <ol>
      <li class="numberedList" value="1">In the <code class="inlineCode">Components</code> folder, add a new folder named <code class="inlineCode">Layout</code>.</li>
      <li class="numberedList">In the <code class="inlineCode">Layout</code> folder, add a file named <code class="inlineCode">NavMenu.razor</code>.</li>
      <li class="numberedList">In <code class="inlineCode">NavMenu.razor</code>, modify the content, as shown in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code">&lt;nav class="navbar navbar-expand-lg bg-body-tertiary"&gt;
  &lt;div class="container-fluid"&gt;
    &lt;a class="navbar-brand" href="#"&gt;Northwind Web&lt;/a&gt;
    &lt;button class="navbar-toggler" type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNavAltMarkup"
            aria-controls="navbarNavAltMarkup"
            aria-expanded="false"
            aria-label="Toggle navigation"&gt;
      &lt;span class="navbar-toggler-icon"&gt;&lt;/span&gt;
    &lt;/button&gt;
    &lt;div class="collapse navbar-collapse"
         id="navbarNavAltMarkup"&gt;
      &lt;div class="navbar-nav"&gt;
        &lt;NavLink class="nav-link" href="/"&gt;
          Home
        &lt;/NavLink&gt;
        &lt;NavLink class="nav-link" href="suppliers"&gt;
          Suppliers
        &lt;/NavLink&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/nav&gt;
</code></pre>
      </li>
    </ol>
    <div><p class="normal"><strong class="keyWord">More Information</strong>: This markup uses a Bootstrap feature called <code class="inlineCode">navbar</code>, which you can read about at the following link: <a href="https://getbootstrap.com/docs/5.3/components/navbar/">https://getbootstrap.com/docs/5.3/components/navbar/</a>.</p>
    </div>
    <ol>
      <li class="numberedList" value="4">In the <code class="inlineCode">Layout</code> folder, add <a id="_idIndexMarker2035"/>a file named <code class="inlineCode">MainLayout.razor</code>.</li>
      <li class="numberedList">In <code class="inlineCode">MainLayout.razor</code>, modify the content, as shown in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code">@inherits LayoutComponentBase
&lt;div class="page"&gt;
  &lt;div class="sidebar"&gt;
    &lt;NavMenu /&gt;
  &lt;/div&gt;
  &lt;main&gt;
    &lt;article class="content px-4"&gt;
      @Body
    &lt;/article&gt;
  &lt;/main&gt;
  &lt;!-- JavaScript to enable features like carousel --&gt;
  &lt;script src="img/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"&gt;&lt;/script&gt;
&lt;/div&gt;
</code></pre>
      </li>
    </ol>
    <p class="normal-one">While reviewing the preceding markup, note the following:</p>
    <ul>
      <li class="bulletList level-2"><code class="inlineCode">@Body</code> marks the insertion point for the Blazor page component being requested.</li>
      <li class="bulletList level-2">At the bottom of the layout is a script to implement some cool features of Bootstrap that we can use later, such as a carousel of images.</li>
    </ul>
    <ol>
      <li class="numberedList" value="6">In <code class="inlineCode">Routes.razor</code>, add an attribute to set the class name for the default layout, as shown highlighted in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code">&lt;Router AppAssembly="typeof(Program).Assembly"&gt;
  &lt;Found Context="routeData"&gt;
    &lt;RouteView RouteData="routeData"
      <strong class="hljs-attr-slc">DefaultLayout</strong><strong class="hljs-tag-slc">=</strong><strong class="hljs-string-slc">"typeof(Layout.MainLayout)"</strong> /&gt;
  &lt;/Found&gt;
&lt;/Router&gt;
</code></pre>
      </li>
      <li class="numberedList">Start <a id="_idIndexMarker2036"/>the website using the <code class="inlineCode">https</code> launch profile.</li>
      <li class="numberedList">Visit it with Chrome and note that it now has a navigation menu at the top of every page, as shown in <em class="italic">Figure 13.6</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B22322_13_06.png" alt="" width="812" height="309"/></figure>
    <p class="packt_figref">Figure 13.6: Navigation menu in the shared layout component</p>
    <div><p class="normal"><strong class="keyWord">Warning!</strong> Clicking the navigation menu for suppliers will give a <code class="inlineCode">404 Not Found</code> error because we have not created that Blazor page component yet.</p>
    </div>
    <ol>
      <li class="numberedList" value="9">Close Chrome and shut down the web server.</li>
    </ol>
    <h2 id="_idParaDest-764" class="heading-2">Creating a suppliers page</h2>
    <p class="normal">You will <a id="_idIndexMarker2037"/>now create a Blazor static SSR page component that shows a list of suppliers. In the next topic, we will load the list of suppliers from a database, but for now, we will simulate that with a hardcoded array of <code class="inlineCode">string</code> values:</p>
    <ol>
      <li class="numberedList" value="1">In the <code class="inlineCode">Pages</code> folder, add a new Blazor page component named <code class="inlineCode">Suppliers.razor</code>. If you are using Visual Studio or Rider, then the project item template is named <strong class="screenText">Razor Component</strong>.</li>
      <li class="numberedList">In <code class="inlineCode">Suppliers.razor</code>, replace the existing contents with markup to render an HTML table containing supplier company names, as shown in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code">@page "/suppliers"
@code {
  public IEnumerable&lt;string&gt;? Companies { get; set; }
    = new[] { "Alpha Co", "Beta Limited", "Gamma Corp" };
}
&lt;div class="row"&gt;
  &lt;h1 class="display-2"&gt;Suppliers&lt;/h1&gt;
  &lt;table class="table"&gt;
    &lt;thead class="thead-inverse"&gt;
      &lt;tr&gt;
        &lt;th&gt;Company Name&lt;/th&gt;
      &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
    @if (Companies is not null)
    {
      @foreach(string name in Companies)
      {
        &lt;tr&gt;
          &lt;td&gt;@name&lt;/td&gt;
        &lt;/tr&gt;
      }
    }
    &lt;/tbody&gt;
  &lt;/table&gt;
&lt;/div&gt;
</code></pre>
      </li>
    </ol>
    <p class="normal-one">While reviewing the preceding markup, note the following:</p>
    <ul>
      <li class="bulletList level-2">The <code class="inlineCode">Suppliers</code> property is populated with some example supplier company names from an array of <code class="inlineCode">string</code> values. Later, we will populate this from the <code class="inlineCode">Northwind</code> database.</li>
      <li class="bulletList level-2">The page outputs an HTML table with Bootstrap styles.</li>
      <li class="bulletList level-2">The page uses Razor syntax <code class="inlineCode">@if</code> and <code class="inlineCode">@for</code> statements to embed C# code in HTML.</li>
      <li class="bulletList level-2">The data rows in the table are generated by looping through the <code class="inlineCode">Suppliers</code> property if it is not <code class="inlineCode">null</code>.</li>
    </ul>
    <ol>
      <li class="numberedList" value="3">Start the <a id="_idIndexMarker2038"/>website using the <code class="inlineCode">https</code> launch profile and visit it using Chrome.</li>
      <li class="numberedList">Click on the button to learn more about suppliers, and note the table of suppliers, as shown in <em class="italic">Figure 13.7</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B22322_13_07.png" alt="" width="812" height="309"/></figure>
    <p class="packt_figref">Figure 13.7: The table of suppliers loaded from an array of strings</p>
    <h2 id="_idParaDest-765" class="heading-2">Configuring files included in an ASP.NET Core project</h2>
    <p class="normal">Until <a id="_idIndexMarker2039"/>now, most of our projects have been simple console apps and class libraries with a few C# class files. By default, when we compiled those projects, all <code class="inlineCode">.cs</code> files in the project folder or subfolders were automatically included in the build at compile time.</p>
    <p class="normal">ASP.NET Core projects get more complicated. There are many more file types; some of them can be compiled at runtime instead of compile time, and some of them are just content that does not need to be compiled but does need to be deployed along with the compiled assemblies.</p>
    <p class="normal">You <a id="_idIndexMarker2040"/>can control how files are processed during a build, and which are included or excluded from a deployment, by putting elements in the project file. These are processed by <strong class="keyWord">MS Build</strong> and other tools during builds and deployments.</p>
    <p class="normal">You declare items in the project file as child elements of an <code class="inlineCode">&lt;ItemGroup&gt;</code> element. For example:</p>
    <pre class="programlisting code"><code class="hljs-code">&lt;--Include the greet.proto file in the build process.--&gt;
&lt;ItemGroup&gt;
  &lt;Protobuf Include="Protos\greet.proto" GrpcServices="Server" /&gt;
&lt;/ItemGroup&gt;
&lt;--Remove the stylecop.json file from the build process.--&gt;
&lt;ItemGroup&gt;
  &lt;None Remove="stylecop.json" /&gt;
&lt;/ItemGroup&gt;
&lt;--Include the stylecop.json file in the deployment.--&gt;
&lt;ItemGroup&gt;
  &lt;AdditionalFiles Include="stylecop.json" /&gt;
&lt;/ItemGroup&gt;
</code></pre>
    <p class="normal">You can have as many <code class="inlineCode">&lt;ItemGroup&gt;</code> elements as you want, so it is good practice to use them to logically divide elements by type. They are merged automatically by build tools.</p>
    <p class="normal">Usually, you manually add these elements when you know you need to use them, but unfortunately, Visual Studio and other code editors sometimes mess things up by trying to be helpful.</p>
    <p class="normal">In one scenario, you might have added a new Blazor component in the <code class="inlineCode">Components\Pages</code> folder named <code class="inlineCode">Customers.razor</code>. You start the web server, but the page does not appear. Or, you are working on a GraphQL service, and you add a file named <code class="inlineCode">seafoodProducts.graphql</code>, but when you run the GraphQL tool to auto-generate client-side proxies, it fails.</p>
    <p class="normal">These are both common indications that your code editor has decided that the new file should not be part of the project. It has automatically added an element to the project file to remove the file from the build process without telling you.</p>
    <p class="normal">To <a id="_idIndexMarker2041"/>solve this type of problem, review the project file for unexpected entries like the following, and delete them:</p>
    <pre class="programlisting code"><code class="hljs-code">&lt;ItemGroup&gt;
  &lt;Content Remove="Components\Pages\Customers.razor" /&gt;
&lt;/ItemGroup&gt;
&lt;ItemGroup&gt;
  &lt;GraphQL Remove="seafoodProducts.graphql" /&gt;
&lt;/ItemGroup&gt;
</code></pre>
    <div><p class="normal"><strong class="keyWord">Good Practice</strong>: When using tools that automatically “fix” problems without telling you, review your project file for unexpected elements when unexpected results happen.</p>
    </div>
    <div><p class="normal"><strong class="keyWord">More Information</strong>: You <a id="_idIndexMarker2042"/>can read more about managing MS Build items at the following link: <a href="https://learn.microsoft.com/en-us/visualstudio/msbuild/msbuild-items">https://learn.microsoft.com/en-us/visualstudio/msbuild/msbuild-items</a>.</p>
    </div>
    <h2 id="_idParaDest-766" class="heading-2">Project file build actions</h2>
    <p class="normal">As we <a id="_idIndexMarker2043"/>have just seen, it is important that ASP.NET Core developers understand how project build actions affect compilation.</p>
    <p class="normal">All files in a .NET SDK project have a build action. Most are set implicitly based on their file extension. You can override the default behavior by explicitly setting a build action. You can do this either by directly editing the <code class="inlineCode">.csproj</code> project file or by using your code editor’s <strong class="screenText">Properties</strong> window.</p>
    <p class="normal">Common build actions for ASP.NET Core project files are shown in <em class="italic">Table 13.2</em>:</p>
    <table id="table002-12" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Build action</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Description</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="screenText">Compile</strong> or <strong class="screenText">C# compiler</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal">Passed to the compiler as a source file.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="screenText">Content</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal">Included as part of the website when it’s deployed.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="screenText">Embedded Resource</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal">Passed to the compiler as a resource to be embedded in the assembly.</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="screenText">None</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal">Not part of the build. This value can be used for documentation and other files that should not be deployed with the website.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 13.2: Common build actions for ASP.NET Core project files</p>
    <div><p class="normal"><strong class="keyWord">More Information</strong>: You can learn more about <strong class="screenText">build actions</strong> and <code class="inlineCode">.csproj</code> entries at the following link: <a href="https://learn.microsoft.com/en-us/visualstudio/ide/build-actions">https://learn.microsoft.com/en-us/visualstudio/ide/build-actions</a>.</p>
    </div>
    <h1 id="_idParaDest-767" class="heading-1">Using Entity Framework Core with ASP.NET Core</h1>
    <p class="normal">Entity <a id="_idIndexMarker2044"/>Framework Core is a natural way to get real data onto a website. In <em class="chapterRef">Chapter 12</em>, <em class="italic">Introducing Modern Web Development Using .NET</em>, you created a pair of class libraries (one for the entity models and one for the <code class="inlineCode">Northwind</code> database context) using SQLite as the data provider (or SQL Server). You will now use them in your website project.</p>
    <h2 id="_idParaDest-768" class="heading-2">Configuring Entity Framework Core as a service</h2>
    <p class="normal">Functionality that is needed by an ASP.NET Core project, such as Entity Framework <a id="_idIndexMarker2045"/>Core database contexts, should be registered as a dependency service during website startup. The code in the GitHub repository solution and below uses SQLite, but you can easily use SQL Server if you prefer.</p>
    <p class="normal">Let’s see how:</p>
    <ol>
      <li class="numberedList" value="1">In the <code class="inlineCode">Northwind.Web</code> project, add a project reference to the <code class="inlineCode">Northwind.DataContext</code> project for either SQLite or SQL Server, as shown in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code">&lt;!-- Change Sqlite to SqlServer if you prefer. --&gt;
&lt;ItemGroup&gt;
  &lt;ProjectReference Include="..\Northwind.DataContext.Sqlite\
Northwind.DataContext.Sqlite.csproj" /&gt;
&lt;/ItemGroup&gt;
</code></pre>
      </li>
    </ol>
    <div><p class="normal"><strong class="keyWord">Warning!</strong> The project reference must go all on one line with no line break.</p>
    </div>
    <ol>
      <li class="numberedList" value="2">Build the <code class="inlineCode">Northwind.Web</code> project.</li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, import the namespace to work with your entity model types, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">using Northwind.EntityModels; // To use AddNorthwindContext method.
</code></pre>
      </li>
      <li class="numberedList">In <code class="inlineCode">Program.cs</code>, after the statement that adds Razor components to the registered services, add a statement to register the <code class="inlineCode">Northwind</code> database context class, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">builder.Services.AddNorthwindContext();
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">Components</code> folder, in <code class="inlineCode">_Imports.razor</code>, import the namespace for our database context, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">@using Northwind.EntityModels @* To use NorthwindContext. *@
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">Components\Pages</code> folder, in <code class="inlineCode">Suppliers.razor</code>, inject an instance of the Northwind context service, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">@inject NorthwindContext _db
</code></pre>
      </li>
      <li class="numberedList">Change <a id="_idIndexMarker2046"/>the <code class="inlineCode">Companies</code> property to be declared as a sequence of <code class="inlineCode">Supplier</code> objects instead of <code class="inlineCode">string</code> values, as shown highlighted in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">public IEnumerable&lt;<strong class="hljs-slc">Supplier</strong>&gt;? Companies { get; set; }
</code></pre>
      </li>
      <li class="numberedList">Define an <code class="inlineCode">OnInitialized</code> method to set the <code class="inlineCode">Companies</code> property using data from the Northwind <code class="inlineCode">Suppliers</code> tables, as shown in the following code:
        <pre class="programlisting code-one"><code class="hljs-code">protected override void OnInitialized()
{
  Companies = _db.Suppliers
    .OrderBy(c =&gt; c.Country)
    .ThenBy(c =&gt; c.CompanyName);
}
</code></pre>
      </li>
      <li class="numberedList">Modify the markup to render multiple columns for each supplier, as shown highlighted in the following markup:
        <pre class="programlisting code-one"><code class="hljs-code">  &lt;table class="table"&gt;
    &lt;thead class="thead-inverse"&gt;
      &lt;tr&gt;
        &lt;th&gt;Company Name&lt;/th&gt;
<strong class="hljs-slc">        &lt;th&gt;Country&lt;/th&gt;</strong>
<strong class="hljs-slc">        &lt;th&gt;Phone&lt;/th&gt;</strong>
      &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
    @if (Model.Suppliers is not null)
    {
<strong class="hljs-slc">      @foreach(Supplier s </strong><strong class="hljs-keyword-slc">in</strong><strong class="hljs-slc"> Companies)</strong>
<strong class="hljs-slc">      {</strong>
        &lt;tr&gt;
          &lt;td&gt;<strong class="hljs-slc">@s.CompanyName</strong>&lt;/td&gt;
<strong class="hljs-slc">          &lt;td&gt;@s.Country&lt;/td&gt;</strong>
<strong class="hljs-slc">          &lt;td&gt;@s.Phone&lt;/td&gt;</strong>
        &lt;/tr&gt;
<strong class="hljs-slc">      }</strong>
    }
    &lt;/tbody&gt;
  &lt;/table&gt;
&lt;/div&gt;
</code></pre>
      </li>
      <li class="numberedList">Start <a id="_idIndexMarker2047"/>the website using the <code class="inlineCode">https</code> launch profile and go to the website home page.</li>
      <li class="numberedList">Click <strong class="screenText">Learn more about our suppliers</strong> and note that the <code class="inlineCode">Suppliers</code> table now loads from the database and the data is sorted first by country and then by company name, as shown in <em class="italic">Figure 13.8</em>:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B22322_13_08.png" alt="" width="812" height="295"/></figure>
    <p class="packt_figref">Figure 13.8: The Suppliers table loaded from the Northwind database</p>
    <p class="normal">In the <a id="_idIndexMarker2048"/>next chapter, we will implement a Blazor website with interactivity so we can easily modify data as well as display it.</p>
    <h1 id="_idParaDest-769" class="heading-1">Practicing and exploring</h1>
    <p class="normal">Test your knowledge and understanding by answering some questions, getting some hands-on practice, and exploring this chapter’s topics with deeper research.</p>
    <h2 id="_idParaDest-770" class="heading-2">Exercise 13.1 – online material</h2>
    <p class="normal">Online material could be material created by Microsoft or third parties, or extra content for this book.</p>
    <h3 id="_idParaDest-771" class="heading-3">Configuring services and the HTTP request pipeline</h3>
    <p class="normal">This online section reviews how services and the HTTP request pipeline work in more detail:</p>
    <p class="normal"><a href="https://github.com/markjprice/cs13net9/blob/main/docs/ch13-http-pipeline.md">https://github.com/markjprice/cs13net9/blob/main/docs/ch13-http-pipeline.md</a></p>
    <h3 id="_idParaDest-772" class="heading-3">Enabling HTTP/3 and request decompression support</h3>
    <p class="normal">HTTP/3 brings benefits to all internet-connected apps, but especially mobile. I have written an online-only section introducing HTTP/3 and showing how to enable it in an ASP.NET Core project like <code class="inlineCode">Northwind.Web</code> when targeting .NET 7 or later.</p>
    <p class="normal">In previews of .NET 8, HTTP/3 was enabled by default, but the Microsoft team decided to revert to disabling HTTP/3 by default. They did this due to a bad experience caused by some antivirus software. Hopefully, in ASP.NET Core 9, they will resolve this issue and re-enable HTTP/3 by default. You can read more about their decision at the following link:</p>
    <p class="normal"><a href="https://devblogs.microsoft.com/dotnet/asp-net-core-updates-in-dotnet-8-rc-1/#http-3-disabled-by-default">https://devblogs.microsoft.com/dotnet/asp-net-core-updates-in-dotnet-8-rc-1/#http-3-disabled-by-default</a></p>
    <p class="normal">The page also includes a section about enabling request decompression support. You can read the page at the following link:</p>
    <p class="normal"><a href="https://github.com/markjprice/cs13net9/blob/main/docs/ch13-enabling-http3.md">https://github.com/markjprice/cs13net9/blob/main/docs/ch13-enabling-http3.md</a></p>
    <h2 id="_idParaDest-773" class="heading-2">Introducing Bootstrap</h2>
    <p class="normal">Bootstrap is the world’s most popular framework for building responsive, mobile-first websites. You can read an online-only section introducing some of Bootstrap’s most important features at the following link:</p>
    <p class="normal"><a href="https://github.com/markjprice/cs13net9/blob/main/docs/ch13-bootstrap.md">https://github.com/markjprice/cs13net9/blob/main/docs/ch13-bootstrap.md</a></p>
    <h2 id="_idParaDest-774" class="heading-2">Exercise 13.2 – practice exercises</h2>
    <p class="normal">Practice exercises go deeper into the topics for this chapter.</p>
    <h3 id="_idParaDest-775" class="heading-3">Build a data-driven web page</h3>
    <p class="normal">Add a Razor Page to the <code class="inlineCode">Northwind.Web</code> website that enables the user to see a list of customers grouped by country. When the user clicks on a customer record, they should then see a page showing the full contact details of that customer and a list of their orders.</p>
    <p class="normal">My suggested solution can be found at the following links:</p>
    <ul>
      <li class="bulletList"><a href="https://github.com/markjprice/cs13net9/blob/main/code/ModernWeb/Northwind.Web/Components/Pages/Customers.razor">https://github.com/markjprice/cs13net9/blob/main/code/ModernWeb/Northwind.Web/Components/Pages/Customers.razor</a></li>
      <li class="bulletList"><a href="https://github.com/markjprice/cs13net9/blob/main/code/ModernWeb/Northwind.Web/Components/Pages/CustomerOrders.razor">https://github.com/markjprice/cs13net9/blob/main/code/ModernWeb/Northwind.Web/Components/Pages/CustomerOrders.razor</a></li>
    </ul>
    <h3 id="_idParaDest-776" class="heading-3">Build web pages for functions</h3>
    <p class="normal">Reimplement some of the console apps from earlier chapters as Razor Pages; for example, from <em class="chapterRef">Chapter 4</em><em class="italic">, Writing, Debugging, and Testing Functions</em>, provide a web UI to output times tables, calculate tax, and generate factorials and the Fibonacci sequence.</p>
    <p class="normal">My suggested solution can be found at the following links:</p>
    <ul>
      <li class="bulletList"><a href="https://github.com/markjprice/cs13net9/blob/main/code/ModernWeb/Northwind.Web/Components/Pages/Functions.razor">https://github.com/markjprice/cs13net9/blob/main/code/ModernWeb/Northwind.Web/Components/Pages/Functions.razor</a></li>
    </ul>
    <h2 id="_idParaDest-777" class="heading-2">Exercise 13.3 – test your knowledge</h2>
    <p class="normal">Answer the following questions:</p>
    <ol>
      <li class="numberedList" value="1">List six method names that can be specified in an HTTP request.</li>
      <li class="numberedList">List six status codes and their descriptions that can be returned in an HTTP response.</li>
      <li class="numberedList">In ASP.NET Core, what is the <code class="inlineCode">Program</code> class used for?</li>
      <li class="numberedList">What does the acronym HSTS stand for and what does it do?</li>
      <li class="numberedList">How do you enable static HTML pages for a website?</li>
      <li class="numberedList">How do you mix C# code into the middle of HTML to create a dynamic page?</li>
      <li class="numberedList">How can you define shared layouts for Blazor components?</li>
      <li class="numberedList">In a Blazor project, what three files do you typically create in a <code class="inlineCode">Components</code> folder and what do they do?</li>
      <li class="numberedList">How do you configure an Entity Framework Core data context for use with an ASP.NET Core website?</li>
      <li class="numberedList">What are the tasks that you must complete to enable Blazor and its static SSR capability in an existing ASP.NET Core Empty project?</li>
    </ol>
    <h2 id="_idParaDest-778" class="heading-2">Exercise 13.4 – explore topics</h2>
    <p class="normal">Use the links on the following page to learn more about the topics covered in this chapter:</p>
    <p class="normal"><a href="https://github.com/markjprice/cs13net9/blob/main/docs/book-links.md#chapter-13---building-websites-using-aspnet-core">https://github.com/markjprice/cs13net9/blob/main/docs/book-links.md#chapter-13---building-websites-using-aspnet-core</a></p>
    <h1 id="_idParaDest-779" class="heading-1">Summary</h1>
    <p class="normal">In this chapter, you learned:</p>
    <ul>
      <li class="bulletList">About the foundations of web development using HTTP</li>
      <li class="bulletList">How to build a simple website that returns static files</li>
      <li class="bulletList">How to use ASP.NET Core with Entity Framework Core to create web pages that are dynamically generated from information in a database</li>
    </ul>
    <p class="normal">In the next chapter, you will learn how to build interactive UI using Blazor.</p>
  </div>
</div></div></body></html>