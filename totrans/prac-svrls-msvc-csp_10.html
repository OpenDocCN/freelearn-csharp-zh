<html><head></head><body>
<div id="_idContainer222">
<h1 class="chapterNumber"><a id="_idTextAnchor297"/><span class="koboSpan" id="kobo.1.1">10</span></h1>
<h1 class="chapterTitle" id="_idParaDest-202"><a id="_idTextAnchor298"/><span class="koboSpan" id="kobo.2.1">Security and Observability for Serverless and Microservices Applications</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">There are studies that indicate that cybercrime can be considered the third economy in the world. </span><span class="koboSpan" id="kobo.3.2">Besides that, the investment made in many companies in cyber security has increased a lot in the last few years. </span><span class="koboSpan" id="kobo.3.3">When we talk about serverless and microservices, we cannot ignore this topic. </span><span class="koboSpan" id="kobo.3.4">In fact, the area of attack of a distributed system is bigger than a simple monolith application.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.4.1">Considering this challenging scenario, security and observability cannot be discussed in a single moment of the development process. </span><span class="koboSpan" id="kobo.4.2">The approach of security and privacy by design indicates that you will only achieve success and reduce risk in cyber security if you start thinking about it just after you start thinking about your solution. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.5.1">The goal of this chapter is to discuss how to secure applications, enable monitoring for both performance and security, and improve incident response, considering the tools and techniques we currently have.</span></p>
<h1 class="heading-1" id="_idParaDest-203"><a id="_idTextAnchor299"/><span class="koboSpan" id="kobo.6.1">Application Security Best Practices</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.7.1">A good approach to </span><a id="_idIndexMarker822"/><span class="koboSpan" id="kobo.8.1">thinking about security in an application is to define it as an onion – with different layers of protection. </span><span class="koboSpan" id="kobo.8.2">The most important thing about any application is the data that is stored and processed by it. </span><span class="koboSpan" id="kobo.8.3">Considering this, the databases of an application must be designed to have the correct access and protection. </span><span class="koboSpan" id="kobo.8.4">However, securing the database is not enough to deliver a good solution, so you must also think about the security of the application itself, defining authentication and authorization for any user who will access it. </span><span class="koboSpan" id="kobo.8.5">Besides that, you need to understand that your application will probably use third-party components that must also be protected. </span><span class="koboSpan" id="kobo.8.6">Infrastructure also needs to be monitored and secure, and there are sophisticated ways to do so nowadays. </span><span class="koboSpan" id="kobo.8.7">Last, but not least, there are alternative solutions that can monitor our applications by intercepting the traffic that arrives at it, guaranteeing</span><a id="_idIndexMarker823"/><span class="koboSpan" id="kobo.9.1"> another layer of security. </span><span class="koboSpan" id="kobo.9.2">Let’s check each layers of security in detail.</span></p>
<h2 class="heading-2" id="_idParaDest-204"><a id="_idTextAnchor300"/><span class="koboSpan" id="kobo.10.1">Network Security</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.11.1">It can be a little</span><a id="_idIndexMarker824"/><span class="koboSpan" id="kobo.12.1"> confusing for developers to think about managing a</span><a id="_idIndexMarker825"/><span class="koboSpan" id="kobo.13.1"> network in the cloud, since you might imagine that any resource provided must be public. </span><span class="koboSpan" id="kobo.13.2">The point is exactly this – we cannot consider any component as public when we are using public cloud providers. </span><span class="koboSpan" id="kobo.13.3">To do so, you must design a proper network that will safeguard applications. </span><span class="koboSpan" id="kobo.13.4">For this, a </span><strong class="keyWord"><span class="koboSpan" id="kobo.14.1">Virtual Private Cloud (VPC)</span></strong><span class="koboSpan" id="kobo.15.1"> must be provided.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.16.1">A VPC provides a </span><a id="_idIndexMarker826"/><span class="koboSpan" id="kobo.17.1">logically isolated section within a public cloud, where you can launch resources in a virtual network that you define. </span><span class="koboSpan" id="kobo.17.2">This isolation ensures that your resources are protected from external threats and unauthorized access. </span><span class="koboSpan" id="kobo.17.3">The focus of this is to reduce the attack surface.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.18.1">With VPC configurations, you will have fine-grained network control. </span><span class="koboSpan" id="kobo.18.2">By defining subnets, route tables, and network gateways, you can control the flow of traffic to and from your serverless functions and microservices. </span><span class="koboSpan" id="kobo.18.3">With this, only trusted sources can access your resources, and only exactly what you want will be exposed to the public internet.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.19.1">When you think about microservices, there is no direct need to have them exposed to the internet. </span><span class="koboSpan" id="kobo.19.2">So, this protection is crucial for sensitive data and critical applications, minimizing the risk of external attacks.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.20.1">In Azure, there are two great services that can help you set the private architecture of your subsystems, guaranteeing that only the surfaces that really need to be exposed. </span><span class="koboSpan" id="kobo.20.2">The first one is Azure Virtual Network, which is the component that will enable you to design a VPC according to the configuration you decide. </span><span class="koboSpan" id="kobo.20.3">The second one is Azure Private Link, which will enable your services to connect over a private endpoint in a virtual network. </span><span class="koboSpan" id="kobo.20.4">This will give you the opportunity to reduce the need to expose a service to the public internet, using the Microsoft backbone network to do so.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.21.1">Obviously, if you have a better network design, you will be able to monitor and protect your solution with more efficiency. </span><span class="koboSpan" id="kobo.21.2">For instance, you can define Azure network security groups to define specific rules according to a group. </span><span class="koboSpan" id="kobo.21.3">You have the option of monitoring the traffic of the network by enabling Virtual Network flow logs. </span><span class="koboSpan" id="kobo.21.4">You can also define inbound and outbound traffic and prohibitions using Azure Firewall. </span><span class="koboSpan" id="kobo.21.5">In summary, Azure Virtual Network and its components are a powerful tool for securing communication between services in the cloud, ensuring </span><a id="_idIndexMarker827"/><span class="koboSpan" id="kobo.22.1">data </span><a id="_idIndexMarker828"/><span class="koboSpan" id="kobo.23.1">confidentiality, integrity, and availability. </span></p>
<h2 class="heading-2" id="_idParaDest-205"><a id="_idTextAnchor301"/><span class="koboSpan" id="kobo.24.1">Data Security</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.25.1">The data that </span><a id="_idIndexMarker829"/><span class="koboSpan" id="kobo.26.1">arrives at a database generally comes from a user or a</span><a id="_idIndexMarker830"/><span class="koboSpan" id="kobo.27.1"> system. </span><span class="koboSpan" id="kobo.27.2">This means that the transmission of this data needs to be guaranteed, and we must consider ways to protect the interception and eventual changing of this data. </span><span class="koboSpan" id="kobo.27.3">The best way to do so is to encrypt data from the client to the server. </span><strong class="keyWord"><span class="koboSpan" id="kobo.28.1">Hyper Text Transfer Protocol Secure (HTTPS) </span></strong><span class="koboSpan" id="kobo.29.1">is the</span><a id="_idIndexMarker831"/><span class="koboSpan" id="kobo.30.1"> alternative that, generally, all web servers use to do so. </span><span class="koboSpan" id="kobo.30.2">Together with</span><a id="_idIndexMarker832"/><span class="koboSpan" id="kobo.31.1"> the </span><strong class="keyWord"><span class="koboSpan" id="kobo.32.1">Transport Layer Security (TLS)</span></strong><span class="koboSpan" id="kobo.33.1"> protocol, we enable a secure channel to transfer data.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.34.1">In a function app, for instance, HTTPS is the only protocol accepted by default. </span><span class="koboSpan" id="kobo.34.2">This means that any HTTP (which is not secure) request will be redirected to HTTPS, providing better security for the transfer of data. </span><span class="koboSpan" id="kobo.34.3">You can check it in the configuration of App Service.</span></p>
<p class="packt_figref"><span class="koboSpan" id="kobo.35.1"><img alt="" role="presentation" src="../Images/B31916_10_01.png"/></span><span class="koboSpan" id="kobo.36.1"> Figure 10.1: HTTPS Only in App Service</span></p>
<p class="normal"><span class="koboSpan" id="kobo.37.1">Besides that, you may also want to increase the security of this transfer layer by defining a specific certificate for your service. </span><span class="koboSpan" id="kobo.37.2">In Azure, you can do this by defining a domain for your app.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.38.1">By default, Azure delivers to you a certificate created by Microsoft, where the domain used is azurewebsites.net. </span><span class="koboSpan" id="kobo.38.2">However, you can buy a custom domain outside Azure, or even inside it, which is much easier to manage.</span></p>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.39.1"> Custom domains will represent a cost to your Azure account. </span><span class="koboSpan" id="kobo.39.2">You can get more details about custom domains at </span><a href="https://learn.microsoft.com/en-us/azure/app-service/tutorial-secure-domain-certificate"><span class="url"><span class="koboSpan" id="kobo.40.1">https://learn.microsoft.com/en-us/azure/app-service/tutorial-secure-domain-certificate</span></span></a></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.41.1">In the same way as you need to secure the transfer layer, you must secure your environment variables and secrets. </span><span class="koboSpan" id="kobo.41.2">Azure provides three services to do so. </span><span class="koboSpan" id="kobo.41.3">The first one is called </span><strong class="keyWord"><span class="koboSpan" id="kobo.42.1">Azure Managed Identities</span></strong><span class="koboSpan" id="kobo.43.1"> and it</span><a id="_idIndexMarker833"/><span class="koboSpan" id="kobo.44.1"> will let you access data in Azure SQL, Cosmos DB, Azure Storage, and so on without the need for a credential. </span><span class="koboSpan" id="kobo.44.2">On the other hand, if you do need to manage variables and secrets, </span><strong class="keyWord"><span class="koboSpan" id="kobo.45.1">Azure Key Vault</span></strong><span class="koboSpan" id="kobo.46.1"> is the </span><a id="_idIndexMarker834"/><span class="koboSpan" id="kobo.47.1">correct service to store client application secrets, connection strings, passwords, shared access keys, and SSH keys. </span><span class="koboSpan" id="kobo.47.2">However, access to Azure Key Vault may cause performance issues for the application’s startup. </span><span class="koboSpan" id="kobo.47.3">That is why you should</span><a id="_idIndexMarker835"/><span class="koboSpan" id="kobo.48.1"> use </span><strong class="keyWord"><span class="koboSpan" id="kobo.49.1">Azure App Configuration</span></strong><span class="koboSpan" id="kobo.50.1"> to store non-secrets, such as client IDs, endpoints, and application parameters.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.51.1">Another important resource that you must consider while protecting data is the options you have for data encryption in the database service. </span><span class="koboSpan" id="kobo.51.2">For instance, in SQL databases, there is the possibility </span><a id="_idIndexMarker836"/><span class="koboSpan" id="kobo.52.1">to </span><a id="_idIndexMarker837"/><span class="koboSpan" id="kobo.53.1">use</span><a id="_idIndexMarker838"/><span class="koboSpan" id="kobo.54.1"> the </span><strong class="keyWord"><span class="koboSpan" id="kobo.55.1">Transparent data encryption</span></strong><span class="koboSpan" id="kobo.56.1"> setting.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.57.1"><img alt="Figure 10.2: Transparent data encryption setting" src="../Images/B31916_10_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.58.1">Figure 10.2: Transparent data encryption setting</span></p>
<p class="normal"><span class="koboSpan" id="kobo.59.1">With this setting, you will prevent situations where a stolen database file can be restored on a different server from yours. </span><span class="koboSpan" id="kobo.59.2">Besides that, in general, database servers also</span><a id="_idIndexMarker839"/><span class="koboSpan" id="kobo.60.1"> have </span><strong class="keyWord"><span class="koboSpan" id="kobo.61.1">firewall rules</span></strong><span class="koboSpan" id="kobo.62.1"> that will restrict direct </span><a id="_idIndexMarker840"/><span class="koboSpan" id="kobo.63.1">access to them, which is a very important approach to not expose the database server to the public cloud.</span></p>
<h2 class="heading-2" id="_idParaDest-206"><a id="_idTextAnchor302"/><span class="koboSpan" id="kobo.64.1">Authentication and Authorization</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.65.1">When you are creating an </span><a id="_idIndexMarker841"/><span class="koboSpan" id="kobo.66.1">application, it is essential that you know the actor that will access it. </span><span class="koboSpan" id="kobo.66.2">To do so, you must provide an </span><strong class="keyWord"><span class="koboSpan" id="kobo.67.1">authentication</span></strong><span class="koboSpan" id="kobo.68.1"> method, that</span><a id="_idIndexMarker842"/><span class="koboSpan" id="kobo.69.1"> is, the process of verifying the identity of a user or system, ensuring that the entity requesting access is indeed who or what it claims to be. </span><span class="koboSpan" id="kobo.69.2">To do so, you must use credentials such as passwords, tokens, or biometric data. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.70.1">Once you have the user or system identified, there is another process that will let this actor access resources or execute activities in the system you are designing. </span><span class="koboSpan" id="kobo.70.2">The process that enables it is</span><a id="_idIndexMarker843"/><span class="koboSpan" id="kobo.71.1"> called </span><strong class="keyWord"><span class="koboSpan" id="kobo.72.1">authorization</span></strong><span class="koboSpan" id="kobo.73.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.74.1">There are some alternatives to deliver authentication and authorization. </span><span class="koboSpan" id="kobo.74.2">We will discuss three of them in this topic: </span><strong class="keyWord"><span class="koboSpan" id="kobo.75.1">JSON Web Tokens (JWTs)</span></strong><span class="koboSpan" id="kobo.76.1">, OAuth 2.0, and OpenID Connect. </span><span class="koboSpan" id="kobo.76.2">They are useful techniques to </span><a id="_idIndexMarker844"/><span class="koboSpan" id="kobo.77.1">provide access to websites and APIs, guaranteeing security for the system you are designing.</span></p>
<h3 class="heading-3" id="_idParaDest-207"><a id="_idTextAnchor303"/><span class="koboSpan" id="kobo.78.1">JSON Web Tokens</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.79.1">JSON Web Token (JWT) enables security </span><a id="_idIndexMarker845"/><span class="koboSpan" id="kobo.80.1">between the client and the server using </span><a id="_idIndexMarker846"/><span class="koboSpan" id="kobo.81.1">an encoded JSON object, called a token, that is transferred in the HTTP header in a compact and stateless format. </span><span class="koboSpan" id="kobo.81.2">The token is created by the server as it verifies the authentication of the requestor. </span><span class="koboSpan" id="kobo.81.3">The authorization is given to ensure that the requestor can access the resources. </span><span class="koboSpan" id="kobo.81.4">JWTs pertain to industry standard RFC 7519.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.82.1">The code provided in the chapter will give you an idea about how to implement JWTs using .NET. </span><span class="koboSpan" id="kobo.82.2">It is worth noting that this code is not ready for use, since the authentication method is not resolved. </span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.83.1">public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.84.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.85.1">JWT</span></span><span class="koboSpan" id="kobo.86.1">
{
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.87.1">// Private field to store the JWT token</span></span><span class="koboSpan" id="kobo.88.1">
  private </span><span class="hljs-title"><span class="koboSpan" id="kobo.89.1">JwtSecurityToken</span></span><span class="koboSpan" id="kobo.90.1"> token;
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.91.1">// Internal constructor to initialize the JWT with a given token</span></span><span class="koboSpan" id="kobo.92.1">
  internal </span><span class="hljs-title"><span class="koboSpan" id="kobo.93.1">JWT</span></span><span class="koboSpan" id="kobo.94.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.95.1">JwtSecurityToken token</span></span><span class="koboSpan" id="kobo.96.1">)
  {
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.97.1">this</span></span><span class="koboSpan" id="kobo.98.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.99.1">token</span></span><span class="koboSpan" id="kobo.100.1"> = token;
  }
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.101.1">// Property to get the expiration date and time of the token</span></span><span class="koboSpan" id="kobo.102.1">
  public </span><span class="hljs-title"><span class="koboSpan" id="kobo.103.1">DateTime</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.104.1">ValidTo</span></span><span class="koboSpan" id="kobo.105.1"> =&gt; token.</span><span class="hljs-property"><span class="koboSpan" id="kobo.106.1">ValidTo</span></span><span class="koboSpan" id="kobo.107.1">;
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.108.1">// Property to get the string representation of the token</span></span><span class="koboSpan" id="kobo.109.1">
  public string </span><span class="hljs-title"><span class="koboSpan" id="kobo.110.1">Value</span></span><span class="koboSpan" id="kobo.111.1"> =&gt; 
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.112.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.113.1">JwtSecurityTokenHandler</span></span><span class="koboSpan" id="kobo.114.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.115.1">WriteToken</span></span><span class="koboSpan" id="kobo.116.1">(</span><span class="hljs-variable"><span class="koboSpan" id="kobo.117.1">this</span></span><span class="koboSpan" id="kobo.118.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.119.1">token</span></span><span class="koboSpan" id="kobo.120.1">);
}
internal </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.121.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.122.1">JWTBuilder</span></span><span class="koboSpan" id="kobo.123.1"> 
{
  public </span><span class="hljs-variable"><span class="koboSpan" id="kobo.124.1">JWT</span></span><span class="koboSpan" id="kobo.125.1">  </span><span class="hljs-title"><span class="koboSpan" id="kobo.126.1">Build</span></span><span class="koboSpan" id="kobo.127.1">() </span><span class="hljs-comment"><span class="koboSpan" id="kobo.128.1">// Method to build the JWT. </span><span class="koboSpan" id="kobo.128.2">JWT is an object </span></span><span class="koboSpan" id="kobo.129.1">
{
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.130.1">var</span></span><span class="koboSpan" id="kobo.131.1"> claims = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.132.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.133.1">List</span></span><span class="koboSpan" id="kobo.134.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.135.1">Claim</span></span><span class="koboSpan" id="kobo.136.1">&gt; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.137.1">// Creating a list of claims</span></span><span class="koboSpan" id="kobo.138.1">
    {
       </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.139.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.140.1">Claim</span></span><span class="koboSpan" id="kobo.141.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.142.1">JwtRegisteredClaimNames</span></span><span class="koboSpan" id="kobo.143.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.144.1">Sub</span></span><span class="koboSpan" id="kobo.145.1">,</span><span class="hljs-variable"><span class="koboSpan" id="kobo.146.1">this</span></span><span class="koboSpan" id="kobo.147.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.148.1">subject</span></span><span class="koboSpan" id="kobo.149.1">), 
       </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.150.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.151.1">Claim</span></span><span class="koboSpan" id="kobo.152.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.153.1">JwtRegisteredClaimNames</span></span><span class="koboSpan" id="kobo.154.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.155.1">Jti</span></span><span class="koboSpan" id="kobo.156.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.157.1">Guid</span></span><span class="koboSpan" id="kobo.158.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.159.1">NewGuid</span></span><span class="koboSpan" id="kobo.160.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.161.1">ToString</span></span><span class="koboSpan" id="kobo.162.1">()) 
    }.</span><span class="hljs-title"><span class="koboSpan" id="kobo.163.1">Union</span></span><span class="koboSpan" id="kobo.164.1">(</span><span class="hljs-variable"><span class="koboSpan" id="kobo.165.1">this</span></span><span class="koboSpan" id="kobo.166.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.167.1">claims</span></span><span class="koboSpan" id="kobo.168.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.169.1">Select</span></span><span class="koboSpan" id="kobo.170.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.171.1">item</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.172.1"> =&gt;</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.173.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.174.1">Claim</span></span><span class="koboSpan" id="kobo.175.1">(item.</span><span class="hljs-property"><span class="koboSpan" id="kobo.176.1">Key</span></span><span class="koboSpan" id="kobo.177.1">, item.</span><span class="hljs-property"><span class="koboSpan" id="kobo.178.1">Value</span></span><span class="koboSpan" id="kobo.179.1">))); 
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.180.1">var</span></span><span class="koboSpan" id="kobo.181.1"> token = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.182.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.183.1">JwtSecurityToken</span></span><span class="koboSpan" id="kobo.184.1">( 
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.185.1">issuer</span></span><span class="koboSpan" id="kobo.186.1">: </span><span class="hljs-variable"><span class="koboSpan" id="kobo.187.1">this</span></span><span class="koboSpan" id="kobo.188.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.189.1">issuer</span></span><span class="koboSpan" id="kobo.190.1">, 
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.191.1">audience</span></span><span class="koboSpan" id="kobo.192.1">: </span><span class="hljs-variable"><span class="koboSpan" id="kobo.193.1">this</span></span><span class="koboSpan" id="kobo.194.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.195.1">audience</span></span><span class="koboSpan" id="kobo.196.1">, 
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.197.1">claims</span></span><span class="koboSpan" id="kobo.198.1">: claims, 
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.199.1">expires</span></span><span class="koboSpan" id="kobo.200.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.201.1">DateTime</span></span><span class="koboSpan" id="kobo.202.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.203.1">UtcNow</span></span><span class="koboSpan" id="kobo.204.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.205.1">AddMinutes</span></span><span class="koboSpan" id="kobo.206.1">(expiryInMinutes), 
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.207.1">signingCredentials</span></span><span class="koboSpan" id="kobo.208.1">: </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.209.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.210.1">SigningCredentials</span></span><span class="koboSpan" id="kobo.211.1">( 
        </span><span class="hljs-variable"><span class="koboSpan" id="kobo.212.1">this</span></span><span class="koboSpan" id="kobo.213.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.214.1">securityKey</span></span><span class="koboSpan" id="kobo.215.1">, 
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.216.1">SecurityAlgorithms</span></span><span class="koboSpan" id="kobo.217.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.218.1">HmacSha256</span></span><span class="koboSpan" id="kobo.219.1">) 
    );
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.220.1">return</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.221.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.222.1">JWT</span></span><span class="koboSpan" id="kobo.223.1">(token);
  }
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.224.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.225.1">Build</span></code><span class="koboSpan" id="kobo.226.1"> method in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.227.1">JWTBuilder</span></code><span class="koboSpan" id="kobo.228.1"> class is responsible for constructing a JWT based on the properties and claims that have been configured in the builder. </span><span class="koboSpan" id="kobo.228.2">A </span><code class="inlineCode"><span class="koboSpan" id="kobo.229.1">List&lt;Claim&gt;</span></code><span class="koboSpan" id="kobo.230.1"> is initialized with two default claims: (1) </span><code class="inlineCode"><span class="koboSpan" id="kobo.231.1">sub</span></code><span class="koboSpan" id="kobo.232.1"> (subject), which represents the subject of the token; (2) </span><code class="inlineCode"><span class="koboSpan" id="kobo.233.1">jti</span></code><span class="koboSpan" id="kobo.234.1"> (JWT ID), a unique identifier for the token, generated using </span><code class="inlineCode"><span class="koboSpan" id="kobo.235.1">Guid.NewGuid()</span></code><span class="koboSpan" id="kobo.236.1">. </span><span class="koboSpan" id="kobo.236.2">Additional claims from the claims dictionary </span><a id="_idIndexMarker847"/><span class="koboSpan" id="kobo.237.1">are appended</span><a id="_idIndexMarker848"/><span class="koboSpan" id="kobo.238.1"> using </span><strong class="keyWord"><span class="koboSpan" id="kobo.239.1">Union</span></strong><span class="koboSpan" id="kobo.240.1">. </span><span class="koboSpan" id="kobo.240.2">Each key-value pair in the dictionary is converted into a Claim </span><a id="_idIndexMarker849"/><span class="koboSpan" id="kobo.241.1">object. </span><span class="koboSpan" id="kobo.241.2">A </span><code class="inlineCode"><span class="koboSpan" id="kobo.242.1">JwtSecurityToken</span></code><span class="koboSpan" id="kobo.243.1"> object is created with the following parameters:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.244.1">issuer</span></strong><span class="koboSpan" id="kobo.245.1">: The entity that issued the token.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.246.1">audience</span></strong><span class="koboSpan" id="kobo.247.1">: The intended recipient of the token.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.248.1">claims</span></strong><span class="koboSpan" id="kobo.249.1">: The list of claims created earlier.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.250.1">expires</span></strong><span class="koboSpan" id="kobo.251.1">: The expiration time, calculated as the current UTC time plus the configured </span><code class="inlineCode"><span class="koboSpan" id="kobo.252.1">expiryInMinutes</span></code><span class="koboSpan" id="kobo.253.1">.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.254.1">signingCredentials</span></strong><span class="koboSpan" id="kobo.255.1">: Specifies how the token is signed. </span><span class="koboSpan" id="kobo.255.2">It uses the provided </span><code class="inlineCode"><span class="koboSpan" id="kobo.256.1">securityKey</span></code><span class="koboSpan" id="kobo.257.1"> and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.258.1">HmacSha256</span></code><span class="koboSpan" id="kobo.259.1"> algorithm.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.260.1">The method wraps the </span><code class="inlineCode"><span class="koboSpan" id="kobo.261.1">JwtSecurityToken</span></code><span class="koboSpan" id="kobo.262.1"> in a custom </span><code class="inlineCode"><span class="koboSpan" id="kobo.263.1">JWT</span></code><span class="koboSpan" id="kobo.264.1"> object and returns it. </span><span class="koboSpan" id="kobo.264.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.265.1">JWT</span></code><span class="koboSpan" id="kobo.266.1"> class provides additional properties like </span><code class="inlineCode"><span class="koboSpan" id="kobo.267.1">ValidTo</span></code><span class="koboSpan" id="kobo.268.1"> (expiration time) and </span><code class="inlineCode"><span class="koboSpan" id="kobo.269.1">Value</span></code><span class="koboSpan" id="kobo.270.1"> (string representation of the token).</span></p>
<p class="normal"><span class="koboSpan" id="kobo.271.1">As soon as the client requestor receives the token, it can be encapsulated in the following requests to the server as authorization header information using the </span><a id="_idIndexMarker850"/><span class="koboSpan" id="kobo.272.1">prefix </span><strong class="keyWord"><span class="koboSpan" id="kobo.273.1">Bearer</span></strong><span class="koboSpan" id="kobo.274.1">. </span><span class="koboSpan" id="kobo.274.2">The server, when it receives this header information, implements middleware software that analyzes whether the request is appropriate for the requester. </span><span class="koboSpan" id="kobo.274.3">The great thing about it is that if the request path is protected by the JWT process, and the request sent does not have the proper token, the request does not arrive at the server for processing, only being processed by the middleware.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.275.1">In the example presented in the chapter, you will find two APIs. </span><span class="koboSpan" id="kobo.275.2">The first one gives you a token for usage. </span><span class="koboSpan" id="kobo.275.3">The second one is the WeatherForecast API generally available when you create an API app using .NET. </span><span class="koboSpan" id="kobo.275.4">To</span><a id="_idIndexMarker851"/><span class="koboSpan" id="kobo.276.1"> make better use of the example, the Swagger documentation was implemented.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.277.1"><img alt="Figure 10.3: JWT Swagger implementation " src="../Images/B31916_10_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.278.1">Figure 10.3: JWT Swagger implementation </span></p>
<p class="normal"><span class="koboSpan" id="kobo.279.1">If you try to run the WeatherForecast API </span><a id="_idIndexMarker852"/><span class="koboSpan" id="kobo.280.1">without delivering a Bearer token, the response will be refused with a 401 error code, which means unauthorized. </span><span class="koboSpan" id="kobo.280.2">On the other hand, if you use the Token API to generate the token needed and use this token for authorization with the padlock icon available in the Swagger interface, the result of the API will be properly delivered.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.281.1"><img alt="Figure 10.4: Defining the Bearer token" src="../Images/B31916_10_04.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.282.1">Figure 10.4: Defining the Bearer token</span></p>
<p class="normal"><span class="koboSpan" id="kobo.283.1">Notice that the token provided respects the JWT standard and can be checked on the jwt.io web page, confirming what you defined in your solution.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.284.1"><img alt="Figure 10.5: Decoding JWT on the jwt.io web page" src="../Images/B31916_10_05.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.285.1">Figure 10.5: Decoding JWT on the jwt.io web page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.286.1">Based on the </span><a id="_idIndexMarker853"/><span class="koboSpan" id="kobo.287.1">sample provided, you may consider JWT as a good way to</span><a id="_idIndexMarker854"/><span class="koboSpan" id="kobo.288.1"> implement a standard method for </span><strong class="keyWord"><span class="koboSpan" id="kobo.289.1">Authorization</span></strong><span class="koboSpan" id="kobo.290.1">.</span></p>
<h3 class="heading-3" id="_idParaDest-208"><a id="_idTextAnchor304"/><span class="koboSpan" id="kobo.291.1">OAuth 2.0 and OpenID Connect (OIDC)</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.292.1">OAuth 2.0 is an</span><a id="_idIndexMarker855"/><span class="koboSpan" id="kobo.293.1"> open standard that </span><a id="_idIndexMarker856"/><span class="koboSpan" id="kobo.294.1">enables third-party</span><a id="_idIndexMarker857"/><span class="koboSpan" id="kobo.295.1"> providers </span><a id="_idIndexMarker858"/><span class="koboSpan" id="kobo.296.1">to give applications </span><strong class="keyWord"><span class="koboSpan" id="kobo.297.1">Authorization</span></strong><span class="koboSpan" id="kobo.298.1"> to access user resources without exposing their credentials. </span><span class="koboSpan" id="kobo.298.2">There are many great providers that enable you to use this technique, such as Google, Microsoft, Facebook, and GitHub.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.299.1">The simple use of logins with passwords for authorization is considered too risky for enterprises nowadays. </span><span class="koboSpan" id="kobo.299.2">Besides that, transferring this kind of data via APIs is also very dangerous, considering the potential cyberattacks that we need to deal with currently. </span><span class="koboSpan" id="kobo.299.3">For this reason, </span><strong class="keyWord"><span class="koboSpan" id="kobo.300.1">OpenID Connect (OIDC)</span></strong><span class="koboSpan" id="kobo.301.1"> is a good option for </span><strong class="keyWord"><span class="koboSpan" id="kobo.302.1">Authentication</span></strong><span class="koboSpan" id="kobo.303.1">, since it enables the confirmation of a user’s existence without exposing passwords.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.304.1">To do so, there are three important things to consider. </span><span class="koboSpan" id="kobo.304.2">The first one is that this is also an open standard, which means that we have many servers offering this service. </span><span class="koboSpan" id="kobo.304.3">The second one is that you will need to consider the usage of a third-party service, so the definition of a good provider must be considered. </span><span class="koboSpan" id="kobo.304.4">The third, but not less important, is that OIDC is implemented above OAuth 2.0, which means that, with it, you will have an entire solution for authentication and authorizing your users. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.305.1">In .NET, we have the possibility to use OAuth 2.0 and OIDC based on the </span><strong class="keyWord"><span class="koboSpan" id="kobo.306.1">Microsoft Authentication Library (MSAL)</span></strong><span class="koboSpan" id="kobo.307.1">. </span><span class="koboSpan" id="kobo.307.2">To</span><a id="_idIndexMarker859"/><span class="koboSpan" id="kobo.308.1"> do so using Azure, you first need to register an app in Microsoft Entra ID.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.309.1"><img alt="Figure 10.6: Registering an App in Microsoft Entra ID" src="../Images/B31916_10_06.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.310.1">Figure 10.6: Registering an App in Microsoft Entra ID</span></p>
<p class="normal"><span class="koboSpan" id="kobo.311.1">Depending on the type of project you are developing, you will have different ways to get the authentication</span><a id="_idIndexMarker860"/><span class="koboSpan" id="kobo.312.1"> of the</span><a id="_idIndexMarker861"/><span class="koboSpan" id="kobo.313.1"> users you want. </span><span class="koboSpan" id="kobo.313.2">The following code </span><a id="_idIndexMarker862"/><span class="koboSpan" id="kobo.314.1">gets </span><a id="_idIndexMarker863"/><span class="koboSpan" id="kobo.315.1">the user profile in a console app, based on a prompt that will redirect the user to the browser.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.316.1">private </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.317.1">static</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.318.1">async</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.319.1">Task</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.320.1">GetUserProfile</span></span><span class="koboSpan" id="kobo.321.1">()
{
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.322.1">IPublicClientApplication</span></span><span class="koboSpan" id="kobo.323.1"> clientApp = </span><span class="hljs-title"><span class="koboSpan" id="kobo.324.1">PublicClientApplicationBuilder</span></span><span class="koboSpan" id="kobo.325.1">
    .</span><span class="hljs-title"><span class="koboSpan" id="kobo.326.1">Create</span></span><span class="koboSpan" id="kobo.327.1">(clientId)
    .</span><span class="hljs-title"><span class="koboSpan" id="kobo.328.1">WithRedirectUri</span></span><span class="koboSpan" id="kobo.329.1">(redirectUri)
    .</span><span class="hljs-title"><span class="koboSpan" id="kobo.330.1">WithAuthority</span></span><span class="koboSpan" id="kobo.331.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.332.1">AzureCloudInstance</span></span><span class="koboSpan" id="kobo.333.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.334.1">AzurePublic</span></span><span class="koboSpan" id="kobo.335.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.336.1">"common"</span></span><span class="koboSpan" id="kobo.337.1">)
    .</span><span class="hljs-title"><span class="koboSpan" id="kobo.338.1">Build</span></span><span class="koboSpan" id="kobo.339.1">();
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.340.1">var</span></span><span class="koboSpan" id="kobo.341.1"> resultadoAzureAd = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.342.1">await</span></span><span class="koboSpan" id="kobo.343.1"> clientApp.</span><span class="hljs-title"><span class="koboSpan" id="kobo.344.1">AcquireTokenInteractive</span></span><span class="koboSpan" id="kobo.345.1">(scopes)
    .</span><span class="hljs-title"><span class="koboSpan" id="kobo.346.1">WithPrompt</span></span><span class="koboSpan" id="kobo.347.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.348.1">Prompt</span></span><span class="koboSpan" id="kobo.349.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.350.1">SelectAccount</span></span><span class="koboSpan" id="kobo.351.1">)
    .</span><span class="hljs-title"><span class="koboSpan" id="kobo.352.1">ExecuteAsync</span></span><span class="koboSpan" id="kobo.353.1">();
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.354.1">if</span></span><span class="koboSpan" id="kobo.355.1"> (resultadoAzureAd != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.356.1">null</span></span><span class="koboSpan" id="kobo.357.1">)
  {
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.358.1">// Print the username of the authenticated user</span></span><span class="koboSpan" id="kobo.359.1">
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.360.1">Console</span></span><span class="koboSpan" id="kobo.361.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.362.1">WriteLine</span></span><span class="koboSpan" id="kobo.363.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.364.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.365.1">User: "</span></span><span class="koboSpan" id="kobo.366.1"> + resultadoAzureAd.</span><span class="hljs-property"><span class="koboSpan" id="kobo.367.1">Account</span></span><span class="koboSpan" id="kobo.368.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.369.1">Username</span></span><span class="koboSpan" id="kobo.370.1">);
  }
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.371.1">The result will be the need to log in using Microsoft. </span><span class="koboSpan" id="kobo.371.2">In this case, OIDC is using Microsoft Entra ID as the provider to identify the user.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.372.1"><img alt="Interface gráfica do usuário, Aplicativo  O conteúdo gerado por IA pode estar incorreto." src="../Images/B31916_10_07.png"/></span> </figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.373.1">Figure 10.7: Log in using Microsoft Entra ID</span></p>
<p class="normal"><span class="koboSpan" id="kobo.374.1">Once you are</span><a id="_idIndexMarker864"/><span class="koboSpan" id="kobo.375.1"> logged</span><a id="_idIndexMarker865"/><span class="koboSpan" id="kobo.376.1"> in, Microsoft will ask if you allow </span><a id="_idIndexMarker866"/><span class="koboSpan" id="kobo.377.1">it </span><a id="_idIndexMarker867"/><span class="koboSpan" id="kobo.378.1">to share information about your account with the desired application.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.379.1"><img alt="Figure 10.8: Authorizing app to read your data" src="../Images/B31916_10_08.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.380.1">Figure 10.8: Authorizing app to read your data</span></p>
<p class="normal"><span class="koboSpan" id="kobo.381.1">There are two great things when you use this approach. </span><span class="koboSpan" id="kobo.381.2">The first one is that you don’t need to worry about user management. </span><span class="koboSpan" id="kobo.381.3">This management will be held by Microsoft Entra ID, which means that it will be centralized and customized using the expertise and experience of the provider, even in aspects of different ways of authenticating, such as Multiple Factors for Authentication. </span><span class="koboSpan" id="kobo.381.4">The</span><a id="_idIndexMarker868"/><span class="koboSpan" id="kobo.382.1"> second</span><a id="_idIndexMarker869"/><span class="koboSpan" id="kobo.383.1"> one, and more important, is the</span><a id="_idIndexMarker870"/><span class="koboSpan" id="kobo.384.1"> user </span><a id="_idIndexMarker871"/><span class="koboSpan" id="kobo.385.1">will not need to remember another account, since they will use the one that they already use in their common work, which makes OIDC a popular choice for creating secure and user-friendly authentication mechanisms. </span></p>
<h2 class="heading-2" id="_idParaDest-209"><a id="_idTextAnchor305"/><span class="koboSpan" id="kobo.386.1">Securing Dependencies</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.387.1">The </span><strong class="keyWord"><span class="koboSpan" id="kobo.388.1">Open Worldwide Application Security Project (OWASP)</span></strong><span class="koboSpan" id="kobo.389.1"> is a foundation</span><a id="_idIndexMarker872"/><span class="koboSpan" id="kobo.390.1"> that works to improve the </span><a id="_idIndexMarker873"/><span class="koboSpan" id="kobo.391.1">security of software in a nonprofit approach. </span><span class="koboSpan" id="kobo.391.2">One of their most well-known initiatives is the Top 10 list, which presents the riskiest situations in relation to your software. </span><span class="koboSpan" id="kobo.391.3">This list indicates situations such as injection attacks, broken authentication, sensitive data exposure, and security misconfigurations.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.392.1">When developing solutions, the usage of vulnerable and outdated components is considered one of the Top 10 risks. </span><span class="koboSpan" id="kobo.392.2">Libraries, frameworks, and APIs play a significant role in modern web application development, but these components can also introduce vulnerabilities into the application if not carefully managed. </span><span class="koboSpan" id="kobo.392.3">The decision to use third-party components can provide attackers with a vector to exploit the application, potentially leading to data breaches, unauthorized access, and other security incidents.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.393.1">Considering the .NET environment, the usage of components is always connected to NuGet. </span><span class="koboSpan" id="kobo.393.2">Since NuGet is the package provider, in Visual Studio, it is quite simple to check if you are using a library that is outdated. </span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.394.1"><img alt="Figure 10.9: Using NuGet to check outdated libraries" src="../Images/B31916_10_09.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.395.1">Figure 10.9: Using NuGet to check outdated libraries</span></p>
<p class="normal"><span class="koboSpan" id="kobo.396.1">On the other hand, you must be aware that not only .NET packages need to be updated in a solution. </span><span class="koboSpan" id="kobo.396.2">When it comes to microservices, depending on the approach decided on to implement them, you will need to handle components that could be in the container or even in the infrastructure that manages the containers of the solution, and these parts of the application must also be continuously checked, evaluating whether there are any vulnerabilities that could cause damage to your solution.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.397.1">If you are using GitHub as a repository, you may consider </span><a id="_idIndexMarker874"/><span class="koboSpan" id="kobo.398.1">using </span><strong class="keyWord"><span class="koboSpan" id="kobo.399.1">GitHub Dependabot</span></strong><span class="koboSpan" id="kobo.400.1"> as a tool for automatically scanning </span><a id="_idIndexMarker875"/><span class="koboSpan" id="kobo.401.1">your GitHub projects for outdated dependencies and known vulnerabilities, and then opening PRs to update</span><a id="_idIndexMarker876"/><span class="koboSpan" id="kobo.402.1"> them. </span><strong class="keyWord"><span class="koboSpan" id="kobo.403.1">Sonar</span></strong><span class="koboSpan" id="kobo.404.1"> and </span><strong class="keyWord"><span class="koboSpan" id="kobo.405.1">Sync</span></strong><span class="koboSpan" id="kobo.406.1"> are </span><a id="_idIndexMarker877"/><span class="koboSpan" id="kobo.407.1">other tools that you may consider in your pipeline to prevent third-party security issues.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.408.1">The purpose of the CVE program (</span><a href="https://www.cve.org/"><span class="url"><span class="koboSpan" id="kobo.409.1">https://www.cve.org/</span></span></a><span class="koboSpan" id="kobo.410.1">) is to help us with that. </span><span class="koboSpan" id="kobo.410.2">CVE means Common Vulnerabilities </span><a id="_idIndexMarker878"/><span class="koboSpan" id="kobo.411.1">and Exposures, and it is a list of publicly disclosed computer security issues.</span></p>
<h1 class="heading-1" id="_idParaDest-210"><a id="_idTextAnchor306"/><span class="koboSpan" id="kobo.412.1">Kubernetes and Azure Container Apps Security</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.413.1">Orchestrators’ security is twofold: on one side, we have user access security, and on the other side, we have network security. </span><span class="koboSpan" id="kobo.413.2">Here, we refer to the users of the orchestrator, not the users of the application hosted by the orchestrator, that is developers, administrators, and other operators that maintain both the orchestrator installation and its applications.  </span></p>
<p class="normal"><span class="koboSpan" id="kobo.414.1">The security of application users is taken care of by the application itself with the usual web application tools that are not specific for microservices, that is security tokens such as authentication cookies and bearer tokens, user claims, roles, and authorization policies. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.415.1">Orchestrator network security refers to orchestrator tools for isolating both different applications running in the same cluster and different parts of the same application.  </span></p>
<p class="normal"><span class="koboSpan" id="kobo.416.1">This section discusses both the orchestrator user’s access security and network security for Kubernetes and Azure Container Apps, each in a dedicated subsection. </span><span class="koboSpan" id="kobo.416.2">Let’s start with Kubernetes network security.</span></p>
<h2 class="heading-2" id="_idParaDest-211"><a id="_idTextAnchor307"/><span class="koboSpan" id="kobo.417.1">Kubernetes network security</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.418.1">Kubernetes network </span><a id="_idIndexMarker879"/><span class="koboSpan" id="kobo.419.1">security enriches the usual IP-based firewall rules with constraints on higher-level software entities like Kubernetes Pods and namespaces. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.420.1">Thus, for instance, we may isolate two applications running in the same Kubernetes cluster by placing them into two different namespaces and then forbidding any communication between those two namespaces.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.421.1">We may also run sensitive Microservices in a “militarized zone” implemented as a namespace that exposes just a few </span><strong class="keyWord"><span class="koboSpan" id="kobo.422.1">filtering Pods</span></strong><span class="koboSpan" id="kobo.423.1"> to external communications. </span><span class="koboSpan" id="kobo.423.2">This </span><a id="_idIndexMarker880"/><span class="koboSpan" id="kobo.424.1">way, the </span><strong class="keyWord"><span class="koboSpan" id="kobo.425.1">filtering Pods </span></strong><span class="koboSpan" id="kobo.426.1">can look for adequate credentials and potential threats before routing the incoming communication to the microservices that must process them.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.427.1">Pod- and namespace-based network rules are more modular and flexible than IP-address-based rules since they directly constrain application-level entities instead of hardware-related entities.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.428.1">Network security rules are defined</span><a id="_idIndexMarker881"/><span class="koboSpan" id="kobo.429.1"> through </span><strong class="keyWord"><span class="koboSpan" id="kobo.430.1">NetworkPolicy</span></strong><span class="koboSpan" id="kobo.431.1"> resources defined with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.432.1">.yaml</span></code><span class="koboSpan" id="kobo.433.1"> below:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.434.1">apiVersion:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.435.1">networking.k8s.io/v1</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.436.1">kind:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.437.1">NetworkPolicy</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.438.1">metadata:</span></span><span class="koboSpan" id="kobo.439.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.440.1">name:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.441.1">example-network-policy</span></span><span class="koboSpan" id="kobo.442.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.443.1">namespace:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.444.1">example-namespace</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.445.1">spec:</span></span><span class="koboSpan" id="kobo.446.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.447.1">podSelector:</span></span><span class="koboSpan" id="kobo.448.1">
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.449.1">matchLabels:</span></span><span class="koboSpan" id="kobo.450.1">
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.451.1">myLabel:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.452.1">matValue</span></span><span class="koboSpan" id="kobo.453.1">
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.454.1">myLabel1:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.455.1">matValue1</span></span><span class="koboSpan" id="kobo.456.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.457.1">policyTypes:</span></span> <span class="hljs-comment"><span class="koboSpan" id="kobo.458.1"># may be either Ingress, or Egress or both</span></span><span class="koboSpan" id="kobo.459.1">
  </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.460.1">-</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.461.1">Ingress</span></span><span class="koboSpan" id="kobo.462.1"> 
  </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.463.1">-</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.464.1">Egress</span></span><span class="koboSpan" id="kobo.465.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.466.1">ingress:</span></span><span class="koboSpan" id="kobo.467.1">
  </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.468.1">-</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.469.1">from:</span></span><span class="koboSpan" id="kobo.470.1">
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.471.1">….</span></span><span class="koboSpan" id="kobo.472.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.473.1">egress:</span></span><span class="koboSpan" id="kobo.474.1">
  </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.475.1">-</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.476.1">to:</span></span><span class="koboSpan" id="kobo.477.1">
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.478.1">----</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.479.1">The policy applies to all Pods selected by </span><code class="inlineCode"><span class="koboSpan" id="kobo.480.1">podSelector</span></code><span class="koboSpan" id="kobo.481.1"> that are in the same namespace of the </span><strong class="keyWord"><span class="koboSpan" id="kobo.482.1">NetworkPolicy</span></strong><span class="koboSpan" id="kobo.483.1"> resource. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.484.1">If </span><code class="inlineCode"><span class="koboSpan" id="kobo.485.1">policyType</span></code><span class="koboSpan" id="kobo.486.1"> contains the </span><code class="inlineCode"><span class="koboSpan" id="kobo.487.1">Ingress</span></code><span class="koboSpan" id="kobo.488.1"> item, then the policy constrains input communications through rules that must be listed in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.489.1">ingress</span></code><span class="koboSpan" id="kobo.490.1"> section. </span><span class="koboSpan" id="kobo.490.2">If </span><code class="inlineCode"><span class="koboSpan" id="kobo.491.1">Ingress</span></code><span class="koboSpan" id="kobo.492.1"> is not listed in </span><code class="inlineCode"><span class="koboSpan" id="kobo.493.1">policyType</span></code><span class="koboSpan" id="kobo.494.1">, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.495.1">ingress</span></code><span class="koboSpan" id="kobo.496.1"> section must be omitted.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.497.1">If </span><code class="inlineCode"><span class="koboSpan" id="kobo.498.1">policyType</span></code><span class="koboSpan" id="kobo.499.1"> contains the </span><code class="inlineCode"><span class="koboSpan" id="kobo.500.1">Egress</span></code><span class="koboSpan" id="kobo.501.1"> item, then the policy constrains output communications through rules that must</span><a id="_idIndexMarker882"/><span class="koboSpan" id="kobo.502.1"> be listed in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.503.1">egress</span></code><span class="koboSpan" id="kobo.504.1"> section. </span><span class="koboSpan" id="kobo.504.2">If </span><code class="inlineCode"><span class="koboSpan" id="kobo.505.1">Egress</span></code><span class="koboSpan" id="kobo.506.1"> is not listed in </span><code class="inlineCode"><span class="koboSpan" id="kobo.507.1">policyType</span></code><span class="koboSpan" id="kobo.508.1">, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.509.1">egress</span></code><span class="koboSpan" id="kobo.510.1"> section must be omitted.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.511.1">Communication from/to each Pod must satisfy the constraints</span><a id="_idIndexMarker883"/><span class="koboSpan" id="kobo.512.1"> of all </span><strong class="keyWord"><span class="koboSpan" id="kobo.513.1">NetworkPolicy</span></strong><span class="koboSpan" id="kobo.514.1"> resources that select it with their </span><code class="inlineCode"><span class="koboSpan" id="kobo.515.1">podSelector</span></code><span class="koboSpan" id="kobo.516.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.517.1">Each </span><code class="inlineCode"><span class="koboSpan" id="kobo.518.1">from</span></code><span class="koboSpan" id="kobo.519.1"> section selects possible sources of communication that sum up to the sources of communication selected by all other </span><code class="inlineCode"><span class="koboSpan" id="kobo.520.1">from</span></code><span class="koboSpan" id="kobo.521.1"> sections. </span><span class="koboSpan" id="kobo.521.2">Analogously, each </span><code class="inlineCode"><span class="koboSpan" id="kobo.522.1">to</span></code><span class="koboSpan" id="kobo.523.1"> section selects possible destinations of communication that sum up to the destinations of communication selected by all other </span><code class="inlineCode"><span class="koboSpan" id="kobo.524.1">to</span></code><span class="koboSpan" id="kobo.525.1"> sections.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.526.1">Each </span><code class="inlineCode"><span class="koboSpan" id="kobo.527.1">from</span></code><span class="koboSpan" id="kobo.528.1"> and each </span><code class="inlineCode"><span class="koboSpan" id="kobo.529.1">to</span></code><span class="koboSpan" id="kobo.530.1"> contains a list of constraints that must be </span><em class="italic"><span class="koboSpan" id="kobo.531.1">all</span></em><span class="koboSpan" id="kobo.532.1"> satisfied by the allowed sources or destinations. </span><span class="koboSpan" id="kobo.532.2">There are three kinds of constraints that can be added:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.533.1">Constraints on IP addresses:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.534.1">    </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.535.1">-</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.536.1">ipBlock:</span></span><span class="koboSpan" id="kobo.537.1">
        </span><span class="hljs-attr"><span class="koboSpan" id="kobo.538.1">cidr:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.539.1">172.17.0.0</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.540.1">/16</span></span><span class="koboSpan" id="kobo.541.1">
        </span><span class="hljs-attr"><span class="koboSpan" id="kobo.542.1">except:</span></span><span class="koboSpan" id="kobo.543.1">
        </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.544.1">-</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.545.1">172.17.1.0</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.546.1">/24</span></span>
</code></pre>
</li>
<li class="bulletList"><span class="koboSpan" id="kobo.547.1">A selector expression that selects Pods of the same namespace of the </span><strong class="keyWord"><span class="koboSpan" id="kobo.548.1">NetworkPolicy</span></strong><span class="koboSpan" id="kobo.549.1"> resource:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.550.1">  </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.551.1">-</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.552.1">podSelector:</span></span><span class="koboSpan" id="kobo.553.1">
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.554.1">matchLabels:</span></span><span class="koboSpan" id="kobo.555.1">
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.556.1">podlabel1:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.557.1">podvalue1</span></span><span class="koboSpan" id="kobo.558.1"> 
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.559.1">…</span></span>
</code></pre>
</li>
<li class="bulletList"><span class="koboSpan" id="kobo.560.1">A selector expression that selects other allowed namespaces:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.561.1">  </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.562.1">-</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.563.1">namespaceSelector:</span></span><span class="koboSpan" id="kobo.564.1">
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.565.1">matchLabels:</span></span><span class="koboSpan" id="kobo.566.1">
        </span><span class="hljs-attr"><span class="koboSpan" id="kobo.567.1">namespacelabel1:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.568.1">namespacevalue1</span></span><span class="koboSpan" id="kobo.569.1">
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.570.1">…</span></span>
</code></pre>
</li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.571.1">If you would like to receive or send communications just to some Pods of the selected namespaces, you</span><a id="_idIndexMarker884"/><span class="koboSpan" id="kobo.572.1"> can also nest a </span><code class="inlineCode"><span class="koboSpan" id="kobo.573.1">podSelector</span></code><span class="koboSpan" id="kobo.574.1"> inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.575.1">namespaceSelector</span></code><span class="koboSpan" id="kobo.576.1"> based item as shown here:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-bullet"><span class="koboSpan" id="kobo.577.1">-</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.578.1">namespaceSelector:</span></span><span class="koboSpan" id="kobo.579.1">
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.580.1">matchLabels:</span></span><span class="koboSpan" id="kobo.581.1">
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.582.1">namespacelabel1:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.583.1">namespacevalue1</span></span><span class="koboSpan" id="kobo.584.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.585.1">podSelector:</span></span><span class="koboSpan" id="kobo.586.1">
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.587.1">matchLabels:</span></span><span class="koboSpan" id="kobo.588.1">
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.589.1">podlabel1:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.590.1">podvalue1</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.591.1">Each </span><code class="inlineCode"><span class="koboSpan" id="kobo.592.1">from</span></code><span class="koboSpan" id="kobo.593.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.594.1">to</span></code><span class="koboSpan" id="kobo.595.1"> can also limit the allowed communication to a list of ports and port intervals as shown here:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.596.1">  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.597.1">ports:</span></span><span class="koboSpan" id="kobo.598.1">
  </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.599.1">-</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.600.1">protocol:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.601.1">TCP</span></span><span class="koboSpan" id="kobo.602.1">
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.603.1">port:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.604.1">6379</span></span><span class="koboSpan" id="kobo.605.1">
   </span><span class="hljs-string"><span class="koboSpan" id="kobo.606.1">…</span></span><span class="koboSpan" id="kobo.607.1">
  </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.608.1">-</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.609.1">protocol:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.610.1">TCP</span></span><span class="koboSpan" id="kobo.611.1">
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.612.1">port:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.613.1">8000</span></span><span class="koboSpan" id="kobo.614.1">
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.615.1">endPort:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.616.1">9000</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.617.1">If the item contains both </span><code class="inlineCode"><span class="koboSpan" id="kobo.618.1">port</span></code><span class="koboSpan" id="kobo.619.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.620.1">endPort</span></code><span class="koboSpan" id="kobo.621.1">, it specifies a port interval. </span><span class="koboSpan" id="kobo.621.2">Otherwise, if it contains just </span><code class="inlineCode"><span class="koboSpan" id="kobo.622.1">port</span></code><span class="koboSpan" id="kobo.623.1">, it specifies a singl</span><a id="_idTextAnchor308"/><span class="koboSpan" id="kobo.624.1">e port.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.625.1">Here is a policy that selects all Pods of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.626.1">mysample</span></code><span class="koboSpan" id="kobo.627.1"> namespace and accepts traffic from all Pods of the same namespace and from all Pods of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.628.1">mysafe</span></code><span class="koboSpan" id="kobo.629.1"> namespace:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.630.1">apiVersion:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.631.1">networking.k8s.io/v1</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.632.1">kind:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.633.1">NetworkPolicy</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.634.1">metadata:</span></span><span class="koboSpan" id="kobo.635.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.636.1">name:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.637.1">example-network-policy</span></span><span class="koboSpan" id="kobo.638.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.639.1">namespace:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.640.1">mysample</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.641.1">spec:</span></span><span class="koboSpan" id="kobo.642.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.643.1">podSelector:</span></span><span class="koboSpan" id="kobo.644.1"> {}
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.645.1">policyTypes:</span></span><span class="koboSpan" id="kobo.646.1"> 
  </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.647.1">-</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.648.1">Ingress</span></span><span class="koboSpan" id="kobo.649.1"> 
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.650.1">ingress:</span></span><span class="koboSpan" id="kobo.651.1">
  </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.652.1">-</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.653.1">from:</span></span><span class="koboSpan" id="kobo.654.1">
    </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.655.1">-</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.656.1">podSelector:{}</span></span><span class="koboSpan" id="kobo.657.1">
    </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.658.1">-</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.659.1">namespaceSelector:</span></span><span class="koboSpan" id="kobo.660.1">
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.661.1">matchExpressions:</span></span><span class="koboSpan" id="kobo.662.1">
      </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.663.1">-</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.664.1">key:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.665.1">namespace</span></span><span class="koboSpan" id="kobo.666.1">
        </span><span class="hljs-attr"><span class="koboSpan" id="kobo.667.1">operator:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.668.1">In</span></span><span class="koboSpan" id="kobo.669.1">
        </span><span class="hljs-attr"><span class="koboSpan" id="kobo.670.1">values:</span></span><span class="koboSpan" id="kobo.671.1"> [</span><span class="hljs-string"><span class="koboSpan" id="kobo.672.1">"mysafe"]</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.673.1">Here is a policy </span><a id="_idIndexMarker885"/><span class="koboSpan" id="kobo.674.1">that selects all Pods of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.675.1">mysample</span></code><span class="koboSpan" id="kobo.676.1"> namespace, and accepts traffic from all Pods of the same namespace and from all Pods of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.677.1">mysafe</span></code><span class="koboSpan" id="kobo.678.1"> namespace, but only on port 80:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.679.1">apiVersion:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.680.1">networking.k8s.io/v1</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.681.1">kind:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.682.1">NetworkPolicy</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.683.1">metadata:</span></span><span class="koboSpan" id="kobo.684.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.685.1">name:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.686.1">example-network-policy</span></span><span class="koboSpan" id="kobo.687.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.688.1">namespace:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.689.1">mysample</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.690.1">spec:</span></span><span class="koboSpan" id="kobo.691.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.692.1">podSelector:</span></span><span class="koboSpan" id="kobo.693.1"> {}
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.694.1">policyTypes:</span></span><span class="koboSpan" id="kobo.695.1"> 
  </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.696.1">-</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.697.1">Ingress</span></span><span class="koboSpan" id="kobo.698.1"> 
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.699.1">ingress:</span></span><span class="koboSpan" id="kobo.700.1">
  </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.701.1">-</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.702.1">from:</span></span><span class="koboSpan" id="kobo.703.1">
    </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.704.1">-</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.705.1">podSelector:{}</span></span><span class="koboSpan" id="kobo.706.1">
    </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.707.1">-</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.708.1">namespaceSelector:</span></span><span class="koboSpan" id="kobo.709.1">
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.710.1">matchExpressions:</span></span><span class="koboSpan" id="kobo.711.1">
      </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.712.1">-</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.713.1">key:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.714.1">namespace</span></span><span class="koboSpan" id="kobo.715.1">
        </span><span class="hljs-attr"><span class="koboSpan" id="kobo.716.1">operator:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.717.1">In</span></span><span class="koboSpan" id="kobo.718.1">
        </span><span class="hljs-attr"><span class="koboSpan" id="kobo.719.1">values:</span></span><span class="koboSpan" id="kobo.720.1"> [</span><span class="hljs-string"><span class="koboSpan" id="kobo.721.1">"mysafe"]</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.722.1">    ports:</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.723.1">    - protocol: TCP</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.724.1">      port: 80</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.725.1">Here is a policy that enables all input traffic of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.726.1">militarized-zone</span></code><span class="koboSpan" id="kobo.727.1"> namespace to pass through the Pods labeled with </span><code class="inlineCode"><span class="koboSpan" id="kobo.728.1">role: access-control</span></code><span class="koboSpan" id="kobo.729.1">:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.730.1">apiVersion:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.731.1">networking.k8s.io/v1</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.732.1">kind:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.733.1">NetworkPolicy</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.734.1">metadata:</span></span><span class="koboSpan" id="kobo.735.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.736.1">name:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.737.1">access-control</span></span><span class="koboSpan" id="kobo.738.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.739.1">namespace:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.740.1">militarized-zone</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.741.1">spec:</span></span><span class="koboSpan" id="kobo.742.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.743.1">podSelector:</span></span><span class="koboSpan" id="kobo.744.1"> 
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.745.1">matchLabels:</span></span><span class="koboSpan" id="kobo.746.1">
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.747.1">role:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.748.1">access-control</span></span><span class="koboSpan" id="kobo.749.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.750.1">policyTypes:</span></span><span class="koboSpan" id="kobo.751.1"> 
  </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.752.1">-</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.753.1">Ingress</span></span><span class="koboSpan" id="kobo.754.1"> 
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.755.1">ingress:</span></span><span class="koboSpan" id="kobo.756.1">
  </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.757.1">-</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.758.1">from:</span></span><span class="koboSpan" id="kobo.759.1">
    </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.760.1">-</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.761.1">podSelector:{}</span></span><span class="koboSpan" id="kobo.762.1">
    </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.763.1">-</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.764.1">namespaceSelector:{}</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.765.1">We ca</span><a id="_idTextAnchor309"/><span class="koboSpan" id="kobo.766.1">n force all </span><a id="_idIndexMarker886"/><span class="koboSpan" id="kobo.767.1">traffic to pass just through the Pods with </span><code class="inlineCode"><span class="koboSpan" id="kobo.768.1">role: access-control</span></code><span class="koboSpan" id="kobo.769.1"> by adding another rule that prevents traffic from external namespaces to all other Pods:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.770.1">apiVersion:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.771.1">networking.k8s.io/v1</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.772.1">kind:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.773.1">NetworkPolicy</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.774.1">metadata:</span></span><span class="koboSpan" id="kobo.775.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.776.1">name:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.777.1">access-control</span></span><span class="koboSpan" id="kobo.778.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.779.1">namespace:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.780.1">militarized-zone</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.781.1">spec:</span></span><span class="koboSpan" id="kobo.782.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.783.1">podSelector:</span></span><span class="koboSpan" id="kobo.784.1"> 
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.785.1">matchExpression:</span></span><span class="koboSpan" id="kobo.786.1">
    </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.787.1">-</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.788.1">key:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.789.1">role</span></span><span class="koboSpan" id="kobo.790.1">
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.791.1">operator:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.792.1">NotIn</span></span><span class="koboSpan" id="kobo.793.1">
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.794.1">values:</span></span><span class="koboSpan" id="kobo.795.1"> [</span><span class="hljs-string"><span class="koboSpan" id="kobo.796.1">"access-control"]</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.797.1">  policyTypes: </span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.798.1">  - Ingress </span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.799.1">  ingress:</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.800.1">  - from:</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.801.1">    - podSelector:{}</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.802.1">    </span></span>
</code></pre>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.803.1">NetworkPolicy</span></code><span class="koboSpan" id="kobo.804.1"> entities constrain direct communication between Pods, that is communication based on Kubernetes services. </span><span class="koboSpan" id="kobo.804.2">However, what happens to communication mediated by message brokers? </span></p>
<p class="normal"><span class="koboSpan" id="kobo.805.1">We may use a different broker for each</span><a id="_idTextAnchor310"/><span class="koboSpan" id="kobo.806.1"> namespace we would like to isolate, so that we can use </span><code class="inlineCode"><span class="koboSpan" id="kobo.807.1">NetworkPolicy</span></code><span class="koboSpan" id="kobo.808.1"> entities to constrain access to the various message brokers, too. </span><span class="koboSpan" id="kobo.808.2">If the message broker servers run outside of the Kubernetes cluster, we may use </span><code class="inlineCode"><span class="koboSpan" id="kobo.809.1">NetworkPolicy</span></code><span class="koboSpan" id="kobo.810.1"> rules that filter the message broker IP addresses. </span><span class="koboSpan" id="kobo.810.2">Otherwise, we can deploy each message broker in the same namespace it serves, so that its Pods are also constrained by the same </span><code class="inlineCode"><span class="koboSpan" id="kobo.811.1">NetworkPolicy</span></code><span class="koboSpan" id="kobo.812.1"> entities that constrain direct communication between microservices. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.813.1">If instead, we use a single message broker cluster, we are forced to use the message broker’s internal </span><a id="_idIndexMarker887"/><span class="koboSpan" id="kobo.814.1">authorization policies to filter the access to the various message queues. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.815.1">Azure Container Apps has simpler but less powerful network security.</span></p>
<h2 class="heading-2" id="_idParaDest-212"><a id="_idTextAnchor311"/><span class="koboSpan" id="kobo.816.1">Azure Container Apps Network Security</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.817.1">To configure network </span><a id="_idIndexMarker888"/><span class="koboSpan" id="kobo.818.1">security in Azure Container Apps, you must use a custom Azure </span><strong class="keyWord"><span class="koboSpan" id="kobo.819.1">Virtual Network (VNET)</span></strong><span class="koboSpan" id="kobo.820.1">. </span><span class="koboSpan" id="kobo.820.2">This requirement introduces the need for specific configurations and profiles. </span><span class="koboSpan" id="kobo.820.3">The setup typically follows these steps:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.821.1">Define a custom Azure </span><strong class="keyWord"><span class="koboSpan" id="kobo.822.1">VNet</span></strong><span class="koboSpan" id="kobo.823.1">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.824.1">Associate a </span><strong class="keyWord"><span class="koboSpan" id="kobo.825.1">dedicated subnet</span></strong><span class="koboSpan" id="kobo.826.1"> from the VNet to each </span><strong class="keyWord"><span class="koboSpan" id="kobo.827.1">Container Apps environment</span></strong><span class="koboSpan" id="kobo.828.1">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.829.1">Assign a </span><strong class="keyWord"><span class="koboSpan" id="kobo.830.1">subnet from each environment</span></strong><span class="koboSpan" id="kobo.831.1"> to its respective </span><strong class="keyWord"><span class="koboSpan" id="kobo.832.1">application</span></strong><span class="koboSpan" id="kobo.833.1">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.834.1">Express communication constraints between environments and applications as </span><strong class="keyWord"><span class="koboSpan" id="kobo.835.1">firewall rules</span></strong><span class="koboSpan" id="kobo.836.1"> on the VNet subnets.</span></li>
</ol>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.837.1">For detailed guidance on associating custom subnets with environments and applications, refer to the official documentation: </span><a href="https://learn.microsoft.com/en-us/azure/container-apps/networking?tabs=workload-profiles-env%2Cazure-cli"><span class="url"><span class="koboSpan" id="kobo.838.1">https://learn.microsoft.com/en-us/azure/container-apps/networking?tabs=workload-profiles-env%2Cazure-cli</span></span></a><span class="koboSpan" id="kobo.839.1">.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.840.1">However, this approach has some limitations. </span><span class="koboSpan" id="kobo.840.2">Because network rules are defined using </span><strong class="keyWord"><span class="koboSpan" id="kobo.841.1">IP-address-based constraints</span></strong><span class="koboSpan" id="kobo.842.1">, rather than explicit software-level policies, the result is </span><strong class="keyWord"><span class="koboSpan" id="kobo.843.1">reduced modularity</span></strong><span class="koboSpan" id="kobo.844.1"> and </span><strong class="keyWord"><span class="koboSpan" id="kobo.845.1">limited scalability</span></strong><span class="koboSpan" id="kobo.846.1">. </span><span class="koboSpan" id="kobo.846.2">This model may be sufficient for small-scale applications with a few communication restrictions, but as your microservices ecosystem grows, the approach can become too complicated.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.847.1">If your system’s communication is handled through </span><strong class="keyWord"><span class="koboSpan" id="kobo.848.1">external message brokers</span></strong><span class="koboSpan" id="kobo.849.1">, a simpler and more scalable solution is to manage access via the </span><strong class="keyWord"><span class="koboSpan" id="kobo.850.1">broker’s authorization policies</span></strong><span class="koboSpan" id="kobo.851.1">, controlling which services can access specific message queues.</span></p>
<h2 class="heading-2" id="_idParaDest-213"><a id="_idTextAnchor312"/><span class="koboSpan" id="kobo.852.1">Kubernetes User Security </span></h2>
<p class="normal"><span class="koboSpan" id="kobo.853.1">Kubernetes user </span><a id="_idIndexMarker889"/><span class="koboSpan" id="kobo.854.1">security is based on four concepts:</span></p>
<ol>
<li class="numberedList" value="1"><strong class="keyWord"><span class="koboSpan" id="kobo.855.1">User</span></strong><span class="koboSpan" id="kobo.856.1">: This represents the user who logs in with Kubectl. </span><span class="koboSpan" id="kobo.856.2">Each user has a unique username and authenticates with a client certificate. </span><span class="koboSpan" id="kobo.856.3">Both certificate and username must be added to the user’s Kubectl configuration file as explained in the </span><em class="italic"><span class="koboSpan" id="kobo.857.1">Interacting with Kubernetes: Kubectl, Minikube, and AKS</span></em><span class="koboSpan" id="kobo.858.1"> section of </span><a href="Chapter_8.xhtml#_idTextAnchor205"><em class="italic"><span class="koboSpan" id="kobo.859.1">Chapter 8</span></em></a><em class="italic"><span class="koboSpan" id="kobo.860.1">, Practical Microservices Organization with Kubernetes</span></em><span class="koboSpan" id="kobo.861.1">.</span></li>
<li class="numberedList"><strong class="keyWord"><span class="koboSpan" id="kobo.862.1">User Group</span></strong><span class="koboSpan" id="kobo.863.1">: Each user group is just a name – a string that may be associated to each user and inserted in its client certificate. </span><span class="koboSpan" id="kobo.863.2">User groups simplify the assignation of permissions to users, since each privilege can be assigned to a single user or to a whole user group.</span></li>
<li class="numberedList"><strong class="keyWord"><span class="koboSpan" id="kobo.864.1">Role</span></strong><span class="koboSpan" id="kobo.865.1">: Each role represents a set of permissions.</span></li>
<li class="numberedList"><strong class="keyWord"><span class="koboSpan" id="kobo.866.1">Role bindings</span></strong><span class="koboSpan" id="kobo.867.1">: Each role binding associates a role, that is a set of permissions, to several users and user groups. </span><span class="koboSpan" id="kobo.867.2">Put simply, role bindings encode a one-to-many relationship between roles and both users and user groups.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.868.1">Permissions can be scoped either to a single namespace or to the whole Kubernetes cluster. </span><span class="koboSpan" id="kobo.868.2">Role and role bindings representing namespace-scoped permissions are encoded respectively in </span><code class="inlineCode"><span class="koboSpan" id="kobo.869.1">Role</span></code><span class="koboSpan" id="kobo.870.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.871.1">RoleBinding</span></code><strong class="keyWord"> </strong><span class="koboSpan" id="kobo.872.1">Kubernetes resources, while role and role bindings representing cluster-scoped permissions are encoded respectively in </span><code class="inlineCode"><span class="koboSpan" id="kobo.873.1">ClusterRole </span></code><span class="koboSpan" id="kobo.874.1">and </span><code class="inlineCode"><span class="koboSpan" id="kobo.875.1">ClusterRoleBinding</span></code><span class="koboSpan" id="kobo.876.1"> Kubernetes resources.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.877.1">A </span><code class="inlineCode"><span class="koboSpan" id="kobo.878.1">RoleBinding</span></code><span class="koboSpan" id="kobo.879.1"> can only refer to a </span><code class="inlineCode"><span class="koboSpan" id="kobo.880.1">Role</span></code><span class="koboSpan" id="kobo.881.1">, while a </span><code class="inlineCode"><span class="koboSpan" id="kobo.882.1">ClusterRoleBinding</span></code><span class="koboSpan" id="kobo.883.1"> can only refer to a </span><code class="inlineCode"><span class="koboSpan" id="kobo.884.1">ClusterRole</span></code><span class="koboSpan" id="kobo.885.1">. </span><span class="koboSpan" id="kobo.885.2">Here are </span><a id="_idIndexMarker890"/><span class="koboSpan" id="kobo.886.1">the definitions of a </span><code class="inlineCode"><span class="koboSpan" id="kobo.887.1">Role</span></code><span class="koboSpan" id="kobo.888.1">:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.889.1">apiVersion:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.890.1">rbac.authorization.k8s.io/v1</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.891.1">kind:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.892.1">Role</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.893.1">metadata:</span></span><span class="koboSpan" id="kobo.894.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.895.1">namespace:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.896.1">&lt;namespace</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.897.1">name&gt;</span></span><span class="koboSpan" id="kobo.898.1"> 
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.899.1">name:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.900.1">&lt;role</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.901.1">name&gt;</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.902.1">rules:</span></span>
<span class="hljs-bullet"><span class="koboSpan" id="kobo.903.1">-</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.904.1">apiGroups:</span></span><span class="koboSpan" id="kobo.905.1"> [</span><span class="hljs-string"><span class="koboSpan" id="kobo.906.1">""</span></span><span class="koboSpan" id="kobo.907.1">] </span><span class="hljs-comment"><span class="koboSpan" id="kobo.908.1"># "" indicates the core API group</span></span><span class="koboSpan" id="kobo.909.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.910.1">resources:</span></span><span class="koboSpan" id="kobo.911.1"> [</span><span class="hljs-string"><span class="koboSpan" id="kobo.912.1">"pods"</span></span><span class="koboSpan" id="kobo.913.1">]
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.914.1">verbs:</span></span><span class="koboSpan" id="kobo.915.1"> [</span><span class="hljs-string"><span class="koboSpan" id="kobo.916.1">"get"</span></span><span class="koboSpan" id="kobo.917.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.918.1">"watch"</span></span><span class="koboSpan" id="kobo.919.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.920.1">"list"</span></span><span class="koboSpan" id="kobo.921.1">] </span><span class="hljs-comment"><span class="koboSpan" id="kobo.922.1"># also "create", "update", "patch", "delete"</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.923.1">Each </span><strong class="keyWord"><span class="koboSpan" id="kobo.924.1">Role</span></strong><span class="koboSpan" id="kobo.925.1"> is identified by its name and by the namespace it applies to. </span><span class="koboSpan" id="kobo.925.2">Permissions are specified as a list of rules, where each rule contains:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.926.1">apiGroups</span></code><span class="koboSpan" id="kobo.927.1">: The API that contains the operations and the resources involved in the permission. </span><span class="koboSpan" id="kobo.927.2">For instance, the API group for Deployments is “apps,” while the API group for Pods is the core API that is represented by the empty string. </span><span class="koboSpan" id="kobo.927.3">The API groups string corresponds to the API name contained in each resource </span><code class="inlineCode"><span class="koboSpan" id="kobo.928.1">apiVersion</span></code><span class="koboSpan" id="kobo.929.1"> property. </span><span class="koboSpan" id="kobo.929.2">Each rule can specify several API groups.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.930.1">r</span><code class="inlineCode"><span class="koboSpan" id="kobo.931.1">esources</span></code><span class="koboSpan" id="kobo.932.1">: The name of the resources that can be manipulated with permission (Pods, Deployments, Services, etc.).</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.933.1">verbs</span></code><span class="koboSpan" id="kobo.934.1">: The operations allowed on the resources:</span><ul>
<li class="bulletList level-2"><code class="inlineCode"><span class="koboSpan" id="kobo.935.1">get</span></code><span class="koboSpan" id="kobo.936.1">: Getting information on specific resource instances.</span></li>
<li class="bulletList level-2"><code class="inlineCode"><span class="koboSpan" id="kobo.937.1">watch</span></code><span class="koboSpan" id="kobo.938.1">: Observing resource instance properties as they change in time. </span><span class="koboSpan" id="kobo.938.2">That is, performing a </span><code class="inlineCode"><span class="koboSpan" id="kobo.939.1">Kubectl get</span></code><span class="koboSpan" id="kobo.940.1"> or a </span><code class="inlineCode"><span class="koboSpan" id="kobo.941.1">Kubectl describe</span></code><span class="koboSpan" id="kobo.942.1"> with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.943.1">–watch</span></code><span class="koboSpan" id="kobo.944.1"> flag on the resource.</span></li>
<li class="bulletList level-2"><code class="inlineCode"><span class="koboSpan" id="kobo.945.1">list</span></code><span class="koboSpan" id="kobo.946.1">: Listing the resource in any list of results.</span></li>
<li class="bulletList level-2"><code class="inlineCode"><span class="koboSpan" id="kobo.947.1">create</span></code><span class="koboSpan" id="kobo.948.1">: Creating an instance of the resource.</span></li>
<li class="bulletList level-2"><code class="inlineCode"><span class="koboSpan" id="kobo.949.1">delete</span></code><span class="koboSpan" id="kobo.950.1">: Deleting an instance of the resource.</span></li>
<li class="bulletList level-2"><code class="inlineCode"><span class="koboSpan" id="kobo.951.1">update</span></code><span class="koboSpan" id="kobo.952.1">: Updating a resource instance by providing a new object that represents the instance. </span><span class="koboSpan" id="kobo.952.2">This is a case of the resource being updated with </span><code class="inlineCode"><span class="koboSpan" id="kobo.953.1">Kubectl apply</span></code><span class="koboSpan" id="kobo.954.1">.</span></li>
<li class="bulletList level-2"><code class="inlineCode"><span class="koboSpan" id="kobo.955.1">patch</span></code><span class="koboSpan" id="kobo.956.1">: Updating a resource instance with </span><code class="inlineCode"><span class="koboSpan" id="kobo.957.1">Kubectl patch</span></code><span class="koboSpan" id="kobo.958.1">. </span><span class="koboSpan" id="kobo.958.2">In this case, we specify an existing resource and then replace just a property with the value contained in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.959.1">-p</span></code><span class="koboSpan" id="kobo.960.1"> option. </span><span class="koboSpan" id="kobo.960.2">The property may also be a complex object, in which case the properties specified in the object tree recursively replace existing values, while properties not specified in the object tree are left unchanged. </span><span class="koboSpan" id="kobo.960.3">Here’s an example:
            </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.961.1">kubectl patch pod &lt;pod name&gt; -p '{"spec":{"containers":[{"name":"kubernetes-serve-hostname","image":"new image"}]}}'
</span></code></pre>
</li>
</ul>
</li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.962.1">Here’s a role that might </span><a id="_idIndexMarker891"/><span class="koboSpan" id="kobo.963.1">be adequate for developers of an application that runs in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.964.1">my-app</span></code><span class="koboSpan" id="kobo.965.1"> namespace:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.966.1">apiVersion:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.967.1">rbac.authorization.k8s.io/v1</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.968.1">kind:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.969.1">Role</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.970.1">metadata:</span></span><span class="koboSpan" id="kobo.971.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.972.1">namespace:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.973.1">my-app</span></span><span class="koboSpan" id="kobo.974.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.975.1">name:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.976.1">developer-user-role</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.977.1">rules:</span></span>
<span class="hljs-bullet"><span class="koboSpan" id="kobo.978.1">-</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.979.1">apiGroups:</span></span><span class="koboSpan" id="kobo.980.1"> [</span><span class="hljs-string"><span class="koboSpan" id="kobo.981.1">""</span></span><span class="koboSpan" id="kobo.982.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.983.1">"apps"</span></span><span class="koboSpan" id="kobo.984.1">]
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.985.1">resources:</span></span><span class="koboSpan" id="kobo.986.1"> [</span><span class="hljs-string"><span class="koboSpan" id="kobo.987.1">"pods"</span></span><span class="koboSpan" id="kobo.988.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.989.1">"services"</span></span><span class="koboSpan" id="kobo.990.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.991.1">"configmaps"</span></span><span class="koboSpan" id="kobo.992.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.993.1">"secrets"</span></span><span class="koboSpan" id="kobo.994.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.995.1">"deployments"</span></span><span class="koboSpan" id="kobo.996.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.997.1">"replicasets"</span></span><span class="koboSpan" id="kobo.998.1">]
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.999.1">verbs:</span></span><span class="koboSpan" id="kobo.1000.1"> [</span><span class="hljs-string"><span class="koboSpan" id="kobo.1001.1">"get"</span></span><span class="koboSpan" id="kobo.1002.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1003.1">"list"</span></span><span class="koboSpan" id="kobo.1004.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1005.1">"watch"</span></span><span class="koboSpan" id="kobo.1006.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1007.1">"create"</span></span><span class="koboSpan" id="kobo.1008.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1009.1">"update"</span></span><span class="koboSpan" id="kobo.1010.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1011.1">"delete"</span></span><span class="koboSpan" id="kobo.1012.1">]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1013.1">All of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1014.1">apiGroups</span></code><span class="koboSpan" id="kobo.1015.1">, r</span><code class="inlineCode"><span class="koboSpan" id="kobo.1016.1">esources</span></code><span class="koboSpan" id="kobo.1017.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1018.1">verbs</span></code><span class="koboSpan" id="kobo.1019.1"> accept the wildcard “*” string that matches everything.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1020.1">A </span><code class="inlineCode"><span class="koboSpan" id="kobo.1021.1">ClusterRole</span></code><span class="koboSpan" id="kobo.1022.1"> definition is completely analogous, the only difference being that no namespace must be specified and that </span><code class="inlineCode"><span class="koboSpan" id="kobo.1023.1">type: Role</span></code><span class="koboSpan" id="kobo.1024.1"> is replaced by </span><code class="inlineCode"><span class="koboSpan" id="kobo.1025.1">type: ClusterRole</span></code><span class="koboSpan" id="kobo.1026.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1027.1">Here is the definition of a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1028.1">RoleBinding</span></code><span class="koboSpan" id="kobo.1029.1">:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.1030.1">apiVersion:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1031.1">rbac.authorization.k8s.io/v1</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1032.1">kind:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1033.1">RoleBinding</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1034.1">metadata:</span></span><span class="koboSpan" id="kobo.1035.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1036.1">name:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1037.1">&lt;role</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1038.1">binding</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1039.1">name&gt;</span></span><span class="koboSpan" id="kobo.1040.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1041.1">namespace:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1042.1">&lt;reference</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1043.1">namespace&gt;</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1044.1">subjects:</span></span>
<span class="hljs-bullet"><span class="koboSpan" id="kobo.1045.1">-</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.1046.1">kind:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1047.1">User</span></span> <span class="hljs-comment"><span class="koboSpan" id="kobo.1048.1"># specific user</span></span><span class="koboSpan" id="kobo.1049.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1050.1">name:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1051.1">jane</span></span> <span class="hljs-comment"><span class="koboSpan" id="kobo.1052.1"># "name" is case sensitive</span></span><span class="koboSpan" id="kobo.1053.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1054.1">apiGroup:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1055.1">rbac.authorization.k8s.io</span></span>
<span class="hljs-bullet"><span class="koboSpan" id="kobo.1056.1">-</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.1057.1">kind:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1058.1">Group</span></span> <span class="hljs-comment"><span class="koboSpan" id="kobo.1059.1">#user group</span></span><span class="koboSpan" id="kobo.1060.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1061.1">name:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1062.1">namespace:administrators</span></span><span class="koboSpan" id="kobo.1063.1">  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1064.1"># "name" is case sensitive</span></span><span class="koboSpan" id="kobo.1065.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1066.1">apiGroup:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1067.1">rbac.authorization.k8s.io</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1068.1">…</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1069.1">roleRef:</span></span><span class="koboSpan" id="kobo.1070.1">
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1071.1"># "roleRef" specifies the binding to a Role </span></span><span class="koboSpan" id="kobo.1072.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1073.1">kind:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1074.1">Role</span></span> <span class="hljs-comment"><span class="koboSpan" id="kobo.1075.1">#this must be Role </span></span><span class="koboSpan" id="kobo.1076.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1077.1">name:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1078.1">&lt;role-name&gt;</span></span> <span class="hljs-comment"><span class="koboSpan" id="kobo.1079.1"># this must match the name of the Role you wish to bind to</span></span><span class="koboSpan" id="kobo.1080.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1081.1">apiGroup:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1082.1">rbac.authorization.k8s.io</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1083.1">A </span><code class="inlineCode"><span class="koboSpan" id="kobo.1084.1">RoleBinding</span></code><span class="koboSpan" id="kobo.1085.1"> contains a name and the reference namespace and specifies the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1086.1">Role</span></code><span class="koboSpan" id="kobo.1087.1"> it is bound to in its </span><code class="inlineCode"><span class="koboSpan" id="kobo.1088.1">roleRef</span></code><span class="koboSpan" id="kobo.1089.1"> property. </span><span class="koboSpan" id="kobo.1089.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1090.1">subjects</span></code><span class="koboSpan" id="kobo.1091.1"> property contains a list of both users and users’ groups, where each item </span><a id="_idIndexMarker892"/><span class="koboSpan" id="kobo.1092.1">specifies the user or group name and the kind of subject.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1093.1">Here is a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1094.1">RoleBinding</span></code><span class="koboSpan" id="kobo.1095.1"> that matches the example </span><code class="inlineCode"><span class="koboSpan" id="kobo.1096.1">developer-user-role</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.1097.1">Role</span></code><span class="koboSpan" id="kobo.1098.1"> we have seen before, with all users belonging to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1099.1">developers</span></code><span class="koboSpan" id="kobo.1100.1"> group:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.1101.1">apiVersion:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1102.1">rbac.authorization.k8s.io/v1</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1103.1">kind:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1104.1">RoleBinding</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1105.1">metadata:</span></span><span class="koboSpan" id="kobo.1106.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1107.1">name:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1108.1">developers-binding</span></span><span class="koboSpan" id="kobo.1109.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1110.1">namespace:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1111.1">my-app</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1112.1">subjects:</span></span>
<span class="hljs-bullet"><span class="koboSpan" id="kobo.1113.1">-</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.1114.1">kind:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1115.1">Group</span></span><span class="koboSpan" id="kobo.1116.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1117.1">name:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1118.1">developers</span></span><span class="koboSpan" id="kobo.1119.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1120.1">apiGroup:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1121.1">rbac.authorization.k8s.io</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1122.1">roleRef:</span></span><span class="koboSpan" id="kobo.1123.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1124.1">kind:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1125.1">Role</span></span><span class="koboSpan" id="kobo.1126.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1127.1">name:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1128.1">developer-user-role</span></span><span class="koboSpan" id="kobo.1129.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1130.1">apiGroup:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1131.1">rbac.authorization.k8s.io</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1132.1">A </span><code class="inlineCode"><span class="koboSpan" id="kobo.1133.1">ClusterBindingRole</span></code><span class="koboSpan" id="kobo.1134.1"> definition is completely analogous, the only difference being that no namespace must be specified, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1135.1">roleRef</span></code><span class="koboSpan" id="kobo.1136.1"> must refer a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1137.1">ClusterRole</span></code><span class="koboSpan" id="kobo.1138.1">, and that </span><code class="inlineCode"><span class="koboSpan" id="kobo.1139.1">type: BindingRole</span></code><span class="koboSpan" id="kobo.1140.1"> is replaced by </span><code class="inlineCode"><span class="koboSpan" id="kobo.1141.1">type: ClusterBindingRole</span></code><span class="koboSpan" id="kobo.1142.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1143.1">Client certificates do not need to be issued by a public certification authority but need just to be approved by the Kubernetes cluster. </span><span class="koboSpan" id="kobo.1143.2">Here is the complete procedure for creating an approved certificate:</span></p>
<ol>
<li class="alphabeticList" value="1"><span class="koboSpan" id="kobo.1144.1">As the first step, you must create the certificate key. </span><span class="koboSpan" id="kobo.1144.2">This can be done by op</span><a id="_idTextAnchor313"/><span class="koboSpan" id="kobo.1145.1">ening a Linux console and using </span><strong class="keyWord"><span class="koboSpan" id="kobo.1146.1">openssl</span></strong><span class="koboSpan" id="kobo.1147.1">:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.1148.1"> openssl genrsa -out mynewuser.key 2048
</span></code></pre>
</li>
<li class="alphabeticList"><span class="koboSpan" id="kobo.1149.1">You must store the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1150.1">mynewuser.key</span></code><span class="koboSpan" id="kobo.1151.1"> file containing the certificate key since it is needed to configure the Kubectl configuration file.</span></li>
<li class="alphabeticList"><span class="koboSpan" id="kobo.1152.1">Now let’s extract the public part </span><code class="inlineCode"><span class="koboSpan" id="kobo.1153.1">mynewuser.key</span></code><span class="koboSpan" id="kobo.1154.1"> in a certificate approval request. </span><span class="koboSpan" id="kobo.1154.2">Again, we can do it with </span><strong class="keyWord"><span class="koboSpan" id="kobo.1155.1">openssl</span></strong><span class="koboSpan" id="kobo.1156.1">:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.1157.1">openssl req -new -key mynewuser.key -out mynewuser.csr -subj "/CN= mynewuser /O=example:mygroup"
</span></code></pre>
</li>
<li class="alphabeticList"><span class="koboSpan" id="kobo.1158.1">The above</span><a id="_idIndexMarker893"/><span class="koboSpan" id="kobo.1159.1"> instruction generates the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1160.1">mynewuser.csr</span></code><span class="koboSpan" id="kobo.1161.1"> file, containing a certificate approval request. </span><code class="inlineCode"><span class="koboSpan" id="kobo.1162.1">mynewuser</span></code><span class="koboSpan" id="kobo.1163.1"> must be replaced by the actual username, while </span><code class="inlineCode"><span class="koboSpan" id="kobo.1164.1">example:mygroup</span></code><span class="koboSpan" id="kobo.1165.1"> must be replaced by the name of the user group you would like to add the user to.</span></li>
<li class="alphabeticList"><span class="koboSpan" id="kobo.1166.1">Now you must encode the certificate request in base 64:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.1167.1">cat mynewuser.csr | base64 | tr -d "\n"
</span></code></pre>
</li>
<li class="alphabeticList"><span class="koboSpan" id="kobo.1168.1">The previous command returns the base-64-encoded certificate in the Linux console. </span><span class="koboSpan" id="kobo.1168.2">Please select and copy it. </span><span class="koboSpan" id="kobo.1168.3">You must insert it in a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1169.1">.yaml</span></code><span class="koboSpan" id="kobo.1170.1"> file that encodes the approval request for the Kubernetes cluster:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.1171.1">apiVersion:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1172.1">certificates.k8s.io/v1</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1173.1">kind:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1174.1">CertificateSigningRequest</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1175.1">metadata:</span></span><span class="koboSpan" id="kobo.1176.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1177.1">name:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1178.1">mynewuserrequest</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1179.1">spec:</span></span><span class="koboSpan" id="kobo.1180.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1181.1">request:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1182.1">&lt;base64</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1183.1">encoded</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1184.1">csr&gt;</span></span><span class="koboSpan" id="kobo.1185.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1186.1">signerName:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1187.1">kubernetes.io/kube-apiserver-client</span></span><span class="koboSpan" id="kobo.1188.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1189.1">expirationSeconds:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1190.1">&lt;duration</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1191.1">in</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1192.1">seconds&gt;</span></span><span class="koboSpan" id="kobo.1193.1">
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1194.1">usages:</span></span><span class="koboSpan" id="kobo.1195.1">
  </span><span class="hljs-bullet"><span class="koboSpan" id="kobo.1196.1">-</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.1197.1">client:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1198.1">auth</span></span>
</code></pre>
</li>
<li class="alphabeticList"><span class="koboSpan" id="kobo.1199.1">The only fields you must change are the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1200.1">name</span></code><span class="koboSpan" id="kobo.1201.1">, that is the approval request name, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1202.1">expirationSeconds</span></code><span class="koboSpan" id="kobo.1203.1">, which contains the certificate validity in seconds.</span></li>
<li class="alphabeticList"><span class="koboSpan" id="kobo.1204.1">Now let’s open the Windows console to interact with Minikube. </span><span class="koboSpan" id="kobo.1204.2">Let’s start Minikube if it’s not started and then pass the previous .yaml file with:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.1205.1">Kubectl apply -f mynewuserrequest.yaml.
</span></code></pre>
</li>
</ol>
<ol>
<li class="alphabeticList" value="1"><span class="koboSpan" id="kobo.1206.1">Now we can approve the certificate with:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.1207.1">kubectl certificate approve mynewuserrequest
</span></code></pre>
</li>
<li class="alphabeticList"><span class="koboSpan" id="kobo.1208.1">After the approval, we can get the final certificate in base 64 format:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.1209.1">kubectl get csr mynewuserrequest -o jsonpath='{.status.certificate}'&gt; mytempfile.txt
</span></code></pre>
</li>
<li class="alphabeticList"><span class="koboSpan" id="kobo.1210.1">Finally, we must base 64 – decode </span><code class="inlineCode"><span class="koboSpan" id="kobo.1211.1">mytempfile.txt</span></code><span class="koboSpan" id="kobo.1212.1"> to get the certificate in binary format. </span><span class="koboSpan" id="kobo.1212.2">We can do it by opening a Linux console in the folder that contains </span><code class="inlineCode"><span class="koboSpan" id="kobo.1213.1">mytempfile.txt</span></code><span class="koboSpan" id="kobo.1214.1">, and then issuing:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.1215.1">cat mytempfile.txt | base64 -d &gt; mynewuser.crt
</span></code></pre>
</li>
<li class="alphabeticList"><span class="koboSpan" id="kobo.1216.1">Now you can use both </span><code class="inlineCode"><span class="koboSpan" id="kobo.1217.1">mynewuser.key</span></code><span class="koboSpan" id="kobo.1218.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1219.1">mynewuser.crt</span></code><span class="koboSpan" id="kobo.1220.1"> to update the Kubectl configuration file of the new user as explained in the </span><em class="italic"><span class="koboSpan" id="kobo.1221.1">Interacting with Kubernetes: Kubectl, Minikube, and AKS</span></em><span class="koboSpan" id="kobo.1222.1"> section of </span><a href="Chapter_8.xhtml#_idTextAnchor205"><em class="italic"><span class="koboSpan" id="kobo.1223.1">Chapter 8</span></em></a><em class="italic"><span class="koboSpan" id="kobo.1224.1">, Practical Microservices Organization with Kubernetes</span></em><span class="koboSpan" id="kobo.1225.1">.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1226.1">As an exercise, you can </span><a id="_idIndexMarker894"/><span class="koboSpan" id="kobo.1227.1">use the above procedure to define a new Minikube user belonging to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1228.1">developers</span></code><span class="koboSpan" id="kobo.1229.1"> user group, and then you can assign it developer privileges on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1230.1">myapp</span></code><span class="koboSpan" id="kobo.1231.1"> namespace with the example </span><code class="inlineCode"><span class="koboSpan" id="kobo.1232.1">developer-user-role Role</span></code><span class="koboSpan" id="kobo.1233.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1234.1">developers-binding RoleBinding</span></code><span class="koboSpan" id="kobo.1235.1"> we defined before.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1236.1">That’s all! </span><span class="koboSpan" id="kobo.1236.2">Let’s move on to Azure Container Apps user security.</span></p>
<h2 class="heading-2" id="_idParaDest-214"><a id="_idTextAnchor314"/><span class="koboSpan" id="kobo.1237.1">Azure Container Apps User Security</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1238.1">Azure Container Apps </span><a id="_idIndexMarker895"/><span class="koboSpan" id="kobo.1239.1">has no dedicated user security like Kubernetes but uses Azure security. </span><span class="koboSpan" id="kobo.1239.2">Roles can be assigned to specific users either through the Azure portal or with the Azure CLI with this command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1240.1">az role assignment create `
--assignee &lt;USER IDENTITY RESOURCE ID&gt; `
--role &lt;ROLE NAME&gt; `
--scope &lt;ENVIRONMENT OR APPLICATION_RESOURCE_ID&gt;
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1241.1">All available roles can be inspected on the Environment and Application page of the Azure portal. </span><span class="koboSpan" id="kobo.1241.2">Both the application/environment resource ID and the user identity resource ID are available on their respective pages.</span></p>
<h1 class="heading-1" id="_idParaDest-215"><a id="_idTextAnchor315"/><span class="koboSpan" id="kobo.1242.1">Threat Detection and Mitigation</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1243.1">The number of threats we need to deal with in an application is quite huge and OWASP, as mentioned before, helps us with that. </span><span class="koboSpan" id="kobo.1243.2">There are many common attacks that an application will need to handle and not only the protection of its network, data, entrance, and dependencies will be enough to deal with these attacks.</span></p>
<h2 class="heading-2" id="_idParaDest-216"><a id="_idTextAnchor316"/><span class="koboSpan" id="kobo.1244.1">Threats</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1245.1">The most difficult </span><a id="_idIndexMarker896"/><span class="koboSpan" id="kobo.1246.1">point of this scenario is detecting a threat on the fly while an application is running. </span><span class="koboSpan" id="kobo.1246.2">But to detect them, we need to understand basically what they are, so let’s check out, in the following topics, some of the common attacks. </span></p>
<h3 class="heading-3" id="_idParaDest-217"><a id="_idTextAnchor317"/><span class="koboSpan" id="kobo.1247.1">Event Injection</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.1248.1">When an attacker</span><a id="_idIndexMarker897"/><span class="koboSpan" id="kobo.1249.1"> manipulates input data to execute unauthorized</span><a id="_idIndexMarker898"/><span class="koboSpan" id="kobo.1250.1"> actions within an application, leading to data breaches, service disruptions, or unauthorized access, we are under an event injection attack. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.1251.1">There are several strategies of mitigation, which include validating and sanitizing the input, guaranteeing strict input data; using strong-validation libraries, to define well-established libraries and framework connections; and restricting the privilege of users to the minimum necessary.</span></p>
<h3 class="heading-3" id="_idParaDest-218"><a id="_idTextAnchor318"/><span class="koboSpan" id="kobo.1252.1">Privilege Escalation</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.1253.1">In an application where</span><a id="_idIndexMarker899"/><span class="koboSpan" id="kobo.1254.1"> you have different levels of access, privilege </span><a id="_idIndexMarker900"/><span class="koboSpan" id="kobo.1255.1">escalation occurs when an attacker gains access beyond what they need to have, accessing resources or functions that they are not authorized to use. </span><span class="koboSpan" id="kobo.1255.2">The result can be catastrophic, leading to unauthorized data access, total system control, and further exploitation of the application.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1256.1">Fine-grained access control to restrict users must be well implemented. </span><span class="koboSpan" id="kobo.1256.2">Also, there is the possibility to use</span><a id="_idIndexMarker901"/><span class="koboSpan" id="kobo.1257.1"> an </span><strong class="keyWord"><span class="koboSpan" id="kobo.1258.1">Identity and Access Management (IAM)</span></strong><span class="koboSpan" id="kobo.1259.1"> solution, which will enforce user permissions. </span><span class="koboSpan" id="kobo.1259.2">Regular audits and </span><strong class="keyWord"><span class="koboSpan" id="kobo.1260.1">Multi-Factor Authentication (MFA)</span></strong><span class="koboSpan" id="kobo.1261.1"> will</span><a id="_idIndexMarker902"/><span class="koboSpan" id="kobo.1262.1"> also help to mitigate possible scenarios where unauthorized users may access relevant data.</span></p>
<h3 class="heading-3" id="_idParaDest-219"><a id="_idTextAnchor319"/><span class="koboSpan" id="kobo.1263.1">Denial of Service (DoS) Attacks</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.1264.1">Let’s suppose you h</span><a id="_idIndexMarker903"/><span class="koboSpan" id="kobo.1265.1">ave massive and excessive traffic in your </span><a id="_idIndexMarker904"/><span class="koboSpan" id="kobo.1266.1">application caused by an attacker who wants to disrupt the availability of your solution, making the site simply stop responding accordingly. </span><span class="koboSpan" id="kobo.1266.2">This is what we call a </span><strong class="keyWord"><span class="koboSpan" id="kobo.1267.1">Denial of Service (DoS)</span></strong><span class="koboSpan" id="kobo.1268.1"> attack. </span><span class="koboSpan" id="kobo.1268.2">A DoS attack is caused by a single attacker, from a single point. </span><span class="koboSpan" id="kobo.1268.3">If you have an event where multiple origins of attacks are observed, you must be experiencing a DDoS attack, which means that the attack is distributed. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.1269.1">Obviously, the main way to mitigate this kind of attack is by blocking the traffic generated by its origin, so traffic filtering can be the best option. </span><span class="koboSpan" id="kobo.1269.2">There is also the possibility of limiting the rate of access from a specific client for a period, minimizing the impact of DDoS attacks. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.1270.1">Besides that, if you have a solution with great availability, focused on delivering high levels of requests, you can suffer less with this kind of attack, especially if we are talking about DoS. </span><span class="koboSpan" id="kobo.1270.2">So, auto-scaling strategies, which automatically adjust the number of active instances of a service based on the current load, are a good approach</span><a id="_idIndexMarker905"/><span class="koboSpan" id="kobo.1271.1"> for that. </span><strong class="keyWord"><span class="koboSpan" id="kobo.1272.1">Content delivery network (CDN)</span></strong><span class="koboSpan" id="kobo.1273.1"> implementations, which approximate content to the ones who are using it by implementing the content across multiple</span><a id="_idIndexMarker906"/><span class="koboSpan" id="kobo.1274.1"> geographically dispersed servers, can be also </span><a id="_idIndexMarker907"/><span class="koboSpan" id="kobo.1275.1">a good way to protect from this kind of attack.</span></p>
<h3 class="heading-3" id="_idParaDest-220"><a id="_idTextAnchor320"/><span class="koboSpan" id="kobo.1276.1">Man-in-the-Middle (MitM) Attacks</span></h3>
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1277.1">Man-in-the-Middle (MitM)</span></strong><span class="koboSpan" id="kobo.1278.1"> attacks occur </span><a id="_idIndexMarker908"/><span class="koboSpan" id="kobo.1279.1">when you have </span><a id="_idIndexMarker909"/><span class="koboSpan" id="kobo.1280.1">an interception of communication between two parts of a system, altering data, which can cause inconsistent information in the solution you provide. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.1281.1">As we have checked before, implementing a secure communication channel, using encryption protocols to secure data in transit, is certainly the best way to reduce the risk of this threat. </span><span class="koboSpan" id="kobo.1281.2">Authentication mechanisms can also help in this case, especially if there is a way to verify the identities of communicating parties.</span></p>
<h3 class="heading-3" id="_idParaDest-221"><a id="_idTextAnchor321"/><span class="koboSpan" id="kobo.1282.1">Code Injection</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.1283.1">Software code is certainly </span><a id="_idIndexMarker910"/><span class="koboSpan" id="kobo.1284.1">one of the ways to cause an attack in an application, especially</span><a id="_idIndexMarker911"/><span class="koboSpan" id="kobo.1285.1"> if the code enables the injection of malicious code. </span><span class="koboSpan" id="kobo.1285.2">Malicious code can be added in SQL commands that do not properly restrict what is executed in the database, enabling leaks, changes, or even data exclusion. </span><span class="koboSpan" id="kobo.1285.3">In cases where your application enables the execution of scripts, the risk is also high, and unauthorized actions can happen due to this. </span><span class="koboSpan" id="kobo.1285.4">You can also have cases where code is injected by attackers into web pages viewed by other users. </span><span class="koboSpan" id="kobo.1285.5">This is </span><a id="_idIndexMarker912"/><span class="koboSpan" id="kobo.1286.1">called </span><strong class="keyWord"><span class="koboSpan" id="kobo.1287.1">cross-site scripting (XSS)</span></strong><span class="koboSpan" id="kobo.1288.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1289.1">Implementing a serious code review process, applying secure coding practices, is mandatory in enterprises where the software is crucial for the business. </span><span class="koboSpan" id="kobo.1289.2">To help with this, the usage of a static analysis tool must be considered, based on the amount of code that is generated daily by the company.</span></p>
<h2 class="heading-2" id="_idParaDest-222"><a id="_idTextAnchor322"/><span class="koboSpan" id="kobo.1290.1">Detection and Mitigation with Web Application Firewalls</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1291.1">Since you now </span><a id="_idIndexMarker913"/><span class="koboSpan" id="kobo.1292.1">understand</span><a id="_idIndexMarker914"/><span class="koboSpan" id="kobo.1293.1"> the number of threats available, it is reasonable to say that there is no way to be entirely protected from them without a tool that can monitor the entire traffic, inspect it according to the different known threats, and alert you to take action once you have something suspicious. </span><span class="koboSpan" id="kobo.1293.2">That is exactly </span><a id="_idIndexMarker915"/><span class="koboSpan" id="kobo.1294.1">what a </span><strong class="keyWord"><span class="koboSpan" id="kobo.1295.1">Web Application Firewall (WAF)</span></strong><span class="koboSpan" id="kobo.1296.1"> does.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1297.1">SQL injection, XSS, and other common web exploits can be handled by WAFs, so you must consider their use crucial for securing serverless and microservices applications. </span><span class="koboSpan" id="kobo.1297.2">This is only possible because WAFs in general monitor HTTP/HTTPS traffic, giving you the possibility to block malicious requests from a specific client, even before they reach your application.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1298.1">They also provide a centralized panel for monitoring traffic and logging, which really simplifies the administration and increases your knowledge about the attacks you are suffering. </span><span class="koboSpan" id="kobo.1298.2">It is important to mention that if you are running a public cloud solution, you are constantly under attack. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.1299.1">The service Microsoft offers as a WAF is called Azure Web Application Firewall. </span><span class="koboSpan" id="kobo.1299.2">It is worth noting that Azure WAF works at Layer 7 (the application layer) of the OSI model and analyzes HTTP(S) traffic. </span><span class="koboSpan" id="kobo.1299.3">To do so, it will be necessary to check the requests and responses passing through a channel. </span><span class="koboSpan" id="kobo.1299.4">One of the alternatives for this channel is called Azure Application Gateway. </span><span class="koboSpan" id="kobo.1299.5">This component</span><a id="_idIndexMarker916"/><span class="koboSpan" id="kobo.1300.1"> is a </span><a id="_idIndexMarker917"/><span class="koboSpan" id="kobo.1301.1">web traffic load balancer that also works on OSI Layer 7. </span><span class="koboSpan" id="kobo.1301.2">It enables you to manage the traffic of your web applications. </span><span class="koboSpan" id="kobo.1301.3">All the inspected traffic that suggests a threat is sent to Azure Monitor as an alert so that an administrator of the application can analyze it and take action.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1302.1">As you may imagine, a solution that monitors the entire traffic of your application is obviously a concern when it comes to budget. </span><span class="koboSpan" id="kobo.1302.2">So, this is certainly a point of discussion about investment and the trade-off of it must be analyzed.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1303.1"><img alt="Figure 10.10: Sample solution architecture for enabling WAF" src="../Images/B31916_10_10.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1304.1">Figure 10.10: Sample solution architecture for enabling WAF</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1305.1">The preceding diagram represents a solution architecture using the components that were described in this topic. </span><span class="koboSpan" id="kobo.1305.2">As you can see, common users access the system via HTTPS, Azure Application Gateway handles traffic routing, and Azure WAF protects the solution against web threats. </span><span class="koboSpan" id="kobo.1305.3">There is also the implementation of a Container Apps environment for scaling workloads using </span><a id="_idIndexMarker918"/><span class="koboSpan" id="kobo.1306.1">containers, and </span><a id="_idIndexMarker919"/><span class="koboSpan" id="kobo.1307.1">the microservices are running inside a virtual network. </span><span class="koboSpan" id="kobo.1307.2">Azure Monitor is being used for the logging and observability of the system, so administrator access to Azure Monitor is used for insights. </span><span class="koboSpan" id="kobo.1307.3">Observability is exactly the next topic that we will discuss. </span><span class="koboSpan" id="kobo.1307.4">Let’s have a look at it.</span></p>
<h1 class="heading-1" id="_idParaDest-223"><a id="_idTextAnchor323"/><span class="koboSpan" id="kobo.1308.1">Observability for Serverless and Microservices</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1309.1">As we have seen up</span><a id="_idIndexMarker920"/><span class="koboSpan" id="kobo.1310.1"> to this point of the book, distributed systems contain a complexity that brings to a solution some concerns that you can’t ignore. </span><span class="koboSpan" id="kobo.1310.2">The implementation of a single microservice, using techniques such as serverless or containerization, is generally quite simple, but observing the entire solution is a difficult task and is certainly one of these concerns. </span><span class="koboSpan" id="kobo.1310.3">The adoption of the observability concept is a good answer to this problem.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1311.1">Observability is defined by three primary signals: logs, metrics, and traces. </span><span class="koboSpan" id="kobo.1311.2">A log is an immutable, time-stamped record of an event. </span><span class="koboSpan" id="kobo.1311.3">A metric is a numerical representation of system performance over time. </span><span class="koboSpan" id="kobo.1311.4">A trace represents the journey of a request across services in a distributed system. </span><span class="koboSpan" id="kobo.1311.5">Together, these three signals provide insight into system behavior, enabling proactive maintenance and fast troubleshooting.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1312.1">Different from traditional monitoring, which generally focuses on predefined metrics and system health indicators, and is often reactive, observability defends a proactive approach, where the monitoring is continuous to avoid critical problems, and fast root-cause detection is the goal. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.1313.1">There are several tools available to help implement observability in distributed systems. </span><span class="koboSpan" id="kobo.1313.2">For logs, tools like Seq and the ELK Stack offer powerful log aggregation and visualization capabilities. </span><span class="koboSpan" id="kobo.1313.3">For metrics, Prometheus is a widely used open-source monitoring solution, often paired with Grafana for visualization. </span><span class="koboSpan" id="kobo.1313.4">For distributed tracing, Jaeger and Zipkin are popular open-source options.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1314.1">However, Application Performance Monitoring (APM) tools like Azure Monitor, Datadog, and New Relic allow you to centralize logs, metrics, and traces in one place, providing a full picture of system behavior. </span><span class="koboSpan" id="kobo.1314.2">Choosing</span><a id="_idIndexMarker921"/><span class="koboSpan" id="kobo.1315.1"> between them depends on your infrastructure, cloud provider, and integration needs.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1316.1">Let’s understand each signal of observability in detail to make it easier to understand.</span></p>
<h2 class="heading-2" id="_idParaDest-224"><a id="_idTextAnchor324"/><span class="koboSpan" id="kobo.1317.1">Logging</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1318.1">Contextual-rich </span><a id="_idIndexMarker922"/><span class="koboSpan" id="kobo.1319.1">data is necessary to understand exactly where and when in the distributed system the issue monitored started. </span><span class="koboSpan" id="kobo.1319.2">For example, understanding the sequence of service calls and the data passed between them can reveal whether an error originated from a specific service or from the interaction between services. </span><span class="koboSpan" id="kobo.1319.3">This level of detail is crucial for effective debugging and for ensuring the resilience and reliability of distributed systems.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1320.1">So, to enhance the usability of logs, it is essential to adopt a structured format that is easy to query and process. </span><span class="koboSpan" id="kobo.1320.2">One of the most common approaches is to use JSON for log entries, as it offers readability and broad compatibility across systems. </span><span class="koboSpan" id="kobo.1320.3">However, structured logging goes beyond using a structured format. </span><span class="koboSpan" id="kobo.1320.4">It requires purposefully defining the meaning (semantics) of each log field. </span><span class="koboSpan" id="kobo.1320.5">This ensures consistency, improves observability, and enables better filtering, indexing, and correlation across logs.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1321.1">Besides that, effective logging needs the use of different logging categories to define the severity and importance of log entries. </span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1322.1">Debug: Detailed information for technical internal purposes.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1323.1">Info: General information about the application.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1324.1">Warning: Alerts that may indicate potential issues, but that did not cause the halting of the application.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1325.1">Error: Problems that impact the application’s operation and that need to be analyzed.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1326.1">Fatal: Critical errors that cause the application to terminate.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1327.1">The correct usage of logging</span><a id="_idIndexMarker923"/><span class="koboSpan" id="kobo.1328.1"> levels minimizes efforts in analyzing issues, focusing on critical ones in an efficient and effective approach.</span></p>
<h2 class="heading-2" id="_idParaDest-225"><a id="_idTextAnchor325"/><span class="koboSpan" id="kobo.1329.1">Metrics</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1330.1">When it comes to</span><a id="_idIndexMarker924"/><span class="koboSpan" id="kobo.1331.1"> metrics that need to be monitored and evaluated for serverless and microservices architectures, there are specific indicators that can be monitored. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.1332.1">For instance, Azure Functions measures the time it takes for a function to execute from start to finish. </span><span class="koboSpan" id="kobo.1332.2">This is </span><a id="_idIndexMarker925"/><span class="koboSpan" id="kobo.1333.1">called </span><strong class="keyWord"><span class="koboSpan" id="kobo.1334.1">Function Execution Time</span></strong><span class="koboSpan" id="kobo.1335.1">. </span><span class="koboSpan" id="kobo.1335.2">Shorter execution times generally indicate better performance.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1336.1">Azure Functions also measures the latency between a serverless function being triggered and the moment the function essentially starts running. </span><span class="koboSpan" id="kobo.1336.2">This is </span><a id="_idIndexMarker926"/><span class="koboSpan" id="kobo.1337.1">called </span><strong class="keyWord"><span class="koboSpan" id="kobo.1338.1">Cold Start</span></strong><span class="koboSpan" id="kobo.1339.1"> and reducing it causes improvement of the user experience. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.1340.1">The number of </span><strong class="keyWord"><span class="koboSpan" id="kobo.1341.1">invocations</span></strong><span class="koboSpan" id="kobo.1342.1"> and the number of </span><strong class="keyWord"><span class="koboSpan" id="kobo.1343.1">errors</span></strong><span class="koboSpan" id="kobo.1344.1"> also illustrate how the function is working, helping in the analysis of performance and possible problematic code.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1345.1">On the other hand, when you have containerized environments, </span><strong class="keyWord"><span class="koboSpan" id="kobo.1346.1">CPU</span></strong><span class="koboSpan" id="kobo.1347.1"> and </span><strong class="keyWord"><span class="koboSpan" id="kobo.1348.1">Memory Usage</span></strong><span class="koboSpan" id="kobo.1349.1"> may be good metrics to </span><a id="_idIndexMarker927"/><span class="koboSpan" id="kobo.1350.1">monitor. </span><span class="koboSpan" id="kobo.1350.2">The</span><a id="_idIndexMarker928"/><span class="koboSpan" id="kobo.1351.1"> first one can affect performance if it is too high, and scaling may be considered. </span><span class="koboSpan" id="kobo.1351.2">The second one can also impact performance, and the the cause of memory leaks can be addressed.</span></p>
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1352.1">Network Traffic </span></strong><span class="koboSpan" id="kobo.1353.1">may</span><a id="_idIndexMarker929"/><span class="koboSpan" id="kobo.1354.1"> also be a concern in containerized environments and can indicate issues related to communication between microservices. </span><strong class="keyWord"><span class="koboSpan" id="kobo.1355.1">Pod Health</span></strong><span class="koboSpan" id="kobo.1356.1"> can</span><a id="_idIndexMarker930"/><span class="koboSpan" id="kobo.1357.1"> help in identifying failing or unhealthy Pods.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1358.1">These and other metrics can not only be monitored but also alerted </span><a id="_idIndexMarker931"/><span class="koboSpan" id="kobo.1359.1">using </span><strong class="keyWord"><span class="koboSpan" id="kobo.1360.1">threshold-based</span></strong><span class="koboSpan" id="kobo.1361.1"> algorithms and alerts. </span><span class="koboSpan" id="kobo.1361.2">Today, in Azure, we also have</span><a id="_idIndexMarker932"/><span class="koboSpan" id="kobo.1362.1"> some </span><strong class="keyWord"><span class="koboSpan" id="kobo.1363.1">anomaly detection</span></strong><span class="koboSpan" id="kobo.1364.1"> done by machine models that generally detect deviation of behaviors in some situations, like time-response.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1365.1">Once alerts are properly set, it is also important to have a clear protocol for responding to these alerts. </span><span class="koboSpan" id="kobo.1365.2">This is normally called</span><a id="_idIndexMarker933"/><span class="koboSpan" id="kobo.1366.1"> the </span><strong class="keyWord"><span class="koboSpan" id="kobo.1367.1">Incident Response Process</span></strong><span class="koboSpan" id="kobo.1368.1">. </span><span class="koboSpan" id="kobo.1368.2">The process needs to determine how to deal with the incident (alert), how to communicate it, and how to discover the root cause, so the incident does not happen again.</span></p>
<h2 class="heading-2" id="_idParaDest-226"><a id="_idTextAnchor326"/><span class="koboSpan" id="kobo.1369.1">Tracing</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1370.1">When you have</span><a id="_idIndexMarker934"/><span class="koboSpan" id="kobo.1371.1"> a distributed application, understanding the complete path from a request to its end is important to effectively diagnose situations across the microservices that are chained. </span><span class="koboSpan" id="kobo.1371.2">That is why tracing is so important, and .NET applications together with Azure have a very good package of libraries to help you with it.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1372.1">The usage of Azure Monitor here is crucial for success. </span><span class="koboSpan" id="kobo.1372.2">Of course, there are other APM systems that can be used to observe the traceability of an application, but Azure Monitor gives us facilities that you may consider using. </span><span class="koboSpan" id="kobo.1372.3">Besides that, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1373.1">OpenTelemetry</span></code><span class="koboSpan" id="kobo.1374.1"> library will give you the versatility needed for enterprise solutions. </span><span class="koboSpan" id="kobo.1374.2">OpenTelemetry (OTel) is a cross-platform, open standard for collecting and emitting telemetry data.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1375.1">In .NET the OpenTelemetry implementation uses well-known platform APIs for instrumentation:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1376.1">Microsoft.Extensions.Logging.ILogger&lt;TCategoryName&gt;</span></code><span class="koboSpan" id="kobo.1377.1"> for logging</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1378.1">System.Diagnostics.Metrics.Meter</span></code><span class="koboSpan" id="kobo.1379.1"> for metrics</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1380.1">System.Diagnostics.ActivitySource</span></code><span class="koboSpan" id="kobo.1381.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1382.1">System.Diagnostics.Activity</span></code><span class="koboSpan" id="kobo.1383.1"> for distributed tracing</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1384.1">These APIs are used by OTel for collecting telemetry and exporting this data to an APM service selected by the developer.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1385.1">It is also important to notice that the implementation of trace propagation using OTel for .NET and Azure Monitor </span><a id="_idIndexMarker935"/><span class="koboSpan" id="kobo.1386.1">is fully automated, which accelerates the process of observing the application’s behavior in Azure Monitor.</span></p>
<h2 class="heading-2" id="_idParaDest-227"><a id="_idTextAnchor327"/><span class="koboSpan" id="kobo.1387.1">Centralized Observability with Azure Monitor</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1388.1">The following </span><a id="_idIndexMarker936"/><span class="koboSpan" id="kobo.1389.1">example </span><a id="_idIndexMarker937"/><span class="koboSpan" id="kobo.1390.1">will give you an idea of how powerful Azure Monitor is as an APM system to centralize logging, metrics, and tracing as a professional observability tool, accelerating diagnosing and enabling proactive management with rapid troubleshooting.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1391.1">The code provided in startup uses Azure Monitor for registering the telemetry collected by </span><code class="inlineCode"><span class="koboSpan" id="kobo.1392.1">OpenTelemetry</span></code><span class="koboSpan" id="kobo.1393.1"> libraries, as we can see here:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1394.1">var</span></span><span class="koboSpan" id="kobo.1395.1"> builder = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1396.1">WebApplication</span></span><span class="koboSpan" id="kobo.1397.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1398.1">CreateBuilder</span></span><span class="koboSpan" id="kobo.1399.1">(args);
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.1400.1">// Retrieve Application Insights connection string from configuration</span></span><span class="koboSpan" id="kobo.1401.1">
string appInsightsConnectionString = builder.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1402.1">Configuration</span></span><span class="koboSpan" id="kobo.1403.1">[
  </span><span class="hljs-string"><span class="koboSpan" id="kobo.1404.1">"AzureMonitor:ConnectionString"</span></span><span class="koboSpan" id="kobo.1405.1">];
builder.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1406.1">Services</span></span><span class="koboSpan" id="kobo.1407.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1408.1">AddOpenTelemetry</span></span><span class="koboSpan" id="kobo.1409.1">()
  .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1410.1">WithTracing</span></span><span class="koboSpan" id="kobo.1411.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1412.1">tracerProviderBuilder</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1413.1"> =&gt;</span></span><span class="koboSpan" id="kobo.1414.1">
  {
    tracerProviderBuilder
      </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1415.1">// Set resource builder with application name</span></span><span class="koboSpan" id="kobo.1416.1">
      .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1417.1">SetResourceBuilder</span></span><span class="koboSpan" id="kobo.1418.1">(
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.1419.1">ResourceBuilder</span></span><span class="koboSpan" id="kobo.1420.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1421.1">CreateDefault</span></span><span class="koboSpan" id="kobo.1422.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.1423.1">AddService</span></span><span class="koboSpan" id="kobo.1424.1">(
          builder.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1425.1">Environment</span></span><span class="koboSpan" id="kobo.1426.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1427.1">ApplicationName</span></span><span class="koboSpan" id="kobo.1428.1">))
      </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1429.1">// Add ASP.NET Core instrumentation</span></span><span class="koboSpan" id="kobo.1430.1">
      .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1431.1">AddAspNetCoreInstrumentation</span></span><span class="koboSpan" id="kobo.1432.1">()
      </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1433.1">// Add HTTP client instrumentation</span></span><span class="koboSpan" id="kobo.1434.1">
      .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1435.1">AddHttpClientInstrumentation</span></span><span class="koboSpan" id="kobo.1436.1">()
      </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1437.1">// Add Azure Monitor Trace Exporter with connection string</span></span><span class="koboSpan" id="kobo.1438.1">
      .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1439.1">AddAzureMonitorTraceExporter</span></span><span class="koboSpan" id="kobo.1440.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1441.1">options</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1442.1"> =&gt;</span></span><span class="koboSpan" id="kobo.1443.1">
      {
        options.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1444.1">ConnectionString</span></span><span class="koboSpan" id="kobo.1445.1"> = appInsightsConnectionString;
      });
  });
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.1446.1">// Add Application Insights only for logging &amp; metrics </span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1447.1">// (without re-adding tracing)</span></span><span class="koboSpan" id="kobo.1448.1">
builder.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1449.1">Services</span></span><span class="koboSpan" id="kobo.1450.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1451.1">AddApplicationInsightsTelemetry</span></span><span class="koboSpan" id="kobo.1452.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1453.1">options</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1454.1"> =&gt;</span></span><span class="koboSpan" id="kobo.1455.1">
{
  options.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1456.1">ConnectionString</span></span><span class="koboSpan" id="kobo.1457.1"> = appInsightsConnectionString;
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1458.1">// Disable AI's automatic trace sampling</span></span><span class="koboSpan" id="kobo.1459.1">
  options.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1460.1">EnableAdaptiveSampling</span></span><span class="koboSpan" id="kobo.1461.1"> = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1462.1">false</span></span><span class="koboSpan" id="kobo.1463.1">; 
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1464.1">// Prevents duplicate dependency tracking</span></span><span class="koboSpan" id="kobo.1465.1">
  options.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1466.1">EnableDependencyTrackingTelemetryModule</span></span><span class="koboSpan" id="kobo.1467.1"> = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1468.1">false</span></span><span class="koboSpan" id="kobo.1469.1">; 
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1470.1">// Prevents duplicate HTTP request tracking</span></span><span class="koboSpan" id="kobo.1471.1">
  options.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1472.1">EnableRequestTrackingTelemetryModule</span></span><span class="koboSpan" id="kobo.1473.1"> = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1474.1">false</span></span><span class="koboSpan" id="kobo.1475.1">; 
});
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1476.1">var</span></span><span class="koboSpan" id="kobo.1477.1"> app = builder.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1478.1">Build</span></span><span class="koboSpan" id="kobo.1479.1">();
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1480.1">The same code </span><a id="_idIndexMarker938"/><span class="koboSpan" id="kobo.1481.1">has two</span><a id="_idIndexMarker939"/><span class="koboSpan" id="kobo.1482.1"> APIs. </span><span class="koboSpan" id="kobo.1482.2">The APIs will obtain data via another route, but one of them will try to access an unknown URL.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.1483.1">// Map GET request to /error endpoint</span></span><span class="koboSpan" id="kobo.1484.1">
app.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1485.1">MapGet</span></span><span class="koboSpan" id="kobo.1486.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1487.1">"/error"</span></span><span class="koboSpan" id="kobo.1488.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.1489.1">async</span></span><span class="koboSpan" id="kobo.1490.1"> (</span><span class="hljs-title"><span class="koboSpan" id="kobo.1491.1">HttpContext</span></span><span class="koboSpan" id="kobo.1492.1"> context) =&gt;
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1493.1">var</span></span><span class="koboSpan" id="kobo.1494.1"> httpClient = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1495.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1496.1">HttpClient</span></span><span class="koboSpan" id="kobo.1497.1">();
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1498.1">var</span></span><span class="koboSpan" id="kobo.1499.1"> response = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1500.1">await</span></span><span class="koboSpan" id="kobo.1501.1"> httpClient.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1502.1">GetAsync</span></span><span class="koboSpan" id="kobo.1503.1">(
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1504.1">"https://anyhost.sample.com/data"</span></span><span class="koboSpan" id="kobo.1505.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1506.1">return</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1507.1">"Hello Trace!"</span></span><span class="koboSpan" id="kobo.1508.1">;
});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1509.1">Notice that the API that is working with a successful endpoint will try to access the Packt website.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.1510.1">// Map GET request to /success endpoint</span></span><span class="koboSpan" id="kobo.1511.1">
app.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1512.1">MapGet</span></span><span class="koboSpan" id="kobo.1513.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1514.1">"/success"</span></span><span class="koboSpan" id="kobo.1515.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.1516.1">async</span></span><span class="koboSpan" id="kobo.1517.1"> (</span><span class="hljs-title"><span class="koboSpan" id="kobo.1518.1">HttpContext</span></span><span class="koboSpan" id="kobo.1519.1"> context) =&gt;
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1520.1">var</span></span><span class="koboSpan" id="kobo.1521.1"> httpClient = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1522.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1523.1">HttpClient</span></span><span class="koboSpan" id="kobo.1524.1">();
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1525.1">var</span></span><span class="koboSpan" id="kobo.1526.1"> response = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1527.1">await</span></span><span class="koboSpan" id="kobo.1528.1"> httpClient.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1529.1">GetAsync</span></span><span class="koboSpan" id="kobo.1530.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1531.1">"https://www.packtpub.com/"</span></span><span class="koboSpan" id="kobo.1532.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1533.1">return</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1534.1">"Hello Trace!"</span></span><span class="koboSpan" id="kobo.1535.1">;
});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1536.1">Both results are impressive. </span><span class="koboSpan" id="kobo.1536.2">The first one indicates the endpoint with an error can be tracked entirely in the Azure Monitor End-to-end transaction view. </span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1537.1"><img alt="Figure 10.11: Endpoint with an error in Azure Monitor End-to-end transaction view" src="../Images/B31916_10_11.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1538.1">Figure 10.11: Endpoint with an error in Azure Monitor End-to-end transaction view</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1539.1">This monitoring </span><a id="_idIndexMarker940"/><span class="koboSpan" id="kobo.1540.1">would be useful to detect this endpoint error, facilitating the correction of this bug. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.1541.1">The second result is also interesting because it detects a redirection that could improve the performance of the request.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1542.1"><img alt="Figure 10.12: Endpoint with a successful result in Azure Monitor End-to-end transaction view" src="../Images/B31916_10_12.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1543.1">Figure 10.12: Endpoint with a successful result in Azure Monitor End-to-end transaction view</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1544.1">The point here is </span><a id="_idIndexMarker941"/><span class="koboSpan" id="kobo.1545.1">that every call will take 67.2 milliseconds only to redirect to the page that is desired. </span><span class="koboSpan" id="kobo.1545.2">Maybe an alternative solution would be to directly access the correct URL. </span><span class="koboSpan" id="kobo.1545.3">We need to understand this example as a hypothetical case, but in real-world cases, this can increase the performance of the application.</span></p>
<h1 class="heading-1" id="_idParaDest-228"><a id="_idTextAnchor328"/><span class="koboSpan" id="kobo.1546.1">Summary </span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1547.1">In this chapter, we had the opportunity to discuss security and observability strategies for serverless and microservices applications. </span><span class="koboSpan" id="kobo.1547.2">We need to understand that the increase in threats posed by cybercrime moves us to integrate security from the initial stages of product development. </span><span class="koboSpan" id="kobo.1547.3">To do so, we must apply, in our security by design approach, security best practices for databases, implementing authentication and authorization mechanisms like </span><strong class="keyWord"><span class="koboSpan" id="kobo.1548.1">JSON Web Tokens (JWTs)</span></strong><span class="koboSpan" id="kobo.1549.1">, OAuth 2.0, and </span><strong class="keyWord"><span class="koboSpan" id="kobo.1550.1">OpenID Connect (OIDC)</span></strong><span class="koboSpan" id="kobo.1551.1">, and using network protection methods like </span><strong class="keyWord"><span class="koboSpan" id="kobo.1552.1">Virtual Private Clouds (VPCs)</span></strong><span class="koboSpan" id="kobo.1553.1"> and Azure Private Link. </span><span class="koboSpan" id="kobo.1553.2">Encryption, HTTPS enforcement, and the use of Azure Key Vault for managing secrets are also important for modern application development.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1554.1">Another focus of the chapter was network security, particularly in Kubernetes and Azure Container Apps environments. </span><span class="koboSpan" id="kobo.1554.2">That is why the chapter explained how Kubernetes network policies enhance security through the isolation of applications and services using namespaces and Pod-based network rules. </span><span class="koboSpan" id="kobo.1554.3">Azure’s network security strategies involve virtual networks, firewalls, and private links to limit exposure to public threats. </span><span class="koboSpan" id="kobo.1554.4">The chapter also discussed user security, emphasizing role-based access control (RBAC) in Kubernetes and Azure role assignments. </span><span class="koboSpan" id="kobo.1554.5">It also addressed securing dependencies by ensuring that third-party components, libraries, and containers are regularly updated to prevent vulnerabilities.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1555.1">The chapter also emphasized the importance of threat detection, using web application firewalls (WAFs) and proactive security strategies to mitigate threats such as injection attacks, denial-of-service (DoS) attacks, and privilege escalation.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1556.1">To finish, observability was another critical topic presented, which was defined through three primary signals: logs, metrics, and traces. </span><span class="koboSpan" id="kobo.1556.2">The chapter explained how structured logging, categorized by severity levels, can help diagnose issues efficiently. </span><span class="koboSpan" id="kobo.1556.3">It also covered key performance metrics for both serverless functions and containerized applications, such as execution times, resource consumption, and error rates. </span><span class="koboSpan" id="kobo.1556.4">Tracing techniques, including OpenTelemetry and Azure Monitor, were presented as solutions for tracking distributed transactions and enhancing system monitoring. </span></p>
<h1 class="heading-1" id="_idParaDest-229"><a id="_idTextAnchor329"/><span class="koboSpan" id="kobo.1557.1">Questions</span></h1>
<ol>
<li class="numberedList" value="1"><strong class="keyWord"><span class="koboSpan" id="kobo.1558.1">Why is security a critical concern in serverless and microservices architectures compared to monolithic applications?</span></strong></li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.1559.1">Security is more critical in serverless and microservices architectures because they significantly expand the attack surface. </span><span class="koboSpan" id="kobo.1559.2">Unlike monolithic applications, distributed systems involve multiple independent services communicating over networks, which increases the potential entry points for cyberattacks. </span><span class="koboSpan" id="kobo.1559.3">Each microservice, API, or function might expose vulnerabilities, and the complexity of managing security across them demands a more comprehensive and layered approach.</span></p>
<ol>
<li class="numberedList" value="2"><strong class="keyWord"><span class="koboSpan" id="kobo.1560.1">What are the key layers of security in an application, and why is the “onion model” a useful analogy?</span></strong></li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.1561.1">The key layers of security include:</span></p>
<ul>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1562.1">Data security (e.g., encryption, secure database access)</span></li>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1563.1">Application security (e.g., authentication and authorization)</span></li>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1564.1">Third-party components (e.g., library updates)</span></li>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1565.1">Infrastructure and network security (e.g., VPCs, firewalls)</span></li>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1566.1">Traffic interception and monitoring (e.g., WAFs)</span></li>
</ul>
<p class="normal-one"><span class="koboSpan" id="kobo.1567.1">The “onion model” is useful because it emphasizes that security must be implemented in multiple concentric layers. </span><span class="koboSpan" id="kobo.1567.2">Each layer reinforces the others, reducing the likelihood of a single point of failure.</span></p>
<ol>
<li class="numberedList" value="3"><strong class="keyWord"><span class="koboSpan" id="kobo.1568.1">How does a Virtual Private Cloud (VPC) improve security in cloud environments, and what are its key benefits?</span></strong></li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.1569.1">A VPC creates a logically isolated network within the public cloud, allowing you to define custom subnets, routing rules, and gateways. </span><span class="koboSpan" id="kobo.1569.2">Key benefits include:</span></p>
<ul>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1570.1">Reduced exposure to public threats</span></li>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1571.1">Fine-grained traffic control</span></li>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1572.1">Integration with services like Azure Private Link</span></li>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1573.1">Enhanced monitoring and protection through network security groups and flow logs</span></li>
</ul>
<ol>
<li class="numberedList" value="4"><strong class="keyWord"><span class="koboSpan" id="kobo.1574.1">What is the difference between authentication and authorization, and what are some commonly used authentication mechanisms?</span></strong>
<ul>
<li class="bulletList level-2"><strong class="keyWord"><span class="koboSpan" id="kobo.1575.1">Authentication</span></strong><span class="koboSpan" id="kobo.1576.1"> is the process of verifying the identity of a user or system.</span></li>
<li class="bulletList level-2"><strong class="keyWord"><span class="koboSpan" id="kobo.1577.1">Authorization</span></strong><span class="koboSpan" id="kobo.1578.1"> determines what an authenticated user is allowed to do.</span></li>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1579.1">Common mechanisms include:</span><ul>
<li class="bulletList level-3"><span class="koboSpan" id="kobo.1580.1">JSON Web Tokens (JWTs)</span></li>
<li class="bulletList level-3"><span class="koboSpan" id="kobo.1581.1">OAuth 2.0</span></li>
<li class="bulletList level-3"><span class="koboSpan" id="kobo.1582.1">OpenID Connect (OIDC)</span></li>
</ul>
</li>
</ul>
</li>
<li class="numberedList"><strong class="keyWord"><span class="koboSpan" id="kobo.1583.1">How does a JSON Web Token (JWT) ensure secure communication between a client and a server?</span></strong></li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.1584.1">A JWT encodes user claims in a signed JSON object transferred via HTTP headers. </span><span class="koboSpan" id="kobo.1584.2">After successful authentication, the server issues a token. </span><span class="koboSpan" id="kobo.1584.3">This token is then included in subsequent requests by the client. </span><span class="koboSpan" id="kobo.1584.4">Middleware on the server verifies the token before allowing access. </span><span class="koboSpan" id="kobo.1584.5">The stateless and signed nature of JWTs helps ensure message integrity and secure access control.</span></p>
<ol>
<li class="numberedList" value="6"><strong class="keyWord"><span class="koboSpan" id="kobo.1585.1">What are Kubernetes resources for handling network security?</span></strong></li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.1586.1">Kubernetes handles network security using:</span></p>
<ul>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1587.1">Namespaces for isolating applications</span></li>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1588.1">Pods with specific labels and rules</span></li>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1589.1">NetworkPolicy resources to define ingress/egress rules based on:</span><ul>
<li class="bulletList level-3"><span class="koboSpan" id="kobo.1590.1">IP blocks</span></li>
<li class="bulletList level-3"><span class="koboSpan" id="kobo.1591.1">Pod selectors</span></li>
<li class="bulletList level-3"><span class="koboSpan" id="kobo.1592.1">Namespace selectors</span></li>
<li class="bulletList level-3"><span class="koboSpan" id="kobo.1593.1">Ports and protocols</span></li>
</ul>
</li>
</ul>
<p class="normal-one"><span class="koboSpan" id="kobo.1594.1">These policies constrain communication between services in a modular, application-centric way.</span></p>
<ol>
<li class="numberedList" value="7"><strong class="keyWord"><span class="koboSpan" id="kobo.1595.1">What are Kubernetes resources for handling users’ security?</span></strong></li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.1596.1">User security in Kubernetes is managed through:</span></p>
<ul>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1597.1">Users and Groups</span></li>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1598.1">Roles and RoleBindings (namespace-scoped)</span></li>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1599.1">ClusterRoles and ClusterRoleBindings (cluster-wide)</span></li>
</ul>
<p class="normal-one"><span class="koboSpan" id="kobo.1600.1">Permissions are defined through verbs (get, list, create, delete, etc.) and bound to users/groups via role bindings. </span><span class="koboSpan" id="kobo.1600.2">Authentication typically uses client certificates.</span></p>
<ol>
<li class="numberedList" value="8"><strong class="keyWord"><span class="koboSpan" id="kobo.1601.1">Does Azure Container Apps have specific facilities for users and network security?</span></strong></li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.1602.1">Yes:</span></p>
<ul>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1603.1">Network security is handled through Azure Virtual Networks and subnets.</span></li>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1604.1">User access is managed via Azure Role-Based Access Control (RBAC), where roles are assigned to users through the Azure portal or CLI.</span></li>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1605.1">Azure does not have a dedicated user security model like Kubernetes but relies on the broader Azure identity platform.</span></li>
</ul>
<ol>
<li class="numberedList" value="9"><strong class="keyWord"><span class="koboSpan" id="kobo.1606.1">What are some common cyber threats, such as privilege escalation and denial-of-service attacks, and what strategies can be used to mitigate them?</span></strong></li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.1607.1">Common threats:</span></p>
<ul>
<li class="bulletList level-2"><strong class="keyWord"><span class="koboSpan" id="kobo.1608.1">Event injection</span></strong><span class="koboSpan" id="kobo.1609.1">: Mitigated by input validation/sanitization.</span></li>
<li class="bulletList level-2"><strong class="keyWord"><span class="koboSpan" id="kobo.1610.1">Privilege escalation</span></strong><span class="koboSpan" id="kobo.1611.1">: Mitigated by fine-grained access controls, IAM solutions, audits, and MFA.</span></li>
<li class="bulletList level-2"><strong class="keyWord"><span class="koboSpan" id="kobo.1612.1">DoS/DDoS attacks</span></strong><span class="koboSpan" id="kobo.1613.1">: Mitigated by rate limiting, traffic filtering, auto-scaling, and CDNs.</span></li>
<li class="bulletList level-2"><strong class="keyWord"><span class="koboSpan" id="kobo.1614.1">MitM attacks</span></strong><span class="koboSpan" id="kobo.1615.1">: Mitigated by HTTPS/TLS encryption and authentication.</span></li>
<li class="bulletList level-2"><strong class="keyWord"><span class="koboSpan" id="kobo.1616.1">Code injection</span></strong><span class="koboSpan" id="kobo.1617.1"> (e.g., SQL Injection, XSS): Mitigated by secure coding practices, static analysis, and WAFs.</span></li>
</ul>
<ol>
<li class="numberedList" value="10"><strong class="keyWord"><span class="koboSpan" id="kobo.1618.1">What role do Web Application Firewalls (WAFs) play in securing microservices applications, and what are their main advantages?</span></strong></li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.1619.1">WAFs monitor and filter HTTP/HTTPS traffic, blocking malicious requests before they reach the application. </span><span class="koboSpan" id="kobo.1619.2">Advantages include:</span></p>
<ul>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1620.1">Protection against known web exploits (e.g., SQL injection, XSS)</span></li>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1621.1">Centralized logging and alerting (e.g., via Azure Monitor)</span></li>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1622.1">Ability to block specific clients</span></li>
<li class="bulletList level-2"><span class="koboSpan" id="kobo.1623.1">Simplified security administration</span></li>
</ul>
<p class="normal-one"><span class="koboSpan" id="kobo.1624.1">Azure’s WAF integrates with Application Gateway and operates at OSI Layer 7.</span></p>
<ol>
<li class="numberedList" value="11"><strong class="keyWord"><span class="koboSpan" id="kobo.1625.1">What are the three primary signals of observability, and how do they contribute to maintaining a secure and efficient system?</span></strong></li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.1626.1">The three primary signals are:</span></p>
<ul>
<li class="bulletList level-2"><strong class="keyWord"><span class="koboSpan" id="kobo.1627.1">Logs</span></strong><span class="koboSpan" id="kobo.1628.1">: Immutable event records that help in debugging and auditing.</span></li>
<li class="bulletList level-2"><strong class="keyWord"><span class="koboSpan" id="kobo.1629.1">Metrics</span></strong><span class="koboSpan" id="kobo.1630.1">: Quantitative performance indicators (e.g., execution time, memory usage).</span></li>
<li class="bulletList level-2"><strong class="keyWord"><span class="koboSpan" id="kobo.1631.1">Traces</span></strong><span class="koboSpan" id="kobo.1632.1">: Visualize request paths across services for root-cause analysis.</span></li>
</ul>
<p class="normal-one"><span class="koboSpan" id="kobo.1633.1">Together, they allow proactive monitoring, help detect anomalies, and support rapid incident response—crucial for secure and resilient systems.</span></p>
<h1 class="heading-1" id="_idParaDest-230"><a id="_idTextAnchor330"/><span class="koboSpan" id="kobo.1634.1">Further reading</span></h1>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1635.1">Azure Container Apps Networking: </span><a href="https://learn.microsoft.com/en-us/azure/container-apps/networking?tabs=workload-profiles-env%2Cazure-cli"><span class="url"><span class="koboSpan" id="kobo.1636.1">https://learn.microsoft.com/en-us/azure/container-apps/networking?tabs=workload-profiles-env%2Cazure-cli</span></span></a><span class="koboSpan" id="kobo.1637.1">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1638.1">Buy a custom domain: </span><a href="https://learn.microsoft.com/en-us/azure/app-service/manage-custom-dns-buy-domain"><span class="url"><span class="koboSpan" id="kobo.1639.1">https://learn.microsoft.com/en-us/azure/app-service/manage-custom-dns-buy-domain</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1640.1">Storing app secrets: </span><a href="https://learn.microsoft.com/en-us/samples/azure/azure-sdk-for-net/app-secrets-configuration/"><span class="url"><span class="koboSpan" id="kobo.1641.1">https://learn.microsoft.com/en-us/samples/azure/azure-sdk-for-net/app-secrets-configuration/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1642.1">Transparent Data Encryption: </span><a href="https://learn.microsoft.com/en-us/sql/relational-databases/security/encryption/transparent-data-encryption"><span class="url"><span class="koboSpan" id="kobo.1643.1">https://learn.microsoft.com/en-us/sql/relational-databases/security/encryption/transparent-data-encryption</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1644.1">JSON Web Tokens: </span><a href="https://jwt.io/"><span class="url"><span class="koboSpan" id="kobo.1645.1">https://jwt.io/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1646.1">OAuth 2.0: </span><a href="https://oauth.net/"><span class="url"><span class="koboSpan" id="kobo.1647.1">https://oauth.net/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1648.1">MSAL: </span><a href="https://learn.microsoft.com/en-us/entra/identity-platform/msal-overview"><span class="url"><span class="koboSpan" id="kobo.1649.1">https://learn.microsoft.com/en-us/entra/identity-platform/msal-overview</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1650.1">What is OIDC?: </span><a href="https://www.microsoft.com/en-us/security/business/security-101/what-is-openid-connect-oidc"><span class="url"><span class="koboSpan" id="kobo.1651.1">https://www.microsoft.com/en-us/security/business/security-101/what-is-openid-connect-oidc</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1652.1">OIDC: </span><a href="https://openid.net/"><span class="url"><span class="koboSpan" id="kobo.1653.1">https://openid.net/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1654.1">OWASP: </span><a href="https://owasp.org/"><span class="url"><span class="koboSpan" id="kobo.1655.1">https://owasp.org/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1656.1">Azure Private Link: </span><a href="https://learn.microsoft.com/en-us/azure/private-link/private-link-overview"><span class="url"><span class="koboSpan" id="kobo.1657.1">https://learn.microsoft.com/en-us/azure/private-link/private-link-overview</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1658.1">Network security groups: </span><a href="https://learn.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview"><span class="url"><span class="koboSpan" id="kobo.1659.1">https://learn.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1660.1">Virtual Network flow logs: </span><a href="https://learn.microsoft.com/en-us/azure/network-watcher/vnet-flow-logs-overview"><span class="url"><span class="koboSpan" id="kobo.1661.1">https://learn.microsoft.com/en-us/azure/network-watcher/vnet-flow-logs-overview</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1662.1">Azure Virtual Network: </span><a href="https://learn.microsoft.com/en-us/azure/virtual-network/virtual-networks-overview"><span class="url"><span class="koboSpan" id="kobo.1663.1">https://learn.microsoft.com/en-us/azure/virtual-network/virtual-networks-overview</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1664.1">Azure Managed Identities: </span><a href="https://learn.microsoft.com/en-us/entra/identity/managed-identities-azure-resources/overview"><span class="url"><span class="koboSpan" id="kobo.1665.1">https://learn.microsoft.com/en-us/entra/identity/managed-identities-azure-resources/overview</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1666.1">Azure Firewall: </span><a href="https://learn.microsoft.com/en-us/azure/firewall/overview"><span class="url"><span class="koboSpan" id="kobo.1667.1">https://learn.microsoft.com/en-us/azure/firewall/overview</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1668.1">Azure Web Application Firewall: </span><a href="https://azure.microsoft.com/en-us/products/web-application-firewall"><span class="url"><span class="koboSpan" id="kobo.1669.1">https://azure.microsoft.com/en-us/products/web-application-firewall</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1670.1">Azure Application Gateway: </span><a href="https://learn.microsoft.com/en-us/azure/application-gateway/"><span class="url"><span class="koboSpan" id="kobo.1671.1">https://learn.microsoft.com/en-us/azure/application-gateway/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1672.1">OpenTelemetry: </span><a href="https://learn.microsoft.com/en-us/dotnet/core/diagnostics/observability-with-otel"><span class="url"><span class="koboSpan" id="kobo.1673.1">https://learn.microsoft.com/en-us/dotnet/core/diagnostics/observability-with-otel</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1674.1">GitHub Dependabot: </span><a href="https://github.com/dependabot"><span class="url"><span class="koboSpan" id="kobo.1675.1">https://github.com/dependabot</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1676.1">Sonar: </span><a href="https://www.sonarsource.com/"><span class="url"><span class="koboSpan" id="kobo.1677.1">https://www.sonarsource.com/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1678.1">Synk: </span><a href="https://snyk.io/"><span class="url"><span class="koboSpan" id="kobo.1679.1">https://snyk.io/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1680.1">Seq: </span><a href="https://datalust.co/seq"><span class="url"><span class="koboSpan" id="kobo.1681.1">https://datalust.co/seq</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1682.1">ELK Stack: </span><a href="https://www.elastic.co/elastic-stack/"><span class="url"><span class="koboSpan" id="kobo.1683.1">https://www.elastic.co/elastic-stack/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1684.1">Prometheus: </span><a href="https://prometheus.io/"><span class="url"><span class="koboSpan" id="kobo.1685.1">https://prometheus.io/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1686.1">Grafana: </span><a href="https://grafana.com/"><span class="url"><span class="koboSpan" id="kobo.1687.1">https://grafana.com/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1688.1">Jaeger: </span><a href="https://www.jaegertracing.io/"><span class="url"><span class="koboSpan" id="kobo.1689.1">https://www.jaegertracing.io/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1690.1">Zipkin: </span><a href="https://zipkin.io/"><span class="url"><span class="koboSpan" id="kobo.1691.1">https://zipkin.io/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1692.1">Datadog: </span><a href="https://www.datadoghq.com/"><span class="url"><span class="koboSpan" id="kobo.1693.1">https://www.datadoghq.com/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1694.1">New Relic: </span><a href="https://newrelic.com/"><span class="url"><span class="koboSpan" id="kobo.1695.1">https://newrelic.com/</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-231"><a id="_idTextAnchor331"/><span class="koboSpan" id="kobo.1696.1">Join our community on Discord</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1697.1">Join our community’s Discord space for discussions with the author and other readers:</span></p>
<p class="normal"><a href="https://packt.link/PSMCSharp"><span class="url"><span class="koboSpan" id="kobo.1698.1">https://packt.link/PSMCSharp</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.1699.1"><img alt="A qr code with black squares  AI-generated content may be incorrect." src="../Images/B31916_Discord-QR-Code.png"/></span></p>
</div>
</body></html>