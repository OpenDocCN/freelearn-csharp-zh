<html><head></head><body>
<div><div><h1 class="chapter-number" id="_idParaDest-239"><a id="_idTextAnchor409" class="pcalibre pcalibre1 calibre6"/>14</h1>
<h1 id="_idParaDest-240" class="calibre5"><a id="_idTextAnchor410" class="pcalibre pcalibre1 calibre6"/>Animating UI Elements</h1>
<p class="calibre3">Since we have already discussed how to create animation transitions for buttons, in this chapter, we’ll take a look at animation transitions more thoroughly and discuss how to create animations for UI elements in a more general sense.</p>
<p class="calibre3">This chapter assumes that you have a basic understanding of Unity’s Animation System and will not go into detail describing the names of the various menus and layout of the Animation Window and Animator Window. Animation Clips and Animators will be described briefly, with a focus on how they relate to UI and their implementation, which will be discussed in the examples at the end of the chapter.</p>
<p class="calibre3">In this chapter, we will discuss the following topics:</p>
<ul class="calibre16">
<li class="calibre14">Applying animations to the various UI elements</li>
<li class="calibre14">Creating a pop-up window that fades in and out</li>
<li class="calibre14">Creating a complex Animation System with a State Machine and Animation Events</li>
</ul>
<p class="calibre3">Even though I am assuming that you have a basic understanding of Unity’s Animation System, I do want to emphasize the difference between an Animation Clip and the Animator.</p>
<p class="calibre3">When creating animations for items in Unity, you start with <strong class="bold">Animation Clips</strong>. An Animation Clip should represent a single distinct action or motion. So, for example, if you had a menu that performed two separate actions, bouncing and zooming, you’d make each of those actions a separate Animation Clip. Although you can have multiple things happen in a single Animation Clip, it is very important not to put multiple actions in a single clip unless they are always going to happen at the same time.</p>
<p class="calibre3">Every GameObject can have multiple Animation Clips. The <strong class="bold">Animator</strong> determines how all of these Animations link together. So, a GameObject’s Animator will have all of its Animation Clips within it.</p>
<p class="calibre3">I wanted to make this distinction because in the past, I have seen projects with epic Animation Clips containing multiple actions that should have been broken down into more simple motions.</p>
<p class="callout-heading">Note</p>
<p class="callout">As with previous chapters, all of the examples shown in this section can be found within the Unity project provided in the code bundle. They can be found within the scene labeled <strong class="source-inline1">Chapter14</strong>.</p>
<h1 id="_idParaDest-241" class="calibre5"><a id="_idTextAnchor411" class="pcalibre pcalibre1 calibre6"/>Technical requirements</h1>
<p class="calibre3">You can find the relevant codes and asset files of this chapter here: <a href="https://github.com/PacktPublishing/Mastering-UI-Development-with-Unity-2nd-Edition/tree/main/Chapter%2014" class="pcalibre pcalibre1 calibre6">https://github.com/PacktPublishing/Mastering-UI-Development-with-Unity-2nd-Edition/tree/main/Chapter%2014</a></p>
<h1 id="_idParaDest-242" class="calibre5"><a id="_idTextAnchor412" class="pcalibre pcalibre1 calibre6"/>Animation Clips</h1>
<p class="calibre3">The great thing about the Unity<a id="_idIndexMarker833" class="pcalibre pcalibre1 calibre6"/> Animation System is that you can animate nearly any property of the UI. To create an Animation Clip, simply open the Animation Window (<strong class="bold">Window</strong> | <strong class="bold">Animation</strong> or <em class="italic">Ctrl</em> + <em class="italic">6</em>), and with the UI element you want to animate selected, select <strong class="bold">Create</strong>:</p>
<div><div><img alt="Figure 14.1: The Animation Window" src="img/Figure_14.01_B18327.jpg" class="calibre461"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.1: The Animation Window</p>
<p class="calibre3">Once you do so, you’ll be prompted to save the Animation Clip.</p>
<p class="calibre3">After creating the Animation Clip, you can then add any property to the clip’s timeline by clicking on <strong class="bold">Add Property</strong>:</p>
<div><div><img alt="Figure 14.2: The SliderExampleAnimation timeline" src="img/Figure_14.02_B18327.jpg" class="calibre462"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.2: The SliderExampleAnimation timeline</p>
<p class="calibre3">Doing so will bring up every <a id="_idIndexMarker834" class="pcalibre pcalibre1 calibre6"/>component of the object, as well as a list of all of its children:</p>
<div><div><img alt="Figure 14.3: Adding an Animation property" src="img/Figure_14.03_B18327.jpg" class="calibre463"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.3: Adding an Animation property</p>
<p class="calibre3">You can also view the components and children of each child:</p>
<div><div><img alt="Figure 14.4: Expanding Animation components" src="img/Figure_14.04_B18327.jpg" class="calibre464"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.4: Expanding Animation components</p>
<p class="calibre3">Then, you can view the components and children of those children. You can continue in this manner until you have <a id="_idIndexMarker835" class="pcalibre pcalibre1 calibre6"/>exhausted the list of GameObjects that are nested under the selected GameObject.</p>
<p class="calibre3">If you expand a component of a GameObject or one of its children, you will then note a list of all properties of that component that can be animated. As you will notice in the following screenshot, almost every property on the <strong class="bold">Slider</strong> component can be animated in this way:</p>
<div><div><img alt="Figure 14.5: The Slider component and its Animatable properties" src="img/Figure_14.05_B18327.jpg" class="calibre465"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.5: The Slider component and its Animatable properties</p>
<p class="calibre3">Only properties that have the following data types can be animated with the Animation System:</p>
<ul class="calibre16">
<li class="calibre14"><code>Vector2</code>, <code>Vector3</code>, and <code>Vector4</code></li>
<li class="calibre14"><code>Quaternion</code></li>
<li class="calibre14"><code>bool</code></li>
<li class="calibre14"><code>float</code></li>
<li class="calibre14"><code>Color</code></li>
</ul>
<p class="calibre3">Selecting the plus sign will add the property to the Animation timeline along with two keyframes. You can then change<a id="_idIndexMarker836" class="pcalibre pcalibre1 calibre6"/> the values of each property at the various keyframes.</p>
<p class="calibre3">A <strong class="bold">keyframe</strong> is an important or <em class="italic">key</em> (hence the name) frame within an animation. It represents the start or end point of a transition within an animation.</p>
<div><div><img alt="Figure 14.6: SliderExampleAnimation first keyframe" src="img/Figure_14.06_B18327.jpg" class="calibre466"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.6: SliderExampleAnimation first keyframe</p>
<p class="calibre3">In the preceding screenshot, the values encased in the red boxes represent the value of the property at the particular frame. Boolean values are represented by checkboxes, and float values are represented by numbers. Each type can be edited directly by selecting them.</p>
<p class="calibre3">Unity will fill in the values between the keyframes so that they change (or interpolate) on a curve. You can view the interpolation curve by selecting the <strong class="bold">Curves</strong> tab.</p>
<p class="calibre3">You can watch the changes occur throughout all frames by playing the animation or scrubbing the playhead.</p>
<p class="calibre3">The <strong class="bold">playhead</strong> is the marker that indicates what frame is currently being displayed. “Scrubbing the playhead” means dragging the playhead across the timeline to view changes over individual frames.</p>
<div><div><img alt="Figure 14.7: The Curves version of the timeline" src="img/Figure_14.07_B18327.jpg" class="calibre467"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.7: The Curves version of the timeline</p>
<p class="calibre3">Boolean properties are interpolated on a linear curve. All other properties (since they are a combination of floats) are interpolated along an ease-in-out curve. You can adjust these by adjusting the handles <a id="_idIndexMarker837" class="pcalibre pcalibre1 calibre6"/>of the tangents at the keyframes by right-clicking on the keyframe.</p>
<p class="calibre3">Often, these ease-in-out curves will cause your UI to appear <em class="italic">bouncy</em>, and adjusting the interpolation curve can remove that bounce. For example, animating an object between two points may make the object go past the destination point momentarily due to the ease-in-out nature of the default interpolation curve.</p>
<h2 id="_idParaDest-243" class="calibre7">An<a id="_idTextAnchor413" class="pcalibre pcalibre1 calibre6"/>imation Events</h2>
<p class="calibre3">One of my favorite things <a id="_idIndexMarker838" class="pcalibre pcalibre1 calibre6"/>about Animation Clips is the ability to add Animation Events to frames on the timeline. Animation Events allow you to call functions that exist <a id="_idIndexMarker839" class="pcalibre pcalibre1 calibre6"/>on the GameObject at specified frames. They are represented by white <em class="italic">flags</em> above the timeline, and hovering over them will show the name of the function called by the Animation Event.</p>
<p class="calibre3">An Animation Event can only call a function that exists somewhere on the GameObject the Animation Clip is attached to. The function can be public or private and can also have a parameter. The parameter can be of the following types:</p>
<ul class="calibre16">
<li class="calibre14"><code>float</code></li>
<li class="calibre14"><code>int</code></li>
<li class="calibre14"><code>string</code></li>
<li class="calibre14">An object reference</li>
<li class="calibre14">An <code>AnimationEvent</code> object</li>
</ul>
<p class="calibre3">You can add an Animation Event to the Animation Clip’s timeline by right-clicking on the area above the frame in which you wish to place the Animation Event and clicking on <strong class="bold">Add Animation Event</strong>, or you can<a id="_idIndexMarker840" class="pcalibre pcalibre1 calibre6"/> click the <strong class="bold">Add Event</strong> button. Selecting the <strong class="bold">Add Event</strong> button will add the Animation Event wherever the playhead currently rests.</p>
<div><div><img alt="Figure 14.8: Animation Events" src="img/Figure_14.08_B18327.jpg" class="calibre468"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.8: Animation Events</p>
<p class="calibre3">You can delete the Animation Event by selecting the white flag and clicking on <strong class="bold">Delete</strong>, and you can move it by clicking on it and dragging it.</p>
<p class="calibre3">The appearance of the<a id="_idIndexMarker841" class="pcalibre pcalibre1 calibre6"/> Animation Event’s Inspector depends on whether the Animation Clip is attached to a GameObject and whether the GameObject is currently selected. The two appearances are shown in the following screenshot:</p>
<div><div><img alt="Figure 14.9: The Inspector of the Animation Event" src="img/Figure_14.09_B18327.jpg" class="calibre469"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.9: The Inspector of the Animation Event</p>
<p class="calibre3">If the Animation Clip is attached to a GameObject and the GameObject is selected, a dropdown menu will appear with a list of all available functions. If the selected function has a parameter, then options concerning the parameter will be made available (take a look at the preceding screenshot). Otherwise, the name of the function and the parameters to pass will have to<a id="_idIndexMarker842" class="pcalibre pcalibre1 calibre6"/> be entered manually.</p>
<p class="calibre3">If you play the <code>Chapter14</code> scene with the <code>Slider Animation Example</code> GameObject enabled, you will see an animation with events playing out.</p>
<p class="calibre3">Now that we’ve looked at<a id="_idIndexMarker843" class="pcalibre pcalibre1 calibre6"/> Animation Clips, let’s look at Animation Controllers<a id="_idTextAnchor414" class="pcalibre pcalibre1 calibre6"/>.</p>
<h1 id="_idParaDest-244" class="calibre5"><a id="_idTextAnchor415" class="pcalibre pcalibre1 calibre6"/>Animator Controller</h1>
<p class="calibre3">Whenever an Animation<a id="_idIndexMarker844" class="pcalibre pcalibre1 calibre6"/> Clip is created for an object, an <code>SliderExampleAnimation</code> Animation Clip on the <code>Slider</code> GameObject in the preceding section, an Animator named <code>Slider</code> was created and the Animator component was attached to the <code>Slider</code> GameObject:</p>
<div><div><img alt="Figure 14.10: The Slider Animator’s Inspector" src="img/Figure_14.10_B18327.jpg" class="calibre470"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.10: The Slider Animator’s Inspector</p>
<p class="calibre3">An Animator is needed to play Animation Clips because it determines when Animation Clips are played.</p>
<p class="calibre3">An Animator is a type of <a id="_idIndexMarker845" class="pcalibre pcalibre1 calibre6"/>decision tree known as a <em class="italic">state machine</em>. It holds a collection of <em class="italic">states</em>. States are essentially <em class="italic">statuses at a moment in time</em>. The <em class="italic">current state</em> of a state machine would be a representation of what is happening at this moment. So, for example, if there were a state machine describing my actions and behaviors, my <em class="italic">current state</em> would be <em class="italic">typing on the keyboard</em>. My state machine would have other states that I could eventually transition to, such as <em class="italic">sleeping</em> or <em class="italic">crying about approaching deadlines</em> if certain conditions <a id="_idIndexMarker846" class="pcalibre pcalibre1 calibre6"/>are met.</p>
<p class="calibre3">States in the Animator are represented by<a id="_idIndexMarker847" class="pcalibre pcalibre1 calibre6"/> rectangles called <em class="italic">nodes</em>. States are connected by transitions that are represented by arrow lines. These transitions occur after either a predetermined time or a set of conditions have been met. The current state will have a blue, animated status bar on it telling you the percentage of the state that has been completed. If the current state is waiting for a transition to occur, this status bar may loop or stop in the full position until the conditions of the transition are met:</p>
<div><div><img alt="Figure 14.11: The Slider Animator" src="img/Figure_14.11_B18327.jpg" class="calibre471"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.11: The Slider Animator</p>
<p class="calibre3">The bottom-right corner of the Animator Window displays the name of the current Animator controller as well as its folder location. This can be very helpful when you have many different Animators, as it tells you which Animator you are working with.</p>
<p class="calibre3">States can be empty or<a id="_idIndexMarker848" class="pcalibre pcalibre1 calibre6"/> represent Animation Clips. If a state represents an Animation Clip, it will have an Animation Clip set to its <strong class="bold">Motion</strong> property in its <strong class="bold">Inspector</strong>, as in the following screenshot:</p>
<div><div><img alt="Figure 14.12: The Motion property of an Animation State" src="img/Figure_14.12_B18327.jpg" class="calibre472"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.12: The Motion property of an Animation State</p>
<p class="calibre3">Most states will be colored gray, but those colored otherwise will represent special states. Every Animator will have an <strong class="bold">Entry</strong> node (green), an <strong class="bold">Exit</strong> node (red), and an <strong class="bold">Any State</strong> node (blue) within it. The first state you add to an Animator will be assigned the Default Layer State node (orange). You can change the state of the Default Layer State at any time. Note that Animator Layers are discussed in a later section.</p>
<p class="calibre3">The <strong class="bold">Entry</strong> and <strong class="bold">Exit</strong> nodes essentially work as <em class="italic">gates</em> between state machines. You can have state machines within state machines, and these <em class="italic">gates</em> decide what happens after the state machine is entered and exited, respectively. So, the <strong class="bold">Entry</strong> node represents the instance the state machine starts, and the <strong class="bold">Exit</strong> node represents the instance it stops.</p>
<p class="calibre3">The <strong class="bold">Entry</strong> node always transitions to the Default Layer State, and you cannot define the conditions of the transition, so the transition will always happen automatically and instantly. Therefore, you can think of the Default Layer State as the <em class="italic">first</em> state that will occur when the state machine begins.</p>
<p class="calibre3">The <strong class="bold">Any State</strong> node is an <em class="italic">all-encompassing</em> state. You use this state when you want a transition to happen, regardless <a id="_idIndexMarker849" class="pcalibre pcalibre1 calibre6"/>of the current state. You can only transition away from the <strong class="bold">Any State</strong> node. Continuing with the example of a state machine that describes my behavior, I would have a transition from <strong class="bold">Any State</strong> to the state of <em class="italic">crying about approaching deadlines</em>, because no matter what I am currently doing, I could burst into tears if the condition “deadline is within 24 hours” is met.</p>
<p class="calibre3">As stated before, the Animator will stay in the current state until a specified amount of time has passed or a set of conditions have been met. Selecting a transition arrow will display the conditions of transition:</p>
<div><div><img alt="Figure 14.13: Expanded properties of an Animation" src="img/Figure_14.13_B18327.jpg" class="calibre473"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.13: Expanded properties of an Animation</p>
<p class="calibre3">The transition from the <a id="_idIndexMarker850" class="pcalibre pcalibre1 calibre6"/>preceding screenshot requires both a specified amount of time and a condition. The transition also isn’t instantaneous and takes <code>0.25</code> s to complete.</p>
<p class="calibre3">The <strong class="bold">Conditions</strong> that must be met for a transition to occur are set by the Animator’s <strong class="bold">Parameters</strong>, which can be found and created in the top-left corner of the Animator Window:</p>
<div><div><img alt="Figure 14.14: Adding an Animator Parameter" src="img/Figure_14.14_B18327.jpg" class="calibre474"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.14: Adding an Animator Parameter</p>
<p class="calibre3">The values of these parameters can be set from scripts. There are four types of Parameters: <code>False</code> after it is used by a transition. Trigger Parameters are helpful for creating flood-gate-type <a id="_idIndexMarker851" class="pcalibre pcalibre1 calibre6"/>actions where the animation has to stop and wait before it can proceed to the next state. These are preferred over Bool Parameters in instances where the states and transitions form a loop, because a Bool Parameter would have to be manually reset before the state looped back around.</p>
<p class="calibre3">When you look at the list of <strong class="bold">Parameters</strong>, you can tell which type they are by the value on the right. Float Parameters have decimal numbers, Int Parameters have integers, Bool Parameters have square checkboxes, and Trigger Parameters have circular radio buttons.</p>
<p class="calibre3">Since Animators are state machines, they can be used to accomplish much more than animations. Animators can be used to keep track of complex game logic. For example, I created the following state machine for a match-three RPG to keep track of what was currently happening in the game. Using it to keep track of the current state of the game allowed me to restrict what the player could do based on what was happening in the game.</p>
<p class="calibre3">For example, if the enemy character was attacking, the player would not interact with the pieces on the board:</p>
<div><div><img alt="Figure 14.15: Example of a Animation State Machine used for logic" src="img/Figure_14.15_B18327.jpg" class="calibre475"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.15: Example of a Animation State Machine used for logic</p>
<p class="calibre3">Now that we’ve reviewed <a id="_idIndexMarker852" class="pcalibre pcalibre1 calibre6"/>the properties of the Animator Controller, let’s look at some of its u<a id="_idTextAnchor416" class="pcalibre pcalibre1 calibre6"/>ses.</p>
<h2 id="_idParaDest-245" class="calibre7"><a id="_idTextAnchor417" class="pcalibre pcalibre1 calibre6"/>The Animator of Transition Animations</h2>
<p class="calibre3">In <a href="B18327_09.xhtml#_idTextAnchor213" class="pcalibre pcalibre1 calibre6"><em class="italic">Chapter 9</em></a>, we took a look at Button <a id="_idIndexMarker853" class="pcalibre pcalibre1 calibre6"/>Animation transitions and created a simple animation for a Button. We let the Button component automatically generate the Animator for us, but never looked at the Animator or did anything with it. Now that we’ve discussed Animators, let’s look at the Animator of the <code>Play Button</code> saved in <code>Assets/Animations</code>:</p>
<div><div><img alt="Figure 14.16: The Animator of a Button" src="img/Figure_14.16_B18327.jpg" class="calibre476"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.16: The Animator of a Button</p>
<p class="calibre3">As you can see from the preceding screenshot, the Animator that was automatically generated for us isn’t particularly complicated and its setup is self-explanatory. It contains states to hold the following five Animation Clips: <code>Normal</code>, <code>Highlighted</code>, <code>Pressed</code>, <code>Selected</code>, and <code>Disabled</code>. All of the Animation Clips transition from <code>Any State</code>. Also, there are five<a id="_idIndexMarker854" class="pcalibre pcalibre1 calibre6"/> Trigger Parameters: <code>Normal</code>, <code>Highlighted</code>, <code>Pressed</code>, <code>Selected</code>, and <code>Disabled</code>.</p>
<p class="calibre3">Automatically generating an Animator for any of the UI elements that allow for transition animations will result in the exact same setup. Even though this Animator is preset for you, you are free to adjust it however you see<a id="_idTextAnchor418" class="pcalibre pcalibre1 calibre6"/> fit.</p>
<h2 id="_idParaDest-246" class="calibre7"><a id="_idTextAnchor419" class="pcalibre pcalibre1 calibre6"/>Animator layers</h2>
<p class="calibre3">When using the Animator, if you<a id="_idIndexMarker855" class="pcalibre pcalibre1 calibre6"/> have a state with transitions to multiple nodes, only one transition can occur. For example, in the following screenshot, the <code>ChooseAState</code> state can only transition to one of the other states at once, even if the transition conditions for all are met; this is true regardless of the type of Parameter that you use:</p>
<div><div><img alt="Figure 14.17: A forking animation example in the Chapter14 scene" src="img/Figure_14.17_B18327.jpg" class="calibre477"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.17: A forking animation example in the Chapter14 scene</p>
<p class="calibre3">If you want multiple animations to<a id="_idIndexMarker856" class="pcalibre pcalibre1 calibre6"/> trigger at once, you can use Animation Layers. The following layer setup will have all three states running simultaneously:</p>
<div><div><img alt="Figure 14.18: An Animation Layers Example in the Chapter14 scene" src="img/Figure_14.18_B18327.jpg" class="calibre478"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.18: An Animation Layers Example in the Chapter14 scene</p>
<p class="calibre3">I’ve found that the most common need for something like this is when you have an object made of multiple sprite sheets and you want multiple sprite sheet animations to trigger at the same time and putting them all on the same Animation Clip doesn’t make sense. For example, I’ve worked on a game where a 2D character had multiple interchangeable parts, and each part had its own sprite sheet animation. It was necessary to have the idle animation for each part start all at the same time. Since the parts could be swapped out, there were multiple combinations of parts that could be achieved, and it would not have made sense to make all the different possible idle animation combinations. It also wouldn’t have made sense to give each possible part its own Animator. So, I made a layer for each body part and was able to have the individual sprite animations all play at the same <a id="_idTextAnchor420" class="pcalibre pcalibre1 calibre6"/>time.</p>
<h2 id="_idParaDest-247" class="calibre7"><a id="_idTextAnchor421" class="pcalibre pcalibre1 calibre6"/>Setting Animation Parameters in scripts</h2>
<p class="calibre3">You can set the values of the Animator Parameters via scripts using the <code>SetFloat()</code>, <code>SetInteger()</code>, <code>SetBool()</code>, <code>SetTrigger()</code>, and <code>ResetTrigger()</code> functions of the <code>Animator</code> class. You reference<a id="_idIndexMarker857" class="pcalibre pcalibre1 calibre6"/> the Animator Parameter variables by the string names assigned to them within the Animator.</p>
<p class="calibre3">To set the Animation Parameters, you first get the Animator on which the Parameters were defined; you can do this with either a public Animator variable or using <code>GetComponent&lt;Animator&gt;()</code>. Then, you call the necessary function on the Animator.</p>
<p class="calibre3">Let’s look at an example that would set the following <strong class="bold">Parameters</strong>:</p>
<div><div><img alt="Figure 14.19: Different types of Animation Parameters" src="img/Figure_14.19_B18327.jpg" class="calibre479"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.19: Different types of Animation Parameters</p>
<p class="calibre3">The following script would set the Animator Parameters defined in the previous screenshot:</p>
<pre class="source-code">
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
public class Chapter14Examples : MonoBehaviour
{
    Animator theAnimator;
    void Awake()
    {
        theAnimator = GetComponent&lt;Animator&gt;();
    }
    public void SetAnimatorParameters()
    {
        theAnimator.SetFloat("FloatParameter", 1.0f);
        theAnimator.SetInteger("IntParameter", 1);
        theAnimator.SetBool("BoolParameter", true);
        theAnimator.SetTrigger("TriggerParameter"); // sets to true
        theAnimator.ResetTrigger("TriggerParameter"); // sets to false
    }
    public void ExampleFunction()
    {
        Debug.Log("The Animation Event is not sending an argument");
    }
    public void ExampleParameterFunction(int value)
    {
        Debug.Log("The Animation Event sends the following value: " + value);
    }
}</pre> <p class="calibre3">The benefit of using a <a id="_idIndexMarker858" class="pcalibre pcalibre1 calibre6"/>Trigger is that you usually don’t have to reset it as it instantly resets the moment a transition uses it. However, if you set a Trigger and the transition is never reached, you will need to reset it using <code>ResetTrig<a id="_idTextAnchor422" class="pcalibre pcalibre1 calibre6"/>ger()</code>.</p>
<h2 id="_idParaDest-248" class="calibre7"><a id="_idTextAnchor423" class="pcalibre pcalibre1 calibre6"/>Animator Behaviours</h2>
<p class="calibre3">If you want to write code that fires at specific points within a state, you can use a unique class of scripts known as State <a id="_idIndexMarker859" class="pcalibre pcalibre1 calibre6"/>Machine Behaviours. State Machine Behaviours can be added to any state node you create within the Animator. I specify <em class="italic">you create</em> because you cannot add them to the <strong class="bold">Entry</strong> node, <strong class="bold">Exit</strong> node, or <strong class="bold">Any </strong><strong class="bold">State</strong> node.</p>
<p class="calibre3">You can create a new State Machine Behaviour by selecting a state and clicking on <strong class="bold">Add Behaviour</strong>:</p>
<div><div><img alt="Figure 14.20: How to add a Behaviour to an Animation State" src="img/Figure_14.20_B18327.jpg" class="calibre480"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.20: How to add a Behaviour to an Animation State</p>
<p class="calibre3">All new State Machine<a id="_idIndexMarker860" class="pcalibre pcalibre1 calibre6"/> Behaviours created in this way are saved in the <code>Assets</code> folder.</p>
<p class="calibre3">When you open the script, it will be automatically populated with the following code:</p>
<pre class="source-code">
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
public class ChooseAStateBehaviour : StateMachineBehaviour
{
    // OnStateEnter is called when a transition starts and the state machine starts to evaluate this state
    //override
    public override void OnStateEnter(Animator animator, AnimatorStateInfo stateInfo, int layerIndex)
    {
        // Implement state enter logic here
    }
    // OnStateUpdate is called on each Update frame between OnStateEnter and OnStateExit callbacks
    //override
    public override void OnStateUpdate(Animator animator, AnimatorStateInfo stateInfo, int layerIndex)
    {
        // Implement state update logic here
    }
    // OnStateExit is called when a transition ends and the state machine finishes evaluating this state
    //override
    public override void OnStateExit(Animator animator, AnimatorStateInfo stateInfo, int layerIndex)
    {
        // Implement state exit logic here
    }
    // OnStateMove is called right after Animator.OnAnimatorMove()
    //override
    public override void OnStateMove(Animator animator, AnimatorStateInfo stateInfo, int layerIndex)
    {
        // Implement code that processes and affects root motion
    }
    // OnStateIK is called right after Animator.OnAnimatorIK()
    //override
    public override void OnStateIK(Animator animator, AnimatorStateInfo stateInfo, int layerIndex)
    {
        // Implement code that sets up animation IK (inverse kinematics)
    }
}</pre> <p class="calibre3">Note that this class is derived from <code>StateMachineBehaviour</code> rather than <code>MonoBehaviour</code>, like the scripts we attach to GameObjects.</p>
<p class="calibre3">There are a few functions prewritten in the script for you, along with descriptions of how to use them. Just as <code>Awake()</code>, <code>Start()</code>, and <code>Update()</code> are predefined functions for MonoBehaviour, <code>OnStateEnter()</code>, <code>OnStateUpdate()</code>, <code>OnStateExit()</code>, <code>OnStateIK()</code>, and <code>OnStateMove()</code> are predefined functions that call at specific times. You can delete whichever functions you don’t want to use. You can also write other <a id="_idIndexMarker861" class="pcalibre pcalibre1 calibre6"/>functions within this script, and they are not restricted to these predefined ones.</p>
<p class="calibre3">These functions can do whatever you want them to do, even set the Animator Parameters of your Animator.</p>
<p class="calibre3">I find State Machine Behaviours to be incredibly helpful because I use state machines extensively to control the logic of my games. Earlier, in this section, I showed you a state machine I created for a match-three RPG. I used multiple State Machine Behaviours to let my other scripts know when the states had changed, call functions from other scripts at specified times, and so on.</p>
<p class="calibre3">Now that we’ve reviewed using Animation clips and Animator Controllers, let’s look at some examples of how to<a id="_idIndexMarker862" class="pcalibre pcalibre1 calibre6"/> implement them in our<a id="_idTextAnchor424" class="pcalibre pcalibre1 calibre6"/> project.</p>
<p class="calibre3">Examples</p>
<p class="calibre3">The main focus of this chapter is to provide examples of how to create common UI animations and effects, so let’s get to it. In these examples, I will show you a basic re-usable animation for fading UI Panels in and out, as well as a more complex animation of a loot box dependent on player inte<a id="_idTextAnchor425" class="pcalibre pcalibre1 calibre6"/>raction.</p>
<h2 id="_idParaDest-249" class="calibre7"><a id="_idTextAnchor426" class="pcalibre pcalibre1 calibre6"/>Animating pop-up windows to fade in and out</h2>
<p class="calibre3">With our first example, we<a id="_idIndexMarker863" class="pcalibre pcalibre1 calibre6"/> will continue to work on our main scene.</p>
<p class="calibre3">Currently, we have a <code>Pause Panel</code> and <code>Inventory Panel</code> that instantly appear when the <em class="italic">P</em> or <em class="italic">I</em> key is pressed. That’s not terribly interesting, so let’s add some animations to have the Panels <em class="italic">pop</em> in and out with fade and scale animations.</p>
<p class="calibre3">It can get rather tedious having to expand all of the parents to see their children every time you go to a new scene. A shortcut to open all parents is to select everything in the Hierarchy and then press the right arrow key on the keyboard. You can do this multiple times if you have multiple nestings. The left arrow key will collapse the parents.</p>
<p class="calibre3">Our workflow to set up these animations and their functionality will be to create Animation Clips, set up our Animator, and then write code that sets the Animator’s parameters at the appropriate times. To make the steps easier to digest, I’ve broken them into sections. The first section covers all of the steps involved with setting up the Animation Clips and Animator and the second section covers the sets involved with wri<a id="_idTextAnchor427" class="pcalibre pcalibre1 calibre6"/>ting code.</p>
<h3 class="calibre9">Setting up the animations</h3>
<p class="calibre3">To create a pop in and out animation on <code>Pause Panel</code> and <code>Inventory Panel</code>, perform the<a id="_idIndexMarker864" class="pcalibre pcalibre1 calibre6"/> following steps:</p>
<ol class="calibre13">
<li class="calibre14">We’ll start by adding an Animation Clip to <code>Pause Panel</code> that will cause it to scale and fade in. Open the Animation Window and select <code>Pause Panel</code> from the Hierarchy. Select <code>Assets/Animation</code> folder and name it <code>FadeAndScale</code>.</li>
<li class="calibre14">We want to control four properties of this Panel: its scale, its alpha value, its ability to be interacted with, and its raycast blocking. Let’s start with scale. We can adjust this property from the Rect Transform component. Select <strong class="bold">Add Property</strong> and click <a id="_idIndexMarker865" class="pcalibre pcalibre1 calibre6"/>on the plus sign next to <strong class="bold">Scale</strong> under <strong class="bold">Rect Transform</strong>, as follows:</li>
</ol>
<div><div><img alt="Figure 14.21: Adding the Scale property" src="img/Figure_14.21_B18327.jpg" class="calibre481"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.21: Adding the Scale property</p>
<ol class="calibre13">
<li value="3" class="calibre14">Two keyframes are initialized for the <strong class="bold">Scale</strong> property at <strong class="bold">0:00</strong> and <strong class="bold">1:00</strong>. This means that the animation will last one second, which is a bit long for a pop-in animation. Select the keyframe at <strong class="bold">1:00</strong> and drag it to <strong class="bold">0:30</strong> to make the animation half a second long:</li>
</ol>
<div><div><img alt="Figure 14.22: Adjusting the length of the animation" src="img/Figure_14.22_B18327.jpg" class="calibre482"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.22: Adjusting the length of the animation</p>
<ol class="calibre13">
<li value="4" class="calibre14">We want the Panel to start off small and then get big. To achieve this, we will need to adjust the <em class="italic">x</em> and <em class="italic">y</em> scales. Expand the <code>1</code> at both keyframes. Since we want the scale to start small and then enlarge to its normal size, we want it to scale from <code>0</code> to <code>1</code>. We<a id="_idIndexMarker866" class="pcalibre pcalibre1 calibre6"/> only need to adjust the <em class="italic">x</em> and <em class="italic">y</em> scales since the <em class="italic">z</em> scale doesn’t really affect a 2D object. So, at keyframe <code>0</code> by typing <code>0</code> in their property boxes, as follows:
<div><div><img alt="Figure 14.23: Adjusting the Scale properties" src="img/Figure_14.23_B18327.jpg" class="calibre483"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.23: Adjusting the Scale properties</p>
<p class="calibre3">If you play the animation, you’ll note that <code>Pause Panel</code> is quickly scaling in. Since parent/child relationships scale children with their parents, we don’t have to animate the scale of all the <code>Pause Panel</code> children separately.</p></li>
</ol>
<ol class="calibre13">
<li value="5" class="calibre14">Now, let’s control the alpha of the Panel to fade it in. We don’t want to animate the alpha on the <code>Pause Panel</code>. Doing so would only affect the alpha of the Panel’s background Image and would not affect the children. Instead, we want to animate the alpha value on the <code>Pause Panel</code> and all its children work in unison. Remember that this was the whole reason we used a Canvas Group component to begin with. Let’s select <strong class="bold">Add Property</strong> | <strong class="bold">Canvas Group</strong> | <strong class="bold">Alpha</strong>:</li>
</ol>
<div><div><img alt="Figure 14.24: Adding the Alpha property" src="img/Figure_14.24_B18327.jpg" class="calibre484"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.24: Adding the Alpha property</p>
<ol class="calibre13">
<li value="6" class="calibre14">To fade in, the Panel should start completely transparent and end completely opaque. Both keyframes already have the <code>1</code>, so change the <code>0</code> at the first keyframe. Playing the animation (or <a id="_idIndexMarker867" class="pcalibre pcalibre1 calibre6"/>scrubbing the playhead) will show the Panel and all of its children fading in.</li>
<li class="calibre14">We will need to animate whether or not the Panel can be interacted with. We don’t want the player to be able to interact with the dropdown menu or mute buttons when the Panel is still popping in. This too is controlled by the Canvas Group component—select <strong class="bold">Add Property</strong> | <strong class="bold">Canvas Group</strong> | <strong class="bold">Interactable</strong>.</li>
<li class="calibre14">The <code>Pause Panel</code> and its children should be interactable only after it has fully popped into the scene. So, deselect the checkbox next to <strong class="bold">CanvasGroup.Interactable</strong> at the first keyframe to make the Canvas Group animate from interactable to not interactable. When you scrub the playhead, you’ll see that the property does not turn back on until the very last frame.</li>
<li class="calibre14">The last item we will need to animate is its raycast blocking. Select <code>false</code> to <code>true</code> as you did with the <code>FadeAndScale</code> Animation Clip’s timeline should now appear, as follows:</li>
</ol>
<div><div><img alt="Figure 14.25: The Timeline of the FadeAndScale Animation Clip" src="img/Figure_14.25_B18327.jpg" class="calibre485"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.25: The Timeline of the FadeAndScale Animation Clip</p>
<ol class="calibre13">
<li value="10" class="calibre14">Now that we have our <a id="_idIndexMarker868" class="pcalibre pcalibre1 calibre6"/>Animation Clip set up, we can start working inside the Animator. When we created the <code>FadeAndScale</code> Animation Clip, an Animator named <code>Pause Panel</code> was automatically created. An Animator component was also added to the <code>Pause Panel</code> GameObject, with the <code>Pause Panel</code> Animator assigned to it.<p class="calibre3">With <code>Pause Panel</code> selected, open the Animator Window. You should see something similar to the following:</p>
<div><div><img alt="Figure 14.26: The Animator of Pause Panel" src="img/Figure_14.26_B18327.jpg" class="calibre486"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.26: The Animator of Pause Panel</p>
<p class="calibre3">You will see a state named <code>FadeAndScale</code>. This state uses the <code>FadeAndScale</code> Animation Clip as its <strong class="bold">Motion</strong>, which you can view in its Inspector.</p></li>
</ol>
<ol class="calibre13">
<li value="11" class="calibre14">Currently, since the <code>FadeAndScale</code> state is connected to the <code>FadeAndScale</code> animation will play instantly. It will also play on a loop. That’s not at all what we want, obviously. Let’s stop it from playing when the game starts by creating an empty state as the Layer Default State. Right-click anywhere within the Animator and select <strong class="bold">Create State</strong> | <strong class="bold">Empty</strong>:
<div><div><img alt="Figure 14.27: Creating an Empty State" src="img/Figure_14.27_B18327.jpg" class="calibre487"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.27: Creating an Empty State</p>
<p class="calibre3">This will add a gray-colored <a id="_idIndexMarker870" class="pcalibre pcalibre1 calibre6"/>state named <code>New State</code> to the Animator.</p></li>
</ol>
<ol class="calibre13">
<li value="12" class="calibre14">Rename <code>New State</code> to <code>Empty State</code> by changing its name in its Inspector.</li>
<li class="calibre14">Set <code>Empty State</code> to the Layer Default State by right-clicking on it and selecting <strong class="bold">Set as Layer </strong><strong class="bold">Default State</strong>:
<div><div><img alt="Figure 14.28: Setting a state as the Layer Default" src="img/Figure_14.28_B18327.jpg" class="calibre488"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.28: Setting a state as the Layer Default</p>
<p class="calibre3">It will now be connected to <code>FadeAndScale</code> will also now no longer be the Layer Default State and will not have any transitions connected to it:</p>
<div><div><img alt="Figure 14.29: Empty State set as the Layer Default" src="img/Figure_14.29_B18327.jpg" class="calibre489"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.29: Empty State set as the Layer Default</p>
<p class="calibre3">We used an empty state <a id="_idIndexMarker871" class="pcalibre pcalibre1 calibre6"/>as our Layer Default State because we want the Panel to do nothing, while it waits for us to tell it to start animating.</p></li>
</ol>
<ol class="calibre13">
<li value="14" class="calibre14">Rearrange the items to a more viewable layout. I personally like the following layout for this Animator:</li>
</ol>
<div><div><img alt="Figure 14.30: Rearranging the States" src="img/Figure_14.30_B18327.jpg" class="calibre490"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.30: Rearranging the States</p>
<ol class="calibre13">
<li value="15" class="calibre14">The <code>FadeAndScale</code> Animation Clip now no longer instantly plays when the game starts. It is still set to have its animation loop, however. To fix this, select the <code>FadeAndScale</code> Animation Clip from your <strong class="bold">Project</strong> folder view. This will bring up its Inspector.<p class="calibre3">Deselect the <strong class="bold">Loop Time</strong> property <a id="_idIndexMarker872" class="pcalibre pcalibre1 calibre6"/>to disable looping on the animation:</p></li>
</ol>
<div><div><img alt="Figure 14.31: Deselecting Loop Time" src="img/Figure_14.31_B18327.jpg" class="calibre491"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.31: Deselecting Loop Time</p>
<ol class="calibre13">
<li value="16" class="calibre14">We want the <code>Pause Panel</code> to be able to fade in and out on command, but we don’t have an Animation Clip for fading out, only one for fading in. We actually don’t need to create a whole Animation Clip to achieve this motion. We can simply play the <code>FadeAndScale</code> Animation Clip backward. Duplicate the <code>FadeAndScale</code> state by selecting it and pressing <em class="italic">Ctrl</em> + <em class="italic">D</em>. This will give you a new state named <code>FadeAndScale 0</code> that has the <code>FadeAndScale</code> Animation Clip set as its <strong class="bold">Motion</strong>:</li>
</ol>
<div><div><img alt="Figure 14.32: Duplicating a State" src="img/Figure_14.32_B18327.jpg" class="calibre492"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.32: Duplicating a State</p>
<ol class="calibre13">
<li value="17" class="calibre14">Rename the <code>FadeAndScale</code> state to <code>FadeAndScaleIn</code> and the <code>FadeAndScale 0</code> state to <code>FadeAndScaleOut</code>.</li>
<li class="calibre14">To set the <code>FadeAndScaleOut</code> state to play the <code>FadeAndScale</code> Animation Clip backward, we simply have to<a id="_idIndexMarker873" class="pcalibre pcalibre1 calibre6"/> change its <code>-1</code> in its Inspector:</li>
</ol>
<div><div><img alt="Figure 14.33: Setting an animation to play in reverse" src="img/Figure_14.33_B18327.jpg" class="calibre493"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.33: Setting an animation to play in reverse</p>
<ol class="calibre13">
<li value="19" class="calibre14">Now that we have all of our states set up properly, we can create the transitions between them. Start by creating two Trigger Parameters named <code>FadeIn</code> and <code>FadeOut</code>:
<div><div><img alt="Figure 14.34: The Animator Parameters" src="img/Figure_14.34_B18327.jpg" class="calibre494"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.34: The Animator Parameters</p>
<p class="calibre3">We are using Trigger Parameters here because we want these values to instantly reset after we’ve used them. That way, we can create an animation cycle without having to<a id="_idIndexMarker874" class="pcalibre pcalibre1 calibre6"/> write code that resets the parameter values.</p></li>
</ol>
<ol class="calibre13">
<li value="20" class="calibre14">You create transitions between states by right-clicking on the first state, selecting <strong class="bold">Make Transition</strong>, and then clicking on the second state:
<div><div><img alt="Figure 14.35: Making transitions" src="img/Figure_14.35_B18327.jpg" class="calibre495"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.35: Making transitions</p>
<p class="calibre3">Create transitions between the states in the following manner:</p>
<div><div><img alt="Figure 14.36: The final state transition layout" src="img/Figure_14.36_B18327.jpg" class="calibre496"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.36: The final state transition layout</p>
<p class="calibre3">This transition flow will allow the Panel to transition from no animation to the <code>FadeAndScale</code> Animation Clip, then to the reversed <code>FadeAndScale</code> Animation Clip, and back and forth between the two.</p>
</li>
</ol><ol class="calibre13">
<li value="21" class="calibre14">If you play the game, <code>Pause Panel</code> will instantly go from the <code>Empty State</code> to the <code>FadeAndScaleIn</code> state and then to the <code>FadeAndScaleOut</code> state, and back and forth between the two indefinitely. This is because transitions are automatically set to occur after an animation is complete. To stop this, you have to tell<a id="_idIndexMarker875" class="pcalibre pcalibre1 calibre6"/> the transitions to only occur after a parameter has been set. Select the transition between the <code>Empty State</code> and the <code>FadeAndScaleIn</code> state. Select the plus sign in the <code>FadeIn</code> Trigger. Since we don’t want timing to be a factor in our transition, deselect <strong class="bold">Has </strong><strong class="bold">Exit Time</strong>:</li>
</ol>
<div><div><img alt="Figure 14.37: The transition properties" src="img/Figure_14.37_B18327.jpg" class="calibre497"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.37: The transition properties</p>
<ol class="calibre13">
<li value="22" class="calibre14">Complete the same steps for the transitions between the <code>FadeAndScaleIn</code> and <code>FadeAndScaleOut</code> States. Set the <code>FadeAndScaleIn</code> State to the <code>FadeAndScaleOut</code> State to the <code>FadeAndScaleOut</code> state to <code>FadeAndScaleIn</code> State to the <code>0</code> to ensure an instant transition:</li>
</ol>
<div><div><img alt="Figure 14.38: How to set up the transitions of the Pause Panel" src="img/Figure_14.38_B18327.jpg" class="calibre498"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.38: How to set up the transitions of the Pause Panel</p>
<ol class="calibre13">
<li value="23" class="calibre14">If you play the game now, you’ll <a id="_idIndexMarker877" class="pcalibre pcalibre1 calibre6"/>note that the <code>Pause Panel</code> is visible when the game starts. This is because our animation states supersede the code we wrote in <code>ShowHidePanels.cs</code> that made the <code>Pause Panel</code> invisible at the start of the scene. We’ll deal with our broken code later, but for now, make the <code>Pause Panel</code> invisible at start by setting its <strong class="bold">Canvas Group</strong> component to have the following values:
<div><div><img alt="Figure 14.39: The properties of the Canvas Group" src="img/Figure_14.39_B18327.jpg" class="calibre499"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.39: The properties of the Canvas Group</p>
<p class="calibre3">Now when you play the game, the <code>Pause Panel</code> will not appear at the start.</p></li>
</ol>
<ol class="calibre13">
<li value="24" class="calibre14">We’ve completed setting up the animations for the <code>Pause Panel</code>, but before you proceed to the <code>Inventory Panel</code>, check whether the animations are working correctly. To do so, arrange your windows so that your Game view and Animator Window are both visible:
<div><div><img alt="Figure 14.40: Playing the Empty State" src="img/Figure_14.40_B18327.jpg" class="calibre500"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.40: Playing the Empty State</p>
<p class="calibre3">You’ll see the progress bar on the current state of <code>Pause Panel</code> running. To force the transitions, click <a id="_idIndexMarker878" class="pcalibre pcalibre1 calibre6"/>on the circles next to the appropriate Trigger parameters.</p></li>
</ol>
<ol class="calibre13">
<li value="25" class="calibre14">If your animations are working the way they should, you can now set up the animations on the <code>Inventory Panel</code>. You may be thinking, “Ugh, now I have to do all of this again for the <code>Inventory Panel</code>?!” However, worry not, you don’t have to do it again, because you can reuse the Animator for the <code>Pause Panel</code> on the <code>Inventory Panel</code>. All of the properties we changed on the <code>Pause Panel</code> in the <code>FadeAndScale</code> Animation Clip also exist on the <code>Inventory Panel</code>. So, to give the same set of animations and controls to the <code>Inventory Panel</code>, we can simply attach the Animator we created to <code>Inventory Panel</code>.<p class="calibre3">Since we will be using the Animator we created on two different objects, it is a good idea to rename it. Change the name from <code>Pause Panel</code> to <code>PopUpPanels</code>. Now, drag it onto the <code>Inventory Panel</code>.</p></li>
<li class="calibre14">Just as we had to change the properties of the Canvas Group on <code>Pause Panel</code> to stop it from appearing when the scene starts, we also have to change the properties on the <code>Inventory Panel</code>. Set the properties as they appear in <em class="italic">Figure 14</em><em class="italic">.39</em>.</li>
</ol>
<p class="calibre3">Now that we are done setting up our animations for our two Panels, we can begin writing code that will trigger<a id="_idIndexMarker879" class="pcalibre pcalibre1 calibre6"/> the animations when the <em class="italic">P</em> and <em class="italic">I</em> keys are hit to bring up the P<a id="_idTextAnchor428" class="pcalibre pcalibre1 calibre6"/>anels.</p>
<h3 class="calibre9">Setting the Animator’s Parameters with code</h3>
<p class="calibre3">We have a script named <code>ShowHidePanels.cs</code> attached to the <code>Main Camera</code> that would bring the <code>Pause Panel</code> and <code>Inventory Panel</code> up when the <em class="italic">P</em> and <em class="italic">I</em> keys, respectively, are pressed. Sadly, it no longer functions, since the animations now supersede the properties of the<a id="_idIndexMarker880" class="pcalibre pcalibre1 calibre6"/> Canvas Groups we set within it. We can reuse the logic but will have to do a bit of work to get our Panels popping up again.</p>
<p class="calibre3">The changes that we will make to <code>ShowHidePanels.cs</code> will cause the Panels in preceding chapter scenes to stop appearing. If you plan on accessing the previous chapter scenes, save a secondary copy of this script as it is now so that you can access it later.</p>
<p class="calibre3">To trigger the animations on the <code>Pause Panel</code> and <code>Inventory Panel</code> with code, complete the following steps:</p>
<ol class="calibre13">
<li class="calibre14">Open the <code>ShowHidePanels.cs</code> script. Comment out all the code in the <code>Start()</code> and <code>Update()</code> methods that use <code>TogglePanel()</code>. After you comment out those lines, you should see the following:<pre class="source-code">
void Start()
{
    // Initialize Panels on Start
    TogglePanel(inventoryPanel, inventoryUp);
    TogglePanel(pausePanel, pauseUp);
}
void Update()
{
    // Handle inventory Panel toggle
    if (Input.GetKeyDown(KeyCode.I) &amp;&amp; !pauseUp)
    {
        inventoryUp = !inventoryUp;
        TogglePanel(inventoryPanel, inventoryUp);
    }
    // Handle pause Panel toggle
    if (Input.GetButtonDown("Pause"))
    {
        pauseUp = !pauseUp;
        TogglePanel(pausePanel, pauseUp);
        Time.timeScale = pauseUp ? 0 : 1; // Pause/unpause game by setting time scale
    }
}</pre></li> <li class="calibre14">Instead of referencing the <code>Pause Panel</code> and <code>Inventory Panel</code> with their Canvas Group components, we’ll now reference them with their Animator components. Create the following two variable declarations at the top of the class:<pre class="source-code">
public Animator inventoryPanelAnim;
public Animator pausePanelAnim;</pre></li> <li class="calibre14">Now let’s create a new <a id="_idIndexMarker881" class="pcalibre pcalibre1 calibre6"/>method called <code>FadePanel()</code> that accepts <code>Animator</code> and <code>bool</code> parameters:<pre class="source-code">
public void FadePanel(Animator anim, bool show)
{
    if (show)
    {
        anim.SetTrigger("FadeIn");
    }
    else
    {
        anim.SetTrigger("FadeOut");
    }
}</pre></li> <li class="calibre14">Update the <code>Update()</code> method to now call the new <code>FadePanel()</code> method where the <code>TogglePanel()</code> method was once called. The bolded text in the following code signifies the added code:<pre class="source-code">
void Update()
{
    // inventory Panel
    if (Input.GetKeyDown(KeyCode.I) &amp;&amp; !pauseUp)
    {
        inventoryUp = !inventoryUp;
        //TogglePanel(inventoryPanel, inventoryUp);
        FadePanel(inventoryPanelAnimator, inventoryUp);
    }
    // pause Panel
    if (Input.GetButtonDown("Pause"))
    {
        pauseUp = !pauseUp;
        //TogglePanel(pausePanel, pauseUp);
        FadePanel(pausePanelAnimator, pauseUp);
        Time.timeScale = Convert.ToInt32(pauseUp);
    }
}</pre><p class="calibre3">That’s all we have to do to the code.</p></li> <li class="calibre14">Drag the <code>Inventory Panel</code> and the <code>Pause Panel</code> into their appropriate slots on the <strong class="bold">Show Hide </strong><strong class="bold">Panels</strong> component:</li>
</ol>
<div><div><img alt="Figure 14.41: The properties of the Show Hide Panels component" src="img/Figure_14.41_B18327.jpg" class="calibre501"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.41: The properties of the Show Hide Panels component</p>
<ol class="calibre13">
<li value="6" class="calibre14">Play the game and watch it kind of work. <code>Inventory Panel</code> should appear and disappear as necessary, but the <code>Pause Panel</code> won’t fade out the way it is supposed to. This is because the following line of code stops all animations from happening that depend <a id="_idIndexMarker882" class="pcalibre pcalibre1 calibre6"/>on time scale:<pre class="source-code">
Time.timeScale = Convert.ToInt32(pauseUp);</pre><p class="calibre3">That line of code was used to effectively pause the game. However, that means it’s pausing our <code>Pause Panel</code> pop-up animation. Don’t worry, you can still use this simple pause code and run animations when the game is paused. All you have to do is tell the Animator on the <code>Pause Panel</code> that it can still function when the time scale is set to <code>0</code>. You do this by changing the <strong class="bold">Update Mode</strong> on the Animator component from <strong class="bold">Normal</strong> to <strong class="bold">Unscaled Time</strong>:</p></li> </ol>
<div><div><img alt="Figure 14.42: Setting Update Mode to Unscaled Time" src="img/Figure_14.42_B18327.jpg" class="calibre502"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.42: Setting Update Mode to Unscaled Time</p>
<ol class="calibre13">
<li value="7" class="calibre14">Set the <code>Inventory Panel</code>’s Animator component as well.</li>
</ol>
<p class="calibre3">Play the game, and you should have<a id="_idIndexMarker883" class="pcalibre pcalibre1 calibre6"/> smoothly animating Pause and Inventory Panels. We can now move on to a more complex an<a id="_idTextAnchor429" class="pcalibre pcalibre1 calibre6"/><a id="_idTextAnchor430" class="pcalibre pcalibre1 calibre6"/>imation.</p>
<h2 id="_idParaDest-250" class="calibre7"><a id="_idTextAnchor431" class="pcalibre pcalibre1 calibre6"/>Animating a complex loot box</h2>
<p class="calibre3">For this example, we’ll work with a new scene. The animation we will create is a bit complicated—a chest will fly into the <a id="_idIndexMarker884" class="pcalibre pcalibre1 calibre6"/>scene and then wait for the player to open it. Once the player opens it, the chest will animate open with a particle system that pops in front of it. Then, three collectibles will fly out in sequence. Each collectible will have its own <em class="italic">shiny</em> animation that begins to play.</p>
<p class="calibre3">The following figure is a storyboard of sorts that shows a few keyframes of the animation playing out:</p>
<div><div><img alt="Figure 14.43: The final version of the animation from this example" src="img/Figure_14.43_B18327.jpg" class="calibre503"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.43: The final version of the animation from this example</p>
<p class="calibre3">In this chapter, we will cover all items except for the Particle System, which we will cover in the next chapter.</p>
<p class="callout-heading">Note</p>
<p class="callout">The chest sprite sheet was obtained from <a href="https://bayat.itch.io/platform-game-assets" class="pcalibre pcalibre1 calibre6">https://bayat.itch.io/platform-game-assets</a> and the item sprite sheets were obtained from <a href="https://opengameart.org/content/shining-coin-shining-health-shining-power-up-sprite-sheets" class="pcalibre pcalibre1 calibre6">https://opengameart.org/content/shining-coin-shining-health-shining-power-up-sprite-sheets</a>.</p>
<p class="calibre3">This example has a lot going on<a id="_idIndexMarker885" class="pcalibre pcalibre1 calibre6"/> with it. It is not particularly complicated to build out, but providing the steps to build it entirely from scratch would require too many steps. That would go beyond the scope of this book; but at this point in the book, you can hopefully look at a scene that’s already been built out and understand how it was achieved. Therefore, we will start this example with a package file that has all the items placed in the scene, some of the animations already created, and all the new sprite sheets included.</p>
<p class="calibre3">Before you begin, import the <code>Chapter 14</code><code> - Examples - LootBox - Start.unitypackage</code> asset package.</p>
<p class="calibre3">If you’d like to view the completed example, view the package labeled <code>Chapter 14</code><code> - Examples - LootBox - </code><code>End.unitypackage</code>.</p>
<p class="callout-heading">Note</p>
<p class="callout">Unity Layers do not save in Unity asset packages. The example will describe creating a Layer named <strong class="source-inline1">UI Particles</strong> and having the cameras ignore or include the Layer, but this is not displayed in the provided package.</p>
<p class="calibre3">To make the example<a id="_idIndexMarker886" class="pcalibre pcalibre1 calibre6"/> easier to absorb, I have broken the steps into three distinct sections. To complete this example, we will perform the following functions:</p>
<ol class="calibre13">
<li class="calibre14">Set up the various animation clips for the individual items.</li>
<li class="calibre14">Tie all the animations together and make sure that they are timed appropriately using a state machine, aka Animator.</li>
<li class="calibre14">Create the Particle System that displays when the chest opens and make sure that it displays properly within the UI (which will be completed in the following<a id="_idTextAnchor432" class="pcalibre pcalibre1 calibre6"/> chapter).</li>
</ol>
<h3 class="calibre9"> Setting up the animations</h3>
<p class="calibre3">Let’s start this section by creating the animations for each of the objects within the scene. To create all the <a id="_idIndexMarker887" class="pcalibre pcalibre1 calibre6"/>animations for this scene, complete the following steps:</p>
<ol class="calibre13">
<li class="calibre14">If you have not done so already, import <code>Chapter 14</code><code> - Examples - LootBox - Start.unitypackage</code>. You should see a scene that has two Canvases—one with a button and a background image and another with a chest, items, and a button, as shown in the following screenshot:
<div><div><img alt="Figure 14.44: The scene layout of the package" src="img/Figure_14.44_B18327.jpg" class="calibre504"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.44: The scene layout of the package</p>
<p class="calibre3">After importing the package, you will also note that there are a few animation clips and controllers provided in the <code>Assets</code> folder.</p></li>
</ol>
<ol class="calibre13">
<li value="2" class="calibre14">The <code>Chest</code> object needs <a id="_idIndexMarker888" class="pcalibre pcalibre1 calibre6"/>two animations, one of it <em class="italic">flying in from the side of the screen</em> and one of its <em class="italic">sprite sheet opening</em>. Let’s make the flying in animation first. Select the <code>Chest</code> object in the Hierarchy and then select <code>ChestFlyingIn.anim</code> and save it in the <code>Assets/Animations/LootBox/Clips</code> folder.</li>
<li class="calibre14">A new Animation Controller named <code>Chest.controller</code> was automatically created in the <code>Assets/Animations/LootBox/Clips</code> folder. Move it to the <code>Assets/Animations/LootBox/Controllers</code> folder.</li>
<li class="calibre14">Within the Animation window, select <code>Chest</code> within the Canvas:</li>
</ol>
<div><div><img alt="Figure 14.45: The ChestFlyingIn animation" src="img/Figure_14.45_B18327.jpg" class="calibre505"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.45: The ChestFlyingIn animation</p>
<ol class="calibre13">
<li value="5" class="calibre14">Currently, the animation is <a id="_idIndexMarker889" class="pcalibre pcalibre1 calibre6"/>one second long, which is a bit longer than we want. Move the second keyframe to the <code>0:30</code> mark so that it will be half a second long.</li>
<li class="calibre14">We will be moving objects in the scene at various keyframes and will want them to be saved in the animation. So, to have the animation record any of the changes you make in the scene, select the record button in the Animation window.</li>
<li class="calibre14">The position of the chest in the scene right now is where we want it to be at the end of the fly-in animation, so we will not affect the position at the second keyframe. However, we want it to start off screen, so with the animation playhead on the first frame, use the <code>Chest</code>’s position at the first frame. This is indicated by the red tint on the Rect Transform.
<div><div><img alt="Figure 14.46: Moving the chest and recording the properties" src="img/Figure_14.46_B18327.jpg" class="calibre506"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.46: Moving the chest and recording the properties</p>
<p class="calibre3">If you scrub the playhead, you will see the chest move from left to right.</p></li>
</ol>
<ol class="calibre13">
<li value="8" class="calibre14">Now, let’s make the chest<a id="_idIndexMarker890" class="pcalibre pcalibre1 calibre6"/> fly in at an arc instead of a straight line. We’ll do this with Animation Curves. Select the <strong class="bold">Curves</strong> tab, as follows:
<div><div><img alt="Figure 14.47: Selecting the Curves menu" src="img/Figure_14.47_B18327.jpg" class="calibre507"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.47: Selecting the Curves menu</p>
<p class="calibre3">The green line represents the <em class="italic">y</em> property <a id="_idIndexMarker891" class="pcalibre pcalibre1 calibre6"/>of the anchored position. Select the <strong class="bold">Anchored Postion.y</strong> property to focus on it.</p></li>
</ol>
<ol class="calibre13">
<li value="9" class="calibre14">Select the first and second key frame anchors to affect their handles. Move their handles until the green curve looks more like an arc:
<div><div><img alt="Figure 14.48: Adjusting the anchors of the curve" src="img/Figure_14.48_B18327.jpg" class="calibre508"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.48: Adjusting the anchors of the curve</p>
<p class="calibre3">Now, when you play the animation, you will see the chest move in an arcing path.</p></li>
</ol>
<ol class="calibre13">
<li value="10" class="calibre14">Let’s have the chest fade in as it flies<a id="_idIndexMarker892" class="pcalibre pcalibre1 calibre6"/> by adding a <code>color</code> property to the animation. Return to the <code>0</code> to make the chest invisible on the first frame:</li>
</ol>
<div><div><img alt="Figure 14.49: The properties of the first frame of the ChestFlyingIn animation" src="img/Figure_14.49_B18327.jpg" class="calibre509"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.49: The properties of the first frame of the ChestFlyingIn animation</p>
<ol class="calibre13">
<li value="11" class="calibre14">Whenever a new animation is created, it is automatically set to loop. We don’t want this animation to play on a<a id="_idIndexMarker893" class="pcalibre pcalibre1 calibre6"/> loop, so select the <code>ChestFlyingIn</code> Animation Clip from the <strong class="bold">Project</strong> view to see its <strong class="bold">Inspector</strong> properties. Deselect the <strong class="bold">Loop </strong><strong class="bold">Time</strong> checkbox.</li>
<li class="calibre14">We don’t want the <code>ChestFlyingIn</code> Animation Clip to automatically play when the scene starts. Since this was the first Animation Clip created for the <code>Chest</code>, it will be set to the Animator default state. With the <code>Chest</code> selected, open the Animator Window.</li>
<li class="calibre14">Create a new default state by right-clicking within the Animator Window and selecting <code>Empty State</code> and set it as the default state by right-clicking on it and selecting <strong class="bold">Set as Layer Default State</strong>. We will do more with the Chest’s Animator later, but for now, this is all we are going to do.</li>
</ol>
<div><div><img alt="Figure 14.50: The Animator of the Chest" src="img/Figure_14.50_B18327.jpg" class="calibre510"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.50: The Animator of the Chest</p>
<ol class="calibre13">
<li value="14" class="calibre14">Now, let’s set up<a id="_idIndexMarker894" class="pcalibre pcalibre1 calibre6"/> the chest opening animation. With <code>Chest</code> still selected, in the Animation window, select <strong class="bold">Create New Clip…</strong> from the Animation Clip dropdown list:
<div><div><img alt="Figure 14.51: Creating a new clip" src="img/Figure_14.51_B18327.jpg" class="calibre511"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.51: Creating a new clip</p>
<p class="calibre3">Name the new Animation Clip <code>ChestOpening.anim</code> and save it in the <code>Assets/Animations/LootBox/Clips</code> folder.</p></li>
</ol>
<ol class="calibre13">
<li value="15" class="calibre14">This Animation Clip will contain all the sprites from the sprite sheet. From the Project view, drag and drop all the sub-sprites into the Animation timeline. A new property for <strong class="bold">Image.Sprite</strong> will automatically be added, and all the sub-sprites will be added to the timeline in a sequence:</li>
</ol>
<div><div><img alt="Figure 14.52: The Chest sprite sheet animation" src="img/Figure_14.52_B18327.jpg" class="calibre512"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.52: The Chest sprite sheet animation</p>
<ol class="calibre13">
<li value="16" class="calibre14">Right now, the animation is way too fast. It is running at 60 frames per second, and there are only 6 frames. We need to change the frame rate. First, we must enable the Sample Rate<a id="_idIndexMarker895" class="pcalibre pcalibre1 calibre6"/> option in the Animation Window. Select the three dots on the timeline and then select <strong class="bold">Show </strong><strong class="bold">Sample Rate</strong>.</li>
</ol>
<div><div><img alt="Figure 14.53: Enabling the Sample Rate menu item" src="img/Figure_14.53_B18327.jpg" class="calibre513"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.53: Enabling the Sample Rate menu item</p>
<ol class="calibre13">
<li value="17" class="calibre14">Now that the <code>12</code>; this will change the animation’s frame rate to <code>12</code> fps:</li>
</ol>
<div><div><img alt="Figure 14.54: Changing the Sample Rate" src="img/Figure_14.54_B18327.jpg" class="calibre514"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.54: Changing the Sample Rate</p>
<ol class="calibre13">
<li value="18" class="calibre14">Since <code>Chest</code> has an animation that will affect its alpha value, let’s ensure that this animation has full alpha whenever it plays. Select <code>1</code> on both the first and last frames.¶Technically, we only need the alpha set to <code>1</code> on the first frame, but I like to add a start and end frame here so that I am very sure about<a id="_idIndexMarker896" class="pcalibre pcalibre1 calibre6"/> what the animation is doing with that value.</li>
<li class="calibre14">We don’t want this animation to play on a loop, so select the <code>ChestOpening</code> Animation Clip from the <strong class="bold">Project</strong> view to take a look at its <strong class="bold">Inspector</strong> properties. Deselect the <strong class="bold">Loop </strong><strong class="bold">Time</strong> checkbox.</li>
<li class="calibre14">All of the other animations needed for this example have already been set up. They are very similar to this one in setup or the ones created in the preceding example. However, they are not hooked up to the correct GameObjects.<p class="calibre3">Let’s give the other objects in <code>Chest Open Canvas</code> their animations. Drag the <code>Coin</code> Animator to the Inspector of the <code>Coin</code> GameObject, the <code>Heart</code> Animator to the Inspector of the <code>Heart</code> GameObject, and the <code>PowerUp</code> Animator to the <code>PowerUp</code> GameObject’s Inspector. Each of these Animators can be found in the <code>Assets/Animations/Loot Box/Controllers</code> folder. You can now preview the animations of all the items popping out of the chests and shining by selecting the GameObjects and pressing play in the Animation window (Play in the Game view will not yet show the animations playing).</p></li>
<li class="calibre14">Let’s initialize the <code>Chest</code> and all of the objects as invisible. Select the <code>Chest</code>, <code>Coin</code>, <code>Heart</code>, and <code>PowerUp</code> GameObjects from the Hierarchy. In their Image component, change the alpha values of their <code>0</code>.</li>
<li class="calibre14">The <code>Chest Open Canvas</code> and the <code>Button</code> on that Canvas both have animations as well. These animations will affect a Canvas Group component on the objects. Right now, they don’t have Canvas Group components, though. So, add a Canvas Group component to <code>Chest Open Canvas</code> and its child <code>Button</code>.</li>
<li class="calibre14">Initialize the two new Canvas Group components to have <code>0</code> and their <code>false</code>.<p class="calibre3">You should now only see the Start Button in the scene.</p></li>
<li class="calibre14">Now, add the <code>CanvasGroupFadeInOut</code> Animator to <code>Chest Open Canvas</code> and its child <code>Button</code>.</li>
</ol>
<p class="calibre3">The animations are now completely<a id="_idIndexMarker897" class="pcalibre pcalibre1 calibre6"/> set up for each of the objects. We still need to finish working on the Animator Controller for the <code>Chest</code> and add some more logic for the various Animators, but we are done with the Animation Clip<a id="_idTextAnchor433" class="pcalibre pcalibre1 calibre6"/>s for now.</p>
<h3 class="calibre9">Building a State Machine and timing the animations</h3>
<p class="calibre3">The next thing to do is<a id="_idIndexMarker898" class="pcalibre pcalibre1 calibre6"/> set up our state machine and write the code that will make the various animations play.</p>
<p class="calibre3">To hook up the <a id="_idIndexMarker899" class="pcalibre pcalibre1 calibre6"/>various animations and have them play at the correct time, complete the following steps:</p>
<ol class="calibre13">
<li class="calibre14">We’ll start by creating the state machine that will work as the logic for our animation sequences. Create a new Animator Controller named <code>ChestOpeningStateMachine.controller</code> in <code>Assets/Animations/Loot Box/Controllers</code>.</li>
<li class="calibre14">Open the <code>ChestOpeningStateMachine</code> Animator Controller and create 12 new Empty States. Arrange, name, and transition the States, as shown in the following screenshot:
<div><div><img alt="Figure 14.55: The State Machine for the Animation" src="img/Figure_14.55_B18327.jpg" class="calibre515"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.55: The State Machine for the Animation</p>
<p class="calibre3">The state machine shown in <a id="_idIndexMarker900" class="pcalibre pcalibre1 calibre6"/>the preceding screenshot <a id="_idIndexMarker901" class="pcalibre pcalibre1 calibre6"/>demonstrates the sequence of events for the animations and interactions of the chest opening. The states labeled <strong class="bold">Waiting On Player</strong> will <em class="italic">play</em> when the game is waiting for the player to press a button to proceed with the animation. The other animations will automatically play based on timed events.</p></li>
</ol>
<ol class="calibre13">
<li value="3" class="calibre14">The state machine created in the previous steps will not actually contain any animations. It is simply a flow chart describing what is currently happening in the game. We will also <a id="_idIndexMarker902" class="pcalibre pcalibre1 calibre6"/>use it to send information to the various objects in the scene to let them<a id="_idIndexMarker903" class="pcalibre pcalibre1 calibre6"/> know what they should or should not be doing. Since we just want this to control the logic of this sequence, and not actually animate anything in the scene, we can add it on an Animator component to any object in the scene. Therefore, let’s add it to the <code>Main Camera</code>. Drag the <code>ChestOpeningStateMachine</code> Animator from the project view to the Inspector of the <code>Main Camera</code>.</li>
<li class="calibre14">Now, we will need to set the conditions of transition for the various states within the state machine. Create four animation Trigger Parameters, named <code>ShowChest</code>, <code>OpenChest</code>, <code>CloseChest</code>, and <code>AnimationComplete</code>.</li>
<li class="calibre14">Now, set Trigger Conditions for each transition, as shown in the following screenshot; with each transition, make sure that you deselect <strong class="bold">Has Exit Time</strong> and <strong class="bold">Fixed Duration</strong>:</li>
</ol>
<div><div><img alt="Figure 14.56: The triggers for the various transitions" src="img/Figure_14.56_B18327.jpg" class="calibre515"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.56: The triggers for the various transitions</p>
<p class="callout-heading">Note</p>
<p class="callout">I highly recommend that you<a id="_idIndexMarker904" class="pcalibre pcalibre1 calibre6"/> bookmark this image or print out a screenshot <a id="_idIndexMarker905" class="pcalibre pcalibre1 calibre6"/>of your <strong class="source-inline1">ChestOpeningStateMachine</strong> Animator while working through this example. Having this as a flow chart that you can easily reference while working on this example will make the steps being completed a lot easier to follow.</p>
<ol class="calibre13">
<li value="6" class="calibre14">Before we write code, let’s set up the Animator for the <code>Chest</code>. Currently, the Animator of the <code>Chest</code> should <a id="_idIndexMarker906" class="pcalibre pcalibre1 calibre6"/>look something as follows:</li>
</ol>
<div><div><img alt="Figure 14.57: The Chest Animator" src="img/Figure_14.57_B18327.jpg" class="calibre516"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.57: The Chest Animator</p>
<p class="calibre3">The Animator only <a id="_idIndexMarker907" class="pcalibre pcalibre1 calibre6"/>contains the animation states but does not yet indicate how they are all connected. We will need to create transitions and set up the Animation Parameters. Rearrange the states and add transitions to the Animator so it appears as follows:</p>
<div><div><img alt="Figure 14.58: The Chest Animator updated" src="img/Figure_14.58_B18327.jpg" class="calibre517"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.58: The Chest Animator updated</p>
<ol class="calibre13">
<li value="7" class="calibre14">Create three animation Trigger Parameters, named <code>ShowChest</code>, <code>OpenChest</code>, and <code>Reset</code>.</li>
<li class="calibre14">Now, set Trigger Conditions for <a id="_idIndexMarker908" class="pcalibre pcalibre1 calibre6"/>each transition, as shown in the following screenshot; with each <a id="_idIndexMarker909" class="pcalibre pcalibre1 calibre6"/>transition, make sure that you deselect <strong class="bold">Has Exit Time</strong> and <strong class="bold">Fixed Duration</strong>:</li>
</ol>
<div><div><img alt="Figure 14.59: The Triggers of the Chest Animator" src="img/Figure_14.59_B18327.jpg" class="calibre518"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.59: The Triggers of the Chest Animator</p>
<ol class="calibre13">
<li value="9" class="calibre14">Now that our Animators are all appropriately set, we can begin coding. We will use the <code>ChestOpeningStateMachine</code> Animator to make each appropriate animation play when the player clicks on the specified button during the specified state. The <code>ChestOpeningStateMachine</code> Animator will then automatically set the appropriate triggers on the Animators on the various objects that appear in the full animated sequence. We need a way to keep track of which items in the scene have Animators that will be controlled by the <code>ChestOpeningStateMachine</code> Animator, what their various parameters are, and what conditions need to be met to have those parameters set. We’ll keep track of all of this information in a single script. Create a new script called <code>ChestAnimControls</code> and save it in <code>Assets/Scripts/LootBox</code>.</li>
<li class="calibre14">To give us a nice, clean way of keeping track of all of the necessary information, we’ll use classes and an <a id="_idIndexMarker910" class="pcalibre pcalibre1 calibre6"/>enumerated list (I’ll explain what <a id="_idIndexMarker911" class="pcalibre pcalibre1 calibre6"/>these are and why we are using them momentarily). Delete the <code>Start()</code> and <code>Update()</code> functions from the <code>ChestAnimControls</code> class, and write the following code:<pre class="source-code">
// The different types of parameters
public enum TypesOfParameters
{
    floatParam,
    intParam,
    boolParam,
    triggerParam
}
// Properties of animation parameters
[System.Serializable]
public class ParameterProperties
{
    public string parameterString; // What string sets it?
    public string whichState; // Name of the state it's called from, null=not called by the state machine
    public TypesOfParameters parameterType; // What type of Animator Parameter is it?
    public float floatValue; // Float value required, if float
    public int intValue; // Int value required, if int
    public bool boolValue; // Bool value required, if bool
}
// Make a list of all animatable objects and their parameters
[System.Serializable]
public class AnimatorProperties
{
    public string name; // So the name will appear in the inspector rather than "Element 0, Element 1, etc"
    public Animator theAnimator; // The animator
    public List&lt;ParameterProperties&gt; animatorParameters; // Its parameter properties
}</pre><p class="calibre3">You’ll note that the preceding code has the following three parts: the <code>TypesOfParameters</code> enumerated, the <code>ParameterProperties</code> class, and the <code>AnimatorProperties</code> class. First, let’s look at the <code>TypesOfParameters</code> enumerated. This is a list of the types of Animator Parameters that can be used within an Animator. An enumerated list is a custom type that contains a set of constants that are represented with names. A benefit of using an enumerated list is that the list appears as a dropdown menu within the Inspector. Now, let’s look at the <code>ParameterProperties</code> class. Each object that is animated within the scene has a set of properties related to its Animator Parameters that we need to keep track of. A class can be an effective tool for grouping sets of data together. Therefore, I used a class to group the name of the parameter, which state the parameter will be set in, what type of parameter it is, and its value if it is a <code>float</code>, <code>integer</code>, or <code>Boolean</code> parameter. Note that the type of parameter is defined using the enumerated list, <code>TypesOfParameters</code>. This was done because there is a finite and specific set of parameters available for each animator parameter. Now, let’s look at the <code>AnimatorProperties</code> subclass. For each object in the scene, we will need to keep track of its name, its animator, and all of its parameters along with the conditions in which they are set. Note that the list of parameters and their <a id="_idIndexMarker912" class="pcalibre pcalibre1 calibre6"/>properties is defined by the <code>ParameterProperties</code> class. A big benefit of working with Unity is the ability to assign and<a id="_idIndexMarker913" class="pcalibre pcalibre1 calibre6"/> view public variables in the Inspector. However, when you create a class within a class, the public variables are not visible within the Inspector unless you place <code>[System.Serializable]</code> above the class. This gives the subclass the <code>Serializable</code> attribute and allows its public variables to be visible in the Inspector.</p></li> </ol>
<p class="callout-heading">Note</p>
<p class="callout">I would like to point out that this code allows for the Animators to have <strong class="source-inline1">Float</strong>, <strong class="source-inline1">Int</strong>, and <strong class="source-inline1">Bool</strong> parameters, even though the only parameters we use in any of our Animators are Triggers. I wrote it in this way to make it work more universally so that you can reuse this code for other animations in the future.</p>
<ol class="calibre13">
<li value="11" class="calibre14">If you find the code we wrote in the preceding step overwhelming, don’t worry—seeing it all listed out in the Inspector will clear it up a bit. All we have done so far is set up a few different groups of data. Now, we will need to create a variable that will use the information. We need a list of all animated items, so add the following code to your script:<pre class="source-code">
public List&lt;AnimatorProperties&gt; animatedItems; //all the animated items controlled by this state machine</pre></li> <li class="calibre14">Attach the <code>ChestAnimControls</code> script to the <code>Main Camera</code> by dragging it into its Inspector.</li>
<li class="calibre14">In the Inspector of the <code>Main Camera</code>, click on the arrow next to <strong class="bold">Animated Items</strong> to expand the list:</li>
</ol>
<div><div><img alt="Figure 14.60: The Chest Anim Controls component" src="img/Figure_14.60_B18327.jpg" class="calibre519"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.60: The Chest Anim Controls component</p>
<ol class="calibre13">
<li value="14" class="calibre14">We have a total of six items <a id="_idIndexMarker914" class="pcalibre pcalibre1 calibre6"/>that need to have their Animators controlled by this script and the State<a id="_idIndexMarker915" class="pcalibre pcalibre1 calibre6"/> Machine we created. So, change the List’s size to <code>6</code>. Expand <strong class="bold">Animator Items</strong> | <strong class="bold">Element 0</strong> and its <strong class="bold">Animator Parameters</strong>:
<div><div><img alt="Figure 14.61: The AnimatorProperties of the Chest Anim Controls" src="img/Figure_14.61_B18327.jpg" class="calibre520"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.61: The AnimatorProperties of the Chest Anim Controls</p>
<p class="calibre3">Remember that the <code>animatedItems</code> variable was a list of <code>AnimatorProperties</code>. So, <code>AnimatorProperties</code> class.</p></li>
</ol>
<ol class="calibre13">
<li value="15" class="calibre14">The first item we will need to list <a id="_idIndexMarker916" class="pcalibre pcalibre1 calibre6"/>data for is the <code>Chest Open Canvas</code> GameObject. Type <code>Chest Open Canvas</code> in the <code>Chest Open Canvas</code> from the Hierarchy into the <code>Chest Open Canvas</code> in the <strong class="bold">Name</strong> slot, you’ll see that the <strong class="bold">Element 0</strong> label is <a id="_idIndexMarker917" class="pcalibre pcalibre1 calibre6"/>replaced with <strong class="bold">Chest Open Canvas</strong>. Whenever you have a list of objects in Unity’s Inspector, if the first item in the object is a string, the string will replace the <strong class="bold">Element </strong><strong class="bold">x</strong> label:</li>
</ol>
<div><div><img alt="Figure 14.62: The Chest Open Canvas properties" src="img/Figure_14.62_B18327.jpg" class="calibre521"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.62: The Chest Open Canvas properties</p>
<ol class="calibre13">
<li value="16" class="calibre14">Now, we will need to list out all the parameters that are used within <code>Chest Open Canvas</code>’s Animator and the conditions under which it is set. It has two parameters that we need to list data for, so change the size of <code>2</code>. Expand the two resulting <strong class="bold">Elements</strong>, as follows:
<div><div><img alt="Figure 14.63: The ParameterProperties and TypesOfParameters" src="img/Figure_14.63_B18327.jpg" class="calibre522"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.63: The ParameterProperties and TypesOfParameters</p>
<p class="calibre3">Remember that the <code>animatorParameters</code> variable was a list of <code>ParameterProperties</code>. So, the two <code>ParameterProperties</code> class. Additionally, within the <code>ParameterProperties</code> class, <code>parameterType</code> was a <code>TypesOfParameters</code> variable. <code>TypesOfParameters</code> was an enumerated list, so<a id="_idIndexMarker918" class="pcalibre pcalibre1 calibre6"/> any variable of that type will appear as a dropdown<a id="_idIndexMarker919" class="pcalibre pcalibre1 calibre6"/> menu with the options that appeared within the defined list.</p></li>
</ol>
<ol class="calibre13">
<li value="17" class="calibre14">We now need to list out each Parameter of the <code>Chest Open Canvas</code>, <code>ChestOpeningStateMachine</code> will cause the Parameter to be set, and specify its <strong class="bold">Parameter Type</strong>:
<div><div><img alt="Figure 14.64: The Chest Open Canvas properties" src="img/Figure_14.64_B18327.jpg" class="calibre523"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.64: The Chest Open Canvas properties</p>
<p class="calibre3">Since each is a Trigger <a id="_idIndexMarker920" class="pcalibre pcalibre1 calibre6"/>Animator Parameter, we do not have to worry about the values for <strong class="bold">Float Value</strong>, <strong class="bold">Int Value</strong>, or <strong class="bold">Bool Value</strong>.</p></li>
</ol>
<ol class="calibre13">
<li value="18" class="calibre14">Now, we can fill in the <a id="_idIndexMarker921" class="pcalibre pcalibre1 calibre6"/>Animator information for the other five animated objects in the same way we filled out the information for the <code>Chest Open Canvas</code>. Fill in the information for the animator of <code>Chest</code> as follows:</li>
</ol>
<div><div><img alt="Figure 14.65: The Chest properties" src="img/Figure_14.65_B18327.jpg" class="calibre524"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.65: The Chest properties</p>
<ol class="calibre13">
<li value="19" class="calibre14">Fill in the information<a id="_idIndexMarker922" class="pcalibre pcalibre1 calibre6"/> for the Animator<a id="_idIndexMarker923" class="pcalibre pcalibre1 calibre6"/> of <code>Coin</code> as follows:</li>
</ol>
<div><div><img alt="Figure 14.66: The Coin properties" src="img/Figure_14.66_B18327.jpg" class="calibre525"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.66: The Coin properties</p>
<ol class="calibre13">
<li value="20" class="calibre14">Fill in the information <a id="_idIndexMarker924" class="pcalibre pcalibre1 calibre6"/>for the Animator<a id="_idIndexMarker925" class="pcalibre pcalibre1 calibre6"/> of <code>Heart</code> as follows:</li>
</ol>
<div><div><img alt="Figure 14.67: The Heart properties" src="img/Figure_14.67_B18327.jpg" class="calibre526"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.67: The Heart properties</p>
<ol class="calibre13">
<li value="21" class="calibre14">Fill in the information <a id="_idIndexMarker926" class="pcalibre pcalibre1 calibre6"/>for the Animator <a id="_idIndexMarker927" class="pcalibre pcalibre1 calibre6"/>of <code>PowerUp</code> as follows:</li>
</ol>
<div><div><img alt="Figure 14.68: The PowerUp properties" src="img/Figure_14.68_B18327.jpg" class="calibre527"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.68: The PowerUp properties</p>
<ol class="calibre13">
<li value="22" class="calibre14">Fill in the information<a id="_idIndexMarker928" class="pcalibre pcalibre1 calibre6"/> for the Animator <a id="_idIndexMarker929" class="pcalibre pcalibre1 calibre6"/>of <code>Button</code> as follows:</li>
</ol>
<div><div><img alt="Figure 14.69: The Button properties" src="img/Figure_14.69_B18327.jpg" class="calibre528"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.69: The Button properties</p>
<ol class="calibre13">
<li value="23" class="calibre14">Now that we have all the appropriate data values for the State Machine initialized and defined, let’s actually have the State Machine perform its appropriate logic. First, we will need<a id="_idIndexMarker930" class="pcalibre pcalibre1 calibre6"/> to create a variable for the Animator. Add the following variable<a id="_idIndexMarker931" class="pcalibre pcalibre1 calibre6"/> initialization to your script:<pre class="source-code">
Animator theStateMachine; //the state machine animator component</pre></li> <li class="calibre14">Now, initialize the State Machine’s Animator in an <code>Awake()</code> function:<pre class="source-code">
void Awake()
{
    theStateMachine = GetComponent&lt;Animator&gt;(); // Get the state machine
}</pre></li> <li class="calibre14">To have the State Machine automatically set the various parameters of the individual Animators at the appropriate state, we will need to loop through all of the animated items we have listed and each of their listed parameters. If the animated item has a parameter, which is to be set at the current state of the State Machine, we will set it based on the conditions listed. Create the following function to perform that functionality:<pre class="source-code">
// Functionality: Check if any of the animations need their parameters set
// Called from enter state
public void CheckForParameterSet()
{
    // Loop through all of the objects
    foreach (AnimatorProperties animatorProp in animatedItems)
    {
        // Loop through its set of parameters
        foreach (ParameterProperties parameter in animatorProp.animatorParameters)
        {
            // Find the ones called on the current state
            if (theStateMachine.GetCurrentAnimatorStateInfo(0).IsName(parameter.whichState))
            {
                // Determine parameter type
                // Float types
                if (parameter.parameterType == TypesOfParameters.floatParam)
                {
                    animatorProp.theAnimator.SetFloat(parameter.parameterString, parameter.floatValue);
                }
                // Int types
                else if (parameter.parameterType == TypesOfParameters.intParam)
                {
                    animatorProp.theAnimator.SetInteger(parameter.parameterString, parameter.intValue);
                }
                // Bool type
                else if (parameter.parameterType == TypesOfParameters.boolParam)
                {
                    animatorProp.theAnimator.SetBool(parameter.parameterString, parameter.boolValue);
                }
                // Trigger type
                else
                {
                    animatorProp.theAnimator.SetTrigger(parameter.parameterString);
                }
            }
        }
    }
}</pre><p class="calibre3">The <code>CheckForParameterSet</code> function will determine whether a specified Animator needs a parameter set at the current state of the State Machine. However, this function is not<a id="_idIndexMarker932" class="pcalibre pcalibre1 calibre6"/> currently called anywhere. We want this function to be called whenever<a id="_idIndexMarker933" class="pcalibre pcalibre1 calibre6"/> a state in the State machine starts. We can accomplish this with a State Machine Behaviour. Open the <code>ChestOpeningStateMachine</code> Animator and select the <code>ChestStateMachineBehaviour</code>, and click on the <code>ChestStateMachineBehaviour</code> will be added to the <code>Assets</code> folder. Move it to the <code>Assets/Scripts/LootBox</code> folder and open it.</p></li> <li class="calibre14">A lot of stuff is included within this State Machine Behaviour. We only need the <code>OnStateEnter</code> function. Adjust the code within the <code>ChestStateMachineBehaviour</code> class to include the following to call the <code>CheckForParameterSet</code> function on the <code>ChestAnimControls</code> script when it starts:<pre class="source-code">
ChestAnimControls theControllerScript;
public void Awake()
{
    // Get the script that holds the state machine logic
    theControllerScript = FindObjectOfType&lt;ChestAnimControls&gt;();
}
// OnStateEnter is called when a transition starts and the state machine starts to evaluate this state
public override void OnStateEnter(Animator animator, AnimatorStateInfo stateInfo, int layerIndex)
{
    theControllerScript.CheckForParameterSet();
}</pre></li> <li class="calibre14">We will need this script on every state that does not say <code>ChestStateMachineBehaviour</code> to each of the states in the right-hand column (the ones that do not say <code>ChestStateMachineBehaviour</code> in their Inspector. The State Machine will now appropriately call each of the individual items’ animations when the appropriate states are entered, but we don’t have anything that actually controls the flow of the state machine.</li>
<li class="calibre14">Right now, it is going to just stay in the <code>Button</code> that is on the <code>Button Canvas</code> that says <code>ChestAnimControls.cs</code> script:<pre class="source-code">
// Called by player interactions (Waiting On Player)
public void PlayerInputTrigger(string triggerString)
{
    theStateMachine.SetTrigger(triggerString);
}</pre><p class="calibre3">This function will trigger the State Machine’s trigger parameter specified by the string sent as an argument.</p></li> <li class="calibre14">We will need to call that function from the <code>Button</code> on the <code>Button Canvas</code>:</li>
</ol>
<div><div><img alt="Figure 14.70: The On Click() event of the Button" src="img/Figure_14.70_B18327.jpg" class="calibre529"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.70: The On Click() event of the Button</p>
<ol class="calibre13">
<li value="30" class="calibre14">Now, we will need to create some <a id="_idIndexMarker936" class="pcalibre pcalibre1 calibre6"/>logic that will have the <code>Button</code> on <code>Chest Open Canvas</code> transition <a id="_idIndexMarker937" class="pcalibre pcalibre1 calibre6"/>from the other two <code>OpenCloseButton.cs</code> in the <code>Assets/Scripts/LootBox</code> folder.</li>
<li class="calibre14">Add the <code>UnityEngine.UI</code> namespace to the <code>OpenCloseButton</code> script with the following:<pre class="source-code">
using UnityEngine.UI;</pre></li> <li class="calibre14">Now, add the following code to the <code>OpenCloseButton</code> script:<pre class="source-code">
Text buttonText;
Animator chestAnimController;
void Awake()
{
    buttonText = transform.GetComponentInChildren&lt;Text&gt;();
    chestAnimController = Camera.main.GetComponent&lt;Animator&gt;();
}
public void OpenOrClose()
{
    Debug.Log("click");
    if (buttonText.text == "Open")
    {
        chestAnimController.SetTrigger("OpenChest");
        SetText("Close");
    }
    else
    {
        chestAnimController.SetTrigger("CloseChest");
        SetText("Open");
    }
}
public void SetText(string setTextTo)
{
    buttonText.text = setTextTo;
}</pre><p class="calibre3">The <code>OpenOrClose()</code> function will be called by the button›s <code>Button</code> on the <code>Chest Open Canvas</code> will be used to open and close the chest. It will set the appropriate trigger based on the current text written on the button and will change its text to <code>"Open"</code> or <code>"Close"</code> with the <code>SetText()</code> function.</p></li> <li class="calibre14">Add the <code>OpenCloseButton</code> script as <a id="_idIndexMarker938" class="pcalibre pcalibre1 calibre6"/>a component to the <code>Button</code> on <code>Chest </code><code>Open Canvas</code>.</li>
<li class="calibre14">Now, add the<a id="_idIndexMarker939" class="pcalibre pcalibre1 calibre6"/> following <code>Button</code> on <code>Chest </code><code>Open Canvas</code>:</li>
</ol>
<div><div><img alt="Figure 14.71: The On Click() property of the Button" src="img/Figure_14.71_B18327.jpg" class="calibre530"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.71: The On Click() property of the Button</p>
<ol class="calibre13">
<li value="35" class="calibre14">If you play the game now and click on the <code>AnimationComplete</code> trigger in the <code>ChestOpeningStateMachine</code> Animator. We will need another script to set this trigger. Create a new script called <code>AnimationControls</code> in the <code>Assets/Scripts/LootBox</code> folder.</li>
<li class="calibre14">Adjust the code within the <code>AnimationControls</code> class, as follows:<pre class="source-code">
Animator chestAnimController;
void Awake()
{
    chestAnimController = Camera.main.GetComponent&lt;Animator&gt;();
}
// Call as an animation event on the last frame of animations
public void ProceedStateMachine()
{
    chestAnimController.SetTrigger("AnimationComplete");
}</pre></li> <li class="calibre14">The preceding code simply sets the <code>AnimationComplete</code> trigger with the <code>ProceedStateMachine()</code> function.<p class="calibre3">This trigger is used to allow each of the individual animations to fully play before the next state is started. To make sure that the animation trigger isn’t set until the entire animation has played, we’ll use Animation Events to call the <code>ProceedStateMachine()</code> function at the appropriate time within the necessary animations.</p><p class="calibre3">When you use an Animation Event, the function you want to call must be on a script attached to the same object as the animation. We want the function to be called at the end of animations on <code>Chest Open Canvas</code>, <code>Chest</code>, <code>Coin</code>, <code>Heart</code>, <code>PowerUp</code>, and the <code>Button</code> on <code>Chest Open Canvas</code>. Therefore, add the <code>AnimationControls</code> script as a component to each of them.</p></li>
<li class="calibre14">Now, we will need to add the <code>ProceedStateMachine()</code> function as an Animation Event to the various<a id="_idIndexMarker940" class="pcalibre pcalibre1 calibre6"/> animations. Select <code>Chest Open Canvas</code> and view its <code>CanvasGroupFadeIn</code> animation. On its last animation frame, right-click on the top dark gray<a id="_idIndexMarker941" class="pcalibre pcalibre1 calibre6"/> area of the timeline and select <code>ProceedStateMachine()</code> from the dropdown menu. It will be the very last function in the list. You should now have a white flag above the last keyframe that says <strong class="bold">ProceedStateMachine</strong> when you hover over it:</li>
</ol>
<div><div><img alt="Figure 14.72: Adding the ProceedStateMachine Event to the animation" src="img/Figure_14.72_B18327.jpg" class="calibre531"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 14.72: Adding the ProceedStateMachine Event to the animation</p>
<ol class="calibre13">
<li value="39" class="calibre14">If you play the game now and click on the <code>ChestFlyingIn</code> animation. To have the animation sequence finish out, add the <code>ProceedStateMachine()</code> function as an Animation Event to each of the following animations: <code>ChestFlyingIn</code>, <code>ChestOpening</code>, <code>CoinPopping</code>, <code>HeartPopping</code>, and <code>PowerUpPop</code>.</li>
<li class="calibre14">Playing the game now<a id="_idIndexMarker942" class="pcalibre pcalibre1 calibre6"/> almost works the way it should. There’s a bit of <a id="_idIndexMarker943" class="pcalibre pcalibre1 calibre6"/>an issue with the timing of the items popping out of the chest when you replay the animation sequence. Currently, there is a bit of a problem with the <code>AnimationComplete</code> trigger. We need that trigger to definitely be unset whenever any of the <code>true</code> when the State Machine restarts, causing some timing issues. To fix this, we need one more State Machine Behaviour. Select the <code>ResetTriggers</code> in its Inspector. Remember that whenever you create a new State Machine Behaviour, it is added to the <code>Asset</code> folder, so move it to the <code>Asset/Scripts/LootBox</code> folder.</li>
<li class="calibre14">We want the <code>AnimationComplete</code> Trigger Parameter to reset whenever a <code>ResetTriggers</code> class, as follows:<pre class="source-code">
// OnStateEnter is called when a transition starts and the state machine starts to evaluate this state
override public void OnStateEnter(Animator animator, AnimatorStateInfo stateInfo, int layerIndex)
{
    animator.ResetTrigger("AnimationComplete");
}</pre></li> <li class="calibre14">Now, add the <code>ResetTriggers</code> State Machine Behaviour to all three of the <strong class="bold">Waiting on </strong><strong class="bold">Player</strong> states.</li>
</ol>
<p class="calibre3">Playing the game now should have the animation sequence firing correctly, with everything but the particle system, which will be covered in the next chapter.</p>
<h1 id="_idParaDest-251" class="calibre5"><a id="_idTextAnchor434" class="pcalibre pcalibre1 calibre6"/>Summary</h1>
<p class="calibre3">Animating UI elements is not significantly different from animating any other 2D object in Unity. Therefore, this chapter offered a brief overview of animation. This chapter also offered an example of the workflow for creating complex animations utilizing a State Machine and Animation Events. There’s a lot we can do with animations, and the examples in this chapter showed you many of the techniques you can use while animating UI. Hopefully, these examples will provide you with enough variation of technique that you can determine how to make your own animations in the future.</p>
<p class="calibre3">In the next chapter, we will discuss how to render particle effects in front of the UI.</p>
</div>
</div></body></html>