<html xml:lang="en-US" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
<meta charset="utf-8"/>
<meta content="packt" name="generator"/>
<title>3 Architectural Principles</title>
<link href="../styles/stylesheet1.css" rel="stylesheet" type="text/css"/>
<link href="../styles/stylesheet2.css" rel="stylesheet" type="text/css"/>
<!-- kobo-style -->
<style id="koboSpanStyle" type="text/css" xmlns="http://www.w3.org/1999/xhtml">.koboSpan { -webkit-text-combine: inherit; }</style>
</head>
<body>
<section class="level1 pkt" data-number="4" id="architectural-principles">
<h1 data-number="4"><span class="koboSpan" id="kobo.1.1" xmlns="http://www.w3.org/1999/xhtml">3 Architectural Principles</span></h1>
<section class="level2" data-number="4.1" id="before-you-begin-join-our-book-community-on-discord-2">
<h2 data-number="4.1"><span class="koboSpan" id="kobo.2.1" xmlns="http://www.w3.org/1999/xhtml">Before you begin: Join our book community on Discord</span></h2>
<p><span class="koboSpan" id="kobo.3.1" xmlns="http://www.w3.org/1999/xhtml">Give your feedback straight to the author himself and chat to other early readers on our Discord server (find the "architecting-aspnet-core-apps-3e" channel under EARLY ACCESS SUBSCRIPTION).</span></p>
<p><a href="https://packt.link/EarlyAccess"><span class="koboSpan" id="kobo.4.1" xmlns="http://www.w3.org/1999/xhtml">https://packt.link/EarlyAccess</span></a></p>
<p><span class="koboSpan" id="kobo.5.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Qr code Description automatically generated" src="../media/file11.png" style="width:10em"/></span></p>
<p><span class="koboSpan" id="kobo.6.1" xmlns="http://www.w3.org/1999/xhtml">This chapter delves into fundamental architectural principles: pillars of contemporary software development practices. </span><span class="koboSpan" id="kobo.6.2" xmlns="http://www.w3.org/1999/xhtml">These principles help us create flexible, resilient, testable, and maintainable code.We can use these principles to stimulate critical thinking, fostering our ability to evaluate trade-offs, anticipate potential issues, and create solutions that stand the test of time by influencing our decision-making process and helping our design choices.As we embark on this journey, we constantly refer to those principles throughout the book, particularly the SOLID principles, which improve our ability to build flexible and robust software systems.In this chapter, we cover the following topics:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.7.1" xmlns="http://www.w3.org/1999/xhtml">The separation of concerns (SoC) principle</span></li>
<li><span class="koboSpan" id="kobo.8.1" xmlns="http://www.w3.org/1999/xhtml">The </span><strong><span class="koboSpan" id="kobo.9.1" xmlns="http://www.w3.org/1999/xhtml">DRY</span></strong><span class="koboSpan" id="kobo.10.1" xmlns="http://www.w3.org/1999/xhtml"> principle</span></li>
<li><span class="koboSpan" id="kobo.11.1" xmlns="http://www.w3.org/1999/xhtml">The </span><strong><span class="koboSpan" id="kobo.12.1" xmlns="http://www.w3.org/1999/xhtml">KISS</span></strong><span class="koboSpan" id="kobo.13.1" xmlns="http://www.w3.org/1999/xhtml"> principle</span></li>
<li><span class="koboSpan" id="kobo.14.1" xmlns="http://www.w3.org/1999/xhtml">The </span><strong><span class="koboSpan" id="kobo.15.1" xmlns="http://www.w3.org/1999/xhtml">SOLID</span></strong><span class="koboSpan" id="kobo.16.1" xmlns="http://www.w3.org/1999/xhtml"> principles</span></li>
</ul>
<p><span class="koboSpan" id="kobo.17.1" xmlns="http://www.w3.org/1999/xhtml">We also revise the following notions:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.18.1" xmlns="http://www.w3.org/1999/xhtml">Covariance</span></li>
<li><span class="koboSpan" id="kobo.19.1" xmlns="http://www.w3.org/1999/xhtml">Contravariance</span></li>
<li><span class="koboSpan" id="kobo.20.1" xmlns="http://www.w3.org/1999/xhtml">Interfaces</span></li>
</ul>
</section>
<section class="level2" data-number="4.2" id="separation-of-concerns-soc">
<h2 data-number="4.2"><span class="koboSpan" id="kobo.21.1" xmlns="http://www.w3.org/1999/xhtml">Separation of concerns (SoC)</span></h2>
<p><span class="koboSpan" id="kobo.22.1" xmlns="http://www.w3.org/1999/xhtml">As its name implies, the idea is to separate our software into logical blocks, each representing a concern. </span><span class="koboSpan" id="kobo.22.2" xmlns="http://www.w3.org/1999/xhtml">A “concern” refers to a specific aspect of a program. </span><span class="koboSpan" id="kobo.22.3" xmlns="http://www.w3.org/1999/xhtml">It’s a particular interest or focus within a system that serves a distinct purpose. </span><span class="koboSpan" id="kobo.22.4" xmlns="http://www.w3.org/1999/xhtml">Concerns could be as broad as data management, as specific as user authentication, or even more specific, like copying an object into another. </span><span class="koboSpan" id="kobo.22.5" xmlns="http://www.w3.org/1999/xhtml">The Separation of Concerns principle suggests that each concern should be isolated and managed separately to improve the system’s maintainability, modularity, and understandability.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.23.1" xmlns="http://www.w3.org/1999/xhtml">The Separation of Concerns principle applies to all programming paradigms. </span><span class="koboSpan" id="kobo.23.2" xmlns="http://www.w3.org/1999/xhtml">In a nutshell, this principle means factoring a program into the correct pieces. </span><span class="koboSpan" id="kobo.23.3" xmlns="http://www.w3.org/1999/xhtml">For example, modules, subsystems, and microservices are macro-pieces, while classes and methods are smaller pieces.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.24.1" xmlns="http://www.w3.org/1999/xhtml">By correctly separating concerns, we can prevent changes in one area from affecting others, allow for more efficient code reuse, and make it easier to understand and manage different parts of a system independently.Here are a few examples:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.25.1" xmlns="http://www.w3.org/1999/xhtml">Security and logging are cross-cutting concerns.</span></li>
<li><span class="koboSpan" id="kobo.26.1" xmlns="http://www.w3.org/1999/xhtml">Rendering a user interface is a concern.</span></li>
<li><span class="koboSpan" id="kobo.27.1" xmlns="http://www.w3.org/1999/xhtml">Handling an HTTP request is a concern.</span></li>
<li><span class="koboSpan" id="kobo.28.1" xmlns="http://www.w3.org/1999/xhtml">Copying an object into another is a concern.</span></li>
<li><span class="koboSpan" id="kobo.29.1" xmlns="http://www.w3.org/1999/xhtml">Orchestrating a distributed workflow is a concern.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.30.1" xmlns="http://www.w3.org/1999/xhtml">Before moving to the DRY principle, it is imperative to consider concerns when dividing software into pieces to create cohesive units. </span><span class="koboSpan" id="kobo.30.2" xmlns="http://www.w3.org/1999/xhtml">A good separation of concerns helps create modular designs and face design dilemmas more effectively, leading to a maintainable application.</span></p>
</section>
<section class="level2" data-number="4.3" id="dont-repeat-yourself-dry">
<h2 data-number="4.3"><span class="koboSpan" id="kobo.31.1" xmlns="http://www.w3.org/1999/xhtml">Don’t repeat yourself (DRY)</span></h2>
<p><span class="koboSpan" id="kobo.32.1" xmlns="http://www.w3.org/1999/xhtml">The DRY principle advocates the separation of concerns principle and aims to eliminate redundancy in code as well. </span><span class="koboSpan" id="kobo.32.2" xmlns="http://www.w3.org/1999/xhtml">It promotes the idea that each piece of knowledge or logic should have a single, unambiguous representation within a system.So, when you have duplicated logic in your system, encapsulate it and reuse that new encapsulation in multiple places instead. </span><span class="koboSpan" id="kobo.32.3" xmlns="http://www.w3.org/1999/xhtml">If you find yourself writing the same or similar code in multiple places, refactor that code into a reusable component instead. </span><span class="koboSpan" id="kobo.32.4" xmlns="http://www.w3.org/1999/xhtml">Leverage functions, classes, modules, or other abstractions to refactor the code.Adhering to the DRY principle makes your code more maintainable, less error-prone, and easier to modify because a change in logic or bug fix needs to be made in only one place, reducing the likelihood of introducing errors or inconsistencies.However, it is imperative to regroup duplicated logic by concern, not only by the similarities of the code itself. </span><span class="koboSpan" id="kobo.32.5" xmlns="http://www.w3.org/1999/xhtml">Let’s look at those two classes:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.33.1" xmlns="http://www.w3.org/1999/xhtml">public class AdminApp
{
    public async Task DisplayListAsync(
        IBookService bookService,
        IBookPresenter presenter)
    {
        var books = await bookService.FindAllAsync();
        foreach (var book in books)
        {
            await presenter.DisplayAsync(book);
        }
    }
}
public class PublicApp
{
    public async Task DisplayListAsync(
        IBookService bookService,
        IBookPresenter presenter)
    {
        var books = await bookService.FindAllAsync();
        foreach (var book in books)
        {
            await presenter.DisplayAsync(book);
        }
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.34.1" xmlns="http://www.w3.org/1999/xhtml">The code is very similar, but encapsulating a single class or method could very well be a mistake. </span><span class="koboSpan" id="kobo.34.2" xmlns="http://www.w3.org/1999/xhtml">Why? </span><span class="koboSpan" id="kobo.34.3" xmlns="http://www.w3.org/1999/xhtml">Keeping two separate classes is more logical because the admin program can have different reasons for modification compared to the public program.However, encapsulating the list logic into the </span><code><span class="koboSpan" id="kobo.35.1" xmlns="http://www.w3.org/1999/xhtml">IBookPresenter</span></code><span class="koboSpan" id="kobo.36.1" xmlns="http://www.w3.org/1999/xhtml"> interface could make sense. </span><span class="koboSpan" id="kobo.36.2" xmlns="http://www.w3.org/1999/xhtml">It would allow us to react differently to both types of users if needed, like filtering the admin panel list but doing something different in the public section. </span><span class="koboSpan" id="kobo.36.3" xmlns="http://www.w3.org/1999/xhtml">One way to do this is by replacing the </span><code><span class="koboSpan" id="kobo.37.1" xmlns="http://www.w3.org/1999/xhtml">foreach</span></code><span class="koboSpan" id="kobo.38.1" xmlns="http://www.w3.org/1999/xhtml"> loop with a </span><code><span class="koboSpan" id="kobo.39.1" xmlns="http://www.w3.org/1999/xhtml">presenter</span></code> <code><span class="koboSpan" id="kobo.40.1" xmlns="http://www.w3.org/1999/xhtml">DisplayListAsync(books)</span></code><span class="koboSpan" id="kobo.41.1" xmlns="http://www.w3.org/1999/xhtml"> call, like the following highlighted code:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.42.1" xmlns="http://www.w3.org/1999/xhtml">public class AdminApp
{
    public async Task DisplayListAsync(
        IBookService bookService,
        IBookPresenter presenter)
    {
        var books = await bookService.FindAllAsync();
        // We could filter the list here
        await presenter.DisplayListAsync(books);
    }
}
public class PublicApp
{
    public async Task DisplayListAsync(
        IBookService bookService,
        IBookPresenter presenter)
    {
        var books = await bookService.FindAllAsync();
        await presenter.DisplayListAsync(books);
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.43.1" xmlns="http://www.w3.org/1999/xhtml">There is more to those simple implementations to discuss, like the possibility of supporting multiple implementations of the interfaces for added flexibility, but let’s keep some subjects for further down the book.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.44.1" xmlns="http://www.w3.org/1999/xhtml">When you don’t know how to name a class or a method, you may have identified a problem with your separation of concerns. </span><span class="koboSpan" id="kobo.44.2" xmlns="http://www.w3.org/1999/xhtml">This is a good indicator that you should go back to the drawing board. </span><span class="koboSpan" id="kobo.44.3" xmlns="http://www.w3.org/1999/xhtml">Nevertheless, naming is hard, so sometimes, that’s just it.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.45.1" xmlns="http://www.w3.org/1999/xhtml">Keeping our code DRY while following the separation of concerns principles is imperative. </span><span class="koboSpan" id="kobo.45.2" xmlns="http://www.w3.org/1999/xhtml">Otherwise, what may seem like a good move could become a nightmare.</span></p>
</section>
<section class="level2" data-number="4.4" id="keep-it-simple-stupid-kiss">
<h2 data-number="4.4"><span class="koboSpan" id="kobo.46.1" xmlns="http://www.w3.org/1999/xhtml">Keep it simple, stupid (KISS)</span></h2>
<p><span class="koboSpan" id="kobo.47.1" xmlns="http://www.w3.org/1999/xhtml">This is another straightforward principle, yet one of the most important. </span><span class="koboSpan" id="kobo.47.2" xmlns="http://www.w3.org/1999/xhtml">Like in the real world, the more moving pieces, the more chances something breaks. </span><span class="koboSpan" id="kobo.47.3" xmlns="http://www.w3.org/1999/xhtml">This principle is a design philosophy that advocates for simplicity in design. </span><span class="koboSpan" id="kobo.47.4" xmlns="http://www.w3.org/1999/xhtml">It emphasizes the idea that systems work best when they are kept simple rather than made complex.Striving for simplicity might involve writing shorter methods or functions, minimizing the number of parameters, avoiding over-architecting, and choosing the simplest solution to solve a problem.Adding interfaces, abstraction layers, and complex object hierarchy adds complexity, but are the added benefits better than the underlying complexity? </span><span class="koboSpan" id="kobo.47.5" xmlns="http://www.w3.org/1999/xhtml">If so, they are worth it; otherwise, they are not.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.48.1" xmlns="http://www.w3.org/1999/xhtml">As a guiding principle, when you can write the same program with less complexity, do it. </span><span class="koboSpan" id="kobo.48.2" xmlns="http://www.w3.org/1999/xhtml">This is also why predicting future requirements can often prove detrimental, as it may inadvertently inject unnecessary complexity into your codebase for features that might never materialize.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.49.1" xmlns="http://www.w3.org/1999/xhtml">We study design patterns in the book and design systems using them. </span><span class="koboSpan" id="kobo.49.2" xmlns="http://www.w3.org/1999/xhtml">We learn how to apply a high degree of engineering to our code, which can lead to over-engineering if done in the wrong context. </span><span class="koboSpan" id="kobo.49.3" xmlns="http://www.w3.org/1999/xhtml">Towards the end of the book, we circle back on the KISS principle when exploring the vertical slice architecture and request-endpoint-response (REPR) patterns.Next, we delve into the SOLID principles, which are the key to flexible software design.</span></p>
</section>
<section class="level2" data-number="4.5" id="the-solid-principles">
<h2 data-number="4.5"><span class="koboSpan" id="kobo.50.1" xmlns="http://www.w3.org/1999/xhtml">The SOLID principles</span></h2>
<p><span class="koboSpan" id="kobo.51.1" xmlns="http://www.w3.org/1999/xhtml">SOLID is an acronym representing five principles that extend the basic OOP concepts of </span><strong><span class="koboSpan" id="kobo.52.1" xmlns="http://www.w3.org/1999/xhtml">Abstraction</span></strong><span class="koboSpan" id="kobo.53.1" xmlns="http://www.w3.org/1999/xhtml">, </span><strong><span class="koboSpan" id="kobo.54.1" xmlns="http://www.w3.org/1999/xhtml">Encapsulation</span></strong><span class="koboSpan" id="kobo.55.1" xmlns="http://www.w3.org/1999/xhtml">, </span><strong><span class="koboSpan" id="kobo.56.1" xmlns="http://www.w3.org/1999/xhtml">Inheritance</span></strong><span class="koboSpan" id="kobo.57.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><strong><span class="koboSpan" id="kobo.58.1" xmlns="http://www.w3.org/1999/xhtml">Polymorphism</span></strong><span class="koboSpan" id="kobo.59.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.59.2" xmlns="http://www.w3.org/1999/xhtml">They add more details about what to do and how to do it, guiding developers toward more robust and flexible designs.It is crucial to remember that these are just guiding principles, not rules that you must follow, no matter what. </span><span class="koboSpan" id="kobo.59.3" xmlns="http://www.w3.org/1999/xhtml">Think about what makes sense for your specific project. </span><span class="koboSpan" id="kobo.59.4" xmlns="http://www.w3.org/1999/xhtml">If you’re building a small tool, it might be acceptable not to follow these principles as strictly as you would for a crucial business application. </span><span class="koboSpan" id="kobo.59.5" xmlns="http://www.w3.org/1999/xhtml">In the case of business-critical applications, it might be a good idea to stick to them more closely. </span><span class="koboSpan" id="kobo.59.6" xmlns="http://www.w3.org/1999/xhtml">Still, it’s usually a smart move to follow them, no matter the size of your app. </span><span class="koboSpan" id="kobo.59.7" xmlns="http://www.w3.org/1999/xhtml">That’s why we’re discussing them before diving into design patterns.The SOLID acronym represents the following:</span></p>
<ul>
<li><strong><span class="koboSpan" id="kobo.60.1" xmlns="http://www.w3.org/1999/xhtml">S</span></strong><span class="koboSpan" id="kobo.61.1" xmlns="http://www.w3.org/1999/xhtml">ingle responsibility principle</span></li>
<li><strong><span class="koboSpan" id="kobo.62.1" xmlns="http://www.w3.org/1999/xhtml">O</span></strong><span class="koboSpan" id="kobo.63.1" xmlns="http://www.w3.org/1999/xhtml">pen/Closed principle</span></li>
<li><strong><span class="koboSpan" id="kobo.64.1" xmlns="http://www.w3.org/1999/xhtml">L</span></strong><span class="koboSpan" id="kobo.65.1" xmlns="http://www.w3.org/1999/xhtml">iskov substitution principle</span></li>
<li><strong><span class="koboSpan" id="kobo.66.1" xmlns="http://www.w3.org/1999/xhtml">I</span></strong><span class="koboSpan" id="kobo.67.1" xmlns="http://www.w3.org/1999/xhtml">nterface segregation principle</span></li>
<li><strong><span class="koboSpan" id="kobo.68.1" xmlns="http://www.w3.org/1999/xhtml">D</span></strong><span class="koboSpan" id="kobo.69.1" xmlns="http://www.w3.org/1999/xhtml">ependency inversion principle</span></li>
</ul>
<p><span class="koboSpan" id="kobo.70.1" xmlns="http://www.w3.org/1999/xhtml">By following these principles, your systems should become easier to test and maintain.</span></p>
<section class="level3" data-number="4.5.1" id="single-responsibility-principle-srp">
<h3 data-number="4.5.1"><span class="koboSpan" id="kobo.71.1" xmlns="http://www.w3.org/1999/xhtml">Single responsibility principle (SRP)</span></h3>
<p><span class="koboSpan" id="kobo.72.1" xmlns="http://www.w3.org/1999/xhtml">Essentially, the SRP means that a single class should hold one, and only one, responsibility, leading me to the following quote:</span></p>
<blockquote>
<em><span class="koboSpan" id="kobo.73.1" xmlns="http://www.w3.org/1999/xhtml">“There should never be more than one reason for a class to change.”— Robert C. </span><span class="koboSpan" id="kobo.73.2" xmlns="http://www.w3.org/1999/xhtml">Martin, originator of the single responsibility principle</span></em>
</blockquote>
<p><span class="koboSpan" id="kobo.74.1" xmlns="http://www.w3.org/1999/xhtml">OK, but why? </span><span class="koboSpan" id="kobo.74.2" xmlns="http://www.w3.org/1999/xhtml">Before answering, take a moment to remember a project you’ve worked on where someone changed one or more requirements along the way. </span><span class="koboSpan" id="kobo.74.3" xmlns="http://www.w3.org/1999/xhtml">I recall several projects that would have benefited from this principle. </span><span class="koboSpan" id="kobo.74.4" xmlns="http://www.w3.org/1999/xhtml">Now, imagine how much simpler it would have been if each part of your system had just one job: one reason to change.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.75.1" xmlns="http://www.w3.org/1999/xhtml">Software maintainability problems can be due to both tech and non-tech people. </span><span class="koboSpan" id="kobo.75.2" xmlns="http://www.w3.org/1999/xhtml">Nothing is purely black or white—most things are a shade of gray. </span><span class="koboSpan" id="kobo.75.3" xmlns="http://www.w3.org/1999/xhtml">The same applies to software design: always do your best, learn from your mistakes, and stay humble (a.k.a. </span><span class="koboSpan" id="kobo.75.4" xmlns="http://www.w3.org/1999/xhtml">continuous improvement).</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.76.1" xmlns="http://www.w3.org/1999/xhtml">By understanding that applications are born to change, you will feel better when that happens, while the SRP helps mitigate the impact of changes. </span><span class="koboSpan" id="kobo.76.2" xmlns="http://www.w3.org/1999/xhtml">For example, it helps make our classes more readable and reusable and to create more flexible and maintainable systems. </span><span class="koboSpan" id="kobo.76.3" xmlns="http://www.w3.org/1999/xhtml">Moreover, when a class does only one thing, it’s easier to see how changes will affect the system, which is more challenging with complex classes since one change might break other parts. </span><span class="koboSpan" id="kobo.76.4" xmlns="http://www.w3.org/1999/xhtml">Furthermore, fewer responsibilities mean less code. </span><span class="koboSpan" id="kobo.76.5" xmlns="http://www.w3.org/1999/xhtml">Less code is easier to understand, helping you grasp that part of the software more quickly.Let’s try this out in action.</span></p>
<section class="level4" data-number="4.5.1.1" id="project-single-responsibility">
<h4 data-number="4.5.1.1"><span class="koboSpan" id="kobo.77.1" xmlns="http://www.w3.org/1999/xhtml">Project – Single Responsibility</span></h4>
<p><span class="koboSpan" id="kobo.78.1" xmlns="http://www.w3.org/1999/xhtml">First, we look at the </span><code><span class="koboSpan" id="kobo.79.1" xmlns="http://www.w3.org/1999/xhtml">Product</span></code><span class="koboSpan" id="kobo.80.1" xmlns="http://www.w3.org/1999/xhtml"> class used in both code samples. </span><span class="koboSpan" id="kobo.80.2" xmlns="http://www.w3.org/1999/xhtml">That class represents a simple fictive product:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.81.1" xmlns="http://www.w3.org/1999/xhtml">public record class Product(int Id, string Name);</span></code></pre>
</div>
<blockquote>
<p><span class="koboSpan" id="kobo.82.1" xmlns="http://www.w3.org/1999/xhtml">The code sample has no implementation because it is irrelevant to understanding the SRP. </span><span class="koboSpan" id="kobo.82.2" xmlns="http://www.w3.org/1999/xhtml">We focus on the class API instead. </span><span class="koboSpan" id="kobo.82.3" xmlns="http://www.w3.org/1999/xhtml">Please assume we implemented the data-access logic using your favorite database.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.83.1" xmlns="http://www.w3.org/1999/xhtml">The following class breaks the SRP:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.84.1" xmlns="http://www.w3.org/1999/xhtml">namespace BeforeSRP;
public class ProductRepository
{
    public ValueTask&lt;Product&gt; GetOnePublicProductAsync(int productId)
        =&gt; throw new NotImplementedException();
    public ValueTask&lt;Product&gt; GetOnePrivateProductAsync(int productId)
        =&gt; throw new NotImplementedException();
    public ValueTask&lt;IEnumerable&lt;Product&gt;&gt; GetAllPublicProductsAsync()
        =&gt; throw new NotImplementedException();
    public ValueTask&lt;IEnumerable&lt;Product&gt;&gt; GetAllPrivateProductsAsync()
        =&gt; throw new NotImplementedException();
    public ValueTask CreateAsync(Product product)
        =&gt; throw new NotImplementedException();
    public ValueTask UpdateAsync(Product product)
        =&gt; throw new NotImplementedException();
    public ValueTask DeleteAsync(Product product)
        =&gt; throw new NotImplementedException();
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.85.1" xmlns="http://www.w3.org/1999/xhtml">What does not conform to the SRP in the preceding class? </span><span class="koboSpan" id="kobo.85.2" xmlns="http://www.w3.org/1999/xhtml">By reading the name of the methods, we can extract two responsibilities:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.86.1" xmlns="http://www.w3.org/1999/xhtml">Handling public products (highlighted code).</span></li>
<li><span class="koboSpan" id="kobo.87.1" xmlns="http://www.w3.org/1999/xhtml">Handling private products.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.88.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.89.1" xmlns="http://www.w3.org/1999/xhtml">ProductRepository</span></code><span class="koboSpan" id="kobo.90.1" xmlns="http://www.w3.org/1999/xhtml"> class mixes public and private product logic. </span><span class="koboSpan" id="kobo.90.2" xmlns="http://www.w3.org/1999/xhtml">From that API alone, there are many possibilities where an error could lead to leaking restricted data to public users. </span><span class="koboSpan" id="kobo.90.3" xmlns="http://www.w3.org/1999/xhtml">That is also true because the class exposes the private logic to the public-facing consumers; someone else could make a mistake.We are ready to rethink the class now that we identified the responsibilities. </span><span class="koboSpan" id="kobo.90.4" xmlns="http://www.w3.org/1999/xhtml">We know it has two responsibilities, so breaking the class into two sounds like an excellent first step. </span><span class="koboSpan" id="kobo.90.5" xmlns="http://www.w3.org/1999/xhtml">Let’s start with extracting a public API:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.91.1" xmlns="http://www.w3.org/1999/xhtml">namespace AfterSRP;
public class PublicProductReader
{
    public ValueTask&lt;IEnumerable&lt;Product&gt;&gt; GetAllAsync()
        =&gt; throw new NotImplementedException();
    public ValueTask&lt;Product&gt; GetOneAsync(int productId)
        =&gt; throw new NotImplementedException();
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.92.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.93.1" xmlns="http://www.w3.org/1999/xhtml">PublicProductReader</span></code><span class="koboSpan" id="kobo.94.1" xmlns="http://www.w3.org/1999/xhtml"> class now contains only two methods: </span><code><span class="koboSpan" id="kobo.95.1" xmlns="http://www.w3.org/1999/xhtml">GetAllAsync</span></code><span class="koboSpan" id="kobo.96.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.97.1" xmlns="http://www.w3.org/1999/xhtml">GetOneAsync</span></code><span class="koboSpan" id="kobo.98.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.98.2" xmlns="http://www.w3.org/1999/xhtml">When reading the name of the class and its methods, it is clear that the class handles only public product data. </span><span class="koboSpan" id="kobo.98.3" xmlns="http://www.w3.org/1999/xhtml">By lowering the complexity of the class, we made it easier to understandNext, let’s do the same for the private products:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.99.1" xmlns="http://www.w3.org/1999/xhtml">namespace AfterSRP;
public class PrivateProductRepository
{
    public ValueTask&lt;IEnumerable&lt;Product&gt;&gt; GetAllAsync()
        =&gt; throw new NotImplementedException();
    public ValueTask&lt;Product&gt; GetOneAsync(int productId)
        =&gt; throw new NotImplementedException();
    public ValueTask CreateAsync(Product product)
        =&gt; throw new NotImplementedException();
    public ValueTask DeleteAsync(Product product)
        =&gt; throw new NotImplementedException();
    public ValueTask UpdateAsync(Product product)
        =&gt; throw new NotImplementedException();
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.100.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.101.1" xmlns="http://www.w3.org/1999/xhtml">PrivateProductRepository</span></code><span class="koboSpan" id="kobo.102.1" xmlns="http://www.w3.org/1999/xhtml"> class follows the same pattern. </span><span class="koboSpan" id="kobo.102.2" xmlns="http://www.w3.org/1999/xhtml">It includes the read methods, named the same as the </span><code><span class="koboSpan" id="kobo.103.1" xmlns="http://www.w3.org/1999/xhtml">PublicProductReader</span></code><span class="koboSpan" id="kobo.104.1" xmlns="http://www.w3.org/1999/xhtml"> class, and the mutation methods only users with private access can use.We improved our code’s readability, flexibility, and security by splitting the initial class into two. </span><span class="koboSpan" id="kobo.104.2" xmlns="http://www.w3.org/1999/xhtml">However, one thing to be careful about with the SRP is not to over-separate classes. </span><span class="koboSpan" id="kobo.104.3" xmlns="http://www.w3.org/1999/xhtml">The more classes in a system, the more complex assembling the system can become, and the harder it can be to debug and follow the execution paths. </span><span class="koboSpan" id="kobo.104.4" xmlns="http://www.w3.org/1999/xhtml">On the other hand, many well-separated responsibilities should lead to a better, more testable system.It is tough to define one hard rule that defines “one reason” or “a single responsibility”. </span><span class="koboSpan" id="kobo.104.5" xmlns="http://www.w3.org/1999/xhtml">However, as a rule of thumb, aim at packing a cohesive set of functionalities in a single class that revolves around its responsibility. </span><span class="koboSpan" id="kobo.104.6" xmlns="http://www.w3.org/1999/xhtml">You should strip out any excess logic and add missing pieces.A good indicator of the SRP violation is when you don’t know how to name an element, which points towards the fact that the element should not reside there, that you should extract it, or that you should split it into multiple smaller pieces.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.105.1" xmlns="http://www.w3.org/1999/xhtml">Using precise names for variables, methods, classes, and other elements is very important and should not be overlooked.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.106.1" xmlns="http://www.w3.org/1999/xhtml">Another good indicator is when a method becomes too big, maybe containing many </span><code><span class="koboSpan" id="kobo.107.1" xmlns="http://www.w3.org/1999/xhtml">if</span></code><span class="koboSpan" id="kobo.108.1" xmlns="http://www.w3.org/1999/xhtml"> statements or loops. </span><span class="koboSpan" id="kobo.108.2" xmlns="http://www.w3.org/1999/xhtml">In that case, you can split that method into multiple smaller methods, classes, or any other construct that suits your requirements. </span><span class="koboSpan" id="kobo.108.3" xmlns="http://www.w3.org/1999/xhtml">That should make the code easier to read and make the initial method’s body cleaner. </span><span class="koboSpan" id="kobo.108.4" xmlns="http://www.w3.org/1999/xhtml">It often also helps you get rid of useless comments and improve testability. </span><span class="koboSpan" id="kobo.108.5" xmlns="http://www.w3.org/1999/xhtml">Next, we explore how to change behaviors without modifying code, but before that, let’s look at interfaces.</span></p>
</section>
</section>
<section class="level3" data-number="4.5.2" id="openclosed-principle-ocp">
<h3 data-number="4.5.2"><span class="koboSpan" id="kobo.109.1" xmlns="http://www.w3.org/1999/xhtml">Open/Closed principle (OCP)</span></h3>
<p><span class="koboSpan" id="kobo.110.1" xmlns="http://www.w3.org/1999/xhtml">Let’s start this section with a quote from Bertrand Meyer, the person who first wrote the term open/closed principle in 1988:</span></p>
<blockquote>
<em><span class="koboSpan" id="kobo.111.1" xmlns="http://www.w3.org/1999/xhtml">“Software entities (classes, modules, functions, and so on) should be open for extension but closed for modification.”</span></em>
</blockquote>
<p><span class="koboSpan" id="kobo.112.1" xmlns="http://www.w3.org/1999/xhtml">OK, but what does that mean? </span><span class="koboSpan" id="kobo.112.2" xmlns="http://www.w3.org/1999/xhtml">It means you should be able to change the class behaviors from the outside without altering the code.As a bit of history, the first appearance of the OCP in 1988 referred to inheritance, and OOP has evolved a lot since then. </span><span class="koboSpan" id="kobo.112.3" xmlns="http://www.w3.org/1999/xhtml">Inheritance is still useful, but you should be careful as it is easily misused. </span><span class="koboSpan" id="kobo.112.4" xmlns="http://www.w3.org/1999/xhtml">Inheritance creates direct coupling between classes. </span><span class="koboSpan" id="kobo.112.5" xmlns="http://www.w3.org/1999/xhtml">You should, most of the time, opt for composition over inheritance.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.113.1" xmlns="http://www.w3.org/1999/xhtml">“Composition over inheritance” is a principle that suggests it’s better to build objects by combining simple, flexible parts (composition) rather than by inheriting properties from a larger, more complex object (inheritance).</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.114.1" xmlns="http://www.w3.org/1999/xhtml">Think of it like building with LEGO® blocks. </span><span class="koboSpan" id="kobo.114.2" xmlns="http://www.w3.org/1999/xhtml">It’s easier to build and adjust your creation if you put together small blocks (composition) rather than trying to alter a big, single block that already has a fixed shape (inheritance).</span></p>
</blockquote>
</blockquote>
<p><span class="koboSpan" id="kobo.115.1" xmlns="http://www.w3.org/1999/xhtml">Meanwhile, we explore three versions of a business process to illustrate the OCP.</span></p>
<section class="level4" data-number="4.5.2.1" id="project-open-close">
<h4 data-number="4.5.2.1"><span class="koboSpan" id="kobo.116.1" xmlns="http://www.w3.org/1999/xhtml">Project – Open Close</span></h4>
<p><span class="koboSpan" id="kobo.117.1" xmlns="http://www.w3.org/1999/xhtml">First, we look at the </span><code><span class="koboSpan" id="kobo.118.1" xmlns="http://www.w3.org/1999/xhtml">Entity</span></code><span class="koboSpan" id="kobo.119.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.120.1" xmlns="http://www.w3.org/1999/xhtml">EntityRepository</span></code><span class="koboSpan" id="kobo.121.1" xmlns="http://www.w3.org/1999/xhtml"> classes used in the code samples:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.122.1" xmlns="http://www.w3.org/1999/xhtml">public record class Entity();
public class EntityRepository
{
    public virtual Task CreateAsync(Entity entity)
        =&gt; throw new NotImplementedException();
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.123.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.124.1" xmlns="http://www.w3.org/1999/xhtml">Entity</span></code><span class="koboSpan" id="kobo.125.1" xmlns="http://www.w3.org/1999/xhtml"> class represents a simple fictive entity with no properties; consider it anything you’d like. </span><span class="koboSpan" id="kobo.125.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.126.1" xmlns="http://www.w3.org/1999/xhtml">EntityRepository</span></code><span class="koboSpan" id="kobo.127.1" xmlns="http://www.w3.org/1999/xhtml"> class has a single </span><code><span class="koboSpan" id="kobo.128.1" xmlns="http://www.w3.org/1999/xhtml">CreateAsync</span></code><span class="koboSpan" id="kobo.129.1" xmlns="http://www.w3.org/1999/xhtml"> method that inserts an instance of an </span><code><span class="koboSpan" id="kobo.130.1" xmlns="http://www.w3.org/1999/xhtml">Entity</span></code><span class="koboSpan" id="kobo.131.1" xmlns="http://www.w3.org/1999/xhtml"> in a database (if it was implemented).</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.132.1" xmlns="http://www.w3.org/1999/xhtml">The code sample has few implementation details because it is irrelevant to understanding the OCP. </span><span class="koboSpan" id="kobo.132.2" xmlns="http://www.w3.org/1999/xhtml">Please assume we implemented the </span><code><span class="koboSpan" id="kobo.133.1" xmlns="http://www.w3.org/1999/xhtml">CreateAsync</span></code><span class="koboSpan" id="kobo.134.1" xmlns="http://www.w3.org/1999/xhtml"> logic using your favorite database.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.135.1" xmlns="http://www.w3.org/1999/xhtml">For the rest of the sample, we refactor the </span><code><span class="koboSpan" id="kobo.136.1" xmlns="http://www.w3.org/1999/xhtml">EntityService</span></code><span class="koboSpan" id="kobo.137.1" xmlns="http://www.w3.org/1999/xhtml"> class, beginning with a version that inherits the </span><code><span class="koboSpan" id="kobo.138.1" xmlns="http://www.w3.org/1999/xhtml">EntityRepository</span></code><span class="koboSpan" id="kobo.139.1" xmlns="http://www.w3.org/1999/xhtml"> class, breaking the OCP:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.140.1" xmlns="http://www.w3.org/1999/xhtml">namespace OCP.NoComposability;
public class EntityService : EntityRepository
{
    public async Task ComplexBusinessProcessAsync(Entity entity)
    {
        // Do some complex things here
        await CreateAsync(entity);
        // Do more complex things here
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.141.1" xmlns="http://www.w3.org/1999/xhtml">As the namespace implies, the preceding </span><code><span class="koboSpan" id="kobo.142.1" xmlns="http://www.w3.org/1999/xhtml">EntityService</span></code><span class="koboSpan" id="kobo.143.1" xmlns="http://www.w3.org/1999/xhtml"> class offers no composability. </span><span class="koboSpan" id="kobo.143.2" xmlns="http://www.w3.org/1999/xhtml">Moreover, we tightly coupled it with the </span><code><span class="koboSpan" id="kobo.144.1" xmlns="http://www.w3.org/1999/xhtml">EntityRepository </span></code><span class="koboSpan" id="kobo.145.1" xmlns="http://www.w3.org/1999/xhtml">class. </span><span class="koboSpan" id="kobo.145.2" xmlns="http://www.w3.org/1999/xhtml">Since we just covered the </span><em><span class="koboSpan" id="kobo.146.1" xmlns="http://www.w3.org/1999/xhtml">composition over inheritance</span></em><span class="koboSpan" id="kobo.147.1" xmlns="http://www.w3.org/1999/xhtml"> principle, we can quickly isolate the problem: </span><strong><span class="koboSpan" id="kobo.148.1" xmlns="http://www.w3.org/1999/xhtml">inheritance</span></strong><span class="koboSpan" id="kobo.149.1" xmlns="http://www.w3.org/1999/xhtml">.As the next step to fix this mess, let’s extract a private </span><code><span class="koboSpan" id="kobo.150.1" xmlns="http://www.w3.org/1999/xhtml">_repository</span></code><span class="koboSpan" id="kobo.151.1" xmlns="http://www.w3.org/1999/xhtml"> field to hold an </span><code><span class="koboSpan" id="kobo.152.1" xmlns="http://www.w3.org/1999/xhtml">EntityRepository</span></code><span class="koboSpan" id="kobo.153.1" xmlns="http://www.w3.org/1999/xhtml"> instance instead:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.154.1" xmlns="http://www.w3.org/1999/xhtml">namespace OCP.Composability;
public class EntityService
{
    private readonly EntityRepository _repository
        = new EntityRepository();
    public async Task ComplexBusinessProcessAsync(Entity entity)
    {
        // Do some complex things here
        await _repository.CreateAsync(entity);
        // Do more complex things here
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.155.1" xmlns="http://www.w3.org/1999/xhtml">Now the </span><code><span class="koboSpan" id="kobo.156.1" xmlns="http://www.w3.org/1999/xhtml">EntityService</span></code><span class="koboSpan" id="kobo.157.1" xmlns="http://www.w3.org/1999/xhtml"> is composed of an </span><code><span class="koboSpan" id="kobo.158.1" xmlns="http://www.w3.org/1999/xhtml">EntityRepository</span></code><span class="koboSpan" id="kobo.159.1" xmlns="http://www.w3.org/1999/xhtml"> instance, and there is no more inheritance. </span><span class="koboSpan" id="kobo.159.2" xmlns="http://www.w3.org/1999/xhtml">However, we still tightly coupled both classes, and it is impossible to change the behavior of the </span><code><span class="koboSpan" id="kobo.160.1" xmlns="http://www.w3.org/1999/xhtml">EntityService</span></code><span class="koboSpan" id="kobo.161.1" xmlns="http://www.w3.org/1999/xhtml"> this way without changing its code.To fix our last issues, we can inject an </span><code><span class="koboSpan" id="kobo.162.1" xmlns="http://www.w3.org/1999/xhtml">EntityRepository</span></code><span class="koboSpan" id="kobo.163.1" xmlns="http://www.w3.org/1999/xhtml"> instance into the class constructor where we set our private field like this:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.164.1" xmlns="http://www.w3.org/1999/xhtml">namespace OCP.DependencyInjection;
public class EntityService
{
    private readonly EntityRepository _repository;
    public EntityService(EntityRepository repository)
    {
        _repository = repository;
    }
    public async Task ComplexBusinessProcessAsync(Entity entity)
    {
        // Do some complex things here
        await _repository.CreateAsync(entity);
        // Do more complex things here
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.165.1" xmlns="http://www.w3.org/1999/xhtml">With the preceding change, we broke the tight coupling between the </span><code><span class="koboSpan" id="kobo.166.1" xmlns="http://www.w3.org/1999/xhtml">EntityService</span></code><span class="koboSpan" id="kobo.167.1" xmlns="http://www.w3.org/1999/xhtml"> and the </span><code><span class="koboSpan" id="kobo.168.1" xmlns="http://www.w3.org/1999/xhtml">EntityRepository</span></code><span class="koboSpan" id="kobo.169.1" xmlns="http://www.w3.org/1999/xhtml"> classes. </span><span class="koboSpan" id="kobo.169.2" xmlns="http://www.w3.org/1999/xhtml">We can also control the behavior of the </span><code><span class="koboSpan" id="kobo.170.1" xmlns="http://www.w3.org/1999/xhtml">EntityService</span></code><span class="koboSpan" id="kobo.171.1" xmlns="http://www.w3.org/1999/xhtml"> class from the outside by deciding what instance of the </span><code><span class="koboSpan" id="kobo.172.1" xmlns="http://www.w3.org/1999/xhtml">EntityRepository</span></code><span class="koboSpan" id="kobo.173.1" xmlns="http://www.w3.org/1999/xhtml"> class we inject into the </span><code><span class="koboSpan" id="kobo.174.1" xmlns="http://www.w3.org/1999/xhtml">EntityService</span></code><span class="koboSpan" id="kobo.175.1" xmlns="http://www.w3.org/1999/xhtml"> constructor. </span><span class="koboSpan" id="kobo.175.2" xmlns="http://www.w3.org/1999/xhtml">We could even go further by leveraging an abstraction instead of a concrete class and explore this subsequently while covering the DIP.As we just explored, the OCP is a super powerful principle, yet simple, that allows controlling an object from the outside. </span><span class="koboSpan" id="kobo.175.3" xmlns="http://www.w3.org/1999/xhtml">For example, we could create two instances of the </span><code><span class="koboSpan" id="kobo.176.1" xmlns="http://www.w3.org/1999/xhtml">EntityService</span></code><span class="koboSpan" id="kobo.177.1" xmlns="http://www.w3.org/1999/xhtml"> class with different </span><code><span class="koboSpan" id="kobo.178.1" xmlns="http://www.w3.org/1999/xhtml">EntityRepository</span></code><span class="koboSpan" id="kobo.179.1" xmlns="http://www.w3.org/1999/xhtml"> instances that connect to different databases. </span><span class="koboSpan" id="kobo.179.2" xmlns="http://www.w3.org/1999/xhtml">Here’s a rough example:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.180.1" xmlns="http://www.w3.org/1999/xhtml">using OCP;
using OCP.DependencyInjection;
// Create the entity in database 1
var repository1 = new EntityRepository(/* connection string 1 */);
var service1 = new EntityService(repository1);
// Create the entity in database 2
var repository2 = new EntityRepository(/* connection string 2 */);
var service2 = new EntityService(repository2);
// Save an entity in two different databases
var entity = new Entity();
await service1.ComplexBusinessProcessAsync(entity);
await service2.ComplexBusinessProcessAsync(entity);</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.181.1" xmlns="http://www.w3.org/1999/xhtml">In the preceding code, assuming we implemented the </span><code><span class="koboSpan" id="kobo.182.1" xmlns="http://www.w3.org/1999/xhtml">EntityRepository</span></code><span class="koboSpan" id="kobo.183.1" xmlns="http://www.w3.org/1999/xhtml"> class and configured </span><code><span class="koboSpan" id="kobo.184.1" xmlns="http://www.w3.org/1999/xhtml">repository1</span></code><span class="koboSpan" id="kobo.185.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.186.1" xmlns="http://www.w3.org/1999/xhtml">repository2</span></code><span class="koboSpan" id="kobo.187.1" xmlns="http://www.w3.org/1999/xhtml"> differently, the result of executing the </span><code><span class="koboSpan" id="kobo.188.1" xmlns="http://www.w3.org/1999/xhtml">ComplexBusinessProcessAsync</span></code><span class="koboSpan" id="kobo.189.1" xmlns="http://www.w3.org/1999/xhtml"> method on </span><code><span class="koboSpan" id="kobo.190.1" xmlns="http://www.w3.org/1999/xhtml">service1</span></code><span class="koboSpan" id="kobo.191.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.192.1" xmlns="http://www.w3.org/1999/xhtml">service2</span></code><span class="koboSpan" id="kobo.193.1" xmlns="http://www.w3.org/1999/xhtml"> would create the entity in two different databases. </span><span class="koboSpan" id="kobo.193.2" xmlns="http://www.w3.org/1999/xhtml">The behavior change between the two instances happened without changing the code of the </span><code><span class="koboSpan" id="kobo.194.1" xmlns="http://www.w3.org/1999/xhtml">EntityService</span></code><span class="koboSpan" id="kobo.195.1" xmlns="http://www.w3.org/1999/xhtml"> class; composition: 1, inheritance: 0.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.196.1" xmlns="http://www.w3.org/1999/xhtml">We explore the </span><strong><span class="koboSpan" id="kobo.197.1" xmlns="http://www.w3.org/1999/xhtml">Strategy pattern</span></strong><span class="koboSpan" id="kobo.198.1" xmlns="http://www.w3.org/1999/xhtml">—the best way of implementing the OCP—in </span><em><span class="koboSpan" id="kobo.199.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 5</span></em><span class="koboSpan" id="kobo.200.1" xmlns="http://www.w3.org/1999/xhtml">, </span><em><span class="koboSpan" id="kobo.201.1" xmlns="http://www.w3.org/1999/xhtml">Strategy, Abstract Factory, and Singleton</span></em><span class="koboSpan" id="kobo.202.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.202.2" xmlns="http://www.w3.org/1999/xhtml">We revisit that pattern and also learn to assemble our program’s well-designed pieces and sew them together using dependency injection in </span><em><span class="koboSpan" id="kobo.203.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 6</span></em><span class="koboSpan" id="kobo.204.1" xmlns="http://www.w3.org/1999/xhtml">, </span><em><span class="koboSpan" id="kobo.205.1" xmlns="http://www.w3.org/1999/xhtml">Dependency Injection</span></em><span class="koboSpan" id="kobo.206.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.207.1" xmlns="http://www.w3.org/1999/xhtml">Next, we explore the principle we can perceive as the most complex of the five, yet the one we will use the less.</span></p>
</section>
</section>
<section class="level3" data-number="4.5.3" id="liskov-substitution-principle-lsp">
<h3 data-number="4.5.3"><span class="koboSpan" id="kobo.208.1" xmlns="http://www.w3.org/1999/xhtml">Liskov substitution principle (LSP)</span></h3>
<p><span class="koboSpan" id="kobo.209.1" xmlns="http://www.w3.org/1999/xhtml">The Liskov Substitution Principle (LSP) states that in a program, if we replace an instance of a superclass (supertype) with an instance of a subclass (subtype), the program should not break or behave unexpectedly.Imagine we have a base class called </span><code><span class="koboSpan" id="kobo.210.1" xmlns="http://www.w3.org/1999/xhtml">Bird</span></code><span class="koboSpan" id="kobo.211.1" xmlns="http://www.w3.org/1999/xhtml"> with a function called </span><code><span class="koboSpan" id="kobo.212.1" xmlns="http://www.w3.org/1999/xhtml">Fly</span></code><span class="koboSpan" id="kobo.213.1" xmlns="http://www.w3.org/1999/xhtml">, and we add the </span><code><span class="koboSpan" id="kobo.214.1" xmlns="http://www.w3.org/1999/xhtml">Eagle</span></code><span class="koboSpan" id="kobo.215.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.216.1" xmlns="http://www.w3.org/1999/xhtml">Penguin</span></code><span class="koboSpan" id="kobo.217.1" xmlns="http://www.w3.org/1999/xhtml"> subclasses. </span><span class="koboSpan" id="kobo.217.2" xmlns="http://www.w3.org/1999/xhtml">Since a penguin can’t fly, replacing an instance of the </span><code><span class="koboSpan" id="kobo.218.1" xmlns="http://www.w3.org/1999/xhtml">Bird</span></code><span class="koboSpan" id="kobo.219.1" xmlns="http://www.w3.org/1999/xhtml"> class with an instance of the </span><code><span class="koboSpan" id="kobo.220.1" xmlns="http://www.w3.org/1999/xhtml">Penguin</span></code><span class="koboSpan" id="kobo.221.1" xmlns="http://www.w3.org/1999/xhtml"> subclass might cause problems because the program expects all birds to be able to fly.So, according to the LSP, our subclasses should behave so the program can still work correctly, even if it doesn’t know which subclass it’s using, preserving system stability.Before moving on with the LSP, let’s look at covariance and contravariance.</span></p>
<section class="level4" data-number="4.5.3.1" id="covariance-and-contravariance">
<h4 data-number="4.5.3.1"><span class="koboSpan" id="kobo.222.1" xmlns="http://www.w3.org/1999/xhtml">Covariance and contravariance</span></h4>
<p><span class="koboSpan" id="kobo.223.1" xmlns="http://www.w3.org/1999/xhtml">We won’t go too deep into this, so we don’t move too far away from the LSP, but since the formal definition mentions them, we must understand these at least a minimum.Covariance and contravariance represent specific polymorphic scenarios. </span><span class="koboSpan" id="kobo.223.2" xmlns="http://www.w3.org/1999/xhtml">They allow reference types to be converted into other types implicitly. </span><span class="koboSpan" id="kobo.223.3" xmlns="http://www.w3.org/1999/xhtml">They apply to generic type arguments, delegates, and array types. </span><span class="koboSpan" id="kobo.223.4" xmlns="http://www.w3.org/1999/xhtml">Chances are, you will never need to remember this, as most of it is implicit, yet, here’s an overview:</span></p>
<ul>
<li><strong><span class="koboSpan" id="kobo.224.1" xmlns="http://www.w3.org/1999/xhtml">Covariance (</span></strong><code><span class="koboSpan" id="kobo.225.1" xmlns="http://www.w3.org/1999/xhtml">out</span></code><strong><span class="koboSpan" id="kobo.226.1" xmlns="http://www.w3.org/1999/xhtml">)</span></strong><span class="koboSpan" id="kobo.227.1" xmlns="http://www.w3.org/1999/xhtml"> enables us to use a more derived type (a subtype) instead of the supertype. </span><span class="koboSpan" id="kobo.227.2" xmlns="http://www.w3.org/1999/xhtml">Covariance is usually applicable to method return types. </span><span class="koboSpan" id="kobo.227.3" xmlns="http://www.w3.org/1999/xhtml">For instance, if a base class method returns an instance of a class, the equivalent method of a derived class can return an instance of a subclass.</span></li>
<li><strong><span class="koboSpan" id="kobo.228.1" xmlns="http://www.w3.org/1999/xhtml">Contravariance (</span></strong><code><span class="koboSpan" id="kobo.229.1" xmlns="http://www.w3.org/1999/xhtml">in</span></code><strong><span class="koboSpan" id="kobo.230.1" xmlns="http://www.w3.org/1999/xhtml">)</span></strong><span class="koboSpan" id="kobo.231.1" xmlns="http://www.w3.org/1999/xhtml"> is the reverse situation. </span><span class="koboSpan" id="kobo.231.2" xmlns="http://www.w3.org/1999/xhtml">It allows a less derived type (a supertype) to be used instead of the subtype. </span><span class="koboSpan" id="kobo.231.3" xmlns="http://www.w3.org/1999/xhtml">Contravariance is usually applicable to method argument types. </span><span class="koboSpan" id="kobo.231.4" xmlns="http://www.w3.org/1999/xhtml">If a method of a base class accepts a parameter of a particular class, the equivalent method of a derived class can accept a parameter of a superclass.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.232.1" xmlns="http://www.w3.org/1999/xhtml">Let’s use some code to understand this more, starting with the model we are using:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.233.1" xmlns="http://www.w3.org/1999/xhtml">public record class Weapon { }
public record class Sword : Weapon { }
public record class TwoHandedSword : Sword { }</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.234.1" xmlns="http://www.w3.org/1999/xhtml">Simple class hierarchy, we have a </span><code><span class="koboSpan" id="kobo.235.1" xmlns="http://www.w3.org/1999/xhtml">TwoHandedSword</span></code><span class="koboSpan" id="kobo.236.1" xmlns="http://www.w3.org/1999/xhtml"> class that inherits from the </span><code><span class="koboSpan" id="kobo.237.1" xmlns="http://www.w3.org/1999/xhtml">Sword</span></code><span class="koboSpan" id="kobo.238.1" xmlns="http://www.w3.org/1999/xhtml"> class and the </span><code><span class="koboSpan" id="kobo.239.1" xmlns="http://www.w3.org/1999/xhtml">Sword</span></code><span class="koboSpan" id="kobo.240.1" xmlns="http://www.w3.org/1999/xhtml"> class that inherits from the </span><code><span class="koboSpan" id="kobo.241.1" xmlns="http://www.w3.org/1999/xhtml">Weapon</span></code><span class="koboSpan" id="kobo.242.1" xmlns="http://www.w3.org/1999/xhtml"> class.</span></p>
<section class="level5" data-number="4.5.3.1.1" id="covariance">
<h5 data-number="4.5.3.1.1"><span class="koboSpan" id="kobo.243.1" xmlns="http://www.w3.org/1999/xhtml">Covariance</span></h5>
<p><span class="koboSpan" id="kobo.244.1" xmlns="http://www.w3.org/1999/xhtml">To demo covariance, we leverage the following generic interface:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.245.1" xmlns="http://www.w3.org/1999/xhtml">public interface ICovariant&lt;out T&gt;
{
    T Get();
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.246.1" xmlns="http://www.w3.org/1999/xhtml">In C#, the </span><code><span class="koboSpan" id="kobo.247.1" xmlns="http://www.w3.org/1999/xhtml">out</span></code><span class="koboSpan" id="kobo.248.1" xmlns="http://www.w3.org/1999/xhtml"> modifier, the highlighted code, explicitly specifies that the generic parameter </span><code><span class="koboSpan" id="kobo.249.1" xmlns="http://www.w3.org/1999/xhtml">T</span></code><span class="koboSpan" id="kobo.250.1" xmlns="http://www.w3.org/1999/xhtml"> is covariant. </span><span class="koboSpan" id="kobo.250.2" xmlns="http://www.w3.org/1999/xhtml">Covariance applies to return types, hence the </span><code><span class="koboSpan" id="kobo.251.1" xmlns="http://www.w3.org/1999/xhtml">Get</span></code><span class="koboSpan" id="kobo.252.1" xmlns="http://www.w3.org/1999/xhtml"> method that returns the generic type </span><code><span class="koboSpan" id="kobo.253.1" xmlns="http://www.w3.org/1999/xhtml">T</span></code><span class="koboSpan" id="kobo.254.1" xmlns="http://www.w3.org/1999/xhtml">.Before testing this out, we need an implementation. </span><span class="koboSpan" id="kobo.254.2" xmlns="http://www.w3.org/1999/xhtml">Here’s a barebone one:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.255.1" xmlns="http://www.w3.org/1999/xhtml">public class SwordGetter : ICovariant&lt;Sword&gt;
{
    private static readonly Sword _instance = new();
    public Sword Get() =&gt; _instance;
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.256.1" xmlns="http://www.w3.org/1999/xhtml">The highlighted code, which represents the </span><code><span class="koboSpan" id="kobo.257.1" xmlns="http://www.w3.org/1999/xhtml">T</span></code><span class="koboSpan" id="kobo.258.1" xmlns="http://www.w3.org/1999/xhtml"> parameter, is of type </span><code><span class="koboSpan" id="kobo.259.1" xmlns="http://www.w3.org/1999/xhtml">Sword</span></code><span class="koboSpan" id="kobo.260.1" xmlns="http://www.w3.org/1999/xhtml">, a subclass of </span><code><span class="koboSpan" id="kobo.261.1" xmlns="http://www.w3.org/1999/xhtml">Weapon</span></code><span class="koboSpan" id="kobo.262.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.262.2" xmlns="http://www.w3.org/1999/xhtml">Since covariance means you can </span><strong><span class="koboSpan" id="kobo.263.1" xmlns="http://www.w3.org/1999/xhtml">return (output) the instance of a subtype as its supertype</span></strong><span class="koboSpan" id="kobo.264.1" xmlns="http://www.w3.org/1999/xhtml">, using the </span><code><span class="koboSpan" id="kobo.265.1" xmlns="http://www.w3.org/1999/xhtml">Sword</span></code><span class="koboSpan" id="kobo.266.1" xmlns="http://www.w3.org/1999/xhtml"> subtype allows exploring this with the </span><code><span class="koboSpan" id="kobo.267.1" xmlns="http://www.w3.org/1999/xhtml">Weapon</span></code><span class="koboSpan" id="kobo.268.1" xmlns="http://www.w3.org/1999/xhtml"> supertype. </span><span class="koboSpan" id="kobo.268.2" xmlns="http://www.w3.org/1999/xhtml">Here’s the xUnit fact that demonstrates covariance:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.269.1" xmlns="http://www.w3.org/1999/xhtml">[Fact]
public void Generic_Covariance_tests()
{
    ICovariant&lt;Sword&gt; swordGetter = new SwordGetter();
    ICovariant&lt;Weapon&gt; weaponGetter = swordGetter;
    Assert.Same(swordGetter, weaponGetter);
    Sword sword = swordGetter.Get();
    Weapon weapon = weaponGetter.Get();
    var isSwordASword = Assert.IsType&lt;Sword&gt;(sword);
    var isWeaponASword = Assert.IsType&lt;Sword&gt;(weapon);
    Assert.NotNull(isSwordASword);
    Assert.NotNull(isWeaponASword);
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.270.1" xmlns="http://www.w3.org/1999/xhtml">The highlighted line represents covariance, showing that we can implicitly convert the </span><code><span class="koboSpan" id="kobo.271.1" xmlns="http://www.w3.org/1999/xhtml">ICovariant&lt;Sword&gt;</span></code><span class="koboSpan" id="kobo.272.1" xmlns="http://www.w3.org/1999/xhtml"> subtype to the </span><code><span class="koboSpan" id="kobo.273.1" xmlns="http://www.w3.org/1999/xhtml">ICovariant&lt;Weapon&gt;</span></code><span class="koboSpan" id="kobo.274.1" xmlns="http://www.w3.org/1999/xhtml"> supertype.The code after that showcases what happens with that polymorphic change. </span><span class="koboSpan" id="kobo.274.2" xmlns="http://www.w3.org/1999/xhtml">For example, the </span><code><span class="koboSpan" id="kobo.275.1" xmlns="http://www.w3.org/1999/xhtml">Get</span></code><span class="koboSpan" id="kobo.276.1" xmlns="http://www.w3.org/1999/xhtml"> method of the </span><code><span class="koboSpan" id="kobo.277.1" xmlns="http://www.w3.org/1999/xhtml">weaponGetter</span></code><span class="koboSpan" id="kobo.278.1" xmlns="http://www.w3.org/1999/xhtml"> object returns a </span><code><span class="koboSpan" id="kobo.279.1" xmlns="http://www.w3.org/1999/xhtml">Weapon</span></code><span class="koboSpan" id="kobo.280.1" xmlns="http://www.w3.org/1999/xhtml"> type, not a </span><code><span class="koboSpan" id="kobo.281.1" xmlns="http://www.w3.org/1999/xhtml">Sword</span></code><span class="koboSpan" id="kobo.282.1" xmlns="http://www.w3.org/1999/xhtml">, even if the underlying instance is a </span><code><span class="koboSpan" id="kobo.283.1" xmlns="http://www.w3.org/1999/xhtml">SwordGetter</span></code><span class="koboSpan" id="kobo.284.1" xmlns="http://www.w3.org/1999/xhtml"> object. </span><span class="koboSpan" id="kobo.284.2" xmlns="http://www.w3.org/1999/xhtml">However, that </span><code><span class="koboSpan" id="kobo.285.1" xmlns="http://www.w3.org/1999/xhtml">Weapon</span></code><span class="koboSpan" id="kobo.286.1" xmlns="http://www.w3.org/1999/xhtml"> is, in fact, a </span><code><span class="koboSpan" id="kobo.287.1" xmlns="http://www.w3.org/1999/xhtml">Sword</span></code><span class="koboSpan" id="kobo.288.1" xmlns="http://www.w3.org/1999/xhtml">, as the assertions demonstrate.Next, let’s explore contravariance.</span></p>
</section>
<section class="level5" data-number="4.5.3.1.2" id="contravariance">
<h5 data-number="4.5.3.1.2"><strong><span class="koboSpan" id="kobo.289.1" xmlns="http://www.w3.org/1999/xhtml">Contravariance</span></strong></h5>
<p><span class="koboSpan" id="kobo.290.1" xmlns="http://www.w3.org/1999/xhtml">To demo covariance, we leverage the following generic interface:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.291.1" xmlns="http://www.w3.org/1999/xhtml">public interface IContravariant&lt;in T&gt;
{
    void Set(T value);
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.292.1" xmlns="http://www.w3.org/1999/xhtml">In C#, the </span><code><span class="koboSpan" id="kobo.293.1" xmlns="http://www.w3.org/1999/xhtml">in</span></code><span class="koboSpan" id="kobo.294.1" xmlns="http://www.w3.org/1999/xhtml"> modifier, the highlighted code, explicitly specifies that the generic parameter </span><code><span class="koboSpan" id="kobo.295.1" xmlns="http://www.w3.org/1999/xhtml">T</span></code><span class="koboSpan" id="kobo.296.1" xmlns="http://www.w3.org/1999/xhtml"> is contravariant. </span><span class="koboSpan" id="kobo.296.2" xmlns="http://www.w3.org/1999/xhtml">Contravariance applies to input types, hence the </span><code><span class="koboSpan" id="kobo.297.1" xmlns="http://www.w3.org/1999/xhtml">Set</span></code><span class="koboSpan" id="kobo.298.1" xmlns="http://www.w3.org/1999/xhtml"> method that takes the generic type </span><code><span class="koboSpan" id="kobo.299.1" xmlns="http://www.w3.org/1999/xhtml">T</span></code><span class="koboSpan" id="kobo.300.1" xmlns="http://www.w3.org/1999/xhtml"> as a parameter.Before testing this out, we need an implementation. </span><span class="koboSpan" id="kobo.300.2" xmlns="http://www.w3.org/1999/xhtml">Here’s a barebone one:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.301.1" xmlns="http://www.w3.org/1999/xhtml">public class WeaponSetter : IContravariant&lt;Weapon&gt;
{
    private Weapon? </span><span class="koboSpan" id="kobo.301.2" xmlns="http://www.w3.org/1999/xhtml">_weapon;
    public void Set(Weapon value)
        =&gt; _weapon = value;
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.302.1" xmlns="http://www.w3.org/1999/xhtml">The highlighted code, which represents the </span><code><span class="koboSpan" id="kobo.303.1" xmlns="http://www.w3.org/1999/xhtml">T</span></code><span class="koboSpan" id="kobo.304.1" xmlns="http://www.w3.org/1999/xhtml"> parameter, is of type </span><code><span class="koboSpan" id="kobo.305.1" xmlns="http://www.w3.org/1999/xhtml">Weapon</span></code><span class="koboSpan" id="kobo.306.1" xmlns="http://www.w3.org/1999/xhtml">, the topmost class in our model; other classes derive from it. </span><span class="koboSpan" id="kobo.306.2" xmlns="http://www.w3.org/1999/xhtml">Since contravariance means you can </span><strong><span class="koboSpan" id="kobo.307.1" xmlns="http://www.w3.org/1999/xhtml">input the instance of a subtype as its supertype</span></strong><span class="koboSpan" id="kobo.308.1" xmlns="http://www.w3.org/1999/xhtml">, using the </span><code><span class="koboSpan" id="kobo.309.1" xmlns="http://www.w3.org/1999/xhtml">Weapon</span></code><span class="koboSpan" id="kobo.310.1" xmlns="http://www.w3.org/1999/xhtml"> supertype allows exploring this with the </span><code><span class="koboSpan" id="kobo.311.1" xmlns="http://www.w3.org/1999/xhtml">Sword</span></code><span class="koboSpan" id="kobo.312.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.313.1" xmlns="http://www.w3.org/1999/xhtml">TwoHandedSword</span></code><span class="koboSpan" id="kobo.314.1" xmlns="http://www.w3.org/1999/xhtml"> subtypes. </span><span class="koboSpan" id="kobo.314.2" xmlns="http://www.w3.org/1999/xhtml">Here’s the xUnit fact that demonstrates contravariance:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.315.1" xmlns="http://www.w3.org/1999/xhtml">[Fact]
public void Generic_Contravariance_tests()
{
    IContravariant&lt;Weapon&gt; weaponSetter = new WeaponSetter();
    IContravariant&lt;Sword&gt; swordSetter = weaponSetter;
    Assert.Same(swordSetter, weaponSetter);
    // Contravariance: Weapon &gt; Sword &gt; TwoHandedSword
    weaponSetter.Set(new Weapon());
    weaponSetter.Set(new Sword());
    weaponSetter.Set(new TwoHandedSword());
    // Contravariance: Sword &gt; TwoHandedSword
    swordSetter.Set(new Sword());
    swordSetter.Set(new TwoHandedSword());
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.316.1" xmlns="http://www.w3.org/1999/xhtml">The highlighted line represents contravariance. </span><span class="koboSpan" id="kobo.316.2" xmlns="http://www.w3.org/1999/xhtml">We can implicitly convert the </span><code><span class="koboSpan" id="kobo.317.1" xmlns="http://www.w3.org/1999/xhtml">IContravariant&lt;Weapon&gt;</span></code><span class="koboSpan" id="kobo.318.1" xmlns="http://www.w3.org/1999/xhtml"> supertype to the </span><code><span class="koboSpan" id="kobo.319.1" xmlns="http://www.w3.org/1999/xhtml">IContravariant&lt;Sword&gt;</span></code><span class="koboSpan" id="kobo.320.1" xmlns="http://www.w3.org/1999/xhtml"> subtype.The code after that showcases what happens with that polymorphic change. </span><span class="koboSpan" id="kobo.320.2" xmlns="http://www.w3.org/1999/xhtml">For example, the </span><code><span class="koboSpan" id="kobo.321.1" xmlns="http://www.w3.org/1999/xhtml">Set</span></code><span class="koboSpan" id="kobo.322.1" xmlns="http://www.w3.org/1999/xhtml"> method of the </span><code><span class="koboSpan" id="kobo.323.1" xmlns="http://www.w3.org/1999/xhtml">weaponSetter </span></code><span class="koboSpan" id="kobo.324.1" xmlns="http://www.w3.org/1999/xhtml">object can take a </span><code><span class="koboSpan" id="kobo.325.1" xmlns="http://www.w3.org/1999/xhtml">Weapon</span></code><span class="koboSpan" id="kobo.326.1" xmlns="http://www.w3.org/1999/xhtml">, a </span><strong><span class="koboSpan" id="kobo.327.1" xmlns="http://www.w3.org/1999/xhtml">Sword</span></strong><span class="koboSpan" id="kobo.328.1" xmlns="http://www.w3.org/1999/xhtml"> , or a </span><code><span class="koboSpan" id="kobo.329.1" xmlns="http://www.w3.org/1999/xhtml">TwoHandedSword</span></code><span class="koboSpan" id="kobo.330.1" xmlns="http://www.w3.org/1999/xhtml"> instance because they are all subtypes of the </span><code><span class="koboSpan" id="kobo.331.1" xmlns="http://www.w3.org/1999/xhtml">Weapon</span></code><span class="koboSpan" id="kobo.332.1" xmlns="http://www.w3.org/1999/xhtml"> type (or is the </span><code><span class="koboSpan" id="kobo.333.1" xmlns="http://www.w3.org/1999/xhtml">Weapon</span></code><span class="koboSpan" id="kobo.334.1" xmlns="http://www.w3.org/1999/xhtml"> type itself).The same happens with the </span><code><span class="koboSpan" id="kobo.335.1" xmlns="http://www.w3.org/1999/xhtml">swordSetter</span></code><span class="koboSpan" id="kobo.336.1" xmlns="http://www.w3.org/1999/xhtml"> instance, but it only takes a </span><code><span class="koboSpan" id="kobo.337.1" xmlns="http://www.w3.org/1999/xhtml">Sword</span></code><span class="koboSpan" id="kobo.338.1" xmlns="http://www.w3.org/1999/xhtml"> or a </span><code><span class="koboSpan" id="kobo.339.1" xmlns="http://www.w3.org/1999/xhtml">TwoHandedSword</span></code><span class="koboSpan" id="kobo.340.1" xmlns="http://www.w3.org/1999/xhtml"> instance, starting at the </span><code><span class="koboSpan" id="kobo.341.1" xmlns="http://www.w3.org/1999/xhtml">Sword</span></code><span class="koboSpan" id="kobo.342.1" xmlns="http://www.w3.org/1999/xhtml"> type in the inheritance hierarchy because the compiler considers the </span><code><span class="koboSpan" id="kobo.343.1" xmlns="http://www.w3.org/1999/xhtml">swordSetter</span></code><span class="koboSpan" id="kobo.344.1" xmlns="http://www.w3.org/1999/xhtml"> instance to be an </span><code><span class="koboSpan" id="kobo.345.1" xmlns="http://www.w3.org/1999/xhtml">IContravariant&lt;Sword&gt;</span></code><span class="koboSpan" id="kobo.346.1" xmlns="http://www.w3.org/1999/xhtml">, even if the underlying implementation is of the </span><code><span class="koboSpan" id="kobo.347.1" xmlns="http://www.w3.org/1999/xhtml">WeaponSetter</span></code><span class="koboSpan" id="kobo.348.1" xmlns="http://www.w3.org/1999/xhtml"> type.Writing the following yields a compiler error:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.349.1" xmlns="http://www.w3.org/1999/xhtml">swordSetter.Set(new Weapon());</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.350.1" xmlns="http://www.w3.org/1999/xhtml">The error is:</span></p>
<div class="C0-ConsolePACKT">
<pre><code><span class="koboSpan" id="kobo.351.1" xmlns="http://www.w3.org/1999/xhtml">Cannot convert from Variance.Weapon to Variance.Sword.</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.352.1" xmlns="http://www.w3.org/1999/xhtml">That means that for the compiler, </span><code><span class="koboSpan" id="kobo.353.1" xmlns="http://www.w3.org/1999/xhtml">swordSetter</span></code><span class="koboSpan" id="kobo.354.1" xmlns="http://www.w3.org/1999/xhtml"> is of type </span><code><span class="koboSpan" id="kobo.355.1" xmlns="http://www.w3.org/1999/xhtml">IContravariant&lt;Sword&gt;</span></code><span class="koboSpan" id="kobo.356.1" xmlns="http://www.w3.org/1999/xhtml">, not </span><code><span class="koboSpan" id="kobo.357.1" xmlns="http://www.w3.org/1999/xhtml">IContravariant&lt;Weapon&gt;</span></code><span class="koboSpan" id="kobo.358.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<blockquote>
<p><strong><span class="koboSpan" id="kobo.359.1" xmlns="http://www.w3.org/1999/xhtml">Note</span></strong></p>
<blockquote>
<p><span class="koboSpan" id="kobo.360.1" xmlns="http://www.w3.org/1999/xhtml">I left a link in the </span><em><span class="koboSpan" id="kobo.361.1" xmlns="http://www.w3.org/1999/xhtml">Further reading</span></em><span class="koboSpan" id="kobo.362.1" xmlns="http://www.w3.org/1999/xhtml"> section that explains covariance and contravariance if you want to know more since we just covered the basics here.</span></p>
</blockquote>
</blockquote>
<p><span class="koboSpan" id="kobo.363.1" xmlns="http://www.w3.org/1999/xhtml">Now that we grazed covariance and contravariance, we are ready to explore the formal version of the LSP.</span></p>
</section>
</section>
<section class="level4" data-number="4.5.3.2" id="the-lsp-explained">
<h4 data-number="4.5.3.2"><span class="koboSpan" id="kobo.364.1" xmlns="http://www.w3.org/1999/xhtml">The LSP explained</span></h4>
<p><span class="koboSpan" id="kobo.365.1" xmlns="http://www.w3.org/1999/xhtml">The LSP came from Barbara Liskov at the end of the ‘80s and was revisited during the ‘90s by both Liskov and Jeannette Wing to create the principle that we know and use today. </span><span class="koboSpan" id="kobo.365.2" xmlns="http://www.w3.org/1999/xhtml">It is also similar to </span><em><span class="koboSpan" id="kobo.366.1" xmlns="http://www.w3.org/1999/xhtml">Design by contract</span></em><span class="koboSpan" id="kobo.367.1" xmlns="http://www.w3.org/1999/xhtml">, by Bertrand Meyer.Next, let’s look at the formal subtype requirement definition:</span></p>
<blockquote>
<em><span class="koboSpan" id="kobo.368.1" xmlns="http://www.w3.org/1999/xhtml">Let </span><span class="koboSpan" id="kobo.369.1" xmlns="http://www.w3.org/1999/xhtml"><img src="../media/file12.png" alt="img"/></span><span class="koboSpan" id="kobo.370.1" xmlns="http://www.w3.org/1999/xhtml"> be a property provable about objects x of type T. </span><span class="koboSpan" id="kobo.370.2" xmlns="http://www.w3.org/1999/xhtml">Then, </span><span class="koboSpan" id="kobo.371.1" xmlns="http://www.w3.org/1999/xhtml"><img src="../media/file13.png" alt="img"/></span><span class="koboSpan" id="kobo.372.1" xmlns="http://www.w3.org/1999/xhtml"> should be true for objects y of type S, where S is a subtype of T.</span></em>
</blockquote>
<p><span class="koboSpan" id="kobo.373.1" xmlns="http://www.w3.org/1999/xhtml">In simpler words, if </span><code><span class="koboSpan" id="kobo.374.1" xmlns="http://www.w3.org/1999/xhtml">S</span></code><span class="koboSpan" id="kobo.375.1" xmlns="http://www.w3.org/1999/xhtml"> is a subtype of </span><code><span class="koboSpan" id="kobo.376.1" xmlns="http://www.w3.org/1999/xhtml">T</span></code><span class="koboSpan" id="kobo.377.1" xmlns="http://www.w3.org/1999/xhtml">, we can replace objects of type </span><code><span class="koboSpan" id="kobo.378.1" xmlns="http://www.w3.org/1999/xhtml">T</span></code><span class="koboSpan" id="kobo.379.1" xmlns="http://www.w3.org/1999/xhtml"> with objects of type </span><code><span class="koboSpan" id="kobo.380.1" xmlns="http://www.w3.org/1999/xhtml">S</span></code><span class="koboSpan" id="kobo.381.1" xmlns="http://www.w3.org/1999/xhtml"> without changing any of the expected behaviors of the program (correctness).The LSP adds the following signature requirements:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.382.1" xmlns="http://www.w3.org/1999/xhtml">The parameters of methods in subtypes must be contravariant.</span></li>
<li><span class="koboSpan" id="kobo.383.1" xmlns="http://www.w3.org/1999/xhtml">The return type of methods in subtypes must be covariant.</span></li>
<li><span class="koboSpan" id="kobo.384.1" xmlns="http://www.w3.org/1999/xhtml">You can’t throw a new type of exception in subtypes.</span></li>
</ul>
<blockquote>
<p><span class="koboSpan" id="kobo.385.1" xmlns="http://www.w3.org/1999/xhtml">The first two rules are tough to violate without effort in C#.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.386.1" xmlns="http://www.w3.org/1999/xhtml">Throwing a new type of exception in subtypes is also considered changing behaviors. </span><span class="koboSpan" id="kobo.386.2" xmlns="http://www.w3.org/1999/xhtml">You can, however, throw subtyped exceptions in subtypes because the existing consumers can handle them.</span></p>
</blockquote>
</blockquote>
<p><span class="koboSpan" id="kobo.387.1" xmlns="http://www.w3.org/1999/xhtml">The LSP also adds the following behavioral conditions:</span></p>
<table>
<colgroup>
<col style="width: 50%"/>
<col style="width: 50%"/>
</colgroup>
<tbody>
<tr class="odd">
<td><strong><span class="koboSpan" id="kobo.388.1" xmlns="http://www.w3.org/1999/xhtml">Conditions</span></strong></td>
<td><strong><span class="koboSpan" id="kobo.389.1" xmlns="http://www.w3.org/1999/xhtml">Examples</span></strong></td>
</tr>
<tr class="even">
<td><span class="koboSpan" id="kobo.390.1" xmlns="http://www.w3.org/1999/xhtml">Any precondition implemented in a supertype should yield the same outcome in its subtypes, but subtypes can be less strict about it, never more.</span></td>
<td><span class="koboSpan" id="kobo.391.1" xmlns="http://www.w3.org/1999/xhtml">If a supertype validates that an argument cannot be </span><code><span class="koboSpan" id="kobo.392.1" xmlns="http://www.w3.org/1999/xhtml">null</span></code><span class="koboSpan" id="kobo.393.1" xmlns="http://www.w3.org/1999/xhtml"> , the subtype could remove that validation but not add stricter validation rules.</span></td>
</tr>
<tr class="odd">
<td><span class="koboSpan" id="kobo.394.1" xmlns="http://www.w3.org/1999/xhtml">Any postcondition implemented in a supertype should yield the same outcome in its subtypes, but subtypes can be more strict about it, never less.</span></td>
<td><p><span class="koboSpan" id="kobo.395.1" xmlns="http://www.w3.org/1999/xhtml">If the supertype never returns </span><code><span class="koboSpan" id="kobo.396.1" xmlns="http://www.w3.org/1999/xhtml">null</span></code><span class="koboSpan" id="kobo.397.1" xmlns="http://www.w3.org/1999/xhtml">, the subtype should not return </span><code><span class="koboSpan" id="kobo.398.1" xmlns="http://www.w3.org/1999/xhtml">null</span></code><span class="koboSpan" id="kobo.399.1" xmlns="http://www.w3.org/1999/xhtml"> either or risk breaking the consumers of the object that are not testing for </span><code><span class="koboSpan" id="kobo.400.1" xmlns="http://www.w3.org/1999/xhtml">null</span></code><span class="koboSpan" id="kobo.401.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p><span class="koboSpan" id="kobo.402.1" xmlns="http://www.w3.org/1999/xhtml">If the supertype does not guarantee the returned value cannot be </span><code><span class="koboSpan" id="kobo.403.1" xmlns="http://www.w3.org/1999/xhtml">null</span></code><span class="koboSpan" id="kobo.404.1" xmlns="http://www.w3.org/1999/xhtml">, then a subtype could decide never to return </span><code><span class="koboSpan" id="kobo.405.1" xmlns="http://www.w3.org/1999/xhtml">null</span></code><span class="koboSpan" id="kobo.406.1" xmlns="http://www.w3.org/1999/xhtml">, making both instances interchangeable.</span></p></td>
</tr>
<tr class="even">
<td><span class="koboSpan" id="kobo.407.1" xmlns="http://www.w3.org/1999/xhtml">Subtypes must preserve the invariance of the supertype.</span></td>
<td><span class="koboSpan" id="kobo.408.1" xmlns="http://www.w3.org/1999/xhtml">A subtype must pass all the tests written for the supertype, so there is no variance between them (they don’t vary/they react the same).</span></td>
</tr>
<tr class="odd">
<td><span class="koboSpan" id="kobo.409.1" xmlns="http://www.w3.org/1999/xhtml">The history constraint dictates that what happens in the supertype must still occur in the subtype, and you can’t change this.</span></td>
<td><p><span class="koboSpan" id="kobo.410.1" xmlns="http://www.w3.org/1999/xhtml">A subtype can add new properties (state) and methods (behaviors).</span></p>
<p><span class="koboSpan" id="kobo.411.1" xmlns="http://www.w3.org/1999/xhtml">A subtype must not modify the supertype state in any new way.</span></p></td>
</tr>
</tbody>
</table><span class="koboSpan" id="kobo.412.1" xmlns="http://www.w3.org/1999/xhtml">
Table 3.1: LSP behavioral conditions
</span><p><span class="koboSpan" id="kobo.413.1" xmlns="http://www.w3.org/1999/xhtml">OK, at this point, you are right to feel that this is rather complex. </span><span class="koboSpan" id="kobo.413.2" xmlns="http://www.w3.org/1999/xhtml">Yet, rest assured that this is the less important of those principles because we are moving as far as we can from inheritance, so the LSP should not apply often.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.414.1" xmlns="http://www.w3.org/1999/xhtml">We can summarize the LSP to:</span></p>
<blockquote>
<p><em><span class="koboSpan" id="kobo.415.1" xmlns="http://www.w3.org/1999/xhtml">In your subtypes, add new behaviors and states; don’t change existing ones.</span></em></p>
</blockquote>
</blockquote>
<p><span class="koboSpan" id="kobo.416.1" xmlns="http://www.w3.org/1999/xhtml">In a nutshell, applying the LSP allows us to swap an instance of a class for one of its subclasses without breaking anything.To make a LEGO® analogy: LSP is like swapping a 4x2 block with a 4x2 block with a sticker on it: neither the structure's structural integrity nor the block's role changed; the new block only has a new sticker state.</span></p>
<blockquote>
<p><strong><span class="koboSpan" id="kobo.417.1" xmlns="http://www.w3.org/1999/xhtml">Tip</span></strong></p>
<blockquote>
<p><span class="koboSpan" id="kobo.418.1" xmlns="http://www.w3.org/1999/xhtml">An excellent way of enforcing those behavioral constraints is automated testing. </span><span class="koboSpan" id="kobo.418.2" xmlns="http://www.w3.org/1999/xhtml">You can write a test suite and run it against all subclasses of a specific supertype to enforce the preservation of behaviors.</span></p>
</blockquote>
</blockquote>
<p><span class="koboSpan" id="kobo.419.1" xmlns="http://www.w3.org/1999/xhtml">Let’s jump into some code to visualize that in practice.</span></p>
</section>
<section class="level4" data-number="4.5.3.3" id="project-liskov-substitution">
<h4 data-number="4.5.3.3"><span class="koboSpan" id="kobo.420.1" xmlns="http://www.w3.org/1999/xhtml">Project – Liskov Substitution</span></h4>
<p><span class="koboSpan" id="kobo.421.1" xmlns="http://www.w3.org/1999/xhtml">To demonstrate the LSP, we will explore some scenarios. </span><span class="koboSpan" id="kobo.421.2" xmlns="http://www.w3.org/1999/xhtml">Each scenario is a test class that follows the same structure:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.422.1" xmlns="http://www.w3.org/1999/xhtml">namespace LiskovSubstitution;
public class TestClassName
{
    public static TheoryData&lt;SuperClass&gt; InstancesThatThrowsSuperExceptions = new TheoryData&lt;SuperClass&gt;()
    {
        new SuperClass(),
        new SubClassOk(),
        new SubClassBreak(),
    };
    [Theory]
    [MemberData(nameof(InstancesThatThrowsSuperExceptions))]
    public void Test_method_name(SuperClass sut)
    {
        // Scenario
    }
    // Other classes, like SuperClass, SubClassOk, 
    // and SubClassBreak
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.423.1" xmlns="http://www.w3.org/1999/xhtml">In the preceding code structure, the highlighted code changes for every test. </span><span class="koboSpan" id="kobo.423.2" xmlns="http://www.w3.org/1999/xhtml">The setup is simple; I use the test method to simulate code that a program could execute, and just by running the same code three times on different classes, each theory fails once:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.424.1" xmlns="http://www.w3.org/1999/xhtml">The initial test passes</span></li>
<li><span class="koboSpan" id="kobo.425.1" xmlns="http://www.w3.org/1999/xhtml">The test of a subtype respecting the LSP passes</span></li>
<li><span class="koboSpan" id="kobo.426.1" xmlns="http://www.w3.org/1999/xhtml">The test of a subtype violating the LSP fails.</span></li>
</ul>
<blockquote>
<p><span class="koboSpan" id="kobo.427.1" xmlns="http://www.w3.org/1999/xhtml">The parameter </span><code><span class="koboSpan" id="kobo.428.1" xmlns="http://www.w3.org/1999/xhtml">sut</span></code><span class="koboSpan" id="kobo.429.1" xmlns="http://www.w3.org/1999/xhtml"> is the subject under test, a well-known acronym.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.430.1" xmlns="http://www.w3.org/1999/xhtml">Of course, we can’t explore all scenarios, so I picked three; let’s check the first one.</span></p>
<section class="level5" data-number="4.5.3.3.1" id="scenario-1-exceptiontest">
<h5 data-number="4.5.3.3.1"><span class="koboSpan" id="kobo.431.1" xmlns="http://www.w3.org/1999/xhtml">Scenario 1: ExceptionTest</span></h5>
<p><span class="koboSpan" id="kobo.432.1" xmlns="http://www.w3.org/1999/xhtml">This scenario explores what can happen when a subtype throws a new exception type.The following code is the consumer of the subject under test:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.433.1" xmlns="http://www.w3.org/1999/xhtml">try
{
    sut.Do();
}
catch (SuperException ex)
{
    // Some code
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.434.1" xmlns="http://www.w3.org/1999/xhtml">The preceding code is very standard. </span><span class="koboSpan" id="kobo.434.2" xmlns="http://www.w3.org/1999/xhtml">We wrapped the execution of some code (the </span><code><span class="koboSpan" id="kobo.435.1" xmlns="http://www.w3.org/1999/xhtml">Do</span></code><span class="koboSpan" id="kobo.436.1" xmlns="http://www.w3.org/1999/xhtml"> method) in a try-catch block to handle a specific exception.The initial subject under test (the </span><code><span class="koboSpan" id="kobo.437.1" xmlns="http://www.w3.org/1999/xhtml">SuperClass</span></code><span class="koboSpan" id="kobo.438.1" xmlns="http://www.w3.org/1999/xhtml">) simulates that at some point during the execution of the </span><code><span class="koboSpan" id="kobo.439.1" xmlns="http://www.w3.org/1999/xhtml">Do</span></code><span class="koboSpan" id="kobo.440.1" xmlns="http://www.w3.org/1999/xhtml"> method, it throws an exception of type </span><code><span class="koboSpan" id="kobo.441.1" xmlns="http://www.w3.org/1999/xhtml">SuperException</span></code><span class="koboSpan" id="kobo.442.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.442.2" xmlns="http://www.w3.org/1999/xhtml">When we execute the code, the try-catch block catches the </span><code><span class="koboSpan" id="kobo.443.1" xmlns="http://www.w3.org/1999/xhtml">SuperException</span></code><span class="koboSpan" id="kobo.444.1" xmlns="http://www.w3.org/1999/xhtml">, and everything goes as planned. </span><span class="koboSpan" id="kobo.444.2" xmlns="http://www.w3.org/1999/xhtml">Here’s the code:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.445.1" xmlns="http://www.w3.org/1999/xhtml">public class SuperClass
{
    public virtual void Do()
        =&gt; throw new SuperException();
}
public class SuperException : Exception { }</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.446.1" xmlns="http://www.w3.org/1999/xhtml">Next, the </span><code><span class="koboSpan" id="kobo.447.1" xmlns="http://www.w3.org/1999/xhtml">SubClassOk</span></code><span class="koboSpan" id="kobo.448.1" xmlns="http://www.w3.org/1999/xhtml"> class simulates that the execution changed, and it throws a </span><code><span class="koboSpan" id="kobo.449.1" xmlns="http://www.w3.org/1999/xhtml">SubException</span></code><span class="koboSpan" id="kobo.450.1" xmlns="http://www.w3.org/1999/xhtml"> that inherits the </span><code><span class="koboSpan" id="kobo.451.1" xmlns="http://www.w3.org/1999/xhtml">SuperException</span></code><span class="koboSpan" id="kobo.452.1" xmlns="http://www.w3.org/1999/xhtml"> class. </span><span class="koboSpan" id="kobo.452.2" xmlns="http://www.w3.org/1999/xhtml">When we execute the code, the try-catch block catches the </span><code><span class="koboSpan" id="kobo.453.1" xmlns="http://www.w3.org/1999/xhtml">SubException</span></code><span class="koboSpan" id="kobo.454.1" xmlns="http://www.w3.org/1999/xhtml">, because it’s a subtype of </span><code><span class="koboSpan" id="kobo.455.1" xmlns="http://www.w3.org/1999/xhtml">SuperException</span></code><span class="koboSpan" id="kobo.456.1" xmlns="http://www.w3.org/1999/xhtml">, and everything goes as planned. </span><span class="koboSpan" id="kobo.456.2" xmlns="http://www.w3.org/1999/xhtml">Here’s the code:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.457.1" xmlns="http://www.w3.org/1999/xhtml">public class SubClassOk : SuperClass
{
    public override void Do()
        =&gt; throw new SubException();
}
public class SubException : SuperException { }</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.458.1" xmlns="http://www.w3.org/1999/xhtml">Finally, the </span><code><span class="koboSpan" id="kobo.459.1" xmlns="http://www.w3.org/1999/xhtml">SubClassBreak</span></code><span class="koboSpan" id="kobo.460.1" xmlns="http://www.w3.org/1999/xhtml"> class simulates that it is throwing </span><code><span class="koboSpan" id="kobo.461.1" xmlns="http://www.w3.org/1999/xhtml">AnotherException</span></code><span class="koboSpan" id="kobo.462.1" xmlns="http://www.w3.org/1999/xhtml">, a new type of exception. </span><span class="koboSpan" id="kobo.462.2" xmlns="http://www.w3.org/1999/xhtml">When we execute the code, the program stops unexpectedly because we did not design the try-catch block for that. </span><span class="koboSpan" id="kobo.462.3" xmlns="http://www.w3.org/1999/xhtml">Here’s the code:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.463.1" xmlns="http://www.w3.org/1999/xhtml">public class SubClassBreak : SuperClass
{
    public override void Do()
        =&gt; throw new AnotherException();
}
public class AnotherException : Exception { }</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.464.1" xmlns="http://www.w3.org/1999/xhtml">So as trivial as it may sound, throwing that exception breaks the program and go against the LSP.</span></p>
</section>
<section class="level5" data-number="4.5.3.3.2" id="scenario-2-preconditiontest">
<h5 data-number="4.5.3.3.2"><span class="koboSpan" id="kobo.465.1" xmlns="http://www.w3.org/1999/xhtml">Scenario 2: PreconditionTest</span></h5>
<p><span class="koboSpan" id="kobo.466.1" xmlns="http://www.w3.org/1999/xhtml">This scenario explores that </span><em><span class="koboSpan" id="kobo.467.1" xmlns="http://www.w3.org/1999/xhtml">any precondition implemented in a supertype should yield the same outcome in its subtypes, but subtypes can be less strict about it, never more</span></em><span class="koboSpan" id="kobo.468.1" xmlns="http://www.w3.org/1999/xhtml">.The following code is the consumer of the subject under test:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.469.1" xmlns="http://www.w3.org/1999/xhtml">var value = 5;
var result = sut.IsValid(value);
Console.WriteLine($"Do something with {result}");</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.470.1" xmlns="http://www.w3.org/1999/xhtml">The preceding code is very standard. </span><span class="koboSpan" id="kobo.470.2" xmlns="http://www.w3.org/1999/xhtml">We have the </span><code><span class="koboSpan" id="kobo.471.1" xmlns="http://www.w3.org/1999/xhtml">value</span></code><span class="koboSpan" id="kobo.472.1" xmlns="http://www.w3.org/1999/xhtml"> variable that could come from anywhere. </span><span class="koboSpan" id="kobo.472.2" xmlns="http://www.w3.org/1999/xhtml">Then we pass it to the </span><code><span class="koboSpan" id="kobo.473.1" xmlns="http://www.w3.org/1999/xhtml">IsValid</span></code><span class="koboSpan" id="kobo.474.1" xmlns="http://www.w3.org/1999/xhtml"> method. </span><span class="koboSpan" id="kobo.474.2" xmlns="http://www.w3.org/1999/xhtml">Finally, we do something with the </span><code><span class="koboSpan" id="kobo.475.1" xmlns="http://www.w3.org/1999/xhtml">result</span></code><span class="koboSpan" id="kobo.476.1" xmlns="http://www.w3.org/1999/xhtml">; in this case, we write a line to the console.The initial subject under test (the </span><code><span class="koboSpan" id="kobo.477.1" xmlns="http://www.w3.org/1999/xhtml">SuperClass</span></code><span class="koboSpan" id="kobo.478.1" xmlns="http://www.w3.org/1999/xhtml">) simulates that a precondition exists that enforces that the value must be positive. </span><span class="koboSpan" id="kobo.478.2" xmlns="http://www.w3.org/1999/xhtml">Here’s the code:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.479.1" xmlns="http://www.w3.org/1999/xhtml">public class SuperClass
{
    public virtual bool IsValid(int value)
    {
        if (value &lt; 0)
        {
            throw new ArgumentException(
                "Value must be positive.", 
                nameof(value)
            );
        }
        return true;
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.480.1" xmlns="http://www.w3.org/1999/xhtml">Next, the </span><code><span class="koboSpan" id="kobo.481.1" xmlns="http://www.w3.org/1999/xhtml">SubClassOk</span></code><span class="koboSpan" id="kobo.482.1" xmlns="http://www.w3.org/1999/xhtml"> class simulates that the execution changed and tolerates negative values up to -10. </span><span class="koboSpan" id="kobo.482.2" xmlns="http://www.w3.org/1999/xhtml">Everything is fine when executing the code because the precondition is less strict. </span><span class="koboSpan" id="kobo.482.3" xmlns="http://www.w3.org/1999/xhtml">Here’s the code:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.483.1" xmlns="http://www.w3.org/1999/xhtml">public class SubClassOk : SuperClass
{
    public override bool IsValid(int value)
    {
        if (value &lt; -10)
        {
            throw new ArgumentException(
                "Value must be greater or equal to -10.", 
                nameof(value)
            );
        }
        return true;
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.484.1" xmlns="http://www.w3.org/1999/xhtml">Finally, the </span><code><span class="koboSpan" id="kobo.485.1" xmlns="http://www.w3.org/1999/xhtml">SubClassBreak</span></code><span class="koboSpan" id="kobo.486.1" xmlns="http://www.w3.org/1999/xhtml"> class simulates that the execution changed and restricts using values under 10. </span><span class="koboSpan" id="kobo.486.2" xmlns="http://www.w3.org/1999/xhtml">When executing the code, it breaks because we were not expecting that error; the precondition was more strict than the </span><code><span class="koboSpan" id="kobo.487.1" xmlns="http://www.w3.org/1999/xhtml">SuperClass</span></code><span class="koboSpan" id="kobo.488.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.488.2" xmlns="http://www.w3.org/1999/xhtml">Here’s the code:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.489.1" xmlns="http://www.w3.org/1999/xhtml">public class SubClassBreak : SuperClass
{
    public override bool IsValid(int value)
    {
        if (value &lt; 10) // Break LSP
        {
            throw new ArgumentException(
                "Value must be greater than 10.", 
                nameof(value)
            );
        }
        return true;
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.490.1" xmlns="http://www.w3.org/1999/xhtml">Yet another example of how a simple change can break its consumers and the LSP. </span><span class="koboSpan" id="kobo.490.2" xmlns="http://www.w3.org/1999/xhtml">Of course, this is an overly simplified example focusing only on the precondition, but the same applies to more complex scenarios. </span><span class="koboSpan" id="kobo.490.3" xmlns="http://www.w3.org/1999/xhtml">Coding is like playing with blocks.</span></p>
</section>
<section class="level5" data-number="4.5.3.3.3" id="scenario-3-postconditiontest">
<h5 data-number="4.5.3.3.3"><span class="koboSpan" id="kobo.491.1" xmlns="http://www.w3.org/1999/xhtml">Scenario 3: PostconditionTest</span></h5>
<p><span class="koboSpan" id="kobo.492.1" xmlns="http://www.w3.org/1999/xhtml">This scenario explores that </span><em><span class="koboSpan" id="kobo.493.1" xmlns="http://www.w3.org/1999/xhtml">postconditions implemented in a supertype should yield the same outcome in its subtypes, but subtypes can be more strict about it, never less</span></em><span class="koboSpan" id="kobo.494.1" xmlns="http://www.w3.org/1999/xhtml">.The following code is the consumer of the subject under test:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.495.1" xmlns="http://www.w3.org/1999/xhtml">var value = 5;
var result = sut.Do(value);
Console.WriteLine($"Do something with {result.Value}");</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.496.1" xmlns="http://www.w3.org/1999/xhtml">The preceding code is very standard and very similar to the second scenario. </span><span class="koboSpan" id="kobo.496.2" xmlns="http://www.w3.org/1999/xhtml">We have the </span><code><span class="koboSpan" id="kobo.497.1" xmlns="http://www.w3.org/1999/xhtml">value</span></code><span class="koboSpan" id="kobo.498.1" xmlns="http://www.w3.org/1999/xhtml"> variable that could come from anywhere. </span><span class="koboSpan" id="kobo.498.2" xmlns="http://www.w3.org/1999/xhtml">Then we pass it to the </span><code><span class="koboSpan" id="kobo.499.1" xmlns="http://www.w3.org/1999/xhtml">Do</span></code><span class="koboSpan" id="kobo.500.1" xmlns="http://www.w3.org/1999/xhtml"> method. </span><span class="koboSpan" id="kobo.500.2" xmlns="http://www.w3.org/1999/xhtml">Finally, we do something with the </span><code><span class="koboSpan" id="kobo.501.1" xmlns="http://www.w3.org/1999/xhtml">result</span></code><span class="koboSpan" id="kobo.502.1" xmlns="http://www.w3.org/1999/xhtml">; in this case, we write a line to the console. </span><span class="koboSpan" id="kobo.502.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.503.1" xmlns="http://www.w3.org/1999/xhtml">Do</span></code><span class="koboSpan" id="kobo.504.1" xmlns="http://www.w3.org/1999/xhtml"> method returns an instance of a </span><code><span class="koboSpan" id="kobo.505.1" xmlns="http://www.w3.org/1999/xhtml">Model</span></code><span class="koboSpan" id="kobo.506.1" xmlns="http://www.w3.org/1999/xhtml"> class, which has only a </span><code><span class="koboSpan" id="kobo.507.1" xmlns="http://www.w3.org/1999/xhtml">Value</span></code><span class="koboSpan" id="kobo.508.1" xmlns="http://www.w3.org/1999/xhtml"> property. </span><span class="koboSpan" id="kobo.508.2" xmlns="http://www.w3.org/1999/xhtml">Here’s the code:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.509.1" xmlns="http://www.w3.org/1999/xhtml">public record class Model(int Value);</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.510.1" xmlns="http://www.w3.org/1999/xhtml">The initial subject under test (the </span><code><span class="koboSpan" id="kobo.511.1" xmlns="http://www.w3.org/1999/xhtml">SuperClass</span></code><span class="koboSpan" id="kobo.512.1" xmlns="http://www.w3.org/1999/xhtml">) simulates that at some point during the execution, it returns a </span><code><span class="koboSpan" id="kobo.513.1" xmlns="http://www.w3.org/1999/xhtml">Model</span></code><span class="koboSpan" id="kobo.514.1" xmlns="http://www.w3.org/1999/xhtml"> instance and sets the value of the </span><code><span class="koboSpan" id="kobo.515.1" xmlns="http://www.w3.org/1999/xhtml">Value</span></code><span class="koboSpan" id="kobo.516.1" xmlns="http://www.w3.org/1999/xhtml"> property to the value of the </span><code><span class="koboSpan" id="kobo.517.1" xmlns="http://www.w3.org/1999/xhtml">value</span></code><span class="koboSpan" id="kobo.518.1" xmlns="http://www.w3.org/1999/xhtml"> parameter. </span><span class="koboSpan" id="kobo.518.2" xmlns="http://www.w3.org/1999/xhtml">Here’s the code:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.519.1" xmlns="http://www.w3.org/1999/xhtml">public class SuperClass
{
    public virtual Model Do(int value)
    {
        return new(value);
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.520.1" xmlns="http://www.w3.org/1999/xhtml">Next, the </span><code><span class="koboSpan" id="kobo.521.1" xmlns="http://www.w3.org/1999/xhtml">SubClassOk</span></code><span class="koboSpan" id="kobo.522.1" xmlns="http://www.w3.org/1999/xhtml"> class simulates that the execution changed and returns a </span><code><span class="koboSpan" id="kobo.523.1" xmlns="http://www.w3.org/1999/xhtml">SubModel</span></code><span class="koboSpan" id="kobo.524.1" xmlns="http://www.w3.org/1999/xhtml"> instance instead. </span><span class="koboSpan" id="kobo.524.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.525.1" xmlns="http://www.w3.org/1999/xhtml">SubModel</span></code><span class="koboSpan" id="kobo.526.1" xmlns="http://www.w3.org/1999/xhtml"> class inherits the </span><code><span class="koboSpan" id="kobo.527.1" xmlns="http://www.w3.org/1999/xhtml">Model</span></code><span class="koboSpan" id="kobo.528.1" xmlns="http://www.w3.org/1999/xhtml"> class and adds a </span><code><span class="koboSpan" id="kobo.529.1" xmlns="http://www.w3.org/1999/xhtml">DoCount</span></code><span class="koboSpan" id="kobo.530.1" xmlns="http://www.w3.org/1999/xhtml"> property. </span><span class="koboSpan" id="kobo.530.2" xmlns="http://www.w3.org/1999/xhtml">When executing the code, everything is fine because the output is invariant (a </span><code><span class="koboSpan" id="kobo.531.1" xmlns="http://www.w3.org/1999/xhtml">SubModel</span></code><span class="koboSpan" id="kobo.532.1" xmlns="http://www.w3.org/1999/xhtml"> is a </span><code><span class="koboSpan" id="kobo.533.1" xmlns="http://www.w3.org/1999/xhtml">Model</span></code><span class="koboSpan" id="kobo.534.1" xmlns="http://www.w3.org/1999/xhtml"> and behaves the same). </span><span class="koboSpan" id="kobo.534.2" xmlns="http://www.w3.org/1999/xhtml">Here’s the code:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.535.1" xmlns="http://www.w3.org/1999/xhtml">public class SubClassOk : SuperClass
{
    private int _doCount = 0;
    public override Model Do(int value)
    {
        var baseModel = base.Do(value);
        return new SubModel(baseModel.Value, ++_doCount);
    }
}
public record class SubModel(int Value, int DoCount) : Model(Value);</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.536.1" xmlns="http://www.w3.org/1999/xhtml">Finally, the </span><code><span class="koboSpan" id="kobo.537.1" xmlns="http://www.w3.org/1999/xhtml">SubClassBreak</span></code><span class="koboSpan" id="kobo.538.1" xmlns="http://www.w3.org/1999/xhtml"> class simulates that the execution changed and returns </span><code><span class="koboSpan" id="kobo.539.1" xmlns="http://www.w3.org/1999/xhtml">null</span></code><span class="koboSpan" id="kobo.540.1" xmlns="http://www.w3.org/1999/xhtml"> when the value of the </span><code><span class="koboSpan" id="kobo.541.1" xmlns="http://www.w3.org/1999/xhtml">value</span></code><span class="koboSpan" id="kobo.542.1" xmlns="http://www.w3.org/1999/xhtml"> parameter is 5. </span><span class="koboSpan" id="kobo.542.2" xmlns="http://www.w3.org/1999/xhtml">When executing the code, it breaks at runtime with a </span><code><span class="koboSpan" id="kobo.543.1" xmlns="http://www.w3.org/1999/xhtml">NullReferenceException</span></code><span class="koboSpan" id="kobo.544.1" xmlns="http://www.w3.org/1999/xhtml"> when accessing the </span><code><span class="koboSpan" id="kobo.545.1" xmlns="http://www.w3.org/1999/xhtml">Value</span></code><span class="koboSpan" id="kobo.546.1" xmlns="http://www.w3.org/1999/xhtml"> property during the interpolation that happens in the </span><code><span class="koboSpan" id="kobo.547.1" xmlns="http://www.w3.org/1999/xhtml">Console.WriteLine</span></code><span class="koboSpan" id="kobo.548.1" xmlns="http://www.w3.org/1999/xhtml"> call. </span><span class="koboSpan" id="kobo.548.2" xmlns="http://www.w3.org/1999/xhtml">Here’s the code:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.549.1" xmlns="http://www.w3.org/1999/xhtml">public class SubClassBreak : SuperClass
{
    public override Model Do(int value)
    {
        if (value == 5)
        {
            return null;
        }
        return base.Do(value);
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.550.1" xmlns="http://www.w3.org/1999/xhtml">This last scenario shows once again how a simple change can break our program. </span><span class="koboSpan" id="kobo.550.2" xmlns="http://www.w3.org/1999/xhtml">Of course, this is also an overly simplified example focusing only on the postcondition and history constraint, but the same applies to more complex scenarios.What about the history constraint? </span><span class="koboSpan" id="kobo.550.3" xmlns="http://www.w3.org/1999/xhtml">We added a new state element to the </span><code><span class="koboSpan" id="kobo.551.1" xmlns="http://www.w3.org/1999/xhtml">SubClassOk</span></code><span class="koboSpan" id="kobo.552.1" xmlns="http://www.w3.org/1999/xhtml"> class by creating the </span><code><span class="koboSpan" id="kobo.553.1" xmlns="http://www.w3.org/1999/xhtml">_doCount</span></code><span class="koboSpan" id="kobo.554.1" xmlns="http://www.w3.org/1999/xhtml"> field. </span><span class="koboSpan" id="kobo.554.2" xmlns="http://www.w3.org/1999/xhtml">Moreover, by adding the </span><code><span class="koboSpan" id="kobo.555.1" xmlns="http://www.w3.org/1999/xhtml">SubModel</span></code><span class="koboSpan" id="kobo.556.1" xmlns="http://www.w3.org/1999/xhtml"> class, we added the </span><code><span class="koboSpan" id="kobo.557.1" xmlns="http://www.w3.org/1999/xhtml">DoCount</span></code><span class="koboSpan" id="kobo.558.1" xmlns="http://www.w3.org/1999/xhtml"> property to the return type. </span><span class="koboSpan" id="kobo.558.2" xmlns="http://www.w3.org/1999/xhtml">That field and property were nonexistent in the supertype, and they did not alter its behaviors: LSP followed!</span></p>
</section>
</section>
<section class="level4" data-number="4.5.3.4" id="conclusion-1">
<h4 data-number="4.5.3.4"><span class="koboSpan" id="kobo.559.1" xmlns="http://www.w3.org/1999/xhtml">Conclusion</span></h4>
<p><span class="koboSpan" id="kobo.560.1" xmlns="http://www.w3.org/1999/xhtml">The key idea of the LSP is that the consumer of a supertype should remain unaware of whether it's interacting with an instance of a supertype or an instance of a subtype.We could also name this principle the backward-compatibility principle because everything that worked in a way before must still work at least the same after the substitution, which is why this principle is essential.Once again, this is only a principle, not a law. </span><span class="koboSpan" id="kobo.560.2" xmlns="http://www.w3.org/1999/xhtml">You can also see a violation of the LSP as a </span><em><span class="koboSpan" id="kobo.561.1" xmlns="http://www.w3.org/1999/xhtml">code smell</span></em><span class="koboSpan" id="kobo.562.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.562.2" xmlns="http://www.w3.org/1999/xhtml">From there, analyze whether you have a design problem and its impact. </span><span class="koboSpan" id="kobo.562.3" xmlns="http://www.w3.org/1999/xhtml">Use your analytical skills on a case-by-case basis and conclude whether or not it would be acceptable to break the LSP in that specific case. </span><span class="koboSpan" id="kobo.562.4" xmlns="http://www.w3.org/1999/xhtml">Sometimes you want to change the program's behavior and break the LSP, but beware that you might break certain execution paths you did not account for and introduce defects.The more we progress, the more we move away from inheritance, and the less we need to worry about this principle. </span><span class="koboSpan" id="kobo.562.5" xmlns="http://www.w3.org/1999/xhtml">However, if you use inheritance and want to ensure your subtypes don’t break the program: apply the LSP, and you will be rewarded by improving your chances of producing defect-free, backward-compatible changes.Let’s look at the ISP next.</span></p>
</section>
</section>
<section class="level3" data-number="4.5.4" id="interface-segregation-principle-isp">
<h3 data-number="4.5.4"><span class="koboSpan" id="kobo.563.1" xmlns="http://www.w3.org/1999/xhtml">Interface segregation principle (ISP)</span></h3>
<p><span class="koboSpan" id="kobo.564.1" xmlns="http://www.w3.org/1999/xhtml">Let’s start with another famous quote by Robert C. </span><span class="koboSpan" id="kobo.564.2" xmlns="http://www.w3.org/1999/xhtml">Martin:</span></p>
<blockquote>
<em><span class="koboSpan" id="kobo.565.1" xmlns="http://www.w3.org/1999/xhtml">“Many client-specific interfaces are better than one general-purpose interface.”</span></em>
</blockquote>
<p><span class="koboSpan" id="kobo.566.1" xmlns="http://www.w3.org/1999/xhtml">What does that mean? </span><span class="koboSpan" id="kobo.566.2" xmlns="http://www.w3.org/1999/xhtml">It means the following:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.567.1" xmlns="http://www.w3.org/1999/xhtml">You should create interfaces.</span></li>
<li><span class="koboSpan" id="kobo.568.1" xmlns="http://www.w3.org/1999/xhtml">You should value small interfaces more.</span></li>
<li><span class="koboSpan" id="kobo.569.1" xmlns="http://www.w3.org/1999/xhtml">You should not create multipurpose interfaces.</span></li>
</ul>
<blockquote>
<p><span class="koboSpan" id="kobo.570.1" xmlns="http://www.w3.org/1999/xhtml">You can see a multipurpose interface as “an interface to rule them all” or a God class, introduced in </span><em><span class="koboSpan" id="kobo.571.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 1</span></em><span class="koboSpan" id="kobo.572.1" xmlns="http://www.w3.org/1999/xhtml">, </span><em><span class="koboSpan" id="kobo.573.1" xmlns="http://www.w3.org/1999/xhtml">Introduction</span></em><span class="koboSpan" id="kobo.574.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.575.1" xmlns="http://www.w3.org/1999/xhtml">An interface could refer to a class interface (the public members of a class) or a C# interface. </span><span class="koboSpan" id="kobo.575.2" xmlns="http://www.w3.org/1999/xhtml">We focus on C# interfaces in the book, as we use them extensively. </span><span class="koboSpan" id="kobo.575.3" xmlns="http://www.w3.org/1999/xhtml">Moreover, C# interfaces are very powerful.Speaking of interfaces, let’s quickly look at them before digging into some code.</span></p>
<section class="level4" data-number="4.5.4.1" id="what-is-an-interface">
<h4 data-number="4.5.4.1"><span class="koboSpan" id="kobo.576.1" xmlns="http://www.w3.org/1999/xhtml">What is an interface?</span></h4>
<p><span class="koboSpan" id="kobo.577.1" xmlns="http://www.w3.org/1999/xhtml">Interfaces are among the most valuable tools in the C# toolbox for creating flexible and maintainable software. </span><span class="koboSpan" id="kobo.577.2" xmlns="http://www.w3.org/1999/xhtml">It can be tough to understand and grasp the power of interfaces at first, especially from an explanation, so don’t worry if you don’t; you will see plenty in action throughout the book.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.578.1" xmlns="http://www.w3.org/1999/xhtml">You can see an interface as allowing a class to impersonate different things (APIs), bringing polymorphism to the next level.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.579.1" xmlns="http://www.w3.org/1999/xhtml">Next are some more details that overview interfaces:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.580.1" xmlns="http://www.w3.org/1999/xhtml">The role of an interface is to define a cohesive contract (public methods, properties, and events). </span><span class="koboSpan" id="kobo.580.2" xmlns="http://www.w3.org/1999/xhtml">In its theoretical form, an interface contains no code; it is only a contract. </span><span class="koboSpan" id="kobo.580.3" xmlns="http://www.w3.org/1999/xhtml">In practice, since C# 8, we can create default implementation in interfaces, which could be helpful to limit breaking changes in a library (such as adding a method to an interface without breaking any class implementing that interface).</span></li>
<li><span class="koboSpan" id="kobo.581.1" xmlns="http://www.w3.org/1999/xhtml">An interface should be small (ISP), and its members should align toward a common goal (cohesion) and share a single responsibility (SRP).</span></li>
<li><span class="koboSpan" id="kobo.582.1" xmlns="http://www.w3.org/1999/xhtml">In C#, a class can implement multiple interfaces, exposing multiples of those public contracts or, more accurately, be any and all of them. </span><span class="koboSpan" id="kobo.582.2" xmlns="http://www.w3.org/1999/xhtml">By leveraging polymorphism, we can consume a class as if it was any of the interfaces it implements or its supertype if it inherits another class.</span></li>
</ul>
<blockquote>
<p><span class="koboSpan" id="kobo.583.1" xmlns="http://www.w3.org/1999/xhtml">A class does not inherit from an interface; it implements an interface. </span><span class="koboSpan" id="kobo.583.2" xmlns="http://www.w3.org/1999/xhtml">However, an interface can inherit from another interface.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.584.1" xmlns="http://www.w3.org/1999/xhtml">Let’s explore the ISP example now that we refreshed our memory.</span></p>
</section>
<section class="level4" data-number="4.5.4.2" id="project-interface-segregation">
<h4 data-number="4.5.4.2"><span class="koboSpan" id="kobo.585.1" xmlns="http://www.w3.org/1999/xhtml">Project – Interface Segregation</span></h4>
<p><span class="koboSpan" id="kobo.586.1" xmlns="http://www.w3.org/1999/xhtml">In this project, we start with the same class as the SRP example but extract an interface from the </span><code><span class="koboSpan" id="kobo.587.1" xmlns="http://www.w3.org/1999/xhtml">ProductRepository</span></code><span class="koboSpan" id="kobo.588.1" xmlns="http://www.w3.org/1999/xhtml"> class. </span><span class="koboSpan" id="kobo.588.2" xmlns="http://www.w3.org/1999/xhtml">Let’s start by looking at the </span><code><span class="koboSpan" id="kobo.589.1" xmlns="http://www.w3.org/1999/xhtml">Product</span></code><span class="koboSpan" id="kobo.590.1" xmlns="http://www.w3.org/1999/xhtml"> class as a reminder, which represents a simple fictive product:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.591.1" xmlns="http://www.w3.org/1999/xhtml">public record class Product(int Id, string Name);</span></code></pre>
</div>
<blockquote>
<p><span class="koboSpan" id="kobo.592.1" xmlns="http://www.w3.org/1999/xhtml">The code sample has no implementation because it is irrelevant to understanding the ISP. </span><span class="koboSpan" id="kobo.592.2" xmlns="http://www.w3.org/1999/xhtml">We focus on the interfaces instead. </span><span class="koboSpan" id="kobo.592.3" xmlns="http://www.w3.org/1999/xhtml">Please assume we implemented the data-access logic using your favorite database.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.593.1" xmlns="http://www.w3.org/1999/xhtml">Now, let’s look at the interface extracted from the </span><code><span class="koboSpan" id="kobo.594.1" xmlns="http://www.w3.org/1999/xhtml">ProductRepository</span></code><span class="koboSpan" id="kobo.595.1" xmlns="http://www.w3.org/1999/xhtml"> class:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.596.1" xmlns="http://www.w3.org/1999/xhtml">namespace InterfaceSegregation.Before;
public interface IProductRepository
{
    public ValueTask&lt;IEnumerable&lt;Product&gt;&gt; GetAllPublicProductAsync();
    public ValueTask&lt;IEnumerable&lt;Product&gt;&gt; GetAllPrivateProductAsync();
    public ValueTask&lt;Product&gt; GetOnePublicProductAsync(int productId);
    public ValueTask&lt;Product&gt; GetOnePrivateProductAsync(int productId);
    public ValueTask CreateAsync(Product product);
    public ValueTask UpdateAsync(Product product);
    public ValueTask DeleteAsync(Product product);
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.597.1" xmlns="http://www.w3.org/1999/xhtml">At this point, the </span><code><span class="koboSpan" id="kobo.598.1" xmlns="http://www.w3.org/1999/xhtml">IProductRepository</span></code><span class="koboSpan" id="kobo.599.1" xmlns="http://www.w3.org/1999/xhtml"> interface breaks the SRP and the ISP the same way the </span><code><span class="koboSpan" id="kobo.600.1" xmlns="http://www.w3.org/1999/xhtml">ProductRepository</span></code><span class="koboSpan" id="kobo.601.1" xmlns="http://www.w3.org/1999/xhtml"> class did before. </span><span class="koboSpan" id="kobo.601.2" xmlns="http://www.w3.org/1999/xhtml">We already identified the SRP issues earlier but did not reach the point of extracting interfaces.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.602.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.603.1" xmlns="http://www.w3.org/1999/xhtml">ProductRepository</span></code><span class="koboSpan" id="kobo.604.1" xmlns="http://www.w3.org/1999/xhtml"> class implements the </span><code><span class="koboSpan" id="kobo.605.1" xmlns="http://www.w3.org/1999/xhtml">IProductRepository</span></code><span class="koboSpan" id="kobo.606.1" xmlns="http://www.w3.org/1999/xhtml"> interface and is the same as the SRP example (all methods </span><code><span class="koboSpan" id="kobo.607.1" xmlns="http://www.w3.org/1999/xhtml">throw new NotImplementedException()</span></code><span class="koboSpan" id="kobo.608.1" xmlns="http://www.w3.org/1999/xhtml">).</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.609.1" xmlns="http://www.w3.org/1999/xhtml">In the SRP example, we identified the following responsibilities:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.610.1" xmlns="http://www.w3.org/1999/xhtml">Handling public products.</span></li>
<li><span class="koboSpan" id="kobo.611.1" xmlns="http://www.w3.org/1999/xhtml">Handling private products.</span></li>
</ul>
<p><span class="koboSpan" id="kobo.612.1" xmlns="http://www.w3.org/1999/xhtml">Based on our previous analysis, we have two functional requirements (public and private access). </span><span class="koboSpan" id="kobo.612.2" xmlns="http://www.w3.org/1999/xhtml">By digging deeper, we can also identify five different database operations. </span><span class="koboSpan" id="kobo.612.3" xmlns="http://www.w3.org/1999/xhtml">Here’s the result in a grid:</span></p>
<table>
<tbody>
<tr class="odd">
<td/>
<td><strong><span class="koboSpan" id="kobo.613.1" xmlns="http://www.w3.org/1999/xhtml">Public</span></strong></td>
<td><strong><span class="koboSpan" id="kobo.614.1" xmlns="http://www.w3.org/1999/xhtml">Private</span></strong></td>
</tr>
<tr class="even">
<td><span class="koboSpan" id="kobo.615.1" xmlns="http://www.w3.org/1999/xhtml">Read one product</span></td>
<td><span class="koboSpan" id="kobo.616.1" xmlns="http://www.w3.org/1999/xhtml">Yes</span></td>
<td><span class="koboSpan" id="kobo.617.1" xmlns="http://www.w3.org/1999/xhtml">Yes</span></td>
</tr>
<tr class="odd">
<td><span class="koboSpan" id="kobo.618.1" xmlns="http://www.w3.org/1999/xhtml">Read all products</span></td>
<td><span class="koboSpan" id="kobo.619.1" xmlns="http://www.w3.org/1999/xhtml">Yes</span></td>
<td><span class="koboSpan" id="kobo.620.1" xmlns="http://www.w3.org/1999/xhtml">Yes</span></td>
</tr>
<tr class="even">
<td><span class="koboSpan" id="kobo.621.1" xmlns="http://www.w3.org/1999/xhtml">Create a product</span></td>
<td><span class="koboSpan" id="kobo.622.1" xmlns="http://www.w3.org/1999/xhtml">No</span></td>
<td><span class="koboSpan" id="kobo.623.1" xmlns="http://www.w3.org/1999/xhtml">Yes</span></td>
</tr>
<tr class="odd">
<td><span class="koboSpan" id="kobo.624.1" xmlns="http://www.w3.org/1999/xhtml">Update a product</span></td>
<td><span class="koboSpan" id="kobo.625.1" xmlns="http://www.w3.org/1999/xhtml">No</span></td>
<td><span class="koboSpan" id="kobo.626.1" xmlns="http://www.w3.org/1999/xhtml">Yes</span></td>
</tr>
<tr class="even">
<td><span class="koboSpan" id="kobo.627.1" xmlns="http://www.w3.org/1999/xhtml">Delete a product</span></td>
<td><span class="koboSpan" id="kobo.628.1" xmlns="http://www.w3.org/1999/xhtml">No</span></td>
<td><span class="koboSpan" id="kobo.629.1" xmlns="http://www.w3.org/1999/xhtml">Yes</span></td>
</tr>
</tbody>
</table><span class="koboSpan" id="kobo.630.1" xmlns="http://www.w3.org/1999/xhtml">
Table 3.3: a grid that shows what the software needs to do (functional requirements) and what needs to happen in the database (database operation requirements).
</span><p><span class="koboSpan" id="kobo.631.1" xmlns="http://www.w3.org/1999/xhtml">We can extract the following families of database operations from Table 3.3:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.632.1" xmlns="http://www.w3.org/1999/xhtml">Read products (read one, read all).</span></li>
<li><span class="koboSpan" id="kobo.633.1" xmlns="http://www.w3.org/1999/xhtml">Write or alter products (create, update, delete).</span></li>
</ul>
<p><span class="koboSpan" id="kobo.634.1" xmlns="http://www.w3.org/1999/xhtml">Based on that more thorough analysis, we can extract the </span><code><span class="koboSpan" id="kobo.635.1" xmlns="http://www.w3.org/1999/xhtml">IProductReader</span></code><span class="koboSpan" id="kobo.636.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.637.1" xmlns="http://www.w3.org/1999/xhtml">IProductWriter</span></code><span class="koboSpan" id="kobo.638.1" xmlns="http://www.w3.org/1999/xhtml"> interfaces representing the database operation. </span><span class="koboSpan" id="kobo.638.2" xmlns="http://www.w3.org/1999/xhtml">Then we can create the </span><code><span class="koboSpan" id="kobo.639.1" xmlns="http://www.w3.org/1999/xhtml">PublicProductReader</span></code><span class="koboSpan" id="kobo.640.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.641.1" xmlns="http://www.w3.org/1999/xhtml">PrivateProductRepository</span></code><span class="koboSpan" id="kobo.642.1" xmlns="http://www.w3.org/1999/xhtml"> classes to implement our functional requirements.Let’s start with the </span><code><span class="koboSpan" id="kobo.643.1" xmlns="http://www.w3.org/1999/xhtml">IProductReader</span></code><span class="koboSpan" id="kobo.644.1" xmlns="http://www.w3.org/1999/xhtml"> interface:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.645.1" xmlns="http://www.w3.org/1999/xhtml">namespace InterfaceSegregation.After;
public interface IProductReader
{
    public ValueTask&lt;IEnumerable&lt;Product&gt;&gt; GetAllAsync();
    public ValueTask&lt;Product&gt; GetOneAsync(int productId);
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.646.1" xmlns="http://www.w3.org/1999/xhtml">With this interface, we cover the </span><em><span class="koboSpan" id="kobo.647.1" xmlns="http://www.w3.org/1999/xhtml">read one product</span></em><span class="koboSpan" id="kobo.648.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><em><span class="koboSpan" id="kobo.649.1" xmlns="http://www.w3.org/1999/xhtml">read all products</span></em><span class="koboSpan" id="kobo.650.1" xmlns="http://www.w3.org/1999/xhtml"> use cases. </span><span class="koboSpan" id="kobo.650.2" xmlns="http://www.w3.org/1999/xhtml">Next, the </span><code><span class="koboSpan" id="kobo.651.1" xmlns="http://www.w3.org/1999/xhtml">IProductWriter</span></code><span class="koboSpan" id="kobo.652.1" xmlns="http://www.w3.org/1999/xhtml"> interface covers the other three database operations:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.653.1" xmlns="http://www.w3.org/1999/xhtml">namespace InterfaceSegregation.After;
public interface IProductWriter
{
    public ValueTask CreateAsync(Product product);
    public ValueTask UpdateAsync(Product product);
    public ValueTask DeleteAsync(Product product);
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.654.1" xmlns="http://www.w3.org/1999/xhtml">We can cover all the database use cases with the preceding interfaces. </span><span class="koboSpan" id="kobo.654.2" xmlns="http://www.w3.org/1999/xhtml">Next, let’s create the </span><code><span class="koboSpan" id="kobo.655.1" xmlns="http://www.w3.org/1999/xhtml">PublicProductReader</span></code><span class="koboSpan" id="kobo.656.1" xmlns="http://www.w3.org/1999/xhtml"> class:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.657.1" xmlns="http://www.w3.org/1999/xhtml">namespace InterfaceSegregation.After;
public class PublicProductReader : IProductReader
{
    public ValueTask&lt;IEnumerable&lt;Product&gt;&gt; GetAllAsync()
        =&gt; throw new NotImplementedException();
    public ValueTask&lt;Product&gt; GetOneAsync(int productId)
        =&gt; throw new NotImplementedException();
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.658.1" xmlns="http://www.w3.org/1999/xhtml">In the preceding code, the </span><code><span class="koboSpan" id="kobo.659.1" xmlns="http://www.w3.org/1999/xhtml">PublicProductReader</span></code><span class="koboSpan" id="kobo.660.1" xmlns="http://www.w3.org/1999/xhtml"> only implements the </span><code><span class="koboSpan" id="kobo.661.1" xmlns="http://www.w3.org/1999/xhtml">IProductReader</span></code><span class="koboSpan" id="kobo.662.1" xmlns="http://www.w3.org/1999/xhtml"> interface, covering the identified scenarios. </span><span class="koboSpan" id="kobo.662.2" xmlns="http://www.w3.org/1999/xhtml">We do the </span><code><span class="koboSpan" id="kobo.663.1" xmlns="http://www.w3.org/1999/xhtml">PrivateProductRepository</span></code><span class="koboSpan" id="kobo.664.1" xmlns="http://www.w3.org/1999/xhtml"> class next before exploring the advantages of the ISP:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.665.1" xmlns="http://www.w3.org/1999/xhtml">namespace InterfaceSegregation.After;
public class PrivateProductRepository : IProductReader, IProductWriter
{
    public ValueTask&lt;IEnumerable&lt;Product&gt;&gt; GetAllAsync()
        =&gt; throw new NotImplementedException();
    public ValueTask&lt;Product&gt; GetOneAsync(int productId)
        =&gt; throw new NotImplementedException();
    public ValueTask CreateAsync(Product product)
        =&gt; throw new NotImplementedException();
    public ValueTask DeleteAsync(Product product)
        =&gt; throw new NotImplementedException();
    public ValueTask UpdateAsync(Product product)
        =&gt; throw new NotImplementedException();
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.666.1" xmlns="http://www.w3.org/1999/xhtml">In the preceding code, the </span><code><span class="koboSpan" id="kobo.667.1" xmlns="http://www.w3.org/1999/xhtml">PrivateProductRepository</span></code><span class="koboSpan" id="kobo.668.1" xmlns="http://www.w3.org/1999/xhtml"> class implements the </span><code><span class="koboSpan" id="kobo.669.1" xmlns="http://www.w3.org/1999/xhtml">IProductReader</span></code><span class="koboSpan" id="kobo.670.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.671.1" xmlns="http://www.w3.org/1999/xhtml">IProductWriter</span></code><span class="koboSpan" id="kobo.672.1" xmlns="http://www.w3.org/1999/xhtml"> interfaces, covering all the database needs. </span><span class="koboSpan" id="kobo.672.2" xmlns="http://www.w3.org/1999/xhtml">Now that we have covered the building blocks, let’s explore what this can do. </span><span class="koboSpan" id="kobo.672.3" xmlns="http://www.w3.org/1999/xhtml">Here’s the </span><code><span class="koboSpan" id="kobo.673.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.674.1" xmlns="http://www.w3.org/1999/xhtml"> file:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.675.1" xmlns="http://www.w3.org/1999/xhtml">using InterfaceSegregation.After;
var publicProductReader = new PublicProductReader();
var privateProductRepository = new PrivateProductRepository();
ReadProducts(publicProductReader);
ReadProducts(privateProductRepository);
// Error: Cannot convert from PublicProductReader to IProductWriter
// ModifyProducts(publicProductReader); // Invalid
WriteProducts(privateProductRepository);
ReadAndWriteProducts(privateProductRepository, privateProductRepository);
ReadAndWriteProducts(publicProductReader, privateProductRepository);
void ReadProducts(IProductReader productReader)
{
    Console.WriteLine(
        "Reading from {0}.",
        productReader.GetType().Name
    );
}
void WriteProducts(IProductWriter productWriter)
{
    Console.WriteLine(
        "Writing to {0}.",
        productWriter.GetType().Name
    );
}
void ReadAndWriteProducts(IProductReader productReader, IProductWriter productWriter)
{
    Console.WriteLine(
        "Reading from {0} and writing to {1}.",
        productReader.GetType().Name,
        productWriter.GetType().Name
    );
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.676.1" xmlns="http://www.w3.org/1999/xhtml">From the preceding code, the </span><code><span class="koboSpan" id="kobo.677.1" xmlns="http://www.w3.org/1999/xhtml">ReadProducts</span></code><span class="koboSpan" id="kobo.678.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.679.1" xmlns="http://www.w3.org/1999/xhtml">ModifyProducts</span></code><span class="koboSpan" id="kobo.680.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code><span class="koboSpan" id="kobo.681.1" xmlns="http://www.w3.org/1999/xhtml">ReadAndUpdateProducts</span></code><span class="koboSpan" id="kobo.682.1" xmlns="http://www.w3.org/1999/xhtml"> methods write messages in the console to demonstrate the advantages of applying the ISP.The </span><code><span class="koboSpan" id="kobo.683.1" xmlns="http://www.w3.org/1999/xhtml">publicProductReader</span></code><span class="koboSpan" id="kobo.684.1" xmlns="http://www.w3.org/1999/xhtml"> (instance of </span><code><span class="koboSpan" id="kobo.685.1" xmlns="http://www.w3.org/1999/xhtml">PublicProductReader</span></code><span class="koboSpan" id="kobo.686.1" xmlns="http://www.w3.org/1999/xhtml">) and </span><code><span class="koboSpan" id="kobo.687.1" xmlns="http://www.w3.org/1999/xhtml">privateProductRepository</span></code><span class="koboSpan" id="kobo.688.1" xmlns="http://www.w3.org/1999/xhtml"> (instance of </span><code><span class="koboSpan" id="kobo.689.1" xmlns="http://www.w3.org/1999/xhtml">PrivateProductRepository</span></code><span class="koboSpan" id="kobo.690.1" xmlns="http://www.w3.org/1999/xhtml">) variables are passed to the methods to show what we can and cannot do with the current design.Before getting into the weed, when we execute the program, we obtain the following output:</span></p>
<div class="C0-ConsolePACKT">
<pre><code><span class="koboSpan" id="kobo.691.1" xmlns="http://www.w3.org/1999/xhtml">Reading from PublicProductReader.
</span><span class="koboSpan" id="kobo.691.2" xmlns="http://www.w3.org/1999/xhtml">Reading from PrivateProductRepository.
</span><span class="koboSpan" id="kobo.691.3" xmlns="http://www.w3.org/1999/xhtml">Writing to PrivateProductRepository.
</span><span class="koboSpan" id="kobo.691.4" xmlns="http://www.w3.org/1999/xhtml">Reading from PrivateProductRepository and writing to PrivateProductRepository.
</span><span class="koboSpan" id="kobo.691.5" xmlns="http://www.w3.org/1999/xhtml">Reading from PublicProductReader and writing to PrivateProductRepository.</span></code></pre>
</div>
<section class="level5" data-number="4.5.4.2.1" id="first-operation">
<h5 data-number="4.5.4.2.1"><span class="koboSpan" id="kobo.692.1" xmlns="http://www.w3.org/1999/xhtml">First operation</span></h5>
<p><span class="koboSpan" id="kobo.693.1" xmlns="http://www.w3.org/1999/xhtml">The following code represents the first operation:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.694.1" xmlns="http://www.w3.org/1999/xhtml">ReadProducts(publicProductReader);
ReadProducts(privateProductRepository);</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.695.1" xmlns="http://www.w3.org/1999/xhtml">Since the </span><code><span class="koboSpan" id="kobo.696.1" xmlns="http://www.w3.org/1999/xhtml">PublicProductReader</span></code><span class="koboSpan" id="kobo.697.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.698.1" xmlns="http://www.w3.org/1999/xhtml">PrivateProductRepository</span></code><span class="koboSpan" id="kobo.699.1" xmlns="http://www.w3.org/1999/xhtml"> classes implement the </span><code><span class="koboSpan" id="kobo.700.1" xmlns="http://www.w3.org/1999/xhtml">IProductReader</span></code><span class="koboSpan" id="kobo.701.1" xmlns="http://www.w3.org/1999/xhtml"> interface, the </span><code><span class="koboSpan" id="kobo.702.1" xmlns="http://www.w3.org/1999/xhtml">ReadProducts</span></code><span class="koboSpan" id="kobo.703.1" xmlns="http://www.w3.org/1999/xhtml"> method accepts them, leading to the following output:</span></p>
<div class="C0-ConsolePACKT">
<pre><code><span class="koboSpan" id="kobo.704.1" xmlns="http://www.w3.org/1999/xhtml">Reading from PublicProductReader.
</span><span class="koboSpan" id="kobo.704.2" xmlns="http://www.w3.org/1999/xhtml">Reading from PrivateProductRepository.</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.705.1" xmlns="http://www.w3.org/1999/xhtml">That means we can centralize some code that reads from both implementations without changing them.</span></p>
</section>
<section class="level5" data-number="4.5.4.2.2" id="second-operation">
<h5 data-number="4.5.4.2.2"><span class="koboSpan" id="kobo.706.1" xmlns="http://www.w3.org/1999/xhtml">Second operation</span></h5>
<p><span class="koboSpan" id="kobo.707.1" xmlns="http://www.w3.org/1999/xhtml">The following code represents the second operation:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.708.1" xmlns="http://www.w3.org/1999/xhtml">WriteProducts(privateProductRepository);</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.709.1" xmlns="http://www.w3.org/1999/xhtml">Since only the </span><code><span class="koboSpan" id="kobo.710.1" xmlns="http://www.w3.org/1999/xhtml">PrivateProductRepository</span></code><span class="koboSpan" id="kobo.711.1" xmlns="http://www.w3.org/1999/xhtml"> class implements the </span><code><span class="koboSpan" id="kobo.712.1" xmlns="http://www.w3.org/1999/xhtml">IProductWriter</span></code><span class="koboSpan" id="kobo.713.1" xmlns="http://www.w3.org/1999/xhtml"> interface, the </span><code><span class="koboSpan" id="kobo.714.1" xmlns="http://www.w3.org/1999/xhtml">WriteProducts</span></code><span class="koboSpan" id="kobo.715.1" xmlns="http://www.w3.org/1999/xhtml"> method accepts only the </span><code><span class="koboSpan" id="kobo.716.1" xmlns="http://www.w3.org/1999/xhtml">privateProductRepository</span></code><span class="koboSpan" id="kobo.717.1" xmlns="http://www.w3.org/1999/xhtml"> variable and outputs the following:</span></p>
<div class="C0-ConsolePACKT">
<pre><code><span class="koboSpan" id="kobo.718.1" xmlns="http://www.w3.org/1999/xhtml">Writing to PrivateProductRepository.</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.719.1" xmlns="http://www.w3.org/1999/xhtml">This is one advantage of well-segregated interfaces and responsibilities; if we try to execute the following line, the compiler yields the error saying that we “cannot convert from PublicProductReader to IProductWriter”:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.720.1" xmlns="http://www.w3.org/1999/xhtml">ModifyProducts(publicProductReader);</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.721.1" xmlns="http://www.w3.org/1999/xhtml">That error makes sense because PublicProductReader does not implement the </span><code><span class="koboSpan" id="kobo.722.1" xmlns="http://www.w3.org/1999/xhtml">IProductWriter</span></code><span class="koboSpan" id="kobo.723.1" xmlns="http://www.w3.org/1999/xhtml"> interface.</span></p>
</section>
<section class="level5" data-number="4.5.4.2.3" id="third-operation">
<h5 data-number="4.5.4.2.3"><span class="koboSpan" id="kobo.724.1" xmlns="http://www.w3.org/1999/xhtml">Third operation</span></h5>
<p><span class="koboSpan" id="kobo.725.1" xmlns="http://www.w3.org/1999/xhtml">The following code represents the third operation:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.726.1" xmlns="http://www.w3.org/1999/xhtml">ReadAndWriteProducts(
    privateProductRepository, 
    privateProductRepository
);
ReadAndWriteProducts(
    publicProductReader, 
    privateProductRepository
);</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.727.1" xmlns="http://www.w3.org/1999/xhtml">Let’s analyze the two calls to the </span><code><span class="koboSpan" id="kobo.728.1" xmlns="http://www.w3.org/1999/xhtml">ReadAndWriteProducts</span></code><span class="koboSpan" id="kobo.729.1" xmlns="http://www.w3.org/1999/xhtml"> method individually, but before that, let’s look at the console output:</span></p>
<div class="C0-ConsolePACKT">
<pre><code><span class="koboSpan" id="kobo.730.1" xmlns="http://www.w3.org/1999/xhtml">Reading from PrivateProductRepository and writing to PrivateProductRepository.
</span><span class="koboSpan" id="kobo.730.2" xmlns="http://www.w3.org/1999/xhtml">Reading from PublicProductReader and writing to PrivateProductRepository.</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.731.1" xmlns="http://www.w3.org/1999/xhtml">The first execution reads and writes to the </span><code><span class="koboSpan" id="kobo.732.1" xmlns="http://www.w3.org/1999/xhtml">PrivateProductRepository</span></code><span class="koboSpan" id="kobo.733.1" xmlns="http://www.w3.org/1999/xhtml"> instance, which is possible because it implements both the </span><code><span class="koboSpan" id="kobo.734.1" xmlns="http://www.w3.org/1999/xhtml">IProductReader</span></code><span class="koboSpan" id="kobo.735.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.736.1" xmlns="http://www.w3.org/1999/xhtml">IProductWriter</span></code><span class="koboSpan" id="kobo.737.1" xmlns="http://www.w3.org/1999/xhtml"> interfaces.The second call, however, reads from the public reader but writes using the private writer. </span><span class="koboSpan" id="kobo.737.2" xmlns="http://www.w3.org/1999/xhtml">The last example shows the power of the ISP, especially when mixed with the SRP, and how easy it is to swap one piece for another when segregating our interfaces correctly and designing our code for the program’s use cases.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.738.1" xmlns="http://www.w3.org/1999/xhtml">You should not divide all your repositories into readers and writers; this sample only demonstrates some possibilities. </span><span class="koboSpan" id="kobo.738.2" xmlns="http://www.w3.org/1999/xhtml">Always design your programs for the specifications that you have.</span></p>
</blockquote>
</section>
</section>
<section class="level4" data-number="4.5.4.3" id="conclusion-2">
<h4 data-number="4.5.4.3"><span class="koboSpan" id="kobo.739.1" xmlns="http://www.w3.org/1999/xhtml">Conclusion</span></h4>
<p><span class="koboSpan" id="kobo.740.1" xmlns="http://www.w3.org/1999/xhtml">To summarize the idea behind the ISP, if you have multiple smaller interfaces, it is easier to reuse them and expose only the features you need instead of exposing APIs that part of your program doesn’t need. </span><span class="koboSpan" id="kobo.740.2" xmlns="http://www.w3.org/1999/xhtml">Furthermore, it is easier to compose bigger pieces using multiple specialized interfaces by implementing them as needed than remove methods from a big interface if we don’t need them in one of its implementations.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.741.1" xmlns="http://www.w3.org/1999/xhtml">The main takeaway is to </span><strong><span class="koboSpan" id="kobo.742.1" xmlns="http://www.w3.org/1999/xhtml">only depend on the interfaces that you consume</span></strong><span class="koboSpan" id="kobo.743.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.744.1" xmlns="http://www.w3.org/1999/xhtml">If you don’t see all of the benefits yet, don’t worry. </span><span class="koboSpan" id="kobo.744.2" xmlns="http://www.w3.org/1999/xhtml">All the pieces should come together as we move on to the last SOLID principle, to dependency injection, the rest of the book, and as you practice applying the SOLID principles.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.745.1" xmlns="http://www.w3.org/1999/xhtml">Like the SRP, be careful not to overuse the ISP mindlessly. </span><span class="koboSpan" id="kobo.745.2" xmlns="http://www.w3.org/1999/xhtml">Think about cohesion and what you are trying to achieve, not how granular an interface can become. </span><span class="koboSpan" id="kobo.745.3" xmlns="http://www.w3.org/1999/xhtml">The finer-grained your interfaces, the more flexible your system will be but remember that flexibility has a cost, which can become very high very quickly. </span><span class="koboSpan" id="kobo.745.4" xmlns="http://www.w3.org/1999/xhtml">For example, your highly-flexible system may be very hard to navigate and understand, increasing the cognitive load required to work on the project.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.746.1" xmlns="http://www.w3.org/1999/xhtml">Next, we explore the last of the SOLID principles.</span></p>
</section>
</section>
<section class="level3" data-number="4.5.5" id="dependency-inversion-principle-dip">
<h3 data-number="4.5.5"><span class="koboSpan" id="kobo.747.1" xmlns="http://www.w3.org/1999/xhtml">Dependency inversion principle (DIP)</span></h3>
<p><span class="koboSpan" id="kobo.748.1" xmlns="http://www.w3.org/1999/xhtml">The DIP provides flexibility, testability, and modularity, by reducing tight coupling between classes or modules.Let’s continue with another quote from Robert C. </span><span class="koboSpan" id="kobo.748.2" xmlns="http://www.w3.org/1999/xhtml">Martin (including the implied context from Wikipedia):</span></p>
<blockquote>
<em><span class="koboSpan" id="kobo.749.1" xmlns="http://www.w3.org/1999/xhtml">One should “depend upon abstractions, [not] concretions.”</span></em>
</blockquote>
<p><span class="koboSpan" id="kobo.750.1" xmlns="http://www.w3.org/1999/xhtml">In the previous section, we explored interfaces (abstractions), one of the pivotal elements of our SOLID arsenal, and using interfaces is the best way to approach the DIP.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.751.1" xmlns="http://www.w3.org/1999/xhtml">Are you wondering why not use abstract classes? </span><span class="koboSpan" id="kobo.751.2" xmlns="http://www.w3.org/1999/xhtml">While helpful at providing default behaviors over inheritance, they’re not fully abstract. </span><span class="koboSpan" id="kobo.751.3" xmlns="http://www.w3.org/1999/xhtml">If one is, it’s better to use an interface instead.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.752.1" xmlns="http://www.w3.org/1999/xhtml">Interfaces are more flexible and powerful, acting as contracts between parts of a system. </span><span class="koboSpan" id="kobo.752.2" xmlns="http://www.w3.org/1999/xhtml">They also allow a class to implement multiple interfaces, boosting flexibility. </span><span class="koboSpan" id="kobo.752.3" xmlns="http://www.w3.org/1999/xhtml">However, don’t discard abstract classes mindlessly. </span><span class="koboSpan" id="kobo.752.4" xmlns="http://www.w3.org/1999/xhtml">Actually, don’t discard anything mindlessly.</span></p>
</blockquote>
</blockquote>
<p><span class="koboSpan" id="kobo.753.1" xmlns="http://www.w3.org/1999/xhtml">Exposing interfaces can save countless hours of struggling to find complex workaround when writing unit tests. </span><span class="koboSpan" id="kobo.753.2" xmlns="http://www.w3.org/1999/xhtml">That is even more true when building a framework or library that others use. </span><span class="koboSpan" id="kobo.753.3" xmlns="http://www.w3.org/1999/xhtml">In that case, please pay even more attention to providing your consumers with interfaces to mock if necessary.All that talk about interfaces again is great, but how can we invert the flow of dependencies? </span><span class="koboSpan" id="kobo.753.4" xmlns="http://www.w3.org/1999/xhtml">Spoiler alert: interfaces!Let’s compare a direct dependency and an inverted dependency first.</span></p>
<section class="level4" data-number="4.5.5.1" id="direct-dependency">
<h4 data-number="4.5.5.1"><span class="koboSpan" id="kobo.754.1" xmlns="http://www.w3.org/1999/xhtml">Direct dependency</span></h4>
<p><span class="koboSpan" id="kobo.755.1" xmlns="http://www.w3.org/1999/xhtml">A direct dependency occurs when a particular piece of code (like a class or a module) relies directly on another. </span><span class="koboSpan" id="kobo.755.2" xmlns="http://www.w3.org/1999/xhtml">For example, if Class A uses a method from Class B, then Class A directly depends on Class B, which is a typical scenario in traditional programming.Say we have a </span><code><span class="koboSpan" id="kobo.756.1" xmlns="http://www.w3.org/1999/xhtml">SomeService</span></code><span class="koboSpan" id="kobo.757.1" xmlns="http://www.w3.org/1999/xhtml"> class that uses the </span><code><span class="koboSpan" id="kobo.758.1" xmlns="http://www.w3.org/1999/xhtml">SqlDataPersistence</span></code><span class="koboSpan" id="kobo.759.1" xmlns="http://www.w3.org/1999/xhtml"> class for production but the </span><code><span class="koboSpan" id="kobo.760.1" xmlns="http://www.w3.org/1999/xhtml">LocalDataPersistence</span></code><span class="koboSpan" id="kobo.761.1" xmlns="http://www.w3.org/1999/xhtml"> class during development and testing. </span><span class="koboSpan" id="kobo.761.2" xmlns="http://www.w3.org/1999/xhtml">Without inverting the dependency flow, we end up with the following UML dependency graph:</span></p>
<figure>
<span class="koboSpan" id="kobo.762.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 3.2: Direct dependency graph schema" src="../media/file14.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.763.1" xmlns="http://www.w3.org/1999/xhtml">Figure 3.2: Direct dependency graph schema</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.764.1" xmlns="http://www.w3.org/1999/xhtml">With the preceding system, we could not change the </span><code><span class="koboSpan" id="kobo.765.1" xmlns="http://www.w3.org/1999/xhtml">SqlDataPersistence</span></code><span class="koboSpan" id="kobo.766.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code><span class="koboSpan" id="kobo.767.1" xmlns="http://www.w3.org/1999/xhtml">LocalDataPersistence</span></code><span class="koboSpan" id="kobo.768.1" xmlns="http://www.w3.org/1999/xhtml"> classes by the </span><code><span class="koboSpan" id="kobo.769.1" xmlns="http://www.w3.org/1999/xhtml">CosmosDbDataPersistence</span></code><span class="koboSpan" id="kobo.770.1" xmlns="http://www.w3.org/1999/xhtml"> class (not in the diagram) without impacting the </span><code><span class="koboSpan" id="kobo.771.1" xmlns="http://www.w3.org/1999/xhtml">SomeService</span></code><span class="koboSpan" id="kobo.772.1" xmlns="http://www.w3.org/1999/xhtml"> class.We call direct dependencies like these </span><strong><span class="koboSpan" id="kobo.773.1" xmlns="http://www.w3.org/1999/xhtml">tight coupling</span></strong><span class="koboSpan" id="kobo.774.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</section>
<section class="level4" data-number="4.5.5.2" id="inverted-dependency">
<h4 data-number="4.5.5.2"><span class="koboSpan" id="kobo.775.1" xmlns="http://www.w3.org/1999/xhtml">Inverted dependency</span></h4>
<p><span class="koboSpan" id="kobo.776.1" xmlns="http://www.w3.org/1999/xhtml">An inverted dependency occurs when high-level modules (which provide complex logic) are independent of low-level modules (which provide basic, foundational operations). </span><span class="koboSpan" id="kobo.776.2" xmlns="http://www.w3.org/1999/xhtml">We can achieve this by introducing an abstraction (like an interface) between the modules. </span><span class="koboSpan" id="kobo.776.3" xmlns="http://www.w3.org/1999/xhtml">This means that instead of Class A depending directly on Class B, Class A would rely on an abstraction that Class B implements.Here is the updated schema that improves the direct dependency example:</span></p>
<figure>
<span class="koboSpan" id="kobo.777.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 3.3: Indirect dependency graph schema" src="../media/file15.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.778.1" xmlns="http://www.w3.org/1999/xhtml">Figure 3.3: Indirect dependency graph schema</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.779.1" xmlns="http://www.w3.org/1999/xhtml">In the preceding diagram, we successfully inverted the dependency flow by ensuring the </span><code><span class="koboSpan" id="kobo.780.1" xmlns="http://www.w3.org/1999/xhtml">SomeService</span></code><span class="koboSpan" id="kobo.781.1" xmlns="http://www.w3.org/1999/xhtml"> class depends only on an </span><code><span class="koboSpan" id="kobo.782.1" xmlns="http://www.w3.org/1999/xhtml">IDataPersistance</span></code><span class="koboSpan" id="kobo.783.1" xmlns="http://www.w3.org/1999/xhtml"> interface (abstraction) that the </span><code><span class="koboSpan" id="kobo.784.1" xmlns="http://www.w3.org/1999/xhtml">SqlDataPersistence</span></code><span class="koboSpan" id="kobo.785.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.786.1" xmlns="http://www.w3.org/1999/xhtml">LocalDataPersistence</span></code><span class="koboSpan" id="kobo.787.1" xmlns="http://www.w3.org/1999/xhtml"> classes implement. </span><span class="koboSpan" id="kobo.787.2" xmlns="http://www.w3.org/1999/xhtml">We could then use the </span><code><span class="koboSpan" id="kobo.788.1" xmlns="http://www.w3.org/1999/xhtml">CosmosDbDataPersistence</span></code><span class="koboSpan" id="kobo.789.1" xmlns="http://www.w3.org/1999/xhtml"> class (not in the diagram) without impacting the </span><code><span class="koboSpan" id="kobo.790.1" xmlns="http://www.w3.org/1999/xhtml">SomeService</span></code><span class="koboSpan" id="kobo.791.1" xmlns="http://www.w3.org/1999/xhtml"> class.We call inverted dependencies like these </span><strong><span class="koboSpan" id="kobo.792.1" xmlns="http://www.w3.org/1999/xhtml">loose coupling</span></strong><span class="koboSpan" id="kobo.793.1" xmlns="http://www.w3.org/1999/xhtml">.Now that we covered how to invert the dependency flow of classes, we look at inverting subsystems.</span></p>
</section>
<section class="level4" data-number="4.5.5.3" id="direct-subsystems-dependency">
<h4 data-number="4.5.5.3"><span class="koboSpan" id="kobo.794.1" xmlns="http://www.w3.org/1999/xhtml">Direct subsystems dependency</span></h4>
<p><span class="koboSpan" id="kobo.795.1" xmlns="http://www.w3.org/1999/xhtml">The preceding direct dependency example divided into packages, which have the same issue, would look like the following:</span></p>
<figure>
<span class="koboSpan" id="kobo.796.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 3.3: direct dependency graph divided into packages" src="../media/file16.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.797.1" xmlns="http://www.w3.org/1999/xhtml">Figure 3.3: direct dependency graph divided into packages</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.798.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.799.1" xmlns="http://www.w3.org/1999/xhtml">Core</span></code><span class="koboSpan" id="kobo.800.1" xmlns="http://www.w3.org/1999/xhtml"> package depends on the </span><code><span class="koboSpan" id="kobo.801.1" xmlns="http://www.w3.org/1999/xhtml">SQL</span></code><span class="koboSpan" id="kobo.802.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.803.1" xmlns="http://www.w3.org/1999/xhtml">Local</span></code><span class="koboSpan" id="kobo.804.1" xmlns="http://www.w3.org/1999/xhtml"> packages leading to tight coupling.</span></p>
<blockquote>
<p><span class="koboSpan" id="kobo.805.1" xmlns="http://www.w3.org/1999/xhtml">Packages usually represent assemblies or namespaces. </span><span class="koboSpan" id="kobo.805.2" xmlns="http://www.w3.org/1999/xhtml">However, dividing responsibilities around assemblies allows loading only the implementations that the program need. </span><span class="koboSpan" id="kobo.805.3" xmlns="http://www.w3.org/1999/xhtml">For example, one program could load the </span><code><span class="koboSpan" id="kobo.806.1" xmlns="http://www.w3.org/1999/xhtml">Local</span></code><span class="koboSpan" id="kobo.807.1" xmlns="http://www.w3.org/1999/xhtml"> assembly, another could load the </span><code><span class="koboSpan" id="kobo.808.1" xmlns="http://www.w3.org/1999/xhtml">SQL</span></code><span class="koboSpan" id="kobo.809.1" xmlns="http://www.w3.org/1999/xhtml"> assembly, and a third could load both.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.810.1" xmlns="http://www.w3.org/1999/xhtml">Enough said; let’s invert the dependency flow of those subsystems.</span></p>
</section>
<section class="level4" data-number="4.5.5.4" id="inverted-subsystems-dependency">
<h4 data-number="4.5.5.4"><span class="koboSpan" id="kobo.811.1" xmlns="http://www.w3.org/1999/xhtml">Inverted subsystems dependency</span></h4>
<p><span class="koboSpan" id="kobo.812.1" xmlns="http://www.w3.org/1999/xhtml">We discussed modules and packages, yet the example diagram of inverted dependency illustrated classes. </span><span class="koboSpan" id="kobo.812.2" xmlns="http://www.w3.org/1999/xhtml">Using a similar approach, we can reduce dependencies between subsystems and create more flexible programs by arranging our code in separate assemblies. </span><span class="koboSpan" id="kobo.812.3" xmlns="http://www.w3.org/1999/xhtml">This way, we can achieve loose coupling and improved modularity in our software. </span><span class="koboSpan" id="kobo.812.4" xmlns="http://www.w3.org/1999/xhtml">To continue the inverted dependency example, we can do the following:</span></p>
<ol>
<li><span class="koboSpan" id="kobo.813.1" xmlns="http://www.w3.org/1999/xhtml">Create an abstraction assembly containing only interfaces.</span></li>
<li><span class="koboSpan" id="kobo.814.1" xmlns="http://www.w3.org/1999/xhtml">Create other assemblies that contain the implementation of the contracts from that first assembly.</span></li>
<li><span class="koboSpan" id="kobo.815.1" xmlns="http://www.w3.org/1999/xhtml">Create assemblies that consume the code through the abstraction assembly.</span></li>
</ol>
<blockquote>
<p><span class="koboSpan" id="kobo.816.1" xmlns="http://www.w3.org/1999/xhtml">There are multiple examples of this in .NET, such as the </span><code><span class="koboSpan" id="kobo.817.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft.Extensions.DependencyInjection.Abstractions</span></code><span class="koboSpan" id="kobo.818.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.819.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft.Extensions.DependencyInjection</span></code><span class="koboSpan" id="kobo.820.1" xmlns="http://www.w3.org/1999/xhtml"> assemblies. </span><span class="koboSpan" id="kobo.820.2" xmlns="http://www.w3.org/1999/xhtml">We explore this concept further in </span><em><span class="koboSpan" id="kobo.821.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 12</span></em><span class="koboSpan" id="kobo.822.1" xmlns="http://www.w3.org/1999/xhtml">, </span><em><span class="koboSpan" id="kobo.823.1" xmlns="http://www.w3.org/1999/xhtml">Layering and Clean Architecture</span></em><span class="koboSpan" id="kobo.824.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.825.1" xmlns="http://www.w3.org/1999/xhtml">Then, if we divide the inverted dependency examples into multiple packages, it would look like the following:</span></p>
<figure>
<span class="koboSpan" id="kobo.826.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 3.4: inverted dependency examples divided into multiple packages" src="../media/file17.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.827.1" xmlns="http://www.w3.org/1999/xhtml">Figure 3.4: inverted dependency examples divided into multiple packages</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.828.1" xmlns="http://www.w3.org/1999/xhtml">In the diagram, the </span><code><span class="koboSpan" id="kobo.829.1" xmlns="http://www.w3.org/1999/xhtml">Core</span></code><span class="koboSpan" id="kobo.830.1" xmlns="http://www.w3.org/1999/xhtml"> package directly depends on the </span><code><span class="koboSpan" id="kobo.831.1" xmlns="http://www.w3.org/1999/xhtml">Abstractions</span></code><span class="koboSpan" id="kobo.832.1" xmlns="http://www.w3.org/1999/xhtml"> package, while two implementations are available: </span><code><span class="koboSpan" id="kobo.833.1" xmlns="http://www.w3.org/1999/xhtml">Local</span></code><span class="koboSpan" id="kobo.834.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.835.1" xmlns="http://www.w3.org/1999/xhtml">Sql</span></code><span class="koboSpan" id="kobo.836.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.836.2" xmlns="http://www.w3.org/1999/xhtml">Since we only rely on abstractions, we can swap one implementation for the other without impacting </span><code><span class="koboSpan" id="kobo.837.1" xmlns="http://www.w3.org/1999/xhtml">Core</span></code><span class="koboSpan" id="kobo.838.1" xmlns="http://www.w3.org/1999/xhtml">, and the program will run just fine unless something is wrong with the implementation itself (but that has nothing to do with the DIP).We could also create a new </span><code><span class="koboSpan" id="kobo.839.1" xmlns="http://www.w3.org/1999/xhtml">CosmosDb</span></code><span class="koboSpan" id="kobo.840.1" xmlns="http://www.w3.org/1999/xhtml"> package and a </span><code><span class="koboSpan" id="kobo.841.1" xmlns="http://www.w3.org/1999/xhtml">CosmosDbDataPersistence</span></code><span class="koboSpan" id="kobo.842.1" xmlns="http://www.w3.org/1999/xhtml"> class that implements the </span><code><span class="koboSpan" id="kobo.843.1" xmlns="http://www.w3.org/1999/xhtml">IDataPersistence</span></code><span class="koboSpan" id="kobo.844.1" xmlns="http://www.w3.org/1999/xhtml"> interface, then use it in the </span><code><span class="koboSpan" id="kobo.845.1" xmlns="http://www.w3.org/1999/xhtml">Core</span></code><span class="koboSpan" id="kobo.846.1" xmlns="http://www.w3.org/1999/xhtml"> without breaking anything. </span><span class="koboSpan" id="kobo.846.2" xmlns="http://www.w3.org/1999/xhtml">Why? </span><span class="koboSpan" id="kobo.846.3" xmlns="http://www.w3.org/1999/xhtml">Because we are only directly depending on abstractions, leading to a loosely coupled system.Next, we dig into some code.</span></p>
</section>
<section class="level4" data-number="4.5.5.5" id="project-dependency-inversion">
<h4 data-number="4.5.5.5"><span class="koboSpan" id="kobo.847.1" xmlns="http://www.w3.org/1999/xhtml">Project – Dependency inversion</span></h4>
<p><span class="koboSpan" id="kobo.848.1" xmlns="http://www.w3.org/1999/xhtml">In this section, we translate the preceding iteration of the inverted dependency example in code. </span><span class="koboSpan" id="kobo.848.2" xmlns="http://www.w3.org/1999/xhtml">We create the following assemblies to align with the preceding diagram:</span></p>
<ul>
<li><code><span class="koboSpan" id="kobo.849.1" xmlns="http://www.w3.org/1999/xhtml">App</span></code><span class="koboSpan" id="kobo.850.1" xmlns="http://www.w3.org/1999/xhtml"> is a console application that references all projects to showcase different use cases.</span></li>
<li><code><span class="koboSpan" id="kobo.851.1" xmlns="http://www.w3.org/1999/xhtml">Core</span></code><span class="koboSpan" id="kobo.852.1" xmlns="http://www.w3.org/1999/xhtml"> is a class library that depends on the </span><code><span class="koboSpan" id="kobo.853.1" xmlns="http://www.w3.org/1999/xhtml">Abstractions</span></code><span class="koboSpan" id="kobo.854.1" xmlns="http://www.w3.org/1999/xhtml"> package.</span></li>
<li><code><span class="koboSpan" id="kobo.855.1" xmlns="http://www.w3.org/1999/xhtml">Abstractions</span></code><span class="koboSpan" id="kobo.856.1" xmlns="http://www.w3.org/1999/xhtml"> is a class library that contains the </span><code><span class="koboSpan" id="kobo.857.1" xmlns="http://www.w3.org/1999/xhtml">IDataPersistence</span></code><span class="koboSpan" id="kobo.858.1" xmlns="http://www.w3.org/1999/xhtml"> interface.</span></li>
<li><code><span class="koboSpan" id="kobo.859.1" xmlns="http://www.w3.org/1999/xhtml">Sql</span></code><span class="koboSpan" id="kobo.860.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.861.1" xmlns="http://www.w3.org/1999/xhtml">Local</span></code><span class="koboSpan" id="kobo.862.1" xmlns="http://www.w3.org/1999/xhtml"> are class libraries that reference the </span><code><span class="koboSpan" id="kobo.863.1" xmlns="http://www.w3.org/1999/xhtml">Abstractions</span></code><span class="koboSpan" id="kobo.864.1" xmlns="http://www.w3.org/1999/xhtml"> project and implement the </span><code><span class="koboSpan" id="kobo.865.1" xmlns="http://www.w3.org/1999/xhtml">IDataPersistence</span></code><span class="koboSpan" id="kobo.866.1" xmlns="http://www.w3.org/1999/xhtml"> interface.</span></li>
</ul>
<blockquote>
<p><span class="koboSpan" id="kobo.867.1" xmlns="http://www.w3.org/1999/xhtml">The code sample has few implementation details because it is irrelevant to understanding the DIP. </span><span class="koboSpan" id="kobo.867.2" xmlns="http://www.w3.org/1999/xhtml">Please assume we implemented the </span><code><span class="koboSpan" id="kobo.868.1" xmlns="http://www.w3.org/1999/xhtml">Persist</span></code><span class="koboSpan" id="kobo.869.1" xmlns="http://www.w3.org/1999/xhtml"> methods logic using your favorite in-memory and SQL databases.</span></p>
</blockquote>
<p><span class="koboSpan" id="kobo.870.1" xmlns="http://www.w3.org/1999/xhtml">Visually, the relationships between the packages look like the following:</span></p>
<figure>
<span class="koboSpan" id="kobo.871.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 3.5: the visual representation of the packages and their relationships" src="../media/file18.png"/></span><figcaption aria-hidden="true"><span class="koboSpan" id="kobo.872.1" xmlns="http://www.w3.org/1999/xhtml">Figure 3.5: the visual representation of the packages and their relationships</span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.873.1" xmlns="http://www.w3.org/1999/xhtml">Code-wise, our abstraction contains a </span><code><span class="koboSpan" id="kobo.874.1" xmlns="http://www.w3.org/1999/xhtml">Persist</span></code><span class="koboSpan" id="kobo.875.1" xmlns="http://www.w3.org/1999/xhtml"> method that we use to showcase the DIP:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.876.1" xmlns="http://www.w3.org/1999/xhtml">namespace Abstractions;
public interface IDataPersistence
{
    void Persist();
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.877.1" xmlns="http://www.w3.org/1999/xhtml">Next, the </span><code><span class="koboSpan" id="kobo.878.1" xmlns="http://www.w3.org/1999/xhtml">LocalDataPersistence</span></code><span class="koboSpan" id="kobo.879.1" xmlns="http://www.w3.org/1999/xhtml"> class depends on the </span><code><span class="koboSpan" id="kobo.880.1" xmlns="http://www.w3.org/1999/xhtml">Abstractions</span></code><span class="koboSpan" id="kobo.881.1" xmlns="http://www.w3.org/1999/xhtml"> package and outputs a line to the console, allowing us to trace what happens in the system:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.882.1" xmlns="http://www.w3.org/1999/xhtml">using Abstractions;
namespace Local;
public class LocalDataPersistence : IDataPersistence
{
    public void Persist()
    {
        Console.WriteLine("Data persisted by LocalDataPersistence.");
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.883.1" xmlns="http://www.w3.org/1999/xhtml">Next, the </span><code><span class="koboSpan" id="kobo.884.1" xmlns="http://www.w3.org/1999/xhtml">SqlDataPersistence</span></code><span class="koboSpan" id="kobo.885.1" xmlns="http://www.w3.org/1999/xhtml"> class is very similar to the </span><code><span class="koboSpan" id="kobo.886.1" xmlns="http://www.w3.org/1999/xhtml">LocalDataPersistence</span></code><span class="koboSpan" id="kobo.887.1" xmlns="http://www.w3.org/1999/xhtml"> class; it depends on the </span><code><span class="koboSpan" id="kobo.888.1" xmlns="http://www.w3.org/1999/xhtml">Abstractions</span></code><span class="koboSpan" id="kobo.889.1" xmlns="http://www.w3.org/1999/xhtml"> package and outputs a line in the console, allowing us to trace what happens in the system:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.890.1" xmlns="http://www.w3.org/1999/xhtml">using Abstractions;
namespace Sql;
public class SqlDataPersistence : IDataPersistence
{
    public void Persist()
    {
        Console.WriteLine("Data persisted by SqlDataPersistence.");
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.891.1" xmlns="http://www.w3.org/1999/xhtml">Before we get to the program flow, we still have the </span><code><span class="koboSpan" id="kobo.892.1" xmlns="http://www.w3.org/1999/xhtml">SomeService</span></code><span class="koboSpan" id="kobo.893.1" xmlns="http://www.w3.org/1999/xhtml"> class to look at, which depends on the </span><code><span class="koboSpan" id="kobo.894.1" xmlns="http://www.w3.org/1999/xhtml">Abstractions</span></code><span class="koboSpan" id="kobo.895.1" xmlns="http://www.w3.org/1999/xhtml"> package:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.896.1" xmlns="http://www.w3.org/1999/xhtml">using Abstractions;
namespace App;
public class SomeService
{
    public void Operation(IDataPersistence someDataPersistence)
    {
        Console.WriteLine("Beginning SomeService.Operation.");
        someDataPersistence.Persist();
        Console.WriteLine("SomeService.Operation has ended.");
    }
}</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.897.1" xmlns="http://www.w3.org/1999/xhtml">The highlighted code shows that the </span><code><span class="koboSpan" id="kobo.898.1" xmlns="http://www.w3.org/1999/xhtml">SomeService</span></code><span class="koboSpan" id="kobo.899.1" xmlns="http://www.w3.org/1999/xhtml"> class calls the </span><code><span class="koboSpan" id="kobo.900.1" xmlns="http://www.w3.org/1999/xhtml">Persist</span></code><span class="koboSpan" id="kobo.901.1" xmlns="http://www.w3.org/1999/xhtml"> method of the provided </span><code><span class="koboSpan" id="kobo.902.1" xmlns="http://www.w3.org/1999/xhtml">IDataPersistence</span></code><span class="koboSpan" id="kobo.903.1" xmlns="http://www.w3.org/1999/xhtml"> interface implementation. </span><span class="koboSpan" id="kobo.903.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.904.1" xmlns="http://www.w3.org/1999/xhtml">SomeService</span></code><span class="koboSpan" id="kobo.905.1" xmlns="http://www.w3.org/1999/xhtml"> class is not aware of where the data go. </span><span class="koboSpan" id="kobo.905.2" xmlns="http://www.w3.org/1999/xhtml">In the case of full implementation, the </span><code><span class="koboSpan" id="kobo.906.1" xmlns="http://www.w3.org/1999/xhtml">someDataPersistence</span></code><span class="koboSpan" id="kobo.907.1" xmlns="http://www.w3.org/1999/xhtml"> instance is responsible for where the data would be persisted. </span><span class="koboSpan" id="kobo.907.2" xmlns="http://www.w3.org/1999/xhtml">Other than that, the </span><code><span class="koboSpan" id="kobo.908.1" xmlns="http://www.w3.org/1999/xhtml">Operation</span></code><span class="koboSpan" id="kobo.909.1" xmlns="http://www.w3.org/1999/xhtml"> method writes lines to the console so we can trace what happens. </span><span class="koboSpan" id="kobo.909.2" xmlns="http://www.w3.org/1999/xhtml">Now from the </span><code><span class="koboSpan" id="kobo.910.1" xmlns="http://www.w3.org/1999/xhtml">App</span></code><span class="koboSpan" id="kobo.911.1" xmlns="http://www.w3.org/1999/xhtml"> package, the </span><code><span class="koboSpan" id="kobo.912.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.913.1" xmlns="http://www.w3.org/1999/xhtml"> file contains the following code:</span></p>
<div class="C0-CodePACKT">
<pre><code><span class="koboSpan" id="kobo.914.1" xmlns="http://www.w3.org/1999/xhtml">using Core;
using Local;
using Sql;
var sqlDataPersistence = new SqlDataPersistence();
var localDataPersistence = new LocalDataPersistence();
var service = new SomeService();
service.Operation(localDataPersistence);
service.Operation(sqlDataPersistence);</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.915.1" xmlns="http://www.w3.org/1999/xhtml">In the preceding code, we create a </span><code><span class="koboSpan" id="kobo.916.1" xmlns="http://www.w3.org/1999/xhtml">SqlDataPersistence</span></code><span class="koboSpan" id="kobo.917.1" xmlns="http://www.w3.org/1999/xhtml"> and a </span><code><span class="koboSpan" id="kobo.918.1" xmlns="http://www.w3.org/1999/xhtml">LocalDataPersistence</span></code><span class="koboSpan" id="kobo.919.1" xmlns="http://www.w3.org/1999/xhtml"> instance. </span><span class="koboSpan" id="kobo.919.2" xmlns="http://www.w3.org/1999/xhtml">Doing that forced us to depend on both packages, but we could have chosen otherwise.Then we create an instance of the </span><code><span class="koboSpan" id="kobo.920.1" xmlns="http://www.w3.org/1999/xhtml">SomeService</span></code><span class="koboSpan" id="kobo.921.1" xmlns="http://www.w3.org/1999/xhtml"> class. </span><span class="koboSpan" id="kobo.921.2" xmlns="http://www.w3.org/1999/xhtml">We then pass both </span><code><span class="koboSpan" id="kobo.922.1" xmlns="http://www.w3.org/1999/xhtml">IDataPersistence</span></code><span class="koboSpan" id="kobo.923.1" xmlns="http://www.w3.org/1999/xhtml"> implementations to the </span><code><span class="koboSpan" id="kobo.924.1" xmlns="http://www.w3.org/1999/xhtml">Operation</span></code><span class="koboSpan" id="kobo.925.1" xmlns="http://www.w3.org/1999/xhtml"> method one after the other.When we execute the program we get the following output:</span></p>
<div class="C0-ConsolePACKT">
<pre><code><span class="koboSpan" id="kobo.926.1" xmlns="http://www.w3.org/1999/xhtml">Beginning SomeService.Operation.
</span><span class="koboSpan" id="kobo.926.2" xmlns="http://www.w3.org/1999/xhtml">Data persisted by LocalDataPersistence.
</span><span class="koboSpan" id="kobo.926.3" xmlns="http://www.w3.org/1999/xhtml">SomeService.Operation has ended.
</span><span class="koboSpan" id="kobo.926.4" xmlns="http://www.w3.org/1999/xhtml">Beginning SomeService.Operation.
</span><span class="koboSpan" id="kobo.926.5" xmlns="http://www.w3.org/1999/xhtml">Data persisted by SqlDataPersistence.
</span><span class="koboSpan" id="kobo.926.6" xmlns="http://www.w3.org/1999/xhtml">SomeService.Operation has ended.</span></code></pre>
</div>
<p><span class="koboSpan" id="kobo.927.1" xmlns="http://www.w3.org/1999/xhtml">The first half of the preceding terminal output represents the first call to the </span><code><span class="koboSpan" id="kobo.928.1" xmlns="http://www.w3.org/1999/xhtml">Operation</span></code><span class="koboSpan" id="kobo.929.1" xmlns="http://www.w3.org/1999/xhtml"> method, where we passed the </span><code><span class="koboSpan" id="kobo.930.1" xmlns="http://www.w3.org/1999/xhtml">LocalDataPersistence</span></code><span class="koboSpan" id="kobo.931.1" xmlns="http://www.w3.org/1999/xhtml"> instance. </span><span class="koboSpan" id="kobo.931.2" xmlns="http://www.w3.org/1999/xhtml">The second half represents the second call, where we passed the </span><code><span class="koboSpan" id="kobo.932.1" xmlns="http://www.w3.org/1999/xhtml">SqlDataPersistence</span></code><span class="koboSpan" id="kobo.933.1" xmlns="http://www.w3.org/1999/xhtml"> instance.The highlighted lines show that depending on an interface allowed us to change this behavior (OCP). </span><span class="koboSpan" id="kobo.933.2" xmlns="http://www.w3.org/1999/xhtml">Moreover, we could create a </span><code><span class="koboSpan" id="kobo.934.1" xmlns="http://www.w3.org/1999/xhtml">CosmosDb</span></code><span class="koboSpan" id="kobo.935.1" xmlns="http://www.w3.org/1999/xhtml"> package, reference it from the </span><code><span class="koboSpan" id="kobo.936.1" xmlns="http://www.w3.org/1999/xhtml">App</span></code><span class="koboSpan" id="kobo.937.1" xmlns="http://www.w3.org/1999/xhtml"> package, then pass an instance of a </span><code><span class="koboSpan" id="kobo.938.1" xmlns="http://www.w3.org/1999/xhtml">CosmosDbDataPersistence</span></code><span class="koboSpan" id="kobo.939.1" xmlns="http://www.w3.org/1999/xhtml"> class to the </span><code><span class="koboSpan" id="kobo.940.1" xmlns="http://www.w3.org/1999/xhtml">Operation</span></code><span class="koboSpan" id="kobo.941.1" xmlns="http://www.w3.org/1999/xhtml"> method, and the </span><code><span class="koboSpan" id="kobo.942.1" xmlns="http://www.w3.org/1999/xhtml">Core</span></code><span class="koboSpan" id="kobo.943.1" xmlns="http://www.w3.org/1999/xhtml"> package would not know about it. </span><span class="koboSpan" id="kobo.943.2" xmlns="http://www.w3.org/1999/xhtml">Why? </span><span class="koboSpan" id="kobo.943.3" xmlns="http://www.w3.org/1999/xhtml">Because we inverted the dependency flow, creating a loosely coupled system. </span><span class="koboSpan" id="kobo.943.4" xmlns="http://www.w3.org/1999/xhtml">We even did some </span><em><span class="koboSpan" id="kobo.944.1" xmlns="http://www.w3.org/1999/xhtml">dependency injection</span></em><span class="koboSpan" id="kobo.945.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<blockquote>
<p><strong><span class="koboSpan" id="kobo.946.1" xmlns="http://www.w3.org/1999/xhtml">Dependency injection</span></strong><span class="koboSpan" id="kobo.947.1" xmlns="http://www.w3.org/1999/xhtml">, or </span><strong><span class="koboSpan" id="kobo.948.1" xmlns="http://www.w3.org/1999/xhtml">Inversion of Control</span></strong><span class="koboSpan" id="kobo.949.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><strong><span class="koboSpan" id="kobo.950.1" xmlns="http://www.w3.org/1999/xhtml">IoC</span></strong><span class="koboSpan" id="kobo.951.1" xmlns="http://www.w3.org/1999/xhtml">), is a design principle that is a first-class citizen of ASP.NET Core. </span><span class="koboSpan" id="kobo.951.2" xmlns="http://www.w3.org/1999/xhtml">It allows us to map abstractions to implementations, and when we need a new type, the whole object tree gets created automatically based on our configuration. </span><span class="koboSpan" id="kobo.951.3" xmlns="http://www.w3.org/1999/xhtml">We start that journey in </span><em><span class="koboSpan" id="kobo.952.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 7</span></em><span class="koboSpan" id="kobo.953.1" xmlns="http://www.w3.org/1999/xhtml">, </span><em><span class="koboSpan" id="kobo.954.1" xmlns="http://www.w3.org/1999/xhtml">Dependency Injection</span></em><span class="koboSpan" id="kobo.955.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</blockquote>
</section>
<section class="level4" data-number="4.5.5.6" id="conclusion-3">
<h4 data-number="4.5.5.6"><span class="koboSpan" id="kobo.956.1" xmlns="http://www.w3.org/1999/xhtml">Conclusion</span></h4>
<p><span class="koboSpan" id="kobo.957.1" xmlns="http://www.w3.org/1999/xhtml">The core idea is to depend on abstractions. </span><span class="koboSpan" id="kobo.957.2" xmlns="http://www.w3.org/1999/xhtml">Interfaces are pure contracts, which makes them more flexible than abstract classes. </span><span class="koboSpan" id="kobo.957.3" xmlns="http://www.w3.org/1999/xhtml">Abstract classes are still helpful, and we explore ways to leverage them in the book.Depending on implementations (classes) creates tight coupling between classes, which leads to a system that can be harder to maintain. </span><span class="koboSpan" id="kobo.957.4" xmlns="http://www.w3.org/1999/xhtml">The cohesion between your dependencies is essential in whether the coupling will help or hurt you in the long run. </span><span class="koboSpan" id="kobo.957.5" xmlns="http://www.w3.org/1999/xhtml">Don’t discard concrete types everywhere mindlessly.</span></p>
</section>
</section>
</section>
<section class="level2" data-number="4.6" id="summary-2">
<h2 data-number="4.6"><span class="koboSpan" id="kobo.958.1" xmlns="http://www.w3.org/1999/xhtml">Summary</span></h2>
<p><span class="koboSpan" id="kobo.959.1" xmlns="http://www.w3.org/1999/xhtml">In this chapter, we covered many architectural principles. </span><span class="koboSpan" id="kobo.959.2" xmlns="http://www.w3.org/1999/xhtml">We began by exploring DRY, KISS, and separation of concerns principles before learning about the SOLID principles and their importance in modern software engineering. </span><span class="koboSpan" id="kobo.959.3" xmlns="http://www.w3.org/1999/xhtml">By following those principles, you should be able to build better, more maintainable software.As we also covered, principles are only principles, not laws. </span><span class="koboSpan" id="kobo.959.4" xmlns="http://www.w3.org/1999/xhtml">You must always be careful not to abuse them so they remain helpful instead of harmful. </span><span class="koboSpan" id="kobo.959.5" xmlns="http://www.w3.org/1999/xhtml">The context is always essential; internal tools and critical business applications require different levels of tinkering. </span><span class="koboSpan" id="kobo.959.6" xmlns="http://www.w3.org/1999/xhtml">The key takeaways from this chapter are:</span></p>
<ul>
<li><span class="koboSpan" id="kobo.960.1" xmlns="http://www.w3.org/1999/xhtml">Don’t over-engineer your solutions (KISS). </span></li>
<li><span class="koboSpan" id="kobo.961.1" xmlns="http://www.w3.org/1999/xhtml">Encapsulate and reuse business logic (DRY). </span></li>
<li><span class="koboSpan" id="kobo.962.1" xmlns="http://www.w3.org/1999/xhtml">Organize elements around concerns and responsibilities (SoC/SRP).</span></li>
<li><span class="koboSpan" id="kobo.963.1" xmlns="http://www.w3.org/1999/xhtml">Aim at composability (OCP).</span></li>
<li><span class="koboSpan" id="kobo.964.1" xmlns="http://www.w3.org/1999/xhtml">Support backward compatibility (LSP).</span></li>
<li><span class="koboSpan" id="kobo.965.1" xmlns="http://www.w3.org/1999/xhtml">Write granular interfaces/contracts (ISP).</span></li>
<li><span class="koboSpan" id="kobo.966.1" xmlns="http://www.w3.org/1999/xhtml">Depend on abstractions and invert the dependency flow (DIP).</span></li>
</ul>
<p><span class="koboSpan" id="kobo.967.1" xmlns="http://www.w3.org/1999/xhtml">With all those principles in our toolbox, we are ready to jump into design patterns and get our design level one step further, with the next chapter covering the MVC pattern in the context of ASP.NET Core REST APIs.Afterward, in the following few chapters, we explore how to implement some of the most frequently used Gang of Four (GoF) patterns and then how to apply them at another level using dependency injection.</span></p>
</section>
<section class="level2" data-number="4.7" id="questions-2">
<h2 data-number="4.7"><span class="koboSpan" id="kobo.968.1" xmlns="http://www.w3.org/1999/xhtml">Questions</span></h2>
<p><span class="koboSpan" id="kobo.969.1" xmlns="http://www.w3.org/1999/xhtml">Let’s take a look at a few practice questions:</span></p>
<ol>
<li><span class="koboSpan" id="kobo.970.1" xmlns="http://www.w3.org/1999/xhtml">How many principles are represented by the SOLID acronym?</span></li>
<li><span class="koboSpan" id="kobo.971.1" xmlns="http://www.w3.org/1999/xhtml">Is it true that when following the SOLID principles, the idea is to create bigger components that can each manage more elements of a program by creating God-sized classes?</span></li>
<li><span class="koboSpan" id="kobo.972.1" xmlns="http://www.w3.org/1999/xhtml">By following the DRY principle, you want to remove all code duplication from everywhere, irrespective of the source, and encapsulate that code into a reusable component. </span><span class="koboSpan" id="kobo.972.2" xmlns="http://www.w3.org/1999/xhtml">Is this affirmation correct?</span></li>
<li><span class="koboSpan" id="kobo.973.1" xmlns="http://www.w3.org/1999/xhtml">Is it true that the ISP tells us that creating multiple smaller interfaces is better than creating one large one?</span></li>
<li><span class="koboSpan" id="kobo.974.1" xmlns="http://www.w3.org/1999/xhtml">What principle tells us that creating multiple smaller classes that handle a single responsibility is better than one class handling multiple responsibilities?</span></li>
</ol>
</section>
<section class="level2" data-number="4.8" id="further-reading-2">
<h2 data-number="4.8"><span class="koboSpan" id="kobo.975.1" xmlns="http://www.w3.org/1999/xhtml">Further reading</span></h2>
<ul>
<li><span class="koboSpan" id="kobo.976.1" xmlns="http://www.w3.org/1999/xhtml">Covariance and contravariance (C#): </span><a href="https://adpg.link/BxBG"><span class="koboSpan" id="kobo.977.1" xmlns="http://www.w3.org/1999/xhtml">https://adpg.link/BxBG</span></a></li>
</ul>
</section>
</section>
</body>
</html>
