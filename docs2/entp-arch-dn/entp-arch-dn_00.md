# 前言

感谢您购买这本书！它源于工业化的信息系统需求。软件无处不在，但除了少数高成本应用外，它充满了错误，维护成本很高，大多数开发者有一半的时间在重新发明轮子或与信息系统抗争以添加一些新功能。

这是我从超过 25 年的行业经验以及为许多不同组织专门从事数字化转型工作几年来的严酷观察。这些不同的经历使我确信，根本问题始终相同：软件行业实际上并不遵循工业化的规则，即分解系统为更小的系统，并使用遵守标准接口的模块将模块连接起来。

与学者们合作帮助我正式化这些业务/IT 对齐的问题，以及它们的来源和可能的解决方案。但我的大多数客户都告诉我，我之所以能作为一个顾问脱颖而出，是因为我不仅能够为董事会提供清晰的转型计划，而且还能提供从语义到 API 合约的咨询建议，甚至在代码的难点部分提供一些实际的帮助。他们说这使得整个合作更具可感知性，并提供了可见的业务成果，因此这就是我想让这本书成为的样子：首先是一些理论，因为我们需要改变我们思考和创建信息系统的思维方式，但也需要一些代码，因为太多的人现在效率不高。

看到许多公司，从小型律师事务所到工业/物流企业，再到一些大型农业合作社，业务效率的积极影响，我确信将工业概念应用于软件设计和架构将变得越来越具有成本效益，尤其是在软件和数据成为大多数组织当今竞争支柱的情况下。

使用 API 接口的规范和标准，外部化诸如身份验证、授权、电子文档管理等功能，最重要的是，从业务功能而不是技术角度思考，如果要将信息系统从成本中心转变为组织的强大资产，这是至关重要的。

这种方法已经帮助了许多公司和政府机构，我希望它也能为您的信息系统带来同样的效果！

这本书面向的对象

这本书旨在帮助您以使其更具灵活性和为您的组织提供更多业务价值的方式创建或演进信息系统架构。由于它是理论性的、面向业务的，并且以.NET 应用为技术应用，它可以在多个层面上被许多人阅读：

+   董事会和高级管理人员可以通过阅读前几章来了解数字化转型及其战略规划。了解信息系统中最常见的问题应有助于他们投资于正确的领域并优先处理工作，不仅要考虑功能，还要在合理的情况下优先考虑技术债务的减少。

+   技术领导、架构师和研发经理也可以从阅读下一章中受益，这些章节使策略更加具体，并解释了在构建信息系统、选择工具和方法以及在其工作中应用一致性方面的最佳实践。

+   - 最后，开发人员或实际操作的架构师和技术总监将继续阅读本书的最后几章，通过编码不同的概念、连接外部服务以及编排 API 和 webhooks 来创建一个虽小但实用的示例系统。

# 本书涵盖的内容

*第一章*，*信息系统的悲哀状态*，解释了什么阻止了大多数信息系统提供应有的价值。它还提出了一些衡量信息系统效率的方法，重点关注大多数观察到的问题的根本原因。

*第二章*，*将工业原则应用于软件*，首先解释了工业化的特点，然后提出了一种将转型应用于信息系统管理的方法。它侧重于标准和规范的重要性，以降低大多数虚拟系统中的复杂性。

*第三章*，*实现业务一致性*，为前几章分析的问题增加了一层理论，解释了康威定律以及一些其他关于业务/IT 一致性的原则、模式和反模式。本章还介绍了四层图，该图将在本书的其余部分中使用。

*第四章*，*处理时间和技术债务*，阐述了技术债务的概念，并解释了信息系统通常一开始与其环境非常适应，但随着时间的推移逐渐偏离效率。它还反思了如何采用敏捷方法来处理架构。

*第五章*，*乌托邦式的完美 IT 系统*，讲述了一个绝对完美的信息系统愿景，该系统将完全符合业务需求，并且变更将像原始设计一样简单。即使这个乌托邦式的系统在现实中永远不会存在，它也会帮助你理解外部化功能和严格分离责任如何使现有的信息系统更加高效，并随着时间的推移简化其演变。

*第六章*, *从代码到系统的 SOLID 原则*，开始了一系列更技术性的章节。它讨论了通常适用于代码的 SOLID 原则，并将它们应用于系统架构。我们还展示了将作为本书其余部分应用实例的示例信息系统。

*第七章*, *C4 及其他方法*，列出了软件设计和架构中最著名的几种建筑方法。它分析了它们之间的差异和共同点，并为你提供了一些根据具体情况选择最适合的方法的途径。

*第八章*, *面向服务和 API*，从对历史上用于实现服务概念的所有技术的描述开始，解释了人们对这一概念有什么期望。它将解释标准和关键格式在服务中的有用性。

*第九章*, *探索领域驱动设计和语义*，关于拥有一个清晰的业务领域语义定义的重要性。尽管这听起来可能有点远离软件架构的概念，但它实际上是业务/IT 对齐方法的核心。

*第十章*, *主数据管理*，提供了一个结构化的视角，用于管理一个良好对齐的信息系统中的数据。主数据管理远不止是在数据库中持久化数据。它涉及定义其生命周期和相关的治理，并确保数据管理不断进步，尤其是在一些遗留数据存储库已经存在的情况下。

*第十一章*, *业务流程和低代码*，解释了业务流程在信息系统中的位置，以及如何使用如 BPMN 等标准正式描述它们。尽管这仍然是一个理论章节，但它描述了可以在信息系统中用于实施业务流程管理的工具。

*第十二章*, *业务规则外部化*，在数据和流程管理之后，完成了理想 IT 系统三个部分的闭环。它解释了什么是业务规则管理系统，并展示了某些实施示例。

*第十三章*, *授权外部化*，解释了身份和授权管理的概念，并展示了如何将其外部化以促进整个信息系统的发展。例如，**基于角色的访问控制**（**RBAC**）和**基于属性的访问控制**（**ABAC**）等范例也通过实例进行了说明。

*第十四章*，*分解功能职责*，是我们开始将前几章的知识应用到示例中的地方；我们将通过代码和服务来实际操作。本章首先使用四层图来建模系统，然后为将在外部应用中更好地考虑的功能准备技术规范。

*第十五章*，*插入标准外部模块*，考虑了这些规范，并为已识别的不同功能提出了一些现成的软件解决方案，例如 Apache Keycloak 用于身份和访问管理（IAM）、MongoDB 用于持久化、Alfresco 用于电子文档管理等等。

*第十六章*，*创建只写数据参照*，专注于示例信息系统的业务领域数据管理。它展示了如何用.NET 编写一个 API 服务器，以尽可能尊重标准以及之前描述的所有业务/IT 对齐原则来提供服务。

*第十七章*，*向数据参照服务添加查询*，在前一章的基础上增加了数据管理系统的一些功能，同时也展示了如何以工业方式对其进行测试。本章使用了如开放数据协议（Open Data Protocol）等标准来改进实现。

*第十八章*，*部署数据参照服务*，展示了如何部署前几章创建的服务以及如何将它们插入到 IAM 中。由于安全性是一个如此重要且复杂的主题，因此这是本章专门讨论的主题。

*第十九章*，*设计第二个数据参照服务*，使用前一章中提出的所有原则来构建第二个 API 实现，这次由于该服务必须使用 webhooks 并在本地缓存数据以减少对第一个数据参照服务的调用而变得复杂。尽管它没有增加任何新的原则，但它确实展示了如何在实践中实现松散耦合。

*第二十章*，*创建图形用户界面*，为我们的示例信息系统添加了一些图形界面，目前该系统仅暴露 API 端点。在展示基于 Web 的单页应用程序并解释业务/IT 对齐的概念和建议也适用于 GUI 领域之后，它详细说明了如何将数据分页机制与后端连接，并观察到职责的严格分离。

*第二十一章*，*扩展接口*，在前一章的基础上，将一些行业标准应用到之前构建的 GUI 上，即通过自动化测试它，同时也展示了如何自动化导入数据以将系统从其遗留数据管理迁移过来。它最后展示了良好的组件分离如何帮助，结合合适的技术栈，快速构建移动应用。

*第二十二章*，*整合业务流程*，通过解释如何通过 GUI、BPMN 引擎或 n8n 等低代码/无代码现代编排工具将业务流程集成到示例应用中，结束了与示例应用对应的章节集。它最后解释了何时需要专用服务来实现编排或编排。

*第二十三章*，*对系统进行修改*，通过展示已构建的信息系统现在可以通过受到副作用的影响或失去进一步发展的能力来支持各种变化，总结了本书的整个想法。在这一章中，我们将更改数据结构、GUI 和业务规则，特别是授权，甚至调整业务流程，希望展示初始架构规划使所有这些变得容易。

# 为了最大限度地利用本书

Docker 已被用于尽可能减少所需的工具。由于所有镜像都在线可用（甚至为示例信息系统创建的定制镜像，可在[`hub.docker.com/repositories/demoeditor`](https://hub.docker.com/repositories/demoeditor)找到），你只需要 Docker（有关安装说明，请参阅 https://docs.docker.com/engine/install/）来与该应用程序一起工作。镜像版本遵循代码分支。

如果你想要调试应用程序并对它进行一些更改以遵循书中的说明，那么你还需要.NET 8.0 SDK ([`dotnet.microsoft.com/download`](https://dotnet.microsoft.com/download))、Visual Studio Code ([`code.visualstudio.com/download`](https://code.visualstudio.com/download))和 Git ([`git-scm.com/book/en/v2/Getting-Started-Installing-Git`](https://git-scm.com/book/en/v2/Getting-Started-Installing-Git))。Postman ([`www.postman.com/`](https://www.postman.com/))也将被用来快速注入数据。

| **本书涵盖的软件/硬件** | **操作系统要求** |
| --- | --- |
| .NET 8.0 SDK | Windows, macOS, 或 Linux |
| Visual Studio Code |  |
| Git |  |
| Docker |  |
| Postman |  |

**如果您正在使用本书的数字版，我们建议您亲自输入代码或从书的 GitHub 仓库（下一节中提供链接）获取代码。这样做将帮助您避免与代码的复制和粘贴相关的任何潜在错误。**

# 下载示例代码文件

您可以从 GitHub 下载本书的示例代码文件 [`github.com/PacktPublishing/Enterprise-Architecture-with-.NET`](https://github.com/PacktPublishing/Enterprise-Architecture-with-.NET)。如果代码有更新，它将在 GitHub 仓库中更新。这个 GitHub 仓库是根据本书中示例构建步骤创建的分支：[`github.com/PacktPublishing/Enterprise-Architecture-with-.NET/tree/main/DemoEditor#versioning`](https://github.com/PacktPublishing/Enterprise-Architecture-with-.NET/tree/main/DemoEditor#versioning)。

我们还提供其他来自我们丰富图书和视频目录的代码包，可在 [`github.com/PacktPublishing/`](https://github.com/PacktPublishing/) 获取。查看它们吧！

# 使用的约定

本书使用了多种文本约定。

`文本中的代码`：表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称。以下是一个示例：“想象一下，我们使用一本书和`author`实体之间的链接。”

代码块设置如下：

```cs
{
    "rel": "author",
    "href": "https://demoeditor.com/authors/202312-007",
    "title": "JP Gouigoux",
    "authorMainContactPhone": "+33 787 787 787"
}
```

任何命令行输入或输出都应如下编写：

```cs
catch (Exception ex) {
  transac.Rollback();
  throw new ApplicationException("Transaction was cancelled",ex);
}
```

**粗体**：表示新术语、重要单词或屏幕上看到的单词。例如，菜单或对话框中的单词以**粗体**显示。以下是一个示例：“一旦连接，您将看到欢迎页面界面，您可以通过点击**Business Central**或屏幕左上角的家图标在任何时候返回该界面。”

小贴士或重要注意事项

看起来像这样。

# 联系我们

我们始终欢迎读者的反馈。

**一般反馈**：如果您对本书的任何方面有任何疑问，请通过电子邮件发送至 customercare@packtpub.com，并在邮件主题中提及书名。

**勘误**：尽管我们已经尽一切努力确保内容的准确性，但错误仍然可能发生。如果您在这本书中发现了错误，我们将不胜感激，如果您能向我们报告这一点。请访问 [www.packtpub.com/support/errata](http://www.packtpub.com/support/errata) 并填写表格。

**盗版**：如果您在互联网上发现我们作品的任何非法副本，无论形式如何，如果您能提供位置地址或网站名称，我们将不胜感激。请通过电子邮件发送至 copyright@packt.com 并附上材料的链接。

**如果您有兴趣成为作者**：如果您在某个领域有专业知识，并且有兴趣撰写或为书籍做出贡献，请访问[authors.packtpub.com](http://authors.packtpub.com)

# 分享您的想法

一旦您阅读了《.NET 企业架构》，我们很乐意听听您的想法！请[点击此处直接进入此书的亚马逊评论页面](https://packt.link/r/1-835-08566-0)并分享您的反馈。

您的评论对我们和科技社区都很重要，并将帮助我们确保我们提供高质量的内容。

# 下载本书的免费 PDF 副本

感谢您购买本书！

您喜欢在路上阅读，但又无法携带您的印刷书籍到处走？

您的电子书购买是否与您选择的设备不兼容？

别担心，现在，每购买一本 Packt 书籍，您都可以免费获得该书的 DRM 免费 PDF 版本。

在任何地方、任何设备上阅读。从您最喜欢的技术书籍中直接搜索、复制和粘贴代码到您的应用程序中。

优惠不会就此停止，您还可以获得独家折扣、时事通讯和每日收件箱中的精彩免费内容。

按照以下简单步骤获取优惠：

1.  扫描下面的二维码或访问以下链接！![二维码](img/B21293_QR_Free_PDF.jpg)

    [`packt.link/free-ebook/9781835085660`](https://packt.link/free-ebook/9781835085660)

1.  提交您的购买证明

1.  就这样！我们将直接将您的免费 PDF 和其他优惠发送到您的电子邮件

# 第一部分：与业务对齐的架构及其解决的问题

本书的第一部分完全不涉及技术，旨在提供对业务/IT 对齐的深入了解。它解释了现有信息系统中存在的困难和不足，以及一些工业化方法可能如何帮助克服这些问题。这对于面临数字化转型的人来说很有用。对于那些 IT 系统无法实现其功能承诺的人来说，很难发展，而且成本效益不高，也应该更好地理解为什么是这样。在解释原因和症状之后，本书的这一部分提出了一种理论方法，即乌托邦式的系统，将消除所有这些不足，并将指导下一部分的工作。

本部分包括以下章节：

+   *第一章*，*信息系统的不堪现状*

+   *第二章*，*将工业原则应用于软件*

+   *第三章*，*实现业务对齐*

+   *第四章*，*处理时间和技术债务*

+   *第五章*，*乌托邦式的完美 IT 系统*
