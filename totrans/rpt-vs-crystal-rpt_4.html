<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Creating First Report</h1></div></div></div><p>In this chapter, we will see how to create a simple report and display this report in our application. We will begin by preparing the report data and connecting that data to our report. Then we will formulate our report data and display the resulting report in our application.</p><p>We will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Preparing a report data</li><li class="listitem" style="list-style-type: disc">Adding a report to the application</li><li class="listitem" style="list-style-type: disc">Using a database expert</li><li class="listitem" style="list-style-type: disc">Choosing a report template</li><li class="listitem" style="list-style-type: disc">Creating report sections</li><li class="listitem" style="list-style-type: disc">Working with lines and boxes</li><li class="listitem" style="list-style-type: disc">Using special fields</li><li class="listitem" style="list-style-type: disc">Adding the report to a form</li></ul></div><div><div><div><div><h1 class="title"><a id="ch04lvl1sec22"/>Preparing a report data</h1></div></div></div><p>Before we begin to add <a id="id103" class="indexterm"/>Crystal Reports to our application, we need to understand the data that we will be displaying and know what data will be displayed in this report. Look at the design of the report in the following screenshot:</p><div><img src="img/4-1.jpg" alt="Preparing a report data"/></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec24"/>Selecting the report data</h2></div></div></div><p>As we can see in the <a id="id104" class="indexterm"/>preceding screenshot, all report data comes from the <code class="literal">Employees</code> table. The <strong>SELECT</strong> query will appear as shown in the following screenshot:</p><div><img src="img/4-2.jpg" alt="Selecting the report data"/></div><p>When we compare the report data with the data retrieved through the query, we will find two differences changes:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>The </strong><strong>Full Name</strong><strong> column</strong>: The <strong>Full Name</strong> column is displayed in the report as one part but in the database it consists of three parts (<strong>TitleOfCourtesy</strong>, <strong>FirstName</strong>, and <strong>LastName</strong>). We can address this problem here in the <code class="literal">SELECT</code> query or in the report itself. We can concatenate the three fields into one field using the SQL query by the plus (<code class="literal">+</code>) operator, as shown in the following screenshot:<div><img src="img/4-3.jpg" alt="Selecting the report data"/></div></li><li class="listitem" style="list-style-type: disc"><strong>The </strong><strong>Reports To</strong><strong> column</strong>: The <strong>Reports To</strong> column is displayed in the report as a name, but as we<a id="id105" class="indexterm"/> can see in the preceding screenshot it is displayed as number. If we look at the <strong>Employee</strong> table we will see that this table has a self-join relationship, see the following screenshot:<div><img src="img/4-4.jpg" alt="Selecting the report data"/></div></li></ul></div><p>We can modify our query to display names rather than numbers in two ways:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Using subquery</strong>: We will <a id="id106" class="indexterm"/>update the query to look like the following screenshot:<div><img src="img/4-5.jpg" alt="Selecting the report data"/></div></li><li class="listitem" style="list-style-type: disc"><strong>Using self join</strong>: We will <a id="id107" class="indexterm"/>update the query to look like the following screenshot:<div><img src="img/4-6.jpg" alt="Selecting the report data"/></div></li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec25"/>Creating a TableAdapter</h2></div></div></div><p>Here are the steps for<a id="id108" class="indexterm"/> creating a TableAdapter:</p><div><ol class="orderedlist arabic"><li class="listitem">Open <strong>DataSet1</strong> from <strong>Solution Explorer</strong>.</li><li class="listitem">Right-click on it and navigate to <strong>Add</strong> | <strong>TableAdapter</strong>.</li><li class="listitem">Select your connection settings and click on the <strong>Next</strong> button.</li><li class="listitem">Select the <strong>Use SQL Statements</strong> option and click on the <strong>Next</strong> button.</li><li class="listitem">Write our selection query as we see in the preceding screenshot and click on the <strong>Next</strong> button.</li><li class="listitem">Click on the <strong>Next</strong> button on the subsequent screens and click on the <strong>Finish</strong> button for the last screen.</li><li class="listitem">Change your <a id="id109" class="indexterm"/>adapter name as shown in the following screenshot:<div><img src="img/4-7.jpg" alt="Creating a TableAdapter"/></div></li></ol></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec23"/>Adding a report to the application</h1></div></div></div><p>In this section, we will see how to add <a id="id110" class="indexterm"/>Crystal Reports to our application to display all <strong>Employee</strong> data from the database.</p><div><ol class="orderedlist arabic"><li class="listitem">Right-click on our application (<strong>Monitor</strong>) in <strong>Solution Explorer</strong> and navigate to <strong>Add</strong> | <strong>New Item</strong>. We will get a result as shown in the following screenshot:<div><img src="img/4-8.jpg" alt="Adding a report to the application"/></div></li><li class="listitem">From the <a id="id111" class="indexterm"/>menu on the left-hand side, select <strong>Reporting</strong> and select <strong>Crystal Reports</strong> from the options on the right-hand side. Change the name to <code class="literal">crAllEmployees.rpt</code> and click on the <strong>Add</strong> button. We will get a result as shown in the following screenshot:<div><img src="img/4-9.jpg" alt="Adding a report to the application"/></div></li><li class="listitem">We have <a id="id112" class="indexterm"/>three options to create our report. From the preceding screenshot, we select <strong>Standard</strong> and use the report wizard to create the report. We will be using the other methods later and they will be explained in the following chapters. Click on the <strong>OK</strong> button to see the following screenshot:<div><img src="img/4-10.jpg" alt="Adding a report to the application"/></div></li><li class="listitem">In this step, we will<a id="id113" class="indexterm"/> choose our TableAdapter that we created before to be used in this report. We will expand <strong>Project Data</strong> | <strong>ADO.NET DataSets</strong> | <strong>Monitor.DataSet1</strong> and choose the <strong>Employees</strong> TableAdapter and move it to the <strong>Selected Tables</strong> list. Then click on the <strong>Next</strong> button as shown in the following screenshot:<div><img src="img/4-11.jpg" alt="Adding a report to the application"/></div></li><li class="listitem">In this step, <a id="id114" class="indexterm"/>we will choose the fields that we need to display in our report, we can add/remove these fields any time we need to after the report creation. Select all the required fields, move them to <strong>Fields To Display</strong> menu, and click on the <strong>Next</strong> button to see the following screenshot:<div><img src="img/4-12.jpg" alt="Adding a report to the application"/></div></li><li class="listitem">In this step we <a id="id115" class="indexterm"/>can add a group to our report, but we don't need any grouping in this report. We will use grouping in other reports and we will see that we can add any group after report creation. Click on the <strong>Next</strong> button to see the following screenshot:<div><img src="img/4-13.jpg" alt="Adding a report to the application"/></div></li><li class="listitem">In this step we <a id="id116" class="indexterm"/>can add a filter to our report, but we don't need any filter in this report. We will use filters in other reports and we can add any filter after the report is created. Click on the <strong>Next</strong> button to see the following screenshot:<div><img src="img/4-14.jpg" alt="Adding a report to the application"/></div></li><li class="listitem">In this step we<a id="id117" class="indexterm"/> will choose the report style. You can browse the styles available and choose the one you like. We will choose the <strong>Standard</strong> style and click on the <strong>Finish</strong> button to see the following screenshot:<div><img src="img/4-15.jpg" alt="Adding a report to the application"/></div></li><li class="listitem">This report has five main sections:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Section 1 (Report Header)</strong>: Any data (text, image, and so on) inserted in this section will be displayed in the report for one time in the top of the first paper only</li><li class="listitem" style="list-style-type: disc"><strong>Section 2 (Page Header)</strong>: Any data (text, image, and so on) inserted in this section will be displayed in the header of each page in the report</li><li class="listitem" style="list-style-type: disc"><strong>Section 3 (Details)</strong>: This section displays the data from the data source containing multiple rows of returned results like Microsoft SQL Server in our sample</li><li class="listitem" style="list-style-type: disc"><strong>Section 4 (Report Footer)</strong>: Any data (text, image, and so on) inserted in this section will be displayed for one time in the end of the last page in the report only</li><li class="listitem" style="list-style-type: disc"><strong>Section 5 (Page Footer)</strong>: Any data (text, image, and so on) inserted in this section will be displayed in the footer of each page in the report</li></ul></div></li><li class="listitem">We need to add <a id="id118" class="indexterm"/><strong>All Employees</strong> text as a header to our report so we will add it in the <strong>Report Header</strong> section:<div><ol class="orderedlist arabic"><li class="listitem">Right-click on <strong>Section2 (Report Header)</strong> and navigate to <strong>Insert</strong> | <strong>Text Object</strong>.</li><li class="listitem">Double-click on <strong>Text Object</strong> and enter <code class="literal">All Employees</code>.</li><li class="listitem">Right-click on <strong>Text Object</strong> and choose <strong>Format Object</strong>, navigate to the <strong>Font</strong> tab, and change <strong>Style</strong> to <strong>Bold</strong> and <strong>Size</strong> to <strong>12</strong>. Navigate to the <strong>Paragraph</strong> tab, change <strong>Alignment</strong> to <strong>Centered</strong> and click on the <strong>OK</strong> button.</li><li class="listitem">Move the <strong>Text Object</strong> to the horizontal middle of the section.</li></ol></div></li><li class="listitem">We will format all report objects and fields as we did with <strong>All Employees</strong> <strong>Text Object</strong> so the report will look like the following screenshot:<div><img src="img/4-16.jpg" alt="Adding a report to the application"/></div></li></ol></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec24"/>Working with lines and boxes</h1></div></div></div><p>In this section we will see how <a id="id119" class="indexterm"/>to use boxes<a id="id120" class="indexterm"/> and lines to enhance our report design.</p><div><ol class="orderedlist arabic"><li class="listitem">Right-click on <strong>Section 2(Page Header)</strong> and navigate to <strong>Insert</strong> | <strong>Box</strong> and draw a box around our fields as shown in the following screenshot:<div><img src="img/4-17.jpg" alt="Working with lines and boxes"/></div></li><li class="listitem">Right-click on <strong>Section 2(Page Header)</strong> and navigate to <strong>Insert</strong> | <strong>Line</strong> and draw a line as shown in the following screenshot:<div><img src="img/4-18.jpg" alt="Working with lines and boxes"/></div></li><li class="listitem">Add some lines between fields, as shown in the following screenshot:<div><img src="img/4-19.jpg" alt="Working with lines and boxes"/></div></li></ol></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec25"/>Using special fields</h1></div></div></div><p>In Crystal Reports, <a id="id121" class="indexterm"/>there are a lot of special fields that we can use in our reports; in this section we will see how to use these special fields.</p><p>We need to add the page number and total page number in the page footer to display the page location in the total page count. The steps for this purpose are as follows:</p><div><ol class="orderedlist arabic"><li class="listitem">Right-click in our report and navigate to <strong>Field Explorer</strong>.</li><li class="listitem">From <strong>Filed Explorer</strong>, open the <strong>Special Fields</strong> node and drag <strong>Page N of M</strong> to <strong>Section5 (Page Footer)</strong>. The <strong>Page N of M</strong> special field will replace <strong>N</strong> with the page number and <strong>M</strong> with the total pages count when we run the report. See the following screenshot:<div><img src="img/4-20.jpg" alt="Using special fields"/></div></li></ol></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec26"/>Adding the report to a form</h1></div></div></div><p>In the preceding steps, we <a id="id122" class="indexterm"/>have completed the report design; the next step is <a id="id123" class="indexterm"/>displaying this report when the user clicks on the <strong>btnEmpAll</strong> button.</p><div><ol class="orderedlist arabic"><li class="listitem">First, we will add a form that we will use to display all reports; we will name this form <code class="literal">ReportForm</code>.</li><li class="listitem">From <strong>Toolbox</strong> <strong>|</strong> <strong>Reporting</strong>, drag-and-drop <strong>crystalReportViewer</strong> to <strong>ReportForm</strong> and name it <code class="literal">crystalReportViewer1</code>.</li><li class="listitem">Double-click on <strong>btnEmpAll</strong> to navigate to the earlier code. We will see the <code class="literal">click</code> event of the <strong>btnEmpAll</strong> button.</li><li class="listitem">In the <code class="literal">click</code> event of the button <strong>btnEmpAll</strong>, enter the code as shown in the following screenshot:<div><img src="img/4-21.jpg" alt="Adding the report to a form"/></div></li><li class="listitem">This code has<a id="id124" class="indexterm"/> three parts:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Prepare report data</strong>: In the first <a id="id125" class="indexterm"/>three lines of code, we fill the dataset by the TableAdapter (<strong>EmployeesTableAdapter</strong>).</li><li class="listitem" style="list-style-type: disc"><strong>Pass data to our report</strong>: In the next two lines of code, we will pass the dataset to our report after we fill it with the data.</li><li class="listitem" style="list-style-type: disc"><strong>Display report in form</strong>: In the last three lines of code we pass our report to <strong>crystalReportViewer1</strong> in <strong>ReportForm</strong> and open this form to display our report.</li></ul></div></li><li class="listitem">Run our application (Press <em>F5</em>) and click on the <strong>btnEmpAll</strong> button (<strong>All</strong>) to see our report, as shown in the following screenshot:<div><img src="img/4-22.jpg" alt="Adding the report to a form"/></div></li></ol></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec27"/>Summary</h1></div></div></div><p>In this chapter, we learned how to create a simple report and display this report in our application. We have seen how to connect the report to the database and how to display and format the data in the report. In the next chapter, we will create new reports to learn grouping and sorting data. We will also learn how to use parameters to filter the table data.</p></div></body></html>