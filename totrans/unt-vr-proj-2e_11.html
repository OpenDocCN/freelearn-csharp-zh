<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Animation and VR Storytelling</h1>
                </header>
            
            <article>
                
<p class="calibre3">The stories we tell, and how we tell them, say a lot about who we are and what we will become. Storytelling between humans is as primal as any human activity, the basis of interpersonal communications, mythology, historical record, entertainment, and all of the arts. VR is emerging as one of the newest, and potentially most profound, storytelling media formats.</p>
<p class="calibre3">In the previous chapter, we looked at 360-degree media, which itself is becoming its own form of VR storytelling, especially for nonfictional documentary, capable of <span class="calibre6">transmitting human experience and</span> creating immersive empathy for humanitarian crises. Many of the tools and lessons we cover in this chapter can also be used with 360 media, but we're going to focus on 3D computer graphics and animation here.</p>
<p class="calibre3">For this project, w<span class="calibre6">e are going to create a little VR experience, a simplistic story about a bird who gains its wings and learns to fly.</span></p>
<p class="calibre3"><span class="calibre6">In this chapter, we are going to learn about the following topics:</span></p>
<ul class="calibre11">
<li class="calibre12">Importing and using external models and animations</li>
<li class="calibre12">Using Unity Timelines to activate and animate objects</li>
<li class="calibre12">Using the Animation editor window for editing property keyframes</li>
<li class="calibre12">Controlling Animation Clips with an Animation Controller</li>
<li class="calibre12">Making the story interactive </li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Composing our story </h1>
                </header>
            
            <article>
                
<p class="calibre3"><em class="calibre14">You start in a dark scene and notice a small sapling in the ground in front of you. It starts to grow into a tree. As dawn breaks, a bird's nest appears, and we notice it has an egg in it. The egg begins to shake, and then hatches. A baby bird emerges, hops around, grows, and tests its wings. Finally, in daylight, it flies away to freedom.</em></p>
<p class="calibre3">Our story is about birth, growth, spreading your wings (literally and figuratively), and moving on. We will start with a music soundtrack and animate our graphics based on its parts. </p>
<p class="calibre3">We are using free, off-the-shelf assets. Of course, you can use your own music and graphics, but we'll assume you're following along using the ones we have selected, which are all available online for free (links are given). As an instructive project, it's minimalistic and not embellished with effects that one might expect of a polished product. But you'd be very proud of your 9-year old cousin or nephew if they made it!</p>
<p class="calibre3">The soundtrack we will use is a rendition of The Beatles and Paul McCartney song, "Blackbird". (A download link is in the next section, and a copy is included with the files for this chapter for convenience.) Based on our mp3 recording of the song, we sketched out a rough timeline plan of our VR experience on a chart, shown here:</p>
<div class="mce-root1"><img src="assets/cac93114-28f5-41b7-871f-7af56d20d5a7.png" class="calibre84"/></div>
<p class="calibre3"> As indicated, the entire song is 165 seconds (2:45).  It starts with a 35-second instrumental intro, then verse one and verse two (also 35 seconds), a 25-second instrumental, and then verse three is 35 seconds. We'll use this to divide our story into five segments.</p>
<p class="calibre3"><span class="calibre6">Plenty of other features ought to be planned out as well. The scene lighting, for example, will start in the dark of night and gradually lighten the sky into dawn and then daytime. </span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Gathering the assets</h1>
                </header>
            
            <article>
                
<p class="calibre3">As mentioned, we're going to build our story from a variety of sources of free and simplistic assets. I recommend you download and install each of them now (or your own substitutions) so they're accessible as we work:</p>
<ul class="calibre11">
<li class="calibre12"><span>Music: The Beatles and Paul McCartney song, "Blackbird" performed by guitarist Salvatore Manalo. </span>Mp3 download:  <a href="http://mp3freeget4.online/play/the-beatles-paul-mccartney-blackbird-cover/chSrubUUdwc.html" class="calibre10">http://mp3freeget4.online/play/the-beatles-paul-mccartney-blackbird-cover/chSrubUUdwc.html</a></li>
<li class="calibre12">Scene and tree: Nature Starter Kit<span>,</span> <a href="https://assetstore.unity.com/packages/3d/environments/nature-starter-kit-1-49962" class="calibre10">https://assetstore.unity.com/packages/3d/environments/nature-starter-kit-1-49962</a></li>
<li class="calibre12">Nest and egg: Use the <kbd class="calibre13">NestAndEgg</kbd> prefab file provided with this book (source: tutorial using Cinema 4D: <a href="https://www.youtube.com/watch?v=jzoNZslTQfI" class="calibre10">https://www.youtube.com/watch?v=jzoNZslTQfI</a> , .c4d file download, <a href="https://yadi.sk/d/ZQep-K-AMKAc8" class="calibre10">https://yadi.sk/d/ZQep-K-AMKAc8</a>)</li>
<li class="calibre12">Living Birds: <a href="https://assetstore.unity.com/packages/3d/characters/animals/living-birds-15649" class="calibre10">https://assetstore.unity.com/packages/3d/characters/animals/living-birds-15649</a></li>
<li class="calibre12">Wispy Skybox: <a href="https://assetstore.unity.com/packages/2d/textures-materials/sky/wispy-skybox-21737" class="calibre10">https://assetstore.unity.com/packages/2d/textures-materials/sky/wispy-skybox-21737 </a></li>
</ul>
<p class="calibre3">Note that the nest and egg object we are using is modified from the one found online. That was in <kbd class="calibre13">.c4d</kbd> format, and we have converted it to <kbd class="calibre13">.fbx</kbd>, packaged them into a prefab, and made a few other changes. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating the initial scene</h1>
                </header>
            
            <article>
                
<p class="calibre3">We're going to make a simple, minimalist scene using a plane for the ground and some rocks from the Nature Starter Kit, a bird's nest with an egg, and a bird:</p>
<ol class="calibre15">
<li class="calibre12">Create a new scene (<span>File | New Scene</span>) and name it "Blackbird" (<span>File | Save Scene As</span>)</li>
<li class="calibre12">Create a 3D <span>Plane</span> named <kbd class="calibre13">GroundPlane</kbd>, reset its <span>Transform</span>, then <span>Scale</span> it to (<kbd class="calibre13">10, 10, 10</kbd>)</li>
<li class="calibre12">Create a new <span>Material</span> named <kbd class="calibre13">GroundMaterial</kbd>, set its <span>Albedo</span> color to an earthy brown (such as <kbd class="calibre13">#251906ff</kbd>), and drag the material onto the plane</li>
<li class="calibre12">Set the <span>Main Camera Position</span> to (<kbd class="calibre13">0, 2, -3</kbd>)</li>
</ol>
<p class="calibre3"><span class="calibre6">You can replace <kbd class="calibre13">Main Camera</kbd> with the <kbd class="calibre13">MeMyselfEye</kbd> camera rig we've been using throughout the book, but it is not necessary in this project as we will not be using device-specific input or other features. The <kbd class="calibre13">Main Camera</kbd> will provide a sufficient VR camera based on the SDK you've selected in <span class="calibre6">Player Settings</span>. </span></p>
<div class="packtinfobox">We are using a simple ground plane, as it gives the aesthetic we want. But this could be a good opportunity for you to explore the Unity Terrain system. This is another rich and very powerful topic, where you can "paint" complex landscapes with trees and grasses. See the manual at <a href="https://docs.unity3d.com/Manual/script-Terrain.html" class="calibre20">https://docs.unity3d.com/Manual/script-Terrain.html</a>.</div>
<p class="calibre3">Now, add a tree and some rocks:</p>
<ol class="calibre15">
<li class="calibre12">From the <kbd class="calibre13">Assets/NatureStarterKit/Models/</kbd> folder, drag the <span>Tree</span> into the scene. Reset its <span>Transform</span>, so it's at the origin.</li>
<li class="calibre12">Add a few rocks near the tree, move them so they're partially buried below the ground. You might put these under an <span>Empty</span> game object named <kbd class="calibre13">Environment</kbd>.</li>
<li class="calibre12">Add a Wind Zone (<span>Create | 3D Object | WindZone</span>) , so the Tree object responds to wind and rustles its leaves.</li>
</ol>
<p class="calibre3">The rocks in my scene are placed as follows (all at <span class="calibre6">Scale</span> <kbd class="calibre13">100</kbd>):</p>
<table border="1" class="calibre36">
<thead class="calibre74">
<tr class="calibre38">
<td class="calibre39">Prefab</td>
<td class="calibre39">Position</td>
</tr>
</thead>
<tbody class="calibre37">
<tr class="calibre38">
<td class="calibre39"><kbd class="calibre13">rock03</kbd></td>
<td class="calibre39"><kbd class="calibre13">(2.9, -0.6, -0.26)</kbd></td>
</tr>
<tr class="calibre38">
<td class="calibre39"><kbd class="calibre13">rock03</kbd></td>
<td class="calibre39"><kbd class="calibre13">(2.6, -0.7, -3.6)</kbd></td>
</tr>
<tr class="calibre38">
<td class="calibre39"><kbd class="calibre13">rock04</kbd></td>
<td class="calibre39"><kbd class="calibre13">(2.1, -0.65, -3.1)</kbd></td>
</tr>
<tr class="calibre38">
<td class="calibre39"><kbd class="calibre13">rock01</kbd></td>
<td class="calibre39"><kbd class="calibre13">(-6, -3.4, -0.6)</kbd></td>
</tr>
<tr class="calibre38">
<td class="calibre39"><kbd class="calibre13">rock04</kbd></td>
<td class="calibre39"><kbd class="calibre13">(-5, -0.7, 3.8)</kbd></td>
</tr>
</tbody>
</table>
<p class="calibre3">Next, we'll add the nest:</p>
<ol class="calibre15">
<li class="calibre12">Drag a copy of the <span>NestAndEgg</span> model into the scene.</li>
<li class="calibre12"><span>Scale</span> and <span>Position</span> it on the ground so it's in easy view, near the tree, and not too small. We chose <span>Position</span> (<kbd class="calibre13">0.5, 0.36, -1.2</kbd>) and <span>Scale</span> (<kbd class="calibre13">0.2, 0.2, 0.2</kbd>).</li>
</ol>
<p class="calibre3">And add a bird. The Living Birds package doesn't have a blackbird, but it does have a bluejay, which is close enough:</p>
<ol class="calibre15">
<li class="calibre12">From the <span>Project</span> <kbd class="calibre13">Assets/living birds/resources/</kbd> folder, drag the <kbd class="calibre13">lb_blueJayHQ</kbd> prefab into the <span>Hierarchy</span>. For convenience, rename it <kbd class="calibre13">Bluejay</kbd>.</li>
<li class="calibre12"><span>Scale</span> and <span>Position</span> it so it appears full grown and perched on the edge of the nest. We chose <span>Scale</span> (<kbd class="calibre13">8, 8, 8</kbd>), <span>Position</span> (<kbd class="calibre13">0.75, 0.4, -1.25</kbd>), and <span>Rotation</span> (<kbd class="calibre13">0, 0, 0</kbd>).</li>
</ol>
<p class="calibre3"><span class="calibre6">The bird is inserted into the scene in a T pose. It has animations attached, which we'll control later in this project. Like most character animations, it runs an <kbd class="calibre13">Idle</kbd> animation initially. (Note, don't rotate the bird object, it messes up the flying animations.)</span></p>
<p class="calibre3">Remember to press <span class="calibre6">Play</span> and check how it looks in VR. It's always much different within VR than the view you see on the flat screen. Our scene and hierarchy is shown in the following screen capture. You many also want to adjust the Main Camera position now:</p>
<div class="mce-root1"><img src="assets/7cde9ff0-46d3-4cbf-82e2-e59b954c19d7.png" class="calibre24"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Timelines and Audio tracks</h1>
                </header>
            
            <article>
                
<p class="calibre3"><span class="calibre6">Earlier, we planned out our movie using a graph paper timeline. Unity provides the tools to implement that almost directly. This Timeline feature was introduced with Unity 2017.</span></p>
<p class="calibre3">Timelines consist of one or more tracks that play over time. It's like an Animation (which controls the properties of a single game object), but Timelines work with many different objects and different types of tracks. As we'll see and explain later, Timelines can have Audio Tracks, Activation Tracks, Animation Tracks, and Control Tracks.</p>
<p class="calibre3"><span class="calibre6">Timelines are a type of Unity <em class="calibre14">Playable</em>.</span> <span class="calibre6">Playables are runtime objects that "play" over time, updating each frame based on its prescribed behavior. Animations are playables too. For more details, see <a href="https://docs.unity3d.com/ScriptReference/Playables.Playable.html" class="calibre10">https://docs.unity3d.com/ScriptReference/Playables.Playable.html</a>. </span></p>
<p class="calibre3"><span class="calibre6">Presently we'll add a Timeline to the project and add an Audio Track. </span>To create the Timeline object and open it in the Timeline Editor window, do the following steps:</p>
<ol class="calibre15">
<li class="calibre12">In <span>Hierarchy</span>, create an <span>Empty</span> game object and name it <kbd class="calibre13">BlackbirdDirector</kbd>.</li>
<li class="calibre12">Open the <span>Timeline Editor</span> (<span>Window | Timeline</span>).</li>
<li class="calibre12">In the window you will see a message "<em class="calibre2">To begin a new timeline with BlackbirdTimeline, create a Director component and a Timeline asset</em>" with a <span>Create</span> button.</li>
<li class="calibre12">Press the <span>Create</span> button.</li>
<li class="calibre12">You are then prompted to save a new Playable asset in your <span>Project</span> <em class="calibre2">Assets</em> folder. Name it <kbd class="calibre13">BlackbirdTimeline</kbd>. Press <span>Save</span>. </li>
</ol>
<p class="calibre3"> At this point, you may have noticed a few important things just happened:</p>
<ul class="calibre11">
<li class="calibre12">The <kbd class="calibre13">BlackbirdTimeline</kbd> asset was created in the <kbd class="calibre13">Asset</kbd> folder you specified</li>
<li class="calibre12">A <kbd class="calibre13">Playable Director</kbd> component was added to the <kbd class="calibre13">BlackbirdDirector</kbd> game object, associating it with that <kbd class="calibre13">BlackbirdTimeline</kbd></li>
<li class="calibre12">The <kbd class="calibre13">Timeline Editor</kbd> <span>window is opened for the</span> <kbd class="calibre13">BlackbirdTimeline</kbd></li>
</ul>
<p class="calibre3">The next screenshot shows the <kbd class="calibre13">BlackbirdDirector</kbd> inspector with its <kbd class="calibre13">Playable Director</kbd> component. <span class="calibre6">A Playable Director component controls when and how a Timeline instance plays, including whether to <span class="calibre6">Play On Awake</span>, and <span class="calibre6">Wrap Mode</span> (what to do when the Timeline is done playing: <span class="calibre6">Hold</span>, <span class="calibre6">Loop</span>, or <span class="calibre6">None</span>):</span></p>
<div class="mce-root1"><img src="assets/7e24ab47-8335-48e6-93b8-1aea94c1aab3.png" class="calibre24"/></div>
<p class="calibre3">Here is the <span class="calibre6">Timeline Editor</span> window for the <kbd class="calibre13">BlackbirdTimeline</kbd>:</p>
<div class="mce-root1"><img src="assets/43c56e6a-8524-4cfc-a2e4-2b2fc39b9bbb.png" class="calibre24"/></div>
<p class="calibre3">Let's now add an <span class="calibre6">Audio Track</span> to the timeline, with our Beatles song:</p>
<ol class="calibre15">
<li class="calibre12">Locate the mp3 file in your <span>Project Assets</span>, and drag it directly onto the <span>Timeline Editor</span></li>
<li class="calibre12">Press <span>Play</span> to play your scene as normal and now the music should start playing as well</li>
</ol>
<p class="calibre3">Here is the <span class="calibre6">Timeline Editor</span> now containing the <span class="calibre6">Audio Track</span>:</p>
<div class="mce-root1"><img src="assets/714577ec-8e8b-48fd-9963-c36c62d52319.png" class="calibre24"/></div>
<p class="calibre3">The white vertical cursor, or <em class="calibre14">Playhead</em>, indicates the current time frame. The default scale is <span class="calibre6">Frames</span>, but in the previous screenshot we have already changed it to <span class="calibre6">Seconds</span> (using the gear-icon in the upper right). You can see this clip is set start at <kbd class="calibre13">0</kbd> and continues to about 165 seconds.</p>
<div class="packttip">You can scale the view using the scroll wheel on your mouse. View all by pressing "A" on the keyboard. When the Timeline contains multiple tracks, you can focus on a specific clip by pressing "F" on the keyboard.</div>
<p class="calibre3">You may notice in the upper left of the Timeline Editor are preview controls. These let you play a preview of the Timeline itself, rather than the whole scene using the usual Editor Play button. </p>
<div class="packtinfobox">Unfortunately, at the time of this writing, the Timeline preview play mode does not play audio clips. You need to use the Editor Play mode for audio.</div>
<div class="packttip">In this scene, we decided to make the music to be ambient audio. The audio will play in 2D mode if no audio source is selected. If you want to play it as spatial audio, emanating from a specific location in the scene, you should create an audio source and put that in the timeline track instead.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using a Timeline to activate objects</h1>
                </header>
            
            <article>
                
<p class="calibre3">We just added an <span class="calibre6">Audio Track</span> to the Timeline. Another type of Timeline track is an <span class="calibre6">Activation Track</span>. Associated with a specific game object, an <span class="calibre6">Activation Track</span> with enable or disable that game object at the specified times.</p>
<p class="calibre3">According to our plan, when the timeline starts, the bird's nest will be hidden (<kbd class="calibre13">NestAndEgg</kbd> object). At the 35-second mark, it becomes enabled. Also, when the nest is first enabled, it should have the <kbd class="calibre13">WholeEgg</kbd>. Then at the 80-second mark, it is hidden and the <kbd class="calibre13">HatchedEgg</kbd> is enabled instead.</p>
<p class="calibre3">The <kbd class="calibre13">NestAndEgg</kbd> game object hierarchy, as shown here, contains the <kbd class="calibre13">Nest</kbd> itself, a <kbd class="calibre13">WholeEgg</kbd> object, and a <kbd class="calibre13">HatchedEgg</kbd> (which has the two eggshell halves):</p>
<div class="mce-root1"><img src="assets/be1a1d2c-c7a4-46cd-91ef-81b52a15f220.png" class="calibre24"/></div>
<p class="calibre3">Let's add the activation sequence to the Timeline now:</p>
<ol class="calibre15">
<li class="calibre12">With <kbd class="calibre13">BlackbirdDirector</kbd> selected in <span>Hierarchy</span>, drag the <kbd class="calibre13">NestAndEgg</kbd> object from <span>Hierarchy</span> into the <span>Timeline Editor</span> window.</li>
<li class="calibre12">A menu pops up, asking what type of track to add; choose <span>Activation Track.</span></li>
<li class="calibre12">A small rectangular track marker is added to the track. Click and drag it into place.</li>
<li class="calibre12">Position and size the track to start at <kbd class="calibre13">35:00</kbd> and end at<kbd class="calibre13">165:00</kbd>.</li>
</ol>
<p class="calibre3">Now for the eggs. Although the egg models are children of NestAndEgg, they can be activated separately from the parent (of course, only when the parent itself is already enabled):</p>
<ol class="calibre15">
<li class="calibre12">Drag the <kbd class="calibre13">WholeEgg</kbd> object from <span>Hierarchy</span> onto the <span>Timeline</span> as an <span>Activation Track</span></li>
<li class="calibre12">Position it to start at <kbd class="calibre13">35:00</kbd> and end at <kbd class="calibre13">60:00</kbd></li>
<li class="calibre12">Drag the <kbd class="calibre13">HatchedEgg</kbd> object from <span>Hierarchy</span> onto the <span>Timeline</span> as an <span>Activation Track</span></li>
<li class="calibre12">Position it to start at <kbd class="calibre13">60:00</kbd> and end at <kbd class="calibre13">165:00</kbd></li>
</ol>
<p class="calibre3"><span class="calibre6">Similarly, activate the bird when the egg hatches, at the 60-second mark:</span></p>
<ol class="calibre15">
<li class="calibre12">Drag the<span> </span><kbd class="calibre13">Bluejay</kbd><span> </span>object from<span> </span><span>Hierarchy</span><span> </span>onto the<span> </span><span>Timeline</span><span> </span>as an<span> </span><span>Activation Track</span></li>
<li class="calibre12">Position it to start at<span> </span><kbd class="calibre13">35:00</kbd><span> </span>and end at<span> </span><kbd class="calibre13">60:00</kbd></li>
<li class="calibre12">Drag the<span> </span><kbd class="calibre13">HatchedEgg</kbd><span> </span>object from<span> </span><span>Hierarchy</span><span> </span>onto the<span> </span><span>Timeline</span><span> </span>as an<span> </span><span>Activation Track</span></li>
<li class="calibre12">Position it to start at<span> </span><kbd class="calibre13">60:00</kbd><span> </span>and end at<span> </span><kbd class="calibre13">165:00</kbd></li>
</ol>
<p class="calibre3">The <span class="calibre6">Timeline</span> with <span class="calibre6">Activate Tracks</span> now looks like the following. You can see, on the left, each track has an object slot containing the game object being controlled by the track. </p>
<div class="mce-root1"><img src="assets/65848b58-5360-41d9-ba45-4b83b0745a8d.png" class="calibre24"/></div>
<p class="calibre3">Using <span class="calibre6">Preview Play</span> (control icons in the upper left of the <span class="calibre6">Timeline Editor</span>) you can play and review these tracks. You can scrub through the time frames by dragging the white Playhead cursor. You will see the nest, eggs, and bird activate and deactivate as specified.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Recording an Animation Track</h1>
                </header>
            
            <article>
                
<p class="calibre3">As you would expect, in addition to audio and activation tracks, Timelines can include animation tracks. Unity's animation features have evolved over the years and Timeline greatly simplifies basic animation capabilities within Unity. You can create and edit animations directly within Timeline without having to create separate Animation Clips and Animator Controllers. These we will get to later in this chapter. For now, w<span class="calibre6">e will start simple, animating just a few Transform parameters on the tree and the nest.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">A growing tree</h1>
                </header>
            
            <article>
                
<p class="calibre3">We want to add an animation of the tree growing from small (scale <kbd class="calibre13">0.1</kbd>) to full size, from <kbd class="calibre13">0</kbd> to <kbd class="calibre13">30</kbd> seconds in the Timeline. We do this by adding an Animation Track for the Tree, and then recording the parameter values at each keyframe time:</p>
<ol class="calibre15">
<li class="calibre12">Ensure <kbd class="calibre13">BlackbirdDirector</kbd> is selected in <span>Hierarchy</span> and the <span>Timeline Editor</span> window is open</li>
<li class="calibre12">Drag the <kbd class="calibre13">Tree</kbd> from <span>Hierarchy</span> into the <span>Timeline</span> window</li>
<li class="calibre12">Select <span>Animation Track</span> as the type of Track we are adding</li>
</ol>
<p class="calibre3">Now, we can begin recording the keyframes:</p>
<ol class="calibre15">
<li class="calibre12">Ensure the <span>Playhead</span> cursor is set to <kbd class="calibre13">0:00</kbd></li>
<li class="calibre12">Press the red <span>Record</span> button on the Tree track in Timeline to begin recording</li>
<li class="calibre12">Select the <kbd class="calibre13">Tree</kbd> in <span>Hierarchy</span></li>
<li class="calibre12">Set its <span>Scale</span> to (<kbd class="calibre13">0.1, 0.1, 0.1</kbd>)</li>
<li class="calibre12">Slide the Playhead to the 30-second mark</li>
<li class="calibre12">With Tree still selected in Hierarchy, set its <span>Scale</span> to (<kbd class="calibre13">1, 1, 1</kbd>)</li>
<li class="calibre12">Press the blinking red <span>Record</span> button again to stop recording</li>
<li class="calibre12">Click the small graph icon to reveal the animation curve, as shown here:</li>
</ol>
<div class="mce-root1"><img src="assets/22de5da0-dc8f-4edd-b986-3a584ddd529b.png" class="calibre24"/></div>
<p class="calibre3">You can see, our Timeline now has an <span class="calibre6">Animation Track</span> that references the <kbd class="calibre13">Tree</kbd> game object. It has two keyframes, starting at <kbd class="calibre13">o</kbd> and ending at <kbd class="calibre13">30</kbd> seconds. Unity fits a gentle curve to ease in and ease out the transition between the polemic key values.</p>
<p class="calibre3">When you grab and slide the <span class="calibre6">Playhead</span> cursor across the timeline curve, you can see the tree change size in your <span class="calibre6">Scene</span> window. If you press the <span class="calibre6">Preview Play</span> icon, you can play the animation.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">A growing bird</h1>
                </header>
            
            <article>
                
<p class="calibre3">Repeat the previous exercise, this time growing the Bluejay. Scale it from a baby bird (<span class="calibre6">Scale</span> = <kbd class="calibre13">1</kbd>) to full size (<span class="calibre6">Scale</span> = <kbd class="calibre13">8</kbd>), for 10 seconds between the <kbd class="calibre13">60</kbd> and <kbd class="calibre13">70</kbd>-second marks. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using the Animation editor</h1>
                </header>
            
            <article>
                
<p class="calibre3"><span class="calibre6">Next, we'll create another animation track, to animate the nest so it starts positioned in the grown tree and then drifts slowly to the ground, wafting like a falling leaf. We want it to exhibit a gentle rocking motion. This is a little more complicated than the simple two-keyframe animation we just did, so we'll do our work in a separate Animation Window instead of the narrow track band on the Timeline Editor.</span><span class="calibre6"> It will animate from 0:35 to 0:45. </span></p>
<p class="calibre3"><span class="calibre6">Animations are based on Keyframes. To animate a property, you create a Keyframe and define the property values for that frame in time. In the previous example, we had just two Keyframes, for the start and end Scale values. Unity fills in-between values with a nice curve. You can insert additional Keyframes, and edit the curve shape.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">A wafting nest</h1>
                </header>
            
            <article>
                
<p class="calibre3">Let's assume your scene already has the nest positioned on the ground, where we want it to end up with the following steps:</p>
<ol class="calibre15">
<li class="calibre12">Drag the <kbd class="calibre13">NestAndEgg</kbd> object from <span>Hierarchy</span> into the <span>Timeline</span> window.</li>
<li class="calibre12">Select <span>Animation Track</span> as the type of track.</li>
<li class="calibre12">Set the <span>Playhead</span> cursor to <kbd class="calibre13">35:00</kbd>.</li>
<li class="calibre12">Note that the <span>Record</span> icon will be disabled when the object is inactive. The <span>Playhead</span> must be within the object's <span>Activation track</span>'s <span>Active</span> range.</li>
<li class="calibre12">Press the <span>Record</span> icon for the NestAndEgg <span>Animation Track</span> to begin recording.</li>
<li class="calibre12">Select the <kbd class="calibre13">NestAndEgg</kbd> object in <span>Hierarchy.</span></li>
<li class="calibre12">Copy the current <span>Transform</span> values to the clipboard (in <span>Inspector</span>, select the <span>gear-icon</span> on the Transform component, and <span>Copy Component</span>).</li>
<li class="calibre12">In the <span>Scene</span> window, ensure the <span>Move gizmo</span> is presently selected.</li>
</ol>
<ol start="9" class="calibre15">
<li class="calibre12">Reposition the nest up in the Tree. <span>Position Y</span> = <kbd class="calibre13">5</kbd> works for me.</li>
<li class="calibre12">Slide the <span>Playhead</span> to <kbd class="calibre13">45:00</kbd>.</li>
<li class="calibre12">In the NestAndEgg <span>Inspector</span>, click the Transform's <span>gear icon</span> and <span>Paste Component Values.</span></li>
<li class="calibre12">Press the blinking red <span>Record</span> button again to stop recording.</li>
</ol>
<p class="calibre3">Having defined an initial Animation recording, we can now work on it in an Animation editor window:</p>
<ol class="calibre15">
<li class="calibre12"><span>On the track, click the little <span>menu icon</span> in its upper right </span></li>
<li class="calibre12"><span>Select <span>Edit in Animation Window</span>, as shown here:</span></li>
</ol>
<div class="mce-root1"><img src="assets/6c9174a3-cad6-4611-9439-6f879a3ef26c.png" class="calibre24"/></div>
<p class="calibre3"><span class="calibre6">The <span class="calibre6">Animation Window</span> has two view modes: <span class="calibre6">Dopesheet</span> and <span class="calibre6">Curves</span>. The <span class="calibre6">Dopesheet</span> view lets you focus on the Keyframes for each property. The <span class="calibre6">Curves</span> view lets you focus on the transitions between Keyframes.</span></p>
<p class="calibre3"><span class="calibre6">The goal is to animate a subtle floating action, where the Nest rocks from side to side (X and Z axes) and rotates lightly on each of the axes. To do this, first we'll "anchor" the Nest at the beginning, middle and end of the fall. (We already have the begin and end positions.) Then, we'll add a couple more keyframes  with arbitrary values to implement the gentle motion.</span></p>
<p class="calibre3">Using the <span class="calibre6">Dopesheet</span> view, we're first going to ensure we have keyframes at the start and end times, and one in between. Add keyframes at 35, 40, and 45 seconds as follows:</p>
<ol class="calibre15">
<li class="calibre12">If not present, add <span>Rotation</span> properties too (<span>Add Property | Transform | Rotation | "+"</span>)</li>
<li class="calibre12">Position the <span>Playhead</span> at the start of our animation (<kbd class="calibre13">35:00</kbd>) </li>
<li class="calibre12">Click the <span>Add Keyframe icon</span> in control bar atop the properties list (highlighted in the screen capture below)</li>
<li class="calibre12">Move the <span>Playhead</span> about halfway, to the <kbd class="calibre13">40</kbd> second mark </li>
<li class="calibre12">Click <span>Add Keyframe icon</span></li>
<li class="calibre12">And again, make sure there's Keyframe markers at the end (<kbd class="calibre13">45:00</kbd>)</li>
</ol>
<div class="packttip"><span>You can use hotkeys to move between Keyframes. Press "Alt+." (Alt+period) for next Keyframe. Press "Alt+," (Alt+comma) for previous Keyframe, and "Shift+," (Shift+comma) for first Keyframe. </span></div>
<p class="calibre3">Now, we'll add a Keyframe at <kbd class="calibre13">37.5</kbd>:</p>
<ol class="calibre15">
<li class="calibre12">Move the <span>Playhead</span> to <span>37.5</span></li>
<li class="calibre12">Click the <span>Add Keyframe icon</span></li>
<li class="calibre12">Click the red <span>Record</span> icon in the upper left to capture new values</li>
<li class="calibre12">Select the <kbd class="calibre13">NestAndEgg</kbd> object in <span>Hierarchy</span> </li>
<li class="calibre12"><span>In the <span>Scene</span> view, u</span>sing the <span>Move Tool</span> gizmo, move the nest a little bit along the X and Z axes (about 0.4 units)</li>
<li class="calibre12">Using the <span>Rotate Tool</span>, rotate the nest gently on any combination of axes (up to 10 degrees)</li>
<li class="calibre12">Move the <span>Playhead</span> to <kbd class="calibre13">42.5</kbd> and repeat steps 2-6</li>
</ol>
<p class="calibre3">The resulting <span class="calibre6">Animation Window</span> in <span class="calibre6">Dopesheet</span> view, with its <span class="calibre6">Position</span> and <span class="calibre6">Rotation</span> property values, is shown here at Keyframe 37.5. The <span class="calibre6">Add Keyframe icon</span> is identified for the reader:</p>
<div class="mce-root1"><img src="assets/33d2fdf5-d8f6-42a9-8446-e913f8fcb09e.png" class="calibre24"/></div>
<p class="calibre3"><span class="calibre6">The <span class="calibre6">Curves</span> view lets you focus on the transitions between Keyframes, and provides the ability to adjust the values and shape the curve splines. My current Curves view is shown here:</span></p>
<div class="mce-root1"><img src="assets/3779f578-e4ed-47bc-aa32-7274c164ff41.png" class="calibre24"/></div>
<div class="packttip">The length of the scrollbars in the Animation Window indicate the current zoom view. The oval ends of each scrollbar are grab-able controls that let you directly adjust the zoom as well as position of the view.</div>
<p class="calibre3">Go back to the TImeline Editor window. Y<span class="calibre6">ou can  slide the </span><span class="calibre6">Playhead</span><span class="calibre6"> cursor to see animations in your </span><span class="calibre6">Scene</span><span class="calibre6"> window, or press the </span><span class="calibre6">Preview Play</span><span class="calibre6"> icon to play them.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Animating other properties</h1>
                </header>
            
            <article>
                
<p class="calibre3">In our story, we want the lighting to start at night and progress through dawn to daylight. <span class="calibre6">We'll do it by manipulating the Directional Light, Skybox Material, and a Spot Light.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Animating lights</h1>
                </header>
            
            <article>
                
<p class="calibre3">For dramatic effect, let's make the scene slowly fade from night to daytime. We will turn off the Directional Light at the start and slowly increase its Intensity:</p>
<ol class="calibre15">
<li class="calibre12">Select<span> </span><kbd class="calibre13">BlackbirdController</kbd><span> </span>in<span> </span><span>Hierarchy</span><span> </span>and open the<span> </span><span>Timeline Editor</span><span> </span>window</li>
<li class="calibre12">Drag the<span> </span><kbd class="calibre13">Directional Light</kbd><span> </span>object from<span> </span><span>Hierarchy</span><span> </span>onto the<span> </span><span>Timeline</span></li>
<li class="calibre12">Press its<span> </span><span>Record</span><span> </span>button</li>
<li class="calibre12">Ensure the<span> </span><span>Playhead</span><span> </span>is at<span> </span><kbd class="calibre13">0:00</kbd></li>
<li class="calibre12">Select the<span> </span><kbd class="calibre13">Directional Light</kbd><span> </span>in<span> </span><span>Hierarchy</span> and change its<span> </span><span>Intensity</span><span> </span>parameter to<span> </span><kbd class="calibre13">0</kbd></li>
<li class="calibre12">Move the<span> </span><span>Playhead</span><span> </span>to the<span> </span><kbd class="calibre13">40:00</kbd><span> </span>second mark</li>
<li class="calibre12">Set the<span> </span><span>Intensity</span><span> </span>to<span> </span><kbd class="calibre13">1</kbd></li>
</ol>
<p class="calibre3">The Directional Light's Animation Track with the Intensity parameter curve is shown here:</p>
<div class="mce-root1"><img src="assets/99c2faa9-237c-457c-8af2-5fb2edc2bbad.png" class="calibre24"/></div>
<p class="calibre3">Other parameters of the light could also be animated, including its Color and the Transform Rotation angles. Just imagine the possibilities!</p>
<p class="calibre3"><span class="calibre6">Let's also add a Point Light. </span>For dramatic effect, position it at the same location as the Nest resting position. This will illuminate the baby tree at first, and focus the user's attention on the egg in the nest once the nest settles onto the ground:</p>
<ol class="calibre15">
<li class="calibre12"><span>Create | Light | Point Light</span></li>
<li class="calibre12">In<span> </span><span>Scene</span><span> </span>view, use the<span> </span><span>Move Tool</span><span> </span>gizmo to position it inside the Nest at the Nest's ground position</li>
<li class="calibre12">Select<span> </span><kbd class="calibre13">BlackbirdDirector</kbd><span> </span>and open the<span> </span><span>Timeline Editor</span></li>
<li class="calibre12">Drag the<span> </span><kbd class="calibre13">Point Light</kbd><span> </span>onto the<span> </span><span>Timeline Editor</span></li>
<li class="calibre12">Choose<span> </span><span>Activation Track</span></li>
<li class="calibre12">Enable the light from<span> </span><kbd class="calibre13">0</kbd>s to about<span> </span><kbd class="calibre13">95</kbd>s, sometime after the egg hatches</li>
</ol>
<p class="calibre3">Things are looking pretty good!</p>
<p class="calibre3">Our Timeline is starting to get a little crowded. Let's move the lights into a<span class="calibre6"> </span><span class="calibre6">Track Group</span>:</p>
<ol class="calibre15">
<li class="calibre12">In<span> </span><span>Timeline</span>, choose<span> </span><span>Add | Track Group</span></li>
<li class="calibre12">Click its label and name it "Lights"</li>
<li class="calibre12">Drag each of the light tracks into the group</li>
</ol>
<div class="packttip">Use Group Tracks to organize your Timeline in a nested tree structure</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Animating a scripted component property</h1>
                </header>
            
            <article>
                
<p class="calibre3">As we're seeing, you can animate just about any GameObject property that you can modify in the Inspector. This includes your own C# script component's serialized properties. </p>
<p class="calibre3"><span class="calibre6">We want to fade the environmental lighting from night to day. There are several ways to achieve this (see the discussion of photospheres in the previous chapter). We've decided to do it by modifying the Skybox Material's Exposure value (o is off, 1 is all the way on). But Timeline can only animate GameObject properties, and this is not one. So what we'll do is create an empty LightingController GameObject and write a script that controls the Skybox Material.</span></p>
<p class="calibre3"><span class="calibre6">Let's add our own Skybox Material to the scene. You can use any skybox texture you like. We will grab one from the WispySkybox package, <kbd class="calibre13">WispyCubemap2</kbd>, that we imported earlier:</span></p>
<ol class="calibre15">
<li class="calibre12">Create a new <span>Material</span> (<span>Assets | Create | Material</span>), name it <kbd class="calibre13">BlackbirdSkyMaterial</kbd></li>
<li class="calibre12">In <span>Inspector</span>, for its <span>Shader</span>, select <span>Skybox/Cubemap</span></li>
<li class="calibre12">Click <span>Select</span> in its <span>Cubemap</span> texture chip, and select <kbd class="calibre13">WispyCubemap2</kbd></li>
<li class="calibre12">Open the <span>Lighting</span> window (if not already in the Editor, choose <span>Window | Lighting | Settings</span>)</li>
<li class="calibre12">Drag the <kbd class="calibre13">BlackbirdSkyMaterial</kbd> from <span>Project Assets</span> onto the <span>Skybox Material</span> slot</li>
<li class="calibre12">Uncheck the<span> </span><span>Mixed Lighting Baked Global Illumination</span><span> </span>checkbox</li>
</ol>
<p class="calibre3">We don't want to bake any of the environment lighting since we're going to modify its settings at runtime.</p>
<p class="calibre3">Selecting the <kbd class="calibre13">BlackbirdSkyMaterial</kbd> again, see what happens when you slide the <span class="calibre6">Exposure</span> value between <kbd class="calibre13">1</kbd> and <kbd class="calibre13">0</kbd>. It fades the brightness of the skybox. We will animate this value to modify the ambient light in our scene. But Animations can only modify GameObject parameters, so we'll write a script:</p>
<ol class="calibre15">
<li class="calibre12">Create a new C# script and name it <kbd class="calibre13">SkyboxMaterialExposureControl</kbd>.</li>
<li class="calibre12">Open the script and <span>write it </span>as follows:</li>
</ol>
<pre class="calibre18">public class SkyboxMaterialExposureControl : MonoBehaviour<br class="title-page-name"/>{<br class="title-page-name"/>    public Material skyboxMaterial;<br class="title-page-name"/>    public float exp = 1.0f;<br class="title-page-name"/><br class="title-page-name"/>    private void Update()<br class="title-page-name"/>    {<br class="title-page-name"/>        SetExposure(exp);<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    public void SetExposure(float value)<br class="title-page-name"/>    {<br class="title-page-name"/>        skyboxMaterial.SetFloat("_Exposure", value);<br class="title-page-name"/>    }<br class="title-page-name"/>}</pre>
<p class="calibre3">Save the file. In Unity, lets make a LightingController object that uses the script as follows:</p>
<ol class="calibre15">
<li class="calibre12"> Create a <span>Empty</span> object in <span>Hierarchy</span>, named "LightingController"</li>
<li class="calibre12">Add the <kbd class="calibre13">SkyboxMaterialExposureControl</kbd> to this object</li>
<li class="calibre12">Drag the <kbd class="calibre13">BlackbirdSkyMaterial</kbd> onto its <span>Skybox Material</span> slot</li>
</ol>
<p class="calibre3">Now, let's animate this parameter:</p>
<ol class="calibre15">
<li class="calibre12">Select <kbd class="calibre13">BlackbirdController</kbd> in <span>Hierarchy</span> and open the <span>Timeline Editor</span> window</li>
<li class="calibre12">Drag the <kbd class="calibre13">LightingController</kbd> object from <span>Hierarchy</span> onto the <span>Timeline</span></li>
<li class="calibre12">Press its <span>Record</span> button</li>
<li class="calibre12">Ensure the <span>Playhead</span> is at <kbd class="calibre13">0:00</kbd></li>
<li class="calibre12">Select the <kbd class="calibre13">LightingController</kbd> in <span>Hierarchy</span>, and change its <span>Exp</span> parameter to <kbd class="calibre13">0</kbd></li>
<li class="calibre12">Move the <span>Playhead</span> to the <kbd class="calibre13">100:00</kbd> second mark</li>
<li class="calibre12">Set the <span>Exp</span> to <kbd class="calibre13">1</kbd></li>
</ol>
<p class="calibre3">The Timeline Editor window with a <span class="calibre6">SkyboxMaterialExposureControl</span> track is shown here:</p>
<div class="mce-root1"><img src="assets/a63ec9e0-95c1-456f-b60e-ab53ce16d560.png" class="calibre24"/></div>
<p class="calibre3">Press <span class="calibre6">Play</span>, and the scene lighting will fade from night to day as the skybox material's Exposure animates from 0 to 1. (Note it's not available in the Timeline preview Play, just the Editor Play). Here is a screenshot of the scene playing at about 45 seconds:</p>
<div class="mce-root1"><img src="assets/c8663f5e-5117-4a81-947f-485ca777426c.png" class="calibre85"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Controlling particle systems</h1>
                </header>
            
            <article>
                
<p class="calibre3">You could continue to improve the scene with other effects. We'd like to include falling leaves, which can be implemented using particle systems and played using a <span class="calibre6">Control Track</span>. </p>
<div class="packtinfobox">Unfortunately, we cannot recommend a specific free "falling leaves" asset as all the ones we found in the Asset Store are paid ones. There's an out-of-date free Sky FX package (<a href="https://assetstore.unity.com/packages/vfx/particles/environment/sky-fx-pack-19242" class="calibre20">https://assetstore.unity.com/packages/vfx/particles/environment/sky-fx-pack-19242</a>), from which we borrowed the textures and made our own particle system prefab, included with this book.</div>
<p class="calibre3">Assuming you have a FallingLeaves particle system, we can add it to the project now:</p>
<ol class="calibre15">
<li class="calibre12">Drag a copy of the <kbd class="calibre13">FallingLeaves</kbd> prefab into the scene.</li>
<li class="calibre12">In the <span>Timeline Editor</span> window (with <kbd class="calibre13">BlackbirdDirector</kbd> selected), click <span>Add</span> and choose <span>Control Track.</span></li>
<li class="calibre12">In the Control Track's menu icon, choose <span><span>Add Control Playable Asset Clip.</span></span></li>
<li class="calibre12">This creates a small rectangle for the clip on the track. Select it.</li>
<li class="calibre12">In <span>Inspector</span>, drag the <kbd class="calibre13">FallingLeaves</kbd> game object from <span>Hierarchy</span> onto the <span>Source Game Object</span> slot.</li>
<li class="calibre12">Going back to the Timeline window, grab and slide the rectangle to the 120-second position, then stretch its right edge to the end of the timeline (165s).</li>
</ol>
<p class="calibre3">The playable asset's <span class="calibre6">Inspector</span> is shown here:</p>
<div class="mce-root1"><img src="assets/fe46c8e1-328c-4c0d-a128-24aa00a17a3c.png" class="calibre86"/></div>
<p class="calibre3">And the Timeline with this <span class="calibre6">Control Track</span> is as follows:</p>
<div class="mce-root1"><img src="assets/84b6b080-475c-42f6-a5f4-db84bcd82925.png" class="calibre24"/></div>
<p class="calibre3"><span class="calibre6">Likewise, if you have multiple Timelines in a scene, you can control them from another Timeline using a Control Track (via game objects with <kbd class="calibre13">PlayableDirector</kbd> components). </span> In our app, w<span class="calibre6">e're using a single Timeline, with</span> <span class="calibre6"><span class="calibre6">Play</span><span class="calibre6"> </span><span class="calibre6">On Awake</span></span><span class="calibre6">,</span><span class="calibre6"> </span><span class="calibre6">so it starts at the beginning of the app and plays through. However, with multiple Timelines in a scene, you can play them on demand.</span></p>
<div class="packtinfobox"><span>You can write your own custom Timeline track classes too. For example, using a Control Track for playing Particle Systems is limited. Here (</span><a href="https://github.com/keijiro/TimelineParticleControl" class="calibre20">https://github.com/keijiro/TimelineParticleControl</a><span>) is a custom track class, </span><kbd class="calibre26">ParticleSystemControlTrack</kbd><span>, that offers control of emission rate, velocity, and other functionality. And if you look into their <kbd class="calibre26">.cs</kbd> code, it provides a good example of how to write a custom track class. </span></div>
<p class="calibre3"><span class="calibre6">Separate Animation Clips are another Playable asset you can add and sequence in Timeline tracks. We look at that next.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using Animation clips</h1>
                </header>
            
            <article>
                
<p class="calibre3"><span class="calibre6">For the next animation example, we'll get the egg to rattle and shake before it hatches. We will create a simple animation and make it loop for its duration. </span><span class="calibre6">To illustrate, we'll make an Animation Clip of the WholeEgg rattling and then add it to the Timeline on an Animation Clip Track. </span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Shaking an egg</h1>
                </header>
            
            <article>
                
<p class="calibre3">To create a new Animation Clip on the WholeEgg object, follow these steps:</p>
<ol class="calibre15">
<li class="calibre12">In Hierarchy, select the WholeEgg object (child of NestAndEgg)</li>
<li class="calibre12">Open the Animation Window (<span>Window</span> | <span>Animation</span>)</li>
<li class="calibre12">You should see a message, <span>To begin animating WhileEgg, create an Animation Clip</span> and a Create button</li>
<li class="calibre12">Press <span>Create</span></li>
<li class="calibre12">When prompted for a file name, save it to <kbd class="calibre13">EggShaker.anim</kbd></li>
</ol>
<p class="calibre3">We've seen the Animation Window earlier in this chapter. <span class="calibre6">We're going to make a very short, 2-second animation that rotates the egg on the X axis and Z axis by manipulating the animation curves:<br class="calibre7"/></span></p>
<ol class="calibre15">
<li class="calibre12">Show the Curves view using the Curves button on the bottom of the window.</li>
<li class="calibre12">Press Add Property and <span>WholeEgg</span> | <span>Transform</span> | <span>Rotation</span> | <span>+</span> to add the Rotation properties.</li>
<li class="calibre12">Select the <span>WholeEgg: Rotation</span> property group on the left.</li>
</ol>
<ol start="4" class="calibre15">
<li class="calibre12">Press <em class="calibre2">A</em> on the keyboard to zoom all; you should see three flat lines, one for each X, Y, Z rotation axes.</li>
<li class="calibre12">Click the Add Keyframe icon in the upper right of the control bar.</li>
<li class="calibre12">There may already be a Keyframe at one second (1:00) by default. If not, move the Playhead and click Add Keyframe.</li>
<li class="calibre12">Scroll out (middle scroll wheel on mouse, or using the horizontal scrollbar oval-end handles) so you can see the 2:00-second marker.</li>
<li class="calibre12">Move the Playhead to 2 seconds and Add Keyframe.</li>
<li class="calibre12">Move the Playhead back to the 1 second mark.</li>
</ol>
<p class="calibre3">Now, we'll edit the animation spline curves. If you're familiar with spline editing, there is a line at each node representing the tangent of the curve at that point, and handles at the ends of the line for editing the curve. (You also modify the operation of this gizmo by right-clicking the node.)</p>
<ol class="calibre15">
<li class="calibre12">Click the 1:00s node for the Rotation.X property, then grab one of the handles to make a smooth S-curve. Not too steep, something between 30 and 45 degrees</li>
<li class="calibre12">Repeat this for the Y and Z axes, with some variation, as shown here:</li>
</ol>
<div class="mce-root1"><img src="assets/ef65b6f1-7102-402c-93d0-1ec4fbd66c47.png" class="calibre24"/></div>
<p class="calibre3">For one or two of the axes, add an extra Keyframe to make the curves look a little more random. My final curves are shown here.</p>
<div class="mce-root1"><img src="assets/f64eb290-4716-49af-a653-4d03018695b0.png" class="calibre24"/></div>
<p class="calibre3">With that done (the curves can be edited and refined later), select <span class="calibre6">BlackbirdDirector,</span> open the Timeline window, and perform the following steps:</p>
<ol class="calibre15">
<li class="calibre12">Select <span>Add</span> and choose <span>Animation Track</span></li>
<li class="calibre12">Drag the <kbd class="calibre13">WholeEgg</kbd> object from <span>Hierarchy</span> onto the <span>Timeline</span></li>
<li class="calibre12">Choose <span>Animation Track</span></li>
</ol>
<p class="calibre3">This time, instead of recording we'll use the one we just created, and make it animate back and forth as follows:</p>
<ol class="calibre15">
<li class="calibre12">Using the menu-icon on the track, choose <span>Add From Animation Clip.</span></li>
<li class="calibre12">A small rectangle is added to the track. Slide it to about 50 seconds, when the nest is on the ground but the chick has not yet hatched.</li>
<li class="calibre12">In <span>Inspector</span>, we now have more clip options. Under <span>Animation Extrapolation</span>, choose <span>Post-Extrapolate: Ping Pong.</span></li>
</ol>
<p class="calibre3">Animation Clips with Timeline can be quite flexible. You can add multiple Animation Clips to an Animation Track, and blend between them by sliding them into one another. If you need even more control, you'd use an Animator Controller instead.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using Animator Controllers</h1>
                </header>
            
            <article>
                
<p class="calibre3"><span class="calibre6">While recording animations as Timeline tracks is very convenient, it does have limitations. Those animations "live" in the Timeline. But, sometimes you want to treat animations as assets in their own right. </span><span class="calibre6">For example, you would use Animation Clips if you want an animation to loop repeatedly, or transition between animations, or blend their actions, or apply the same set of animation curves to other objects.</span></p>
<p class="calibre3">We will take a look at a couple of existing examples of Animators and then use the existing birds one to make our Bluejay fly.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Definitions for Animation and Animator</h1>
                </header>
            
            <article>
                
<p class="calibre3"><strong class="calibre5">Animators</strong> have been the standard way of managing <em class="calibre14">Animation Clips</em> in Unity, before Timeline. It uses <span class="calibre6">an <span class="calibre6">Animator Component</span>, an <span class="calibre6">Animator Controller</span>, and an <span class="calibre6">Animation Clip</span>. Fortunately, if you create a new Animation Clip on an object, Unity creates each of these items for you. But it's important to understand how they fit together.</span></p>
<p class="calibre3">Briefly, from the Unity manual (<a href="https://docs.unity3d.com/Manual/animeditor-CreatingANewAnimationClip.html" class="calibre10">https://docs.unity3d.com/Manual/animeditor-CreatingANewAnimationClip.html</a>):</p>
<div class="packtquote"><span>"To animate GameObjects in Unity, the object or objects need an </span><strong class="calibre1">Animator Component</strong><span> attached. This Animator Component must reference an </span><strong class="calibre1">Animator Controller</strong><span>, which in turn contains references to one or more </span><strong class="calibre1">Animation Clips</strong><span>."</span></div>
<p class="calibre3"><span class="calibre6">These objects originate from the Mecanim animation system folded into Unity a few versions back (you may still see references to Mecanim in the Unity Manual and web searches). This animation system is especially tailored for humanoid character animations (see <a href="https://docs.unity3d.com/Manual/AnimationOverview.html" class="calibre10">https://docs.unity3d.com/Manual/AnimationOverview.html</a>). The terminology can seem redundant and confusing. The following definitions may help (or not!). Pay especially close attention to the use of "animator" versus "animation":</span></p>
<ul class="calibre11">
<li class="calibre12"><em class="calibre2">Animation Clips</em><span>:</span> Describes how an object's properties change over time.</li>
<li class="calibre12"><em class="calibre2">Animator Controller</em><span>:</span> Organizes clips in a state machine flowchart, keeps track which clip should currently be playing, when animations should change or blend together. References the clips it uses.</li>
<li class="calibre12"><em class="calibre2">Animator component</em><span>:</span> Brings together Animation Clips, the Animation Controller, and the Avatar if used.</li>
<li class="calibre12">Do not use<span> </span><em class="calibre2">legacy Animation components :</em> Animation component is legacy but Animation window is not!</li>
<li class="calibre12"><em class="calibre2">Animation window</em>: Used to create/edit individual Animation Clips, and can animate any property you can edit in the inspector. Shows a <span>timeline</span> but is not the same as the Timeline window. Offers Dopesheet versus Curves view. </li>
<li class="calibre12"><em class="calibre2">Animator window</em>: Organizes existing animation clip assets into a flowchart-like state machine graph.</li>
</ul>
<div class="packtinfobox"><span>Actually, Timeline animation recordings also use Animation Clips, you just don't need to explicitly create them. Each recorded Animation Track in a Timeline has a corresponding animation playable file (named "Recorded (n)") in your Assets folder. </span></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">ThirdPersonController Animator</h1>
                </header>
            
            <article>
                
<p class="calibre3">The <kbd class="calibre13">ThirdPersonController</kbd> character prefab we used for Ethan in previous chapters uses an animator controller to manage humanoid animation clips on the rigged model. For curiosity, let's examine it now (although we will not use it in this scene):</p>
<ol class="calibre15">
<li class="calibre12">Temporarily drag a copy of the <kbd class="calibre13">ThirdPersonController</kbd> prefab from your <span>Project</span> <kbd class="calibre13">Assets/Standard Assets/ Characters/ThirdPersonCharacter/Prefabs/</kbd> folder into the scene.</li>
<li class="calibre12">Notice in <span>Inspector</span>, it has an <span>Animator</span> component and the <span>Controller</span> slot references <kbd class="calibre13">ThirPersonAnimatorController</kbd>. Click on that.</li>
<li class="calibre12">This will highlight the controller asset (in <kbd class="calibre13">Assets/.../ThirdPersonCharacter/Animator</kbd>).</li>
<li class="calibre12">Double-click<kbd class="calibre13">ThirdPersonAnimatorController</kbd> to open it in an <span>Animator</span> window.</li>
</ol>
<p class="calibre3">The Animator graph for Ethan is shown next. You can see that when the character is activated (<kbd class="calibre13">Entry</kbd>), it initializes to the <kbd class="calibre13">Grounded</kbd> state. <span class="calibre6">The oval boxes are </span><span class="calibre6">States</span><span class="calibre6">; the lines between them are </span><span class="calibre6">Transitions</span><span class="calibre6">. </span>On the left is the list of state <span class="calibre6">Properties</span> that the Animator can use. When <kbd class="calibre13">Crouch</kbd> is true, for example, the animation transitions to <kbd class="calibre13">Crouching</kbd>, plays that, then transitions back (and clears the <kbd class="calibre13">Crouch</kbd> state flag):</p>
<div class="mce-root1"><img src="assets/fabf44c6-83b7-4256-94f8-872d8c44e0fd.png" class="calibre24"/></div>
<p class="calibre3">If you open the <kbd class="calibre13">Grounded</kbd> state (double-click), you can see a <span class="calibre6">Blend Tree</span> with an impressive collection of <span class="calibre6">Animation Clips</span> for standing idle, walking, turning, and so on. These will be activated and combined (blended) based on user input. </p>
<p class="calibre3">Next, let's look at another example, the <kbd class="calibre13">BirdAnimatorController</kbd> used by our <kbd class="calibre13">Bluejay</kbd>.</p>
<p class="calibre3">You can now delete the <kbd class="calibre13">ThirdPersonController</kbd> object from the scene.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Living Birds Animator</h1>
                </header>
            
            <article>
                
<p class="calibre3">The Living Birds package comes with a lot of animation clips. You can actually open the FBX models in Blender or another animation application and examine how the models and animations are defined. These have been combined into a <kbd class="calibre13">BirdAnimationController</kbd>. Examine the Animator using the following steps:</p>
<ol class="calibre15">
<li class="calibre12">Select the <kbd class="calibre13">Bluejay</kbd> in <span><span>Hierarchy.</span></span></li>
<li class="calibre12">Notice in <span>Inspector</span>, it has an <span>Animator</span> component, and the <span>Controller</span> slot references <kbd class="calibre13">BirdAnimatorController</kbd>. Click on that.</li>
<li class="calibre12"><span>In <span>Project Assets</span>, double-click the <kbd class="calibre13">ThirdPersonAnimatorController</kbd> to open it in an <span>Animator</span> window.</span></li>
</ol>
<p class="calibre3">The Animator graph is shown here:</p>
<div class="mce-root1"><img src="assets/fb942217-cd4a-423b-be38-3fa48b860bac.png" class="calibre24"/></div>
<p class="calibre3">You can see that almost all the animations readily transition to and from the Idle one, whether Preen, Peck, Sing, or HopLeft, HopRight, HopForward, and so on. Also, note the Idle -&gt; Fly -&gt; Landing -&gt; Idle loop, as we're going to use that.</p>
<p class="calibre3">The Bluejay also has a C# script, <kbd class="calibre13">lb_Bird</kbd>, which invokes the Animator behaviors. It's not the cleanest code, but it is useful. The most pertinent functions are <kbd class="calibre13">OnGroundBehaviors</kbd> and <kbd class="calibre13">FlyToTarget</kbd>:</p>
<ul class="calibre11">
<li class="calibre12"><kbd class="calibre13">OnGroundBehaviors</kbd> randomly chooses and plays one of the idle animations every 3 seconds</li>
<li class="calibre12"><kbd class="calibre13">FlyToTarget</kbd>, will cause the bird to fly to a given position, including takeoff and landing and random fluttering around; it looks reasonably natural</li>
</ul>
<p class="calibre3">So in our project, rather than recording the Keyframe position details of the bird's animation path like we did the falling nest, we'll define specific targets and let the <kbd class="calibre13">lb_Bird</kbd> script actually control the bird transforms. <span class="calibre6">This is a lot like using a <span class="calibre6">Navmesh</span> to direct Ethan's movement as we did in Chapter 4, <em class="calibre14">Gaze-Based Control</em>. We will use Timeline to select one target position to the next, over time.  </span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Learning to fly</h1>
                </header>
            
            <article>
                
<p class="calibre3">First, let's create a <kbd class="calibre13">BirdController</kbd> and specify a list of locations where the bird should fly between. Then, we'll add this to the Timeline:</p>
<ol class="calibre15">
<li class="calibre12">In <span>Hierarchy</span>, create an <span>Empty</span> game object named <kbd class="calibre13">BirdController</kbd> and reset its <span>Transform.</span></li>
<li class="calibre12">Create a child <span>Empty</span> object, named <kbd class="calibre13">Location1</kbd>. Move it to be just atop the rock closest to the Nest .</li>
<li class="calibre12"><span>Create another <span>Empty</span>, named <kbd class="calibre13">Location2</kbd>, positioned back near the Nest but not in it this time.</span></li>
<li class="calibre12">Continue creating location markers. The values I used, based on my scene and rock locations, are shown in the following table.</li>
<li class="calibre12">The last location should be far away. The bird will head there at the end of the video.</li>
</ol>
<table class="calibre73">
<thead class="calibre74">
<tr class="calibre38">
<td class="calibre39">Name</td>
<td class="calibre39">Position</td>
<td class="calibre39">Description</td>
</tr>
</thead>
<tbody class="calibre37">
<tr class="calibre38">
<td class="calibre39"><kbd class="calibre13">Location0</kbd></td>
<td class="calibre39"><kbd class="calibre13">(0.75, 0.4, -1.25)</kbd></td>
<td class="calibre39">Start position of the Bluejay</td>
</tr>
<tr class="calibre38">
<td class="calibre39"><kbd class="calibre13">Location1</kbd></td>
<td class="calibre39"><kbd class="calibre13">(3, 0.8, 0)</kbd></td>
<td class="calibre39">Atop nearest rock</td>
</tr>
<tr class="calibre38">
<td class="calibre39"><kbd class="calibre13">Location2</kbd></td>
<td class="calibre39"><kbd class="calibre13">(1.2, 0.2, -1.7)</kbd></td>
<td class="calibre39">Ground near Nest but not in it</td>
</tr>
<tr class="calibre38">
<td class="calibre39"><kbd class="calibre13">Location3</kbd></td>
<td class="calibre39"><kbd class="calibre13">(2.5, 0.8, -3.4)</kbd></td>
<td class="calibre39">Atop next nearest rock</td>
</tr>
<tr class="calibre38">
<td class="calibre39"><kbd class="calibre13">Location4</kbd></td>
<td class="calibre39"><kbd class="calibre13">(-5.85, 0.8, -0.3)</kbd></td>
<td class="calibre39">Next rock</td>
</tr>
<tr class="calibre38">
<td class="calibre39"><kbd class="calibre13">Location5</kbd></td>
<td class="calibre39"><kbd class="calibre13">(-5, 0.33, 3.5)</kbd></td>
<td class="calibre39">Last rock</td>
</tr>
<tr class="calibre38">
<td class="calibre39"><kbd class="calibre13">Location6</kbd></td>
<td class="calibre39"><kbd class="calibre13">(45, 11, 45)</kbd></td>
<td class="calibre39">In the distance</td>
</tr>
</tbody>
</table>
<p class="calibre3">Create a new C# script on the <kbd class="calibre13">BirdController</kbd>, named <kbd class="calibre13">BirdController</kbd>, and write it as follows:</p>
<pre class="calibre18">using System.Collections;<br class="title-page-name"/>using System.Collections.Generic;<br class="title-page-name"/>using UnityEngine;</pre>
<pre class="calibre18"><br class="title-page-name"/>public class BirdController : MonoBehaviour<br class="title-page-name"/>{<br class="title-page-name"/>    public GameObject bird;<br class="title-page-name"/>    public List&lt;GameObject&gt; targets = new List&lt;GameObject&gt;();<br class="title-page-name"/>    public int animIndex;<br class="title-page-name"/><br class="title-page-name"/>    public bool collideWithObjects = false;<br class="title-page-name"/>    public float birdScale = 1.0f;<br class="title-page-name"/><br class="title-page-name"/>    private int prevIndex;<br class="title-page-name"/><br class="title-page-name"/>    void Start()<br class="title-page-name"/>    {<br class="title-page-name"/>        prevIndex = 0;<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    void Update()<br class="title-page-name"/>    {<br class="title-page-name"/>        if (animIndex != prevIndex &amp;&amp; <br class="title-page-name"/>            index &gt; 0 &amp;&amp; <br class="title-page-name"/>            index &lt; targets.Count)<br class="title-page-name"/>        {<br class="title-page-name"/>            prevIndex = animIndex;<br class="title-page-name"/>            bird.gameObject.SendMessage("FlyToTarget", targets[index].transform.position);<br class="title-page-name"/>        }<br class="title-page-name"/>    }<br class="title-page-name"/>}<br class="title-page-name"/>}</pre>
<p class="calibre3">There are a number of things going on here. We'll explain.</p>
<p class="calibre3"><kbd class="calibre13">BirdController</kbd> has a reference to the <kbd class="calibre13">bird</kbd>, and a list of location <kbd class="calibre13">targets</kbd>. We'll populate this list in the Unity Editor. Each location is identified by an index value between <kbd class="calibre13">0</kbd> and the size of the list. An integer, <kbd class="calibre13">animIndex</kbd>, will be the parameter controlled by the Timeline, telling the controller which location the bird should fly to.</p>
<p class="calibre3">On each Update, we check whether the <kbd class="calibre13">animIndex</kbd> has changed. If so, and it's within the range for our list, it calls <kbd class="calibre13">FlyToTarget</kbd> on the bird. (We use <kbd class="calibre13">SendMessage</kbd>, not a best practice way of triggering functions in another object, but it's the least disruptive given the existing scripts provided with the Living Birds package.)</p>
<p class="calibre3">The extra two variables, <kbd class="calibre13">collideWithObjects</kbd> and <kbd class="calibre13">birdScale</kbd>, are not used but are required by the <kbd class="calibre13">lb_Bird.cs</kbd> script on the Bluejay.</p>
<p class="calibre3">Save the script. Now, in Unity:</p>
<ol class="calibre15">
<li class="calibre12">Drag the <kbd class="calibre13">BirdController</kbd> script onto the <kbd class="calibre13">BirdController</kbd> object as a component</li>
<li class="calibre12">Drag <kbd class="calibre13">Bluejay</kbd> onto the <span>Bird</span> slot</li>
<li class="calibre12">Unfold the <span>Targets</span> list and set <span>Size</span> to <kbd class="calibre13">7</kbd></li>
<li class="calibre12">Drag <kbd class="calibre13">Location0</kbd> onto <span>Element 0</span>, <kbd class="calibre13">Location1</kbd> onto <span>Element 1</span>, and so on</li>
</ol>
<p class="calibre3">The Hierarchy with the BirdController component is shown here:</p>
<div class="mce-root1"><img src="assets/04e02268-18e3-4461-b644-f51cf8bd6e73.png" class="calibre24"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Hacking the birds</h1>
                </header>
            
            <article>
                
<p class="calibre3">Unfortunately, like a lot of code you'll find on the internet, the Living Birds code works for its own purposes but not necessarily ours. In this case, the package is designed for generating a flock of various birds that fly and land randomly, avoid collisions and can even be killed. We have just one bird and want more control over the landing locations, so we'll make a change to use our <kbd class="calibre13">BirdController</kbd> rather than the <kbd class="calibre13">lb_BirdController</kbd> in the package.</p>
<p class="calibre3">Open the <kbd class="calibre13">lb_Bird.cs</kbd> file (attached to <kbd class="calibre13">Bluejay</kbd>) and modify it as follows:</p>
<p class="calibre3">Replace the definition of <kbd class="calibre13">controller</kbd> to be our <kbd class="calibre13">BirdController</kbd>:</p>
<pre class="calibre18">// lb_BirdController controller; // removed<br class="title-page-name"/>public BirdController controller; // added</pre>
<p class="calibre3">Comment out or remove the  <kbd class="calibre13">SetController </kbd><span class="calibre6">function:</span></p>
<pre class="calibre18">// remove this<br class="title-page-name"/>// void SetController(lb_BirdController cont){<br class="title-page-name"/>//     controller = cont;<br class="title-page-name"/>// }</pre>
<p class="calibre3">Save it. In Unity, drag the <kbd class="calibre13">BirdController</kbd> object onto the <span class="calibre6">Bluejay</span>'s <span class="calibre6">LB_Bird Controller</span> slot.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Fly away!</h1>
                </header>
            
            <article>
                
<p class="calibre3">Now, we'll add the BirdController as an Animation Track in our Timeline. The AnimIndex parameter is an integer value that will step up in value along the timeline. We want to Bluejay to start learning to fly around 80 seconds, and jump from location to location about 10 seconds apart (80, 90, 100, 110, 120, and away at 130).</p>
<ol class="calibre15">
<li class="calibre12">Open the <span>Timeline Editor</span> window for the <kbd class="calibre13">BlackbirdDirector</kbd>.</li>
<li class="calibre12">Drag the <kbd class="calibre13">BirdController</kbd> object from <span>Hierarchy</span> onto the <span>Timeline</span>, adding a new <span>Animation Track.</span></li>
<li class="calibre12">Press its red <span>Record</span> button.</li>
<li class="calibre12">Select the <kbd class="calibre13">BirdController</kbd> in <span>Hierarchy.</span></li>
<li class="calibre12">Move the <span>Playhead</span> to <kbd class="calibre13">80</kbd>, and in <span>Inspector</span>, set <span>Anim Index</span> to <kbd class="calibre13">1</kbd>.</li>
<li class="calibre12">Move the <span>Playhead</span> to <kbd class="calibre13">90</kbd> and set <span>Anim Index</span> to <kbd class="calibre13">2</kbd>.</li>
<li class="calibre12">Continue for the other indexes <kbd class="calibre13">3</kbd> through <kbd class="calibre13">6</kbd>.</li>
<li class="calibre12">Press the red <span>Record</span> button again to stop recording.</li>
<li class="calibre12">Preview the curve. If it doesn't start at 0 (prior to 80s), use <span>Edit in Animation Window</span> and add another Keyframe with value <kbd class="calibre13">0</kbd>.</li>
</ol>
<p class="calibre3">The <span class="calibre6">Animation Track</span> curve for the <span class="calibre6">Anim Index</span> parameter is shown here, simply incrementing by one at each keyframe:</p>
<div class="mce-root1"><img src="assets/54b4d8a8-0308-4e22-82f4-1bf5ce8da653.png" class="calibre24"/></div>
<p class="calibre3"><span class="calibre6">Play</span> it through. Wow! The bird flies from rock to rock, and eventually flies away!</p>
<p class="calibre3">You can adjust the bird's path and timing between landings by moving the location objects and the animation curve keyframes, respectively. You could also try animating the BirdController's <span class="calibre6">Bird Scale</span> parameter to make the bird increasingly more bold and strong as it learns to fly. A screen capture is given here with the bird flying and leaves falling:</p>
<div class="mce-root1"><img src="assets/9059b585-24dc-4923-8704-824668e046dc.png" class="calibre24"/></div>
<p class="calibre3"><span class="calibre6">We have a completed story. </span>To wrap this up, let's add a little bit of interactivity, so the player can control when the story begins playing.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Making the story interactive</h1>
                </header>
            
            <article>
                
<p class="calibre3">So far, we used the Timeline to drive our entire VR story experience from start to finish. But in fact, Timelines are a playable asset like others in Unity. For example, if you select the BlackbirdDirector object and look in Inspector at its Playable Director, you'll see it has a Play On Awake checkbox, and it's presently checked. What we're going to do now is not play on awake, but rather start playing on a user event, namely looking directly at the small tree for a few seconds. And when the story ends, it resets itself.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Look to play</h1>
                </header>
            
            <article>
                
<p class="calibre3">First, we'll add a LookAtTarget encasing the small tree and then use that to trigger playing the timeline:</p>
<ol class="calibre15">
<li class="calibre12">Select the<span> </span><kbd class="calibre13">BlackbirdDirector</kbd><span> </span>and uncheck the<span> </span><span>Play On Awake</span><span> </span>checkbox</li>
<li class="calibre12">For reference, set the Tree game object Scale to its starting keyframe Scale (<kbd class="calibre13">0.1, 0.1, 0.1</kbd>) </li>
<li class="calibre12">In<span> </span><span>Hierarchy</span>, create a cube (<span>Create | 3D Object | Cube</span>) and name it <kbd class="calibre13">LookAtTarget</kbd></li>
<li class="calibre12">Scale and place it to encase the small tree,<span> </span><span>Scale</span><span> </span>(<kbd class="calibre13">0.4, 0.5, 0.4</kbd>),<span> </span><span>Position</span><span> </span>(<kbd class="calibre13">0, 0.3, 0</kbd>)</li>
<li class="calibre12">Disable its<span> </span><span>Mesh Renderer</span>, but keep its<span> </span><span>Box Collider</span></li>
<li class="calibre12">Create a new C# script on the cube, named <kbd class="calibre13">LookAtToStart</kbd>, and write it as follows:</li>
</ol>
<pre class="calibre18">using System.Collections;<br class="title-page-name"/>using System.Collections.Generic;<br class="title-page-name"/>using UnityEngine;<br class="title-page-name"/>using UnityEngine.Playables;<br class="title-page-name"/><br class="title-page-name"/>public class LookAtToStart : MonoBehaviour<br class="title-page-name"/>{<br class="title-page-name"/>    public PlayableDirector timeline;<br class="title-page-name"/>    public float timeToSelect = 2f;<br class="title-page-name"/>    private float countDown;<br class="title-page-name"/><br class="title-page-name"/>    void Start()<br class="title-page-name"/>    {<br class="title-page-name"/>        countDown = timeToSelect;<br class="title-page-name"/>    }</pre>
<pre class="calibre18"><br class="title-page-name"/>    void Update()<br class="title-page-name"/>    {<br class="title-page-name"/>        // Do nothing if already playing<br class="title-page-name"/>        if (timeline.state == PlayState.Playing)<br class="title-page-name"/>            return;<br class="title-page-name"/><br class="title-page-name"/>        // Is user looking here?<br class="title-page-name"/>        Transform camera = Camera.main.transform;<br class="title-page-name"/>        Ray ray = new Ray(camera.position, camera.rotation * Vector3.forward);<br class="title-page-name"/>        RaycastHit hit;<br class="title-page-name"/>        if (Physics.Raycast(ray, out hit) &amp;&amp; <br class="title-page-name"/>            (hit.collider.gameObject == gameObject))<br class="title-page-name"/>        {<br class="title-page-name"/>            if (countDown &gt; 0f)<br class="title-page-name"/>            {<br class="title-page-name"/>                countDown -= Time.deltaTime;<br class="title-page-name"/>            }<br class="title-page-name"/>            else<br class="title-page-name"/>            {<br class="title-page-name"/>                // go!<br class="title-page-name"/>                timeline.Play();<br class="title-page-name"/>            }<br class="title-page-name"/>        }<br class="title-page-name"/>        else<br class="title-page-name"/>        {<br class="title-page-name"/>            // reset timer<br class="title-page-name"/>            countDown = timeToSelect;<br class="title-page-name"/>        }<br class="title-page-name"/>    }<br class="title-page-name"/>}</pre>
<p class="calibre3">The script is similar to ones we wrote in Chapter 4. We use the main camera and determine the direction it is looking. Using the physics engine, we call <kbd class="calibre13">Physics.Raycast</kbd> to cast a ray in the view direction and determine if it hit this object. If so, we start or continue a countdown timer and then play the timeline. Meanwhile, if you look away, we reset the timer.</p>
<p class="calibre3">Try it now. The Timeline will not start playing until you look at the cube for a few seconds.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Resetting the initial scene setup</h1>
                </header>
            
            <article>
                
<p class="calibre3"><span class="calibre6">You probably noticed, unfortunately, that the default start scene is not necessary the same state we have for the beginning of the timeline.  You could fix this by manually ensuring that every object in the scene Hierarchy has the same initial state as the start of the timeline. Instead, we'll add a little hack that plays the timeline for a brief 0.1 seconds to reset the objects.</span></p>
<p class="calibre3">We will implement this using a coroutine. Modify the <kbd class="calibre13">LookAtToStart</kbd> script as follows. Add a new variable, <kbd class="calibre13">resetSetup</kbd>, and initialize it to true:</p>
<pre class="calibre18">private bool resetSetup;<br class="title-page-name"/><br class="title-page-name"/>void Start()<br class="title-page-name"/>{<br class="title-page-name"/>    countDown = timeToSelect;<br class="title-page-name"/>    resetSetup = true;<br class="title-page-name"/>}</pre>
<p class="calibre3">Add a <kbd class="calibre13">PlayToSetup</kbd> function that will be run as a coroutine. Coroutines are a way to run a function, let Unity do other stuff momentarily, and then resume where you left off (via the <kbd class="calibre13">yield</kbd> statement). Here, we start playing the timeline, go away for 0.1 seconds, and then tell it to stop playing:</p>
<pre class="calibre18">IEnumerator PlayToSetup()<br class="title-page-name"/>{<br class="title-page-name"/>    timeline.Play();<br class="title-page-name"/>    yield return new WaitForSeconds(0.1f);<br class="title-page-name"/>    timeline.Stop();<br class="title-page-name"/>}</pre>
<p class="calibre3">Call the coroutine from <kbd class="calibre13">Update</kbd> when we want to reset the setup:</p>
<pre class="calibre18">    void Update()<br class="title-page-name"/>    {<br class="title-page-name"/>        if (timeline.state == PlayState.Playing)<br class="title-page-name"/>        {<br class="title-page-name"/>            return;<br class="title-page-name"/>        }<br class="title-page-name"/>        if (resetSetup)<br class="title-page-name"/>        {<br class="title-page-name"/>            StartCoroutine("PlayToSetup");<br class="title-page-name"/>            resetSetup = false;<br class="title-page-name"/>        }</pre>
<p class="calibre3">We also want the scene to reset after the timeline plays all the way through, so we set <kbd class="calibre13">resetSetup</kbd> as soon as the timeline starts playing. It'll be recognized once <kbd class="calibre13">timeline.state</kbd> is no longer playing:</p>
<pre class="calibre18">        ...<br class="title-page-name"/>            // go!<br class="title-page-name"/>            timeline.Play();<br class="title-page-name"/>            resetSetup = true;<br class="title-page-name"/>        }</pre>
<p class="calibre3">Press Play. Look at the tree. Enjoy the experience. When it ends, you're reset to the beginning and can look at the tree again to replay.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">More interactivity ideas</h1>
                </header>
            
            <article>
                
<p class="calibre3">We're going to stop developing now. Some suggestions on how to improve the interactivity and user experience include:</p>
<ul class="calibre11">
<li class="calibre12">Add a particle effect around the tree to indicate that it's a trigger</li>
<li class="calibre12">Highlight the tree as feedback when you're looking at it</li>
<li class="calibre12">Display a countdown cursor to indicate the timer has started and when the story will begin playing</li>
</ul>
<p class="calibre3">Here are other suggestions for interactable objects you could add to the story:</p>
<ul class="calibre11">
<li class="calibre12">Look at the egg in the nest causes it to hatch sooner than its default timing</li>
<li class="calibre12">When you look at the bird while it's idle, it will turn to look back at you</li>
<li class="calibre12">If you poke the bird with your hand controller, it jumps out of the way</li>
<li class="calibre12">You can pick up a rock and throw it to kill the bird (nooo, just kidding!)</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p class="calibre3">In this chapter, we built an animated VR story. We began by deciding what we want to do, planning out the timeline, music track, graphic assets, animation sequences, and lighting. We imported our assets and placed them in the scene, then created a Timeline and roughed out when specific objects are enabled and disabled using an Activation Track. Next, we animated several objects, including growing the tree, floating the nest, and rumbling the egg. We also animated the lighting, learning how to animate game object parameters other than Transforms.</p>
<p class="calibre3">We also used Animation Clips and an Animator Controller, using animations imported from a third-party package. We reviewed a script that calls into the Animator and wrote a controller on top of that, to fly the bird from location to location. Lastly, we added interactions to the story, using gaze-based control to start and replay the experience.</p>
<p class="calibre3"><span class="calibre6">In the next chapter, we go social as we look at ways to add multi-user networking to Unity VR projects and how to add scenes to the emerging metaverse. Multiplayer games are familiar to most of us, but when combined with virtual reality, it provides a social experience that is unparalleled by any other technology. We will learn about networking technology using the Unity Networking features.</span></p>


            </article>

            
        </section>
    </body></html>