<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Scripting Victory and Defeat</h1>
                </header>
            
            <article>
                
<p class="mce-root">In <a href="fdacd7a8-63fe-454d-9d50-f9f40070e484.xhtml" target="_blank">Chapter 10</a>, <em>Scripting Our Points System</em>, we designed, scripted, and implemented our game's point system. We made changes to the appropriate GameObjects and wrote several scripts to manage the point system. We ensured the points were updated on our <strong>Head's-Up Display</strong> (<strong>HUD</strong>) for each frame of the game. In addition, we added the ability for the Cucumber Man to collect cherries from the cherry trees and use them as weapons against the Cucumber Beetles. </p>
<p>In this chapter, we will design and script our game's victory and defeat conditions. We will update the scripts we created in other chapters to manage the Cucumber Man's health, providing frame-by-frame onscreen updates and ensuring a player life is lost when the health runs out. We will manage, through scripts, the lives remaining. We will also design and script the respawning of our player character.</p>
<p>Specifically, we will cover the following in this chapter:</p>
<ul>
<li>Designing the defeat and victory conditions</li>
<li>Updating the player's health</li>
<li>Implementing the victory logic</li>
<li>Implementing the end-of-game logic</li>
<li>Updating the HUD with lives remaining</li>
<li>Scripting the player character's respawning</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Designing victory and defeat conditions</h1>
                </header>
            
            <article>
                
<p>Currently, our game has no clear end and does not implement any reward for the player's actions. In this section, we will design our game's victory and defeat conditions so that there is a clear goal or way to win the game.</p>
<p>In <a href="df7798e1-3730-4af7-8c04-857d71ac78d2.xhtml" target="_blank">Chapter 3</a>, <em>Designing the Game</em>, we identified three end-of-game conditions: two ending in defeat for our Cucumber Man, and only one resulting in defeat for our Cucumber Beetles.</p>
<p>Here are the victory conditions for our game:</p>
<ul>
<li>The Cucumber Beetles win if:
<ul>
<li>There are no cucumbers left in the game</li>
<li>The Cucumber Man runs out of lives</li>
</ul>
</li>
<li>The Cucumber Man wins if:
<ul>
<li>There are no Cucumber Beetles left in the game</li>
</ul>
</li>
</ul>
<p>These victory and defeat conditions are pretty simple, and there can only be one winner. If the Cucumber Beetles win, the Cucumber Man loses. </p>
<p>In order to implement these conditions, we need to track the following with our scripts:</p>
<ul>
<li>Number of cucumbers</li>
<li>Number of Cucumber Beetles</li>
<li>Number of Cucumber Man lives remaining </li>
</ul>
<p>In <a href="fdacd7a8-63fe-454d-9d50-f9f40070e484.xhtml" target="_blank">Chapter 10</a>, <em>Scripting Our Points System</em>, we wrote the necessary scripts to keep track of cucumbers and Cucumber Beetles. We also ensured the HUD is continuously updated with those counts. It is important for the player to have a sense of how they are doing in the game. Beyond just points, the player will want to continually review how many cucumbers and C<span>ucumber</span> Beetles there are in the game. The player will also want to know how many Cucumber Man lives remain. </p>
<p>In the next section, we will update our game so the number of lives are updated and the player's health bar is put into use. These will provide the player with much-needed visual components of the HUD during gameplay.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Updating the player's health</h1>
                </header>
            
            <article>
                
<p>In this section, we will fully implement our player's health. We will start the Cucumber Man with three lives, each with a full health value of 100. We will update our scripts so that the Cucumber Man loses health when a cucumber beetle attacks him. Our approach will be to deduct one point from the Cucumber Man's health for every second that it is colliding with a Cucumber Beetle. We will also script the HUD's health bar and start with that task in the next section.</p>
<p><span>Before we get started, you should open your Unity game project. </span><span>Alternatively, you can download the</span> <em>Starting-Chapter-11</em><span><em> Unity</em> </span><span>project available from the publisher's companion site.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Scripting the health bar</h1>
                </header>
            
            <article>
                
<p>In this section, we will create a new script and attach it to our HUD's health bar. We will edit the script and use it to manage our Cucumber Man's health and the visible status of the HUD's health bar.</p>
<p>Let's start by reviewing our health bar:</p>
<ol>
<li>In the <span class="packt_screen">Hierarchy</span> panel, select the <kbd>HUD_Canvas</kbd> | <kbd>Health_Slider</kbd>.</li>
</ol>
<p> </p>
<ol start="2">
<li>In the <span class="packt_screen">Inspector</span> panel, review the <span class="packt_screen">Slider (Script)</span> component. As you can see in the following screenshot, there is a <span class="packt_screen">Value</span> component with a slider at the bottom of the interface:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="281" width="322" src="assets/94572672-7913-46ac-adec-96ee531eb0c9.png"/></div>
<ol start="3">
<li>Click the <span class="packt_screen">Game</span> view tab so you can see the HUD without being in game-mode.</li>
<li>In the <span class="packt_screen">Inspector</span> panel, drag the <span class="packt_screen">Value</span> slider and observe how the health bar functions.</li>
</ol>
<p>You can see that the health bar already functions; we merely need to add a script to the slider so that it tracks the player's health and updates the HUD during game play. Here are those steps:</p>
<ol start="1">
<li>In the <span class="packt_screen">Inspector</span> panel, click the <span class="packt_screen">Add Component</span> button</li>
<li>Select <span class="packt_screen">New Script</span> and name the script <kbd>HealthManager</kbd></li>
<li>In the <span class="packt_screen">Project</span> panel, click <span class="packt_screen">Favorites</span> | <span class="packt_screen">All Scripts</span></li>
<li>Drag the <kbd>HealthManager</kbd> script to the <kbd>Assets</kbd> | <kbd>Custom Scripts</kbd> folder</li>
<li>Double-click the <kbd>HealthManager</kbd> script to open it in an editor</li>
</ol>
<p> </p>
<ol start="6">
<li>Edit the script so that it matches the following code, the first section of the code contains the namespace <kbd>import</kbd> statements and the <kbd>HealthManager</kbd> <span>class declaration:</span></li>
</ol>
<pre><span> <span>using</span><span> System</span><span>.</span><span>Collections</span><span>;</span><br/> <span>using</span><span> System</span><span>.</span><span>Collections</span><span>.</span><span>Generic</span><span>;</span><br/> <span>using</span><span> UnityEngine</span><span>;</span><br/> <span>using</span><span> UnityEngine</span><span>.</span><span>UI</span><span>;</span><br/> <br/> <span>public</span><span> </span><span>class</span><span> </span><span>HealthManager</span><span> </span><span>:</span><span> </span><span>MonoBehaviour</span><span> </span><span>{</span> <br/></span></pre>
<p><span>The next section of code declares our class variables. We will use</span> <kbd>currentHealth</kbd> <span>to hold the value of the Cucumber Man's up-to-date health value. We will use</span> <kbd>healthBar</kbd> <span>as a reference to the slider:</span></p>
<pre><span>public static int currentHealth;<br/>public Slider healthBar;<br/></span></pre>
<p><span>Our</span> <kbd>HealthManager</kbd> <span>class has three methods; the first is the <kbd>Awake()</kbd> method. The first statement in this method gets a reference to the</span> <kbd>Slider</kbd> <span>component. The second statement sets the <kbd>currentHealth</kbd> to <kbd>100</kbd>. This is our maximum health starting point for the Cucumber Man:</span></p>
<pre><span>void Awake () {<br/>healthBar = GetComponent&amp;lt;Slider&gt; ();<br/>currentHealth = 100;<br/>}<br/><br/></span></pre>
<p><span>Our second method is the <kbd>ReduceHealth()</kbd> method. This will be used by other scripts to call for a health reduction. As you can see, the first statement simply decrements the <kbd>currentHealth</kbd> value by one. The second statement updates the slider on the screen:</span></p>
<pre><span>void ReduceHealth () {<br/>currentHealth = currentHealth - 1;<br/>healthBar.value = currentHealth;<br/>}<br/></span></pre>
<p>The last method for this class is the <kbd>Update()</kbd> method. We have one statement in that method to update the slider for each frame of the game. This results in the slider accurately depicting the player's health:</p>
<pre><span>void Update () {<br/>healthBar.value = currentHealth;<br/>}<br/> }</span></pre>
<p>In the next section, we will modify the appropriate script to call the <kbd>ReduceHealth()</kbd> method when the Cucumber Man is being bitten by a Cucumber Beetle. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Decrementing health</h1>
                </header>
            
            <article>
                
<p>Our <kbd>BeetleNPC</kbd> script already detects collisions with the Cucumber Man, so we can simply update that script to deduct a point from the Cucumber Man's health when a collision is detected. We will do this by making a call to the <kbd>ReduceHealth()</kbd> method of the <kbd>HealthManager</kbd> script. Here are the steps:</p>
<ol>
<li>In the <span class="packt_screen">Project</span> panel, select <span class="packt_screen">Assets</span> | <span class="packt_screen">Custom Scripts</span> and double-click the <kbd>BeetleNPC</kbd> script.</li>
<li>Add the following statement in the class variables section of the script. This creates a variable we can use to reference the <kbd>HealthManager</kbd> class:</li>
</ol>
<pre>      public HealthManager _healthManager;</pre>
<ol start="3">
<li>Add the following two statements in the <kbd>OnCollisionEnter()</kbd> method after the first <kbd>if</kbd> statement:</li>
</ol>
<pre><span><span>      _healthManager</span><span> </span><span>=</span><span> </span><span>GameObject</span><span>.</span><span>Find</span><span> <br/></span><span>      (</span><span>"</span><span>Health_Slider</span><span>"</span><span>)</span><span>.</span><span>GetComponent</span><span>&amp;lt;</span><span>HealthManager</span><span>&gt;</span><span>()</span><span>;</span><br/><span>      _healthManager</span><span>.</span><span>ReduceHealth</span><span>()</span><span>;</span></span> </pre>
<p>With these two statements, we obtain a reference to the <kbd>HealthManager</kbd> script of <kbd><span>Health_Slider</span></kbd>, and then call the <kbd>ReduceHealth()</kbd> method.</p>
<p>You can now test your game and watch the health bar change as Cucumber Beetles start attacking the Cucumber Man.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Implementing victory</h1>
                </header>
            
            <article>
                
<p>In this section, we will implement the victory condition for the Cucumber Man. The only victory condition for the Cucumber Man is when the number of Cucumber Beetles is zero. Our <kbd>BeetleManager</kbd> script already provides functionality for counting Cucumber Beetles. As you will recall, that is how we update our Cucumber Beetle count on our HUD. We will make some modifications to that script and create a new script in this section.</p>
<p>Let's start by creating an onscreen text component to display <span class="packt_screen">You Won!</span> when the number of Cucumber Beetles reaches zero. Here are the steps:</p>
<ol>
<li>Right-click an empty area of the <span class="packt_screen">Hierarchy</span> panel.</li>
<li>Select <span class="packt_screen">Create Empty</span>.</li>
<li>In the <span class="packt_screen">Inspector</span> panel, rename the new GameObject to <kbd>EndofGame</kbd>. We will use this as a container for our victory and defeat text labels. </li>
<li>In the <span class="packt_screen">Hierarchy</span> panel, drag the <kbd>EndofGame</kbd> GameObject to subordinate it to our <kbd>HUD_Canvas</kbd>.</li>
<li>With the <kbd>EndofGame</kbd> GameObject selected, in the <span class="packt_screen">Inspector</span> panel, select the <span class="packt_screen">Transform</span> dropdown and click <span class="packt_screen">Reset</span>. This resets the transform of the object.</li>
<li>In the <span class="packt_screen">Hierarchy</span> panel, right-click and select <span class="packt_screen">UI</span> | <span class="packt_screen">Text</span>. </li>
<li>Subordinate the new text object to the <kbd>EndofGame</kbd> GameObject.</li>
<li>Rename the new text object <kbd>Victory</kbd>.</li>
</ol>
<p>The next four steps are used to configure the <span class="packt_screen">Victory</span> text object in the <span class="packt_screen">Inspector</span> panel:</p>
<ol start="1">
<li>Change the text property to <kbd>You Won!</kbd></li>
<li>Set the <span class="packt_screen">Font Style</span> to <span class="packt_screen">Bold</span></li>
<li>Increase the <span class="packt_screen">Font Size</span> to <span class="packt_screen">24</span></li>
<li>Select a bright <span class="packt_screen">Color</span> for the text</li>
</ol>
<p>By clicking on the <span class="packt_screen">Game</span> tab or putting the game into game mode, you can see the new victory text is displayed in the center of the screen. We only want that text displayed when the player has won the game. Let's tackle that task:</p>
<ol start="1">
<li>Ensure the <span class="packt_screen">Victory</span> text component is selected</li>
<li>In the <span class="packt_screen">Inspector</span> panel, click the <span class="packt_screen">Add Component</span> button</li>
</ol>
<p> </p>
<ol start="3">
<li>Select <span class="packt_screen">New Script</span> and name the script <kbd>VictoryManager</kbd></li>
<li>In the <span class="packt_screen">Project</span> panel, click <span class="packt_screen">Favorites</span> | <span class="packt_screen">All Scripts</span></li>
<li>Drag the <kbd>VictoryManager</kbd> script to the <kbd>Assets</kbd> | <kbd>Custom Scripts</kbd> folder</li>
<li>Double-click the <span class="packt_screen">VictoryManager</span> script to open it in an editor</li>
<li>Edit the script so that it matches the following code, the first section of the code contains the namespace <kbd>import</kbd> statements and the <kbd>VictoryManager</kbd> <span>class declaration:</span></li>
</ol>
<pre><span><span>using</span><span> System</span><span>.</span><span>Collections</span><span>;</span><br/> <span>using</span><span> System</span><span>.</span><span>Collections</span><span>.</span><span>Generic</span><span>;</span><br/> <span>using</span><span> UnityEngine</span><span>;</span><br/> <span>using</span><span> UnityEngine</span><span>.</span><span>UI</span><span>;</span><br/> <br/> <span>public</span><span> </span><span>class</span><span> </span><span>VictoryManager</span><span> </span><span>:</span><span> </span><span>MonoBehaviour</span><span> </span><span>{</span></span></pre>
<p>The next section of our script contains two class variable declarations and the <kbd>Awake()</kbd> method. In the <kbd>Awake()</kbd> method, we get the reference to the text component of our <kbd>Victory</kbd> UI object. We also set the initial text to null, so nothing will be displayed:</p>
<pre><span> <span>    </span><span>Text</span><span> </span><span>Victory</span><span>;<br/></span>     int beetleCount;<br/> <br/> <span>    </span><span>void</span><span> </span><span>Awake</span><span> </span><span>()</span><span> </span><span>{</span><br/> <br/> <span>        </span><span>Victory</span><span> </span><span>=</span><span> </span><span>GetComponent</span><span>&amp;lt;</span><span>Text</span><span>&gt;</span><span> </span><span>()</span><span>;</span><br/> <span>        </span><span>Victory</span><span>.</span><span>text</span><span> </span><span>=</span><span> </span><span>"</span><span>"</span><span>;</span><br/> <span>    </span><span>}</span></span></pre>
<p>The last section of our script is the <kbd>Update()</kbd> method. Here we set the value of count to the current count of Cucumber Beetles, then test whether the count equals zero. If the <kbd>(count == 0)</kbd> condition is true, we display the victory text on the screen:</p>
<pre><span> <span>    </span><span>void</span><span> </span><span>Update</span><span> </span><span>()</span><span> </span><span>{</span><br/> <br/> <span>        beetleCount = BeetleManager.currentBeetleCount;<br/> <br/>         if (beetleCount == 0) {<br/>             Victory.text = ("You won!");</span> <br/> <span>        </span><span>}</span><br/> <span>    </span><span>}</span><br/> <span>}</span><span> </span><br/></span></pre>
<p><span>Our next task is to update the</span> <kbd>BeetleManager</kbd> <span>script. We will make three changes to the script:</span></p>
<ol start="1">
<li>Add the <kbd>static</kbd> modifier to the <kbd>currentBeetleCount</kbd> class variable. The new line of code should be: </li>
</ol>
<pre>      public static int currentBeetleCount;</pre>
<p class="mce-root"/>
<ol start="2">
<li>
<p>In the <kbd>Awake()</kbd> method, change <kbd>currentBeetleCount = 0;</kbd> to <kbd>currentBeetleCount =1;</kbd>.  This will help ensure the game does not think there are no Cucumber Beetles when the game starts.</p>
</li>
<li>
<p>Add the following statement as the final statement in the <kbd>Update()</kbd> method: <span><kbd><span>currentBeetleCount</span><span> </span><span>=</span><span> </span><span>beetles</span><span>.</span><span>Length</span><span>;</span></kbd></span>. This will update the <kbd>currentBeetleCount</kbd> variable for each frame.</p>
</li>
</ol>
<p>You are now ready to test the game. Kill all your Cucumber Beetles to test the code changes you made. If something does not work correctly or you receive errors, please refer to the following updated <kbd>BeetleManager</kbd> script:</p>
<pre><span> <span>using</span><span> System</span><span>.</span><span>Collections</span><span>;</span><br/> <span>using</span><span> System</span><span>.</span><span>Collections</span><span>.</span><span>Generic</span><span>;</span><br/> <span>using</span><span> UnityEngine</span><span>;</span><br/> <span>using</span><span> UnityEngine</span><span>.</span><span>UI</span><span>;</span><br/> <br/> <span>public</span><span> </span><span>class</span><span> </span><span>BeetleManager</span><span> </span><span>:</span><span> </span><span>MonoBehaviour</span><span> </span><span>{</span><br/> <br/> <span>    </span><span>public</span><span> </span><span>static</span><span> </span><span>int</span><span> </span><span>currentBeetleCount</span><span>;</span><br/> <span>    </span><span>Text</span><span> </span><span>Beetle_Count</span><span>;</span><br/> <span>    </span><span>public</span><span> </span><span>GameObject</span><span>[]</span><span> </span><span>beetles</span><span>;</span><br/> <br/> <span>    </span><span>void</span><span> </span><span>Awake</span><span> </span><span>()</span><span> </span><span>{</span><br/> <br/> <span>        </span><span>Beetle_Count</span><span> </span><span>=</span><span> </span><span>GetComponent</span><span>&amp;lt;</span><span>Text</span><span>&gt;</span><span> </span><span>()</span><span>;</span><br/> <span>        </span><span>currentBeetleCount</span><span> </span><span>=</span><span> </span><span>1</span><span>;</span><br/> <span>    </span><span>}</span><br/> <br/> <span>    </span><span>void</span><span> </span><span>Update</span><span> </span><span>()</span><span> </span><span>{</span><br/> <br/> <span>        </span><span>beetles</span><span> </span><span>=</span><span> </span><span>GameObject</span><span>.</span><span>FindGameObjectsWithTag</span><span> </span><span>(</span><span>"</span><span>Beetle</span><span>"</span><span>)</span><span>;</span><br/> <span>        </span><span>Beetle_Count</span><span>.</span><span>text</span><span> </span><span>=</span><span> </span><span>beetles</span><span>.</span><span>Length</span><span>.</span><span>ToString</span><span>()</span><span>;</span><br/> <span>        </span><span>currentBeetleCount</span><span> </span><span>=</span><span> </span><span>beetles</span><span>.</span><span>Length</span><span>;</span><br/> <span>    </span><span>}</span><br/> <span>}</span></span> </pre>
<p>Now that the victory condition has been implemented, we are ready to implement our defeat conditions. We will do that in the next section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Implementing defeat</h1>
                </header>
            
            <article>
                
<p>There are two game conditions in which the player can lose the game. The first condition is if there are no cucumbers left in the game. The second condition is if all three lives are gone. Let's look at each of these defeat conditions separately.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Scripting defeat based on no cucumbers remaining</h1>
                </header>
            
            <article>
                
<p>Our <kbd>CucumberManager</kbd> script already keeps track of the number of cucumbers in the game, so we merely need to give that script's <kbd>currentCucumberCount</kbd> class variable the static modifier and then update our <kbd>VictoryManager</kbd> script. Here are the steps.</p>
<ol>
<li>
<p>Edit the <kbd>CucumberManager</kbd> script so the <kbd>currentCucumberCount</kbd> variable declaration is as follows:</p>
</li>
</ol>
<pre><span>      public static int currentCucumberCount;</span></pre>
<ol start="2">
<li>In the <kbd>Awake()</kbd> method, change <kbd>currentCucumberCount = 0;</kbd> to <kbd>currentCucumberCount = 1;</kbd>. This will help ensure the game does not think there are no cucumbers when the game starts.</li>
<li>Add the following statement at the end of the <kbd>Update()</kbd> method, <kbd>currentCucumberCount = cucumbers.Length;</kbd>. This will keep the counter updated in each frame.</li>
</ol>
<p>Those were the only changes needed for the <kbd>CucumberManager</kbd> script. Next, we will edit the <kbd>VictoryManager</kbd> script:</p>
<ol start="1">
<li>Edit the <kbd>VictoryManager</kbd> script by adding the <span><kbd><span>int</span><span> </span><span>cucumberCount</span><span>;</span></kbd></span> class variable.</li>
</ol>
<p> </p>
<ol start="2">
<li>Add the following lines of code to the bottom of the <kbd>Update()</kbd> method. These lines will continually check to see whether there are no cucumbers remaining and display the <span class="packt_screen">You Lost!</span> text when the count equals zero:</li>
</ol>
<pre><span> <span>        </span><span>cucumberCount</span><span> </span><span>=</span><span> </span><span>CucumberManager</span><span>.</span><span>currentCucumberCount</span><span>;</span><br/> <br/> <span>        </span><span>if</span><span> </span><span>(</span><span>cucumberCount</span><span> </span><span>==</span><span> </span><span>0</span><span>)</span><span> </span><span>{</span><br/> <span>            </span><span>Victory</span><span>.</span><span>text</span><span> </span><span>=</span><span> </span><span>(</span><span>"</span><span>You</span><span> </span><span>Lost</span><span>!</span><span>"</span><span>)</span><span>;</span><br/> <span>        </span><span>}</span></span> </pre>
<p>You are now ready to test this defeat condition. </p>
<div class="packt_tip">You can speed up your testing by deleting cucumbers from the <span class="packt_screen">Hierarchy</span> panel when in game mode. When you exit game mode, all deleted objects will be restored.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Scripting defeat for no lives remaining</h1>
                </header>
            
            <article>
                
<p>We will use the <kbd>CucumberManManager</kbd> script to keep track of the number of lives the Cucumber Man has remaining. Edit that script and make the following changes:</p>
<ol>
<li>Add the <span><kbd><span>public</span><span> </span><span>static</span><span> </span><span>int</span><span> </span><span>livesRemaining</span><span>;</span></kbd></span> class variable. We will use this variable to track the number of remaining lives.</li>
<li>Add the <span><kbd><span>public</span><span> </span><span>Animator</span><span> </span><span>anim</span><span>;</span></kbd></span> class variable. We will use this to play the Cucumber Man's death animation.</li>
<li><span>Add the </span><kbd>livesRemaining = 3;</kbd><span> statement to the bottom of the</span> <kbd>Awake()</kbd> <span>method.</span></li>
</ol>
<ol start="4">
<li>Add the following <kbd>if</kbd> statement block to the bottom of the <kbd>Update()</kbd> method:</li>
</ol>
<pre><span> <span>        </span><span>if</span><span> </span><span>(</span><span>livesRemaining</span><span> </span><span>==</span><span> </span><span>0</span><span>)</span><span> </span><span>{</span><br/> <span>            anim = GetComponent&amp;lt;Animator&gt; ();<br/>             anim.Play ("CM_Die");</span> <br/> <span>        </span><span>}</span></span> </pre>
<p>As you can see in the changes to our <kbd>Update()</kbd> method, we are simply checking the value of <kbd>livesRemaining</kbd> and, when no lives remain, we play the appropriate death animation.</p>
<p>You can test this defeat condition by following these steps:</p>
<ol>
<li>Remove the <kbd>static</kbd> modifier from the <kbd>public static int livesRemaining</kbd> statement</li>
<li>Put the game in game-mode</li>
<li>In the <span class="packt_screen">Hierarchy</span> panel, click the <kbd>CucumberMan</kbd> GameObject</li>
<li>In the <span class="packt_screen">Inspector</span> panel, scroll to the <span class="packt_screen">Cucumber Man Manager (Script)</span> component</li>
<li>Change the <span class="packt_screen">Lives Remaining</span> to <kbd>0</kbd> (zero). See the following screenshot for details:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="91" width="361" src="assets/be498c7e-b996-4414-9e47-4ae6bc0055c2.png"/></div>
<ol start="6">
<li>When your testing is complete, put the <kbd>static</kbd> modifier back into the statement from step 1</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Updating the HUD with lives remaining</h1>
                </header>
            
            <article>
                
<p>In the previous section, we modified the <kbd>CucumberManManager</kbd> script to track the number of lives our player has remaining and, when none were left, the appropriate animation was played. In this section, we will continue modifying the <kbd>CucumberManManager</kbd> script to update the HUD with the number of lives remaining.</p>
<p>We only need to modify the <kbd>CucumberManManager</kbd> script's <kbd>Update()</kbd> method. The completed <kbd>Update()</kbd> method is provided here with an explanation of the changes made:</p>
<pre><span> <span>    </span><span>void</span><span> </span><span>Update</span><span> </span><span>()</span><span> </span><span>{</span><br/> <br/> <span>        </span><span>if</span><span> </span><span>(</span><span>collectingCherries</span><span>)</span><span> </span><span>{</span><br/> <span>            </span><span>if</span><span> </span><span>(</span><span>tempCurrentCherryCount</span><span> </span><span>&gt;&lt;/span&gt;<span>=</span><span> </span><span>60</span><span>)</span><span> </span><span>{</span><br/> <span>                </span><span>currentCherryCount</span><span> </span><span>=</span><span> </span><span>currentCherryCount</span><span> </span><span>+</span><span> </span><span>1</span><span>;</span><br/> <span>                </span><span>tempCurrentCherryCount</span><span> </span><span>=</span><span> </span><span>0</span><span>;</span><br/> <br/> <span>                </span><span>_ptsManager</span><span> </span><span>=</span><span> </span><span>GameObject</span><span>.</span><span>Find</span><span> <br/></span><span>                 (</span><span>"</span><span>Score_Value</span><span>"</span><span>)</span><span>.</span><span>GetComponent</span><span>&amp;lt;</span><span>PointsManager</span><span>&gt;()</span><span>;</span><br/> <span>                </span><span>PointsManager</span><span>.</span><span>currentScore</span><span> </span><span>=</span><span> <br/></span><span>                 PointsManager</span><span>.</span><span>currentScore</span><span> </span><span>+</span><span> </span><span>5</span><span>;</span><br/> <br/> <span>            </span><span>}</span><span> </span><span>else</span><span> </span><span>{</span><br/> <span>                </span><span>tempCurrentCherryCount</span><span> </span><span>=</span><span> </span><span>tempCurrentCherryCount</span><span> </span><span>+</span><span> </span><span>1</span><span>;</span><br/> <span>            </span><span>}</span><br/> <span>        </span><span>}</span><br/> <span>            </span><br/> <span>        </span><span>if</span><span> </span><span>(</span><span>livesRemaining</span><span> </span><span>==</span><span> </span><span>2</span><span>)</span><span> </span><span>{</span><br/> <span>            </span><span>Destroy</span><span> </span><span>(</span><span>GameObject</span><span>.</span><span>Find</span><span> </span><span>(</span><span>"</span><span>Life3</span><span>"</span><span>))</span><span>;</span><br/> <span>        </span><span>}</span><br/> <span>        </span><span>if</span><span> </span><span>(</span><span>livesRemaining</span><span> </span><span>==</span><span> </span><span>1</span><span>)</span><span> </span><span>{</span><br/> <span>            </span><span>Destroy</span><span> </span><span>(</span><span>GameObject</span><span>.</span><span>Find</span><span> </span><span>(</span><span>"</span><span>Life2</span><span>"</span><span>))</span><span>;</span><br/> <span>        </span><span>}</span><br/> <span>        </span><span>if</span><span> </span><span>(</span><span>livesRemaining</span><span> </span><span>==</span><span> </span><span>0</span><span>)</span><span> </span><span>{</span><br/> <span>            </span><span>Destroy</span><span> </span><span>(</span><span>GameObject</span><span>.</span><span>Find</span><span> </span><span>(</span><span>"</span><span>Life1</span><span>"</span><span>))</span><span>;</span><br/> <span>            anim = GetComponent&amp;lt;Animator&gt; ();<br/>             anim.Play ("CM_Die");</span> <br/> <span>        </span><span>}</span><br/> <span>    </span><span>}</span></span> </span></pre>
<p>We added conditional statements to check for the number of lives remaining. When two are left, we destroy the third life image. We destroy the second one when only one life remains, and destroy the first life image when no life remains. We used the <kbd>Destroy()</kbd> method to accomplish this. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Scripting the player character's respawning </h1>
                </header>
            
            <article>
                
<p>In the previous section, we modified the <kbd>CucumberManManager</kbd> script to track how many lives remain and to destroy the UI image elements as appropriate. In this section, we will modify that script to accomplish the following when a life is lost:</p>
<ul>
<li>Play the die animation</li>
<li>Respawn the player on a respawn pad</li>
</ul>
<p>Let's start by modifying the <kbd>CucumberManManager</kbd> script:</p>
<ol>
<li>Add the following class variables:</li>
</ol>
<pre><span> <span>    </span><span>public</span><span> </span><span>Transform</span><span> </span><span>SpawnPad1</span><span>;</span><br/> <span>    </span><span>public</span><span> </span><span>Transform</span><span> </span><span>SpawnPad2</span><span>;</span><br/> <span>    </span><span>public</span><span> </span><span>Transform</span><span> </span><span>SpawnPad3</span><span>;</span></span></pre>
<ol start="2">
<li>In the <span class="packt_screen">Hierarchy</span> panel, select the <kbd>CucumberMan</kbd> GameObject and, in the <span class="packt_screen">Inspector</span> panel, scroll until you locate the <span class="packt_screen">Cucumber Man Manager (Script)</span> component.</li>
<li>Drag <kbd>SpawnPad1</kbd>, <kbd>SpawnPad2</kbd>, and <kbd>SpawnPad3</kbd> from the <span class="packt_screen">Hierarchy</span> view to the designated spots in the <span class="packt_screen">Inspector</span> panel. See the following for details:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="122" width="330" src="assets/6b9033e5-038d-4ba4-97d4-590066db7680.png"/></div>
<ol start="4">
<li>Modify the bottom section of the <kbd>Update()</kbd> method, as shown here:</li>
</ol>
<pre> <span> <span>       </span><span>if</span><span> </span><span>(</span><span>livesRemaining</span><span> </span><span>==</span><span> </span><span>2</span><span>)</span><span> </span><span>{</span><br/> <span>            </span><span>Destroy</span><span> </span><span>(</span><span>GameObject</span><span>.</span><span>Find</span><span> </span><span>(</span><span>"</span><span>Life3</span><span>"</span><span>))</span><span>;</span><br/> <span>            </span><span>anim</span><span> </span><span>=</span><span> </span><span>GetComponent</span><span>&amp;lt;</span><span>Animator</span><span>&gt;</span><span> </span><span>()</span><span>;</span><br/> <span>            </span><span>anim</span><span>.</span><span>Play</span><span> </span><span>(</span><span>"</span><span>CM_Die</span><span>"</span><span>)</span><span>;</span><br/> <br/> <span>            </span><span>StartCoroutine</span><span> </span><span>(</span><span>"</span><span>ReSpawnCucumberMan</span><span>"</span><span>)</span><span>;</span><br/> <span>        </span><span>}<br/></span><br/> <span>        </span><span>if</span><span> </span><span>(</span><span>livesRemaining</span><span> </span><span>==</span><span> </span><span>1</span><span>)</span><span> </span><span>{</span><br/> <span>            </span><span>Destroy</span><span> </span><span>(</span><span>GameObject</span><span>.</span><span>Find</span><span> </span><span>(</span><span>"</span><span>Life2</span><span>"</span><span>))</span><span>;</span><br/> <span>            </span><span>anim</span><span> </span><span>=</span><span> </span><span>GetComponent</span><span>&amp;lt;</span><span>Animator</span><span>&gt;</span><span> </span><span>()</span><span>;</span><br/> <span>            </span><span>anim</span><span>.</span><span>Play</span><span> </span><span>(</span><span>"</span><span>CM_Die</span><span>"</span><span>)</span><span>;</span><br/> <br/> <span>            </span><span>StartCoroutine</span><span> </span><span>(</span><span>"</span><span>ReSpawnCucumberMan</span><span>"</span><span>)</span><span>;</span><br/> <span>        </span><span>}</span><br/><br/> <span>        </span><span>if</span><span> </span><span>(</span><span>livesRemaining</span><span> </span><span>==</span><span> </span><span>0</span><span>)</span><span> </span><span>{</span><br/> <span>            </span><span>Destroy</span><span> </span><span>(</span><span>GameObject</span><span>.</span><span>Find</span><span> </span><span>(</span><span>"</span><span>Life1</span><span>"</span><span>))</span><span>;</span><br/> <span>            </span><span>anim</span><span> </span><span>=</span><span> </span><span>GetComponent</span><span>&amp;lt;</span><span>Animator</span><span>&gt;</span><span> </span><span>()</span><span>;</span><br/> <span>            </span><span>anim</span><span>.</span><span>Play</span><span> </span><span>(</span><span>"</span><span>CM_Die</span><span>"</span><span>)</span><span>;</span><br/> <span>        </span><span>}</span></span> </pre>
<p>Reviewing the preceding code reveals that there are three conditions being checked based on the value of the <kbd>livesRemaining</kbd> variable. In each case, the appropriate UI image component is removed from the HUD, and we play the <kbd>CM_Die</kbd> animation. For the first two cases (<kbd>livesRemaining</kbd> equals two or one), we have a <kbd>StartCoroutine("RespawnCucumberMan");</kbd> method call. We will write that method next:</p>
<ol start="1">
<li>Write the <kbd>ReSpawnCucumberMan()</kbd> method. Enter the following code after the <kbd>OnTriggerEnter()</kbd> methods in the <kbd>CucumberManManager</kbd> class:</li>
</ol>
<pre><span> <span>    </span><span>IEnumerator</span><span> </span><span>ReSpawnCucumberMan</span><span>()</span><span> </span><span>{</span><br/> <br/> <span>        </span><span>int</span><span> </span><span>randomNumber</span><span> </span><span>=</span><span> </span><span>Random</span><span>.</span><span>Range</span><span> </span><span>(</span><span>1</span><span>,</span><span> </span><span>4</span><span>)</span><span>;</span><br/><br/> <span>        </span><span>if</span><span> </span><span>(</span><span>randomNumber</span><span> </span><span>==</span><span> </span><span>1</span><span>)</span><span> </span><span>{</span><br/> <span>            </span><span>yield</span><span> </span><span>return</span><span> </span><span>new</span><span> </span><span>WaitForSecondsRealtime</span><span> </span><span>(</span><span>4</span><span>)</span><span>;</span><br/> <span>            </span><span>this</span><span>.</span><span>transform</span><span>.</span><span>position</span><span> </span><span>=</span><span> </span><span>SpawnPad1</span><span>.</span><span>transform</span><span>.</span><span>position</span><span>;</span><br/> <span>        </span><span>}</span><span> </span><span>else</span><span> </span><span>if</span><span> </span><span>(</span><span>randomNumber</span><span> </span><span>==</span><span> </span><span>2</span><span>)</span><span> </span><span>{</span><br/> <span>            </span><span>yield</span><span> </span><span>return</span><span> </span><span>new</span><span> </span><span>WaitForSecondsRealtime</span><span> </span><span>(</span><span>4</span><span>)</span><span>;</span><br/> <span>            </span><span>this</span><span>.</span><span>transform</span><span>.</span><span>position</span><span> </span><span>=</span><span> </span><span>SpawnPad2</span><span>.</span><span>transform</span><span>.</span><span>position</span><span>;</span><br/> <span>        </span><span>}</span><span> </span><span>else</span><span> </span><span>{</span><br/> <span>            </span><span>yield</span><span> </span><span>return</span><span> </span><span>new</span><span> </span><span>WaitForSecondsRealtime</span><span> </span><span>(</span><span>4</span><span>)</span><span>;</span><br/> <span>            </span><span>this</span><span>.</span><span>transform</span><span>.</span><span>position</span><span> </span><span>=</span><span> </span><span>SpawnPad3</span><span>.</span><span>transform</span><span>.</span><span>position</span><span>;</span><br/> <span>        </span><span>}</span><br/> <span>            </span><br/> <span>        </span><span>anim</span><span>.</span><span>Play</span><span> </span><span>(</span><span>"</span><span>CM_Idle</span><span>"</span><span>)</span><span>;</span><br/> <span>    </span><span>}</span></span></pre>
<p>Our <kbd>ReSpawnCucumberMan()</kbd> method starts by obtaining a random number of <kbd>1</kbd>, <kbd>2</kbd>, or <kbd>3</kbd>. We then check to see which random number was generated, and branch appropriately. We have a four-second delay in order for the die animation to complete. We then respawn the Cucumber Man to the spawn pad corresponding with the randomly generated number. Lastly, we play the idle animation.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we designed and scripted our game's victory and defeat conditions. We updated our game's scripts to manage the Cucumber Man's health, including updating the HUD's health bar. We implemented our victory and end-of-game logic through scripting. We also implemented the lives remaining and the onscreen indicators of those lives. Lastly, we scripted the respawning of our player character.</p>
<p>In the next chapter, we will plan and implement audio and visual effects in our game to help enhance overall game play. Specifically, we will add audio to key events in our combat system and add several special effects using Unity's particle system to add to the game's visual appeal.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    </body></html>