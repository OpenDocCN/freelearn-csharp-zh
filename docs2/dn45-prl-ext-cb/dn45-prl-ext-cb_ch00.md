# 前言

多核处理器的繁荣正在全面展开。现在很难找到没有至少两个处理器核心的服务器、台式机或笔记本电脑。市场上甚至有几种双核手机型号。

然而，为了充分发挥现代多核处理器的威力，开发者需要能够有效地识别并行化的机会并编写并行代码。

由于创建和管理经典线程的生命周期非常复杂，因此并行编码并不是大多数开发者常规实践的内容。

为了帮助简化编写并行代码的复杂性，微软在 .NET 框架中引入了并行扩展。并行扩展或任务并行库帮助我们以自然的方式编写高效的、可扩展的并行代码，而无需直接处理经典的线程模型或线程池。使用这些扩展，我们可以方便地编写现有顺序代码的并行版本，这些版本可以自动利用所有可用的处理器，从而提供显著的性能提升。

本书从前往后全面覆盖了 .Net 4.5 并行扩展的主要类，并将为没有多线程开发经验的开发者提供编写高度可扩展的异步应用程序的能力，这些应用程序可以利用当今的硬件。

# 本书涵盖的内容

第一章, *使用任务并行库入门*，探讨了创建和启动任务、取消任务、处理任务中的异常以及控制任务行为的各种方法。.NET 并行扩展的核心是 System.Threading.Task 类。

第二章, *实现延续*，帮助我们学习如何创建任务延续和子任务。我们还将学习如何控制延续运行的条件，如何使用延续处理异常，以及如何将任务和延续链起来形成管道模式。在异步编程中，一个异步操作调用另一个操作并将数据传递给它是非常常见的。

第三章, *使用并行循环学习并发*，帮助我们学习如何使用并行循环并行处理大量数据。我们还将学习如何控制循环的并行度，跳出循环，并为循环处理分区源数据。

第四章, *并行 LINQ*，帮助我们学习如何创建并行 LINQ 查询，控制查询选项，如结果合并和查询的并行度。并行 LINQ 是 LINQ to Objects 的并行实现。

第五章，*并发集合*，帮助我们了解如何将并发集合用作生产者-消费者模式中的数据缓冲区，如何向自定义集合添加阻塞和边界，以及如何使用多个并发集合来形成管道。.NET Framework 4.5 中的并发集合允许开发者创建类型安全和线程安全的集合。

第六章，*同步原语*，帮助我们了解.NET Framework 中可用的同步原语，以及如何使用新的轻量级同步原语。并行应用程序通常需要管理对某种共享数据的访问。

第七章，*分析和调试*，帮助我们检查 Visual Studio 2012 中内置的并行调试和分析工具，以及如何使用它们来调试和优化我们的并行应用程序。

第八章，*异步*，帮助我们了解.NET Framework 的异步功能，以及如何使用异步来保持响应式 UI。我们都见过客户端应用程序由于同步代码长时间占用单个 UI 线程而无法响应用户鼠标事件或更新显示的情况。

第九章，*数据流库*，帮助我们检查 Microsoft 提供的各种数据流块类型，以及如何使用它们来形成一个数据处理管道。任务并行库的数据流库是一组新类，旨在通过使用异步消息传递和管道化来提高高度并发应用程序的鲁棒性，从而比手动线程化获得更多控制和更好的性能。

# 您需要为本书准备什么

本书假设您在通用 C#开发方面有坚实的基础。您应该至少具备 lambda 表达式和委托的实用知识。您需要一个 Windows 7、Windows 8 或 Windows Server 2008 R2 PC。不需要多核或多处理器机器，但更佳。此外，您还需要 Visual Studio 2012 和.NET Framework 4.5。

# 本书面向对象

本书旨在帮助经验丰富的 C#开发者编写利用现代多核处理器能力的应用程序。它为经验丰富的 C#开发者提供了与.NET 并行扩展一起工作的必要知识。编写多线程应用程序的先前经验不是必需的。

# 习惯用法

在本书中，您将找到许多不同风格的文本，以区分不同类型的信息。以下是一些这些风格的示例及其含义的解释。

文本中的代码词如下所示：“在本菜谱中，我们将探讨向`BlockingCollection`添加项目和从`BlockingCollection`中删除项目的基本知识。”

代码块设置如下：

```cs
char[] delimiters = { ' ', ',', '.', ';', ':', '-', '_', '/', '\u000A' };
const string headerText = "Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; Trident/6.0)";
```

当我们希望引起您对代码块中特定部分的注意时，相关的行或项目将以粗体显示：

```cs
var result = Enumerable.Range(0, 10000).AsParallel()
        .WithExecutionMode(ParallelExecutionMode.ForceParallelism)
 .WithDegreeOfParallelism(2)
        …
        .Select((x, i) => i)
        .ToArray();                       
```

**新术语**和**重要词汇**以粗体显示。您在屏幕上看到的单词，例如在菜单或对话框中，在文本中显示如下：“点击**下一步**按钮将您移动到下一屏幕”。

### 注意

警告或重要提示以这种方式出现在框中。

### 小贴士

小贴士和技巧看起来像这样。

# 读者反馈

我们始终欢迎读者的反馈。请告诉我们您对这本书的看法——您喜欢什么或可能不喜欢什么。读者的反馈对我们开发您真正能从中受益的标题非常重要。

要向我们发送一般反馈，只需发送电子邮件到 `<[feedback@packtpub.com>`，并在邮件主题中提及书籍标题。

如果您在某个主题上具有专业知识，并且您对撰写或为书籍做出贡献感兴趣，请参阅我们的作者指南[www.packtpub.com/authors](http://www.packtpub.com/authors)。

# 客户支持

现在您是 Packt 书籍的骄傲拥有者，我们有一些事情可以帮助您从您的购买中获得最大收益。

## 下载示例代码

您可以从[`www.packtpub.com`](http://www.packtpub.com)下载您购买的所有 Packt 书籍的示例代码文件。如果您在其他地方购买了这本书，您可以访问[`www.packtpub.com/support`](http://www.packtpub.com/support)并注册，以便将文件直接通过电子邮件发送给您。

## 勘误

尽管我们已经尽一切努力确保内容的准确性，但错误仍然可能发生。如果您在我们的书中发现错误——可能是文本或代码中的错误——如果您能向我们报告这一点，我们将不胜感激。通过这样做，您可以避免其他读者的挫败感，并帮助我们改进本书的后续版本。如果您发现任何勘误，请通过访问[`www.packtpub.com/submit-errata`](http://www.packtpub.com/submit-errata)来报告它们，选择您的书籍，点击**勘误提交表单**链接，并输入您的勘误详情。一旦您的勘误得到验证，您的提交将被接受，勘误将被上传到我们的网站，或添加到该标题的勘误部分下的现有勘误列表中。任何现有勘误都可以通过从[`www.packtpub.com/support`](http://www.packtpub.com/support)选择您的标题来查看。

## 盗版

互联网上对版权材料的盗版是一个跨所有媒体的持续问题。在 Packt，我们非常重视我们版权和许可证的保护。如果您在互联网上发现我们作品的任何非法副本，无论形式如何，请立即提供位置地址或网站名称，以便我们可以追究补救措施。

请通过电子邮件联系 `<copyright@packtpub.com>` 并附上疑似盗版材料的链接。

我们感谢您在保护我们作者方面的帮助，以及我们为您提供有价值内容的能力。

## 问题和答案

如果您在本书的任何方面遇到问题，可以通过 `<questions@packtpub.com>` 联系我们，我们将尽力解决。
