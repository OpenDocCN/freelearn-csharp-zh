<html><head></head><body>
<div><h1 class="chapter-number" id="_idParaDest-68"><a id="_idTextAnchor250"/>3</h1>
<h1 id="_idParaDest-69"><a id="_idTextAnchor251"/>Converting a Xamarin.Forms App into .NET MAUI</h1>
<p>Before we dive too far into .NET MAUI, we will look back at an existing Xamarin.Forms app and convert it into .NET MAUI. This chapter will guide you through the steps to convert an existing Xamarin.Forms app running on Mono into a .NET MAUI app running on .NET 7. We will discuss two different methods for converting your Xamarin.Forms application into .NET MAUI. The first method will use a new .NET MAUI project and move our old Xamarin.Forms code into the new project. The second method will use the <strong class="bold">.NET Upgrade Assistant</strong> tool to do some of the upgrades for us.</p>
<p>If you are new to .NET MAUI and are not coming from Xamarin.Forms app development, feel free to skip this chapter and go straight to the next project.</p>
<p>The following topics will be covered in this chapter:</p>
<ul>
<li>Moving code to a new .NET MAUI project</li>
<li>An overview of upgrading a Xamarin.Forms app</li>
<li>Installing and running .NET Upgrade Assistant</li>
</ul>
<h1 id="_idParaDest-70"><a id="_idTextAnchor252"/><a id="_idTextAnchor253"/>Technical requirements</h1>
<p>To complete this project, you need to have Visual Studio installed on your <strong class="bold">Macintosh</strong> (<strong class="bold">Mac</strong>) or PC, as well as the .NET Mobile components. Refer to <em class="italic">Chapter 1</em>, <em class="italic">Introduction to .NET MAUI</em>, for more details on how to set up your environment.<a id="_idTextAnchor254"/> There are additional components that will be installed in this chapter, so you will need an internet connection to download and install .NET Upgrade Assistant. This chapter provides screenshots and instructions for Visual Studio on Windows.</p>
<p>This chapter will both be a classic <strong class="bold">File</strong> | <strong class="bold">New</strong> | <strong class="bold">Project</strong> chapter and use an existing app, guiding you step by step through the process of migrating an app from Xamarin.Forms to .NET MAUI. For the second app, you will need to download the source from this book’s GitHub repository.</p>
<p>You can find the full source for the code in this chapter at <a href="https://github.com/PacktPublishing/MAUI-Projects-3rd-Edition">https://github.com/PacktPublishing/MAUI-Projects-3rd-Edition</a> under the <code>Chapter03</code> folder.</p>
<h1 id="_idParaDest-71"><a id="_idTextAnchor255"/>Project overview</h1>
<p>This chapter is not meant to be an exhaustive tome of all the things you need to be aware of when converting your <a id="_idIndexMarker350"/>Xamarin.Forms app into .NET MAUI. Rather, it is an overview of what you need to consider when migrating your app, along with two walk-throughs of methods to accomplish that task. There are too many variations in application styles, versions, frameworks, custom controls, and so on for this one chapter to cover every scenario. That could take an entire book and would most likely be outdated by the time it was published. So, in this chapter, we are<a id="_idIndexMarker351"/> going to focus on a simple migration method that has the benefit of using the .NET MAUI Single Project feature and .NET Migration Assistant, which will automate much of the manual stuff and is constantly being updated.</p>
<p>The first part of this chapter will use a new Xamarin.Forms app created from the Shell template. The second part of this chapter will use .NET Upgrade Assistant to upgrade the open source app, BuildChat, which is available on GitHub at <a href="https://github.com/mindofai/Build2019Chat">https://github.com/mindofai/Build2019Chat</a>.</p>
<p>Every development book needs to have a chat app; this book is no different. For .NET Migration Assistant, we will use an existing chat app that was built using Xamarin.Forms. The app can be debugged and tested locally, so there is no need to set up and configure any cloud services.</p>
<p>The build time for this project is about one hour.</p>
<h1 id="_idParaDest-72"><a id="_idTextAnchor256"/>Migrating into a blank .NET MAUI template</h1>
<p>This method of moving your existing app <a id="_idIndexMarker352"/>code into a new .NET MAUI app is used mainly for smaller, simpler apps that do not have a lot of external dependencies, such as NuGet, or native libraries. The largest benefit of this method is that your migrated app will be in a single project, targeting all the .NET MAUI-supported platforms. If your original app only targeted Android and iOS, using this method could get you Mac Catalyst and Windows targets for free. Using .NET Upgrade Assistant will not add any platforms that you didn’t already target.</p>
<p>To illustrate these steps, we will create a new project, just like we did in <em class="italic">Chapter 2</em>. This time, however, we will have to <a id="_idIndexMarker353"/>create a Xamarin.Forms project first.</p>
<h2 id="_idParaDest-73"><a id="_idTextAnchor257"/>Creating a new Xamarin.Forms app</h2>
<p>The following steps will guide you through <a id="_idIndexMarker354"/>creating a new <a id="_idIndexMarker355"/>Xamarin.Forms project:</p>
<ol>
<li>Open Visual Studio 2022 and select <strong class="bold">Create a </strong><strong class="bold">new project</strong>:</li>
</ol>
<div><div><img alt="Figure 3.1 – Visual Studio 2022" src="img/B19214_03_1.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.1 – Visual Studio 2022</p>
<p class="list-inset">This will open the <strong class="bold">Create a new </strong><strong class="bold">project</strong> wizard.</p>
<ol>
<li value="2">In the search field, type <code>Xamarin.Forms</code> and select the <strong class="bold">Mobile App (Xamarin.Forms)</strong> item<a id="_idIndexMarker356"/> from the list:</li>
</ol>
<div><div><img alt="Figure 3.2 – New Xamarin.Forms project" src="img/B19214_03_2.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.2 – New Xamarin.Forms project</p>
<ol>
<li value="3">Complete the next <a id="_idIndexMarker357"/>page of the wizard by naming your project <code>MauiMigration</code>, and then click <strong class="bold">Next</strong>:</li>
</ol>
<div><div><img alt="Figure 3.3 – Configuring the Xamarin.Forms project" src="img/B19214_03_3.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.3 – Configuring the Xamarin.Forms project</p>
<ol>
<li value="4">Select the <strong class="bold">Flyout</strong> template and <a id="_idIndexMarker358"/>ensure that all <a id="_idIndexMarker359"/>three Xamarin.Forms platforms are checked:</li>
</ol>
<div><div><img alt="Figure 3.4 – Selecting the Xamarin.Forms template and platforms" src="img/B19214_03_4.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.4 – Selecting the Xamarin.Forms template and platforms</p>
<p class="list-inset">You may receive a few messages about out-of-support components. These are expected if this is the<a id="_idIndexMarker360"/> first time you are creating a Xamarin.Forms app and can be safely ignored.</p>
<ol>
<li value="5">Finalize the setup by <a id="_idIndexMarker361"/>clicking <strong class="bold">Create</strong> and wait for Visual Studio to create the project.<p class="list-inset">Before we begin to migrate this app, it’s a good idea to make sure it works properly.</p></li>
<li>Run the app and test out all the buttons, flyout options, and menus.<p class="list-inset">On the <strong class="bold">About</strong> page, there is a <strong class="bold">Learn more</strong> button that will open a browser and navigate you to the Xamarin.Forms quickstart web page:</p></li>
</ol>
<div><div><img alt="Figure 3.5 – The Learn ﻿more button" src="img/B19214_03_5.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.5 – The Learn more button</p>
<ol>
<li value="7">The flyout menu has<a id="_idIndexMarker362"/> three options: <strong class="bold">About</strong>, <strong class="bold">Browse</strong>, and <strong class="bold">Logout</strong>. Ensure you click on each one and explore all their functionality:</li>
</ol>
<div><div><img alt="Figure 3.6 – Flyout menu options" src="img/B19214_03_6.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.6 – Flyout menu options</p>
<p>Now that we have <a id="_idIndexMarker363"/>explored this Xamarin.Forms app, let’s move on to creating the new .NET MAUI project, which will act as our new app.</p>
<h2 id="_idParaDest-74"><a id="_idTextAnchor258"/>Creating a new .NET MAUI app</h2>
<p>We will add a new project to the current solution to<a id="_idIndexMarker364"/> make things easier. To create a new .NET MAUI project, follow these <a id="_idIndexMarker365"/>steps:</p>
<ol>
<li>In Visual Studio, right-click the <code>MauiMigration</code> solution item in <strong class="bold">Solution Explorer</strong> and select <strong class="bold">File</strong> | <strong class="bold">Add</strong> | <strong class="bold">New Project</strong>:</li>
</ol>
<div><div><img alt="Figure 3.7 – Adding a new project to solution" src="img/B19214_03_7.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.7 – Adding a new project to solution</p>
<ol>
<li value="2">In<a id="_idIndexMarker366"/> the <strong class="bold">Add a new project</strong> dialog, select <strong class="bold">.NET MAUI App</strong> and<a id="_idIndexMarker367"/> click <strong class="bold">Next</strong>:</li>
</ol>
<div><div><img alt="Figure 3.8 – Adding a new .NET MAUI project" src="img/B19214_03_8.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.8 – Adding a new .NET MAUI project</p>
<ol>
<li value="3">In the <code>MyMauiApp</code> and click <strong class="bold">Next</strong>:</li>
</ol>
<div><div><img alt="Figure 3.9 – Configuring the .NET MAUI project" src="img/B19214_03_9.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.9 – Configuring the .NET MAUI project</p>
<ol>
<li value="4">In the <strong class="bold">Additional Information</strong> dialog, ensure that the selected framework is <strong class="bold">.NET 7.0 (Standard Term Support)</strong> and click <strong class="bold">Create</strong>.</li>
</ol>
<p>Now that we have the shell of the .NET <a id="_idIndexMarker370"/>MAUI app, we can start moving the important parts of the Xamarin.Forms app <a id="_idIndexMarker371"/>over to the .NET MAUI project.</p>
<h2 id="_idParaDest-75"><a id="_idTextAnchor259"/>Migrating the MauiMigration app to MyMauiApp</h2>
<p>Migrating a Xamarin.Forms app into a<a id="_idIndexMarker372"/> blank new .NET MAUI template will involve the following high-level steps:</p>
<ol>
<li>Copy your app files into the<a id="_idIndexMarker373"/> new template.</li>
<li>Change the Xamarin.Forms namespace to its .NET MAUI equivalent.</li>
<li>Update the app startup so that it uses your views.</li>
</ol>
<p>The next few sections will explain<a id="_idIndexMarker374"/> how to accomplish these steps.</p>
<h3>Copying files to a new project</h3>
<p>To begin, let’s copy the<a id="_idIndexMarker375"/> XAML and C# files and folders from the Xamarin.Forms project to the .NET MAUI project. In the <code>MauiMigration</code> project, select the <code>Models</code>, <code>Services</code>, <code>ViewModels</code>, and <code>Views</code> folders. We will copy these files instead of moving them so that we don’t destroy the original project. Right-click any of the selected folders and select <code>MauiApp</code> project and click <strong class="bold">Paste</strong>.</p>
<p>A few images are also needed; we will copy them from the <code>MauiMigration.UWP</code> project. Under the <code>MauiMigration.UWP</code> project, you will find three image files called <code>icon_about.png</code>, <code>icon_feed.png</code>, and <code>xamarin_logo.png</code>. Select all three files and copy them just like you did for the previous files. Paste the files into the <code>MyMauiApp/Resources/Images</code> folder.</p>
<p>Visual Studio may make some changes to your project file when you copy/paste files, such as adding new item groups that remove and add the same file to the project. You can safely remove these changes as the single project system knows how to handle <code>XAML</code> and <code>.png</code> files. If you get compilation errors related to missing images or errors in the <code>XAML</code> files, check <code>MyMAuiApp.csproj</code> for any additional <code>ItemGroups</code> that reference either the <code>.png</code> files or <code>XAML</code> files and remove them.</p>
<p>The following screenshot shows an example of the <code>MyMauiApp.csproj</code> file after copying the images from <code>MauiMigration.UWP</code>. <em class="italic">Figure 3</em><em class="italic">.10</em> shows the changes that Visual Studio added; these can be removed:</p>
<div><div><img alt="Figure 3.10 – Visual Studio added unnecessary items" src="img/B19214_03_10.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.10 – Visual Studio added unnecessary items</p>
<p>Next, we will need to<a id="_idIndexMarker376"/> update the <code>XAML</code> files so that they reference .NET MAUI controls.</p>
<h3>Updating namespaces</h3>
<p>Currently, the <code>XAML</code> files are<a id="_idIndexMarker377"/> still using the Xamarin.Forms namespace. To update these files, we need to change the following:</p>
<pre class="source-code">
</pre> <p>We must amend this like so:</p>
<pre class="source-code">
</pre> <p>You can use the <strong class="bold">Find and Replace</strong> feature in Visual Studio to make these changes or manually edit each file. To use the <strong class="bold">Find and Replace</strong> dialog, follow these steps:</p>
<ol>
<li>In <code>MyMauiApp</code> project.</li>
<li>From the Visual Studio menu select <strong class="bold">Edit</strong> | <strong class="bold">Find and Replace</strong> | <strong class="bold">Replace in Files</strong> (or <em class="italic">Ctrl</em> + <em class="italic">Shift</em> + <em class="italic">H</em>) to open the <strong class="bold">Find and </strong><strong class="bold">Replace</strong> dialog:</li>
</ol>
<div><div><img alt="Figure 3.11 – The Find and Replace dialog﻿" src="img/B19214_03_11.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.11 – The Find and Replace dialog</p>
<ol>
<li value="3">In the <strong class="bold">Look in</strong> field, select <strong class="bold">Current project</strong>.</li>
<li>Click the <strong class="bold">Replace All</strong> button; there<a id="_idIndexMarker378"/> should only be five places to make that change.</li>
</ol>
<p>Once completed, there are a few other changes that need t<a id="_idTextAnchor260"/>o be made.</p>
<p>In the <code>NewItemPage.xaml</code> file, in the <code>Views</code> folder of the <code>MyMauiApp</code> project, remove the following highlighted text:</p>
<pre class="source-code">
Title="New Item"
<strong class="bold"></strong>
<code>XAML</code> file namespace changes are complete, we can move on to the C# namespace changes.</p>
<p>Using the <strong class="bold">Find and Replace</strong> dialog again, we can remove all the Xamarin.Forms namespace references. This time, by using a regular expression, we can remove multiple lines. Use the following expression in the <strong class="bold">Find</strong> entry box:</p>
<pre class="source-code">
^using Xamarin\.[Forms,Essentials].*;</pre> <p>Then, check the <strong class="bold">Use regular expressions</strong> checkbox and select <strong class="bold">Current project</strong> for <strong class="bold">Look in</strong>, as shown here:</p>
<div><div><img alt="Figure 3.12 – Find and Replace – C# namespaces" src="img/B19214_03_12.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.12 – Find and Replace – C# namespaces</p>
<p>Most of the changes have<a id="_idIndexMarker379"/> been made, and the app should compile at this point. However, it is not using any of the code we have copied and modified as .NET MAUI Shell does not<a id="_idIndexMarker380"/> reference the copied pages. The next step is to hook Shell into our code.</p>
<h3>Modifying the app startup</h3>
<p>The <code>MyMauiApp</code> project is still using the default <code>MainPage.xaml</code> file as its startup page. The next step in our <a id="_idIndexMarker381"/>migration is to make the <code>AppShell.xaml</code> file the same as it is for our Xamarin.Forms app.</p>
<p>What we need to copy is in the <code>MauiMigration</code> project, in the <code>AppShell.xaml</code> file, starting at line 76 until line 101, as shown in the following code snippet:</p>
<pre class="source-code">
    &lt;!--
        When the Flyout is visible this defines the content to display in the flyout.
        FlyoutDisplayOptions="AsMultipleItems" will create a separate flyout item for each child element           https://docs.microsoft.com/dotnet/api/xamarin.forms.shellgroupitem.flyoutdisplayoptions?view=xamarin-forms
    --&gt;
    &lt;FlyoutItem Title="About" Icon="icon_about.png"&gt;
        &lt;ShellContent Route="AboutPage" ContentTemplate="{DataTemplate local:AboutPage}" /&gt;
    &lt;/FlyoutItem&gt;
    &lt;FlyoutItem Title="Browse" Icon="icon_feed.png"&gt;
        &lt;ShellContent Route="ItemsPage" ContentTemplate="{DataTemplate local:ItemsPage}" /&gt;
    &lt;/FlyoutItem&gt;
    &lt;!-- When the Flyout is visible this will be a menu item you can tie a click behavior to  --&gt;
    &lt;MenuItem Text="Logout" StyleClass="MenuItemLayoutStyle" Clicked="OnMenuItemClicked"&gt;
    &lt;/MenuItem&gt;
    &lt;!--
        TabBar lets you define content that won't show up in a flyout menu. When this content is active
        the flyout menu won't be available. This is useful for creating areas of the application where
        you don't want users to be able to navigate away from. If you would like to navigate to this
        content you can do so by calling
        await Shell.Current.GoToAsync("//LoginPage");
    --&gt;
    &lt;TabBar&gt;
        &lt;ShellContent Route="LoginPage" ContentTemplate="{DataTemplate local:LoginPage}" /&gt;
    &lt;/TabBar&gt;</pre> <p>Copy the preceding code and<a id="_idIndexMarker382"/> replace the following lines in the <code>MyMauiApp</code> project’s <code>AppShell.xaml</code> file:</p>
<pre class="source-code">
    &lt;ShellContent
        Title="Home"
        ContentTemplate="{DataTemplate local:MainPage}"
        Route="MainPage" /&gt;</pre> <p>To enable the flyout, you will need to remove the following highlighted text in <code>AppShell.xaml</code>:</p>
<pre class="source-code">
    
    <code>MauiProgram.cs</code> file and make the changes highlighted in the <a id="_idIndexMarker383"/>following code block:</p>
<pre class="source-code">
using Microsoft.Extensions.Logging;
<strong class="bold">using MauiMigration.Services;</strong>
<strong class="bold">using MauiMigration.Models;</strong>
namespace MyMauiApp
{
    public static class MauiProgram
    {
        public static MauiApp CreateMauiApp()
        {
            var builder = MauiApp.CreateBuilder();
            builder
                .UseMauiApp&lt;App&gt;()
                .ConfigureFonts(fonts =&gt;
                {
                    fonts.AddFont("OpenSans-Regular.ttf", "OpenSansRegular");
                    fonts.AddFont("OpenSans-Semibold.ttf", "OpenSansSemibold");
                });
            <strong class="bold">DependencyService.RegisterSingleton&lt;IDataStore&lt;Item&gt;&gt;(new MockDataStore());</strong>
#if DEBUG
        builder.Logging.AddDebug();
#endif
        return builder.Build();
        }
    }
}</pre> <p>At this point, you should be able to compile and run the converted project. Make sure you set <code>MyMauiApp</code> as the startup project before running. Play around with the app and make sure it is all working before <a id="_idIndexMarker384"/>moving on to the next section on manually migrating your apps to .NET MAUI.</p>
<h1 id="_idParaDest-76"><a id="_idTextAnchor261"/>Manual migration overview</h1>
<p>In the previous section, we converted a simple Xamarin.Forms app into .NET MAUI using the Single Project system. This project did not use any advanced features of Xamarin.Forms, such as external NuGets, custom controls, or any commercial controls. These are additional items that you will have to consider when migrating your apps from Xamarin.Forms to .NET MAUI.</p>
<p>In this section, we are going to discuss <a id="_idIndexMarker385"/>the basic flow that you should go through to migrate your Xamarin.Forms app to .NET MAUI. This is by no means an all-inclusive list; the .NET MAUI team is updating a wiki page that details all their knowledge in one location.</p>
<p class="callout-heading">Official migration guide</p>
<p class="callout">The guidelines for migrating your Xamarin.Forms apps to .NET MAUI are continually evolving since the release of .NET MAUI, based on usage and feedback. To review the latest guidelines, please visit the following URL in your favorite browser: <a href="https://learn.microsoft.com/en-us/dotnet/maui/get-started/migrate?view=net-maui-7.0">https://learn.microsoft.com/en-us/dotnet/maui/get-started/migrate?view=net-maui-7.0</a>.</p>
<p>When migrating your apps from Xamarin.Forms to .NET MAUI, you will need to follow the overall steps outlined <a id="_idIndexMarker386"/>here:</p>
<ol>
<li>Convert the Xamarin.Forms projects from .NET Framework into .NET SDK style.</li>
<li>Update the code from Xamarin.Forms to .NET MAUI.</li>
<li>Update any incompatible dependencies with .NET 6+ versions.</li>
<li>Address any breaking API changes.</li>
<li>Run the converted app and verify its functionality.</li>
</ol>
<p>.NET Upgrade Assistant is a tool that will attempt to perform the first four steps for you. However, before we dive into using .NET Upgrade Assistant, we are going to look at what each of these steps entails so that we have a firm understanding of how to migrate our app if .NET Upgrade Assistant is unable to operate on an app project.</p>
<h2 id="_idParaDest-77"><a id="_idTextAnchor262"/>Converting the Xamarin.Forms projects from .NET Framework into .NET SDK style</h2>
<p>Some Xamarin.Forms projects are based on the .NET Framework project template. It is a verbose project format that has been <a id="_idIndexMarker387"/>updated for .NET projects. The new format, typically referred to as the SDK style, is a much more concise format with better defaults. Xamarin.Forms projects created with Visual Studio 16.5 or later use the newer SDK format.</p>
<p>To convert an old format project file, such as the one we will be using with .NET Upgrade Assistant, in the <em class="italic">Installing and running .NET Upgrade Assistant</em> section later in this chapter, you would need to change the <code>&lt;Project /&gt;</code> element to the new SDK style, like this:</p>
<ol>
<li>Find a line like this in your project file:<pre class="source-code">
&lt;Project ToolsVersion="4.0" DefaultTargets="Build" &gt;</pre></li> <li>Replace it with the following:<pre class="source-code">
&lt;Project Sdk="Microsoft.NET.Sdk"&gt;</pre></li> </ol>
<p>Remember that you will have to make this change for all your Xamarin.Forms projects, platform-specific projects, and any shared library projects.</p>
<p>Let’s look at the specific changes that you might have to make for a typical Xamarin.Forms project that targets<a id="_idIndexMarker388"/> both Android and iOS.</p>
<p>To convert the shared library project of a Xamarin.Forms app into a .NET MAUI project, we need to replace the contents of the <code>csproj</code> file with the following:</p>
<pre class="source-code">
&lt;Project Sdk="Microsoft.NET.Sdk"&gt;
  &lt;PropertyGroup&gt;
    <strong class="bold">&lt;TargetFrameworks&gt;net7.0-ios;net7.0-android; &lt;/TargetFrameworks&gt;</strong>
<strong class="bold">    &lt;TargetFrameworks Condition="$([MSBuild]::IsOSPlatform</strong>
<strong class="bold">('windows'))"&gt;$(TargetFrameworks);net7.0-windows10.0.19041.0</strong>
<strong class="bold">&lt;/TargetFrameworks&gt;</strong>
    <strong class="bold">&lt;UseMaui&gt;True&lt;/UseMaui&gt;</strong>
    &lt;OutputType&gt;Library&lt;/OutputType&gt;
    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
    &lt;!-- Required for C# Hot Reload --&gt;
    &lt;UseInterpreter Condition="'$(Configuration)' == 'Debug'"&gt;True&lt;/UseInterpreter&gt;
    <strong class="bold">&lt;SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$</strong>
<strong class="bold">(TargetFramework)')) == 'ios'"&gt;14.2&lt;/SupportedOSPlatformVersion&gt;</strong>
<strong class="bold">    &lt;SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$</strong>
<strong class="bold">(TargetFramework)')) == 'android'"&gt;21.0&lt;/SupportedOSPlatformVersion&gt;</strong>
<strong class="bold">    &lt;SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$</strong>
<strong class="bold">(TargetFramework)')) == 'windows'"&gt;10.0.17763.0&lt;/SupportedOS</strong>
<strong class="bold">PlatformVersion&gt;</strong>
<strong class="bold">    &lt;TargetPlatformMinVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$</strong>
<strong class="bold">(TargetFramework)')) == 'windows'"&gt;10.0.17763.0&lt;/Target</strong>
<strong class="bold">PlatformMinVersion&gt;</strong>
  &lt;/PropertyGroup&gt;
&lt;/Project&gt;</pre> <p>The important bits are highlighted. <code>&lt;UseMaui&gt;True&lt;/UseMaui&gt;</code> will enable the project system to automatically add the correct <a id="_idIndexMarker389"/>references to the project for .NET MAUI libraries. The <code>&lt;TargetFrameworks&gt;</code> elements are updated<a id="_idIndexMarker390"/> for the correct <strong class="bold">Target Framework Monikers</strong> (<strong class="bold">TFMs</strong>) for .NET 6 or 7.</p>
<p>.NET MAUI also requires an additional <code>&lt;SupportedOSPlatformVersion&gt;</code> property, which is set conditionally based on <code>TargetPlatformIdentifier</code>.</p>
<p>That is a significant amount of reduction from the .NET Framework <code>csproj</code> files. In addition to the property reduction, you can remove most of the <code>&lt;ItemGroup&gt;…&lt;/ItemGroup&gt;</code> entries since all source files are now included by default. The groups to leave are the groups containing <code>&lt;ProjectReferences /&gt;</code> entries.</p>
<p>Now that we’ve converted the shared project, let’s review the changes needed for an Android project.</p>
<p>As with all .NET Framework projects, we will need to change the <code>&lt;Project …&gt;</code> element to the following:</p>
<pre class="source-code">
&lt;Project Sdk="Microsoft.NET.Sdk"&gt;</pre> <p>Now, remove all the <code>&lt;PropertyGroup&gt;…&lt;/PropertyGroup&gt;</code> elements since they are default values, and replace them with the following:</p>
<pre class="source-code">
&lt;PropertyGroup&gt;
  <strong class="bold">&lt;UseMaui&gt;True&lt;/UseMaui&gt;</strong>
  <strong class="bold">&lt;TargetFramework&gt;net7.0-android&lt;/TargetFramework&gt;</strong>
  &lt;OutputType&gt;Exe&lt;/OutputType&gt;
  &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
  <strong class="bold">&lt;SupportedOSPlatformVersion Condition="'$(TargetFramework)' == 'net7.0-android'"&gt;31.0&lt;/SupportedOSPlatformVersion&gt;</strong>
<strong class="bold">&lt;/PropertyGroup&gt;</strong>
&lt;PropertyGroup&gt;
  &lt;UseInterpreter Condition="$(TargetFramework.Contains('-android'))"&gt;True&lt;/UseInterpreter&gt;
&lt;/PropertyGroup&gt;</pre> <p>Again, in the Android project, we <a id="_idIndexMarker391"/>set the <code>&lt;UseMaui&gt;</code> and <code>&lt;</code><code>TargetFramework&gt;</code> properties.</p>
<p>To finish migrating this project file, remove all the <code>&lt;ItemGroup&gt;</code> elements and their contents, except for the one group that contains the <code>&lt;AndroidResource&gt;</code> elements. Finally, remove the <code>&lt;Import&gt;</code> element at the bottom of the project file; it is no longer needed.</p>
<p>The next project type to look at is an iOS project. The changes here will be very similar to the changes in an Android project but with an iOS twist. Xamarin.Forms iOS projects are also a .NET Framework style project, so we will need to change the <code>&lt;Project …&gt;</code> element to the following:</p>
<pre class="source-code">
&lt;Project Sdk="Microsoft.NET.Sdk"&gt;</pre> <p>Then, we will need to remove all the existing <code>&lt;PropertyGroup&gt;</code> elements and add the following:</p>
<pre class="source-code">
&lt;PropertyGroup&gt;
  <strong class="bold">&lt;UseMaui&gt;true&lt;/UseMaui&gt;</strong>
  <strong class="bold">&lt;TargetFramework&gt;net7.0-ios&lt;/TargetFramework&gt;</strong>
  &lt;OutputType&gt;Exe&lt;/OutputType&gt;
  &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
  <strong class="bold">&lt;SupportedOSPlatformVersion </strong>
<strong class="bold">Condition="$([MSBuild]::GetTargetPlatformIdentifier('$</strong>
<strong class="bold">(TargetFramework)')) == 'ios'"&gt;14.2&lt;/SupportedOSPlatformVersion&gt;</strong>
&lt;/PropertyGroup&gt;</pre> <p>Again, you will notice the <code>&lt;UseMaui&gt;</code> property being set, and that the <code>&lt;TargetFramwork&gt;</code> value is <code>net7.0-ios</code>.</p>
<p>To finish converting an iOS <a id="_idIndexMarker392"/>project, remove the <code>&lt;ItemGroup&gt;</code> and <code>&lt;Import&gt;</code> elements except for the one containing the <code>&lt;ProjectReference&gt;</code> items; those are still needed.</p>
<h2 id="_idParaDest-78"><a id="_idTextAnchor263"/>Updating code from Xamarin.Forms to .NET MAUI</h2>
<p>Updating the code from <a id="_idIndexMarker393"/>Xamarin.Forms to .NET MAUI consists of several steps. First, we need to add some new code that is required to initialize .NET MAUI. Refer to the <em class="italic">Examining the files section</em> of <em class="italic">Chapter 2</em> for more details on the files that are needed.</p>
<p>The first change you will need is in the shared project. Add a new class file called <code>MauiProgram.cs</code> with the following contents, minimally:</p>
<pre class="source-code">
public static class MauiProgram
{
    public static MauiApp CreateMauiApp()
    {
        var builder = MauiApp.CreateBuilder();
        builder
            .UseMauiApp&lt;App&gt;()
            .ConfigureFonts(fonts =&gt;
            {
                fonts.AddFont("OpenSans-Regular.ttf", 
"OpenSansRegular");
             });
        return builder.Build();
    }
}</pre> <p>You may have to add additional code to this file so that it can handle additional needs for your application, such as registering types for dependency injection or registering additional library features, such <a id="_idIndexMarker394"/>as logging.</p>
<p>In the <code>Platforms/Android</code> folder, add a new class file named <code>MainApplication.cs</code> and update the class so that it looks like this:</p>
<pre class="source-code">
[Application]
public class MainApplication : MauiApplication
{
    public MainApplication(IntPtr handle, JniHandleOwnership ownership)
    : base(handle, ownership)
    {
    }
    protected override MauiApp CreateMauiApp() =&gt; MauiProgram.CreateMauiApp();
}</pre> <p>We must also make a few adjustments to the <code>MainActivity</code> class. Open the <code>MainActivity.cs</code> file and make the changes highlighted in the following code:</p>
<pre class="source-code">
[Activity(Label = "ManualMigration", Icon = "@mipmap/icon", 
Theme = <strong class="bold">"@style/Theme.MaterialComponents"</strong>, MainLauncher = true, 
ConfigurationChanges = ConfigChanges.ScreenSize | ConfigChanges.
Orientation | ConfigChanges.UiMode | ConfigChanges.ScreenLayout | 
ConfigChanges.SmallestScreenSize )]
public class MainActivity <strong class="bold">: MauiAppCompatActivity</strong>
<strong class="bold">{</strong>
<strong class="bold">    protected override void OnCreate(Bundle savedInstanceState)</strong>
<strong class="bold">    {</strong>
<strong class="bold">        base.OnCreate(savedInstanceState);</strong>
<strong class="bold">    }</strong>
<code>targetSdkVersion</code> in the <code>AndroidManifest.xml</code> file to version <code>33</code>, like this:</p>
<pre class="source-code">
&lt;uses-sdk android:minSdkVersion="21" <strong class="bold">android:targetSdkVersion="33"</strong> /&gt;</pre> <p class="callout-heading">Android SDK versions</p>
<p class="callout">Since the Android SDK is updated yearly, it may be the case that the version of .NET for Android and .NET MAUI that you are<a id="_idIndexMarker396"/> using is also using a version of the Android SDK that is greater than <code>33</code>. The good news is that you will get an error in Visual Studio if <code>targetSdkVersion</code> is too low or is not installed. Just follow the instructions in the build error to set the SDK version correctly.</p>
<p>That is all the changes we need to make in the Android project for now. Moving on to the iOS project, the <code>AppDelegate.cs</code> file can be updated so that it matches the following:</p>
<pre class="source-code">
public partial class AppDelegate : MauiUIApplicationDelegate
{
    protected override MauiApp CreateMauiApp() =&gt; MauiProgram.
CreateMauiApp();
}</pre> <p>The final change for the iOS project is to open the <code>Info.plist</code> file and change the <code>MinimumOSVersion</code> property to <code>15.2</code>.</p>
<p>With the base changes needed<a id="_idIndexMarker397"/> to start your app as a .NET MAUI app done, the next changes are much broader brush strokes:</p>
<ol>
<li>Remove all <code>Xamarin.*</code> namespaces from <code>.</code><code>cs</code> files.</li>
<li>Change all <code>xaml</code> namespace declarations from the following:<pre class="source-code">
</pre><p class="list-inset">You will need to amend them like so:</p><pre class="source-code"></pre></li> </ol>
<p>You may notice that these are the same changes we made in the previous section when using a .NET MAUI Single Project.</p>
<p class="callout-heading">About images</p>
<p class="callout">.NET MAUI has improved image handling for the various platforms that it targets. You can provide a single SVG image file, and it will resize the image correctly for all platforms for you. Since the SVG format is based on vectors, it will render much better than other formats such as JPG and PNG after resizing. It is recommended that you convert your images into SVG format, if possible, to take advantage of this feature in .NET MAUI.</p>
<h2 id="_idParaDest-79"><a id="_idTextAnchor264"/>Updating any incompatible NuGet packages</h2>
<p>There are a lot of NuGet packages out there and there is no way we can cover them all. But, in general, for each of the NuGet packages that are in use in your app, be sure to look for a version that specifically <a id="_idIndexMarker398"/>supports .NET MAUI or the version of .NET that you are targeting. You can use the NuGet Gallery page to determine whether a package supports .NET MAUI. Using a popular package such as PCLCrypto version 2.0.147 (<a href="https://www.nuget.org/packages/PCLCrypto/2.0.147#supportedframeworks-body-tab">https://www.nuget.org/packages/PCLCrypto/2.0.147#supportedframeworks-body-tab</a>) targets classic Xamarin projects but not .NET 6 or .NET 7. You can find the compatible frameworks under the <strong class="bold">Frameworks</strong> tab:</p>
<div><div><img alt="Figure 3.13 – NuGet Gallery page for PCLCrypto v2.0.147" src="img/B19214_03_13.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.13 – NuGet Gallery page for PCLCrypto v2.0.147</p>
<p>However, version 2.1.40-alpha (<a href="https://www.nuget.org/packages/PCLCrypto/2.1.40-alpha#supportedframeworks-body-tab">https://www.nuget.org/packages/PCLCrypto/2.1.40-alpha#supportedframeworks-body-tab</a>) lists .NET 6<a id="_idIndexMarker399"/> and .NET 7 as compatible frameworks:</p>
<div><div><img alt="Figure 3.14 – NuGet Gallery page for PCLCrypto v2.1.40-alpha" src="img/B19214_03_14.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.14 – NuGet Gallery page for PCLCrypto v2.1.40-alpha</p>
<p>Currently, we know of the following<a id="_idIndexMarker400"/> NuGet changes:</p>
<ul>
<li>Remove all Xamarin.Forms and Xamarin.Essentials NuGet references from your projects. These are now included in .NET MAUI directly. You will have to make some namespace adjustments as those have changed.</li>
<li>Replace Xamarin.Community Toolkit with the latest preview of .NET MAUI Community Toolkit. You will have to make some namespace adjustments as those have changed.</li>
<li>If you reference any of the following SkiaSharp NuGet packages directly, replace them with the latest previews:<ul><li><strong class="bold">SkiaSharp.Views.Maui.Controls</strong></li><li><strong class="bold">SkiaSharp.Views.Maui.Core</strong></li><li><strong class="bold">SkiaSharp.Views.Maui.Controls.Compatibility</strong></li></ul></li>
</ul>
<p>You can find the latest version of NuGet packages on the NuGet Gallery website at <a href="https://nuget.org/packages">https://nuget.org/packages</a>.</p>
<h2 id="_idParaDest-80"><a id="_idTextAnchor265"/>Addressing any breaking API changes</h2>
<p>Unfortunately, there is no magic bullet for any of these types of changes. You will simply have to start from the top of your <a id="_idIndexMarker401"/>error list and work your way through them. You can review the release notes linked in the official migration guide, available at <a href="https://learn.microsoft.com/en-us/dotnet/maui/migration/">https://learn.microsoft.com/en-us/dotnet/maui/migration/</a>, as helpful hints.</p>
<p>For example, a common type of error that’s seen is <code>error CS0104: 'ViewExtensions' is an ambiguous reference between 'Microsoft.Maui.Controls.ViewExtensions' and 'Microsoft.Maui.ViewExtensions'</code>. This can be fixed by explicitly using the full namespace when referencing the type or by using a type alias – for example, <code>using ViewExtensions = </code><code>Microsoft.Maui.Controls.ViewExtensions</code>.</p>
<h2 id="_idParaDest-81"><a id="_idTextAnchor266"/>Custom renderers and effects</h2>
<p>Your application may use custom renderers or effects to provide a unique user experience. Covering how to upgrade<a id="_idIndexMarker402"/> these components is beyond the scope of this chapter. To learn more about how to upgrade renderers and effects, visit the Microsoft Learn site for .NET MAUI migration at <a href="https://learn.microsoft.com/en-us/dotnet/maui/migration/">https://learn.microsoft.com/en-us/dotnet/maui/migration/</a>.</p>
<h2 id="_idParaDest-82"><a id="_idTextAnchor267"/>Running the converted app and verifying its functionality</h2>
<p>This is not the last step – I<a id="_idIndexMarker403"/> recommend that you attempt to do this after each change. Building your app as you make changes ensures that you are moving in the right direction. I recommend that you <code>obj</code> and <code>bin</code> folders beforehand. This<a id="_idIndexMarker404"/> will ensure that you are building with the latest changes and dependencies, by forcing a NuGet restore.</p>
<p>Now that we know the basics of how to convert a Xamarin.Forms app, let’s use .NET Upgrade Assistant to migrate a project for us.</p>
<h1 id="_idParaDest-83"><a id="_idTextAnchor268"/>Installing and running .NET Upgrade Assistant</h1>
<p>As stated previously, .NET Upgrade Assistant will attempt to perform the first four steps of the migration of your Xamarin.Forms app to .NET MAUI outlined in the previous section. The tool is under active <a id="_idIndexMarker405"/>development and as the team discovers new improvements, they are added. This is mostly due to feedback they receive from <a id="_idIndexMarker406"/>developers like you.</p>
<p>At the time of writing, .NET Upgrade Assistant did not work on all projects and has the following limitations:</p>
<ul>
<li>Xamarin.Forms must be version 5.0 and higher</li>
<li>Only Android and iOS projects are converted</li>
<li>.NET MAUI must be properly installed with the appropriate workloads</li>
</ul>
<p>If you have followed the steps from <em class="italic">Chapter 1</em>, then the last should should already be satisfied.</p>
<p>If your Xamarin.Forms app meets these criteria, then we can get started by installing<a id="_idIndexMarker407"/> the tool.</p>
<h2 id="_idParaDest-84"><a id="_idTextAnchor269"/>Installing .NET Upgrade Assistant</h2>
<p>.NET Upgrade Assistant is a Visual Studio<a id="_idIndexMarker408"/> extension on Windows and a command-line tool on Windows and macOS. You can use the integrated developer PowerShell in Visual Studio or any command-line prompt to install the tool. Follow these steps to install the tool using Visual Studio on Windows:</p>
<ol>
<li>In Visual Studio, select the <strong class="bold">Extensions</strong> menu, then the <strong class="bold">Manage Extensions</strong> item. This will open the <strong class="bold">Manage </strong><strong class="bold">Extensions</strong> dialog.</li>
<li>In the <code>upgrade</code>.</li>
<li>Select <strong class="bold">.NET Upgrade Assistant</strong> and click <strong class="bold">Download</strong>:</li>
</ol>
<div><div><img alt="Figure 3.15 – Visual Studio – the Manage Extensions dialog﻿" src="img/B19214_03_15.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.15 – Visual Studio – the Manage Extensions dialog</p>
<ol>
<li value="4">Once the extension has<a id="_idIndexMarker409"/> been downloaded, you will need to close and reopen Visual Studio to install the extension:</li>
</ol>
<div><div><img alt="Figure 3.16 – Installing the .NET Upgrade Assistant VSIX" src="img/B19214_03_16.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.16 – Installing the .NET Upgrade Assistant VSIX</p>
<ol>
<li value="5">Click <strong class="bold">Modify</strong> and then<a id="_idIndexMarker410"/> follow the instructions to complete the installation.</li>
<li>Once the installation is complete, reopen Visual Studio.</li>
</ol>
<p>Now that the tool has been installed, we can use it to convert a Xamarin.Forms project!</p>
<h2 id="_idParaDest-85"><a id="_idTextAnchor270"/>Preparing to run .NET Upgrade Assistant</h2>
<p>For the remainder of this chapter, we <a id="_idIndexMarker411"/>will be using Visual Studio on Windows to migrate a Xamarin.Forms app to .NET MAUI.</p>
<p>To run .NET Upgrade Assistant, we will need a Xamarin.Forms project to upgrade. For this portion of the chapter, we will use the Xamarin.Forms app that was demoed at the Microsoft Build conference in 2019. The source can be found at <a href="https://github.com/mindofai/Build2019Chat">https://github.com/mindofai/Build2019Chat</a>, though you can find it in this book’s GitHub repository at <a href="https://github.com/PacktPublishing/MAUI-Projects-3rd-Edition">https://github.com/PacktPublishing/MAUI-Projects-3rd-Edition</a> under the <code>Chapter03/Build2019Chat</code> folder.</p>
<p>Once you have downloaded the source, open the <code>BuildChat.sln</code> file in Visual Studio. Once the project has finished loading, make sure your configuration is correct by running the app first. You should see a screen that looks like this on Android:</p>
<div><div><img alt="Figure 3.17 – The original app on Android" src="img/B19214_03_17.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.17 – The original app on Android</p>
<p>Now that we have confirmed that the original app runs, we can follow these steps to prepare for running .NET <a id="_idIndexMarker412"/>Upgrade Assistant:</p>
<ol>
<li>Right-click the <code>BuildChat</code> solution node in <strong class="bold">Solution Explorer</strong> and select <strong class="bold">Manage NuGet Packages </strong><strong class="bold">for Solution…</strong>:</li>
</ol>
<div><div><img alt="Figure 3.18 – Solution context menu" src="img/B19214_03_18.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.18 – Solution context menu</p>
<ol>
<li value="2">In the <strong class="bold">NuGet – Solution</strong> window<a id="_idIndexMarker413"/> that opens, select the <strong class="bold">Updates</strong> tab:</li>
</ol>
<p class="IMG---Figure"> </p>
<div><div><img alt="Figure 3.19 – The NuGet – Solution window" src="img/B19214_03_19.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.19 – The NuGet – Solution window</p>
<ol>
<li value="3">Click the <strong class="bold">Select all packages</strong> checkbox, then click <strong class="bold">Update</strong>.</li>
<li>Visual Studio will prompt you with a preview of all the changes that will be made. Click <strong class="bold">OK</strong> once you have reviewed them.</li>
<li>Visual Studio will then prompt you to accept the license terms for packages that have them. Once you have reviewed the license terms, click <strong class="bold">I Accept</strong>.</li>
<li>After updating, you may <a id="_idIndexMarker414"/>still have a <strong class="bold">gold bar</strong> indicator in the Visual Studio window from running the application earlier. You can safely dismiss the message by clicking the <strong class="bold">X</strong> button on the right:<div><img alt="Figure 3.20 – Xamarin.Forms version gold bar" src="img/B19214_03_20.jpg"/></div></li>
</ol>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.20 – Xamarin.Forms version gold bar</p>
<ol>
<li value="7">Once the packages have been updated, let’s make sure the app is still working by running it again. You <a id="_idIndexMarker415"/>should get a build error like the following:</li>
</ol>
<div><div><img alt="Figure 3.21 – Error after upgrading packages" src="img/B19214_03_21.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.21 – Error after upgrading packages</p>
<ol>
<li value="8">To resolve this error, in <code>BuildChat.Android</code> project, then press <em class="italic">Alt</em> and <em class="italic">Enter</em> at the same time to open the project properties page.</li>
<li>Use the <code>Android 8.1 (Oreo)</code> to <code>Android 10.0</code>.</li>
</ol>
<p class="callout-heading">Google Play support</p>
<p class="callout">You may get a warning about Google Play requiring new apps and updates to support a specific version of Android. To remove that warning, just set <strong class="bold">Target Framework</strong> to the version indicated in the warning message.</p>
<ol>
<li value="10">Visual Studio will prompt you to confirm the change as it has to close and re-open the project. Select <strong class="bold">Yes</strong>.</li>
<li>Visual Studio may also prompt you to install the Android version if you haven’t installed it. Follow the<a id="_idIndexMarker416"/> prompts to install the Android version.</li>
<li>Attempting to run the project again yields a new set of errors:</li>
</ol>
<div><div><img alt="Figure 3.22 – Missing packages error" src="img/B19214_03_22.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.22 – Missing packages error</p>
<ol>
<li value="13">To resolve this error, right-click the <code>BuildChat.Android</code> project and select <strong class="bold">Unload Project</strong>. The project file should open in Visual Studio automatically.</li>
<li>Locate <code>&lt;ItemGroup&gt;</code> in the file with <code>&lt;PackageReference&gt;</code> items and make the changes highlighted in the following snippet:<pre class="source-code">
&lt;ItemGroup&gt;
    &lt;PackageReference Include="Microsoft.AspNetCore.SignalR.Client"&gt;
    &lt;Version&gt;7.0.9&lt;/Version&gt;
    &lt;/PackageReference&gt;
    &lt;PackageReference Include="Xamarin.Forms" Version="5.0.0.2578" /&gt;
    &lt;PackageReference Include="Xamarin.Android.Support.Design" Version="28.0.0.3" /&gt;
    &lt;PackageReference Include="Xamarin.Android.Support.v7.AppCompat" Version="28.0.0.3" /&gt;
    &lt;PackageReference Include="Xamarin.Android.Support.v4" Version="28.0.0.3" /&gt;
    &lt;PackageReference Include="Xamarin.Android.Support.v7.CardView" Version="28.0.0.3" /&gt;
<strong class="bold">&lt;PackageReference Include="Xamarin.AndroidX.MediaRouter" Version="1.2.0" /&gt;</strong>
<strong class="bold">    &lt;PackageReference Include="Xamarin.AndroidX.Palette" Version="1.0.0.5" /&gt;</strong>
&lt;/ItemGroup&gt;</pre><p class="list-inset">You could also use Visual <a id="_idIndexMarker417"/>Studio’s NuGet Package Manager to add these packages.</p></li> <li>Save and reload the project before trying to run it again. Since the project was unloaded, you will need to set the <code>BuildChat.Android</code> project as the startup project again.</li>
</ol>
<p>You should be able to run the application at this time since some warnings can be ignored. If not, review the previous steps to make sure you made all the changes correctly. At this point, we are ready to run the upgrade assistant to convert from Xamarin.Forms into .NET<a id="_idIndexMarker418"/> MAUI.</p>
<p class="callout-heading">Treat warnings as errors</p>
<p class="callout">If you have the project option to treat warnings as errors set to anything other than none, then the warnings will prevent you from running the app. Set the option to none to allow the app to run. The option defaults to none.</p>
<h2 id="_idParaDest-86"><a id="_idTextAnchor271"/>Running .NET Upgrade Assistant</h2>
<p>Running .NET Upgrade Assistant <a id="_idIndexMarker419"/>from within Visual Studio is a straightforward process. We will upgrade each project individually; there isn’t any method to upgrade all the projects in one go.</p>
<h3>Upgrading the BuildChat project</h3>
<p>Let’s start with the<a id="_idIndexMarker420"/> shared project, <code>BuildChat</code>, by following these steps:</p>
<ol>
<li>Select the <code>BuildChat</code> project in <strong class="bold">Solution Explorer</strong>.</li>
<li>Use the context menu to select the <strong class="bold">Upgrade</strong> menu item:</li>
</ol>
<div><div><img alt="Figure 3.23 – Upgrading the BuildChat project" src="img/B19214_03_23.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.23 – Upgrading the BuildChat project</p>
<p class="list-inset">This will open the <strong class="bold">Upgrade</strong> assistant in<a id="_idIndexMarker421"/> a document window:</p>
<div><div><img alt="Figure 3.24 – Upgrading the BuildChat project" src="img/B19214_03_24.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.24 – Upgrading the BuildChat project</p>
<ol>
<li value="3">Select the <strong class="bold">In-place project </strong><strong class="bold">upgrade</strong> option.</li>
<li>Depending on the<a id="_idIndexMarker422"/> versions of .NET you have installed, you will be prompted to choose one. If you followed the setup instructions in <em class="italic">Chapter 1</em>, you should have the .NET 7.0 option available. Select <strong class="bold">.NET 7.0</strong> and select <strong class="bold">Next</strong>:</li>
</ol>
<div><div><img alt="Figure 3.25 – Choosing the preferred target framework" src="img/B19214_03_25.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.25 – Choosing the preferred target framework</p>
<ol>
<li value="5">At this point, you are allowed to review the changes that will be made by expanding each node in<a id="_idIndexMarker423"/> the list. You can also choose to not upgrade certain items by removing the check in the checkbox next to that item. When you have inspected all the changes, make sure all items are checked again, then click <strong class="bold">Upgrade selection</strong>:</li>
</ol>
<div><div><img alt="Figure 3.26 – Reviewing the upgrade" src="img/B19214_03_26.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.26 – Reviewing the upgrade</p>
<ol>
<li value="6">Visual Studio will start<a id="_idIndexMarker424"/> the upgrade process. You can monitor it as it completes each item:</li>
</ol>
<div><div><img alt="Figure 3.27 – Upgrade in progress" src="img/B19214_03_27.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.27 – Upgrade in progress</p>
<ol>
<li value="7">When it’s finished, you <a id="_idIndexMarker425"/>can inspect each item to see what the result of the upgrade was:</li>
</ol>
<div><div><img alt="Figure 3.28 – Upgrade complete" src="img/B19214_03_28.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.28 – Upgrade complete</p>
<p>A white check in a green circle indicates some transformation was completed and successful, a green check with a white background means the step was skipped since nothing was needed, and a red <a id="_idIndexMarker426"/>cross (not shown) means the transformation failed. You can view the complete output from the tool by inspecting the <strong class="bold">Upgrade Assistant</strong> log in the output pane:</p>
<div><div><img alt="Figure 3.29 – Upgrade Assistant log output" src="img/B19214_03_29.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.29 – Upgrade Assistant log output</p>
<p>Do not be concerned with <a id="_idIndexMarker427"/>the errors in the error window at this point. There will be errors until we finish upgrading the remaining projects. Now that the <code>BuildChat</code> project has been upgraded, we can upgrade the <code>BuildChat.Android</code> project.</p>
<h3>Upgrading the BuildChat.Android project</h3>
<p>The steps for upgrading the remaining projects are largely the same – the only difference will be the steps involved in <a id="_idIndexMarker428"/>upgrading each project. The next two sections will skip the screenshots and just provide the steps. To complete the upgrade for the <code>BuildChat.Android</code> project, follow these steps:</p>
<ol>
<li>Select the <strong class="bold">BuildChat.Android</strong> project in <strong class="bold">Solution Explorer</strong>.</li>
<li>Use the context menu to select the <strong class="bold">Upgrade</strong> menu item.</li>
<li>This will open the <strong class="bold">Upgrade</strong> assistant in a document window.</li>
<li>Select the <strong class="bold">In-place project </strong><strong class="bold">upgrade</strong> option.</li>
<li>Select the <strong class="bold">.NET 7.0</strong> option, then select <strong class="bold">Next</strong>.</li>
<li>Review the changes that will be made by expanding each node in the list. Make sure all items are checked, then click <strong class="bold">Upgrade Selection</strong>.</li>
<li>Visual Studio will complete the upgrade process.</li>
</ol>
<p>Now that .NET Upgrade Assistant has completed the <code>BuildChat.Android</code> project, we can upgrade the <code>BuildChat.iOS</code> project.</p>
<h3>Upgrading the BuildChat.iOS project</h3>
<p>The steps for upgrading the iOS project are largely the same – the only difference will be the steps involved in upgrading each project. To complete the upgrade for the <code>BuildChat.iOS</code> project, follow these steps:</p>
<ol>
<li>Select the <code>BuildChat.iOS</code> project in <strong class="bold">Solution Explorer</strong>.</li>
<li>Use the context menu to select the <strong class="bold">Upgrade</strong> menu item.</li>
<li>This will open the <strong class="bold">Upgrade</strong> assistant in a document window:</li>
<li>Select the <strong class="bold">In-place project </strong><strong class="bold">upgrade</strong> option.</li>
<li>Select the <strong class="bold">.NET 7.0</strong> option, then select <strong class="bold">Next</strong>.</li>
<li>Review the changes that<a id="_idIndexMarker429"/> will be made by expanding each node in the list. Make sure all items are checked, then click <strong class="bold">Upgrade Selection</strong>.</li>
<li>Visual Studio will complete the upgrade process.</li>
</ol>
<p>Now that .NET Upgrade Assistant has completed the <code>BuildChat.iOS</code> project, we can see how well it worked.</p>
<h3>Completing the upgrade to .NET MAUI</h3>
<p>With .NET Upgrade Assistant having done all the work it can to upgrade the projects, we can now see what is left for us to<a id="_idIndexMarker430"/> complete the upgrade to .NET MAUI.</p>
<p>The first thing we want to do is make sure that the project is clean of all the previous build artifacts. This will ensure we are referencing all the right dependencies in our build output by forcing a restore and build. The best way to accomplish this is to remove the <code>bin</code> and <code>obj</code> folders from each project folder.</p>
<p>Use <code>bin</code> and <code>obj</code> folders from the <code>BuildChat</code>, <code>BuildChat.Android</code> and <code>BuildChat.iOS</code> folders, then build the solution.</p>
<p>We’ll end up with a few build <a id="_idIndexMarker431"/>errors for each project, as shown in the following figure:</p>
<div><div><img alt="Figure 3.30 – Package issues" src="img/B19214_03_30.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.30 – Package issues</p>
<p>To resolve these errors, either use Visual Studio’s NuGet Package Manager to add a reference to version 7.0.1 of the <code>Microsoft.Extensions.Logging.Abstractions</code> package to all the projects, or follow these steps to update the project files manually:</p>
<ol>
<li>Select the <code>BuildChat</code> project in <strong class="bold">Solution Explorer</strong>.<p class="list-inset">The project file will open in a document window automatically.</p></li>
<li>Locate the <code>ItemGroup</code> element that contains the <code>PackageReference</code> items.</li>
<li>Make the changes highlighted in the following snippet:<pre class="source-code">
&lt;ItemGroup&gt;
    &lt;PackageReference Include="Microsoft.AspNetCore.SignalR.Client" Version="7.0.9" /&gt;
<strong class="bold">    &lt;PackageReference Include="Microsoft.Extensions.Logging.Abstractions" Version="7.0.1" /&gt;</strong>
&lt;/ItemGroup&gt;</pre></li> <li>Select the <code>BuildChat.Android</code> project in <strong class="bold">Solution Explorer</strong>.<p class="list-inset">The project file will open in a document window automatically.</p></li>
<li>Locate the <code>ItemGroup</code> element that contains the <code>PackageReference</code> items.</li>
<li>Make the changes<a id="_idIndexMarker432"/> highlighted in the following snippet:<pre class="source-code">
&lt;ItemGroup&gt;
    &lt;PackageReference Include="Xamarin.AndroidX.MediaRouter" Version="1.2.0" /&gt;
    &lt;PackageReference Include="Xamarin.AndroidX.Palette" Version="1.0.0.5" /&gt;
    &lt;PackageReference Include="Microsoft.AspNetCore.SignalR.Client" Version="7.0.9" /&gt;
<strong class="bold">    &lt;PackageReference Include="Microsoft.Extensions.Logging.Abstractions" Version="7.0.1" /&gt;</strong>
&lt;/ItemGroup&gt;</pre></li> <li>Select the <code>BuildChat.iOS</code> project in <strong class="bold">Solution Explorer</strong>.<p class="list-inset">The project file will open in a document window automatically.</p></li>
<li>Locate the <code>ItemGroup</code> element that contains the <code>PackageReference</code> items.</li>
<li>Make the changes highlighted in the following snippet:<pre class="source-code">
&lt;ItemGroup&gt;
    &lt;PackageReference Include="Microsoft.AspNetCore.SignalR.Client" Version="7.0.9" /&gt;
<strong class="bold">    &lt;PackageReference Include="Microsoft.Extensions.Logging.Abstractions" Version="7.0.1" /&gt;</strong>
&lt;/ItemGroup&gt;</pre></li> </ol>
<p>Now that we have added the required package references, we can try building the app again. After this build, we’ll get two new errors:</p>
<div><div><img alt="Figure 3.31 – Namespace does not exist errors" src="img/B19214_03_31.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.31 – Namespace does not exist errors</p>
<p>These two errors show two areas that the upgrade assistant did not upgrade. Luckily, we covered how to upgrade these <a id="_idIndexMarker433"/>two files easier in this chapter. Let’s upgrade them again, starting with the <code>BuildChat.Android</code> project.</p>
<p>Open the <code>MainActivity.cs</code> file and make the changes highlighted in the following code:</p>
<pre class="source-code">
<strong class="bold">using Microsoft.Maui;</strong>
namespace BuildChat.Droid
{
    [Activity(Label = "BuildChat", Icon = "@mipmap/icon", <strong class="bold">Theme = "@style/Theme.MaterialComponents"</strong>, MainLauncher = true, ConfigurationChanges = ConfigChanges.ScreenSize | ConfigChanges.Orientation)]
    public class MainActivity : <strong class="bold">MauiAppCompatActivity</strong>
<strong class="bold">    {</strong>
<strong class="bold">        protected override void OnCreate(Bundle savedInstanceState)</strong>
<strong class="bold">        {</strong>
<strong class="bold">            base.OnCreate(savedInstanceState);</strong>
<strong class="bold">        }</strong>
<strong class="bold">    }</strong>
}</pre> <p>That should complete the changes needed for the Android project. Now, to upgrade the iOS project, open the <code>AppDelegate.cs</code> file in <code>BuildChat.iOS</code> and update it so that it matches the <a id="_idIndexMarker434"/>following:</p>
<pre class="source-code">
<strong class="bold">using Foundation;</strong>
<strong class="bold">using Microsoft.Maui;</strong>
<strong class="bold">using Microsoft.Maui.Hosting;</strong>
namespace BuildChat.iOS
{
    // The UIApplicationDelegate for the application. This class is responsible for launching the
    // User Interface of the application, as well as listening (and optionally responding) to
    // application events from iOS.
    [Register("AppDelegate")]
    public partial class AppDelegate : <strong class="bold">MauiUIApplicationDelegate</strong>
<strong class="bold">    {</strong>
<strong class="bold">        protected override MauiApp CreateMauiApp() =&gt; MauiProgram.CreateMauiApp();</strong>
<strong class="bold">    }</strong>
}</pre> <p>The final change for the iOS project is to open the <code>Info.plist</code> file and change the <code>MinimumOSVersion</code> property to <code>15.2</code>. To make this change, use <code>Info.plist</code> file and make this change, follow these steps:</p>
<ol>
<li>Select the <code>Info.plist</code> file in the <code>BuildChat.iOS</code> project.</li>
<li>Use the context<a id="_idIndexMarker435"/> menu (right-click) and select <strong class="bold">Open With…</strong>.</li>
<li>In the <strong class="bold">Open With</strong> dialog, select <strong class="bold">Generic Plist Editor</strong>, then select <strong class="bold">OK</strong>:</li>
</ol>
<div><div><img alt="Figure 3.32 – Opening the Info.plist file" src="img/B19214_03_32.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.32 – Opening the Info.plist file</p>
<ol>
<li value="4">Find the entry labeled <code>Minimum system version</code> and change the value from <code>8.0</code> to <code>15.1</code>:</li>
</ol>
<div><div><img alt="Figure 3.33 – Changing the minimum system version" src="img/B19214_03_33.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.33 – Changing the minimum system version</p>
<p>Great – that should complete the<a id="_idIndexMarker436"/> changes needed to get the app running as a .NET MAUI application! The following are the before and after screenshots of the application; <em class="italic">before</em> is on the left and <em class="italic">after</em> is on the right:</p>
<div><div><img alt="" role="presentation" src="img/B19214_03_34.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"> </p>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.34 – Xamarin.Forms versus .NET MAUI</p>
<p>There are some visual changes<a id="_idIndexMarker437"/> between Xamarin.Forms and .NET MAUI, and you can tweak the .NET MAUI settings for the layouts and controls to get a very similar output.</p>
<h1 id="_idParaDest-87"><a id="_idTextAnchor272"/>Summary</h1>
<p>In this chapter, we focused on upgrading a Xamarin.Forms app to .NET MAUI. We learned how to upgrade the project files from .NET Framework to SDK-style projects, application startup files, XAML views, and C# files needed for .NET MAUI. We started by doing this manually to learn about all the required steps and changes. We ended this chapter by using .NET Upgrade Assistant to make many of the changes for us. We also learned how to upgrade to the Single Project format, which is the default for .NET MAUI. Now, we can pick the best method for the project we are upgrading.</p>
<p>While we covered a lot in this chapter, it was not exhaustive. There is a lot of variation in different projects, from NuGet package dependencies and vendor-provided controls to customizations using renderers and effects. The app you are upgrading may use one or all of these, and you can find additional help on the Microsoft Learn site for upgrading Xamarin.Forms to .NET MAUI: <a href="https://learn.microsoft.com/en-us/dotnet/maui/migration/">https://learn.microsoft.com/en-us/dotnet/maui/migration/</a>.</p>
<p>If you are interested in seeing the <code>BuildChat</code> app fully functional, try using .NET Upgrade Assistant on the service that was also built for the 2019 Microsoft Build conference. You can find the source on GitHub at <a href="https://github.com/mindofai/SignalRChat/tree/master">https://github.com/mindofai/SignalRChat/tree/master</a>. You could also use ChatGPT to help you build the service yourself using Azure Functions and SignalR.</p>
<p>In the next chapter, we will build an app that displays news articles using the new .NET MAUI Shell.</p>
</div>


<div><h1 id="_idParaDest-88" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor273"/>Part 2: Basic Projects</h1>
<p>In this part, you will learn about .NET MAUI features such as Shell, CollectionView, Image, Button, Label, CarouselView, Grid, Custom Controls, and Gestures. You will explore using location services, calling custom web APIs, and designing your XAML for different form factors.</p>
<p>This part has the following chapters:</p>
<ul>
<li><a href="B19214_04.xhtml#_idTextAnchor274"><em class="italic">Chapter 4</em></a>, <em class="italic">Building a News App Using .NET MAUI Shell</em></li>
<li><a href="B19214_05.xhtml#_idTextAnchor399"><em class="italic">Chapter 5</em></a>, <em class="italic">Building a Matchmaking App with Rich UX Using Animations</em></li>
<li><a href="B19214_06.xhtml#_idTextAnchor513"><em class="italic">Chapter 6</em></a>, <em class="italic">Building a Photo Gallery App Using CollectionView and CarouselView</em></li>
<li><a href="B19214_07.xhtml#_idTextAnchor569"><em class="italic">Chapter 7</em></a>, <em class="italic">Building a Location Tracking App Using GPS and Maps</em></li>
<li><a href="B19214_08.xhtml#_idTextAnchor708"><em class="italic">Chapter 8</em></a>, <em class="italic">Building a Weather App for Multiple Form Factors</em></li>
</ul>
</div>
<div><div></div>
</div>
</body></html>