<html><head></head><body><div><p>&#13;
    <h1 class="chapterNumber">13</h1>&#13;
    <h1 id="_idParaDest-252" class="chapterTitle">Exploring Generics, Delegates, and Beyond</h1>&#13;
    <p class="normal">The more time you spend programming, the more you start thinking about systems. Structuring how classes and objects interact, communicate, and exchange data are all examples of systems we've worked with so far; the question now is how to make them safer and more efficient.</p>&#13;
    <p class="normal">Since this will be the last practical chapter of the book, we'll be going over examples of generic programming concepts, delegation, event creation, and error handling. Each of these topics is a large area of study in its own right, so take what you learn here and expand on it in your projects. After we complete our practical coding, we'll finish up with a brief overview of design patterns and how they'll play a part in your programming journey going forward.</p>&#13;
    <p class="normal">We'll cover the following topics in this chapter:</p>&#13;
    <ul>&#13;
      <li class="bullet">Generic programming</li>&#13;
      <li class="bullet">Using delegates</li>&#13;
      <li class="bullet">Creating events and subscriptions</li>&#13;
      <li class="bullet">Throwing and handling errors</li>&#13;
      <li class="bullet">Understanding design patterns</li>&#13;
    </ul>&#13;
    <h1 id="_idParaDest-253" class="title">Introducing generics</h1>&#13;
    <p class="normal">All of our code so far has been very specific in terms of defining and using types. However, there will <a id="_idIndexMarker870"/>be cases where you need a class or method to treat its entities in the same way, regardless of its type, while still being type-safe. Generic programming allows us to create reusable classes, methods, and variables using a placeholder, rather than a concrete type.</p>&#13;
    <p class="normal">When a generic class instance is created at compile time or a method is used, a concrete type will be assigned, but the code itself treats it as a generic type. Being able to write generic code is a huge benefit when you need to work with different object types in the same way, for example, custom collection types that need to be able to perform the same operations <a id="_idIndexMarker871"/>on elements regardless of type, or classes that need the same underlying functionality. While you might be asking yourself why we don't just subclass or use interfaces, you'll see in our examples that generics help us in a different way. </p>&#13;
    <div>&#13;
      <p class="Information-Box--PACKT-">We've already seen this in action with the <code class="Code-In-Text--PACKT-">List</code> type, which is a generic type. We can access all its addition, removal, and modification functions regardless of whether it's storing integers, strings, or individual characters.</p>&#13;
    </p>&#13;
    <h2 id="_idParaDest-254" class="title">Generic objects</h2>&#13;
    <p class="normal">Creating a generic class works the same as creating a non-generic class but with one important <a id="_idIndexMarker872"/>difference: its generic type parameter. Let's take a look at an example of a generic collection class we might want to create to get a clearer picture of how this works:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">public class SomeGenericCollection<strong class="hljs-slc">&lt;</strong><strong class="hljs-title-slc">T</strong><strong class="hljs-slc">&gt;</strong> {}&#13;
</code></pre>&#13;
    <p class="normal">We've declared a generic collection class named <code class="Code-In-Text--PACKT-">SomeGenericCollection</code> and specified that its type parameter will be named <code class="Code-In-Text--PACKT-">T</code>. Now, <code class="Code-In-Text--PACKT-">T</code> will stand in for the element type that the generic list will store and can be used inside the generic class just like any other type.</p>&#13;
    <p class="normal">Whenever we create an instance of <code class="Code-In-Text--PACKT-">SomeGenericCollection</code>, we need to specify the type of values it can store:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">SomeGenericCollection<strong class="hljs-slc">&lt;</strong><strong class="hljs-built_in-slc">int</strong><strong class="hljs-slc">&gt;</strong> highScores = new SomeGenericCollection&lt;int&gt;();&#13;
</code></pre>&#13;
    <p class="normal">In this case, <code class="Code-In-Text--PACKT-">highScores</code> stores integer values and <code class="Code-In-Text--PACKT-">T</code> stands in for the <code class="Code-In-Text--PACKT-">int</code> type, but the <code class="Code-In-Text--PACKT-">SomeGenericCollection</code> class will treat any element type the same.</p>&#13;
    <p>&#13;
      <p class="Information-Box--PACKT-">You have complete control over naming a generic type parameter, but the industry standard in many programming languages is a capital <code class="Code-In-Text--PACKT-">T</code>. If you are going to name your type parameters differently, consider starting the name with a capital <code class="Code-In-Text--PACKT-">T</code> for consistency and readability.</p>&#13;
    </p>&#13;
    <p class="normal">Let's create a more game-focused example next with a generic <code class="Code-In-Text--PACKT-">Shop</code> class to store some fictional inventory items with the following steps:</p>&#13;
    <ol>&#13;
      <li class="numbered">Create a <a id="_idIndexMarker873"/>new C# script in the <code class="Code-In-Text--PACKT-">Scripts</code> folder, name it <code class="Code-In-Text--PACKT-">Shop</code>, and update its code to the following:&#13;
        <pre class="programlisting code"><code class="hljs-code">using System.Collections;&#13;
using System.Collections.Generic;&#13;
using UnityEngine;&#13;
 &#13;
// 1&#13;
public class Shop&lt;T&gt;&#13;
{&#13;
    // 2&#13;
    public List&lt;T&gt; inventory = new List&lt;T&gt;();&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Create a new instance of <code class="Code-In-Text--PACKT-">Shop</code> in <code class="Code-In-Text--PACKT-">GameBehavior</code>:&#13;
        <pre class="programlisting code"><code class="hljs-code">public class GameBehavior : MonoBehaviour, IManager&#13;
{&#13;
    // ... No other changes needed ...&#13;
 &#13;
      &#13;
    public void Initialize()&#13;
    {&#13;
        // 3&#13;
        var itemShop = new Shop&lt;string&gt;();&#13;
        // 4&#13;
        Debug.Log("There are " + itemShop.inventory.Count + " items for sale.");&#13;
    }&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
    </ol>&#13;
    <p class="normal">Let's break down the code:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Declares a new generic class named <code class="Code-In-Text--PACKT-">IShop</code> with a <code class="Code-In-Text--PACKT-">T</code> type parameter</li>&#13;
      <li class="numbered">Adds an inventory <code class="Code-In-Text--PACKT-">List&lt;T&gt;</code> of type <code class="Code-In-Text--PACKT-">T</code> to store whatever item types we initialize the generic class with</li>&#13;
      <li class="numbered">Creates a new instance of <code class="Code-In-Text--PACKT-">Shop&lt;string&gt;</code> in <code class="Code-In-Text--PACKT-">GameBehavior</code> and specifies string values as the generic type</li>&#13;
      <li class="numbered">Prints out a debug message with the inventory count:<figure class="mediaobject"><img src="img/B17573_13_01.png" alt="" width="721" height="141"/></figure>&#13;
    <p class="packt_figref">Figure 13.1: Console output from a generic class</p>&#13;
      </li>&#13;
    </ol>&#13;
&#13;
    <p class="normal">Nothing new has happened here yet in terms of functionality, but Visual Studio recognizes <code class="Code-In-Text--PACKT-">Shop</code> as a generic class because of its generic type parameter, <code class="Code-In-Text--PACKT-">T</code>. This sets us up to include <a id="_idIndexMarker874"/>additional generic operations like adding inventory items or finding how many of each item is available.</p>&#13;
    <p>&#13;
      <p class="Information-Box--PACKT-">It's worth noting here that generics aren't supported by the Unity Serializer by default. If you want to serialize generic classes, like we did with custom classes in the last chapter, you need to add the <code class="Code-In-Text--PACKT-">Serializable</code> attribute to the top of class, like we did with our <code class="Code-In-Text--PACKT-">Weapon</code> class. You can find more information at <a href="https://docs.unity3d.com/ScriptReference/SerializeReference.html">https://docs.unity3d.com/ScriptReference/SerializeReference.html</a>. </p>&#13;
    </p>&#13;
    <h2 id="_idParaDest-255" class="title">Generic methods</h2>&#13;
    <p class="normal">A standalone generic method can have a placeholder type parameter, just like a generic class, which allows <a id="_idIndexMarker875"/>it to be included inside either a generic or non-generic class as needed:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">public void GenericMethod<strong class="hljs-function-slc">&lt;</strong><strong class="hljs-title-slc">T</strong><strong class="hljs-function-slc">&gt;</strong>(<strong class="hljs-params-slc">T</strong> genericParameter) {}&#13;
</code></pre>&#13;
    <p class="normal">The <code class="Code-In-Text--PACKT-">T</code> type can be used inside the method body and defined when the method is called:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">GenericMethod<strong class="hljs-slc">&lt;</strong><strong class="hljs-built_in-slc">string</strong><strong class="hljs-slc">&gt;(</strong><strong class="hljs-string-slc">"Hello World!"</strong><strong class="hljs-slc">)</strong>;&#13;
</code></pre>&#13;
    <p class="normal">If you want to declare a generic method inside a generic class, you don't need to specify a new <code class="Code-In-Text--PACKT-">T</code> type:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">public class SomeGenericCollection&lt;T&gt; &#13;
{&#13;
    public void NonGenericMethod(<strong class="hljs-params-slc">T</strong> genericParameter) {}&#13;
}&#13;
</code></pre>&#13;
    <p class="normal">When you call a non-generic method that uses a generic type parameter, there's no issue because the generic class has already taken care of assigning a concrete type:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">SomeGenericCollection<strong class="hljs-slc">&lt;</strong><strong class="hljs-built_in-slc">int</strong><strong class="hljs-slc">&gt;</strong> highScores = new SomeGenericCollection&#13;
&lt;int&gt; ();&#13;
highScores.NonGenericMethod(<strong class="hljs-number-slc">35</strong>);&#13;
</code></pre>&#13;
    <p>&#13;
      <p class="Information-Box--PACKT-">Generic methods can be overloaded and marked as static, just like non-generic methods. If you want the specific syntax for those situations, check out <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/generics/generic-methods">https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/generics/generic-methods</a>.</p>&#13;
    </p>&#13;
    <p class="normal">Your next task <a id="_idIndexMarker876"/>is to create a method that adds new generic items to the inventory and use it in the <code class="Code-In-Text--PACKT-">GameBehavior</code> script.</p>&#13;
    <p class="normal">Since we already have a generic class with a defined type parameter, let's add a non-generic method to see them working together:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Open up <code class="Code-In-Text--PACKT-">Shop</code> and update the code as follows:&#13;
        <pre class="programlisting code"><code class="hljs-code">public class Shop&lt;T&gt;&#13;
{&#13;
    public List&lt;T&gt; inventory = new List&lt;T&gt;();&#13;
    <strong class="hljs-comment-slc">// 1</strong>&#13;
    <strong class="hljs-keyword-slc">public</strong><strong class="hljs-function-slc"> </strong><strong class="hljs-keyword-slc">void</strong><strong class="hljs-function-slc"> </strong><strong class="hljs-title-slc">AddItem</strong><strong class="hljs-function-slc">(</strong><strong class="hljs-params-slc">T newItem</strong><strong class="hljs-function-slc">)</strong>&#13;
    <strong class="hljs-slc">{</strong>&#13;
      &#13;
        <strong class="hljs-slc">inventory.Add(newItem);</strong>&#13;
    <strong class="hljs-slc">}</strong>&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Go into <code class="Code-In-Text--PACKT-">GameBehavior</code> and add an item to <code class="Code-In-Text--PACKT-">itemShop</code>:&#13;
        <pre class="programlisting code"><code class="hljs-code">public class GameBehavior : MonoBehaviour, IManager&#13;
{&#13;
    // ... No other changes needed ...&#13;
     &#13;
     public void Initialize()&#13;
    {&#13;
        var itemShop = new Shop&lt;string&gt;();&#13;
        <strong class="hljs-comment-slc">// 2</strong>&#13;
        itemShop<strong class="hljs-slc">.AddItem(</strong><strong class="hljs-string-slc">"Potion"</strong><strong class="hljs-slc">);</strong>&#13;
        itemShop<strong class="hljs-slc">.AddItem(</strong><strong class="hljs-string-slc">"Antidote"</strong><strong class="hljs-slc">);</strong>&#13;
       Debug.Log("There are " + itemShop.inventory.Count + " items for sale.");&#13;
    }&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
    </ol>&#13;
    <p class="normal">Let's break <a id="_idIndexMarker877"/>down the code:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Declares a method for adding <code class="Code-In-Text--PACKT-">newItems</code> of type <code class="Code-In-Text--PACKT-">T</code> to the inventory</li>&#13;
      <li class="numbered">Adds two string items to <code class="Code-In-Text--PACKT-">itemShop</code> using <code class="Code-In-Text--PACKT-">AddItem()</code> and prints out a debug log:<figure class="mediaobject"><img src="img/B17573_13_02.png" alt="" width="721" height="145"/></figure>&#13;
    <p class="packt_figref">Figure 13.2: Console output after adding an item to a generic class</p>&#13;
      </li>&#13;
    </ol>&#13;
&#13;
    <p class="normal">We wrote <code class="Code-In-Text--PACKT-">AddItem()</code> to take in a parameter of the same type as our generic <code class="Code-In-Text--PACKT-">Shop</code> instance. Since <code class="Code-In-Text--PACKT-">itemShop</code> was created to hold string values, we add the <code class="Code-In-Text--PACKT-">"Potion"</code> and <code class="Code-In-Text--PACKT-">"Antidote"</code> string values without any issues. </p>&#13;
    <p class="normal">However, if you try and add an integer, for example, you'll get an error saying that the generic type of the <code class="Code-In-Text--PACKT-">itemShop</code> doesn't match:</p>&#13;
    <figure class="mediaobject"><img src="img/B17573_13_03.png" alt="" width="721" height="208"/></figure>&#13;
    <p class="packt_figref">Figure 13.3: Conversion error in a generic class</p>&#13;
    <p class="normal">Now that you've written a generic method, you need to know how to use multiple generic types in a single class. For example, what if we wanted to add a method to the <code class="Code-In-Text--PACKT-">Shop</code> class that finds <a id="_idIndexMarker878"/>out how many of a given item are in stock? We can't use type <code class="Code-In-Text--PACKT-">T</code> again because it's already been defined in the class definition. So what do we do?</p>&#13;
    <p class="normal">Add the following method to the bottom of the <code class="Code-In-Text--PACKT-">Shop</code> class:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">// 1&#13;
public int GetStockCount&lt;U&gt;()&#13;
{&#13;
    // 2&#13;
    var stock = 0;&#13;
    // 3&#13;
    foreach (var item in inventory)&#13;
    {&#13;
        if (item is U)&#13;
        {&#13;
            stock++;&#13;
        }&#13;
    }&#13;
    // 4&#13;
    return stock;&#13;
}&#13;
</code></pre>&#13;
    <p class="normal">Let's break down our new method:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Declares a method that returns an int value for how many matching items of type <code class="Code-In-Text--PACKT-">U</code> we find in the inventory<ul>&#13;
          <li class="bullet-l2">Generic type parameter naming is completely up to you, just like naming variables. Conventionally, they start at <code class="Code-In-Text--PACKT-">T</code> and continue in alphabetical order from there.</li>&#13;
        </ul>&#13;
      </li>&#13;
      <li class="numbered">Creates a variable to hold the number of matching stock items we find and eventually return from the inventory</li>&#13;
      <li class="numbered">Uses a <code class="Code-In-Text--PACKT-">foreach</code> loop to go through the inventory list and increase the stock value every time a match is found</li>&#13;
      <li class="numbered">Returns the number of matching stock items </li>&#13;
    </ol>&#13;
    <p class="normal">The problem here <a id="_idIndexMarker879"/>is that we're storing string values in our shop, so if we try and look up how many string items we have, we'll get the full inventory:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">Debug.Log("There are " + itemShop.GetStockCount&lt;string&gt;() + " items for sale.");&#13;
</code></pre>&#13;
    <p class="normal">This will print something like the following to the console:</p>&#13;
    <figure class="mediaobject"><img src="img/B17573_13_04.png" alt="" width="827" height="132"/></figure>&#13;
    <p class="packt_figref">Figure 13.4: Console output from using multiple generic string types</p>&#13;
    <p class="normal">On the other hand, if we tried to look up integer types in our inventory, we'd get no results because we're only storing strings:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">Debug.Log("There are " + itemShop.GetStockCount&lt;int&gt;() + " items for sale.");&#13;
</code></pre>&#13;
    <p class="normal">This will print something like the following to the console:</p>&#13;
    <p class="packt_figref"><img src="img/B17573_13_05.png" alt="" width="828" height="129"/></p>&#13;
    <p class="packt_figref">Figure 13.5: Console output using multiple non-matching generic types</p>&#13;
    <p class="normal">Neither of these scenarios is ideal since we can't make sure our shop inventory is storing AND can be searched for the same item type. But here's where generics really shine—we can add rules <a id="_idIndexMarker880"/>for our generic classes and methods to enforce the behavior we want, which we'll cover in the next section.</p>&#13;
    <h2 id="_idParaDest-256" class="title">Constraint type parameters</h2>&#13;
    <p class="normal">One of the great things about generics is that their type parameters can be limited. This might contradict <a id="_idIndexMarker881"/>what we've learned about generics so far, but just because a class <em class="italic">can</em> contain any type, doesn't mean it should be allowed to.</p>&#13;
    <p class="normal">To constrain a generic type parameter, we need a new keyword and a syntax we haven't seen before:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">public class SomeGenericCollection&lt;T&gt; where T: ConstraintType {}&#13;
</code></pre>&#13;
    <p class="normal">The <code class="Code-In-Text--PACKT-">where</code> keyword defines the rules that <code class="Code-In-Text--PACKT-">T</code> must pass before it can be used as a generic type parameter. It essentially says <code class="Code-In-Text--PACKT-">SomeGenericClass</code> can take in any <code class="Code-In-Text--PACKT-">T</code> type as long as it conforms to the constraining type. The constraining rules aren't anything mystical or scary; they're concepts we've already covered:</p>&#13;
    <ul>&#13;
      <li class="bullet">Adding the <code class="Code-In-Text--PACKT-">class</code> keyword would constrain <code class="Code-In-Text--PACKT-">T</code> to types that are classes</li>&#13;
      <li class="bullet">Adding the <code class="Code-In-Text--PACKT-">struct</code> keyword would constrain <code class="Code-In-Text--PACKT-">T</code> to types that are structs</li>&#13;
      <li class="bullet">Adding an interface, such as <code class="Code-In-Text--PACKT-">IManager</code>, as the type would limit <code class="Code-In-Text--PACKT-">T</code> to types that adopt the interface</li>&#13;
      <li class="bullet">Adding a custom class, such as <code class="Code-In-Text--PACKT-">Character</code>, would constrain <code class="Code-In-Text--PACKT-">T</code> to only that class type</li>&#13;
    </ul>&#13;
    <p>&#13;
      <p class="Information-Box--PACKT-">If you need a more flexible approach to account for classes that have subclasses, you can use <code class="Code-In-Text--PACKT-">where T : U</code>, which specifies that the generic <code class="Code-In-Text--PACKT-">T</code> type must be of, or derive from, the <code class="Code-In-Text--PACKT-">U</code> type. This is a little advanced for our needs, but you can find more details at <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/generics/constraints-on-type-parameters">https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/generics/constraints-on-type-parameters</a>.</p>&#13;
    </p>&#13;
    <p class="normal">Just for fun, let's constrain <code class="Code-In-Text--PACKT-">Shop</code> to only accept a new type called <code class="Code-In-Text--PACKT-">Collectable</code>:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Create a new script in the <code class="Code-In-Text--PACKT-">Scripts</code> folder, name it <code class="Code-In-Text--PACKT-">Collectable</code>, and add the following code:&#13;
        <pre class="programlisting code"><code class="hljs-code">using System.Collections;&#13;
using System.Collections.Generic;&#13;
using UnityEngine;&#13;
 &#13;
public class Collectable&#13;
{&#13;
    public string name;&#13;
}&#13;
 &#13;
public class Potion : Collectable&#13;
{&#13;
    public Potion()&#13;
    {&#13;
        this.name = "Potion";&#13;
    }&#13;
}&#13;
 &#13;
public class Antidote : Collectable&#13;
{&#13;
    public Antidote()&#13;
    {&#13;
        this.name = "Antidote";&#13;
    }&#13;
}&#13;
</code></pre>&#13;
        <p class="bullet-para">All we've <a id="_idIndexMarker882"/>done here is declare a new class called <code class="Code-In-Text--PACKT-">Collectable</code> with a name property, and created subclasses for potions and antidotes. With this structure, we can enforce our <code class="Code-In-Text--PACKT-">Shop</code> to only accept <code class="Code-In-Text--PACKT-">Collectable</code> types, and our stock finding method to only accept <code class="Code-In-Text--PACKT-">Collectable</code> types as well so we can compare them and find matches.</p>&#13;
      </li>&#13;
      <li class="numbered">Open up <code class="Code-In-Text--PACKT-">Shop</code> and update the class declaration:&#13;
        <pre class="programlisting code"><code class="hljs-code">public class Shop&lt;T&gt; <strong class="hljs-keyword-slc">where</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">T</strong><strong class="hljs-slc"> : </strong><strong class="hljs-title-slc">Collectable</strong>&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Update the <code class="Code-In-Text--PACKT-"> GetStockCount()</code> method to constrain <code class="Code-In-Text--PACKT-">U</code> to equal whatever the initial generic <code class="Code-In-Text--PACKT-">T</code> type is:&#13;
        <pre class="programlisting code"><code class="hljs-code">public int GetStockCount&lt;U&gt;() <strong class="hljs-keyword-slc">where</strong><strong class="hljs-function-slc"> U : T</strong>&#13;
{&#13;
    var stock = 0;&#13;
    foreach (var item in inventory)&#13;
    {&#13;
        if (item is U)&#13;
        {&#13;
            stock++;&#13;
        }&#13;
    }&#13;
    return stock;&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">In <code class="Code-In-Text--PACKT-">GameBehavior</code>, update the <code class="Code-In-Text--PACKT-">itemShop</code> instance to the following code:&#13;
        <pre class="programlisting code"><code class="hljs-code">var itemShop = new Shop&lt;<strong class="hljs-slc">Collectable</strong>&gt;();&#13;
itemShop.AddItem(<strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> Potion()</strong>);&#13;
itemShop.AddItem(<strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> Antidote()</strong>);&#13;
Debug.Log("There are " + itemShop.GetStockCount&lt;<strong class="hljs-slc">Potion</strong>&gt;() + " items for sale.");&#13;
</code></pre>&#13;
        <p class="bullet-para">This will result in output like the following:</p>&#13;
        <figure class="mediaobject"><img src="img/B17573_13_12.png" alt="" width="754" height="126"/></figure>&#13;
    <p class="packt_figref">Figure 13.6: Output from updated GameBehavior script</p>&#13;
      </li>&#13;
    </ol>&#13;
&#13;
    <p class="normal">In our <a id="_idIndexMarker883"/>example, we can ensure only collectable types are allowed in our shops. If we accidentally try and add non-collectable types in our code, Visual Studio will alert us about trying to break our own rules!</p>&#13;
    <h2 id="_idParaDest-257" class="title">Adding generics to Unity objects</h2>&#13;
    <p class="normal">Generics also work with Unity scripts and GameObjects. For example, we can easily create a <a id="_idIndexMarker884"/>generic destroyable class to use on any <code class="Code-In-Text--PACKT-">MonoBehaviour</code> or object <code class="Code-In-Text--PACKT-">Component</code> we want to delete from the scene. If this sounds familiar, it's <a id="_idIndexMarker885"/>what our <code class="Code-In-Text--PACKT-">BulletBehavior</code> does for us, but it's not applicable to anything other than that script. To make this more scalable, let's make any script that inherits from <code class="Code-In-Text--PACKT-">MonoBehaviour</code> destroyable.</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Create a new script in the <code class="Code-In-Text--PACKT-">Scripts</code> folder, name it <code class="Code-In-Text--PACKT-">Destroyable</code>, and add the following code:&#13;
        <pre class="programlisting code"><code class="hljs-code">using System.Collections;&#13;
using System.Collections.Generic;&#13;
using UnityEngine;&#13;
 &#13;
public class Destroyable&lt;T&gt; : MonoBehaviour where T : MonoBehaviour&#13;
{&#13;
    public int OnscreenDelay;&#13;
 &#13;
    void Start()&#13;
    {&#13;
        Destroy(this.gameObject, OnscreenDelay);&#13;
    }&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Delete all the code inside <code class="Code-In-Text--PACKT-">BulletBehavior</code> and inherit from the new generic class:&#13;
        <pre class="programlisting code"><code class="hljs-code">public class BulletBehavior : <strong class="hljs-title-slc">Destroyable</strong><strong class="hljs-slc">&lt;</strong><strong class="hljs-title-slc">BulletBehavior</strong><strong class="hljs-slc">&gt;</strong>&#13;
{&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
    </ol>&#13;
    <p class="normal">We've now turned our <code class="Code-In-Text--PACKT-">BulletBehavior</code> script into a generic destroyable object. Nothing changes in the Bullet Prefab, but we can make any other object destroyable by inheriting <a id="_idIndexMarker886"/>from the generic <code class="Code-In-Text--PACKT-">Destroyable</code> class. In our <a id="_idIndexMarker887"/>example, this would boost code efficiency and reusability if we created multiple projectile Prefabs and wanted them all to be destroyable, but at different times.</p>&#13;
    <p class="normal">Generic programming is a powerful tool in our toolbox, but with the basics covered it's time to talk about an equally important topic as you progress in your programming journey—delegation!</p>&#13;
    <h1 id="_idParaDest-258" class="title">Delegating actions</h1>&#13;
    <p class="normal">There will be times when you need to pass off, or delegate, the execution of a method from one <a id="_idIndexMarker888"/>file to another. In C#, this can be accomplished through delegate types, which store references to methods and can be treated like any other variable. The only caveat is that the delegate itself and any assigned method need to have the same signature—just like integer variables can only hold whole numbers and strings can only hold text.</p>&#13;
    <p class="normal">Creating a delegate is a mix between writing a function and declaring a variable:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">public <strong class="hljs-built_in-slc">delegate</strong> returnType DelegateName(int param1, string param2);&#13;
</code></pre>&#13;
    <p class="normal">You start with an access modifier followed by the <code class="Code-In-Text--PACKT-">delegate</code> keyword, which identifies it to the compiler as a <code class="Code-In-Text--PACKT-">delegate</code> type. A <code class="Code-In-Text--PACKT-">delegate</code> type can have a return type and name as a regular function, as well as parameters if needed. However, this syntax only declares the <code class="Code-In-Text--PACKT-">delegate</code> type itself; to use it, you need to create an instance as we do with classes:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">public <strong class="hljs-slc">DelegateName</strong> someDelegate;&#13;
</code></pre>&#13;
    <p class="normal">With a <code class="Code-In-Text--PACKT-">delegate</code> type variable declared, it's easy to assign a method that matches the delegate signature:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">public DelegateName someDelegate = <strong class="hljs-slc">MatchingMethod</strong>;&#13;
public void <strong class="hljs-title-slc">MatchingMethod</strong><strong class="hljs-function-slc">(</strong><strong class="hljs-built_in-slc">int</strong><strong class="hljs-params-slc"> param1, </strong><strong class="hljs-built_in-slc">string</strong><strong class="hljs-params-slc"> param2</strong><strong class="hljs-function-slc">)</strong> &#13;
{&#13;
    // ... Executing code here ...&#13;
}&#13;
</code></pre>&#13;
    <p class="normal">Notice that <a id="_idIndexMarker889"/>you don't include the parentheses when assigning <code class="Code-In-Text--PACKT-">MatchingMethod</code> to the <code class="Code-In-Text--PACKT-">someDelegate</code> variable, as it's not calling the method at this point. What it's doing is delegating the calling responsibility of <code class="Code-In-Text--PACKT-">MatchingMethod</code> to <code class="Code-In-Text--PACKT-">someDelegate</code>, which means we can call the function as follows:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">someDelegate();&#13;
</code></pre>&#13;
    <p class="normal">This might seem cumbersome at this point in your C# skill development, but I promise you that being able to store and execute methods as variables will come in handy down the road.</p>&#13;
    <h2 id="_idParaDest-259" class="title">Creating a debug delegate</h2>&#13;
    <p class="normal">Let's create a simple delegate type to define a method that takes in a string and eventually <a id="_idIndexMarker890"/>prints it out using an assigned method. Open up <code class="Code-In-Text--PACKT-">GameBehavior</code> and add the following code:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">public class GameBehavior : MonoBehaviour, IManager&#13;
{&#13;
    // ... No other changes needed ...&#13;
 &#13;
    <strong class="hljs-comment-slc">// 1</strong>&#13;
    <strong class="hljs-keyword-slc">public</strong><strong class="hljs-function-slc"> </strong><strong class="hljs-built_in-slc">delegate</strong><strong class="hljs-function-slc"> </strong><strong class="hljs-keyword-slc">void</strong><strong class="hljs-function-slc"> </strong><strong class="hljs-title-slc">DebugDelegate</strong><strong class="hljs-function-slc">(</strong><strong class="hljs-built_in-slc">string</strong><strong class="hljs-params-slc"> newText</strong><strong class="hljs-function-slc">)</strong><strong class="hljs-slc">;</strong>&#13;
 &#13;
    <strong class="hljs-comment-slc">// 2</strong>&#13;
    <strong class="hljs-keyword-slc">public</strong><strong class="hljs-slc"> DebugDelegate debug = Print;</strong>&#13;
 &#13;
    public void Initialize() &#13;
    {&#13;
        _state = "Game Manager initialized..";&#13;
        _state.FancyDebug();&#13;
        <strong class="hljs-comment-slc">// 3</strong>&#13;
        <strong class="hljs-slc">debug(_state);</strong>&#13;
   // ... No changes needed ...&#13;
    }&#13;
    <strong class="hljs-comment-slc">// 4</strong>&#13;
    <strong class="hljs-keyword-slc">public</strong><strong class="hljs-function-slc"> </strong><strong class="hljs-keyword-slc">static</strong><strong class="hljs-function-slc"> </strong><strong class="hljs-keyword-slc">void</strong><strong class="hljs-function-slc"> </strong><strong class="hljs-title-slc">Print</strong><strong class="hljs-function-slc">(</strong><strong class="hljs-built_in-slc">string</strong><strong class="hljs-params-slc"> newText</strong><strong class="hljs-function-slc">)</strong>&#13;
    <strong class="hljs-slc">{</strong>&#13;
        <strong class="hljs-slc">Debug.Log(newText);</strong>&#13;
    <strong class="hljs-slc">}</strong>&#13;
}&#13;
</code></pre>&#13;
    <p class="normal">Let's <a id="_idIndexMarker891"/>break down the code:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Declares a <code class="Code-In-Text--PACKT-">public delegate</code> type named <code class="Code-In-Text--PACKT-">DebugDelegate</code> to hold a method that takes in a <code class="Code-In-Text--PACKT-">string</code> parameter and returns <code class="Code-In-Text--PACKT-">void</code></li>&#13;
      <li class="numbered">Creates a new <code class="Code-In-Text--PACKT-">DebugDelegate</code> instance named <code class="Code-In-Text--PACKT-">debug</code> and assigns it a method with a matching signature named <code class="Code-In-Text--PACKT-">Print()</code></li>&#13;
      <li class="numbered">Replaces the <code class="Code-In-Text--PACKT-">Debug.Log(_state)</code> code inside <code class="Code-In-Text--PACKT-">Initialize()</code> with a call to the <code class="Code-In-Text--PACKT-">debug</code> delegate instance instead</li>&#13;
      <li class="numbered">Declares <code class="Code-In-Text--PACKT-">Print()</code> as a <code class="Code-In-Text--PACKT-">static</code> method that takes in a <code class="Code-In-Text--PACKT-">string</code> parameter and logs it to the console:<figure class="mediaobject"><img src="img/B17573_13_06.png" alt="" width="751" height="159"/></figure>&#13;
    <p class="packt_figref">Figure 13.7: Console output from a delegate action</p>&#13;
      </li>&#13;
    </ol>&#13;
&#13;
    <p class="normal">Nothing in the console has changed, but instead of directly calling <code class="Code-In-Text--PACKT-">Debug.Log()</code> inside <code class="Code-In-Text--PACKT-">Initialize()</code>, that operation has been delegated to the <code class="Code-In-Text--PACKT-">debug</code> delegate instance. While this is a simplistic example, delegation is a powerful tool when you need to store, pass, and execute methods as their types.</p>&#13;
    <p class="normal">In Unity, we've <a id="_idIndexMarker892"/>already worked with examples of delegation by using the <code class="Code-In-Text--PACKT-">OnCollisionEnter()</code> and <code class="Code-In-Text--PACKT-">OnCollisionExit()</code> methods, which are methods that are called through delegation. In the real world, custom delegates are most useful when paired with events, which we'll see in a later section of this chapter.</p>&#13;
    <h2 id="_idParaDest-260" class="title">Delegates as parameter types</h2>&#13;
    <p class="normal">Since we've seen how to create delegate types for storing methods, it makes sense that a delegate <a id="_idIndexMarker893"/>type could also be used as a method parameter itself. This isn't that far removed from what we've already done, but it's a good idea to cover our bases.</p>&#13;
    <p class="normal">Let's see how a delegate type can be used as a method parameter. Update <code class="Code-In-Text--PACKT-">GameBehavior</code> with the following code:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">public class GameBehavior : MonoBehaviour, IManager&#13;
{&#13;
    // ... No changes needed ...&#13;
    public void Initialize() &#13;
    {&#13;
        _state = "Game Manager initialized..";&#13;
        _state.FancyDebug();&#13;
        debug(_state);&#13;
        <strong class="hljs-comment-slc">// 1</strong>&#13;
        <strong class="hljs-slc">LogWithDelegate(debug);</strong>&#13;
    }&#13;
    <strong class="hljs-comment-slc">// 2</strong>&#13;
    <strong class="hljs-keyword-slc">public</strong><strong class="hljs-function-slc"> </strong><strong class="hljs-keyword-slc">void</strong><strong class="hljs-function-slc"> </strong><strong class="hljs-title-slc">LogWithDelegate</strong><strong class="hljs-function-slc">(</strong><strong class="hljs-params-slc">DebugDelegate del</strong><strong class="hljs-function-slc">)</strong>&#13;
    <strong class="hljs-slc">{</strong>&#13;
        <strong class="hljs-comment-slc">// 3</strong>&#13;
        <strong class="hljs-slc">del(</strong><strong class="hljs-string-slc">"Delegating the debug task..."</strong><strong class="hljs-slc">);</strong>&#13;
    <strong class="hljs-slc">}</strong>&#13;
}&#13;
</code></pre>&#13;
    <p class="normal">Let's break down the code:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Calls <code class="Code-In-Text--PACKT-">LogWithDelegate()</code> and passes in our <code class="Code-In-Text--PACKT-">debug</code> variable as its type parameter</li>&#13;
      <li class="numbered">Declares a new method that takes in a parameter of the <code class="Code-In-Text--PACKT-">DebugDelegate</code> type</li>&#13;
      <li class="numbered">Calls the <a id="_idIndexMarker894"/>delegate parameter's function and passes in a string literal to be printed out:<figure class="mediaobject"><img src="img/B17573_13_07.png" alt="" width="750" height="197"/></figure>&#13;
    <p class="packt_figref">Figure 13.8: Console output of a delegate as a parameter type</p>&#13;
      </li>&#13;
    </ol>&#13;
&#13;
    <p class="normal">We've created a method that takes in a parameter of the <code class="Code-In-Text--PACKT-">DebugDelegate</code> type, which means that the actual argument passed in will represent a method and can be treated as one. Think of this example as a delegation chain, where <code class="Code-In-Text--PACKT-">LogWithDelegate()</code> is two steps removed from the actual method doing the debugging, which is <code class="Code-In-Text--PACKT-">Print()</code>. Creating a delegation chain like this isn't always a common solution in a game or application scenario, but when you need to control levels of delegation it's important to understand the syntax involved. This is especially true in scenarios where your delegation chain is spread across multiple scripts or classes.</p>&#13;
    <p>&#13;
      <p class="Information-Box--PACKT-">It's easy to get lost with delegation if you miss an important mental connection, so go back and review the code from the beginning of the section and check the docs at <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/delegates/">https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/delegates/</a>.</p>&#13;
    </p>&#13;
    <p class="normal">Now that you know how to work with basic delegates, it's time to talk about how events can be <a id="_idIndexMarker895"/>used to efficiently communicate information between multiple scripts. Honestly, the best use case for a delegate is being paired with events, which we'll dive into next.</p>&#13;
    <h1 id="_idParaDest-261" class="title">Firing events</h1>&#13;
    <p class="normal">C# events allow you to essentially create a subscription system based on actions in your games or apps. For instance, if you wanted to send out an event whenever an item is collected, or when <a id="_idIndexMarker896"/>a player presses the spacebar, you could do that. However, when an event fires, it doesn't automatically have a subscriber, or receiver, to handle any code that needs to execute after the event action.</p>&#13;
    <p class="normal">Any class can subscribe or unsubscribe to an event through the calling class the event is fired from; just like signing up to receive notifications on your phone when a new post is shared on Facebook, events form a kind of distributed-information superhighway for sharing actions and data across your application.</p>&#13;
    <p class="normal">Declaring events is similar to declaring delegates in that an event has a specific method signature. We'll use a delegate to specify the method signature we want the event to have, then create the event using the <code class="Code-In-Text--PACKT-">delegate</code> type and the <code class="Code-In-Text--PACKT-">event</code> keyword:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">public delegate void EventDelegate(int param1, string param2);&#13;
public <strong class="hljs-keyword-slc">event</strong> EventDelegate eventInstance;&#13;
</code></pre>&#13;
    <p class="normal">This setup allows us to treat <code class="Code-In-Text--PACKT-">eventInstance</code> as a method because it's a delegate type, which means we can send it out at any time by calling it:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">eventInstance(35, "John Doe");&#13;
</code></pre>&#13;
    <p class="normal">Your next task is to create an event of your own and fire it off in the appropriate place inside <code class="Code-In-Text--PACKT-">PlayerBehavior</code>.</p>&#13;
    <h2 id="_idParaDest-262" class="title">Creating and invoking events</h2>&#13;
    <p class="normal">Let's create <a id="_idIndexMarker897"/>an event to fire off any time our player jumps. Open up <code class="Code-In-Text--PACKT-">PlayerBehavior</code> and add <a id="_idIndexMarker898"/>the following changes:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">public class PlayerBehavior : MonoBehaviour &#13;
{&#13;
    // ... No other variable changes needed ...&#13;
    <strong class="hljs-comment-slc">// 1</strong>&#13;
    <strong class="hljs-keyword-slc">public</strong><strong class="hljs-function-slc"> </strong><strong class="hljs-built_in-slc">delegate</strong><strong class="hljs-function-slc"> </strong><strong class="hljs-keyword-slc">void</strong><strong class="hljs-function-slc"> </strong><strong class="hljs-title-slc">JumpingEvent</strong><strong class="hljs-function-slc">()</strong><strong class="hljs-slc">;</strong>&#13;
    <strong class="hljs-comment-slc">// 2</strong>&#13;
    <strong class="hljs-keyword-slc">public</strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">event</strong><strong class="hljs-slc"> JumpingEvent playerJump;</strong>&#13;
    void Start()&#13;
    {&#13;
        // ... No changes needed ...&#13;
    }&#13;
    void Update() &#13;
    {&#13;
        // ... No changes needed ...&#13;
;&#13;
    }&#13;
    void FixedUpdate()&#13;
    {&#13;
        if(IsGrounded() &amp;&amp;  _isJumping)&#13;
        {&#13;
            _rb.AddForce(Vector3.up * jumpVelocity,&#13;
               ForceMode.Impulse);&#13;
            <strong class="hljs-comment-slc">// 3</strong>&#13;
            <strong class="hljs-slc">playerJump();</strong>&#13;
        }&#13;
    }&#13;
    // ... No changes needed in IsGrounded or OnCollisionEnter&#13;
}&#13;
</code></pre>&#13;
    <p class="normal">Let's break down the code:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Declares a new <code class="Code-In-Text--PACKT-">delegate</code> type that returns <code class="Code-In-Text--PACKT-">void</code> and takes in no parameters</li>&#13;
      <li class="numbered">Creates an event of the <code class="Code-In-Text--PACKT-">JumpingEvent</code> type, named <code class="Code-In-Text--PACKT-">playerJump</code>, that can be treated as a method that matches the preceding delegate's <code class="Code-In-Text--PACKT-">void</code> return and no parameter signature</li>&#13;
      <li class="numbered">Calls <code class="Code-In-Text--PACKT-">playerJump</code> after the force is applied in <code class="Code-In-Text--PACKT-">Update()</code></li>&#13;
    </ol>&#13;
    <p class="normal">We have <a id="_idIndexMarker899"/>successfully created a simple delegate type that takes in no parameters <a id="_idIndexMarker900"/>and returns nothing, as well as an event of that type to execute whenever the player jumps. Each time the player jumps, the <code class="Code-In-Text--PACKT-">playerJump</code> event is sent out to all of its subscribers to notify them of the action.</p>&#13;
    <p class="normal">After the event fires, it's up to its subscribers to process it and do any additional operations, which we'll see in the <em class="italic">Handling event subscriptions</em> section, next.</p>&#13;
    <h2 id="_idParaDest-263" class="title">Handling event subscriptions</h2>&#13;
    <p class="normal">Right now, our <code class="Code-In-Text--PACKT-">playerJump</code> event has no subscribers, but changing that is simple and very similar to how we assigned method references to delegate types in the last section:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">someClass.eventInstance += EventHandler;&#13;
</code></pre>&#13;
    <p class="normal">Since events <a id="_idIndexMarker901"/>are variables that belong to the class they're declared in, and subscribers will be other classes, a reference to the event-containing class is necessary for subscriptions. The <code class="Code-In-Text--PACKT-">+=</code> operator is used to assign a method that will fire when an event executes, just like setting up an out-of-office email. Like assigning delegates, the method signature of the event handler method must match the event's type. In our previous syntax example, that means <code class="Code-In-Text--PACKT-">EventHandler</code> needs to be the following:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">public void EventHandler(int param1, string param2) {}&#13;
</code></pre>&#13;
    <p class="normal">In cases where you need to unsubscribe from an event, you simply do the reverse of the assignment by using the <code class="Code-In-Text--PACKT-">-=</code> operator:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">someClass.eventInstance -= EventHandler;&#13;
</code></pre>&#13;
    <p>&#13;
      <p class="Information-Box--PACKT-">Event subscriptions are generally handled when a class is initialized or destroyed, making it easy to manage multiple events without messy code implementations.</p>&#13;
    </p>&#13;
    <p class="normal">Now that you know the syntax for subscribing and unsubscribing to events, it's your turn to put this into practice in the <code class="Code-In-Text--PACKT-">GameBehavior</code> script.</p>&#13;
    <p class="normal">Now that <a id="_idIndexMarker902"/>our event is firing every time the player jumps, we need a way to capture that action:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Go back to <code class="Code-In-Text--PACKT-">GameBehavior</code> and update the following code:&#13;
        <pre class="programlisting code"><code class="hljs-code">public class GameBehavior : MonoBehaviour, IManager&#13;
{&#13;
    // 1&#13;
    public PlayerBehavior playerBehavior;&#13;
 &#13;
    // 2&#13;
    void OnEnable()&#13;
    {&#13;
        // 3&#13;
        GameObject player = GameObject.Find("Player");&#13;
        // 4&#13;
        playerBehavior = player.GetComponent&lt;PlayerBehavior&gt;();&#13;
        // 5&#13;
        playerBehavior.playerJump += HandlePlayerJump;&#13;
        debug("Jump event subscribed...");&#13;
    }&#13;
 &#13;
    // 6&#13;
    public void HandlePlayerJump()&#13;
    {&#13;
         debug("Player has jumped...");&#13;
    <strong class="hljs-slc">}</strong>&#13;
    // ... No other changes ...&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
    </ol>&#13;
    <p class="normal">Let's break down the code:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Creates a public variable of type <code class="Code-In-Text--PACKT-">PlayerBehavior </code></li>&#13;
      <li class="numbered">Declares the<code class="Code-In-Text--PACKT-"> OnEnable() </code>method, which is called whenever the object the script is attached to becomes active in the scene<p>&#13;
          <p class="Information-Box--PACKT-"><code class="Code-In-Text--PACKT-">OnEnable</code> is a method in the <code class="Code-In-Text--PACKT-">MonoBehaviour</code> class, so all Unity scripts have access to it. This is a great place to put event subscriptions instead of <code class="Code-In-Text--PACKT-">Awake</code> because it only executes when the object is active, not just in the process of loading.</p>&#13;
        </p>&#13;
      </li>&#13;
      <li class="numbered">Finds the <code class="Code-In-Text--PACKT-">Player</code> object in the scene and stores its <code class="Code-In-Text--PACKT-">GameObject</code> in a local variable</li>&#13;
      <li class="numbered">Uses <code class="Code-In-Text--PACKT-">GetComponent()</code> to retrieve a reference to the <code class="Code-In-Text--PACKT-">PlayerBehavior</code> class attached to the <code class="Code-In-Text--PACKT-">Player</code> and stores it in the <code class="Code-In-Text--PACKT-">playerBehavior</code> variable</li>&#13;
      <li class="numbered">Subscribes to the <code class="Code-In-Text--PACKT-">playerJump</code> event declared in <code class="Code-In-Text--PACKT-">PlayerBehavior</code> with a method named <code class="Code-In-Text--PACKT-">HandlePlayerJump</code> using the <code class="Code-In-Text--PACKT-">+=</code> operator</li>&#13;
      <li class="numbered">Declares the <code class="Code-In-Text--PACKT-">HandlePlayerJump()</code> method with a signature that matches the event's <a id="_idIndexMarker903"/>type and logs a success message using the debug delegate each time the event is received:<figure class="mediaobject"><img src="img/B17573_13_08.png" alt="" width="627" height="100"/></figure>&#13;
    <p class="packt_figref">Figure 13.9: Console output from a delegate event subscription</p>&#13;
      </li>&#13;
    </ol>&#13;
&#13;
    <p class="normal">To correctly subscribe and receive events in <code class="Code-In-Text--PACKT-">GameBehavior</code>, we had to grab a reference to the <code class="Code-In-Text--PACKT-">PlayerBehavior</code> class attached to the player. We could have done this all in one line, but it's much more readable when it's split up. We then assigned a method to the <code class="Code-In-Text--PACKT-">playerJump</code> event that will execute whenever the event is received, and complete the subscription process.</p>&#13;
    <p class="normal">Now each time you jump, you'll see a debug message with the event message:</p>&#13;
    <figure class="mediaobject"><img src="img/B17573_13_09.png" alt="" width="529" height="43"/></figure>&#13;
    <p class="packt_figref">Figure 13.10: Console output from a delegate event firing</p>&#13;
    <p class="normal">Since event subscriptions are configured in scripts, and scripts are attached to Unity objects, our job isn't done yet. We still need to handle how we clean up subscriptions when the <a id="_idIndexMarker904"/>object is destroyed or removed from the scene, which we'll cover in the next section.</p>&#13;
    <h2 id="_idParaDest-264" class="title">Cleaning up event subscriptions</h2>&#13;
    <p class="normal">Even though our player is never destroyed in our prototype, that's a common feature in games when <a id="_idIndexMarker905"/>you lose. It's always important to clean up event subscriptions because they take up allocated resources, as we discussed with streams in <em class="chapterRef">Chapter 12</em>, <em class="italic">Saving, Loading, and Serializing Data</em>.</p>&#13;
    <p class="normal">We don't want any subscriptions hanging around after the subscribed object has been destroyed, so let's clean up our jumping event. Add the following code to <code class="Code-In-Text--PACKT-">GameBehavior </code>after the <code class="Code-In-Text--PACKT-">OnEnable</code> method:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">// 1&#13;
private void OnDisable()&#13;
{&#13;
    // 2&#13;
    playerBehavior.playerJump -= HandlePlayerJump;&#13;
    debug("Jump event unsubscribed...");&#13;
}&#13;
</code></pre>&#13;
    <p class="normal">Let's break down our new code addition:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Declares the <code class="Code-In-Text--PACKT-">OnDisable()</code> method, which belongs to the <code class="Code-In-Text--PACKT-">MonoBehavior</code> class and is the companion to the <code class="Code-In-Text--PACKT-">OnEnable()</code> method we used earlier<ul>&#13;
          <li class="bullet-l2">Any cleanup code you need to write should generally go in this method, as it executes when the object the script is attached to is inactive</li>&#13;
        </ul>&#13;
      </li>&#13;
      <li class="numbered">Unsubscribes the <code class="Code-In-Text--PACKT-">playerJump</code> event from <code class="Code-In-Text--PACKT-">HandlePlayerJump</code> using the <code class="Code-In-Text--PACKT-">-=</code> operator and print out a console message</li>&#13;
    </ol>&#13;
    <p class="normal">Now our script properly subscribes and unsubscribes to an event when the GameObject is enabled and disabled, leaving no unused resources in our game scene.</p>&#13;
    <p class="normal">That wraps up our discussion on events. Now you can broadcast them to every corner of your game from a single script and react to scenarios like a player losing life, collecting items, or updating the UI. However, we still have to discuss a very important topic that no program can succeed without, and that's error handling.</p>&#13;
    <h1 id="_idParaDest-265" class="title">Handling exceptions</h1>&#13;
    <p class="normal">Efficiently incorporating errors and exceptions into your code is both a professional and personal benchmark <a id="_idIndexMarker906"/>in your programming journey. Before you start yelling "Why would I add errors when I've spent all this time trying to avoid them?!", you should know that I don't mean adding errors to break your existing code. It's quite the opposite—including errors or exceptions and handling them appropriately when pieces of functionality are used incorrectly makes your code base stronger and less prone to crashes, not weaker.</p>&#13;
    <h2 id="_idParaDest-266" class="title">Throwing exceptions</h2>&#13;
    <p class="normal">When we talk about adding errors, we refer to the process as <em class="italic">exception throwing</em>, which is an apt visual analogy. Throwing exceptions is part of something called defensive programming, which <a id="_idIndexMarker907"/>essentially means that you actively and consciously guard against improper or unplanned operations in your code. To mark those situations, you throw out an exception from a method that is then handled by the calling code.</p>&#13;
    <p class="normal">Let's take an example: say we have an <code class="Code-In-Text--PACKT-">if</code> statement that checks whether a player's email address is valid before letting them sign up. If the email entered is not valid, we want our code to throw an exception:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">public void ValidateEmail(string email)&#13;
{&#13;
    if(!email.Contains("@"))&#13;
    {&#13;
        <strong class="hljs-keyword-slc">throw</strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> System.ArgumentException(</strong><strong class="hljs-string-slc">"Email is invalid"</strong><strong class="hljs-slc">);</strong>&#13;
    }&#13;
}&#13;
</code></pre>&#13;
    <p class="normal">We use the <code class="Code-In-Text--PACKT-">throw</code> keyword to send out the exception, which is created with the <code class="Code-In-Text--PACKT-">new</code> keyword followed by the exception we specify. <code class="Code-In-Text--PACKT-">System.ArgumentException()</code> will log the information about where and when the exception was executed by default, but can also accept a custom string if you want to be more specific.</p>&#13;
    <p class="normal"><code class="Code-In-Text--PACKT-">ArgumentException</code> is a subclass of the <code class="Code-In-Text--PACKT-">Exception</code> class and is accessed through the <code class="Code-In-Text--PACKT-">System</code> class shown previously. C# comes with many built-in exception types, including subclasses for checking for null values, out or range collection values, and invalid operations. Exceptions are a prime example of using the right tool for the right job. Our example only needs the basic <code class="Code-In-Text--PACKT-">ArgumentException</code>, but you can find the full descriptive list at <a href="https://docs.microsoft.com/en-us/dotnet/api/system.exception#Standard">https://docs.microsoft.com/en-us/dotnet/api/system.exception#Standard</a>.</p>&#13;
    <p class="normal">Let's keep things simple on our first foray into exceptions and make sure that our level only restarts if <a id="_idIndexMarker908"/>we provide a positive scene index number:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Open up <code class="Code-In-Text--PACKT-">Utilities</code> and add the following code to the overloaded version of <code class="Code-In-Text--PACKT-">RestartLevel(int)</code>:&#13;
        <pre class="programlisting code"><code class="hljs-code">public static class Utilities &#13;
{&#13;
    // ... No changes needed ...&#13;
    public static bool RestartLevel(int sceneIndex) &#13;
    {&#13;
        <strong class="hljs-comment-slc">// 1</strong>&#13;
        <strong class="hljs-keyword-slc">if</strong><strong class="hljs-slc">(sceneIndex &lt; </strong><strong class="hljs-number-slc">0</strong><strong class="hljs-slc">)</strong>&#13;
        <strong class="hljs-slc">{</strong>&#13;
            <strong class="hljs-comment-slc">// 2</strong>&#13;
            <strong class="hljs-keyword-slc">throw</strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> System.ArgumentException(</strong><strong class="hljs-string-slc">"Scene index cannot be negative"</strong><strong class="hljs-slc">);</strong>&#13;
         <strong class="hljs-slc">}</strong>&#13;
 &#13;
        Debug.Log("Player deaths: " + PlayerDeaths);&#13;
        string message = UpdateDeathCount(ref PlayerDeaths);&#13;
        Debug.Log("Player deaths: " + PlayerDeaths);&#13;
        Debug.Log(message);&#13;
   &#13;
        SceneManager.LoadScene(sceneIndex);&#13;
        Time.timeScale = 1.0f;&#13;
 &#13;
        return true;&#13;
    }&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numbered">Change <code class="Code-In-Text--PACKT-">RestartLevel()</code> in <code class="Code-In-Text--PACKT-">GameBehavior</code> to take in a negative scene index and lose the game:&#13;
        <pre class="programlisting code"><code class="hljs-code">// 3&#13;
public void RestartScene()&#13;
{&#13;
    Utilities.RestartLevel(<strong class="hljs-number-slc">-1</strong>);&#13;
}&#13;
</code></pre>&#13;
      </li>&#13;
    </ol>&#13;
    <p class="normal">Let's break down the code:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Declares an <code class="Code-In-Text--PACKT-">if</code> statement to check that <code class="Code-In-Text--PACKT-">sceneIndex</code> is not less than 0 or a negative number</li>&#13;
      <li class="numbered">Throws an <code class="Code-In-Text--PACKT-">ArgumentException</code> with a custom message if a negative scene index is passed in as an argument</li>&#13;
      <li class="numbered">Calls <code class="Code-In-Text--PACKT-">RestartLevel()</code> with a scene index of <code class="Code-In-Text--PACKT-">-1</code>:<figure class="mediaobject"><img src="img/B17573_13_10.png" alt="" width="521" height="43"/></figure>&#13;
    <p class="packt_figref">Figure 13.11: Console output when an exception is thrown</p>&#13;
      </li>&#13;
    </ol>&#13;
&#13;
    <p class="normal">When we lose the game now, <code class="Code-In-Text--PACKT-">RestartLevel()</code> is called, but since we're using <code class="Code-In-Text--PACKT-">-1</code> as the scene index <a id="_idIndexMarker909"/>argument, our exception is fired before any of the scene manager logic is executed. We don't have any other scenes configured in our game at the moment, but this defensive code acts as a safeguard and doesn't let us take an action that might crash the game (Unity doesn't support negative indexes when loading scenes).</p>&#13;
    <p class="normal">Now that you've successfully thrown an error, you need to know how to handle the fallout from the error, which leads us to our next section and the <code class="Code-In-Text--PACKT-">try-catch</code> statement.</p>&#13;
    <h2 id="_idParaDest-267" class="title">Using try-catch</h2>&#13;
    <p class="normal">Now that we've thrown an error, it's our job to safely handle the possible outcomes that calling <code class="Code-In-Text--PACKT-">RestartLevel()</code> might have <a id="_idIndexMarker910"/>because at this point, this is not addressed properly. The way to do this is with a new kind of statement, called <code class="Code-In-Text--PACKT-">try-catch</code>:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">try&#13;
{&#13;
    // Call a method that might throw an exception&#13;
}&#13;
catch (ExceptionType localVariable)&#13;
{&#13;
    // Catch all exception cases individually&#13;
}&#13;
</code></pre>&#13;
    <p class="normal">The <code class="Code-In-Text--PACKT-">try-catch</code> statement is made up of consecutive code blocks that are executed on different conditions; it's like a specialized <code class="Code-In-Text--PACKT-">if</code>/<code class="Code-In-Text--PACKT-">else</code> statement. We call any methods that potentially throw exceptions in the <code class="Code-In-Text--PACKT-">try</code> block—if no exceptions are thrown, the code keeps executing without interruption. If an exception is thrown, the code jumps to the <code class="Code-In-Text--PACKT-">catch</code> statement that matches the thrown exception, just like <code class="Code-In-Text--PACKT-">switch</code> statements do with their cases. <code class="Code-In-Text--PACKT-">catch</code> statements need to define what exception they are accounting for and specify a local variable name that will represent it inside the <code class="Code-In-Text--PACKT-">catch</code> block.</p>&#13;
    <p class="normal">You can chain as many <code class="Code-In-Text--PACKT-">catch</code> statements after the <code class="Code-In-Text--PACKT-">try</code> block as you need to handle multiple exceptions thrown from a single method, provided they are catching different exceptions. For example:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">try&#13;
{&#13;
    // Call a method that might throw an exception&#13;
}&#13;
catch (ArgumentException argException)&#13;
{&#13;
    // Catch argument exceptions here&#13;
}&#13;
catch (FileNotFoundException fileException)&#13;
{&#13;
    // Catch exceptions for files not found here&#13;
}&#13;
</code></pre>&#13;
    <p class="normal">There's also an optional <code class="Code-In-Text--PACKT-">finally</code> block that can be declared after any <code class="Code-In-Text--PACKT-">catch</code> statements that will execute <a id="_idIndexMarker911"/>at the very end of the <code class="Code-In-Text--PACKT-">try-catch</code> statement, regardless of whether an exception was thrown:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">finally&#13;
{&#13;
    // Executes at the end of the try-catch no matter what&#13;
}&#13;
</code></pre>&#13;
    <p class="normal">Your next task is to use a <code class="Code-In-Text--PACKT-">try-catch</code> statement to handle any errors thrown from restarting the level unsuccessfully. Now that we have an exception that is thrown when we lose the game, let's handle it safely. Update <code class="Code-In-Text--PACKT-">GameBehavior</code> with the following code and lose the game again:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">public class GameBehavior : MonoBehaviour, IManager&#13;
{&#13;
    // ... No variable changes needed ...&#13;
    public void RestartScene()&#13;
    {&#13;
        // 1 &#13;
        try&#13;
        {&#13;
            Utilities.RestartLevel(-1);&#13;
            debug("Level successfully restarted...");&#13;
        }&#13;
        // 2&#13;
        catch (System.ArgumentException exception)&#13;
        {&#13;
            // 3&#13;
            Utilities.RestartLevel(0);&#13;
            debug("Reverting to scene 0: " + exception.ToString());&#13;
        }&#13;
        // 4&#13;
        finally&#13;
        {&#13;
            debug("Level restart has completed...");&#13;
        }&#13;
    }&#13;
}&#13;
</code></pre>&#13;
    <p class="normal">Let's break <a id="_idIndexMarker912"/>down the code:</p>&#13;
    <ol>&#13;
      <li class="numbered" value="1">Declares the <code class="Code-In-Text--PACKT-">try</code> block and moves the call to <code class="Code-In-Text--PACKT-">RestartLevel()</code> inside with a <code class="Code-In-Text--PACKT-">debug</code> command to print out if the restart is completed without any exceptions.</li>&#13;
      <li class="numbered">Declares the <code class="Code-In-Text--PACKT-">catch</code> block and defines <code class="Code-In-Text--PACKT-">System.ArgumentException</code> as the exception type it will handle and <code class="Code-In-Text--PACKT-">exception</code> as the local variable name.</li>&#13;
      <li class="numbered">Restarts the game at the default scene index if the exception is thrown:<ul>&#13;
          <li class="bullet-l2">Uses the <code class="Code-In-Text--PACKT-">debug</code> delegate to print out a custom message, plus the exception information, which can be accessed from <code class="Code-In-Text--PACKT-">exception</code> and converted into a string with the <code class="Code-In-Text--PACKT-">ToString()</code> method</li>&#13;
        </ul>&#13;
        <p class="bullet-para">Since <code class="Code-In-Text--PACKT-">exception</code> is of the <code class="Code-In-Text--PACKT-">ArgumentException</code> type, there are several properties and methods associated with the <code class="Code-In-Text--PACKT-">Exception</code> class that you can access. These are often useful when you need detailed information about a particular exception.</p>&#13;
      </li>&#13;
      <li class="numbered">Adds a <code class="Code-In-Text--PACKT-">finally</code> block with a debug message to signal the end of the exception-handling code:<figure class="mediaobject"><img src="img/B17573_13_11.png" alt="" width="573" height="119"/></figure>&#13;
    <p class="packt_figref">Figure 13.12: Console output of a complete try-catch statement</p>&#13;
      </li>&#13;
    </ol>&#13;
&#13;
    <p class="normal">When <code class="Code-In-Text--PACKT-">RestartLevel()</code> is called now, our <code class="Code-In-Text--PACKT-">try</code> block safely allows it to execute, and if an error is thrown, it's caught inside the <code class="Code-In-Text--PACKT-">catch</code> block. The <code class="Code-In-Text--PACKT-">catch</code> block restarts the level at the default scene index and the code proceeds to the <code class="Code-In-Text--PACKT-">finally</code> block, which simply logs a message for us.</p>&#13;
    <p class="normal">It's important to <a id="_idIndexMarker913"/>understand how to work with exceptions, but you shouldn't get into the habit of putting them everywhere in your code. This will lead to bloated classes and might affect the game's processing time. Instead, you want to use exceptions where they are most needed—invalidation or data processing, rather than game mechanics.</p>&#13;
    <p class="normal">C# allows you the freedom to create your exception types to suit any specific needs your code might have, but that's beyond the scope of this book. It's just a good thing to remember for the future: <a href="https://docs.microsoft.com/en-us/dotnet/standard/exceptions/how-to-create-user-defined-exceptions">https://docs.microsoft.com/en-us/dotnet/standard/exceptions/how-to-create-user-defined-exceptions</a>.</p>&#13;
    <h1 id="_idParaDest-268" class="title">Summary</h1>&#13;
    <p class="normal">While this chapter brings us to the end of our practical adventure into C# and Unity 2020, I hope that your journey into game programming and software development has just begun. You've learned everything from creating variables, methods, and class objects to writing your game mechanics, enemy behavior, and more.</p>&#13;
    <p class="normal">The topics we've covered in this chapter have been a level above what we dealt with for the majority of this book, and with good reason. You already know your programming brain is a muscle that you need to exercise before you can advance to the next plateau. That's all generics, events, and design patterns are: just the next rung up the programming ladder.</p>&#13;
    <p class="normal">In the next chapter, I will leave you with resources, further reading, and lots of other helpful (and, dare I say, cool) opportunities and information about the Unity community and the software development industry at large.</p>&#13;
    <p class="normal">Happy coding!</p>&#13;
    <h1 id="_idParaDest-269" class="title">Pop quiz – intermediate C#</h1>&#13;
    <ol>&#13;
      <li class="numbered" value="1">What is the difference between a generic and non-generic class?</li>&#13;
      <li class="numbered">What needs to match when assigning a value to a delegate type?</li>&#13;
      <li class="numbered">How would you unsubscribe from an event?</li>&#13;
      <li class="numbered">Which C# keyword would you use to send out an exception in your code?</li>&#13;
    </ol>&#13;
    <h1 class="heading-1">JOIN us on Discord!</h1>&#13;
    <p class="normal">Read this book alongside other users, Unity/C# experts, and Harrison Ferrone. Ask questions, provide solutions to other readers, chat with the author via <em class="italic">Ask Me Anything sessions</em> and much more.</p>&#13;
<p class="normal">Join Now! </p>&#13;
    <p class="normal"><a href="https://packt.link/csharpunity2021">https://packt.link/csharpunity2021</a></p>&#13;
    <p class="normal"><img style="height: 8em; width: auto;" src="img/QR_Code_9781801813945.png" alt="" width="354" height="354"/></p>&#13;
  </div>&#13;
</div></body></html>