<html><head></head><body>
  <div id="_idContainer051">
   <h1 class="chapter-number" id="_idParaDest-114">
    <a id="_idTextAnchor143">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     9
    </span>
   </h1>
   <h1 id="_idParaDest-115">
    <a id="_idTextAnchor144">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Object Relational Mapping with Entity Framework Core and Dapper
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.3.1">
     In the previous chapter, we used direct connections to SQL and NoSQL databases to create and retrieve data, a staple of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.4.1">
      most APIs.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.5.1">
     In reality, a large segment of APIs based on .NET favor the use of
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.6.1">
      Object Relation Mapping
     </span>
    </strong>
    <span class="koboSpan" id="kobo.7.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.8.1">
      ORM
     </span>
    </strong>
    <span class="koboSpan" id="kobo.9.1">
     ) to
    </span>
    <a id="_idIndexMarker323">
    </a>
    <span class="koboSpan" id="kobo.10.1">
     converse with databases over the direct connection method.
    </span>
    <span class="koboSpan" id="kobo.10.2">
     This is because ORMs offer another layer of abstraction over the underlying data, promoting SOLID design principles while being conducive to scalability and easy
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.11.1">
      long-term maintenance.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.12.1">
     In this chapter, we are going to explore two of the mainstream ORM frameworks â€“ Entity Framework Core and Dapper.
    </span>
    <span class="koboSpan" id="kobo.12.2">
     With these two technologies, we will be able to map the entities in our database and manage them as if the data was contained within the classes that make up our minimal
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.13.1">
      API project.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.14.1">
     We will cover the following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.15.1">
      main topics:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.16.1">
      Introduction
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.17.1">
       to ORMs
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.18.1">
      Configuring Dapper in minimal
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.19.1">
       API projects
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.20.1">
      Performing CRUD operations
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.21.1">
       with Dapper
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.22.1">
      Configuring Entity Framework in minimal
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.23.1">
       API projects
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.24.1">
      Performing CRUD operations with
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.25.1">
       Entity Framework
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-116">
    <a id="_idTextAnchor145">
    </a>
    <span class="koboSpan" id="kobo.26.1">
     Technical requirements
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.27.1">
     You will need the following software to be installed on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.28.1">
      your machine:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.29.1">
      Visual Studio 2022 or Visual
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.30.1">
       Studio Code
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.31.1">
      Microsoft SQL Server 2022
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.32.1">
       Developer Edition
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.33.1">
      Microsoft SQL Server
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.34.1">
       Management Studio
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.35.1">
     You will need to create a database in SQL Server (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.36.1">
      MyCompany
     </span>
    </strong>
    <span class="koboSpan" id="kobo.37.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.37.2">
     The SQL to create the required
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.38.1">
      Employees
     </span>
    </strong>
    <span class="koboSpan" id="kobo.39.1">
     table was provided in the previous chapter, but I will also include it in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.40.1">
      this chapter.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.41.1">
     The code for this chapter is available in the GitHub repository
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.42.1">
      at:
     </span>
    </span>
    <a href="https://github.com/PacktPublishing/Minimal-APIs-in-ASP.NET-9">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.43.1">
       https://github.com/PacktPublishing/Minimal-APIs-in-ASP.NET-9
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.44.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-117">
    <a id="_idTextAnchor146">
    </a>
    <span class="koboSpan" id="kobo.45.1">
     Introduction to ORMs
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.46.1">
     ORMs were first
    </span>
    <a id="_idIndexMarker324">
    </a>
    <span class="koboSpan" id="kobo.47.1">
     introduced in the 1990s to address the
    </span>
    <a id="_idIndexMarker325">
    </a>
    <span class="koboSpan" id="kobo.48.1">
     mismatch between the way data is modeled in relational databases such as SQL
    </span>
    <a id="_idIndexMarker326">
    </a>
    <span class="koboSpan" id="kobo.49.1">
     and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.50.1">
      Object-Oriented Programming
     </span>
    </strong>
    <span class="koboSpan" id="kobo.51.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.52.1">
      OOP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.53.1">
     ) languages, often referred to as the
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.54.1">
       Impedance Mismatch
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.55.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.56.1">
     Data in a
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.57.1">
      relational database
     </span>
    </em>
    <span class="koboSpan" id="kobo.58.1">
     is laid out in a series of tables, each with a number of columns defining the property of each record, which in turn is represented by a row in the table.
    </span>
    <span class="koboSpan" id="kobo.58.2">
     The relationships between entities in a relational database are represented by
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.59.1">
      foreign keys
     </span>
    </em>
    <span class="koboSpan" id="kobo.60.1">
     and
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.61.1">
      join
     </span>
    </em>
    <span class="koboSpan" id="kobo.62.1">
     operations that occur during
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.63.1">
      a query.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.64.1">
     In contrast, data in an
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.65.1">
      OOP language
     </span>
    </em>
    <span class="koboSpan" id="kobo.66.1">
     is represented as objects that have fields, properties, and operational logic such as methods and functions that can act on the data.
    </span>
    <span class="koboSpan" id="kobo.66.2">
     Relationships between objects in OOP are more abstract, represented by pointer references and concepts such as inheritance
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.67.1">
      and polymorphism.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.68.1">
     An ORM bridges the gap between these two paradigms by providing a means of mapping the data, which allows us to work with database records as if they were objects.
    </span>
    <span class="koboSpan" id="kobo.68.2">
     This provides a layer of abstraction that simplifies the complexities of SQL, making it easier to
    </span>
    <a id="_idIndexMarker327">
    </a>
    <span class="koboSpan" id="kobo.69.1">
     perform
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.70.1">
      Create
     </span>
    </strong>
    <span class="koboSpan" id="kobo.71.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.72.1">
      Read
     </span>
    </strong>
    <span class="koboSpan" id="kobo.73.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.74.1">
      Update
     </span>
    </strong>
    <span class="koboSpan" id="kobo.75.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.76.1">
      Delete
     </span>
    </strong>
    <span class="koboSpan" id="kobo.77.1">
     (
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.78.1">
       CRUD
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.79.1">
      ) operations.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.80.1">
     There are many, widely used ORMs on offer for various OOP languages and frameworks.
    </span>
    <span class="koboSpan" id="kobo.80.2">
     The first widely used ORM
    </span>
    <a id="_idIndexMarker328">
    </a>
    <span class="koboSpan" id="kobo.81.1">
     was
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.82.1">
      TopLink
     </span>
    </strong>
    <span class="koboSpan" id="kobo.83.1">
     .
    </span>
    <span class="koboSpan" id="kobo.83.2">
     Developed in 1994, it was designed to provide mapping for Java applications, influencing many of the ORM technologies we take for granted today, such as the two we will be exploring in this chapter â€“ Dapper and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.84.1">
      Entity Framework.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.85.1">
     ORMs are a significant accelerator to any project, but particularly to minimal API projects.
    </span>
    <span class="koboSpan" id="kobo.85.2">
     They reduce boilerplate code in ASP.NET because they can be easily installed as a package, and configuration can be achieved centrally, with queries and commands requiring less ceremony than direct SQL connections that use classes such as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.86.1">
      SqlConnection
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.87.1">
      and
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.88.1">
       SqlCommand
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.89.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.90.1">
     One of the most powerful aspects of ORMs is the ability for them to manage the schema of the underlying database.
    </span>
    <span class="koboSpan" id="kobo.90.2">
     Objects can be of course mapped from an existing database, but ORMs provide the ability to manage the database structure in the same way classes are configured in code..
    </span>
    <span class="koboSpan" id="kobo.90.3">
     This makes schema management really simple and more efficient because developers would be altering class structures anyway.
    </span>
    <span class="koboSpan" id="kobo.90.4">
     It prevents
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.91.1">
      double keying
     </span>
    </em>
    <span class="koboSpan" id="kobo.92.1">
     , taking advantage of the work that has already been done in code to automate the dependent changes in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.93.1">
      the database.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.94.1">
     If you read the previous chapter, youâ€™ll remember that we created a database called
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.95.1">
      MyCompany
     </span>
    </strong>
    <span class="koboSpan" id="kobo.96.1">
     to use as an example for connecting directly from our API.
    </span>
    <span class="koboSpan" id="kobo.96.2">
     We will continue to use this
    </span>
    <a id="_idIndexMarker329">
    </a>
    <span class="koboSpan" id="kobo.97.1">
     database, but instead, we will map the objects within it using ORMs.
    </span>
    <span class="koboSpan" id="kobo.97.2">
     Letâ€™s first do this using the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.98.1">
      ORM, Dapper.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-118">
    <a id="_idTextAnchor147">
    </a>
    <span class="koboSpan" id="kobo.99.1">
     Configuring Dapper in minimal API projects
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.100.1">
     Iâ€™m starting with
    </span>
    <a id="_idIndexMarker330">
    </a>
    <span class="koboSpan" id="kobo.101.1">
     Dapper
    </span>
    <a id="_idIndexMarker331">
    </a>
    <span class="koboSpan" id="kobo.102.1">
     because it is an ORM that is
    </span>
    <a id="_idIndexMarker332">
    </a>
    <span class="koboSpan" id="kobo.103.1">
     often referred to as a
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.104.1">
      Micro-ORM
     </span>
    </em>
    <span class="koboSpan" id="kobo.105.1">
     when compared to Entity Framework.
    </span>
    <span class="koboSpan" id="kobo.105.2">
     The reason for this is that it does away with a lot of ORM features such as result caching, change tracking, lazy loading, and database migrations.
    </span>
    <span class="koboSpan" id="kobo.105.3">
     Instead, Dapper focuses on simplicity and performance.
    </span>
    <span class="koboSpan" id="kobo.105.4">
     Being a more lightweight solution means that it could be preferable to Entity Framework, depending on the needs of your
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.106.1">
      minimal API.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.107.1">
     Dapper is a good starting point for learning ORMs because it still uses SQL queries, making it the perfect middle-ground between the direct connection method shown in the previous chapter and the more verbose ORM feature set provided by
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.108.1">
      Entity Framework.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.109.1">
     Database migrations and Dapper
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.110.1">
     The last differentiating feature (database migrations) is an important one because it relates to the ability to change the schema of a database.
    </span>
    <span class="koboSpan" id="kobo.110.2">
     We will talk about migrations later in the chapter when we explore Entity Framework, but for now, know that database migrations change the database schema from our code, and Dapper does not support this via migrations.
    </span>
    <span class="koboSpan" id="kobo.110.3">
     However, you can still change the table schema by sending SQL commands through Dapper.
    </span>
    <span class="koboSpan" id="kobo.110.4">
     This is outside of the scope of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.111.1">
      this chapter.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.112.1">
     Dapper works with many database providers, including SQL Server, Oracle, SQLite, MySQL, and PostgreSQL.
    </span>
    <span class="koboSpan" id="kobo.112.2">
     It uses ADO.NET, meaning that it will work with any database platform that has a provider using ADO.NET.
    </span>
    <span class="koboSpan" id="kobo.112.3">
     Because we are using the database we created in the previous chapter, we will be connecting to a SQL
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.113.1">
      Server database.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.114.1">
     Letâ€™s create a new (empty) ASP.NET project in Visual Studio so that we have a clean slate to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.115.1">
      work on.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.116.1">
     Once you have created the project, navigate to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.117.1">
      Program.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.118.1">
     , which should have the template
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.119.1">
      Hello
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.120.1">
       World
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.121.1">
      example.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.122.1">
     To start with, we need a database to connect to.
    </span>
    <span class="koboSpan" id="kobo.122.2">
     If you followed along with the previous chapter, you will have installed a SQL Server instance and created a database called
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.123.1">
      MyCompany
     </span>
    </strong>
    <span class="koboSpan" id="kobo.124.1">
     .
    </span>
    <span class="koboSpan" id="kobo.124.2">
     If you havenâ€™t done this already, install SQL Server and create the database within SQL Server
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.125.1">
      Management Studio.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.126.1">
     Once you have
    </span>
    <a id="_idIndexMarker333">
    </a>
    <span class="koboSpan" id="kobo.127.1">
     a
    </span>
    <a id="_idIndexMarker334">
    </a>
    <span class="koboSpan" id="kobo.128.1">
     database, if
    </span>
    <a id="_idIndexMarker335">
    </a>
    <span class="koboSpan" id="kobo.129.1">
     you donâ€™t yet have the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.130.1">
      Employees
     </span>
    </strong>
    <span class="koboSpan" id="kobo.131.1">
     table, you can use the following SQL to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.132.1">
      create one:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.133.1">
CREATE TABLE dbo.Employees
Â Â Â Â (
Â Â Â Â Id int NOT NULL IDENTITY (1, 1),
Â Â Â Â Name varchar(MAX) NOT NULL,
Â Â Â Â Salary decimal(10, 2) NOT NULL,
Â Â Â Â Address varchar(MAX) NOT NULL,
Â Â Â Â City varchar(50) NOT NULL,
Â Â Â Â Region varchar(50) NOT NULL,
Â Â Â Â Country varchar(50) NOT NULL,
Â Â Â Â Phone varchar(200) NOT NULL
Â Â Â Â PostalCode varchar(50) NOT NULL,
)</span></pre>
   <p>
    <span class="koboSpan" id="kobo.134.1">
     Dapper uses providers to facilitate the connection to the target database platform.
    </span>
    <span class="koboSpan" id="kobo.134.2">
     For SQL Server, the required providers are the same as for direct connections to SQL Server from
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.135.1">
      C#:
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.136.1">
       Microsoft.Data.SqlClient
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.137.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.138.1">
     Install
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.139.1">
      Microsoft.Data.SqlClient
     </span>
    </strong>
    <span class="koboSpan" id="kobo.140.1">
     , either from the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.141.1">
      NuGet
     </span>
    </strong>
    <span class="koboSpan" id="kobo.142.1">
     package manager GUI or in the Package Manager Console by running
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.143.1">
      the following:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.144.1">
Install-Package Microsoft.Data.SqlClient</span></pre>
   <p>
    <span class="koboSpan" id="kobo.145.1">
     While weâ€™re installing
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.146.1">
      NuGet
     </span>
    </strong>
    <span class="koboSpan" id="kobo.147.1">
     packages, we also need to install the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.148.1">
      Dapper
     </span>
    </strong>
    <span class="koboSpan" id="kobo.149.1">
     package.
    </span>
    <span class="koboSpan" id="kobo.149.2">
     You can do this in the package manager console by running
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.150.1">
      the following:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.151.1">
Install-Package Dapper</span></pre>
   <p>
    <span class="koboSpan" id="kobo.152.1">
     We could technically start writing queries now, directly within our minimal API endpoints, but for consistency and good practice, we should create a new service specifically for Dapper and register it for dependency injection.
    </span>
    <span class="koboSpan" id="kobo.152.2">
     Create a class called
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.153.1">
      DapperService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.154.1">
     .
    </span>
    <span class="koboSpan" id="kobo.154.2">
     As we did in the previous chapter for
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.155.1">
      SQLService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.156.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.157.1">
      MongoDbService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.158.1">
     , we will register this class as a singleton in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.159.1">
      Program.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.160.1">
     .
    </span>
    <span class="koboSpan" id="kobo.160.2">
     Ensure you register the service
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.161.1">
      before
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.162.1">
       app.Run();
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.163.1">
      :
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.164.1">
builder.Services.AddSingleton&lt;DapperService&gt;();</span></pre>
   <p>
    <span class="koboSpan" id="kobo.165.1">
     We have now configured the project to use Dapper on a SQL Server database using dependency injection
    </span>
    <a id="_idIndexMarker336">
    </a>
    <span class="koboSpan" id="kobo.166.1">
     with
    </span>
    <a id="_idIndexMarker337">
    </a>
    <span class="koboSpan" id="kobo.167.1">
     the
    </span>
    <a id="_idIndexMarker338">
    </a>
    <span class="koboSpan" id="kobo.168.1">
     relevant provider, and we have created a database to work with, meaning that we can proceed with performing our first CRUD operations from our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.169.1">
      minimal API.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-119">
    <a id="_idTextAnchor148">
    </a>
    <span class="koboSpan" id="kobo.170.1">
     Performing CRUD operations with Dapper
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.171.1">
     Letâ€™s work our
    </span>
    <a id="_idIndexMarker339">
    </a>
    <span class="koboSpan" id="kobo.172.1">
     way
    </span>
    <a id="_idIndexMarker340">
    </a>
    <span class="koboSpan" id="kobo.173.1">
     through each of the aspects of CRUD in Dapper with some examples.
    </span>
    <span class="koboSpan" id="kobo.173.2">
     First of all, letâ€™s create
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.174.1">
      an employee.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.175.1">
     Creating an Employee record
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.176.1">
     First, we will
    </span>
    <a id="_idIndexMarker341">
    </a>
    <span class="koboSpan" id="kobo.177.1">
     create an endpoint
    </span>
    <a id="_idIndexMarker342">
    </a>
    <span class="koboSpan" id="kobo.178.1">
     that creates an employee.
    </span>
    <span class="koboSpan" id="kobo.178.2">
     That means weâ€™ll be using the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.179.1">
       POST
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.180.1">
      method:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.181.1">
      Go to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.182.1">
       Program.cs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.183.1">
      and map a POST endpoint to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.184.1">
       employees
      </span>
     </strong>
     <span class="koboSpan" id="kobo.185.1">
      route.
     </span>
     <span class="koboSpan" id="kobo.185.2">
      It should accept an
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.186.1">
       Employee
      </span>
     </strong>
     <span class="koboSpan" id="kobo.187.1">
      as a parameter, and it should
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.188.1">
       inject
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.189.1">
        DapperService
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.190.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.191.1">
app.MapPost(
Â Â Â Â "/employees",
Â Â Â Â (Employee employee,
Â Â Â Â [FromServices] DapperService dapperService) =&gt;
{
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.192.1">
      Next, we can create a method within
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.193.1">
       DapperService
      </span>
     </strong>
     <span class="koboSpan" id="kobo.194.1">
      that handles the creation of the employee in the database (this is where we get to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.195.1">
       use Dapper).
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.196.1">
      Open
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.197.1">
       DapperService.cs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.198.1">
      and
     </span>
     <a id="_idIndexMarker343">
     </a>
     <span class="koboSpan" id="kobo.199.1">
      create
     </span>
     <a id="_idIndexMarker344">
     </a>
     <span class="koboSpan" id="kobo.200.1">
      a method
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.201.1">
       called
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.202.1">
        AddEmployee
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.203.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.204.1">
public async Task AddEmployee(Employee employee)
{
}</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.205.1">
       Like the direct connection examples from the previous chapter, Dapper uses
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.206.1">
        SqlConnection
       </span>
      </strong>
      <span class="koboSpan" id="kobo.207.1">
       to connect to a SQL Server.
      </span>
      <span class="koboSpan" id="kobo.207.2">
       Inside the scope of that connection, you need to write the appropriate query for the action you want to take.
      </span>
      <span class="koboSpan" id="kobo.207.3">
       Because weâ€™re creating an
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.208.1">
        employee
       </span>
      </strong>
      <span class="koboSpan" id="kobo.209.1">
       , we will be adding a new record to the database and so we will write an
      </span>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.210.1">
         INSERT
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.211.1">
        statement.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.212.1">
      Make a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.213.1">
       using
      </span>
     </strong>
     <span class="koboSpan" id="kobo.214.1">
      statement to hold the connection to the database (remember,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.215.1">
       using
      </span>
     </strong>
     <span class="koboSpan" id="kobo.216.1">
      statements allow the connection to be automatically disposed of) and add the connection string to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.217.1">
       your database.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.218.1">
      Follow this up by defining a string that represents the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.219.1">
        INSERT
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.220.1">
       statement:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.221.1">
using (var sqlConnection = new
Â Â Â Â SqlConnection("YOURCONNECTIONSTRING"))
{
Â Â Â Â var sql = "INSERT INTO Employees " +
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (Name, Salary, Address, City, " +
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Region, "Country, Phone) VALUES " +
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (@Name, @Salary, @Address, @City, " +
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â @Region, @Country, @Phone)";
}</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.222.1">
       Notice how the
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.223.1">
        INSERT
       </span>
      </strong>
      <span class="koboSpan" id="kobo.224.1">
       statement must contain all the relevant columns and values as parameters for
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.225.1">
        those columns.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.226.1">
      Next, we
     </span>
     <a id="_idIndexMarker345">
     </a>
     <span class="koboSpan" id="kobo.227.1">
      will use Dapper to
     </span>
     <a id="_idIndexMarker346">
     </a>
     <span class="koboSpan" id="kobo.228.1">
      commit the database transaction against the instantiated
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.229.1">
       SqlConnection
      </span>
     </strong>
     <span class="koboSpan" id="kobo.230.1">
      .
     </span>
     <span class="koboSpan" id="kobo.230.2">
      We can use
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.231.1">
       ExecuteAsync()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.232.1">
      , a Dapper extension method that will execute the statement while mapping the properties from the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.233.1">
       Employee
      </span>
     </strong>
     <span class="koboSpan" id="kobo.234.1">
      object that we passed into this the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.235.1">
        AddEmployee()
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.236.1">
       method:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.237.1">
await sqlConnection.ExecuteAsync(sql, new
{
Â Â Â Â employee.PostalCode,
Â Â Â Â employee.Name,
Â Â Â Â employee.Salary,
Â Â Â Â employee.Address,
Â Â Â Â employee.City,
Â Â Â Â employee.Region,
Â Â Â Â employee.Country,
Â Â Â Â employee.Phone
});</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.238.1">
       We now have a method on
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.239.1">
        DapperService
       </span>
      </strong>
      <span class="koboSpan" id="kobo.240.1">
       that can receive an
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.241.1">
        Employee
       </span>
      </strong>
      <span class="koboSpan" id="kobo.242.1">
       parameter
      </span>
      <a id="_idIndexMarker347">
      </a>
      <span class="koboSpan" id="kobo.243.1">
       and commit it to
      </span>
      <a id="_idIndexMarker348">
      </a>
      <span class="koboSpan" id="kobo.244.1">
       the database via Dapper, as
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.245.1">
        shown here:
       </span>
      </span>
     </p>
     <pre class="source-code"><span class="koboSpan" id="kobo.246.1">public class DapperService
{
Â Â Â Â public async Task AddEmployee(Employee employee)
Â Â Â Â {
Â Â Â Â Â Â Â Â using (var sqlConnection = new
Â Â Â Â Â Â Â Â Â Â Â Â SqlConnection("YOURCONNECTIONSTRING"))
Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â var sql = "INSERT INTO Employees " +
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (Name, Salary, Address, City, " +
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Region, Country, Phone) VALUES " +
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (@Name, @Salary, @Address, " +
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â @City, @Region, @Country, @Phone)";
Â Â Â Â Â Â Â Â Â Â Â Â await sqlConnection.ExecuteAsync(sql, new
Â Â Â Â Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â employee.PostalCode,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â employee.Name,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â employee.Salary,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â employee.Address,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â employee.City,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â employee.Region,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â employee.Country,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â employee.Phone
Â Â Â Â Â Â Â Â Â Â Â Â });
Â Â Â Â Â Â Â Â }
Â Â Â Â }
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.247.1">
      All that remains now is to call this method in the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.248.1">
       POST
      </span>
     </strong>
     <span class="koboSpan" id="kobo.249.1">
      endpoint we started writing in
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.250.1">
       Program.cs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.251.1">
      , before returning an
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.252.1">
       HTTP 201 CREATED
      </span>
     </strong>
     <span class="koboSpan" id="kobo.253.1">
      status code to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.254.1">
       the client:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.255.1">
app.MapPost(
Â Â Â Â "/employees",
Â Â Â Â async (Employee employee,
Â Â Â Â Â Â Â Â Â Â Â [FromServices] DapperService dapperService)
Â Â Â Â Â Â Â Â Â Â Â =&gt;
{
Â Â Â Â await dapperService.AddEmployee(employee);
Â Â Â Â return Results.Created();
});</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.256.1">
     Thatâ€™s
    </span>
    <a id="_idIndexMarker349">
    </a>
    <span class="koboSpan" id="kobo.257.1">
     taken
    </span>
    <a id="_idIndexMarker350">
    </a>
    <span class="koboSpan" id="kobo.258.1">
     care of the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.259.1">
      Create
     </span>
    </em>
    <span class="koboSpan" id="kobo.260.1">
     part
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.261.1">
      of CRUD.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.262.1">
     Storing and referencing connection strings
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.263.1">
     In the previous chapter, I demonstrated how you can follow best practices by storing connection strings in a configuration file and then referencing them
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.264.1">
      via
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.265.1">
       IConfiguration.
      </span>
     </strong>
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.266.1">
     If you havenâ€™t already done so, please refer to this in the previous chapter so that you can implement it for Dapper and Entity
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.267.1">
      Framework usage.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.268.1">
     Letâ€™s move on to the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.269.1">
      Read
     </span>
    </em>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.270.1">
      part now.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.271.1">
     Reading an Employee record
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.272.1">
     The
    </span>
    <a id="_idIndexMarker351">
    </a>
    <em class="italic">
     <span class="koboSpan" id="kobo.273.1">
      Read
     </span>
    </em>
    <span class="koboSpan" id="kobo.274.1">
     part
    </span>
    <a id="_idIndexMarker352">
    </a>
    <span class="koboSpan" id="kobo.275.1">
     will entail having a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.276.1">
      GET
     </span>
    </strong>
    <span class="koboSpan" id="kobo.277.1">
     endpoint on top of a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.278.1">
      SELECT
     </span>
    </strong>
    <span class="koboSpan" id="kobo.279.1">
     query on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.280.1">
      the database:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.281.1">
      Start by adding a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.282.1">
       GET
      </span>
     </strong>
     <span class="koboSpan" id="kobo.283.1">
      endpoint to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.284.1">
       Program.cs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.285.1">
      , mapped to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.286.1">
       Employees
      </span>
     </strong>
     <span class="koboSpan" id="kobo.287.1">
      route.
     </span>
     <span class="koboSpan" id="kobo.287.2">
      It should have a route parameter called
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.288.1">
       id
      </span>
     </strong>
     <span class="koboSpan" id="kobo.289.1">
      that is passed through the body of the lambda expression inside the endpoint, and it should
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.290.1">
       inject
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.291.1">
        DapperService
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.292.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.293.1">
app.MapGet(
Â Â Â Â "/employees/{id}",
Â Â Â Â (int id,
Â Â Â Â Â [FromServices] DapperService dapperService) =&gt;
{
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.294.1">
      Next, weâ€™re going to take the same approach we took in the last example by making a new function in
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.295.1">
       DapperService
      </span>
     </strong>
     <span class="koboSpan" id="kobo.296.1">
      , but this time, instead of inserting, it will run a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.297.1">
       SELECT
      </span>
     </strong>
     <span class="koboSpan" id="kobo.298.1">
      query to get the employee for the specified
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.299.1">
       id
      </span>
     </strong>
     <span class="koboSpan" id="kobo.300.1">
      , before returning it to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.301.1">
       the endpoint:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.302.1">
Â Â Â Â Â Â Â Â public async Task&lt;Employee&gt;
Â Â Â Â Â Â Â Â Â Â Â Â GetEmployeeById(int id)
Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â using (var sqlConnection = new
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â SqlConnection("YOURCONNECTIONSTRING"))
Â Â Â Â Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â var sql = "SELECT * FROM Employees
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â WHERE Id = @employeeId";
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â var result = await sqlConnection
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .QuerySingleAsync&lt;Employee&gt;(
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â sql, new { employeeId = id });
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return result;
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }</span></pre>
     <p class="list-inset">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.303.1">
        QuerySingleAsync&lt;Employee&gt;()
       </span>
      </strong>
      <span class="koboSpan" id="kobo.304.1">
       is where the Dapper code comes in.
      </span>
      <span class="koboSpan" id="kobo.304.2">
       Like before, this is a Dapper extension method that allows us to execute a SQL query, with the expectation that one record will be returned, that record being
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.305.1">
        an employee.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.306.1">
      Notice the parameters being sent in.
     </span>
     <span class="koboSpan" id="kobo.306.2">
      We passed the SQL query, but then we passed a new instance of an object array.
     </span>
     <span class="koboSpan" id="kobo.306.3">
      This is the value for the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.307.1">
       @employeeId
      </span>
     </strong>
     <span class="koboSpan" id="kobo.308.1">
      parameter that we declared in the SQL query.
     </span>
     <span class="koboSpan" id="kobo.308.2">
      Dapper expects us to pass our parameter values in as an array of objects so that their values can be mapped to
     </span>
     <a id="_idIndexMarker353">
     </a>
     <span class="koboSpan" id="kobo.309.1">
      the relevant
     </span>
     <a id="_idIndexMarker354">
     </a>
     <span class="koboSpan" id="kobo.310.1">
      parameters in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.311.1">
       the query.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.312.1">
      We also called a specific extension method â€“
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.313.1">
       QuerySingleAsync()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.314.1">
      .
     </span>
     <span class="koboSpan" id="kobo.314.2">
      The reason for this is obvious â€“ we only want one record.
     </span>
     <span class="koboSpan" id="kobo.314.3">
      If you want more, there are functions such as
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.315.1">
       Query()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.316.1">
      that will return an
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.317.1">
       IEnumerable
      </span>
     </strong>
     <span class="koboSpan" id="kobo.318.1">
      containing
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.319.1">
       many records.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.320.1">
      Finally, we once again simply call the function in
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.321.1">
       DapperService
      </span>
     </strong>
     <span class="koboSpan" id="kobo.322.1">
      from the endpoint, returning the result to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.323.1">
       the client:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.324.1">
app.MapGet(
Â Â Â Â "/employees/{id}",
Â Â Â Â async (int id,
Â Â Â Â Â Â Â Â Â Â Â [FromServices] DapperService dapperService)
Â Â Â Â Â Â Â Â Â Â Â =&gt;
{
Â Â Â Â Â return Results.Ok(
Â Â Â Â Â Â Â Â Â await dapperService.GetEmployeeById(id));
});</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.325.1">
     Next, letâ€™s look
    </span>
    <a id="_idIndexMarker355">
    </a>
    <span class="koboSpan" id="kobo.326.1">
     at how we can
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.327.1">
      update
     </span>
    </em>
    <span class="koboSpan" id="kobo.328.1">
     an
    </span>
    <a id="_idIndexMarker356">
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.329.1">
      employee record.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.330.1">
     Updating an Employee record
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.331.1">
     Weâ€™re two
    </span>
    <a id="_idIndexMarker357">
    </a>
    <span class="koboSpan" id="kobo.332.1">
     letters into CRUD now.
    </span>
    <span class="koboSpan" id="kobo.332.2">
     Letâ€™s
    </span>
    <a id="_idIndexMarker358">
    </a>
    <span class="koboSpan" id="kobo.333.1">
     take a look now at
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.334.1">
      Update
     </span>
    </strong>
    <span class="koboSpan" id="kobo.335.1">
     by taking the same approach â€“ creating a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.336.1">
      PUT
     </span>
    </strong>
    <span class="koboSpan" id="kobo.337.1">
     endpoint and connecting it
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.338.1">
      to
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.339.1">
       DapperService:
      </span>
     </strong>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.340.1">
app.MapPut(
Â Â Â Â "/employees",
Â Â Â Â Â async (Employee employee,
Â Â Â Â Â Â Â Â Â Â Â Â [FromServices] DapperService dapperService) =&gt;
{
Â Â Â Â await dapperService.UpdateEmployee(employee);
Â Â Â Â return Results.Ok();
});</span></pre>
   <p>
    <span class="koboSpan" id="kobo.341.1">
     Then, we create a function that performs the update against
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.342.1">
      the database:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.343.1">
Â Â Â Â Â Â Â Â public async Task UpdateEmployee (
Â Â Â Â Â Â Â Â Â Â Â Â Employee employee)
Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â using (var sqlConnection = new
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â SqlConnection("YOURCONNECTIONSTRING"))
Â Â Â Â Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â var sql = "UPDATE Employees SET Name = " +
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â @Name, Salary = @Salary, Address = " +
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â @Address, City = @City, " +
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Region = @Region WHERE Id = @id";
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â var parameters = new
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â employee.Id,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â employee.Name,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â employee.Salary,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â employee.Address,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â employee.City,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â employee.Region
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â };
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â await sqlConnection.ExecuteAsync(
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â sql, parameters);
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }</span></pre>
   <p>
    <span class="koboSpan" id="kobo.344.1">
     Notice how the code weâ€™ve added to update the record in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.345.1">
      DapperService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.346.1">
     is similar to the code we
    </span>
    <a id="_idIndexMarker359">
    </a>
    <span class="koboSpan" id="kobo.347.1">
     added to create a record.
    </span>
    <span class="koboSpan" id="kobo.347.2">
     The main difference is the SQL string.
    </span>
    <span class="koboSpan" id="kobo.347.3">
     Otherwise, weâ€™re
    </span>
    <a id="_idIndexMarker360">
    </a>
    <span class="koboSpan" id="kobo.348.1">
     still passing in an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.349.1">
      Employee
     </span>
    </strong>
    <span class="koboSpan" id="kobo.350.1">
     object and mapping its properties to the record in the database
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.351.1">
      via Dapper.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.352.1">
     Deleting an Employee record
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.353.1">
     Finally, weâ€™ve
    </span>
    <a id="_idIndexMarker361">
    </a>
    <span class="koboSpan" id="kobo.354.1">
     reached the final
    </span>
    <a id="_idIndexMarker362">
    </a>
    <span class="koboSpan" id="kobo.355.1">
     section of CRUD â€“
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.356.1">
       Delete
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.357.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.358.1">
     Weâ€™ll follow the same principle weâ€™ve applied in all the operations up to this point, but this time Iâ€™m going to start by adding the functionality to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.359.1">
      DapperService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.360.1">
     for deleting a record
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.361.1">
      by ID:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.362.1">
Â Â Â Â Â Â Â Â public async Task DeleteEmployeeById(int id)
Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â using (var sqlConnection = new
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â SqlConnection("YOURCONNECTIONSTRING"))
Â Â Â Â Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â var sql = "DELETE FROM Employees WHERE Id =
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â @employeeId";
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â await sqlConnection.ExecuteAsync(
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â sql,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â new { employeeId = id }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â );
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }</span></pre>
   <p>
    <span class="koboSpan" id="kobo.363.1">
     Now, we can add an endpoint to use the service for record deletion, returning a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.364.1">
      NO CONTENT
     </span>
    </strong>
    <span class="koboSpan" id="kobo.365.1">
     result
    </span>
    <a id="_idIndexMarker363">
    </a>
    <span class="koboSpan" id="kobo.366.1">
     to
    </span>
    <a id="_idIndexMarker364">
    </a>
    <span class="koboSpan" id="kobo.367.1">
     the client
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.368.1">
      on success:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.369.1">
Â Â Â Â Â Â Â Â Â Â Â Â app.MapDelete(
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "/employees/{id}",
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â async (int id,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â [FromServices] DapperService
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â dapperService) =&gt;
Â Â Â Â Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â await dapperService.DeleteEmployeeById(id);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return Results.NoContent();
Â Â Â Â Â Â Â Â Â Â Â Â });</span></pre>
   <p>
    <span class="koboSpan" id="kobo.370.1">
     Weâ€™ve covered enough of Dapper that you should now be able to use it to perform basic simple CRUD operations on SQL databases through this powerful yet lightweight (micro) ORM.
    </span>
    <span class="koboSpan" id="kobo.370.2">
     You could also try swapping out the SQL provider for one that supports another database, such as MySQL or PostgreSQL, to improve your experience of using Dapper to manage data in SQL for incoming requests on your
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.371.1">
      minimal APIs.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.372.1">
     Dapper has its place, but Entity Framework is a more feature-rich alternative that is used for not only transacting data but also to manage the SQL database structure
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.373.1">
      from code.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.374.1">
     Letâ€™s take a
    </span>
    <a id="_idIndexMarker365">
    </a>
    <span class="koboSpan" id="kobo.375.1">
     look
    </span>
    <a id="_idIndexMarker366">
    </a>
    <span class="koboSpan" id="kobo.376.1">
     at how we can build the same functionality weâ€™ve explored in the section, using
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.377.1">
      Entity Framework.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-120">
    <a id="_idTextAnchor149">
    </a>
    <span class="koboSpan" id="kobo.378.1">
     Configuring Entity Framework in minimal API projects
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.379.1">
     Firstly, we
    </span>
    <a id="_idIndexMarker367">
    </a>
    <span class="koboSpan" id="kobo.380.1">
     need
    </span>
    <a id="_idIndexMarker368">
    </a>
    <span class="koboSpan" id="kobo.381.1">
     to use
    </span>
    <a id="_idIndexMarker369">
    </a>
    <span class="koboSpan" id="kobo.382.1">
     Microsoftâ€™s Entity Framework packages to configure the connection, referred to hereafter as
    </span>
    <a id="_idIndexMarker370">
    </a>
    <span class="koboSpan" id="kobo.383.1">
     the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.384.1">
      context
     </span>
    </strong>
    <span class="koboSpan" id="kobo.385.1">
     .
    </span>
    <span class="koboSpan" id="kobo.385.2">
     This wording already creates a layer of abstraction from the database as we start to consider our data as members of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.386.1">
      this context.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.387.1">
     Start by installing the following packages via the package manager console in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.388.1">
      Visual Studio:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.389.1">
Install-Package Microsoft.EntityFrameworkCore
Install-Package Microsoft.EntityFrameworkCore.SqlServer
Install-Package Microsoft.EntityFrameworkCore.Tools</span></pre>
   <p>
    <span class="koboSpan" id="kobo.390.1">
     This ensures that all the libraries required to interact with SQL Server through Entity Framework are
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.391.1">
      in place.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.392.1">
     Next, we
    </span>
    <a id="_idIndexMarker371">
    </a>
    <span class="koboSpan" id="kobo.393.1">
     will
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.394.1">
      scaffold
     </span>
    </strong>
    <span class="koboSpan" id="kobo.395.1">
     the existing
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.396.1">
      MyCompany
     </span>
    </strong>
    <span class="koboSpan" id="kobo.397.1">
     database, again from the package manager console, using the connection string for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.398.1">
      the database:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.399.1">
Scaffold-DbContext "Your_Connection_String" Microsoft.EntityFrameworkCore.SqlServer -OutputDir Models -Context MyCompanyContext</span></pre>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.400.1">
      Scaffolding
     </span>
    </strong>
    <span class="koboSpan" id="kobo.401.1">
     means
    </span>
    <a id="_idIndexMarker372">
    </a>
    <span class="koboSpan" id="kobo.402.1">
     that Entity Framework looks at the schema of the database and maps the tables to objects in your code.
    </span>
    <span class="koboSpan" id="kobo.402.2">
     The result is a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.403.1">
      DbContext
     </span>
    </strong>
    <span class="koboSpan" id="kobo.404.1">
     , which wraps all of the different entities in the context.
    </span>
    <span class="koboSpan" id="kobo.404.2">
     A series of models will also be created that are classes representing each of the entities.
    </span>
    <span class="koboSpan" id="kobo.404.3">
     These are placed in the folder specified by the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.405.1">
      OutputDir
     </span>
    </strong>
    <span class="koboSpan" id="kobo.406.1">
     switch used by the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.407.1">
      console command.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.408.1">
     Because I stated that I want the context to be called
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.409.1">
      MyCompanyContext
     </span>
    </strong>
    <span class="koboSpan" id="kobo.410.1">
     , a new class called
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.411.1">
      MyCompanyContext
     </span>
    </strong>
    <span class="koboSpan" id="kobo.412.1">
     has been generated in the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.413.1">
       Models
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.414.1">
      folder.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.415.1">
     In this class, you can see that a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.416.1">
      DbSet&lt;Employee&gt;
     </span>
    </strong>
    <span class="koboSpan" id="kobo.417.1">
     called
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.418.1">
      Employees
     </span>
    </strong>
    <span class="koboSpan" id="kobo.419.1">
     has been added.
    </span>
    <span class="koboSpan" id="kobo.419.2">
     A
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.420.1">
      DbSet
     </span>
    </strong>
    <span class="koboSpan" id="kobo.421.1">
     represents all the current records in a given database table.
    </span>
    <span class="koboSpan" id="kobo.421.2">
     This is a collection representing each of the records in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.422.1">
      Employees
     </span>
    </strong>
    <span class="koboSpan" id="kobo.423.1">
     , and by adding to, retrieving from, updating, or removing from this collection, we can indirectly change the corresponding SQL table.
    </span>
    <span class="koboSpan" id="kobo.423.2">
     Letâ€™s look at the generated code to further understand what is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.424.1">
      happening here.
     </span>
    </span>
   </p>
   <p>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.425.1">
      MyCompanyContext
     </span>
    </strong>
    <span class="koboSpan" id="kobo.426.1">
     is a class derived from
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.427.1">
      DbContext
     </span>
    </strong>
    <span class="koboSpan" id="kobo.428.1">
     .
    </span>
    <span class="koboSpan" id="kobo.428.2">
     It represents the data source in use and provides a means of interacting with this source at a higher level of abstraction.
    </span>
    <span class="koboSpan" id="kobo.428.3">
     When the class is instantiated,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.429.1">
      DbContextOptions
     </span>
    </strong>
    <span class="koboSpan" id="kobo.430.1">
     is injected into it, which is then
    </span>
    <a id="_idIndexMarker373">
    </a>
    <span class="koboSpan" id="kobo.431.1">
     passed
    </span>
    <a id="_idIndexMarker374">
    </a>
    <span class="koboSpan" id="kobo.432.1">
     to
    </span>
    <a id="_idIndexMarker375">
    </a>
    <span class="koboSpan" id="kobo.433.1">
     the base
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.434.1">
       DbContext
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.435.1">
      class:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.436.1">
public partial class MyCompanyContext : DbContext
{
Â Â Â Â public MyCompanyContext()
Â Â Â Â {
Â Â Â Â }
Â Â Â Â public MyCompanyContext(
Â Â Â Â Â Â Â Â DbContextOptions&lt;MyCompanyContext&gt; options)
Â Â Â Â Â Â Â Â : base(options)
Â Â Â Â {
Â Â Â Â }
Â Â Â Â public virtual DbSet&lt;Employee&gt; Employees { get; set; }</span></pre>
   <p>
    <span class="koboSpan" id="kobo.437.1">
     Entity Framework then generates the code required to build the context, mapping business objects to tables in the database, allowing a model to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.438.1">
      be created:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.439.1">
Â Â Â Â protected override void OnConfiguring(
Â Â Â Â Â Â Â Â DbContextOptionsBuilder optionsBuilder) =&gt;
# warning To protect potentially sensitive information in
# your connection string, you should move it out of source
# code. </span><span class="koboSpan" id="kobo.439.2">You can avoid scaffolding the connection string by
# using the Name= syntax to read it from configuration â€“
# see https://go.microsoft.com/fwlink/?linkid=2131148. </span><span class="koboSpan" id="kobo.439.3">For
# more guidance on storing connection strings, see
# https://go.microsoft.com/fwlink/?LinkId=723263.</span></pre>
   <p>
    <span class="koboSpan" id="kobo.440.1">
     Entity Framework
    </span>
    <a id="_idIndexMarker376">
    </a>
    <span class="koboSpan" id="kobo.441.1">
     is
    </span>
    <a id="_idIndexMarker377">
    </a>
    <span class="koboSpan" id="kobo.442.1">
     instructed
    </span>
    <a id="_idIndexMarker378">
    </a>
    <span class="koboSpan" id="kobo.443.1">
     in this example to use SQL Server with the specified connection string to model the entities based on the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.444.1">
      database schema:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.445.1">
Â Â Â Â Â Â Â optionsBuilder.UseSqlServer("YOURCONNECTIONSTRING");
Â Â Â Â protected override void OnModelCreating(
Â Â Â Â Â Â Â Â ModelBuilder modelBuilder)
Â Â Â Â {
Â Â Â Â Â Â Â Â modelBuilder.Entity&lt;Employee&gt;(entity =&gt;
Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â entity.HasNoKey();
Â Â Â Â Â Â Â Â Â Â Â Â entity.Property(e =&gt; e.Address)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .IsUnicode(false);
Â Â Â Â Â Â Â Â Â Â Â Â entity.Property(e =&gt; e.City)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .HasMaxLength(50)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .IsUnicode(false);
Â Â Â Â Â Â Â Â Â Â Â Â entity.Property(e =&gt; e.Country)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .HasMaxLength(50)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .IsUnicode(false);
Â Â Â Â Â Â Â Â Â Â Â Â entity.Property(e =&gt; e.Id)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .ValueGeneratedOnAdd();
Â Â Â Â Â Â Â Â Â Â Â Â entity.Property(e =&gt; e.Name).IsUnicode(false);
Â Â Â Â Â Â Â Â Â Â Â Â entity.Property(e =&gt; e.Phone)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .HasMaxLength(200)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .IsUnicode(false);
Â Â Â Â Â Â Â Â Â Â Â Â entity.Property(e =&gt; e.PostalCode)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .HasMaxLength(50)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .IsUnicode(false);
Â Â Â Â Â Â Â Â Â Â Â Â entity.Property(e =&gt; e.Region)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .HasMaxLength(50)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .IsUnicode(false);
Â Â Â Â Â Â Â Â Â Â Â Â entity.Property(e =&gt; e.Salary)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .HasColumnType("decimal(10, 2)");
Â Â Â Â Â Â Â Â });
Â Â Â Â Â Â Â Â OnModelCreatingPartial(modelBuilder);
Â Â Â Â }
Â Â Â Â partial void OnModelCreatingPartial(
Â Â Â Â Â Â Â Â ModelBuilder modelBuilder);
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.446.1">
     Before we start
    </span>
    <a id="_idIndexMarker379">
    </a>
    <span class="koboSpan" id="kobo.447.1">
     looking at communicating with the database through Entity Framework from the API endpoints, we have another piece of configuration
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.448.1">
      to explore.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.449.1">
     Itâ€™s important to understand
    </span>
    <a id="_idIndexMarker380">
    </a>
    <span class="koboSpan" id="kobo.450.1">
     how
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.451.1">
      migrations
     </span>
    </strong>
    <span class="koboSpan" id="kobo.452.1">
     are used by Entity Framework to change the database schema.
    </span>
    <span class="koboSpan" id="kobo.452.2">
     A migration is a set of instructions to follow to make specific changes to a database.
    </span>
    <span class="koboSpan" id="kobo.452.3">
     Whether to add a column to a table, add a new table, or remove a column, it can usually be done via
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.453.1">
      a migration.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.454.1">
     Migrations keep Entity Framework as the single source of truth for your data by outlining how a databaseâ€™s structural change should be managed, in addition
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.455.1">
      to data.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.456.1">
     Letâ€™s explore migrations by making a change to our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.457.1">
      Employees
     </span>
    </strong>
    <span class="koboSpan" id="kobo.458.1">
     table.
    </span>
    <span class="koboSpan" id="kobo.458.2">
     Weâ€™re going to add a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.459.1">
      Title
     </span>
    </strong>
    <span class="koboSpan" id="kobo.460.1">
     column to the table.
    </span>
    <span class="koboSpan" id="kobo.460.2">
     First, open the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.461.1">
      Employee
     </span>
    </strong>
    <span class="koboSpan" id="kobo.462.1">
     model that was generated in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.463.1">
      Models
     </span>
    </strong>
    <span class="koboSpan" id="kobo.464.1">
     folder and add
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.465.1">
      Title
     </span>
    </strong>
    <span class="koboSpan" id="kobo.466.1">
     as a
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.467.1">
       string
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.468.1">
      property:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.469.1">
Â Â public string Title { get; set; }</span></pre>
   <p>
    <span class="koboSpan" id="kobo.470.1">
     Then, we head back to the package manager console to input a command to add the migration.
    </span>
    <span class="koboSpan" id="kobo.470.2">
     This command asks Entity Framework to look for any changes to any of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.471.1">
      DbSet
     </span>
    </strong>
    <span class="koboSpan" id="kobo.472.1">
     objects in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.473.1">
      DbContext
     </span>
    </strong>
    <span class="koboSpan" id="kobo.474.1">
     .
    </span>
    <span class="koboSpan" id="kobo.474.2">
     It will then generate C# code that will eventually run SQL on the database to commit
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.475.1">
      the changes.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.476.1">
     Use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.477.1">
      Add-Migration
     </span>
    </strong>
    <span class="koboSpan" id="kobo.478.1">
     command in the package manager console, followed by a string
    </span>
    <a id="_idIndexMarker381">
    </a>
    <span class="koboSpan" id="kobo.479.1">
     that
    </span>
    <a id="_idIndexMarker382">
    </a>
    <span class="koboSpan" id="kobo.480.1">
     gives
    </span>
    <a id="_idIndexMarker383">
    </a>
    <span class="koboSpan" id="kobo.481.1">
     the migration
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.482.1">
      a name:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.483.1">
PM&gt; Add-Migration "Add_title_to_employees_table"</span></pre>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.484.1">
     Migration names
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.485.1">
     When naming a migration, it is good practice to provide a summary of the changes these migrations make â€“ for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.486.1">
      example,
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.487.1">
       changed_datatype_of_salary_column_to_decimal
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.488.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.489.1">
     Entity Framework will then build the project and add a new class for the migration in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.490.1">
      Migrations
     </span>
    </strong>
    <span class="koboSpan" id="kobo.491.1">
     folder, creating the folder if it does not
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.492.1">
      yet exist:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.493.1">
public partial class add_title_field_to_employees :
Â Â Â Â Migration
{
Â Â Â Â /// &lt;inheritdoc /&gt;
Â Â Â Â protected override void Up(
Â Â Â Â Â Â Â Â MigrationBuilder migrationBuilder)
Â Â Â Â {
Â Â Â Â Â Â Â Â migrationBuilder.AddColumn&lt;string&gt;(
Â Â Â Â Â Â Â Â Â Â Â Â name: "Title",
Â Â Â Â Â Â Â Â Â Â Â Â table: "Employees",
Â Â Â Â Â Â Â Â Â Â Â Â type: "nvarchar(max)",
Â Â Â Â Â Â Â Â Â Â Â Â nullable: false,
Â Â Â Â Â Â Â Â Â Â Â Â defaultValue: "");
Â Â Â Â }
Â Â Â Â /// &lt;inheritdoc /&gt;
Â Â Â Â protected override void Down(
Â Â Â Â Â Â Â Â MigrationBuilder migrationBuilder)
Â Â Â Â {
Â Â Â Â Â Â Â Â migrationBuilder.DropColumn(
Â Â Â Â Â Â Â Â Â Â Â Â name: "Title",
Â Â Â Â Â Â Â Â Â Â Â Â table: "Employees");
Â Â Â Â }
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.494.1">
     You can see that
    </span>
    <a id="_idIndexMarker384">
    </a>
    <span class="koboSpan" id="kobo.495.1">
     the migration specifies that a column is to be added
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.496.1">
      called
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.497.1">
       Title
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.498.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.499.1">
     To commit this to the database, we can
    </span>
    <a id="_idTextAnchor150">
    </a>
    <span class="koboSpan" id="kobo.500.1">
     write another simple command in the package
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.501.1">
      manager console:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.502.1">
Update-Database</span></pre>
   <p>
    <span class="koboSpan" id="kobo.503.1">
     If all went as expected, youâ€™ll see that the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.504.1">
      Employees
     </span>
    </strong>
    <span class="koboSpan" id="kobo.505.1">
     table in the database has a
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.506.1">
       Title
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.507.1">
      column.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.508.1">
     Now that weâ€™ve covered the basics of its configuration, letâ€™s update the endpoints in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.509.1">
      Program.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.510.1">
     to
    </span>
    <a id="_idIndexMarker385">
    </a>
    <span class="koboSpan" id="kobo.511.1">
     use
    </span>
    <a id="_idIndexMarker386">
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.512.1">
      Entity
     </span>
    </span>
    <span class="No-Break">
     <a id="_idIndexMarker387">
     </a>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.513.1">
      Framework.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-121">
    <a id="_idTextAnchor151">
    </a>
    <span class="koboSpan" id="kobo.514.1">
     Performing CRUD operations with Entity Framework
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.515.1">
     We have a
    </span>
    <a id="_idIndexMarker388">
    </a>
    <span class="koboSpan" id="kobo.516.1">
     new dependency in the form
    </span>
    <a id="_idIndexMarker389">
    </a>
    <span class="koboSpan" id="kobo.517.1">
     of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.518.1">
      DbContext
     </span>
    </strong>
    <span class="koboSpan" id="kobo.519.1">
     .
    </span>
    <span class="koboSpan" id="kobo.519.2">
     We should register it within the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.520.1">
      Main
     </span>
    </strong>
    <span class="koboSpan" id="kobo.521.1">
     method in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.522.1">
      Program.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.523.1">
     for use during
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.524.1">
      a request:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.525.1">
var builder = WebApplication.CreateBuilder(args);
builder.Services.AddScoped&lt;MyCompanyContext&gt;();
var app = builder.Build();</span></pre>
   <p>
    <span class="koboSpan" id="kobo.526.1">
     As we did in the previous examples using Dapper, we will create a new service for managing CRUD operations for
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.527.1">
      Employee
     </span>
    </strong>
    <span class="koboSpan" id="kobo.528.1">
     objects.
    </span>
    <span class="koboSpan" id="kobo.528.2">
     This time, we will be more specific with the naming, and call
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.529.1">
      it
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.530.1">
       EmployeeService
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.531.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.532.1">
     In
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.533.1">
      EmployeeService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.534.1">
     , start by adding a constructor, to which we can pass the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.535.1">
      registered context:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.536.1">
public class EmployeeService
{
Â Â Â Â private MyCompanyContext _companyContext;
Â Â Â Â public EmployeeService(
Â Â Â Â Â Â Â Â MyCompanyContext myCompanyContext)
Â Â Â Â {
Â Â Â Â Â Â Â Â _companyContext = myCompanyContext;
Â Â Â Â }</span></pre>
   <p>
    <span class="koboSpan" id="kobo.537.1">
     Then, define all the
    </span>
    <a id="_idIndexMarker390">
    </a>
    <span class="koboSpan" id="kobo.538.1">
     functions
    </span>
    <a id="_idIndexMarker391">
    </a>
    <span class="koboSpan" id="kobo.539.1">
     that will be needed for CRUD operations
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.540.1">
      using
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.541.1">
       MyCompanyContext
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.542.1">
      :
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.543.1">
Â Â Â Â public async Task AddEmployee(Employee employee)
Â Â Â Â {
Â Â Â Â Â Â Â Â await _companyContext.Employees
Â Â Â Â Â Â Â Â Â Â Â Â .AddAsync(employee);
Â Â Â Â Â Â Â Â await _companyContext
Â Â Â Â Â Â Â Â Â Â Â Â .SaveChangesAsync();
Â Â Â Â }
Â Â Â Â public async Task&lt;Employee&gt; GetEmployeeById(int id)
Â Â Â Â {
Â Â Â Â Â Â Â Â var result =Â Â await _companyContext.Employees
Â Â Â Â Â Â Â Â Â Â Â Â .FirstOrDefaultAsync(x =&gt; x.Id == id);
Â Â Â Â Â Â Â Â if(result == null)
Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â throw new EmployeeNotFoundException(id);
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â return result;
Â Â Â Â }
Â Â Â Â public async Task UpdateEmployee(Employee employee)
Â Â Â Â {
Â Â Â Â Â Â Â Â var employeeToUpdate = await GetEmployeeById(
Â Â Â Â Â Â Â Â Â Â Â Â employee.Id);
Â Â Â Â Â Â Â Â _companyContext.Employees.Update(employeeToUpdate);
Â Â Â Â Â Â Â Â await _companyContext.SaveChangesAsync();
Â Â Â Â }
Â Â Â Â public async Task DeleteEmployee(Employee employee)
Â Â Â Â {
Â Â Â Â Â Â Â Â _companyContext.Remove(employee);
Â Â Â Â Â Â Â Â await _companyContext.SaveChangesAsync();
Â Â Â Â }
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.544.1">
     Finally, weâ€™ll create a customer exception called
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.545.1">
      EmployeeNotFoundException
     </span>
    </strong>
    <span class="koboSpan" id="kobo.546.1">
     , which can we throw in
    </span>
    <a id="_idIndexMarker392">
    </a>
    <span class="koboSpan" id="kobo.547.1">
     the
    </span>
    <a id="_idIndexMarker393">
    </a>
    <span class="koboSpan" id="kobo.548.1">
     event a requested employee is not present in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.549.1">
      data source:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.550.1">
public class EmployeeNotFoundException : Exception
{
Â Â Â Â public EmployeeNotFoundException(int id)
Â Â Â Â Â Â Â Â : base(
Â Â Â Â Â Â Â Â Â Â Â Â $"Employee with id {id} could not be found")
Â Â Â Â {
Â Â Â Â }
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.551.1">
     In each of these new functions within
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.552.1">
      EmployeeService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.553.1">
     , we are interacting with the database via the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.554.1">
      Employees
     </span>
    </strong>
    <span class="koboSpan" id="kobo.555.1">
     collection sitting within
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.556.1">
      MyCompanyContext
     </span>
    </strong>
    <span class="koboSpan" id="kobo.557.1">
     .
    </span>
    <span class="koboSpan" id="kobo.557.2">
     We are then committing the changes we have made to this collection to the database
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.558.1">
      using
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.559.1">
       SaveChangesAsync();
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.560.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.561.1">
     Take note of the reusability of one of the functions,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.562.1">
      GetEmployeeById
     </span>
    </strong>
    <span class="koboSpan" id="kobo.563.1">
     .
    </span>
    <span class="koboSpan" id="kobo.563.2">
     In most CRUD operations, we need to be able to target the affected
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.564.1">
      Employee
     </span>
    </strong>
    <span class="koboSpan" id="kobo.565.1">
     object, and we can reuse this function for this.
    </span>
    <span class="koboSpan" id="kobo.565.2">
     To guard against the potential of an employee not being found in the collection, there is a custom exception that can be thrown.
    </span>
    <span class="koboSpan" id="kobo.565.3">
     This is useful for the API endpoint because it means it can cater its response to a specific exception if it occurs, in this case, returning a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.566.1">
      404 NOT FOUND
     </span>
    </strong>
    <span class="koboSpan" id="kobo.567.1">
     status code
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.568.1">
      if necessary.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.569.1">
     Weâ€™ve established that in Entity Framework, interacting with a database table means interacting with a collection in C#.
    </span>
    <span class="koboSpan" id="kobo.569.2">
     This is apparent in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.570.1">
      EmployeeService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.571.1">
     , where LINQ queries are used in place of the SQL queries that would have been used in a direct SQL connection or a micro-ORM such
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.572.1">
      as Dapper.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.573.1">
     With the establishment of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.574.1">
      EmployeeService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.575.1">
     , the API endpoints in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.576.1">
      Program.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.577.1">
     can be altered to use Entity Framework rather than the previously used Dapper.
    </span>
    <span class="koboSpan" id="kobo.577.2">
     But to what extent do they need to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.578.1">
      be changed?
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.579.1">
     The answer to
    </span>
    <a id="_idIndexMarker394">
    </a>
    <span class="koboSpan" id="kobo.580.1">
     this
    </span>
    <a id="_idIndexMarker395">
    </a>
    <span class="koboSpan" id="kobo.581.1">
     is â€“ not very much at all, thanks to the abstraction weâ€™ve created in the form of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.582.1">
      EmployeeService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.583.1">
     .
    </span>
    <span class="koboSpan" id="kobo.583.2">
     Weâ€™ve used an injected dependency to manage the database interaction, with the functions within having the same name or
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.584.1">
      signature
     </span>
    </strong>
    <span class="koboSpan" id="kobo.585.1">
     as each other, meaning that we can just swap out the injected
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.586.1">
      DapperService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.587.1">
     for the new
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.588.1">
      EmployeeService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.589.1">
     that uses
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.590.1">
      Entity Framework.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.591.1">
     Head back to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.592.1">
      Program.cs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.593.1">
     and register
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.594.1">
      EmployeeService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.595.1">
     for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.596.1">
      dependency injection:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.597.1">
Â Â Â Â var builder = WebApplication.CreateBuilder(args);
Â Â Â Â builder.Services.AddScoped&lt;MyCompanyContext&gt;();
Â Â Â Â builder.Services.AddScoped&lt;EmployeeService&gt;();
Â Â Â Â var app = builder.Build();</span></pre>
   <p>
    <span class="koboSpan" id="kobo.598.1">
     Double-click the parameter that currently passes in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.599.1">
      DapperService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.600.1">
     to any of the mapped endpoints.
    </span>
    <span class="koboSpan" id="kobo.600.2">
     In Visual Studio, you can rename this object
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.601.1">
      EmployeeService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.602.1">
     by holding
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.603.1">
      Ctrl
     </span>
    </em>
    <span class="koboSpan" id="kobo.604.1">
     and pressing the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.605.1">
      R
     </span>
    </em>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.606.1">
      key twice.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.607.1">
     After renaming, all other occurrences will also be updated.
    </span>
    <span class="koboSpan" id="kobo.607.2">
     You shouldnâ€™t have any errors as long as the functions called by each endpoint have the same signature regardless of whether youâ€™re using
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.608.1">
      DapperService
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.609.1">
      or
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.610.1">
       EmployeeService
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.611.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.612.1">
     The following code shows the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.613.1">
      POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.614.1">
     endpoint for creating an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.615.1">
      employee
     </span>
    </strong>
    <span class="koboSpan" id="kobo.616.1">
     after it has been updated to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.617.1">
      use
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.618.1">
       EmployeeService
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.619.1">
      :
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.620.1">
Â Â Â Â app.MapPost(
Â Â Â Â Â Â Â Â "/employees",
Â Â Â Â Â Â Â Â async (Employee employee,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â [FromServices] EmployeeService
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â employeeService) =&gt;
Â Â Â Â {
Â Â Â Â Â Â Â Â await employeeService.AddEmployee(employee);
Â Â Â Â Â Â Â Â return Results.Created();
Â Â Â Â });</span></pre>
   <p>
    <span class="koboSpan" id="kobo.621.1">
     This was a rather whirlwind introduction to Entity Framework, which has a great deal more in the way of features.
    </span>
    <span class="koboSpan" id="kobo.621.2">
     However, the main focus is on a minimal APIâ€™s interaction with databases in
    </span>
    <a id="_idIndexMarker396">
    </a>
    <span class="koboSpan" id="kobo.622.1">
     an
    </span>
    <a id="_idIndexMarker397">
    </a>
    <span class="koboSpan" id="kobo.623.1">
     abstracted manner, and this example is enough to get you started on your
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.624.1">
      ORM journey.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.625.1">
     Letâ€™s review the things weâ€™ve learned about Dapper and Entity Framework in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.626.1">
      this chapter.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-122">
    <a id="_idTextAnchor152">
    </a>
    <span class="koboSpan" id="kobo.627.1">
     Summary
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.628.1">
     This chapter has introduced the use of Dapper and Entity Framework to provide an abstraction layer between minimal API endpoints and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.629.1">
      relational databases.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.630.1">
     We opened with an introduction to ORMs, defining their role in simplifying database interactions in minimal APIs, before providing an overview of the various features available for interaction with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.631.1">
      data sources.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.632.1">
     We then stepped through the configuration of Dapper, adding the relevant libraries and providing a dedicated
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.633.1">
      DapperService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.634.1">
     that could be used on minimal API endpoints with dependency injection.
    </span>
    <span class="koboSpan" id="kobo.634.2">
     Once we had configured Dapper, we created the SQL queries in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.635.1">
      DapperService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.636.1">
     and linked the endpoints to the service to provide an end-to-end link between API and database
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.637.1">
      via Dapper.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.638.1">
     Having established CRUD operations on the database with Dapper, we contrasted this by configuring Entity Framework, and then performed the equivalent setup of a service for completing
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.639.1">
      CRUD operations.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.640.1">
     Finally, the original
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.641.1">
      DapperService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.642.1">
     was swapped out for the new
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.643.1">
      EmployeeService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.644.1">
     using Entity Framework, demonstrating the versatility of injecting an abstraction as a dependency for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.645.1">
      data management.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.646.1">
     Thereâ€™s no doubt that integrating data sources via ORMs is a significant aspect of building a minimal API.
    </span>
    <span class="koboSpan" id="kobo.646.2">
     When managing data, depending on the way the data is requested, the potential for bottlenecks in performance can be significant.
    </span>
    <span class="koboSpan" id="kobo.646.3">
     We will explore this concept and ways that these bottlenecks can be mitigated in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.647.1">
      next chapter.
     </span>
    </span>
   </p>
  </div>
 

  <div class="Content" id="_idContainer052">
   <h1 id="_idParaDest-123" lang="en-US" xml:lang="en-US">
    <a id="_idTextAnchor153">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     Part 3 - Optimal Minimal APIs
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.2.1">
     To build high-performing, scalable APIs, itâ€™s essential to fine-tune your systemâ€™s performance and take advantage of advanced programming techniques.
    </span>
    <span class="koboSpan" id="kobo.2.2">
     This part covers how to identify bottlenecks, employ asynchronous programming, and implement caching strategies to improve efficiency and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.3.1">
      user experience.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.4.1">
     This part has the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.5.1">
      following chapters:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <a href="B20968_10.xhtml#_idTextAnchor154">
      <em class="italic">
       <span class="koboSpan" id="kobo.6.1">
        Chapter 10
       </span>
      </em>
     </a>
     <span class="koboSpan" id="kobo.7.1">
      ,
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.8.1">
       Profiling and Identifying Bottlenecks
      </span>
     </em>
    </li>
    <li>
     <a href="B20968_11.xhtml#_idTextAnchor165">
      <em class="italic">
       <span class="koboSpan" id="kobo.9.1">
        Chapter 11
       </span>
      </em>
     </a>
     <span class="koboSpan" id="kobo.10.1">
      ,
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.11.1">
       Utilizing Asynchronous Programming for Scalability
      </span>
     </em>
    </li>
    <li>
     <a href="B20968_12.xhtml#_idTextAnchor174">
      <em class="italic">
       <span class="koboSpan" id="kobo.12.1">
        Chapter 12
       </span>
      </em>
     </a>
     <span class="koboSpan" id="kobo.13.1">
      ,
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.14.1">
       Caching Strategies for Enhanced Performance
      </span>
     </em>
    </li>
   </ul>
  </div>
  <div>
   <div id="_idContainer053">
   </div>
  </div>
  <div>
   <div id="_idContainer054">
   </div>
  </div>
  <div>
   <div id="_idContainer055">
   </div>
  </div>
  <div>
   <div id="_idContainer056">
   </div>
  </div>
  <div>
   <div id="_idContainer057">
   </div>
  </div>
  <div>
   <div class="Basic-Graphics-Frame" id="_idContainer058">
   </div>
  </div>
  <div>
   <div class="Basic-Graphics-Frame" id="_idContainer059">
   </div>
  </div>
  <div>
   <div id="_idContainer060">
   </div>
  </div>
  <div>
   <div id="_idContainer061">
   </div>
  </div>
  <div>
   <div class="Basic-Graphics-Frame" id="_idContainer062">
   </div>
  </div>
 </body></html>