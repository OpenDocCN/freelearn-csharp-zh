<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">AR for Retail with Vuforia</h1>
                </header>
            
            <article>
                
<p class="mce-root"><span>In this chapter, you will work with Vuforia, one of the most well-known AR SDKs that offers a wide variety of options (working with and without image targets, web and local recognition, and more), as well as examples that can be directly downloaded and tested. It has also the advantage of being integrated into the Unity editor, making it easier to develop with it.</span></p>
<p class="mce-root"><span>This chapter's first main goal is to introduce you to the Vuforia SDK and how it works. Among its many features, you will learn how to use spatial recognition and augmentation to place 3D objects in the real world without the need for previously printed image targets. </span>You will learn how to use Vuforia fusion with and without ARCore and you will acquire the skills to use Vuforia's elements in Unity. This chapter's second goal is to present you with an attractive use of AR in retail to show potential customers products such as furniture, paintings, decorations, and more in their own spaces. With these kinds of applications, they can decide on which elements they want to buy and how they will look in their own homes, making them more involved in the buying process.</p>
<p class="mce-root">In this chapter, we will cover the following topics:</p>
<ul>
<li>Using AR for retail</li>
<li>Exploring Vuforia</li>
<li>AR on the go <span>–</span> using Ground Plane</li>
<li>Creating an AR furniture viewer</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p class="mce-root">The technical requirements for this chapter are as follows:</p>
<ul>
<li>A Unity 3D-supporting computer (see the latest requirements here: <a href="https://unity3d.com/unity/system-requirements">https://unity3d.com/unity/system-requirements</a>).<span> </span>This chapter's example project has been developed on a Windows 10 x 64 computer.</li>
<li class="mce-root">Unity 3D (2019.1.2f1 in this book).</li>
<li>Microsoft Visual Studio Community 2017 (included in Unity installation).</li>
<li class="mce-root">The latest version of Vuforia that's included with Unity 3D <span>(8.3.8 in this book).</span></li>
<li class="mce-root">A mobile device supporting Vuforia Fusion (see <a href="https://library.vuforia.com/content/vuforia-library/en/articles/Solution/ground-plane-supported-devices.html">https://library.vuforia.com/content/vuforia-library/en/articles/Solution/ground-plane-supported-devices.html</a>).</li>
</ul>
<p>The resources and the code files for this chapter can be found here: <a href="https://github.com/PacktPublishing/Enterprise-Augmented-Reality-Projects/tree/master/Chapter06">https://github.com/PacktPublishing/Enterprise-Augmented-Reality-Projects/tree/master/Chapter06</a>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using AR for retail</h1>
                </header>
            
            <article>
                
<p>Retail is one of the fields where AR offers a wider range of possibilities, from satisfying and engaging the consumer in order to reduce returned products, to linking products with social media or personalizing the shopping experience. Some examples of this are as follows:</p>
<ul>
<li>Trying products before buying them. This is where users visualize clothes, shoes, glasses, or even makeup before actually buying the products.</li>
<li>Seeing how a product such as a piece of furniture, a piece of art, or even wall paint looks in their homes with AR.</li>
<li>At the store, seeing extra information about a product, such as comments and reviews, before buying it.</li>
<li>In a commercial center, receiving geopositioned information and discounts from the stores in it.</li>
<li>In supermarkets or big stores, orienting customers through sections to the product they want.</li>
</ul>
<p>This field also allows us to display AR on various hardware, including customers' mobile devices, tactile screens, and virtual fitting rooms. Therefore, in the past few years, AR solutions in retail have multiplied, especially since ARKit (from Apple) and ARCore (from Google) appeared on the market. These two pieces of software allow us to easily recognize the environment using the camera and sensors of the mobile devices and place virtual elements over flat surfaces such as the ground or tables.</p>
<p class="mce-root">In this chapter, we will take advantage of Vuforia Fusion, Vuforia SDK's ground detection features, which can also be combined with ARCore, to place virtual objects in our surroundings without any kind of printed target, creating an AR furniture viewer that customers can use to see how the furniture fits in their homes.</p>
<p class="mce-root">For our project, we will be using the real catalog pages and 3D models from the company Euro Seating at <a href="https://www.euroseating.com/en/">https://www.euroseating.com/en/</a>, a seating manufacturer present in more than 100 countries all over the world. Using their high-quality 3D models and real catalog will help us visualize this project as a real-life AR application that can be used in any other marketing context. The models and images that are used in this chapter have been handed over by the company for their use in the context of this book.</p>
<p>We will start by exploring Vuforia and how to integrate it into our Unity project.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Exploring Vuforia</h1>
                </header>
            
            <article>
                
<p>Initially developed by Qualcomm, and currently run by PTC, Vuforia is one of the oldest and most well-known AR SDKs. It's one of the most stable and best-performing pieces of software on the market and, along with ARKit and ARCore, one of the favorite choices for AR developers.</p>
<p>Vuforia offers a wide variety of features, including 2D images and 3D objects tracking, markerless AR where there is no need for a reference image to launch AR content (the one we will be using in this chapter) and barcode-like markers called Vumarks. It provides multiple examples and extra features, such as virtual buttons, runtime image target creation, and background video texture manipulation. </p>
<p>Like other AR software, Vuforia requires a license for it to be deployed on mobile devices. Vuforia offers a free development key generator, which will have to be switched to a deployment key when the app is in the production stage. You can consult its pricing options on their web page: <a href="https://developer.vuforia.com/pricing">https://developer.vuforia.com/pricing</a>.</p>
<p>The Vuforia SDK can be downloaded for Android and iOS, and can also be used in the Unity 3D platform. Since the Unity 2017.2 version, it comes directly integrated into the Unity editor, just like any other main asset, and it has to be installed and activated inside it. Now, we'll incorporate Vuforia into a new project and set it up so that we can build it on an Android device. Let's get started:</p>
<ol start="1">
<li class="mce-root CDPAlignCenter CDPAlign">
<p>When you first installed Unity on your computer (see <a href="54a1260e-a741-4eb5-9c98-01350fcba94b.xhtml">Chapter 2</a>, <em>I<span>ntroduction to Unity for AR Development</span></em>), you should have selected the option of adding the Vuforia module. If you didn't install it or you are in doubt, open the Unity Hub, go to the <span class="packt_screen">Installs</span> tab, and check the installed modules at the bottom of your Unity version:</p>
</li>
</ol>
<div class="CDPAlignCenter CDPAlign packt_figref"><img class="aligncenter size-full wp-image-1150 image-border" src="assets/d508932b-5c92-4d39-9148-71a0b3e95384.png" style="width:44.75em;height:25.92em;"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>Current Unity installation with Vuforia support</span></div>
<ol start="2">
<li class="mce-root CDPAlignCenter CDPAlign">
<p>If Vuforia is not there, click on the top-right button and click on <span class="packt_screen">Add Modules</span>. Select <span class="packt_screen">Vuforia</span> and install it:</p>
</li>
</ol>
<div class="CDPAlignCenter CDPAlign packt_figref"><img class="aligncenter size-full wp-image-1151 image-border" src="assets/bb80c325-c67c-4bac-b5e2-7761d88879eb.png" style="width:35.00em;height:19.08em;"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>Adding</span><span> new modules to the current Unity installation using Unity Hub</span></div>
<div class="packt_infobox">Vuforia usually comes included with stable versions; if you are trying a beta version or a very recent version of Unity, it's possible that Vuforia might not appear among the options and you will have to install a previous version to use it.</div>
<ol start="3">
<li class="mce-root CDPAlignLeft CDPAlign">
<p>Now, open the Unity Hub. On the <span class="packt_screen">Projects</span> tab, click on <span class="packt_screen">NEW</span>:</p>
</li>
</ol>
<div class="CDPAlignCenter CDPAlign packt_figref"><img class="aligncenter size-full wp-image-1152 image-border" src="assets/bc7350e1-568b-44eb-bba2-da9e090d9c9c.png" style="width:45.00em;height:19.67em;"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>Creating a new project in the Unity Hub</span></div>
<ol start="4">
<li class="mce-root CDPAlignLeft CDPAlign">Fill in the <span class="packt_screen">Project Name</span> and <span class="packt_screen">Location</span> fields and click on <span class="packt_screen">CREATE</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1153 image-border" src="assets/b15fd64e-6aa2-406c-8107-65cec09c7a1f.png" style="width:39.00em;height:25.67em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Creating a new 3D project</div>
<ol start="5">
<li class="mce-root">Click <em>Ctrl</em> + <em>N</em> or go to <span class="packt_screen">File</span>|<span class="packt_screen">New Scene</span>. Now, press <em>Ctrl</em> + <em>S</em> or go to <span class="packt_screen">File</span>|<span class="packt_screen">Save</span>. Name the file <kbd>OnTheGo</kbd> and save it in the <kbd>Scenes</kbd> folder:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/36c23a34-c9a1-477e-bc02-01bbf42f016e.png" style="width:27.25em;height:17.75em;"/> </p>
<div class="packt_figref CDPAlignCenter CDPAlign">Creating a new scene for the current project</div>
<ol start="6">
<li class="mce-root">You can also delete the <span class="packt_screen">SampleScene</span> that comes with the project from the <span class="packt_screen">Project</span> window:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1814 image-border" src="assets/c6510b92-d5c7-49bd-bb29-ea3fbbbece5d.png" style="width:41.50em;height:45.50em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">SampleScene is no longer needed</div>
<ol start="7">
<li class="mce-root">AR requires a special camera that retrieves the physical camera feed and processes it so that we can integrate the virtual elements into the real image stream. Vuforia provides an asset called <span class="packt_screen">AR Camera</span> that does this for us. Delete the existing Unity <span class="packt_screen">Main Camera</span>, right-click on the <span class="packt_screen">Hierarchy</span> window, and select <span class="packt_screen">Vuforia Engine</span>|<span class="packt_screen">AR Camera</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/74044d09-e811-45ad-8e41-db04ea5d9263.png" style="width:25.92em;height:26.67em;"/> </p>
<div class="packt_figref CDPAlignCenter CDPAlign">Adding the AR Camera to the scene</div>
<ol start="8">
<li class="mce-root">Since it's the first time we're using Vuforia in the project, a message will appear asking us to import Vuforia's assets. Click <span class="packt_screen">Import</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/a4a9095b-3f7a-4fb6-81c9-ff183815f204.png" style="width:24.92em;height:9.92em;"/> </p>
<div class="packt_figref CDPAlignCenter CDPAlign">Message to import Vuforia and its assets into the project</div>
<p style="padding-left: 60px">A new folder called <kbd>Vuforia</kbd> will appear in the <span class="packt_screen">Project</span> window, inside the <kbd>Assets</kbd> folder.</p>
<ol start="9">
<li class="mce-root">Place the <span class="packt_screen">Directional Light</span> inside the <span class="packt_screen">AR Camera</span> so that the light moves along with the camera.</li>
<li class="mce-root">Now, we have to enable Vuforia in the <span class="packt_screen">Player Settings</span> so that we can use it in the scene:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1156 image-border" src="assets/1b38d5ea-c50c-4bbe-b546-58cd37a078d6.png" style="width:40.17em;height:43.00em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Vuforia Behaviour component detecting that Vuforia isn't enabled yet</div>
<ol start="11">
<li class="mce-root">Press <em>Ctrl</em> + <em>Shift</em> + <em>B</em> or go to <span class="packt_screen">File</span>|<span class="packt_screen">Build Settings...</span> to open the <span class="packt_screen">Build Settings</span> window.</li>
<li class="mce-root">Before anything else, click on <span class="packt_screen">Add Open Scenes</span> to include our scene in the building scenes list.</li>
<li class="mce-root">Then, switch platforms by clicking on <span class="packt_screen">Android</span> and pressing <span class="packt_screen">Switch Platform</span> in the bottom-right corner. With this, we will have configured our project so that it can be built on an Android device:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1157 image-border" src="assets/4f964b45-5803-437a-b2e5-435d4381b9b2.png" style="width:52.17em;height:41.08em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign"> Build Settings panel, allowing us to add new scenes, switch platforms, and access Player Settings</div>
<ol start="14">
<li class="mce-root">Now, click on <span class="packt_screen">Player Settings...</span> to open a new window.</li>
<li class="mce-root">Fill in the <span class="packt_screen">Company Name</span> and <span class="packt_screen">Product Name</span> (the name the app will have when we install it on a device). </li>
<li class="mce-root"><span>In the last tab, </span><span class="packt_screen">XR Settings</span><span>, enable </span><span class="packt_screen">Vuforia Augmented Reality Supported</span><span> to allow the use of Vuforia in this project:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1158 image-border" src="assets/43780ea1-a74d-45fb-9c87-91415d4034da.png" style="width:78.08em;height:51.75em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign"> Player Settings with Company Name and Product Name filled and Vuforia activated in the XR Settings</div>
<ol start="17">
<li class="mce-root">A new message will appear indicating that XR is not supported by the Vulkan graphics API. To fix this, open the <span class="packt_screen">Other Settings</span> tab and remove <span class="packt_screen">Vulkan</span> from <span class="packt_screen">Graphics APIs</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1815 image-border" src="assets/579fd8a4-2d31-465f-be42-5e36ed52bbd9.png" style="width:72.58em;height:26.50em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Removing Vulkan from the Graphics API under Other Settings|Rendering</div>
<ol start="18">
<li class="mce-root">Below this, fill in the <span class="packt_screen">Identification</span> section's <span class="packt_screen">Package Name</span> and minimum <span class="packt_screen">API Level</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/dde477a2-98b0-42cb-be27-d4b364d9cd60.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign"> Updating the Package Name and Minimum API Level under Other Settings|Identification</div>
<div class="packt_infobox">Currently, Vuforia supports Android 4.4 and above and iOS 11 and above. However, we recommend setting the <span class="packt_screen">Minimum</span> <span class="packt_screen">API Leve</span><span class="packt_screen">l</span> to <kbd>5</kbd> to ensure the devices running the apps are powerful enough to do so. You can check the minimum requirements for Vuforia here: <a href="https://library.vuforia.com/articles/Solution/Vuforia-Supported-Versions">https://library.vuforia.com/articles/Solution/Vuforia-Supported-Versions</a>.</div>
<ol start="19">
<li class="mce-root">This step is not always required but it might be the case that the Vuforia version that's been installed with your Unity version is not the latest one. If so, when selecting the <span class="packt_screen">ARCamera</span>, a message will appear on the <span class="packt_screen">Vuforia Behaviour</span> component indicating that a new version is available:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/3c504aca-4367-4d4f-b50a-b7a91bf5a27c.png" style="width:24.25em;height:16.83em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Link to the new Vuforia version in the Vuforia Behaviour component of the ARCamera</div>
<ol start="20">
<li class="mce-root">Click on the link to download the executable and follow the steps to install it:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1159 image-border" src="assets/7ce54be6-2c8b-45c1-a4e0-c813926ae9a0.png" style="width:29.42em;height:22.83em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Vuforia AR Setup Wizard</div>
<ol start="21">
<li class="mce-root">When updating Vuforia, make sure you install it in your Unity root folder, usually in <kbd>C:/Program Files/Unity/Hub/Editor/{unity_version_name}</kbd>, and close your currently running Unity session if asked. If a message appears asking you to update your project, click <span class="packt_screen">Update</span>. Vuforia will now be up to date in your project:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1160 image-border" src="assets/0daff2ee-d0b9-4f46-a802-c6dafcb306aa.png" style="width:32.08em;height:12.58em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Update message from Vuforia Engine</div>
<p>Now that we know how to integrate Vuforia into a new project, we will start using its Ground Plane feature to create an app that detects flat surfaces and places 3D content on them.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">AR on the go – using Ground Plane</h1>
                </header>
            
            <article>
                
<p class="mce-root"><span>Vuforia's main feature that's used to place virtual objects on the user's environment in real time is called </span><strong>Ground Plane</strong><em>.</em> <span>We are going to use this feature to create an app</span> to place 3D content on horizontal surfaces of the real world, such as floors and tables. </p>
<p class="mce-root">Starting with Vuforia 7, the SDK introduced a new capability, called <strong>Vuforia Fusion</strong>, to improve the performance of spatial recognition according to each device's features, including cameras, sensors, chipsets, and internal AR frameworks. Vuforia Fusion tries to detect integrated frameworks such as ARKit (iOS) or ARCore (Android), which offer the best performance. If none are found, it tries to use VISLAM and SLAM, respectively.</p>
<div class="mce-root packt_infobox"><strong>Simultaneous localization and mapping</strong> (<span><strong>SLAM</strong>)</span> algorithms estimate the pose of an object and the map of the surrounding environment at the same time. <strong>visual-inertial simultaneous localization and mapping</strong> (<strong>VISLAM</strong>) is Vuforia's algorithm that combines <strong>v</strong><strong>isual odometry</strong> (<strong>VIO</strong>) and SLAM to improve the latter's performance.</div>
<p class="mce-root">Although the list increases quickly, not all devices support Vuforia's Ground Plane yet. In general, if the running device supports ARCore or ARKit, it will work. If not, it will depend on internal AR-enabling technologies. Vuforia keeps a list of the currently supported devices on its <span>web page: </span><a href="https://library.vuforia.com/articles/Solution/vuforia-fusion-supported-devices.html">https://library.vuforia.com/articles/Solution/vuforia-fusion-supported-devices.html</a>.</p>
<p><span><span>In the next subsection, we are going to learn how to enable ARCore in Vuforia. If your device doesn't support ARCore, you can directly skip to the next subsection. If you<span> are planning to distribute your app among ARCore-supporting and -non-supporting devices, and want to test Vuforia's VISLAM performance first, skip this step and do this after testing the final app to see the difference.</span></span></span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Enabling ARCore in Vuforia</h1>
                </header>
            
            <article>
                
<p><span>In this section, we're going to learn to enable ARCore for Vuforia; if your device supports ARCore, you will benefit from using it along with Vuforia, as the resulting app will detect flat surfaces faster and with more precision. To enable ARCore for Vuforia inside Unity, follow these steps:</span></p>
<ol>
<li><span>Download the latest version of the ARCore library from Google's repository. The global link is </span><kbd>https://dl.google.com/dl/android/maven2/com/google/ar/core/&lt;ARCORE_VERSION&gt;/core-&lt;ARCORE_VERSION&gt;.aar</kbd>.<span><em><br/></em></span>You <span>can check the latest version available at </span><a href="https://github.com/google-ar/arcore-unity-sdk/releases">https://github.com/google-ar/arcore-unity-sdk/releases</a>.</li>
</ol>
<div class="packt_tip">At the time of writing this chapter, the current version is 1.9.0, so the link will be <a href="https://dl.google.com/dl/android/maven2/com/google/ar/core/1.9.0/core-1.9.0.aar">https://dl.google.com/dl/android/maven2/com/google/ar/core/1.9.0/core-1.9.0.aar</a><span>.</span></div>
<ol start="2">
<li><span><span>In Unity, in the <span class="packt_screen">Project</span> window, right-click on the <kbd>Assets</kbd> folder and press <span class="packt_screen">Create</span></span></span>|<span><span><span class="packt_screen">Folder</span>. Name it </span></span><kbd>Plugins</kbd> <span><span>and create another one called</span></span> <kbd>Android</kbd> <span><span>inside it:</span></span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><span><span><span><img class="aligncenter size-full wp-image-1161 image-border" src="assets/7ad90606-9b4f-4b74-bb94-7e0d9b438e23.png" style="width:39.08em;height:19.50em;"/></span></span></span></p>
<div class="packt_figref CDPAlignCenter CDPAlign"><span>Creating a new folder inside Assets</span></div>
<ol start="3">
<li><span><span>Copy the downloaded <kbd>.aar</kbd> file inside the</span></span> <kbd>Android</kbd> <span><span>folder:</span></span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><span><span><img class="aligncenter size-full wp-image-1162 image-border" src="assets/23a90f03-0c87-46b4-b1d6-023c21f5ef15.png" style="width:29.75em;height:17.42em;"/></span></span></p>
<div class="packt_figref CDPAlignCenter CDPAlign">The ARCore plugin located inside the Android folder</div>
<ol start="4">
<li>Select the file and verify<span> that </span><span class="packt_screen">Android</span><span> is checked under </span><span class="packt_screen">Select platforms for plugin</span><span><span> in the <span class="packt_screen">Inspector</span> window:</span></span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><span><span><img class="aligncenter size-full wp-image-1163 image-border" src="assets/b798ee63-d31a-4fbf-8848-5b125b38429d.png" style="width:20.83em;height:24.83em;"/></span></span></p>
<div class="packt_figref CDPAlignCenter CDPAlign">ARCore library's properties in the Inspector window</div>
<ol start="5">
<li>Select the <span class="packt_screen">ARCamera</span> and click on the <span class="packt_screen">Open Vuforia Engine configuration</span> button:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/805eb651-813f-452e-9161-4970e8768729.png" style="width:19.33em;height:16.42em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Opening Vuforia Engine configuration from the ARCamera</div>
<ol start="6">
<li>Under <span class="packt_screen">Device Tracker</span>, set <span class="packt_screen">ARCore Requirement</span> to <span class="packt_screen">Optional</span> or <span class="packt_screen">Required</span>, depending on your targeted user devices:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1816 image-border" src="assets/76fcf545-0b82-4971-9b53-e7b8b1e89db2.png" style="width:18.33em;height:24.08em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Setting ARCore to OPTIONAL or REQUIRED</div>
<p><span>If set to <span class="packt_screen">OPTIONAL</span>, when using Ground Plane, Vuforia will try to make use of ARCore, and if the device doesn't support it, it will switch to Vuforia's internal algorithms. If set to <span class="packt_screen">REQUIRED</span>, the app won't work on devices that don't support ARCore.</span></p>
<p>Now that we have configured ARCore, we'll create an AR scene to test the Ground Plane feature.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating the Ground Plane scene</h1>
                </header>
            
            <article>
                
<p class="mce-root">The AR scene in this project will consist of the following elements:</p>
<ul>
<li class="mce-root">The <span class="packt_screen">ARCamera</span>, which will retrieve the physical camera's feed and process each frame</li>
<li class="mce-root">The <span class="packt_screen">Ground Plane Finder</span>, which is in charge of searching for horizontal surfaces and placing objects on them when users tap on the screen</li>
</ul>
<ul>
<li class="mce-root">The <span class="packt_screen">Ground Plane Stage</span>, which is the parent GameObject where the virtual elements will go</li>
<li>A test cube, which will appear on the ground when the user taps on the screen</li>
</ul>
<p class="mce-root">We created the <span class="packt_screen">ARCamera</span> element when we integrated Vuforia in Unity, so let's create the rest of the elements to make the Ground Plane features work:</p>
<ol>
<li class="mce-root">Right-click on the <span class="packt_screen">Hierarchy</span> window and select <span class="packt_screen">Vuforia Engine</span>|<span class="packt_screen">Ground Plane</span>|<span class="packt_screen">Ground Plane Stage</span>. This will create the parent GameObject for the contents we want to show in AR. It's represented with a visual reference of a 100 cm square to help with the virtual objects' real-world scale. This reference is only visible inside the Unity editor:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1817 image-border" src="assets/36e703af-d963-496a-a503-d25139a328b8.png" style="width:23.00em;height:26.25em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Creating a Ground Plane Stage element</div>
<ol start="2">
<li class="mce-root">The <span class="packt_screen">Ground Plane Stage</span> GameObject has two scripts attached to it: </li>
</ol>
<ul>
<li style="padding-left: 30px"><span class="packt_screen">Anchor Behaviour</span>, which determines whether the virtual objects appear attached to the ground or in mid-air</li>
<li style="padding-left: 30px"><span class="packt_screen">Default Trackable Event Handler</span>, which is Vuforia's default script to show/hide elements when the target is found/lost</li>
</ul>
<ol start="3">
<li class="mce-root">To create a virtual object to test, right-click <span class="packt_screen">Ground Plane Stage</span> and create a <span class="packt_screen">3D Object</span>|<span class="packt_screen">Cube</span>. Make sure it appears as a child of the <span class="packt_screen">Ground Plane Stage</span> so that it's shown/hidden when appropriate:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1999 image-border" src="assets/3ffe14d4-b884-4d64-963a-d756307b13a7.png" style="width:43.33em;height:49.83em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Creating a cube as the child of the Ground Plane Stage</div>
<ol start="4">
<li>Scale<span> down the cube so that it's smaller than the visual reference of the </span><span class="packt_screen">Ground Plane Stage</span><span>. Make sure it's visible from the </span><span class="packt_screen">ARCamera</span><span> in the </span><span class="packt_screen">Game</span><span> view (if not, move/rotate either the </span><span class="packt_screen">ARCamera</span><span> or, preferably, the </span><span class="packt_screen">Ground Plane Stage</span><span><span> until it's in view):</span></span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1819 image-border" src="assets/61ba0799-3123-4c41-9a85-cc730f5dca21.png" style="width:62.58em;height:25.83em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">The cube placed over the reference grid of the Ground Plane stage</div>
<ol start="5">
<li>Right-click outside the <span class="packt_screen">Hierarchy</span> <span>window and select</span> <span class="packt_screen">Vuforia Engine</span>|<span class="packt_screen">Ground Plane</span>|<span class="packt_screen">Plane Finder</span><span><span>:</span></span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><span><span><img class="aligncenter size-full wp-image-1166 image-border" src="assets/8473749c-717e-4faf-bf1e-9433c3f5d458.png" style="width:25.83em;height:38.67em;"/></span></span></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Creating the Plane Finder to detect the ground planes</div>
<ol start="6">
<li>This GameObject has three scripts attached to it:</li>
</ol>
<ul>
<li style="padding-left: 30px"><span class="packt_screen">Anchor Input Listener Behaviour</span>, which is in charge of listening for the user's input (tap on the screen)</li>
<li style="padding-left: 30px"><span class="packt_screen">Plane Finder Behaviour</span>, which is used to find horizontal surfaces to place the content</li>
</ul>
<ul>
<li style="padding-left: 30px"><span class="packt_screen">Content Positioning Behaviour</span>, which is used to position the content of the real world</li>
</ul>
<ol start="7">
<li>On the <span class="packt_screen">Content Positioning Behaviour</span> script, select (or drag from the <span class="packt_screen">Hierarch</span><span class="packt_screen">y</span>) the <span class="packt_screen">Ground Plane Stage</span> inside the <span class="packt_screen">Anchor Stage</span> selection box:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1167 image-border" src="assets/8752691c-5284-4362-a87f-8272f642ce3e.png" style="width:34.75em;height:37.25em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Linking the Ground Plane Stage to the Plane Finder</div>
<ol start="8">
<li>Before moving on, press <em>Ctrl</em> + <em>S to</em> save the current scene.</li>
</ol>
<p>Now that we have our AR scene configured, we're going to add the Vuforia key, a necessary step that we need to take in order to build Vuforia on mobile devices.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Obtaining the key</h1>
                </header>
            
            <article>
                
<p class="mce-root">Vuforia requires a development/deployment key for the app to work on a real device. To do this, follow these steps:</p>
<ol>
<li class="mce-root">Go to Vuforia's developer page (<a href="https://developer.vuforia.com/license-manager">https://developer.vuforia.com/license-manager</a>), register, and log in.</li>
<li class="mce-root">On the <span class="packt_screen">License Manager</span> tab, select <span class="packt_screen">Get Development Key</span> to obtain a free key to use while developing.</li>
<li class="mce-root">Give it the name of your app, <kbd>AR On the Go</kbd>, read and accept the terms and conditions, and press <span class="packt_screen">Confirm</span>.</li>
<li class="mce-root">Select your newly created license and copy the key numbers.</li>
<li class="mce-root">Go back to the Unity editor and select <span class="packt_screen">ARCamera</span> from the scene.</li>
<li class="mce-root">Click on <span class="packt_screen">Open Vuforia Engine Configuration</span> in the <span class="packt_screen">Inspector</span> window to open the general Vuforia configuration:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-497 image-border" src="assets/211f4bd7-180b-4e05-b06a-c05d6da55533.png" style="width:16.00em;height:28.17em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign"><span>ARCamera GameObject in the Inspector window</span></div>
<ol start="7">
<li class="mce-root">Here, paste your key into the <span class="packt_screen">App License Key</span> <span>field:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1820 image-border" src="assets/8b4cdedd-5a87-442a-a28a-bdf1331678b9.png" style="width:32.00em;height:29.50em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Vuforia configuration options in the Inspector window</div>
<p><span><span>Now, we have included a Vuforia development key in our project that will let us build and install our app on a real device.</span></span></p>
<div class="packt_infobox"><span><span>Keep in mind that when you want to upload an app to the store (Google or Apple), you will have to buy a deployment key according to Vuforia's plans. You can find the updated prices at <a href="https://developer.vuforia.com/pricing">https://developer.vuforia.com/pricing</a>. </span></span></div>
<p>In the next section, we will test our app in Unity to make sure everything works as it should.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Testing the app</h1>
                </header>
            
            <article>
                
<p>When developing a project in Unity, it's good practice to test it before building it since the building process takes time. This way, you can detect basic problems and errors and correct them quickly before actually trying the app on your phone.</p>
<p>Vuforia can't currently be built as a standalone application, but it has a script integrated with the ARCamera for testing purposes. When you are testing the app in Unity editor, it will use the computer's camera to simulate the AR. If it doesn't detect a camera, it will leave the background black and play the AR directly.</p>
<p>On the other hand, when you're working with a Ground Plane project and you want to test the app, Vuforia won't be able to use the device's sensors to detect a flat surface. Instead, it offers an image target reference to simulate Ground Plane recognition, and when the camera detects that image, it will behave like it's detecting a flat surface on the phone.</p>
<p class="mce-root"/>
<p>To test our app, follow these steps:</p>
<ol start="1">
<li><span>Locate the PDF called </span><kbd>Emulator Ground Plane.pdf</kbd> at<span> </span><span class="packt_screen">Vuforia</span>|<span class="packt_screen">Databases</span>|<span class="packt_screen">ForPrint</span>|<span class="packt_screen">Emulator </span>from the<span> </span><span class="packt_screen">Project</span><span> </span>window. Print it and place it on the ground (you can also open the PDF image directly on the computer, although the size reference might not be accurate).</li>
<li>Press the play button in the top Toolbar and point the webcam to the image. You will see a visual mark when the software detects a surface (the target, in this case). Before pressing the play button, you can click the<span> </span><span class="packt_screen">Maximize on Play</span><span> </span>button in the<span> </span><span class="packt_screen">Game</span><span> </span>view's top-right corner to see the image maximized on the screen:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1821 image-border" src="assets/6e58c8cd-228b-460a-aeeb-07ada120aed8.png" style="width:114.75em;height:73.33em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign"> Game view detecting the Ground Plane Emulator image</div>
<ol start="3">
<li>Click on the computer screen over the<span> </span><span class="packt_screen">Game</span><span> view to simulate a screen touch on the phone. The cube will appear over the target. Its size will depend on the size that you gave previously in the Unity editor (the <span class="packt_screen">Ground Plane Stag</span><span class="packt_screen">e</span> in Unity is 100 cm x 100 cm, while the printed emulator is 20 cm x 20 cm):</span> </li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1822 image-border" src="assets/1276a128-54ff-4fd9-89d0-63d504191a76.png" style="width:115.08em;height:72.92em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">The cube appears on the floor when clicking the Game view</div>
<p><span><span>If everything works as expected, we can change the cube and start shaping our AR app to show furniture in the real world.</span></span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating an AR furniture viewer</h1>
                </header>
            
            <article>
                
<p class="mce-root">Now that we have the main structure of the AR scene, we'll customize the app to create an AR furniture viewer that allows us to place chairs in the real world. The app will let us do the following:</p>
<ul>
<li class="mce-root">Place a single chair on the ground</li>
<li class="mce-root">Duplicate the chair to create a cinema-like scene</li>
<li><span>Rotate the chair to adjust it to the environment</span></li>
</ul>
<p>Let's get started!</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding elements to our project</h1>
                </header>
            
            <article>
                
<p><span><span>We will start by adding new elements to our project and scene, including the 3D model and a user interface:</span></span></p>
<ol>
<li class="mce-root">Create your own folder inside the <kbd>Assets</kbd> folder of the <span class="packt_screen">Project</span> window and name it <kbd>@MyAssets</kbd>. Then, create three other folders called <kbd>Images</kbd>, <kbd>Models</kbd>, and <kbd>Scripts</kbd> inside it:</li>
</ol>
<div class="CDPAlignCenter CDPAlign packt_figref"><img class="aligncenter size-full wp-image-1168 image-border" src="assets/09188c1a-37c8-4b7e-a782-7893a8826888.png" style="width:24.75em;height:17.17em;"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>The new folders inside @MyAssets</span></div>
<ol start="2">
<li>Now, from the resources of the project, copy the models and images into their respective folders in the <span class="packt_screen">Project</span> <span>window.<br/></span></li>
<li class="mce-root CDPAlignLeft CDPAlign">In the <span class="packt_screen">Inspector</span> <span>window, change</span> the <kbd>chair.png</kbd> <span>and</span> <kbd>cinema.png</kbd> <span>images' </span><span class="packt_screen">Texture Type</span> <span>to</span> <span class="packt_screen">Sprite (2D and UI)</span> <span>and click</span> <span class="packt_screen">Apply</span><span><span>. This will allow us to use them as UI elements later. The others will be used as regular textures on planes:</span></span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1169 image-border" src="assets/c14d5088-5a1c-45d8-8131-b37e843fb3b6.png" style="width:24.75em;height:26.08em;"/></p>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>The chair.png image import settings in the Inspector window<br/></span></div>
<ol start="4">
<li class="mce-root">Drag the <span class="packt_screen">prince</span> model from the <span class="packt_screen">Assets</span>|<span class="packt_screen">Models</span>|<span class="packt_screen">Prince</span> folder to the <span class="packt_screen">Hierarchy</span> window as the child of <span class="packt_screen">Ground Plane Stage</span>.</li>
<li class="mce-root">Delete the <span class="packt_screen">Cube</span> since we don't need it anymore.</li>
<li class="mce-root">Scale it, rotate it, and move it until it's facing forward, over the <span class="packt_screen">Ground Plane Stage</span> at a convenient size (you can adapt this later when you test the app):</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1823 image-border" src="assets/a8e6ba8b-af45-45c9-9aa4-8e5669deeca1.png" style="width:101.75em;height:40.75em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">The prince model as the Ground Plane Stage object's child in the scene</div>
<ol start="7">
<li class="mce-root">To create the UI, right-click the <span class="packt_screen">Hierarchy</span> window and select <span class="packt_screen">UI</span>|<span class="packt_screen">Button</span>. It will automatically encapsulate the <span class="packt_screen">Button</span> in a new <span class="packt_screen">Canvas</span> element and add the necessary <span class="packt_screen">Event System</span> to the scene too:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/7dbfa02f-22ae-4828-a896-a73e509e42aa.png" style="width:31.75em;height:38.50em;"/> </p>
<div class="packt_figref CDPAlignCenter CDPAlign">Creating a button in the Hierarchy window</div>
<ol start="8">
<li class="mce-root">Select the <span class="packt_screen">C</span><span class="packt_screen">anvas</span> and change the parameters on the <span class="packt_screen">Canvas Scaler</span> so that it scales up and down according to the device's screen size:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1170 image-border" src="assets/e2703a80-5d9a-422b-a884-549aab5b1b42.png" style="width:65.92em;height:63.33em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">New Canvas Scaler parameters to adapt the UI's size to the screen size</div>
<ol start="9">
<li class="mce-root">Select the button and delete its <span class="packt_screen">Text</span> GameObject.</li>
</ol>
<p> </p>
<ol start="10">
<li class="mce-root">In the <span class="packt_screen">Inspector</span> window, change its name to <kbd>chair_b</kbd> to identify it, its position, and size using the <span class="packt_screen">Rect Transform</span> component. Add the chair image to its <span class="packt_screen">Source Image</span> <span>in the</span> <span class="packt_screen">Image</span> <span>component:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/6f897b1a-d5fb-450c-b302-cb35ad4a09fb.png" style="width:39.08em;height:47.75em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Customizing the created button</div>
<p style="padding-left: 60px"><span>This is the button that will switch between moving a single chair and adding multiple chairs to form a cinema:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/a205bd30-e135-4d91-af20-233bd868c1e4.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">The view of the chair and button in the Game view</div>
<p><span>Now, we have </span>to create a script that will contain the logic of the app.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding the logic of the app</h1>
                </header>
            
            <article>
                
<p>Now, let's create the logic of the app by adding a new script to the project. <span>This will be the script in charge of switching between one and multiple chairs:</span></p>
<ol start="1">
<li class="mce-root">In your <span class="packt_screen">@MyAssets</span>|<span class="packt_screen">Scripts</span> folder, in the <span class="packt_screen">Project</span> window, right-click and select <span class="packt_screen">Create</span>|<span class="packt_screen">C# Script</span>. Call it <kbd>OnTheGoHandler.cs</kbd>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1171 image-border" src="assets/b4c53ee9-eb88-461e-9421-db3362b0f1ed.png" style="width:40.25em;height:43.67em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Adding a new script in the Project window</div>
<ol start="2">
<li><span><span>Double-click on it to open it in Visual Studio:</span></span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><span><span><img src="assets/eb1187f2-fedd-48e9-9c17-b32449ff3a98.png"/></span></span></p>
<div class="packt_figref CDPAlignCenter CDPAlign">The OnTheGoHandler script in Visual Studio</div>
<ol start="3">
<li class="mce-root">
<p class="mce-root">Add the <kbd>Vuforia</kbd> library at the top of the script to use its features:</p>
</li>
</ol>
<pre style="padding-left: 60px">using Vuforia;</pre>
<ol start="4">
<li><span>Inside the class, declare the following variables:</span></li>
</ol>
<pre style="padding-left: 60px"><span>public GameObject chairButton;</span><br/><span>public Sprite[] buttonSprites;<br/>private ContentPositioningBehaviour contentPosBehaviour; <br/>private bool multipleChairs = false;</span></pre>
<p style="padding-left: 60px">The <kbd>chairButton</kbd> variable will correspond to the button we created in Unity. The <kbd>buttonSprites</kbd> array will contain the two background images for the button and we'll switch between them. The <kbd>contentPosBehaviour</kbd> variable comes from the <kbd>Vuforia</kbd> class, which is in charge of adding our virtual objects to the real world. We will use the <kbd>multipleChairs</kbd> Boolean to switch between the two states (one chair or multiple chairs). Public variables will be initialized in the Unity editor.</p>
<ol start="5">
<li>Inside the <kbd>Start()</kbd> method, add the following code:</li>
</ol>
<pre style="padding-left: 60px">contentPosBehaviour = GetComponent&lt;ContentPositioningBehaviour&gt;(); </pre>
<p style="padding-left: 60px"><span>This will retrieve the </span><kbd>ContentPositioningBehaviour</kbd><span> component of the GameObject that contains the script.</span></p>
<ol start="6">
<li class="mce-root">
<p class="mce-root">After the <kbd>Update()</kbd> method, create a new method:</p>
</li>
</ol>
<pre style="padding-left: 60px" class="mce-root">public void SwitchMultipleChairs()<br/> {<br/>     if (!multipleChairs) <br/>     {<br/>         chairButton.GetComponent&lt;UnityEngine.UI.Image&gt;().sprite = buttonSprites[1];<br/>         contentPosBehaviour.DuplicateStage = true;<br/>         multipleChairs = true;<br/>     }<br/>     else<br/>     {<br/>         chairButton.GetComponent&lt;UnityEngine.UI.Image&gt;().sprite = buttonSprites[0];<br/>         contentPosBehaviour.DuplicateStage = false;<br/>         multipleChairs = false;<br/>     }<br/> }</pre>
<p style="padding-left: 60px" class="mce-root">When this method is called, it checks whether the current state is a single chair or multiple chairs. It switches the image of the UI button accordingly and adjusts the <kbd>DuplicateStage</kbd> <span>parameter </span><span>of the</span> <kbd>ContentPositioningBehaviour</kbd> <span>class to allow one or multiple instances of the same chair. Then, it sets</span> <kbd>multipleChairs</kbd> <span>to</span> <kbd>true</kbd> <span>or</span> <kbd>false</kbd> <span>to keep track of the current state.</span></p>
<p class="mce-root"/>
<ol start="7">
<li class="CDPAlignLeft CDPAlign"><span>Back in the Unity editor, drag the script over the <span class="packt_screen">Plane Finder</span>. Alternatively, in the <span class="packt_screen">Inspector</span> window, click on <span class="packt_screen">Add Component</span></span>|<span><span class="packt_screen">On The Go Handler</span>:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1172 image-border" src="assets/cdd4e4b9-9753-4885-860f-37b065a44126.png" style="width:66.08em;height:68.42em;"/></p>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>Adding the created script to the Plane Finder GameObject<br/></span></div>
<ol start="8">
<li class="CDPAlignLeft CDPAlign">In the <span class="packt_screen">On The Go Handler</span> <span>script, select or drag the button to the</span> <span class="packt_screen">Chair Button</span> <span>field and select the two sprites, chair and cinema, from</span> <span class="packt_screen">@MyAssets</span>|<span class="packt_screen">Images</span> <span>in that order (see the following screenshot).</span></li>
<li class="CDPAlignLeft CDPAlign"><span>From the</span> <span class="packt_screen">Content Positioning Behaviour</span><span> drop-down, uncheck</span> <span class="packt_screen">Duplicate Stage</span><span> so that it starts with a single chair:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/38598ab4-0df9-43e8-a73b-8cfa16d2dd48.png" style="width:30.92em;height:39.08em;"/></p>
<div class="CDPAlignCenter CDPAlign packt_figref"><span> Assigning the corresponding elements to the OnTheGoHandler script in the Inspector window<br/></span></div>
<ol start="10">
<li>Finally, select the button and, in the <span class="packt_screen">On Click ()</span> method, at the bottom, choose the <span class="packt_screen">Plane Finder</span> and select the <span class="packt_screen">On The Go Handler</span>|<span class="packt_screen">SwitchMultipleChairs</span> function:</li>
</ol>
<div class="CDPAlignCenter CDPAlign packt_figref"><img class="aligncenter size-full wp-image-1173 image-border" src="assets/15e51237-1b5f-45b0-b17c-5345d6302a4b.png" style="width:22.83em;height:47.50em;"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>Selecting the OnClick() method behaviour for the button in the Inspector window</span></div>
<ol start="11">
<li>Before we add any new features, we need to build this app on a mobile device. Press <em>Ctrl</em> + <em>Shift</em> + <em>B</em> or go to <span class="packt_screen">File</span>|<span class="packt_screen">Build Settings...</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1174 image-border" src="assets/c7503e3f-d531-49c4-9774-df958b538755.png" style="width:52.33em;height:41.08em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Build Settings panel to build and run the app on a mobile device</div>
<ol start="12">
<li>Press <span class="packt_screen">Build And Run</span>, give your <kbd>.apk</kbd> file a name, and run it on the mobile device. Point the camera to the ground until a little icon appears, marking the ground level:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1175 image-border" src="assets/5fb64796-d4e5-4608-89f0-079e404b1b6a.png" style="width:31.58em;height:17.75em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">The white square shows the point of the ground where the virtual objects will be placed</div>
<ol start="13">
<li>Move around and tap on the screen to place a chair. Now, you can walk around the virtual chair to see it from different angles:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1176 image-border" src="assets/95a34205-8713-4bd7-9fdf-327a6bd2255d.png" style="width:31.67em;height:17.83em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">The virtual red chair placed in a real environment</div>
<ol start="14">
<li>Press the button to switch to multiple-chair mode, move the camera around, and place multiple chairs all over the room:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1177 image-border" src="assets/53821359-3a01-4a75-9d12-8f8b08f31c81.png" style="width:49.17em;height:27.75em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Two virtual chairs, one next to the other</div>
<p>It's probable that, on your first attempt, the chair won't have the desired size or the shadows won't correspond to the real ones. Furthermore, the chair will always be facing forward, so you'll have to move around the room before placing it in the desired place. Let's improve these little details to make the app more appealing.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Improving the app</h1>
                </header>
            
            <article>
                
<p>Now, we are going to improve the current app to make it more appealing to the user:</p>
<ol start="1">
<li>First of all, try adding a new <span class="packt_screen">Directional Light</span> (right-click on the existing one and press <span class="packt_screen">Duplicate</span>) and play with its <span class="packt_screen">Rotation</span>, <span class="packt_screen">Intensit</span><span class="packt_screen">y</span>, and/or <span class="packt_screen">Shadow Type</span>. In this case, we have placed two lights, with <span class="packt_screen">Rotation</span> values of (<kbd>-30</kbd>,<kbd>-20</kbd>,<kbd>0</kbd>) and (<kbd>30</kbd>,<kbd>20</kbd>,<kbd>0</kbd>) respectively and with <span class="packt_screen">No Shadows</span>, creating a lighter-colored chair:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1824 image-border" src="assets/e76034fd-6f8b-4a57-922d-d074265cfd59.png" style="width:53.00em;height:38.17em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Values of one of the Directional Lights</div>
<ol start="2">
<li>Now, let's make the visual reference of the floor more visible: select the <span class="packt_screen">Plane Finder</span> GameObject and, in the <span class="packt_screen">Inspector</span> window, double-click on the <span class="packt_screen">DefaultPlaneIndicator</span> element located in the <span class="packt_screen">Plane Finder Behaviour</span> script. This will open the original element:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1825 image-border" src="assets/29249900-8077-463a-a06f-7824494a0f91.png" style="width:52.58em;height:22.58em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Selecting DefaultPlaneIndicator in the Inspector window</div>
<ol start="3">
<li>From the <span class="packt_screen">Hierarchy</span> window, select the <span class="packt_screen">DefaultIndicator</span> child. Then, in the <span class="packt_screen">Inspector</span> window, increase its size to <kbd>0.05</kbd> and change the default image to <span class="packt_screen">reticle_ground_surface</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1178 image-border" src="assets/1766c05c-071f-44a6-b473-0980c9a86c39.png" style="width:43.42em;height:49.08em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">The DefaultIndicator GameObject's components in the Inspector window</div>
<ol start="4">
<li>Let's add a rotation indicator to the chair so that it appears when we use two fingers on the screen. Right-click on the <span class="packt_screen">prince</span> GameObject in the <span class="packt_screen">Hierarchy</span> window and select 3<span class="packt_screen">D Object</span>|<span class="packt_screen">Quad</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign packt_figref"><img class="aligncenter size-full wp-image-1826 image-border" src="assets/76d89880-1dc4-4b4f-9fab-9c7729113ac1.png" style="width:48.25em;height:45.17em;"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Creating a Quad element child of the prince GameObject</div>
<ol start="5">
<li>
<p>Drag the <kbd>placement_rotate</kbd> image from the <span class="packt_screen">Project</span> window over the <span class="packt_screen">rotate</span> GameObject in the <span class="packt_screen">Hierarchy</span> window to convert it into its texture and set the material's <span class="packt_screen">Rendering Mode</span> to <span class="packt_screen">Cutout</span>:</p>
</li>
</ol>
<div class="CDPAlignCenter CDPAlign packt_figref"><img src="assets/e0db86f6-98c3-470b-a47e-f7d7f0213715.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>Quad's material's properties on the Inspector</span></div>
<ol start="6">
<li>Adjust its position and rotation so that it appears in the middle of the<span> </span><span class="packt_screen">Ground Plane Stage</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/657aacd3-f55e-45f7-b714-3836a4b86d60.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">The Quad in the middle of the Ground Plane around the seat</div>
<ol start="7">
<li>Now, create another script in the <span class="packt_screen">@MyAssets</span>|<span class="packt_screen">Scripts</span> folder. Call it <kbd>ChairHandler.cs</kbd> and attach it to the <span class="packt_screen">prince</span> GameObject:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1827 image-border" src="assets/9569e497-f230-4335-8139-5944bd3c7768.png" style="width:42.25em;height:47.75em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">The prince GameObject with the newly created script attached to it</div>
<ol start="8">
<li>Double-click on the script to open it in Visual Studio:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/f40008d1-57e8-4048-b542-f91166be209e.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">ChairHandler script in Visual Studio</div>
<ol start="9">
<li>At the beginning of the class, add the following variables:</li>
</ol>
<pre style="padding-left: 60px">public GameObject rotateGO;<br/>private float rotateSpeed = 0.8f;</pre>
<p style="padding-left: 60px">The first variable refers to the <span class="packt_screen">Quad</span> GameObject we created previously (with the rotation arrows image). The second variable controls the rotation speed of the chair.</p>
<ol start="10">
<li>Inside the <kbd>Start()</kbd> method, add the following code:</li>
</ol>
<pre style="padding-left: 60px">rotateGO.SetActive(false);</pre>
<p style="padding-left: 60px"> With this, we are hiding the rotate arrows until the chair is actually rotating. </p>
<ol start="11">
<li>Now, inside the <kbd>Update()</kbd> method, add the following code:</li>
</ol>
<pre style="padding-left: 60px">Touch[] touches = Input.touches;<br/>if (Input.touchCount == 2 &amp;&amp; (touches[0].phase == TouchPhase.Moved || touches[1].phase == TouchPhase.Moved))<br/>{<br/> rotateGO.SetActive(true);<br/><br/> Vector2 previousPosition= touches[1].position - touches[1].deltaPosition - (touches[0].position - touches[0].deltaPosition);<br/> Vector2 currentPosition = touches[1].position - touches[0].position;<br/> float angleDelta = Vector2.Angle(previousPosition, currentPosition);<br/> Vector3 cross = Vector3.Cross(previousPosition, currentPosition);<br/><br/> Vector3 previousRotation = transform.localEulerAngles;<br/> if (cross.z &gt; 0)<br/> {<br/> transform.localEulerAngles = previousRotation - new Vector3(0, angleDelta * rotateSpeed, 0);<br/> }<br/> else if (cross.z &lt; 0)<br/> {<br/> transform.localEulerAngles = previousRotation + new Vector3(0, angleDelta * rotateSpeed, 0);<br/> } <br/>}<br/>else<br/>{<br/> rotateGO.SetActive(false);<br/>} </pre>
<p style="padding-left: 60px">The preceding code retrieves the touches coming from the screen. If it's two touches (two fingers touching the screen) and at least one of them is moving, it does the following:</p>
<ul>
<li style="padding-left: 30px">Makes the rotation image visible.</li>
<li style="padding-left: 30px">Retrieves the touches' positions.</li>
<li style="padding-left: 30px">Calculates the angle between the last finger position and the current one, and rotates the chair accordingly. When the user stops rotating the chair, the rotation image is hidden again.</li>
</ul>
<ol start="12">
<li>The final step is to drag the <span class="packt_screen">Quad</span> GameObject from the <span class="packt_screen">Hierarchy</span> to the <span class="packt_screen">ChairHandler</span> script's <span class="packt_screen">Rotate GO</span> field in the <span class="packt_screen">Inspector</span> window.</li>
<li>Now, you can directly press <em>Ctrl</em> + <em>B</em> to build and run the project or do so through <span class="packt_screen">File</span>|<span class="packt_screen">Build And Run</span>. As you can see, the mark on the ground is much more visible now:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1180 image-border" src="assets/96e707e8-567b-498b-9fac-c60af30e0e0a.png" style="width:28.50em;height:15.67em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">The new ground reference mark</div>
<ol start="14">
<li>Now, you can also rotate the chair to see how it would look in its place:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1181 image-border" src="assets/27609e39-b472-406f-a925-5161c2b9b1c1.png" style="width:18.17em;height:21.42em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Rotation arrows appearing when the user rotates the chair with two fingers</div>
<p><span><span>With that, we have completed the AR furniture viewer. </span></span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p class="mce-root">In this chapter, we have learned about one of Vuforia's features: Ground Plane. We created a project that places virtual chairs in real-life scenarios and lets us manipulate them with touchscreens (rotate them) and through a simple UI button (multiply them).</p>
<p class="mce-root">By now, you will have a better understanding of how Vuforia works, how to create Vuforia elements inside Unity, and how to create a wholly functional Ground Plane example in it. With the skills that you've acquired through this project's development, you can improve it by adding new 3D models, new UI elements, or updating the current scripts to include more features in the app.</p>
<p class="mce-root">You also have better insight into how AR can work in the retail field so that you can adapt the current project to fill your personal or professional needs in this area. As we mentioned at the beginning of this chapter and seen throughout, the app can easily be changed to display other types of furniture, decorations, carpets, or any product that you want to show over a surface and observe from different angles.</p>
<p class="mce-root">In the next chapter, we will be exploring Vuforia's possibilities even further by looking at Image Targets and deploying the app inside Moverio AR glasses.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<p>From here, you can try to use Vuforia's<span> </span><span class="packt_screen">Mid Air</span><span> </span>option<span>, which, instead of placing the objects attached to the ground, places them at a distance from it. This can be useful for placing objects on walls, such as frames, pictures, and so on, or when working with flying objects such as drones. Their use is very similar; instead of creating a </span><span class="packt_screen">Plane Finder</span><span> and </span><span class="packt_screen">Ground Plane Stage</span><span>, you create a </span><span class="packt_screen">Mid Air Positione</span><em><span class="packt_screen">r</span></em><span> and </span><span class="packt_screen">Mid Air Stage</span><span>.</span></p>
<p><span>You can also download the Vuforia core samples from the Unity Asset Store (</span><a href="https://assetstore.unity.com/packages/templates/packs/vuforia-core-samples-99026">https://assetstore.unity.com/packages/templates/packs/vuforia-core-samples-99026</a><span>), which includes a full example of the Ground Plane and its features.</span></p>


            </article>

            
        </section>
    </body></html>