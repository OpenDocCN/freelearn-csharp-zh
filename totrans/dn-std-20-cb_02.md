# 原始数据类型、集合、LINQ以及更多

在本章中，我们将介绍以下内容：

+   构建一个使用原始数据类型的.NET Standard 2.0库

+   构建一个用于使用库的.NET控制台应用程序

+   创建集合

+   构建一个用于使用库的WPF应用程序

+   使用反射描述我们的库

+   构建一个用于使用库的.NET Core控制台应用程序

+   构建一个使用LINQ的.NET Standard 2.0库

+   构建一个用于使用库的ASP.NET MVC应用程序

# 技术要求

读者应该具备基本的C#知识。他们还应该了解如何使用Visual Studio，使用NuGet安装包，以及在其他项目中引用项目中的库。

本章的代码文件可以在GitHub上找到：

[https://github.com/PacktPublishing/DotNET-Standard-2-Cookbook/tree/master/Chapter02](https://github.com/PacktPublishing/DotNET-Standard-2-Cookbook/tree/master/Chapter02)

查看以下视频以查看代码的实际操作：

[https://goo.gl/BiXiAM](https://goo.gl/BiXiAM)

# 简介

当您将C#视为一种语言时，有一些事情我们需要首先考虑：C#能做什么，它如何支持我们的日常编程需求，以及它如何帮助我们解决问题。在本章中，我们将主要探讨C#支持的原始数据类型、集合和LINQ功能。在完整的.NET Framework中，使用这些功能没有问题，但当涉及到跨平台和.NET Framework不同版本之间的代码共享时，它确实成为一个问题。

每个菜谱都将通过构建.NET Standard 2.0库以及如何使用它来介绍如何与使用.NET Framework版本的程序一起使用。

# 构建一个使用原始数据类型的.NET Standard 2.0库

在这个菜谱中，我们将探讨C#原始数据类型及其在.NET Standard 2.0库中的使用。原始数据类型是框架的核心部分之一。这些类型是在.NET Framework本身中定义的，而不是在C#语言规范中定义的。

我们将构建一个使用.NET Framework中的原始数据类型的.NET Standard 2.0库，并在下一个菜谱中使用它。

# 准备工作

如前所述，原始数据类型是在.NET Framework本身中定义的，并且不是特定于语言的。这意味着您可以在.NET Framework支持的所有语言中使用这些数据类型。这并不意味着您可以在不同版本的.NET Framework中使用这些原始数据类型。例如，如果一个数据类型是在.NET Framework版本4.6.1中定义的，而在.NET Core 2.0中没有定义，那么您的代码将在.NET Core 2.0中失败。

此外，请确保您拥有最新的Visual Studio版本，即写作时的2017版本。

# 如何操作...

1.  打开Visual Studio 2017。

1.  点击“文件”|“新建”|“项目”，然后在“新建项目模板”对话框中，在左侧窗格的“其他项目类型”节点下选择“Visual Studio解决方案”，然后在右侧窗格中选择“空白解决方案”。

1.  在“名称”文本框中，输入`Chapter2.Primitives`作为解决方案的名称。在“位置”下拉列表中选择一个首选位置，或点击“浏览...”按钮选择一个位置。保留默认设置。

![图片](img/c20399d7-b2e9-46c0-bb99-3574accc4395.png)

1.  点击“确定”。

1.  现在，在解决方案资源管理器中（或按*Ctrl* + *Alt* + *L*），选择Chapter2.Primitives。右键单击，选择“添加”|“新建项目**”。**

1.  在“添加新项目”对话框中，展开“Visual C#”节点，在左侧窗格中选择.NET Standard。

1.  在右侧窗格中，选择类库(.NET Standard)：

![图片](img/2f43e866-6234-4fdb-bdc5-dbe41ad92b7c.png)

1.  现在，在“名称”文本框中，输入`Chapter2.Primitives.PrimitiveLib`，并将“位置”文本框保留为默认设置：

![图片](img/54e2fecb-0500-48be-95d4-ac805bbfefea.png)

1.  点击“确定”。

1.  现在，解决方案资源管理器应该看起来像这样：

![图片](img/61ea9ea7-b0e1-4993-b1ae-81438b4c9e0c.png)

1.  点击`Class1.cs`并按*F2*重命名它。输入`Helpers.cs`作为新名称。

1.  在重命名确认对话框中，选择“是”。

1.  现在，双击`Helpers.cs`以打开其代码窗口。

1.  在`Helpers`类的花括号之间输入以下代码：

[PRE0]

1.  按*Ctrl* + *Shift* + *B*构建您的代码。

1.  再次，在步骤14的结束花括号旁边输入以下代码：

[PRE1]

1.  让我们构建代码以检查一切是否正常。点击“生成”|“生成解决方案”或按*Ctrl* + *Shift* + *B*，解决方案应该能够成功构建。让我们在下一个菜谱中测试我们的类库。

1.  点击“文件”|“全部保存”，或者按*Ctrl* + *Shift* + *S*，以保存解决方案和类库项目。

# 它是如何工作的...

让我们看看到目前为止我们取得了什么成果。从步骤1到4，我们打开了Visual Studio 2017并创建了一个空白解决方案。空白解决方案是具有多个项目的项目的良好基础。在步骤5到10中，我们在空白解决方案中添加了一个新项目。在第7步中，我们使用了一个现有的基础.NET Standard 2.0项目模板，并在第8步中给它起了适当的名字。

在第11步和第12步中，我们将默认的`Class1.cs`更改为有意义的名称。这些名称非常重要，它有助于开发者理解文件内部的代码用途。在这种情况下，我们选择了`Chapter2.Primitives.PrimitiveLib`作为项目名称。前两部分提供了解决方案名称，最后是实际的项目名称。

在第14步中，我们创建了包含公共方法的代码。该方法接受一个`int`类型的变量作为参数。`int`是框架本身支持的原始数据类型，因此我们在.NET Standard库中使用它。这意味着代码可以在.NET Framework、.NET Core和Mono运行的应用程序之间共享。

数据类型`int`是`System.Int32`的别名，这些是在.NET下支持的原始类型，可以在.NET Standard 2.0库中使用和共享：

+   `Boolean`

+   `Byte`

+   `SByte`

+   `Int16`

+   `UInt16`

+   `Int32`

+   `UInt32`

+   `Int64`

+   `UInt64`

+   `IntPtr`

+   `UIntPtr`

+   `Char`

+   `Double`

+   `Single`

代码接受一个 `char` 变量，每个 `if` 语句验证通过方法中的 `yourMarks` 参数发送的分数。最后，方法返回一个 `char` 值作为成绩，然后我们确认所有语法都是正确的，并在步骤 15 中成功构建。在步骤 16 中，我们创建了另一个方法，将厘米转换为英寸。输入参数是另一个原始类型 `double`，它也是 `System.Double` 的别名。这是因为 C# 将所有原始类型表示为对象。在代码内部，一个变量已经将厘米转换为英寸，并存储为 `oneCmToInches`**。**在最后一行，我们返回英寸作为 `double`，这是从方法参数中给出的厘米转换而来的。

在步骤 17 中，我们进行了另一个构建以检查所有代码的语法，并最终保存了所有内容。

# 一个用于使用库的 .NET 控制台应用程序

在本菜谱中，我们将做两件事。首先，我们将打开 Visual Studio 并对之前构建的 .NET Standard 2.0 库的解决方案进行快速构建。最后，我们将添加一个 .NET 控制台应用程序来使用这个库。这个控制台应用程序将在 Windows 下使用 .NET Framework 4.6.1 作为基础框架。

# 准备工作

确保你已经完成了上一个菜谱中构建的 .NET Standard 2.0 库。我们将在本菜谱中使用它。打开 Visual Studio 2017 并准备项目。点击 构建 | 构建解决方案，或者按 *Ctrl* + *Shift* + *B*，解决方案应该能够成功构建。一切准备就绪，可以测试我们的类库。

# 如何操作...

1.  打开 Visual Studio 2017。

1.  现在打开上一个菜谱中的解决方案。点击 文件 | 打开 | 打开项目/解决方案，或者按 *Ctrl* + *Shift* + *O*，然后选择 Chapter2.Primitives 解决方案。

1.  现在，点击 Chapter2.Library 解决方案标签。点击 文件 | 添加 | 新建项目。

1.  在 添加新项目 模板对话框中，展开左侧面板中的 Visual C# 节点。

1.  在右侧面板中选择 Windows Classic Desktop，然后选择 控制台应用程序 (.NET Framework)：

![](img/a39cf4fe-46b0-4d02-a64a-9d0809d710ea.png)

1.  现在，在名称：文本框中，键入 `Chapter2.Primitives.PrimitivesConsole`，并保持位置：文本框不变。

![](img/13e8f526-ea8e-4513-94f5-3a39811fee8b.png)

1.  点击确定。

1.  添加新项目后，解决方案资源管理器 (*Ctrl* + *Alt* + *L*) 应该看起来像这样：

![](img/a6ba892c-9cf2-4c16-9014-163008c00383.png)

1.  在 Chapter2.Primitives.PrimitivesConsole 项目节点中点击引用标签。右键单击并选择添加 | 添加引用。

1.  在参考管理器中，在左侧面板中选择项目，然后在右侧面板中检查 Chapter2.Primitives.PrimitiveLib：

![](img/8a4442e5-962a-4e15-9ba0-e1dd14a478c6.png)

1.  点击确定以将引用添加到所选项目。

1.  现在，在新增的控制台应用程序项目中，双击 Program.cs 打开代码窗口。

1.  向上滚动并添加以下 `using` 指令：

[PRE2]

1.  现在，向下滚动，在 `Main()` 方法的花括号之间，输入以下代码：

[PRE3]

1.  现在，按 *F5* 键进行代码调试。

1.  你应该看到如下输出：

![图片](img/f99be648-880f-4319-bc7b-b5a44a781a70.png)

1.  现在，按任意键退出控制台，点击在 `Console.ReadLine()` 行之前，按 *Enter* 键添加一些新的代码。

1.  让我们现在输入以下代码：

[PRE4]

1.  按 *F5* 键查看输出，你应该会看到以下内容：

![图片](img/853b0f62-feaf-4c03-a40f-043f8f36ffa5.png)

1.  现在我们已经成功测试了库，更改一些值并查看它是如何工作的。

# 它是如何工作的...

在第1步到第7步中，我们打开了一个现有的 Visual Studio 解决方案，并向其中添加了一个新项目。新添加的项目是基于 .NET 的控制台应用程序。在第9步到第11步中，我们添加了对 .NET Standard 2.0 库项目的引用。这是一个重要的步骤。为了使用库中的功能，你必须将项目作为引用添加。

在第13步，我们添加了代码来使用库的第一个方法。代码的第一行将定义一个变量来持有 `Helpers()` 类的实例。`var` 关键字帮助你创建一个局部变量，而不需要给出显式的类型。它只是告诉编译器从初始化语句右侧的表达式中获取变量的类型。例如，请看以下内容：

[PRE5]

这与以下内容相同：

[PRE6]

代码的第二行保存了 `WhatIsMyGrade()` 方法的返回值。下一行将输出显示到控制台窗口。最后一行将告诉控制台等待按键。在第14步和第15步中，我们看到了我们编写的代码的输出。

在第17步，我们正在测试我们创建的 .NET Standard 2.0 库中 `Helpers()` 类内的第二个方法。在第一行，我们创建了一个变量来存储需要转换的默认值。在第二行，它将转换后的输出存储在一个变量中。同样，我们使用了 `var` 关键字来存储变量，这将自动存储从方法返回的类型值，在本例中是 `System.Double` 类型。第三行将在控制台窗口中显示输出。在第18步和第19步中，我们执行了控制台应用程序。

# 创建集合

在 .NET Framework 中支持三种类型的集合。在这个菜谱中，我们将专注于在 .NET Standard 2.0 库中使用这些集合。一般来说，集合用于管理相关对象的组。创建对象的数组是分组相关对象的一种方式。但我们的重点是使用这些集合，这是分组相关对象的第二种方法。

# 准备工作

这是我们在 .NET Framework 中拥有的三种类型的集合：

+   `System.Collections.Generic` 类

+   `System.Collections.Concurrent` 类

+   `System.Collections` 类

让我们来看看这些以及它们在 .NET Standard 2.0 库中的使用。

# 如何操作...

1.  打开 Visual Studio 2017。

1.  点击 文件 | 新建 | 项目，然后在新建项目模板对话框中，在左侧窗格的 其他项目类型 节点下选择 Visual Studio 解决方案，然后在右侧窗格中选择 空白解决方案。

1.  在 名称：文本框中，输入 `Chapter2.Collections` 作为解决方案的名称。在 位置：下拉列表中选择一个首选位置或点击 浏览... 按钮选择一个位置。保留默认设置不变：

![图片](img/80f7e6d9-3b59-40d2-bb73-d424abf4ba74.png)

1.  点击确定。

1.  现在，在解决方案资源管理器（或按 *Ctrl* + *Alt* + *L*），选择 Chapter2.Collections。右键单击并选择 添加 | 新建项目。

1.  在添加新项目对话框中，展开 Visual C# 节点并在左侧窗格中选择 .NET Standard。

1.  在右侧窗格中选择 类库 (.NET Standard)：

![图片](img/eb794e35-3680-4d29-888f-895b453ccd3d.png)

1.  现在，在 名称：文本框中输入 `Chapter2.Collections.CollectionsLib` 并保留 位置：文本框不变：

![图片](img/069f3d1e-745e-46e8-b167-ff7754aa9a8e.png)

1.  点击确定。

1.  现在，解决方案资源管理器应该看起来像这样：

![图片](img/12f5b8f1-dbfb-40bf-a472-d3b7d5dd5bd2.png)

1.  点击 Class1.cs 并按 *F2* 重命名它。输入新名称为 `LittleShop.cs`。

1.  在确认对话框中选择是进行重命名。

1.  现在双击 `LittleShop.cs` 以打开其代码窗口。

1.  在代码窗口顶部，将光标（或点击鼠标）移动到 using 指令的最后一行并添加以下 using 指令：

[PRE7]

1.  在 LittleShop 类的花括号之间输入以下代码：

[PRE8]

1.  按下 *Ctrl* + *Shift* + *B* 进行快速构建并检查任何语法错误。

1.  现在在代码窗口顶部的 using 指令末尾输入以下代码：

[PRE9]

1.  在 GetFruitsList() 方法的末尾添加以下代码：

[PRE10]

1.  快速按一下 *Ctrl* + B 进行调试并检查语法错误。

1.  现在我们已经准备好测试库了。

# 工作原理...

让我们看看幕后发生了什么。从步骤1到4，我们创建了项目的基。这个基将帮助您创建 .NET Standard 2.0 库以及将使用该库的项目。空白解决方案始终是任何类型项目的良好起点。在步骤5到10中，我们将 .NET Standard 2.0 库项目添加到空白解决方案，并给它一个有意义的名称。在步骤11到13中，我们将默认类模板名称更改为有意义的名称。

在第 14 步中，我们创建了对 `System.Collections.Generics` 命名空间的引用。这将使您能够访问此命名空间下所有可用的集合。在第 15 步中，我们使用了一个名为 `List<T>` 的泛型集合对象。在接下来的几行中，我们将一些字符串对象添加到创建的变量中。最后，我们返回了列表集合，它与 `GetFruitsList()` 方法的返回类型相同。然后，在第 16 步中，我们进行了快速构建，这将帮助我们检查代码的语法。进行快速构建以检查语法是一个好的做法。

再次，在第 17 步中，我们向 `System.Collections` 命名空间添加了另一个引用。然后，在第 18 步中，我们添加了一个返回 `ArrayList()` 的 `public` 方法，它包含在 `System.Collections` 命名空间中。在 `GetShopItems()` 方法的第一行中，我们创建了一个 `ArrayList()` 对象的实例，在接下来的几行中，我们使用其 `Add()` 方法向 `ArrayList()` 添加了一个字符串对象。最后，在最后一行，我们返回存储在变量中的数组列表。然后，在第 19 步中，我们进行了快速构建，这将帮助我们检查代码的语法。进行快速构建以检查语法是一个好的做法。

最后一种类型是 `System.Collections.Concurrent` 命名空间。此命名空间包含线程安全的集合。这意味着多个线程可以安全地向这些集合添加或从这些集合中删除项目。

# 一个用于使用库的 WPF 应用程序

在本菜谱中，我们将创建一个用于使用我们在上一个菜谱中创建的 .NET Standard 2.0 库的 Windows Presentation Foundation 应用程序。我们将从之前创建的解决方案继续构建应用程序。Windows Presentation Foundation 是一个在 .NET Framework 下工作并在 Windows OS 中运行的 UI 框架。

# 准备工作

打开 Visual Studio 2017 并为项目做准备。确保你已经完成了在预览构建中构建 .NET Standard 2.0 库。如果该项目尚未打开，请打开它，然后点击 构建 | 构建解决方案，或按 *Ctrl* + *Shift* + *B*，解决方案应该能够成功构建。一切准备就绪，可以测试我们的类库。

# 如何操作...

1.  打开 Visual Studio 2017。

1.  现在打开之前菜谱中创建的解决方案。点击 文件 | 打开 | 打开项目/解决方案，或按 *Ctrl* + *Shift* + *O*，并选择 Chapter2.Collections 解决方案。

1.  现在，点击 Chapter2.Collections 解决方案标签。点击 文件 | 添加 | 新建项目。

1.  在 添加新项目 模板对话框中，展开左侧窗格中的 Visual C# 节点。

1.  在右侧窗格中选择 Windows Classic Desktop 然后选择 WPF App (.NET Framework)：

![](img/1f8418ff-babb-41b1-94cd-cb36decccbe8.png)

1.  在“名称：”文本框中，输入`Chapter2.Collections.WPFLittleShop`作为项目的名称，并保持“位置：”文本框不变：

![](img/d9de6ce8-85ad-4159-a2b1-40aaab20827f.png)

1.  点击确定。

1.  现在，解决方案资源管理器（按 *Ctrl* + *Alt* + *L* 打开）应该看起来像这样：

![](img/686e8ecb-694e-4ae7-a79a-845b5f6f61a7.png)

1.  现在，双击`MainWindow.xaml`以打开设计视图。

1.  通过按*Ctrl* + *Alt* + *X*打开工具箱，并将两个按钮和两个列表框拖放到主窗口中。

1.  将它们放置如下：

![](img/a25fcb29-fdb4-4db5-a4ac-fd2678e31701.png)

1.  现在，打开属性窗口，或按*F4*，并更改以下属性：

    | **控制器** | **属性** | **值** |
    | --- | --- | --- |
    | 按钮（从左数第一个） | 名称 | `FruitsButton` |
    | 按钮（从左数第一个） | 内容 | `Get Fruits` |
    | 按钮（从左数第二个） | 名称 | `ItemsButton` |
    | 按钮（从左数第二个） | 内容 | `Get Items` |
    | 列表框（从左数第一个） | 名称 | `FruitsList` |
    | 列表框（从左数第二个） | 名称 | `ItemsList` |

1.  应用了之前的属性后，`MainWindow`应该看起来像这样：

![](img/770fe6a7-65a2-4452-9df6-d5cb18b0f62f.png)

1.  现在，在解决方案资源管理器中（或按*Ctrl* + *Alt* + *L*），展开`Chapter2.Collections.WPFLittleShop`项目树。

1.  右键单击“引用”标签并选择“添加引用”。

1.  在引用管理器对话框中，展开左侧窗格中的“项目”节点。

1.  点击“解决方案”。

1.  现在，在右侧窗格中检查`Chapter2.Collections.CollectionsLib`：

![](img/aecd3e1c-474b-41c4-a86e-c414f0ba4d72.png)

1.  点击“确定”。

1.  双击“获取水果”按钮。

1.  你将看到`FruitsButton_Click()`方法。

1.  向上滚动代码窗口，并在所有`using`指令的末尾添加以下`using`指令：

[PRE11]

1.  再次向下滚动，并在`FruitsButton_Click()`方法中编写以下代码：

[PRE12]

1.  通过点击其标签或直接在解决方案资源管理器中双击`MainWindow.xaml`标签来切换回`MainWindow.xaml`的设计视图。

1.  选择“获取项目”按钮并双击它。

1.  现在，在`ItemsButton_Click()`事件方法中输入以下代码：

[PRE13]

1.  让我们按*F5*来调试代码。

1.  点击“获取水果”和“获取项目”按钮。

1.  你应该看到如下输出：

![](img/f23c37d3-b1e1-4b54-85dc-4f697f724814.png)

# 它是如何工作的...

现在，我们有一个使用.NET Standard 2.0库作为其源的工作WPF应用程序。让我们看看我们遵循的步骤。在步骤1到7中，我们打开了之前构建的.NET Standard 2.0库项目和解题方案。之后，我们将一个Windows Presentation Foundation项目添加到解决方案中。正如你所知，WPF是一个在.NET Framework之上运行的UI框架。

从步骤9到13，我们只是创建了应用程序的用户界面。然后在步骤12中，我们更改了我们添加的控件的一些默认属性。赋予有意义的名称是一个非常好的做法，因为它有助于你构建可读的代码。在步骤20中，我们只是双击了一个控件，在这个例子中是按钮，以打开代码窗口。默认情况下，Visual Studio为我们选择了一个事件。主要选择一个常用事件，在这个例子中是按钮的点击事件。

在步骤22中，我们将.NET Standard 2.0库引用到代码中。这将允许你在WPF应用程序中访问其可用方法。在步骤23中，我们有按钮点击事件的实际运行代码。在第一行，我们创建了一个`LittleShop()`实例并将其存储在一个变量中。然后我们使用`GetFruitsList()`方法获取水果列表并将其存储在一个变量中。然后我们遍历`fruits`变量中所有可用的项目。

[PRE14]

在之前为`fruits`变量编写的代码中，有一个`List`集合。`foreach`循环将遍历存储在`fruits`变量中的`List`集合内的每个项目。在循环内部，一个`FruitsList`列表框控件将添加存储在`fruit`变量中的`fruits`集合中的每个项目。

[PRE15]

在我们将每个项目添加到列表框（`FruitsList`）之后，我们添加了一个显示`List`集合中项目数量的字符串。我们使用了`List`集合中的`Count`属性来获取该信息。在代码的最后一行，我们选择了`List`集合的`Capacity`属性。容量属性获取或设置内部数据结构可以不进行大小调整而容纳的总元素数。

在步骤26中，我们创建了一个`LittleShop()`类的实例，并使用`GetShopItems()`方法获取作为`ArrayList()`返回的项目。然后我们使用`for`循环获取第二个列表框中的项目。其余部分与我们对`List`集合所做的一样。

# 使用反射描述我们的库

在这个菜谱中，我们将构建一个具有两个公共方法的类对象。在使用控制台应用程序之后，我们将使用反射来描述这个类对象。反射赋予你读取其自身元数据以及在运行时查找程序集、类型和模块信息的能力。

# 准备工作

确保已安装Visual Studio 2017及其所有更新。我们将从一个空白解决方案开始。空白解决方案是任何规模项目的非常好的起点。让我们构建我们的.NET Standard 2.0库。

# 如何操作...

1.  打开Visual Studio 2017。

1.  点击“文件”|“新建”|“项目”，然后在“新建项目模板”对话框中，在左侧窗格的“其他项目类型”节点下选择“Visual Studio解决方案”，然后在右侧窗格中选择“空白解决方案”。

1.  在“名称：”文本框中，将`Chapter2.Reflections`作为解决方案的名称输入。在“位置：”下拉列表中选择一个首选位置或点击“浏览...”按钮选择一个位置。保留默认设置：

![图片](img/e94bbb65-3bb2-41c2-818d-80a471fe8c5e.png)

1.  点击“确定”。

1.  现在，在解决方案资源管理器（或按*Ctrl* + *Alt* + *L*），选择Chapter2.Reflections。右键单击并选择“添加”|“新项目”。

1.  在“添加新项目”对话框中，展开“Visual C#”节点，并在左侧窗格中选择“.NET Standard”。

1.  在右侧窗格中，选择“类库 (.NET Standard)”：

![图片](img/44ee992e-3c96-460b-adf5-2b95ce49e9ee.png)

1.  现在，在 名称： 文本框中，键入 `Chapter2.Reflections.CalculatorLib` 并保持 位置： 文本框不变：

![图片](img/c63ec722-e6e0-4e42-bd53-566d5c1a8a8e.png)

1.  点击确定。

1.  现在，解决方案资源管理器（按 *Ctrl* + *Alt* + *L* 打开）应该看起来像这样：

![图片](img/60c4ef83-e10d-4baf-ae96-95467761eabb.png)

1.  在项目树中选择 `Class1.cs` 并按 *F2*。

1.  将 `Class1.cs` 重命名为 `Calculator.cs`，同时确保你也将类名本身进行了相同的更改：

[PRE16]

1.  现在，解决方案资源管理器应该看起来像这样：

![图片](img/fd4c25cd-b407-4be3-b2af-f3d0f11846dc.png)

1.  在代码窗口中，在 `Calculator` 类的大括号之间，编写以下代码：

[PRE17]

1.  通过按 *Ctrl* + *Shift* + *B* 进行快速构建。

# 工作原理...

从步骤1到4，我们创建了一个空白解决方案。然后，从步骤5到9，我们在空白解决方案中添加了一个 .NET Standard 2.0 库。在步骤12中，我们将模板中提供的现有 `Class1.cs` 重命名为更有意义的东西。我们还重命名了类名以匹配文件名。这是一个好习惯，也是 Visual Studio 在创建全新的类时的默认行为。我们将名称更改为 `Calculator.cs` 并将类名更改为 `Calculator`。

在步骤14中，我们向 `Calculator` 类添加了两个简单的方法。第一个方法用于将给定的整数相加，第二个方法用于从一个整数中减去另一个整数。最后，我们快速构建以检查语法错误。

# 一个用于使用库的 .NET Core 控制台应用程序

让我们看看在这个配方中使用反射。在上一个配方中，我们构建了一个小的 .NET Standard 2.0 库。现在我们将创建一个基于 .NET Core 的控制台应用程序并使用反射来描述我们的库。我们将使用 `System.Reflection` 命名空间及其几个类

# 准备工作

确保你已经完成了上一个配方，如果没有，请完成它并返回这个配方。打开 Visual Studio 2017 并定位并打开之前构建的 .NET Standard 库。

# 如何操作...

1.  打开 Visual Studio 2017。

1.  现在打开上一个配方中的解决方案。单击 文件 | 打开 | 打开项目/解决方案，或按 *Ctrl* + *Shift* + *O*，并选择 `Chapter2.Reflections` 解决方案。

1.  按 *Ctrl* + *Shift* + *B* 进行快速构建以检查一切是否正常。

1.  现在，单击 Chapter2.Reflections 解决方案标签。单击 文件 | 添加 | 新项目。

1.  在 添加新项目 模板对话框中，展开左侧窗格中的 Visual C# 节点。

1.  在右侧窗格中选择 .NET Core，然后选择 控制台应用程序 (.NET Core)：

![图片](img/0c898c7e-73d5-4051-9a68-deb0c32f76d1.png)

1.  现在，在 名称： 文本框中，键入 `Chapter2.Reflections.ReflectCore` 作为项目的名称。其余字段应保持默认设置：

![图片](img/3dfeac57-0137-4b0b-9179-7d09eb06ca14.png)

1.  点击确定。

1.  现在，解决方案资源管理器（按 *Ctrl* + *Alt* + *L*）应该看起来像这样：

![图片](img/dcbb6288-addc-4e9a-94a9-5f073c78ddcb.png)

1.  右键单击`Chapter2.Reflections.CalculatorLib`中的“依赖项”标签。

1.  选择“添加引用”。

1.  在参考管理器中，点击右侧窗格中的“项目”标签。

1.  在左侧窗格中检查`Chapter2.Reflections.CalculatorLib`项目。

1.  点击“确定”。

1.  现在，双击`Program.cs`以打开代码窗口。

1.  在代码窗口中，滚动到屏幕顶部。

1.  在`using`指令的最后一行旁边，添加以下`using`指令：

[PRE18]

1.  再次，向下滚动直到到达`Main()`方法，并在`Main()`方法的括号之间写入以下代码：

[PRE19]

1.  让我们按*F5*并查看输出：

![](img/cc88f0b5-378c-44a2-85fe-0c8740cca464.png)

1.  按任意键退出。

# 它是如何工作的...

让我们看看步骤并尝试理解。在步骤1到3中，我们打开了一个包含.NET Standard 2.0库的现有解决方案。我们快速构建以检查所有语法是否正确，并且项目没有问题地编译。在步骤4到8中，我们将一个基于.NET Core的控制台应用程序添加到项目中，并给它一个合适的名称。

在步骤10到14中，我们从.NET Core控制台应用程序中添加了对.NET Standard 2.0库项目的引用。在步骤17中，我们将两个命名空间添加到了`Program.cs`代码中。一个是用于访问反射类，这些类包含在`System.Reflection`命名空间中。另一个是.NET Standard 2.0库本身。

在步骤18中，我们在`Program.cs`的`Main()`方法中添加了代码：

[PRE20]

在第一行代码中，我们将一个名为`info`的变量存储了一个`Calculator`类类型，该变量是`System.Reflections.MemberInfo()`类型。在第二行代码中，我们使用`Name`属性访问了程序集类的名称，而再次使用`Module.Name`属性访问了模块名称。`Member Info()`类允许您获取成员的属性信息，并提供对成员元数据的访问：

[PRE21]

在前面的几行代码中，我们在.NET Standard 2.0库内部创建了一个`Calculator()`类的实例。在第二行中，我们存储了类的类型。在第三行中，我们有一个名为`methods`的变量，用于存储该类内部所有可用的运行时方法。由于`GetRuntimeMethods()`是一个集合，我们可以轻松地使用`foreach`语句遍历集合。最后，在`foreach()`语句内部，我们输出了`Calculator()`类内部每个方法的名称和返回类型。

最后，我们等待用户按任意键退出控制台应用程序。

在步骤*19*中，在输出中，您可能会注意到除了我们创建的两个公共方法之外，还有更多方法。这些方法来自基`Object`类本身。

# 构建.NET Standard 2.0库，使用LINQ

在这个示例中，我们将在我们的.NET Standard 2.0库中使用LINQ。LINQ代表.NET语言集成查询。LINQ定义了一组通用标准查询操作符：列表、选择、排序和投影操作符，这些操作符可以在任何.NET编程语言中使用。标准查询操作符允许查询应用于任何基于`IEnumerable<T>`的信息源。

我们将构建一个利用LINQ的.NET Standard 2.0库，并在下一个示例中使用这个库。

# 准备工作

让我们通过打开Visual Studio 2017并创建一个基于.NET Standard 2.0库的项目来做好准备。我们可以从一个空白解决方案开始，稍后添加库项目。

# 如何操作...

1.  打开Visual Studio 2017。

1.  点击“文件”|“新建”|“项目”，然后在左侧窗格的“其他项目类型”节点下选择“Visual Studio解决方案”，然后在右侧窗格中选择“空白解决方案”。

1.  在“名称”文本框中，输入`Chapter2.Linq`作为解决方案的名称。在“位置”下拉列表中选择一个首选位置，或点击“浏览...”按钮选择一个位置。保留默认设置：

![图片](img/e4c790ae-563b-4ade-ae31-7783318dcab0.png)

1.  点击“确定”。

1.  现在，在解决方案资源管理器（或按*Ctrl* + *Alt* + *L*），选择Chapter2.Linq。右键单击并选择“添加”|“新建项目”。

1.  在“添加新项目”对话框中，展开“Visual C#”节点，并在左侧窗格中选择.NET Standard。

1.  在右侧窗格中，选择“类库 (.NET Standard)”。

![图片](img/2c7235a4-bef0-48a6-9177-339bafacb4ac.png)

1.  现在，在“名称”文本框中，输入`Chapter2.Linq.QueriesLib`，并保留“位置”文本框不变：

![图片](img/46570710-4850-4efd-be6d-5b3f7a2723ff.png)

1.  点击“确定”。

1.  现在，解决方案资源管理器（按*Ctrl* + *Alt* + *L*打开）应该看起来像这样：

![图片](img/4446b8fd-d524-4b9c-8d92-2dfedb849cbe.png)

1.  在项目树中选择Class1.cs并按*F2*。

1.  将`Class1.cs`重命名为`TelephoneBook.cs`，同时确保你也将类名本身进行了相同的更改。

1.  在确认对话框中点击“是”以确认重命名。

1.  现在，解决方案资源管理器应该看起来像这样：

![图片](img/93a2abd6-f0bd-4ca6-b21b-c5b4e582a334.png)

1.  双击TelephoneBook.cs文件以打开代码窗口。

1.  现在，将代码窗口滚动到顶部，并在`using`指令的最后一行旁边添加以下代码：

[PRE22]

1.  再次，滚动到`TelephoneBook`类的开括号处，并添加以下代码：

[PRE23]

1.  现在，在下一行，将以下代码作为`constructor`方法添加：

[PRE24]

1.  在构造函数旁边添加以下代码：

[PRE25]

1.  再次，在`GetContacts()`方法的末尾添加此代码块：

[PRE26]

1.  最后，在`GetContactsByLastName()`方法的末尾添加以下代码块：

[PRE27]

1.  现在我们已经将代码添加到.NET Standard 2.0库中，让我们按*Ctrl* + *Shift* + *B*进行快速构建并检查语法错误。

# 它是如何工作的...

从步骤1到4，我们使用Visual Studio 2017创建了一个空白解决方案，并给它指定了一个位置和有意义的名称。然后，从步骤5到9，我们在空白解决方案中添加了一个新的.NET Standard 2.0库。像往常一样，我们给它起了一个恰当且有意义的名字。

在步骤12和13中，我们将默认的 `Class1.cs` 模板重命名为 `TelephoneBook.cs`。保持类和文件名相同是一个好习惯。当你回到代码时，这会使代码更易读、更易理解。在步骤16中，我们向代码中添加了两个命名空间。`System.Collections.Generic` 将为你提供代码中使用的 `List<T>` 类，而 `System.Linq` 通过允许使用LINQ功能，为你提供了对那些泛型集合的更多控制。

在步骤17中，我们引入了一个类型为 `List<string>` 的私有变量。在步骤18中，我们初始化了这个变量并向列表中添加了一些数据。  所有这些都是在 `TelephoneBook()` 类的构造函数中完成的。在步骤19中，我们创建了一个返回联系人列表的方法。它只有一行代码，返回了填充后的列表。

再次，在步骤20中，我们创建了一个接受字符串作为参数的方法。该参数是姓氏，我们在这行代码中使用了LINQ查询：

[PRE28]

我们使用了一个 `Where` 子句来过滤列表，并使用内联函数将 `lastName` 参数传递给操作。最后，我们将结果作为列表输出，并在方法末尾返回结果。

在步骤21中，我们创建了一个使用LINQ对列表进行排序的方法。`GetSortedContacts()` 方法接受一个布尔参数，它是可选的。C#自C# 4.0以来就支持可选参数。

[PRE29]

上一行代码使用了列表中的 `OrderBy()` 方法来按升序排序列表，并将其作为列表传递。如果我们需要降序排序，只需将方法参数传递为 `false`。

# 使用库的ASP.NET MVC应用程序

在这个菜谱中，我们将创建一个ASP.NET MVC应用程序来使用.NET Standard 2.0库。这个库是在上一个菜谱中创建的。ASP.NET MVC应用程序在基于Windows的系统下运行于IIS，并使用完整的.NET Framework。我们将从一个空的ASP.NET MVC项目开始，然后转向其组件和库的使用。

# 准备工作

定位之前构建的.NET Standard 2.0库，并确保它构建时没有错误。还假设你具备基于MVC的ASP.NET应用程序的基本知识，并且熟悉术语模型（Models）、视图（Views）和控制器（Controllers）。

# 如何操作...

1.  打开Visual Studio 2017。

1.  现在，打开上一个菜谱中的解决方案。点击 文件 | 打开 | **打开项目/解决方案**，或者按 *Ctrl* + *Shift* + *O*，然后选择Chapter2.Linq解决方案。

1.  按 *Ctrl* + *Shift* + *B* 进行快速构建以检查一切是否正常。

1.  现在，点击Chapter2.Linq解决方案标签。点击 文件 | 添加 | 新项目。

1.  在 添加新项目 模板对话框中，展开左侧窗格中的Visual C#节点。

1.  在右侧窗格中选择 Web，然后选择 ASP.NET Web 应用程序 (.NET Framework)：

![](img/20a27ff5-8440-47b4-9efd-d52f03e50785.png)

1.  现在，在“名称：”文本框中，键入`Chapter2.Linq.QueriesMVC`作为名称，并将“位置：”文本框保留在默认值：

![](img/abf53291-f64e-4a65-86f4-81520db37cf4.png)

1.  在新 ASP.NET Web 应用程序对话框中，从模板列表中选择空：

1.  选择MVC作为“为以下添加文件夹和核心引用”的选项：

![](img/8cddcabf-0bb7-45e7-b831-8569d4a9dc36.png)

1.  保持其余部分不变，并点击确定以创建默认的 ASP.NET MVC Web 应用程序模板。

1.  现在，解决方案资源管理器应该看起来像这样：

![](img/6e9e4007-12da-496d-a4df-d884af83963b.png)

1.  现在，在`Chapter2.Linq.QueriesMVC`项目中的“控制器”文件夹内右键单击。

1.  选择添加 | 控制器。

1.  在添加脚手架对话框中，选择MVC 5 控制器 - 空的：

![](img/844d157d-f6a6-4d5a-9ce4-67c67e954f4b.png)

1.  点击添加。

1.  在添加控制器对话框中，将控制器名称键入为`HomeController`：

![](img/8a1937df-7064-41f2-8a42-6d206c147b2a.png)

1.  点击添加。

1.  现在，解决方案资源管理器（按 *Ctrl* + *Alt* + *L*）应该看起来像这样：

![](img/070304a9-3490-43c0-9ef5-b6e8bed16785.png)

1.  现在，右键单击“引用”标签并选择添加引用。

1.  在参考管理器中，选择项目并从列表中检查Chapter2.Linq.QueriesLib：

![](img/d012a394-ca29-4efa-bada-2018e2ca7894.png)

1.  点击确定。

1.  现在，在“控制器”文件夹中双击`HomeController.cs`。

1.  在`HomeController.cs`代码窗口中，向上滚动并在`using`指令的最后一行添加以下代码：

[PRE30]

1.  在`Index()`动作中，在`return`关键字之前添加以下代码：

[PRE31]

1.  右键单击`Index()`方法的名称并选择添加视图：

![](img/a88b630b-98ca-45b6-8a5a-cb71f46d38c6.png)

1.  在添加视图对话框中，保留默认设置并点击添加：

![](img/09bdfcf0-0e0c-46ca-9c1e-c5f3dbad7a10.png)

1.  你将看到一个带有默认模板的`Index.cshtml`代码窗口。

1.  将代码`<h2>Index</h2>`更改为以下内容：

[PRE32]

1.  现在，将光标移至代码窗口的底部并添加此代码：

[PRE33]

1.  让我们按 *F5* 测试代码。

1.  默认情况下，浏览器将加载`http://localhost:portnumber/Home/`，这里是输出：

![](img/773addf4-9c10-4293-80a7-9438d60fb097.png)

1.  现在让我们关闭浏览器并切换回`HomeController.cs`代码窗口。

1.  在`Index()`动作方法的结束花括号之后，添加以下代码：

[PRE34]

1.  右键单击`Search()`动作的方法名称并选择添加视图。

1.  按步骤 *26* 和 *27* 添加`Search.chtml`视图。

1.  在`Search.chtml`代码窗口中，将代码`<h2>Search</h2>`更改为以下内容：

[PRE35]

1.  在`<h2>`标签之后将以下代码添加到`Search.chtml`中：

[PRE36]

1.  让我们按 *F5* 调试当前代码。

1.  在浏览器地址栏中输入`http://localhost:portnumber/Home/Search`并按 *Enter*：

![](img/54913537-199c-43db-aa32-cd640d0d1616.png)

1.  现在再次，在地址栏中输入`http://localhost:portnumber/Home/Search?ln=Marrier`并按*Enter*键：

![图片](img/cdda6873-2d9b-44f4-be7d-ef88c4be9987.png)

1.  关闭浏览器并切换回`HomeController.cs`代码窗口。

1.  在`Search()`动作方法之后添加以下代码：

[PRE37]

1.  右键单击`SortedContacts()`动作的方法名称，然后选择添加视图。

1.  按照步骤*26*和*27*添加`SortedContacts.chtml`视图。

1.  现在，在`SortedContacts.chtml`中，将`<h2>SortedContacts</h2>`更改为`<h2>Sorted Contacts</h2>`。

1.  在`<h2>`标签的末尾添加以下代码。

[PRE38]

1.  按*F5*键以调试当前代码。

1.  在浏览器地址栏中输入`http://localhost:portnumber/Home/SortedContacts`并按*Enter*键：

![图片](img/1dabb79c-f045-4a7e-913c-27d2bedec8d3.png)

1.  再次，在地址栏中输入`http://localhost:51084/Home/SortedContacts?asc=false`并按*Enter*键：

![图片](img/026b9e17-9f8b-4341-bb56-85b280144ba5.png)

1.  关闭浏览器。

# 它是如何工作的...

让我们看看完成后的步骤。从步骤1到3，我们打开了一个现有的解决方案，这是在之前的菜谱中完成的。然后我们快速构建以进行语法检查。从步骤4到6，我们在现有解决方案中添加了一个ASP.NET Web应用程序项目。在第7步，我们给它起了个合适的名字。

之后，在步骤8和9中，我们决定它应该是什么样的ASP.NET Web应用程序。在这种情况下，我们选择了MVC空模板。在步骤13到15中，我们向MVC应用程序添加了一个控制器。我们选择了一个空的MVC 5控制器。

在步骤19到21中，我们从.NET Standard 2.0库中添加了引用。在第23步，我们在代码级别引用了它。在第24步，代码的第一行中，我们创建了一个`TelephoneBook()`类的实例。在第二行中，我们调用了`GetContacts()`方法并将其存储在`ViewBag.Contacts`中。`ViewBag`用于从控制器向视图发送数据。

从步骤25到27，我们向控制器动作方法中添加了一个视图。在第28步，我们更改了Visual Studio为我们创建的`View`模板中的现有代码。然后，我们使用Razor语法遍历联系人。在步骤30和31中，我们在浏览器中测试了代码。

从步骤31到50，我们创建了视图并测试了`TelephoneBook()`类中找到的其他方法。
